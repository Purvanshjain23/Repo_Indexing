// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMQAXFR
// ?Date: 14.08.2025 Time: 03:43:45
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?***** Change Log and Comments
DO;

//?** E01523 RMC 5/02/2011 Use req delv dt/time for ddt calc always
//?** 10/01/2009 LJB E00495 Use Carrier Appointment date/time, if
//?**    entered to calc Must Ship
//?** 11/21/2007 LJB FP1251 Set Must Ship Error code to Yes if
//?**    Miles To Next Stop is zeros
ENDDO;

// PAR.Must Ship Error = CND.No Error
PAR.Must_Ship_Error = *BLANK;

EXECUTE FUNCTION(CLC Must Ship/Load     RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1520283;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Order_Number);
PARAMETER(WRK.Must_Ship_Error);
PARAMETER(PAR.Warehouse_Code);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?E01523 RMC 5/02/2011 Use req delv dt/time for ddt calc always
 //?10/01/2009 LJB E00495  If Carrier Appt Date/Time entered in
 //?      Load Detail, use it for Must Ship calcs, else use
 //?      Requested Delivery Date/Time
 //?05/12/04 SLM PKTR01 Multi-Company - Function was changed
 //?      to remove Company RST or Pos
 ENDDO;

 // PAR.Must Ship Error = CND.No Error
 PAR.Must_Ship_Error = *BLANK;

 //?USER: Process Data record

 //?Set warehouse code
 CASE;

 // IF PAR.Warehouse Code EQ WRK.BLANK
 IF PAR.Warehouse_Code = WRK.BLANK;

 EXECUTE FUNCTION(RTV 1st Warehouse/Ctl  RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1360958;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(PAR.USR_Warehouse_Code);
 PARAMETER(WRK.TXT_field_not_needed);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  EXECUTE FUNCTION(RTV Warehouse Control  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1304300;
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(PAR.Trans_Contol_AS400_Plant);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

 }

 //?Set warehouse code
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.USR Warehouse Code = PAR.Warehouse Code
 PAR.USR_Warehouse_Code = PAR.Warehouse_Code;

 ENDIF;

 //?Check if dates in order
 CASE;

 // IF DB1.Shipping Method is Buyers Truck
 IF DB1.Shipping_Method = 'CR'/'CT';

 //?       don't edit dates for buyers truck orders/loads
 //?Check if dates in order
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?E01523 RMC 5/02/2011 Use req delv dt/time for ddt calc always
 // WRK.USR Date - ATR = DB1.Requested Delivery Date
 WRK.USR_Date_ATR = DB1.Requested_Delivery_Date;

 // WRK.USR To Time 4.0 = DB1.Requested Delivery Time
 WRK.USR_To_Time_4_0 = DB1.Requested_Delivery_Time;

 // Call program CLC Must Ship Date     XF.
 CALL PROGRAM(CLC Must Ship Date     XF) ('PDJBXFR');
 PARAMETER(PAR.Must_Ship_Error);
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Ship_To_City);
 PARAMETER(DB1.Ship_To_State_Code);
 PARAMETER(DB1.Requested_Ship_Date);
 PARAMETER(DB1.Scheduled_Ship_Date);
 PARAMETER(WRK.USR_Date_ATR);
 PARAMETER(WRK.USR_To_Time_4_0);
 PARAMETER(DB1.Load_ID);
 PARAMETER(PAR.USR_Warehouse_Code);
 PARAMETER(PAR.Must_Ship_Date_USR);
 PARAMETER(PAR.Must_Ship_Time_USR);

 //?When find an error, quit
 CASE;

 // IF PAR.Must Ship Error is No Error
 IF PAR.Must_Ship_Error = *BLANK;

 // OR PAR.Must Ship Error is Req Ship should =Must Shp
 OR PAR.Must_Ship_Error = 'RSD';

 //?               do nothing
 //?When find an error, quit
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?** error if Miles to Next=Zeros or dates out of order or no time to ship
 QUIT;

 ENDIF;

 ENDIF;

}


// PAR.Must Ship Error = WRK.Must Ship Error
PAR.Must_Ship_Error = WRK.Must_Ship_Error;

