     H/TITLE WW Production Items   DF  Display file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Display file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 12/16/13  Time  : 14:51:25
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDCWDFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW Production Items   DF  Display file
      *
     FPDI8CPLAIF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : PS Prod Item Schedule     Typ/Dte/Pwhs/Itm/Whs/Co
      *
     FPDKMREL1IF  E           K        DISK
      * RTV : Company Values            Retrieval index
      *
     FCAAFREL3IF  E           K        DISK
      * RSQ : Calendar                  Co/Date               NV
      *
     FCAAFREL1IF  E           K        DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FCABZREL1IF  E           K        DISK
      * RTV : Company Item              Retrieval index       NV
      *
     FPMFDREL2IF  E           K        DISK
      * RSQ : Company Item Ext          RTV, select Active
      *
     FPBBFREL1IF  E           K        DISK
      * RTV : PS Production Capacity    Retrieval index
      *
     FOPBGWKLNIF  E           K        DISK
      * RSQ : Order Detail              Co/Item/Whs/SSD/Ord NCRX
      *
     FOPBFCPL1IF  E           K        DISK
      * RTV : Order Header TRG          Retrieval index       NV
      *
     FCAB0RELCIF  E           K        DISK
      * RSQ : Item Balance              Co/Whse/Item
      *
     FCAB7CPLJIF  E           K        DISK
      * RSQ : Item Transaction Detail   Co/Itm/Whs/PDte    R/RR
      *
     FCAABREL1IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       V
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     E                    J7          7  1
     E                    K7          7  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    J3          3  1
     E                    K3          3  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    #L7         7  1
     E                    #L3         3  1
     E                    UCT        40  1               CENTER TABLE
      * Screen: Field position and name array
     E                    W0BEG   7 034  5 0A
     E                    W0END   7 034  5 0A
     E                    W0NAM   7 034 10
      * Long constants
     E                    @CN#    1  20  6   @CN    25
     E                    YDOW        7  1               *Days of week
     I@AFREBE
      * Calendar                  Retrieval index       NV
      * Renamed input format fields
     I              AFAIC3                          WAAIC3
     I              AFBCDT                          WABCDT
     I              AFCQNB                          WACQNB
     I              AFESNB                          WAESNB
     I              AFETNB                          WAETNB
     I              AFBZNB                          WABZNB
     I              AFA9ST                          WAA9ST
     I              AFEINB                          WAEINB
     I              AFC5ST                          WAC5ST
     I              AFAQNB                          WAAQNB
     I              AFCMST                          WACMST
     I              AFV9ST                          WAV9ST
     I              AFWAST                          WAWAST
     I              AFX2ST                          WAX2ST
     I              AFOJDT                          WAOJDT
     I              AFNQNX                          WANQNX
     I              AFNRNX                          WANRNX
     I              AFI9SX                          WAI9SX
     I              AFJASX                          WAJASX
     I              AFOKDT                          WAOKDT
     I              AFOLDT                          WAOLDT
     I              AFUVST                          WAUVST
     I              AFUWST                          WAUWST
     I              AFUXST                          WAUXST
     I              AFAATM                          WAAATM
     I              AFAYNA                          WAAYNA
     I              AFA0NA                          WAA0NA
     I              AFAXDT                          WAAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      * Outward parameters
     IPARC        DS                             14
      * KEY : PS Prod Item Schedule     Retrieval index
      * I : RST Company Number
     I                                    P   1   20PAAIC3
      * I : RST Production Type
     I                                        3   3 PAV5ST
      * I : RST Production Date
     I                                    P   4   70PAELDT
      * I : RST Item Code
     I                                    P   8  110PAHGCD
      * I : RST Warehouse Code
     I                                       12  14 PAAJCD
      *
      * Outward parameters
     IPBRC        DS                             16
      * KEY : PS Production Detail Com  Retrieval index
      * I : RST Company Number
     I                                    P   1   20PBAIC3
      * I : RST Production Type
     I                                        3   3 PBV5ST
      * I : RST Production Date
     I                                    P   4   70PBELDT
      * I : RST Item Code
     I                                    P   8  110PBHGCD
      * I : RST Warehouse Code
     I                                       12  14 PBAJCD
      *
      * Outward parameters
     IPCRC        DS                             18
      * KEY : PS Production Adjustment  Retrieval index
      * I : MAP Company Number
     I                                    P   1   20PCAIC3
      * I : MAP Production Date
     I                                    P   3   60PCELDT
      * I : MAP Item Code
     I                                    P   7  100PCHGCD
      * I : MAP Warehouse Code
     I                                       11  13 PCAJCD
      * I : MAP PS Adjustment Type
     I                                       14  15 PCPSAD
      * I : MAP PS Adjustment Number
     I                                    P  16  180PCPSAN
      *
      * Outward parameters
     IPDRC        DS                             13
      * KEY : Order Detail Schedule     Co/Item/Whse/SchdDte
      * I : RST Company Number
     I                                    P   1   20PDAIC3
      * I : RST Item Code
     I                                    P   3   60PDHGCD
      * I : RST Warehouse Code
     I                                        7   9 PDAJCD
      *
      * Outward parameters
     IPERC        DS                             27
      * KEY : Order Detail              CItm/PrWhs/SSD/Itm/DD+
      * I : RST Consumed Item Code
     I                                    P   1   40PENUDT
      * I : RST Production Warehouse
     I                                        5   7 PEF6SX
      *
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             17
      * KEY: PS Prod Item Schedule     Typ/Dte/Pwhs/Itm/Whs/Co
      * I : RST Production Type
     I                                        1   1 P1V5ST
      * I : RST Production Date
     I                                    P   2   50P1ELDT
      * I : RST PS Production Warehouse
     I                                        6   8 P1B7ST
     IP2PARM      DS
      * FLD: *Arrays
      * N :  Warehouse Code
     I                                        1   3 P2AJCD
      * N :  Application Code
     I                                        4   9 P2DNCD
      * N :  Enterprise Code 1
     I                                       10  13 P2DQCD
      * N :  Enterprise Code 2
     I                                       14  25 P2DRCD
      * N :  Salesperson Code
     I                                       26  28 P2BCCD
      * N :  System Date Format
     I                                       29  31 P2B8NA
      * N :  User Profile Name
     I                                       32  41 P2AJVN
      * N :  Allow Multi-Company
     I                                       42  42 P2I6ST
      * N :  Default Printer
     I                                       43  52 P2MPNA
      * N :  First Time Flag
     I                                       53  53 P2TAST
      * N :  System Value Alpha
     I                                       54  93 P2BXTX
      * N :  Access Denied (Y/N)
     I                                       94  94 P2WVST
     IP3PARM      DS
      * FLD: *Arrays
      * N :  PRT Printer Device
     I                                        1  10 P3WRST
      * N :  PRT Hold Output Sts
     I                                       11  14 P3WSST
      * N :  PRT Save Output Sts
     I                                       15  18 P3WTST
      * N :  PRT Number of Copies
     I                                       19  200P3DYNB
      * N :  PRT Night Queue
     I                                       21  30 P3BVVN
      * N :  Program name USR
     I                                       31  40 P3BMVN
      * N :  Program Name$ USR
     I                                       41  50 P3BWVN
      * N :  Display Prt Opt Pmt USR
     I                                       51  54 P3XFST
      * N :  Warehouse Code PASS   USR
     I                                       55  57 P3T3CD
     IP4PARM      DS
      * N :  Status - Y or N
     I                                        1   1 P4B8ST
     IP5PARM      DS
      * N :  Report Type Schedule  USR
     I                                        1   1 P5RYST
     IP6PARM      DS
      * FLD: Company Item
      * N :  U/M - Primary
     I                                        1   2 P6ADCD
      * N :  Unit Weight
     I                                    P   3   82P6AIWG
      * N :  Fresh Chilling Time
     I                                    P   9  112P6CHTM
      * N :  Piece Count Item
     I                                       12  12 P6PCCT
      * N :  Pieces Per Bag
     I                                    P  13  160P6BDNB
      * N :  Bags Per Unit
     I                                    P  17  200P6BJNB
      * N :  Primal Group Code
     I                                       21  26 P6XRCD
     IP7PARM      DS
      * FLD: *Arrays
      * N :  Avail Ship Date 1 USR
     I                                    P   1   40P7H6DT
      * N :  Avail Ship Date 2 USR
     I                                    P   5   80P7H7DT
      * N :  Avail Ship Date 3 USR
     I                                    P   9  120P7H8DT
      * N :  Avail Ship Date 4 USR
     I                                    P  13  160P7H9DT
      * N :  Avail Ship Date 5 USR
     I                                    P  17  200P7IADT
      * N :  Avail Ship Date 6 USR
     I                                    P  21  240P7IBDT
      * N :  Avail Ship Date 7 USR
     I                                    P  25  280P7INDT
      * N :  Avail Ship Date 8 USR
     I                                    P  29  320P7IODT
      * N :  Avail Ship Date 9 USR
     I                                    P  33  360P7IPDT
      * N :  Avail Ship Date 10 USR
     I                                    P  37  400P7IQDT
      * N :  Avail Ship Date 11 USR
     I                                    P  41  440P7IRDT
      * N :  Avail Ship Date 12 USR
     I                                    P  45  480P7ISDT
      * N :  Avail Ship Date 13 USR
     I                                    P  49  520P7ITDT
      * N :  Avail Ship Date 14 USR
     I                                    P  53  560P7IUDT
      * N :  Avail Ship Date 15 USR
     I                                    P  57  600P7IVDT
      * N :  Avail Ship Date 16 USR
     I                                    P  61  640P7IWDT
      * N :  Avail Ship Date 17 USR
     I                                    P  65  680P7IXDT
      * N :  Avail Ship Date 18 USR
     I                                    P  69  720P7IYDT
      * N :  Avail Ship Date 19 USR
     I                                    P  73  760P7IZDT
      * N :  Avail Ship Date 20 USR
     I                                    P  77  800P7I0DT
      * N :  Avail Ship Date 21 USR
     I                                    P  81  840P7I1DT
      * N :  Production Date USR
     I                                    P  85  880P7GXDT
      * N :  Prod Date Alpha USR
     I                                       89  95 P7TOTX
      * N :  Status Flag 1  Y/N
     I                                       96  96 P7Q1ST
     IP8PARM      DS
      * FLD: Calendar
      * N :  Day of Week
     I                                        1   1 P8A9ST
      * N :  Kill Day Status
     I                                        2   2 P8V9ST
      * N :  Production Day Status
     I                                        3   3 P8WAST
     IP9PARM      DS
      * FLD: *Arrays
      * N :  Quantity Production USR
     I                                    P   1   41P9WPRD
      * N :  Date Mon USR
     I                                    P   5   80P9JHDT
      * N :  Week Number
     I                                    P   9  100P9EINB
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'CD7 Non numeric data'
      * Message data for 'CD7 Non numeric data'
      * Message data for 'CD3 Non numeric data'
      * Message data for 'PS Prd Type Required'
      * Production Type
     I                                        1   1 ZA0001
      * Message data for 'Date must be entered'
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0002
      * Application Code
     I                                       11  16 ZA0003
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0004
      * Application Code
     I                                       11  16 ZA0005
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: PS Prod It
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile control
      * CASE: WRK.First Time Flag is Yes
     C           WUTAST    IFEQ 'Y'                        *IF
     C                     Z-ADD#CNUDT    WUNUDT           Consumed Item C
     C                     MOVEL'N'       WUTAST           First Time Flag
     C                     END                             *FI
     C                     MOVEL#CS0CD    WUCKAA           Item Category C
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           I8V5ST           Production Type
     C                     KFLD           I8ELDT           Production Date
     C                     KFLD           I8B7ST           PS Production W
     C                     KFLD           I8HGCD           Item Code
     C                     KFLD           I8AJCD           Warehouse Code
     C                     KFLD           I8AIC3           Company Number
      * Setup key
     C                     MOVEL#2V5ST    I8V5ST
     C                     Z-ADD#2ELDT    I8ELDT
     C                     MOVEL#2B7ST    I8B7ST
     C                     Z-ADD#2HGCD    I8HGCD
     C                     MOVEL#2AJCD    I8AJCD
     C                     Z-ADD#2AIC3    I8AIC3
     C           KPOS      SETLL@I8CPBS
     C           KRST      KLIST
     C                     KFLD           I8V5ST           Production Type
     C                     KFLD           I8ELDT           Production Date
     C                     KFLD           I8B7ST           PS Production W
      * Setup key
     C                     MOVEL#2V5ST    I8V5ST
     C                     Z-ADD#2ELDT    I8ELDT
     C                     MOVEL#2B7ST    I8B7ST
     C           KRST      READE@I8CPBS                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2R3CD    WZR3CD
     C                     MOVEL#2R3CD    WZR3CD           Department Code
     C           *LIKE     DEFN #2DVWG    WZDVWG
     C                     MOVEL#2DVWG    WZDVWG           PS Weight Order
     C           *LIKE     DEFN #2DWWG    WZDWWG
     C                     MOVEL#2DWWG    WZDWWG           PS Weight FX Ad
     C           *LIKE     DEFN #2AVWT    WZAVWT
     C                     MOVEL#2AVWT    WZAVWT           PS Weight Avail
     C           *LIKE     DEFN #2WTON    WZWTON
     C                     MOVEL#2WTON    WZWTON           PS Weight Produ
     C           *LIKE     DEFN #2DXWG    WZDXWG
     C                     MOVEL#2DXWG    WZDXWG           PS Weight Stand
     C           *LIKE     DEFN #2QTSP    WZQTSP
     C                     MOVEL#2QTSP    WZQTSP           PS Pieces Plann
     C           *LIKE     DEFN #2QTAS    WZQTAS
     C                     MOVEL#2QTAS    WZQTAS           PS Weight Sched
     C           *LIKE     DEFN #2B7ST    WZB7ST
     C                     MOVEL#2B7ST    WZB7ST           PS Production W
     C           *LIKE     DEFN #2ELDT    WZELDT
     C                     MOVEL#2ELDT    WZELDT           Production Date
     C           *LIKE     DEFN #2V5ST    WZV5ST
     C                     MOVEL#2V5ST    WZV5ST           Production Type
     C           *LIKE     DEFN #2TEST    WZTEST
     C                     MOVEL#2TEST    WZTEST           PS Print On Sch
     C           *LIKE     DEFN #2HGCD    WZHGCD
     C                     MOVEL#2HGCD    WZHGCD           Item Code
     C           *LIKE     DEFN #2AJCD    WZAJCD
     C                     MOVEL#2AJCD    WZAJCD           Warehouse Code
     C           *LIKE     DEFN #2AIC3    WZAIC3
     C                     MOVEL#2AIC3    WZAIC3           Company Number
     C           *LIKE     DEFN #2XRCD    WZXRCD
     C                     MOVEL#2XRCD    WZXRCD           Primal Group Co
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@I8CPBS                  90*
     C  N82                READ @I8CPBS                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,39
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2R3CD    IFNE *BLANK                     Department Code
     C           I8R3CD    CABNE#2R3CD    BB020            Department Code
     C                     END
     C           #2DVWG    IFNE *ZERO                      PS Weight Order
     C           I8DVWG    CABNE#2DVWG    BB020            PS Weight Order
     C                     END
     C           #2DWWG    IFNE *ZERO                      PS Weight FX Ad
     C           I8DWWG    CABNE#2DWWG    BB020            PS Weight FX Ad
     C                     END
     C           #2AVWT    IFNE *ZERO                      PS Weight Avail
     C           I8AVWT    CABNE#2AVWT    BB020            PS Weight Avail
     C                     END
     C           #2WTON    IFNE *ZERO                      PS Weight Produ
     C           I8WTON    CABNE#2WTON    BB020            PS Weight Produ
     C                     END
     C           #2DXWG    IFNE *ZERO                      PS Weight Stand
     C           I8DXWG    CABNE#2DXWG    BB020            PS Weight Stand
     C                     END
     C           #2QTSP    IFNE *ZERO                      PS Pieces Plann
     C           I8QTSP    CABNE#2QTSP    BB020            PS Pieces Plann
     C                     END
     C           #2QTAS    IFNE *ZERO                      PS Weight Sched
     C           I8QTAS    CABNE#2QTAS    BB020            PS Weight Sched
     C                     END
     C           #2HGCD    IFEQ *ZERO                      Item Code
     C           #2AJCD    IFNE *BLANK                     Warehouse Code
     C           I8AJCD    CABNE#2AJCD    BB020            Warehouse Code
     C                     END
     C                     END
     C           #2HGCD    IFEQ *ZERO                      Item Code
     C           #2AJCD    OREQ *BLANK                     Warehouse Code
     C           #2AIC3    IFNE *ZERO                      Company Number
     C           I8AIC3    CABNE#2AIC3    BB020            Company Number
     C                     END
     C                     END
     C           #2XRCD    IFNE *BLANK                     Primal Group Co
     C           I8XRCD    CABNE#2XRCD    BB020            Primal Group Co
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
      * *Set Cursor: CTL.Item Code  (*Override=*YES)
     C                     Z-ADD*ZERO     W0RR0
     C                     Z-ADD012       W0ROW0
     C                     Z-ADD005       W0COL0
     C                     MOVEL'1'       W0OVR0           *YES
      * First time only
      * CASE: CTL.Base Frozen    USR is blank
     C           #CWQST    IFEQ *BLANK                     *IF
      * RTV Alpha Value        RT - Company Values  * 
     C                     EXSR SARVGN
     C                     MOVELP2BXTX    #CWQST           Base Frozen
      * RTV Day and Week No.   RT - Calendar  * 
     C                     EXSR SBRVGN
      * CASE: PAR.Day of Week is Friday
     C           P8A9ST    IFEQ '6'                        *IF
      * WRK.Date Sat USR = CTL.Production Date + CON.1 *DAYS
     C           #2ELDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD1         XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL@CN,003   XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     WUJMDT
     C                     ELSE
     C           XDINDT    SUB  1000000   WUJMDT
     C                     END
      * Rtv Kill/Prod Day Sts RT - Calendar  * 
     C                     EXSR SCRVGN
     C                     END                             *FI
     C                     END                             *FI
      * Rtv Prd Sch InfoPSPRIMRT - Company Item  * 
     C                     EXSR SDRVGN
      * Verify if the Primal Group Report (item category 06 = co/item
      * CASE: CTL.Item Category Code 6 NE WRK.Blank for 3          USR
     C           #CS0CD    IFNE WUUAT1                     *IF
      * Verify if the Primal Group Report (item category 06 = co/item
      * CASE: CTL.Item Category Code 6 EQ RCD.Item Category Code 6
     C           #CS0CD    IFEQ #RS0CD                     *IF
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     END                             *FI
      * Rtv CIE Capacity Qty  RT - Company Item Ext  * 
     C                     EXSR SERVGN
      * CIE Capacity code selection
      * CASE:
      *  - c1ORc2
      *   |- c1    : CTL.CIE Capacity Code is Not Entered
      *   |- c2    : CTL.CIE Capacity Code EQ RCD.CIE Capacity Code
      *   '-
     C           #CKUAA    IFEQ *BLANK                     *IF
     C           #CKUAA    OREQ #RKUAA                     *OR
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * Print on Schedule selection
      * CASE: CTL.PS Print On Schedule is yes
     C           #2TEST    IFEQ 'Y'                        *IF
      * If item is marked as print on schedule "N"o then don't display
      * CASE: RCD.PS Print On Schedule is yes
     C           #1TEST    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     ELSE
      * CASE: CTL.PS Print On Schedule is no
     C           #2TEST    IFEQ 'N'                        *IF
      * If item is marked do not print on schedule select N only
      * CASE: RCD.PS Print On Schedule is no
     C           #1TEST    IFEQ 'N'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Ctl print on schedul is no value,  so do not check
     C                     END                             *FI
     C                     END                             *FI
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * If day of week is friday & no prod/no kill add sat ords to total
      * CASE: PAR.Day of Week is Friday
     C           P8A9ST    IFEQ '6'                        *IF
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Kill Day Status is no
      *   |- c2    : PAR.Production Day Status is no
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P8V9ST    IFEQ 'N'                        *IF
     C           P8WAST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * RTV Order Qty & Wght 2 RT - Order Detail  * 
     C                     EXSR SGRVGN
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Order Qty & Weight RT - Order Detail  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1AIC3    WL0005           Company Number
     C                     Z-ADD#1HGCD    WL0006           Item Code
     C                     MOVEL#1AJCD    WL0007    P      Warehouse Code
     C                     Z-ADD#RQORD    WL0008           Quantity Ordere
     C                     Z-ADDWUD0WG    WL0009           Weight Ordered
     C                     Z-ADD#2ELDT    WL0010           Scheduled Ship
     C                     EXSR SIRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0008    #RQORD           Quantity Ordere
     C                     Z-ADDWL0009    WUD0WG           Weight Ordered
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Order Qty & Weight RT - Order Detail  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1AIC3    WL0005           Company Number
     C                     Z-ADD#1HGCD    WL0006           Item Code
     C                     MOVEL#1AJCD    WL0007    P      Warehouse Code
     C                     Z-ADD#RQORD    WL0008           Quantity Ordere
     C                     Z-ADDWUD0WG    WL0009           Weight Ordered
     C                     Z-ADD#2ELDT    WL0010           Scheduled Ship
     C                     EXSR SIRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0008    #RQORD           Quantity Ordere
     C                     Z-ADDWL0009    WUD0WG           Weight Ordered
     C                     END                             *FI
      * Weight Scheduled
      * RCD.Weight Sched Prod USR =
      *    *COMPUTE (x1 + x2 - x3 - x4)
      * x1    : DB1.PS Weight Standard
      * +     : PGM.*Synon (15,2) work field
      * x2    : DB1.PS Weight Prod Adj
      * -     : PGM.*Synon (15,2) work field
      * x3    : DB1.PS Weight Converted
      * -     : PGM.*Synon (17,7) work field
      * x4    : DB1.PS Weight Whse Tfr Adj
     C           I8DXWG    ADD  I8D1WG    W0WA02           *Synon (15,2) w
     C           W0WA02    SUB  I8WTCN    W0WA01           *Synon (15,2) w
     C           W0WA01    SUB  I8GAWG    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    #RF2WG           Weight Sched Pr
      * Pieces Scheduled
      * RCD.Pieces Scheduled =
      *    *COMPUTE (x1 + x2 - x3 - x4)
      * x1    : DB1.PS Pieces Standard
      * +     : PGM.*Synon (15,2) work field
      * x2    : DB1.PS Pieces Prod Adj
      * -     : PGM.*Synon (15,2) work field
      * x3    : DB1.PS Pieces Converted
      * -     : PGM.*Synon (17,7) work field
      * x4    : DB1.PS Pieces Whse Tfr Adj
     C           I8B2NB    ADD  I8CBNB    W0WA02           *Synon (15,2) w
     C           W0WA02    SUB  I8PSCV    W0WA01           *Synon (15,2) w
     C           W0WA01    SUB  I8BPNB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    #RPIAC           Pieces Schedule
      * Quantity Production
      * CASE:
      *  - c1 AND c2 AND c3
      *   |- c1    : PAR.Piece Count Item is yes
      *   |- c2    : PAR.Pieces Per Bag is GT Zero
      *   |- c3    : PAR.Bags Per Unit is GT Zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P6PCCT    IFEQ 'Y'                        *IF
     C           P6BDNB    IFGT *ZERO                      *IF
     C           P6BJNB    IFGT *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Quantity Production
      * RCD.Quantity Production USR =
      *    *COMPUTE (x1 / (x2 * x3))
      * x1    : RCD.Pieces Scheduled
      * /     : PGM.*Synon (15,0) work field *
      * x2    : PAR.Pieces Per Bag
      * *     : PGM.*Synon (15,0) work field *
      * x3    : PAR.Bags Per Unit
     C           P6BDNB    MULT P6BJNB    W0WJ01           *Synon (15,0) w
     C           #RPIAC    DIV  W0WJ01    W0WJ00           *Synon (15,0) w
     C                     Z-ADDW0WJ00    #RWPRD           Quantity Produc
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Unit Weight is Greater than zero
     C           P6AIWG    IFGT *ZERO                      *IF
      * Quantity Production
      * RCD.Quantity Production USR =
      *    *COMPUTE (x1 / x2)
      * x1    : RCD.Weight Sched Prod USR
      * /     : PGM.*Synon (15,0) work field *
      * x2    : PAR.Unit Weight
     C           #RF2WG    DIV  P6AIWG    W0WJ00           *Synon (15,0) w
     C                     Z-ADDW0WJ00    #RWPRD           Quantity Produc
     C                     END                             *FI
     C                     END                             *FI
      * Add Actual Inventory, Actual Production and Position PPS073
      * RTV On Hand Qty       RT - IC Item Balance  * 
     C                     EXSR SJRVGN
      * Rtv Actual Production RT - IC Transaction Detail  * 
     C                     EXSR SKRVGN
      * If sched prod GE Actual then subtract Actual from Sched, else zer
      * CASE: RCD.Quantity Production USR GE RCD.Actual Production 6.1 US
     C           #RWPRD    IFGE #RK6QT                     *IF
     C           #RWPRD    SUB  #RK6QT    P9WPRD           Quantity Produc
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     P9WPRD           Quantity Produc
     C                     END                             *FI
      * FP1054 Hide on Screen
      * If production and order quantity are zero then don't display item
      * CASE:
      *  - c1 AND c2
      *   |- c1    : RCD.Quantity Production USR is EQ Zero
      *   |- c2    : RCD.Quantity Ordered USR is EQ Zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #RWPRD    IFEQ *ZERO                      *IF
     C           #RQORD    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * Consumed (Get the first Consumed Item Number)
     C                     EXSR UASUBR                     Consumed (Get t
     C                     END                             *FI
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C           KRST      READE@I8CPBS                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate PS Print On Schedule
     C                     MOVEL*BLANK    W0RTN
      * Name search required?
     C           '#2TEST'  IFEQ YPMTFD
      * PS Print On Schedule
     C                     MOVEL#2TEST    W0INVL 25
      * Set current value in drop down list.
     C                     MOVEL*ZEROS    ZFTEST
     C                     SELEC
     C           W0INVL    WHEQ 'N'                        N
     C                     Z-ADD1         ZFTEST
     C           W0INVL    WHEQ 'Y'                        Y
     C                     Z-ADD2         ZFTEST
     C                     ENDSL
     C                     EXFMTZETEST
      * Set selected value from drop down list.
     C                     MOVEL*BLANKS   W0INVL
     C                     SELEC
     C           ZFTEST    WHEQ 1
     C                     MOVEL'N'       W0INVL           N
     C           ZFTEST    WHEQ 2
     C                     MOVEL'Y'       W0INVL           Y
     C                     ENDSL
     C                     SETOF                     90    *
     C                     MOVELW0INVL    #2TEST
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
      * Validate Item Code and convert to internal.
      * CD7 Ext/Int
     C                     MOVELV2HGCD    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2HGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,004                    *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2HGCD           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #2HGCD           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Consumed Item Code and convert to internal.
      * CD7 Ext/Int
     C                     MOVELVCNUDT    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELVCNUDT    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,004                    *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #CNUDT           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #CNUDT           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Company Number and convert to internal.
      * CD3 Ext/Int
     C                     MOVELV2AIC3    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC3  3
     C                     MOVEA*BLANKS   K3
     C                     Z-ADD3         C       30
     C                     Z-ADD3         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUDMCD    J3
     C                     MOVE *BLANKS   W0RTN
     C                     DO   3
     C           J3,C      IFNE ' '
     C                     MOVEAJ3,C      K3,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK3        JUSTC3
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC3    TESTC   1
     C           TESTC     IFGT '?'
     C           TESTC     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC3     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC3    WUDMCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,004                    *IF
      * Setup message data for message
      * Send message 'CD3 Non numeric data'
     C                     MOVEL'USR0752' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2AIC3           CD3 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUDMCD    #2AIC3           CD3 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    CABNE*BLANKS   DATAG1
      * Change of position specified
     C           WZTEST    CASNE#2TEST    FBRQRL
     C           WZHGCD    CASNE#2HGCD    FBRQRL
     C           WZAJCD    CASNE#2AJCD    FBRQRL
     C           WZAIC3    CASNE#2AIC3    FBRQRL
     C           WZXRCD    CASNE#2XRCD    FBRQRL
     C                     END
     C           DATAG1    TAG
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
      * Consumed Break reload subfile
     C                     EXSR UBSUBR                     Consumed Break
      * F4 = Capacity Code
      * CASE: CTL.*CMD key is *Prompt
     C           *IN04     IFEQ '1'                        *IF
      * CASE: PGM.*Cursor field <IS> CTL.CIE Capacity Code
     C           W0CFL     IFEQ '#CKUAA'                   *IF
      * Sel PS Prod Capacity   SL - PS Production Capacity  * 
     C                     CALL 'PBK0SRR'              90  Sel PS Prod Cap
     C                     PARM *BLANK    W0RTN   7
     C           #CKUAA    PARM #CKUAA    WQ0004  6        PS Prod Capacit
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBK0SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9938  *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * Make Sheet or Various  or daily production schedule
      * CASE: CTL.*CMD key is *Print List
     C           *IN21     IFEQ '1'                        *IF
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.Production Type is Plan/Schedule
      *   |- c2    : CTL.Production Date is entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #2V5ST    IFEQ 'P'                        *IF
     C           #2V5ST    OREQ 'S'
     C           #2ELDT    IFNE *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD#2ELDT    P7GXDT           Production Date
     C                     MOVEL#2B7ST    P3T3CD           Warehouse Code
     C                     MOVEL'N'       YL0005           PRT Night Queue
     C                     MOVEL'*YES'    P3XFST           Display Prt Opt
      * Prt Prd Schedule Rpts PV - PS Prod Item Schedule  * 
     C                     CALL 'PMAQPVR'              90  Prt Prd Schedul
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P7GXDT    WQ0005  70       Production Date
     C           P3T3CD    PARM P3T3CD    WQ0006  3        Warehouse Code
     C           P3XFST    PARM P3XFST    WQ0007  4        Display Prt Opt
     C                     PARM #2AIC3    WQ0008  30       Company Number
     C                     PARM #2V5ST    WQ0009  1        Production Type
     C                     PARM @CN,005   WQ0010 25        PRT Description
     C           P3WRST    PARM P3WRST    WQ0011 10        PRT Printer Dev
     C           P3WSST    PARM P3WSST    WQ0012  4        PRT Hold Output
     C           P3WTST    PARM P3WTST    WQ0013  4        PRT Save Output
     C           P3DYNB    PARM P3DYNB    WQ0014  20       PRT Number of C
     C           YL0005    PARM YL0005    WQ0015  1        PRT Night Queue
     C           P3BVVN    PARM P3BVVN    WQ0016 10        PRT Night Queue
     C                     PARM P2DNCD    WQ0017  6        Application Cod
     C                     PARM '1'       WQ0018  1        Paper Type USR
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMAQPVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9935  *
     C                     END
     C                     ELSE
      * CASE: *OTHERWISE
      * Error Messages
      * CASE: CTL.Production Type EQ WRK.BLANK
     C           #2V5ST    IFEQ WUGSTX                     *IF
      * Setup message data for message
     C                     MOVEL#2V5ST    ZA0001           Production Type
      * Send message 'PS Prd Type Required'
     C                     MOVEL'USR2023' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: CTL.Production Date is not entered
     C           #2ELDT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Send message 'Date must be entered'
     C                     MOVEL'USR0231' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Work With Production Adjustments only on specific users
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is CF22
      *   |- c2    : WRK.Allow Adjustments Usr is yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN22     IFEQ '1'                        *IF
     C           WUDPST    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * WW Prd Adjustments    DF - PS Production Adjustment  * 
     C                     CALL 'PDTIDFR'              90  WW Prd Adjustme
     C                     PARM *BLANK    W0RTN   7
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDTIDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * WW Production Order Hold
      * CASE: CTL.*CMD key is CF13
     C           *IN13     IFEQ '1'                        *IF
      * WW Prod Order Hold    DF - OP Order Header  * 
     C                     CALL 'PDVLDFR'              90  WW Prod Order H
     C                     PARM *BLANK    W0RTN   7
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDVLDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * WW PA
      * CASE: CTL.*CMD key is CF16
     C           *IN16     IFEQ '1'                        *IF
      * ** Pass company# & whse to Product Availability   09/01/06 LJB
      * WW Product Availablty DF - Company Item Avail Group  * 
     C                     CALL 'PDFPDFR'              90  WW Product Avai
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0019  30       Company Number
     C                     PARM #2AJCD    WQ0020  3        Warehouse Code
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDFPDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993534*
     C                     END
     C                     END                             *FI
      * Refresh
      * CASE: CTL.*CMD key is CF05
     C           *IN05     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Refresh
      * CASE: CTL.Item Category Code 6 NE WRK.Item Category Code USR
     C           #CS0CD    IFNE WUCKAA                     *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL#CS0CD    WUCKAA           Item Category C
     C                     ELSE
      * CASE: CTL.CIE Capacity Code NE LCL.CIE Capacity Code
     C           #CKUAA    IFNE YL0006                     *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL#CKUAA    YL0006           CIE Capacity Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,39
     C                     SETOF                     98    *
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * USER: Process subfile record (Pre-confirm)
      * RTV Company Name Only  RT - Company Name and Address  * 
     C                     EXSR SLRVGN
      * Display Detail   only for is programmers
      * CASE: RCD.*SFLSEL is *5
     C           #1SEL     IFEQ '5'                        *IF
      * CASE: JOB.*USER is All IS DEV/PRD & Prktest
     C           ##USR     IFEQ @CN,006                    *IF
     C           ##USR     OREQ @CN,007
     C           ##USR     OREQ @CN,008
     C           ##USR     OREQ @CN,009
     C           ##USR     OREQ @CN,010
     C           ##USR     OREQ @CN,011
     C           ##USR     OREQ @CN,012
     C           ##USR     OREQ @CN,013
     C           ##USR     OREQ @CN,014
     C           ##USR     OREQ @CN,015
     C           ##USR     OREQ @CN,016
      * Dsp Production Detail DR - PS Prod Item Schedule  * 
     C                     CLEARPARC
     C                     Z-ADD#1AIC3    PAAIC3           Company Number
     C                     MOVEL#1V5ST    PAV5ST    P      Production Type
     C                     Z-ADD#1ELDT    PAELDT           Production Date
     C                     Z-ADD#1HGCD    PAHGCD           Item Code
     C                     MOVEL#1AJCD    PAAJCD    P      Warehouse Code
      *
     C                     CALL 'PDDHD1R'              90  Dsp Production
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: PS Prod It
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDDHD1R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * Edit Comments   Option 7
      * CASE: RCD.*SFLSEL is *7
     C           #1SEL     IFEQ '7'                        *IF
      * Edt Prod Sched Comm   EF - PS Production Detail Com  * 
     C                     CLEARPBRC
     C                     Z-ADD#1AIC3    PBAIC3           Company Number
     C                     MOVEL#1V5ST    PBV5ST    P      Production Type
     C                     Z-ADD#1ELDT    PBELDT           Production Date
     C                     Z-ADD#1HGCD    PBHGCD           Item Code
     C                     MOVEL#1AJCD    PBAJCD    P      Warehouse Code
      *
     C                     CALL 'PDFPEFR'              90  Edt Prod Sched
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PBRC             KEY: PS Product
     C                     PARM WUADTX    WQ0021 30        Name
     C                     PARM #RGENA    WQ0022 30        Description Lin
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDFPEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
      * Display Orders  Option 8
      * CASE: RCD.*SFLSEL is *8
     C           #1SEL     IFEQ '8'                        *IF
      * Dsp Item Orders       DF - Order Detail  * 
     C                     CALL 'PDO7DFR'              90  Dsp Item Orders
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1AIC3    WQ0023  30       Company Number
     C                     PARM #1HGCD    WQ0024  70       Item Code
     C                     PARM #1ELDT    WQ0025  70       Scheduled Ship
     C                     PARM WUADTX    WQ0026 30        Name
     C                     PARM #1AJCD    WQ0027  3        Warehouse Code
     C           WUICL     PARM WUICL     WQ0028  1        *Initial call
     C                     PARM #1WPST    WQ0029  2        Warehouse Type
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDO7DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
      * Create Production Adjustment  Option 9  only on adjustment users
      * CASE:
      *  - c1 AND c2
      *   |- c1    : RCD.*SFLSEL is Option 9
      *   |- c2    : WRK.Allow Adjustments Usr is yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1SEL     IFEQ '9'                        *IF
     C           #1SEL     OREQ ' 9'
     C           WUDPST    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Edt Adjustment        ER - PS Production Adjustment  * 
     C                     CLEARPCRC
     C                     Z-ADD#1AIC3    PCAIC3           Company Number
     C                     Z-ADD#1ELDT    PCELDT           Production Date
     C                     Z-ADD#1HGCD    PCHGCD           Item Code
     C                     MOVEL#1AJCD    PCAJCD    P      Warehouse Code
     C                     MOVELWUPSAD    PCPSAD    P      PS Adjustment T
     C                     Z-ADDWUPSAN    PCPSAN           PS Adjustment N
      *
     C                     CALL 'PDTPE1R'              90  Edt Adjustment
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PCRC             KEY: PS Product
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDTPE1R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Remove this FP1054
      * Add Option 10 & 11 - FP1054
      * WW Inv Alloc  - option 10
      * CASE: RCD.*SFLSEL is Option 10
     C           #1SEL     IFEQ '10'                       *IF
      * WW Inv Allocation     DF - Order Detail Schedule  * 
     C                     CLEARPDRC
     C                     Z-ADD#1AIC3    PDAIC3           Company Number
     C                     Z-ADD#1HGCD    PDHGCD           Item Code
     C                     MOVEL#1AJCD    PDAJCD    P      Warehouse Code
      *
     C                     CALL 'POP5DFR'              90  WW Inv Allocati
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PDRC             KEY: Order Deta
     C                     PARM *ZERO     WQ0030  70       Order Number
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POP5DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * WW Order sched  option 11
      * CASE: RCD.*SFLSEL is Option 11
     C           #1SEL     IFEQ '11'                       *IF
      * CASE: RCD.Consumed Item Code is Not Entered
     C           #RNUDT    IFEQ *ZERO                      *IF
     C                     Z-ADD#1HGCD    YL0007           Consumed Item C
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#RNUDT    YL0007           Consumed Item C
     C                     END                             *FI
      * WW OrdPrdSch Edit     DF - Order Detail  * 
     C                     CLEARPERC
     C                     Z-ADDYL0007    PENUDT           Consumed Item C
     C                     MOVEL#2B7ST    PEF6SX    P      Production Ware
      *
     C                     CALL 'POQJDFR'              90  WW OrdPrdSch Ed
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PERC             KEY: Order Deta
     C                     PARM #1HGCD    WQ0031  70       Item Code
     C                     PARM WUCZT1    WQ0032132        Message USR
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POQJDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * *Set Cursor: CTL.Item Code  (*Override=*YES)
     C                     Z-ADD*ZERO     W0RR0
     C                     Z-ADD012       W0ROW0
     C                     Z-ADD005       W0COL0
     C                     MOVEL'1'       W0OVR0           *YES
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
      * SFLNXTCHG
     C                     SETON                     84
     C                     ELSE
      * SFLRCD valid
      * SFLNXTCHG
     C                     SETOF                     84
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN78
     C           #1B6ST    IFEQ 'E'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     MOVEL'0'       *IN79
     C           ##USR     IFEQ @CN,006                    *IF
     C           ##USR     OREQ @CN,007
     C           ##USR     OREQ @CN,008
     C           ##USR     OREQ @CN,009
     C           ##USR     OREQ @CN,010
     C           ##USR     OREQ @CN,011
     C           ##USR     OREQ @CN,012
     C           ##USR     OREQ @CN,013
     C           ##USR     OREQ @CN,014
     C           ##USR     OREQ @CN,015
     C           ##USR     OREQ @CN,016
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @I8CPBS fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     MOVELI8V5ST    #1V5ST           Production Type
     C                     Z-ADDI8ELDT    #1ELDT           Production Date
     C                     MOVELI8R3CD    #1R3CD           Department Code
     C                     Z-ADDI8RGNB    #1RGNB           Item Structure
     C                     Z-ADDI8RHNB    #1RHNB           Item Structure
     C                     Z-ADDI8RINB    #1RINB           Item Structure
     C                     Z-ADDI8DVWG    #1DVWG           PS Weight Order
     C                     Z-ADDI8D7NB    #1D7NB           PS Pieces Order
     C                     Z-ADDI8FCAD    #1FCAD           PS Weight FC Ad
     C                     Z-ADDI8D9NB    #1D9NB           PS Pieces FC Ad
     C                     Z-ADDI8DWWG    #1DWWG           PS Weight FX Ad
     C                     Z-ADDI8EANB    #1EANB           PS Pieces FX Ad
     C                     Z-ADDI8AVWT    #1AVWT           PS Weight Avail
     C                     Z-ADDI8ECNB    #1ECNB           PS Pieces Avail
     C                     Z-ADDI8WTON    #1WTON           PS Weight Produ
     C                     Z-ADDI8EDNB    #1EDNB           PS Pieces Produ
     C                     Z-ADDI8WTCN    #1WTCN           PS Weight Conve
     C                     Z-ADDI8PSCV    #1PSCV           PS Pieces Conve
     C                     Z-ADDI8FNWT    #1FNWT           PS Weight Fab N
     C                     Z-ADDI8EENB    #1EENB           PS Pieces Fab N
     C                     Z-ADDI8DXWG    #1DXWG           PS Weight Stand
     C                     Z-ADDI8B2NB    #1B2NB           PS Pieces Stand
     C                     Z-ADDI8WTIN    #1WTIN           PS Weight Inv O
     C                     Z-ADDI8D5NB    #1D5NB           PS Pieces Inv O
     C                     Z-ADDI8SHWT    #1SHWT           PS Weight Sched
     C                     Z-ADDI8EBNB    #1EBNB           PS Pieces Sched
     C                     Z-ADDI8QTSP    #1QTSP           PS Pieces Plann
     C                     Z-ADDI8WAIO    #1WAIO           PS Weight Sched
     C                     Z-ADDI8EGNB    #1EGNB           PS Pieces Sched
     C                     Z-ADDI8UNW2    #1UNW2           PS Weight Inv A
     C                     Z-ADDI8CENB    #1CENB           PS Pieces Inv A
     C                     Z-ADDI8F9WG    #1F9WG           PS Unit Weight
     C                     Z-ADDI8BPNB    #1BPNB           PS Pieces Whse
     C                     Z-ADDI8GAWG    #1GAWG           PS Weight Whse
     C                     Z-ADDI8BQNB    #1BQNB           PS Pieces Unuse
     C                     Z-ADDI8GBWG    #1GBWG           PS Weight Unuse
     C                     Z-ADDI8BRNB    #1BRNB           PS Pieces Unuse
     C                     Z-ADDI8GCWG    #1GCWG           PS Weight Unuse
     C                     Z-ADDI8BSNB    #1BSNB           PS Pieces Unuse
     C                     Z-ADDI8GDWG    #1GDWG           PS Weight Unuse
     C                     Z-ADDI8BWNB    #1BWNB           PS Pieces Unuse
     C                     Z-ADDI8GEWG    #1GEWG           PS Weight Unuse
     C                     Z-ADDI8PS6U    #1PS6U           PS Pieces Unuse
     C                     Z-ADDI8E0WG    #1E0WG           PS Weight Ship
     C                     Z-ADDI8D6NB    #1D6NB           PS Pieces Ship
     C                     Z-ADDI8WTSP    #1WTSP           PS Weight Plann
     C                     Z-ADDI8DJPC    #1DJPC           PS % of Carcass
     C                     Z-ADDI8F8WG    #1F8WG           PS Avg Piece Wg
     C                     Z-ADDI8GPDT    #1GPDT           PS Available Sh
     C                     Z-ADDI8QTAS    #1QTAS           PS Weight Sched
     C                     Z-ADDI8EFNB    #1EFNB           PS Pieces Sched
     C                     Z-ADDI8OAWT    #1OAWT           PS Weight Prod
     C                     Z-ADDI8CDNB    #1CDNB           PS Pieces Prod
     C                     Z-ADDI8SAWT    #1SAWT           PS Weight Shipp
     C                     Z-ADDI8B9NB    #1B9NB           PS Pieces Shipp
     C                     Z-ADDI8D1WG    #1D1WG           PS Weight Prod
     C                     Z-ADDI8CBNB    #1CBNB           PS Pieces Prod
     C                     Z-ADDI8EZWG    #1EZWG           PS Weight Inv A
     C                     Z-ADDI8CCNB    #1CCNB           PS Pieces Inv A
     C                     MOVELI8WCST    #1WCST           PS Item Id
     C                     MOVELI8WPST    #1WPST           Warehouse Type
     C                     MOVELI8B5ST    #1B5ST           PS Lock Status
     C                     MOVELI8TFST    #1TFST           PS Export/Domes
     C                     MOVELI8THST    #1THST           PS Piece Count
     C                     MOVELI8UDST    #1UDST           PS Unused Sts 1
     C                     MOVELI8UFST    #1UFST           PS Unused Sts 2
     C                     MOVELI8UGST    #1UGST           PS Unused Sts 3
     C                     MOVELI8UHST    #1UHST           PS Unused Sts 4
     C                     MOVELI8B6ST    #1B6ST           PS Item Sched N
     C                     MOVELI8B7ST    #1B7ST           PS Production W
     C                     MOVELI8UVST    #1UVST           EDI Status 1
     C                     MOVELI8UWST    #1UWST           EDI Status 2
     C                     MOVELI8UXST    #1UXST           EDI Status 3
     C                     MOVELI8VSST    #1VSST           Record Status
     C                     Z-ADDI8AATM    #1AATM           Job Time
     C                     MOVELI8AYNA    #1AYNA           User Id
     C                     MOVELI8A0NA    #1A0NA           Job Name
     C                     Z-ADDI8AXDT    #1AXDT           Job Date
     C                     Z-ADDI8HGCD    #1HGCD           Item Code
      * Clear external version also
     C                     MOVEL*BLANK    V1HGCD
     C                     MOVELI8AJCD    #1AJCD           Warehouse Code
     C                     Z-ADDI8AIC3    #1AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V1AIC3
     C                     MOVELI8XRCD    #1XRCD           Primal Group Co
     C                     MOVELI8TEST    #1TEST           PS Print On Sch
     C                     MOVEL*BLANK    #RF8NA           Warehouse Descr
     C                     MOVEL*BLANK    #RADCD           U/M - Primary
     C                     Z-ADD*ZERO     #RQAVP           Quantity Avail
     C                     Z-ADD*ZERO     #RK7QT           Quantity Positi
     C                     Z-ADD*ZERO     #RPIAC           Pieces Schedule
     C                     Z-ADD*ZERO     #RF2WG           Weight Sched Pr
     C                     Z-ADD*ZERO     #RH1QT           Scheduled Quant
     C                     Z-ADD*ZERO     #RPCAL           Pieces Allocate
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RGENA           Item Descriptio
     C                     Z-ADD*ZERO     #RNUDT           Consumed Item C
      * Clear external version also
     C                     MOVEL*BLANK    VRNUDT
     C                     MOVEL*BLANK    #RS0CD           Item Primal Sch
     C                     MOVEL*BLANK    #RKUAA           CIE Capacity Co
     C                     Z-ADD*ZERO     #RQINV           Quantity Invent
     C                     Z-ADD*ZERO     #RK6QT           Actual Producti
     C                     Z-ADD*ZERO     #RWPRD           Quantity Produc
     C                     Z-ADD*ZERO     #RQORD           Quantity Ordere
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #CGUTX           Condition Name
     C                     MOVEL*BLANK    #2R3CD           Department Code
     C                     MOVEL*BLANK    #CADCD           U/M - Primary
     C                     Z-ADD*ZERO     #CQAVP           Quantity Avail
     C                     Z-ADD*ZERO     #CK7QT           Quantity Positi
     C                     Z-ADD*ZERO     #CF2WG           Weight Sched Pr
     C                     Z-ADD*ZERO     #CPCAL           Pieces Allocate
     C                     Z-ADD*ZERO     #2DVWG           PS Weight Order
     C                     Z-ADD*ZERO     #2DWWG           PS Weight FX Ad
     C                     Z-ADD*ZERO     #2AVWT           PS Weight Avail
     C                     Z-ADD*ZERO     #2WTON           PS Weight Produ
     C                     Z-ADD*ZERO     #2DXWG           PS Weight Stand
     C                     Z-ADD*ZERO     #2QTSP           PS Pieces Plann
     C                     Z-ADD*ZERO     #2QTAS           PS Weight Sched
     C                     MOVELP1B7ST    #2B7ST           PS Production W
     C                     Z-ADDP1ELDT    #2ELDT           Production Date
      * Clear external version also
     C                     Z-ADD*ZERO     V2ELDT
     C                     MOVELP1V5ST    #2V5ST           Production Type
     C                     MOVEL*BLANK    #CWQST           Base Frozen
     C                     MOVEL*BLANK    #2TEST           PS Print On Sch
     C                     Z-ADD*ZERO     #2HGCD           Item Code
      * Clear external version also
     C                     MOVEL*BLANK    V2HGCD
     C                     MOVEL*BLANK    #CGENA           Item Descriptio
     C                     Z-ADD*ZERO     #CNUDT           Consumed Item C
      * Clear external version also
     C                     MOVEL*BLANK    VCNUDT
     C                     MOVEL*BLANK    #2AJCD           Warehouse Code
     C                     Z-ADD*ZERO     #2AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V2AIC3
     C                     MOVEL*BLANK    #2XRCD           Primal Group Co
     C                     MOVEL*BLANK    #CS0CD           Item Primal Sch
     C                     MOVEL*BLANK    #CKUAA           CIE Capacity Co
     C                     MOVEL*BLANK    #CPFTX           Text 1 Length U
     C                     Z-ADD*ZERO     #CQINV           Quantity Invent
     C                     Z-ADD*ZERO     #CK6QT           Actual Producti
     C                     Z-ADD*ZERO     #CH1QT           Scheduled Quant
     C                     Z-ADD*ZERO     #CIRQT           Quantity Ordere
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1HGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1HGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V1HGCD           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1HGCD           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Consumed Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #RNUDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#RNUDT    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VRNUDT           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VRNUDT           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #1AIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V1AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1AIC3           CD3 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Production Date to display format
      * Convert date
     C           1000000   ADD  #2ELDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2ELDT
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #2HGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#2HGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V2HGCD           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2HGCD           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Consumed Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CNUDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CNUDT    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VCNUDT           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VCNUDT           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #2AIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V2AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2AIC3           CD3 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Alpha Value        RT - Company Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           KMAIC3           Company Number
     C                     KFLD           KMV8CD           Company Value C
      * Setup key
     C                     Z-ADD#1AIC3    KMAIC3           Company Number
     C                     MOVEL@CN,001   KMV8CD           Company Value C
      * Establish starting position
     C           KRSSA     CHAIN@KMREHC              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2221' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL@CN,002   W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELKMBXTX    P2BXTX           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Day and Week No.   RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN AFAIC3    WQSB01           Company Number
     C           *LIKE     DEFN AFBCDT    WQSB02           Post to G/L Dat
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Post to G/L Dat
      * Setup key
     C                     Z-ADD#1AIC3    WQSB01           Company Number
     C                     Z-ADD#2ELDT    WQSB02           Post to G/L Dat
      * Establish starting position
     C           KRSSB     SETLL@AFREYY                    *
     C           KRSSB     READE@AFREYY                  90*
      * Data record not found
     C   90                MOVEL'USR0018' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDAFETNB    WUETNB           Accounting Peri
     C                     MOVELAFA9ST    P8A9ST           Day of Week
     C                     Z-ADDAFEINB    WUEINB           Week Number
     C           KRSSB     READE@AFREYY                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Kill/Prod Day Sts RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WABCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADD#1AIC3    WAAIC3           Company Number
     C                     Z-ADDWUJMDT    WABCDT           Post to G/L Dat
      * Establish starting position
     C           KRSSC     CHAIN@AFREBE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0018' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    P8V9ST           Kill Day Status
     C                     MOVEL*BLANK    P8WAST           Production Day
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAV9ST    P8V9ST           Kill Day Status
     C                     MOVELWAWAST    P8WAST           Production Day
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Prd Sch InfoPSPRIMRT - Company Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           BZAIC3           Company Number
     C                     KFLD           BZHGCD           Item Code
      * Setup key
     C                     Z-ADD#1AIC3    BZAIC3           Company Number
     C                     Z-ADD#1HGCD    BZHGCD           Item Code
      * Establish starting position
     C           KRSSD     CHAIN@BZREJU              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0326' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RGENA           Description Lin
     C                     MOVEL*BLANK    #RADCD           U/M - Primary
     C                     Z-ADD*ZERO     P6AIWG           Unit Weight
     C                     Z-ADD*ZERO     WURINB           Item Structure
     C                     Z-ADD*ZERO     WURHNB           Item Structure
     C                     Z-ADD*ZERO     WURGNB           Item Structure
     C                     MOVEL*BLANK    WUN0CD           Item Type Code
     C                     MOVEL*BLANK    WUQ1CD           Default Warehou
     C                     Z-ADD*ZERO     P6CHTM           Fresh Chilling
     C                     MOVEL*BLANK    WUQZCD           Base/Conv/Loss
     C                     MOVEL*BLANK    WUXWST           Variety/Rendere
     C                     MOVEL*BLANK    WUVMST           Credit Item Sta
     C                     Z-ADD*ZERO     WUSWGH           Std Weight/Head
     C                     Z-ADD*ZERO     WUPPHE           Pieces Per Head
     C                     MOVEL*BLANK    #1R3CD           Department Code
     C                     MOVEL*BLANK    WUSDCD           Group for Packa
     C                     MOVEL*BLANK    #RS0CD           Item Primal Sch
     C                     MOVEL*BLANK    WUX5ST           Seconds Item
     C                     MOVEL*BLANK    P6PCCT           Piece Count Ite
     C                     Z-ADD*ZERO     P6BDNB           Pieces Per Bag
     C                     Z-ADD*ZERO     P6BJNB           Bags Per Unit
     C                     MOVEL*BLANK    #1TFST           Export/Domestic
     C                     MOVEL*BLANK    #1TEST           Print On Schedu
     C                     MOVEL*BLANK    WUSYST           Fresh Inv Alloc
     C                     MOVEL*BLANK    WUSZST           Fresh Sched As
     C                     MOVEL*BLANK    WUS1ST           Frozen Inv Allo
     C                     MOVEL*BLANK    #1XRCD           Primal Group Co
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBZAVNA    #RGENA           Description Lin
     C                     MOVELBZADCD    #RADCD           U/M - Primary
     C                     Z-ADDBZAIWG    P6AIWG           Unit Weight
     C                     Z-ADDBZRINB    WURINB           Item Structure
     C                     Z-ADDBZRHNB    WURHNB           Item Structure
     C                     Z-ADDBZRGNB    WURGNB           Item Structure
     C                     MOVELBZN0CD    WUN0CD           Item Type Code
     C                     MOVELBZQ1CD    WUQ1CD           Default Warehou
     C                     Z-ADDBZCHTM    P6CHTM           Fresh Chilling
     C                     MOVELBZQZCD    WUQZCD           Base/Conv/Loss
     C                     MOVELBZXWST    WUXWST           Variety/Rendere
     C                     MOVELBZVMST    WUVMST           Credit Item Sta
     C                     Z-ADDBZSWGH    WUSWGH           Std Weight/Head
     C                     Z-ADDBZPPHE    WUPPHE           Pieces Per Head
     C                     MOVELBZR3CD    #1R3CD           Department Code
     C                     MOVELBZSDCD    WUSDCD           Group for Packa
     C                     MOVELBZS0CD    #RS0CD           Item Primal Sch
     C                     MOVELBZX5ST    WUX5ST           Seconds Item
     C                     MOVELBZPCCT    P6PCCT           Piece Count Ite
     C                     Z-ADDBZBDNB    P6BDNB           Pieces Per Bag
     C                     Z-ADDBZBJNB    P6BJNB           Bags Per Unit
     C                     MOVELBZSUST    #1TFST           Export/Domestic
     C                     MOVELBZSVST    #1TEST           Print On Schedu
     C                     MOVELBZSYST    WUSYST           Fresh Inv Alloc
     C                     MOVELBZSZST    WUSZST           Fresh Sched As
     C                     MOVELBZS1ST    WUS1ST           Frozen Inv Allo
     C                     MOVELBZXRCD    #1XRCD           Primal Group Co
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv CIE Capacity Qty  RT - Company Item Ext  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * E2885 RMC 12/9/13 new capacity field in CIE, get qty from PS Prod
      * Declare restrictor key work fields
     C           *LIKE     DEFN FDAIC3    WQSE01           Company Number
     C           *LIKE     DEFN FDHGCD    WQSE02           Item Code
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           Company Number
     C                     KFLD           WQSE02           Item Code
      * Setup key
     C                     Z-ADD#1AIC3    WQSE01           Company Number
     C                     Z-ADD#1HGCD    WQSE02           Item Code
      * Establish starting position
     C           KRSSE     SETLL@FDREAW                    *
     C           KRSSE     READE@FDREAW                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4125' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RKUAA           CIE Capacity Co
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.CIE Capacity Code is Entered
     C           FDKUAA    IFNE *BLANK                     *IF
      * RTV PS Prod Cap Max   RT - PS Production Capacity  * 
     C                     EXSR SFRVGN
     C                     MOVELFDKUAA    #RKUAA           CIE Capacity Co
     C                     END                             *FI
     C           KRSSE     READE@FDREAW                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV PS Prod Cap Max   RT - PS Production Capacity  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           BFSFAA           PS Prod Capacit
      * Setup key
     C                     MOVELFDKUAA    BFSFAA           PS Prod Capacit
      * Establish starting position
     C           KRSSF     CHAIN@BFRERV              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4671' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Order Qty & Wght 2 RT - Order Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     #RQORD           Quantity Ordere
     C                     Z-ADD*ZERO     WUD0WG           Weight Ordered
      * Declare restrictor key work fields
     C           *LIKE     DEFN OMAIC3    WQSG01           Company Number
     C           *LIKE     DEFN OMHGCD    WQSG02           Item Code
     C           *LIKE     DEFN OMAJCD    WQSG03           Warehouse Code
      * Define keylist
     C           KPSSG     KLIST
     C                     KFLD           WQSG01           Company Number
     C                     KFLD           WQSG02           Item Code
     C                     KFLD           WQSG03           Warehouse Code
     C                     KFLD           OMAODT           Scheduled Ship
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           Company Number
     C                     KFLD           WQSG02           Item Code
     C                     KFLD           WQSG03           Warehouse Code
      * Setup key
     C                     Z-ADD#1AIC3    WQSG01           Company Number
     C                     Z-ADD#1HGCD    WQSG02           Item Code
     C                     MOVEL#1AJCD    WQSG03           Warehouse Code
     C                     Z-ADD#2ELDT    OMAODT           Scheduled Ship
      * Establish starting position
     C           KPSSG     SETLL@BGWKLI                    *
     C           KRSSG     READE@BGWKLI                  90*
      * Data record not found
     C   90                MOVEL'USR1309' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * RTV Hdr Sts,BillActTy RT - Order Header TRG  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDOMAIC3    WL0001           Company Number
     C                     Z-ADDOMC4NB    WL0002           Order Number
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    YL0001    P      Header Status
     C                     MOVELWL0004    YL0002    P      Billing Activit
      * CASE: DB1.Scheduled Ship Date GT PAR.Date Sat USR
     C           OMAODT    IFGT WUJMDT                     *IF
     C                     GOTO SGEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: LCL.Billing Activity Type is Invoice or Transfer
     C           YL0002    IFEQ '1'                        *IF
     C           YL0002    OREQ '4'
     C                     ADD  OMAVQT    #RQORD           Quantity Ordere
     C                     ADD  OMD0WG    WUD0WG           Weight Ordered
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSG     READE@BGWKLI                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV Hdr Sts,BillActTy RT - Order Header TRG  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEC4NB           Order Number
      * Setup key
     C                     Z-ADDWL0001    BEAIC3           Company Number
     C                     Z-ADDWL0002    BEC4NB           Order Number
      * Establish starting position
     C           KRSSH     CHAIN@BECPFK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL@CN,002   W0RTN            *Return code
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBEGWST    WL0003           Header Status
     C                     MOVELBEOBST    WL0004           Billing Activit
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * RTV Order Qty & Weight RT - Order Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     WL0008           Quantity Ordere
     C                     Z-ADD*ZERO     WL0009           Weight Ordered
      * Declare restrictor key work fields
     C           *LIKE     DEFN OMAIC3    WQSI01           Company Number
     C           *LIKE     DEFN OMHGCD    WQSI02           Item Code
     C           *LIKE     DEFN OMAJCD    WQSI03           Warehouse Code
     C           *LIKE     DEFN OMAODT    WQSI04           Scheduled Ship
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           Company Number
     C                     KFLD           WQSI02           Item Code
     C                     KFLD           WQSI03           Warehouse Code
     C                     KFLD           WQSI04           Scheduled Ship
      * Setup key
     C                     Z-ADDWL0005    WQSI01           Company Number
     C                     Z-ADDWL0006    WQSI02           Item Code
     C                     MOVELWL0007    WQSI03           Warehouse Code
     C                     Z-ADDWL0010    WQSI04           Scheduled Ship
      * Establish starting position
     C           KRSSI     SETLL@BGWKLI                    *
     C           KRSSI     READE@BGWKLI                  90*
      * Data record not found
     C   90                MOVEL'USR1309' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * RTV Hdr Sts,BillActTy RT - Order Header TRG  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDOMAIC3    WL0001           Company Number
     C                     Z-ADDOMC4NB    WL0002           Order Number
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    YL0003    P      Header Status
     C                     MOVELWL0004    YL0004    P      Billing Activit
      * CASE: LCL.Billing Activity Type is Invoice or Transfer
     C           YL0004    IFEQ '1'                        *IF
     C           YL0004    OREQ '4'
     C                     ADD  OMAVQT    WL0008           Quantity Ordere
     C                     ADD  OMD0WG    WL0009           Weight Ordered
     C                     END                             *FI
     C           KRSSI     READE@BGWKLI                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * RTV On Hand Qty       RT - IC Item Balance  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     #RQINV           On Hand U/M1 Su
      * Declare restrictor key work fields
     C           *LIKE     DEFN B0AIC3    WQSJ01           Company Number
     C           *LIKE     DEFN B0AJCD    WQSJ02           Warehouse Code
     C           *LIKE     DEFN B0HGCD    WQSJ03           Item Code
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           Company Number
     C                     KFLD           WQSJ02           Warehouse Code
     C                     KFLD           WQSJ03           Item Code
      * Setup key
     C                     Z-ADD#1AIC3    WQSJ01           Company Number
     C                     MOVEL#1AJCD    WQSJ02           Warehouse Code
     C                     Z-ADD#1HGCD    WQSJ03           Item Code
      * Establish starting position
     C           KRSSJ     SETLL@B0REHD                    *
     C           KRSSJ     READE@B0REHD                  90*
      * Data record not found
     C   90                MOVEL'USR0328' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  B0DDQT    #RQINV           On Hand U/M1 Su
     C           KRSSJ     READE@B0REHD                  90*
     C                     ENDDO
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Rtv Actual Production RT - IC Transaction Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUFDWG           Production Weig
     C                     Z-ADD*ZERO     #RK6QT           Production Quan
      * Declare restrictor key work fields
     C           *LIKE     DEFN B7AIC3    WQSK01           Company Number
     C           *LIKE     DEFN B7HGCD    WQSK02           Item Code
     C           *LIKE     DEFN B7AJCD    WQSK03           Warehouse Code
     C           *LIKE     DEFN B7ELDT    WQSK04           Production Date
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Company Number
     C                     KFLD           WQSK02           Item Code
     C                     KFLD           WQSK03           Warehouse Code
     C                     KFLD           WQSK04           Production Date
      * Setup key
     C                     Z-ADD#1AIC3    WQSK01           Company Number
     C                     Z-ADD#1HGCD    WQSK02           Item Code
     C                     MOVEL#1AJCD    WQSK03           Warehouse Code
     C                     Z-ADD#1ELDT    WQSK04           Production Date
      * Establish starting position
     C           KRSSK     SETLL@B7CPGM                    *
     C           KRSSK     READE@B7CPGM                  90*
      * Data record not found
     C   90                MOVEL'USR0344' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  B7AHWG    WUFDWG           Production Weig
     C                     ADD  B7A5QT    #RK6QT           Production Quan
     C           KRSSK     READE@B7CPGM                  90*
     C                     ENDDO
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * RTV Company Name Only  RT - Company Name and Address  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           ABAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    ABAIC3           Company Number
      * Establish starting position
     C           KRSSL     CHAIN@ABREAK              90    *
      * Data record not found
     C   90                MOVEL'USR0003' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELABADTX    WUADTX           Name
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0001    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSM     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL@CN,002   W0RTN            *Return code
     C                     GOTO SMEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    P2I6ST           Allow Multi-Com
     C                     MOVELDRMPNA    P2MPNA           Default Printer
     C                     MOVELDRBCCD    P2BCCD           Salesperson Cod
     C                     Z-ADDDRAIC3    YL0008           Company Number
     C                     MOVELDRBUVN    WN0002           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0011    DTAJVN           User Profile Na
     C                     MOVELWL0012    DTDNCD           Application Cod
      * Establish starting position
     C           KRSSN     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0013           Company Number
     C                     MOVELDTAJCD    WL0014           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSO01           Application Cod
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WQSO01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSO01           Application Cod
     C                     MOVEL'P/S'     WQSO01           Application Cod
      * Establish starting position
     C           KRSSO     SETLL@DNRESF                    *
     C           KRSSO     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SPRVGN
     C                     END                             *FI
     C           KRSSO     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSP01           Application Cod
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSP01           Application Cod
      * Establish starting position
     C           KRSSP     SETLL@DNRESF                    *
     C           KRSSP     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL@CN,002   W0RTN            *Return code
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSP     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Rtv Profile Model     RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVEL##USR     DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSQ     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0010           User Code Model
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRBUVN    YL0010           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Consumed (Get the first Consumed Item Number)
      *================================================================
      * Rtv First Consumed Itm XF - Item Bill Of Material  * 
     C                     CALL 'POP1XFR'              90  Rtv First Consu
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1AIC3    WQ0001  30       Company Number
     C                     PARM #1HGCD    WQ0002  70       Item Code
     C           #RNUDT    PARM *ZERO     WQ0003  70       Component Item
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POP1XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: RCD.Consumed Item Code EQ RCD.Item Code
     C           #RNUDT    IFEQ #1HGCD                     *IF
     C                     Z-ADD*ZERO     #RNUDT           Consumed Item C
     C                     END                             *FI
      * CASE: CTL.Consumed Item Code is Entered
     C           #CNUDT    IFNE *ZERO                      *IF
      * CASE: CTL.Consumed Item Code EQ RCD.Consumed Item Code
     C           #CNUDT    IFEQ #RNUDT                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Consumed Break reload subfile
      *================================================================
      * CASE: CTL.Consumed Item Code NE WRK.Consumed Item Code
     C           #CNUDT    IFNE WUNUDT                     *IF
     C                     Z-ADD#CNUDT    WUNUDT           Consumed Item C
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * ***** Change Flag and Comments
      *================================================================
      * ** 12/12/2013 RMC E2885
      * ** Added cie capacity code selection
      * ** 03/15/2013 RMC E2513
      * ** Schedule missed-- added print on sched, var<>0
      * ** 04/14/2009 slm FP1054
      * ** PRODUCTION WAREHOUSE, for the print report
      * ** 02/10/2009 slm FP1054
      * ** PRODUCTION WAREHOUSE, and 132 screen
      * ** 2/15/2009 Additional changes for new options
      * ** check for who the user is, and allow adjustments
      * ** 11/21/2008 slm e00243
      * ** Add new prompt screen and for selection of belly & trim report
      * ** screen - pass to print program  (f21)
      * ** 04/14/2008 LJB FP1235
      * ** Add option to email the production schedule to the prompt
      * ** screen - pass to print program  (f21)
      * RMC PFS019 8/31/06 print new prod schedule pla9pfr
      * RMC PFS019 9/14/06 put pgm name in prt sched prompt
      * LJB 09/01/2006 L60831A Pass company# & whse to Product Availabili
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         XCVFA     BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C           XDAY1     IFGT 109267
     C                     ADD  2         XDAY1
     C                     ELSE
     C           XDAY1     IFGT 36218
     C                     ADD  1         XDAY1
     C                     END
     C                     END
      * Full years (up to the date)
     C           XDAY1     DIV  365.25    XDWK1   80
     C                     MVR            XDWK3   71
     C                     Z-ADDXDWK1     XDINYY
     C           XDWK3     IFEQ 0
      * The date is the end of a year
     C                     Z-ADD12        XDINMM
     C                     Z-ADD31        XDINDD
     C                     ELSE
      * Year days up to the date
     C           XDWK1     MULT 365.25    XDWK2   60
     C                     SUB  XDWK2     XDAY1
     C                     ADD  1         XDINYY
      * Leap year ?
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
      * March 1 (relative day of the year)
     C           XDWK1     IFEQ 0
     C                     Z-ADD60        XDWK1
     C                     ELSE
     C                     Z-ADD59        XDWK1
     C                     END
      * Define date base month and offset day -
     C           XDAY1     IFLE XDWK1
      *  - January (thru February)
     C                     Z-ADD1         XDINMM
     C                     ELSE
     C                     SUB  XDWK1     XDAY1
     C           XDAY1     IFLE 153
      *  - March (thru July)
     C                     Z-ADD3         XDINMM
     C                     ELSE
      *  - August (thru December)
     C                     Z-ADD8         XDINMM
     C                     SUB  153       XDAY1
     C                     END
      * Calculate 2 month base and offset day
     C           XDAY1     SUB  1         XDWK1
     C                     DIV  61        XDWK1
     C                     MVR            XDAY1
     C                     ADD  1         XDAY1
     C                     MULT 2         XDWK1
     C                     ADD  XDWK1     XDINMM
     C                     END
      * Calculate date increment,
     C           XDAY1     IFGT 31
     C                     ADD  1         XDINMM
     C                     SUB  31        XDAY1
     C                     END
     C                     Z-ADDXDAY1     XDINDD
     C                     END
      *================================================================
     CSR         XCVFAE    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDADY     BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C           XDURR     IFEQ 0
     C           XDWSL     OREQ 0
      * None days of week selected
     C                     Z-ADDXDAY2     XDAY1
     C           XDURR     IFNE *ZERO
      * Return Code: Unable to increment date.
     C                     MOVEL'Y2U0059' W0RTN   7
     C                     ENDIF
     C                     GOTO XDADYE
     C                     ENDIF
     C           XDWSL     IFEQ 7
      * All days of week selected
     C           XDAY2     ADD  XDURR     XDAY1
     C                     GOTO XDADYM
     C                     ENDIF
      * Some days of week selected
     C           XDURR     IFGE 0
     C                     Z-ADD1         XDSTP   10
     C                     ELSE
     C                     Z-ADD-1        XDSTP
     C                     ENDIF
      * Get number of full weeks in the duration
     C           XDURR     DIV  XDWSL     XDWNB   60
      * Isolate the last week
     C                     MVR            XDLSW   10
     C           XDLSW     IFEQ 0
     C           XDWSL     MULT XDSTP     XDLSW
     C                     SUB  XDSTP     XDWNB
     C                     ENDIF
      * Increment the date by the full weeks
     C           XDWNB     MULT 7         XDWK1   80
     C           XDAY2     ADD  XDWK1     XDAY1   60
      * Determine day of week of the beginning date
     C           XDAY2     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ENDIF
      * Loop: Increment the date by the last week
     C           XDLSW     DOWNE0
      * Increment the date
     C                     ADD  XDSTP     XDAY1
      * Increment the day of week
     C                     ADD  XDSTP     YY
      * Put day of week into the range 1-7
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ELSE
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     ELSE
     C           YY        IFEQ -1
     C                     Z-ADD6         YY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           YDOW,YY   IFEQ XDSEL
      * Selected day of the last week has been processed
     C                     SUB  XDSTP     XDLSW
     C                     ENDIF
      * End of loop
     C                     ENDDO
     C           XDADYM    TAG
     C           XDINDD    IFLT 1
     C                     Z-ADD1         XDINDD
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         XDADYE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
     C           *IN25     IFEQ '0'
      * Bypass when help done
     C                     SETOF                     94    *
     C           W0OVR0    IFEQ '1'
     C           W0OVR0    OREQ '0'
     C           *IN99     ANDEQ'0'
      * If override or no error
     C                     SETON                     94    *
     C           W0RR0     IFNE *ZERO
     C           W0RR0     IFGT ##RRMX
     C                     Z-ADD##RRMX    ##SFRC
     C                     ELSE
     C                     Z-ADDW0RR0     ##SFRC
     C                     END
     C                     END
     C                     Z-ADDW0ROW0    ZZCSRW
     C                     Z-ADDW0COL0    ZZCSCL
     C                     END
     C                     END
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C           ZINPOS    IFGE 03328
     C           ZINPOS    ANDLE06144
      * Cursor in the subfile record area
      * Reset cursor position to the basic (first) record for lookup
     C           W0CRW     SUB  13        W0CSRR  50
     C           03328     ADD  W0CCL     ZINPOS
      * Calculate rrn of the cursor position
     C                     ADD  ##SFRC    W0CSRR
     C                     ENDIF
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     ENDIF
     C           W0CFL     IFEQ *BLANK
     C                     Z-ADD0         W0CSRR
     C                     ENDIF
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
     C                     SETOF                     94    *
     C                     Z-ADD0         W0RR0   40
     C                     Z-ADD0         W0ROW0  30
     C                     Z-ADD0         W0COL0  30
     C                     MOVE '2'       W0OVR0  1
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD13        ZHSTRW  40
     C                     Z-ADD23        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           ZHCSRW    IFEQ 004
     C           ZHCSCL    ANDEQ127
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#2TEST'  YPMTFD           PS Print On Sch
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM 'PDCWDFRH'W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P2AJCD           Warehouse Code
     C                     MOVEL*BLANK    P2DNCD           Application Cod
     C                     MOVEL*BLANK    P2DQCD           Enterprise Code
     C                     MOVEL*BLANK    P2DRCD           Enterprise Code
     C                     MOVEL*BLANK    P2BCCD           Salesperson Cod
     C                     MOVEL*BLANK    P2B8NA           System Date For
     C                     MOVEL*BLANK    P2AJVN           User Profile Na
     C                     MOVEL*BLANK    P2I6ST           Allow Multi-Com
     C                     MOVEL*BLANK    P2MPNA           Default Printer
     C                     MOVEL*BLANK    P2TAST           First Time Flag
     C                     MOVEL*BLANK    P2BXTX           System Value Al
     C                     MOVEL*BLANK    P2WVST           Access Denied (
     C                     MOVEL*BLANK    P3WRST           PRT Printer Dev
     C                     MOVEL*BLANK    P3WSST           PRT Hold Output
     C                     MOVEL*BLANK    P3WTST           PRT Save Output
     C                     Z-ADD*ZERO     P3DYNB           PRT Number of C
     C                     MOVEL*BLANK    P3BVVN           PRT Night Queue
     C                     MOVEL*BLANK    P3BMVN           Program name US
     C                     MOVEL*BLANK    P3BWVN           Program Name$ U
     C                     MOVEL*BLANK    P3XFST           Display Prt Opt
     C                     MOVEL*BLANK    P3T3CD           Warehouse Code
     C                     MOVEL*BLANK    P4B8ST           Status - Y or N
     C                     MOVEL*BLANK    P5RYST           Report Type Sch
     C                     MOVEL*BLANK    P6ADCD           U/M - Primary
     C                     Z-ADD*ZERO     P6AIWG           Unit Weight
     C                     Z-ADD*ZERO     P6CHTM           Fresh Chilling
     C                     MOVEL*BLANK    P6PCCT           Piece Count Ite
     C                     Z-ADD*ZERO     P6BDNB           Pieces Per Bag
     C                     Z-ADD*ZERO     P6BJNB           Bags Per Unit
     C                     MOVEL*BLANK    P6XRCD           Primal Group Co
     C                     Z-ADD*ZERO     P7H6DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7H7DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7H8DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7H9DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IADT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IBDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7INDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IODT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IPDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IQDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IRDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7ISDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7ITDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IUDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IVDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IWDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IXDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IYDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7IZDT           Avail Ship Date
     C                     Z-ADD*ZERO     P7I0DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7I1DT           Avail Ship Date
     C                     Z-ADD*ZERO     P7GXDT           Production Date
     C                     MOVEL*BLANK    P7TOTX           Prod Date Alpha
     C                     MOVEL*BLANK    P7Q1ST           Status Flag 1
     C                     MOVEL*BLANK    P8A9ST           Day of Week
     C                     MOVEL*BLANK    P8V9ST           Kill Day Status
     C                     MOVEL*BLANK    P8WAST           Production Day
     C                     Z-ADD*ZERO     P9WPRD           Quantity Produc
     C                     Z-ADD*ZERO     P9JHDT           Date Mon USR
     C                     Z-ADD*ZERO     P9EINB           Week Number
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field First Time Flag
     C                     MOVEL*BLANK    WUTAST  1
      * Define work field Consumed Item Code
     C                     Z-ADD*ZERO     WUNUDT  70
      * Define work field Item Category Code USR
     C                     MOVEL*BLANK    WUCKAA  3
      * Define work field Accounting Period Code
     C                     Z-ADD*ZERO     WUETNB  20
      * Define work field Week Number
     C                     Z-ADD*ZERO     WUEINB  20
      * Define work field Date Sat USR
     C                     Z-ADD*ZERO     WUJMDT  70
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WABCDT           Post to G/L Dat
     C                     Z-ADD*ZERO     WACQNB           Julian Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEINB           Week Number
     C                     Z-ADD*ZERO     WAAQNB           Billing Cycle
     C                     Z-ADD*ZERO     WAOJDT           HPS PIC Date
     C                     Z-ADD*ZERO     WANQNX           HPS Calendar Ye
     C                     Z-ADD*ZERO     WANRNX           HPS Calendar We
     C                     Z-ADD*ZERO     WAOKDT           Calendar Unused
     C                     Z-ADD*ZERO     WAOLDT           Calendar Unused
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field Item Structure Class Code
     C                     Z-ADD*ZERO     WURINB  30
      * Define work field Item Structure Group Code
     C                     Z-ADD*ZERO     WURHNB  30
      * Define work field Item Structure Type Code
     C                     Z-ADD*ZERO     WURGNB  30
      * Define work field Item Type Code
     C                     MOVEL*BLANK    WUN0CD  3
      * Define work field Default Warehouse
     C                     MOVEL*BLANK    WUQ1CD  3
      * Define work field Base/Conv/Loss Item
     C                     MOVEL*BLANK    WUQZCD  2
      * Define work field Variety/Rendered/Cut
     C                     MOVEL*BLANK    WUXWST  1
      * Define work field Credit Item Status
     C                     MOVEL*BLANK    WUVMST  1
      * Define work field Std Weight/Head (Var/Ren)
     C                     Z-ADD*ZERO     WUSWGH 112
      * Define work field Pieces Per Head
     C                     Z-ADD*ZERO     WUPPHE  70
      * Define work field Group for Packaging
     C                     MOVEL*BLANK    WUSDCD  1
      * Define work field Seconds Item
     C                     MOVEL*BLANK    WUX5ST  1
      * Define work field Fresh Inv Allocation Seq
     C                     MOVEL*BLANK    WUSYST  1
      * Define work field Fresh Sched As Ordered
     C                     MOVEL*BLANK    WUSZST  1
      * Define work field Frozen Inv Allocation Seq
     C                     MOVEL*BLANK    WUS1ST  1
      * Define work field Blank for 3          USR
     C                     MOVEL*BLANK    WUUAT1  3
      * Define work field Weight Ordered
     C                     Z-ADD*ZERO     WUD0WG 112
      * Define work field Production Weight USR
     C                     Z-ADD*ZERO     WUFDWG  92
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Define work field BLANK
     C                     MOVEL*BLANK    WUGSTX256
      * Define work field Allow Adjustments Usr
     C                     MOVEL*BLANK    WUDPST  1
      * Define work field Name
     C                     MOVEL*BLANK    WUADTX 30
      * Define work field *Initial call
     C                     MOVEL*BLANK    WUICL   1
      * Define work field PS Adjustment Type
     C                     MOVEL*BLANK    WUPSAD  2
      * Define work field PS Adjustment Number
     C                     Z-ADD*ZERO     WUPSAN  50
      * Define work field Message USR
     C                     MOVEL*BLANK    WUCZT1132
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Initialize *SET CURSOR data
     C                     MOVE 'Y'       YSETCS  1
     C                     EXSR Y9CLR
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WA02 152       *Synon (15,2) w
     C                     Z-ADD*ZEROS    W0WA01 152       *Synon (15,2) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WJ01 150       *Synon (15,0) w
     C                     Z-ADD*ZEROS    W0WJ00 150       *Synon (15,0) w
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'Y'       W0PMT   1
      * Define local variables for subroutine SHRVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  70
     C                     MOVEL*BLANK    WL0003  1
     C                     MOVEL*BLANK    WL0004  1
      * Define local variables for subroutine SIRVGN.
     C                     Z-ADD*ZERO     WL0005  30
     C                     Z-ADD*ZERO     WL0006  70
     C                     MOVEL*BLANK    WL0007  3
     C                     Z-ADD*ZERO     WL0008 112
     C                     Z-ADD*ZERO     WL0009 112
     C                     Z-ADD*ZERO     WL0010  70
      * Define local variables for subroutine SNRVGN.
     C                     MOVEL*BLANK    WL0011 10
     C                     MOVEL*BLANK    WL0012  6
     C                     Z-ADD*ZERO     WL0013  30
     C                     MOVEL*BLANK    WL0014  3
      * Define null work field PS Max Qty per Day
     C                     Z-ADD*ZERO     YN0001  70
      * Define local work field Header Status
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Billing Activity Type
     C                     MOVEL*BLANK    YL0002  1
      * Define local work field Header Status
     C                     MOVEL*BLANK    YL0003  1
      * Define local work field Billing Activity Type
     C                     MOVEL*BLANK    YL0004  1
      * Define local work field PRT Night Queue Run Sts
     C                     MOVEL*BLANK    YL0005  1
      * Define local work field CIE Capacity Code
     C                     MOVEL*BLANK    YL0006  6
      * Define local work field Consumed Item Code
     C                     Z-ADD*ZERO     YL0007  70
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0008  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0009  3
      * Define local work field User Code Model
     C                     MOVEL*BLANK    YL0010 10
      * Define local work field User Profile Code
     C                     MOVEL*BLANK    YL0011 10
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD11        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      *
     C                     MOVEL*BLANK    WN0001 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0001           User Profile Na
      *
     C                     MOVEL*BLANK    WN0002 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SMRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,002                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0001    ZA0002           User Profile Na
     C                     MOVEL'P/S'     ZA0003           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL@CN,017   P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0002    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0001    WL0011    P      User Profile Na
     C                     MOVEL'P/S'     WL0012    P      Application Cod
     C                     EXSR SNRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0013    WUAIC3           Company Number
     C                     MOVELWL0014    YL0009    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0002    WL0011    P      User Profile Na
     C                     MOVEL'P/S'     WL0012    P      Application Cod
     C                     EXSR SNRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0013    WUAIC3           Company Number
     C                     MOVELWL0014    YL0009    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0009    #2AJCD           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0001    ZA0004           User Profile Na
     C                     MOVEL'P/S'     ZA0005           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL@CN,017   P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0008    IFNE *ZERO                      *IF
     C                     Z-ADDYL0008    WUAIC3           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0009    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C           #2AJCD    PARM *BLANK    WQ0033  3        Warehouse Code
     C                     PARM YL0008    WQ0034  30       Shipping Compan
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9934  *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SORVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
     C                     Z-ADD9999      W0SLM            *Scan limit
      * ***** Change Flag and Comments
     C                     EXSR UCSUBR                     ***** Change Fl
     C                     MOVEL'Y'       WUTAST           First Time Flag
      * Rtv Profile Model     RT - User Profile Control  * 
     C                     EXSR SQRVGN
      * 11/02/09 PKD Allow Sched as Order -renamed to App WHS Restrict
      * *Set Cursor: CTL.Item Code  (*Override=*YES)
     C                     Z-ADD*ZERO     W0RR0
     C                     Z-ADD012       W0ROW0
     C                     Z-ADD005       W0COL0
     C                     MOVEL'1'       W0OVR0           *YES
      * CASE:
      *  - c1 OR c2 ORc3
      *   |- c1    : LCL.User Code Model is Production Scheduling
      *   |- c2    : LCL.User Code Model is IS
      *   |- c3    : LCL.User Profile Code is Production Sched 2
      *   '-
     C           YL0010    IFEQ @CN,018                    *IF
     C           YL0010    OREQ @CN,019                    *OR
     C           YL0011    OREQ @CN,020                    *OR
      * only allow these user to have use the adjustment processing
     C                     MOVEL'Y'       WUDPST           Allow Adjustmen
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDPST           Allow Adjustmen
     C                     END                             *FI
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** W0BEG
01052010780110901127011510153801794
03077030870310803119031250313103141
03147031580316303173031830319503330
03333033430336403375033810338703397
034030341403419034290343903451
** W0END
01054010850110901127011510166701923
03083031030311403121031270313603143
03152031580316903179031900320103331
03339033590337003377033830339203399
034080341403425034350344603457
** W0NAM
#2B7ST    V2ELDT    #2V5ST    #CWQST    #2TEST    **SPT     #2ST1
V2HGCD    #CGENA    VCNUDT    #2AJCD    V2AIC3    #2XRCD    #CS0CD
#CKUAA    #CPFTX    #CQINV    #CK6QT    #CH1QT    #CIRQT    #1SEL
V1HGCD    #RGENA    VRNUDT    #1AJCD    V1AIC3    #1XRCD    #RS0CD
#RKUAA    #1TEST    #RQINV    #RK6QT    #RWPRD    #RQORD
** @CN
00001 FRZTRMPROD
00002 Y2U0005
00003 1111111
00004 USR0752
00005 Production Items
00006 ALICEB
00007 ISALICEB
00008 PRKTEST
00009 ISPURVAP
00010 ISPPATE
00011 ISROSEM
00012 ISRCENT
00013 ISSMASO
00014 ISSUSANM
00015 ISLBUSE
00016 ISLARAB
00017 Y2U9999
00018 PORKSCHE
00019 ISBGUTI
00020 PORKSCHE2
