/*********************************************************************/
/* PROGRAM    : PMUNUPC                                             */
/* TITLE      : EXECUTE THE HPBSHIP AND EMAIL TO RECIPS,            */
/* DATE       : 05/02/2008                                           */
/* Description: EXECUTE THE SQL HPBSHIP AND EMAIL TO RECIP IN THE   */
/*                HPBSHIP ESEND LIST                                 */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &COMP       COMPANY FOR OH SELECTION 369  AND 374       */
/*    I     &COMP2      COMPANY FOR PROD PLANT   361  AND 373       */
/*    I     &EADDRESS   EMAIL ADDRESS TO SEND TO                     */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/* 9/04/09   RMC       ADDED 2ND SQL EMAIL ADDR AND EXEC IT IN THE SCRIPT  */
/* 4/09/12   RMC E2041 STOP SENDING HPBSHIP USING EMAIL ADDR 1 (MUSKETS)  */
/* 8/30/16   RMC R6965 NEW  HPB PLANT -- ADD COMP PARMS TO PASS TO SQLS */
/*********************************************************************/
 PMUNUPC:    PGM        PARM(&RETURN &COMP &COMP2)
/*-------------------------------------------------------------------*/
/* Declare Variables                                                 */
/*-------------------------------------------------------------------*/
             DCL        VAR(&RETURN)   TYPE(*CHAR) LEN(7)
 /*          DCL        VAR(&EADDR) TYPE(*CHAR) LEN(50)    */
             DCL        VAR(&EADDR2) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMP) TYPE(*CHAR) LEN(3)   /* MKT COMPANY */
             DCL        VAR(&COMP2) TYPE(*CHAR) LEN(3) /*PROD PLANT COMP */
             DCL        VAR(&COMP2N) TYPE(*DEC) LEN(3 0) /*PROD PLANT COMP */

             DCL        VAR(&DATE) TYPE(*CHAR) LEN(8)

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

             CHGVAR     VAR(&COMP2N) VALUE(&COMP2)

/*-------------------------------------------------------------------*/
/* GET PREVIOUS PROD DATE                                      */
/*-------------------------------------------------------------------*/
 /*          CALL       PGM(PMUOXFR) PARM(' ' X'361F' &DATE)         */
             CALL       PGM(PMUOXFR) PARM(' ' &COMP2N  &DATE)

/*-------------------------------------------------------------------*/
/* GET ESEND ADDRESS BOOK LIST NAME FROM COMPANY VALUES  */
/*-------------------------------------------------------------------*/
  /*        CALL       PGM(POMTXFR) PARM(' ' X'361F' 'HPBSHIP'  &EADDR) */
  /*         CALL       PGM(POMTXFR) PARM(' ' X'361F' 'HPBSHIP2' &EADDR2) */
             CALL       PGM(POMTXFR) PARM(' ' &COMP2N  'HPBSHIP2' &EADDR2)
/*-------------------------------------------------------------------*/
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ADDLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF2103 CPF9999)

  /*  T:     RUNSCRIPT  SCRIPT(HPBSHIP.S) SETVAR((&SDATE &DATE) +
                          (&EMAIL &EADDR) (&EMAIL2 &EADDR2))       */
 SCRIPT:     RUNSCRIPT  SCRIPT(HPBSHIP.S) SETVAR((&SDATE &DATE) +
                          (&EMAIL2 &EADDR2) (&COMP &COMP) (&COMP2 +
                          &COMP2))

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ENDPGM))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     RMVLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF0000)

             ENDPGM
