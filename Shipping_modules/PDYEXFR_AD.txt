// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDYEXFR
// ?Date: 14.08.2025 Time: 03:33:36
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// PAR.Ord/Sch Sts USR = CND.Scheduled
PAR.Ord_Sch_Sts_USR = 'S';

CASE;

// IF PAR.Production Type is Schedule Saved in the am
IF PAR.Production_Type = 'X';

// IF PAR.Production Date EQ JOB.*Job date
IF PAR.Production_Date = JOB.*Job_date;

// AND PAR.Production Type is Plan
AND PAR.Production_Type = 'P';

// IF PAR.Fresh Chilling Time is GT Zero
IF PAR.Fresh_Chilling_Time > *ZERO;

// AND PAR.Avail Ship Date USR EQ JOB.*Job date
AND PAR.Avail_Ship_Date_USR = JOB.*Job_date;

// IF PAR.Production Date LT JOB.*Job date
IF PAR.Production_Date < JOB.*Job_date;

// AND PAR.Production Type is Plan
AND PAR.Production_Type = 'P';

// AND PAR.Fresh Chilling Time is GT Zero
AND PAR.Fresh_Chilling_Time > *ZERO;

// IF PAR.Production Date LT JOB.*Job date
IF PAR.Production_Date < JOB.*Job_date;

// AND PAR.Avail Ship Date USR GT JOB.*Job date
AND PAR.Avail_Ship_Date_USR > JOB.*Job_date;

//?Retrieve/Calculate Weight Scheduled Shipments
CASE;

// IF PAR.Avail Dsp/Prt Type USR is Display Detail
IF PAR.Avail_Dsp_Prt_Type_USR = 'D';

// OR PAR.Avail Dsp/Prt Type USR is Print Detail
OR PAR.Avail_Dsp_Prt_Type_USR = 'L';

EXECUTE FUNCTION(Rtv Sched Shipments   RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1425201;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Avail_Ship_Date_USR);
PARAMETER(PAR.Weight_Scheduled_SUM);
PARAMETER(PAR.Quantity_Scheduled_SUM);
PARAMETER(PAR.Ord_Sch_Sts_USR);
{
 //?USER: Initialize routine

 // PAR.Weight Scheduled SUM = CON.*ZERO
 PAR.Weight_Scheduled_SUM = *ZERO;

 // PAR.Quantity Scheduled SUM = CON.*ZERO
 PAR.Quantity_Scheduled_SUM = *ZERO;

 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Hdr Sts,BillActTy RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1946282;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(WRK.Header_Status);
 PARAMETER(WRK.Billing_Activity_Type);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF WRK.Header Status is Not Comp/Canc/Conf
 IF WRK.Header_Status = 'L'/'A'/'E'/'H';

 // AND WRK.Billing Activity Type is Invoice or Transfer
 AND WRK.Billing_Activity_Type = '1'/'4';

 CASE;

 // IF PAR.Ord/Sch Sts USR is Scheduled
 IF PAR.Ord_Sch_Sts_USR = 'S';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Scheduled
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Scheduled;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Scheduled
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Scheduled;

 // IF PAR.Ord/Sch Sts USR is Ordered
 IF PAR.Ord_Sch_Sts_USR = 'O';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Ordered
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Ordered;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Ordered
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Ordered;

 ENDIF;

 ENDIF;

}


CASE;

// IF PAR.Piece Count Item is Not Yes
IF PAR.Piece_Count_Item = *BLANK/'N';

// AND PAR.Unit Weight is Greater than zero
AND PAR.Unit_Weight > *ZERO;

// Sched Shipments (No Dec)
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Sched_Ship_USR + ( PAR.Weight_Scheduled_SUM             +
/ PAR.Unit_Weight 'H' );

// IF PAR.Piece Count Item is yes
IF PAR.Piece_Count_Item = 'Y';

// AND PAR.Pieces Per Bag is GT Zero
AND PAR.Pieces_Per_Bag > *ZERO;

// AND PAR.Bags Per Unit is GT Zero
AND PAR.Bags_Per_Unit > *ZERO;

// PAR.Quantity Sched Ship USR = PAR.Quantity Scheduled SUM
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Scheduled_SUM;

ENDIF;

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

//?Calculate Production/Reserved/Adjustments
CASE;

// IF PAR.Piece Count Item is Not Yes
IF PAR.Piece_Count_Item = *BLANK/'N';

// AND PAR.Unit Weight is Greater than zero
AND PAR.Unit_Weight > *ZERO;

// Production (No Dec)
PAR.Quantity_Production_USR = PAR.Quantity_Production_USR + ( ( ( (                                +
PAR.PS_Weight_Standard + PAR.PS_Weight_Prod_Adj ) - PAR.PS_Weight_Converted )                     +
- PAR.PS_Weight_Whs_Tfr_Adj ) / PAR.Unit_Weight 'H' );

//?Reserved (No Dec)
CASE;

// IF PAR.Avail Ship Date USR GT JOB.*Job date
IF PAR.Avail_Ship_Date_USR > JOB.*Job_date;

// Sales (No Dec)
PAR.Quantity_Sales_USR = PAR.Quantity_Sales_USR + ( PAR.PS_Weight_Prod_Allocated                   +
/ PAR.Unit_Weight 'H' );

//?Retrieve/Calculate Weight Scheduled Shipments
CASE;

// IF PAR.Avail Dsp/Prt Type USR is Display Detail
IF PAR.Avail_Dsp_Prt_Type_USR = 'D';

// OR PAR.Avail Dsp/Prt Type USR is Print Detail
OR PAR.Avail_Dsp_Prt_Type_USR = 'L';

EXECUTE FUNCTION(Rtv Sched Shipments   RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1425201;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Avail_Ship_Date_USR);
PARAMETER(PAR.Weight_Scheduled_SUM);
PARAMETER(PAR.Quantity_Scheduled_SUM);
PARAMETER(PAR.Ord_Sch_Sts_USR);
{
 //?USER: Initialize routine

 // PAR.Weight Scheduled SUM = CON.*ZERO
 PAR.Weight_Scheduled_SUM = *ZERO;

 // PAR.Quantity Scheduled SUM = CON.*ZERO
 PAR.Quantity_Scheduled_SUM = *ZERO;

 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Hdr Sts,BillActTy RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1946282;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(WRK.Header_Status);
 PARAMETER(WRK.Billing_Activity_Type);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF WRK.Header Status is Not Comp/Canc/Conf
 IF WRK.Header_Status = 'L'/'A'/'E'/'H';

 // AND WRK.Billing Activity Type is Invoice or Transfer
 AND WRK.Billing_Activity_Type = '1'/'4';

 CASE;

 // IF PAR.Ord/Sch Sts USR is Scheduled
 IF PAR.Ord_Sch_Sts_USR = 'S';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Scheduled
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Scheduled;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Scheduled
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Scheduled;

 // IF PAR.Ord/Sch Sts USR is Ordered
 IF PAR.Ord_Sch_Sts_USR = 'O';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Ordered
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Ordered;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Ordered
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Ordered;

 ENDIF;

 ENDIF;

}


// Sched Shipments (No Dec)
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Sched_Ship_USR + ( PAR.Weight_Scheduled_SUM             +
/ PAR.Unit_Weight 'H' );

ENDIF;

ENDIF;

// Adjustments (No Dec)
PAR.Quantity_Adjustment_USR = PAR.Quantity_Adjustment_USR + ( PAR.PS_Weight_Shipping_Adj           +
/ PAR.Unit_Weight 'H' );

//?Calculate Production/Reserved/Adjustments
// IF PAR.Piece Count Item is yes
IF PAR.Piece_Count_Item = 'Y';

// AND PAR.Pieces Per Bag is GT Zero
AND PAR.Pieces_Per_Bag > *ZERO;

// AND PAR.Bags Per Unit is GT Zero
AND PAR.Bags_Per_Unit > *ZERO;

//? **If Piece count item use  PIECE fields
// Production (No Dec)
PAR.Quantity_Production_USR = PAR.Quantity_Production_USR + ( ( ( (                                +
PAR.PS_Pieces_Standard + PAR.PS_Pieces_Prod_Adj ) - PAR.PS_Pieces_Converted )                     +
- PAR.PS_Pieces_Whs_Tfr_Adj ) / ( PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) + 'H' );

//?Reserved (No Dec)
CASE;

// IF PAR.Avail Ship Date USR GT JOB.*Job date
IF PAR.Avail_Ship_Date_USR > JOB.*Job_date;

// Reserved (No Dec)
PAR.Quantity_Sales_USR = PAR.Quantity_Sales_USR + ( PAR.PS_Pieces_Prod_Allocated / (               +
PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) 'H' );

//?Retrieve/Calculate Weight Scheduled Shipments
CASE;

// IF PAR.Avail Dsp/Prt Type USR is Display Detail
IF PAR.Avail_Dsp_Prt_Type_USR = 'D';

// OR PAR.Avail Dsp/Prt Type USR is Print Detail
OR PAR.Avail_Dsp_Prt_Type_USR = 'L';

EXECUTE FUNCTION(Rtv Sched Shipments   RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1425201;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Avail_Ship_Date_USR);
PARAMETER(PAR.Weight_Scheduled_SUM);
PARAMETER(PAR.Quantity_Scheduled_SUM);
PARAMETER(PAR.Ord_Sch_Sts_USR);
{
 //?USER: Initialize routine

 // PAR.Weight Scheduled SUM = CON.*ZERO
 PAR.Weight_Scheduled_SUM = *ZERO;

 // PAR.Quantity Scheduled SUM = CON.*ZERO
 PAR.Quantity_Scheduled_SUM = *ZERO;

 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Hdr Sts,BillActTy RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1946282;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(WRK.Header_Status);
 PARAMETER(WRK.Billing_Activity_Type);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF WRK.Header Status is Not Comp/Canc/Conf
 IF WRK.Header_Status = 'L'/'A'/'E'/'H';

 // AND WRK.Billing Activity Type is Invoice or Transfer
 AND WRK.Billing_Activity_Type = '1'/'4';

 CASE;

 // IF PAR.Ord/Sch Sts USR is Scheduled
 IF PAR.Ord_Sch_Sts_USR = 'S';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Scheduled
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Scheduled;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Scheduled
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Scheduled;

 // IF PAR.Ord/Sch Sts USR is Ordered
 IF PAR.Ord_Sch_Sts_USR = 'O';

 // PAR.Weight Scheduled SUM = PAR.Weight Scheduled SUM + DB1.Weight Ordered
 PAR.Weight_Scheduled_SUM = PAR.Weight_Scheduled_SUM + DB1.Weight_Ordered;

 // PAR.Quantity Scheduled SUM = PAR.Quantity Scheduled SUM + DB1.Quantity Ordered
 PAR.Quantity_Scheduled_SUM = PAR.Quantity_Scheduled_SUM + DB1.Quantity_Ordered;

 ENDIF;

 ENDIF;

}


// PAR.Quantity Sched Ship USR = PAR.Quantity Scheduled SUM
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Scheduled_SUM;

ENDIF;

ENDIF;

// Adjustments (No Dec)
PAR.Quantity_Adjustment_USR = PAR.Quantity_Adjustment_USR + ( PAR.PS_Pieces_Shipping_Adj /         +
( PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) 'H' );

ENDIF;

//?Calculate Ship From Cut Adjustment
CASE;

// IF PAR.Chilling Time is GT Zero
IF PAR.Fresh_Chilling_Time > *ZERO;

// AND PAR.Production Date EQ JOB.*Job date
AND PAR.Production_Date = JOB.*Job_date;

EXECUTE FUNCTION(Rtv Ship Cut Adjust   RT) TYPE(RTVOBJ) FILE(PDI8CPP)           AC1461722;
PARAMETER(PAR.Company_Number);
PARAMETER('P');
PARAMETER(PAR.Avail_Ship_Date_USR);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.PS_Weight_Ship_Cut_Adj);
PARAMETER(PAR.PS_Pieces_Ship_Cut_Adj);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PAR.Piece Count Item is Not Yes
IF PAR.Piece_Count_Item = *BLANK/'N';

// AND PAR.Unit Weight is Greater than zero
AND PAR.Unit_Weight > *ZERO;

// Ship Cut Adj (No Dec)
PAR.Quantity_Adjustment_USR = PAR.Quantity_Adjustment_USR + ( PAR.PS_Weight_Ship_Cut_Adj           +
/ PAR.Unit_Weight 'H' );

// IF PAR.Piece Count Item is yes
IF PAR.Piece_Count_Item = 'Y';

// AND PAR.Pieces Per Bag is GT Zero
AND PAR.Pieces_Per_Bag > *ZERO;

// AND PAR.Bags Per Unit is GT Zero
AND PAR.Bags_Per_Unit > *ZERO;

// Ship Cut Adj (No Dec)
PAR.Quantity_Adjustment_USR = PAR.Quantity_Adjustment_USR + ( PAR.PS_Pieces_Ship_Cut_Adj /         +
( PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) 'H' );

ENDIF;

ENDIF;

// Old Availability
PAR.Quantity_Available_USR = ( ( PAR.Quantity_Inventory_USR                                        +
+ PAR.Quantity_Production_USR ) - PAR.Quantity_Sales_USR ) + PAR.Quantity_Adjustment_USR;

// PAR.Production Date USR = PAR.Production Date
PAR.Production_Date_USR = PAR.Production_Date;

ENDIF;

