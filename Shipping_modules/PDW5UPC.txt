/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  THIS PROGRAM WILL BE CALLED FROM A TRIGGER ON THE   */
/*              ORDER HEADER FILE.                                  */
/*              THIS PROGRAM WILL CALL A SYNON PROGRAM TO RETRIEVE  */
/*              THE ORDER NUMBER FROM THE TRIGGER BUFFER AND RETURN */
/*              THE USER EMAIL ADDRESS AND THE ORDER NUMBER         */
/*              THIS CL WILL THEN SEND AN EMAIL MESSAGE THAT AN      */
/*              ORDER HAS SHIPPED FROM THE PORK OMS SYSTEM. IT USES */
/*              A USERID THAT IS (A + CUSTOMER #). THE MESSAGE WILL */
/*              ONLY BE SENT IF THE ORDER HEADER EMAIL FLAG IS YES. */
/*              AND THE ORDER HAS ALREADY BEEN EMAILED.             */
/*                                                                  */
/*  3/02/10     THE PROCESS TO SEND THE ASN TO THE CUSTOMER WAS      */
/*              ADDED TO ALSO KICK OFF ANYTIME THE ORDER HDR FILE   */
/*              IS WRITTEN TO OR CHANGED. CERTAIN CRITERIA HAVE TO  */
/*              BE IN PLACE FOR THE PROCESS TO CREATE THE ASN AND   */
/*              SEND. MAINLY THAT THE ORDER IS IN SHIPPED STS AND   */
/*              AND THE EDI ASN SEND FLAG BE YES.                   */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*                                                                  */
/*  DATE      - 04/06/99                                            */
/*                                                                  */
/********************************************************************/
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*               &TRGBUF  - TRIGGER BUFFER                          */
/*               &TRGLEN  - TRIGGER LENGTH                          */
/********************************************************************/
/* MODIFIED BY:                                                     */
/* RMC   3/17/00   CHANGE THE SNDDST TO USE THE TOINTNET PARAMETER  */
/* RMC   6/09/00   ADD THE CUST PO NUMBER TO THE MESSAGE      */
/* PKD   11/08/00  ADDED ORDER NUMBER AND CUSTOMER NAME TO THE      */
/*                 MESSAGE FOR ERROR IN SNDDST.                     */
/* PKD   11/08/00  ADDED A MESSAGE FOR SUCCESSFUL SEND OF EMAIL     */
/* RMC   03/20/02  ADD 7 TO BUFFER POSITIONS STARTING WITH FIELD    */
/*                 &CUSTNAME                                        */
/* SLM   07/27/06  REPLACE WWW.SEABOARDPORK.COM/corner/ccs  */
/*                         WWW.SEABOARDFOODS.COM/CCS                */
/* JJH   12/02/15  REPLACE WWW.SEABOARDPORK.COM/corner/ccs  */
/*                         LEGACY.SEABOARDFOODS.COM/CCS             */
/* JJH   05/02/19  E14943  REPLACE legacy.seaboardfoods.com/ccs with*/
/*                         https://customercare.seaboardfoods.com   */
/* DN    02/14/22  W93244  REPLACE last sentence with 'Please visit  */
/*                         https://customercare.seaboardfoods.com to */
/*                         view or print your invoice.               */
/********************************************************************/

 PDW5UPC:    PGM        PARM(&TRGBUF &TRGLEN)

/* PARMS */
         DCL     &TRGBUF     *CHAR    (1906)     /* TRIGGER BUFFER */
         DCL     &TRGLEN     *DEC     (4 0)      /* BUFFER LENGTH  */

         DCL     &BFRSTS     *CHAR    1          /* ORD STATUS BEFORE         */
         DCL     &AFTSTS     *CHAR    1          /* ORD STATUS AFTER          */
         DCL     &EMAIL      *CHAR    1          /* EMAIL ORDER SHIP          */
         DCL     &ORDEMAIL   *CHAR    1          /* ORDER ALREADY EMAIL       */
         DCL     &ORDINUSE   *CHAR    1          /* ORD IN USE                */
         DCL     &CUSTNAME   *CHAR    (25)       /* CUSTMOMER NAME            */
         DCL     &INTNET     *CHAR    (50)       /* EMAIL ADDR                */

         DCL     &EMAILUSR   *CHAR    (8)        /* EMAIL USER ID             */
         DCL     &ORDERA     *CHAR    7          /* ORDER NUMBER ALPHA        */
         DCL     &COMPA      *CHAR    3          /* COMPANY NUMBER ALPH       */
         DCL     &EMAILYN    *CHAR    1          /* EMAIL ORDER               */
         DCL     &RETURN     *CHAR    7          /* RETURN CODE               */
         DCL     &CUSTPO     *CHAR    15         /* CUSTOMER PO               */
         DCL     &MSG        *CHAR    256        /* MESSAGE FOR ESNDFILE CMD  */
         DCL     &EDEASN     *CHAR    1          /* EDI ASN FLAG?             */
         DCL     &TPRTNR     *CHAR    6          /* TRADE PARTNER             */

             DCL        VAR(&A) TYPE(*CHAR) LEN(20)
             DCL        VAR(&B) TYPE(*CHAR) LEN(28)

             CHGVAR     VAR(&BFRSTS) VALUE(%SST(&TRGBUF 547 1))
/* 3/20      CHGVAR     VAR(&CUSTNAME) VALUE(%SST(&TRGBUF 1018 25)) */
/*   "       CHGVAR     VAR(&AFTSTS) VALUE(%SST(&TRGBUF 1452 1)) */
/*   "       CHGVAR     VAR(&EMAIL) VALUE(%SST(&TRGBUF 1658 1))   */
/*   "       CHGVAR     VAR(&ORDEMAIL) VALUE(%SST(&TRGBUF 1659 1)) */
             CHGVAR     VAR(&CUSTNAME) VALUE(%SST(&TRGBUF 1025 25))
             CHGVAR     VAR(&AFTSTS) VALUE(%SST(&TRGBUF 1459 1))
             CHGVAR     VAR(&EMAIL) VALUE(%SST(&TRGBUF 1665 1))
             CHGVAR     VAR(&ORDEMAIL) VALUE(%SST(&TRGBUF 1666 1))
             CHGVAR     VAR(&ORDINUSE) VALUE(%SST(&TRGBUF 1458 1))

/* IF ORDER IS BEING SHIPPED AND ORDER EMAIL IS Y AND ORDER EMAILED IS*/
/* NOT Y THEN RETRIEVE ORDER NUMBER/EMAIL ADDRESS AND SEND EMAIL */

     /*      IF COND(&BFRSTS *EQ 'A' *AND &AFTSTS *EQ 'R' */

             IF         COND(&AFTSTS *EQ 'R' *AND &EMAIL *EQ 'Y' +
                          *AND &ORDEMAIL *NE 'Y' *AND &ORDINUSE *EQ +
                          'N') THEN(DO)

             CALL       PGM(PDX0UPR) PARM(&TRGBUF &EMAILUSR &COMPA +
                          &ORDERA &EMAILYN &INTNET &CUSTPO &EDEASN +
                          &TPRTNR)

             CHGVAR     VAR(&A) VALUE('ORDER NUMBER' *BCAT &ORDERA)
             IF         COND(&CUSTPO *NE '               ') THEN(DO)
             CHGVAR     VAR(&B) VALUE('P.O. NUMBER' *BCAT &CUSTPO)
             ENDDO

             IF COND(&EMAILYN *EQ 'Y') THEN(DO)

/*           SNDDST     TYPE(*LMSG) TOINTNET((&INTNET)) +
                          DSTD(&CUSTNAME) LONGMSG('Order number' +
                          *BCAT &ORDERA *BCAT 'has been shipped. +
                          Click link to view the invoice: +
                          HTTP://legacy.seaboardfoods.com/ccs/s+
                          tatus_single-order.asp?ordernbr=' *CAT +
                          &ORDERA)                           */
/*---------------------------------------------------------------------------*/
/*  PURVA */
/*           SNDDST     TYPE(*LMSG) TOINTNET((&INTNET)) +
                          DSTD(&CUSTNAME) LONGMSG(&A *BCAT &B +
                          *BCAT 'has been shipped. +
                          Click link to view the invoice: +
                          HTTP://legacy.seaboardfoods.com/ccs/s+
                          tatus_single-order.asp?ordernbr=' *CAT +
                          &ORDERA) */
/*           MONMSG     MSGID(CPF901A) EXEC(DO) */
/*           SNDMSG     MSG('ERROR IN SNDDST FOR' *BCAT &A *BCAT +
                          'TO' *BCAT &CUSTNAME) TOUSR(ISRCENT) */
/*           SNDMSG     MSG('ERROR IN SNDDST') TOUSR(ISRCENT) */
/*           CHGJOB     LOG(4 0 *SECLVL) */
/*           GOTO       CMDLBL(ORDCHG) */
/*           ENDDO */

/*----------------------------------------------------------------------*/
/* TESTING ESNDFILE COMMAND -PURVA                                      */
/*----------------------------------------------------------------------*/
             ADDLIBLE ESEND *LAST
             MONMSG     MSGID(CPF0000)

/* E14943    CHGVAR     VAR(&MSG) VALUE(&A *BCAT &B *BCAT 'has been +   */
/* E14943                 shipped. Click link to view the invoice: +    */
/* E14943                 HTTP://legacy.seaboardfoods.com/ccs/stat+     */
/* E14943                 us_single-order.asp?ordernbr=' *CAT &ORDERA)  */

   /* W93244 - Replaced with Updated Website Link */
   /* W93244 CHGVAR     VAR(&MSG) VALUE(&A *BCAT &B *BCAT 'has been +
                          shipped. Click link to view the invoice: +
                          https://customercare.seaboardfoods.com/stat+
                          us_single-order.asp?ordernbr=' *CAT &ORDERA)  */

             CHGVAR     VAR(&MSG) VALUE(&A *BCAT &B *BCAT 'has been +
                          shipped. Please visit: +
                          https://customercare.seaboardfoods.com to +
                          view or print your invoice.')

             ESNDFILE   RECIPIENT(&INTNET) SUBJECT(&CUSTNAME) MSG(&MSG)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             SNDMSG     MSG('ERROR IN ESNDFILE FOR' *BCAT &A *BCAT +
                          'TO' *BCAT &CUSTNAME) TOUSR(SEABOARD)
             CHGJOB     LOG(4 0 *SECLVL)
             GOTO       CMDLBL(ORDCHG)
             ENDDO
             SNDMSG     MSG('EMAIL SENT FOR' *BCAT &A *BCAT +
                          'TO' *BCAT &CUSTNAME) TOUSR(SEABOARD)
/*----------------------------------------------------------------------*/

/* CHANGE ORDER EMAILED FLAG *NOTE* SUBMITTED BECAUSE WILL KICK OFF */
/* TRIGGER AGAIN                                                  */
ORDCHG:
             SBMJOB     CMD(CALL PGM(PDXZXFR) PARM(&RETURN &COMPA +
                          &ORDERA))

             ENDDO

             ENDDO
/*----------------------------------------------------------------------*/

 END:        ENDPGM

