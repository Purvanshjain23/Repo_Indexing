     H/TITLE Snd PFS Load Header   XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 07/11/19  Time  : 12:50:49
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPPBACPL3IF  E           K        DISK
      * RSQ : PFS Load Header           Co/Ld PSts=0
      *
     FPPBACPL5IF  E           K        DISK                      A
      * UPD : PFS Load Header           Update Index QTEMP
      *
     FPPBACPL0UF  E           K        DISK
      * UPD : PFS Load Header           Update index
      *
     I@BACPB5
      * PFS Load Header           Co/Ld PSts=0
      * Renamed input format fields
     I              BAY1NX                          WAY1NX
     I              BAZGNX                          WAZGNX
     I              BAAWNY                          WAAWNY
     I              BAF4AA                          WAF4AA
     I              BAFQT1                          WAFQT1
     I              BAVBSX                          WAVBSX
     I              BAF5AA                          WAF5AA
     I              BAFRT1                          WAFRT1
     I              BAFST1                          WAFST1
     I              BAFTT1                          WAFTT1
     I              BAFUT1                          WAFUT1
     I              BAFVT1                          WAFVT1
     I              BAFWT1                          WAFWT1
     I              BAFXT1                          WAFXT1
     I              BAZLNX                          WAZLNX
     I              BAF7AA                          WAF7AA
     I              BAF6AA                          WAF6AA
     I              BAU7SX                          WAU7SX
     I              BAU9SX                          WAU9SX
     I              BAVASX                          WAVASX
     I              BAZMNX                          WAZMNX
     I              BAZNNX                          WAZNNX
     I              BAZONX                          WAZONX
     I              BAU8SX                          WAU8SX
     I              BAZHNX                          WAZHNX
     I              BAZINX                          WAZINX
     I              BAZJNX                          WAZJNX
     I              BAZKNX                          WAZKNX
     I              BABLNY                          WABLNY
     I              BAFYT1                          WAFYT1
     I              BABKNY                          WABKNY
     I              BAATNY                          WAATNY
     I              BAB4NY                          WAB4NY
     I              BAY7SX                          WAY7SX
     I              BAHST1                          WAHST1
     I              BAF5NY                          WAF5NY
     I              BAY8SX                          WAY8SX
     I              BAY9SX                          WAY9SX
     I              BAZASX                          WAZASX
     I              BAZBSX                          WAZBSX
     I              BAZCSX                          WAZCSX
     I              BAMWU1                          WAMWU1
     I              BAUWSX                          WAUWSX
     I              BAUXSX                          WAUXSX
     I              BAV3SX                          WAV3SX
     I              BAAHNY                          WAAHNY
     I              BAAINY                          WAAINY
     I              BAAJNY                          WAAJNY
     I              BAAKNY                          WAAKNY
      *
     I@BACPDB
      * PFS Load Header           Update Index QTEMP
      * Renamed input format fields
     I              BAY1NX                          WBY1NX
     I              BAZGNX                          WBZGNX
     I              BAAWNY                          WBAWNY
     I              BAF4AA                          WBF4AA
     I              BAFQT1                          WBFQT1
     I              BAVBSX                          WBVBSX
     I              BAF5AA                          WBF5AA
     I              BAFRT1                          WBFRT1
     I              BAFST1                          WBFST1
     I              BAFTT1                          WBFTT1
     I              BAFUT1                          WBFUT1
     I              BAFVT1                          WBFVT1
     I              BAFWT1                          WBFWT1
     I              BAFXT1                          WBFXT1
     I              BAZLNX                          WBZLNX
     I              BAF7AA                          WBF7AA
     I              BAF6AA                          WBF6AA
     I              BAU7SX                          WBU7SX
     I              BAU9SX                          WBU9SX
     I              BAVASX                          WBVASX
     I              BAZMNX                          WBZMNX
     I              BAZNNX                          WBZNNX
     I              BAZONX                          WBZONX
     I              BAU8SX                          WBU8SX
     I              BAZHNX                          WBZHNX
     I              BAZINX                          WBZINX
     I              BAZJNX                          WBZJNX
     I              BAZKNX                          WBZKNX
     I              BABLNY                          WBBLNY
     I              BAFYT1                          WBFYT1
     I              BABKNY                          WBBKNY
     I              BAATNY                          WBATNY
     I              BAB4NY                          WBB4NY
     I              BAY7SX                          WBY7SX
     I              BAHST1                          WBHST1
     I              BAF5NY                          WBF5NY
     I              BAY8SX                          WBY8SX
     I              BAY9SX                          WBY9SX
     I              BAZASX                          WBZASX
     I              BAZBSX                          WBZBSX
     I              BAZCSX                          WBZCSX
     I              BAMWU1                          WBMWU1
     I              BAUWSX                          WBUWSX
     I              BAUXSX                          WBUXSX
     I              BAV3SX                          WBV3SX
     I              BAAHNY                          WBAHNY
     I              BAAINY                          WBAINY
     I              BAAJNY                          WBAJNY
     I              BAAKNY                          WBAKNY
      *
     I@BACPZI
      * PFS Load Header           Update index
      * Renamed input format fields
     I              BAY1NX                          WCY1NX
     I              BAZGNX                          WCZGNX
     I              BAAWNY                          WCAWNY
     I              BAF4AA                          WCF4AA
     I              BAFQT1                          WCFQT1
     I              BAVBSX                          WCVBSX
     I              BAF5AA                          WCF5AA
     I              BAFRT1                          WCFRT1
     I              BAFST1                          WCFST1
     I              BAFTT1                          WCFTT1
     I              BAFUT1                          WCFUT1
     I              BAFVT1                          WCFVT1
     I              BAFWT1                          WCFWT1
     I              BAFXT1                          WCFXT1
     I              BAZLNX                          WCZLNX
     I              BAF7AA                          WCF7AA
     I              BAF6AA                          WCF6AA
     I              BAU7SX                          WCU7SX
     I              BAU9SX                          WCU9SX
     I              BAVASX                          WCVASX
     I              BAZMNX                          WCZMNX
     I              BAZNNX                          WCZNNX
     I              BAZONX                          WCZONX
     I              BAU8SX                          WCU8SX
     I              BAZHNX                          WCZHNX
     I              BAZINX                          WCZINX
     I              BAZJNX                          WCZJNX
     I              BAZKNX                          WCZKNX
     I              BABLNY                          WCBLNY
     I              BAFYT1                          WCFYT1
     I              BABKNY                          WCBKNY
     I              BAATNY                          WCATNY
     I              BAB4NY                          WCB4NY
     I              BAY7SX                          WCY7SX
     I              BAHST1                          WCHST1
     I              BAF5NY                          WCF5NY
     I              BAY8SX                          WCY8SX
     I              BAY9SX                          WCY9SX
     I              BAZASX                          WCZASX
     I              BAZBSX                          WCZBSX
     I              BAZCSX                          WCZCSX
     I              BAMWU1                          WCMWU1
     I              BAUWSX                          WCUWSX
     I              BAUXSX                          WCUXSX
     I              BAV3SX                          WCV3SX
     I              BAAHNY                          WCAHNY
     I              BAAINY                          WCAINY
     I              BAAJNY                          WCAJNY
     I              BAAKNY                          WCAKNY
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPPBA1    E DSPPBACPL5
      * UPD : PFS Load Header           Update Index QTEMP
      * Renamed input format fields
     I              BAY1NX                          WBY1NX
     I              BAZGNX                          WBZGNX
     I              BAAWNY                          WBAWNY
     I              BAF4AA                          WBF4AA
     I              BAFQT1                          WBFQT1
     I              BAVBSX                          WBVBSX
     I              BAF5AA                          WBF5AA
     I              BAFRT1                          WBFRT1
     I              BAFST1                          WBFST1
     I              BAFTT1                          WBFTT1
     I              BAFUT1                          WBFUT1
     I              BAFVT1                          WBFVT1
     I              BAFWT1                          WBFWT1
     I              BAFXT1                          WBFXT1
     I              BAZLNX                          WBZLNX
     I              BAF7AA                          WBF7AA
     I              BAF6AA                          WBF6AA
     I              BAU7SX                          WBU7SX
     I              BAU9SX                          WBU9SX
     I              BAVASX                          WBVASX
     I              BAZMNX                          WBZMNX
     I              BAZNNX                          WBZNNX
     I              BAZONX                          WBZONX
     I              BAU8SX                          WBU8SX
     I              BAZHNX                          WBZHNX
     I              BAZINX                          WBZINX
     I              BAZJNX                          WBZJNX
     I              BAZKNX                          WBZKNX
     I              BABLNY                          WBBLNY
     I              BAFYT1                          WBFYT1
     I              BABKNY                          WBBKNY
     I              BAATNY                          WBATNY
     I              BAB4NY                          WBB4NY
     I              BAY7SX                          WBY7SX
     I              BAHST1                          WBHST1
     I              BAF5NY                          WBF5NY
     I              BAY8SX                          WBY8SX
     I              BAY9SX                          WBY9SX
     I              BAZASX                          WBZASX
     I              BAZBSX                          WBZBSX
     I              BAZCSX                          WBZCSX
     I              BAMWU1                          WBMWU1
     I              BAUWSX                          WBUWSX
     I              BAUXSX                          WBUXSX
     I              BAV3SX                          WBV3SX
     I              BAAHNY                          WBAHNY
     I              BAAINY                          WBAINY
     I              BAAJNY                          WBAJNY
     I              BAAKNY                          WBAKNY
      *
     IQPPBA2    E DSPPBACPL0
      * UPD : PFS Load Header           Update index
      * Renamed input format fields
     I              BAY1NX                          WCY1NX
     I              BAZGNX                          WCZGNX
     I              BAAWNY                          WCAWNY
     I              BAF4AA                          WCF4AA
     I              BAFQT1                          WCFQT1
     I              BAVBSX                          WCVBSX
     I              BAF5AA                          WCF5AA
     I              BAFRT1                          WCFRT1
     I              BAFST1                          WCFST1
     I              BAFTT1                          WCFTT1
     I              BAFUT1                          WCFUT1
     I              BAFVT1                          WCFVT1
     I              BAFWT1                          WCFWT1
     I              BAFXT1                          WCFXT1
     I              BAZLNX                          WCZLNX
     I              BAF7AA                          WCF7AA
     I              BAF6AA                          WCF6AA
     I              BAU7SX                          WCU7SX
     I              BAU9SX                          WCU9SX
     I              BAVASX                          WCVASX
     I              BAZMNX                          WCZMNX
     I              BAZNNX                          WCZNNX
     I              BAZONX                          WCZONX
     I              BAU8SX                          WCU8SX
     I              BAZHNX                          WCZHNX
     I              BAZINX                          WCZINX
     I              BAZJNX                          WCZJNX
     I              BAZKNX                          WCZKNX
     I              BABLNY                          WCBLNY
     I              BAFYT1                          WCFYT1
     I              BABKNY                          WCBKNY
     I              BAATNY                          WCATNY
     I              BAB4NY                          WCB4NY
     I              BAY7SX                          WCY7SX
     I              BAHST1                          WCHST1
     I              BAF5NY                          WCF5NY
     I              BAY8SX                          WCY8SX
     I              BAY9SX                          WCY9SX
     I              BAZASX                          WCZASX
     I              BAZBSX                          WCZBSX
     I              BAZCSX                          WCZCSX
     I              BAMWU1                          WCMWU1
     I              BAUWSX                          WCUWSX
     I              BAUXSX                          WCUXSX
     I              BAV3SX                          WCV3SX
     I              BAAHNY                          WCAHNY
     I              BAAINY                          WCAINY
     I              BAAJNY                          WCAJNY
     I              BAAKNY                          WCAKNY
      *
     IYARDCS      DS                            430
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Company Number
     I                                    P   1   20P1AIC3
     IP2PARM      DS
      * N :  PFS Company Number
     I                                        1   30P2Y1NX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Snd PFS Load Header   XF
     C                     Z-ADDP1AIC3    P2Y1NX           PFS Company Num
      * Snd PFS Load Header   RT - PFS Load Header  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Snd PFS Load Header   RT - PFS Load Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAY1NX    WQSA01           PFS Company Num
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
      * Setup key
     C                     Z-ADDP2Y1NX    WQSA01           PFS Company Num
      * Establish starting position
     C           KRSSA     SETLL@BACPB5                    *
     C           KRSSA     READE@BACPB5                  90*
      * Data record not found
     C   90                MOVEL'USR3484' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Crt PFS LdHdr QTEMP   CR - PFS Load Header  * 
     C                     EXSR SBCRRC
      * Chg Process Status    CH - PFS Load Header  * 
     C                     EXSR SCCHRC
     C           KRSSA     READE@BACPB5                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Crt PFS LdHdr QTEMP   CR - PFS Load Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BACPDB
     C                     Z-ADDWAY1NX    WBY1NX           PFS Company Num
     C                     Z-ADDWAZGNX    WBZGNX           PFS Load ID
     C                     Z-ADDWAAWNY    WBAWNY           PFS Sched Seque
     C                     MOVELWAF4AA    WBF4AA           PFS Carrier Cod
     C                     MOVELWAFQT1    WBFQT1           PFS Carrier Nam
     C                     MOVELWAVBSX    WBVBSX           PFS Export Stat
     C                     MOVELWAF5AA    WBF5AA           PFS Shipping Li
     C                     MOVELWAFRT1    WBFRT1           PFS Shipping Li
     C                     MOVELWAFST1    WBFST1           PFS Shipping Li
     C                     MOVELWAFTT1    WBFTT1           PFS Shipping Li
     C                     MOVELWAFUT1    WBFUT1           PFS Shipping Li
     C                     MOVELWAFVT1    WBFVT1           PFS Shipping Li
     C                     MOVELWAFWT1    WBFWT1           PFS Shipping LI
     C                     MOVELWAFXT1    WBFXT1           PFS Vessel Name
     C                     MOVELWAZLNX    WBZLNX           PFS Voyage
     C                     MOVELWAF7AA    WBF7AA           PFS Discharge P
     C                     MOVELWAF6AA    WBF6AA           PFS Booking Num
     C                     MOVELWAU7SX    WBU7SX           PFS Shipping Me
     C                     MOVELWAU9SX    WBU9SX           PFS Load Shag F
     C                     MOVELWAVASX    WBVASX           PFS Load Wash F
     C                     Z-ADDWAZMNX    WBZMNX           PFS Load Total
     C                     Z-ADDWAZNNX    WBZNNX           PFS Load Total
     C                     Z-ADDWAZONX    WBZONX           PFS Reefer Temp
     C                     MOVELWAU8SX    WBU8SX           PFS Reefer Temp
     C                     Z-ADDWAZHNX    WBZHNX           PFS Load Sched
     C                     Z-ADDWAZINX    WBZINX           PFS Load Sched
     C                     Z-ADDWAZJNX    WBZJNX           PFS Load Deadli
     C                     Z-ADDWAZKNX    WBZKNX           PFS Load Deadli
     C                     Z-ADDWABLNY    WBBLNY           PFS Maximum Loa
     C                     MOVELWAFYT1    WBFYT1           PFS Federal Tax
     C                     Z-ADDWABKNY    WBBKNY           PFS Estimated P
     C                     Z-ADDWAATNY    WBATNY           PFS Average Pal
     C                     Z-ADDWAB4NY    WBB4NY           PFS Predicted L
     C                     MOVELWAY7SX    WBY7SX           PFS Load Status
     C                     MOVELWAHST1    WBHST1           PFS Trailer Id
     C                     Z-ADDWAF5NY    WBF5NY           PFS Sequence No
     C                     MOVELWAY8SX    WBY8SX           PFS Load Unused
     C                     MOVELWAY9SX    WBY9SX           PFS Load Unused
     C                     MOVELWAZASX    WBZASX           PFS Load Unused
     C                     MOVELWAZBSX    WBZBSX           PFS Load Unused
     C                     MOVELWAZCSX    WBZCSX           PFS Load Unused
     C                     MOVELWAMWU1    WBMWU1           PFS Load Unused
     C                     MOVELWAUWSX    WBUWSX           PFS Record Stat
     C                     Z-ADDWAUXSX    WBUXSX           PFS Process Sta
     C                     MOVELWAV3SX    WBV3SX           PFS Error Reaso
     C                     Z-ADDWAAHNY    WBAHNY           PFS Create Date
     C                     Z-ADDWAAINY    WBAINY           PFS Create Time
     C                     Z-ADDWAAJNY    WBAJNY           PFS Change Date
     C                     Z-ADDWAAKNY    WBAKNY           PFS Change time
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBY1NX           PFS Company Num
     C                     KFLD           WBZGNX           PFS Load ID
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BACPDB                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3485' W0RTN   7
      * Send message 'PFS Load Header        EX'
     C                     MOVEL'USR3485' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@BACPDB                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Process Status    CH - PFS Load Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  50       PFS Sched Seque
     C                     MOVEL*BLANK    WN0002  3        PFS Carrier Cod
     C                     MOVEL*BLANK    WN0003 30        PFS Carrier Nam
     C                     MOVEL*BLANK    WN0004  1        PFS Export Stat
     C                     MOVEL*BLANK    WN0005  3        PFS Shipping Li
     C                     MOVEL*BLANK    WN0006 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0007 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0008 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0009 20        PFS Shipping Li
     C                     MOVEL*BLANK    WN0010  2        PFS Shipping Li
     C                     MOVEL*BLANK    WN0011 11        PFS Shipping LI
     C                     MOVEL*BLANK    WN0012 30        PFS Vessel Name
     C                     MOVEL*BLANK    WN0013 15        PFS Voyage
     C                     MOVEL*BLANK    WN0014 20        PFS Discharge P
     C                     MOVEL*BLANK    WN0015 15        PFS Booking Num
     C                     MOVEL*BLANK    WN0016  2        PFS Shipping Me
     C                     MOVEL*BLANK    WN0017  1        PFS Load Shag F
     C                     MOVEL*BLANK    WN0018  1        PFS Load Wash F
     C                     Z-ADD*ZERO     WN0019  20       PFS Load Total
     C                     Z-ADD*ZERO     WN0020  50       PFS Load Total
     C                     Z-ADD*ZERO     WN0021  52       PFS Reefer Temp
     C                     MOVEL*BLANK    WN0022  1        PFS Reefer Temp
     C                     Z-ADD*ZERO     WN0023  80       PFS Load Sched
     C                     Z-ADD*ZERO     WN0024  60       PFS Load Sched
     C                     Z-ADD*ZERO     WN0025  80       PFS Load Deadli
     C                     Z-ADD*ZERO     WN0026  60       PFS Load Deadli
     C                     Z-ADD*ZERO     WN0027  82       PFS Maximum Loa
     C                     MOVEL*BLANK    WN0028 20        PFS Federal Tax
     C                     Z-ADD*ZERO     WN0029  50       PFS Estimated P
     C                     Z-ADD*ZERO     WN0030  52       PFS Average Pal
     C                     Z-ADD*ZERO     WN0031  82       PFS Predicted L
     C                     MOVEL*BLANK    WN0032  1        PFS Load Status
     C                     MOVEL*BLANK    WN0033 20        PFS Trailer Id
     C                     Z-ADD*ZERO     WN0034  90       PFS Sequence No
     C                     MOVEL*BLANK    WN0035  1        PFS Load Unused
     C                     MOVEL*BLANK    WN0036  1        PFS Load Unused
     C                     MOVEL*BLANK    WN0037  1        PFS Load Unused
     C                     MOVEL*BLANK    WN0038  2        PFS Load Unused
     C                     MOVEL*BLANK    WN0039  2        PFS Load Unused
     C                     MOVEL*BLANK    WN0040 15        PFS Load Unused
     C                     MOVEL*BLANK    WN0041  1        PFS Record Stat
     C                     MOVEL*BLANK    WN0042  6        PFS Error Reaso
     C                     Z-ADD*ZERO     WN0043  80       PFS Create Date
     C                     Z-ADD*ZERO     WN0044  60       PFS Create Time
     C                     Z-ADD*ZERO     WN0045  80       PFS Change Date
     C                     Z-ADD*ZERO     WN0046  60       PFS Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BACPZI
     C                     Z-ADDWAY1NX    WCY1NX           PFS Company Num
     C                     Z-ADDWAZGNX    WCZGNX           PFS Load ID
      *
     C           KLCHSC    KLIST
     C                     KFLD           WCY1NX           PFS Company Num
     C                     KFLD           WCZGNX           PFS Load ID
     C           KLCHSC    CHAIN@BACPZI              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PPBACPL0'MDACP
     C                     MOVEL'@BACPZI' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPPBA2    YARDCS
      * Move non-key fields to @BACPZI
     C                     Z-ADD1         WCUXSX           PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C           QPPBA2    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BACPZI                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPPBACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2Y1NX           PFS Company Num
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WAAWNY           PFS Sched Seque
     C                     Z-ADD*ZERO     WAZMNX           PFS Load Total
     C                     Z-ADD*ZERO     WAZNNX           PFS Load Total
     C                     Z-ADD*ZERO     WAZONX           PFS Reefer Temp
     C                     Z-ADD*ZERO     WAZHNX           PFS Load Sched
     C                     Z-ADD*ZERO     WAZINX           PFS Load Sched
     C                     Z-ADD*ZERO     WAZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WAZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WABLNY           PFS Maximum Loa
     C                     Z-ADD*ZERO     WABKNY           PFS Estimated P
     C                     Z-ADD*ZERO     WAATNY           PFS Average Pal
     C                     Z-ADD*ZERO     WAB4NY           PFS Predicted L
     C                     Z-ADD*ZERO     WAF5NY           PFS Sequence No
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
