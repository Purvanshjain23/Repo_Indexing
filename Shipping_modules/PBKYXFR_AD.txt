// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBKYXFR
// ?Date: 14.08.2025 Time: 03:48:20
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?DDSDDL RMC 05/17/22 - RENAMED PDIORELI TO PDIORELK
//?E3796 JJH 02/26/15 - Requested Ship Date for Production Schedule
//?Accidentally changed parms on this screen and acess path.  So reset
//?back to original and recompiled.  No logic changes.
ENDDO;

EXECUTE FUNCTION(RTV Cur Wk Held-Cnsmd  RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC2078543;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Consumed_Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(*MISSING);
PARAMETER(PAR.Week_End_Date);
PARAMETER(PAR.Next_Production_Day_Usr);
PARAMETER(PAR.Quantity_on_Hold_USR);
PARAMETER(PAR.Weight_Total_Need_USR);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Processing if Data record not found

 QUIT;

 //?USER: Process Data record

 //?New code - for BXs end at Monday Date, for CB End at Week End date
 CASE;

 // IF DB1.Scheduled Ship Date GT PAR.Next Production Day Usr
 IF DB1.Scheduled_Ship_Date > PAR.Next_Production_Day_Usr;

 QUIT;

 //?New code - for BXs end at Monday Date, for CB End at Week End date
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?For Boxes - include orders to Next Prod Date, which is monday
 CASE;

 // IF DB1.U/M - Ordered is EQ Boxes
 IF DB1.U_M_Ordered = 'BX';

 // AND DB1.Scheduled Ship Date LE PAR.Next Production Day Usr
 AND DB1.Scheduled_Ship_Date <= PAR.Next_Production_Day_Usr;

 CASE;

 // IF DB1.Detail Line Status is Avail/Entered/Held
 IF DB1.Detail_Line_Status = 'A'/'E'/'H';

 // Compute:Qty on hold
 PAR.Quantity_on_Hold_USR = ( DB1.Quantity_Ordered - DB1.Quantity_Scheduled )
 + PAR.Quantity_on_Hold_USR;

 //?IF Base item is the item, then use 100% prod yield, else get prod yield
 CASE;

 // IF DB1.Item Code EQ PAR.Consumed Item Code
 IF DB1.Item_Code = PAR.Consumed_Item_Code;

 // LCL.Production Yield = CON.100
 LCL.Production_Yield = 100;

 //?IF Base item is the item, then use 100% prod yield, else get prod yield
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Rtv Item PrdYCns SWYG RT) TYPE(RTVOBJ) FILE(PDIOREP)           AC2078563;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.Production_Yield);
 PARAMETER(LCL.Record_Found_USR);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Processing if Data record not found

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  // PAR.Production Yield = PAR.Production Yield + DB1.Production Yield
  PAR.Production_Yield = PAR.Production_Yield + DB1.Production_Yield;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

 }

 ENDIF;

 // Compute:Wgt on hold
 LCL.Start_Weight = ( DB1.Weight_Ordered - DB1.Weight_Scheduled ) * (
 LCL.Production_Yield / 100 );

 // PAR.Weight Total Need USR = PAR.Weight Total Need USR + LCL.Start Weight
 PAR.Weight_Total_Need_USR = PAR.Weight_Total_Need_USR + LCL.Start_Weight;

 ENDIF;

 ENDIF;

 //?For Combo - include orders to Week End Date which is sunday
 CASE;

 // IF DB1.U/M - Ordered is Combos
 IF DB1.U_M_Ordered = 'CB';

 // AND DB1.Scheduled Ship Date LE PAR.Week End Date
 AND DB1.Scheduled_Ship_Date <= PAR.Week_End_Date;

 CASE;

 // IF DB1.Detail Line Status is Avail/Entered/Held
 IF DB1.Detail_Line_Status = 'A'/'E'/'H';

 // Compute:Qty on hold
 PAR.Quantity_on_Hold_USR = ( DB1.Quantity_Ordered - DB1.Quantity_Scheduled )
 + PAR.Quantity_on_Hold_USR;

 //?IF Base item is the item, then use 100% prod yield, else get prod yield
 CASE;

 // IF DB1.Item Code EQ PAR.Consumed Item Code
 IF DB1.Item_Code = PAR.Consumed_Item_Code;

 // LCL.Production Yield = CON.100
 LCL.Production_Yield = 100;

 //?IF Base item is the item, then use 100% prod yield, else get prod yield
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Rtv Item PrdYCns SWYG RT) TYPE(RTVOBJ) FILE(PDIOREP)           AC2078563;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.Production_Yield);
 PARAMETER(LCL.Record_Found_USR);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Processing if Data record not found

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  // PAR.Production Yield = PAR.Production Yield + DB1.Production Yield
  PAR.Production_Yield = PAR.Production_Yield + DB1.Production_Yield;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

 }

 ENDIF;

 // Compute:Wgt on hold
 LCL.Start_Weight = ( DB1.Weight_Ordered - DB1.Weight_Scheduled ) * (
 LCL.Production_Yield / 100 );

 // PAR.Weight Total Need USR = PAR.Weight Total Need USR + LCL.Start Weight
 PAR.Weight_Total_Need_USR = PAR.Weight_Total_Need_USR + LCL.Start_Weight;

 ENDIF;

 ENDIF;

 ENDIF;

}


