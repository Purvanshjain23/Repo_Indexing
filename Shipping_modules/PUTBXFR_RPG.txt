     H/TITLE Rtv EDI Manual PO Sts XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISJBADE
     H* Date          : 08/24/21  Time  : 08:50:08
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOPBFCPL1IF  E           K        DISK
      * RTV : Order Header TRG          Retrieval index       NV
      *
     FPNGQREL1IF  E           K        DISK
      * RTV : EDI Bill To Interchange   Retrieval index
      *
     FECP004L9IF  E           K        DISK
      * RSQ : EDI Purchase Order Header Trade Part/PO#/OrdDte (d
      *
     E                    YDOW        7  1               *Days of week
     I@BECPFK
      * Order Header TRG          Retrieval index       NV
      * Renamed input format fields
     I              BEAIC3                          WAAIC3
     I              BEC4NB                          WAC4NB
     I              BEJNCD                          WAJNCD
     I              BEANC7                          WAANC7
     I              BEBKC7                          WABKC7
     I              BEBRTX                          WABRTX
     I              BEHMNA                          WAHMNA
     I              BEHONA                          WAHONA
     I              BEHPNA                          WAHPNA
     I              BEHNNA                          WAHNNA
     I              BEDBCD                          WADBCD
     I              BECKTX                          WACKTX
     I              BEB0C7                          WAB0C7
     I              BEAETX                          WAAETX
     I              BEB1NA                          WAB1NA
     I              BEB3NA                          WAB3NA
     I              BEB4NA                          WAB4NA
     I              BEB2NA                          WAB2NA
     I              BEBHCD                          WABHCD
     I              BEC8TX                          WAC8TX
     I              BEBCNA                          WABCNA
     I              BEA0DT                          WAA0DT
     I              BEA5DT                          WAA5DT
     I              BEGNDT                          WAGNDT
     I              BEACDT                          WAACDT
     I              BEAQCD                          WAAQCD
     I              BEB6NA                          WAB6NA
     I              BEBYNA                          WABYNA
     I              BEBZNA                          WABZNA
     I              BEGTST                          WAGTST
     I              BEGVST                          WAGVST
     I              BEGUST                          WAGUST
     I              BEQFST                          WAQFST
     I              BECQCD                          WACQCD
     I              BEGJST                          WAGJST
     I              BEGWST                          WAGWST
     I              BEGXST                          WAGXST
     I              BEGYST                          WAGYST
     I              BEAODT                          WAAODT
     I              BEAIVN                          WAAIVN
     I              BECXDT                          WACXDT
     I              BEJZVA                          WAJZVA
     I              BEA1WG                          WAA1WG
     I              BEXIST                          WAXIST
     I              BEXJST                          WAXJST
     I              BEXKST                          WAXKST
     I              BEEIDT                          WAEIDT
     I              BEAFTM                          WAAFTM
     I              BEE8CD                          WAE8CD
     I              BEE9CD                          WAE9CD
     I              BERMNB                          WARMNB
     I              BETBNB                          WATBNB
     I              BER1NB                          WAR1NB
     I              BEPJST                          WAPJST
     I              BEU0ST                          WAU0ST
     I              BEU1ST                          WAU1ST
     I              BEQ2CD                          WAQ2CD
     I              BEU2ST                          WAU2ST
     I              BEVEST                          WAVEST
     I              BEVFST                          WAVFST
     I              BEVGST                          WAVGST
     I              BERPCD                          WARPCD
     I              BERNNB                          WARNNB
     I              BEVDST                          WAVDST
     I              BEATIN                          WAATIN
     I              BEU4ST                          WAU4ST
     I              BEU5ST                          WAU5ST
     I              BERSRN                          WARSRN
     I              BEMHNA                          WAMHNA
     I              BEMINA                          WAMINA
     I              BEWBST                          WAWBST
     I              BER4CD                          WAR4CD
     I              BEBFCD                          WABFCD
     I              BEQ4CD                          WAQ4CD
     I              BET3NB                          WAT3NB
     I              BESICD                          WASICD
     I              BECONB                          WACONB
     I              BECEST                          WACEST
     I              BEAWDT                          WAAWDT
     I              BEJPCD                          WAJPCD
     I              BEXUST                          WAXUST
     I              BEZ1ST                          WAZ1ST
     I              BEVRVA                          WAVRVA
     I              BEOBST                          WAOBST
     I              BEBCST                          WABCST
     I              BEBDST                          WABDST
     I              BEB7VL                          WAB7VL
     I              BEGASX                          WAGASX
     I              BEGBSX                          WAGBSX
     I              BEGCSX                          WAGCSX
     I              BEGDSX                          WAGDSX
     I              BEFNSX                          WAFNSX
     I              BEFOSX                          WAFOSX
     I              BEFPSX                          WAFPSX
     I              BEFQSX                          WAFQSX
     I              BEFRSX                          WAFRSX
     I              BEFSSX                          WAFSSX
     I              BEFTSX                          WAFTSX
     I              BEFUSX                          WAFUSX
     I              BEFVSX                          WAFVSX
     I              BEFWSX                          WAFWSX
     I              BEFXSX                          WAFXSX
     I              BEFYSX                          WAFYSX
     I              BENODT                          WANODT
     I              BENPDT                          WANPDT
     I              BENQDT                          WANQDT
     I              BENRDT                          WANRDT
     I              BENSDT                          WANSDT
     I              BEBPTM                          WABPTM
     I              BEBQTM                          WABQTM
     I              BEBRTM                          WABRTM
     I              BEBSTM                          WABSTM
     I              BEBTTM                          WABTTM
     I              BEH0NX                          WAH0NX
     I              BEH1NX                          WAH1NX
     I              BEH2NX                          WAH2NX
     I              BEH3NX                          WAH3NX
     I              BEH4NX                          WAH4NX
     I              BEC0C7                          WAC0C7
     I              BEUVST                          WAUVST
     I              BEUWST                          WAUWST
     I              BEUXST                          WAUXST
     I              BEAATM                          WAAATM
     I              BEAYNA                          WAAYNA
     I              BEA0NA                          WAA0NA
     I              BEAXDT                          WAAXDT
      *
     I@GQREH2
      * EDI Bill To Interchange   Retrieval index
      * Renamed input format fields
     I              GQB0C7                          WBB0C7
     I              GQM4AA                          WBM4AA
     I              GQM7AA                          WBM7AA
     I              GQJ5NX                          WBJ5NX
     I              GQA8U1                          WBA8U1
     I              GQA9U1                          WBA9U1
     I              GQBAU1                          WBBAU1
     I              GQBBU1                          WBBBU1
     I              GQY4NY                          WBY4NY
     I              GQY5NY                          WBY5NY
     I              GQBFU1                          WBBFU1
     I              GQBGU1                          WBBGU1
     I              GQBHU1                          WBBHU1
     I              GQBIU1                          WBBIU1
     I              GQSIAA                          WBSIAA
     I              GQSJAA                          WBSJAA
     I              GQVSST                          WBVSST
     I              GQMJDT                          WBMJDT
     I              GQBETM                          WBBETM
     I              GQCCVN                          WBCCVN
     I              GQCDVN                          WBCDVN
     I              GQMKDT                          WBMKDT
     I              GQBFTM                          WBBFTM
     I              GQCEVN                          WBCEVN
     I              GQCFVN                          WBCFVN
      *
     I@P004H8
      * EDI Purchase Order Header Trade Part/PO#/OrdDte (d
      * Renamed input format fields
     I              BQTSCN                          WCTSCN
     I              BQL3SX                          WCL3SX
     I              BQOSDT                          WCOSDT
     I              BQPONO                          WCPONO
     I              BQDKAA                          WCDKAA
     I              BQNAME                          WCNAME
     I              BQCQLF                          WCCQLF
     I              BQCNUM                          WCCNUM
     I              BQINRF                          WCINRF
     I              BQGNTX                          WCGNTX
     I              BQHUAA                          WCHUAA
     I              BQHUVL                          WCHUVL
     I              BQHVAA                          WCHVAA
     I              BQX8T1                          WCX8T1
     I              BQJ2AA                          WCJ2AA
     I              BQT6DT                          WCT6DT
     I              BQQLFX                          WCQLFX
     I              BQDELV                          WCDELV
     I              BQSHMT                          WCSHMT
     I              BQMTTY                          WCMTTY
     I              BQPLEX                          WCPLEX
     I              BQLDOP                          WCLDOP
     I              BQROUT                          WCROUT
     I              BQFOBP                          WCFOBP
     I              BQD3VL                          WCD3VL
     I              BQUNIT                          WCUNIT
     I              BQD4VL                          WCD4VL
     I              BQAMTX                          WCAMTX
     I              BQDSTS                          WCDSTS
     I              BQSRAA                          WCSRAA
     I              BQBRU1                          WCBRU1
     I              BQSSAA                          WCSSAA
     I              BQBSU1                          WCBSU1
     I              BQSTAA                          WCSTAA
     I              BQBTU1                          WCBTU1
     I              BQSUAA                          WCSUAA
     I              BQBUU1                          WCBUU1
     I              BQSVAA                          WCSVAA
     I              BQBVU1                          WCBVU1
     I              BQSWAA                          WCSWAA
     I              BQBWU1                          WCBWU1
     I              BQSXAA                          WCSXAA
     I              BQBXU1                          WCBXU1
     I              BQYDT1                          WCYDT1
     I              BQNLST                          WCNLST
     I              BQUFDT                          WCUFDT
     I              BQOJAA                          WCOJAA
     I              BQJ5NX                          WCJ5NX
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Header TRG
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Order Number
     I                                    P   3   60P1C4NB
     IP2PARM      DS
      * FLD: EDI Bill To Interchange
      * I :  Interchange Code
     I                                        1   6 P2M4AA
     IP3PARM      DS
      * O :  Send EDI Document Y/N
     I                                        1   1 P3L6SC
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P2M4AA    PARM           WP0003  6        Interchange Cod
     C           P3L6SC    PARM P3L6SC    WP0004  1        Send EDI Docume
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Rtv EDI Manual PO Sts XF
      * Modification history
     C                     EXSR UASUBR                     Modification hi
      * RTV All Fields         RT - Order Header TRG  * BillTo/PO/Order D
     C                     EXSR SARVGN
      * Rtv Don't Send Mnl PO RT - EDI Bill To Interchange  * TradePart/D
     C                     EXSR SBRVGN
      * Determine value for output parm Send EDI Document Y/N
      * CASE: Do not Send for Manual PO = N or is blank
      *  - c1 OR c2
      *   |- c1    : LCL.Do not Send for Manual PO is Send the Document (
      *   |- c2    : LCL.Do not Send for Manual PO is Send the Document (
      *   '-
     C           YL0005    IFEQ *BLANK                     *IF
     C           YL0005    OREQ 'N'                        *OR
     C                     MOVEL'Y'       P3L6SC           Send EDI Docume
     C                     GOTO AAEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * Rtv Send EDI Docs Y/N RT - EDI Purchase Order Header  * ECP004L9
     C                     EXSR SCRVGN
     C                     GOTO AAEXIT                     *QUIT
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV All Fields         RT - Order Header TRG  * BillTo/PO/Order
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
      * Setup key
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1C4NB    WAC4NB           Order Number
      * Establish starting position
     C           KRSSA     CHAIN@BECPFK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           Bill to Custome
     C                     MOVEL*BLANK    YL0002           Customer Purcha
     C                     Z-ADD*ZERO     YL0003           Order Date
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAB0C7    YL0001           Bill to Custome
     C                     MOVELWABCNA    YL0002           Customer Purcha
     C                     Z-ADDWAA0DT    YL0003           Order Date
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Don't Send Mnl PO RT - EDI Bill To Interchange  * TradePart/
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBB0C7           Bill to Custome
     C                     KFLD           WBM4AA           Interchange Cod
      * Setup key
     C                     Z-ADDYL0001    WBB0C7           Bill to Custome
     C                     MOVELP2M4AA    WBM4AA           Interchange Cod
      * Establish starting position
     C           KRSSB     CHAIN@GQREH2              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4373' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0004           EDI Trading Par
     C                     MOVEL*BLANK    YL0005           Do not Send for
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBJ5NX    YL0004           EDI Trading Par
     C                     MOVELWBSJAA    YL0005           Do not Send for
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Send EDI Docs Y/N RT - EDI Purchase Order Header  * ECP004L9
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Determine +/- 5 days based on the Order Header-Order Date
      * LCL.Date Range High = PAR.Order Date + CON.5 *DAYS
     C           YL0003    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD5         XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     YL0006
     C                     ELSE
     C           XDINDT    SUB  1000000   YL0006
     C                     END
      * LCL.Date Range Low = PAR.Order Date + CON.-5 *DAYS
     C           YL0003    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD-5        XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     YL0007
     C                     ELSE
     C           XDINDT    SUB  1000000   YL0007
     C                     END
      * Default Send EDI Documents flag to No
     C                     MOVEL'N'       P3L6SC           Send EDI Docume
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCJ5NX    WQSC01           EDI Trading Par
     C           *LIKE     DEFN WCPONO    WQSC02           G5003-PURCHASE
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           EDI Trading Par
     C                     KFLD           WQSC02           G5003-PURCHASE
      * Setup key
     C                     MOVELYL0004    WQSC01           EDI Trading Par
     C                     MOVELYL0002    WQSC02           G5003-PURCHASE
      * Establish starting position
     C           KRSSC     SETLL@P004H8                    *
     C           KRSSC     READE@P004H8                  90*
      * Data record not found
     C   90                MOVEL'USR3103' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Check if ECP004L9 Order Date within Order Date Range
      * CASE: Order Date <= Date High AND >= Date Low
      *  - c1 AND c2
      *   |- c1    : DB1.G5002-ORDER DATE LE LCL.Date Range High
      *   |- c2    : DB1.G5002-ORDER DATE GE LCL.Date Range Low
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WCOSDT    IFLE YL0006                     *IF
     C           WCOSDT    IFGE YL0007                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       P3L6SC           Send EDI Docume
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSC     READE@P004H8                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modification history
      *================================================================
      *  7/07/2021 JBB SDN657 - Trading Partner Controls for Outbound Doc
      *                         Function created.  Retrieve the 'Do not
      *                         Send Manual PO' value to set the 'Send ED
      *                         Document Y/N' flag back to the calling
      *                         program for Order and Interchange Code.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         XCVFA     BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C           XDAY1     IFGT 109267
     C                     ADD  2         XDAY1
     C                     ELSE
     C           XDAY1     IFGT 36218
     C                     ADD  1         XDAY1
     C                     END
     C                     END
      * Full years (up to the date)
     C           XDAY1     DIV  365.25    XDWK1   80
     C                     MVR            XDWK3   71
     C                     Z-ADDXDWK1     XDINYY
     C           XDWK3     IFEQ 0
      * The date is the end of a year
     C                     Z-ADD12        XDINMM
     C                     Z-ADD31        XDINDD
     C                     ELSE
      * Year days up to the date
     C           XDWK1     MULT 365.25    XDWK2   60
     C                     SUB  XDWK2     XDAY1
     C                     ADD  1         XDINYY
      * Leap year ?
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
      * March 1 (relative day of the year)
     C           XDWK1     IFEQ 0
     C                     Z-ADD60        XDWK1
     C                     ELSE
     C                     Z-ADD59        XDWK1
     C                     END
      * Define date base month and offset day -
     C           XDAY1     IFLE XDWK1
      *  - January (thru February)
     C                     Z-ADD1         XDINMM
     C                     ELSE
     C                     SUB  XDWK1     XDAY1
     C           XDAY1     IFLE 153
      *  - March (thru July)
     C                     Z-ADD3         XDINMM
     C                     ELSE
      *  - August (thru December)
     C                     Z-ADD8         XDINMM
     C                     SUB  153       XDAY1
     C                     END
      * Calculate 2 month base and offset day
     C           XDAY1     SUB  1         XDWK1
     C                     DIV  61        XDWK1
     C                     MVR            XDAY1
     C                     ADD  1         XDAY1
     C                     MULT 2         XDWK1
     C                     ADD  XDWK1     XDINMM
     C                     END
      * Calculate date increment,
     C           XDAY1     IFGT 31
     C                     ADD  1         XDINMM
     C                     SUB  31        XDAY1
     C                     END
     C                     Z-ADDXDAY1     XDINDD
     C                     END
      *================================================================
     CSR         XCVFAE    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDADY     BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C           XDURR     IFEQ 0
     C           XDWSL     OREQ 0
      * None days of week selected
     C                     Z-ADDXDAY2     XDAY1
     C           XDURR     IFNE *ZERO
      * Return Code: Unable to increment date.
     C                     MOVEL'Y2U0059' W0RTN   7
     C                     ENDIF
     C                     GOTO XDADYE
     C                     ENDIF
     C           XDWSL     IFEQ 7
      * All days of week selected
     C           XDAY2     ADD  XDURR     XDAY1
     C                     GOTO XDADYM
     C                     ENDIF
      * Some days of week selected
     C           XDURR     IFGE 0
     C                     Z-ADD1         XDSTP   10
     C                     ELSE
     C                     Z-ADD-1        XDSTP
     C                     ENDIF
      * Get number of full weeks in the duration
     C           XDURR     DIV  XDWSL     XDWNB   60
      * Isolate the last week
     C                     MVR            XDLSW   10
     C           XDLSW     IFEQ 0
     C           XDWSL     MULT XDSTP     XDLSW
     C                     SUB  XDSTP     XDWNB
     C                     ENDIF
      * Increment the date by the full weeks
     C           XDWNB     MULT 7         XDWK1   80
     C           XDAY2     ADD  XDWK1     XDAY1   60
      * Determine day of week of the beginning date
     C           XDAY2     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ENDIF
      * Loop: Increment the date by the last week
     C           XDLSW     DOWNE0
      * Increment the date
     C                     ADD  XDSTP     XDAY1
      * Increment the day of week
     C                     ADD  XDSTP     YY
      * Put day of week into the range 1-7
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ELSE
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     ELSE
     C           YY        IFEQ -1
     C                     Z-ADD6         YY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           YDOW,YY   IFEQ XDSEL
      * Selected day of the last week has been processed
     C                     SUB  XDSTP     XDLSW
     C                     ENDIF
      * End of loop
     C                     ENDDO
     C           XDADYM    TAG
     C           XDINDD    IFLT 1
     C                     Z-ADD1         XDINDD
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         XDADYE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WACXDT           Date of Origina
     C                     Z-ADD*ZERO     WAJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WAA1WG           Order Weight To
     C                     Z-ADD*ZERO     WAEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WAAFTM           Requested Deliv
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WARNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAVRVA           A/R order Value
     C                     Z-ADD*ZERO     WAB7VL           Invoice Order V
     C                     Z-ADD*ZERO     WANODT           OH Appt Confirm
     C                     Z-ADD*ZERO     WANPDT           JPN Invoice Iss
     C                     Z-ADD*ZERO     WANQDT           Load Actual Shi
     C                     Z-ADD*ZERO     WANRDT           Load BOL Comple
     C                     Z-ADD*ZERO     WANSDT           Load Truck Depa
     C                     Z-ADD*ZERO     WABPTM           Maximum Gross W
     C                     Z-ADD*ZERO     WABQTM           Time of Origina
     C                     Z-ADD*ZERO     WABRTM           OH Appt Confirm
     C                     Z-ADD*ZERO     WABSTM           Load BOL Comple
     C                     Z-ADD*ZERO     WABTTM           Load Truck Depa
     C                     Z-ADD*ZERO     WAH0NX           Act Frt Referen
     C                     Z-ADD*ZERO     WAH1NX           Act Non-Ref Frt
     C                     Z-ADD*ZERO     WAH2NX           OH Fuel Surchar
     C                     Z-ADD*ZERO     WAH3NX           OH Total Non-Re
     C                     Z-ADD*ZERO     WAH4NX           OH Total Ref Fr
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WBY4NY           EDI Alt ST Cust
     C                     Z-ADD*ZERO     WBY5NY           EDI unused nbr
     C                     Z-ADD*ZERO     WBMJDT           Create Date
     C                     Z-ADD*ZERO     WBBETM           Create Time
     C                     Z-ADD*ZERO     WBMKDT           Change Date
     C                     Z-ADD*ZERO     WBBFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCTSCN           ST02-TRANS SET
     C                     Z-ADD*ZERO     WCOSDT           G5002-ORDER DAT
     C                     Z-ADD*ZERO     WCHUVL           SAC05-$$ AMT OF
     C                     Z-ADD*ZERO     WCT6DT           G6202 Ship Date
     C                     Z-ADD*ZERO     WCDELV           G6202-DELIVERY
     C                     Z-ADD*ZERO     WCD3VL           G7601-QUANTITY
     C                     Z-ADD*ZERO     WCD4VL           G7603-WEIGHT OR
     C                     Z-ADD*ZERO     WCAMTX           G7608-ORDER AMO
     C                     Z-ADD*ZERO     WCUFDT           POH Date Stamp
     C                     MOVEL'N'       W0PMT   1
      * Define null work field Order Type - Sales
     C                     MOVEL*BLANK    YN0001  2
      * Define null work field A/R Customer Number
     C                     Z-ADD*ZERO     YN0002  70
      * Define null work field Ship To Customer
     C                     Z-ADD*ZERO     YN0003  70
      * Define null work field Ship To Name
     C                     MOVEL*BLANK    YN0004 30
      * Define null work field Ship To Address Line 1
     C                     MOVEL*BLANK    YN0005 30
      * Define null work field Ship To Address Line 2
     C                     MOVEL*BLANK    YN0006 30
      * Define null work field Ship To Address Line 3
     C                     MOVEL*BLANK    YN0007 30
      * Define null work field Ship To City
     C                     MOVEL*BLANK    YN0008 20
      * Define null work field Ship To State Code
     C                     MOVEL*BLANK    YN0009  2
      * Define null work field Ship To Zip/Postal Code
     C                     MOVEL*BLANK    YN0010 11
      * Define local work field Bill to Customer
     C                     Z-ADD*ZERO     YL0001  70
      * Define null work field Bill to Name
     C                     MOVEL*BLANK    YN0011 30
      * Define null work field Bill to Address Line 1
     C                     MOVEL*BLANK    YN0012 30
      * Define null work field Bill to Address Line 2
     C                     MOVEL*BLANK    YN0013 30
      * Define null work field Bill to Address Line 3
     C                     MOVEL*BLANK    YN0014 30
      * Define null work field Bill to City
     C                     MOVEL*BLANK    YN0015 20
      * Define null work field Bill to State Code
     C                     MOVEL*BLANK    YN0016  2
      * Define null work field Bill to Zip/Postal Code
     C                     MOVEL*BLANK    YN0017 11
      * Define local work field Customer Purchase Order #
     C                     MOVEL*BLANK    YL0002 15
      * Define local work field Order Date
     C                     Z-ADD*ZERO     YL0003  70
      * Define null work field Requested Ship Date
     C                     Z-ADD*ZERO     YN0018  70
      * Define null work field Actual Shipped Date
     C                     Z-ADD*ZERO     YN0019  70
      * Define null work field Cancel Date
     C                     Z-ADD*ZERO     YN0020  70
      * Define null work field Terms Code
     C                     MOVEL*BLANK    YN0021  2
      * Define null work field Special Instructions
     C                     MOVEL*BLANK    YN0022 40
      * Define null work field Special Instructions 2
     C                     MOVEL*BLANK    YN0023 40
      * Define null work field Carrier Code
     C                     MOVEL*BLANK    YN0024  3
      * Define null work field Comment Print Acknowledge
     C                     MOVEL*BLANK    YN0025  1
      * Define null work field Comment Print Inv/Cr.Memo
     C                     MOVEL*BLANK    YN0026  1
      * Define null work field Comment Print Pick Slip
     C                     MOVEL*BLANK    YN0027  1
      * Define null work field Comment Print Ship Doc
     C                     MOVEL*BLANK    YN0028  1
      * Define null work field Reason Code
     C                     MOVEL*BLANK    YN0029  3
      * Define null work field Order in Use
     C                     MOVEL*BLANK    YN0030  1
      * Define null work field Header Status
     C                     MOVEL*BLANK    YN0031  1
      * Define null work field Header Status Last
     C                     MOVEL*BLANK    YN0032  1
      * Define null work field Order Type Print Status
     C                     MOVEL*BLANK    YN0033  1
      * Define null work field Scheduled Ship Date
     C                     Z-ADD*ZERO     YN0034  70
      * Define null work field User Original Entry
     C                     MOVEL*BLANK    YN0035 10
      * Define null work field Date of Original Entry
     C                     Z-ADD*ZERO     YN0036  70
      * Define null work field Order Value Total
     C                     Z-ADD*ZERO     YN0037 112
      * Define null work field Order Weight Total
     C                     Z-ADD*ZERO     YN0038 112
      * Define null work field Credit Hold
     C                     MOVEL*BLANK    YN0039  1
      * Define null work field Production Hold
     C                     MOVEL*BLANK    YN0040  1
      * Define null work field New Customer Hold
     C                     MOVEL*BLANK    YN0041  1
      * Define null work field Requested Delivery Date
     C                     Z-ADD*ZERO     YN0042  70
      * Define null work field Requested Delivery Time
     C                     Z-ADD*ZERO     YN0043  40
      * Define null work field Accounts Receiv. Ent 1
     C                     MOVEL*BLANK    YN0044  4
      * Define null work field Accounts Receiv. Ent 2
     C                     MOVEL*BLANK    YN0045 12
      * Define null work field Load ID
     C                     Z-ADD*ZERO     YN0046  70
      * Define null work field Absorbed Freight Rate CWT
     C                     Z-ADD*ZERO     YN0047  52
      * Define null work field Rated Freight
     C                     Z-ADD*ZERO     YN0048 112
      * Define null work field LTL Flag
     C                     MOVEL*BLANK    YN0049  1
      * Define null work field Price Audit
     C                     MOVEL*BLANK    YN0050  1
      * Define null work field Price Status
     C                     MOVEL*BLANK    YN0051  1
      * Define null work field Shipping Method
     C                     MOVEL*BLANK    YN0052  2
      * Define null work field Export Status
     C                     MOVEL*BLANK    YN0053  1
      * Define null work field Palletize
     C                     MOVEL*BLANK    YN0054  1
      * Define null work field Shrink Wrap
     C                     MOVEL*BLANK    YN0055  1
      * Define null work field Slip Sheet
     C                     MOVEL*BLANK    YN0056  1
      * Define null work field Age Code
     C                     MOVEL*BLANK    YN0057  1
      * Define null work field Reefer Temperature
     C                     Z-ADD*ZERO     YN0058  52
      * Define null work field Load Type
     C                     MOVEL*BLANK    YN0059  1
      * Define null work field Attach to Invoice Number
     C                     Z-ADD*ZERO     YN0060  70
      * Define null work field Load Plan Order
     C                     MOVEL*BLANK    YN0061  1
      * Define null work field Print Pick Slip
     C                     MOVEL*BLANK    YN0062  1
      * Define null work field Resell Reference Number
     C                     Z-ADD*ZERO     YN0063  70
      * Define null work field Special Comment 1
     C                     MOVEL*BLANK    YN0064 30
      * Define null work field Special Comment 2
     C                     MOVEL*BLANK    YN0065 30
      * Define null work field Affect Auto Accruals
     C                     MOVEL*BLANK    YN0066  1
      * Define null work field Sales Route Code
     C                     MOVEL*BLANK    YN0067  3
      * Define null work field Manager Level Code
     C                     MOVEL*BLANK    YN0068  2
      * Define null work field VP Level Code
     C                     MOVEL*BLANK    YN0069  3
      * Define null work field Attach to Order Number
     C                     Z-ADD*ZERO     YN0070  70
      * Define null work field Reason for Price Audit
     C                     MOVEL*BLANK    YN0071  3
      * Define null work field Invoice Number
     C                     Z-ADD*ZERO     YN0072  70
      * Define null work field Invoice Suffix
     C                     MOVEL*BLANK    YN0073  2
      * Define null work field Invoice Date
     C                     Z-ADD*ZERO     YN0074  70
      * Define null work field Event Code
     C                     MOVEL*BLANK    YN0075  2
      * Define null work field Trans Contol AS400/Plant
     C                     MOVEL*BLANK    YN0076  1
      * Define null work field Modified Flag
     C                     MOVEL*BLANK    YN0077  1
      * Define null work field A/R order Value Total
     C                     Z-ADD*ZERO     YN0078 112
      * Define null work field Billing Activity Type
     C                     MOVEL*BLANK    YN0079  1
      * Define null work field Block Order Flag
     C                     MOVEL*BLANK    YN0080  1
      * Define null work field Order Certification Flag
     C                     MOVEL*BLANK    YN0081  1
      * Define null work field Invoice Order Value Tot
     C                     Z-ADD*ZERO     YN0082 112
      * Define null work field Process Sts for 3C
     C                     MOVEL*BLANK    YN0083  1
      * Define null work field Order Conf Fax Sts
     C                     MOVEL*BLANK    YN0084  1
      * Define null work field Manifest Fax Sts
     C                     MOVEL*BLANK    YN0085  1
      * Define null work field Invoice Fax Sts
     C                     MOVEL*BLANK    YN0086  1
      * Define null work field Transfer in Storage Ind
     C                     MOVEL*BLANK    YN0087  1
      * Define null work field Email Cust On Order Ship
     C                     MOVEL*BLANK    YN0088  1
      * Define null work field Order Emailed
     C                     MOVEL*BLANK    YN0089  1
      * Define null work field Export Docs Go w/Driver
     C                     MOVEL*BLANK    YN0090  1
      * Define null work field Shipping Temp Code C/F
     C                     MOVEL*BLANK    YN0091  1
      * Define null work field Broker Order Status
     C                     MOVEL*BLANK    YN0092  1
      * Define null work field Air Freight Order
     C                     MOVEL*BLANK    YN0093  1
      * Define null work field Order Requires Review
     C                     MOVEL*BLANK    YN0094  2
      * Define null work field OH Load Plan Ready
     C                     MOVEL*BLANK    YN0095  2
      * Define null work field Export USDA Approved
     C                     MOVEL*BLANK    YN0096  2
      * Define null work field HPB Ship to Warehouse
     C                     MOVEL*BLANK    YN0097  3
      * Define null work field OH TF Exempt Code
     C                     MOVEL*BLANK    YN0098  3
      * Define null work field OH Appt Confirmation Dt
     C                     Z-ADD*ZERO     YN0099  70
      * Define null work field JPN Invoice Issuance Date
     C                     Z-ADD*ZERO     YN0100  70
      * Define null work field Load Actual Shipped Date
     C                     Z-ADD*ZERO     YN0101  70
      * Define null work field Load BOL Complete Date
     C                     Z-ADD*ZERO     YN0102  70
      * Define null work field Load Truck Departure Date
     C                     Z-ADD*ZERO     YN0103  70
      * Define null work field Maximum Gross Weight
     C                     Z-ADD*ZERO     YN0104  60
      * Define null work field Time of Original Entry
     C                     Z-ADD*ZERO     YN0105  60
      * Define null work field OH Appt Confirmation Tm
     C                     Z-ADD*ZERO     YN0106  60
      * Define null work field Load BOL Complete Time
     C                     Z-ADD*ZERO     YN0107  60
      * Define null work field Load Truck Departure Time
     C                     Z-ADD*ZERO     YN0108  60
      * Define null work field Act Frt Reference Amount
     C                     Z-ADD*ZERO     YN0109 112
      * Define null work field Act Non-Ref Frt Amount
     C                     Z-ADD*ZERO     YN0110 112
      * Define null work field OH Fuel Surcharge Amount
     C                     Z-ADD*ZERO     YN0111 112
      * Define null work field OH Total Non-Ref Frt Amt
     C                     Z-ADD*ZERO     YN0112 112
      * Define null work field OH Total Ref Frt Amt
     C                     Z-ADD*ZERO     YN0113 112
      * Define null work field Claim Number
     C                     Z-ADD*ZERO     YN0114  70
      * Define null work field EDI Status 1
     C                     MOVEL*BLANK    YN0115  1
      * Define null work field EDI Status 2
     C                     MOVEL*BLANK    YN0116  1
      * Define null work field EDI Status 3
     C                     MOVEL*BLANK    YN0117  1
      * Define null work field Job Time
     C                     Z-ADD*ZERO     YN0118  60
      * Define null work field User Id
     C                     MOVEL*BLANK    YN0119 10
      * Define null work field Job Name
     C                     MOVEL*BLANK    YN0120 10
      * Define null work field Job Date
     C                     Z-ADD*ZERO     YN0121  70
      * Define local work field EDI Trading Partner No.
     C                     MOVEL*BLANK    YL0004  6
      * Define local work field Do not Send for Manual PO
     C                     MOVEL*BLANK    YL0005  3
      * Define local work field Date Range High
     C                     Z-ADD*ZERO     YL0006  70
      * Define local work field Date Range Low
     C                     Z-ADD*ZERO     YL0007  70
      *================================================================
     CSR         ZZEXIT    ENDSR
