/*********************************************************************/
/* PROGRAM    : PPW6UPC                                              */
/* TITLE      : GENERIC PROGRAM TO EXECUTE THE ESNDMAIL COMMAND      */
/* DATE       : 02/20/2006                                           */
/* Description: EXECUTE THE ESNDNMAIL COMMAND, ADD AND REMOVE THE    */
/*                ESEND LIBRARY, MONITOR FOR ERRORS, SEND A          */
/*                MESSAGE OF UP TO 256 CHARACTERS                    */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &EADDRESS   EMAIL ADDRESS TO SEND TO                     */
/*    I     &ESUBJECT   EMAIL SUBJECT                                */
/*    I     &EMESSAGE   MESSAGE TO SEND                              */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*                                                                   */
/*********************************************************************/
 PPW6UPC:    PGM        PARM(&RETURN &EADDRESS &ESUBJECT &EMESSAGE)

/*-------------------------------------------------------------------*/
/* Declare Variables                                                 */
/*-------------------------------------------------------------------*/
             DCL        VAR(&RETURN)   TYPE(*CHAR) LEN(7)
             DCL        VAR(&EADDRESS) TYPE(*CHAR) LEN(50)
             DCL        VAR(&ESUBJECT) TYPE(*CHAR) LEN(60)
             DCL        VAR(&EMESSAGE) TYPE(*CHAR) LEN(256)

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

/*-------------------------------------------------------------------*/
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ADDLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF2103 CPF9999)


             ESNDMAIL   RECIPIENT(&EADDRESS) SUBJECT(&ESUBJECT) +
                          MSG(&EMESSAGE)
             MONMSG     MSGID(CPF9999 EML9999 CPF0000 EML0000) +
                          EXEC(GOTO CMDLBL(MSGTRAP))

             CHGVAR     VAR(&MSG2) VALUE('EMAIL sent to' *BCAT +
                          &EADDRESS *BCAT '-' *BCAT &EMESSAGE)
             SNDPGRMSG  TOPGR(SEABOARD) MSG(&MSG2)

MONMSG     MSGID(CPF0000)

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    SNDMSG     MSG('ERROR IN ESNDMAIL FOR ' *CAT &EMESSAGE +
                          *BCAT 'in program PPW6UPC') TOUSR(SEABOARD)
             CHGJOB     LOG(4 0 *SECLVL)


 ENDPGM:     RMVLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF0000)

             ENDPGM
