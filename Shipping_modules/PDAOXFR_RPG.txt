     H/TITLE DSP Control Chg Log    XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 08/19/16  Time  : 09:48:07
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCAADREL9IF  E           K        DISK
      * RSQ : Warehouse                 ShipCo/Warehouse
      *
     FCAABREL3IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       NV
      *
     FPDLHCPL5IF  E           K        DISK
      * RSQ : Load Order Change Log     Type/Load ID/D/T/S
      *
     FPDLHCPL3IF  E           K        DISK
      * RSQ : Load Order Change Log     Ld ID,Typ,Dte/Time/Se
      *
     FOMFJCPLGIF  E           K        DISK
      * RSQ : Load Header               SchShp,Seq,Ld/Unaccep
      *
     E                    #L3         3  1
      * Long constants
     E                    @CN#    1  03  6   @CN    25
     I@DRRETH
      * User Profile Control      Retrieval index       NV
      * Renamed input format fields
     I              DRAJVN                          WAAJVN
     I              DRAUNA                          WAAUNA
     I              DRB8NA                          WAB8NA
     I              DRAHVN                          WAAHVN
     I              DRI6ST                          WAI6ST
     I              DRI7ST                          WAI7ST
     I              DRXMST                          WAXMST
     I              DRXNST                          WAXNST
     I              DRI8ST                          WAI8ST
     I              DRNLNB                          WANLNB
     I              DRMPNA                          WAMPNA
     I              DRBCCD                          WABCCD
     I              DRAIC3                          WAAIC3
     I              DRDQCD                          WADQCD
     I              DRDRCD                          WADRCD
     I              DRAJCD                          WAAJCD
     I              DRBUVN                          WABUVN
     I              DRUVST                          WAUVST
     I              DRUWST                          WAUWST
     I              DRUXST                          WAUXST
     I              DRAATM                          WAAATM
     I              DRAYNA                          WAAYNA
     I              DRA0NA                          WAA0NA
     I              DRAXDT                          WAAXDT
      *
     I@DTRETE
      * User Application Profile  Retrieval index       NV
      * Renamed input format fields
     I              DTAJVN                          WBAJVN
     I              DTDNCD                          WBDNCD
     I              DTAIC3                          WBAIC3
     I              DTDQCD                          WBDQCD
     I              DTDRCD                          WBDRCD
     I              DTAJCD                          WBAJCD
     I              DTJFST                          WBJFST
     I              DTUVST                          WBUVST
     I              DTUWST                          WBUWST
     I              DTUXST                          WBUXST
     I              DTAATM                          WBAATM
     I              DTAYNA                          WBAYNA
     I              DTA0NA                          WBA0NA
     I              DTAXDT                          WBAXDT
      *
     I@ADREWA
      * Warehouse                 ShipCo/Warehouse
      * Renamed input format fields
     I              ADAJCD                          WCAJCD
     I              ADF8NA                          WCF8NA
     I              ADACNA                          WCACNA
     I              ADADNA                          WCADNA
     I              ADAENA                          WCAENA
     I              ADAJNA                          WCAJNA
     I              ADBTTX                          WCBTTX
     I              ADAOCD                          WCAOCD
     I              ADBGCD                          WCBGCD
     I              ADVHST                          WCVHST
     I              ADMPNA                          WCMPNA
     I              ADWPST                          WCWPST
     I              ADXUST                          WCXUST
     I              ADT0ST                          WCT0ST
     I              ADT1ST                          WCT1ST
     I              ADDBNB                          WCDBNB
     I              ADT2ST                          WCT2ST
     I              ADT3ST                          WCT3ST
     I              ADT4ST                          WCT4ST
     I              ADT6ST                          WCT6ST
     I              ADBWC3                          WCBWC3
     I              ADBTC3                          WCBTC3
     I              ADBUC3                          WCBUC3
     I              ADBVC3                          WCBVC3
     I              ADFCAA                          WCFCAA
     I              ADRQSX                          WCRQSX
     I              ADRRSX                          WCRRSX
     I              ADRSSX                          WCRSSX
     I              ADRTSX                          WCRTSX
     I              ADT7ST                          WCT7ST
     I              ADT8ST                          WCT8ST
     I              ADRNSX                          WCRNSX
     I              ADROSX                          WCROSX
     I              ADRPSX                          WCRPSX
     I              ADUVST                          WCUVST
     I              ADUWST                          WCUWST
     I              ADUXST                          WCUXST
     I              ADVSST                          WCVSST
     I              ADAATM                          WCAATM
     I              ADAYNA                          WCAYNA
     I              ADA0NA                          WCA0NA
     I              ADAXDT                          WCAXDT
      *
     I@ABREG3
      * Company Name and Address  Retrieval index       NV
      * Renamed input format fields
     I              ABAIC3                          WDAIC3
     I              ABADTX                          WDADTX
     I              ABACNA                          WDACNA
     I              ABADNA                          WDADNA
     I              ABAENA                          WDAENA
     I              ABAJNA                          WDAJNA
     I              ABBTTX                          WDBTTX
     I              ABBVTX                          WDBVTX
     I              ABBWTX                          WDBWTX
     I              ABA2NA                          WDA2NA
     I              ABABTX                          WDABTX
     I              ABBGCD                          WDBGCD
     I              ABKXCD                          WDKXCD
     I              ABUVST                          WDUVST
     I              ABUWST                          WDUWST
     I              ABUXST                          WDUXST
     I              ABVSST                          WDVSST
     I              ABAATM                          WDAATM
     I              ABAYNA                          WDAYNA
     I              ABA0NA                          WDA0NA
     I              ABAXDT                          WDAXDT
      *
     I@LHCPO6
      * Load Order Change Log     Type/Load ID/D/T/S
      * Renamed input format fields
     I              LHK4DT                          WEK4DT
     I              LHA1TM                          WEA1TM
     I              LHDXNB                          WEDXNB
     I              LHRMNB                          WERMNB
     I              LHRVNB                          WERVNB
     I              LHRVST                          WERVST
     I              LHUJST                          WEUJST
     I              LHMNTX                          WEMNTX
     I              LHMOTX                          WEMOTX
     I              LHAYNA                          WEAYNA
     I              LHA0NA                          WEA0NA
     I              LHBZNA                          WEBZNA
     I              LHXMCD                          WEXMCD
     I              LHAIC3                          WEAIC3
     I              LHC4NB                          WEC4NB
      *
     I@LHCPO4
      * Load Order Change Log     Ld ID,Typ,Dte/Time/Se
      * Renamed input format fields
     I              LHK4DT                          WFK4DT
     I              LHA1TM                          WFA1TM
     I              LHDXNB                          WFDXNB
     I              LHRMNB                          WFRMNB
     I              LHRVNB                          WFRVNB
     I              LHRVST                          WFRVST
     I              LHUJST                          WFUJST
     I              LHMNTX                          WFMNTX
     I              LHMOTX                          WFMOTX
     I              LHAYNA                          WFAYNA
     I              LHA0NA                          WFA0NA
     I              LHBZNA                          WFBZNA
     I              LHXMCD                          WFXMCD
     I              LHAIC3                          WFAIC3
     I              LHC4NB                          WFC4NB
      *
     I@FJCPO8
      * Load Header               SchShp,Seq,Ld/Unaccep
      * Renamed input format fields
     I              FJRMNB                          WGRMNB
     I              FJAIC3                          WGAIC3
     I              FJAODT                          WGAODT
     I              FJPJST                          WGPJST
     I              FJPKST                          WGPKST
     I              FJRNNB                          WGRNNB
     I              FJDMTX                          WGDMTX
     I              FJDNTX                          WGDNTX
     I              FJDOTX                          WGDOTX
     I              FJWTTX                          WGWTTX
     I              FJWUTX                          WGWUTX
     I              FJRPNB                          WGRPNB
     I              FJFLAM                          WGFLAM
     I              FJXQST                          WGXQST
     I              FJRRNB                          WGRRNB
     I              FJDXTX                          WGDXTX
     I              FJDYTX                          WGDYTX
     I              FJSBNB                          WGSBNB
     I              FJBZNA                          WGBZNA
     I              FJRONB                          WGRONB
     I              FJSQNB                          WGSQNB
     I              FJR1NB                          WGR1NB
     I              FJVCST                          WGVCST
     I              FJVDST                          WGVDST
     I              FJSDNB                          WGSDNB
     I              FJPAOU                          WGPAOU
     I              FJDGWG                          WGDGWG
     I              FJSXNB                          WGSXNB
     I              FJHADT                          WGHADT
     I              FJAART                          WGAART
     I              FJDHWG                          WGDHWG
     I              FJDIWG                          WGDIWG
     I              FJAQDT                          WGAQDT
     I              FJS6NB                          WGS6NB
     I              FJT4NB                          WGT4NB
     I              FJPRTM                          WGPRTM
     I              FJNPSV                          WGNPSV
     I              FJJ8TX                          WGJ8TX
     I              FJTLMI                          WGTLMI
     I              FJJ9TX                          WGJ9TX
     I              FJQ2CD                          WGQ2CD
     I              FJVPCD                          WGVPCD
     I              FJDBCD                          WGDBCD
     I              FJGRWE                          WGGRWE
     I              FJXCCD                          WGXCCD
     I              FJU2ST                          WGU2ST
     I              FJF9DT                          WGF9DT
     I              FJONTM                          WGONTM
     I              FJJ4DT                          WGJ4DT
     I              FJTRTM                          WGTRTM
     I              FJJ5DT                          WGJ5DT
     I              FJSPTM                          WGSPTM
     I              FJJ6DT                          WGJ6DT
     I              FJLFTM                          WGLFTM
     I              FJJ7DT                          WGJ7DT
     I              FJBOTM                          WGBOTM
     I              FJJ8DT                          WGJ8DT
     I              FJBLTM                          WGBLTM
     I              FJKIDT                          WGKIDT
     I              FJASTM                          WGASTM
     I              FJKADT                          WGKADT
     I              FJAJCM                          WGAJCM
     I              FJXACD                          WGXACD
     I              FJOANA                          WGOANA
     I              FJK4TX                          WGK4TX
     I              FJVOAG                          WGVOAG
     I              FJKBDT                          WGKBDT
     I              FJNBBO                          WGNBBO
     I              FJW4CD                          WGW4CD
     I              FJEFDT                          WGEFDT
     I              FJCNTN                          WGCNTN
     I              FJKCDT                          WGKCDT
     I              FJTMIN                          WGTMIN
     I              FJKDDT                          WGKDDT
     I              FJVMNB                          WGVMNB
     I              FJOCFR                          WGOCFR
     I              FJKJDT                          WGKJDT
     I              FJATTM                          WGATTM
     I              FJOTRS                          WGOTRS
     I              FJRNST                          WGRNST
     I              FJBRBK                          WGBRBK
     I              FJEIDT                          WGEIDT
     I              FJRMST                          WGRMST
     I              FJAJCD                          WGAJCD
     I              FJKKDT                          WGKKDT
     I              FJAVTM                          WGAVTM
     I              FJKZDT                          WGKZDT
     I              FJAXTM                          WGAXTM
     I              FJLHOS                          WGLHOS
     I              FJLHOR                          WGLHOR
     I              FJWNTX                          WGWNTX
     I              FJOITX                          WGOITX
     I              FJOJTX                          WGOJTX
     I              FJLLDT                          WGLLDT
     I              FJLSHG                          WGLSHG
     I              FJYPST                          WGYPST
     I              FJK0DT                          WGK0DT
     I              FJAYTM                          WGAYTM
     I              FJKNNX                          WGKNNX
     I              FJICWG                          WGICWG
     I              FJIDWG                          WGIDWG
     I              FJH9SX                          WGH9SX
     I              FJWOTX                          WGWOTX
     I              FJK1DT                          WGK1DT
     I              FJAZTM                          WGAZTM
     I              FJK2DT                          WGK2DT
     I              FJA0TM                          WGA0TM
     I              FJROST                          WGROST
     I              FJRPST                          WGRPST
     I              FJRQST                          WGRQST
     I              FJRRST                          WGRRST
     I              FJZBVA                          WGZBVA
     I              FJWPTX                          WGWPTX
     I              FJWQTX                          WGWQTX
     I              FJWRTX                          WGWRTX
     I              FJWSTX                          WGWSTX
     I              FJRVSX                          WGRVSX
     I              FJRUSX                          WGRUSX
     I              FJRWSX                          WGRWSX
     I              FJRXSX                          WGRXSX
     I              FJRYSX                          WGRYSX
     I              FJRZSX                          WGRZSX
     I              FJR0SX                          WGR0SX
     I              FJR1SX                          WGR1SX
     I              FJR2SX                          WGR2SX
     I              FJR3SX                          WGR3SX
     I              FJR4SX                          WGR4SX
     I              FJPYDT                          WGPYDT
     I              FJCKTM                          WGCKTM
     I              FJPZDT                          WGPZDT
     I              FJCLTM                          WGCLTM
     I              FJP0DT                          WGP0DT
     I              FJCMTM                          WGCMTM
     I              FJP1DT                          WGP1DT
     I              FJCNTM                          WGCNTM
     I              FJP2DT                          WGP2DT
     I              FJCOTM                          WGCOTM
     I              FJP3DT                          WGP3DT
     I              FJCQTM                          WGCQTM
     I              FJUVST                          WGUVST
     I              FJUWST                          WGUWST
     I              FJUXST                          WGUXST
     I              FJAATM                          WGAATM
     I              FJAYNA                          WGAYNA
     I              FJA0NA                          WGA0NA
     I              FJAXDT                          WGAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD1T        DS
      * Internal date
     I                                        1   70XDINT1
     I                                        1   30XDINY1
     I                                        4   50XDINM1
     I                                        6   70XDIND1
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      /EJECT
     IXDMT        DS
      * Duration mask
     I                                        1   70XDIMDT
     I                                        1   30XDIMYY
     I                                        4   50XDIMMM
     I                                        6   70XDIMDD
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Load Order Change Log
      * N :  Load ID
     I                                    P   1   40P1RMNB
     IP2PARM      DS
      * N :  Access Denied (Y/N)
     I                                        1   1 P2WVST
     IP3PARM      DS
      * I :  Load Start Company USR
     I                                    P   1   20P3B0C3
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0001
      * Application Code
     I                                       11  16 ZA0002
      * Message data for 'No Unaccepted Loads Found'
      * Company Number
     I                                        1   3 ZA0003
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P3B0C3    PARM           WP0001  30       Load Start Comp
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * DSP Control Chg Log    XF
      * ----- CHANGE LOG -----
      * E00519 Access by WHS  IF
      * ---------- November 2009 PKD ----------
      * *****  WW Cust/Order Inq O.E.  *****
      * - Do not allow Transfer Co if Application WHS Restrict = Y.
      * ***** Edit Order Header ***** -TESTED 11/10/09
      * -  Added validation on Warehouse Code.  If Application WHS Restri
      * is Yes, then only the Warehouse Code for O/P Application Code
      * are allowed.  If the Application WHS Restrict is No, then the
      * User is allowed access to all Active Warehouses.
      * -  Changed the F4=Prompt to only display the Warehouses the
      * User has access to if the Application WHS Restrict is Yes.
      * ***** Edit Order Detail Lines & Copy Order Template ***** TESTED
      * -  Added validation for Item Code. For each application and
      * Warehouse, addtional access control is defined for TF Exempt Code
      * Users that are restricted by Warehouse, they may also be restrict
      * on the Items they are able to sell.
      * -  Added validation on Order TF Exempt Code.  If the Customer is
      * is Exempt, then they can only sell Exempt Product. (E00505)
      * ***** Edit Load Plan Order Entry *****
      * -  Added WHS Code to the Control Context and Record Context.
      * For Users that are Application WHS Restrict = Yes,
      * the CTL.Warehouse Code will be restricted to the
      * Warehouses that they have access to.
      * -  CTL.Warehouse Code will be required for Users with
      * Application Warehouse Controlled.
      * -  Added Delivery State Code (Sail Port State) to the screen.
      * It will default to the Ship To State Code.  It will be overriden
      * to the Sail Port State if the Shipping Line and Port Delivery
      * Terminal are entered in the Order Header Extent.
      * -  Added subfile select for WHS and Delv ST.
      * ***** Edit Load Plan *****
      * -  For Users that are Application WHS Restrict = Yes,
      * the CTL.Warehouse Code will be restricted to the
      * Warehouses that they have access to.
      * -  CTL.Warehouse Code will be required for Users with
      * Application Warehouse Controlled.
      * -  CTL.USR Load Type---Default from the CTL.USR Warehosue Code
      * for users that are Application WHS Restrict.
      * ***** Display Change Log/Accept Load (PDAOXFR) *****
      * -  Deletes will not be accepted by Application WHS Restricted
      * users because we do not know the Warehouse that was on the Load.
      * -  If Application WHS Restrict is Yes, then only select the load
      * for acceptance if at least one order on the load has a warehouse
      * where the user has access.
      * -  Reverse imaged Warehouse Code on the Display. The Users with
      * Application WHS Restrict of No will be able to see all Loads.
      * ***** Edit Load Plan *****
      * - Added Warehouse Code to the Control and Detail Context with
      * appropriate validations.
      * ***** Work With Load Confirmation *****
      * - Added Warehouse Code as a parameter from the Work With Load
      * Plan All screen for selection of the Loads to Display on the
      * screen.  Added selection for Warehouse Code if one passed in.
      * If the Load is not to be selected due to not matching the Whs,
      * a record is created for the load in the array (exception array).
      * - Added Warehouse Code to the Subfile.
      * ***** Order Status Report Prompt *****
      * - Added Warehouse Code restriction on the prompt.
      * ***** Work With Orders Price Audit/Maintenance *****
      * - Added Warehouse Code restriction.
      * ***** Work With Orders - Edit Ship Date  *****
      * - Added Warehouse Code restriction.
      * ----------------------
      *
     C                     MOVEL*BLANK    WN0001 10        User Profile Na
      *
      * VAL Set Int.Acc No Hdg IF
     C                     MOVEL##USR     WN0001           User Profile Na
      *
     C                     MOVEL*BLANK    WN0002 10        User Code Model
      *
      * VAL User/Appl No Exit  IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SARVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
     C                     MOVEL'Y'       WUWVST           Access Denied (
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUWVST           Access Denied (
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0002    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0001    WL0001    P      User Profile Na
     C                     MOVEL'PDZ6DF'  WL0002    P      Application Cod
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0003    WUAIC3           Company Number
     C                     MOVELWL0004    YL0002    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0002    WL0001    P      User Profile Na
     C                     MOVEL'PDZ6DF'  WL0002    P      Application Cod
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0003    WUAIC3           Company Number
     C                     MOVELWL0004    YL0002    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0002    WUAJCD           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUWVST           Access Denied (
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUWVST           Access Denied (
     C                     END                             *FI
      * CASE: LCL.Company Number is greater than zero
     C           YL0001    IFGT 0                          *IF
     C                     Z-ADDYL0001    WUAIC3           Company Number
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0002    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  RT - Warehouse  * 
     C                     EXSR SCRVGN
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADDWUAIC3    WUAIC3           Company Number
     C                     MOVELWUWVST    P2WVST           Access Denied (
      * If access denied is no, rtv co. name
      * CASE: WRK.Access Denied (Y/N) is no
     C           WUWVST    IFEQ 'N'                        *IF
      * RTV Company Name       RT - Company Name and Address  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
      * CASE: PAR.Access Denied (Y/N) is yes
     C           P2WVST    IFEQ 'Y'                        *IF
      * Set Message Queue Dest. - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVEL##USR     ZA0001           *USER
     C                     MOVEL'PDZ6DF'  ZA0002           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * RTV Appl Whs Restrict  RT - User Profile Control  * 
     C                     EXSR SERVGN
      * CASE: LCL.Application WHS Restrict is no
     C           YL0004    IFEQ 'N'                        *IF
      * LCL.Created Date = JOB.*Job date + CON.-1 *YEARS
     C           ##JDT     ADD  1000000   XDINDT
     C                     Z-ADD-1        XDURR   80
     C                     EXSR XDAYR
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     YL0005
     C                     ELSE
     C           XDINDT    SUB  1000000   YL0005
     C                     END
      * Show Deleted Loads 1st
      * RTV Dsp All By Type    RT - Load Order Change Log  * 
     C                     EXSR SFRVGN
     C                     END                             *FI
     C                     Z-ADD*ZERO     P1RMNB           Load ID
      * This is for all non-deleted, unaccepted loads
      * RTV Control Chg Log    RT - Load Header  * 
     C                     EXSR SHRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
      * Setup message data for message
      * Convert Load Start Company USR to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           P3B0C3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVELP3B0C3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    ZA0003           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0003           CD3 Ext Numeric
     C                     END                             *FI
      * Send message 'No Unaccepted Loads Found'
     C                     MOVEL'USR2526' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0001    WAAJVN           User Profile Na
      * Establish starting position
     C           KRSSA     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAI6ST    WUI6ST           Allow Multi-Com
     C                     MOVELWAMPNA    WUMPNA           Default Printer
     C                     MOVELWABCCD    WUBCCD           Salesperson Cod
     C                     Z-ADDWAAIC3    YL0001           Company Number
     C                     MOVELWABUVN    WN0002           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBAJVN           User Profile Na
     C                     KFLD           WBDNCD           Application Cod
      * Setup key
     C                     MOVELWL0001    WBAJVN           User Profile Na
     C                     MOVELWL0002    WBDNCD           Application Cod
      * Establish starting position
     C           KRSSB     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWBAIC3    WL0003           Company Number
     C                     MOVELWBAJCD    WL0004           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Prod Whse for Co  RT - Warehouse  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCBWC3    WQSC01           Shipping Compan
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Shipping Compan
      * Setup key
     C                     Z-ADDYL0003    WQSC01           Shipping Compan
      * Establish starting position
     C           KRSSC     SETLL@ADREWA                    *
     C           KRSSC     READE@ADREWA                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0007' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAJCD           Warehouse Code
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Record Status is Active
     C           WCVSST    IFEQ 'A'                        *IF
      * CASE: DB1.Production Warehouse Code is Warehouse Code not Blank
     C           WCAOCD    IFNE *BLANK                     *IF
     C                     MOVELWCAOCD    WUAJCD           Warehouse Code
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSC     READE@ADREWA                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Company Name       RT - Company Name and Address  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WDAIC3           Company Number
      * Setup key
     C                     Z-ADDWUAIC3    WDAIC3           Company Number
      * Establish starting position
     C           KRSSD     CHAIN@ABREG3              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0003' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUADTX           Name
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWDADTX    WUADTX           Name
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV Appl Whs Restrict  RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WAAJVN           User Profile Na
      * Setup key
     C                     MOVEL##USR     WAAJVN           User Profile Na
      * Establish starting position
     C           KRSSE     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0004           Application WHS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAI7ST    YL0004           Application WHS
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV Dsp All By Type    RT - Load Order Change Log  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0003  70       Order Number
     C                     Z-ADD*ZERO     WN0004  50       Stop/Drop
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WERVST    WQSF02           Load Change Typ
      * Define keylist
     C           KPSSF     KLIST
     C                     KFLD           WQSF02           Load Change Typ
     C                     KFLD           WEK4DT           Created Date
     C                     KFLD           WEA1TM           Created Time
     C                     KFLD           WEDXNB           Sequence Number
     C                     KFLD           WERMNB           Load ID
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF02           Load Change Typ
      * Setup key
     C                     MOVEL'DELOAD'  WQSF02           Load Change Typ
     C                     Z-ADDYL0005    WEK4DT           Created Date
     C                     Z-ADD*ZERO     WEA1TM           Created Time
     C                     Z-ADD*ZERO     WEDXNB           Sequence Number
     C                     Z-ADD*ZERO     WERMNB           Load ID
      * Establish starting position
     C           KPSSF     SETLL@LHCPO6                    *
     C           KRSSF     READE@LHCPO6                  90*
      * Data record not found
     C   90                MOVEL'USR2471' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     Z-ADD0         WN0003           Order Number
     C                     Z-ADD0         WN0004           Stop/Drop
      * If displaying deleted load look for deleted loads that are accept
      * CASE: PAR.Load Change Type is Delete Load
     C           'DELOAD'  IFEQ @CN,002                    *IF
      * Chk Load for DELODA   RT - Load Order Change Log  * 
     C                     EXSR SGRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
      * Display loads for par.company only  RMC 4/10/06
      * CASE: DB1.Company Number EQ PAR.Company Number
     C           WEAIC3    IFEQ P3B0C3                     *IF
     C                     Z-ADDWERVNB    WN0004           Stop/Drop
     C                     Z-ADDWEC4NB    WN0003           Order Number
      * DSP Load Acceptance    DF - Load Order Change Log  * 
     C                     CALL 'PDZ6DFR'              90  DSP Load Accept
     C                     PARM *BLANK    W0RTN   7
     C                     PARM 0         WQ0001  70       Created Date
     C                     PARM 0         WQ0002  60       Created Time
     C                     PARM 0         WQ0003  30       Sequence Number
     C                     PARM WERMNB    WQ0004  70       Load ID
     C           WN0004    PARM WN0004    WQ0005  50       Stop/Drop
     C           WN0003    PARM WN0003    WQ0006  70       Order Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDZ6DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ @CN,003                    *IF
     C                     MOVEL*BLANK    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWERVNB    WN0004           Stop/Drop
     C                     Z-ADDWEC4NB    WN0003           Order Number
      * DSP Load Acceptance    DF - Load/Order Change Log  * 
     C                     CALL 'PDZ6DFR'              90  DSP Load Accept
     C                     PARM *BLANK    W0RTN   7
     C                     PARM 0         WQ0007  70       Created Date
     C                     PARM 0         WQ0008  60       Created Time
     C                     PARM 0         WQ0009  30       Sequence Number
     C                     PARM WERMNB    WQ0010  70       Load ID
     C           WN0004    PARM WN0004    WQ0011  50       Stop/Drop
     C           WN0003    PARM WN0003    WQ0012  70       Order Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDZ6DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ @CN,003                    *IF
     C                     MOVEL*BLANK    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSF     READE@LHCPO6                  90*
     C                     ENDDO
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Chk Load for DELODA   RT - Load Order Change Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WFRMNB    WQSG02           Load ID
     C           *LIKE     DEFN WFRVST    WQSG03           Load Change Typ
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG02           Load ID
     C                     KFLD           WQSG03           Load Change Typ
      * Setup key
     C                     Z-ADDWERMNB    WQSG02           Load ID
     C                     MOVEL'DELODA'  WQSG03           Load Change Typ
      * Establish starting position
     C           KRSSG     SETLL@LHCPO4                    *
     C           KRSSG     READE@LHCPO4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2471' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c2 AND c3
      *   |- c2    : PAR.Load ID EQ DB1.Load ID
      *   |- c3    : PAR.Load Change Type EQ DB1.Load Change Type
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WERMNB    IFEQ WFRMNB                     *IF
     C           'DELODA'  IFEQ WFRVST                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     END                             *FI
     C                     GOTO SGEXIT                     *QUIT
     C           KRSSG     READE@LHCPO4                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV Control Chg Log    RT - Load Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0005  70       Created Date
     C                     Z-ADD*ZERO     WN0006  60       Created Time
     C                     Z-ADD*ZERO     WN0007  30       Sequence Number
     C                     Z-ADD*ZERO     WN0008  50       Stop/Drop
     C                     Z-ADD*ZERO     WN0009  70       Order Number
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * ----- Change Log -----
      * E00519 Access by WHS  IF
      * ---------- November 2009 PKD ----------
      * *****  WW Cust/Order Inq O.E.  *****
      * - Do not allow Transfer Co if Application WHS Restrict = Y.
      * ***** Edit Order Header ***** -TESTED 11/10/09
      * -  Added validation on Warehouse Code.  If Application WHS Restri
      * is Yes, then only the Warehouse Code for O/P Application Code
      * are allowed.  If the Application WHS Restrict is No, then the
      * User is allowed access to all Active Warehouses.
      * -  Changed the F4=Prompt to only display the Warehouses the
      * User has access to if the Application WHS Restrict is Yes.
      * ***** Edit Order Detail Lines & Copy Order Template ***** TESTED
      * -  Added validation for Item Code. For each application and
      * Warehouse, addtional access control is defined for TF Exempt Code
      * Users that are restricted by Warehouse, they may also be restrict
      * on the Items they are able to sell.
      * -  Added validation on Order TF Exempt Code.  If the Customer is
      * is Exempt, then they can only sell Exempt Product. (E00505)
      * ***** Edit Load Plan Order Entry *****
      * -  Added WHS Code to the Control Context and Record Context.
      * For Users that are Application WHS Restrict = Yes,
      * the CTL.Warehouse Code will be restricted to the
      * Warehouses that they have access to.
      * -  CTL.Warehouse Code will be required for Users with
      * Application Warehouse Controlled.
      * -  Added Delivery State Code (Sail Port State) to the screen.
      * It will default to the Ship To State Code.  It will be overriden
      * to the Sail Port State if the Shipping Line and Port Delivery
      * Terminal are entered in the Order Header Extent.
      * -  Added subfile select for WHS and Delv ST.
      * ***** Edit Load Plan *****
      * -  For Users that are Application WHS Restrict = Yes,
      * the CTL.Warehouse Code will be restricted to the
      * Warehouses that they have access to.
      * -  CTL.Warehouse Code will be required for Users with
      * Application Warehouse Controlled.
      * -  CTL.USR Load Type---Default from the CTL.USR Warehosue Code
      * for users that are Application WHS Restrict.
      * ***** Display Change Log/Accept Load (PDAOXFR) *****
      * -  Deletes will not be accepted by Application WHS Restricted
      * users because we do not know the Warehouse that was on the Load.
      * -  If Application WHS Restrict is Yes, then only select the load
      * for acceptance if at least one order on the load has a warehouse
      * where the user has access.
      * -  Reverse imaged Warehouse Code on the Display. The Users with
      * Application WHS Restrict of No will be able to see all Loads.
      * ***** Edit Load Plan *****
      * - Added Warehouse Code to the Control and Detail Context with
      * appropriate validations.
      * ***** Work With Load Confirmation *****
      * - Added Warehouse Code as a parameter from the Work With Load
      * Plan All screen for selection of the Loads to Display on the
      * screen.  Added selection for Warehouse Code if one passed in.
      * If the Load is not to be selected due to not matching the Whs,
      * a record is created for the load in the array (exception array).
      * - Added Warehouse Code to the Subfile.
      * ***** Order Status Report Prompt *****
      * - Added Warehouse Code restriction on the prompt.
      * ***** Work With Orders Price Audit/Maintenance *****
      * - Added Warehouse Code restriction.
      * ***** Work With Orders - Edit Ship Date  *****
      * - Added Warehouse Code restriction.
      * ----------------------
     C                     MOVEL'N'       WUWXST           Record Found US
      * Define keylist
     C           KPSSH     KLIST
     C                     KFLD           WGAODT           Scheduled Ship
     C                     KFLD           WGT4NB           Schedule Sequen
     C                     KFLD           WGRMNB           Load ID
      * Setup key
     C                     Z-ADD9999999   WGAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WGT4NB           Schedule Sequen
     C                     Z-ADDP1RMNB    WGRMNB           Load ID
      * Establish starting position
     C           KPSSH     SETLL@FJCPO8                    *
     C                     READ @FJCPO8                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1188' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Documentation
     C                     EXSR UASUBR                     Documentation
     C                     MOVEL'Y'       W0RSL            *Record selecte
      * SEL: Load ID (Application WHS Restrict = Y)
      * CASE: PAR.Application WHS Restrict is yes
     C           YL0004    IFEQ 'Y'                        *IF
      * Sel Appl WHS Ld       XF - User Application Whs  * 
     C                     CALL 'PNMWXFR'              90  Sel Appl WHS Ld
     C                     PARM *BLANK    W0RTN   7
     C                     PARM ##USR     WQ0013 10        User Profile Na
     C                     PARM 'TRF'     WQ0014  6        Application Cod
     C                     PARM WGRMNB    WQ0015  70       Load ID
     C           W0RSL     PARM W0RSL     WQ0016  1        *Record selecte
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNMWXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Process Record
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * position by Date/Time
     C                     Z-ADD0         WN0005           Created Date
     C                     Z-ADD0         WN0006           Created Time
     C                     Z-ADD0         WN0007           Sequence Number
      * RTV Latest Accept Type RT - Load Order Change Log  * 
     C                     EXSR SIRVGN
     C                     Z-ADD0         WN0009           Order Number
     C                     Z-ADD0         WN0008           Stop/Drop
      * RTV Next/Prev Order    XF - Load Order Change Log  * 
     C                     CALL 'PDAPXFR'              90  RTV Next/Prev O
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WN0005    WQ0017  70       Created Date
     C                     PARM WN0006    WQ0018  60       Created Time
     C                     PARM WN0007    WQ0019  30       Sequence Number
     C                     PARM WGRMNB    WQ0020  70       Load ID
     C           WN0008    PARM WN0008    WQ0021  50       Stop/Drop
     C                     PARM WGAIC3    WQ0022  30       Company Number
     C           WN0009    PARM WN0009    WQ0023  70       Order Number
     C                     PARM 'N'       WQ0024  1        USR Next/Previo
     C           WURTN     PARM *BLANK    WQ0025  7        *Return code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDAPXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rst on Load Str Company            RMC 3/1/06
      * CASE: PAR.Load Start Company USR EQ DB1.Company Number
     C           P3B0C3    IFEQ WGAIC3                     *IF
      * CASE: PAR.Order Number NE WRK.ZERO
     C           WN0009    IFNE WUW0NB                     *IF
     C                     MOVEL'Y'       WUWXST           Record Found US
      * DSP Load Acceptance    DF - Load Order Change Log  * 
     C                     CALL 'PDZ6DFR'              90  DSP Load Accept
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WN0005    WQ0026  70       Created Date
     C                     PARM WN0006    WQ0027  60       Created Time
     C                     PARM WN0007    WQ0028  30       Sequence Number
     C                     PARM WGRMNB    WQ0029  70       Load ID
     C           WN0008    PARM WN0008    WQ0030  50       Stop/Drop
     C           WN0009    PARM WN0009    WQ0031  70       Order Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDZ6DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ @CN,003                    *IF
     C                     MOVEL*BLANK    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @FJCPO8                  90*
     C                     ENDDO
      * USER: Exit processing
      * CASE: WRK.Record Found USR is Record Not Found
     C           WUWXST    IFEQ 'N'                        *IF
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     END                             *FI
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * RTV Latest Accept Type RT - Load Order Change Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WFRMNB    WQSI02           Load ID
     C           *LIKE     DEFN WFRVST    WQSI03           Load Change Typ
      * Define keylist
     C           KPSSI     KLIST
     C                     KFLD           WQSI02           Load ID
     C                     KFLD           WQSI03           Load Change Typ
     C                     KFLD           WFK4DT           Created Date
     C                     KFLD           WFA1TM           Created Time
     C                     KFLD           WFDXNB           Sequence Number
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI02           Load ID
     C                     KFLD           WQSI03           Load Change Typ
      * Setup key
     C                     Z-ADDWGRMNB    WQSI02           Load ID
     C                     MOVEL'ACCEPT'  WQSI03           Load Change Typ
     C                     Z-ADDWN0005    WFK4DT           Created Date
     C                     Z-ADDWN0006    WFA1TM           Created Time
     C                     Z-ADDWN0007    WFDXNB           Sequence Number
      * Establish starting position
     C           KPSSI     SETLL@LHCPO4                    *
     C           KRSSI     READE@LHCPO4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2471' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WN0005           Created Date
     C                     Z-ADD*ZERO     WN0006           Created Time
     C                     Z-ADD*ZERO     WN0007           Sequence Number
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * this is intended to get ALL of a rst. type of change.  It will re
      * the information from the LAST one.
      * PAR = DB1 By name
     C                     Z-ADDWFK4DT    WN0005           Created Date
     C                     Z-ADDWFA1TM    WN0006           Created Time
     C                     Z-ADDWFDXNB    WN0007           Sequence Number
     C           KRSSI     READE@LHCPO4                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Documentation
      *================================================================
      * On entry, only want to see changes since last acceptance AND
      *    only want to see changes to orders, not load log entries.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         XDAG1     BEGSR
      *================================================================
      * Prepare parameters to calculate Date Increment
      *================================================================
     C           XDURR     IFLT 0
      * Negative date increment
     C                     Z-ADD-1        XDWK2   60
     C                     ELSE
      * Positive date increment
     C                     Z-ADD1         XDWK2
     C                     ENDIF
     C                     MULT XDWK2     XDURR
      * Refresh the length of updated month (returned in XDWK1).
     C                     Z-ADDXDINDT    XDINT2
     C                     EXSR XDMNH
     C           XDINDD    IFEQ XDWK1
      * Save the start day
     C                     Z-ADD0         XDINDD
     C                     ENDIF
     C                     Z-ADD0         XDINT2
     C                     Z-ADD0         XDIMDT
     C                     MOVEL*BLANK    W0RTN   7
      *================================================================
     CSR         XDAG1E    ENDSR
      /EJECT
     CSR         XDAG2     BEGSR
      *================================================================
      * General calculations driven by Increment Mask
      *================================================================
      * Extract days
     C           XDIMDD    IFEQ 1
     C                     DIV  100       XDURR   80
     C                     MVR            XDIND2
     C                     ENDIF
      * Extract months
     C           XDIMMM    IFEQ 1
     C                     DIV  100       XDURR   80
     C                     MVR            XDINM2
     C                     ENDIF
      * Extract years
     C           XDIMYY    IFEQ 1
     C                     DIV  1000      XDURR   80
     C                     MVR            XDINY2
     C                     ENDIF
     C           XDURR     IFNE 0
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      * Normalize month increment
     C           XDINM2    DIV  12        XDURR   80
     C                     MVR            XDINM2
     C                     ADD  XDURR     XDINY2
      * Apply year increment
     C                     MULT XDWK2     XDINY2
     C                     ADD  XDINYY    XDINY2
      * Apply month increment
     C                     MULT XDWK2     XDINM2
     C                     ADD  XDINMM    XDINM2
      * Normalize updated month
     C                     EXSR XDNZM
     C           XDINDD    IFGT XDWK1
     C           XDINDD    OREQ 0
      * Restore the start day
     C                     Z-ADDXDWK1     XDINDD
     C                     ENDIF
      * Apply day increment
     C                     MULT XDWK2     XDIND2
     C           XDINDD    ADD  XDIND2    XDURR
     C                     Z-ADD0         XDIND2
      * Normalize day increment
     C           XDIND2    DOWLE0
     C           XDURR     IFEQ 0
     C                     ADD  XDWK2     XDINM2
      * Normalize updated month
     C                     EXSR XDNZM
     C                     Z-ADDXDWK1     XDURR
     C                     ENDIF
     C           XDURR     IFLT 0
     C                     SUB  1         XDINM2
      * Normalize updated month
     C                     EXSR XDNZM
     C                     ADD  XDWK1     XDURR
     C                     ELSE
     C           XDURR     IFGT XDWK1
     C                     SUB  XDWK1     XDURR
     C                     ADD  1         XDINM2
      * Normalize updated month
     C                     EXSR XDNZM
     C                     ELSE
     C                     Z-ADDXDURR     XDIND2
     C                     ENDIF
     C                     ENDIF
     C                     ENDDO
      * Check updated year
     C           XDINY2    IFGE 400
     C           XDINY2    ORLE 0
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
     C           W0RTN     IFEQ 'Y2U0006'
     C                     Z-ADD0         XDINDT
     C                     ELSE
     C                     Z-ADDXDINT2    XDINDT
     C                     ENDIF
      *================================================================
     CSR         XDAG2E    ENDSR
      /EJECT
     CSR         XDAYR     BEGSR
      *================================================================
      * Calculate duration, *YEARS
      *================================================================
      * Check and adjust End Of Month dates, if any.
     C                     EXSR XDAG1
      * Define increment Mask.
     C                     Z-ADD1         XDIMYY
      * Initiate general DATE INCREMENT calculations.
     C                     EXSR XDAG2
      *================================================================
     CSR         XDAYRE    ENDSR
      /EJECT
     CSR         XDMNH     BEGSR
      *================================================================
      * Find length(XDWK1) in days for the month passed in XDIN2TS
      *================================================================
     C           XDINM2    IFEQ 4
     C           XDINM2    OREQ 6
     C           XDINM2    OREQ 9
     C           XDINM2    OREQ 11
     C                     Z-ADD30        XDWK1   80
     C                     ELSE
     C                     Z-ADD31        XDWK1
     C                     END
     C           XDINM2    IFEQ 2
      * Determine February length
     C           XDINY2    IFEQ 300
     C           XDINY2    OREQ 100
     C                     Z-ADD28        XDWK1
     C                     ELSE
     C           XDINY2    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     Z-ADD29        XDWK1
     C                     ELSE
     C                     Z-ADD28        XDWK1
     C                     END
     C                     END
     C                     END
      *================================================================
     CSR         XDMNHE    ENDSR
      /EJECT
     CSR         XDNZM     BEGSR
      *================================================================
      * Normalize days
      *================================================================
     C           XDINM2    IFLT 1
     C                     ADD  12        XDINM2
     C                     SUB  1         XDINY2
     C                     ENDIF
     C           XDINM2    IFGT 12
     C                     SUB  12        XDINM2
     C                     ADD  1         XDINY2
     C                     ENDIF
      * Refresh the length of updated month (returned in XDWK1).
     C                     EXSR XDMNH
      *================================================================
     CSR         XDNZME    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1RMNB           Load ID
     C                     MOVEL*BLANK    P2WVST           Access Denied (
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Warehouse Code
     C                     MOVEL*BLANK    WUAJCD  3
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field Salesperson Code
     C                     MOVEL*BLANK    WUBCCD  3
      * Define work field Allow Multi-Company
     C                     MOVEL*BLANK    WUI6ST  1
      * Define work field Default Printer
     C                     MOVEL*BLANK    WUMPNA 10
      * Define work field Name
     C                     MOVEL*BLANK    WUADTX 30
      * Define work field System Value Alpha
     C                     MOVEL*BLANK    WUBXTX 40
      * Define work field Access Denied (Y/N)
     C                     MOVEL*BLANK    WUWVST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WANLNB           Entity Number
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCDBNB           Warehouse Chill
     C                     Z-ADD*ZERO     WCBWC3           Shipping Compan
     C                     Z-ADD*ZERO     WCBTC3           Accounting Comp
     C                     Z-ADD*ZERO     WCBUC3           WHS Sched Prod
     C                     Z-ADD*ZERO     WCBVC3           WHS Inventory C
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEK4DT           Created Date
     C                     Z-ADD*ZERO     WEA1TM           Created Time
     C                     Z-ADD*ZERO     WEDXNB           Sequence Number
     C                     Z-ADD*ZERO     WERMNB           Load ID
     C                     Z-ADD*ZERO     WERVNB           Stop/Drop
     C                     Z-ADD*ZERO     WEAIC3           Company Number
     C                     Z-ADD*ZERO     WEC4NB           Order Number
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGRMNB           Load ID
     C                     Z-ADD*ZERO     WGAIC3           Company Number
     C                     Z-ADD*ZERO     WGAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WGRNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WGRPNB           Total Load Orde
     C                     Z-ADD*ZERO     WGFLAM           Flat Amount
     C                     Z-ADD*ZERO     WGRRNB           Total Stops
     C                     Z-ADD*ZERO     WGSBNB           BOL Time
     C                     Z-ADD*ZERO     WGSQNB           Ld Hdr/Ld Dtl U
     C                     Z-ADD*ZERO     WGR1NB           Rated Freight
     C                     Z-ADD*ZERO     WGSDNB           Number Pallets
     C                     Z-ADD*ZERO     WGPAOU           Number Pallets
     C                     Z-ADD*ZERO     WGDGWG           Load Carrier Pa
     C                     Z-ADD*ZERO     WGSXNB           Estimated Arriv
     C                     Z-ADD*ZERO     WGHADT           Actual Arrival
     C                     Z-ADD*ZERO     WGAART           Actual Arrival
     C                     Z-ADD*ZERO     WGDHWG           Trailer IN Weig
     C                     Z-ADD*ZERO     WGDIWG           Trailer OUT Wei
     C                     Z-ADD*ZERO     WGAQDT           Actual Departur
     C                     Z-ADD*ZERO     WGS6NB           Departure Time
     C                     Z-ADD*ZERO     WGT4NB           Schedule Sequen
     C                     Z-ADD*ZERO     WGPRTM           Product Tempera
     C                     Z-ADD*ZERO     WGNPSV           Number Pallets
     C                     Z-ADD*ZERO     WGTLMI           Total Load Mile
     C                     Z-ADD*ZERO     WGGRWE           Gross Weight
     C                     Z-ADD*ZERO     WGF9DT           Actual Ship Dat
     C                     Z-ADD*ZERO     WGJ4DT           Truck Ready Dat
     C                     Z-ADD*ZERO     WGTRTM           Truck Ready Tim
     C                     Z-ADD*ZERO     WGJ5DT           Spotted Date
     C                     Z-ADD*ZERO     WGSPTM           Spotted Time
     C                     Z-ADD*ZERO     WGJ6DT           Load Finished D
     C                     Z-ADD*ZERO     WGLFTM           Load Finished T
     C                     Z-ADD*ZERO     WGJ7DT           BOL Complete Da
     C                     Z-ADD*ZERO     WGBOTM           BOL Complete Ti
     C                     Z-ADD*ZERO     WGJ8DT           BOL Received Da
     C                     Z-ADD*ZERO     WGBLTM           BOL Received Ti
     C                     Z-ADD*ZERO     WGKIDT           Truck Departure
     C                     Z-ADD*ZERO     WGASTM           Truck Departure
     C                     Z-ADD*ZERO     WGKADT           Adjusted Depart
     C                     Z-ADD*ZERO     WGAJCM           Adjusted Depart
     C                     Z-ADD*ZERO     WGVOAG           Voyage
     C                     Z-ADD*ZERO     WGKBDT           Sail Date
     C                     Z-ADD*ZERO     WGEFDT           Arrival Date
     C                     Z-ADD*ZERO     WGKCDT           Date In
     C                     Z-ADD*ZERO     WGTMIN           Time In
     C                     Z-ADD*ZERO     WGKDDT           Date Out
     C                     Z-ADD*ZERO     WGVMNB           Time Out
     C                     Z-ADD*ZERO     WGOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WGKJDT           Scheduled Deliv
     C                     Z-ADD*ZERO     WGATTM           Scheduled Deliv
     C                     Z-ADD*ZERO     WGBRBK           Bring Back Mile
     C                     Z-ADD*ZERO     WGEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WGKKDT           On Yard Date
     C                     Z-ADD*ZERO     WGAVTM           On Yard Time
     C                     Z-ADD*ZERO     WGKZDT           Deadline Depart
     C                     Z-ADD*ZERO     WGAXTM           Deadline Depart
     C                     Z-ADD*ZERO     WGLLDT           Express Mail Da
     C                     Z-ADD*ZERO     WGK0DT           Product Complet
     C                     Z-ADD*ZERO     WGAYTM           Product Complet
     C                     Z-ADD*ZERO     WGKNNX           Pallets Loaded
     C                     Z-ADD*ZERO     WGICWG           Avg Pallet Tare
     C                     Z-ADD*ZERO     WGIDWG           Tot Pallet Tare
     C                     Z-ADD*ZERO     WGK1DT           Load Confirmati
     C                     Z-ADD*ZERO     WGAZTM           Load Door 1
     C                     Z-ADD*ZERO     WGK2DT           Override Total
     C                     Z-ADD*ZERO     WGA0TM           Load Door 2
     C                     Z-ADD*ZERO     WGZBVA           Load Actual Fre
     C                     Z-ADD*ZERO     WGPYDT           LH Carrier Paid
     C                     Z-ADD*ZERO     WGCKTM           LH Carrier Paid
     C                     Z-ADD*ZERO     WGPZDT           LH Last Combo P
     C                     Z-ADD*ZERO     WGCLTM           LH Last Combo P
     C                     Z-ADD*ZERO     WGP0DT           LPT Load Plan S
     C                     Z-ADD*ZERO     WGCMTM           LPT Load Plan S
     C                     Z-ADD*ZERO     WGP1DT           TPM Planned Shi
     C                     Z-ADD*ZERO     WGCNTM           LH Unused Time
     C                     Z-ADD*ZERO     WGP2DT           LH Unused Date
     C                     Z-ADD*ZERO     WGCOTM           LH Unused Time
     C                     Z-ADD*ZERO     WGP3DT           LH Unused Date
     C                     Z-ADD*ZERO     WGCQTM           LH Unused Time
     C                     Z-ADD*ZERO     WGAATM           Job Time
     C                     Z-ADD*ZERO     WGAXDT           Job Date
      * Define work field Record Found USR
     C                     MOVEL*BLANK    WUWXST  1
      * Define work field *Return code
     C                     MOVEL*BLANK    WURTN   7
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBRVGN.
     C                     MOVEL*BLANK    WL0001 10
     C                     MOVEL*BLANK    WL0002  6
     C                     Z-ADD*ZERO     WL0003  30
     C                     MOVEL*BLANK    WL0004  3
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0001  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0002  3
      * Define local work field Shipping Company
     C                     Z-ADD*ZERO     YL0003  30
      * Define local work field Application WHS Restrict
     C                     MOVEL*BLANK    YL0004  1
      * Define local work field Created Date
     C                     Z-ADD*ZERO     YL0005  70
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Y2U0005
00002 DELOAD
00003 Y2U9999
