     H/TITLE Clc OrdDtl Ext Amt    XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     W* Warning: This program does not set on the LR indicator
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1181
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISPPATE
     H* Date          : 08/28/07  Time  : 22:17:57
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Detail
      * O :  Extended Amount
     I                                    P   1   62P1AYVA
      * I :  U/M - Base Price
     I                                        7   8 P1CRCD
      * I :  Quantity Shipped Total
     I                                    P   9  142P1CBQT
      * I :  Weight Shipped Total
     I                                    P  15  202P1ATWG
      * I :  Unit Price
     I                                    P  21  264P1AKPR
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AYVA    PARM P1AYVA    WP0001 112       Extended Amount
     C           P1CRCD    PARM           WP0002  2        U/M - Base Pric
     C           P1CBQT    PARM           WP0003 112       Quantity Shippe
     C           P1ATWG    PARM           WP0004 112       Weight Shipped
     C           P1AKPR    PARM           WP0005 114       Unit Price
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Clc OrdDtl Ext Amt    XF
     C                     Z-ADD*ZERO     P1AYVA           Extended Amount
      * UOM Type
      * CASE:
      *  - c1 OR c2 OR c3 OR c4
      *   |- c1    : PAR.U/M - Base Price is Carcass Hundred Weight
      *   |- c2    : PAR.U/M - Base Price is Pounds
      *   |- c3    : PAR.U/M - Base Price is Tons
      *   |- c4    : PAR.U/M - Base Price is Thousand
      *   '-
     C           P1CRCD    IFEQ 'CW'                       *IF
     C           P1CRCD    OREQ 'LB'                       *OR
     C           P1CRCD    OREQ 'TN'                       *OR
     C           P1CRCD    OREQ 'M'                        *OR
     C                     MOVEL'W'       YL0001           UOM Type USR
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Q'       YL0001           UOM Type USR
     C                     END                             *FI
      * UOM Type = Weight
      * CASE: LCL.UOM Type USR is Weight
     C           YL0001    IFEQ 'W'                        *IF
      * Hundred Weight
      * CASE: PAR.U/M - Base Price is Carcass Hundred Weight
     C           P1CRCD    IFEQ 'CW'                       *IF
      * PAR.Extended Amount =
      *    *COMPUTE (x1 * (x2 / x3))
      * x1    : PAR.Unit Price
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x2    : PAR.Weight Shipped Total
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x3    : CON.100
     C           P1ATWG    DIV  100       W0WB01    H      *Synon (15,5) w
     C           P1AKPR    MULT W0WB01    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    P1AYVA           Extended Amount
     C                     END                             *FI
      * Thousand
      * CASE: PAR.U/M - Base Price is Thousand
     C           P1CRCD    IFEQ 'M'                        *IF
      * PAR.Extended Amount =
      *    *COMPUTE (x1 * (x2 / x3))
      * x1    : PAR.Unit Price
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x2    : PAR.Weight Shipped Total
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x3    : CON.1000
     C           P1ATWG    DIV  1000      W0WB01    H      *Synon (15,5) w
     C           P1AKPR    MULT W0WB01    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    P1AYVA           Extended Amount
     C                     END                             *FI
      * Tons
      * CASE: PAR.U/M - Base Price is Tons
     C           P1CRCD    IFEQ 'TN'                       *IF
      * PAR.Extended Amount =
      *    *COMPUTE (x1 * (x2 / x3))
      * x1    : PAR.Unit Price
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x2    : PAR.Weight Shipped Total
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x3    : CON.2000
     C           P1ATWG    DIV  2000      W0WB01    H      *Synon (15,5) w
     C           P1AKPR    MULT W0WB01    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    P1AYVA           Extended Amount
     C                     END                             *FI
      * Pounds
      * CASE: PAR.U/M - Base Price is Pounds
     C           P1CRCD    IFEQ 'LB'                       *IF
      * PAR.Extended Amount =
      *    *COMPUTE (x1 * x3)
      * x1    : PAR.Unit Price
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x3    : PAR.Weight Shipped Total
     C           P1AKPR    MULT P1ATWG    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    P1AYVA           Extended Amount
     C                     END                             *FI
     C                     END                             *FI
      * UOM Type = Quantity
      * CASE: LCL.UOM Type USR is Quantity
     C           YL0001    IFEQ 'Q'                        *IF
      * PAR.Extended Amount =
      *    *COMPUTE (x1 * x3)
      * x1    : PAR.Unit Price
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x3    : PAR.Quantity Shipped Total
     C           P1AKPR    MULT P1CBQT    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    P1AYVA           Extended Amount
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WB01 155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WA00 152       *Synon (15,2) w
     C                     MOVEL'N'       W0PMT   1
      * Define local work field UOM Type USR
     C                     MOVEL*BLANK    YL0001  1
      *================================================================
     CSR         ZZEXIT    ENDSR
