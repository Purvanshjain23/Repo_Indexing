// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBDTXFR
// ?Date: 14.08.2025 Time: 03:47:30
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(VAL Dup Assignd Contnr RT) TYPE(RTVOBJ) FILE(PMAMREP)          AC2043746;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.OHE_Container_Number);
PARAMETER(PAR.Carrier_Code_Usr);
PARAMETER(PAR.Load_Id_1);
{
 //?USER: Initialize routine

 // PGM.*Return code = CND.Trailer Available to assn
 PGM.*Return_code = 'TRLRAVL';

 //?USER: Processing if Data record not found

 //?If container not on open OHE, see if it is on another load
 EXECUTE FUNCTION(RTV Trailer's Load ID  RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC2032021;
 PARAMETER(LCL.Load_ID);
 PARAMETER(LCL.Company_Number);
 PARAMETER(LCL.Load_Status);
 PARAMETER(PAR.OHE_Container_Number);
 PARAMETER(PAR.Carrier_Code_Usr);
 PARAMETER(LCL.Load_Type);
 PARAMETER(LCL.USR_Active_Load);
 {
  //?USER: Initialize routine

  // PAR.USR Active Load = CND.no
  PAR.USR_Active_Load = 'N';

  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  //?If Load is not shipped or invoiced
  CASE;

  // IF DB1.Load Status is Prior to Shipped
  IF DB1.Load_Status = 'C'/'E'/'L'/'U';

  MOVE *ALL (To: PAR From: DB1);

  // PAR.USR Active Load = CND.yes
  PAR.USR_Active_Load = 'Y';

  QUIT;

  ENDIF;

 }

 //?error if carrier/trailer is already assigned
 CASE;

 // IF LCL.Load ID NE PAR.Load ID
 IF LCL.Load_ID <> PAR.Load_ID;

 // AND LCL.Load ID is NE Blank
 AND LCL.Load_ID <> *ZERO;

 // AND LCL.USR Active Load is yes
 AND LCL.USR_Active_Load = 'Y';

 // PGM.*Return code = CND.Trailer already assigned
 PGM.*Return_code = 'TRLRASN';

 // PAR.Load Id 1 = LCL.Load ID
 PAR.Load_Id_1 = LCL.Load_ID;

 QUIT;

 ENDIF;

 //?USER: Process Data record

 //?** Comments
 DO;

 //?** We are looking for a load with a container assigned that has the
 //?** same Carrier and Trailer ID as a Load Header record where
 //?** the load has not been shipped or invoiced.
 //?** If one is found, then pass back a flag that says a match
 //?** exists, otherwise, pass back a flag that there is no match.
 ENDDO;

 //?If container exists on another load that has not yet shipped
 CASE;

 // IF DB1.Load ID NE PAR.Load ID
 IF DB1.Load_ID <> PAR.Load_ID;

 EXECUTE FUNCTION(VAL Trailer assignmnt RT) TYPE(RTVOBJ) FILE(OMFJCPP)           AC2031954;
 PARAMETER(*ZERO);
 PARAMETER(DB1.OHE_Container_Number);
 PARAMETER(PAR.Carrier_Code_Usr);
 PARAMETER(LCL.USR_Load_ID);
 PARAMETER(PAR.Load_ID);
 {
  //?USER: Initialize routine

  //?***** Changes and comments
  DO;

  //?** 05/14/2012 LJB E002105
  //?** Restrict to Carrier/Trailer, okay if multiple carriers have
  //?** the same trailer id
  ENDDO;

  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.Trailer Available to assn
  PGM.*Return_code = 'TRLRAVL';

  //?USER: Process Data record

  CASE;

  // IF DB1.Load ID NE PAR.Load Id 2
  IF DB1.Load_ID <> PAR.Load_Id_2;

  CASE;

  // IF DB1.Load Status is Prior to Shipped
  IF DB1.Load_Status = 'C'/'E'/'L'/'U';

  // PGM.*Return code = CND.Trailer already assigned
  PGM.*Return_code = 'TRLRASN';

  // PAR.USR Load ID = DB1.Load ID
  PAR.USR_Load_ID = DB1.Load_ID;

  QUIT;

  ENDIF;

  ENDIF;

 }

 CASE;

 // IF PGM.*Return code is *Record already exists
 IF PGM.*Return_code = 'Y2U0003';

 // PGM.*Return code = CND.Trailer already assigned
 PGM.*Return_code = 'TRLRASN';

 // PAR.Load Id 1 = DB1.Load ID
 PAR.Load_Id_1 = DB1.Load_ID;

 QUIT;

 ENDIF;

 ENDIF;

}


