<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMEIPVR - Business Documentation (Sections 1-7)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
        <style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background-color: #f8f9fa;
}

.header {
    background: linear-gradient(135deg, #0066cc, #007bff);
    color: white;
    padding: 2rem;
    margin: -20px -20px 30px -20px;
    border-radius: 0 0 15px 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.header h1 { margin: 0; font-size: 2.5em; font-weight: 300; }
.header .subtitle { font-size: 1.2em; opacity: 0.9; margin-top: 10px; }

.meta-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.meta-item {
    background: rgba(255,255,255,0.2);
    padding: 10px 15px;
    border-radius: 8px;
}

.meta-item strong {
    display: block;
    font-size: 0.9em;
    opacity: 0.8;
}

.alert-banner {
    background: linear-gradient(45deg, #ffc107, #f39c12);
    color: #000;
    padding: 15px;
    margin: 20px 0;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
}

.executive-summary {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin: 30px 0;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.summary-card {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-left: 5px solid #0066cc;
}

.summary-card h3 { color: #2c3e50; margin-top: 0; }

.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.kpi-item {
    text-align: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.kpi-value {
    font-size: 2em;
    font-weight: bold;
    color: #0066cc;
}

.kpi-label {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
}

.toc {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin: 30px 0;
}

.toc ul { list-style: none; padding: 0; }
.toc li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; }
.toc a { color: #0066cc; text-decoration: none; font-weight: 500; }
.toc a:hover { color: #007bff; }

.section {
    background: white;
    margin: 30px 0;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.section h2 {
    color: #2c3e50;
    border-bottom: 3px solid #0066cc;
    padding-bottom: 10px;
    margin-bottom: 25px;
}

.section h3 { color: #34495e; margin-top: 25px; }

.function-analysis {
    background: #f8f9fa;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 20px;
    margin: 30px 0;
}

.function-header {
    background: #0066cc;
    color: white;
    padding: 20px;
    margin: -20px -20px 20px -20px;
    border-radius: 8px 8px 0 0;
}

.function-header h3 { margin: 0; color: white; }

table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

th {
    background: #0066cc;
    color: white;
    font-weight: 600;
}

tr:hover { background-color: #f8f9fa; }

.nav-link {
    display: inline-block;
    background: #0066cc;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    margin: 10px 5px;
    font-weight: 500;
    transition: all 0.3s;
}

.nav-link:hover {
    background: #007bff;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,102,204,0.3);
}

.highlight {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    border-left: 5px solid #ffc107;
    margin: 15px 0;
}

.priority-critical { color: #e74c3c; font-weight: bold; }
.priority-high { color: #f39c12; font-weight: bold; }
.priority-medium { color: #3498db; }
.priority-low { color: #95a5a6; }

@media (max-width: 768px) {
    .summary-grid, .meta-info, .kpi-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 2em; }
    body { padding: 10px; }
}
    </style>
</head>
<body>

<div class="header">
    <h1>OMEIPVR</h1>
    <div class="subtitle">IBM i Program Business Documentation</div>
    <div class="meta-info">
        <div class="meta-item"><strong>Object Type</strong>RPG Program</div>
        <div class="meta-item"><strong>Lines of Code</strong>1,492</div>
        <div class="meta-item"><strong>Functions</strong>24</div>
        <div class="meta-item"><strong>Generated</strong>October 14, 2025</div>
    </div>
</div>

<div class="alert-banner" style="background: linear-gradient(45deg, #28a745, #20c997); color: white;">
    COMPLETE DOCUMENTATION - All Sections Analyzed from Source Code
</div>


<div class="executive-summary">
    <h2>Executive Summary</h2>
    <p><strong>Program Overview:</strong> OMEIPVR is a prompt and validation program for the "Print Loads Shipped Report" function. It provides an interactive screen interface for users to specify report parameters (company number, date range) and submit print jobs for shipped loads reporting.</p>

    <div class="summary-grid">
        <div class="summary-card">
            <h3>Business Value</h3>
            <ul>
                <li>Validates shipping report parameters before print submission</li>
                <li>Ensures data integrity through company and date validation</li>
                <li>Streamlines report generation process for shipping operations</li>
                <li>Provides user-friendly prompting for report criteria</li>
            </ul>
        </div>

        <div class="summary-card">
            <h3>System Scale</h3>
            <ul>
                <li><strong>Functions:</strong> 24 subroutines</li>
                <li><strong>Code Lines:</strong> 1,492</li>
                <li><strong>Database Files:</strong> 7 input files</li>
                <li><strong>External Calls:</strong> 10+ program integrations</li>
            </ul>
        </div>

        <div class="summary-card">
            <h3>Operational Impact</h3>
            <ul>
                <li>Shipping department users submit load reports daily</li>
                <li>Supports multi-company and multi-warehouse operations</li>
                <li>Enables date range reporting for shipped loads</li>
                <li>Integrates with print management subsystem (PDOWUPR)</li>
            </ul>
        </div>
    </div>

    <h3>Key Performance Indicators</h3>
    <div class="kpi-grid">
        <div class="kpi-item"><div class="kpi-value">1,492</div><div class="kpi-label">Lines of Code</div></div>
        <div class="kpi-item"><div class="kpi-value">24</div><div class="kpi-label">Functions</div></div>
        <div class="kpi-item"><div class="kpi-value">7</div><div class="kpi-label">Database Files</div></div>
        <div class="kpi-item"><div class="kpi-value">10+</div><div class="kpi-label">Program Calls</div></div>
    </div>
</div>


<div class="toc">
    <h3>Table of Contents</h3>
    <ul>
        <li><a href="#context">1. Business Context and Overview</a></li>
        <li><a href="#inputs">2. Inputs (Primary and Optional)</a></li>
        <li><a href="#structure">3. Structure Overview and Components</a></li>
        <li><a href="#logic-summary">4. Business Logic Summary</a></li>
        <li><a href="#logic-flow">5. Detailed Logic Flow and Process Diagrams</a></li>
        <li><a href="#data-interaction">6. Data Operations</a></li>
        <li><a href="#dependencies">7. System Dependencies</a></li>
        <li><strong><a href="OMEIPVR_Section_8_Functions.html" class="nav-link" style="display:inline; padding:5px 10px;">8. Functions (24) →</a></strong></li>
    </ul>
</div>


<div class="section" id="context">
    <h2>1. Business Context and Overview</h2>

    <h3>Executive Summary</h3>
    <p><strong>Program Title:</strong> PRT Loads Shipped Rpt PV - Prompt & Validate Record</p>
    <p><strong>Function Type:</strong> Interactive prompt and validation screen for report generation</p>
    <p><strong>Development Origin:</strong> Generated by CA 2E release 8.5 (Synon CASE tool)</p>
    <p><strong>System:</strong> OMS Development Model - Order Management System</p>

    <h3>Business Purpose</h3>
    <p>OMEIPVR serves as the user interface gateway for generating shipped loads reports. The program:</p>
    <ul>
        <li><strong>Prompts users</strong> for report criteria including company number, date range (from/thru dates)</li>
        <li><strong>Validates inputs</strong> against business rules: valid company numbers, proper date formats, logical date sequences</li>
        <li><strong>Retrieves reference data</strong> including company names, country codes, user profiles, and application access rights</li>
        <li><strong>Submits print jobs</strong> to the print management subsystem (PDOWUPR) with validated parameters</li>
        <li><strong>Manages user experience</strong> with help text display, field prompting (F4), and error message handling</li>
    </ul>

    <h3>Key Business Functions</h3>
    <ul>
        <li><strong>Data Validation (9 functions):</strong> Company validation, date validation, plant company status checks, reference file validation</li>
        <li><strong>Screen Management (5 functions):</strong> Display screen formatting, cursor positioning, help text display, field attribute control</li>
        <li><strong>Data Retrieval (6 functions):</strong> Company name lookup, user profile retrieval, application profile access, country validation</li>
        <li><strong>Report Submission (1 function):</strong> Package parameters and submit to print queue via PDOWUPR</li>
        <li><strong>Program Control (3 functions):</strong> Initialization, exit handling, message queue management</li>
    </ul>
</div>


<div class="section" id="inputs">
    <h2>2. Inputs (Primary and Optional)</h2>

    <h3>2.1 Primary Inputs</h3>
    <p><strong>Entry Parameter:</strong></p>
    <ul>
        <li><strong>P0RTN</strong> (7 characters) - Return code parameter passed between programs</li>
    </ul>

    <p><strong>Screen Input Fields (OMEIPVR#CF):</strong></p>
    <ul>
        <li><strong>#DATNB</strong> - Company Number (3-digit packed decimal)</li>
        <li><strong>#DBDDT</strong> / VDBDDT - From Date (internal/external format)</li>
        <li><strong>#DBEDT</strong> / VDBEDT - Through Date (internal/external format)</li>
        <li><strong>#1KXCD</strong> - Country Code (optional)</li>
    </ul>

    <p><strong>Database Files (F-specs):</strong></p>
    <ul>
        <li><strong>OMEIPVR#CF</strong> - Workstation display file (screen interface)</li>
        <li><strong>OME5REL2IF</strong> - Country master file (active records only)</li>
        <li><strong>CAABREL3IF</strong> - Company Name and Address retrieval file</li>
        <li><strong>PDJYREL2IF</strong> - Company Defaults Internal (active records)</li>
        <li><strong>CADRREL1IF</strong> - User Profile Control file</li>
        <li><strong>CADTREL1IF</strong> - User Application Profile file</li>
        <li><strong>CADNREL2IF</strong> - Application master file (RSQ Application Code)</li>
    </ul>

    <h3>2.2 Optional Inputs</h3>
    <p><strong>Passed Parameters (P1PARM, P2PARM, P3PARM):</strong></p>
    <ul>
        <li><strong>P1AJCD</strong> - Warehouse Code</li>
        <li><strong>P1AIC3</strong> - Company Number (from user profile/application profile)</li>
        <li><strong>P1DNCD</strong> - Application Code</li>
        <li><strong>P1B8NA</strong> - System Date Format (DMY/MDY/YMD)</li>
        <li><strong>P1AJVN</strong> - User Profile Name</li>
        <li><strong>P1I6ST</strong> - Allow Multi-Company flag (Y/N)</li>
        <li><strong>P1MPNA</strong> - Default Printer name</li>
        <li><strong>P2G3TX</strong> - Print Description text</li>
        <li><strong>P2WRST</strong> - Printer Device name</li>
        <li><strong>P2WSST</strong> - Hold Output Status</li>
        <li><strong>P2WTST</strong> - Save Output Status</li>
        <li><strong>P2DYNB</strong> - Number of Copies</li>
        <li><strong>P2WUST</strong> - Night Queue Run Status</li>
        <li><strong>P2BVVN</strong> - Night Queue name</li>
        <li><strong>P3ADTX</strong> - Company Name (retrieved)</li>
    </ul>

    <p><strong>System Inputs:</strong></p>
    <ul>
        <li><strong>##USR</strong> - Current user profile name from job</li>
        <li><strong>##SD7</strong> - System date (7-digit format)</li>
        <li><strong>##JTM</strong> - Job time</li>
        <li><strong>XDDTFM</strong> - System date format setting (from data area Y2DTFMA)</li>
        <li><strong>XOFF</strong> - Century cut-off year (from data area Y2CTOFF)</li>
    </ul>
</div>


<div class="section" id="structure">
    <h2>3. Structure Overview and Components</h2>

    <h3>Component Organization</h3>
    <table>
        <thead>
            <tr><th>Category</th><th>Functions</th><th>Purpose</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>Business Logic</td>
                <td>9</td>
                <td>Validates company numbers, checks plant company status, verifies date ranges, performs field-level validation</td>
            </tr>
            <tr>
                <td>Data Retrieval</td>
                <td>6</td>
                <td>Retrieves company names, user profiles, application profiles, country codes, warehouse assignments, application descriptions</td>
            </tr>
            <tr>
                <td>Initialization</td>
                <td>1</td>
                <td>Program startup: retrieves job attributes, user profile, application access, default parameters, loads screen</td>
            </tr>
            <tr>
                <td>Messaging</td>
                <td>1</td>
                <td>Sends error/info/completion messages to program message queue with data formatting</td>
            </tr>
            <tr>
                <td>Program Control</td>
                <td>2</td>
                <td>Exit program processing, reclaim resources, return to caller with status codes</td>
            </tr>
            <tr>
                <td>Screen Control</td>
                <td>4</td>
                <td>Cursor positioning, field attribute control, prompt request handling, help text display</td>
            </tr>
            <tr>
                <td>User Interface</td>
                <td>1</td>
                <td>Main screen display loop with format conversion, HELP processing, prompt handling, message display</td>
            </tr>
        </tbody>
    </table>

    <h3>Program Call Tree Structure</h3>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Main[OMEIPVR<br/>Main Entry] --> ZZINIT[ZZINIT<br/>Initialize]
    Main --> Loop{Screen<br/>Conversation<br/>Loop}

    Loop --> MNCV#1[MNCV#1<br/>Convert to External]
    MNCV#1 --> XDVC2T[XDVC2T<br/>Date Conversion]

    Loop --> CAEXFM[CAEXFM<br/>Display Screen]
    CAEXFM --> GADSA1[GADSA1<br/>Set Display Attributes]
    CAEXFM --> Y0SET[Y0SET<br/>Set Cursor]
    CAEXFM --> Y8TST[Y8TST<br/>Test Cursor]
    CAEXFM --> ZDVPMT[ZDVPMT<br/>Process Prompt]
    CAEXFM --> ZHHPKY[ZHHPKY<br/>Display Help]
    CAEXFM --> Y9CLR[Y9CLR<br/>Clear Cursor]

    Loop --> Response{User<br/>Response}
    Response -->|Cancel/F3| ZXEXPG[ZXEXPG<br/>Cancel Exit]
    Response -->|HOME| MALDSC[MALDSC<br/>Load Screen]
    Response -->|Process| DAPRSC[DAPRSC<br/>Process Screen]

    MALDSC --> SARVGN[SARVGN<br/>Retrieve Company]

    DAPRSC --> DBVLSC[DBVLSC<br/>Validate Screen]
    DBVLSC --> XDCK2[XDCK2<br/>Check Date]
    DBVLSC --> VACKRL[VACKRL<br/>Select Record]
    DBVLSC --> VBCKRL[VBCKRL<br/>Check Country]
    DBVLSC --> SARVGN2[SARVGN<br/>Retrieve Company]
    DBVLSC --> SBRVGN[SBRVGN<br/>Plant Co Status]

    DAPRSC --> Submit[Submit Print Job<br/>CALL PDOWUPR]

    ZZINIT --> SCRVGN[SCRVGN<br/>Retrieve User Profile]
    ZZINIT --> SDRVGN[SDRVGN<br/>Retrieve Appl Profile]
    ZZINIT --> SERVGN[SERVGN<br/>Retrieve Appl Desc]
    SERVGN --> SFRVGN[SFRVGN<br/>Retrieve App Group]
    ZZINIT --> MALDSC2[MALDSC<br/>Load Screen]

    ZXEXPG --> ZYEXPG[ZYEXPG<br/>Exit Program]

    ZASNMS[ZASNMS<br/>Send Message]

    style Main fill:#2e8b57,stroke:#1e5d3a,color:#fff
    style Loop fill:#0066cc,stroke:#004499,color:#fff
    style Response fill:#ffc107,stroke:#f39c12,color:#000
    style Submit fill:#e74c3c,stroke:#c0392b,color:#fff
        </pre>
    </div>
    <p><em>This diagram shows the main execution flow. ZASNMS (messaging) is called from multiple functions as needed for error/info messages.</em></p>
</div>


<div class="section" id="logic-summary">
    <h2>4. Business Logic Summary</h2>

    <h3>Primary Business Workflow</h3>
    <p>The OMEIPVR program follows a conversational screen processing pattern with the following workflow:</p>

    <ol>
        <li><strong>Initialization (ZZINIT):</strong>
            <ul>
                <li>Retrieve job attributes (date, time, user profile)</li>
                <li>Validate user access to OMS application</li>
                <li>Retrieve user profile control settings (company, warehouse, printer defaults)</li>
                <li>Check multi-company authorization flag</li>
                <li>Retrieve application profile for default company and warehouse</li>
                <li>Load application description for screen header</li>
                <li>Initialize screen with default values</li>
            </ul>
        </li>

        <li><strong>Screen Conversation Loop:</strong>
            <ul>
                <li>Convert internal dates to display format (MNCV#1 → XDVC2T)</li>
                <li>Set display attributes based on multi-company flag (GADSA1)</li>
                <li>Display screen and wait for user input (CAEXFM)</li>
                <li>Process help requests (F1/HELP key → ZHHPKY)</li>
                <li>Process field prompts (F4 key → ZDVPMT)</li>
                <li>Handle cursor positioning (Y0SET, Y8TST, Y9CLR)</li>
            </ul>
        </li>

        <li><strong>User Response Processing:</strong>
            <ul>
                <li><strong>Cancel (F3):</strong> Exit program via ZXEXPG → ZYEXPG</li>
                <li><strong>HOME Key:</strong> Reset screen fields via MALDSC</li>
                <li><strong>ENTER:</strong> Process screen input via DAPRSC</li>
            </ul>
        </li>

        <li><strong>Input Validation (DBVLSC):</strong>
            <ul>
                <li>Validate From Date format and value (XDCK2) - check month 1-12, day range, leap year logic</li>
                <li>Validate Through Date format and value (XDCK2)</li>
                <li>Verify From Date ≤ Through Date (logical sequence)</li>
                <li>Check required fields (company, both dates)</li>
                <li>Handle F4 prompt on company field (call PPF2SRR for company selection if multi-company allowed)</li>
                <li>Validate company number exists (SARVGN → CAABREL3IF)</li>
                <li>Check if company is a plant company (SBRVGN → PDJYREL2IF)</li>
                <li>Validate country code if entered (VBCKRL → OME5REL2IF)</li>
                <li>Send error messages for validation failures (ZASNMS)</li>
            </ul>
        </li>

        <li><strong>Print Job Submission (DAPRSC):</strong>
            <ul>
                <li>Package all parameters (company, dates, printer settings)</li>
                <li>Call PDOWUPR to submit report to print queue</li>
                <li>Handle submission errors with message USR1832 "Print has been Submitted"</li>
                <li>Return to screen loop for next transaction</li>
            </ul>
        </li>
    </ol>

    <h3>Key Business Rules</h3>
    <ul>
        <li>Users must have an OMS application profile (CADTREL1IF) to access the program</li>
        <li>Company number validation requires active company record in CAABREL3IF</li>
        <li>Only "Plant Company" status companies are accepted (WAYISX field = 'P')</li>
        <li>Date validation uses system date format (DMY/MDY/YMD) and century cut-off year logic</li>
        <li>From Date must not exceed Through Date</li>
        <li>Multi-company access controlled by P1I6ST flag in user profile</li>
        <li>F4 prompt for company selection only available when multi-company access is allowed</li>
    </ul>
</div>


<div class="section" id="logic-flow">
    <h2>5. Detailed Logic Flow and Process Diagrams</h2>

    <h3>Business Process Flow Diagram</h3>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Start([Program Entry]) --> Init[ZZINIT: Initialize Program]
    Init --> GetJob[Retrieve Job Attributes<br/>User, Date, Time]
    GetJob --> CheckUser{User Profile<br/>Exists?}
    CheckUser -->|No| DenyAccess[Send USR0810<br/>Access Denied]
    DenyAccess --> ExitError([Exit with Error])
    CheckUser -->|Yes| GetAppProfile[Retrieve Application Profile<br/>Company, Warehouse]
    GetAppProfile --> LoadScreen[Load Default Values<br/>MALDSC]

    LoadScreen --> ScreenLoop{Screen<br/>Conversation<br/>Loop}
    ScreenLoop --> ConvertDates[MNCV#1: Convert Dates<br/>to Display Format]
    ConvertDates --> SetAttrib[GADSA1: Set Display<br/>Attributes]
    SetAttrib --> DisplayScreen[CAEXFM: Display Screen<br/>Wait for Input]

    DisplayScreen --> CheckKey{Which Key<br/>Pressed?}
    CheckKey -->|F1/HELP| ShowHelp[ZHHPKY: Display Help Text]
    ShowHelp --> DisplayScreen
    CheckKey -->|F4 on Company| CheckMulti{Multi-Company<br/>Allowed?}
    CheckMulti -->|Yes| PromptCompany[Call PPF2SRR<br/>Company Selection]
    CheckMulti -->|No| ErrorPrompt[Send USR2410<br/>Prompt Not Allowed]
    PromptCompany --> DisplayScreen
    ErrorPrompt --> DisplayScreen
    CheckKey -->|F3/Cancel| CancelExit[ZXEXPG → ZYEXPG<br/>Exit Program]
    CancelExit --> End([Program End])
    CheckKey -->|HOME| ResetScreen[MALDSC: Reset<br/>Screen Fields]
    ResetScreen --> ScreenLoop
    CheckKey -->|ENTER| ValidateInput[DBVLSC: Validate Input]

    ValidateInput --> CheckFromDate{From Date<br/>Valid?}
    CheckFromDate -->|No| ErrorFromDate[XDCK2: Send Y2U0006<br/>Invalid Date]
    ErrorFromDate --> ScreenLoop
    CheckFromDate -->|Yes| CheckThruDate{Through Date<br/>Valid?}
    CheckThruDate -->|No| ErrorThruDate[XDCK2: Send Y2U0006<br/>Invalid Date]
    ErrorThruDate --> ScreenLoop
    CheckThruDate -->|Yes| CheckSequence{From ≤ Through?}
    CheckSequence -->|No| ErrorSequence[Send USR0319<br/>From Exceeds To]
    ErrorSequence --> ScreenLoop
    CheckSequence -->|Yes| ValidateCompany[SARVGN: Retrieve<br/>Company Name]

    ValidateCompany --> CompanyExists{Company<br/>Found?}
    CompanyExists -->|No| ErrorCompany[Send USR0163<br/>Company Not Found]
    ErrorCompany --> ScreenLoop
    CompanyExists -->|Yes| CheckPlant[SBRVGN: Check<br/>Plant Company]
    CheckPlant --> IsPlant{Plant<br/>Company?}
    IsPlant -->|No| ErrorPlant[Send USR1783<br/>Invalid Company]
    ErrorPlant --> ScreenLoop
    IsPlant -->|Yes| ValidCountry{Country Code<br/>Entered?}
    ValidCountry -->|Yes| CheckCountry[VBCKRL: Validate<br/>Country Code]
    CheckCountry --> CountryValid{Country<br/>Valid?}
    CountryValid -->|No| ErrorCountry[Send USR1158<br/>Country NF]
    ErrorCountry --> ScreenLoop
    CountryValid -->|Yes| PackageParams
    ValidCountry -->|No| PackageParams[Package Parameters<br/>for Print]

    PackageParams --> SubmitPrint[Call PDOWUPR<br/>Submit Print Job]
    SubmitPrint --> CheckSubmit{Submission<br/>Success?}
    CheckSubmit -->|Error| ErrorSubmit[Send Y2U0032<br/>Call Error]
    ErrorSubmit --> ScreenLoop
    CheckSubmit -->|Success| ConfirmSubmit[Send USR1832<br/>Print Submitted]
    ConfirmSubmit --> ScreenLoop

    style Start fill:#d4edda,stroke:#28a745
    style End fill:#d1ecf1,stroke:#17a2b8
    style ExitError fill:#f8d7da,stroke:#dc3545
    style DenyAccess fill:#fff3cd,stroke:#ffc107
    style ErrorFromDate fill:#fff3cd,stroke:#ffc107
    style ErrorThruDate fill:#fff3cd,stroke:#ffc107
    style ErrorSequence fill:#fff3cd,stroke:#ffc107
    style ErrorCompany fill:#fff3cd,stroke:#ffc107
    style ErrorPlant fill:#fff3cd,stroke:#ffc107
    style ErrorCountry fill:#fff3cd,stroke:#ffc107
    style ErrorSubmit fill:#fff3cd,stroke:#ffc107
    style ConfirmSubmit fill:#d1ecf1,stroke:#17a2b8
        </pre>
    </div>
    <p><em>This comprehensive flow diagram shows all validation steps, error paths, and the main business process from screen display through print job submission.</em></p>
</div>


<div class="section" id="data-interaction">
    <h2>6. Data Operations and Business Information Flow</h2>

    <h3>Database Access Patterns</h3>
    <p>The program performs READ-ONLY operations across multiple database files for validation and reference data retrieval:</p>

    <table>
        <thead>
            <tr><th>File Name</th><th>Access Method</th><th>Purpose</th><th>Key Fields</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>OMEIPVR#CF</td>
                <td>EXFMT (Screen I/O)</td>
                <td>Display screen format #RCDDTL1 for user input/output</td>
                <td>N/A (Workstation)</td>
            </tr>
            <tr>
                <td>CAABREL3IF</td>
                <td>CHAIN (@ABREG3)</td>
                <td>Retrieve company name and address by company number</td>
                <td>ABAIC3 (Company Number)</td>
            </tr>
            <tr>
                <td>PDJYREL2IF</td>
                <td>CHAIN (@JYRECE)</td>
                <td>Retrieve company defaults to check plant company status</td>
                <td>WAAIC3 (Company Number)</td>
            </tr>
            <tr>
                <td>CADRREL1IF</td>
                <td>CHAIN (@DRRETH)</td>
                <td>Retrieve user profile control settings (multi-company flag, printer)</td>
                <td>WBAJVN (User Profile Name)</td>
            </tr>
            <tr>
                <td>CADTREL1IF</td>
                <td>CHAIN (@DTRETE)</td>
                <td>Retrieve user application profile (default company, warehouse)</td>
                <td>WCAJVN + WCDNCD (User + Application)</td>
            </tr>
            <tr>
                <td>CADNREL2IF</td>
                <td>SETLL + READE (@DNRESF)</td>
                <td>Read application and application group descriptions</td>
                <td>WDDNCD (Application Code = 'OMS')</td>
            </tr>
            <tr>
                <td>OME5REL2IF</td>
                <td>CHAIN (@E5REVS)</td>
                <td>Validate country code against active country master</td>
                <td>E5KXCD (Country Code)</td>
            </tr>
        </tbody>
    </table>

    <h3>Data Flow Patterns</h3>
    <ul>
        <li><strong>Initialization Phase:</strong>
            <ul>
                <li>IN operation reads data areas (XDDTFM, XOFF, ZADFMF, ##CMP)</li>
                <li>CHAIN operations retrieve user profile (CADRREL1IF) and application profile (CADTREL1IF)</li>
                <li>SETLL/READE operations read application descriptions (CADNREL2IF)</li>
            </ul>
        </li>
        <li><strong>Validation Phase:</strong>
            <ul>
                <li>CHAIN to CAABREL3IF validates company number and retrieves company name</li>
                <li>CHAIN to PDJYREL2IF checks plant company status (WAYISX field)</li>
                <li>CHAIN to OME5REL2IF validates country code if entered</li>
            </ul>
        </li>
        <li><strong>Screen I/O:</strong>
            <ul>
                <li>WRITE operations output message control (#MSGCTL) and command text (#CMDTXT1)</li>
                <li>EXFMT operation displays screen and accepts input (#RCDDTL1)</li>
            </ul>
        </li>
        <li><strong>No Updates:</strong> This program is strictly READ-ONLY for database files; no WRITE, UPDATE, or DELETE operations to database tables</li>
    </ul>

    <h3>Data Transformations</h3>
    <ul>
        <li><strong>Date Conversion:</strong> Internal 7-digit dates (CYMD) ↔ External display format (based on XDDTFM: DMY/MDY/YMD)</li>
        <li><strong>Century Logic:</strong> 2-digit years before cut-off (XOFFYY) treated as 20YY, otherwise 19YY</li>
        <li><strong>Numeric Formatting:</strong> Company numbers displayed with leading zeros suppressed using edit array (#L3)</li>
        <li><strong>Text Centering:</strong> Application description centered in 40-character header field (UCT array)</li>
    </ul>
</div>


<div class="section" id="dependencies">
    <h2>7. System Dependencies and Business Relationships</h2>

    <h3>External Program Dependencies</h3>
    <p>OMEIPVR integrates with multiple external programs through CALL statements:</p>

    <table>
        <thead>
            <tr><th>Program Name</th><th>Purpose</th><th>Called From</th><th>Parameters</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>PDOWUPR</strong></td>
                <td>Print management: Submit job to print queue</td>
                <td>DAPRSC (line 380)</td>
                <td>13 params: Return code, Application, Program name, Description, Printer settings, Company, Dates, System values</td>
            </tr>
            <tr>
                <td><strong>PPF2SRR</strong></td>
                <td>Company selection prompt (F4 on company field)</td>
                <td>DBVLSC (line 454)</td>
                <td>2 params: Return code, Company number (I/O)</td>
            </tr>
            <tr>
                <td><strong>PDL7SRR</strong></td>
                <td>Company selection for search (name search)</td>
                <td>VACKRL (line 864)</td>
                <td>2 params: Return code, Company number (I/O)</td>
            </tr>
            <tr>
                <td><strong>PDEGSRR</strong></td>
                <td>Country code selection/validation</td>
                <td>VBCKRL (line 908)</td>
                <td>2 params: Return code, Country code (I/O)</td>
            </tr>
            <tr>
                <td><strong>PNKDXFR</strong></td>
                <td>Retrieve production warehouse for company</td>
                <td>ZZINIT (line 1423)</td>
                <td>3 params: Return code, Warehouse code (I/O), Shipping company</td>
            </tr>
            <tr>
                <td><strong>Y2RTJCR</strong></td>
                <td>Retrieve job attributes (date, time, user, etc.)</td>
                <td>ZZINIT (line 1255)</td>
                <td>1 param: Program data structure (PGMDS)</td>
            </tr>
            <tr>
                <td><strong>Y2CLMSC</strong></td>
                <td>Clear messages from program message queue</td>
                <td>CAEXFM (line 329)</td>
                <td>2 params: Program queue name, Relative queue level</td>
            </tr>
            <tr>
                <td><strong>Y2SNMGC</strong></td>
                <td>Send message to program message queue</td>
                <td>ZASNMS (line 1105)</td>
                <td>6 params: Program queue, Rel queue, Message ID, Message file, Message data, Message type</td>
            </tr>
            <tr>
                <td><strong>YDDSHPR</strong></td>
                <td>Display help text for screen fields</td>
                <td>ZHHPKY (line 1175)</td>
                <td>9 params: Help member name, File, Library, Return code, Label, Options, Row, Column, Label groups</td>
            </tr>
            <tr>
                <td><strong>Y2RCRSC</strong></td>
                <td>Reclaim resources of called programs</td>
                <td>ZYEXPG (line 1207)</td>
                <td>No parameters</td>
            </tr>
            <tr>
                <td><strong>Y2QLVNR</strong></td>
                <td>Qualify file name with library</td>
                <td>ZZINIT (line 1308)</td>
                <td>3 params: File name, Library name, Qualified name (output)</td>
            </tr>
        </tbody>
    </table>

    <h3>Data Area Dependencies</h3>
    <ul>
        <li><strong>Y2DTFMA</strong> - System date format (DMY/MDY/YMD) - Read during initialization</li>
        <li><strong>Y2CTOFF</strong> - Century cut-off year for date conversion - Read during initialization</li>
        <li><strong>YYCOTXA</strong> - Company context data area - Read during initialization</li>
        <li><strong>CAMGFLA</strong> - Default message file name - Read during initialization</li>
    </ul>

    <h3>File Dependencies</h3>
    <ul>
        <li><strong>OMEIPVRH</strong> - Help text member (used by YDDSHPR for F1/HELP key)</li>
        <li><strong>Y2USRMSG</strong> - Default user message file for standard messages</li>
        <li><strong>Custom Message Files</strong> - Application-specific message files for business error messages (USR0163, USR0319, USR0763, USR0767, USR0810, USR1158, USR1783, USR1832, USR2025, USR2410)</li>
    </ul>

    <h3>Integration Points</h3>
    <ul>
        <li><strong>Upstream:</strong> Called by menu programs or workflow processes that need to generate shipped loads reports</li>
        <li><strong>Downstream:</strong> PDOWUPR submits report generation job (likely OMEIPVR or related report program) to batch queue</li>
        <li><strong>Security:</strong> Access controlled through CADRREL1IF (User Profile Control) and CADTREL1IF (User Application Profile)</li>
        <li><strong>Company Security:</strong> Multi-company access determined by P1I6ST flag in user profile</li>
    </ul>

    <h3>Modernization Considerations</h3>
    <p><strong>Migration Complexity: MODERATE</strong></p>

    <h4>Strengths for Modernization:</h4>
    <ul>
        <li><strong>Clear separation of concerns:</strong> Screen handling, validation, and business logic are well-separated</li>
        <li><strong>READ-ONLY operations:</strong> No database updates simplifies migration</li>
        <li><strong>Standard CA 2E patterns:</strong> Well-documented code generation patterns</li>
        <li><strong>Subroutine modularity:</strong> 24 functions with clear responsibilities</li>
    </ul>

    <h4>Challenges for Modernization:</h4>
    <ul>
        <li><strong>Screen file dependency:</strong> 5250 green-screen format requires web/mobile UI redesign</li>
        <li><strong>Multiple external calls:</strong> 11 external programs need API wrappers or replacement</li>
        <li><strong>Date conversion logic:</strong> Complex legacy date handling (CYMD format, century cut-off)</li>
        <li><strong>Message queue architecture:</strong> Program message queues need modern notification system</li>
        <li><strong>Data area dependencies:</strong> Configuration data areas need modern config management</li>
    </ul>

    <h4>Recommended Migration Path:</h4>
    <ol>
        <li><strong>Phase 1:</strong> Extract business rules into service layer (date validation, company validation)</li>
        <li><strong>Phase 2:</strong> Create REST APIs for external program calls (PDOWUPR, PPF2SRR, etc.)</li>
        <li><strong>Phase 3:</strong> Design modern UI (web form) matching 5250 screen functionality</li>
        <li><strong>Phase 4:</strong> Replace message queue with logging/notification service</li>
        <li><strong>Phase 5:</strong> Migrate database file reads to SQL queries/stored procedures</li>
        <li><strong>Phase 6:</strong> Implement new date handling using modern date/time libraries</li>
    </ol>

    <h4>Reusable Components:</h4>
    <ul>
        <li>Company validation logic (SARVGN, SBRVGN, VACKRL)</li>
        <li>Date validation rules (XDCK2)</li>
        <li>User profile/security checks (SCRVGN, SDRVGN)</li>
        <li>Business error messages (all USR* message IDs)</li>
    </ul>
</div>


<div style="text-align: center; margin: 50px 0;">
    <a href="OMEIPVR_Section_8_Functions.html" class="nav-link" style="font-size: 1.1em; padding: 15px 30px;">
        Continue to Section 8: Detailed Functions Analysis (24 Functions) →
    </a>
</div>

</body>
</html>
