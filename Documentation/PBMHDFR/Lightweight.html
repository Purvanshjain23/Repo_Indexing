<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PBMHDFR - Business Documentation</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true,theme:'default'});</script>
<style>
body{font-family:'Segoe UI',Calibri,sans-serif;max-width:1200px;margin:20px auto;padding:20px;background:#f8f9fa;line-height:1.6;}
.header{background:linear-gradient(135deg,#0066cc,#007bff);color:white;padding:25px;margin:-20px -20px 30px -20px;border-radius:0 0 12px 12px;}
h1{margin:0;font-size:2.2em;color:#fff;}
.subtitle{font-size:1.1em;margin-top:8px;opacity:0.9;}
h2{color:#2c3e50;border-bottom:3px solid #0066cc;padding-bottom:8px;margin-top:30px;}
h3{color:#0066cc;margin-top:20px;}
h4{color:#555;margin-top:15px;font-size:1.05em;}
.info-box{background:#e7f3ff;padding:15px;margin:15px 0;border-left:5px solid #0066cc;border-radius:5px;}
.highlight{background:#fff3cd;padding:15px;margin:15px 0;border-left:5px solid #ffc107;border-radius:5px;}
.func{background:white;padding:20px;margin:20px 0;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.func-header{background:#0066cc;color:white;padding:12px 15px;margin:-20px -20px 15px -20px;border-radius:8px 8px 0 0;}
.func-header h3{color:white;margin:0;}
.func-header p{margin:5px 0 0 0;opacity:0.9;}
.mermaid{background:#fafafa;padding:20px;border-radius:8px;margin:15px 0;border:1px solid #e0e0e0;}
table{width:100%;border-collapse:collapse;margin:15px 0;}
th{background:#0066cc;color:white;padding:10px;text-align:left;}
td{padding:10px;border-bottom:1px solid #ddd;}
tr:hover{background:#f8f9fa;}
.process-narrative{background:#f8f9fa;padding:20px;margin:20px 0;border-radius:8px;border-left:4px solid #0066cc;}
</style></head><body>

<div class="header">
<h1>PBMHDFR</h1>
<div class="subtitle">Business Process Documentation for Non-Technical Users</div>
<p style="margin-top:10px;opacity:0.9;">Lines: 4869 | Functions: 39 | IBM i RPG Program</p>
</div>

<!-- AI_MARKER: Section1_BusinessContext -->
<h2>1. Business Context and Overview</h2>
<p><strong>Executive Summary:</strong> PBMHDFR is a warehouse load planning screen that displays item details for scheduled shipping loads. It allows warehouse staff to view and manage items planned for loading onto trucks, organized by company, warehouse, and scheduled ship date. The program presents data in an interactive subfile format where users can browse through items and take actions based on what needs to be loaded.</p>
<p><strong>Business Purpose:</strong> This program supports warehouse loading operations by providing visibility into which items need to be loaded onto specific shipments. It helps warehouse teams coordinate loading activities, verify item availability, and ensure orders are shipped according to schedule. The program integrates with the order management system to display real-time load planning data.</p>
<p><strong>Key Business Functions:</strong> Display items scheduled for loading in a paginated subfile format; filter load plans by company, warehouse, and ship date; allow warehouse staff to drill down into item details; support multi-warehouse and multi-company operations; validate user access to specific warehouses; provide interactive navigation through large item lists.</p>

<!-- AI_MARKER: Section2_Inputs -->
<h2>2. Inputs and Data Sources</h2>
<h3>Primary Data Sources</h3>
<p><strong>Database Files:</strong></p>
<ul>
<li><strong>OMFJCPMT</strong> - Load Header file containing load scheduling and carrier information (Load ID, Scheduled Ship Date, Carrier Code)</li>
<li><strong>OMFLCPL1</strong> - Load Detail file with specific item information for each load</li>
<li><strong>OPBFCPL8</strong> - Order Header file linking loads to customer orders</li>
<li><strong>OPBGWKL1 / OPBGWKLA</strong> - Order Detail files containing item quantities, weights, and order line details</li>
<li><strong>CAADREL3</strong> - Warehouse Codes master file for warehouse validation</li>
<li><strong>OMBYREL1</strong> - Item Default file for item master data</li>
<li><strong>PDL1REL1</strong> - User Warehouse Access security file to control which warehouses users can access</li>
<li><strong>CADTREL1 / CADNREL2</strong> - User Application Profile and Application security files</li>
<li><strong>CAABREL3 / CADRREL1</strong> - Company Name and User Profile Control files</li>
</ul>
<h3>Required Input Parameters</h3>
<p><strong>P1AIC3 (Company Number):</strong> 3-digit company code identifying which company's load data to display</p>
<p><strong>P6AODT (Scheduled Ship Date):</strong> Date for which load planning items should be displayed (format: CYMD)</p>
<p><strong>P6VPCD (Ship From Warehouse):</strong> 3-character warehouse code specifying the shipping location</p>
<h3>Optional Parameters / Screen Inputs</h3>
<p><strong>P1DQCD/P1DRCD:</strong> Enterprise Code filters for multi-enterprise operations</p>
<p><strong>P1BCCD:</strong> Salesperson Code for filtering by sales representative</p>
<p><strong>P1AJVN:</strong> User Profile Name for security validation</p>
<p><strong>P1I6ST/P1I8ST:</strong> Multi-Company/Multi-Warehouse authorization flags</p>
<p><strong>P6RMNB (Load ID):</strong> Specific load number for drilling down to individual load details</p>
<p><strong>P6BZNA (Carrier Code):</strong> Carrier selection for filtering loads by shipping carrier</p>
<h3>User Interaction / Function Keys</h3>
<p><strong>F3 (Exit):</strong> Cancel and exit the program (indicator 03)</p>
<p><strong>F12 (Cancel):</strong> Return to previous screen without saving changes</p>
<p><strong>HOME Key:</strong> Request subfile reload to refresh data from database (indicator 30)</p>
<p><strong>Page Up/Down:</strong> Navigate through subfile pages when item list exceeds screen capacity (indicator 27 for next page)</p>
<p><strong>Enter Key:</strong> Process screen input and selections made by user</p>

<!-- AI_MARKER: Section3_Structure -->
<h2>3. Program Structure and Organization</h2>
<h3>How the Program is Organized</h3>
<p><strong>Main Control Flow:</strong> The program follows a classic display file/subfile pattern with initialization (ZZINIT), subfile loading (BAIZSF, BBLDSF), screen display (CAEXFM), and response processing (DAPR##). It loops continuously until the user exits.</p>
<p><strong>Function Categories:</strong></p>
<ul>
<li><strong>Initialization Functions (2):</strong> ZZINIT (program startup), BAIZSF (subfile initialization and first page load)</li>
<li><strong>Subfile Management (2):</strong> BBLDSF (build/load additional subfile pages), FBRQRL (reload request handler)</li>
<li><strong>Display & Processing (2):</strong> CAEXFM (format and display screen), DAPR## (process user input/actions)</li>
<li><strong>Data Retrieval Functions (21):</strong> SARVGN through SQRVGN - retrieve company names, warehouse descriptions, user profiles, item data, order details, and load information</li>
<li><strong>Validation Functions (6):</strong> DHPRCF, DBPRSF, DCPRSR, EAPRSF, EBPRSR - validate warehouse access, security profiles, and user permissions</li>
<li><strong>Utility Functions (6):</strong> ZASNMS, ZDVPMT, ZHHPKY, ZXEXPG, ZYEXPG, ZZINIT - message handling, date/time processing, function key handling, program exit</li>
</ul>
<h3>Program Call Tree</h3>
<div class="mermaid">
flowchart TD
    Start([Program Entry]) --> ZZINIT[ZZINIT: Initialize Program]
    ZZINIT --> Loop{Main Loop}
    Loop --> BAIZSF[BAIZSF: Initialize & Load Subfile]
    BAIZSF --> SARVGN[SARVGN: Get Company Name]
    BAIZSF --> SBRVGN[SBRVGN: Get Warehouse Desc]
    BAIZSF --> SCRVGN[SCRVGN: Get User Profile]
    BAIZSF --> SDRVGN[SDRVGN: Check Warehouse Access]
    BAIZSF --> SERVGN[SERVGN: Retrieve Application Profile]
    BAIZSF --> DisplayLoop{Display Loop}
    DisplayLoop --> CAEXFM[CAEXFM: Display Screen]
    CAEXFM --> UserAction{User Action?}
    UserAction -->|F3 Exit| ZXEXPG[ZXEXPG: Exit Program]
    UserAction -->|HOME Reload| FBRQRL[FBRQRL: Request Reload]
    UserAction -->|Page Down| BBLDSF[BBLDSF: Load Next Page]
    UserAction -->|Enter| DAPR##[DAPR##: Process Input]
    FBRQRL --> Loop
    BBLDSF --> DisplayLoop
    DAPR## --> DisplayLoop
    ZXEXPG --> End([Program End])
</div>
<p><strong>Coordination Pattern:</strong> Functions coordinate through a master control loop. BAIZSF initializes and loads the first page of data by calling multiple retrieval functions (SARVGN, SBRVGN, etc.). CAEXFM displays the screen and waits for user action. Based on function keys, control passes to ZXEXPG (exit), FBRQRL (reload from top), BBLDSF (next page), or DAPR## (process selections). This cycle repeats until exit.</p>

<!-- AI_MARKER: Section4_BusinessLogic -->
<h2>4. Business Logic Summary</h2>
<h3>Primary Business Workflow</h3>
<p><strong>Load Planning Display Process:</strong> User launches the program with company, ship date, and warehouse parameters. The program validates user authorization for the specified warehouse by checking the PDL1REL1 (User Warehouse Access) file. If authorized, it retrieves company and warehouse descriptions for display header. The program then queries the OMFJCPMT (Load Header) and OMFLCPL1 (Load Detail) files to build a list of items scheduled for loading. Items are displayed in a scrollable subfile, paginated with approximately 10-15 records per screen. Users can navigate through pages, select items for action, or refresh the display. The program maintains position in the result set across page requests.</p>
<h3>Key Business Rules</h3>
<ul>
<li><strong>Warehouse Authorization:</strong> Users must have explicit access rights to view load data for a warehouse (enforced via PDL1REL1 file lookup)</li>
<li><strong>Company Number Required:</strong> A valid 3-digit company code must be provided to filter load data</li>
<li><strong>Scheduled Ship Date Filter:</strong> All displayed items must match the specified ship date parameter</li>
<li><strong>First-Time Initialization:</strong> When P1TAST='Y', the program initializes screen fields from parameters; otherwise, it retains previous screen values</li>
<li><strong>Warehouse Code Validation:</strong> Blank warehouse codes trigger error message 'USR2015 - Warehouse Code Required'</li>
<li><strong>Access Denied Handling:</strong> If user lacks warehouse access, program displays appropriate error message and exits</li>
<li><strong>Multi-Company/Multi-Warehouse Support:</strong> Authorization flags (P1I6ST, P1I8ST) control whether users can access multiple companies/warehouses</li>
<li><strong>Subfile Page Limit:</strong> Maximum subfile capacity controlled by W0SLM constant to prevent performance degradation</li>
</ul>
<h3>Decision Points</h3>
<p><strong>Key Decision Logic:</strong></p>
<ul>
<li><strong>Line 1145 (P1TAST='Y' check):</strong> Determines whether to initialize screen from parameters or retain existing values</li>
<li><strong>Line 1161 (#CCPCD=*BLANK check):</strong> Validates warehouse code presence before proceeding with data retrieval</li>
<li><strong>Line 1199 (WN0020=*BLANK check):</strong> Decides which user profile to use for warehouse access validation (##USR or WN0020)</li>
<li><strong>Line 1120-1127 (Function Key CAS structure):</strong> Routes execution based on user action: F3 exits, HOME reloads, PageDown loads next page, Enter processes input</li>
<li><strong>Warehouse Access Validation:</strong> Checks if WN0003 (Shipping Transaction access) is authorized before displaying load data</li>
<li><strong>Application Profile Check:</strong> Verifies user has access to the shipping application via CADTREL1/CADNREL2 files</li>
</ul>

<!-- AI_MARKER: Section5_DetailedFlow -->
<h2>5. Detailed Business Process Flow</h2>
<h3>Business Process Narrative</h3>
<div class="process-narrative">
<p><strong>Initialization and Authorization (Lines 1108-1250):</strong> When the program starts, it first calls ZZINIT to set up the runtime environment, initialize program variables, and establish file connections. The program then enters the BAIZSF subroutine to initialize the subfile display. If this is the first time running (P1TAST='Y'), it populates screen fields from the input parameters: company number, warehouse code, and ship date. The program validates that a warehouse code has been provided; if blank, it displays error USR2015 and exits. Next, it retrieves the company name and warehouse description for the screen header by calling SARVGN and SBRVGN. The most critical step is warehouse access authorization: the program calls SCRVGN to get the user's profile, then SDRVGN to check if the user has shipping transaction access (WN0003) for the specified warehouse. If access is denied, the program displays an appropriate error message and terminates. If authorized, it proceeds to call SERVGN to validate application-level permissions.</p>
<p><strong>Main Processing and Data Display (Lines 1115-1130):</strong> Once authorization succeeds, the program enters a display loop controlled by the W0RSF flag. It calls BBLDSF (or continues from BAIZSF) to load subfile records by reading from the Load Header (OMFJCPMT) and Load Detail (OMFLCPL1) files, filtering by company, warehouse, and ship date. Each subfile record contains item information, quantities, weights, and order references. The program loads records one page at a time (typically 10-15 records) to maintain performance. After loading, it calls CAEXFM to format and display the screen to the user. The program then waits for user action: F3 (exit), HOME (reload from beginning), Page Down (load next page), or Enter (process selections). Based on the function key pressed, control branches via a CAS (case) structure to the appropriate handler subroutine.</p>
<p><strong>Completion and Business Outcomes:</strong> The program continues looping through display and processing cycles until the user presses F3 or F12 to exit. Each interaction allows warehouse staff to view current load planning data, navigate through item lists, and potentially select items for further processing (handled by DAPR## subroutine). When exiting, the program calls ZXEXPG or ZYEXPG to perform cleanup and return control to the calling program. The business outcome is that warehouse personnel have real-time visibility into scheduled loads, enabling them to plan loading sequences, allocate resources, and ensure timely shipment departures. The program's security controls ensure that users only see load data for warehouses they are authorized to access, maintaining data integrity and operational security.</p>
</div>

<h3>Visual Process Flow Diagram</h3>
<div class="mermaid">
flowchart TD
    Start([User Launches Program]) --> Entry[Receive Parameters:<br/>Company, Warehouse, Ship Date]
    Entry --> Init[ZZINIT: Initialize Environment]
    Init --> SubfileInit[BAIZSF: Initialize Subfile]
    SubfileInit --> FirstTime{First Time<br/>Flag = 'Y'?}
    FirstTime -->|Yes| SetFields[Load Parameters to Screen Fields]
    FirstTime -->|No| RetainFields[Retain Previous Screen Values]
    SetFields --> CheckWhse{Warehouse<br/>Code Blank?}
    RetainFields --> CheckWhse
    CheckWhse -->|Yes| ErrWhse[Display Error: Warehouse Required]
    ErrWhse --> Exit1([Exit Program])
    CheckWhse -->|No| GetCompany[SARVGN: Retrieve Company Name]
    GetCompany --> GetWhse[SBRVGN: Retrieve Warehouse Description]
    GetWhse --> GetProfile[SCRVGN: Get User Profile]
    GetProfile --> CheckAccess[SDRVGN: Validate Warehouse Access]
    CheckAccess --> HasAccess{User Has<br/>Shipping Access?}
    HasAccess -->|No| ErrAccess[Display Error: Access Denied]
    ErrAccess --> Exit2([Exit Program])
    HasAccess -->|Yes| GetAppProfile[SERVGN: Validate Application Access]
    GetAppProfile --> LoadData[Load Subfile Records<br/>from Load Header & Detail Files]
    LoadData --> DisplayScreen[CAEXFM: Display Screen to User]
    DisplayScreen --> WaitInput{User Action?}
    WaitInput -->|F3 Exit| ExitProg[ZXEXPG: Exit Program]
    WaitInput -->|HOME Reload| ReloadTop[FBRQRL: Reload from Top]
    WaitInput -->|Page Down| NextPage[BBLDSF: Load Next Page]
    WaitInput -->|Enter| ProcessInput[DAPR##: Process Selections]
    ReloadTop --> SubfileInit
    NextPage --> DisplayScreen
    ProcessInput --> DisplayScreen
    ExitProg --> End([Program Terminates])
</div>

<h3>Process Explanation</h3>
<p><strong>Step-by-Step Business Flow:</strong> The warehouse staff member starts the program by providing three key pieces of information: which company's data to view, which warehouse location to display, and which scheduled ship date to filter by. The program first checks if the user is authorized to see data for that warehouse by consulting the security database. If authorized, it looks up descriptive names for the company and warehouse to display friendly headers on the screen. Next, it queries the shipping system's Load Header and Load Detail files to find all items scheduled for loading that match the criteria. These items are formatted into a scrollable list showing item codes, quantities, weights, and related order information. The user can browse through the list using page navigation keys, reload the data if it changes, or press F3 to exit when finished. Throughout this process, the program enforces strict access controls to ensure users only see data for warehouses they're authorized to manage.</p>

<!-- AI_MARKER: Section6_DataOperations -->
<h2>6. Data Operations and Information Flow</h2>
<h3>Business Data Access</h3>
<p><strong>Read-Only Operations:</strong></p>
<ul>
<li><strong>CAABREL3</strong> - Reads company master data to display company names on screen header</li>
<li><strong>CAADREL3</strong> - Reads warehouse master data to display warehouse descriptions and validate warehouse codes</li>
<li><strong>CADRREL1</strong> - Reads user profile control data to determine user model and preferences</li>
<li><strong>PDL1REL1</strong> - Reads user warehouse access rights to enforce security (checks shipping transaction authorization)</li>
<li><strong>CADTREL1 / CADNREL2</strong> - Reads user application profiles to verify application-level access permissions</li>
<li><strong>OMFJCPMT / OMFJCPL0 / OMFJCPLL</strong> - Reads load header records (Load ID, Scheduled Ship Date, Carrier, Status)</li>
<li><strong>OMFLCPL1</strong> - Reads load detail records (Item Code, Order Number, Quantity, Weight)</li>
<li><strong>OPBFCPL8</strong> - Reads order header data to link loads to customer orders</li>
<li><strong>OPBGWKL1 / OPBGWKLA</strong> - Reads order detail/line item data (Item codes, quantities, prices, weights)</li>
<li><strong>OMBYREL1</strong> - Reads item master defaults for item descriptions and attributes</li>
<li><strong>CAVLLSL0</strong> - Reads values list for dropdown/selection list data</li>
</ul>
<p><strong>Update Operations:</strong></p>
<ul>
<li><strong>OMFJCPL1</strong> - Update file for Load Header - may update load status, carrier assignments, or scheduling changes based on user actions</li>
</ul>
<h3>Information Processing</h3>
<p><strong>Data Flow Pattern:</strong> The program follows a strict read-validate-display pattern with minimal updates. (1) <strong>Security Layer:</strong> First, user credentials flow through PDL1REL1 and CADTREL1 files to validate authorization. (2) <strong>Reference Data Layer:</strong> Company and warehouse codes are resolved to descriptive names via CAABREL3 and CAADREL3 lookups. (3) <strong>Transactional Data Layer:</strong> Load planning data flows from OMFJCPMT (headers) joined with OMFLCPL1 (details) to build the item list. (4) <strong>Enrichment Layer:</strong> Order and item data from OPBFCPL8, OPBGWKL1, and OMBYREL1 enrich each subfile record with customer order context and item descriptions. (5) <strong>Presentation Layer:</strong> All retrieved data is formatted into subfile records and displayed. User selections may trigger updates to OMFJCPL1 to change load statuses or assignments.</p>

<!-- AI_MARKER: Section7_Dependencies -->
<h2>7. System Dependencies and Integration Points</h2>
<h3>External Program Calls</h3>
<p><strong>No Direct CALL Statements:</strong> This program does not contain CALL statements to external programs. All processing is handled internally through subroutines (EXSR). This is typical of display file programs that focus on data presentation rather than complex business logic execution.</p>
<p><strong>Display File:</strong> PBMHDFR#C - The program's primary external dependency is its display file (screen format definition) which controls the visual layout and user interaction patterns.</p>
<h3>Integration Architecture</h3>
<p><strong>Role in System Landscape:</strong> PBMHDFR is a front-end inquiry program within the warehouse management system. It integrates with:</p>
<ul>
<li><strong>Order Management System:</strong> Retrieves order header (OPBFCPL8) and detail (OPBGWKL1) data to show which customer orders are included in each load</li>
<li><strong>Load Planning System:</strong> Primary integration point - reads and potentially updates load headers (OMFJCPMT) and details (OMFLCPL1)</li>
<li><strong>Security Framework:</strong> Integrates with enterprise security via PDL1REL1 (warehouse access), CADTREL1 (user profiles), and CADNREL2 (application access)</li>
<li><strong>Item Master System:</strong> Links to OMBYREL1 for item descriptions and default attributes</li>
<li><strong>Company/Warehouse Master:</strong> Integrates with CAABREL3 and CAADREL3 for organizational structure data</li>
</ul>
<p><strong>Upstream Systems:</strong> Receives parameters from calling programs (likely a menu system or load management dashboard) that provide company, warehouse, and ship date context.</p>
<p><strong>Downstream Impact:</strong> Updates to OMFJCPL1 (Load Header) made through this program affect load scheduling, carrier assignments, warehouse resource planning, and shipping execution processes.</p>
<h3>Modernization Opportunities</h3>
<ul>
<li><strong>Web/Mobile Interface:</strong> Replace green-screen display file with responsive web interface accessible on tablets/smartphones for warehouse floor staff</li>
<li><strong>Real-Time Refresh:</strong> Implement automatic data refresh instead of manual HOME key reload to show live load status changes</li>
<li><strong>Enhanced Search/Filter:</strong> Add advanced filtering by carrier, item type, customer, or urgency level beyond basic company/warehouse/date</li>
<li><strong>Visual Analytics:</strong> Replace text-based subfile with graphical load planning board showing truck capacities, weight distributions, and route optimization</li>
<li><strong>API Enablement:</strong> Expose load planning data via REST APIs for integration with third-party TMS (Transportation Management Systems) or carrier portals</li>
<li><strong>Role-Based Security:</strong> Modernize security model from file-based warehouse access to role-based access control (RBAC) with granular permissions</li>
<li><strong>Workflow Automation:</strong> Add automated load optimization, carrier selection, and route planning instead of manual review</li>
<li><strong>Integration with IoT:</strong> Connect with warehouse IoT devices (barcode scanners, weight scales, dock door sensors) for automatic load verification</li>
</ul>

<h2>8. Detailed Business Functions Analysis</h2>
<p><strong>For Business Users:</strong> This section provides detailed analysis of each function with clear explanations and visual diagrams.</p>
<div class="highlight">
<strong>Coverage:</strong> All 39 functions documented with 4-part analysis and visual flowcharts
</div>

<div class="func">
<div class="func-header">
<h3>Function 1: BAIZSF</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 1133 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F01_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> P1TAST (First Time Flag), P1AIC3 (Company Number), P1AJCD (Warehouse Code), P6AODT (Scheduled Ship Date)</p>
<p><strong>Output:</strong> Initialized subfile with header data (company name, warehouse description), loaded with first page of load planning items</p>
<p><strong>Key Data:</strong> User profile (##USR), warehouse access rights (WN0001-WN0019), load header fields (#2AIC3, #2AODT, #CCPCD)</p>
</div>

<!-- AI_MARKER: F01_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>BAIZSF initializes the subfile display and loads the first page of load planning data. It first clears any existing subfile records and resets the record counter. If this is the first time the program runs (P1TAST='Y'), it populates screen fields from input parameters. The function validates that a warehouse code is provided and checks user authorization for the specified warehouse by calling multiple retrieval subroutines (SARVGN for company name, SBRVGN for warehouse description, SCRVGN for user profile, SDRVGN for warehouse access rights, SERVGN for application profile). If the user lacks warehouse access or the warehouse code is blank, it displays an error message and exits. Upon successful validation, it calls BBLDSF to load the first page of subfile records from the database.</p>
</div>

<!-- AI_MARKER: F01_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function performs a sequential validation and initialization process: clear subfile → check first-time flag → validate warehouse code → retrieve company/warehouse descriptions → validate user access → load data. Multiple decision points check for blank warehouse codes, missing access rights (WN0021='N'), and area-specific permissions (inventory, lot/loc, shipping transactions). Any failed validation triggers error messages (USR2015, USR2776, USR2792) and branches to exit label BAEXIT.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([BAIZSF Entry]) --> Clear[Clear Subfile: SETON 80, WRITE, SETOF 80]
    Clear --> ResetCount[Reset Record Counter: ##RRMX=0]
    ResetCount --> FirstTime{P1TAST = 'Y'?}
    FirstTime -->|Yes| InitFields[Initialize Fields:<br/>#2AIC3=P1AIC3, #CCPCD=P1AJCD<br/>#2AODT=P6AODT, P1TAST='N']
    FirstTime -->|No| KeepFields[Keep Existing Fields]
    InitFields --> GetCompany[EXSR SARVGN:<br/>Retrieve Company Name]
    KeepFields --> GetCompany
    GetCompany --> GetWhse[EXSR SBRVGN:<br/>Retrieve Warehouse Description]
    GetWhse --> CheckBlank{#CCPCD = *BLANK?}
    CheckBlank -->|Yes| ErrWhse[Send Message USR2015:<br/>Warehouse Code Required<br/>SETON 99,32]
    ErrWhse --> ExitErr([GOTO BAEXIT])
    CheckBlank -->|No| InitAccessVars[Initialize WN0001-WN0019:<br/>Clear Access Variables]
    InitAccessVars --> GetProfile[EXSR SCRVGN:<br/>Retrieve User Profile Model]
    GetProfile --> CheckModel{WN0020 = *BLANK?}
    CheckModel -->|Yes| GetAccess1[EXSR SDRVGN:<br/>User=##USR, Whse=#CCPCD]
    CheckModel -->|No| GetAccess2[EXSR SDRVGN:<br/>User=WN0020, Whse=#CCPCD]
    GetAccess1 --> CheckFound{WN0021 = 'N'?}
    GetAccess2 --> CheckFound
    CheckFound -->|Yes| ErrAccess[Send Message USR2776:<br/>Access Denied: Warehouse<br/>SETON 99,32]
    ErrAccess --> ExitErr
    CheckFound -->|No| ValidateArea[Validate Access Areas:<br/>Inventory, Lot/Loc, Shipping]
    ValidateArea --> AreaCheck{All Required<br/>Access OK?}
    AreaCheck -->|No| ErrArea[Send Message USR2792:<br/>Access Denied: Area<br/>SETON 99,32]
    ErrArea --> ExitErr
    AreaCheck -->|Yes| LoadSubfile[Load Subfile Page:<br/>##RROK=0, EXSR BBLDSF]
    LoadSubfile --> End([Return to Caller])
</div>

<!-- AI_MARKER: F01_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> Calls SARVGN (reads CAABREL3 for company name), SBRVGN (reads CAADREL3 for warehouse description), SCRVGN (reads CADRREL1 for user profile), SDRVGN (reads PDL1REL1 for warehouse access rights), SERVGN (validates application access via CADTREL1/CADNREL2). Writes to display file #SFLCTL to clear subfile.</p>
<p><strong>External Calls:</strong> Calls CARVC2R program multiple times (lines 1284, 1292, 1321, 1329, etc.) to retrieve condition name descriptions from values list for error messages.</p>
<p><strong>Business Impact:</strong> This function serves as the security gatekeeper for the entire load planning screen. It enforces warehouse-level and area-level access controls, ensuring only authorized users can view load data for specific warehouses. Proper authorization prevents unauthorized access to sensitive shipping information and maintains data security compliance. The function's validation logic directly impacts operational security and audit compliance.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 2: BBLDSF</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 1655 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F02_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> ##RRMX (current subfile record count), W0RR0 (cursor position), W0SPG (subfile pages), selection criteria (#2T4NB, #2VDST, #2RPNB, #2AODT, #2KZDT, #2AXTM, #2RMNB, #2EIDT, #2R0SX), filter fields (#2AIC3 company, #2BZNA carrier, #CHGCD item code)</p>
<p><strong>Output:</strong> Populated subfile records written to #SFLRCD, updated ##RR counter, ##RROK record count, indicators 81/99/82</p>
<p><strong>Key Data:</strong> Load header fields (FJRMNB, FJAIC3, FJAODT, FJBZNA, FJPKST), W0RSL (record selection flag), ##RRRD (scan counter), W0SLM (scan limit)</p>
</div>

<!-- AI_MARKER: F02_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>BBLDSF loads additional pages of subfile data when users page down through the load planning list. It reads from the Load Header file (@FJCPVB) sequentially, applying multiple selection filters: schedule sequence (#2T4NB), load type (FJVDST), total orders (FJRPNB), dates (#2AODT, #2KZDT, #2AXTM), load ID (#2RMNB), delivery date (#2EIDT), and load U/M (#2R0SX). For each record, it validates company match (#2AIC3 vs FJAIC3), multi-company load flag (FJRVSX), warehouse access (via SFRVGN), load status (must be C/E/L/U: Comb/Entered/Locked/Unlck), item existence on load (via SHRVGN), and carrier code (#2BZNA vs FJBZNA). Selected records are converted to external format (MNCV#1), written to subfile via WRITE#SFLRCD, and counter ##RROK incremented. The function stops when page full (##RROK >= ##SFLN), scan limit reached (##RRRD >= W0SLM), or EOF (*IN82='1'). Error messages Y2U0008 (no data) or Y2U0017 (scan limit) display as appropriate.</p>
</div>

<!-- AI_MARKER: F02_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function performs paginated data loading with complex multi-criteria filtering. It reads database records sequentially, applies cascading selection logic (dates → company → load status → item existence → carrier), and writes qualifying records to the subfile until the page is full or limits are reached. Key decision points include W0RR0>0 (cursor positioning), selection field comparisons (CABLT/CABNE/CABGT/CABNE operations), W0RSL='Y' (record selected flag), and multiple nested IF-ELSE structures for company/carrier filtering.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([BBLDSF Entry]) --> ReEstablish{Indicator 27<br/>PageDown?}
    ReEstablish -->|Yes| ReadPrev[READP @FJCPVB, then READ @FJCPVB]
    ReEstablish -->|No| ClearInd[Clear Error Indicators 41+]
    ReadPrev --> ClearInd
    ClearInd --> SetStart[##RR = ##RRMX<br/>##RRRD = 0]
    SetStart --> CalcPages{W0RR0 > 0?}
    CalcPages -->|Yes| DivPages[##SPG = W0RR0 / ##SFPG<br/>Adjust for remainder]
    CalcPages -->|No| UseSPG[##SPG = W0SPG]
    DivPages --> CompLines[##SFLN = ##SPG * ##SFPG<br/>Max 999]
    UseSPG --> CompLines
    CompLines --> LoopStart{*IN82=0 AND<br/>##RROK < ##SFLN AND<br/>##RRRD < W0SLM?}
    LoopStart -->|No| CheckEmpty{##RR = 0 AND<br/>*IN82 = 1?}
    LoopStart -->|Yes| Filter1{Selection<br/>Criteria Match?}
    Filter1 -->|No| ReadNext[READ @FJCPVB, ##RRRD++]
    Filter1 -->|Yes| LoadFields[EXSR MBFL#1<br/>W0RSL='Y', ##RR++]
    LoadFields --> CheckCompany{#2AIC3 ≠ 0 AND<br/>FJAIC3 ≠ #2AIC3?}
    CheckCompany -->|Yes| CheckMulti{FJRVSX = 'N'?}
    CheckCompany -->|No| SelWhs[W0RSL='N'<br/>EXSR SFRVGN: Sel Order by Whs]
    CheckMulti -->|Yes| SetNo[W0RSL='N']
    CheckMulti -->|No| SelWhs
    SelWhs --> CheckStatus{#1PKST in<br/>C/E/L/U?}
    CheckStatus -->|No| SetNo2[W0RSL='N']
    CheckStatus -->|Yes| CheckItem{#CHGCD = 0?}
    CheckItem -->|Yes| ExitBBEXIT([GOTO BBEXIT])
    CheckItem -->|No| ValidLoad{W0RSL = Y or Blank?}
    ValidLoad -->|Yes| ChkLoadDetail[EXSR SHRVGN: Val Itm on LD]
    ValidLoad -->|No| DecRR[##RR--]
    ChkLoadDetail --> Found{YL0001 = 'Y'?}
    Found -->|No| SetNo3[W0RSL='N']
    Found -->|Yes| CheckCarrier{#2BZNA<br/>entered?}
    CheckCarrier -->|No| ConvertWrite[##RR--, W0RSL≠Y Skip]
    CheckCarrier -->|Yes| Carrier{#2BZNA = '*' AND<br/>FJBZNA ≠ Blank?}
    Carrier -->|Yes| SetNo4[W0RSL='N']
    Carrier -->|No| CarrierMatch{#2BZNA ≠ FJBZNA?}
    CarrierMatch -->|Yes| SetNo5[W0RSL='N']
    CarrierMatch -->|No| ConvertWrite
    ConvertWrite --> ChkSelect{W0RSL = 'Y'?}
    ChkSelect -->|No| ReadNext
    ChkSelect -->|Yes| Convert[EXSR MNCV#1<br/>##RR++, ##RROK++]
    Convert --> SetInd[EXSR GADSA1<br/>Set indicators]
    SetInd --> WriteRec[WRITE #SFLRCD]
    WriteRec --> ReadNext
    SetNo --> DecRR
    SetNo2 --> DecRR
    SetNo3 --> DecRR
    SetNo4 --> DecRR
    SetNo5 --> DecRR
    DecRR --> ReadNext
    ReadNext --> LoopStart
    CheckEmpty -->|Yes| MsgNoData[Send Y2U0008:<br/>No data to display]
    CheckEmpty -->|No| SaveHigh{##RR > ##RRMX?}
    MsgNoData --> SaveHigh
    SaveHigh -->|Yes| CalcTop[Calculate ##SFRC top line<br/>##RRMX = ##RR]
    SaveHigh -->|No| CheckScan{##RRRD >= W0SLM?}
    CalcTop --> CheckScan
    CheckScan -->|Yes| MsgLimit[Send Y2U0017:<br/>Scan limit reached]
    CheckScan -->|No| ResetCount[##RROK = 0]
    MsgLimit --> End([Return])
    ResetCount --> End
</div>

<!-- AI_MARKER: F02_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> Reads OMFJCPMT load headers via @FJCPVB format (READ/READP operations). Calls MBFL#1 to load subfile fields from DB record. Calls SFRVGN to select orders by warehouse from OPBFCPL8. Calls SHRVGN to validate item exists on load detail (OMFLCPL1). Writes to display file #SFLRCD. Calls MNCV#1 for field conversion and GADSA1/GBDSA2 for screen indicators.</p>
<p><strong>External Calls:</strong> None - all processing via internal EXSR subroutines</p>
<p><strong>Business Impact:</strong> This is the core pagination engine for the load planning display. It enables warehouse staff to browse through potentially thousands of load records efficiently by loading only one page at a time. The comprehensive filtering (by company, carrier, status, dates, items) allows users to quickly find specific loads meeting business criteria. The scan limit (W0SLM) prevents performance degradation when result sets are extremely large. Poor performance here would directly impact warehouse staff productivity during peak loading times.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 3: CAEXFM</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 1880 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F03_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> W0HLP (help flag), indicators *IN04/25/30/27, YSETCS (cursor flag), ZZSFM (subfile mode)</p>
<p><strong>Output:</strong> Displayed screen via EXFMT#SFLCTL, updated @#SFRC, cleared message queue</p>
<p><strong>Key Data:</strong> ##TME (time), ##JTM (job time), WCSRLC (cursor location), ZAPGMQ (message queue)</p>
</div>

<!-- AI_MARKER: F03_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>CAEXFM displays the screen and waits for user input. It converts fields to external format, saves/clears/restores indicators, updates screen time, sets cursor if requested, writes message/command formats, executes the screen (EXFMT#SFLCTL), maintains subfile position, tests cursor, checks prompts, displays help if requested, updates job time, and clears the message queue. Loop continues for help requests until W0HLP='N'.</p>
</div>

<!-- AI_MARKER: F03_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Core display handler that prepares screen (convert/indicators/time), displays it (EXFMT waits for input), processes user action (cursor/prompt/help/messages). W0HLP loop handles help display.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([CAEXFM]) --> Chk{*IN30=0<br/>*IN27=0?}
    Chk -->|Yes| Conv[EXSR MOCV#2]
    Chk -->|No| SetInd[EXSR GBDSA2]
    Conv --> SetInd
    SetInd --> Loop{W0HLP='N'?}
    Loop -->|No| Save[Save *IN04/25<br/>Clear indicators]
    Save --> Time[TIME ##TME]
    Time --> Cursor{YSETCS='Y'?}
    Cursor -->|Yes| SetC[EXSR Y0SET]
    Cursor -->|No| Mode[*IN02=ZZSFM]
    SetC --> Mode
    Mode --> Write[WRITE #MSGCTL/#CMDTXT1]
    Write --> Disp[EXFMT #SFLCTL]
    Disp --> Pos{@#SFRC>0?}
    Pos -->|Yes| SaveP[##SFRC=@#SFRC]
    Pos -->|No| Test[EXSR Y8TST]
    SaveP --> Test
    Test --> Prompt[EXSR ZDVPMT]
    Prompt --> Help{*IN25=1?}
    Help -->|Yes| ShowH[EXSR ZHHPKY]
    Help -->|No| JobT[TIME ##JTM]
    ShowH --> JobT
    JobT --> Clear[CALL Y2CLMSC]
    Clear --> Loop
    Loop -->|Yes| End([Return])
</div>

<!-- AI_MARKER: F03_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> EXFMT#SFLCTL (display file I/O), WRITE#MSGCTL/#CMDTXT1</p>
<p><strong>External Calls:</strong> Y2CLMSC (clear message queue)</p>
<p><strong>Business Impact:</strong> User interaction hub - performance here affects user experience. Slow response frustrates staff during busy periods.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 4: DBPRSF</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2506 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F04_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> YAFSCH (first changed subfile record), *IN92 (EOF indicator for READC)</p>
<p><strong>Output:</strong> Updated subfile records via UPDAT#SFLRCD, processed changes</p>
<p><strong>Key Data:</strong> #SFLRCD (subfile record format), ##RR (record number)</p>
</div>

<!-- AI_MARKER: F04_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>DBPRSF processes modified subfile records after user makes changes. If YAFSCH is not zero, it chains to that specific record; otherwise, it reads the first changed record (READC). For each changed record, it calls DCPRSR to validate and process the changes, converts fields to external format (MNCV#1), sets screen indicators (GADSA1), and updates the subfile record (UPDAT#SFLRCD). Loop continues reading changed records (READC) until *IN92='1' (no more changes).</p>
</div>

<!-- AI_MARKER: F04_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Iterates through user-modified subfile records, validates each via DCPRSR, converts to display format, updates subfile. Stops when no more changed records found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([DBPRSF]) --> ChkFirst{YAFSCH ≠ 0?}
    ChkFirst -->|Yes| Chain[CHAIN #SFLRCD<br/>using YAFSCH]
    ChkFirst -->|No| ReadC[READC #SFLRCD]
    Chain --> Loop{*IN92 = 0?}
    ReadC --> Loop
    Loop -->|Yes| Process[EXSR DCPRSR:<br/>Process record]
    Loop -->|No| End([Return])
    Process --> Convert[EXSR MNCV#1:<br/>Convert fields]
    Convert --> SetInd[EXSR GADSA1:<br/>Set indicators]
    SetInd --> Update[UPDAT #SFLRCD]
    Update --> ReadNext[READC #SFLRCD]
    ReadNext --> Loop
</div>

<!-- AI_MARKER: F04_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN/READC/UPDAT operations on #SFLRCD subfile format</p>
<p><strong>External Calls:</strong> None - calls internal subroutines DCPRSR, MNCV#1, GADSA1</p>
<p><strong>Business Impact:</strong> Processes user edits to load planning data. Validates changes before committing to ensure data integrity.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 5: DCPRSR</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2529 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F05_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> VRMBDT (date field), #RT4TM (time), #RHLNX (to-time), #1P0DT (load plan start date), YPMTFD (prompt field)</p>
<p><strong>Output:</strong> Validated #RMBDT (internal date), P3R4ST (update flag), indicators 98/41/84/99, W0RSF (reload flag)</p>
<p><strong>Key Data:</strong> XDEXDT/XDINDT (date conversion), W0RTN (return code), #1RMNB (load ID), #RS2TX (trailer ID)</p>
</div>

<!-- AI_MARKER: F05_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>DCPRSR validates individual subfile record changes. It clears error indicators (41/98), validates the date field (VRMBDT) via XDCK2, converts to internal format (XDINDT to #RMBDT), exits early if prompt field entered (YPMTFD not blank), sets SFLNXTCHG (*IN84), retrieves current load header data (SJRVGN), validates load exists (sends USR2313 if not found, sets W0RSF='Y' reload flag), moves trailer ID (#1DXTX to #RS2TX), validates date/time consistency (time entered but no date, or date entered but no time triggers USR4698 error), checks if time or date changed from original values (#RT4TM≠#RHLNX or #1P0DT≠#RMBDT), sets update flag (P3R4ST='Y') if changed, positions cursor (##SFRC=##RR) if errors found (*IN98='1').</p>
</div>

<!-- AI_MARKER: F05_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Validates date field, retrieves load header, checks date/time consistency (both or neither must be entered), detects changes from original values, sets update flag if modified. Multiple error paths for invalid date, missing load, or incomplete date/time pairs.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([DCPRSR]) --> ClearInd[Clear indicators 41,98<br/>EXSR GADSA1]
    ClearInd --> ValDate[XDEXDT=VRMBDT<br/>EXSR XDCK2]
    ValDate --> ChkErr{W0RTN<br/>not blank?}
    ChkErr -->|Yes| SetErr[SETON 98,41]
    ChkErr -->|No| Convert[#RMBDT=XDINDT]
    SetErr --> Convert
    Convert --> ChkPmt{YPMTFD<br/>not blank?}
    ChkPmt -->|Yes| Exit([GOTO DCEXIT])
    ChkPmt -->|No| SetNext[SETON 84<br/>SFLNXTCHG]
    SetNext --> GetLoad[EXSR SJRVGN:<br/>RTV load header]
    GetLoad --> ChkFound{W0RTN<br/>= blank?}
    ChkFound -->|No| ErrLoad[Send USR2313<br/>Load not found<br/>SETON 98<br/>W0RSF='Y']
    ErrLoad --> Exit
    ChkFound -->|Yes| MoveTrlr[#RS2TX=#1DXTX<br/>Trailer ID]
    MoveTrlr --> ChkDT{Time entered<br/>but no date<br/>OR Date>0<br/>but time=0?}
    ChkDT -->|Yes| ErrDT[Send USR4698<br/>Must enter both<br/>SETON 98,41,42]
    ChkDT -->|No| ChkChg{#RT4TM ≠ #RHLNX<br/>OR #1P0DT ≠ #RMBDT?}
    ErrDT --> ChkErr2{*IN98 = 1?}
    ChkChg -->|Yes| SetUpd[P3R4ST='Y'<br/>Update flag]
    ChkChg -->|No| ChkErr2
    SetUpd --> ChkErr2
    ChkErr2 -->|Yes| SetCsr[##SFRC=##RR<br/>SETON 99]
    ChkErr2 -->|No| EndOK([Return])
    SetCsr --> EndOK
</div>

<!-- AI_MARKER: F05_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> Calls SJRVGN to retrieve load header, XDCK2/XDVC2T for date validation/conversion, GADSA1 for indicators, ZASNMS for messages</p>
<p><strong>External Calls:</strong> None - internal subroutines only</p>
<p><strong>Business Impact:</strong> Critical validation layer ensuring data integrity for load planning changes. Prevents incomplete or invalid date/time entries that could cause scheduling errors.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 6: DHPRCF</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2621 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F06_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> W0HLP (help flag), *IN29 (cancel indicator), V#CFCD (confirmation value), YPMTFD (prompt field)</p>
<p><strong>Output:</strong> ##CFCD (internal confirmation code), indicators 29/96/99, W0DCF (defer confirm flag)</p>
<p><strong>Key Data:</strong> Y2LSNO (list 1001713), Y2INVL/Y2EXVL (internal/external values), WN30 (saved indicators)</p>
</div>

<!-- AI_MARKER: F06_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>DHPRCF displays confirmation prompt screen. Converts fields (MOCV#2), sets indicators (GBDSA2), updates time, initializes ##CFCD='N', saves command key indicators (WN30), converts confirmation value from internal to external via @Y2INEX lookup (list 1001713), loops displaying #CONFIRM screen until user responds (W0HLP='N' and *IN29='0'), handles help requests, validates confirmation input (allows '?' for search, calls CAVLLSR for value list), converts external value back to internal via @Y2EXIN lookup, sets indicator 29 if invalid (*IN90='1'), restores command keys, updates job time, clears message queue if confirmed (##CFCD='Y'), compares ##CFCD to 'Y' setting indicators 99 (equal) and 99 (not equal).</p>
</div>

<!-- AI_MARKER: F06_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Prompts user for yes/no confirmation. Converts confirmation code between internal ('Y'/'N') and external display values, handles value list prompting (?), validates input, loops until valid response or cancel (*IN29).</p>
</div>
<div class="mermaid">
flowchart TD
    Start([DHPRCF]) --> Conv[EXSR MOCV#2/GBDSA2<br/>TIME, ##CFCD='N']
    Conv --> Save[Save *IN→WN30<br/>SETOF 29]
    Save --> Chain1[CHAIN @Y2INEX<br/>Convert ##CFCD→V#CFCD]
    Chain1 --> Loop{W0HLP='N'<br/>AND *IN29='0'?}
    Loop -->|No| Write[WRITE #MSGCTL/CMDTXT1/SFLCTL<br/>EXFMT #CONFIRM]
    Loop -->|Yes| Restore[MOVEA WN30→*IN]
    Write --> Chk29{*IN29='1'?}
    Chk29 -->|Yes| Set99[SETON 99<br/>GOTO DHEXIT]
    Chk29 -->|No| Help{*IN25=1?}
    Help -->|Yes| ShowHelp[EXSR ZHHPKY]
    Help -->|No| ValConf[W0NSRQ=V#CFCD[0]]
    ShowHelp --> ValConf
    ValConf --> ChkSrch{W0NSRQ='?'<br/>OR YPMTFD='V#CFCD'?}
    ChkSrch -->|Yes| CallList[CALL CAVLLSR<br/>W0DCF='Y'<br/>YPMTFD='*DONE']
    ChkSrch -->|No| Chain2[CHAIN @Y2EXIN<br/>Convert V#CFCD→##CFCD]
    CallList --> Chain2
    Chain2 --> Chk90{*IN90='1'?}
    Chk90 -->|Yes| Blank[##CFCD=*BLANK<br/>SETON 96<br/>WRITE #CONFIRM]
    Chk90 -->|No| MovInv[##CFCD=Y2INVL]
    Blank --> Set29[SETON/SETOF 29]
    MovInv --> Set29
    Set29 --> Loop
    Restore --> Time[TIME ##JTM]
    Time --> ChkY{##CFCD='Y'?}
    ChkY -->|Yes| Clear[CALL Y2CLMSC<br/>ZAFSMS='Y']
    ChkY -->|No| Comp[COMP ##CFCD to 'Y'<br/>Set indicators 99]
    Clear --> Comp
    Comp --> End([Return])
</div>

<!-- AI_MARKER: F06_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN @Y2INEX/Y2EXIN (value list conversions), EXFMT #CONFIRM (confirmation screen)</p>
<p><strong>External Calls:</strong> CAVLLSR (value list search), Y2CLMSC (clear messages)</p>
<p><strong>Business Impact:</strong> Confirmation prompt prevents accidental changes to load planning data. Ensures user explicitly approves updates before database commits.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 7: EAPRSF</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2723 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F07_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> *IN81 (subfile has records), *IN92 (EOF for READC), *IN99 (error flag)</p>
<p><strong>Output:</strong> Updated subfile records, W0RSF (reload subfile flag)</p>
<p><strong>Key Data:</strong> #SFLRCD (subfile record format)</p>
</div>

<!-- AI_MARKER: F07_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>EAPRSF updates database from modified subfile records post-confirmation. If *IN81='1' (subfile has records), reads first changed record (READC), loops while *IN92='0', calls EBPRSR to process each record, converts fields (MNCV#1), sets indicators (GADSA1), updates subfile (UPDAT#SFLRCD). If any errors (*IN99='1'), cancels reload (W0RSF='N'). Always sets W0RSF='Y' at end for reload.</p>
</div>

<!-- AI_MARKER: F07_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Post-confirmation database update handler. Iterates through changed subfile records, processes via EBPRSR, updates display. Sets reload flag unless errors found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([EAPRSF]) --> Chk81{*IN81='1'?}
    Chk81 -->|No| ChkErr{*IN99='1'?}
    Chk81 -->|Yes| ReadC[READC #SFLRCD]
    ReadC --> Loop{*IN92='0'?}
    Loop -->|No| ChkErr
    Loop -->|Yes| Proc[EXSR EBPRSR]
    Proc --> Conv[EXSR MNCV#1]
    Conv --> SetInd[EXSR GADSA1]
    SetInd --> Upd[UPDAT #SFLRCD]
    Upd --> ReadNext[READC #SFLRCD]
    ReadNext --> Loop
    ChkErr -->|Yes| NoReload[W0RSF='N']
    ChkErr -->|No| SetReload[W0RSF='Y']
    NoReload --> SetReload
    SetReload --> End([Return])
</div>

<!-- AI_MARKER: F07_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> READC/UPDAT #SFLRCD, calls EBPRSR for database updates</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Commits validated load planning changes to database. Critical for ensuring user edits are saved after confirmation.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 8: EBPRSR</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2750 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F08_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #RT4TM (time field), ##RR (record number)</p>
<p><strong>Output:</strong> YL0007 (load plan start time), indicators 98/84/99, ##SFRC (cursor position)</p>
<p><strong>Key Data:</strong> WKIND0 (indicator array)</p>
</div>

<!-- AI_MARKER: F08_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>EBPRSR processes individual modified subfile record post-confirmation. Clears error indicators (41/98), converts time field (#RT4TM) to internal format (YL0007=RT4TM*100 if entered, else zero), calls SKRVGN to update load header with new start time, sets SFLNXTCHG (*IN84) if errors, positions cursor (##SFRC=##RR) if *IN98='1' and not already error (*IN99='0').</p>
</div>

<!-- AI_MARKER: F08_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Converts user-entered time to internal format, calls SKRVGN to update load header in database, handles errors by setting SFLNXTCHG and positioning cursor.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([EBPRSR]) --> Clear[Clear indicators 41/98]
    Clear --> ChkTime{#RT4TM ≠ 0?}
    ChkTime -->|Yes| Mult[YL0007 = #RT4TM * 100]
    ChkTime -->|No| Zero[YL0007 = 0]
    Mult --> Call[EXSR SKRVGN:<br/>Update load header]
    Zero --> Call
    Call --> ChkErr{*IN98='1'?}
    ChkErr -->|Yes| SetNext[SETON 84<br/>SFLNXTCHG]
    ChkErr -->|No| End([Return])
    SetNext --> ChkCsr{*IN99='0'?}
    ChkCsr -->|Yes| SetCsr[##SFRC=##RR<br/>SETON 99]
    ChkCsr -->|No| End
    SetCsr --> End
</div>

<!-- AI_MARKER: F08_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> Calls SKRVGN to update OMFJCPL1 load header with new start time</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Updates load plan start times in database. Ensures schedule changes are persisted for downstream shipping operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 9: FBRQRL</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2779 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F09_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> None</p>
<p><strong>Output:</strong> W0RSF='Y' (reload subfile flag)</p>
<p><strong>Key Data:</strong> W0RSF (single character field)</p>
</div>

<!-- AI_MARKER: F09_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>FBRQRL requests subfile reload. Single-line function that sets W0RSF='Y'. Called when user presses HOME key (indicator 30) to refresh data from database.</p>
</div>

<!-- AI_MARKER: F09_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Simplest function - just sets reload flag to 'Y'. Main loop detects this flag and calls BAIZSF to rebuild subfile from scratch.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([FBRQRL]) --> Set[W0RSF = 'Y']
    Set --> End([Return])
</div>

<!-- AI_MARKER: F09_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Enables users to refresh load data when shipments are updated by other users or background processes. Critical for multi-user environments.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 10: GADSA1</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2787 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F10_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #RKOST (knockout status field)</p>
<p><strong>Output:</strong> *IN77 (display indicator)</p>
<p><strong>Key Data:</strong> Indicator 77 controls field display attributes in subfile record</p>
</div>

<!-- AI_MARKER: F10_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>GADSA1 sets display attributes for subfile records. Checks #RKOST field - if 'Y', sets indicator 77 to '1', otherwise '0'. Indicator 77 controls visual attributes (color, intensity, reverse image) for knockout items in subfile.</p>
</div>

<!-- AI_MARKER: F10_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Simple conditional indicator setting. Used to highlight special-status records visually on screen.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([GADSA1]) --> Init[*IN77 = '0']
    Init --> Check{#RKOST = 'Y'?}
    Check -->|Yes| SetOn[*IN77 = '1']
    Check -->|No| End([Return])
    SetOn --> End
</div>

<!-- AI_MARKER: F10_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None - just sets indicator</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Visual cue for warehouse staff to identify knockout/special handling items. Improves data readability and reduces picking errors.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 11: GBDSA2</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 2798 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F11_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> P1I6ST (multi-company flag), P1I8ST (multi-warehouse flag)</p>
<p><strong>Output:</strong> *IN79, *IN78 (display indicators)</p>
<p><strong>Key Data:</strong> Indicators control field protection on subfile control screen</p>
</div>

<!-- AI_MARKER: F11_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>GBDSA2 sets display attributes for subfile control screen. If P1I6ST='N' (not multi-company), sets *IN79='1' to protect company field. If P1I8ST='N' (not multi-warehouse), sets *IN78='1' to protect warehouse field. Prevents users from changing fields they don't have access to.</p>
</div>

<!-- AI_MARKER: F11_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Security-based field protection. Sets indicators to protect company/warehouse fields based on user authorization flags.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([GBDSA2]) --> Init[*IN79='0'<br/>*IN78='0']
    Init --> ChkComp{P1I6ST='N'?}
    ChkComp -->|Yes| SetComp[*IN79='1']
    ChkComp -->|No| ChkWhse{P1I8ST='N'?}
    SetComp --> ChkWhse
    ChkWhse -->|Yes| SetWhse[*IN78='1']
    ChkWhse -->|No| End([Return])
    SetWhse --> End
</div>

<!-- AI_MARKER: F11_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None - just sets indicators</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Enforces security by preventing unauthorized field changes. Users restricted to single company/warehouse can't accidentally view or modify other companies' data.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 12: SARVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3139 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F12_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #2AIC3 (company number)</p>
<p><strong>Output:</strong> #CADTX (company name), W0RTN (return code)</p>
<p><strong>Key Data:</strong> ABAIC3 (key field), @ABREG3 (CAABREL3 format), ABADTX (company name from DB)</p>
</div>

<!-- AI_MARKER: F12_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SARVGN retrieves company name from CAABREL3 file. Sets up key (ABAIC3=#2AIC3), chains to @ABREG3 format. If *IN90='1' (not found), sets W0RTN='USR0003', blanks #CADTX, exits. If found (*IN90='0'), moves ABADTX to #CADTX.</p>
</div>

<!-- AI_MARKER: F12_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Standard retrieval pattern: setup key, CHAIN to file, check result, handle not-found or move data.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SARVGN]) --> Init[W0RTN=*BLANK<br/>ABAIC3=#2AIC3]
    Init --> Chain[CHAIN @ABREG3<br/>KRSSA key]
    Chain --> Chk{*IN90='1'?}
    Chk -->|Yes| NotFnd[W0RTN='USR0003'<br/>#CADTX=*BLANK<br/>GOTO SAEXIT]
    Chk -->|No| Found[#CADTX=ABADTX]
    NotFnd --> End([Return])
    Found --> End
</div>

<!-- AI_MARKER: F12_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CAABREL3 (@ABREG3) by company number</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Displays friendly company name on screen instead of numeric code. Improves user experience.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 13: SBRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3168 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F13_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #CCPCD (warehouse code)</p>
<p><strong>Output:</strong> #CO6NA (warehouse description), W0RTN (return code - 'USR0007' or 'Y2U0005' if not found)</p>
<p><strong>Key Data:</strong> ADAJCD (key field for warehouse code), @ADRET1 (CAADREL3 format), ADF8NA (warehouse description from database)</p>
</div>

<!-- AI_MARKER: F13_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SBRVGN retrieves warehouse description from CAADREL3 (Warehouse Codes master file). It sets up the key using the warehouse code (#CCPCD), chains to the database file via @ADRET1 format. If the warehouse code is not found (*IN90='1'), it returns error code 'Y2U0005', blanks the warehouse description (#CO6NA), and exits. If found, it moves the warehouse description (ADF8NA) to the output field (#CO6NA) for display on the screen header.</p>
</div>

<!-- AI_MARKER: F13_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Standard retrieval pattern for warehouse master data. Sets up key with warehouse code, chains to CAADREL3, handles not-found condition by returning error code and blanking output, or moves warehouse description to output field if found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SBRVGN]) --> Init[W0RTN=*BLANK<br/>ADAJCD=#CCPCD]
    Init --> Chain[CHAIN @ADRET1<br/>KRSSB key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='Y2U0005'<br/>#CO6NA=*BLANK<br/>GOTO SBEXIT]
    Chk -->|No| Found[#CO6NA=ADF8NA]
    NotFnd --> End([Return])
    Found --> End
</div>

<!-- AI_MARKER: F13_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CAADREL3 (@ADRET1) by warehouse code to retrieve warehouse description</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Displays friendly warehouse name instead of warehouse code on screen header, improving user experience and helping warehouse staff confirm they are viewing the correct location's data.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 14: SCRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3197 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F14_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> ##USR (user profile name)</p>
<p><strong>Output:</strong> WN0020 (user code model), W0RTN (return code - 'USR0763' if not found)</p>
<p><strong>Key Data:</strong> DRAJVN (key field for user profile), @DRRETH (CADRREL1 format - User Profile Control file), DRBUVN (user code model from database)</p>
</div>

<!-- AI_MARKER: F14_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SCRVGN retrieves user profile model/code from CADRREL1 (User Profile Control file). It sets up the key using the user profile name (##USR), chains to the database file via @DRRETH format. If the user profile is not found (*IN90='1'), it returns error code 'USR0763', blanks the user code model (WN0020), and exits. If found, it moves the user code model (DRBUVN) to the working field (WN0020). This function is used to determine the user's security profile model for subsequent authorization checks.</p>
</div>

<!-- AI_MARKER: F14_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Retrieves user profile model for security authorization. Sets up key with user profile name, chains to CADRREL1, handles not-found by returning error code and blanking user code model, or moves user code model to working field if found for subsequent security checks.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SCRVGN]) --> Init[W0RTN=*BLANK<br/>DRAJVN=##USR]
    Init --> Chain[CHAIN @DRRETH<br/>KRSSC key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='USR0763'<br/>WN0020=*BLANK<br/>GOTO SCEXIT]
    Chk -->|No| Found[WN0020=DRBUVN]
    NotFnd --> End([Return])
    Found --> End
</div>

<!-- AI_MARKER: F14_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CADRREL1 (@DRRETH) by user profile name to retrieve user code model for security profile</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Critical security function that determines user's authorization model. This user code model is used by subsequent functions (like SDRVGN) to check if user has access to specific warehouses and transaction types. Without this, users could potentially access unauthorized data.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 15: SDRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3226 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F15_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WL0001 (user profile name), WL0002 (warehouse code)</p>
<p><strong>Output:</strong> WL0003-WL0021 (warehouse access flags for various transaction types), WL0022 (record found flag 'Y'/'N'), W0RTN (return code - 'USR2626' if not found)</p>
<p><strong>Key Data:</strong> L1AJVN/L1AJCD (composite key: user + warehouse), @L1RESJ (PDL1REL1 format - User Warehouse Access file), L1UWAS (inventory transactions), L1EQSX (shipping transactions), and 17 other access flags</p>
</div>

<!-- AI_MARKER: F15_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SDRVGN retrieves user warehouse access rights from PDL1REL1 (User Warehouse Access security file). It sets up a composite key using user profile name (WL0001) and warehouse code (WL0002), then chains to the database. If no access record is found (*IN90='1'), it returns error code 'USR2626', sets WL0022='N' (not found), blanks all 19 access flags (WL0003-WL0021), and exits. If an access record exists, it copies all 19 access flags from the database record to working storage fields and sets WL0022='Y' (found). These flags control whether the user can perform inventory transactions, shipping transactions, lot/location tracking, cross-application, and other warehouse operations. This is a critical security gatekeeper that enforces warehouse-level access control.</p>
</div>

<!-- AI_MARKER: F15_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Security authorization function that validates user's access to specific warehouse operations. Sets up composite key (user + warehouse), chains to PDL1REL1, handles no-access by returning error and blanking all 19 access flags, or copies all access flags to working storage if user has warehouse access rights.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SDRVGN]) --> Init[W0RTN=*BLANK<br/>L1AJVN=WL0001<br/>L1AJCD=WL0002]
    Init --> Chain[CHAIN @L1RESJ<br/>KRSSD composite key]
    Chain --> Chk{*IN90='1'?<br/>No Access?}
    Chk -->|Yes| NotFnd[W0RTN='USR2626'<br/>Blank WL0003-WL0021<br/>WL0022='N'<br/>GOTO SDEXIT]
    Chk -->|No| Found[Copy L1UWAS→WL0003<br/>Copy L1EQSX→WL0005<br/>Copy 17 more flags<br/>WL0022='Y']
    NotFnd --> End([Return])
    Found --> End
</div>

<!-- AI_MARKER: F15_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN PDL1REL1 (@L1RESJ) by composite key (user + warehouse) to retrieve 19 warehouse access authorization flags including inventory transactions (WL0003), shipping transactions (WL0005), lot/location tracking (WL0004), and cross-application access (WL0006)</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Absolutely critical security function that prevents unauthorized warehouse access. Called during program initialization (via BAIZSF) to verify user has shipping transaction rights (WN0003) for the specified warehouse before allowing any load planning operations. Without this check, users could view or modify loads for warehouses they shouldn't access, creating serious security and audit compliance issues.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 16: SERVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3296 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F16_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WL0023 (item code)</p>
<p><strong>Output:</strong> WL0024 (item description line 1), WL0025 (item description line 2), W0RTN (return code - 'USR1160' if not found)</p>
<p><strong>Key Data:</strong> BYHGCD (key field for item code), @BYREA1 (OMBYREL1 format - OM Item file), BYAVNA/BYAWNA (description lines from database)</p>
</div>

<!-- AI_MARKER: F16_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SERVGN retrieves item descriptions from OMBYREL1 (OM Item master file). It sets up the key using the item code (WL0023), chains to the database file via @BYREA1 format. If the item code is not found (*IN90='1'), it returns error code 'USR1160', blanks both description lines (WL0024, WL0025), and exits. If found, it moves the two description lines (BYAVNA, BYAWNA) to the output fields for display on the subfile record showing what item is included in the load.</p>
</div>

<!-- AI_MARKER: F16_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Standard retrieval pattern for item master data. Sets up key with item code, chains to OMBYREL1, handles not-found condition by returning error code and blanking descriptions, or moves item description lines to output fields if found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SERVGN]) --> Init[W0RTN=*BLANK<br/>BYHGCD=WL0023]
    Init --> Chain[CHAIN @BYREA1<br/>KRSSE key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='USR1160'<br/>WL0024=*BLANK<br/>WL0025=*BLANK<br/>GOTO SEEXIT]
    Chk -->|No| Found[WL0024=BYAVNA<br/>WL0025=BYAWNA]
    NotFnd --> End([Return])
    Found --> End
</div>

<!-- AI_MARKER: F16_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN OMBYREL1 (@BYREA1) by item code to retrieve item description lines</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Displays item descriptions on the load planning subfile so warehouse staff can see exactly what products are scheduled for loading. This prevents picking errors and helps staff verify they're loading the correct items onto the truck.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 17: SFRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3327 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F17_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #1RMNB (load ID)</p>
<p><strong>Output:</strong> WN0038 (warehouse order found status 'Y'/'N'), WN0039 (count of confirmed/complete orders), WN0040 (count of other status orders), WUD9SX (warehouse order ship status 'A'/'P'), WUFBSX (plant controlled flag 'Y'/'N'), W0RTN (return code - 'USR0176' if not found)</p>
<p><strong>Key Data:</strong> WQSF02 (key: load ID), @BFCPD9 (OPBFCPL8 format - Order Header TRG file), BEGWST (header status: 'C'=Confirmed, 'R'=Complete), BEXUST (trans control: 'P'=Plant)</p>
</div>

<!-- AI_MARKER: F17_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SFRVGN analyzes order header records for a specific load to determine shipping status. It reads all order headers (OPBFCPL8) linked to the load ID using SETLL/READE loop. For each order header, it calls SGRVGN to check if any order details match the warehouse, sets WUFBSX='Y' if plant-controlled. It counts orders by status: WN0039 counts confirmed/complete orders (status 'C' or 'R'), WN0040 counts other statuses. After processing all orders, it sets warehouse order ship status: WUD9SX='A' if all orders confirmed/complete, WUD9SX='P' if mix of statuses. This determines if the load is ready to ship or still has pending items.</p>
</div>

<!-- AI_MARKER: F17_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Iterates through order headers for a load, calls SGRVGN to validate warehouse match, categorizes orders by status (confirmed/complete vs others), determines overall warehouse order ship status based on counts.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SFRVGN]) --> Init[WN0038='N'<br/>WN0039=0, WN0040=0<br/>WUFBSX='N']
    Init --> Setup[WQSF02=#1RMNB]
    Setup --> Setll[SETLL @BFCPD9<br/>READE @BFCPD9]
    Setll --> Loop{*IN90='0'?<br/>More records?}
    Loop -->|No| Eval{WN0039 > 0?}
    Loop -->|Yes| CallSG[EXSR SGRVGN]
    CallSG --> ChkPlant{BEXUST='P'?}
    ChkPlant -->|Yes| SetPlant[WUFBSX='Y']
    ChkPlant -->|No| ChkWhs{WN0038='Y'?}
    SetPlant --> ChkWhs
    ChkWhs -->|Yes| ChkStat{BEGWST='C'<br/>or 'R'?}
    ChkWhs -->|No| ReadNext[READE @BFCPD9]
    ChkStat -->|Yes| Inc39[WN0039 + 1]
    ChkStat -->|No| Inc40[WN0040 + 1]
    Inc39 --> ReadNext
    Inc40 --> ReadNext
    ReadNext --> Loop
    Eval -->|Yes| ChkMix{WN0040 > 0?}
    Eval -->|No| End([Return])
    ChkMix -->|Yes| SetP[WUD9SX='P']
    ChkMix -->|No| SetA[WUD9SX='A']
    SetP --> End
    SetA --> End
</div>

<!-- AI_MARKER: F17_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on OPBFCPL8 (@BFCPD9) by load ID to read all order headers for the load. Calls SGRVGN which reads OPBGWKL1 order details.</p>
<p><strong>External Calls:</strong> SGRVGN (validates warehouse match on order details)</p>
<p><strong>Business Impact:</strong> Critical shipping readiness indicator. Determines if load contains all confirmed/complete orders (ready to ship) or has mix of statuses (partial). This prevents shipping incomplete loads and helps warehouse prioritize which loads to finish first. The 'A' (all ready) vs 'P' (partial) status drives loading dock scheduling.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 18: SGRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3390 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F18_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> BEAIC3 (company number), BEC4NB (order number), #CCPCD (warehouse code)</p>
<p><strong>Output:</strong> WN0038 (warehouse order found status 'Y'/'N'), W0RSL (record selected flag 'Y'), W0RTN (return code - 'USR1309' if not found)</p>
<p><strong>Key Data:</strong> WQSG01/WQSG02 (composite key: company+order), @BGWKL1 (OPBGWKL1 format - Order Detail file), OMGMST (detail line status), OMAJCD (warehouse code from detail)</p>
</div>

<!-- AI_MARKER: F18_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SGRVGN validates that an order has detail lines matching the specified warehouse. It reads all order detail records (OPBGWKL1) for a company+order using SETLL/READE loop. For each detail line, it checks if the line status is not cancelled (statuses 'L','A','C','R','E','H','I' are valid), and if the detail's warehouse code (OMAJCD) matches the input warehouse (#CCPCD). If a match is found, it sets WN0038='Y', W0RSL='Y', and exits immediately (GOTO SGEXIT). This ensures the order has at least one active detail line shipping from the correct warehouse before including it in the load.</p>
</div>

<!-- AI_MARKER: F18_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Searches order detail lines for warehouse match. Loops through all detail lines, checks if line is not cancelled AND warehouse matches, sets found flags and exits immediately when first match found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SGRVGN]) --> Init[WN0038='N'<br/>WQSG01=BEAIC3<br/>WQSG02=BEC4NB]
    Init --> Setll[SETLL @BGWKL1<br/>READE @BGWKL1]
    Setll --> Loop{*IN90='0'?<br/>More details?}
    Loop -->|No| End([Return])
    Loop -->|Yes| ChkStat{OMGMST in<br/>'L','A','C','R',<br/>'E','H','I'?}
    ChkStat -->|No| ReadNext[READE @BGWKL1]
    ChkStat -->|Yes| ChkWhs{#CCPCD=<br/>OMAJCD?}
    ChkWhs -->|No| ReadNext
    ChkWhs -->|Yes| SetFlags[W0RSL='Y'<br/>WN0038='Y'<br/>GOTO SGEXIT]
    ReadNext --> Loop
    SetFlags --> End
</div>

<!-- AI_MARKER: F18_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on OPBGWKL1 (@BGWKL1) by company+order to read all order detail lines</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Warehouse validation prevents incorrect load assignments. Ensures orders are only included on loads shipping from the correct warehouse. Without this check, items could be staged at wrong warehouse, causing fulfillment delays and customer dissatisfaction.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 19: SHRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3434 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F19_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #1RMNB (load ID)</p>
<p><strong>Output:</strong> YL0001 (record found flag 'Y'/'N'), YL0002 (total quantity ordered accumulated across all load detail lines), W0RTN (return code - 'USR1192' if not found)</p>
<p><strong>Key Data:</strong> WQSH01 (key: load ID), @FLCPBW (OMFLCPL1 format - Load Detail file), FLAIC3 (company), FLC4NB (order number)</p>
</div>

<!-- AI_MARKER: F19_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SHRVGN validates that items exist on the load detail file and calculates total quantity. It reads all load detail records (OMFLCPL1) for a specific load ID using SETLL/READE loop. For each detail record, it calls SIRVGN to retrieve and accumulate the quantity ordered (YL0003) from order details (OPBGWKLA), adding each quantity to the total (YL0002). This function verifies the load has valid detail lines and computes the total number of items scheduled for loading.</p>
</div>

<!-- AI_MARKER: F19_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Iterates through all load detail records, calls SIRVGN for each to get order detail quantity, accumulates total quantity across all items on the load.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SHRVGN]) --> Init[YL0001='N'<br/>WQSH01=#1RMNB]
    Init --> Setll[SETLL @FLCPBW<br/>READE @FLCPBW]
    Setll --> Loop{*IN90='0'?<br/>More load details?}
    Loop -->|No| End([Return])
    Loop -->|Yes| CallSI[EXSR SIRVGN]
    CallSI --> Accum[YL0002 + YL0003]
    Accum --> ReadNext[READE @FLCPBW]
    ReadNext --> Loop
</div>

<!-- AI_MARKER: F19_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on OMFLCPL1 (@FLCPBW) by load ID. Calls SIRVGN which reads OPBGWKLA order details.</p>
<p><strong>External Calls:</strong> SIRVGN (retrieves order detail quantities and validates item exists on order)</p>
<p><strong>Business Impact:</strong> Critical load validation ensuring load plan matches actual order data. The total quantity calculation helps warehouse staff know how many items to load and verify counts match expectations. Prevents shipping errors from data inconsistencies between load plan and order system.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 20: SIRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3463 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F20_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> FLAIC3 (company), FLC4NB (order number), #CHGCD (item code)</p>
<p><strong>Output:</strong> YL0003 (quantity ordered accumulated), YL0001 (record found 'Y'/'N'), W0RTN (return code - 'USR1309' if not found)</p>
<p><strong>Key Data:</strong> WQSI01/WQSI02 (composite key: company+order), @BGWKAE (OPBGWKLA format - Order Detail alt file), WAHGCD (item code from detail), WAAVQT (available quantity)</p>
</div>

<!-- AI_MARKER: F20_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SIRVGN retrieves order detail information and validates item exists on load. It initializes YL0003=0, then reads order detail records (OPBGWKLA) for company+order using SETLL/READE loop. For each detail line, it checks if the item code (#CHGCD) matches the detail's item (WAHGCD). When match found, it accumulates the available quantity (WAAVQT) to YL0003 and sets YL0001='Y'. This function totals quantity for a specific item across all detail lines of an order, ensuring item is validly on the load.</p>
</div>

<!-- AI_MARKER: F20_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Searches order details for specific item match. Loops through all detail lines, compares item codes, accumulates quantities when item matches, sets found flag.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SIRVGN]) --> Init[YL0003=0<br/>WQSI01=FLAIC3<br/>WQSI02=FLC4NB]
    Init --> Setll[SETLL @BGWKAE<br/>READE @BGWKAE]
    Setll --> Chk90{*IN90='1'?<br/>Not found?}
    Chk90 -->|Yes| NotFnd[W0RTN='USR1309'<br/>GOTO SIEXIT]
    Chk90 -->|No| Loop{*IN90='0'?<br/>More details?}
    Loop -->|No| End([Return])
    Loop -->|Yes| ChkItem{#CHGCD=<br/>WAHGCD?}
    ChkItem -->|No| ReadNext[READE @BGWKAE]
    ChkItem -->|Yes| AccumQty[YL0003 + WAAVQT<br/>YL0001='Y']
    AccumQty --> ReadNext
    ReadNext --> Loop
    NotFnd --> End
</div>

<!-- AI_MARKER: F20_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on OPBGWKLA (@BGWKAE) by company+order to read alternative order detail view</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Item-level validation ensures correct items are on load. Quantity accumulation helps verify order fulfillment accuracy - if expected quantity doesn't match loaded quantity, warehouse knows there's a problem before truck leaves.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 21: SJRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3502 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F21_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #1RMNB (load ID)</p>
<p><strong>Output:</strong> 20+ load header fields including #1AODT (scheduled ship date), #1PKST (load status), #1RPNB (total load orders), #1FLAM (flat amount), #1BZNA (carrier code), #1RONB (truck size), #1VDST (load type), #1T4NB (schedule sequence), WUTLMI (total load miles), #1Q2CD (shipping method), #1VPCD (ship from warehouse), #1DBCD (ship to state), #1RMST (load acceptance status), #1IDWG (tot pallet tare weight), W0RTN (return code - 'USR1188' if not found)</p>
<p><strong>Key Data:</strong> WBRMNB (key: load ID), @FJCPBN (OMFJCPMT format - Load Header file)</p>
</div>

<!-- AI_MARKER: F21_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SJRVGN retrieves comprehensive load header screen fields from OMFJCPMT (Load Header file). It chains to the load header record using load ID. If not found (*IN90='1'), returns error 'USR1188'. If found, it moves 20+ fields from database (WB prefix) to screen fields (#1 prefix): scheduled ship date, load status, total orders, flat amount, allocate pounds status, trailer ID, carrier code, truck size, load type, schedule sequence, total miles, shipping method, ship-from warehouse, ship-to state, load acceptance status, and pallet tare weight. This populates the entire screen with current load planning data for display and modification.</p>
</div>

<!-- AI_MARKER: F21_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Single CHAIN to load header, retrieves all screen display fields. If found, moves 20+ database fields to screen variables for display and user interaction.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SJRVGN]) --> Init[WBRMNB=#1RMNB]
    Init --> Chain[CHAIN @FJCPBN<br/>KRSSJ key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='USR1188']
    Chk -->|No| Move[Move 20+ fields:<br/>#1AODT=WBAODT<br/>#1PKST=WBPKST<br/>#1RPNB=WBRPNB<br/>#1FLAM=WBFLAM<br/>#1BZNA=WBBZNA<br/>#1RONB=WBRONB<br/>#1VDST=WBVDST<br/>etc...]
    NotFnd --> End([Return])
    Move --> End
</div>

<!-- AI_MARKER: F21_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN OMFJCPMT (@FJCPBN) by load ID to retrieve complete load header record with 20+ fields</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Critical data retrieval for load planning screen. Provides warehouse staff with all load details: carrier assignment, truck specifications, schedule, status, and shipping parameters. This comprehensive view enables informed decisions about loading priorities, carrier selection, route optimization, and schedule adjustments. Essential for daily warehouse operations and logistics coordination.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 22: SKRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3539 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F22_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> #1RMNB (load ID)</p>
<p><strong>Output:</strong> W0RTN (return code - 'USR1188' if not found), processes all load header records for the load</p>
<p><strong>Key Data:</strong> WQSK02 (key: load ID), @FJCPSB (OMFJCPMT format - Load Header file for update)</p>
</div>

<!-- AI_MARKER: F22_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SKRVGN orchestrates load plan start time changes by reading all load header records for a load. It uses SETLL/READE loop to read through @FJCPSB format of OMFJCPMT. For each load header record found, it calls SLCHRC to perform the actual database update with the new start time (YL0007). This function acts as a controller that ensures all related load header records are updated consistently when user changes the load plan start time.</p>
</div>

<!-- AI_MARKER: F22_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Iterates through load header records, calls SLCHRC for each to apply start time change with record locking and validation.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SKRVGN]) --> Setup[WQSK02=#1RMNB]
    Setup --> Setll[SETLL @FJCPSB<br/>READE @FJCPSB]
    Setll --> Loop{*IN90='0'?<br/>More records?}
    Loop -->|No| End([Return])
    Loop -->|Yes| CallSL[EXSR SLCHRC:<br/>Change load header]
    CallSL --> ReadNext[READE @FJCPSB]
    ReadNext --> Loop
</div>

<!-- AI_MARKER: F22_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on OMFJCPMT (@FJCPSB). Calls SLCHRC which performs CHAIN/UPDAT operations.</p>
<p><strong>External Calls:</strong> SLCHRC (performs actual database update with full validation and TMS trigger)</p>
<p><strong>Business Impact:</strong> Ensures consistent update of load start times across all related records. Critical for accurate warehouse scheduling - if start time changes, all dependent systems (TMS, warehouse management) need updated information to coordinate truck arrivals and loading dock assignments.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 23: SLCHRC</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3565 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F23_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WCRMNB (load ID from parent), #RMBDT (load plan start date), YL0007 (load plan start time), WN0041-WN0183 (150+ working storage fields for all load header attributes)</p>
<p><strong>Output:</strong> YARDC (record data changed flag 'Y'/'N'), W0RTN (return code - 'Y2U0009' if record not found, 'Y2U0004' if update error), *IN98 (error indicator), updates OMFJCPL1 via @FJCPBO format</p>
<p><strong>Key Data:</strong> WDRMNB (key: load ID), @FJCPBO (OMFJCPL1 format for update), QOMFJ1/YARDCS (change detection), WDP0DT/WDCMTM (new start date/time), WDRYSX (MG Created Load flag), audit fields (WDAATM, WDAYNA, WDA0NA, WDAXDT)</p>
</div>

<!-- AI_MARKER: F23_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SLCHRC performs the actual database update for load plan start time changes with comprehensive validation and auditing. It initializes 150+ working storage fields (WN0041-WN0183) covering every load header attribute, then chains to OMFJCPL1 (@FJCPBO) using load ID. If record not found (*IN90='1'), returns error 'Y2U0009' with detailed error message. If record locked (*IN91='1'), returns lock error 'Y2U0016'. For valid records, it stores original data (QOMFJ1→YARDCS) for change detection, updates start date/time fields (WDP0DT=#RMBDT, WDCMTM=YL0007), sets audit fields (job time, user ID, job name, job date). If load is MG-created (WDRYSX='Y'), calls PBXOXFR to trigger TMS load synchronization with 'LPTCHG' change type. Compares original vs new data, sets YARDC='Y' if changed, performs UPDAT@FJCPBO if changed or UNLCK if unchanged, handles update errors (*IN91='1').</p>
</div>

<!-- AI_MARKER: F23_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Complex database change handler: initializes 150+ fields, chains to record with locking, validates not-found/locked conditions, stores original data, updates start time fields, sets audit trail, triggers TMS sync if MG-created, detects changes, updates or unlocks record, handles errors.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SLCHRC]) --> Init[Initialize WN0041-WN0183<br/>YARDC=*BLANK<br/>WDRMNB=WCRMNB]
    Init --> Chain[CHAIN @FJCPBO<br/>KLCHSL key]
    Chain --> Chk90{*IN90='1'?<br/>Not found?}
    Chk90 -->|Yes| NotFnd[W0RTN='Y2U0009'<br/>Send message<br/>GOTO SLEXIT]
    Chk90 -->|No| Chk91{*IN91='1'?<br/>Locked?}
    Chk91 -->|Yes| Locked[W0RTN='Y2U0016'<br/>Send lock message]
    Chk91 -->|No| Store[YARDCS=QOMFJ1<br/>Store original]
    Store --> Update[WDP0DT=#RMBDT<br/>WDCMTM=YL0007<br/>Set audit fields]
    Update --> ChkMG{WDRYSX='Y'?<br/>MG Created?}
    ChkMG -->|Yes| CallTMS[CALL PBXOXFR<br/>TMS Load Trigger<br/>YL0008='LPTCHG']
    ChkMG -->|No| ChkChg{QOMFJ1≠YARDCS?}
    CallTMS --> ChkErr{*IN90='1'?<br/>Call error?}
    ChkErr -->|Yes| SetErr[W0RTN='Y2U0032'<br/>SETON 98]
    ChkErr -->|No| ChkChg
    SetErr --> ChkChg
    ChkChg -->|Yes| SetFlag[YARDC='Y']
    ChkChg -->|No| DoUpd{YARDC='Y'?}
    SetFlag --> DoUpd
    DoUpd -->|Yes| Upd[UPDAT @FJCPBO]
    DoUpd -->|No| Unlck[UNLCK OMFJCPL1]
    Upd --> ChkUpd{*IN91='1'?}
    ChkUpd -->|Yes| UpdErr[W0RTN='Y2U0004']
    ChkUpd -->|No| End([Return])
    Unlck --> End
    NotFnd --> End
    Locked --> End
    UpdErr --> End
</div>

<!-- AI_MARKER: F23_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN OMFJCPL1 (@FJCPBO) with record locking, UPDAT@FJCPBO or UNLCK based on change detection</p>
<p><strong>External Calls:</strong> PBXOXFR (TMS Load Trigger for MG-created loads), ZASNMS (error message handling)</p>
<p><strong>Business Impact:</strong> Mission-critical database update handler ensuring data integrity for load scheduling changes. Prevents concurrent update conflicts through record locking, maintains complete audit trail (who/when/what), triggers downstream TMS synchronization for integrated transportation management. Without this robust change handler, load time changes could corrupt data or cause scheduling conflicts across warehouse and carrier systems.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 24: SMRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3830 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F24_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WN0184 (user profile name)</p>
<p><strong>Output:</strong> P1I6ST (allow multi-company flag 'Y'/'N'), P1MPNA (default printer name), P1BCCD (salesperson code), YL0015 (company number), WN0185 (user code model), W0RTN (return code - 'USR0763' or 'Y2U0005' if not found)</p>
<p><strong>Key Data:</strong> DRAJVN (key: user profile), @DRRETH (CADRREL1 format - User Profile Control file), DRI6ST, DRMPNA, DRBCCD, DRAIC3, DRBUVN (user profile fields from database)</p>
</div>

<!-- AI_MARKER: F24_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SMRVGN retrieves program setup and user defaults with company information from CADRREL1 (User Profile Control file). It chains to the user profile record using user profile name (WN0184). If not found (*IN90='1'), returns error 'Y2U0005'. If found, it moves user setup fields to program parameters: allow multi-company access flag (P1I6ST=DRI6ST), default printer (P1MPNA=DRMPNA), salesperson code (P1BCCD=DRBCCD), default company number (YL0015=DRAIC3), and user code model (WN0185=DRBUVN). This initializes the user's session with their personalized settings and security permissions.</p>
</div>

<!-- AI_MARKER: F24_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Retrieves user profile setup. Chains to CADRREL1, handles not-found error, moves 5 user configuration fields to program parameters for session initialization.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SMRVGN]) --> Init[DRAJVN=WN0184]
    Init --> Chain[CHAIN @DRRETH<br/>KRSSM key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='Y2U0005'<br/>GOTO SMEXIT]
    Chk -->|No| Move[P1I6ST=DRI6ST<br/>P1MPNA=DRMPNA<br/>P1BCCD=DRBCCD<br/>YL0015=DRAIC3<br/>WN0185=DRBUVN]
    NotFnd --> End([Return])
    Move --> End
</div>

<!-- AI_MARKER: F24_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CADRREL1 (@DRRETH) by user profile name to retrieve user setup/preferences</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Critical user session initialization. Sets multi-company access rights (determines if user can switch companies), default printer for reports, salesperson code for commissions/tracking, and default company context. Ensures users work in correct company context and have appropriate access levels from program start.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 25: SNRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3862 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F25_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WL0026 (user profile name), WL0027 (application code)</p>
<p><strong>Output:</strong> WL0028 (company number from application profile), WL0029 (warehouse code from application profile), W0RTN (return code - 'USR0767' if not found)</p>
<p><strong>Key Data:</strong> DTAJVN/DTDNCD (composite key: user+application), @DTRETE (CADTREL1 format - User Application Profile file), DTAIC3 (company), DTAJCD (warehouse)</p>
</div>

<!-- AI_MARKER: F25_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SNRVGN retrieves application-specific profile settings from CADTREL1 (User Application Profile file). It chains to the user application profile record using composite key of user profile name (WL0026) and application code (WL0027). If not found (*IN90='1'), returns error 'USR0767'. If found, it moves the application-specific company number (DTAIC3→WL0028) and warehouse code (DTAJCD→WL0029) to working storage. This allows users to have different default company/warehouse contexts for different applications, enabling personalized workflow based on which application module they're using.</p>
</div>

<!-- AI_MARKER: F25_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Retrieves application-specific user preferences. Chains to CADTREL1 using composite key (user+application), handles not-found, moves company and warehouse defaults to working storage.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SNRVGN]) --> Init[DTAJVN=WL0026<br/>DTDNCD=WL0027]
    Init --> Chain[CHAIN @DTRETE<br/>KRSSN key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='USR0767']
    Chk -->|No| Move[WL0028=DTAIC3<br/>WL0029=DTAJCD]
    NotFnd --> End([Return])
    Move --> End
</div>

<!-- AI_MARKER: F25_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CADTREL1 (@DTRETE) by composite key (user+application) to retrieve application-specific defaults</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Enables application-specific user defaults. A warehouse supervisor might default to warehouse 001 in shipping application but warehouse 002 in receiving application. This context-sensitive defaulting improves productivity by reducing data entry and ensuring users work in their primary operational areas without manual selection each time.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 26: SORVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3887 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F26_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Application code 'OMS' (hardcoded)</p>
<p><strong>Output:</strong> WUAUNA (application description), W0RTN (return code - 'USR0755' if not found)</p>
<p><strong>Key Data:</strong> WQSO01 (key: application code='OMS'), @DNRESF (CADNREL2 format - Application file), DNRSCD (application group code), DNAUNA (description)</p>
</div>

<!-- AI_MARKER: F26_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SORVGN retrieves application group description from CADNREL2 (Application master file) for the OMS application. It uses SETLL/READE loop to read all OMS application records. For each record, it checks if the application group code (DNRSCD) is blank. If blank, it directly moves the description (DNAUNA→WUAUNA). If not blank (grouped application), it calls SPRVGN to retrieve the description from the grouped application code. This provides friendly application names for user interface display.</p>
</div>

<!-- AI_MARKER: F26_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Loops through OMS applications, checks if application has a group code. If no group, uses description directly. If grouped, calls SPRVGN to get group description.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SORVGN]) --> Init[WQSO01='OMS']
    Init --> Setll[SETLL @DNRESF<br/>READE @DNRESF]
    Setll --> Loop{*IN90='0'?<br/>More apps?}
    Loop -->|No| End([Return])
    Loop -->|Yes| ChkGrp{DNRSCD<br/>blank?}
    ChkGrp -->|Yes| Direct[WUAUNA=DNAUNA]
    ChkGrp -->|No| CallSP[EXSR SPRVGN]
    Direct --> ReadNext[READE @DNRESF]
    CallSP --> ReadNext
    ReadNext --> Loop
</div>

<!-- AI_MARKER: F26_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on CADNREL2 (@DNRESF) by application code 'OMS'</p>
<p><strong>External Calls:</strong> SPRVGN (retrieves grouped application descriptions)</p>
<p><strong>Business Impact:</strong> Provides user-friendly application names in interface. Helps users identify which business application module they're working in (OMS = Order Management System), improving navigation and reducing confusion in multi-application environments.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 27: SPRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3921 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F27_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> DNRSCD (application group code from SORVGN)</p>
<p><strong>Output:</strong> WUAUNA (application description), W0RTN (return code - 'USR0755' or 'Y2U0005' if not found)</p>
<p><strong>Key Data:</strong> WQSP01 (key: application code), @DNRESF (CADNREL2 format - Application file), DNAUNA (description from database)</p>
</div>

<!-- AI_MARKER: F27_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SPRVGN retrieves specific application description from CADNREL2 (Application master file) using application group code (DNRSCD). It performs SETLL/READE loop to read matching applications. If not found (*IN90='1'), returns error 'Y2U0005' and blanks WUAUNA. If found, it loops through matching records and moves the description (DNAUNA→WUAUNA). This function is called by SORVGN to resolve grouped application names into their descriptive text.</p>
</div>

<!-- AI_MARKER: F27_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Retrieves grouped application description. Sets up key with application group code, performs SETLL/READE, handles not-found error, loops and moves description to output field.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SPRVGN]) --> Init[WQSP01=DNRSCD]
    Init --> Setll[SETLL @DNRESF<br/>READE @DNRESF]
    Setll --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='Y2U0005'<br/>WUAUNA=*BLANK<br/>GOTO SPEXIT]
    Chk -->|No| Loop{*IN90='0'?<br/>More records?}
    Loop -->|No| End([Return])
    Loop -->|Yes| Move[WUAUNA=DNAUNA]
    Move --> ReadNext[READE @DNRESF]
    ReadNext --> Loop
    NotFnd --> End
</div>

<!-- AI_MARKER: F27_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> SETLL/READE loop on CADNREL2 (@DNRESF) by application group code</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Secondary lookup supporting hierarchical application naming. Ensures consistent application descriptions across system modules for grouped applications.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 28: SQRVGN</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3955 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F28_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> ##USR (user profile name)</p>
<p><strong>Output:</strong> P1I8ST (allow multi-warehouse flag 'Y'/'N'), W0RTN (return code - 'USR0763' if not found)</p>
<p><strong>Key Data:</strong> DRAJVN (key: user profile), @DRRETH (CADRREL1 format - User Profile Control file), DRI8ST (multi-warehouse authorization flag from database)</p>
</div>

<!-- AI_MARKER: F28_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>SQRVGN retrieves multi-warehouse authorization flag from CADRREL1 (User Profile Control file). It chains to the user profile record using user profile name (##USR). If not found (*IN90='1'), returns error 'USR0763' and blanks P1I8ST. If found, it moves the multi-warehouse authorization flag (DRI8ST→P1I8ST). This determines whether the user is allowed to access and switch between multiple warehouse locations during their session, a critical security control for multi-warehouse operations.</p>
</div>

<!-- AI_MARKER: F28_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Simple retrieval for security authorization. Chains to user profile, handles not-found by blanking authorization flag, or moves multi-warehouse permission to program parameter if found.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([SQRVGN]) --> Init[DRAJVN=##USR]
    Init --> Chain[CHAIN @DRRETH<br/>KRSSQ key]
    Chain --> Chk{*IN90='1'?<br/>Not Found?}
    Chk -->|Yes| NotFnd[W0RTN='USR0763'<br/>P1I8ST=*BLANK<br/>GOTO SQEXIT]
    Chk -->|No| Move[P1I8ST=DRI8ST]
    NotFnd --> End([Return])
    Move --> End
</div>

<!-- AI_MARKER: F28_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> CHAIN CADRREL1 (@DRRETH) by user profile name to retrieve multi-warehouse authorization flag</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Critical security control determining if user can access multiple warehouses. Users restricted to single warehouse cannot switch warehouse contexts or view loads from other locations, preventing unauthorized cross-warehouse data access and ensuring proper segregation of duties in multi-location operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 29: XDCK2</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 3984 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F29_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> XDEXDT (external date 6-digit format), XDDTFM (date format code: 'DMY'/'MDY'/'YMD'), XOFFYY (century cutoff year), YPMTFD (prompt field flag)</p>
<p><strong>Output:</strong> XDINDT (internal date CYMD format), W0RTN (return code - 'Y2U0006' if invalid), XTTIM (timestamp cleared if invalid)</p>
<p><strong>Key Data:</strong> XDEX02/XDEX03/XDEX04 (external date components), XDINDD/XDINMM/XDINYY (internal day/month/year), @XD array (max days per month: 31,28,31,30...), XDWK1 (leap year calculation working field)</p>
</div>

<!-- AI_MARKER: F29_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>XDCK2 performs comprehensive date validation supporting multiple international formats (DMY/MDY/YMD) with leap year handling. If XDEXDT=0 or YPMTFD blank, exits immediately (blank dates allowed). Maps external format to internal: DMY→day=XDEX02/month=XDEX03/year=XDEX04, MDY→month=XDEX02/day=XDEX03/year=XDEX04, YMD→year=XDEX02/month=XDEX03/day=XDEX04. Handles century cutoff (if XDINYY < XOFFYY, adds 100 for 20XX). Validates month 1-12, day 1-max for month (uses @XD array). Special leap year logic: if month=2 AND year≠0 AND year≠200, divides year by 4, checks remainder=0 (leap year), allows day 29 if leap, else max day 28. If any validation fails, sends error message 'Y2U0006' via ZASNMS, sets W0RTN, clears XTTIM (timestamp).</p>
</div>

<!-- AI_MARKER: F29_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Complex multi-format date validator with leap year logic. Checks if date is zero (allowed), maps external format to internal components based on DMY/MDY/YMD setting, applies century cutoff, validates month/day ranges, performs special leap year calculation for February, sends error message if invalid.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([XDCK2]) --> ChkZero{XDEXDT=0?}
    ChkZero -->|Yes| End([Return])
    ChkZero -->|No| MapFmt{XDDTFM?}
    MapFmt -->|DMY| MapDMY[DD=XDEX02<br/>MM=XDEX03<br/>YY=XDEX04]
    MapFmt -->|MDY| MapMDY[MM=XDEX02<br/>DD=XDEX03<br/>YY=XDEX04]
    MapFmt -->|YMD| MapYMD[YY=XDEX02<br/>MM=XDEX03<br/>DD=XDEX04]
    MapDMY --> ChkCent{YY<XOFFYY?}
    MapMDY --> ChkCent
    MapYMD --> ChkCent
    ChkCent -->|Yes| AddCent[YY + 100]
    ChkCent -->|No| ChkPmt{YPMTFD<br/>blank?}
    AddCent --> ChkPmt
    ChkPmt -->|Yes| End
    ChkPmt -->|No| ValMonth{MM in<br/>1-12?}
    ValMonth -->|No| Error[W0RTN='Y2U0006'<br/>EXSR ZASNMS<br/>XTTIM=0]
    ValMonth -->|Yes| ValDay{DD in<br/>1-max?}
    ValDay -->|No| Error
    ValDay -->|Yes| ChkFeb{MM=2?}
    ChkFeb -->|No| End
    ChkFeb -->|Yes| ChkLeap{YY≠0 AND<br/>YY≠200?}
    ChkLeap -->|No| ValFeb28{DD>28?}
    ChkLeap -->|Yes| DivBy4[YY÷4 remainder]
    DivBy4 --> ChkRem{Remainder=0?<br/>Leap year?}
    ChkRem -->|No| ValFeb28
    ChkRem -->|Yes| End
    ValFeb28 -->|Yes| Error
    ValFeb28 -->|No| End
    Error --> End
</div>

<!-- AI_MARKER: F29_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None - pure validation logic</p>
<p><strong>External Calls:</strong> ZASNMS (sends error message 'Y2U0006' - Invalid date)</p>
<p><strong>Business Impact:</strong> Prevents invalid ship dates from corrupting load planning system. Critical for scheduling - invalid dates could cause missed shipments, incorrect billing cycles, or carrier coordination failures. Supports international operations by handling different regional date formats (European DMY vs American MDY vs Asian YMD).</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 30: XDVC2T</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4052 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F30_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> XDINDD (internal day), XDINMM (internal month), XDINYY (internal year), XDDTFM (date format: 'DMY'/'MDY'/'YMD')</p>
<p><strong>Output:</strong> XDEX01 (century=0), XDEX02/XDEX03/XDEX04 (external date components mapped by format)</p>
<p><strong>Key Data:</strong> Format-specific mapping rules for date component positioning</p>
</div>

<!-- AI_MARKER: F30_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>XDVC2T converts internal date format (CYMD) to external display format based on regional preferences. It sets century component to 0 (XDEX01=0), then maps internal components to external positions based on XDDTFM: DMY format→XDEX02=day/XDEX03=month/XDEX04=year, MDY format→XDEX02=month/XDEX03=day/XDEX04=year, YMD format→XDEX02=year/XDEX03=month/XDEX04=day. This enables the system to display dates in format matching user's regional settings (European 31/12/24, American 12/31/24, or Asian 24/12/31).</p>
</div>

<!-- AI_MARKER: F30_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Simple format converter. Sets century to 0, checks format code, maps internal date components to external positions accordingly.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([XDVC2T]) --> Init[XDEX01=0]
    Init --> ChkFmt{XDDTFM?}
    ChkFmt -->|DMY| SetDMY[XDEX02=XDINDD<br/>XDEX03=XDINMM<br/>XDEX04=XDINYY]
    ChkFmt -->|MDY| SetMDY[XDEX02=XDINMM<br/>XDEX03=XDINDD<br/>XDEX04=XDINYY]
    ChkFmt -->|YMD| SetYMD[XDEX02=XDINYY<br/>XDEX03=XDINMM<br/>XDEX04=XDINDD]
    SetDMY --> End([Return])
    SetMDY --> End
    SetYMD --> End
</div>

<!-- AI_MARKER: F30_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None - pure conversion logic</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Enables localized date display matching user regional preferences. International warehouse operations require flexible date formatting - European staff expect DD/MM/YY while American staff expect MM/DD/YY. This improves usability and reduces date entry errors across global operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 31: Y0SET</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4077 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F31_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> None</p>
<p><strong>Output:</strong> None</p>
<p><strong>Key Data:</strong> Empty stub function - no operations performed</p>
</div>

<!-- AI_MARKER: F31_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>Y0SET is an empty stub function with no implementation. The subroutine begins (BEGSR) and immediately ends (ENDSR) with no code between. This appears to be a reserved function name for potential future cursor positioning functionality that was never implemented or has been deprecated in the current version of the program.</p>
</div>

<!-- AI_MARKER: F31_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> No-operation stub function. Immediately returns without performing any actions.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Y0SET]) --> End([Return immediately])
</div>

<!-- AI_MARKER: F31_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> No business impact - stub function with no implementation. May be called by other code but performs no operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 32: Y8TST</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4084 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F32_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> @#RWCL (cursor row/column position from screen DDS), ##SFRC (subfile top record number)</p>
<p><strong>Output:</strong> ZINPOS (calculated position), W0CRW (cursor row), W0CCL (cursor column), W0CSRR (subfile record RRN), W0CFL (field name at cursor position)</p>
<p><strong>Key Data:</strong> W0END/W0BEG/W0NAM arrays (field boundary positions and names - populated at compile time), F (lookup index counter), subfile area range 02816-06144</p>
</div>

<!-- AI_MARKER: F32_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>Y8TST tests and resolves cursor position to determine which field and subfile record user is on. It calculates ZINPOS from @#RWCL, divides by 256 to get cursor row (W0CRW) with remainder as column (W0CCL). If cursor is in subfile record area (positions 02816-06144), it calculates the subfile RRN: subtracts 11 from row (W0CRW-11→W0CSRR), divides by record length (ZHRLEN), adds column to base position 02816, then adds top subfile RRN (##SFRC) to get actual record number. Performs LOOKUP on W0END array with W0BEG lower bound check to find which field cursor is on, returns field name in W0CFL. If LOOKUP fails (*IN96='0') or cursor outside fields, clears W0CSRR to zero.</p>
</div>

<!-- AI_MARKER: F32_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Calculates cursor position coordinates, determines if in subfile area, computes subfile RRN using row math, performs array lookup to identify field name at cursor position.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Y8TST]) --> Calc[ZINPOS=@#RWCL<br/>W0CRW=ZINPOS÷256<br/>W0CCL=remainder]
    Calc --> ChkSfl{ZINPOS in<br/>02816-06144?}
    ChkSfl -->|No| Lookup[F=1<br/>LOOKUP W0END,F]
    ChkSfl -->|Yes| CalcRRN[W0CSRR=W0CRW-11<br/>ZINPOS=02816+W0CCL<br/>W0CSRR+##SFRC]
    CalcRRN --> Lookup
    Lookup --> Init[W0CFL=*BLANK]
    Init --> DoLookup[LOOKUP W0END,F<br/>with W0BEG check]
    DoLookup --> Chk96{*IN96='1'<br/>AND ZINPOS≥W0BEG,F?}
    Chk96 -->|Yes| SetField[W0CFL=W0NAM,F]
    Chk96 -->|No| ChkBlank{W0CFL<br/>blank?}
    SetField --> End([Return])
    ChkBlank -->|Yes| Clear[W0CSRR=0]
    ChkBlank -->|No| End
    Clear --> End
</div>

<!-- AI_MARKER: F32_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None - pure calculation and array lookup</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Enables context-sensitive features like field-level help (F1) and prompting (F4). When user presses help or prompt key, system knows exactly which field they need assistance with, providing targeted information rather than generic help. Critical for user experience and training efficiency.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 33: Y9CLR</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4113 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F33_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> None</p>
<p><strong>Output:</strong> None</p>
<p><strong>Key Data:</strong> Empty stub function - no operations performed</p>
</div>

<!-- AI_MARKER: F33_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>Y9CLR is an empty stub function with no implementation. The subroutine begins (BEGSR) and immediately ends (ENDSR) with no code between. This appears to be a reserved function name for clearing cursor positioning data that was never implemented or has been deprecated in the current version of the program.</p>
</div>

<!-- AI_MARKER: F33_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> No-operation stub function. Immediately returns without performing any actions.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Y9CLR]) --> End([Return immediately])
</div>

<!-- AI_MARKER: F33_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> No business impact - stub function with no implementation. May be called by other code but performs no operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 34: ZASNMS</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4120 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F34_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> ZAPGMQ (program message queue name, defaults to ##PGM), ZAMSGF (message file name, defaults to ZADFMF), ZAMSID (message ID), ZAMSDA (message data), ZAMSTP (message type), ZAPGRL (release queue level)</p>
<p><strong>Output:</strong> All input fields cleared after message sent</p>
<p><strong>Key Data:</strong> ##PGM (current program name), ZADFMF (default message file from data area)</p>
</div>

<!-- AI_MARKER: F34_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZASNMS sends messages to the program's message queue for user display. If ZAPGMQ is blank, it defaults to current program name (##PGM). If ZAMSGF is blank, it defaults to system message file (ZADFMF). It then calls IBM i utility program Y2SNMGC passing 6 parameters: program queue, release queue level, message ID, message file name, message data, and message type. After the message is sent, it clears all 6 parameter fields to blank/zero so they default properly on the next call. This is the centralized message handling function used throughout the program for error messages, warnings, and informational alerts.</p>
</div>

<!-- AI_MARKER: F34_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Centralized message sender. Sets defaults for queue and message file if not provided, calls IBM i message utility, clears all parameters for next use.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZASNMS]) --> ChkPgmQ{ZAPGMQ<br/>blank?}
    ChkPgmQ -->|Yes| SetPgmQ[ZAPGMQ=##PGM]
    ChkPgmQ -->|No| ChkMsgF{ZAMSGF<br/>blank?}
    SetPgmQ --> ChkMsgF
    ChkMsgF -->|Yes| SetMsgF[ZAMSGF=ZADFMF]
    ChkMsgF -->|No| Call[CALL Y2SNMGC<br/>6 parameters]
    SetMsgF --> Call
    Call --> Clear[ZAPGMQ=*BLANK<br/>ZAPGRL=*BLANK<br/>ZAMSID=*BLANK<br/>ZAMSGF=*BLANK<br/>ZAMSDA=*BLANK<br/>ZAMSTP=*BLANK]
    Clear --> End([Return])
</div>

<!-- AI_MARKER: F34_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> Y2SNMGC (IBM i message sending utility - sends messages to program message queue for display to user)</p>
<p><strong>Business Impact:</strong> Critical user communication mechanism. All error messages, warnings, and confirmations flow through this function ensuring consistent message formatting and proper error logging. Without this, users wouldn't see validation errors, missing data warnings, or success confirmations, making the system unusable.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 35: ZDVPMT</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4148 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F35_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> *IN04 (prompt key indicator), @#RWCL (cursor row/column), @#SFRC (subfile top RRN), @#DFMT (display format name '#SFLCTL'), ##RR (current record number), W0PMT (prompt enabled flag)</p>
<p><strong>Output:</strong> YPMTFD (prompted field name or '*NONE'), YAFSCH (first changed RRN for SFLNXTCHG), YPMRRN (prompt RRN), ZZCSRW/ZZCSCL (saved cursor position), Y#SFRC (saved subfile top), *IN84 (SFLNXTCHG indicator)</p>
<p><strong>Key Data:</strong> ZHCSRW/ZHCSCL (cursor row/column calculated), ZHSTRW=11/ZHNDRW=23 (subfile row range), ZHRLEN=1 (row length), ZZSFM (subfile mode), YZSFDL (subfile display line), ZHF4RW (F4 row), ZHWK1# (working field)</p>
</div>

<!-- AI_MARKER: F35_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZDVPMT is a complex F4 prompt request handler for subfile operations. When *IN04='1' (F4 pressed): initializes prompt workfields, extracts cursor position (ZHCSRW/ZHCSCL) from @#RWCL by dividing by 256, saves cursor for redisplay (ZZCSRW/ZZCSCL), saves subfile top position (Y#SFRC=@#SFRC). Initializes subfile parameters (rows 11-23, length 1). If cursor is in subfile rows 11-23, calculates which line (YZSFDL) and F4 row (ZHF4RW). Special case: if cursor at row 10 column 77 on #SFLCTL format, sets YPMTFD='#2PKST' (load status field). If YPMTFD still blank AND prompting disabled (W0PMT='N'), sets YPMTFD='*NONE', sets help flag (W0HLP='Y', ZAFSMS='Y'), sends error 'Y2U0101'. If cursor in valid subfile range AND field identified: saves first changed RRN (READC #SFLRCD, if found sets YAFSCH=##RR, *IN84, UPDAT), calculates prompt RRN from cursor position, chains to that subfile record, updates with SFLNXTCHG, determines lowest RRN (YAFSCH) for positioning.</p>
</div>

<!-- AI_MARKER: F35_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Complex F4 prompt handler. Extracts cursor position, identifies field, validates prompting allowed, handles special case for load status field, saves changed record positions, chains to prompted subfile record, sets SFLNXTCHG indicator for proper cursor positioning after prompt returns.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZDVPMT]) --> Init[Clear YPMTFD/YAFSCH/YPMRRN]
    Init --> Chk04{*IN04='1'?}
    Chk04 -->|No| End([Return])
    Chk04 -->|Yes| Extract[ZHCSRW=@#RWCL÷256<br/>ZHCSCL=remainder<br/>Save cursor positions]
    Extract --> InitSfl[ZHSTRW=11, ZHNDRW=23<br/>ZHRLEN=1<br/>Y#SFRC=@#SFRC]
    InitSfl --> CalcRow{ZHCSRW in<br/>11-23?}
    CalcRow -->|Yes| CalcLine[Calculate YZSFDL/ZHF4RW]
    CalcRow -->|No| ChkSpec{Row=10<br/>Col=77<br/>on #SFLCTL?}
    CalcLine --> ChkSpec
    ChkSpec -->|Yes| SetPKST[YPMTFD='#2PKST']
    ChkSpec -->|No| ChkBlank{YPMTFD<br/>blank?}
    SetPKST --> ChkBlank
    ChkBlank -->|Yes| ChkPmt{W0PMT='N'?}
    ChkBlank -->|No| ChkInSfl{ZHCSRW in<br/>11-23 AND<br/>YPMTFD≠'*NONE'?}
    ChkPmt -->|Yes| SetNone[YPMTFD='*NONE'<br/>W0HLP='Y'<br/>Send Y2U0101]
    ChkPmt -->|No| ChkInSfl
    SetNone --> ChkInSfl
    ChkInSfl -->|No| End
    ChkInSfl -->|Yes| SaveChg[READC #SFLRCD<br/>If found: YAFSCH=##RR<br/>SETON 84, UPDAT]
    SaveChg --> CalcRRN[Calculate YPMRRN<br/>CHAIN #SFLRCD]
    CalcRRN --> ChkChain{*IN92='0'?}
    ChkChain -->|Yes| UpdRec[SETON 84<br/>UPDAT #SFLRCD]
    ChkChain -->|No| ClrRRN[YPMRRN=0]
    UpdRec --> CompRRN{YAFSCH=0<br/>or YPMRRN<YAFSCH?}
    ClrRRN --> CompRRN
    CompRRN -->|True| SetAFSCH[YAFSCH=YPMRRN]
    CompRRN -->|False| End
    SetAFSCH --> End
</div>

<!-- AI_MARKER: F35_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> READC/CHAIN/UPDAT on #SFLRCD subfile to track changed records and set SFLNXTCHG positioning</p>
<p><strong>External Calls:</strong> ZASNMS (sends error 'Y2U0101' if prompting not allowed)</p>
<p><strong>Business Impact:</strong> Enables F4 prompting on load planning screen fields. Users can press F4 on fields like Load Status or Carrier Code to see valid value lists, dramatically improving data entry speed and accuracy. Without this, users would need to memorize hundreds of valid codes. The cursor positioning logic ensures users return to exact spot after selecting from prompt list.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 36: ZHHPKY</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4256 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F36_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> *IN25 (help key indicator F1), @#RWCL (cursor row/column position), ##PGM (program name='PBMHDFR')</p>
<p><strong>Output:</strong> W0HLP='Y' (help request flag), ZZCSRW/ZZCSCL (saved cursor row/column for redisplay), W0RTN (return code from help display), WCSRLC='OFF' (cursor location indicator cleared), *IN94 (set ON after clearing cursor)</p>
<p><strong>Key Data:</strong> ZHCSRW/ZHCSCL (cursor position extracted), W0HPMB (help text source=##PGM), YYHPFL/YYHPLB (help file/library=blank), YYHLVN='*CSRLOC' (cursor location help), YYUSOP='*NORMAL' (help options), YYRW/YYCL (row/column passed to help), YYLGCT=0 (label group count), YYLGVN (label groups=blank)</p>
</div>

<!-- AI_MARKER: F36_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZHHPKY displays context-sensitive help text when user presses F1 (help key). It sets help request flag (W0HLP='Y'), extracts cursor position from @#RWCL by dividing by 256 to get row (ZHCSRW) and remainder for column (ZHCSCL), saves cursor position for redisplay after help (ZZCSRW=ZHCSRW, ZZCSCL=ZHCSCL). Calls IBM i help display utility YDDSHPR with 11 parameters including program name (W0HPMB=##PGM), help label '*CSRLOC' (cursor location based help), option '*NORMAL', cursor row/column, and help group information. After help display completes, clears set cursor indicator (conditional on *IN94: WCSRLC='OFF', SETON 94). This provides field-level contextual help to users based on where cursor is positioned.</p>
</div>

<!-- AI_MARKER: F36_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> F1 help key handler. Sets help flag, extracts and saves cursor position, calls IBM i help utility with cursor location parameters, clears cursor indicator after help display.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZHHPKY]) --> SetHelp[W0HLP='Y']
    SetHelp --> Extract[ZHCSRW=@#RWCL÷256<br/>ZHCSCL=remainder]
    Extract --> Save[ZZCSRW=ZHCSRW<br/>ZZCSCL=ZHCSCL]
    Save --> Call[CALL YDDSHPR<br/>11 parameters:<br/>W0HPMB=##PGM<br/>YYHLVN='*CSRLOC'<br/>YYUSOP='*NORMAL'<br/>YYRW/YYCL=cursor<br/>etc...]
    Call --> Chk94{*IN94='0'?}
    Chk94 -->|Yes| Clear[WCSRLOC='OFF'<br/>SETON 94]
    Chk94 -->|No| End([Return])
    Clear --> End
</div>

<!-- AI_MARKER: F36_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> YDDSHPR (IBM i help display utility - shows context-sensitive help text based on cursor position and program member)</p>
<p><strong>Business Impact:</strong> F1 help key provides instant, context-sensitive assistance to warehouse users. When user positions cursor on Load Status field and presses F1, they see help specific to load status codes rather than generic program help. Critical for training new staff and reducing support calls - users get self-service answers without leaving their workflow.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 37: ZXEXPG</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4290 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F37_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> *IN12 (cancel key indicator F12) or *IN03 (exit key indicator F3)</p>
<p><strong>Output:</strong> Program termination via ZYEXPG</p>
<p><strong>Key Data:</strong> None - simple wrapper function</p>
</div>

<!-- AI_MARKER: F37_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZXEXPG is a wrapper function for program exit/cancellation. It contains a single line that executes ZYEXPG (EXSR ZYEXPG) which performs the actual program termination. This function is called when user presses F3 (Exit) or F12 (Cancel) to leave the load planning screen. By using a wrapper, the program maintains a consistent exit point name (ZXEXPG) while delegating actual termination logic to ZYEXPG.</p>
</div>

<!-- AI_MARKER: F37_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Simple wrapper that calls actual exit function. Provides named exit point for program cancellation without duplicating termination code.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZXEXPG]) --> Call[EXSR ZYEXPG]
    Call --> End([Return])
</div>

<!-- AI_MARKER: F37_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> None</p>
<p><strong>External Calls:</strong> ZYEXPG (internal subroutine - actual program exit handler)</p>
<p><strong>Business Impact:</strong> Provides clean exit mechanism when user presses F3/F12 to cancel out of load planning screen. Ensures proper program termination without leaving database locks or incomplete transactions.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 38: ZYEXPG</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4298 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F38_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> None</p>
<p><strong>Output:</strong> *INLR='1' (Last Record indicator - triggers program termination and resource cleanup), program returns to caller</p>
<p><strong>Key Data:</strong> LR indicator (IBM i program termination flag)</p>
</div>

<!-- AI_MARKER: F38_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZYEXPG performs direct program exit and resource cleanup. It sets the Last Record indicator to ON (SETON LR), which signals to IBM i that the program is terminating and should release all resources (file locks, memory allocations, data area locks). It then executes RETRN (return) to return control to the calling program. This is the actual termination handler called by ZXEXPG when user exits the program via F3/F12 keys.</p>
</div>

<!-- AI_MARKER: F38_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Two-step program termination: set Last Record indicator ON to trigger resource cleanup, then return to calling program.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZYEXPG]) --> SetLR[SETON LR<br/>Last Record ON]
    SetLR --> Return[RETRN<br/>Return to caller]
    Return --> End([Program Terminated])
</div>

<!-- AI_MARKER: F38_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> Releases all database file locks and closes all open files (automatic via LR indicator)</p>
<p><strong>External Calls:</strong> None</p>
<p><strong>Business Impact:</strong> Critical for multi-user environment. Clean program termination releases database locks immediately, allowing other warehouse users to access the same load records without waiting. Prevents resource contention and ensures system remains responsive during peak shipping hours when many users are simultaneously planning loads.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 39: ZZINIT</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 4311 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F39_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> W0ICL (initial call flag), ##SD7 (system date 7-digit), CAMGFLA data area (default message file)</p>
<p><strong>Output:</strong> W0ICL='Y'/'N' (first call flag), clears all program parameters P0RTN, W0RTN, W0RSL, W0RSF, W0RTW, W0ENV='400', clears P1 group (12 fields), P2 group (13 fields), P3 group (7 fields), P4-P9 groups (1-2 fields each), ##JDT (job date), ##JTM/##TME (job/screen time), ZADFMF (default message file), working storage initialization (WUAWNA, WUD9SX, WUFBSX, WAAIC3, WAC4NB, WADPNB, WAUENB, etc.)</p>
<p><strong>Key Data:</strong> PGMDS (program data structure from Y2RTJCR), 40+ parameter fields across P1-P9 groups, multiple working storage fields for subfile and database operations</p>
</div>

<!-- AI_MARKER: F39_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>ZZINIT performs comprehensive program initialization ensuring clean starting state. If W0ICL is blank (first call ever), sets W0ICL='Y', otherwise sets W0ICL='N' for subsequent calls. Clears all control fields (P0RTN, W0RTN, W0RSL='record selected', W0RSF='reload subfile flag', W0RTW='return code working', W0ENV='400'). Systematically blanks ALL parameter groups: P1 (12 fields: warehouse code, enterprise codes, salesperson, date format, user profile, multi-company/warehouse flags, printer, first-time flag, requested delivery date), P2 (13 fields: printer description/settings, company/date/order numbers, system values, change flags), P3 (7 fields: display options, sequence, update/error status, weight), P4-P9 (miscellaneous job/load fields). Calls Y2RTJCR to retrieve job attributes into PGMDS data structure. Sets job date (##JDT=##SD7) and gets current time (TIME ##JTM, TIME ##TME). Retrieves default message file (IN ZADFMF from CAMGFLA data area). Initializes working storage fields for description lines, status flags, and database record fields.</p>
</div>

<!-- AI_MARKER: F39_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> Comprehensive startup initialization. Sets first-call flag, clears all 40+ parameter fields across 9 parameter groups, calls IBM i utility to get job info, sets date/time, retrieves message file, initializes working storage for subfile and database operations.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([ZZINIT]) --> ChkICL{W0ICL<br/>blank?}
    ChkICL -->|Yes| SetFirst[W0ICL='Y']
    ChkICL -->|No| SetNot[W0ICL='N']
    SetFirst --> ClrCtl[Clear control:<br/>P0RTN, W0RTN, W0RSL<br/>W0RSF, W0RTW<br/>W0ENV='400']
    SetNot --> ClrCtl
    ClrCtl --> ClrP1[Clear P1 group:<br/>12 fields including<br/>warehouse, enterprise,<br/>user, multi-company]
    ClrP1 --> ClrP2[Clear P2 group:<br/>13 printer/order fields]
    ClrP2 --> ClrP3[Clear P3 group:<br/>7 display/update fields]
    ClrP3 --> ClrP4_9[Clear P4-P9:<br/>Misc job/load fields]
    ClrP4_9 --> CallJob[CALL Y2RTJCR<br/>PARM PGMDS]
    CallJob --> SetDT[##JDT=##SD7<br/>TIME ##JTM<br/>TIME ##TME]
    SetDT --> GetMsgF[IN ZADFMF<br/>from data area]
    GetMsgF --> InitWrk[Initialize working:<br/>WUAWNA, WUD9SX,<br/>WUFBSX, WAAIC3,<br/>WAC4NB, etc...]
    InitWrk --> End([Return])
</div>

<!-- AI_MARKER: F39_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> IN (read data area CAMGFLA to get default message file)</p>
<p><strong>External Calls:</strong> Y2RTJCR (IBM i retrieve job attributes utility - populates PGMDS data structure with job name, user, date, time)</p>
<p><strong>Business Impact:</strong> Critical startup function ensuring clean program state and preventing data contamination from previous runs. Without proper initialization, residual data from a previous user's session could cause: wrong warehouse data to display, incorrect security permissions, or load data to appear for different company. The comprehensive parameter clearing ensures each user session starts fresh with no cross-contamination between different companies, warehouses, or user profiles.</p>
</div>
</div>

<h2>Function Summary</h2>
<table>
<thead><tr><th>Function</th><th>Line</th><th>Business Purpose</th></tr></thead>
<tbody>
<tr><td><strong>BAIZSF</strong></td><td>1133</td><td>Initialize subfile and load first page of load planning data with security validation</td></tr>
<tr><td><strong>BBLDSF</strong></td><td>1655</td><td>Build additional subfile pages to display more load items beyond initial screen</td></tr>
<tr><td><strong>CAEXFM</strong></td><td>1880</td><td>Display load planning screen and wait for user input/function keys</td></tr>
<tr><td><strong>DBPRSF</strong></td><td>2506</td><td>Process modified subfile records after user makes changes</td></tr>
<tr><td><strong>DCPRSR</strong></td><td>2529</td><td>Validate individual subfile record changes including date/time validation</td></tr>
<tr><td><strong>DHPRCF</strong></td><td>2621</td><td>Display confirmation prompt with yes/no value list support</td></tr>
<tr><td><strong>EAPRSF</strong></td><td>2723</td><td>Update database from modified subfile records post-confirmation</td></tr>
<tr><td><strong>EBPRSR</strong></td><td>2750</td><td>Process individual record database update with time conversion</td></tr>
<tr><td><strong>FBRQRL</strong></td><td>2779</td><td>Request subfile reload when HOME key pressed</td></tr>
<tr><td><strong>GADSA1</strong></td><td>2787</td><td>Set display attributes for knockout status items in subfile</td></tr>
<tr><td><strong>GBDSA2</strong></td><td>2798</td><td>Set field protection based on multi-company/warehouse security permissions</td></tr>
<tr><td><strong>SARVGN</strong></td><td>3139</td><td>Retrieve company name for screen header display</td></tr>
<tr><td><strong>SBRVGN</strong></td><td>3168</td><td>Retrieve warehouse description for screen header display</td></tr>
<tr><td><strong>SCRVGN</strong></td><td>3197</td><td>Retrieve user profile model for security authorization checks</td></tr>
<tr><td><strong>SDRVGN</strong></td><td>3226</td><td>Retrieve warehouse access rights for user security validation</td></tr>
<tr><td><strong>SERVGN</strong></td><td>3296</td><td>Retrieve item descriptions for subfile display</td></tr>
<tr><td><strong>SFRVGN</strong></td><td>3327</td><td>Analyze order headers to determine load shipping readiness status</td></tr>
<tr><td><strong>SGRVGN</strong></td><td>3390</td><td>Validate warehouse match on order detail lines</td></tr>
<tr><td><strong>SHRVGN</strong></td><td>3434</td><td>Validate items exist on load detail and calculate total quantity</td></tr>
<tr><td><strong>SIRVGN</strong></td><td>3463</td><td>Validate item exists on order and accumulate quantity ordered</td></tr>
<tr><td><strong>SJRVGN</strong></td><td>3502</td><td>Retrieve comprehensive load header fields for screen display</td></tr>
<tr><td><strong>SKRVGN</strong></td><td>3539</td><td>Orchestrate load plan start time changes across all load headers</td></tr>
<tr><td><strong>SLCHRC</strong></td><td>3565</td><td>Perform database update for load time changes with TMS trigger and locking</td></tr>
<tr><td><strong>SMRVGN</strong></td><td>3830</td><td>Retrieve user program setup with company and security defaults</td></tr>
<tr><td><strong>SNRVGN</strong></td><td>3862</td><td>Retrieve application-specific user profile preferences</td></tr>
<tr><td><strong>SORVGN</strong></td><td>3887</td><td>Retrieve OMS application group description for display</td></tr>
<tr><td><strong>SPRVGN</strong></td><td>3921</td><td>Retrieve grouped application description supporting SORVGN</td></tr>
<tr><td><strong>SQRVGN</strong></td><td>3955</td><td>Retrieve multi-warehouse authorization flag for security control</td></tr>
<tr><td><strong>XDCK2</strong></td><td>3984</td><td>Validate date format with DMY/MDY/YMD support and leap year logic</td></tr>
<tr><td><strong>XDVC2T</strong></td><td>4052</td><td>Convert internal date to external format based on regional preferences</td></tr>
<tr><td><strong>Y0SET</strong></td><td>4077</td><td>Empty stub function - no operations (reserved for future use)</td></tr>
<tr><td><strong>Y8TST</strong></td><td>4084</td><td>Calculate cursor position and identify field for help/prompting</td></tr>
<tr><td><strong>Y9CLR</strong></td><td>4113</td><td>Empty stub function - no operations (reserved for future use)</td></tr>
<tr><td><strong>ZASNMS</strong></td><td>4120</td><td>Send error/info messages to program message queue for user display</td></tr>
<tr><td><strong>ZDVPMT</strong></td><td>4148</td><td>Handle F4 prompt requests with cursor positioning and subfile tracking</td></tr>
<tr><td><strong>ZHHPKY</strong></td><td>4256</td><td>Display context-sensitive help when F1 key pressed</td></tr>
<tr><td><strong>ZXEXPG</strong></td><td>4290</td><td>Wrapper function for program cancellation (F3/F12 handler)</td></tr>
<tr><td><strong>ZYEXPG</strong></td><td>4298</td><td>Direct program exit with resource cleanup and lock release</td></tr>
<tr><td><strong>ZZINIT</strong></td><td>4311</td><td>Comprehensive program initialization clearing all parameters and setting defaults</td></tr>
</tbody></table>

<div style="text-align:center;margin:40px 0;padding:20px;background:#e7f3ff;border-radius:8px;">
<p><strong>Documentation Status:</strong> All 39 functions analyzed for business users</p>
<p>This documentation focuses on business value and process understanding</p>
</div>

</body></html>
