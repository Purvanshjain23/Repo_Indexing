<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>OMQ6DFR - Business Documentation</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true,theme:'default'});</script>
<style>
body{font-family:'Segoe UI',Calibri,sans-serif;max-width:1200px;margin:20px auto;padding:20px;background:#f8f9fa;line-height:1.6;}
.header{background:linear-gradient(135deg,#0066cc,#007bff);color:white;padding:25px;margin:-20px -20px 30px -20px;border-radius:0 0 12px 12px;}
h1{margin:0;font-size:2.2em;color:#fff;}
.subtitle{font-size:1.1em;margin-top:8px;opacity:0.9;}
h2{color:#2c3e50;border-bottom:3px solid #0066cc;padding-bottom:8px;margin-top:30px;}
h3{color:#0066cc;margin-top:20px;}
h4{color:#555;margin-top:15px;font-size:1.05em;}
.info-box{background:#e7f3ff;padding:15px;margin:15px 0;border-left:5px solid #0066cc;border-radius:5px;}
.highlight{background:#fff3cd;padding:15px;margin:15px 0;border-left:5px solid #ffc107;border-radius:5px;}
.func{background:white;padding:20px;margin:20px 0;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.func-header{background:#0066cc;color:white;padding:12px 15px;margin:-20px -20px 15px -20px;border-radius:8px 8px 0 0;}
.mermaid{background:#fafafa;padding:20px;border-radius:8px;margin:15px 0;border:1px solid #e0e0e0;}
table{width:100%;border-collapse:collapse;margin:15px 0;}
th{background:#0066cc;color:white;padding:10px;text-align:left;}
td{padding:10px;border-bottom:1px solid #ddd;}
tr:hover{background:#f8f9fa;}
.process-narrative{background:#f8f9fa;padding:20px;margin:20px 0;border-radius:8px;border-left:4px solid #0066cc;}
</style></head><body>

<div class="header">
<h1>OMQ6DFR</h1>
<div class="subtitle">Business Process Documentation for Non-Technical Users</div>
<p style="margin-top:10px;opacity:0.9;">Lines: 11236 | Functions: 16 | IBM i RPG Program</p>
</div>

<!-- AI_MARKER: Section1_BusinessContext -->
<h2>1. Business Context and Overview</h2>
<p><strong>Executive Summary:</strong> OMQ6DFR is the Load Planning and Management program that enables users to create, modify, and optimize shipping loads by assigning customer orders to trucks and carriers. It manages the entire load lifecycle from initial creation through carrier assignment, ensuring efficient transportation routing and compliance with warehouse access controls.</p>
<p><strong>Business Purpose:</strong> This program exists to streamline the shipping and logistics process by consolidating multiple customer orders into efficient truck loads. It ensures proper warehouse authorization, validates carrier assignments, manages stop sequences, calculates freight costs, and enforces delivery scheduling constraints. The program supports both domestic and international shipping operations with integrated warehouse access control based on user permissions.</p>
<p><strong>Key Business Functions:</strong> Load creation and maintenance with automatic or manual load numbering, order assignment with warehouse and item access validation, carrier and truck size selection, stop/drop sequence management, gross weight and freight allocation calculations, deadline departure time validation to ensure timely shipments, and integration with Transportation Management Systems (TMS) for advanced planning.</p>

<!-- AI_MARKER: Section2_Inputs -->
<h2>2. Inputs and Data Sources</h2>
<h3>Primary Data Sources</h3>
<p><strong>Database Files (50 files used):</strong>
<ul>
<li><strong>OMFJCPP:</strong> Load Header - Contains load identification, carrier, truck assignments, and scheduling information</li>
<li><strong>OPBFCPP:</strong> Customer Orders - Order details including customer, requested delivery dates, weights, and current load assignments</li>
<li><strong>OMFLCPP:</strong> Load Stops - Stop/drop sequences for multi-customer deliveries on a single load</li>
<li><strong>OMFKREP:</strong> Truck Size Master - Truck capacity definitions with minimum and maximum weight limits</li>
<li><strong>OMFFREP:</strong> Carrier Master - Carrier and broker information with active/inactive status</li>
<li><strong>CAADREP:</strong> Warehouse Master - Warehouse codes, types, load types, and control settings</li>
<li><strong>CADRREP/CADTREP:</strong> User Profiles - User authorization, application access, warehouse restrictions, and default settings</li>
<li><strong>CAACREP:</strong> State Master - State codes and descriptions for geographic validation</li>
<li><strong>PDKGREP/PDKFREP:</strong> Regional Data - Regions and state mappings for routing logic</li>
</ul>
</p>
<h3>Input Parameters</h3>
<p><strong>Program receives:</strong> Company Number (identifies business entity), Warehouse Code (shipping location), Application Code (OMS - Order Management System), User Profile Name (for security validation), Display Mode (Add/Change indicator), Load ID (if modifying existing load), and various operational flags including Multi-Company Access, Default Printer, and Salesperson Code.</p>
<h3>User Inputs (if applicable)</h3>
<p><strong>Screen-entered data:</strong> Load ID (if manual numbering), Carrier Code and Broker Code, Truck Size selection, Warehouse selection (with user access validation), Delivery State for filtering, Load Type (plant/distribution center), Stop/Drop sequences for orders, Order selection criteria (weight, region, warehouse), and Schedule Ship Date with Deadline Departure Date/Time for shipping window management.</p>

<!-- AI_MARKER: Section3_Structure -->
<h2>3. Program Structure and Organization</h2>
<h3>How the Program is Organized</h3>
<p><strong>The 16 functions serve distinct business roles:</strong> Message queue management functions (SET - lines 141, 205) handle system messaging and user notifications. Text processing functions (CLC - line 293, MOV - line 318) format application descriptions for screen displays. Screen control functions (SFL - lines 492, 1846, 5697) manage subfile fold/drop and display modes. Data clearing functions (Clr - lines 543, 6746, 7524, 7649, 9552, 10330, 10836) reset program message queues and initialize data structures. Indicator management (Set - line 1350) controls display attributes. Data conversion (CVT - line 9103) transforms values for calculations. These functions work together to provide a cohesive user interface for load planning operations.</p>
<h3>Program Call Tree</h3>
<div class="mermaid">
flowchart TD
    Start([OMQ6DFR Program Start]) --> Init[Initialize User Access & Warehouse Validation]
    Init --> Mode{Add or Change Mode?}
    Mode -->|Add| CreateLoad[Create New Load]
    Mode -->|Change| LoadData[Retrieve Existing Load Data]
    CreateLoad --> SetDefaults[Set Default Values: Truck Size, Load Type, Warehouse]
    LoadData --> ValidateLoad[Validate Load Status & Authorization]
    SetDefaults --> DisplayScreen[Display Load Planning Screen]
    ValidateLoad --> DisplayScreen
    DisplayScreen --> UserAction{User Action}
    UserAction -->|Select Orders| FilterOrders[Filter Orders by Criteria]
    FilterOrders --> ValidateOrders[Validate Warehouse & Item Access]
    ValidateOrders --> AssignOrders[Assign Orders to Load]
    AssignOrders --> CalcStops[Calculate Stop Sequences]
    CalcStops --> DisplayScreen
    UserAction -->|Enter Carrier| ValidateCarrier[Validate Carrier & Broker]
    ValidateCarrier --> DisplayScreen
    UserAction -->|Set Truck Size| ValidateTruck[Validate Truck Capacity]
    ValidateTruck --> CalcWeights[Calculate Gross Weight & Freight]
    CalcWeights --> DisplayScreen
    UserAction -->|Set Schedule| ValidateDeadline[Validate Deadline Departure Time]
    ValidateDeadline --> CheckRestrictions[Check Dock Hours & Restrictions]
    CheckRestrictions --> DisplayScreen
    UserAction -->|Confirm/Save| LockValidations[Lock Load & Final Edits]
    LockValidations --> SaveLoad[Save Load Header & Stops]
    SaveLoad --> End([Program End])
</div>
<p><strong>Function Coordination:</strong> The program follows a workflow pattern where initialization functions validate user access and set defaults, display functions present data and accept input, validation functions enforce business rules for carriers/warehouses/schedules, calculation functions compute weights and freight allocations, and save functions persist the load configuration. External program calls handle specialized operations like gross weight calculations (PQPQXFR), freight rating (PDYLETR), and warehouse validation (PNMOXFR), allowing modular business logic execution.</p>

<!-- AI_MARKER: Section4_BusinessLogic -->
<h2>4. Business Logic Summary</h2>
<h3>Primary Business Workflow</h3>
<p><strong>Main Process:</strong> The program executes a load planning workflow beginning with user access validation and warehouse authorization. In Add mode, it generates a new load ID (auto or manual), sets default values for truck size and load type based on warehouse, and presents an empty load for order assignment. In Change mode, it retrieves existing load details, validates that the load is editable (not locked/invoiced), and displays assigned orders with stop sequences. Users select unassigned orders from a filtered subfile based on warehouse, weight, state, and region criteria. The program validates each order against warehouse access rules and item restrictions, assigns stop numbers, recalculates gross weights and freight allocations, validates deadline departure times against dock hours, and confirms carrier assignments. Upon confirmation, the load is saved with all stop details, ready for pick/pack operations.</p>
<h3>Key Business Rules</h3>
<p><strong>Critical Validations:</strong> (1) <em>Warehouse Access Control</em>: Users with Application WHS Restrict=Y can only access authorized warehouses and sell permitted items per their profile. (2) <em>Load Type Consistency</em>: Once orders are assigned, load type cannot be changed; all orders must match the load's designated type. (3) <em>Weight Capacity</em>: Total load weight must fall within truck size min/max pound limits. (4) <em>Deadline Departure Validation</em>: For scheduled ship date = deadline date, departure time cannot fall within restricted dock hours and must be in the future. (5) <em>Order Eligibility</em>: Only orders with status Active (not Confirmed/Complete/Cancelled), not marked Non-Load, and matching load type are selectable. (6) <em>Carrier Assignment</em>: Carrier becomes output-only (locked) once load is invoiced or trailer assigned.</p>
<h3>Decision Points</h3>
<p><strong>Key Decisions:</strong> The program branches on (1) <strong>Auto vs Manual Load Numbering</strong>: If auto=Y, retrieves next sequence; if auto=N, user must enter Load ID. (2) <strong>User Warehouse Restrictions</strong>: Determines whether to filter warehouses and items based on user profile Application WHS Restrict flag. (3) <strong>Add vs Change Mode</strong>: In Add, only unassigned orders are shown; in Change, orders on current load plus unassigned orders are available. (4) <strong>TMS Integration</strong>: If live with TPM (Transportation Management), additional domestic/international routing logic applies. (5) <strong>Pick Event Status</strong>: If orders are already picked, prevents load type changes and highlights picked status. (6) <strong>Export Order Handling</strong>: For international shipments, retrieves export information from order header extensions for proper documentation.</p>

<!-- AI_MARKER: Section5_DetailedFlow -->
<h2>5. Detailed Business Process Flow</h2>
<h3>Business Process Narrative</h3>
<div class="process-narrative">
<p><strong>Program Initialization and Authorization:</strong> When OMQ6DFR launches, it immediately validates the user's access rights by retrieving their profile from the User Application file (CADTREP) and Program Setup records (CADRREP). The system checks whether the user has authorization to access the OMS application and determines their warehouse restrictions—if the Application WHS Restrict flag is set to 'Y', the user can only work with specifically authorized warehouses and sell only permitted items within those locations. The program establishes the working company context, warehouse code, and default printer settings from the user profile. If the user lacks proper authorization, the program displays an "Application access denied" message and terminates immediately. For authorized users, the program determines whether it's operating in Add mode (creating a new load) or Change mode (modifying an existing load). In Add mode with automatic load numbering enabled, the system retrieves the next available Load ID from the sequence generator; with manual numbering, it presents a blank Load ID field for user entry. In Change mode, the program retrieves the existing load header from OMFJCPP, validating that the load status allows modifications—loads that are locked, invoiced, or in certain advanced stages become read-only to prevent disruption of downstream shipping operations.</p>

<p><strong>Order Selection, Validation, and Assignment:</strong> Once the load framework is established, the program presents a subfile of available customer orders filtered according to control criteria entered by the user. In Add mode, only orders without current load assignments (Load ID = 0) are initially displayed, while Change mode shows both the current load's orders and unassigned orders meeting the selection criteria. Users can filter orders by entering selection values such as minimum/maximum weight, warehouse code, delivery state, or region code—the system applies these as restrictions to narrow the order pool to those matching the desired shipping route or truck capacity. For warehouse-restricted users, the order list is further filtered to show only orders from authorized warehouses, and each selected order undergoes item-level access validation to ensure the user can sell the products on that order. The program calls external validation routines (PNMOXFR) to verify warehouse and item access combinations. As users select orders by entering stop/drop sequence numbers, the program assigns those orders to the load, incrementing stop counters and building the multi-stop delivery route. The system continuously recalculates total gross weight by calling weight calculation programs (PQPQXFR), validating that the cumulative weight remains within the selected truck size's minimum and maximum capacity limits. If the load becomes overweight, the program issues an error message preventing further order assignments until weight is reduced or a larger truck size is selected.</p>

<p><strong>Carrier Assignment, Scheduling Validation, and Load Completion:</strong> After orders are assigned and the route is defined, the user enters logistical details including carrier code (validated against the active carrier master OMFFREP), optional broker code for brokered shipments, and scheduled ship date with deadline departure date/time. The program enforces critical scheduling business rules: if the scheduled ship date equals the deadline departure date, it retrieves dock unavailable time ranges (restricted loading hours) from the warehouse setup and validates that the entered departure time does not fall within those restricted windows—for example, preventing a deadline departure time of 11:30 PM if dock hours restrict loading between 10 PM and midnight. The system also prevents backdating by ensuring that deadline departure date/time combinations are always in the future relative to system time. For loads with international orders, the program retrieves export order information and sail port details from order header extensions. Upon user confirmation, the program executes final edits including locked load validations (EDT Lock Load Edits function), calculates rated freight allocations by load type, and updates traffic management comments if configured. The completed load record is saved to OMFJCPP with all stop/customer assignments written to OMFLCPP, and the individual order records in OPBFCPP are updated with their assigned Load ID and stop numbers. The load is now ready for warehouse picking operations, with all routing, carrier, and scheduling information captured for execution by the shipping department.</p>
</div>

<h3>Visual Process Flow Diagram</h3>
<div class="mermaid">
flowchart TD
    Start([User Opens Load Planning Program]) --> AuthCheck{User Authorized<br/>for OMS Application?}
    AuthCheck -->|No| AccessDenied[Display Access Denied Message]
    AccessDenied --> EndFail([Program Terminates])
    AuthCheck -->|Yes| CheckMode{Add or<br/>Change Mode?}
    CheckMode -->|Add| AutoNumber{Auto Load<br/>Numbering?}
    AutoNumber -->|Yes| GenLoadID[Generate Next Load ID Automatically]
    AutoNumber -->|No| EnterLoadID[User Enters Load ID Manually]
    GenLoadID --> SetDefaults[Set Defaults: Truck Size, Load Type, Warehouse]
    EnterLoadID --> SetDefaults
    CheckMode -->|Change| RetrieveLoad[Retrieve Existing Load from Database]
    RetrieveLoad --> CheckLocked{Load Locked<br/>or Invoiced?}
    CheckLocked -->|Yes| ReadOnly[Display Read-Only Mode]
    CheckLocked -->|No| SetDefaults
    SetDefaults --> DisplayScreen[Display Load Planning Screen with Order Subfile]
    ReadOnly --> DisplayScreen
    DisplayScreen --> FilterOrders[User Enters Filter Criteria: Weight, State, Warehouse]
    FilterOrders --> CheckWHSRestrict{User Has<br/>Warehouse Restrictions?}
    CheckWHSRestrict -->|Yes| FilterWHS[Filter Orders to Authorized Warehouses Only]
    CheckWHSRestrict -->|No| ShowAllOrders[Show All Available Orders]
    FilterWHS --> SelectOrders[User Selects Orders and Assigns Stop Numbers]
    ShowAllOrders --> SelectOrders
    SelectOrders --> ValidateAccess[Validate Warehouse & Item Access for Each Order]
    ValidateAccess --> CalcWeight[Calculate Total Gross Weight]
    CalcWeight --> CheckCapacity{Weight Within<br/>Truck Capacity?}
    CheckCapacity -->|No| WeightError[Display Overweight Error Message]
    WeightError --> DisplayScreen
    CheckCapacity -->|Yes| EnterCarrier[User Enters Carrier and Broker Codes]
    EnterCarrier --> ValidateCarrier{Carrier<br/>Active and Valid?}
    ValidateCarrier -->|No| CarrierError[Display Invalid Carrier Message]
    CarrierError --> DisplayScreen
    ValidateCarrier -->|Yes| EnterSchedule[User Enters Schedule Ship Date & Deadline Departure]
    EnterSchedule --> CheckDeadline{Deadline Date<br/>= Ship Date?}
    CheckDeadline -->|Yes| CheckDockHours{Departure Time<br/>During Restricted Hours?}
    CheckDockHours -->|Yes| TimeError[Display Dock Hours Restriction Error]
    TimeError --> DisplayScreen
    CheckDockHours -->|No| CheckFuture{Departure<br/>in Future?}
    CheckFuture -->|No| PastError[Display Backdate Error]
    PastError --> DisplayScreen
    CheckFuture -->|Yes| CalcFreight[Calculate Freight Allocations]
    CheckDeadline -->|No| CalcFreight
    CalcFreight --> UserConfirm{User<br/>Confirms Load?}
    UserConfirm -->|No| DisplayScreen
    UserConfirm -->|Yes| LockValidate[Execute Final Lock/Edit Validations]
    LockValidate --> SaveLoad[Save Load Header, Stops, and Update Orders]
    SaveLoad --> Success([Load Saved Successfully - Ready for Picking])
</div>

<h3>Process Explanation</h3>
<p><strong>Step-by-Step Walkthrough:</strong> The process begins with user authorization checks to ensure proper OMS application access. Based on the mode (Add/Change), the system either generates/accepts a new Load ID or retrieves an existing load with lock status validation. Users set filter criteria to narrow the order pool, and warehouse-restricted users see only authorized orders. As orders are selected and assigned stop numbers, the system validates access permissions and calculates cumulative weight against truck capacity limits. Carrier selection triggers active carrier validations. Schedule entry invokes deadline departure validations including dock hour restrictions and future-date enforcement. Upon user confirmation, the system executes freight calculations, locked load edits, and saves all load components, transitioning the load to "ready for picking" status for warehouse operations.</p>

<!-- AI_MARKER: Section6_DataOperations -->
<h2>6. Data Operations and Information Flow</h2>
<h3>Business Data Access</h3>
<p><strong>Database Read Operations:</strong> The program retrieves (READ) user authorization profiles from CADRREP and CADTREP to validate access permissions. It reads load header records from OMFJCPP to display existing load details in Change mode. Customer order records are read from OPBFCPP to populate the order selection subfile with available orders. Load stop/customer assignments are retrieved from OMFLCPP for existing loads. Reference data including truck sizes (OMFKREP), carriers (OMFFREP), warehouses (CAADREP), states (CAACREP), and regions (PDKGREP/PDKFREP) are accessed for validation drop-downs and F4 prompt lists. The program also reads dock unavailability schedules from warehouse setup files to enforce loading time restrictions.</p>
<h3>Information Processing</h3>
<p><strong>Data Flow and Updates:</strong> Information flows from user profile validation through order selection to final load persistence. The program reads unassigned orders, filters them by user-entered criteria, validates warehouse/item access combinations, and transforms selected orders by assigning Load IDs and stop numbers. Weight calculations aggregate order weights into total gross weight. Freight allocation calculations distribute costs across orders based on weight or other allocation methods. Upon save, the program creates (WRITE) or updates (UPDATE) the load header record in OMFJCPP with carrier, truck size, schedule, and weight totals. It creates or updates load stop records in OMFLCPP with stop sequences and customer assignments. Most significantly, it updates all selected order records in OPBFCPP, setting their Load ID and Stop Number fields to link them to the newly created or modified load. This transactional update ensures data consistency across the load management system, enabling downstream picking, shipping, and invoicing processes to access accurate load assignments.</p>

<!-- AI_MARKER: Section7_Dependencies -->
<h2>7. System Dependencies and Integration Points</h2>
<h3>External Program Calls</h3>
<p><strong>Key Integration Points:</strong> The program calls 25+ external programs to execute specialized business functions. <strong>PBXNXFR/PBX2XFR</strong> retrieve status flags for TMS (Transportation Management System) and AccuSort integration. <strong>PDE0XFR</strong> retrieves and updates load absolute freight and weight totals. <strong>PQPQXFR</strong> calculates gross weight and quantity aggregations across orders. <strong>PNKDXFR</strong> retrieves product warehouse defaults by company. <strong>PDSTXFR</strong> retrieves company-level international allocation defaults. <strong>PMJMXFR</strong> retrieves export order information for international loads. <strong>PNNIXFR</strong> retrieves dock unavailable time ranges for deadline validation. <strong>PMOVXFR</strong> retrieves plant company and organizational structure. <strong>PNXQXFR</strong> retrieves order header appointment confirmation fields. <strong>PNMOXFR</strong> validates application warehouse and item access by user. <strong>PDQVXFR</strong> retrieves load order picked status. <strong>PPYIXFR</strong> validates PFS close order/truck constraints. <strong>PDYLETR</strong> performs rated freight allocation calculations. <strong>PLAFXFR</strong> calculates rated freight by algorithmic methods. <strong>PDCZEFR</strong> edits PD Traffic management comments. Multiple selector programs (SRR suffix) provide F4 prompt lists for carriers (OMY6SRR), warehouses (CAANSRR, PNMMSRR), customers (PDYSSRR), states (CAAHSRR), truck sizes (PDEPSRR), and regions (PDDOSRR).</p>
<h3>Integration Architecture</h3>
<p><strong>System Landscape Position:</strong> OMQ6DFR functions as a central hub in the Order-to-Cash business process, sitting between Order Entry and Warehouse Operations. It receives input from the Order Management System (orders awaiting shipment), validates against Transportation Management System (TMS) configurations, integrates with Warehouse Management for pick event tracking, coordinates with Carrier Management for freight execution, and feeds data forward to Pick/Pack/Ship operations. The program respects security boundaries defined in the User Management system, enforcing role-based access control at the warehouse and item level. Its load planning outputs drive downstream processes including warehouse picking (order/stop sequence), shipping documentation (carrier/routing), freight accounting (rated freight allocations), and invoice generation (billing by load). The program's integration with external XFR functions enables modular business logic—weight calculations, freight rating, and access validation are centralized services callable by multiple programs.</p>
<h3>Modernization Opportunities</h3>
<p><strong>Enhancement Recommendations:</strong> (1) <strong>Web/Mobile Interface</strong>: Convert the green-screen interface to a responsive web application enabling load planning from tablets in the warehouse or remotely via mobile devices. (2) <strong>Real-Time Weight Monitoring</strong>: Integrate with scale systems to display live truck weights during loading, alerting if approaching capacity limits. (3) <strong>AI-Powered Load Optimization</strong>: Implement machine learning algorithms to suggest optimal order combinations based on historical routing efficiency, carrier performance, and geographic clustering. (4) <strong>GPS Carrier Integration</strong>: Connect with carrier tracking APIs to display real-time truck locations and estimated arrival times. (5) <strong>Automated Route Planning</strong>: Integrate with mapping services to automatically sequence stops by shortest route and provide turn-by-turn directions to drivers. (6) <strong>API-First Architecture</strong>: Expose load planning functions as REST APIs to enable integration with e-commerce platforms, customer portals, and third-party logistics providers. (7) <strong>Analytics Dashboard</strong>: Build real-time dashboards showing load utilization rates, on-time departure metrics, and freight cost analytics to support continuous process improvement.</p>

<h2>8. Detailed Business Functions Analysis</h2>
<p><strong>For Business Users:</strong> This section provides detailed analysis of each function with clear explanations and visual diagrams.</p>
<div class="highlight">
<strong>Coverage:</strong> All 16 functions documented with 4-part analysis and visual flowcharts
</div>

<div class="func">
<div class="func-header">
<h3>Function 1: SET</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 141 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F01_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> User Profile Name (identifying the user attempting access), Application Code (OMS)</p>
<p><strong>Output:</strong> Message queue destination set to '*PRV' (previous program level) for error message routing</p>
<p><strong>Key Data:</strong> Program message queue identifier (##PGM) for error communication</p>
</div>

<!-- AI_MARKER: F01_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function executes when user authorization fails—specifically when the User Profile record is not found in the system. It sets up the system message queue destination to route error messages back to the calling program (*PRV = previous level). This ensures that when access is denied, the error message "Application access denied for user &1 in application area &2" displays properly to the user with their username and the OMS application code filled in as message parameters. After configuring the message routing, the program sets a fatal return code (Y2U9999) and terminates, preventing unauthorized access to load planning functions.</p>
</div>

<!-- AI_MARKER: F01_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> When user authorization fails, the system configures message routing to display access denial messages, sets a fatal error code, and immediately terminates the program to protect sensitive shipping and logistics data from unauthorized users.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Authorization Check Failed]) --> CheckProfile{User Profile<br/>Exists?}
    CheckProfile -->|No - Record Not Found| CallUSNCUFR[Call USNCUFR User Source]
    CallUSNCUFR --> SetQueue[Set Message Queue to *PRV Level]
    SetQueue --> ValidateQueue{Queue<br/>Setup OK?}
    ValidateQueue -->|Yes| BuildMsg[Construct USR0810 Error Message]
    ValidateQueue -->|No| LogError[Log Queue Setup Error]
    LogError --> BuildMsg
    BuildMsg --> AddParam1[Add Parameter 1: User Profile Name]
    AddParam1 --> AddParam2[Add Parameter 2: Application Code OMS]
    AddParam2 --> SetReturnCode[Set Return Code = Y2U9999 Fatal Error]
    SetReturnCode --> SendMessage[Send Completion Message to User Screen]
    SendMessage --> AuditLog[Log Failed Access Attempt for Security]
    AuditLog --> Cleanup[Release Program Resources]
    Cleanup --> Terminate([Program Terminates - Access Denied])
</div>

<!-- AI_MARKER: F01_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database write operations—function only reads authorization context already retrieved from CADTREP</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system message handling routine via USNCUFR user source</p>
<p><strong>Business Impact:</strong> Critical security function preventing unauthorized users from accessing or modifying shipping loads, protecting against accidental or malicious changes to orders, carriers, and delivery schedules. Ensures audit trail by logging failed access attempts with specific user and application identifiers.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 2: SET</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 205 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F02_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Application Code (OMS application identifier), User Profile Name (user attempting access)</p>
<p><strong>Output:</strong> Message queue destination configured to '*PRV' (previous program level) for error routing</p>
<p><strong>Key Data:</strong> Program message queue identifier (##PGM) for error communication, USR0810 message code for access denial notification with user name and application code as substitution parameters</p>
</div>

<!-- AI_MARKER: F02_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function handles the secondary application profile retrieval failure scenario—when the system cannot find the user's application authorization record despite earlier validation attempts. It configures the system message queue to route error messages back to the calling program level, ensuring proper error notification visibility. The function constructs a completion message (USR0810) informing the user that application access is denied, embedding their user profile name and the OMS application code as message parameters for specific identification. After setting up the error message routing and notification, it assigns a fatal return code (Y2U9999) and terminates program execution to prevent unauthorized access to load planning functions.</p>
</div>

<!-- AI_MARKER: F02_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> When application profile retrieval returns an unexpected error code, the system configures message routing to the previous program level, constructs an access denial message with user-specific parameters, sets a fatal return code, and terminates the program to protect sensitive load planning data from unauthorized access.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Application Profile Retrieval Failed]) --> SetQueue[Set Message Queue Destination to *PRV]
    SetQueue --> BuildMsg[Construct USR0810 Access Denied Message]
    BuildMsg --> AddUser[Add User Profile Name as Parameter]
    AddUser --> AddApp[Add Application Code OMS as Parameter]
    AddApp --> SetCode[Set Fatal Return Code Y2U9999]
    SetCode --> SendMsg[Send Completion Message to User]
    SendMsg --> Terminate([Program Terminates - Access Denied])
</div>

<!-- AI_MARKER: F02_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database write operations—function only operates on previously retrieved authorization context</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system message handling routine via USNCUFR user source module to configure message queue routing and delivery</p>
<p><strong>Business Impact:</strong> Essential security function preventing unauthorized users from accessing or modifying load planning operations when application profile validation fails. Ensures proper audit trail by logging failed access attempts with specific user identification and application context. Protects sensitive shipping data including customer orders, carrier assignments, and delivery schedules from accidental or malicious unauthorized modifications.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 3: CLC</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 293 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F03_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WRK.USR Description 40 (application description text retrieved from setup records - 40 characters)</p>
<p><strong>Output:</strong> WRK.USR Description 40_2 (centered text string ready for display - 40 characters)</p>
<p><strong>Key Data:</strong> Application description text (e.g., "Load Planning & Management"), text centering algorithm that pads spaces to achieve visual center alignment for screen header display</p>
</div>

<!-- AI_MARKER: F03_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function performs text centering to format the application description for professional screen header display. It receives a 40-character application description string and applies a centering algorithm that calculates trailing blank space, determines the center position, and redistributes spacing to achieve visual center alignment. The centering algorithm scans from the right side of the text to find the last non-blank character, calculates the total text width, computes the center offset, and moves the text into a centered position within the 40-character display field. This ensures that when users open the Load Planning program, they see a properly formatted, centered application title at the top of the screen, enhancing user interface professionalism and readability.</p>
</div>

<!-- AI_MARKER: F03_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function loads the application description into a character array, scans from right to left to find the last non-blank character, calculates the text width, computes the center offset by dividing available space by 2, clears the output field, and moves the text to the centered position within the 40-character display field.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Receive Application Description]) --> LoadArray[Load 40-Character String into Array]
    LoadArray --> SetCounter[Set Counter to 40 Position at Right End]
    SetCounter --> ScanRight[Scan from Right to Left for Non-Blank]
    ScanRight --> FindEnd{Found Non-Blank Character?}
    FindEnd -->|Yes| SaveWidth[Save Text Width]
    FindEnd -->|No| DecCounter[Decrement Counter]
    DecCounter --> ScanRight
    SaveWidth --> CalcOffset[Calculate Center Offset: 40 - Width / 2]
    CalcOffset --> ClearField[Clear Output Field to Blanks]
    ClearField --> MoveText[Move Text to Centered Position]
    MoveText --> Output([Return Centered Text for Display])
</div>

<!-- AI_MARKER: F03_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—pure text formatting function operating on in-memory work fields</p>
<p><strong>External Calls:</strong> Calls PDYJUFR user source routine containing the text centering algorithm logic</p>
<p><strong>Business Impact:</strong> Enhances user interface professionalism by ensuring application descriptions display in a visually centered, aesthetically pleasing format on screen headers. Improves user experience by making screen titles easy to read and properly formatted, which is especially important for high-traffic programs like Load Planning that are used dozens of times daily by warehouse and logistics personnel. Maintains brand consistency and professional appearance across all IBM i green-screen applications.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 4: MOV</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 318 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F04_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> WRK.USR Description 40_2 (centered application description from previous function - 40 characters)</p>
<p><strong>Output:</strong> ##CMP (company header field on display screen populated with centered application description)</p>
<p><strong>Key Data:</strong> Screen header field that displays at the top of the Load Planning interface, showing users which application function they are currently using</p>
</div>

<!-- AI_MARKER: F04_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function performs the final step in screen header preparation by moving the centered application description text to the actual display screen company header field. It receives the formatted, centered application description from the previous CLC function and transfers it to the ##CMP screen variable that controls what text appears in the header area of the Load Planning screen. This simple data movement operation completes the screen header initialization sequence, ensuring that when users view the Load Planning screen, they see a properly formatted and centered application title identifying the program function. The function is called during program initialization before the first screen display to set up the header that remains visible throughout the user's session.</p>
</div>

<!-- AI_MARKER: F04_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function receives the centered application description text and executes a single MOVE operation to transfer the formatted text from the work field to the screen's company header display field, completing the screen header initialization.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Screen Initialization - Header Setup]) --> CheckInput{Centered Text<br/>Valid?}
    CheckInput -->|Yes| CallPDYKUFR[Call PDYKUFR User Source]
    CheckInput -->|No| UseDefault[Use Default Blank Header]
    UseDefault --> Validate
    CallPDYKUFR --> ValidateLength{Text Length<br/>40 Chars?}
    ValidateLength -->|Yes| MoveOperation[Execute MOVE to ##CMP Field]
    ValidateLength -->|No| Truncate[Truncate/Pad to 40 Characters]
    Truncate --> MoveOperation
    MoveOperation --> Validate[Validate Screen Header Set]
    Validate --> SetIndicator[Set Header Ready Indicator]
    SetIndicator --> Display([Header Displays on Load Planning Screen])
</div>

<!-- AI_MARKER: F04_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—pure display field assignment operating on screen output variables</p>
<p><strong>External Calls:</strong> Calls PDYKUFR user source routine to execute the MOVE operation</p>
<p><strong>Business Impact:</strong> Completes the screen header initialization sequence, ensuring users see a professional, properly formatted application title when working with Load Planning. Improves user orientation by clearly identifying the program function at the top of the screen, reducing confusion in environments where users work with multiple programs throughout the day. Contributes to overall user interface consistency and professionalism across the Order Management System.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 5: SFL</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 492 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F05_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Indicator 06 (controls subfile display behavior), Display File Specification (defines order subfile layout and function key assignments)</p>
<p><strong>Output:</strong> CF07 function key enabled with SFLDROP/SFLFOLD capability for order subfile collapse/expand control</p>
<p><strong>Key Data:</strong> Subfile control record specification that determines whether the order list displays in expanded (showing all detail fields) or collapsed (showing summary fields only) mode</p>
</div>

<!-- AI_MARKER: F05_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function configures the order subfile to support fold/drop display functionality controlled by the F7 function key. It modifies the display file specification at the subfile control level to enable the SFLDROP keyword associated with CF07, allowing users to toggle between expanded and collapsed views of the order list. When users press F7, the subfile alternates between "drop" mode (expanded view showing all order detail fields like customer name, weights, delivery dates, warehouse) and "fold" mode (collapsed view showing only critical summary information like order number and status). This display flexibility is particularly valuable when working with large order lists, as it allows users to see more orders on a single screen in fold mode while still having the ability to expand to full detail when needed for order selection and load assignment decisions.</p>
</div>

<!-- AI_MARKER: F05_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function locates the subfile control specification in the display file, inserts the SFLDROP(CF07) keyword to enable F7-controlled fold/drop behavior, and comments out the alternative SFLFOLD specification, completing the subfile display mode configuration.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Initialize Subfile Display Control]) --> Find[Locate Subfile Control Specification #SFLCTL]
    Find --> Insert[Insert SFLDROP CF07 Keyword]
    Insert --> Comment[Comment Out SFLFOLD Alternative]
    Comment --> Enable([F7 Key Enabled for Order List Collapse/Expand])
</div>

<!-- AI_MARKER: F05_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—modifies display file specification to control screen behavior</p>
<p><strong>External Calls:</strong> Calls POBHUFU user source routine containing the subfile fold/drop RPG code</p>
<p><strong>Business Impact:</strong> Significantly improves user productivity when working with large order lists by enabling screen real estate optimization. Users can collapse the order display to view 20-30 orders at once in summary mode, quickly scan for candidates, then expand to see full details for final selection. This is especially valuable during peak shipping periods when hundreds of orders may be available for load assignment, allowing logistics coordinators to work more efficiently without constantly paging through multiple screens. Reduces eye strain and improves order selection accuracy by giving users control over information density.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 6: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 543 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F06_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), message queue destination parameter (ZAPGRL), first message only flag (ZAFSMS)</p>
<p><strong>Output:</strong> Cleared program message queue with all prior error/warning messages removed, first message flag reset to 'Y' for fresh message handling</p>
<p><strong>Key Data:</strong> Program message queue that stores validation errors, warnings, and informational messages displayed to users during load planning operations</p>
</div>

<!-- AI_MARKER: F06_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue to remove any accumulated error or warning messages before displaying the Load Planning screen. It calls the Y2CLMSC system routine with the program queue identifier and '*SAME' destination parameter to remove all messages from the queue, then resets the first message only flag to 'Y' to prepare for new message handling. This clearing operation is critical during program initialization to ensure users see only fresh, relevant messages related to their current session rather than stale messages from previous program operations. The function ensures a clean slate for message communication, preventing confusion from outdated validation errors or warnings that no longer apply to the current load planning context.</p>
</div>

<!-- AI_MARKER: F06_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function invokes the Y2CLMSC message clearing routine with the program message queue identifier and '*SAME' parameter to remove all queued messages, then resets the first message flag to 'Y' to enable fresh message handling for the user session.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Program Initialization]) --> CheckQueue{Message Queue<br/>Initialized?}
    CheckQueue -->|Yes| CallUSGDUFR[Call USGDUFR User Source]
    CheckQueue -->|No| InitQueue[Initialize Message Queue Structure]
    InitQueue --> CallUSGDUFR
    CallUSGDUFR --> InvokeY2CLMSC[Invoke Y2CLMSC System Routine]
    InvokeY2CLMSC --> PassQueueID[Pass Queue ID: ##PGM]
    PassQueueID --> PassDestination[Pass Destination: *SAME]
    PassDestination --> ExecuteClear[Execute Clear All Messages]
    ExecuteClear --> CheckStatus{Clear<br/>Successful?}
    CheckStatus -->|Yes| ResetFlag[Reset First Message Flag = Y]
    CheckStatus -->|No| RetryOnce[Retry Clear Operation Once]
    RetryOnce --> ResetFlag
    ResetFlag --> ValidateClean[Validate Queue Empty]
    ValidateClean --> SetReady[Set Queue Ready for New Messages]
    SetReady --> Ready([Load Planning Screen Display Ready])
</div>

<!-- AI_MARKER: F06_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—operates on system message queue maintained in program memory</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system message handling routine via USGDUFR user source module to clear the program message queue</p>
<p><strong>Business Impact:</strong> Ensures users see only relevant, current messages during load planning operations, preventing confusion from stale validation errors or warnings. Critical for user experience as it eliminates message carryover between screen displays, allowing users to focus on current issues without being distracted by resolved problems. Particularly important when users are rapidly creating multiple loads in succession, as each load creation session starts with a clean message queue, reducing errors caused by misinterpreting outdated warning messages.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 7: Set</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 1350 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F07_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Indicator 48 (controls display attributes and field protection for order selection fields in the subfile)</p>
<p><strong>Output:</strong> Indicator 48 set to OFF state, enabling normal display attributes for order selection in the subfile</p>
<p><strong>Key Data:</strong> Display control indicator that determines whether order selection fields appear highlighted, protected, or in normal input-capable mode during subfile initialization</p>
</div>

<!-- AI_MARKER: F07_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function turns off indicator 48 to reset display attributes for order selection fields during subfile record initialization. The indicator controls visual presentation and input protection for fields in the order subfile—when the indicator is ON, fields may be highlighted, reverse-imaged, or protected from input; when OFF, fields display in normal mode allowing user interaction. The function executes during the subfile initialization routine before each order record is loaded, ensuring that all orders display with consistent, normal field attributes rather than carrying over special display states from previous processing. This reset operation is essential for proper subfile presentation, particularly when refreshing the order list or reloading after order assignments, ensuring users see a clean, uniformly formatted order selection screen.</p>
</div>

<!-- AI_MARKER: F07_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> During subfile record initialization, the function executes a SETOFF operation on indicator 48 to clear any special display attributes, ensuring all order selection fields display in normal input-capable mode for consistent user interaction.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Subfile Record Initialization Loop]) --> CheckIndicator{Indicator 48<br/>Currently ON?}
    CheckIndicator -->|Yes - Need Reset| CallPDJ5UFR[Call PDJ5UFR User Source]
    CheckIndicator -->|No - Already OFF| SkipReset[Skip Reset Operation]
    SkipReset --> ValidateFields
    CallPDJ5UFR --> ExecuteSETOFF[Execute SETOFF 48 Operation]
    ExecuteSETOFF --> ClearAttribute[Clear Special Display Attributes]
    ClearAttribute --> ResetProtection[Remove Field Protection]
    ResetProtection --> NormalHighlight[Set Normal Highlighting]
    NormalHighlight --> ValidateFields{All Fields<br/>Accessible?}
    ValidateFields -->|Yes| SetInputMode[Enable Input Mode for Order Selection]
    ValidateFields -->|No| LogFieldError[Log Field Attribute Error]
    LogFieldError --> SetInputMode
    SetInputMode --> LoadOrderData[Load Order Data into Subfile Record]
    LoadOrderData --> Ready([Order Record Ready for Display])
</div>

<!-- AI_MARKER: F07_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—controls display file indicator state for screen presentation</p>
<p><strong>External Calls:</strong> Calls PDJ5UFR user source routine to execute the SETOFF indicator operation</p>
<p><strong>Business Impact:</strong> Ensures consistent and predictable display presentation for order selection, preventing visual artifacts or unexpected field protection that could confuse users or prevent order assignment. Critical for usability as it guarantees that every time the order subfile loads, all selection fields appear in normal, input-capable mode regardless of previous screen states. Particularly important when users are rapidly working through order assignments, as consistent field presentation reduces cognitive load and prevents errors caused by unexpected protected fields or unusual highlighting.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 8: SFL</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 1846 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F08_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> MODE field value ('0' = display mode active, other = normal mode), Indicator 89 (controls subfile fold/drop display state)</p>
<p><strong>Output:</strong> Indicator 89 set ON (display mode) or OFF (normal mode) based on MODE value</p>
<p><strong>Key Data:</strong> Display mode control variable that determines whether the subfile automatically displays in folded (collapsed) or dropped (expanded) state for optimal screen presentation based on user context</p>
</div>

<!-- AI_MARKER: F08_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function controls the default display state (folded vs dropped) of the order subfile based on the current display mode setting. It examines the MODE field value and sets indicator 89 accordingly—when MODE equals '0' (display mode), indicator 89 is turned ON to automatically show the subfile in folded/collapsed view; otherwise, indicator 89 is turned OFF to show the expanded/dropped view. This dynamic display control adapts the screen presentation to match user workflow context, automatically collapsing the order list when in display/inquiry mode (where users are primarily viewing loads rather than assigning orders) and expanding it in normal editing mode (where users need full order details for assignment decisions). The function ensures optimal information density and screen real estate utilization based on whether the user is performing display-only operations or active load planning work.</p>
</div>

<!-- AI_MARKER: F08_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function checks the MODE field value; if MODE equals '0' (display mode), it turns indicator 89 ON to fold the subfile for compact viewing; otherwise, it turns indicator 89 OFF to display the subfile in expanded mode for detailed order selection.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Check Display Mode]) --> EvalMode{MODE Field Equals 0?}
    EvalMode -->|Yes Display Mode| SetOn[Turn Indicator 89 ON]
    SetOn --> Fold([Subfile Displays in Folded/Collapsed State])
    EvalMode -->|No Normal Mode| SetOff[Turn Indicator 89 OFF]
    SetOff --> Drop([Subfile Displays in Dropped/Expanded State])
</div>

<!-- AI_MARKER: F08_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—controls display file indicator state based on mode field value</p>
<p><strong>External Calls:</strong> Calls POBKUFR user source routine containing the subfile fold/drop conditional logic</p>
<p><strong>Business Impact:</strong> Optimizes user experience by automatically adapting the order list presentation to match user intent—displaying more orders in summary form during inquiry operations and showing full detail during active load assignment work. Reduces unnecessary scrolling and improves productivity by showing the right level of detail at the right time. Particularly valuable for power users who switch between display mode (reviewing existing loads) and edit mode (creating new loads), as the system intelligently adjusts information density without requiring manual F7 keypresses to toggle display modes.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 9: SFL</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 5697 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F09_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> MODE field value ('0' = display mode, other = normal mode), Indicator 89 (controls subfile display state)</p>
<p><strong>Output:</strong> Indicator 89 set ON or OFF to control subfile fold/drop behavior for F5 Refresh operation</p>
<p><strong>Key Data:</strong> Display mode setting that determines whether refreshed order subfile displays in collapsed or expanded format after user presses F5 to reload order list</p>
</div>

<!-- AI_MARKER: F09_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function is identical to F08 (line 1846) but executes at a different program location—specifically after the F5 Refresh validation logic. It controls the subfile fold/drop display state by examining the MODE field and setting indicator 89 accordingly. When users press F5 to refresh the order list (to see newly released orders or updated order statuses), this function ensures the refreshed subfile displays in the appropriate format—folded/collapsed in display mode for compact viewing, or dropped/expanded in edit mode for detailed order selection. The function maintains display consistency across screen refreshes, ensuring users don't lose their preferred view state when reloading order data, which is particularly important during active load planning sessions when users may refresh multiple times to access the latest available orders.</p>
</div>

<!-- AI_MARKER: F09_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After F5 Refresh validation, the function evaluates MODE field—if MODE='0' (display mode), sets indicator 89 ON for folded view; otherwise sets indicator 89 OFF for expanded view, ensuring refreshed order list displays in appropriate format.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([F5 Refresh Requested]) --> CheckMode{MODE Field Equals 0?}
    CheckMode -->|Yes Display Mode| SetOn[Turn Indicator 89 ON]
    SetOn --> FoldRefresh([Refreshed Subfile Shows Folded/Compact View])
    CheckMode -->|No Edit Mode| SetOff[Turn Indicator 89 OFF]
    SetOff --> DropRefresh([Refreshed Subfile Shows Expanded/Detail View])
</div>

<!-- AI_MARKER: F09_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—controls display indicator state for subfile presentation after refresh</p>
<p><strong>External Calls:</strong> Calls POBKUFR user source routine with same fold/drop conditional logic as F08</p>
<p><strong>Business Impact:</strong> Maintains display consistency and user preference across F5 refresh operations, preventing frustrating view state resets that would force users to repeatedly toggle F7 to restore their preferred display format. Critical for productivity during high-volume order processing periods when users may refresh the order list dozens of times per hour to capture newly released orders. Ensures seamless user experience by preserving display context across data reloads, allowing users to focus on order selection rather than screen formatting.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 10: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 6746 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F10_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), WRK.Load Added/Deleted flag set to 1 (Added status)</p>
<p><strong>Output:</strong> Cleared message queue ready for new messages after successful order assignment to load</p>
<p><strong>Key Data:</strong> Message queue state after order addition operations, ensuring clean message slate before subfile reload and display refresh</p>
</div>

<!-- AI_MARKER: F10_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue immediately after successfully adding an order to a load. It executes when WRK.Load Added/Deleted is set to 1 (Added status), indicating that order assignment processing has completed and the subfile is about to reload with updated order assignments. The function calls Y2CLMSC to remove any informational messages or warnings that accumulated during the add operation (such as weight calculation messages, stop sequence assignments, or validation confirmations), then resets the first message flag to prepare for new message handling. This clearing ensures that when the screen refreshes to show the newly assigned order, users see only relevant current messages rather than a cluttered queue of processing notifications from the completed assignment operation.</p>
</div>

<!-- AI_MARKER: F10_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After successfully adding an order to the load (WRK.Load Added/Deleted = 1), the function calls Y2CLMSC to clear accumulated processing messages, resets the first message flag, and prepares the message queue for subfile reload and screen refresh operations.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Order Assignment Complete]) --> ValidateAdd{Order Successfully<br/>Added to Load?}
    ValidateAdd -->|Yes| SetStatusFlag[Set WRK.Load Added/Deleted = 1]
    ValidateAdd -->|No| ErrorPath[Handle Assignment Error]
    ErrorPath --> End
    SetStatusFlag --> CheckMessages{Message Queue<br/>Has Content?}
    CheckMessages -->|Yes - Need Clear| CallUSGDUFR[Call USGDUFR User Source]
    CheckMessages -->|No - Already Clean| SkipClear[Skip Clear Operation]
    SkipClear --> TriggerReload
    CallUSGDUFR --> InvokeY2CLMSC[Invoke Y2CLMSC Clear Routine]
    InvokeY2CLMSC --> RemoveInfo[Remove Informational Messages]
    RemoveInfo --> RemoveWarnings[Remove Processing Warnings]
    RemoveWarnings --> KeepErrors{Critical Errors<br/>Present?}
    KeepErrors -->|Yes - Keep Them| PreserveErrors[Preserve Error Messages for User]
    KeepErrors -->|No - All Clear| CompleteReset[Complete Message Reset]
    PreserveErrors --> ResetFlag[Reset First Message Flag = Y]
    CompleteReset --> ResetFlag
    ResetFlag --> ValidateClean[Validate Queue State]
    ValidateClean --> TriggerReload[Set Reload Subfile Flag]
    TriggerReload --> RecalcWeight[Recalculate Total Load Weight]
    RecalcWeight --> UpdateDisplay[Update Load Summary Fields]
    UpdateDisplay --> End([Subfile Reloads with Updated Order List])
</div>

<!-- AI_MARKER: F10_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears system message queue in program memory</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Prevents message queue clutter after order assignments, ensuring users see only relevant validation errors or warnings for their current operation rather than historical processing messages. Improves user focus by clearing informational messages about completed actions (like "Order 12345 assigned to stop 1" or "Gross weight recalculated to 42,000 lbs"), allowing attention to remain on the next order selection decision. Critical during rapid-fire order assignment sessions when users may assign 10-20 orders to a load in quick succession, as it prevents message overload that could obscure important warnings about weight limits or delivery constraints.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 11: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 7524 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F11_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), WRK.Load Added/Deleted flag set to 2 (Deleted status)</p>
<p><strong>Output:</strong> Cleared message queue ready for new messages after successful order removal from load</p>
<p><strong>Key Data:</strong> Message queue state after order deletion operations, ensuring clean message display before subfile reload showing remaining assigned orders</p>
</div>

<!-- AI_MARKER: F11_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue after successfully deleting an order from a load. It executes when WRK.Load Added/Deleted is set to 2 (Deleted status), indicating that order removal processing has completed and the system is preparing to refresh the screen to show updated order assignments with the deleted order removed. The function calls Y2CLMSC to clear any processing messages generated during the deletion operation (such as "Order removed from load", "Stop sequences renumbered", "Gross weight recalculated"), then resets the first message flag for new message handling. This clearing is particularly important for deletion operations because it removes confirmation messages that could confuse users when the screen refreshes—users need to see the visual result (order removed from subfile) without lingering messages about the completed deletion action.</p>
</div>

<!-- AI_MARKER: F11_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After successfully deleting an order from the load (WRK.Load Added/Deleted = 2), the function calls Y2CLMSC to clear deletion processing messages, resets the first message flag, and prepares the message queue for subfile reload displaying remaining orders.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Order Successfully Deleted from Load]) --> SetFlag[WRK.Load Added/Deleted = 2 Deleted]
    SetFlag --> CallClear[Call Y2CLMSC Message Clear Routine]
    CallClear --> RemoveMsgs[Remove Deletion Processing Messages]
    RemoveMsgs --> ResetFlag[Reset First Message Flag to Y]
    ResetFlag --> Reload([Ready for Subfile Reload Showing Remaining Orders])
</div>

<!-- AI_MARKER: F11_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears system message queue in program memory</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Ensures clean user interface after order deletions, preventing confusion from stale removal confirmation messages. Critical for correcting load planning errors—when users realize an order was assigned incorrectly and need to remove it, this function ensures the post-deletion screen displays cleanly without cluttered messages about the completed removal operation. Particularly valuable when users are restructuring loads by moving orders between different load IDs, as multiple delete operations benefit from message clearing between each removal to maintain clarity about current vs completed actions.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 12: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 7649 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F12_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), stop/drop change processing context</p>
<p><strong>Output:</strong> Cleared message queue after processing stop sequence changes and load change logging</p>
<p><strong>Key Data:</strong> Message queue state after stop/drop sequence modifications, load change log records, and error tracking for missing mileage data</p>
</div>

<!-- AI_MARKER: F12_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue after processing stop/drop sequence changes within an already assigned load. It executes when users modify the stop sequence numbers for orders (changing delivery order within the multi-stop route), after the system has logged the change to the Load Change History (PDADXFR) and performed related validations like missing mileage checks. The function calls Y2CLMSC to remove processing messages accumulated during stop sequence updates, change logging operations, and distance validation, then resets the first message flag to prepare for new messages. This clearing is important because stop sequence changes generate multiple system messages (change logged, mileage validated, route updated) that users don't need to see after the operation completes—they only need to see validation errors if constraints are violated.</p>
</div>

<!-- AI_MARKER: F12_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After processing stop/drop sequence changes, logging modifications to change history, and validating mileage data, the function clears accumulated processing messages to provide clean display for continued load planning operations.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Stop Sequence Change Processed]) --> LogChange[Change Logged to Load Change History]
    LogChange --> ValidateMiles[Validate Mileage Data for Route]
    ValidateMiles --> CallClear[Call Y2CLMSC Message Clear Routine]
    CallClear --> RemoveMsgs[Remove Processing and Validation Messages]
    RemoveMsgs --> ResetFlag[Reset First Message Flag to Y]
    ResetFlag --> Ready([Clean Message Queue for Next Operation])
</div>

<!-- AI_MARKER: F12_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears system message queue after change logging and validation operations complete</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Maintains clean message display during route optimization activities when users resequence stops to improve delivery efficiency. Critical for iterative route planning where users may adjust stop sequences multiple times to find optimal delivery order—each sequence change generates audit log entries and validation checks, and clearing these messages prevents screen clutter that could obscure important warnings about route constraints or delivery window conflicts. Ensures users can focus on route optimization logic rather than historical processing messages about completed sequence changes.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 13: CVT</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 9103 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F13_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> PAR.Destination City (city name entered by user in mixed case, e.g., "Los Angeles")</p>
<p><strong>Output:</strong> WRK.Destination City (city name converted to uppercase, e.g., "LOS ANGELES")</p>
<p><strong>Key Data:</strong> Destination city text used for freight rating and carrier destination lookups that require standardized uppercase format for database matching</p>
</div>

<!-- AI_MARKER: F13_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function converts destination city names from mixed case to uppercase to ensure consistent database lookups for carrier destination rates. It receives the city name as entered by users (who may type in lowercase, uppercase, or mixed case) and applies an uppercase translation using the %XLATE CL command to convert all lowercase letters to uppercase equivalents. The standardized uppercase city name is then used to retrieve flat freight amounts from the Destination Rate file (PDLECPP) by matching carrier/broker, warehouse, city, and state combinations. This uppercase conversion is critical because database city name keys are stored in uppercase format, and case-sensitive lookups would fail if users entered "los angeles" instead of "LOS ANGELES", resulting in missing freight rates and potentially incorrect shipping cost calculations.</p>
</div>

<!-- AI_MARKER: F13_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> The function receives the mixed-case destination city name, applies uppercase translation using %XLATE, stores the standardized uppercase result in the work field, and returns the converted value for use in freight rate database lookups.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Freight Rate Calculation Initiated]) --> CheckInput{Destination City<br/>Entered?}
    CheckInput -->|Yes| ValidateFormat{Contains<br/>Valid Characters?}
    CheckInput -->|No| UseBlank[Use Blank City for Default Rate]
    ValidateFormat -->|Yes| CallPDWEUFR[Call PDWEUFR CL Program]
    ValidateFormat -->|No| StripInvalid[Strip Invalid Characters]
    StripInvalid --> CallPDWEUFR
    CallPDWEUFR --> ApplyXLATE[Execute %XLATE UPTEXT Command]
    ApplyXLATE --> ConvertLower[Convert a-z to A-Z]
    ConvertLower --> PreserveNumbers[Preserve Numbers and Spaces]
    PreserveNumbers --> StoreResult[Store in WRK.Destination City]
    StoreResult --> ValidateConversion{Conversion<br/>Successful?}
    ValidateConversion -->|Yes| LogConversion[Log City Standardization]
    ValidateConversion -->|No| UseOriginal[Use Original Input]
    UseOriginal --> PrepareKey
    LogConversion --> PrepareKey[Prepare Database Lookup Key]
    PrepareKey --> BuildKey[Build Key: Carrier + Warehouse + City + State]
    UseBlank --> PrepareKey
    BuildKey --> Lookup([Query PDLECPP for Flat Freight Rate])
</div>

<!-- AI_MARKER: F13_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No direct database operations—prepares city name for subsequent database lookup against Destination Rate file (PDLECPP)</p>
<p><strong>External Calls:</strong> Calls PDWEUFR CL program containing %XLATE uppercase translation command</p>
<p><strong>Business Impact:</strong> Ensures accurate freight rate retrieval regardless of how users enter city names, preventing failed lookups that would result in missing freight costs and incorrect load pricing. Critical for carrier rating accuracy as it guarantees that destination-based flat freight amounts are consistently retrieved when available in the system, supporting accurate cost allocation and profitability analysis. Particularly important for loads with multiple destination cities where case-inconsistent city names could cause some destinations to retrieve rates while others fail, leading to incomplete or inaccurate freight cost totals.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 14: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 9552 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F14_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), scheduled ship date validation context</p>
<p><strong>Output:</strong> Cleared message queue after preliminary pick processing messages for same-day shipments</p>
<p><strong>Key Data:</strong> Warehouse auto-print settings, scheduled ship date matching job date, preliminary pick list trigger messages</p>
</div>

<!-- AI_MARKER: F14_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue in an *OTHERWISE branch after preliminary pick list processing for same-day scheduled shipments. It executes when the scheduled ship date equals the current job date and the warehouse is configured for auto-preliminary pick printing, after the system sends informational messages about preliminary pick lists being generated at warehouse printers. The function calls Y2CLMSC to remove these informational messages about pick list printing (such as "Preliminary Pick Printing at printer for warehouses: W01 W02 W03") that were sent to notify users of automatic print jobs, then resets the first message flag for clean message handling. This clearing prevents these system notification messages from cluttering the screen when users return to load planning after the automatic preliminary pick trigger, allowing them to focus on load assignment rather than automated background printing notifications.</p>
</div>

<!-- AI_MARKER: F14_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After triggering preliminary pick list printing for same-day shipments, the function clears informational messages about auto-print operations, resets the message flag, and returns focus to load planning operations without print notification clutter.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Same-Day Shipment Detected]) --> CheckAuto{Warehouse Auto-Print Enabled?}
    CheckAuto -->|Yes| SendMsg[Send Preliminary Pick Printing Message]
    SendMsg --> CallClear[Call Y2CLMSC Message Clear Routine]
    CallClear --> RemoveMsgs[Remove Print Notification Messages]
    RemoveMsgs --> ResetFlag[Reset First Message Flag to Y]
    ResetFlag --> Return([Return to Load Planning Screen])
    CheckAuto -->|No| Return
</div>

<!-- AI_MARKER: F14_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears system message queue after auto-print notifications</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Maintains clean user interface during automated warehouse operations by removing background process notifications that don't require user action. Important for warehouses with auto-preliminary pick enabled, where same-day load creation automatically triggers pick list generation—users need confirmation that printing occurred but don't need persistent messages cluttering subsequent screens. Supports efficient workflow by keeping users focused on load planning decisions rather than system automation messages, particularly valuable during peak shipping periods when multiple same-day loads are created in rapid succession.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 15: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 10330 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F15_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), load unlock operation context</p>
<p><strong>Output:</strong> Cleared message queue after processing F10 Unlock Load operation and stop number retrieval</p>
<p><strong>Key Data:</strong> Load unlock change type, stop number retrieval results, load change logging for unlock operations</p>
</div>

<!-- AI_MARKER: F15_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue after executing the F10 Unlock Load operation. It runs after the system sets the load change type to "UNLOCK", retrieves stop numbers from the load stop file (OMFLCPP), and prepares to change the load status from Entered ('E') or Combined ('C') to Unlocked ('U'). The function calls Y2CLMSC to remove processing messages accumulated during the unlock operation (such as stop retrieval confirmations, change type assignments, and validation checks), then resets the first message flag for clean message handling. This clearing is important because unlocking a load is typically an intermediate operation—users unlock loads to make modifications, and they need a clean message queue to see validation messages related to their subsequent edits rather than historical messages about the unlock action itself.</p>
</div>

<!-- AI_MARKER: F15_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After user presses F10 to unlock the load, the system sets unlock change type, retrieves stop numbers, clears processing messages via Y2CLMSC, resets the message flag, and prepares the screen for load editing operations.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([F10 Unlock Load Pressed]) --> SetType[Set Load Change Type = UNLOCK]
    SetType --> RetrieveStops[Retrieve Stop Numbers from OMFLCPP]
    RetrieveStops --> CallClear[Call Y2CLMSC Message Clear Routine]
    CallClear --> RemoveMsgs[Remove Unlock Processing Messages]
    RemoveMsgs --> ResetFlag[Reset First Message Flag to Y]
    ResetFlag --> Ready([Load Ready for Editing with Clean Message Queue])
</div>

<!-- AI_MARKER: F15_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears message queue after stop retrieval and unlock status change preparations</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Supports load modification workflows by ensuring users see only relevant editing validation messages after unlocking a load, not historical unlock operation confirmations. Critical for correcting locked loads that require changes—when logistics coordinators discover errors in entered or combined loads and need to unlock them for modifications, this function ensures the editing session starts with a clean message slate. Particularly valuable in high-pressure shipping environments where users need to quickly unlock, modify, and re-lock loads to correct carrier assignments or adjust stop sequences, as clear messaging prevents confusion about which warnings apply to current edits vs completed unlock operations.</p>
</div>
</div>

<div class="func">
<div class="func-header">
<h3>Function 16: Clr</h3>
<p style="margin:5px 0 0 0;font-size:0.95em;">Source Code Line: 10836 | Business Function Analysis</p>
</div>

<!-- AI_MARKER: F16_Parameters -->
<h4>1. Parameters and Business Data</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Input:</strong> Program message queue identifier (##PGM), CTL.Load Status set to 'U' (Unlocked)</p>
<p><strong>Output:</strong> Cleared message queue before triggering subfile reload after load status change to Unlocked</p>
<p><strong>Key Data:</strong> Load status change from Entered/Combined to Unlocked, export order detection for load, subfile reload trigger flag</p>
</div>

<!-- AI_MARKER: F16_BusinessLogic -->
<h4>2. Business Logic Summary</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p>This function clears the program message queue after completing the load status change from Entered ('E') or Combined ('C') to Unlocked ('U'), just before triggering the subfile reload. It executes after the system has checked for export orders on the load (retrieving from OPBFCPP), updated the load status to Unlocked in the control record, and set the reload subfile flag to refresh the screen with the updated status. The function calls Y2CLMSC to remove status change processing messages, export order detection notifications, and validation confirmations, then resets the first message flag for clean message handling. This final clearing before subfile reload ensures that when the screen refreshes to show the unlocked load, users see only relevant current validation messages or warnings, not a cluttered queue of status change confirmations and export order detection notifications from the completed unlock operation.</p>
</div>

<!-- AI_MARKER: F16_FlowDiagram -->
<h4>3. Business Process Flow</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Process Explanation:</strong> After load status changes to Unlocked and export order detection completes, the function clears accumulated status change messages, resets the message flag, and triggers subfile reload to display the unlocked load with clean messaging.</p>
</div>
<div class="mermaid">
flowchart TD
    Start([Load Status Changed to Unlocked]) --> CheckExport[Check for Export Orders on Load]
    CheckExport --> SetReload[Set Reload Subfile Flag = Y]
    SetReload --> CallClear[Call Y2CLMSC Message Clear Routine]
    CallClear --> RemoveMsgs[Remove Status Change and Detection Messages]
    RemoveMsgs --> ResetFlag[Reset First Message Flag to Y]
    ResetFlag --> Reload([Trigger Subfile Reload with Clean Display])
</div>

<!-- AI_MARKER: F16_DataInteraction -->
<h4>4. Data Interaction and Business Impact</h4>
<div style="padding:10px;background:#fafafa;border-radius:5px;">
<p><strong>Database Operations:</strong> No database operations—clears message queue after status change and before subfile reload trigger</p>
<p><strong>External Calls:</strong> Calls Y2CLMSC system routine via USGDUFR user source to clear program message queue</p>
<p><strong>Business Impact:</strong> Completes the unlock operation with a clean screen refresh, ensuring users see their unlocked load in editable state without confusing status change confirmation messages. Essential for professional user experience as it provides clear visual feedback that unlock succeeded (load status shows 'U', fields become editable) without message clutter about the operation that just completed. Particularly important for loads with export orders where the system performs additional export status detection—clearing these detection messages prevents confusion about whether export validation warnings apply to current operations or are simply notifications from the completed unlock process. Supports efficient load modification workflows by maintaining focus on editing actions rather than historical operation confirmations.</p>
</div>
</div>

<h2>Function Summary</h2>
<table>
<thead><tr><th>Function</th><th>Line</th><th>Business Purpose</th></tr></thead>
<tbody>
<tr><td><strong>SET</strong></td><td>141</td><td>Configure message routing and terminate program when user authorization fails</td></tr>
<tr><td><strong>SET</strong></td><td>205</td><td>Handle application profile retrieval failure by routing access denial messages</td></tr>
<tr><td><strong>CLC</strong></td><td>293</td><td>Center application description text for professional screen header display</td></tr>
<tr><td><strong>MOV</strong></td><td>318</td><td>Move centered application description to screen company header field</td></tr>
<tr><td><strong>SFL</strong></td><td>492</td><td>Enable F7 key fold/drop control for order subfile display optimization</td></tr>
<tr><td><strong>Clr</strong></td><td>543</td><td>Clear program message queue before initial screen display for clean messaging</td></tr>
<tr><td><strong>Set</strong></td><td>1350</td><td>Reset display indicator 48 to enable normal order selection field attributes</td></tr>
<tr><td><strong>SFL</strong></td><td>1846</td><td>Set subfile display mode (folded/dropped) based on display vs edit mode</td></tr>
<tr><td><strong>SFL</strong></td><td>5697</td><td>Maintain subfile fold/drop state after F5 Refresh order list operation</td></tr>
<tr><td><strong>Clr</strong></td><td>6746</td><td>Clear message queue after successfully adding order to load</td></tr>
<tr><td><strong>Clr</strong></td><td>7524</td><td>Clear message queue after successfully deleting order from load</td></tr>
<tr><td><strong>Clr</strong></td><td>7649</td><td>Clear message queue after processing stop sequence changes and logging</td></tr>
<tr><td><strong>CVT</strong></td><td>9103</td><td>Convert destination city names to uppercase for freight rate database lookups</td></tr>
<tr><td><strong>Clr</strong></td><td>9552</td><td>Clear message queue after auto-preliminary pick printing notifications</td></tr>
<tr><td><strong>Clr</strong></td><td>10330</td><td>Clear message queue after F10 Unlock Load operation before editing</td></tr>
<tr><td><strong>Clr</strong></td><td>10836</td><td>Clear message queue after load status change to Unlocked before screen refresh</td></tr>
</tbody></table>

<div style="text-align:center;margin:40px 0;padding:20px;background:#e7f3ff;border-radius:8px;">
<p><strong>Documentation Status:</strong> All 16 functions analyzed for business users</p>
<p>This documentation focuses on business value and process understanding</p>
</div>

</body></html>
