<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICQ9DFR - Complete Business Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
        <style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background-color: #f8f9fa;
}

.header {
    background: linear-gradient(135deg, #0066cc, #007bff);
    color: white;
    padding: 2rem;
    margin: -20px -20px 30px -20px;
    border-radius: 0 0 15px 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.header h1 { margin: 0; font-size: 2.5em; font-weight: 300; }
.header .subtitle { font-size: 1.2em; opacity: 0.9; margin-top: 10px; }

.meta-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.meta-item {
    background: rgba(255,255,255,0.2);
    padding: 10px 15px;
    border-radius: 8px;
}

.meta-item strong {
    display: block;
    font-size: 0.9em;
    opacity: 0.8;
}

.alert-banner {
    background: linear-gradient(45deg, #ffc107, #f39c12);
    color: #000;
    padding: 15px;
    margin: 20px 0;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
}

.executive-summary {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin: 30px 0;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.summary-card {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-left: 5px solid #0066cc;
}

.summary-card h3 { color: #2c3e50; margin-top: 0; }

.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.kpi-item {
    text-align: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.kpi-value {
    font-size: 2em;
    font-weight: bold;
    color: #0066cc;
}

.kpi-label {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
}

.toc {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin: 30px 0;
}

.toc ul { list-style: none; padding: 0; }
.toc li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; }
.toc a { color: #0066cc; text-decoration: none; font-weight: 500; }
.toc a:hover { color: #007bff; }

.section {
    background: white;
    margin: 30px 0;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.section h2 {
    color: #2c3e50;
    border-bottom: 3px solid #0066cc;
    padding-bottom: 10px;
    margin-bottom: 25px;
}

.section h3 { color: #34495e; margin-top: 25px; }

.function-analysis {
    background: #f8f9fa;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 20px;
    margin: 30px 0;
}

.function-header {
    background: #0066cc;
    color: white;
    padding: 20px;
    margin: -20px -20px 20px -20px;
    border-radius: 8px 8px 0 0;
}

.function-header h3 { margin: 0; color: white; }

table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

th {
    background: #0066cc;
    color: white;
    font-weight: 600;
}

tr:hover { background-color: #f8f9fa; }

.nav-link {
    display: inline-block;
    background: #0066cc;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    margin: 10px 5px;
    font-weight: 500;
    transition: all 0.3s;
}

.nav-link:hover {
    background: #007bff;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,102,204,0.3);
}

.highlight {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    border-left: 5px solid #ffc107;
    margin: 15px 0;
}

.priority-critical { color: #e74c3c; font-weight: bold; }
.priority-high { color: #f39c12; font-weight: bold; }
.priority-medium { color: #3498db; }
.priority-low { color: #95a5a6; }

@media (max-width: 768px) {
    .summary-grid, .meta-info, .kpi-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 2em; }
    body { padding: 10px; }
}
    </style>
</head>
<body>


<div class="header">
    <h1>ICQ9DFR</h1>
    <div class="subtitle">IBM i Program Business Documentation</div>
    <div class="meta-info">
        <div class="meta-item"><strong>Object Type</strong>RPG Program</div>
        <div class="meta-item"><strong>Lines of Code</strong>2,067</div>
        <div class="meta-item"><strong>Functions</strong>3</div>
        <div class="meta-item"><strong>Generated</strong>October 15, 2025</div>
    </div>
</div>

<div class="alert-banner" style="background: linear-gradient(45deg, #28a745, #20c997);">
    COMPLETE DOCUMENTATION - Full Analysis with Accurate Business Context
</div>


<div class="executive-summary">
    <h2>Executive Summary</h2>
    <p><strong>Strategic Overview:</strong> ICQ9DFR is a critical Inventory & Warehouse Management display program that provides real-time visibility into item inventory levels, production schedules, aging analysis, and order commitments across warehouse locations. This program supports inventory planning, production scheduling, and order fulfillment operations by displaying detailed inventory aging information with toggleable quantity/weight views.</p>

    <div class="summary-grid">
        <div class="summary-card">
            <h3>Business Value</h3>
            <ul>
                <li><strong>Inventory Visibility:</strong> Real-time display of on-hand quantities, aging, and availability</li>
                <li><strong>Production Tracking:</strong> Monitors production by shift with aging date validation</li>
                <li><strong>Order Fulfillment:</strong> Shows scheduled quantities, picked items, and available inventory</li>
                <li><strong>Age Management:</strong> Tracks product freshness with production date aging (7+ days flagged)</li>
            </ul>
        </div>

        <div class="summary-card">
            <h3>System Scale</h3>
            <ul>
                <li><strong>Functions:</strong> 3 (CLC, MOV, SFL)</li>
                <li><strong>Code Lines:</strong> 2,067</li>
                <li><strong>Database Files:</strong> 15+ (CAB0REP, CAB1REP, OPBGWKP, etc.)</li>
                <li><strong>External Programs:</strong> 8 (PDYJUFR, PDYKUFR, PNO6XFR, etc.)</li>
                <li><strong>Function Calls:</strong> 25+ internal function executions</li>
            </ul>
        </div>

        <div class="summary-card">
            <h3>Operational Impact</h3>
            <ul>
                <li><strong>Users:</strong> Warehouse managers, inventory planners, production supervisors</li>
                <li><strong>Business Processes:</strong> Inventory inquiry, production monitoring, order fulfillment, age compliance</li>
                <li><strong>Operations:</strong> Real-time inventory tracking, aging analysis, weight/quantity toggle (F13)</li>
                <li><strong>Compliance:</strong> Age validation for requested delivery dates with chilling time calculations</li>
            </ul>
        </div>
    </div>

    <h3>Key Performance Indicators</h3>
    <div class="kpi-grid">
        <div class="kpi-item"><div class="kpi-value">2,067</div><div class="kpi-label">Lines of Code</div></div>
        <div class="kpi-item"><div class="kpi-value">3</div><div class="kpi-label">Functions</div></div>
        <div class="kpi-item"><div class="kpi-value">15+</div><div class="kpi-label">Database Files</div></div>
        <div class="kpi-item"><div class="kpi-value">8</div><div class="kpi-label">External Programs</div></div>
    </div>
</div>


<div class="toc">
    <h3>Table of Contents</h3>
    <ul>
        <li><a href="#context">1. Business Context and Overview</a></li>
        <li><a href="#inputs">2. Inputs (Primary and Optional)</a></li>
        <li><a href="#structure">3. Structure Overview and Components</a></li>
        <li><a href="#logic-summary">4. Business Logic Summary</a></li>
        <li><a href="#logic-flow">5. Detailed Logic Flow and Process Diagrams</a></li>
        <li><a href="#data-interaction">6. Data Operations</a></li>
        <li><a href="#dependencies">7. System Dependencies</a></li>
        <li><strong><a href="ICQ9DFR_Section_8_Functions.html" class="nav-link" style="display:inline; padding:5px 10px;">8. Functions (3) â†’</a></strong></li>
    </ul>
</div>


<div class="section" id="context">
    <h2>1. Business Context and Overview</h2>

    <h3>Executive Summary</h3>
    <p><strong>Program Name:</strong> ICQ9DFR - Item/Warehouse Inventory Inquiry Details (Display Function)</p>
    <p><strong>Program Date:</strong> Generated from Action Diagram dated 14.08.2025 03:33:33</p>
    <p><strong>Business Domain:</strong> Inventory & Warehouse Management / Production Tracking / Order Fulfillment</p>

    <p>ICQ9DFR is an inquiry display program providing comprehensive visibility into inventory levels, production tracking, and order commitments for items across warehouse locations. The program displays detailed inventory aging information with sophisticated features including weight/quantity toggle views (F13), production tracking by shift, aging date validation, and real-time availability calculations. This program is critical for inventory planners, warehouse managers, and production supervisors making operational decisions about order fulfillment and production scheduling.</p>

    <h3>Business Purpose</h3>
    <p><strong>Primary Function:</strong> Display detailed item/warehouse inventory inquiry with aging analysis</p>

    <ul>
        <li><strong>Inventory Visibility:</strong> Shows on-hand quantities, available inventory, current vs. aged inventory breakdown</li>
        <li><strong>Production Monitoring:</strong> Tracks production quantities by shift (Shift 1 & 2) with multiple calculation modes (W/O Rework-PRD, W/ Rework-All, W/ Rework & Adj)</li>
        <li><strong>Order Fulfillment Tracking:</strong> Displays open orders, scheduled quantities, picked quantities, and transfer/staging quantities</li>
        <li><strong>Age Management:</strong> Calculates aging based on production dates with 7+ day threshold for aged inventory classification</li>
        <li><strong>Production Date Validation:</strong> Validates production override age dates against requested delivery dates with chilling time adjustments for frozen warehouses</li>
        <li><strong>Weight/Quantity Toggle:</strong> F13 key toggles between quantity and weight views for all displayed metrics</li>
    </ul>

    <h3>Key Business Functions</h3>
    <ul>
        <li><strong>Screen Initialization:</strong> Sets application headings, retrieves company/warehouse/item information, initializes subfile control</li>
        <li><strong>Inventory Calculations:</strong> Computes on-hand quantities, current vs. aged inventory split, inventory/order differences</li>
        <li><strong>Production Tracking:</strong> Retrieves production quantities by shift and date with configurable calculation modes (F10/F11/F12)</li>
        <li><strong>Order Scheduling:</strong> Builds label date arrays, calculates scheduled quantities by age date, validates age information</li>
        <li><strong>Availability Calculation:</strong> Determines available inventory by subtracting picked quantities from on-hand quantities</li>
        <li><strong>Chilling Time Management:</strong> Retrieves fresh/frozen chilling times from system values and item master</li>
        <li><strong>Age Code Calculation:</strong> Calls external program PNO6XFR to calculate number of days to age for each production date</li>
        <li><strong>Display Mode Toggle:</strong> CF07 fold/drop subfile, CF13 quantity/weight toggle, CF10/11/12 calculation mode selection</li>
        <li><strong>Navigation:</strong> CF14 calls Item Orders display (PDO7DFR), CF03 exits program</li>
    </ul>
</div>


<div class="section" id="inputs">
    <h2>2. Inputs (Primary and Optional)</h2>

    <h3>2.1 Primary Inputs</h3>
    <p><strong>Control Record (CTL) - Screen Input Parameters:</strong></p>
    <table>
        <thead>
            <tr><th>Field</th><th>Description</th><th>Business Purpose</th></tr>
        </thead>
        <tbody>
            <tr><td>CTL.Company_Number</td><td>Company identifier</td><td>Identifies which company's inventory to display</td></tr>
            <tr><td>CTL.Warehouse_Code</td><td>Warehouse location code</td><td>Specifies warehouse for inventory inquiry</td></tr>
            <tr><td>CTL.Item_Code</td><td>Item/product identifier</td><td>Item to display inventory details for</td></tr>
            <tr><td>CTL.*CMD_key</td><td>Function key pressed</td><td>Controls display modes (F10/11/12=calc mode, F13=toggle qty/wgt, F14=orders, CF07=fold/drop)</td></tr>
        </tbody>
    </table>

    <p><strong>Database Files (Read-Only Access):</strong></p>
    <ul>
        <li><strong>CAABREP:</strong> Company Master - retrieves company name</li>
        <li><strong>CADNREP:</strong> Application Group/Description - screen heading setup</li>
        <li><strong>CAADREP:</strong> Warehouse Master - warehouse description, type, lot tracking flag</li>
        <li><strong>CABZREP:</strong> Item Master Extended - fresh chilling time</li>
        <li><strong>CAB0REP:</strong> Item Balance Summary - on-hand quantities by item/warehouse</li>
        <li><strong>CAB1REP:</strong> Item Balance Detail - quantity on-hand by production date/label date</li>
        <li><strong>CAB7CPP:</strong> Inventory Transaction History - production quantities by shift and transaction type</li>
        <li><strong>OPBGWKP:</strong> Order Detail Work File - scheduled quantities by order</li>
        <li><strong>OPBFCPP:</strong> Order Header - header status, billing activity type, requested delivery date</li>
        <li><strong>PPBGCPP:</strong> Pick File Detail - picked quantities by PFS transaction</li>
        <li><strong>PMAECPP:</strong> Transfer/Staging File - in-transit quantities</li>
        <li><strong>PDKMREP:</strong> System Values - retrieves FZNCHLTME (frozen chilling time)</li>
    </ul>

    <h3>2.2 Optional Inputs</h3>
    <table>
        <thead>
            <tr><th>Field</th><th>Description</th><th>Conditional Usage</th></tr>
        </thead>
        <tbody>
            <tr><td>PAR.Application_Code</td><td>Application identifier</td><td>Parameter for screen heading setup (defaults to 'I/C')</td></tr>
            <tr><td>PAR.Catch_Weight_Status</td><td>Catch weight indicator</td><td>Displays catch weight condition description</td></tr>
            <tr><td>PAR.Select_Option</td><td>Production calc mode</td><td>Controls production quantity calculation (Blank=W/O Rework-PRD, 1=W/ Rework-All, 2=W/ Rework & Adj)</td></tr>
            <tr><td>PAR.Shift_Number</td><td>Shift identifier</td><td>Filters production quantities by specific shift if entered</td></tr>
            <tr><td>PAR.*Initial_call</td><td>First-time call flag</td><td>Controls navigation to/from Item Orders display (PDO7DFR)</td></tr>
            <tr><td>WRK.Status_Flag_4_Y_N</td><td>Display mode toggle</td><td>Y=display weights, N=display quantities (toggled by F13)</td></tr>
            <tr><td>JOB.*Job_date</td><td>Current job date</td><td>Used as cutoff date for open order retrieval</td></tr>
        </tbody>
    </table>
</div>


<div class="section" id="structure">
    <h2>3. Structure Overview and Components</h2>

    <h3>Component Organization</h3>
    <table>
        <thead>
            <tr><th>Category</th><th>Functions</th><th>Purpose</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>User Source Functions (Embedded RPG)</td>
                <td>3 (CLC, MOV, SFL)</td>
                <td>User-written RPG code embedded in Action Diagram: CLC centers text strings, MOV moves application description to company heading, SFL configures subfile fold/drop behavior</td>
            </tr>
            <tr>
                <td>Internal Functions</td>
                <td>25+ EXCINTFUN calls</td>
                <td>Reusable internal functions for validation, heading setup, chilling time retrieval, age information validation, inventory age calculations</td>
            </tr>
            <tr>
                <td>Database Retrieval Functions</td>
                <td>15+ RTVOBJ calls</td>
                <td>Retrieve operations for company, warehouse, item, order, transaction, and inventory data</td>
            </tr>
            <tr>
                <td>External Program Calls</td>
                <td>8 external programs</td>
                <td>Age code calculation (PNO6XFR), text centering (PDYJUFR), heading move (PDYKUFR), subfile control (POBHUFU/POBKUFR), age validation (PNQNXFR), item orders display (PDO7DFR)</td>
            </tr>
            <tr>
                <td>Array Management</td>
                <td>Date_for_Qty_Sche array</td>
                <td>Creates, deletes, updates array tracking scheduled quantities by label date for aging analysis</td></tr>
        </tbody>
    </table>

    <h3>Program Call Tree Structure</h3>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Main[ICQ9DFR Main<br/>Initialize Program] --> InitScreen[Initialize Screen<br/>VAL Rtv and Center Hdg IF]
    InitScreen --> SetHeading[SET Screen Headings IF]
    SetHeading --> RtvAppGrp[RTV Applic Group Desc RT<br/>CADNREP]
    RtvAppGrp --> CenterText[CLC Center Txt Str 40 US<br/>PDYJUFR - Center heading]
    CenterText --> MoveDesc[MOV Appl Desc-Co Head US<br/>PDYKUFR - Move to heading]

    Main --> InitFlags[Initialize Flags<br/>First Time=Y, Toggle=N]
    Main --> ConfigSFL[SFL Fold/Drop RPG US<br/>POBHUFU - Subfile config]

    Main --> BuildArray[Build Label Date Array<br/>Del/Rtv/Crt Date_for_Qty_Sche]
    BuildArray --> RtvLabelDates[Rtv Bld Label Dt Array RT<br/>CAB1REP - On-hand by date]

    Main --> CalcScheduled[Calculate Scheduled Qty<br/>Rtv Sched Qty/Label Dt RT<br/>OPBGWKP]
    CalcScheduled --> ValidateAge[Val Age Information IF<br/>PNQNXFR - Validate dates]
    CalcScheduled --> UpdateArray[Upd Sched Qtys by Age RT<br/>Update array quantities]

    Main --> RetrieveData[Retrieve Master Data]
    RetrieveData --> CompanyName[RTV Company Name RT<br/>CAABREP]
    RetrieveData --> WhsInfo[RTV Desc/Type/LotTrk RT<br/>CAADREP]
    RetrieveData --> ChillTime[Rtv Chilling Time IF<br/>CABZREP/PDKMREP]
    RetrieveData --> OnHandQty[RTV On Hand Qty RT<br/>CAB0REP]
    RetrieveData --> OpenOrders[RTV Itm Inq-Opn Ords RT<br/>OPBGWKP]
    RetrieveData --> AgedInv[Rtv Current/Aged Inv RT<br/>CAB1REP + PNO6XFR]

    Main --> CalcDiff[Calculate Inv/Ord Diff<br/>OnHand - Open Orders]

    Main --> ToggleCheck{CF13 Pressed?<br/>Toggle Qty/Wgt}
    ToggleCheck -->|Yes| CalcWeights[Calculate Weights<br/>Rtv Current/Aged Wgt RT<br/>Rtv ItmInq-OpnOrds,Wgt RT]
    ToggleCheck -->|No| DisplayQty[Display Quantities]

    Main --> PickedQty[Rtv Picked Qty Tot RT<br/>PPBGCPP]
    Main --> InTransit[Rtv InTransit Qty RT<br/>PMAECPP]

    Main --> SubfileInit[Initialize Subfile Record]
    SubfileInit --> ModeCheck{Check Calc Mode<br/>CF10/11/12}
    ModeCheck --> ProdQty[Rtv Tran qty by Trn Typ RT<br/>CAB7CPP - Shift 1 & 2]
    ProdQty --> AgeCalc[CLC Age Code #ofDays XF<br/>PNO6XFR]
    SubfileInit --> OrderQty[Rtv Order Age Quantity RT<br/>Array lookup]
    SubfileInit --> DateConvert[CNV cyymmdd to yyyymmdd IF]
    SubfileInit --> PickedDetail[Rtv Picked Qty RT<br/>PPBGCPP by date]
    SubfileInit --> CalcAvail[Calculate Available<br/>OnHand - Picked]

    SubfileInit --> WeightCheck{Display Weights?}
    WeightCheck -->|Yes| ProdWeight[Rtv Tran Wgt by Trn Typ RT<br/>CAB7CPP - Shift 1 & 2]
    WeightCheck --> EstWeight[Estimate Committed Wgt<br/>Qty * Conversion Factor]

    Main --> SFLMode[SFL Fold/Drop RPG 2 US<br/>POBKUFR - Set fold mode]

    Main --> PreConfirm{Pre-confirm Check<br/>CF10/11/12/13?}
    PreConfirm -->|Yes| ReloadSFL[Reload Subfile<br/>Set reload flag]

    Main --> CmdKeys{Process Command Keys}
    CmdKeys -->|CF14| ItemOrders[Call Zzz Item Orders DF<br/>PDO7DFR]
    CmdKeys -->|CF03| Exit[Exit Program<br/>Return code Y2U9999]

    style Main fill:#2e8b57,stroke:#1e5d3a,color:#fff
    style InitScreen fill:#3498db,stroke:#2980b9,color:#fff
    style BuildArray fill:#e67e22,stroke:#d35400,color:#fff
    style CalcScheduled fill:#e67e22,stroke:#d35400,color:#fff
    style RetrieveData fill:#9b59b6,stroke:#8e44ad,color:#fff
    style SubfileInit fill:#16a085,stroke:#138d75,color:#fff
        </pre>
    </div>
    <p><em>Complete program flow showing initialization, array building, data retrieval, calculations, subfile processing, and command key handling</em></p>
</div>


<div class="section" id="logic-summary">
    <h2>4. Business Logic Summary</h2>

    <h3>Primary Business Workflow</h3>
    <p>ICQ9DFR follows a comprehensive inquiry display workflow with sophisticated calculations and multiple display modes:</p>

    <ol>
        <li><strong>Screen Initialization (Lines 6-111):</strong>
            <ul>
                <li>Executes VAL Rtv and Center Hdg IF to set application code heading ('I/C')</li>
                <li>Retrieves and centers application description from CADNREP</li>
                <li>Calls CLC (PDYJUFR) to center 40-character text string for display</li>
                <li>Calls MOV (PDYKUFR) to move centered description to company heading</li>
                <li>Initializes flags: First Time=Y, Toggle=N (display quantities by default)</li>
                <li>Configures subfile with fold/drop capability via SFL function (POBHUFU)</li>
            </ul>
        </li>

        <li><strong>Label Date Array Building (Lines 185-226):</strong>
            <ul>
                <li>Deletes existing Date_for_Qty_Sche array</li>
                <li>Retrieves all label dates from CAB1REP where Quantity_on_Hand_Weight > 0</li>
                <li>Creates array entries for each unique label date with quantity initialized to zero</li>
                <li>Captures first label date in PAR.First_Label_Date_USR for display reference</li>
            </ul>
        </li>

        <li><strong>Scheduled Quantity Calculation (Lines 236-505):</strong>
            <ul>
                <li>Retrieves open orders from OPBGWKP (Order Detail Work File)</li>
                <li>Filters for invoice/transfer orders (Billing Activity Type = 1 or 4)</li>
                <li>Validates age information via PNQNXFR for Seaboard company orders</li>
                <li>Calculates production age dates by subtracting age days from scheduled ship date</li>
                <li>Updates array quantities by matching calculated age date to label dates</li>
                <li>Only includes orders with scheduled ship date >= label date (not past due)</li>
            </ul>
        </li>

        <li><strong>Master Data Retrieval (Lines 509-753):</strong>
            <ul>
                <li><strong>Company:</strong> RTV Company Name from CAABREP</li>
                <li><strong>Warehouse:</strong> Description, Type, Lot Tracking from CAADREP</li>
                <li><strong>Chilling Time:</strong> Retrieves fresh chilling time from CABZREP, adjusts for frozen warehouse from PDKMREP (FZNCHLTME system value)</li>
                <li><strong>On-Hand Quantity:</strong> Sums On_Hand_UOM1_Summary from CAB0REP</li>
                <li><strong>Open Orders:</strong> Sums Quantity_Scheduled from OPBGWKP for non-completed orders (status L/A/E/H)</li>
                <li><strong>Current/Aged Inventory:</strong> Calls PNO6XFR to calculate days-to-age, classifies as Aged if >= 7 days</li>
                <li><strong>Inventory/Order Difference:</strong> Calculates On-Hand minus Open Orders</li>
            </ul>
        </li>

        <li><strong>Quantity/Weight Toggle Processing (Lines 757-984):</strong>
            <ul>
                <li><strong>CF13 Pressed:</strong> Toggles WRK.Status_Flag_4_Y_N between Y (weights) and N (quantities)</li>
                <li><strong>Quantity Mode (N):</strong> Displays quantities directly from database fields</li>
                <li><strong>Weight Mode (Y):</strong>
                    <ul>
                        <li>Retrieves actual weights from CAB1REP (Quantity_on_Hand_Weight)</li>
                        <li>Calls PNO6XFR to calculate aging, sums into Current (< 7 days) and Aged (>= 7 days)</li>
                        <li>Retrieves scheduled weights from OPBGWKP</li>
                        <li>Calculates Inv/Ord Difference using weight fields</li>
                        <li>Note: Weight fields truncate decimals without rounding when moved to integer screen fields</li>
                    </ul>
                </li>
                <li>Updates toggle text fields: "Qty" or "Wgt" for all four display columns</li>
            </ul>
        </li>

        <li><strong>Additional Metrics Retrieval (Lines 986-1041):</strong>
            <ul>
                <li><strong>Picked Quantity:</strong> Sums PFS_Transaction_Quantity from PPBGCPP for transaction types S01 (Ship Regular) and S02 (Transfer), subtracts other types</li>
                <li><strong>Transfer/Staging:</strong> Counts in-transit items from PMAECPP</li>
            </ul>
        </li>

        <li><strong>Subfile Record Initialization (Lines 1043-1978):</strong>
            <ul>
                <li>Skips records where Quantity_on_Hand_Weight = 0</li>
                <li><strong>Calculation Mode Selection (CF10/11/12):</strong>
                    <ul>
                        <li>CF10: "W/O Rework-PRD" - Production only (transaction type RR, reason codes PRD or RWZ)</li>
                        <li>CF11: "W/ Rework-All" - All receipt production (transaction type RR)</li>
                        <li>CF12: "W/ Rework & Adj" - Production and adjustments (types RR and A)</li>
                    </ul>
                </li>
                <li>Retrieves production quantities by shift (Shift 1 & 2) from CAB7CPP based on selected mode</li>
                <li>Calls PNO6XFR to calculate @Number_of_Days_to_Age for each production date</li>
                <li>Retrieves scheduled quantities from Date_for_Qty_Sche array by label date</li>
                <li>Converts label date from CYYMMDD to YYYYMMDD format</li>
                <li>Retrieves picked quantities for specific label date from PPBGCPP</li>
                <li>Calculates Available = On-Hand - Picked</li>
                <li><strong>If Weight Mode:</strong>
                    <ul>
                        <li>Retrieves production weights by shift from CAB7CPP</li>
                        <li>Estimates committed weight = Quantity_Ordered * Conversion_Factor (rounded)</li>
                        <li>Retrieves picked weight for label date</li>
                        <li>Recalculates Available using weight values</li>
                    </ul>
                </li>
            </ul>
        </li>

        <li><strong>Subfile Display Configuration (Lines 1980-2015):</strong>
            <ul>
                <li>Calls SFL Fold/Drop RPG 2 US (POBKUFR) to set fold mode based on MODE field</li>
                <li>Pre-confirm processing: If CF10/11/12/13 pressed, sets reload flag and resets first-time flag to reload subfile with new calculation mode</li>
            </ul>
        </li>

        <li><strong>Command Key Processing (Lines 2017-2065):</strong>
            <ul>
                <li><strong>CF14:</strong> Navigates to Item Orders display (PDO7DFR) passing company, item, warehouse, and initial call flag</li>
                <li><strong>CF03:</strong> Exits program with return code 'Y2U9999'</li>
            </ul>
        </li>
    </ol>

    <h3>Key Decision Points</h3>
    <ul>
        <li><strong>Age Classification:</strong> Items with @Number_of_Days_to_Age >= 7 are classified as "Aged", otherwise "Current"</li>
        <li><strong>Order Inclusion:</strong> Only orders with header status L/A/E/H (not completed/cancelled/confirmed) and billing activity type 1/4 (invoice/transfer) are included in scheduled quantities</li>
        <li><strong>Scheduled Quantity Date Matching:</strong> Scheduled quantities only added to label dates where calculated production age date <= scheduled ship date</li>
        <li><strong>Zero Quantity Exclusion:</strong> Subfile records excluded if Quantity_on_Hand_Weight = 0</li>
        <li><strong>Shift Filtering:</strong> If PAR.Shift_Number entered, production quantities filtered to specific shift; otherwise all shifts included</li>
        <li><strong>Production Reason Code Filtering:</strong> In "W/O Rework-PRD" mode, only includes reason codes PRD (Production from Accu-Sort) and RWZ (Freezer Transfer)</li>
    </ul>
</div>


<div class="section" id="logic-flow">
    <h2>5. Detailed Logic Flow and Process Diagrams</h2>

    <h3>Business Process Flow Diagram</h3>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Start([ICQ9DFR Start]) --> InitScreen[Initialize Screen<br/>Set Headings & Center Text]
    InitScreen --> InitFlags[Initialize Control Flags<br/>FirstTime=Y, Toggle=N]
    InitFlags --> ConfigSFL[Configure Subfile<br/>SFLDROP CF07]

    ConfigSFL --> DelArray[Delete Date_for_Qty_Sche Array]
    DelArray --> BuildArray[Build Label Date Array<br/>From CAB1REP where Qty>0]

    BuildArray --> CalcScheduled[Calculate Scheduled Quantities<br/>From OPBGWKP]
    CalcScheduled --> CheckOrderType{Order Type?<br/>Invoice/Transfer?}
    CheckOrderType -->|Yes| ValidateAge[Validate Age Information<br/>PNQNXFR]
    CheckOrderType -->|No| SkipOrder[Skip Order]
    ValidateAge --> CalcProdDate[Calculate Production Date<br/>Ship Date - Age Days]
    CalcProdDate --> UpdateArray[Update Array<br/>Add Qty to Matching Label Date]

    UpdateArray --> RetrieveMaster[Retrieve Master Data<br/>Company, Warehouse, Item]
    RetrieveMaster --> GetChillTime[Get Chilling Time<br/>CABZREP/PDKMREP]
    GetChillTime --> GetOnHand[Get On-Hand Quantity<br/>CAB0REP Summary]
    GetOnHand --> GetOpenOrders[Get Open Orders<br/>OPBGWKP where Status L/A/E/H]
    GetOpenOrders --> CalcAged[Calculate Current/Aged<br/>CAB1REP + PNO6XFR]

    CalcAged --> CalcDiff[Calculate Inv/Ord Difference<br/>OnHand - Open]

    CalcDiff --> CheckToggle{CF13 Toggle?<br/>Qty or Wgt Mode?}
    CheckToggle -->|Qty Mode| DisplayQty[Display Quantities<br/>Toggle Text = Qty]
    CheckToggle -->|Wgt Mode| CalcWeights[Calculate Weights<br/>From CAB1REP/OPBGWKP]
    CalcWeights --> DisplayWgt[Display Weights<br/>Toggle Text = Wgt]

    DisplayQty --> GetPicked[Get Picked Quantities<br/>PPBGCPP Total]
    DisplayWgt --> GetPicked
    GetPicked --> GetTransfer[Get Transfer/Staging<br/>PMAECPP Count]

    GetTransfer --> InitSubfile[Initialize Subfile Records<br/>From CAB1REP Detail]
    InitSubfile --> CheckZero{Qty On-Hand<br/>Weight = 0?}
    CheckZero -->|Yes| SkipRecord[Skip Record]
    CheckZero -->|No| CheckCalcMode{Check Calc Mode<br/>CF10/11/12}

    CheckCalcMode -->|CF10| Mode1[W/O Rework-PRD<br/>RR: PRD/RWZ only]
    CheckCalcMode -->|CF11| Mode2[W/ Rework-All<br/>RR: All reasons]
    CheckCalcMode -->|CF12| Mode3[W/ Rework & Adj<br/>RR + A types]
    CheckCalcMode -->|Default| Mode1

    Mode1 --> GetProdQty[Get Production Qty<br/>Shift 1 & 2 from CAB7CPP]
    Mode2 --> GetProdQty
    Mode3 --> GetProdQty

    GetProdQty --> CalcAge[Calculate Age Days<br/>PNO6XFR]
    CalcAge --> GetArrayQty[Get Scheduled Qty<br/>From Array by Label Date]
    GetArrayQty --> ConvertDate[Convert Date<br/>CYYMMDD to YYYYMMDD]
    ConvertDate --> GetPickedDetail[Get Picked by Date<br/>PPBGCPP]
    GetPickedDetail --> CalcAvail[Calculate Available<br/>OnHand - Picked]

    CalcAvail --> WeightCheck{Display<br/>Weights?}
    WeightCheck -->|Yes| GetProdWgt[Get Production Weight<br/>Shift 1 & 2]
    WeightCheck -->|No| AddRecord[Add Subfile Record]
    GetProdWgt --> EstCommitted[Estimate Committed Wgt<br/>Qty * Conversion Factor]
    EstCommitted --> AddRecord

    AddRecord --> MoreRecords{More<br/>Records?}
    MoreRecords -->|Yes| InitSubfile
    MoreRecords -->|No| SetFoldMode[Set Fold/Drop Mode<br/>POBKUFR]

    SetFoldMode --> CheckReload{CF10/11/12/13<br/>Pressed?}
    CheckReload -->|Yes| ReloadSFL[Set Reload Flag<br/>Reset FirstTime=Y]
    CheckReload -->|No| ProcessCmdKeys{Process<br/>Command Keys}

    ReloadSFL --> DisplayScreen[Display Screen]
    DisplayScreen --> ProcessCmdKeys

    ProcessCmdKeys -->|CF14| CallOrders[Call Item Orders<br/>PDO7DFR]
    ProcessCmdKeys -->|CF03| ExitPgm[Exit Program<br/>Return Y2U9999]
    ProcessCmdKeys -->|Other| DisplayScreen

    CallOrders --> DisplayScreen
    ExitPgm --> End([Program End])

    style Start fill:#d4edda,stroke:#28a745,stroke-width:3px
    style End fill:#d1ecf1,stroke:#17a2b8,stroke-width:3px
    style BuildArray fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    style CalcScheduled fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    style RetrieveMaster fill:#e7d4f5,stroke:#9b59b6,stroke-width:2px
    style InitSubfile fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px
    style CheckCalcMode fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style CheckToggle fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
        </pre>
    </div>
    <p><em>Complete business process flow showing initialization, array building, scheduled quantity calculations, master data retrieval, subfile processing with multiple calculation modes, and command key handling</em></p>
</div>


<div class="section" id="data-interaction">
    <h2>6. Data Operations and Business Information Flow</h2>

    <h3>Database Access Patterns</h3>
    <p><strong>Access Mode:</strong> Read-Only (No updates, deletes, or creates to database files)</p>

    <table>
        <thead>
            <tr><th>File</th><th>Operation</th><th>Purpose</th><th>Key Fields</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>CADNREP</td>
                <td>Retrieve</td>
                <td>Application Group/Description for screen heading</td>
                <td>Application_Code</td>
            </tr>
            <tr>
                <td>CAABREP</td>
                <td>Retrieve</td>
                <td>Company Master - retrieves company name</td>
                <td>Company_Number</td>
            </tr>
            <tr>
                <td>CAADREP</td>
                <td>Retrieve</td>
                <td>Warehouse Master - description, type (FZ=Frozen), lot tracking</td>
                <td>Warehouse_Code</td>
            </tr>
            <tr>
                <td>CABZREP</td>
                <td>Retrieve</td>
                <td>Item Master Extended - fresh chilling time</td>
                <td>Company_Number + Item_Code</td>
            </tr>
            <tr>
                <td>PDKMREP</td>
                <td>Retrieve</td>
                <td>System Values - retrieves FZNCHLTME (frozen chilling time)</td>
                <td>Company_Number + 'FZNCHLTME'</td>
            </tr>
            <tr>
                <td>CAB0REP</td>
                <td>Retrieve (Multiple)</td>
                <td>Item Balance Summary - sums on-hand quantities, available to sell</td>
                <td>Company_Number + Item_Code + Warehouse_Code</td>
            </tr>
            <tr>
                <td>CAB1REP</td>
                <td>Retrieve (Multiple)</td>
                <td>Item Balance Detail - quantity/weight by production date & label date</td>
                <td>Company_Number + Item_Code + Warehouse_Code + Production_Date</td>
            </tr>
            <tr>
                <td>CAB7CPP</td>
                <td>Retrieve (Multiple)</td>
                <td>Inventory Transaction History - production quantities by shift, transaction type, reason code</td>
                <td>Company_Number + Item_Code + Warehouse_Code + Production_Date + Shift_Number</td>
            </tr>
            <tr>
                <td>OPBGWKP</td>
                <td>Retrieve (Multiple)</td>
                <td>Order Detail Work File - scheduled quantities by order, item, warehouse</td>
                <td>Company_Number + Item_Code + Warehouse_Code</td>
            </tr>
            <tr>
                <td>OPBFCPP</td>
                <td>Retrieve</td>
                <td>Order Header - header status, billing activity type, requested delivery date</td>
                <td>Company_Number + Order_Number</td>
            </tr>
            <tr>
                <td>PPBGCPP</td>
                <td>Retrieve (Multiple)</td>
                <td>Pick File Detail - picked quantities by transaction type (S01/S02)</td>
                <td>Company_Number + Warehouse_Code + Item_Code + Label_Date</td>
            </tr>
            <tr>
                <td>PMAECPP</td>
                <td>Retrieve (Multiple)</td>
                <td>Transfer/Staging File - counts in-transit items</td>
                <td>Warehouse_Code + Item_Code (converted to alpha)</td>
            </tr>
        </tbody>
    </table>

    <h3>Data Flow Pattern</h3>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart LR
    subgraph Master["Master Data Files"]
        CAABREP[CAABREP<br/>Company Master]
        CAADREP[CAADREP<br/>Warehouse Master]
        CABZREP[CABZREP<br/>Item Master]
        CADNREP[CADNREP<br/>Application Groups]
        PDKMREP[PDKMREP<br/>System Values]
    end

    subgraph Inventory["Inventory Files"]
        CAB0REP[CAB0REP<br/>Balance Summary]
        CAB1REP[CAB1REP<br/>Balance Detail]
        CAB7CPP[CAB7CPP<br/>Transaction History]
    end

    subgraph Orders["Order Files"]
        OPBGWKP[OPBGWKP<br/>Order Detail]
        OPBFCPP[OPBFCPP<br/>Order Header]
    end

    subgraph Warehouse["Warehouse Operations"]
        PPBGCPP[PPBGCPP<br/>Pick File]
        PMAECPP[PMAECPP<br/>Transfer/Staging]
    end

    Master --> Program[ICQ9DFR<br/>Display Program]
    Inventory --> Program
    Orders --> Program
    Warehouse --> Program

    Program --> Screen[Screen Display<br/>Inventory Inquiry Details]
    Program --> Array[Date_for_Qty_Sche<br/>Array Storage]

    style Program fill:#2e8b57,stroke:#1e5d3a,stroke-width:3px,color:#fff
    style Screen fill:#3498db,stroke:#2980b9,stroke-width:2px,color:#fff
    style Array fill:#e67e22,stroke:#d35400,stroke-width:2px,color:#fff
        </pre>
    </div>

    <h3>Array Management</h3>
    <p><strong>Date_for_Qty_Sche Array:</strong> Temporary array structure for tracking scheduled quantities by label date</p>
    <ul>
        <li><strong>Creation:</strong> Line 185 - Del Qty Sched for Age DL (deletes existing array)</li>
        <li><strong>Population:</strong> Lines 190-226 - Rtv Bld Label Dt Array RT creates entries for each label date with quantity > 0</li>
        <li><strong>Update:</strong> Lines 478-501 - Upd Sched Qtys by Age RT adds scheduled quantities to matching label dates</li>
        <li><strong>Retrieval:</strong> Lines 1493-1505 - Rtv Order Age Quantity RT retrieves scheduled quantity for specific label date</li>
        <li><strong>Structure:</strong>
            <ul>
                <li>DB1.Label_Date (key field)</li>
                <li>DB1.Quantity_Ordered (accumulated scheduled quantity)</li>
            </ul>
        </li>
    </ul>

    <h3>Key Calculations</h3>
    <table>
        <thead>
            <tr><th>Calculation</th><th>Formula</th><th>Business Rule</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>Inventory/Order Difference</td>
                <td>OnHand - OpenOrders</td>
                <td>Shows surplus (+) or shortage (-) inventory relative to commitments</td>
            </tr>
            <tr>
                <td>Available Inventory</td>
                <td>OnHand - Picked</td>
                <td>Actual available after subtracting picked quantities by label date</td>
            </tr>
            <tr>
                <td>Age Classification</td>
                <td>If Days >= 7 then Aged else Current</td>
                <td>PNO6XFR calculates days from production date to job date</td>
            </tr>
            <tr>
                <td>Production Age Date</td>
                <td>Scheduled_Ship_Date - Item_Age_Days</td>
                <td>Determines required production date for order fulfillment</td>
            </tr>
            <tr>
                <td>Estimated Committed Weight</td>
                <td>Quantity_Ordered * Conversion_Factor (rounded)</td>
                <td>Estimates weight commitment when actual weight not available</td>
            </tr>
            <tr>
                <td>Production Quantity by Mode</td>
                <td>Sum(Transaction_Quantity) filtered by mode</td>
                <td>CF10=PRD/RWZ only, CF11=all RR, CF12=RR+A types</td>
            </tr>
        </tbody>
    </table>
</div>


<div class="section" id="dependencies">
    <h2>7. System Dependencies and Business Relationships</h2>

    <h3>External Program Dependencies</h3>
    <table>
        <thead>
            <tr><th>Program</th><th>Type</th><th>Purpose</th><th>Call Location</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>PDYJUFR</td>
                <td>User Source (CLC)</td>
                <td>Centers 40-character text string for display headings</td>
                <td>Line 59 - Screen initialization</td>
            </tr>
            <tr>
                <td>PDYKUFR</td>
                <td>User Source (MOV)</td>
                <td>Moves application description to company heading field</td>
                <td>Line 84 - Screen initialization</td>
            </tr>
            <tr>
                <td>POBHUFU</td>
                <td>User Source (SFL)</td>
                <td>Configures subfile fold/drop behavior on CF07</td>
                <td>Line 103 - Subfile setup</td>
            </tr>
            <tr>
                <td>POBKUFR</td>
                <td>User Source (SFL)</td>
                <td>Sets subfile fold mode based on MODE field value</td>
                <td>Line 1981 - Subfile display</td>
            </tr>
            <tr>
                <td>PNO6XFR</td>
                <td>External Function</td>
                <td>Calculates age code and number of days to age from production date</td>
                <td>Lines 725, 841, 1486 - Age calculations</td>
            </tr>
            <tr>
                <td>PNQNXFR</td>
                <td>External Function</td>
                <td>Validates age information: production dates vs. requested delivery dates with chilling time</td>
                <td>Line 350 - Age validation for orders</td>
            </tr>
            <tr>
                <td>PDO7DFR</td>
                <td>Display Function</td>
                <td>Item Orders display - shows order details for item/warehouse</td>
                <td>Line 2038 - CF14 navigation</td>
            </tr>
        </tbody>
    </table>

    <h3>Internal Function Dependencies</h3>
    <ul>
        <li><strong>VAL Rtv and Center Hdg IF:</strong> Validates and retrieves centered application heading</li>
        <li><strong>SET Screen Headings IF:</strong> Sets up screen heading fields from application groups</li>
        <li><strong>FP1309 Inventory Age IF:</strong> FP1309 enhancement for inventory age code description</li>
        <li><strong>Rtv Chilling Time IF:</strong> Retrieves fresh chilling time, adjusts for frozen warehouse</li>
        <li><strong>Rtv Whs Typ/FZNCHLTME IF:</strong> Internal function to get warehouse type and frozen chilling time</li>
        <li><strong>Val Age Information IF:</strong> Validates production age dates against delivery requirements</li>
        <li><strong>CNV cyymmdd to yyyymmdd IF:</strong> Date conversion from century format to 4-digit year format</li>
    </ul>

    <h3>Database File Dependencies</h3>
    <p><strong>Critical Files (Without these, program cannot function):</strong></p>
    <ul>
        <li><strong>CAB1REP:</strong> Item Balance Detail - Core file for inventory by production/label date</li>
        <li><strong>CAB0REP:</strong> Item Balance Summary - On-hand quantity summaries</li>
        <li><strong>OPBGWKP:</strong> Order Detail Work File - Scheduled quantities and order data</li>
        <li><strong>OPBFCPP:</strong> Order Header - Order status and billing activity validation</li>
    </ul>

    <p><strong>Supporting Files (Program degrades gracefully if unavailable):</strong></p>
    <ul>
        <li><strong>CAABREP, CAADREP:</strong> Company/warehouse names display as blank</li>
        <li><strong>CABZREP, PDKMREP:</strong> Chilling time defaults to zero</li>
        <li><strong>PPBGCPP:</strong> Picked quantities show as zero, available = on-hand</li>
        <li><strong>PMAECPP:</strong> Transfer/staging count shows as zero</li>
        <li><strong>CAB7CPP:</strong> Production quantities show as zero in subfile</li>
    </ul>

    <h3>System Integration Points</h3>
    <ul>
        <li><strong>Inventory Management System:</strong> Reads real-time inventory balances, transaction history</li>
        <li><strong>Order Processing System:</strong> Accesses order details, scheduled ship dates, requested delivery dates</li>
        <li><strong>Warehouse Management System:</strong> Retrieves pick file data, transfer/staging information</li>
        <li><strong>Production System:</strong> Accesses production transaction history by shift and reason code</li>
        <li><strong>System Configuration:</strong> Uses system values (FZNCHLTME) for frozen warehouse chilling time</li>
    </ul>

    <h3>Business Process Dependencies</h3>
    <ul>
        <li><strong>Upstream Process:</strong> Production receipts must be recorded in CAB7CPP with correct shift, transaction type, and reason codes</li>
        <li><strong>Upstream Process:</strong> Inventory balance updates must maintain accurate production dates and label dates in CAB1REP</li>
        <li><strong>Upstream Process:</strong> Order entry must record scheduled ship dates, requested delivery dates, and item age days in OPBGWKP/OPBFCPP</li>
        <li><strong>Upstream Process:</strong> Picking operations must record PFS transactions in PPBGCPP with correct label dates</li>
        <li><strong>Downstream Process:</strong> Users may navigate to Item Orders display (PDO7DFR) for detailed order information</li>
        <li><strong>Downstream Process:</strong> Inventory planners use displayed information to make production scheduling decisions</li>
        <li><strong>Downstream Process:</strong> Warehouse managers use availability data to determine picking priorities</li>
    </ul>

    <h3>Modernization Considerations</h3>
    <p><strong>Complexity Assessment:</strong> Moderate to High</p>

    <ul>
        <li><strong>Strengths for Migration:</strong>
            <ul>
                <li>Read-only display program - no database updates to synchronize</li>
                <li>Well-structured with clear separation: initialization, data retrieval, calculations, display</li>
                <li>Business logic concentrated in calculation routines (easy to extract)</li>
                <li>External program calls clearly documented with parameters</li>
            </ul>
        </li>

        <li><strong>Migration Challenges:</strong>
            <ul>
                <li>Complex aging calculation logic across multiple production dates</li>
                <li>Array management for Date_for_Qty_Sche requires equivalent data structure</li>
                <li>Multiple display modes (qty/wgt toggle, calculation modes) need UI framework support</li>
                <li>Embedded RPG code (CLC, MOV, SFL) requires translation or reimplementation</li>
                <li>Dependencies on external age calculation program (PNO6XFR) must be migrated simultaneously</li>
                <li>Date conversion logic (CYYMMDD to YYYYMMDD) needs careful validation</li>
                <li>Weight calculation with decimal truncation (not rounding) must be preserved exactly</li>
            </ul>
        </li>

        <li><strong>Recommended Approach:</strong>
            <ul>
                <li><strong>Phase 1:</strong> Migrate database read functions to modern ORM or data access layer</li>
                <li><strong>Phase 2:</strong> Reimplement aging calculation logic with comprehensive unit tests</li>
                <li><strong>Phase 3:</strong> Build web UI with toggle modes, fold/drop equivalent (expand/collapse)</li>
                <li><strong>Phase 4:</strong> Migrate external dependencies (PNO6XFR age calculator)</li>
                <li><strong>Phase 5:</strong> Parallel testing with legacy system for data accuracy validation</li>
                <li><strong>Testing Focus:</strong> Age classification edge cases, weight vs. quantity toggle accuracy, scheduled quantity date matching</li>
            </ul>
        </li>

        <li><strong>Business Impact:</strong>
            <ul>
                <li><strong>High:</strong> Critical inquiry for daily operations, used by multiple user groups</li>
                <li><strong>Risk:</strong> Aging calculations must be exactly accurate for compliance and customer commitments</li>
                <li><strong>Opportunity:</strong> Modern UI could add real-time refresh, drill-down capabilities, export to Excel</li>
            </ul>
        </li>
    </ul>
</div>


<!-- SECTION 8: FUNCTIONS -->
<div class="section" id="functions">
    <h2>8. Detailed Business Functions Analysis</h2>
    <p>Complete 4-part analysis for all 3 functions with Mermaid diagrams.</p>

<div class="function-analysis" id="func-1">
    <div class="function-header">
        <h3>F001: CLC Center Txt Str 40 US - Text Formatting Function</h3>
        <div style="margin-top: 10px;">
            <span style="background: #3498db; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em;">
                Priority: Medium
            </span>
            <span style="background: #28a745; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em; margin-left: 10px;">
                COMPLETE
            </span>
        </div>
    </div>

    <h4>1. Parameters and Business Data Elements</h4>
    <p>The CLC function centers text strings within a 40-character field for screen display headings.</p>

    <p><strong>Source Location:</strong> Lines 59-81</p>
    <p><strong>External Program:</strong> PDYJUFR (User Source RPG)</p>

    <table>
        <thead>
            <tr><th>Parameter</th><th>Direction</th><th>Description</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>WRK.USR_Description_40</td>
                <td>Input</td>
                <td>40-character text string to be centered (application description)</td>
            </tr>
            <tr>
                <td>WRK.USR_Description_40_2</td>
                <td>Output</td>
                <td>Centered 40-character string with leading blanks for display</td>
            </tr>
        </tbody>
    </table>

    <h4>2. Business Logic Summary</h4>
    <ul>
        <li><strong>Primary Business Workflow:</strong> Centers text by calculating trailing spaces and redistributing as leading spaces</li>
        <li><strong>Key Decision Points:</strong> Loops from right to left finding first non-blank character to determine text length</li>
        <li><strong>Exception Management:</strong> If text is already 40 characters (no trailing spaces), returns unchanged</li>
    </ul>

    <h4>3. Detailed Logic Explanation and Business Process Flow</h4>
    <p><strong>Embedded RPG Code Analysis:</strong></p>

    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #0066cc;">
E                    UCT        40  1               CENTER TABLE
C                     MOVEA#IDSC4    UCT              LOAD ARRAY
C                     Z-ADD40        UX      20       SET COUNTER
C           UX        DOWGT0
C           UCT,UX    IFEQ ' '
C                     SUB  1         UX
C                     ELSE
C                     Z-ADDUX        UXH     20
C                     Z-ADD0         UX
C                     END
C                     END
C           40        SUB  UXH       UX
C           UX        DIV  2         UX
C           UX        IFGT 0
C                     MOVE *BLANKS   UCT
C                     MOVEA#IDSC4    UCT,UX
C                     END
C                     MOVEAUCT       #ODE40           LOAD OUTPUT
    </pre>

    <p><strong>Step-by-Step Process:</strong></p>
    <ol>
        <li><strong>Load Input:</strong> Input string #IDSC4 (40 chars) loaded into array UCT</li>
        <li><strong>Find Text End:</strong> Loop from position 40 down to 1, finding first non-blank character</li>
        <li><strong>Calculate Length:</strong> UXH stores position of last non-blank character</li>
        <li><strong>Calculate Padding:</strong> UX = (40 - UXH) / 2 (integer division for leading spaces)</li>
        <li><strong>Center Text:</strong> If UX > 0, clear UCT to blanks, move original text starting at position UX</li>
        <li><strong>Output Result:</strong> Centered text moved to output parameter #ODE40</li>
    </ol>

    <p><strong>Business Purpose:</strong> Creates visually centered screen headings for professional display appearance. Used to center application description "I/C" in company heading area.</p>

    <h4>Business Process Flow Diagram (Mermaid):</h4>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Start([CLC Start<br/>PDYJUFR]) --> LoadInput[Load Input String<br/>into UCT Array 40 chars]
    LoadInput --> InitCounter[Set Counter UX = 40<br/>Start from right]

    InitCounter --> Loop{Counter UX > 0?}
    Loop -->|Yes| CheckBlank{UCT,UX<br/>= Blank?}
    CheckBlank -->|Yes| Decrement[Subtract 1 from UX<br/>Move left one position]
    Decrement --> Loop

    CheckBlank -->|No| FoundEnd[Found Last Non-Blank<br/>UXH = UX position]
    FoundEnd --> SetZero[Set UX = 0<br/>Exit loop]
    SetZero --> CalcPad

    Loop -->|No| CalcPad[Calculate Padding<br/>UX = 40 - UXH / 2]

    CalcPad --> CheckPad{UX > 0?}
    CheckPad -->|Yes| ClearField[Clear UCT to Blanks]
    ClearField --> MoveText[Move Original Text<br/>Starting at Position UX]
    MoveText --> Output[Output Centered Text<br/>to #ODE40]

    CheckPad -->|No| Output
    Output --> End([CLC End])

    style Start fill:#d4edda,stroke:#28a745,stroke-width:2px
    style End fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px
    style Loop fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style CheckBlank fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style CheckPad fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style ClearField fill:#e7d4f5,stroke:#9b59b6
    style MoveText fill:#e7d4f5,stroke:#9b59b6
        </pre>
    </div>

    <h4>4. Data Interaction and Business Information Management</h4>
    <p><strong>Data Operations:</strong></p>
    <ul>
        <li><strong>Input:</strong> WRK.USR_Description_40 (application description from CADNREP)</li>
        <li><strong>Processing:</strong> Array manipulation in UCT (40-character array), integer calculations for padding</li>
        <li><strong>Output:</strong> WRK.USR_Description_40_2 (centered text for screen heading)</li>
        <li><strong>No Database Access:</strong> Pure string manipulation function</li>
    </ul>

    <p><strong>Usage Context:</strong> Called during screen initialization (line 59) to center the application group description ("I/C") for display in the company heading area. Result is then passed to MOV function (PDYKUFR) for final placement in heading field.</p>
</div>

<div class="function-analysis" id="func-2">
    <div class="function-header">
        <h3>F002: MOV Appl Desc-Co Head US - Field Move Function</h3>
        <div style="margin-top: 10px;">
            <span style="background: #3498db; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em;">
                Priority: Medium
            </span>
            <span style="background: #28a745; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em; margin-left: 10px;">
                COMPLETE
            </span>
        </div>
    </div>

    <h4>1. Parameters and Business Data Elements</h4>
    <p>The MOV function moves the centered application description to the company heading field for screen display.</p>

    <p><strong>Source Location:</strong> Lines 84-88</p>
    <p><strong>External Program:</strong> PDYKUFR (User Source RPG)</p>

    <table>
        <thead>
            <tr><th>Parameter</th><th>Direction</th><th>Description</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>WRK.USR_Description_40_2</td>
                <td>Input</td>
                <td>Centered 40-character application description (output from CLC function)</td>
            </tr>
            <tr>
                <td>##CMP (implied)</td>
                <td>Output</td>
                <td>Company heading field on display screen</td>
            </tr>
        </tbody>
    </table>

    <h4>2. Business Logic Summary</h4>
    <ul>
        <li><strong>Primary Business Workflow:</strong> Simple field-to-field move operation to place centered text in heading</li>
        <li><strong>Key Decision Points:</strong> None - direct assignment operation</li>
        <li><strong>Exception Management:</strong> No error handling - straightforward data move</li>
    </ul>

    <h4>3. Detailed Logic Explanation and Business Process Flow</h4>
    <p><strong>Embedded RPG Code Analysis:</strong></p>

    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #0066cc;">
C                     MOVE #IDE40    ##CMP
    </pre>

    <p><strong>Step-by-Step Process:</strong></p>
    <ol>
        <li><strong>Receive Input:</strong> #IDE40 parameter contains centered 40-character text from CLC function</li>
        <li><strong>Move to Heading:</strong> MOVE operation copies centered text to ##CMP (company heading display field)</li>
        <li><strong>Complete:</strong> Heading field now contains centered application description for screen display</li>
    </ol>

    <p><strong>Business Purpose:</strong> Final step in screen heading initialization. Places the centered application group description ("I/C") into the company heading area of the display screen. This provides context to users about which application module they are viewing.</p>

    <h4>Business Process Flow Diagram (Mermaid):</h4>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Start([MOV Start<br/>PDYKUFR]) --> ReceiveInput[Receive Centered Text<br/>from #IDE40 parameter]
    ReceiveInput --> MoveField[MOVE #IDE40 to ##CMP<br/>Copy 40 characters]
    MoveField --> Complete[Company Heading Updated<br/>Centered text displayed]
    Complete --> End([MOV End])

    style Start fill:#d4edda,stroke:#28a745,stroke-width:2px
    style End fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px
    style MoveField fill:#e7d4f5,stroke:#9b59b6,stroke-width:2px
    style Complete fill:#d4edda,stroke:#28a745
        </pre>
    </div>

    <h4>4. Data Interaction and Business Information Management</h4>
    <p><strong>Data Operations:</strong></p>
    <ul>
        <li><strong>Input:</strong> WRK.USR_Description_40_2 (#IDE40) - Centered text from CLC function</li>
        <li><strong>Processing:</strong> Simple MOVE operation (right-to-left field copy in RPG)</li>
        <li><strong>Output:</strong> ##CMP display field - Company heading on screen</li>
        <li><strong>No Database Access:</strong> Pure field move operation, no file I/O</li>
    </ul>

    <p><strong>Usage Context:</strong> Called immediately after CLC function (line 84) to complete the heading setup sequence. Works in conjunction with CLC to create professional-looking centered headings:
        <ol>
            <li>Application description retrieved from CADNREP</li>
            <li>CLC centers the text within 40 characters</li>
            <li>MOV places centered text in display heading field</li>
        </ol>
    </p>
</div>

<div class="function-analysis" id="func-3">
    <div class="function-header">
        <h3>F003: SFL Fold/Drop RPG US - Subfile Control Function</h3>
        <div style="margin-top: 10px;">
            <span style="background: #3498db; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em;">
                Priority: Medium
            </span>
            <span style="background: #28a745; color: white; padding: 5px 12px; border-radius: 4px; font-size: 0.9em; margin-left: 10px;">
                COMPLETE
            </span>
        </div>
    </div>

    <h4>1. Parameters and Business Data Elements</h4>
    <p>The SFL function configures subfile display characteristics for fold/drop behavior activated by CF07 function key.</p>

    <p><strong>Source Location:</strong> Lines 103-110 (first call - POBHUFU), Lines 1981-1988 (second call - POBKUFR)</p>
    <p><strong>External Programs:</strong> POBHUFU (initial setup), POBKUFR (mode control)</p>

    <h4>First Call - POBHUFU (Line 103):</h4>
    <table>
        <thead>
            <tr><th>Parameter</th><th>Value</th><th>Description</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>Parameter 1</td>
                <td>6</td>
                <td>Configuration parameter (likely line position or mode indicator)</td>
            </tr>
        </tbody>
    </table>

    <h4>Second Call - POBKUFR (Line 1981):</h4>
    <table>
        <thead>
            <tr><th>Parameter</th><th>Direction</th><th>Description</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>MODE field</td>
                <td>Input</td>
                <td>Mode indicator ('0' = folded, other = expanded)</td>
            </tr>
            <tr>
                <td>Indicator 89</td>
                <td>Output</td>
                <td>Controls fold/drop display state</td>
            </tr>
        </tbody>
    </table>

    <h4>2. Business Logic Summary</h4>
    <ul>
        <li><strong>Primary Business Workflow:</strong> Configures subfile to allow users to toggle between folded (compact) and dropped (expanded) views using CF07</li>
        <li><strong>Key Decision Points:</strong> MODE field value determines whether indicator 89 is set ON (folded) or OFF (dropped)</li>
        <li><strong>Exception Management:</strong> None - simple indicator management</li>
    </ul>

    <h4>3. Detailed Logic Explanation and Business Process Flow</h4>

    <p><strong>First Call - POBHUFU (Initialization):</strong></p>
    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #0066cc;">
) find text=#SFLCTL
) insert
A                                      SFLDROP(CF07)
A* 07                                  SFLFOLD(CF07)
    </pre>
    <p>This is a DDS (Display Data Specification) manipulation function that finds the subfile control record (#SFLCTL) and inserts SFLDROP(CF07) keyword, enabling fold/drop capability on CF07 key press.</p>

    <p><strong>Second Call - POBKUFR (Mode Control):</strong></p>
    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #0066cc;">
C     MODE          IFEQ      '0'
C                   SETON                                        89
C                   ELSE
C                   SETOFF                                       89
C                   ENDIF
    </pre>

    <p><strong>Step-by-Step Process:</strong></p>
    <ol>
        <li><strong>Initialization (POBHUFU):</strong> Called once at program start (line 103) to configure DDS with SFLDROP(CF07) keyword, enabling fold/drop toggle</li>
        <li><strong>Mode Check (POBKUFR):</strong> Called before each subfile display (line 1981) to set indicator 89 based on MODE field</li>
        <li><strong>Indicator 89 ON (MODE='0'):</strong> Subfile displays in folded/compact view (fewer fields visible)</li>
        <li><strong>Indicator 89 OFF (MODE<>'0'):</strong> Subfile displays in dropped/expanded view (all fields visible)</li>
        <li><strong>User Toggle:</strong> When user presses CF07, system toggles MODE field and program reloads subfile with new indicator setting</li>
    </ol>

    <p><strong>Business Purpose:</strong> Provides users with flexible viewing options for inventory detail subfile. Folded view shows essential fields for quick scanning; dropped view shows all fields including production quantities, aging data, and availability metrics. This improves usability for users who need different levels of detail at different times.</p>

    <h4>Business Process Flow Diagram (Mermaid):</h4>
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
        <pre class="mermaid">
flowchart TD
    Start([Program Start]) --> InitSFL[SFL Initialization<br/>POBHUFU Line 103]
    InitSFL --> InsertDDS[Insert SFLDROP CF07<br/>into DDS #SFLCTL]
    InsertDDS --> EnableToggle[Enable Fold/Drop<br/>on CF07 Key]

    EnableToggle --> DisplayLoop[Display Subfile Loop]
    DisplayLoop --> CheckMode[Check MODE Field<br/>POBKUFR Line 1981]

    CheckMode --> ModeDecision{MODE = '0'?}
    ModeDecision -->|Yes| SetOn[SETON Indicator 89<br/>Folded View]
    ModeDecision -->|No| SetOff[SETOFF Indicator 89<br/>Dropped View]

    SetOn --> DisplayFolded[Display Compact Subfile<br/>Essential Fields Only]
    SetOff --> DisplayExpanded[Display Full Subfile<br/>All Fields Visible]

    DisplayFolded --> UserAction{User Presses<br/>CF07?}
    DisplayExpanded --> UserAction

    UserAction -->|Yes| ToggleMode[Toggle MODE Field<br/>Swap 0 â†” Other]
    ToggleMode --> ReloadSFL[Set Reload Subfile Flag]
    ReloadSFL --> DisplayLoop

    UserAction -->|No| OtherKey[Process Other Keys<br/>Continue Program]
    OtherKey --> End([Program End])

    style Start fill:#d4edda,stroke:#28a745,stroke-width:2px
    style End fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px
    style ModeDecision fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style UserAction fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    style DisplayFolded fill:#e7d4f5,stroke:#9b59b6
    style DisplayExpanded fill:#e7d4f5,stroke:#9b59b6
    style ToggleMode fill:#fff3cd,stroke:#ffc107
        </pre>
    </div>

    <h4>4. Data Interaction and Business Information Management</h4>
    <p><strong>Data Operations:</strong></p>
    <ul>
        <li><strong>Input:</strong> MODE field value (controlled by CF07 toggle), Parameter value 6 (configuration)</li>
        <li><strong>Processing:</strong> DDS keyword insertion (POBHUFU), Conditional indicator control (POBKUFR)</li>
        <li><strong>Output:</strong> Indicator 89 (controls subfile display format), Modified DDS with SFLDROP keyword</li>
        <li><strong>No Database Access:</strong> Pure display control functions, no file I/O</li>
    </ul>

    <p><strong>Usage Context:</strong></p>
    <ul>
        <li><strong>POBHUFU:</strong> Called once at program initialization (line 103) to enable fold/drop capability in subfile DDS</li>
        <li><strong>POBKUFR:</strong> Called before each subfile display (line 1981) to set indicator 89 based on current MODE</li>
        <li><strong>User Experience:</strong> Users press CF07 to toggle between compact (quick scan) and detailed (full analysis) views of inventory aging data</li>
        <li><strong>Performance Benefit:</strong> Folded view reduces screen update time and improves readability when full detail not needed</li>
    </ul>
</div>

<div class="section">
    <h2>Complete Function Catalog</h2>
    <p>All embedded RPG user source functions in this program (complete with detailed analysis):</p>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Function</th>
                <th>Program</th>
                <th>Category</th>
                <th>Priority</th>
                <th>Lines</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>F001</td>
                <td><a href="#func-1">CLC Center Txt Str 40 US</a></td>
                <td>PDYJUFR</td>
                <td>Text Formatting</td>
                <td class="priority-medium">Medium</td>
                <td>59-81</td>
                <td style="background: #d4edda; color: #155724; font-weight: bold;">Complete</td>
            </tr>
            <tr>
                <td>F002</td>
                <td><a href="#func-2">MOV Appl Desc-Co Head US</a></td>
                <td>PDYKUFR</td>
                <td>Field Move</td>
                <td class="priority-medium">Medium</td>
                <td>84-88</td>
                <td style="background: #d4edda; color: #155724; font-weight: bold;">Complete</td>
            </tr>
            <tr>
                <td>F003</td>
                <td><a href="#func-3">SFL Fold/Drop RPG US</a></td>
                <td>POBHUFU/POBKUFR</td>
                <td>Subfile Control</td>
                <td class="priority-medium">Medium</td>
                <td>103-110, 1981-1988</td>
                <td style="background: #d4edda; color: #155724; font-weight: bold;">Complete</td>
            </tr>
        </tbody>
    </table>
</div>

</div>

<footer style="text-align: center; padding: 20px; color: #666; border-top: 1px solid #ddd; margin-top: 40px;">
    <p>Complete IBM i Business Documentation - Generated with AI Marker Approach</p>
</footer>

</body>
</html>
