     H/TITLE Exc Load Data to WIM   XF Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 02/28/23  Time  : 09:29:29
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FECP070L1  IF   E           K DISK
      * RTV : EDI Whs Inv Adj Adv   HDR Retrieval index
      *
     FECP071L1  IF   E           K DISK
      * RTV : EDI Whs Inv Adj Adv   DTL Retrieval index
      *
     FECP072L1  IF   E           K DISK
      * RTV : EDI Whs Inv Adj Adv   NAM Retrieval index
      *
     FECP770L0  IF A E           K DISK
      * UPD : WIM EDI Whs InvAdjAdv HDR Update index
      *
     FECP771L0  IF A E           K DISK
      * UPD : WIM EDI Whs InvAdjAdv DTL Update index
      *
     FECP772L0  IF A E           K DISK
      * UPD : WIM EDI Whs InvAdjAdv NAM Update index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QECP71        E DS                  EXTNAME(ECP770L0)
      * UPD : WIM EDI Whs InvAdjAdv HDR Update index
      * Renamed input format fields
     D  WBH9NY       E                     EXTFLD(CTH9NY)
     D  WBHPAA       E                     EXTFLD(CTHPAA)
     D  WBA0ST       E                     EXTFLD(CTA0ST)
     D  WBHSU1       E                     EXTFLD(CTHSU1)
     D  WBHTU1       E                     EXTFLD(CTHTU1)
     D  WBHUU1       E                     EXTFLD(CTHUU1)
     D  WBCRNZ       E                     EXTFLD(CTCRNZ)
     D  WBIVU1       E                     EXTFLD(CTIVU1)
     D  WBAQTH       E                     EXTFLD(CTAQTH)
      *
     D QECP72        E DS                  EXTNAME(ECP771L0)
      * UPD : WIM EDI Whs InvAdjAdv DTL Update index
      * Renamed input format fields
     D  WDH9NY       E                     EXTFLD(CSH9NY)
     D  WDT4NY       E                     EXTFLD(CST4NY)
     D  WDE3SC       E                     EXTFLD(CSE3SC)
     D  WDA2NZ       E                     EXTFLD(CSA2NZ)
     D  WDWGAA       E                     EXTFLD(CSWGAA)
     D  WDE8SC       E                     EXTFLD(CSE8SC)
     D  WDHWU1       E                     EXTFLD(CSHWU1)
     D  WDNIVL       E                     EXTFLD(CSNIVL)
     D  WDNOVL       E                     EXTFLD(CSNOVL)
     D  WDAQNZ       E                     EXTFLD(CSAQNZ)
     D  WDCTNZ       E                     EXTFLD(CSCTNZ)
      *
     D QECP73        E DS                  EXTNAME(ECP772L0)
      * UPD : WIM EDI Whs InvAdjAdv NAM Update index
      * Renamed input format fields
     D  WFH9NY       E                     EXTFLD(CUH9NY)
     D  WFTYPC       E                     EXTFLD(CUTYPC)
     D  WFAMEX       E                     EXTFLD(CUAMEX)
     D  WFDCDQ       E                     EXTFLD(CUDCDQ)
     D  WFDCDE       E                     EXTFLD(CUDCDE)
     D  WFDD1X       E                     EXTFLD(CUDD1X)
     D  WFDD2X       E                     EXTFLD(CUDD2X)
     D  WFITYX       E                     EXTFLD(CUITYX)
     D  WFTATE       E                     EXTFLD(CUTATE)
     D  WFIPXX       E                     EXTFLD(CUIPXX)
     D  WFWFAA       E                     EXTFLD(CUWFAA)
      *
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              8
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  ZADFMF         S             10
     D  WQSC01         S                   LIKE(WCH9NY)
     D  WQSE01         S                   LIKE(WEH9NY)
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * I :  W1501 Date
     D  P1HSU1                 1      8
     D                 DS
     D  ZAMSDA                 1    132
     I@AQCPBF
      * EDI Whs Inv Adj Adv   HDR Retrieval index
      * Renamed input format fields
     I              AQH9NY                      WAH9NY
     I              AQHPAA                      WAHPAA
     I              AQA0ST                      WAA0ST
     I              AQHSU1                      WAHSU1
     I              AQHTU1                      WAHTU1
     I              AQHUU1                      WAHUU1
     I              AQCRNZ                      WACRNZ
     I              AQIVU1                      WAIVU1
     I              AQAQTH                      WAAQTH
      *
     I@CTCPK9
      * WIM EDI Whs InvAdjAdv HDR Update index
      * Renamed input format fields
     I              CTH9NY                      WBH9NY
     I              CTHPAA                      WBHPAA
     I              CTA0ST                      WBA0ST
     I              CTHSU1                      WBHSU1
     I              CTHTU1                      WBHTU1
     I              CTHUU1                      WBHUU1
     I              CTCRNZ                      WBCRNZ
     I              CTIVU1                      WBIVU1
     I              CTAQTH                      WBAQTH
      *
     I@ASCPBM
      * EDI Whs Inv Adj Adv   DTL Retrieval index
      * Renamed input format fields
     I              ASH9NY                      WCH9NY
     I              AST4NY                      WCT4NY
     I              ASE3SC                      WCE3SC
     I              ASA2NZ                      WCA2NZ
     I              ASWGAA                      WCWGAA
     I              ASE8SC                      WCE8SC
     I              ASHWU1                      WCHWU1
     I              ASNIVL                      WCNIVL
     I              ASNOVL                      WCNOVL
     I              ASAQNZ                      WCAQNZ
     I              ASCTNZ                      WCCTNZ
      *
     I@CSCPK6
      * WIM EDI Whs InvAdjAdv DTL Update index
      * Renamed input format fields
     I              CSH9NY                      WDH9NY
     I              CST4NY                      WDT4NY
     I              CSE3SC                      WDE3SC
     I              CSA2NZ                      WDA2NZ
     I              CSWGAA                      WDWGAA
     I              CSE8SC                      WDE8SC
     I              CSHWU1                      WDHWU1
     I              CSNIVL                      WDNIVL
     I              CSNOVL                      WDNOVL
     I              CSAQNZ                      WDAQNZ
     I              CSCTNZ                      WDCTNZ
      *
     I@ARCPBJ
      * EDI Whs Inv Adj Adv   NAM Retrieval index
      * Renamed input format fields
     I              ARH9NY                      WEH9NY
     I              ARTYPC                      WETYPC
     I              ARAMEX                      WEAMEX
     I              ARDCDQ                      WEDCDQ
     I              ARDCDE                      WEDCDE
     I              ARDD1X                      WEDD1X
     I              ARDD2X                      WEDD2X
     I              ARITYX                      WEITYX
     I              ARTATE                      WETATE
     I              ARIPXX                      WEIPXX
     I              ARWFAA                      WEWFAA
      *
     I@CUCPLC
      * WIM EDI Whs InvAdjAdv NAM Update index
      * Renamed input format fields
     I              CUH9NY                      WFH9NY
     I              CUTYPC                      WFTYPC
     I              CUAMEX                      WFAMEX
     I              CUDCDQ                      WFDCDQ
     I              CUDCDE                      WFDCDE
     I              CUDD1X                      WFDD1X
     I              CUDD2X                      WFDD2X
     I              CUITYX                      WFITYX
     I              CUTATE                      WFTATE
     I              CUIPXX                      WFIPXX
     I              CUWFAA                      WFWFAA
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1HSU1        PARM                    WP0001                         W1501 Date
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc Load Data to WIM   XF
      * RMC per entered date, load data to the corresponding WIM EDI 947
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   HDR  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   HDR  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Establish starting position
     C     *LOVAL        SETLL     @AQCPBF                                      *
     C                   READ      @AQCPBF                                90    *
      * Data record not found
     C   90              MOVEL     'USR5023'     W0RTN
      * USER: Process Data record
      * CASE: DB1.W1501 Date EQ PAR.W1501 Date
     C                   DOW       NOT *IN90
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv HDR  * 
     C                   IF        WAHSU1 = P1HSU1
     C                   EXSR      SBCRRC
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   DTL  * 
     C                   EXSR      SCRVGN
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   NAM  * 
     C                   EXSR      SERVGN
     C                   END                                                    *FI
     C                   READ      @AQCPBF                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBCRRC        BEGSR
      *================================================================
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv HDR  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to @CTCPK9
     C                   Z-ADD     WAH9NY        WBH9NY                         EDI SURROGATE N
     C                   MOVEL     WAHPAA        WBHPAA                         TRADE PARTNER C
     C                   MOVEL     WAA0ST        WBA0ST                         EDI-Record Proc
     C                   MOVEL     WAHSU1        WBHSU1                         W1501 Date
     C                   MOVEL     WAHTU1        WBHTU1                         W1502 Adj Numbe
     C                   MOVEL     WAHUU1        WBHUU1                         W1503 Adj Numbe
     C                   Z-ADD     WACRNZ        WBCRNZ                         N902 Transfer O
     C                   MOVEL     WAIVU1        WBIVU1                         G6202 Contact U
     C                   Z-ADD     WAAQTH        WBAQTH                         G6204 Adjustmen
      *
     C     KLCRSB        KLIST
     C                   KFLD                    WBH9NY                         EDI SURROGATE N
      * Check for duplicate primary key
     C     KLCRSB        SETLL     @CTCPK9                                90    *
     C                   IF        *IN90
     C                   MOVEL     'USR5278'     W0RTN
      * Send message 'WIM EDI WhsInvAdjAdv H EX'
     C                   MOVEL     'USR5278'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
     C                   WRITE     @CTCPK9                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   DTL  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WQSC01                         EDI SURROGATE N
      * Setup key
     C                   Z-ADD     WAH9NY        WQSC01                         EDI SURROGATE N
      * Establish starting position
     C     KRSSC         SETLL     @ASCPBM                                      *
     C     KRSSC         READE     @ASCPBM                                90    *
      * Data record not found
     C   90              MOVEL     'USR5027'     W0RTN
      * USER: Process Data record
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv DTL  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SDCRRC
     C     KRSSC         READE     @ASCPBM                                90    *
     C                   ENDDO
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDCRRC        BEGSR
      *================================================================
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv DTL  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to @CSCPK6
     C                   Z-ADD     WCH9NY        WDH9NY                         EDI SURROGATE N
     C                   Z-ADD     WCT4NY        WDT4NY                         LX01 Sequence N
     C                   MOVEL     WCE3SC        WDE3SC                         W1901 ADJUSTMEN
     C                   Z-ADD     WCA2NZ        WDA2NZ                         W1902 CREDIT DE
     C                   MOVEL     WCWGAA        WDWGAA                         W1903 UOM
     C                   MOVEL     WCE8SC        WDE8SC                         W902 Reference
     C                   MOVEL     WCHWU1        WDHWU1                         W1906 PRODUCT
     C                   Z-ADD     WCNIVL        WDNIVL                         W1910 WEIGHT-GR
     C                   Z-ADD     WCNOVL        WDNOVL                         W1913 WEIGHT-NE
     C                   MOVEL     WCAQNZ        WDAQNZ                         N902 Serial Num
     C                   Z-ADD     WCCTNZ        WDCTNZ                         G6202 Productio
      *
     C     KLCRSD        KLIST
     C                   KFLD                    WDH9NY                         EDI SURROGATE N
     C                   KFLD                    WDT4NY                         LX01 Sequence N
      * Check for duplicate primary key
     C     KLCRSD        SETLL     @CSCPK6                                90    *
     C                   IF        *IN90
     C                   MOVEL     'USR5276'     W0RTN
      * Send message 'WIM EDI Whs InvAdjAdv  EX'
     C                   MOVEL     'USR5276'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
     C                   WRITE     @CSCPK6                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SERVGN        BEGSR
      *================================================================
      * Rtv Load Data to WIM   RT - EDI Whs Inv Adj Adv   NAM  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSE         KLIST
     C                   KFLD                    WQSE01                         EDI SURROGATE N
      * Setup key
     C                   Z-ADD     WAH9NY        WQSE01                         EDI SURROGATE N
      * Establish starting position
     C     KRSSE         SETLL     @ARCPBJ                                      *
     C     KRSSE         READE     @ARCPBJ                                90    *
      * Data record not found
     C   90              MOVEL     'USR5025'     W0RTN
      * USER: Process Data record
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv NAM  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SFCRRC
     C     KRSSE         READE     @ARCPBJ                                90    *
     C                   ENDDO
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCRRC        BEGSR
      *================================================================
      * Create WIM EDI Whs InvAdj - WIM EDI Whs InvAdjAdv NAM  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to @CUCPLC
     C                   Z-ADD     WEH9NY        WFH9NY                         EDI SURROGATE N
     C                   MOVEL     WETYPC        WFTYPC                         N101-NAME TYPE
     C                   MOVEL     WEAMEX        WFAMEX                         N102-NAME
     C                   MOVEL     WEDCDQ        WFDCDQ                         N103-ID CODE QU
     C                   MOVEL     WEDCDE        WFDCDE                         N104-ID CODE
     C                   MOVEL     WEDD1X        WFDD1X                         N301-ADD
     C                   MOVEL     WEDD2X        WFDD2X                         N302-ADDRESS
     C                   MOVEL     WEITYX        WFITYX                         N401-CITY
     C                   MOVEL     WETATE        WFTATE                         N402-STATE
     C                   MOVEL     WEIPXX        WFIPXX                         N403-POSTAL COD
     C                   MOVEL     WEWFAA        WFWFAA                         N404-COUNTRY CO
      *
     C     KLCRSF        KLIST
     C                   KFLD                    WFH9NY                         EDI SURROGATE N
     C                   KFLD                    WFTYPC                         N101-NAME TYPE
      * Check for duplicate primary key
     C     KLCRSF        SETLL     @CUCPLC                                90    *
     C                   IF        *IN90
     C                   MOVEL     'USR5280'     W0RTN
      * Send message 'WIM EDI WhsInvAdjAdv N EX'
     C                   MOVEL     'USR5280'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
     C                   WRITE     @CUCPLC                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WACRNZ                         N902 Transfer O
     C                   Z-ADD     *ZERO         WAAQTH                         G6204 Adjustmen
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WBCRNZ                         N902 Transfer O
     C                   Z-ADD     *ZERO         WBAQTH                         G6204 Adjustmen
      * Obtain default message file
     C     *DTAARA       DEFINE    CAMGFLA       ZADFMF
     C                   IN        ZADFMF
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WCT4NY                         LX01 Sequence N
     C                   Z-ADD     *ZERO         WCA2NZ                         W1902 CREDIT DE
     C                   Z-ADD     *ZERO         WCNIVL                         W1910 WEIGHT-GR
     C                   Z-ADD     *ZERO         WCNOVL                         W1913 WEIGHT-NE
     C                   Z-ADD     *ZERO         WCCTNZ                         G6202 Productio
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WDH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WDT4NY                         LX01 Sequence N
     C                   Z-ADD     *ZERO         WDA2NZ                         W1902 CREDIT DE
     C                   Z-ADD     *ZERO         WDNIVL                         W1910 WEIGHT-GR
     C                   Z-ADD     *ZERO         WDNOVL                         W1913 WEIGHT-NE
     C                   Z-ADD     *ZERO         WDCTNZ                         G6202 Productio
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WEH9NY                         EDI SURROGATE N
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WFH9NY                         EDI SURROGATE N
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
