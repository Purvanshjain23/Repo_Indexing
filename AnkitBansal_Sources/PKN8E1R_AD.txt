// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKN8E1R
// ?Date: 14.08.2025 Time: 02:52:18
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?H16853 ISE 11/02/20 - Increased the Buy Order Number field
//?                      length from 5 to 7.
ENDDO;

//?USER: Initialize detail screen (new record)

// DTL.Condition Name USR = Condition name of PAR.PAD Transaction Type
DTL.Condition_Name_USR = RTVCND(PAR.PAD_Transaction_Type);

//?USER: Validate detail screen relations

//?Transaction amount
CASE;

// IF PAR.PAD Transaction Type is Producer Payment Receipt
IF PAR.PAD_Transaction_Type = 'PAY';

// AND DTL.PAD Transaction Amount GT WRK.Zero USR
AND DTL.PAD_Transaction_Amount > WRK.Zero_USR;

// PAR.PAD Transaction Amount = CON.*ZERO - DTL.PAD Transaction Amount
PAR.PAD_Transaction_Amount = *ZERO - DTL.PAD_Transaction_Amount;

//?Transaction amount
// IF *OTHERWISE
IF *OTHERWISE;

// PAR.PAD Transaction Amount = DTL.PAD Transaction Amount
PAR.PAD_Transaction_Amount = DTL.PAD_Transaction_Amount;

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(Crt Reserve Acct Dtl  CR) TYPE(CRTOBJ) FILE(PKEFCPP)           AB1208636;
PARAMETER(DTL.PC_Contract_Code);
PARAMETER(DTL.PAD_Transaction_Date);
PARAMETER(DTL.PAD_Transaction_Sequence);
PARAMETER(PAR.PAD_Transaction_Amount);
PARAMETER(DTL.PAD_Transaction_Type);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(*BLANK);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER('A');
PARAMETER(JOB.*JOB);
PARAMETER(JOB.*PROGRAM);
PARAMETER(JOB.*USER);
PARAMETER(JOB.*Job_date);
PARAMETER(JOB.*Job_time);
{
 //?USER: Processing after Data update

 EXECUTE FUNCTION(Chg Account Balance   CH) TYPE(CHGOBJ) FILE(PKEECPP)           AB1208757;
 PARAMETER(DB1.PC_Contract_Code);
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER(DB1.RS_Record_Status);
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 PARAMETER(DB1.PAD_Transaction_Amount);
 {
  //?USER: Processing after Data read

  // DB1.PAH Account Balance = DB1.PAH Account Balance + PAR.PAD Transaction Amount
  DB1.PAH_Account_Balance = DB1.PAH_Account_Balance + PAR.PAD_Transaction_Amount;

 }

}


