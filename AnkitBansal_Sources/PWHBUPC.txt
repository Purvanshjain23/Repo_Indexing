             PGM

             DCL        VAR(&COMPANY) TYPE(*DEC)  LEN(3 0) VALUE(0)
             DCL        VAR(&LIBLST)  TYPE(*CHAR) LEN(2750)
             DCL        VAR(&DATALIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&CURLIB)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&GRPPRF)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&START)   TYPE(*DEC)  LEN(5 0) VALUE(1)
             DCL        VAR(&PRDTST)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&RETURN)  TYPE(*CHAR) LEN(7)

             RTVUSRPRF  GRPPRF(&GRPPRF)

/*           IF         COND(&GRPPRF *EQ 'SBDPGMR ') THEN(GOTO +
                          CMDLBL(ENDIT))                             */

/* Retrieve the company of the Tattoo to be repaid                   */
             CALL       PGM(PUAZSRR) PARM(&RETURN &COMPANY)
             IF         COND(&COMPANY *EQ 0) THEN(GOTO +
                          CMDLBL(ENDIT))

/* Retrieve current production data library                          */
             RTVJOBA    USRLIBL(&LIBLST)
             CALLSUBR   SUBR(RTVLIBR)
             IF         COND(&CURLIB *EQ '         ') THEN(GOTO +
                          CMDLBL(ENDIT))

/* Replace current production library with Company data library      */
             CALLSUBR   SUBR(CHGLIBL)

/* Copy files to qtemp */
             CRTDUPOBJ  OBJ(PKA1CPP)  FROMLIB(&DATALIB) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PKA1CPL1) FROMLIB(&DATALIB) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)

             CALL       PGM(PWHCDFR) PARM(&RETURN &COMPANY)
             IF         COND(&RETURN *NE '      ') THEN(GOTO +
                          CMDLBL(ENDIT))

/*********************************************************************/
/* SUBROUTINE: CHGLIBL - Change Library List based upon Company#     */
/*********************************************************************/
             SUBR       SUBR(CHGLIBL)

             CHGVAR     VAR(&PRDTST) VALUE(%SST(&CURLIB 5 3))

             IF         COND(&GRPPRF *EQ 'SBDPGMR ') THEN(DO)
             SELECT
             WHEN       COND(&COMPANY = 360) THEN(DO)

             ENDDO

             ENDSUBR

/*********************************************************************/
/* SUBROUTINE: RTVLIBR - Retrieve current plant specific library     */
/*********************************************************************/
             SUBR       SUBR(RTVLIBR)

 LOOP:       CHGVAR     VAR(&CURLIB) VALUE(%SST(&LIBLST &START 10))
             SELECT
             WHEN       COND(&CURLIB *EQ 'PRKFGUP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ 'PRKFSTP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ 'PRKFTFP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ 'PRKFTSTGUP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ 'PRKFTSTSTP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ 'PRKFTSTTFP') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             WHEN       COND(&CURLIB *EQ '          ') THEN(GOTO +
                          CMDLBL(ENDLOOP))

             OTHERWISE  CMD(DO)
             CHGVAR     VAR(&START) VALUE(&START + 11)
             GOTO       CMDLBL(LOOP)
             ENDDO

             ENDSELECT

 ENDLOOP:    ENDSUBR
/*********************************************************************/

 ENDIT:      ENDPGM
