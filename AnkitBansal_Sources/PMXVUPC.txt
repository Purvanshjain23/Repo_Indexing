/********************************************************************/
/*                                                                   */
/*  SYNOPSIS -  BUILD BROKER COMMISSION RATE MATRIX                  */
/*                                                                   */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                              */
/*  DATE      - 08/26/2008                                           */
/*  AUTHOR    - LARA BUSER                                           */
/*                                                                   */
/*  PARAMETERS:                                                      */
/*  &RETURN      RETURN CODE                                         */
/*  &ACCRLCD     ACCRUAL CODE                                        */
/*  &DATEN       DATE ENTERED 15.5                                   */
/*  &EMAIL       EMAIL ADDRESS                                       */
/*********************************************************************/
 PMXVUPC:    PGM        PARM(&RETURN &ACCRLCD &DATEN &EMAIL)

             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&ACCRLCD) TYPE(*CHAR) LEN(3)
             DCL        VAR(&DATEN) TYPE(*DEC)
             DCL        VAR(&DATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(50)

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&DATE) VALUE(&DATEN)

/* CREATE WORK FILE IN QTEMP                                         */
             CRTDUPOBJ  OBJ(PMECCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PMECCPP) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130) EXEC(CLRPFM FILE(QTEMP/PMECCPP))

             CRTDUPOBJ  OBJ(PMECCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PMECCPL0) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130)

             CRTDUPOBJ  OBJ(PMECCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PMECCPL1) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130)

/* WRITE ITEMS & ACCRUAL CODES TO THE WORK FILE                      */
             CALL       PGM(PMXSXFR) PARM(&RETURN &ACCRLCD &DATE)
             IF         COND(&RETURN *NE '       ') THEN(GOTO +
                          CMDLBL(BUILDERR))

/* CREATE THE TABLE AND EMAIL AS A SPREADSHEET                       */
             EXECUTE    VIEW(PMECCPPVT) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('Broker +
                          Commission Rate Matrix')
             MONMSG     MSGID(CPF0000) EXEC(CHGVAR VAR(&RETURN) +
                          VALUE('Y2U0032')) /* Error returned on +
                          call */

/* HANDLE ERRORS                                                     */
BUILDERR:

 END:        ENDPGM
