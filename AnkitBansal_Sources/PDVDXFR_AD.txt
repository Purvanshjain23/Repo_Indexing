// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDVDXFR
// ?Date: 14.08.2025 Time: 03:33:16
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?***** Change Log and comments
DO;

//?*****
//?** 05/16/2006 LJB   T00008
//?** Result field changed to 25 characters to accommodate
//?** international fax numbers.
ENDDO;

EXECUTE FUNCTION(RTV Name, Address, Fax RT) TYPE(RTVOBJ) FILE(OMFFREP)          AC1448662;
PARAMETER(PAR.Carrier_Code);
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Address_Line_1);
PARAMETER(PAR.Address_Line_2);
PARAMETER(PAR.City_for_Fax);
PARAMETER(PAR.Zip_Code_for_Fax);
PARAMETER(PAR.State_Code);
PARAMETER(PAR.Fax_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Fax if carrier is found
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// PGM.*Return code = CND.*Record does not exist
PGM.*Return_code = 'Y2U0005';

//?Fax if carrier is found
// IF *OTHERWISE
IF *OTHERWISE;

//?** Result field changed to 25 characters to accommodate
//?** international fax numbers.             05/16/2006 LJB
// PAR.Fax Area Code = SUBSTRING(PAR.Fax Number,CON.1,CON.3)
PAR.Fax_Area_Code = SUBSTRING(PAR.Fax_Number:1:3);

// PAR.Fax Phone Number = SUBSTRING(PAR.Fax Number,CON.4,CON.21)
PAR.Fax_Phone_Number = SUBSTRING(PAR.Fax_Number:4:21);

// PAR.Spool File Selection = CON.*JOB
PAR.Spool_File_Selection = *JOB;

// PAR.Display Fax Select Screen = CND.Yes
PAR.Display_Fax_Select_Screen = 'Y';

//?convert SEND DATE from cyymmdd to mmddyy.
DO;

EXECUTE FUNCTION(CNV cyymmdd to mmddyy) TYPE(EXCINTFUN)                         AC1563472;
PARAMETER(JOB.*Job_date);
PARAMETER(PAR.Send_Date);
{
 //?Execute internal function

 //?convert numeric date to character date.
 // PAR.Date (Alpha) USR = CVTVAR(PAR.Date In  (7,0) USR)
 PAR.Date_Alpha_USR = CVTVAR(PAR.Date_In_70_USR);

 //?extract month, day, and year.
 // PAR.Year  (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.2,CON.2)
 PAR.Year_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:2:2);

 // PAR.Month (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.4,CON.2)
 PAR.Month_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:4:2);

 // PAR.Day   (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.6,CON.2)
 PAR.Day_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:6:2);

 //?reconstruct date in mmddyy format.
 // PAR.Date (Char-6) USR = CONCAT(PAR.Month (Char) USR,PAR.Day   (Char) USR,CON.*ZE
 PAR.Date_Char_6_USR = PAR.Month_Char_USR + PAR.Day_Char_USR (*ZERO);

 // PAR.Date (Char-6) USR = CONCAT(PAR.Date (Char-6) USR,PAR.Year  (Char) USR,CON.*Z
 PAR.Date_Char_6_USR = PAR.Date_Char_6_USR + PAR.Year_Char_USR (*ZERO);

 //?convert character date to numeric date.
 // PAR.Date Out (6,0) USR = CVTVAR(PAR.Date (Char-6) USR)
 PAR.Date_Out_60_USR = CVTVAR(PAR.Date_Char_6_USR);

}


ENDDO;

// PAR.Send Priority = CON.49
PAR.Send_Priority = 49;

// PAR.Cover Sheet Name = CON.SBDTRANS
PAR.Cover_Sheet_Name = 'SBDTRANS';

// Execute function PRC Load FastFax Array US.
EXECUTE FUNCTION(PRC Load FastFax Array US) TYPE(EXCUSRSRC) ('PDVAUFR');
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Fax_Area_Code);
PARAMETER(PAR.Fax_Phone_Number);
PARAMETER(PAR.Routing_Code);
PARAMETER(PAR.International_Code);
PARAMETER(PAR.Address_Line_1);
PARAMETER(PAR.Address_Line_2);
PARAMETER(PAR.City_for_Fax);
PARAMETER(PAR.State_Code);
PARAMETER(PAR.Zip_Code_for_Fax);
PARAMETER(PAR.Country_Description);
PARAMETER(1);
{
 C                     Z-ADD#IINDE    X       30                   TEXT2
 C                     MOVEL#ILLTX    QRCP,X                       TEXT2
 C                     MOVEL#ILMTX    QRCO,X                       Y
 C                     MOVEL#IXDCD    QFXA,X                       E ARRAY
 C                     MOVEL#ILNTX    QFXN,X                       RRAY
 C                     MOVEL#IPWST    QRTG,X                        ARRAY
 C                     MOVEL#IP0ST    QINT,X                       'INT'
 C                     MOVEL#IACNA    QAD1,X                       ARRAY
 C                     MOVEL#IADNA    QAD2,X                       ARRAY
 C                     MOVEL#ILOTX    QCTY,X                       RRAY
 C                     MOVEL#IBGCD    QSTA,X                       ARRAY
 C                     MOVEL#ILPTX    QZIP,X                       RAY
 C                     MOVEL#IDATX    QCNY,X                       Y ARRAY
}


// Execute function PRC Call FastFax PGM   US.
EXECUTE FUNCTION(PRC Call FastFax PGM   US) TYPE(EXCUSRSRC) ('PDVBUFR');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(PAR.Display_Fax_Select_Screen);
PARAMETER(PAR.User_Id);
PARAMETER(PAR.Send_Date);
PARAMETER(PAR.Send_Time);
PARAMETER(PAR.Send_Priority);
PARAMETER(PAR.Cost_Account_Name);
PARAMETER(PAR.Cover_Sheet_Name);
PARAMETER(PAR.Forms_Type_Str);
PARAMETER(PAR.Fax_Resolution);
PARAMETER(PAR.From_Page);
PARAMETER(PAR.To_Page);
PARAMETER(PAR.Page_Length);
PARAMETER(PAR.Page_Width);
PARAMETER(PAR.CPI);
PARAMETER(PAR.LPI);
PARAMETER(PAR.Save_Copy_of_Fax);
PARAMETER(PAR.Print_Copy_of_Fax);
PARAMETER(PAR.Printer_Name_or_Outq);
PARAMETER(PAR.Outq_Library);
PARAMETER(PAR.Print_On_Form);
PARAMETER(PAR.Landscape);
{
 E*****
 E* 05/16/2006 LJB T00008
 E* QFXN CHANGED TO 25 TO ACCOMMODATE INTERNATIONAL FAX NUMBERS
 E*****
 E                    QRCP       45 25
 E                    QRCO       45 30
 E                    QFXA       45  3
 E*****>> 5/16/06     QFXN       45 12   LJB ******
 E                    QFXN       45 25
 E                    QRTG       45  3
 E                    QINT       45  3
 E                    QAD1       45 30
 E                    QAD2       45 30
 E                    QCTY       45 30
 E                    QSTA       45  2
 E                    QZIP       45 10
 E                    QCNY       45 30
 E                    QCT1       15 80
 E                    QCT2       15 80
 IQIAPDS      DS
 I                                        1  10 QSDR
 I*                                                  USER ID OF SENDER
 I                                       11  160QSDT
 I*                                                  SEND DATE MMDDYY
 I                                       17  200QSTM
 I*                                                  SEND TIME  24HR HHMM
 I                                       21  220QPTY
 I*                                                  SEND PRIORITY
 I*                                                  01=HI - 98=LO 99=HLD
 I                                       23  29 QCAC
 I*                                                  COST ACCOUNT
 I                                       30  39 QCVR
 I*                                                  COVER NAME
 I                                       40  49 QFMN
 I*                                                  FORM NAME
 I                                       50  500QRSL
 I*                                                  FUTURE/RESOLUTTION
 I                                       51  530QFPG
 I*                                                  FUTURE/FROM PAGE
 I                                       54  560QTPG
 I*                                                  FUTURE/TO PAGE
 I                                       57  590QPGL
 I*                                                  FUTURE/PAGE LENGTH
 I                                       60  620QPGW
 I*                                                  FUTURE/PAGE WIDTH
 I                                       63  640QCPI
 I*                                                  FUTURE/CPI
 I                                       65  660QLPI
 I*                                                  FUTURE/LPI
 I                                       67  710QFNT
 I*                                                  FUTURE/FONT NAME
 I                                       72  74 QSVC
 I*                                                  SAVE COPY OF FAX
 I*                                                  0=NO 999=PERM X=DAYS
 I                                       75  75 QPRC
 I*                                                  PRINT COPY OF FAX
 I*                                                  0=NO 1=IMMED 2=SENT
 I                                       76  85 QPRQ
 I*                                                  PRINTER/OUTQ NAME
 I                                       86  95 QQLB
 I*                                                  OUTQ LIBRARY
 I                                       96  96 QPRF
 I*                                                  FUTURE/PRINT W/FORM
 I                                       97  97 QLAN
 I*                                                  FUTURE/LANDSCAPE
 C****************************************************************
 C           QIAPRM    PLIST
 C                     PARM           QSLCT  10        SPOOL FILE SELE
 C*                                                  *JOB *USER 'USER DATE'
 C                     PARM           QSBMT   1        PARMS SET/DISPALAY SC
 C*                                                  ERRORS 'Y' 'N' ' '
 C                     PARM           QIAPDS           DATA STRUCTURE ABOVE
 C                     PARM           QRCP             RECIPIENT ARRAY
 C                     PARM           QRCO             COMPANY ARRAY
 C                     PARM           QFXA             FAX AREA CODE ARRAY
 C                     PARM           QFXN             FAX NUMBER ARRAY
 C                     PARM           QRTG             ROUTING CODE ARRAY
 C                     PARM           QINT             'USA' 'CAN' 'INT'
 C*                                                    'OTH' 'PVT'
 C                     PARM           QAD1             RECIP ADDR1 ARRAY
 C                     PARM           QAD2             RECIP ADDR2 ARRAY
 C                     PARM           QCTY             RECIP CITY ARRAY
 C                     PARM           QSTA             RECIP STATE ARRAY
 C                     PARM           QZIP             RECIP ZIP ARRAY
 C                     PARM           QCNY             RECIP COUNTRY ARRAY
 C                     PARM           QCT1             COVER SHEET TEXT1
 C                     PARM           QCT2             COVER SHEET TEXT2
 C****************************************************************
 C                     MOVEL#ILHTX    QSLCT
 C                     MOVEL#IPHST    QSBMT
 C                     MOVE #IAYNA    QSDR
 C                     Z-ADD#IKXDT    QSDT
 C                     Z-ADD#ISDTM    QSTM
 C                     Z-ADD#IXTNB    QPTY
 C                     MOVEL#ILFTX    QCAC
 C                     MOVEL#ILGTX    QCVR
 C                     MOVEL#IFDNA    QFMN
 C                     Z-ADD#IFAXR    QRSL
 C                     Z-ADD#IFRMP    QFPG
 C                     Z-ADD#ITOPG    QTPG
 C                     Z-ADD#IPGLN    QPGL
 C                     Z-ADD#IPGWD    QPGW
 C                     Z-ADD#ICPII    QCPI
 C                     Z-ADD#ILPII    QLPI
 C                     MOVEL#ILITX    QSVC
 C                     MOVEL#IPCOF    QPRC
 C                     MOVEL#ILJTX    QPRQ
 C                     MOVEL#ILKTX    QQLB
 C                     MOVEL#IPROF    QPRF
 C                     MOVEL#IPSST    QLAN
 C*
 C                     MOVEL'FASTFAX/'QIAPGM 16
 C                     MOVE 'FFX300CL'QIAPGM
 C                     CALL QIAPGM    QIAPRM
 C                     SETON                     LR
}


ENDIF;

