     H/TITLE WW PFS Prd Sch Bt Hd  DF  Display file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Display file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 11/25/19  Time  : 14:56:47
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPBR6DFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW PFS Prd Sch Bt Hd  DF  Display file
      *
     FPBB2CPL2IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : PFS Prod Sched Batch Hdr BchDt(D)/BchTm(D)
      *
     FPBB3CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Sel  Retrieval index
      *
     FPBB1CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Dtl  Retrieval index
      *
     FPBB2CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index
      *
     FPBB2CPL4IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index (2)
      *
     FPBB2CPL3IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Hdr  SntDt(D)/SntTm(D)
      *
     FPBB1CPL6IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Dtl  Retrieval index (2)
      *
     FPBC3CPL4IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      *
     FPBC3CPL3IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Cgn  Retrival index Seq(D)
      *
     FPBC3CPL5IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      *
     FPBC3CPL6IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPBB3CPL0UF  E           K        DISK
      * UPD : PFS Prod Sched Batch Sel  Update index
      *
     FPBB2CPL0UF  E           K        DISK
      * UPD : PFS Prod Sched Batch Hdr  Update index
      *
     FPBB1CPL0UF  E           K        DISK
      * UPD : PFS Prod Sched Batch Dtl  Update index
      *
     FPBC3CPL0IF  E           K        DISK                      A
      * UPD : PFS Prod Sched Batch Cgn  Update index
      *
      * Days in month for date validation
     E                    @XD    12  12  2 0
     E                    UCT        40  1               CENTER TABLE
      * Long constants
     E                    @CN#    1  07  6   @CN    25
     E                    YDOW        7  1               *Days of week
     I@B3CPUV
      * PFS Prod Sched Batch Sel  Update index
      * Renamed input format fields
     I              B3Y1NX                          WAY1NX
     I              B3ASD8                          WAASD8
     I              B3AOTS                          WAAOTS
     I              B3TVAA                          WATVAA
     I              B3DNNB                          WADNNB
     I              B3DONB                          WADONB
     I              B3UWSX                          WAUWSX
     I              B3UXSX                          WAUXSX
     I              B3V3SX                          WAV3SX
     I              B3AHNY                          WAAHNY
     I              B3AINY                          WAAINY
     I              B3AJNY                          WAAJNY
     I              B3AKNY                          WAAKNY
      *
     I@B2CPUP
      * PFS Prod Sched Batch Hdr  Update index
      * Renamed input format fields
     I              B2Y1NX                          WBY1NX
     I              B2ASD8                          WBASD8
     I              B2AOTS                          WBAOTS
     I              B2TVAA                          WBTVAA
     I              B2B0SC                          WBB0SC
     I              B2ATD8                          WBATD8
     I              B2APTS                          WBAPTS
     I              B2UWSX                          WBUWSX
     I              B2UXSX                          WBUXSX
     I              B2V3SX                          WBV3SX
     I              B2AHNY                          WBAHNY
     I              B2AINY                          WBAINY
     I              B2AJNY                          WBAJNY
     I              B2AKNY                          WBAKNY
      *
     I@B1CPUS
      * PFS Prod Sched Batch Dtl  Update index
      * Renamed input format fields
     I              B1Y1NX                          WCY1NX
     I              B1ASD8                          WCASD8
     I              B1AOTS                          WCAOTS
     I              B1TVAA                          WCTVAA
     I              B1BTSQ                          WCBTSQ
     I              B1P7DT                          WCP7DT
     I              B1Y2NX                          WCY2NX
     I              B1U2SX                          WCU2SX
     I              B1ZPNX                          WCZPNX
     I              B1ZXNX                          WCZXNX
     I              B1CSSC                          WCCSSC
     I              B1ODQY                          WCODQY
     I              B1INAL                          WCINAL
     I              B1C6NB                          WCC6NB
     I              B1C8NB                          WCC8NB
     I              B1FLQ1                          WCFLQ1
     I              B1FLQ2                          WCFLQ2
     I              B1ZGNX                          WCZGNX
     I              B1ZWNX                          WCZWNX
     I              B1ZSNX                          WCZSNX
     I              B1ZJNX                          WCZJNX
     I              B1ZKNX                          WCZKNX
     I              B1DNNB                          WCDNNB
     I              B1DONB                          WCDONB
     I              B1DRNB                          WCDRNB
     I              B1U0SX                          WCU0SX
     I              B1BZSC                          WCBZSC
     I              B1B3SC                          WCB3SC
     I              B1B0SC                          WCB0SC
     I              B1VISX                          WCVISX
     I              B1ZLSX                          WCZLSX
     I              B1VGSX                          WCVGSX
     I              B1OJU1                          WCOJU1
     I              B1UWSX                          WCUWSX
     I              B1UXSX                          WCUXSX
     I              B1V3SX                          WCV3SX
     I              B1AHNY                          WCAHNY
     I              B1AINY                          WCAINY
     I              B1AJNY                          WCAJNY
     I              B1AKNY                          WCAKNY
      *
     I@B2CPUQ
      * PFS Prod Sched Batch Hdr  Retrieval index
      * Renamed input format fields
     I              B2Y1NX                          WDY1NX
     I              B2ASD8                          WDASD8
     I              B2AOTS                          WDAOTS
     I              B2TVAA                          WDTVAA
     I              B2B0SC                          WDB0SC
     I              B2ATD8                          WDATD8
     I              B2APTS                          WDAPTS
     I              B2UWSX                          WDUWSX
     I              B2UXSX                          WDUXSX
     I              B2V3SX                          WDV3SX
     I              B2AHNY                          WDAHNY
     I              B2AINY                          WDAINY
     I              B2AJNY                          WDAJNY
     I              B2AKNY                          WDAKNY
      *
     I@B2CPZE
      * PFS Prod Sched Batch Hdr  Retrieval index (2)
      * Renamed input format fields
     I              B2Y1NX                          WEY1NX
     I              B2ASD8                          WEASD8
     I              B2AOTS                          WEAOTS
     I              B2TVAA                          WETVAA
     I              B2B0SC                          WEB0SC
     I              B2ATD8                          WEATD8
     I              B2APTS                          WEAPTS
     I              B2UWSX                          WEUWSX
     I              B2UXSX                          WEUXSX
     I              B2V3SX                          WEV3SX
     I              B2AHNY                          WEAHNY
     I              B2AINY                          WEAINY
     I              B2AJNY                          WEAJNY
     I              B2AKNY                          WEAKNY
      *
     I@B2CPW9
      * PFS Prod Sched Batch Hdr  SntDt(D)/SntTm(D)
      * Renamed input format fields
     I              B2Y1NX                          WFY1NX
     I              B2ASD8                          WFASD8
     I              B2AOTS                          WFAOTS
     I              B2TVAA                          WFTVAA
     I              B2B0SC                          WFB0SC
     I              B2ATD8                          WFATD8
     I              B2APTS                          WFAPTS
     I              B2UWSX                          WFUWSX
     I              B2UXSX                          WFUXSX
     I              B2V3SX                          WFV3SX
     I              B2AHNY                          WFAHNY
     I              B2AINY                          WFAINY
     I              B2AJNY                          WFAJNY
     I              B2AKNY                          WFAKNY
      *
     I@B1CPCV
      * PFS Prod Sched Batch Dtl  Retrieval index (2)
      * Renamed input format fields
     I              B1Y1NX                          WGY1NX
     I              B1ASD8                          WGASD8
     I              B1AOTS                          WGAOTS
     I              B1TVAA                          WGTVAA
     I              B1BTSQ                          WGBTSQ
     I              B1P7DT                          WGP7DT
     I              B1Y2NX                          WGY2NX
     I              B1U2SX                          WGU2SX
     I              B1ZPNX                          WGZPNX
     I              B1ZXNX                          WGZXNX
     I              B1CSSC                          WGCSSC
     I              B1ODQY                          WGODQY
     I              B1INAL                          WGINAL
     I              B1C6NB                          WGC6NB
     I              B1C8NB                          WGC8NB
     I              B1FLQ1                          WGFLQ1
     I              B1FLQ2                          WGFLQ2
     I              B1ZGNX                          WGZGNX
     I              B1ZWNX                          WGZWNX
     I              B1ZSNX                          WGZSNX
     I              B1ZJNX                          WGZJNX
     I              B1ZKNX                          WGZKNX
     I              B1DNNB                          WGDNNB
     I              B1DONB                          WGDONB
     I              B1DRNB                          WGDRNB
     I              B1U0SX                          WGU0SX
     I              B1BZSC                          WGBZSC
     I              B1B3SC                          WGB3SC
     I              B1B0SC                          WGB0SC
     I              B1VISX                          WGVISX
     I              B1ZLSX                          WGZLSX
     I              B1VGSX                          WGVGSX
     I              B1OJU1                          WGOJU1
     I              B1UWSX                          WGUWSX
     I              B1UXSX                          WGUXSX
     I              B1V3SX                          WGV3SX
     I              B1AHNY                          WGAHNY
     I              B1AINY                          WGAINY
     I              B1AJNY                          WGAJNY
     I              B1AKNY                          WGAKNY
      *
     I@C3CPDJ
      * PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      * Renamed input format fields
     I              C3Y1NX                          WHY1NX
     I              C3ASD8                          WHASD8
     I              C3AOTS                          WHAOTS
     I              C3TVAA                          WHTVAA
     I              C3BTSQ                          WHBTSQ
     I              C3P7DT                          WHP7DT
     I              C3Y2NX                          WHY2NX
     I              C3U2SX                          WHU2SX
     I              C3ZPNX                          WHZPNX
     I              C3ZXNX                          WHZXNX
     I              C3CSSC                          WHCSSC
     I              C3ODQY                          WHODQY
     I              C3INAL                          WHINAL
     I              C3C6NB                          WHC6NB
     I              C3C8NB                          WHC8NB
     I              C3FLQ1                          WHFLQ1
     I              C3FLQ2                          WHFLQ2
     I              C3ZGNX                          WHZGNX
     I              C3ZWNX                          WHZWNX
     I              C3ZSNX                          WHZSNX
     I              C3ZJNX                          WHZJNX
     I              C3ZKNX                          WHZKNX
     I              C3DNNB                          WHDNNB
     I              C3DONB                          WHDONB
     I              C3DRNB                          WHDRNB
     I              C3U0SX                          WHU0SX
     I              C3BZSC                          WHBZSC
     I              C3B3SC                          WHB3SC
     I              C3B0SC                          WHB0SC
     I              C3VISX                          WHVISX
     I              C3ZLSX                          WHZLSX
     I              C3VGSX                          WHVGSX
     I              C3OJU1                          WHOJU1
     I              C3UWSX                          WHUWSX
     I              C3UXSX                          WHUXSX
     I              C3V3SX                          WHV3SX
     I              C3AHNY                          WHAHNY
     I              C3AINY                          WHAINY
     I              C3AJNY                          WHAJNY
     I              C3AKNY                          WHAKNY
      *
     I@C3CPDC
      * PFS Prod Sched Batch Cgn  Retrival index Seq(D)
      * Renamed input format fields
     I              C3Y1NX                          WIY1NX
     I              C3ASD8                          WIASD8
     I              C3AOTS                          WIAOTS
     I              C3TVAA                          WITVAA
     I              C3BTSQ                          WIBTSQ
     I              C3P7DT                          WIP7DT
     I              C3Y2NX                          WIY2NX
     I              C3U2SX                          WIU2SX
     I              C3ZPNX                          WIZPNX
     I              C3ZXNX                          WIZXNX
     I              C3CSSC                          WICSSC
     I              C3ODQY                          WIODQY
     I              C3INAL                          WIINAL
     I              C3C6NB                          WIC6NB
     I              C3C8NB                          WIC8NB
     I              C3FLQ1                          WIFLQ1
     I              C3FLQ2                          WIFLQ2
     I              C3ZGNX                          WIZGNX
     I              C3ZWNX                          WIZWNX
     I              C3ZSNX                          WIZSNX
     I              C3ZJNX                          WIZJNX
     I              C3ZKNX                          WIZKNX
     I              C3DNNB                          WIDNNB
     I              C3DONB                          WIDONB
     I              C3DRNB                          WIDRNB
     I              C3U0SX                          WIU0SX
     I              C3BZSC                          WIBZSC
     I              C3B3SC                          WIB3SC
     I              C3B0SC                          WIB0SC
     I              C3VISX                          WIVISX
     I              C3ZLSX                          WIZLSX
     I              C3VGSX                          WIVGSX
     I              C3OJU1                          WIOJU1
     I              C3UWSX                          WIUWSX
     I              C3UXSX                          WIUXSX
     I              C3V3SX                          WIV3SX
     I              C3AHNY                          WIAHNY
     I              C3AINY                          WIAINY
     I              C3AJNY                          WIAJNY
     I              C3AKNY                          WIAKNY
      *
     I@C3CPDK
      * PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      * Renamed input format fields
     I              C3Y1NX                          WJY1NX
     I              C3ASD8                          WJASD8
     I              C3AOTS                          WJAOTS
     I              C3TVAA                          WJTVAA
     I              C3BTSQ                          WJBTSQ
     I              C3P7DT                          WJP7DT
     I              C3Y2NX                          WJY2NX
     I              C3U2SX                          WJU2SX
     I              C3ZPNX                          WJZPNX
     I              C3ZXNX                          WJZXNX
     I              C3CSSC                          WJCSSC
     I              C3ODQY                          WJODQY
     I              C3INAL                          WJINAL
     I              C3C6NB                          WJC6NB
     I              C3C8NB                          WJC8NB
     I              C3FLQ1                          WJFLQ1
     I              C3FLQ2                          WJFLQ2
     I              C3ZGNX                          WJZGNX
     I              C3ZWNX                          WJZWNX
     I              C3ZSNX                          WJZSNX
     I              C3ZJNX                          WJZJNX
     I              C3ZKNX                          WJZKNX
     I              C3DNNB                          WJDNNB
     I              C3DONB                          WJDONB
     I              C3DRNB                          WJDRNB
     I              C3U0SX                          WJU0SX
     I              C3BZSC                          WJBZSC
     I              C3B3SC                          WJB3SC
     I              C3B0SC                          WJB0SC
     I              C3VISX                          WJVISX
     I              C3ZLSX                          WJZLSX
     I              C3VGSX                          WJVGSX
     I              C3OJU1                          WJOJU1
     I              C3UWSX                          WJUWSX
     I              C3UXSX                          WJUXSX
     I              C3V3SX                          WJV3SX
     I              C3AHNY                          WJAHNY
     I              C3AINY                          WJAINY
     I              C3AJNY                          WJAJNY
     I              C3AKNY                          WJAKNY
      *
     I@C3CPDL
      * PFS Prod Sched Batch Cgn  Co/Bdt/Btm/Usr/It/Od/Bs-
      * Renamed input format fields
     I              C3Y1NX                          WKY1NX
     I              C3ASD8                          WKASD8
     I              C3AOTS                          WKAOTS
     I              C3TVAA                          WKTVAA
     I              C3BTSQ                          WKBTSQ
     I              C3P7DT                          WKP7DT
     I              C3Y2NX                          WKY2NX
     I              C3U2SX                          WKU2SX
     I              C3ZPNX                          WKZPNX
     I              C3ZXNX                          WKZXNX
     I              C3CSSC                          WKCSSC
     I              C3ODQY                          WKODQY
     I              C3INAL                          WKINAL
     I              C3C6NB                          WKC6NB
     I              C3C8NB                          WKC8NB
     I              C3FLQ1                          WKFLQ1
     I              C3FLQ2                          WKFLQ2
     I              C3ZGNX                          WKZGNX
     I              C3ZWNX                          WKZWNX
     I              C3ZSNX                          WKZSNX
     I              C3ZJNX                          WKZJNX
     I              C3ZKNX                          WKZKNX
     I              C3DNNB                          WKDNNB
     I              C3DONB                          WKDONB
     I              C3DRNB                          WKDRNB
     I              C3U0SX                          WKU0SX
     I              C3BZSC                          WKBZSC
     I              C3B3SC                          WKB3SC
     I              C3B0SC                          WKB0SC
     I              C3VISX                          WKVISX
     I              C3ZLSX                          WKZLSX
     I              C3VGSX                          WKVGSX
     I              C3OJU1                          WKOJU1
     I              C3UWSX                          WKUWSX
     I              C3UXSX                          WKUXSX
     I              C3V3SX                          WKV3SX
     I              C3AHNY                          WKAHNY
     I              C3AINY                          WKAINY
     I              C3AJNY                          WKAJNY
     I              C3AKNY                          WKAKNY
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXDI8T       DS
      * Internal date
     I                                        1   80XDI8DT
     I                                        1   40XDI8CY
     I                                        1   10XDI8CC
     I                                        2   40XDI8YY
     I                                        5   60XDI8MM
     I                                        7   80XDI8DD
      /EJECT
     IXTCK        DS
      * Time: hours, minutes, seconds
     I                                        1   60XTTIM
     I                                        1   20XTHH
     I                                        3   40XTNN
     I                                        5   60XTSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPBB31    E DSPBB3CPL0
      * UPD : PFS Prod Sched Batch Sel  Update index
      * Renamed input format fields
     I              B3Y1NX                          WAY1NX
     I              B3ASD8                          WAASD8
     I              B3AOTS                          WAAOTS
     I              B3TVAA                          WATVAA
     I              B3DNNB                          WADNNB
     I              B3DONB                          WADONB
     I              B3UWSX                          WAUWSX
     I              B3UXSX                          WAUXSX
     I              B3V3SX                          WAV3SX
     I              B3AHNY                          WAAHNY
     I              B3AINY                          WAAINY
     I              B3AJNY                          WAAJNY
     I              B3AKNY                          WAAKNY
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPBB21    E DSPBB2CPL0
      * UPD : PFS Prod Sched Batch Hdr  Update index
      * Renamed input format fields
     I              B2Y1NX                          WBY1NX
     I              B2ASD8                          WBASD8
     I              B2AOTS                          WBAOTS
     I              B2TVAA                          WBTVAA
     I              B2B0SC                          WBB0SC
     I              B2ATD8                          WBATD8
     I              B2APTS                          WBAPTS
     I              B2UWSX                          WBUWSX
     I              B2UXSX                          WBUXSX
     I              B2V3SX                          WBV3SX
     I              B2AHNY                          WBAHNY
     I              B2AINY                          WBAINY
     I              B2AJNY                          WBAJNY
     I              B2AKNY                          WBAKNY
      *
     IQPBB11    E DSPBB1CPL0
      * UPD : PFS Prod Sched Batch Dtl  Update index
      * Renamed input format fields
     I              B1Y1NX                          WCY1NX
     I              B1ASD8                          WCASD8
     I              B1AOTS                          WCAOTS
     I              B1TVAA                          WCTVAA
     I              B1BTSQ                          WCBTSQ
     I              B1P7DT                          WCP7DT
     I              B1Y2NX                          WCY2NX
     I              B1U2SX                          WCU2SX
     I              B1ZPNX                          WCZPNX
     I              B1ZXNX                          WCZXNX
     I              B1CSSC                          WCCSSC
     I              B1ODQY                          WCODQY
     I              B1INAL                          WCINAL
     I              B1C6NB                          WCC6NB
     I              B1C8NB                          WCC8NB
     I              B1FLQ1                          WCFLQ1
     I              B1FLQ2                          WCFLQ2
     I              B1ZGNX                          WCZGNX
     I              B1ZWNX                          WCZWNX
     I              B1ZSNX                          WCZSNX
     I              B1ZJNX                          WCZJNX
     I              B1ZKNX                          WCZKNX
     I              B1DNNB                          WCDNNB
     I              B1DONB                          WCDONB
     I              B1DRNB                          WCDRNB
     I              B1U0SX                          WCU0SX
     I              B1BZSC                          WCBZSC
     I              B1B3SC                          WCB3SC
     I              B1B0SC                          WCB0SC
     I              B1VISX                          WCVISX
     I              B1ZLSX                          WCZLSX
     I              B1VGSX                          WCVGSX
     I              B1OJU1                          WCOJU1
     I              B1UWSX                          WCUWSX
     I              B1UXSX                          WCUXSX
     I              B1V3SX                          WCV3SX
     I              B1AHNY                          WCAHNY
     I              B1AINY                          WCAINY
     I              B1AJNY                          WCAJNY
     I              B1AKNY                          WCAKNY
      *
      * Outward parameters
     IPARC        DS                             33
      * KEY : PFS Prod Sched Batch Dtl Co/DtTm(D)/Tp/Gp/U/BC/Itm
      * I : RST PFS Company Number
     I                                        1   30PAY1NX
      * I : RST PFS Batch Date
     I                                        4  110PAASD8
      * I : RST PFS Batch Time
     I                                       12  170PAAOTS
      *
     IYARDCS      DS                             78
     IQPBC31    E DSPBC3CPL0
      * UPD : PFS Prod Sched Batch Cgn  Update index
      *
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0001
      * Application Code
     I                                       11  16 ZA0002
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0003
      * Application Code
     I                                       11  16 ZA0004
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           B2ASD8           PFS Batch Date
     C                     KFLD           B2AOTS           PFS Batch Time
      * Setup key
     C           #2ASD8    IFEQ *ZERO
     C                     MOVEL*HIVAL    B2ASD8           PFS Batch Date
     C                     ELSE
     C                     Z-ADD#2ASD8    B2ASD8
     C                     ENDIF
     C           #2AOTS    IFEQ *ZERO
     C                     MOVEL*HIVAL    B2AOTS           PFS Batch Time
     C                     ELSE
     C                     Z-ADD#2AOTS    B2AOTS
     C                     ENDIF
     C           KPOS      SETLL@B2CPUX
     C                     READ @B2CPUX                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2APTS    WZAPTS
     C                     MOVEL#2APTS    WZAPTS           PFS Batch Sent
     C           *LIKE     DEFN #2B0SC    WZB0SC
     C                     MOVEL#2B0SC    WZB0SC           PFS Baseline Sc
     C           *LIKE     DEFN #2AOTS    WZAOTS
     C                     MOVEL#2AOTS    WZAOTS           PFS Batch Time
     C           *LIKE     DEFN #2UWSX    WZUWSX
     C                     MOVEL#2UWSX    WZUWSX           PFS Record Stat
     C           *LIKE     DEFN #2Y1NX    WZY1NX
     C                     MOVEL#2Y1NX    WZY1NX           PFS Company Num
     C           *LIKE     DEFN #2ATD8    WZATD8
     C                     MOVEL#2ATD8    WZATD8           PFS Batch Sent
     C           *LIKE     DEFN #2ASD8    WZASD8
     C                     MOVEL#2ASD8    WZASD8           PFS Batch Date
     C           *LIKE     DEFN #2TVAA    WZTVAA
     C                     MOVEL#2TVAA    WZTVAA           PFS User ID
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@B2CPUX                  90*
     C  N82                READ @B2CPUX                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,35
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2APTS    IFNE *ZERO                      PFS Batch Sent
     C           B2APTS    CABNE#2APTS    BB020            PFS Batch Sent
     C                     END
     C           #2B0SC    IFNE *BLANK                     PFS Baseline Sc
     C           B2B0SC    CABNE#2B0SC    BB020            PFS Baseline Sc
     C                     END
     C           #2ASD8    IFEQ *ZERO                      PFS Batch Date
     C           #2AOTS    IFNE *ZERO                      PFS Batch Time
     C           B2AOTS    CABNE#2AOTS    BB020            PFS Batch Time
     C                     END
     C                     END
     C           #2UWSX    IFNE *BLANK                     PFS Record Stat
     C           B2UWSX    CABNE#2UWSX    BB020            PFS Record Stat
     C                     END
     C           #2Y1NX    IFNE *ZERO                      PFS Company Num
     C           B2Y1NX    CABNE#2Y1NX    BB020            PFS Company Num
     C                     END
     C           #2ATD8    IFNE *ZERO                      PFS Batch Sent
     C           B2ATD8    CABGT#2ATD8    BB020            PFS Batch Sent
     C                     END
     C           #2TVAA    IFNE *BLANK                     PFS User ID
     C           B2TVAA    CABNE#2TVAA    BB020            PFS User ID
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
      * Process Status Description
      * CASE: RCD.PFS Process Status is Selection
     C           #1UXSX    IFEQ 4                          *IF
     C                     MOVEL@CN,001   #RD9U1           Process Status
     C                     ELSE
      * CASE: RCD.PFS Process Status is Not Sent-Voided
     C           #1UXSX    IFEQ 5                          *IF
     C                     MOVEL@CN,002   #RD9U1           Process Status
     C                     ELSE
      * CASE: RCD.PFS Process Status is Ready to Send
     C           #1UXSX    IFEQ 6                          *IF
     C                     MOVEL@CN,003   #RD9U1           Process Status
     C                     ELSE
      * CASE: RCD.PFS Process Status is Send InProcess
     C           #1UXSX    IFEQ 7                          *IF
     C                     MOVEL@CN,004   #RD9U1           Process Status
     C                     ELSE
      * CASE: RCD.PFS Process Status is Sent
     C           #1UXSX    IFEQ 9                          *IF
     C                     MOVEL*BLANK    #RD9U1           Process Status
     C                     MOVEL'Sent'    #RD9U1           Process Status
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RD9U1           Process Status
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C                     READ @B2CPUX                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate PFS Batch Sent Date
      * External date
     C                     Z-ADDV2ATD8    XDEXDT
      * Check date
     C                     EXSR XDC84
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDXDI8DT    #2ATD8
      * Validate PFS Batch Date
      * External date
     C                     Z-ADDV2ASD8    XDEXDT
      * Check date
     C                     EXSR XDC84
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
     C                     Z-ADDXDI8DT    #2ASD8
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    CABNE*BLANKS   DATAG1
      * Change of position specified
     C           WZY1NX    CASNE#2Y1NX    FBRQRL
     C           WZATD8    CASNE#2ATD8    FBRQRL
     C           WZASD8    CASNE#2ASD8    FBRQRL
     C           WZTVAA    CASNE#2TVAA    FBRQRL
     C                     END
     C           DATAG1    TAG
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
      * F5=Refresh
      * CASE: CTL.*CMD key is CF05
     C           *IN05     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * F6=Create
      * CASE: CTL.*CMD key is *Create
     C           *IN06     IFEQ '1'                        *IF
      * Pmt PFS Prd Sch Bt Hd PV - PFS Prod Sched Batch Hdr  * 
     C                     CALL 'PBR9PVR'              90  Pmt PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C           YL0001    PARM *ZERO     WQ0001  30       PFS Company Num
     C           YL0002    PARM *ZERO     WQ0002  80       PFS Batch Date
     C           YL0003    PARM *ZERO     WQ0003  60       PFS Batch Time
     C           YL0004    PARM *BLANK    WQ0004 10        PFS User ID
     C           YL0005    PARM *BLANK    WQ0005  1        PFS Baseline Sc
     C           YL0006    PARM *BLANK    WQ0006  1        PFS Prod Sch Cr
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBR9PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: LCL.PFS Prod Sch Created USR is Yes
     C           YL0006    IFEQ 'Y'                        *IF
      * CASE: LCL.PFS Baseline Schedule is Baseline
     C           YL0005    IFEQ 'B'                        *IF
      * Convert PFS Create Date to YYYYMMDD
      * Rtv System Date *CYMD IF
      * LCL.*System timestamp = JOB.*System timestamp
     C                     EXSR XSTMS
     C                     MOVEL##TMS     YL0008           *System timesta
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0009    P  90  Year USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD6         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0010    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0011    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD0         ZQ      50
     C           YL0009    CAT  YL0010:ZQ YL0012    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           YL0012    CAT  YL0011:ZQ YL0012    P      Date (Char-8) U
     C                     MOVE YL0012    YL0013           DATE
      *
     C                     Z-ADD*ZERO     WN0001  40       Year Code
     C                     Z-ADD*ZERO     WN0002  20       Month
     C                     Z-ADD*ZERO     WN0003  20       Day of Month US
     C                     MOVEL*BLANK    WN0004  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0005  2        Month (Char) US
     C                     MOVEL*BLANK    WN0006  2        Day   (Char) US
     C                     Z-ADD*ZERO     WN0007  20       Year  NBR USR
     C                     MOVEL*BLANK    WN0008  2        Year  (Char) US
     C                     MOVEL*BLANK    WN0009  7        Date (Alpha) US
      *
      * CVT *YYMD to *CYMD    IF
      * ** YEAR **
     C           YL0013    DIV  10000     WN0001           Year Code
     C                     Z-ADDWN0001    WN0007           Year  NBR USR
     C                     MOVELWN0007    WN0008           Year  (Char) US
      * ** MONTH **
     C           YL0013    DIV  100       WN0002           Month
     C                     MOVELWN0002    WN0005           Month (Char) US
      * ** DAY **
     C                     Z-ADDYL0013    WN0003           Day of Month US
     C                     MOVELWN0003    WN0006           Day   (Char) US
      * CENTURY+YEAR
      * CASE: PAR.Year Code is Twentieth Century
     C           WN0001    IFLE 1999                       *IF
     C                     Z-ADD0         ZQ      50
     C           '0'       CAT  WN0008:ZQ WN0009    P      Date (Alpha) US
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD0         ZQ      50
     C           '1'       CAT  WN0008:ZQ WN0009    P      Date (Alpha) US
     C                     END                             *FI
     C                     Z-ADD0         ZQ      50
     C           WN0009    CAT  WN0005:ZQ WN0009    P      Date (Alpha) US
     C                     Z-ADD0         ZQ      50
     C           WN0009    CAT  WN0006:ZQ WN0009    P      Date (Alpha) US
     C                     MOVE WN0009    YL0007           Date
      *
     C                     MOVEL*BLANK    WN0010  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0011  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0012  2        Month (Char) US
     C                     MOVEL*BLANK    WN0013  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           YL0007    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0015
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0016
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0017
     C                     MOVEL*BLANK    WN0011           Year Alpha (YYY
     C                     MOVELYL0015    WN0011           Year Alpha (YYY
     C                     MOVELYL0016    WN0012           Month (Char) US
     C                     MOVELYL0017    WN0013           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0011    CAT  WN0012:ZQ WN0010    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0010    CAT  WN0013:ZQ WN0010    P      Date (Char-8) U
     C                     MOVE WN0010    YL0014           Date Out (8,0)
      * Crt PFS Prd Sch Bt Sl XF - Company Item  * 
     C                     CALL 'PBSCXFR'              90  Crt PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0007  30       Company Number
     C                     PARM YL0002    WQ0008  80       PFS Batch Date
     C                     PARM YL0003    WQ0009  60       PFS Batch Time
     C                     PARM YL0004    WQ0010 10        PFS User ID
     C                     PARM YL0014    WQ0011  80       PFS Create Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSCXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * WW PFS Prd Sch Bt Sl  DF - Company Item  * 
     C                     CALL 'PBR8DFR'              90  WW PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0012  30       PFS Company Num
     C                     PARM YL0002    WQ0013  80       PFS Batch Date
     C                     PARM YL0003    WQ0014  60       PFS Batch Time
     C                     PARM YL0004    WQ0015 10        PFS User ID
     C                     PARM YL0005    WQ0016  1        PFS Baseline Sc
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBR8DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Prod Schd Batch Sent
     C           W0RTN     IFEQ @CN,006                    *IF
      * Send message 'PFS Prd Sch Bt Rdy to Snd'
     C                     MOVEL'USR4825' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * F8=Dsp Prod Sched
      * CASE: CTL.*CMD key is CF08
     C           *IN08     IFEQ '1'                        *IF
      * Convert PFS Batch  Date to YYYYMMDD
      * Rtv System Date *CYMD IF
      * LCL.*System timestamp = JOB.*System timestamp
     C                     EXSR XSTMS
     C                     MOVEL##TMS     YL0008           *System timesta
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0009    P  90  Year USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD6         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0010    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0011    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD0         ZQ      50
     C           YL0009    CAT  YL0010:ZQ YL0012    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           YL0012    CAT  YL0011:ZQ YL0012    P      Date (Char-8) U
     C                     MOVE YL0012    YL0013           DATE
      *
     C                     Z-ADD*ZERO     WN0014  40       Year Code
     C                     Z-ADD*ZERO     WN0015  20       Month
     C                     Z-ADD*ZERO     WN0016  20       Day of Month US
     C                     MOVEL*BLANK    WN0017  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0018  2        Month (Char) US
     C                     MOVEL*BLANK    WN0019  2        Day   (Char) US
     C                     Z-ADD*ZERO     WN0020  20       Year  NBR USR
     C                     MOVEL*BLANK    WN0021  2        Year  (Char) US
     C                     MOVEL*BLANK    WN0022  7        Date (Alpha) US
      *
      * CVT *YYMD to *CYMD    IF
      * ** YEAR **
     C           YL0013    DIV  10000     WN0014           Year Code
     C                     Z-ADDWN0014    WN0020           Year  NBR USR
     C                     MOVELWN0020    WN0021           Year  (Char) US
      * ** MONTH **
     C           YL0013    DIV  100       WN0015           Month
     C                     MOVELWN0015    WN0018           Month (Char) US
      * ** DAY **
     C                     Z-ADDYL0013    WN0016           Day of Month US
     C                     MOVELWN0016    WN0019           Day   (Char) US
      * CENTURY+YEAR
      * CASE: PAR.Year Code is Twentieth Century
     C           WN0014    IFLE 1999                       *IF
     C                     Z-ADD0         ZQ      50
     C           '0'       CAT  WN0021:ZQ WN0022    P      Date (Alpha) US
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD0         ZQ      50
     C           '1'       CAT  WN0021:ZQ WN0022    P      Date (Alpha) US
     C                     END                             *FI
     C                     Z-ADD0         ZQ      50
     C           WN0022    CAT  WN0018:ZQ WN0022    P      Date (Alpha) US
     C                     Z-ADD0         ZQ      50
     C           WN0022    CAT  WN0019:ZQ WN0022    P      Date (Alpha) US
     C                     MOVE WN0022    YL0007           Date
      *
     C                     MOVEL*BLANK    WN0023  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0024  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0025  2        Month (Char) US
     C                     MOVEL*BLANK    WN0026  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           YL0007    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0015
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0016
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0017
     C                     MOVEL*BLANK    WN0024           Year Alpha (YYY
     C                     MOVELYL0015    WN0024           Year Alpha (YYY
     C                     MOVELYL0016    WN0025           Month (Char) US
     C                     MOVELYL0017    WN0026           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0024    CAT  WN0025:ZQ WN0023    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0023    CAT  WN0026:ZQ WN0023    P      Date (Char-8) U
     C                     MOVE WN0023    YL0002           Date Out (8,0)
      * Dsp PFS Prd Sch Bt Dt DF - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PBSODFR'              90  Dsp PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM 360       WQ0017  30       PFS Company Num
     C                     PARM YL0002    WQ0018  80       PFS Batch Date
     C                     PARM 115900    WQ0019  60       PFS Batch Time
     C                     PARM 'A'       WQ0020  1        Display View Us
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSODFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98    *
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * USER: Process subfile record (Pre-confirm)
      * 2=Edit
      * CASE: RCD.*SFLSEL is *Edit
     C           #1SEL     IFEQ '2'                        *IF
     C           #1SEL     OREQ ' 2'
      * CASE: RCD.PFS User ID EQ JOB.*USER
     C           #1TVAA    IFEQ ##USR                      *IF
      * CASE:
      *  - c1 OR c2
      *   |- c1    : RCD.PFS Process Status is Selection
      *   |- c2    : RCD.PFS Process Status is Ready to Send
      *   '-
     C           #1UXSX    IFEQ 4                          *IF
     C           #1UXSX    OREQ 6                          *OR
      * WW PFS Prd Sch Bt Sl  DF - Company Item  * 
     C                     CALL 'PBR8DFR'              90  WW PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1Y1NX    WQ0021  30       PFS Company Num
     C                     PARM #1ASD8    WQ0022  80       PFS Batch Date
     C                     PARM #1AOTS    WQ0023  60       PFS Batch Time
     C                     PARM #1TVAA    WQ0024 10        PFS User ID
     C                     PARM #1B0SC    WQ0025  1        PFS Baseline Sc
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBR8DFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      * CASE: PGM.*Return code is Prod Schd Batch Sent
     C           W0RTN     IFEQ @CN,006                    *IF
      * Send message 'PFS Prd Sch Bt Create'
     C                     MOVEL'USR4827' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Edt Allowed if Selection'
     C                     MOVEL'USR4816' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'PFS Prd Sch Bt Edit Alw'
     C                     MOVEL'USR4826' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C                     END                             *FI
      * 4=Delete
      * CASE: RCD.*SFLSEL is *Delete#1
     C           #1SEL     IFEQ '4'                        *IF
      * CASE: RCD.PFS User ID EQ JOB.*USER
     C           #1TVAA    IFEQ ##USR                      *IF
      * CASE:
      *  - c1 OR c2
      *   |- c1    : RCD.PFS Process Status is Send InProcess
      *   |- c2    : RCD.PFS Process Status is Sent
      *   '-
     C           #1UXSX    IFEQ 7                          *IF
     C           #1UXSX    OREQ 9                          *OR
      * Send message 'Del N/Allowed After Sent'
     C                     MOVEL'USR4815' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     ELSE
      * CASE: *OTHERWISE
      * Delete PFS Prod Sched Batch Sel
      * DeA PFS Prd Sch Bt SL RT - PFS Prod Sched Batch Sel  * 
     C                     EXSR SARVGN
      * Delete PFS Prod Sched Batch Hdr
      * Del PFS Prd Sch Bt Hd DL - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SCDLRC
      * E6235 JJH 06/23/16 - Delete all PFS Prod Sched Batch Hdr records.
      * DeA PFS Prd Sch Bt Dt RT - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'PFS Prd Sch Bt Delete Alw'
     C                     MOVEL'USR4829' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C                     END                             *FI
      * 5=Dsp Selection
      * CASE: RCD.*SFLSEL is *5
     C           #1SEL     IFEQ '5'                        *IF
      * Dsp PFS Prd Sch Bt Sl DF - Company Item  * 
     C                     CALL 'PBSDDFR'              90  Dsp PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1Y1NX    WQ0026  30       PFS Company Num
     C                     PARM #1ASD8    WQ0027  80       PFS Batch Date
     C                     PARM #1AOTS    WQ0028  60       PFS Batch Time
     C                     PARM #1TVAA    WQ0029 10        PFS User ID
     C                     PARM #1B0SC    WQ0030  1        PFS Baseline Sc
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSDDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
      * 6=Prt Sched
      * CASE: RCD.*SFLSEL is *6
     C           #1SEL     IFEQ '6'                        *IF
      * CASE: RCD.PFS Process Status is Not Sent-Voided
     C           #1UXSX    IFEQ 5                          *IF
      * Send message 'PFS Prod Sched Rpt N/Prt'
     C                     MOVEL'USR4853' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Prt PFS Prd Sch Bt Dt PF - PFS Prod Sched Batch Dtl  * 
     C                     CLEARPARC
     C                     Z-ADD#1Y1NX    PAY1NX           PFS Company Num
     C                     Z-ADD#1ASD8    PAASD8           PFS Batch Date
     C                     Z-ADD#1AOTS    PAAOTS           PFS Batch Time
      *
     C                     CALL 'PBSTPFR'              90  Prt PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: PFS Prod S
     C                     PARM #1TVAA    WQ0031 10        PFS User ID
     C                     PARM #1B0SC    WQ0032  1        PFS Baseline Sc
     C                     PARM #1UXSX    WQ0033  10       PFS Process Sta
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSTPFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * Send message 'PFS Prod Sched Bc Printed'
     C                     MOVEL'USR4852' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     END                             *FI
      * 7=Dsp Prod Sched
      * CASE: RCD.*SFLSEL is *7
     C           #1SEL     IFEQ '7'                        *IF
      * CASE:
      *  - c1 OR c2 OR c3
      *   |- c1    : RCD.PFS Process Status is Ready to Send
      *   |- c2    : RCD.PFS Process Status is Send InProcess
      *   |- c3    : RCD.PFS Process Status is Sent
      *   '-
     C           #1UXSX    IFEQ 6                          *IF
     C           #1UXSX    OREQ 7                          *OR
     C           #1UXSX    OREQ 9                          *OR
      * Dsp PFS Prd Sch Bt1Dt DF - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PBSSDFR'              90  Dsp PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1Y1NX    WQ0034  30       PFS Company Num
     C                     PARM #1ASD8    WQ0035  80       PFS Batch Date
     C                     PARM #1AOTS    WQ0036  60       PFS Batch Time
     C                     PARM 'S'       WQ0037  1        Display View Us
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSSDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'PFS Prd Sch Bch Not Crt'
     C                     MOVEL'USR4840' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C                     END                             *FI
      * 8=Send
      * CASE: RCD.*SFLSEL is *8
     C           #1SEL     IFEQ '8'                        *IF
      * CASE: RCD.PFS User ID EQ JOB.*USER
     C           #1TVAA    IFEQ ##USR                      *IF
      * CASE: RCD.PFS Process Status is Ready to Send
     C           #1UXSX    IFEQ 6                          *IF
      * Ex1 PFS Prd Sch Bt Sl RT - PFS Prod Sched Batch Sel  * 
     C                     EXSR SFRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Convert PFS Change Date to YYYYMMDD
      * Rtv System Date *CYMD IF
      * LCL.*System timestamp = JOB.*System timestamp
     C                     EXSR XSTMS
     C                     MOVEL##TMS     YL0008           *System timesta
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0009    P  90  Year USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD6         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0010    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0008:ZQ YL0011    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD0         ZQ      50
     C           YL0009    CAT  YL0010:ZQ YL0012    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           YL0012    CAT  YL0011:ZQ YL0012    P      Date (Char-8) U
     C                     MOVE YL0012    YL0013           DATE
      *
     C                     Z-ADD*ZERO     WN0027  40       Year Code
     C                     Z-ADD*ZERO     WN0028  20       Month
     C                     Z-ADD*ZERO     WN0029  20       Day of Month US
     C                     MOVEL*BLANK    WN0030  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0031  2        Month (Char) US
     C                     MOVEL*BLANK    WN0032  2        Day   (Char) US
     C                     Z-ADD*ZERO     WN0033  20       Year  NBR USR
     C                     MOVEL*BLANK    WN0034  2        Year  (Char) US
     C                     MOVEL*BLANK    WN0035  7        Date (Alpha) US
      *
      * CVT *YYMD to *CYMD    IF
      * ** YEAR **
     C           YL0013    DIV  10000     WN0027           Year Code
     C                     Z-ADDWN0027    WN0033           Year  NBR USR
     C                     MOVELWN0033    WN0034           Year  (Char) US
      * ** MONTH **
     C           YL0013    DIV  100       WN0028           Month
     C                     MOVELWN0028    WN0031           Month (Char) US
      * ** DAY **
     C                     Z-ADDYL0013    WN0029           Day of Month US
     C                     MOVELWN0029    WN0032           Day   (Char) US
      * CENTURY+YEAR
      * CASE: PAR.Year Code is Twentieth Century
     C           WN0027    IFLE 1999                       *IF
     C                     Z-ADD0         ZQ      50
     C           '0'       CAT  WN0034:ZQ WN0035    P      Date (Alpha) US
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD0         ZQ      50
     C           '1'       CAT  WN0034:ZQ WN0035    P      Date (Alpha) US
     C                     END                             *FI
     C                     Z-ADD0         ZQ      50
     C           WN0035    CAT  WN0031:ZQ WN0035    P      Date (Alpha) US
     C                     Z-ADD0         ZQ      50
     C           WN0035    CAT  WN0032:ZQ WN0035    P      Date (Alpha) US
     C                     MOVE WN0035    YL0007           Date
      *
     C                     MOVEL*BLANK    WN0036  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0037  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0038  2        Month (Char) US
     C                     MOVEL*BLANK    WN0039  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           YL0007    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0015
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0016
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           YL0007    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0017
     C                     MOVEL*BLANK    WN0037           Year Alpha (YYY
     C                     MOVELYL0015    WN0037           Year Alpha (YYY
     C                     MOVELYL0016    WN0038           Month (Char) US
     C                     MOVELYL0017    WN0039           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0037    CAT  WN0038:ZQ WN0036    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0036    CAT  WN0039:ZQ WN0036    P      Date (Char-8) U
     C                     MOVE WN0036    YL0018           Date Out (8,0)
      * Initialize PFS Prod Sched Batch Dtl fields
     C                     Z-ADD##JTM     YL0019           PFS Batch Sent
     C                     MOVEL##USR     YL0004           PFS User ID
     C                     Z-ADDYL0018    YL0020           PFS Change Date
     C                     Z-ADDYL0019    YL0021           PFS Change time
      * Convert Numeric Fields to Alpha Fields
     C                     MOVEL#1Y1NX    YL0022           PFS Company Num
     C                     MOVEL#1ASD8    YL0023           PFS Batch Date
     C                     MOVEL#1AOTS    YL0024           PFS Batch Time
      * CPYF PBB1CPP to PBB1CPPGUY or PBB1CPPSTJ
      * IJS PFS Prd Sch Bt Dt CL - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PBS3UPR'              90  IJS PFS Prd Sch
     C                     PARM YL0022    WQ0038  3        PFS Company Num
     C                     PARM YL0023    WQ0039  8        PFS Batch Date
     C                     PARM YL0024    WQ0040  6        PFS Batch Time
     C                     PARM YL0004    WQ0041 10        PFS User ID
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBS3UPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     END
      * Update PFS Prod Sched Batch Hdr
      * Chg PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SGRVGN
      * Reload subfile and send message
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      * Send message 'PFS Prd Sch Bt Sent'
     C                     MOVEL'USR4854' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
      * E7663 JJH 10/25/16 - PFS Prod Sched Batch Cgn
      * Crt PFS Prd Sch Bt Cg RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SIRVGN
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
      * Send message 'PFS Prd Sch Bt Sl No Rcds'
     C                     MOVEL'USR4820' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
      * Send message 'PFS Prod Sch Bt RdyToSnd'
     C                     MOVEL'USR4819' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
      * Send message 'PFS Prd Sch Bt Send Alw'
     C                     MOVEL'USR4828' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
      * SFLNXTCHG
     C                     SETON                     84
     C                     ELSE
      * SFLRCD valid
      * SFLNXTCHG
     C                     SETOF                     84
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN79
     C           #1ATD8    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN78
     C           #1APTS    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @B2CPUX fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     MOVELB2UWSX    #1UWSX           PFS Record Stat
     C                     Z-ADDB2UXSX    #1UXSX           PFS Process Sta
     C                     MOVELB2V3SX    #1V3SX           PFS Error Reaso
     C                     Z-ADDB2AHNY    #1AHNY           PFS Create Date
     C                     Z-ADDB2AINY    #1AINY           PFS Create Time
     C                     Z-ADDB2AJNY    #1AJNY           PFS Change Date
     C                     Z-ADDB2AKNY    #1AKNY           PFS Change time
     C                     Z-ADDB2Y1NX    #1Y1NX           PFS Company Num
     C                     Z-ADDB2ATD8    #1ATD8           PFS Batch Sent
      * Clear external version also
     C                     Z-ADD*ZERO     V1ATD8
     C                     Z-ADDB2APTS    #1APTS           PFS Batch Sent
     C                     Z-ADDB2ASD8    #1ASD8           PFS Batch Date
      * Clear external version also
     C                     Z-ADD*ZERO     V1ASD8
     C                     Z-ADDB2AOTS    #1AOTS           PFS Batch Time
     C                     MOVELB2TVAA    #1TVAA           PFS User ID
     C                     MOVELB2B0SC    #1B0SC           PFS Baseline Sc
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RD9U1           Process Status
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADD*ZERO     #2APTS           PFS Batch Sent
     C                     MOVEL*BLANK    #2B0SC           PFS Baseline Sc
     C                     Z-ADD*ZERO     #2AOTS           PFS Batch Time
     C                     MOVEL*BLANK    #2UWSX           PFS Record Stat
     C                     Z-ADD*ZERO     #2Y1NX           PFS Company Num
     C                     Z-ADD*ZERO     #2ATD8           PFS Batch Sent
      * Clear external version also
     C                     Z-ADD*ZERO     V2ATD8
     C                     Z-ADD*ZERO     #2ASD8           PFS Batch Date
      * Clear external version also
     C                     Z-ADD*ZERO     V2ASD8
     C                     MOVEL*BLANK    #2TVAA           PFS User ID
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert PFS Batch Sent Date to display format
      * Convert date
     C                     Z-ADD#1ATD8    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    V1ATD8
      * Convert PFS Batch Date to display format
      * Convert date
     C                     Z-ADD#1ASD8    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    V1ASD8
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert PFS Batch Sent Date to display format
      * Convert date
     C                     Z-ADD#2ATD8    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    V2ATD8
      * Convert PFS Batch Date to display format
      * Convert date
     C                     Z-ADD#2ASD8    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    V2ASD8
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * DeA PFS Prd Sch Bt SL RT - PFS Prod Sched Batch Sel  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * E3787 JJH 08/07/15 - This function deletes all PFS Prod Sched
      *   Batch Sel records for this PFS Production Schedule Batch.
      * Declare restrictor key work fields
     C           *LIKE     DEFN B3Y1NX    WQSA01           PFS Company Num
     C           *LIKE     DEFN B3ASD8    WQSA02           PFS Batch Date
     C           *LIKE     DEFN B3AOTS    WQSA03           PFS Batch Time
     C           *LIKE     DEFN B3TVAA    WQSA04           PFS User ID
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
     C                     KFLD           WQSA02           PFS Batch Date
     C                     KFLD           WQSA03           PFS Batch Time
     C                     KFLD           WQSA04           PFS User ID
      * Setup key
     C                     Z-ADD#1Y1NX    WQSA01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSA02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSA03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSA04           PFS User ID
      * Establish starting position
     C           KRSSA     SETLL@B3CPUW                    *
     C           KRSSA     READE@B3CPUW                  90*
      * Data record not found
     C   90                MOVEL'USR4808' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Del PFS Prd Sch Bt Sl DL - PFS Prod Sched Batch Sel  * 
     C                     EXSR SBDLRC
     C           KRSSA     READE@B3CPUW                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * Del PFS Prd Sch Bt Sl DL - PFS Prod Sched Batch Sel  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @B3CPUV
     C                     Z-ADDB3Y1NX    WAY1NX           PFS Company Num
     C                     Z-ADDB3ASD8    WAASD8           PFS Batch Date
     C                     Z-ADDB3AOTS    WAAOTS           PFS Batch Time
     C                     MOVELB3TVAA    WATVAA           PFS User ID
     C                     Z-ADDB3DNNB    WADNNB           PFS Item Struct
     C                     Z-ADDB3DONB    WADONB           PFS Item Struct
      *
     C           KLDLSB    KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAASD8           PFS Batch Date
     C                     KFLD           WAAOTS           PFS Batch Time
     C                     KFLD           WATVAA           PFS User ID
     C                     KFLD           WADNNB           PFS Item Struct
     C                     KFLD           WADONB           PFS Item Struct
     C           KLDLSB    CHAIN@B3CPUV              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PBB3CPL0'MDACP
     C                     MOVEL'@B3CPUV' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@B3CPUV                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * Del PFS Prd Sch Bt Hd DL - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @B2CPUP
     C                     Z-ADD#1Y1NX    WBY1NX           PFS Company Num
     C                     Z-ADD#1ASD8    WBASD8           PFS Batch Date
     C                     Z-ADD#1AOTS    WBAOTS           PFS Batch Time
     C                     MOVEL#1TVAA    WBTVAA           PFS User ID
      *
     C           KLDLSC    KLIST
     C                     KFLD           WBY1NX           PFS Company Num
     C                     KFLD           WBASD8           PFS Batch Date
     C                     KFLD           WBAOTS           PFS Batch Time
     C                     KFLD           WBTVAA           PFS User ID
     C           KLDLSC    CHAIN@B2CPUP              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PBB2CPL0'MDACP
     C                     MOVEL'@B2CPUP' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@B2CPUP                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * DeA PFS Prd Sch Bt Dt RT - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN B1Y1NX    WQSD01           PFS Company Num
     C           *LIKE     DEFN B1ASD8    WQSD02           PFS Batch Date
     C           *LIKE     DEFN B1AOTS    WQSD03           PFS Batch Time
     C           *LIKE     DEFN B1TVAA    WQSD04           PFS User ID
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           PFS Company Num
     C                     KFLD           WQSD02           PFS Batch Date
     C                     KFLD           WQSD03           PFS Batch Time
     C                     KFLD           WQSD04           PFS User ID
      * Setup key
     C                     Z-ADD#1Y1NX    WQSD01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSD02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSD03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSD04           PFS User ID
      * Establish starting position
     C           KRSSD     SETLL@B1CPUT                    *
     C           KRSSD     READE@B1CPUT                  90*
      * Data record not found
     C   90                MOVEL'USR4804' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Del PFS Prd Sch Bt Dt DL - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SEDLRC
     C           KRSSD     READE@B1CPUT                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SEDLRC    BEGSR
      *================================================================
      * Del PFS Prd Sch Bt Dt DL - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @B1CPUS
     C                     Z-ADDB1Y1NX    WCY1NX           PFS Company Num
     C                     Z-ADDB1ASD8    WCASD8           PFS Batch Date
     C                     Z-ADDB1AOTS    WCAOTS           PFS Batch Time
     C                     MOVELB1TVAA    WCTVAA           PFS User ID
     C                     Z-ADDB1BTSQ    WCBTSQ           PFS Batch Seq
      *
     C           KLDLSE    KLIST
     C                     KFLD           WCY1NX           PFS Company Num
     C                     KFLD           WCASD8           PFS Batch Date
     C                     KFLD           WCAOTS           PFS Batch Time
     C                     KFLD           WCTVAA           PFS User ID
     C                     KFLD           WCBTSQ           PFS Batch Seq
     C           KLDLSE    CHAIN@B1CPUS              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PBB1CPL0'MDACP
     C                     MOVEL'@B1CPUS' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@B1CPUS                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Ex1 PFS Prd Sch Bt Sl RT - PFS Prod Sched Batch Sel  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * This function is used to determine if at least 1 record exists
      * for the PFS Prod Sched Batch Hdr.
      * Declare restrictor key work fields
     C           *LIKE     DEFN B3Y1NX    WQSF01           PFS Company Num
     C           *LIKE     DEFN B3ASD8    WQSF02           PFS Batch Date
     C           *LIKE     DEFN B3AOTS    WQSF03           PFS Batch Time
     C           *LIKE     DEFN B3TVAA    WQSF04           PFS User ID
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           PFS Company Num
     C                     KFLD           WQSF02           PFS Batch Date
     C                     KFLD           WQSF03           PFS Batch Time
     C                     KFLD           WQSF04           PFS User ID
      * Setup key
     C                     Z-ADD#1Y1NX    WQSF01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSF02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSF03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSF04           PFS User ID
      * Establish starting position
     C           KRSSF     SETLL@B3CPUW                    *
     C           KRSSF     READE@B3CPUW                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4808' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SFEXIT                     *QUIT
     C           KRSSF     READE@B3CPUW                  90*
     C                     ENDDO
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Chg PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WDY1NX           PFS Company Num
     C                     KFLD           WDASD8           PFS Batch Date
     C                     KFLD           WDAOTS           PFS Batch Time
     C                     KFLD           WDTVAA           PFS User ID
      * Setup key
     C                     Z-ADD#1Y1NX    WDY1NX           PFS Company Num
     C                     Z-ADD#1ASD8    WDASD8           PFS Batch Date
     C                     Z-ADD#1AOTS    WDAOTS           PFS Batch Time
     C                     MOVEL#1TVAA    WDTVAA           PFS User ID
      * Establish starting position
     C           KRSSG     CHAIN@B2CPUQ              90    *
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg PFS Prd Sch Bt Hd CH - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SHCHRC
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Chg PFS Prd Sch Bt Hd CH - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @B2CPUP
     C                     Z-ADDWDY1NX    WBY1NX           PFS Company Num
     C                     Z-ADDWDASD8    WBASD8           PFS Batch Date
     C                     Z-ADDWDAOTS    WBAOTS           PFS Batch Time
     C                     MOVELWDTVAA    WBTVAA    P      PFS User ID
      *
     C           KLCHSH    KLIST
     C                     KFLD           WBY1NX           PFS Company Num
     C                     KFLD           WBASD8           PFS Batch Date
     C                     KFLD           WBAOTS           PFS Batch Time
     C                     KFLD           WBTVAA           PFS User ID
     C           KLCHSH    CHAIN@B2CPUP              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PBB2CPL0'MDACP
     C                     MOVEL'@B2CPUP' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPBB21    YARDCS
      * Move non-key fields to @B2CPUP
     C                     MOVELWDB0SC    WBB0SC    P      PFS Baseline Sc
     C                     Z-ADDYL0018    WBATD8           PFS Batch Sent
     C                     Z-ADDYL0019    WBAPTS           PFS Batch Sent
     C                     MOVELWDUWSX    WBUWSX    P      PFS Record Stat
     C                     Z-ADD9         WBUXSX           PFS Process Sta
     C                     MOVELWDV3SX    WBV3SX    P      PFS Error Reaso
     C                     Z-ADDWDAHNY    WBAHNY           PFS Create Date
     C                     Z-ADDWDAINY    WBAINY           PFS Create Time
     C                     Z-ADDYL0020    WBAJNY           PFS Change Date
     C                     Z-ADDYL0021    WBAKNY           PFS Change time
      *
      * Set PGM.*Record Data Changed flag
     C           QPBB21    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@B2CPUP                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPBB2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WDY1NX           PFS Company Num
     C                     KFLD           WDASD8           PFS Batch Date
     C                     KFLD           WDAOTS           PFS Batch Time
     C                     KFLD           WDTVAA           PFS User ID
      * Setup key
     C                     Z-ADD#1Y1NX    WDY1NX           PFS Company Num
     C                     Z-ADD#1ASD8    WDASD8           PFS Batch Date
     C                     Z-ADD#1AOTS    WDAOTS           PFS Batch Time
     C                     MOVEL#1TVAA    WDTVAA           PFS User ID
      * Establish starting position
     C           KRSSI     CHAIN@B2CPUQ              90    *
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Crt all PFS Prod Sched Batch Dtl records into PFS Prod Sched Batc
      * Cgs file.
      * Crt PFS Prd Sch Bt Cg RT - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SJRVGN
      * E12509 - Change logic to not write addtional records from
      *   the previous batch only if it is the 1st Baseline of the day.
      * Determine if we should update PFS Prod Sched Batch Cgn
      * CASE: DB1.PFS Baseline Schedule is Baseline
     C           WDB0SC    IFEQ 'B'                        *IF
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SLRVGN
      * CASE: LCL.PFS Baseline Schedule Cnt is Equal (1)
     C           YL0033    IFEQ 1                          *IF
      * Do Nothing
     C                     MOVEL'N'       YL0035           Upd Prod Sched
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       YL0035           Upd Prod Sched
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       YL0035           Upd Prod Sched
     C                     END                             *FI
      * Update PFS Prod Sched Batch Cgn
      * CASE: LCL.Upd Prod Sched Batch CGN is Yes
     C           YL0035    IFEQ 'Y'                        *IF
      * Determine the Previous PFS Prod Sched Batch Cgn
      * Rtv Prev ProdSchBtHdr RT - PFS Prod Sched Batch Hdr  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0041           PFS Company Num
     C                     Z-ADD#1ASD8    WL0042           PFS Batch Sent
     C                     Z-ADD235959    WL0043           PFS Batch Sent
     C                     EXSR SMRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0044    YL0036           PFS Company Num
     C                     Z-ADDWL0045    YL0037           PFS Batch Date
     C                     Z-ADDWL0046    YL0038           PFS Batch Time
     C                     MOVELWL0047    YL0039    P      PFS User ID
      * Crt all PFS Prod Sched Batch Dtl records into PFS Prod Sched Batc
      * Cgn file from the Previous Batch that are NOT in the PFS Prod Sch
      * Sel of Current Batch.
      * E12509 JJH 05/30/18 - New Logic to create PFS Prod Sched Cgn
      * Crt PFS Prd Sch Bt Cg RT2 - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SNRVGN
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg RT - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN B1Y1NX    WQSJ01           PFS Company Num
     C           *LIKE     DEFN B1ASD8    WQSJ02           PFS Batch Date
     C           *LIKE     DEFN B1AOTS    WQSJ03           PFS Batch Time
     C           *LIKE     DEFN B1TVAA    WQSJ04           PFS User ID
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           PFS Company Num
     C                     KFLD           WQSJ02           PFS Batch Date
     C                     KFLD           WQSJ03           PFS Batch Time
     C                     KFLD           WQSJ04           PFS User ID
      * Setup key
     C                     Z-ADDWDY1NX    WQSJ01           PFS Company Num
     C                     Z-ADDWDASD8    WQSJ02           PFS Batch Date
     C                     Z-ADDWDAOTS    WQSJ03           PFS Batch Time
     C                     MOVELWDTVAA    WQSJ04           PFS User ID
      * Establish starting position
     C           KRSSJ     SETLL@B1CPUT                    *
     C           KRSSJ     READE@B1CPUT                  90*
      * Data record not found
     C   90                MOVEL'USR4804' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDB1Y1NX    WL0001           PFS Company Num
     C                     Z-ADDB1ASD8    WL0002           PFS Batch Date
     C                     Z-ADDB1AOTS    WL0003           PFS Batch Time
     C                     MOVELB1TVAA    WL0004    P      PFS User ID
     C                     Z-ADDB1BTSQ    WL0005           PFS Batch Seq
     C                     Z-ADDB1P7DT    WL0006           PFS Production
     C                     Z-ADDB1Y2NX    WL0007           PFS Item Code
     C                     MOVELB1U2SX    WL0008    P      PFS Label Type
     C                     Z-ADDB1ZPNX    WL0009           PFS Order Numbe
     C                     Z-ADDB1ZXNX    WL0010           PFS Order Line
     C                     MOVELB1CSSC    WL0011    P      PFS Order Line
     C                     Z-ADDB1ODQY    WL0012           PFS Ordered Qty
     C                     Z-ADDB1INAL    WL0013           PFS Inventory A
     C                     Z-ADDB1C6NB    WL0014           PFS Fill Qty Pr
     C                     Z-ADDB1C8NB    WL0015           PFS Fill Qty Sh
     C                     Z-ADDB1FLQ1    WL0016           PFS Fill Qty Sh
     C                     Z-ADDB1FLQ2    WL0017           PFS Fill Qty Sh
     C                     Z-ADDB1ZGNX    WL0018           PFS Load ID
     C                     Z-ADDB1ZWNX    WL0019           PFS Loading Seq
     C                     Z-ADDB1ZSNX    WL0020           PFS Scheduled S
     C                     Z-ADDB1ZJNX    WL0021           PFS Load Deadli
     C                     Z-ADDB1ZKNX    WL0022           PFS Load Deadli
     C                     Z-ADDB1DNNB    WL0023           PFS Item Struct
     C                     Z-ADDB1DONB    WL0024           PFS Item Struct
     C                     Z-ADDB1DRNB    WL0025           PFS Item Struct
     C                     MOVELB1U0SX    WL0026    P      PFS Primary UOM
     C                     MOVELB1BZSC    WL0027    P      PFS Fresh/Froze
     C                     MOVELB1B3SC    WL0028    P      PFS Base/Conver
     C                     MOVELB1B0SC    WL0029    P      PFS Baseline Sc
     C                     MOVELB1VISX    WL0030    P      PFS Palletize
     C                     MOVELB1ZLSX    WL0031    P      PFS Pallet Type
     C                     MOVELB1VGSX    WL0032    P      PFS Slip Sheet
     C                     MOVELB1OJU1    WL0033    P      PFS Customer Na
     C                     MOVELB1UWSX    WL0034    P      PFS Record Stat
     C                     Z-ADDB1UXSX    WL0035           PFS Process Sta
     C                     MOVELB1V3SX    WL0036    P      PFS Error Reaso
     C                     Z-ADDB1AHNY    WL0037           PFS Create Date
     C                     Z-ADDB1AINY    WL0038           PFS Create Time
     C                     Z-ADDB1AJNY    WL0039           PFS Change Date
     C                     Z-ADDB1AKNY    WL0040           PFS Change time
     C                     EXSR SKCRRC
     C           KRSSJ     READE@B1CPUT                  90*
     C                     ENDDO
      * USER: Exit processing
      * PAR = DB1 By name
     C                     Z-ADDB1BTSQ    YL0025           PFS Batch Seq
     C                     MOVELB1UWSX    YL0026           PFS Record Stat
     C                     Z-ADDB1UXSX    YL0027           PFS Process Sta
     C                     MOVELB1V3SX    YL0028           PFS Error Reaso
     C                     Z-ADDB1AHNY    YL0029           PFS Create Date
     C                     Z-ADDB1AINY    YL0030           PFS Create Time
     C                     Z-ADDB1AJNY    YL0031           PFS Change Date
     C                     Z-ADDB1AKNY    YL0032           PFS Change time
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCRRC    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @C3CPY0
     C                     Z-ADDWL0001    C3Y1NX           PFS Company Num
     C                     Z-ADDWL0002    C3ASD8           PFS Batch Date
     C                     Z-ADDWL0003    C3AOTS           PFS Batch Time
     C                     MOVELWL0004    C3TVAA           PFS User ID
     C                     Z-ADDWL0005    C3BTSQ           PFS Batch Seq
     C                     Z-ADDWL0006    C3P7DT           PFS Production
     C                     Z-ADDWL0007    C3Y2NX           PFS Item Code
     C                     MOVELWL0008    C3U2SX           PFS Label Type
     C                     Z-ADDWL0009    C3ZPNX           PFS Order Numbe
     C                     Z-ADDWL0010    C3ZXNX           PFS Order Line
     C                     MOVELWL0011    C3CSSC           PFS Order Line
     C                     Z-ADDWL0012    C3ODQY           PFS Ordered Qty
     C                     Z-ADDWL0013    C3INAL           PFS Inventory A
     C                     Z-ADDWL0014    C3C6NB           PFS Fill Qty Pr
     C                     Z-ADDWL0015    C3C8NB           PFS Fill Qty Sh
     C                     Z-ADDWL0016    C3FLQ1           PFS Fill Qty Sh
     C                     Z-ADDWL0017    C3FLQ2           PFS Fill Qty Sh
     C                     Z-ADDWL0018    C3ZGNX           PFS Load ID
     C                     Z-ADDWL0019    C3ZWNX           PFS Loading Seq
     C                     Z-ADDWL0020    C3ZSNX           PFS Scheduled S
     C                     Z-ADDWL0021    C3ZJNX           PFS Load Deadli
     C                     Z-ADDWL0022    C3ZKNX           PFS Load Deadli
     C                     Z-ADDWL0023    C3DNNB           PFS Item Struct
     C                     Z-ADDWL0024    C3DONB           PFS Item Struct
     C                     Z-ADDWL0025    C3DRNB           PFS Item Struct
     C                     MOVELWL0026    C3U0SX           PFS Primary UOM
     C                     MOVELWL0027    C3BZSC           PFS Fresh/Froze
     C                     MOVELWL0028    C3B3SC           PFS Base/Conver
     C                     MOVELWL0029    C3B0SC           PFS Baseline Sc
     C                     MOVELWL0030    C3VISX           PFS Palletize
     C                     MOVELWL0031    C3ZLSX           PFS Pallet Type
     C                     MOVELWL0032    C3VGSX           PFS Slip Sheet
     C                     MOVELWL0033    C3OJU1           PFS Customer Na
     C                     MOVELWL0034    C3UWSX           PFS Record Stat
     C                     Z-ADDWL0035    C3UXSX           PFS Process Sta
     C                     MOVELWL0036    C3V3SX           PFS Error Reaso
     C                     Z-ADDWL0037    C3AHNY           PFS Create Date
     C                     Z-ADDWL0038    C3AINY           PFS Create Time
     C                     Z-ADDWL0039    C3AJNY           PFS Change Date
     C                     Z-ADDWL0040    C3AKNY           PFS Change time
      *
     C           KLCRSK    KLIST
     C                     KFLD           C3Y1NX           PFS Company Num
     C                     KFLD           C3ASD8           PFS Batch Date
     C                     KFLD           C3AOTS           PFS Batch Time
     C                     KFLD           C3TVAA           PFS User ID
     C                     KFLD           C3BTSQ           PFS Batch Seq
      * Check for duplicate primary key
     C           KLCRSK    SETLL@C3CPY0                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR4966' W0RTN   7
      * Send message 'PFS Prod Sched Batch C EX'
     C                     MOVEL'USR4966' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C                     WRITE@C3CPY0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0034           PFS Baseline Sc
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEY1NX    WQSL01           PFS Company Num
     C           *LIKE     DEFN WEASD8    WQSL02           PFS Batch Date
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           WQSL01           PFS Company Num
     C                     KFLD           WQSL02           PFS Batch Date
      * Setup key
     C                     Z-ADDWDY1NX    WQSL01           PFS Company Num
     C                     Z-ADDWDASD8    WQSL02           PFS Batch Date
      * Establish starting position
     C           KRSSL     SETLL@B2CPZE                    *
     C           KRSSL     READE@B2CPZE                  90*
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Baseline Schedule is Baseline
     C           WEB0SC    IFEQ 'B'                        *IF
     C                     ADD  1         YL0034           PFS Baseline Sc
     C                     END                             *FI
     C           KRSSL     READE@B2CPZE                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     Z-ADDYL0034    YL0033           PFS Baseline Sc
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Rtv Prev ProdSchBtHdr RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0040           Count USR
      * Declare restrictor key work fields
     C           *LIKE     DEFN WFY1NX    WQSM01           PFS Company Num
     C           *LIKE     DEFN WFATD8    WQSM02           PFS Batch Sent
      * Define keylist
     C           KPSSM     KLIST
     C                     KFLD           WQSM01           PFS Company Num
     C                     KFLD           WQSM02           PFS Batch Sent
     C                     KFLD           WFAPTS           PFS Batch Sent
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           WQSM01           PFS Company Num
     C                     KFLD           WQSM02           PFS Batch Sent
      * Setup key
     C                     Z-ADDWL0041    WQSM01           PFS Company Num
     C                     Z-ADDWL0042    WQSM02           PFS Batch Sent
     C                     Z-ADDWL0043    WFAPTS           PFS Batch Sent
      * Establish starting position
     C           KPSSM     SETLL@B2CPW9                    *
     C           KRSSM     READE@B2CPW9                  90*
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Process Status is Sent
     C           WFUXSX    IFEQ 9                          *IF
     C                     ADD  1         YL0040           Count USR
      * CASE: LCL.Count USR is EQ 2
     C           YL0040    IFEQ 2                          *IF
      * PAR = DB1 By name
     C                     Z-ADDWFY1NX    WL0044           PFS Company Num
     C                     Z-ADDWFASD8    WL0045           PFS Batch Date
     C                     Z-ADDWFAOTS    WL0046           PFS Batch Time
     C                     MOVELWFTVAA    WL0047           PFS User ID
     C                     GOTO SMEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSM     READE@B2CPW9                  90*
     C                     ENDDO
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg RT2 - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGY1NX    WQSN01           PFS Company Num
     C           *LIKE     DEFN WGASD8    WQSN02           PFS Batch Date
     C           *LIKE     DEFN WGAOTS    WQSN03           PFS Batch Time
     C           *LIKE     DEFN WGTVAA    WQSN04           PFS User ID
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           WQSN01           PFS Company Num
     C                     KFLD           WQSN02           PFS Batch Date
     C                     KFLD           WQSN03           PFS Batch Time
     C                     KFLD           WQSN04           PFS User ID
      * Setup key
     C                     Z-ADDYL0036    WQSN01           PFS Company Num
     C                     Z-ADDYL0037    WQSN02           PFS Batch Date
     C                     Z-ADDYL0038    WQSN03           PFS Batch Time
     C                     MOVELYL0039    WQSN04           PFS User ID
      * Establish starting position
     C           KRSSN     SETLL@B1CPCV                    *
     C           KRSSN     READE@B1CPCV                  90*
      * Data record not found
     C   90                MOVEL'USR4804' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * E12509 JJH 05/30/18 - New Logic to create PFS Prod Sched Cgn
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.PFS Baseline Schedule is Baseline
      *   |- c2    : DB1.PFS Baseline Schedule is Not Baseline
      *   '-
     C           WGB0SC    IFEQ 'B'                        *IF
     C           WGB0SC    OREQ *BLANK                     *OR
      * Crt PFS Prd Sch Bt Cg-B - PFS Prod Sched Batch Cgn  * 
     C                     EXSR SORVGN
     C                     ELSE
      * CASE: DB1.PFS Baseline Schedule is Work Ahead
     C           WGB0SC    IFEQ 'W'                        *IF
      * Crt PFS Prd Sch Bt Cg-W - PFS Prod Sched Batch Cgn  * 
     C                     EXSR SQRVGN
     C                     ELSE
      * CASE: DB1.PFS Baseline Schedule is Cancelled
     C           WGB0SC    IFEQ 'X'                        *IF
      * Crt PFS Prd Sch Bt Cg-X - PFS Prod Sched Batch Cgn  * 
     C                     EXSR SRRVGN
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSN     READE@B1CPCV                  90*
     C                     ENDDO
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg-B - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WHY1NX    WQSO01           PFS Company Num
     C           *LIKE     DEFN WHASD8    WQSO02           PFS Batch Date
     C           *LIKE     DEFN WHAOTS    WQSO03           PFS Batch Time
     C           *LIKE     DEFN WHTVAA    WQSO04           PFS User ID
     C           *LIKE     DEFN WHY2NX    WQSO05           PFS Item Code
     C           *LIKE     DEFN WHZPNX    WQSO06           PFS Order Numbe
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WQSO01           PFS Company Num
     C                     KFLD           WQSO02           PFS Batch Date
     C                     KFLD           WQSO03           PFS Batch Time
     C                     KFLD           WQSO04           PFS User ID
     C                     KFLD           WQSO05           PFS Item Code
     C                     KFLD           WQSO06           PFS Order Numbe
      * Setup key
     C                     Z-ADD#1Y1NX    WQSO01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSO02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSO03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSO04           PFS User ID
     C                     Z-ADDWGY2NX    WQSO05           PFS Item Code
     C                     Z-ADDWGZPNX    WQSO06           PFS Order Numbe
      * Establish starting position
     C           KRSSO     SETLL@C3CPDJ                    *
     C           KRSSO     READE@C3CPDJ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4965' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD9999999   YL0041           PFS Batch Seq
      * Rtv Last PFS Batch SeqRT - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0048           PFS Company Num
     C                     Z-ADD#1ASD8    WL0049           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0050           PFS Batch Time
     C                     MOVEL#1TVAA    WL0051    P      PFS User ID
     C                     Z-ADDYL0041    WL0052           PFS Batch Seq
     C                     EXSR SPRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0052    YL0041           PFS Batch Seq
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0001           PFS Company Num
     C                     Z-ADD#1ASD8    WL0002           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0003           PFS Batch Time
     C                     MOVEL#1TVAA    WL0004    P      PFS User ID
     C                     Z-ADDYL0041    WL0005           PFS Batch Seq
     C                     Z-ADDWGP7DT    WL0006           PFS Production
     C                     Z-ADDWGY2NX    WL0007           PFS Item Code
     C                     MOVELWGU2SX    WL0008    P      PFS Label Type
     C                     Z-ADDWGZPNX    WL0009           PFS Order Numbe
     C                     Z-ADDWGZXNX    WL0010           PFS Order Line
     C                     MOVELWGCSSC    WL0011    P      PFS Order Line
     C                     Z-ADDWGODQY    WL0012           PFS Ordered Qty
     C                     Z-ADDWGINAL    WL0013           PFS Inventory A
     C                     Z-ADDWGC6NB    WL0014           PFS Fill Qty Pr
     C                     Z-ADDWGC8NB    WL0015           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ1    WL0016           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ2    WL0017           PFS Fill Qty Sh
     C                     Z-ADDWGZGNX    WL0018           PFS Load ID
     C                     Z-ADDWGZWNX    WL0019           PFS Loading Seq
     C                     Z-ADDWGZSNX    WL0020           PFS Scheduled S
     C                     Z-ADDWGZJNX    WL0021           PFS Load Deadli
     C                     Z-ADDWGZKNX    WL0022           PFS Load Deadli
     C                     Z-ADDWGDNNB    WL0023           PFS Item Struct
     C                     Z-ADDWGDONB    WL0024           PFS Item Struct
     C                     Z-ADDWGDRNB    WL0025           PFS Item Struct
     C                     MOVELWGU0SX    WL0026    P      PFS Primary UOM
     C                     MOVELWGBZSC    WL0027    P      PFS Fresh/Froze
     C                     MOVELWGB3SC    WL0028    P      PFS Base/Conver
     C                     MOVELWGB0SC    WL0029    P      PFS Baseline Sc
     C                     MOVELWGVISX    WL0030    P      PFS Palletize
     C                     MOVELWGZLSX    WL0031    P      PFS Pallet Type
     C                     MOVELWGVGSX    WL0032    P      PFS Slip Sheet
     C                     MOVELWGOJU1    WL0033    P      PFS Customer Na
     C                     MOVELWGUWSX    WL0034    P      PFS Record Stat
     C                     Z-ADDWGUXSX    WL0035           PFS Process Sta
     C                     MOVELWGV3SX    WL0036    P      PFS Error Reaso
     C                     Z-ADDWGAHNY    WL0037           PFS Create Date
     C                     Z-ADDWGAINY    WL0038           PFS Create Time
     C                     Z-ADDWGAJNY    WL0039           PFS Change Date
     C                     Z-ADDWGAKNY    WL0040           PFS Change time
     C                     EXSR SKCRRC
     C                     GOTO SOEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Do nothing
     C           KRSSO     READE@C3CPDJ                  90*
     C                     ENDDO
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * Rtv Last PFS Batch SeqRT - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WIY1NX    WQSP01           PFS Company Num
     C           *LIKE     DEFN WIASD8    WQSP02           PFS Batch Date
     C           *LIKE     DEFN WIAOTS    WQSP03           PFS Batch Time
     C           *LIKE     DEFN WITVAA    WQSP04           PFS User ID
      * Define keylist
     C           KPSSP     KLIST
     C                     KFLD           WQSP01           PFS Company Num
     C                     KFLD           WQSP02           PFS Batch Date
     C                     KFLD           WQSP03           PFS Batch Time
     C                     KFLD           WQSP04           PFS User ID
     C                     KFLD           WIBTSQ           PFS Batch Seq
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP01           PFS Company Num
     C                     KFLD           WQSP02           PFS Batch Date
     C                     KFLD           WQSP03           PFS Batch Time
     C                     KFLD           WQSP04           PFS User ID
      * Setup key
     C                     Z-ADDWL0048    WQSP01           PFS Company Num
     C                     Z-ADDWL0049    WQSP02           PFS Batch Date
     C                     Z-ADDWL0050    WQSP03           PFS Batch Time
     C                     MOVELWL0051    WQSP04           PFS User ID
     C                     Z-ADDWL0052    WIBTSQ           PFS Batch Seq
      * Establish starting position
     C           KPSSP     SETLL@C3CPDC                    *
     C           KRSSP     READE@C3CPDC                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4965' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WL0052           PFS Batch Seq
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WIBTSQ    ADD  1         WL0052           PFS Batch Seq
     C                     GOTO SPEXIT                     *QUIT
     C           KRSSP     READE@C3CPDC                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg-W - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WJY1NX    WQSQ01           PFS Company Num
     C           *LIKE     DEFN WJASD8    WQSQ02           PFS Batch Date
     C           *LIKE     DEFN WJAOTS    WQSQ03           PFS Batch Time
     C           *LIKE     DEFN WJTVAA    WQSQ04           PFS User ID
     C           *LIKE     DEFN WJY2NX    WQSQ05           PFS Item Code
     C           *LIKE     DEFN WJZPNX    WQSQ06           PFS Order Numbe
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WQSQ01           PFS Company Num
     C                     KFLD           WQSQ02           PFS Batch Date
     C                     KFLD           WQSQ03           PFS Batch Time
     C                     KFLD           WQSQ04           PFS User ID
     C                     KFLD           WQSQ05           PFS Item Code
     C                     KFLD           WQSQ06           PFS Order Numbe
      * Setup key
     C                     Z-ADD#1Y1NX    WQSQ01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSQ02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSQ03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSQ04           PFS User ID
     C                     Z-ADDWGY2NX    WQSQ05           PFS Item Code
     C                     Z-ADDWGZPNX    WQSQ06           PFS Order Numbe
      * Establish starting position
     C           KRSSQ     SETLL@C3CPDK                    *
     C           KRSSQ     READE@C3CPDK                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4965' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD9999999   YL0042           PFS Batch Seq
      * Rtv Last PFS Batch SeqRT - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0048           PFS Company Num
     C                     Z-ADD#1ASD8    WL0049           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0050           PFS Batch Time
     C                     MOVEL#1TVAA    WL0051    P      PFS User ID
     C                     Z-ADDYL0042    WL0052           PFS Batch Seq
     C                     EXSR SPRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0052    YL0042           PFS Batch Seq
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(PAR) WGVISX' defaulted for 'PFS Palletize'.
      * Field '(PAR) WGZLSX' defaulted for 'PFS Pallet Type'.
      * Field '(PAR) WGVGSX' defaulted for 'PFS Slip Sheet'.
      * Field '(PAR) WGOJU1' defaulted for 'PFS Customer Name'.
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0001           PFS Company Num
     C                     Z-ADD#1ASD8    WL0002           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0003           PFS Batch Time
     C                     MOVEL#1TVAA    WL0004    P      PFS User ID
     C                     Z-ADDYL0042    WL0005           PFS Batch Seq
     C                     Z-ADDWGP7DT    WL0006           PFS Production
     C                     Z-ADDWGY2NX    WL0007           PFS Item Code
     C                     MOVELWGU2SX    WL0008    P      PFS Label Type
     C                     Z-ADDWGZPNX    WL0009           PFS Order Numbe
     C                     Z-ADDWGZXNX    WL0010           PFS Order Line
     C                     MOVELWGCSSC    WL0011    P      PFS Order Line
     C                     Z-ADDWGODQY    WL0012           PFS Ordered Qty
     C                     Z-ADDWGINAL    WL0013           PFS Inventory A
     C                     Z-ADDWGC6NB    WL0014           PFS Fill Qty Pr
     C                     Z-ADDWGC8NB    WL0015           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ1    WL0016           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ2    WL0017           PFS Fill Qty Sh
     C                     Z-ADDWGZGNX    WL0018           PFS Load ID
     C                     Z-ADDWGZWNX    WL0019           PFS Loading Seq
     C                     Z-ADDWGZSNX    WL0020           PFS Scheduled S
     C                     Z-ADDWGZJNX    WL0021           PFS Load Deadli
     C                     Z-ADDWGZKNX    WL0022           PFS Load Deadli
     C                     Z-ADDWGDNNB    WL0023           PFS Item Struct
     C                     Z-ADDWGDONB    WL0024           PFS Item Struct
     C                     Z-ADDWGDRNB    WL0025           PFS Item Struct
     C                     MOVELWGU0SX    WL0026    P      PFS Primary UOM
     C                     MOVELWGBZSC    WL0027    P      PFS Fresh/Froze
     C                     MOVELWGB3SC    WL0028    P      PFS Base/Conver
     C                     MOVELWGB0SC    WL0029    P      PFS Baseline Sc
     C                     MOVELWGVISX    WL0030    P      PFS Palletize
     C                     MOVELWGZLSX    WL0031    P      PFS Pallet Type
     C                     MOVELWGVGSX    WL0032    P      PFS Slip Sheet
     C                     MOVELWGOJU1    WL0033    P      PFS Customer Na
     C                     MOVELWGUWSX    WL0034    P      PFS Record Stat
     C                     Z-ADDWGUXSX    WL0035           PFS Process Sta
     C                     MOVELWGV3SX    WL0036    P      PFS Error Reaso
     C                     Z-ADDWGAHNY    WL0037           PFS Create Date
     C                     Z-ADDWGAINY    WL0038           PFS Create Time
     C                     Z-ADDWGAJNY    WL0039           PFS Change Date
     C                     Z-ADDWGAKNY    WL0040           PFS Change time
     C                     EXSR SKCRRC
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Do nothing
     C           KRSSQ     READE@C3CPDK                  90*
     C                     ENDDO
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Cg-X - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WKY1NX    WQSR01           PFS Company Num
     C           *LIKE     DEFN WKASD8    WQSR02           PFS Batch Date
     C           *LIKE     DEFN WKAOTS    WQSR03           PFS Batch Time
     C           *LIKE     DEFN WKTVAA    WQSR04           PFS User ID
     C           *LIKE     DEFN WKY2NX    WQSR05           PFS Item Code
     C           *LIKE     DEFN WKZPNX    WQSR06           PFS Order Numbe
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           WQSR01           PFS Company Num
     C                     KFLD           WQSR02           PFS Batch Date
     C                     KFLD           WQSR03           PFS Batch Time
     C                     KFLD           WQSR04           PFS User ID
     C                     KFLD           WQSR05           PFS Item Code
     C                     KFLD           WQSR06           PFS Order Numbe
      * Setup key
     C                     Z-ADD#1Y1NX    WQSR01           PFS Company Num
     C                     Z-ADD#1ASD8    WQSR02           PFS Batch Date
     C                     Z-ADD#1AOTS    WQSR03           PFS Batch Time
     C                     MOVEL#1TVAA    WQSR04           PFS User ID
     C                     Z-ADDWGY2NX    WQSR05           PFS Item Code
     C                     Z-ADDWGZPNX    WQSR06           PFS Order Numbe
      * Establish starting position
     C           KRSSR     SETLL@C3CPDL                    *
     C           KRSSR     READE@C3CPDL                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4965' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD9999999   YL0043           PFS Batch Seq
      * Rtv Last PFS Batch SeqRT - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0048           PFS Company Num
     C                     Z-ADD#1ASD8    WL0049           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0050           PFS Batch Time
     C                     MOVEL#1TVAA    WL0051    P      PFS User ID
     C                     Z-ADDYL0043    WL0052           PFS Batch Seq
     C                     EXSR SPRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0052    YL0043           PFS Batch Seq
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1Y1NX    WL0001           PFS Company Num
     C                     Z-ADD#1ASD8    WL0002           PFS Batch Date
     C                     Z-ADD#1AOTS    WL0003           PFS Batch Time
     C                     MOVEL#1TVAA    WL0004    P      PFS User ID
     C                     Z-ADDYL0043    WL0005           PFS Batch Seq
     C                     Z-ADDWGP7DT    WL0006           PFS Production
     C                     Z-ADDWGY2NX    WL0007           PFS Item Code
     C                     MOVELWGU2SX    WL0008    P      PFS Label Type
     C                     Z-ADDWGZPNX    WL0009           PFS Order Numbe
     C                     Z-ADDWGZXNX    WL0010           PFS Order Line
     C                     MOVELWGCSSC    WL0011    P      PFS Order Line
     C                     Z-ADDWGODQY    WL0012           PFS Ordered Qty
     C                     Z-ADDWGINAL    WL0013           PFS Inventory A
     C                     Z-ADDWGC6NB    WL0014           PFS Fill Qty Pr
     C                     Z-ADDWGC8NB    WL0015           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ1    WL0016           PFS Fill Qty Sh
     C                     Z-ADDWGFLQ2    WL0017           PFS Fill Qty Sh
     C                     Z-ADDWGZGNX    WL0018           PFS Load ID
     C                     Z-ADDWGZWNX    WL0019           PFS Loading Seq
     C                     Z-ADDWGZSNX    WL0020           PFS Scheduled S
     C                     Z-ADDWGZJNX    WL0021           PFS Load Deadli
     C                     Z-ADDWGZKNX    WL0022           PFS Load Deadli
     C                     Z-ADDWGDNNB    WL0023           PFS Item Struct
     C                     Z-ADDWGDONB    WL0024           PFS Item Struct
     C                     Z-ADDWGDRNB    WL0025           PFS Item Struct
     C                     MOVELWGU0SX    WL0026    P      PFS Primary UOM
     C                     MOVELWGBZSC    WL0027    P      PFS Fresh/Froze
     C                     MOVELWGB3SC    WL0028    P      PFS Base/Conver
     C                     MOVELWGB0SC    WL0029    P      PFS Baseline Sc
     C                     MOVELWGVISX    WL0030    P      PFS Palletize
     C                     MOVELWGZLSX    WL0031    P      PFS Pallet Type
     C                     MOVELWGVGSX    WL0032    P      PFS Slip Sheet
     C                     MOVELWGOJU1    WL0033    P      PFS Customer Na
     C                     MOVELWGUWSX    WL0034    P      PFS Record Stat
     C                     Z-ADDWGUXSX    WL0035           PFS Process Sta
     C                     MOVELWGV3SX    WL0036    P      PFS Error Reaso
     C                     Z-ADDWGAHNY    WL0037           PFS Create Date
     C                     Z-ADDWGAINY    WL0038           PFS Create Time
     C                     Z-ADDWGAJNY    WL0039           PFS Change Date
     C                     Z-ADDWGAKNY    WL0040           PFS Change time
     C                     EXSR SKCRRC
     C                     GOTO SREXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Do nothing
     C           KRSSR     READE@C3CPDL                  90*
     C                     ENDDO
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0040    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSS     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SSEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    YL0047           Allow Multi-Com
     C                     MOVELDRMPNA    YL0048           Default Printer
     C                     MOVELDRBCCD    YL0046           Salesperson Cod
     C                     Z-ADDDRAIC3    YL0049           Company Number
     C                     MOVELDRBUVN    WN0041           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - User Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSST     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0053    DTAJVN           User Profile Na
     C                     MOVELWL0054    DTDNCD           Application Cod
      * Establish starting position
     C           KRSST     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0055           Company Number
     C                     MOVELDTAJCD    WL0056           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SURVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSU01           Application Cod
      * Define keylist
     C           KRSSU     KLIST
     C                     KFLD           WQSU01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSU01           Application Cod
     C                     MOVEL'P/S'     WQSU01           Application Cod
      * Establish starting position
     C           KRSSU     SETLL@DNRESF                    *
     C           KRSSU     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SVRVGN
     C                     END                             *FI
     C           KRSSU     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSV01           Application Cod
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           WQSV01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSV01           Application Cod
      * Establish starting position
     C           KRSSV     SETLL@DNRESF                    *
     C           KRSSV     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SVEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSV     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * E12509 JJH 02/07/17 - PFS Prod Sched Batch Cgn
      * - Add logic to correct Cancellation with a Status of B=Baseline
      * - Change logic to not write addtional records from the Previous
      *   batch only if it is the 1st Baseline of the day.
      * E7663 JJH 10/20/16 - PFS Prod Sched Batch Cgn
      * - Create a new file that contains all records that are sent in
      *   the PFS Prod Batch Dtl that is intended to go to COGNOS.
      * - This new file will be PFS Prod Sched Batch Cgn (PBC3CPP).
      * - This file will contain all item codes, to include the Partial
      *   Batch records sent, plus the records from the Previous Batch
      *   that were not sent.
      * - Records sent from the Previous Batch will be based on not being
      *   selected in the PFS Prod Sched Batch Sel.
      * - This new file will be created when the user selects Option 8=Se
      * - Thus, all item codes will be sent to Cognos.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDC84     BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
     C                     Z-ADD*ZERO     XDI8DT
      * If external date is zero, do not check
     C           XDEXDT    CABEQ*ZERO     XDC84E
      *................................................................
      * Map external to internal according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDEX01    XDI8DD           DD
     C                     Z-ADDXDEX02    XDI8MM           MM
     C           XDEY02    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY02    XDI8YY            YYY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDEX01    XDI8MM           MM
     C                     Z-ADDXDEX02    XDI8DD           DD
     C           XDEY02    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY02    XDI8YY            YYY
     C                     ELSE
     C           XDEY01    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY01    XDI8YY            YYY
     C                     Z-ADDXDEX03    XDI8MM           MM
     C                     Z-ADDXDEX04    XDI8DD           DD
     C                     END
     C                     END
     C           YPMTFD    CABNE*BLANK    XDC84E
     C           XDDTFM    IFEQ 'YMD'
      *................................................................
     C           XDEY01    IFGE 2200
     C           XDI8DT    ORNE *ZERO
     C           XDEY01    ANDLT1801
     C                     GOTO XDC84M
     C                     END
     C                     ELSE
      *................................................................
     C           XDEY02    IFGE 2200
     C           XDI8DT    ORNE *ZERO
     C           XDEY02    ANDLT1801
     C                     GOTO XDC84M
     C                     END
     C                     END
      *................................................................
      * Check months in range 1 to 12
     C           XDI8MM    CABLT1         XDC84M
     C           XDI8MM    CABGT12        XDC84M
      *................................................................
      * Check days in range 1 to maximum for month
     C           XDI8DD    CABLT1         XDC84M
     C           XDI8DD    CABGT@XD,XDI8MMXDC84M
      *................................................................
      * Special case: leap year
     C           XDI8MM    IFEQ 2
     C           XDI8YY    IFNE 900
     C           XDI8YY    ANDNE100
     C           XDI8YY    DIV  4         XDWK1   80
     C                     MVR            XDWK1
     C                     ELSE
     C                     Z-ADD1         XDWK1
     C                     END
      * Year is not leap
     C           XDWK1     IFNE *ZERO
     C           XDI8DD    CABGT28        XDC84M
     C                     END
     C                     END
     C                     GOTO XDC84E
      *................................................................
      * Send error message
     C           XDC84M    TAG
      * Send message '*Invalid date'
     C                     MOVEL'Y2U0006' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0006' W0RTN
      * Disable time portion if timestamp is validated
     C                     Z-ADD*ZERO     XTTIM
      *================================================================
     CSR         XDC84E    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         XDV84T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDI8DD    XDEX01           DD
     C                     Z-ADDXDI8MM    XDEX02           MM
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDI8MM    XDEX01           MM
     C                     Z-ADDXDI8DD    XDEX02           DD
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
      * YMD format
     C           1000      MULT XDI8CC    XDEY01           Y
     C                     ADD  XDI8YY    XDEY01            YYY
     C                     Z-ADDXDI8MM    XDEX03           MM
     C                     Z-ADDXDI8DD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDV84E    ENDSR
      /EJECT
     CSR         XSTMS     BEGSR
      *================================================================
      * Refresh System timestamp
      *================================================================
     C                     CALL 'Y2RTTSK'
     C                     PARM           ##TMS  26        System timestam
      *================================================================
     CSR         XSTMSE    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD7         ZHSTRW  40
     C                     Z-ADD21        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
     C                     MOVE '0'       XDTSDL 26 P
     C                     MOVEL@CN,005   XDTSDL
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WAAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WADNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WADONB           PFS Item Struct
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WBASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WBAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WBATD8           PFS Batch Sent
     C                     Z-ADD*ZERO     WBAPTS           PFS Batch Sent
     C                     Z-ADD*ZERO     WBUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WBAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WBAINY           PFS Create Time
     C                     Z-ADD*ZERO     WBAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WBAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WCASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WCAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WCBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WCP7DT           PFS Production
     C                     Z-ADD*ZERO     WCY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WCZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WCZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WCODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WCINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WCC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WCC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WCZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WCZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WCZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WCZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WCDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WCDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WCDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WCUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WCAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WCAINY           PFS Create Time
     C                     Z-ADD*ZERO     WCAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WCAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WHY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WHASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WHAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WHBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WHP7DT           PFS Production
     C                     Z-ADD*ZERO     WHY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WHZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WHZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WHODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WHINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WHC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WHC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WHFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WHFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WHZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WHZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WHZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WHZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WHZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WHDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WHDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WHDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WHUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WHAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WHAINY           PFS Create Time
     C                     Z-ADD*ZERO     WHAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WHAKNY           PFS Change time
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SKCRRC.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  80
     C                     Z-ADD*ZERO     WL0003  60
     C                     MOVEL*BLANK    WL0004 10
     C                     Z-ADD*ZERO     WL0005  70
     C                     Z-ADD*ZERO     WL0006  80
     C                     Z-ADD*ZERO     WL0007  70
     C                     MOVEL*BLANK    WL0008  2
     C                     Z-ADD*ZERO     WL0009  70
     C                     Z-ADD*ZERO     WL0010  30
     C                     MOVEL*BLANK    WL0011  1
     C                     Z-ADD*ZERO     WL0012  70
     C                     Z-ADD*ZERO     WL0013  70
     C                     Z-ADD*ZERO     WL0014  70
     C                     Z-ADD*ZERO     WL0015  70
     C                     Z-ADD*ZERO     WL0016  70
     C                     Z-ADD*ZERO     WL0017  70
     C                     Z-ADD*ZERO     WL0018  70
     C                     Z-ADD*ZERO     WL0019  20
     C                     Z-ADD*ZERO     WL0020  80
     C                     Z-ADD*ZERO     WL0021  80
     C                     Z-ADD*ZERO     WL0022  60
     C                     Z-ADD*ZERO     WL0023  30
     C                     Z-ADD*ZERO     WL0024  30
     C                     Z-ADD*ZERO     WL0025  30
     C                     MOVEL*BLANK    WL0026  2
     C                     MOVEL*BLANK    WL0027  2
     C                     MOVEL*BLANK    WL0028  1
     C                     MOVEL*BLANK    WL0029  1
     C                     MOVEL*BLANK    WL0030  1
     C                     MOVEL*BLANK    WL0031  2
     C                     MOVEL*BLANK    WL0032  1
     C                     MOVEL*BLANK    WL0033 30
     C                     MOVEL*BLANK    WL0034  1
     C                     Z-ADD*ZERO     WL0035  10
     C                     MOVEL*BLANK    WL0036  6
     C                     Z-ADD*ZERO     WL0037  80
     C                     Z-ADD*ZERO     WL0038  60
     C                     Z-ADD*ZERO     WL0039  80
     C                     Z-ADD*ZERO     WL0040  60
      * Define local variables for subroutine SMRVGN.
     C                     Z-ADD*ZERO     WL0041  30
     C                     Z-ADD*ZERO     WL0042  80
     C                     Z-ADD*ZERO     WL0043  60
     C                     Z-ADD*ZERO     WL0044  30
     C                     Z-ADD*ZERO     WL0045  80
     C                     Z-ADD*ZERO     WL0046  60
     C                     MOVEL*BLANK    WL0047 10
      * Define local variables for subroutine SPRVGN.
     C                     Z-ADD*ZERO     WL0048  30
     C                     Z-ADD*ZERO     WL0049  80
     C                     Z-ADD*ZERO     WL0050  60
     C                     MOVEL*BLANK    WL0051 10
     C                     Z-ADD*ZERO     WL0052  70
      * Define local variables for subroutine STRVGN.
     C                     MOVEL*BLANK    WL0053 10
     C                     MOVEL*BLANK    WL0054  6
     C                     Z-ADD*ZERO     WL0055  30
     C                     MOVEL*BLANK    WL0056  3
      * Define local work field PFS Company Number
     C                     Z-ADD*ZERO     YL0001  30
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0002  80
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0003  60
      * Define local work field PFS User ID
     C                     MOVEL*BLANK    YL0004 10
      * Define local work field PFS Baseline Schedule
     C                     MOVEL*BLANK    YL0005  1
      * Define local work field PFS Prod Sch Created USR
     C                     MOVEL*BLANK    YL0006  1
      * Define local work field System Date USR
     C                     Z-ADD*ZERO     YL0007  70
      * Define local work field *System timestamp
     C                     MOVELXDTSDL    YL0008 26
      * Define local work field Year USR
     C                     MOVEL*BLANK    YL0009  4
      * Define local work field Month USR
     C                     MOVEL*BLANK    YL0010  2
      * Define local work field Day USR
     C                     MOVEL*BLANK    YL0011  2
      * Define local work field Date (Char-8) USR
     C                     MOVEL*BLANK    YL0012  8
      * Define local work field DATE
     C                     Z-ADD*ZERO     YL0013  80
      * Define local work field PFS Create Date
     C                     Z-ADD*ZERO     YL0014  80
      * Define local work field Year Code
     C                     Z-ADD*ZERO     YL0015  40
      * Define local work field Month NBR USR
     C                     Z-ADD*ZERO     YL0016  20
      * Define local work field Day of Month USR
     C                     Z-ADD*ZERO     YL0017  20
      * Define local work field PFS Batch Sent Date
     C                     Z-ADD*ZERO     YL0018  80
      * Define local work field PFS Batch Sent Time
     C                     Z-ADD*ZERO     YL0019  60
      * Define local work field PFS Change Date
     C                     Z-ADD*ZERO     YL0020  80
      * Define local work field PFS Change time
     C                     Z-ADD*ZERO     YL0021  60
      * Define local work field PFS Company Number Alpha
     C                     MOVEL*BLANK    YL0022  3
      * Define local work field PFS Batch Date Alpha
     C                     MOVEL*BLANK    YL0023  8
      * Define local work field PFS Batch Time Alpha
     C                     MOVEL*BLANK    YL0024  6
      * Define local work field PFS Batch Seq
     C                     Z-ADD*ZERO     YL0025  70
      * Define local work field PFS Record Status
     C                     MOVEL*BLANK    YL0026  1
      * Define local work field PFS Process Status
     C                     Z-ADD*ZERO     YL0027  10
      * Define local work field PFS Error Reason
     C                     MOVEL*BLANK    YL0028  6
      * Define local work field PFS Create Date
     C                     Z-ADD*ZERO     YL0029  80
      * Define local work field PFS Create Time
     C                     Z-ADD*ZERO     YL0030  60
      * Define local work field PFS Change Date
     C                     Z-ADD*ZERO     YL0031  80
      * Define local work field PFS Change time
     C                     Z-ADD*ZERO     YL0032  60
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0033  20
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0034  20
      * Define local work field Upd Prod Sched Batch CGN
     C                     MOVEL*BLANK    YL0035  1
      * Define local work field PFS Company Number
     C                     Z-ADD*ZERO     YL0036  30
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0037  80
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0038  60
      * Define local work field PFS User ID
     C                     MOVEL*BLANK    YL0039 10
      * Define local work field Count USR
     C                     Z-ADD*ZERO     YL0040  50
      * Define local work field PFS Batch Seq
     C                     Z-ADD*ZERO     YL0041  70
      * Define local work field PFS Batch Seq
     C                     Z-ADD*ZERO     YL0042  70
      * Define local work field PFS Batch Seq
     C                     Z-ADD*ZERO     YL0043  70
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0044  3
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0045  30
      * Define local work field Salesperson Code
     C                     MOVEL*BLANK    YL0046  3
      * Define local work field Allow Multi-Company
     C                     MOVEL*BLANK    YL0047  1
      * Define local work field Default Printer
     C                     MOVEL*BLANK    YL0048 10
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0049  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0050  3
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD15        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      *
     C                     MOVEL*BLANK    WN0040 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0040           User Profile Na
      *
     C                     MOVEL*BLANK    WN0041 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SSRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,007                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0040    ZA0001           User Profile Na
     C                     MOVEL'P/S'     ZA0002           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0041    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0040    WL0053    P      User Profile Na
     C                     MOVEL'P/S'     WL0054    P      Application Cod
     C                     EXSR STRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0055    YL0045           Company Number
     C                     MOVELWL0056    YL0050    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0041    WL0053    P      User Profile Na
     C                     MOVEL'P/S'     WL0054    P      Application Cod
     C                     EXSR STRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0055    YL0045           Company Number
     C                     MOVELWL0056    YL0050    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0050    YL0044           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0040    ZA0003           User Profile Na
     C                     MOVEL'P/S'     ZA0004           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0049    IFNE 0                          *IF
     C                     Z-ADDYL0049    YL0045           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0050    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C           YL0044    PARM *BLANK    WQ0042  3        Warehouse Code
     C                     PARM YL0049    WQ0043  30       Shipping Compan
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SURVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
      * Ext Void Unsent Bt Hd RT - PFS Prod Sched Batch Hdr  * 
     C                     CALL 'PBS6XFR'              90  Ext Void Unsent
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBS6XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @XD
312931303130313130313031
** @CN
00001 Batch Selection
00002 Not Sent-Voided
00003 Ready To Send
00004 Send InProcess
00005 0001-01-01-00.00.00.00000
00006 PSBSENT
00007 Y2U0005
