     H/TITLE CRT 1 WF Invoice/Cmb   XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISLBUSE
     H* Date          : 04/09/10  Time  : 11:04:45
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOPBFCPL1IF  E           K        DISK
      * RTV : Order Header TRG          Retrieval index       NV
      *
     FOPBFCPHAIF  E           K        DISK
      * RSQ : Order Header TRG          Invoice Print Sel CMB
      *
     FPMAFCPL0IF  E           K        DISK                      A
      * UPD : WF Invoice/Combine Drv    Update index
      *
     I@BECPFK
      * Order Header TRG          Retrieval index       NV
      * Renamed input format fields
     I              BEAIC3                          WAAIC3
     I              BEC4NB                          WAC4NB
     I              BEJNCD                          WAJNCD
     I              BEANC7                          WAANC7
     I              BEBKC7                          WABKC7
     I              BEBRTX                          WABRTX
     I              BEHMNA                          WAHMNA
     I              BEHONA                          WAHONA
     I              BEHPNA                          WAHPNA
     I              BEHNNA                          WAHNNA
     I              BEDBCD                          WADBCD
     I              BECKTX                          WACKTX
     I              BEB0C7                          WAB0C7
     I              BEAETX                          WAAETX
     I              BEB1NA                          WAB1NA
     I              BEB3NA                          WAB3NA
     I              BEB4NA                          WAB4NA
     I              BEB2NA                          WAB2NA
     I              BEBHCD                          WABHCD
     I              BEC8TX                          WAC8TX
     I              BEBCNA                          WABCNA
     I              BEA0DT                          WAA0DT
     I              BEA5DT                          WAA5DT
     I              BEGNDT                          WAGNDT
     I              BEACDT                          WAACDT
     I              BEAQCD                          WAAQCD
     I              BEB6NA                          WAB6NA
     I              BEBYNA                          WABYNA
     I              BEBZNA                          WABZNA
     I              BEGTST                          WAGTST
     I              BEGVST                          WAGVST
     I              BEGUST                          WAGUST
     I              BEQFST                          WAQFST
     I              BECQCD                          WACQCD
     I              BEGJST                          WAGJST
     I              BEGWST                          WAGWST
     I              BEGXST                          WAGXST
     I              BEGYST                          WAGYST
     I              BEAODT                          WAAODT
     I              BEAIVN                          WAAIVN
     I              BECXDT                          WACXDT
     I              BEJZVA                          WAJZVA
     I              BEA1WG                          WAA1WG
     I              BEXIST                          WAXIST
     I              BEXJST                          WAXJST
     I              BEXKST                          WAXKST
     I              BEEIDT                          WAEIDT
     I              BEAFTM                          WAAFTM
     I              BEE8CD                          WAE8CD
     I              BEE9CD                          WAE9CD
     I              BERMNB                          WARMNB
     I              BETBNB                          WATBNB
     I              BER1NB                          WAR1NB
     I              BEPJST                          WAPJST
     I              BEU0ST                          WAU0ST
     I              BEU1ST                          WAU1ST
     I              BEQ2CD                          WAQ2CD
     I              BEU2ST                          WAU2ST
     I              BEVEST                          WAVEST
     I              BEVFST                          WAVFST
     I              BEVGST                          WAVGST
     I              BERPCD                          WARPCD
     I              BERNNB                          WARNNB
     I              BEVDST                          WAVDST
     I              BEATIN                          WAATIN
     I              BEU4ST                          WAU4ST
     I              BEU5ST                          WAU5ST
     I              BERSRN                          WARSRN
     I              BEMHNA                          WAMHNA
     I              BEMINA                          WAMINA
     I              BEWBST                          WAWBST
     I              BER4CD                          WAR4CD
     I              BEBFCD                          WABFCD
     I              BEQ4CD                          WAQ4CD
     I              BET3NB                          WAT3NB
     I              BESICD                          WASICD
     I              BECONB                          WACONB
     I              BECEST                          WACEST
     I              BEAWDT                          WAAWDT
     I              BEJPCD                          WAJPCD
     I              BEXUST                          WAXUST
     I              BEZ1ST                          WAZ1ST
     I              BEVRVA                          WAVRVA
     I              BEOBST                          WAOBST
     I              BEBCST                          WABCST
     I              BEBDST                          WABDST
     I              BEB7VL                          WAB7VL
     I              BEGASX                          WAGASX
     I              BEGBSX                          WAGBSX
     I              BEGCSX                          WAGCSX
     I              BEGDSX                          WAGDSX
     I              BEFNSX                          WAFNSX
     I              BEFOSX                          WAFOSX
     I              BEFPSX                          WAFPSX
     I              BEFQSX                          WAFQSX
     I              BEFRSX                          WAFRSX
     I              BEFSSX                          WAFSSX
     I              BEFTSX                          WAFTSX
     I              BEFUSX                          WAFUSX
     I              BEFVSX                          WAFVSX
     I              BEFWSX                          WAFWSX
     I              BEFXSX                          WAFXSX
     I              BEFYSX                          WAFYSX
     I              BENODT                          WANODT
     I              BENPDT                          WANPDT
     I              BENQDT                          WANQDT
     I              BENRDT                          WANRDT
     I              BENSDT                          WANSDT
     I              BEBPTM                          WABPTM
     I              BEBQTM                          WABQTM
     I              BEBRTM                          WABRTM
     I              BEBSTM                          WABSTM
     I              BEBTTM                          WABTTM
     I              BEH0NX                          WAH0NX
     I              BEH1NX                          WAH1NX
     I              BEH2NX                          WAH2NX
     I              BEH3NX                          WAH3NX
     I              BEH4NX                          WAH4NX
     I              BEC0C7                          WAC0C7
     I              BEUVST                          WAUVST
     I              BEUWST                          WAUWST
     I              BEUXST                          WAUXST
     I              BEAATM                          WAAATM
     I              BEAYNA                          WAAYNA
     I              BEA0NA                          WAA0NA
     I              BEAXDT                          WAAXDT
      *
     I@BFCPIA
      * Order Header TRG          Invoice Print Sel CMB
      * Renamed input format fields
     I              BEAIC3                          WBAIC3
     I              BEC4NB                          WBC4NB
     I              BEJNCD                          WBJNCD
     I              BEANC7                          WBANC7
     I              BEBKC7                          WBBKC7
     I              BEBRTX                          WBBRTX
     I              BEHMNA                          WBHMNA
     I              BEHONA                          WBHONA
     I              BEHPNA                          WBHPNA
     I              BEHNNA                          WBHNNA
     I              BEDBCD                          WBDBCD
     I              BECKTX                          WBCKTX
     I              BEB0C7                          WBB0C7
     I              BEAETX                          WBAETX
     I              BEB1NA                          WBB1NA
     I              BEB3NA                          WBB3NA
     I              BEB4NA                          WBB4NA
     I              BEB2NA                          WBB2NA
     I              BEBHCD                          WBBHCD
     I              BEC8TX                          WBC8TX
     I              BEBCNA                          WBBCNA
     I              BEA0DT                          WBA0DT
     I              BEA5DT                          WBA5DT
     I              BEGNDT                          WBGNDT
     I              BEACDT                          WBACDT
     I              BEAQCD                          WBAQCD
     I              BEB6NA                          WBB6NA
     I              BEBYNA                          WBBYNA
     I              BEBZNA                          WBBZNA
     I              BEGTST                          WBGTST
     I              BEGVST                          WBGVST
     I              BEGUST                          WBGUST
     I              BEQFST                          WBQFST
     I              BECQCD                          WBCQCD
     I              BEGJST                          WBGJST
     I              BEGWST                          WBGWST
     I              BEGXST                          WBGXST
     I              BEGYST                          WBGYST
     I              BEAODT                          WBAODT
     I              BEAIVN                          WBAIVN
     I              BECXDT                          WBCXDT
     I              BEJZVA                          WBJZVA
     I              BEA1WG                          WBA1WG
     I              BEXIST                          WBXIST
     I              BEXJST                          WBXJST
     I              BEXKST                          WBXKST
     I              BEEIDT                          WBEIDT
     I              BEAFTM                          WBAFTM
     I              BEE8CD                          WBE8CD
     I              BEE9CD                          WBE9CD
     I              BERMNB                          WBRMNB
     I              BETBNB                          WBTBNB
     I              BER1NB                          WBR1NB
     I              BEPJST                          WBPJST
     I              BEU0ST                          WBU0ST
     I              BEU1ST                          WBU1ST
     I              BEQ2CD                          WBQ2CD
     I              BEU2ST                          WBU2ST
     I              BEVEST                          WBVEST
     I              BEVFST                          WBVFST
     I              BEVGST                          WBVGST
     I              BERPCD                          WBRPCD
     I              BERNNB                          WBRNNB
     I              BEVDST                          WBVDST
     I              BEATIN                          WBATIN
     I              BEU4ST                          WBU4ST
     I              BEU5ST                          WBU5ST
     I              BERSRN                          WBRSRN
     I              BEMHNA                          WBMHNA
     I              BEMINA                          WBMINA
     I              BEWBST                          WBWBST
     I              BER4CD                          WBR4CD
     I              BEBFCD                          WBBFCD
     I              BEQ4CD                          WBQ4CD
     I              BET3NB                          WBT3NB
     I              BESICD                          WBSICD
     I              BECONB                          WBCONB
     I              BECEST                          WBCEST
     I              BEAWDT                          WBAWDT
     I              BEJPCD                          WBJPCD
     I              BEXUST                          WBXUST
     I              BEZ1ST                          WBZ1ST
     I              BEVRVA                          WBVRVA
     I              BEOBST                          WBOBST
     I              BEBCST                          WBBCST
     I              BEBDST                          WBBDST
     I              BEB7VL                          WBB7VL
     I              BEGASX                          WBGASX
     I              BEGBSX                          WBGBSX
     I              BEGCSX                          WBGCSX
     I              BEGDSX                          WBGDSX
     I              BEFNSX                          WBFNSX
     I              BEFOSX                          WBFOSX
     I              BEFPSX                          WBFPSX
     I              BEFQSX                          WBFQSX
     I              BEFRSX                          WBFRSX
     I              BEFSSX                          WBFSSX
     I              BEFTSX                          WBFTSX
     I              BEFUSX                          WBFUSX
     I              BEFVSX                          WBFVSX
     I              BEFWSX                          WBFWSX
     I              BEFXSX                          WBFXSX
     I              BEFYSX                          WBFYSX
     I              BENODT                          WBNODT
     I              BENPDT                          WBNPDT
     I              BENQDT                          WBNQDT
     I              BENRDT                          WBNRDT
     I              BENSDT                          WBNSDT
     I              BEBPTM                          WBBPTM
     I              BEBQTM                          WBBQTM
     I              BEBRTM                          WBBRTM
     I              BEBSTM                          WBBSTM
     I              BEBTTM                          WBBTTM
     I              BEH0NX                          WBH0NX
     I              BEH1NX                          WBH1NX
     I              BEH2NX                          WBH2NX
     I              BEH3NX                          WBH3NX
     I              BEH4NX                          WBH4NX
     I              BEC0C7                          WBC0C7
     I              BEUVST                          WBUVST
     I              BEUWST                          WBUWST
     I              BEUXST                          WBUXST
     I              BEAATM                          WBAATM
     I              BEAYNA                          WBAYNA
     I              BEA0NA                          WBA0NA
     I              BEAXDT                          WBAXDT
      *
     I@AFCPHT
      * WF Invoice/Combine Drv    Update index
      * Renamed input format fields
     I              AFB2VN                          WCB2VN
     I              AFDJVN                          WCDJVN
     I              AFC4NB                          WCC4NB
     I              AFAETX                          WCAETX
     I              AFJZVA                          WCJZVA
     I              AFA1WG                          WCA1WG
     I              AFBRTX                          WCBRTX
     I              AFRLST                          WCRLST
     I              AFHUSX                          WCHUSX
     I              AFBCNA                          WCBCNA
     I              AFA8TX                          WCA8TX
     I              AFBETX                          WCBETX
     I              AFGNDT                          WCGNDT
     I              AFBKC7                          WCBKC7
     I              AFEMC7                          WCEMC7
     I              AFAIC3                          WCAIC3
     I              AFCONB                          WCCONB
     I              AFCEST                          WCCEST
     I              AFVSST                          WCVSST
     I              AFMJDT                          WCMJDT
     I              AFBETM                          WCBETM
     I              AFCCVN                          WCCCVN
     I              AFCDVN                          WCCDVN
     I              AFMKDT                          WCMKDT
     I              AFBFTM                          WCBFTM
     I              AFCEVN                          WCCEVN
     I              AFCFVN                          WCCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * Outward parameters
     IPARC        DS                              4
      * KEY : Customer EXT              Retrieval index
      * I : RST Ship To Customer
     I                                    P   1   40PABKC7
      *
     IQPMAF1    E DSPMAFCPL0
      * UPD : WF Invoice/Combine Drv    Update index
      * Renamed input format fields
     I              AFB2VN                          WCB2VN
     I              AFDJVN                          WCDJVN
     I              AFC4NB                          WCC4NB
     I              AFAETX                          WCAETX
     I              AFJZVA                          WCJZVA
     I              AFA1WG                          WCA1WG
     I              AFBRTX                          WCBRTX
     I              AFRLST                          WCRLST
     I              AFHUSX                          WCHUSX
     I              AFBCNA                          WCBCNA
     I              AFA8TX                          WCA8TX
     I              AFBETX                          WCBETX
     I              AFGNDT                          WCGNDT
     I              AFBKC7                          WCBKC7
     I              AFEMC7                          WCEMC7
     I              AFAIC3                          WCAIC3
     I              AFCONB                          WCCONB
     I              AFCEST                          WCCEST
     I              AFVSST                          WCVSST
     I              AFMJDT                          WCMJDT
     I              AFBETM                          WCBETM
     I              AFCCVN                          WCCCVN
     I              AFCDVN                          WCCDVN
     I              AFMKDT                          WCMKDT
     I              AFBFTM                          WCBFTM
     I              AFCEVN                          WCCEVN
     I              AFCFVN                          WCCFVN
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: WF Invoice/Combine Drv
      * I : MAP Job Name CDE
     I                                        1  10 P1B2VN
      * I : MAP Job Number Cde
     I                                       11  20 P1DJVN
      * I : MAP Order Number
     I                                    P  21  240P1C4NB
      * I : MAP Company Number
     I                                    P  25  260P1AIC3
     IP2PARM      DS
      * O : MAP One Invoice Per PO
     I                                        1   1 P2HUSX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1B2VN    PARM           WP0001 10        Job Name CDE
     C           P1DJVN    PARM           WP0002 10        Job Number Cde
     C           P1C4NB    PARM           WP0003  70       Order Number
     C           P1AIC3    PARM           WP0004  30       Company Number
     C           P2HUSX    PARM P2HUSX    WP0005  1        One Invoice Per
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CRT 1 WF Invoice/Cmb   XF
     C                     MOVEL*BLANK    P2HUSX           One Invoice Per
      * Get order information, and then customer ext for ship to customer
      * RTV Info for Invc Prt  RT - Order Header TRG  * 
     C                     EXSR SARVGN
      * Rtv One Invoice /PO   XP - Customer EXT  * 
     C                     CLEARPARC
     C                     Z-ADDYL0003    PABKC7           Ship To Custome
      *
     C                     CALL 'PMCOXFR'              90  Rtv One Invoice
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Customer E
     C           YL0031    PARM *BLANK    WQ0001  1        One Invoice Per
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMCOXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.Billing Activity Type is Invoice or Debit Memo
      *   |- c2    : LCL.One Invoice Per PO is Yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0030    IFEQ '3'                        *IF
     C           YL0030    OREQ '1'
     C           YL0031    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * ****
      * 4/24/2007 SLM Invoice Date and Invoice must be populated
      * Verify all orders for all Customer/PO/Actual Ship Date/
      * and invoice no and invoice date has been updated
      *    ***** regardless of Company ****
      * RTV Info for InvCmbCRT RT - Order Header TRG  * 
     C                     EXSR SBRVGN
     C                     MOVELYL0031    P2HUSX           One Invoice Per
     C                     END                             *FI
      * ***** Change Log and Comments
     C                     EXSR UASUBR                     ***** Change Lo
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Info for Invc Prt  RT - Order Header TRG  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
      * Setup key
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1C4NB    WAC4NB           Order Number
      * Establish starting position
     C           KRSSA     CHAIN@BECPFK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           Order Type - Sa
     C                     Z-ADD*ZERO     YL0002           A/R Customer Nu
     C                     Z-ADD*ZERO     YL0003           Ship To Custome
     C                     MOVEL*BLANK    YL0004           Ship To Name
     C                     MOVEL*BLANK    YL0005           Ship To Address
     C                     MOVEL*BLANK    YL0006           Ship To Address
     C                     MOVEL*BLANK    YL0007           Ship To Address
     C                     MOVEL*BLANK    YL0008           Ship To City
     C                     MOVEL*BLANK    YL0009           Ship To State C
     C                     MOVEL*BLANK    YL0010           Ship To Zip/Pos
     C                     Z-ADD*ZERO     YL0011           Bill to Custome
     C                     MOVEL*BLANK    YL0012           Bill to Name
     C                     MOVEL*BLANK    YL0013           Bill to Address
     C                     MOVEL*BLANK    YL0014           Bill to Address
     C                     MOVEL*BLANK    YL0015           Bill to Address
     C                     MOVEL*BLANK    YL0016           Bill to City
     C                     MOVEL*BLANK    YL0017           Bill to State C
     C                     MOVEL*BLANK    YL0018           Bill to Zip/Pos
     C                     MOVEL*BLANK    YL0019           Customer Purcha
     C                     Z-ADD*ZERO     YL0020           Order Date
     C                     Z-ADD*ZERO     YL0021           Actual Shipped
     C                     MOVEL*BLANK    YL0022           Terms Code
     C                     MOVEL*BLANK    YL0023           Carrier Code
     C                     Z-ADD*ZERO     YL0024           Order Value Tot
     C                     Z-ADD*ZERO     YL0025           Order Weight To
     C                     Z-ADD*ZERO     YL0026           Load ID
     C                     MOVEL*BLANK    YL0027           Sales Route Cod
     C                     Z-ADD*ZERO     YL0028           Invoice Number
     C                     Z-ADD*ZERO     YL0029           Invoice Date
     C                     MOVEL*BLANK    YL0030           Billing Activit
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAJNCD    YL0001           Order Type - Sa
     C                     Z-ADDWAANC7    YL0002           A/R Customer Nu
     C                     Z-ADDWABKC7    YL0003           Ship To Custome
     C                     MOVELWABRTX    YL0004           Ship To Name
     C                     MOVELWAHMNA    YL0005           Ship To Address
     C                     MOVELWAHONA    YL0006           Ship To Address
     C                     MOVELWAHPNA    YL0007           Ship To Address
     C                     MOVELWAHNNA    YL0008           Ship To City
     C                     MOVELWADBCD    YL0009           Ship To State C
     C                     MOVELWACKTX    YL0010           Ship To Zip/Pos
     C                     Z-ADDWAB0C7    YL0011           Bill to Custome
     C                     MOVELWAAETX    YL0012           Bill to Name
     C                     MOVELWAB1NA    YL0013           Bill to Address
     C                     MOVELWAB3NA    YL0014           Bill to Address
     C                     MOVELWAB4NA    YL0015           Bill to Address
     C                     MOVELWAB2NA    YL0016           Bill to City
     C                     MOVELWABHCD    YL0017           Bill to State C
     C                     MOVELWAC8TX    YL0018           Bill to Zip/Pos
     C                     MOVELWABCNA    YL0019           Customer Purcha
     C                     Z-ADDWAA0DT    YL0020           Order Date
     C                     Z-ADDWAGNDT    YL0021           Actual Shipped
     C                     MOVELWAAQCD    YL0022           Terms Code
     C                     MOVELWABZNA    YL0023           Carrier Code
     C                     Z-ADDWAJZVA    YL0024           Order Value Tot
     C                     Z-ADDWAA1WG    YL0025           Order Weight To
     C                     Z-ADDWARMNB    YL0026           Load ID
     C                     MOVELWAR4CD    YL0027           Sales Route Cod
     C                     Z-ADDWACONB    YL0028           Invoice Number
     C                     Z-ADDWAAWDT    YL0029           Invoice Date
     C                     MOVELWAOBST    YL0030           Billing Activit
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Info for InvCmbCRT RT - Order Header TRG  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBGNDT    WQSB02           Actual Shipped
     C           *LIKE     DEFN WBBCNA    WQSB03           Customer Purcha
     C           *LIKE     DEFN WBBKC7    WQSB04           Ship To Custome
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Actual Shipped
     C                     KFLD           WQSB03           Customer Purcha
     C                     KFLD           WQSB04           Ship To Custome
      * Setup key
     C                     Z-ADDP1AIC3    WQSB01           Company Number
     C                     Z-ADDYL0021    WQSB02           Actual Shipped
     C                     MOVELYL0019    WQSB03           Customer Purcha
     C                     Z-ADDYL0003    WQSB04           Ship To Custome
      * Establish starting position
     C           KRSSB     SETLL@BFCPIA                    *
     C           KRSSB     READE@BFCPIA                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * ** Fax Flag is no longer being used. If fax number is in the Cust
      * ** Distribution Entry file then fax the invoice.      P000198
     C                     MOVEL'Y'       YL0032           Fax Invoice Fla
      * CASE: DB1.Billing Activity Type is Invoice or Debit Memo
     C           WBOBST    IFEQ '3'                        *IF
     C           WBOBST    OREQ '1'
      * Crt WF Invoice/Combine CR - WF Invoice/Combine Drv  * 
     C                     EXSR SCCRRC
     C                     END                             *FI
     C           KRSSB     READE@BFCPIA                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Crt WF Invoice/Combine CR - WF Invoice/Combine Drv  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Create Date
     C                     Z-ADD*ZERO     WN0002  60       Create Time
     C                     MOVEL*BLANK    WN0003 10        Create User
     C                     MOVEL*BLANK    WN0004 10        Create Program
     C                     Z-ADD*ZERO     WN0005  70       Change Date
     C                     Z-ADD*ZERO     WN0006  60       Change Time
     C                     MOVEL*BLANK    WN0007 10        Change User
     C                     MOVEL*BLANK    WN0008 10        Change Program
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AFCPHT
     C                     MOVELP1B2VN    WCB2VN           Job Name CDE
     C                     MOVELP1DJVN    WCDJVN           Job Number Cde
     C                     Z-ADDWBC4NB    WCC4NB           Order Number
     C                     MOVELWBAETX    WCAETX           Bill to Name
     C                     Z-ADDWBJZVA    WCJZVA           Order Value Tot
     C                     Z-ADDWBA1WG    WCA1WG           Order Weight To
     C                     MOVELWBBRTX    WCBRTX           Ship To Name
     C                     MOVELYL0032    WCRLST           Fax Invoice Fla
     C                     MOVEL'Y'       WCHUSX           One Invoice Per
     C                     MOVELWBBCNA    WCBCNA           Customer Purcha
     C                     MOVEL'N'       WCA8TX           Combine Invoice
     C                     MOVELWBOBST    WCBETX           WF Inv/Comb Bil
     C                     Z-ADDWBGNDT    WCGNDT           Actual Shipped
     C                     Z-ADDWBBKC7    WCBKC7           Ship To Custome
     C                     Z-ADDWBB0C7    WCEMC7           Bill to Custome
     C                     Z-ADDWBAIC3    WCAIC3           Company Number
     C                     Z-ADDWBCONB    WCCONB           Invoice Number
     C                     MOVELWBCEST    WCCEST           Invoice Suffix
     C                     MOVEL'A'       WCVSST           Record Status
      *
      * USER: Processing before Data update
      * Set Crt Date/Time      IF
      * *** Set RECORD STATUS field. ***
     C                     MOVEL'A'       WCVSST           Record Status
      * *** Set CREATE fields. ***
     C                     Z-ADD##JDT     WCMJDT           Create Date
     C                     Z-ADD##JTM     WCBETM           Create Time
     C                     MOVEL##USR     WCCCVN           Create User
     C                     MOVEL##PGM     WCCDVN           Create Program
      * *** Set CHANGE fields. ***
     C                     Z-ADD*ZERO     WCMKDT           Change Date
     C                     Z-ADD*ZERO     WCBFTM           Change Time
     C                     MOVEL*BLANK    WCCEVN           Change User
     C                     MOVEL*BLANK    WCCFVN           Change Program
     C           KLCRSC    KLIST
     C                     KFLD           WCB2VN           Job Name CDE
     C                     KFLD           WCDJVN           Job Number Cde
     C                     KFLD           WCC4NB           Order Number
      * Check for duplicate primary key
     C           KLCRSC    SETLL@AFCPHT                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3672' W0RTN   7
      * Send message 'WF Invoice/Combine Drv EX'
     C                     MOVEL'USR3672' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@AFCPHT                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * ***** Change Log and Comments
      *================================================================
      * ** 04/02/2010 LJB P000198 (sub task: E000673)
      * ** Recompile due to change in RTV Info for InvCmbCRT RT
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WACXDT           Date of Origina
     C                     Z-ADD*ZERO     WAJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WAA1WG           Order Weight To
     C                     Z-ADD*ZERO     WAEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WAAFTM           Requested Deliv
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WARNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAVRVA           A/R order Value
     C                     Z-ADD*ZERO     WAB7VL           Invoice Order V
     C                     Z-ADD*ZERO     WANODT           OH Unused Date
     C                     Z-ADD*ZERO     WANPDT           OH Unused Date
     C                     Z-ADD*ZERO     WANQDT           OH Unused Date
     C                     Z-ADD*ZERO     WANRDT           OH Unused Date
     C                     Z-ADD*ZERO     WANSDT           OH Unused Date
     C                     Z-ADD*ZERO     WABPTM           Maximum Gross W
     C                     Z-ADD*ZERO     WABQTM           Time of Origina
     C                     Z-ADD*ZERO     WABRTM           OH Unused Time
     C                     Z-ADD*ZERO     WABSTM           OH Unused Time
     C                     Z-ADD*ZERO     WABTTM           OH Unused Time
     C                     Z-ADD*ZERO     WAH0NX           Act Frt Referen
     C                     Z-ADD*ZERO     WAH1NX           Act Non-Ref Frt
     C                     Z-ADD*ZERO     WAH2NX           OH Fuel Surchar
     C                     Z-ADD*ZERO     WAH3NX           OH Total Non-Re
     C                     Z-ADD*ZERO     WAH4NX           OH Total Ref Fr
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCC4NB           Order Number
     C                     Z-ADD*ZERO     WCJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WCA1WG           Order Weight To
     C                     Z-ADD*ZERO     WCGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCEMC7           Bill to Custome
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCCONB           Invoice Number
     C                     Z-ADD*ZERO     WCMJDT           Create Date
     C                     Z-ADD*ZERO     WCBETM           Create Time
     C                     Z-ADD*ZERO     WCMKDT           Change Date
     C                     Z-ADD*ZERO     WCBFTM           Change Time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Order Type - Sales
     C                     MOVEL*BLANK    YL0001  2
      * Define local work field A/R Customer Number
     C                     Z-ADD*ZERO     YL0002  70
      * Define local work field Ship To Customer
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field Ship To Name
     C                     MOVEL*BLANK    YL0004 30
      * Define local work field Ship To Address Line 1
     C                     MOVEL*BLANK    YL0005 30
      * Define local work field Ship To Address Line 2
     C                     MOVEL*BLANK    YL0006 30
      * Define local work field Ship To Address Line 3
     C                     MOVEL*BLANK    YL0007 30
      * Define local work field Ship To City
     C                     MOVEL*BLANK    YL0008 20
      * Define local work field Ship To State Code
     C                     MOVEL*BLANK    YL0009  2
      * Define local work field Ship To Zip/Postal Code
     C                     MOVEL*BLANK    YL0010 11
      * Define local work field Bill to Customer
     C                     Z-ADD*ZERO     YL0011  70
      * Define local work field Bill to Name
     C                     MOVEL*BLANK    YL0012 30
      * Define local work field Bill to Address Line 1
     C                     MOVEL*BLANK    YL0013 30
      * Define local work field Bill to Address Line 2
     C                     MOVEL*BLANK    YL0014 30
      * Define local work field Bill to Address Line 3
     C                     MOVEL*BLANK    YL0015 30
      * Define local work field Bill to City
     C                     MOVEL*BLANK    YL0016 20
      * Define local work field Bill to State Code
     C                     MOVEL*BLANK    YL0017  2
      * Define local work field Bill to Zip/Postal Code
     C                     MOVEL*BLANK    YL0018 11
      * Define local work field Customer Purchase Order #
     C                     MOVEL*BLANK    YL0019 15
      * Define local work field Order Date
     C                     Z-ADD*ZERO     YL0020  70
      * Define local work field Actual Shipped Date
     C                     Z-ADD*ZERO     YL0021  70
      * Define local work field Terms Code
     C                     MOVEL*BLANK    YL0022  2
      * Define local work field Carrier Code
     C                     MOVEL*BLANK    YL0023  3
      * Define local work field Order Value Total
     C                     Z-ADD*ZERO     YL0024 112
      * Define local work field Order Weight Total
     C                     Z-ADD*ZERO     YL0025 112
      * Define local work field Load ID
     C                     Z-ADD*ZERO     YL0026  70
      * Define local work field Sales Route Code
     C                     MOVEL*BLANK    YL0027  3
      * Define local work field Invoice Number
     C                     Z-ADD*ZERO     YL0028  70
      * Define local work field Invoice Date
     C                     Z-ADD*ZERO     YL0029  70
      * Define local work field Billing Activity Type
     C                     MOVEL*BLANK    YL0030  1
      * Define local work field One Invoice Per PO
     C                     MOVEL*BLANK    YL0031  1
      * Define local work field Fax Invoice Flag
     C                     MOVEL*BLANK    YL0032  1
      *================================================================
     CSR         ZZEXIT    ENDSR
