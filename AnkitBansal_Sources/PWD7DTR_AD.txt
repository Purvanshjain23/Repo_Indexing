// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWD7DTR
// ?Date: 14.08.2025 Time: 02:56:10
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?E11288 JJH 07/31/17 - Tattoo Header Modifications
//?- Copied from Edt Buy Order and Load ET (PKAOETR)
//?- Hide Movement Number
//?- Comment out Error Messages
//?- Comment out all validation and error messages
//?- Remove Options 5=Move Time, F14=Edit Comments, F15=
ENDDO;

//?RMC 11/04/16 R7805 add BOH MPR purch type
//?RMC Comment hedge stuff.. never installed 9/27/16
//?E3577 11/5/14 RMC Allow new BOH Type is Hedge. Hedge wont have any
//? Loads.  They will have BOH Hedge Head and get reported to USDA MPR
EXECUTE FUNCTION(HPE034) TYPE(EXCINTFUN)                                        AB1195750;
{
 //?Execute internal function

 //?Create a Trucker edit. - Dwight Shepard
 //?Purpose:
 //?Clone the Trucker report that post and remove
 //?all update of vouchers.  Producer the report
 //?for the user to sight review before continue on.
 //?Modification History
 //?Date        Person   Description
}


//?PK0495 12/12/02 Make subfile fields output & dsp movement#
//?  & Comment SFL Detail validations
//?PK0495 01/20/03 Allow subfile input and validate.
//?H16853 ISE 11/02/2020 CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


// LCL.Company Value Code    USR = CND.HPE & HPS Application Usd
LCL.Company_Value_Code_USR = 'DLVTRKRULE';

// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(LCL.Company_Value_Code_USR);
PARAMETER(LCL.System_Value_Alpha_USR);

// WRK.Co Uses HPE & HPS usr = LCL.System Value Alpha    USR
WRK.Co_Uses_HPE_HPS_usr = LCL.System_Value_Alpha_USR;

//?USER: Initialize subfile record

CASE;

// IF DB1.BOH MPR Purchase Type is *ALL values
IF DB1.BOH_MPR_Purchase_Type = '01'/'02'/'03'/'04'/'05'/'06'/'07'/'08'/'09'/'10'/'11';

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV MPR Prdcr Purch TpRT) TYPE(RTVOBJ) FILE(PKE3CPP)           AB1235599;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(LCL.MPR_Purchase_Type_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// CTL.BOH MPR Purchase Type = CVTVAR(LCL.MPR Purchase Type Code)
CTL.BOH_MPR_Purchase_Type = CVTVAR(LCL.MPR_Purchase_Type_Code);

ENDIF;

EXECUTE FUNCTION(Rtv Mvmnt,Farm f/BOL  RT) TYPE(RTVOBJ) FILE(PLAECPP)           AB1245116;
PARAMETER(DB2.BOL_Kill_Date);
PARAMETER(LCL.DSD_Farm_Site_Code);
PARAMETER(RCD.TH_HPS_Movement_Ref_#);
PARAMETER(DB2.BOH_Company_Number);
PARAMETER(DB2.BOH_Buy_Order_Number);
PARAMETER(DB2.BOL_Load_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


CASE;

// IF RCD.TH HPS Movement Ref # is Not entered
IF RCD.TH_HPS_Movement_Ref_# = *ZERO;

EXECUTE FUNCTION(Rtv Movement Number   RT) TYPE(RTVOBJ) FILE(PLAFCPP)           AB1247975;
PARAMETER(DB2.BOH_Company_Number);
PARAMETER(DB2.BOH_Buy_Order_Number);
PARAMETER(DB2.BOL_Load_Number);
PARAMETER(RCD.TH_HPS_Movement_Ref_#);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


ENDIF;

//?1/21/03 Save date/time to check for Delivery tracking change necessary
// RCD.Time USR = DB2.BOL Pln Delv Start Time
RCD.Time_USR = DB2.BOL_Pln_Delv_Start_Time;

// RCD.Date Beg USR = DB2.BOL Pln Delv Date
RCD.Date_Beg_USR = DB2.BOL_Pln_Delv_Date;

CASE;

// IF DB1.RS Record Status is InActive
IF DB1.RS_Record_Status = 'I';

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

// RCD.BOL Pln Delv Date = DB2.BOL Pln Delv Date
RCD.BOL_Pln_Delv_Date = DB2.BOL_Pln_Delv_Date;

//?E3577 SET STS TO YES IF A DETAIL EXISTS
// LCL.Status 1 = CND.Yes
LCL.Status_1 = 'Y';

EXECUTE FUNCTION(Rtv Buy Order Load Ref RT) TYPE(RTVOBJ) FILE(PWACCPP)          AB1333104;
PARAMETER(DB2.BOH_Company_Number);
PARAMETER(DB2.BOH_Buy_Order_Number);
PARAMETER(DB2.BOL_Load_Number);
PARAMETER(RCD.BOL_Ref_1);
PARAMETER(RCD.BOL_Ref_2);
PARAMETER(RCD.BOL_Ref_Status);
PARAMETER(NLL.RS_Record_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//? 5/22/17 JBB C9426 - Remove validation of the REF fields.
//?USER: Validate header non-key relations

EXECUTE FUNCTION(Rtv Producer Split    RT) TYPE(RTVOBJ) FILE(PKBFREP)           AB1107922;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.Primary_Split_USR);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.PSS_Split_Percent = 100;

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Producer TrkSz,Src RT) TYPE(RTVOBJ) FILE(PKACREP)          AB1121114;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Std_Truck_Size);
PARAMETER(LCL.PD_Freight_Exp_Paid_By);
PARAMETER(WRK.SR_Source_Code);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Source Type       RT) TYPE(RTVOBJ) FILE(PKAAREP)           AB1141829;
PARAMETER(WRK.SR_Source_Code);
PARAMETER(WRK.SR_Type);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// CTL.BOH Status Desc Usr = Condition name of CTL.BOH Status
CTL.BOH_Status_Desc_Usr = RTVCND(CTL.BOH_Status);

//?********** 08/02/95 PKP **********
//?If Payment Type = Carcass Merit, validate Base Quote & Type.
//?If Payment Type = Live, Base Quote must be 0 and Type is blank.
//?**********************************
//?USER: Validate subfile record fields

// RCD.BOL MPR Prior Day Prch = CND.Blank
RCD.BOL_MPR_Prior_Day_Prch = *BLANK;

//?CALC: Subfile record function fields

CTL.Head_Total_SUM = SUM(RCD.BOL_Pln_Head_Delv);

//?USER: Validate totals

//?Command 14 comments
CASE;

// IF CTL.*CMD key is CF14
IF CTL.*CMD_key = '14';

// Call program Edt BO Comments       EF.
CALL PROGRAM(Edt BO Comments       EF) ('PKASEFR');
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F15 EDIT PRODUCER SPLITE WAS removed this is a payment function
//?and should not be here
//?USER: Process command keys

RETURN;

