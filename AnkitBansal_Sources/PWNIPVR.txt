// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWNIPVR
// ?Date: 14.08.2025 Time: 02:57:06
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification History
DO;

//? 6/08/2021 JBB SDD619 - Repayment by Business User
//?               P17058   Function created.  Copied from Pmt Transfer
//?                        Tattoo   PV (PKVDPVR).  This function will
//?                        perform the transfer, and also update the
//?                        Tattoo Repayment Comment file.
ENDDO;

EXECUTE FUNCTION(Val Application/User  IF) TYPE(EXCINTFUN)                      AB1129080;
PARAMETER(PAR.Oms_Warehouse_Code);
PARAMETER(PAR.CC_Company_Number);
PARAMETER('HPE');
PARAMETER(PAR.Oms_SalesPerson_Code);
PARAMETER(PAR.Oms_Allow_Multi_Company);
PARAMETER(PAR.Oms_Default_Printer);
PARAMETER(PAR.Oms_Name);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(PAR.Oms_Access_Denied_Y_N);

//?USER: Load screen

//?Original values coming from the repayment screen
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

//?Convert incoming values to character for TRC Comment
// LCL.Buy Order Number Orig Txt = CVTVAR(PAR.BOH Buy Order Number)
LCL.Buy_Order_Number_Orig_Txt = CVTVAR(PAR.BOH_Buy_Order_Number);

// LCL.Buy Order Load Orig Txt = CVTVAR(PAR.BOL Load Number)
LCL.Buy_Order_Load_Orig_Txt = CVTVAR(PAR.BOL_Load_Number);

// LCL.Tattoo Number Orig Txt = CVTVAR(PAR.TH Tattoo Number)
LCL.Tattoo_Number_Orig_Txt = CVTVAR(PAR.TH_Tattoo_Number);

//?Convert Kill Date from cyymmdd to mm/dd/yy
CASE;

// IF PAR.TH Kill Date is Entered
IF PAR.TH_Kill_Date <> *ZERO;

// Call program Cvt cyymmdd to mm/dd/yyUP.
CALL PROGRAM(Cvt cyymmdd to mm/dd/yyUP) ('PWMZUPR');
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(LCL.Kill_Date_Orig_Txt_8);

//?Convert Kill Date from cyymmdd to mm/dd/yy
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Kill Date Orig Txt 8 = CON.*BLANK
LCL.Kill_Date_Orig_Txt_8 = *BLANK;

ENDIF;

ENDIF;

//?Producer and Location
EXECUTE FUNCTION(Val Buy Order Dtl&Inf RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1292327;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(PGM.*Return_code);

//?Get Tattoo Header Ext for the Site Id & Subsidiary
EXECUTE FUNCTION(Rtv Site ID/Prod Subs RT) TYPE(RTVOBJ) FILE(PKDNCPP)           AB1291789;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(NLL.PD_Producer_Code);
PARAMETER(DTL.PS_Site_ID);
PARAMETER(DTL.Producer_Subsidiary_Code);

//?Load alpha values for TRC Comment
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Producer Code New = DTL.PD Producer Code
DTL.Producer_Code_New = DTL.PD_Producer_Code;

// DTL.Location Code New = DTL.PL Location Code
DTL.Location_Code_New = DTL.PL_Location_Code;

// DTL.Site Id New = DTL.PS Site ID
DTL.Site_Id_New = DTL.PS_Site_ID;

// DTL.Prod Subsidiary New Usr = DTL.Producer Subsidiary Code
DTL.Prod_Subsidiary_New_Usr = DTL.Producer_Subsidiary_Code;

ENDIF;

//?Get Tattoo Header State Code
// Call program Rtv TattooHdr Fields  XF.
CALL PROGRAM(Rtv TattooHdr Fields  XF) ('PLNBXFR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(DTL.TH_HPS_Movement_Ref_#);
PARAMETER(DTL.TH_State);

// DTL.Movement number new usr = DTL.TH HPS Movement Ref #
DTL.Movement_number_new_usr = DTL.TH_HPS_Movement_Ref_#;

// WRK.Movement# Compared = CND.Yes
WRK.Movement#_Compared = 'Y';

// DTL.Text 1 41 Usr = CON.*BLANK
DTL.Text_1_41_Usr = *BLANK;

// DTL.Text 2 41 Usr = CON.*BLANK
DTL.Text_2_41_Usr = *BLANK;

EXECUTE FUNCTION(Rtv PL Vnd Nbr, state RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1207995;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Location_Code_New);
PARAMETER(NLL.PL_Name);
PARAMETER(NLL.Pl_VND_Address_Number);
PARAMETER(NLL.PL_State_Code);
PARAMETER(LCL.PL_Site_ID_Required);

// DTL.Th State code New = DTL.TH State
DTL.Th_State_code_New = DTL.TH_State;

// WRK.Allow Change Usr Y/N ST = CND.Yes
WRK.Allow_Change_Usr_Y_N_ST = 'Y';

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

//?Site is required or not if not then blank out the site
CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

CASE;

// IF LCL.PL Site ID Required is Yes
IF LCL.PL_Site_ID_Required = 'Y';

// WRK.Allow Change Usr Y/N Site = CND.Yes
WRK.Allow_Change_Usr_Y_N_Site = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

//?Site is required or not if not then blank out the site
// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

//?Subsidiary is required or not - if not  blank out subsidiary
DO;

CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

EXECUTE FUNCTION(Rtv ProdSubsidiaryPrc RT) TYPE(RTVOBJ) FILE(PLA8REP)           AB1291791;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(WRK.Producer_Subsidiary_SUSR);

CASE;

// IF WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
IF WRK.Producer_Subsidiary_SUSR = 'Y';

// WRK.Allow Change Usr Y/N Subs = CND.Yes
WRK.Allow_Change_Usr_Y_N_Subs = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Prod Subsidiary New Usr = CON.*BLANK
DTL.Prod_Subsidiary_New_Usr = *BLANK;

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Prod Subsidiary New Usr = CON.*BLANK
DTL.Prod_Subsidiary_New_Usr = *BLANK;

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

ENDIF;

ENDDO;

// DTL.HC Class Type Desc Usr = Condition name of PAR.TH Hog Class Type
DTL.HC_Class_Type_Desc_Usr = RTVCND(PAR.TH_Hog_Class_Type);

// DTL.Status 1 = CND.Yes
DTL.Status_1 = 'Y';

// DTL.Condition Name USR = Condition name of DTL.Status 1
DTL.Condition_Name_USR = RTVCND(DTL.Status_1);

//?If Hog Class Type is Resale and Source Type = Internal
CASE;

// IF PAR.TH Hog Class Type is Resale
IF PAR.TH_Hog_Class_Type = 'R';

// AND PAR.TH Source Type is Internal
AND PAR.TH_Source_Type = 'I';

// WRK.@Status Internal (Y/N) = CND.Yes
WRK.@Status_Internal_Y_N = 'Y';

// DTL.Print Scale Tkt       USR = CND.No
DTL.Print_Scale_Tkt_USR = 'N';

//?If Hog Class Type is Resale and Source Type = Internal
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.@Status Internal (Y/N) = CND.No
WRK.@Status_Internal_Y_N = *BLANK;

// DTL.Print Scale Tkt       USR = CND.Yes
DTL.Print_Scale_Tkt_USR = 'Y';

// DTL.Text 10 1 USR = Condition name of DTL.Print Scale Tkt       USR
DTL.Text_10_1_USR = RTVCND(DTL.Print_Scale_Tkt_USR);

ENDIF;

// DTL.Buy Order New Usr = DTL.BOH Buy Order Number
DTL.Buy_Order_New_Usr = DTL.BOH_Buy_Order_Number;

// DTL.Buy Order Load New Usr = DTL.BOL Load Number
DTL.Buy_Order_Load_New_Usr = DTL.BOL_Load_Number;

// DTL.Kill Date Usr = DTL.TH Kill Date
DTL.Kill_Date_Usr = DTL.TH_Kill_Date;

// DTL.Message Special Usr = CON.*BLANK
DTL.Message_Special_Usr = *BLANK;

// WRK.@Status (Yes/No) = CND.No
WRK.@Status_Yes_No = 'N';

EXECUTE FUNCTION(Vry Held Over Record  RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1196384;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(WRK.@Status_Yes_No);
PARAMETER(WRK.Kill_Date_1_Usr);
PARAMETER(WRK.Kill_Date_2_USR);
PARAMETER(WRK.Freight_Amount_Usr);

//?If Held Over
CASE;

// IF WRK.@Status (Yes/No) is Yes
IF WRK.@Status_Yes_No = 'Y';

// Retrieve message - 'This Tattoo was Held Over from &1 to &2'
DTL.Message_Special_Usr = RTVMSG(PRK0725);
PARAMETER(WRK.Kill_Date_1_Usr);
PARAMETER(WRK.Kill_Date_2_USR);

ENDIF;

//? 2/04/2019 JBB E14234 - Transfer for Repayments
//?USER: Validate fields

//?Select record
CASE;

// IF PGM.*Cursor field <IS> DTL.Buy Order New Usr
IF PGM.*Cursor_field = DTL.Buy_Order_New_Usr;

// AND DTL.*CMD key is CF04
AND DTL.*CMD_key = '04';

// Call program Sel Buy Order Load    SR.
CALL PROGRAM(Sel Buy Order Load    SR) ('PKJBSRR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(DTL.Kill_Date_Usr);

//?Select record
// IF PGM.*Cursor field <IS> DTL.Buy Order Load New Usr
IF PGM.*Cursor_field = DTL.Buy_Order_Load_New_Usr;

// AND DTL.*CMD key is CF04
AND DTL.*CMD_key = '04';

// Call program Sel Buy Order Load    SR.
CALL PROGRAM(Sel Buy Order Load    SR) ('PKJBSRR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(DTL.Kill_Date_Usr);

ENDIF;

//?If the buy order is changing check if frt if frt error
CASE;

// IF DTL.BOH Buy Order Number NE DTL.Buy Order New Usr
IF DTL.BOH_Buy_Order_Number <> DTL.Buy_Order_New_Usr;

// OR DTL.BOL Load Number NE DTL.Buy Order Load New Usr
OR DTL.BOL_Load_Number <> DTL.Buy_Order_Load_New_Usr;

CASE;

// IF WRK.Freight Amount Usr NE WRK.Zero USR
IF WRK.Freight_Amount_Usr <> WRK.Zero_USR;

EXECUTE FUNCTION(RTV Payment Prc        RT) TYPE(RTVOBJ) FILE(PKC4REP)          AB1146809;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(LCL.Pmt_Current_Payment_Date);
PARAMETER(LCL.Pmt_Current_Payment_Step);

//?Allow Transfer if paym date is kill date & paym step is 1. PK0254
CASE;

// IF LCL.Pmt Current Payment Date EQ DTL.TH Kill Date
IF LCL.Pmt_Current_Payment_Date = DTL.TH_Kill_Date;

// AND LCL.Pmt Current Payment Step is Less or Equal to Step 1
AND LCL.Pmt_Current_Payment_Step <= 00001;

//?Allow Transfer if paym date is kill date & paym step is 1. PK0254
// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Invalid selection. Freight has been allocated.'
ERROR(PRK0390);

QUIT;

ENDIF;

ENDIF;

ENDIF;

EXECUTE FUNCTION(Val Buy Order Dtl&Inf RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1292327;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(DTL.Kill_Date_Usr);
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Location_Code_New);
PARAMETER(PGM.*Return_code);

CASE;

// IF PGM.*Return code is Record Found
IF PGM.*Return_code = '999';

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Buy Order Load not found.'
ERROR(PRK0051);

ENDIF;

EXECUTE FUNCTION(Rtv Movement NumberNF RT) TYPE(RTVOBJ) FILE(PLAFCPP)           AB1292759;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(DTL.Movement_number_new_usr);
PARAMETER(PGM.*Return_code);

// WRK.Movement# Compared = CND.Yes
WRK.Movement#_Compared = 'Y';

// DTL.Text 1 41 Usr = CON.*BLANK
DTL.Text_1_41_Usr = *BLANK;

// DTL.Text 2 41 Usr = CON.*BLANK
DTL.Text_2_41_Usr = *BLANK;

CASE;

// IF DTL.Movement number new usr EQ DTL.TH HPS Movement Ref #
IF DTL.Movement_number_new_usr = DTL.TH_HPS_Movement_Ref_#;

// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Movement# Compared = CND.No
WRK.Movement#_Compared = 'N';

// DTL.Text 1 41 Usr = CON.Movement# change,
DTL.Text_1_41_Usr = 'Movement# change,';

// DTL.Text 1 41 Usr = CONCAT(DTL.Text 1 41 Usr,CON.Review Tattoo,CON.1)
DTL.Text_1_41_Usr = DTL.Text_1_41_Usr + 'Review Tattoo' (1);

// DTL.Text 2 41 Usr = CON.Using
DTL.Text_2_41_Usr = 'Using';

// DTL.Text 2 41 Usr = CONCAT(DTL.Text 2 41 Usr,CON.Edit TattooHdr/Defect,CON.1)
DTL.Text_2_41_Usr = DTL.Text_2_41_Usr + 'Edit TattooHdr/Defect' (1);

ENDIF;

//?Make sure the New info isnt the same as the original info
CASE;

// IF DTL.BOH Buy Order Number EQ DTL.Buy Order New Usr
IF DTL.BOH_Buy_Order_Number = DTL.Buy_Order_New_Usr;

// AND DTL.BOL Load Number EQ DTL.Buy Order Load New Usr
AND DTL.BOL_Load_Number = DTL.Buy_Order_Load_New_Usr;

// AND DTL.TH Tattoo Number EQ DTL.Tattoo Number New User
AND DTL.TH_Tattoo_Number = DTL.Tattoo_Number_New_User;

// AND DTL.TH Kill Date EQ DTL.Kill Date Usr
AND DTL.TH_Kill_Date = DTL.Kill_Date_Usr;

// Send error message - 'Cannot transfer to same buy order, load, kill dt, and tattoo.'
ERROR(PRK0919);
MSGPARM(DTL.Buy_Order_New_Usr);
MSGPARM(DTL.Buy_Order_Load_New_Usr);
MSGPARM(DTL.Kill_Date_Usr);
MSGPARM(DTL.Tattoo_Number_New_User);

QUIT;

ENDIF;

EXECUTE FUNCTION(Rtv PL Vnd Nbr, state RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1207995;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Location_Code_New);
PARAMETER(NLL.PL_Name);
PARAMETER(NLL.Pl_VND_Address_Number);
PARAMETER(LCL.PL_State_Code);
PARAMETER(LCL.PL_Site_ID_Required);

// WRK.Producer Subsidiary SUSR = CND.No Producer Subsidiary
WRK.Producer_Subsidiary_SUSR = 'N';

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

// WRK.Allow Change Usr Y/N ST = CND.No
WRK.Allow_Change_Usr_Y_N_ST = 'N';

CASE;

// IF PAR.TH Hog Class Type is Resale
IF PAR.TH_Hog_Class_Type = 'R';

// WRK.Allow Change Usr Y/N ST = CND.Yes
WRK.Allow_Change_Usr_Y_N_ST = 'Y';

ENDIF;

//?Change in producer or location
CASE;

// IF DTL.PD Producer Code NE DTL.Producer Code New
IF DTL.PD_Producer_Code <> DTL.Producer_Code_New;

// DTL.Th State code New = LCL.PL State Code
DTL.Th_State_code_New = LCL.PL_State_Code;

//?Site is required or not if not then blank out the site
CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

CASE;

// IF LCL.PL Site ID Required is Yes
IF LCL.PL_Site_ID_Required = 'Y';

// WRK.Allow Change Usr Y/N Site = CND.Yes
WRK.Allow_Change_Usr_Y_N_Site = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

//?Site is required or not if not then blank out the site
// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

//?Subsidiary is required or not - if not  blank out subsidiary
DO;

CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

EXECUTE FUNCTION(Rtv ProdSubsidiaryPrc RT) TYPE(RTVOBJ) FILE(PLA8REP)           AB1291791;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(WRK.Producer_Subsidiary_SUSR);

CASE;

// IF WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
IF WRK.Producer_Subsidiary_SUSR = 'Y';

// WRK.Allow Change Usr Y/N Subs = CND.Yes
WRK.Allow_Change_Usr_Y_N_Subs = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Prod Subsidiary New Usr = CON.*BLANK
DTL.Prod_Subsidiary_New_Usr = *BLANK;

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Prod Subsidiary New Usr = CON.*BLANK
DTL.Prod_Subsidiary_New_Usr = *BLANK;

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

ENDIF;

ENDDO;

// WRK.Allow Change Usr Y/N ST = CND.Yes
WRK.Allow_Change_Usr_Y_N_ST = 'Y';

//?Change in producer or location
// IF DTL.PL Location Code NE DTL.Location Code New
IF DTL.PL_Location_Code <> DTL.Location_Code_New;

// DTL.Th State code New = LCL.PL State Code
DTL.Th_State_code_New = LCL.PL_State_Code;

//?Site is required or not if not then blank out the site
CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

CASE;

// IF LCL.PL Site ID Required is Yes
IF LCL.PL_Site_ID_Required = 'Y';

// WRK.Allow Change Usr Y/N Site = CND.Yes
WRK.Allow_Change_Usr_Y_N_Site = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

//?Site is required or not if not then blank out the site
// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Site Id New = CON.*BLANK
DTL.Site_Id_New = *BLANK;

// WRK.Allow Change Usr Y/N Site = CND.No
WRK.Allow_Change_Usr_Y_N_Site = 'N';

ENDIF;

// WRK.Allow Change Usr Y/N ST = CND.Yes
WRK.Allow_Change_Usr_Y_N_ST = 'Y';

ENDIF;

CASE;

// IF LCL.PL Site ID Required is Yes
IF LCL.PL_Site_ID_Required = 'Y';

// AND DTL.TH Hog Class Type is Not Resale
AND DTL.TH_Hog_Class_Type = 'M'/'S';

//?Validate New Site Id for new producer
DO;

//?** F4 = Select Producer Site ID to get mileage and or state code
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.Site Id New
AND PGM.*Cursor_field = DTL.Site_Id_New;

// Call program Sel Prod Site Mileage SR.
CALL PROGRAM(Sel Prod Site Mileage SR) ('PLFQSRR');
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Site_Id_New);
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(LCL.PSM_Miles_to_Company);

EXECUTE FUNCTION(Rtv Site State ActOnlyRT) TYPE(RTVOBJ) FILE(PLATREP)           AB1273369;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Site_Id_New);
PARAMETER(DTL.Th_State_code_New);

ENDIF;

//?Not a Contract, No Rsl Hogs, then Site Id is req, pull th state
CASE;

// IF PAR.TH Hog Class Type is Not Resale
IF PAR.TH_Hog_Class_Type = 'M'/'S';

//?Site ID will not be required on Resale Hogs
//?** Error if Site ID is blank
CASE;

// IF DTL.Site Id New is *Blank
IF DTL.Site_Id_New = *BLANK;

// Send error message - 'Producer Site ID Required'
ERROR(PRK1140);
MSGPARM(DTL.Site_Id_New);

ENDIF;

EXECUTE FUNCTION(Rtv PrdSiteMil CoMilStRT) TYPE(RTVOBJ) FILE(PLASREP)           AB1273532;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Site_Id_New);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(LCL.PSM_Miles_to_Company);
PARAMETER(DTL.Th_State_code_New);

//?** Error if no matching record in Producer Site Mileage
CASE;

// IF LCL.PSM Miles to Company is No Miles
IF LCL.PSM_Miles_to_Company = *ZERO;

// Send error message - 'Producer Site/Mileage NF'
ERROR(PRK1153);
MSGPARM(DTL.Site_Id_New);

//?** Error if no matching record in Producer Site Mileage
// IF DTL.Th State code New EQ WRK.Blank USR
IF DTL.Th_State_code_New = WRK.Blank_USR;

// Send error message - 'State Code is Invalid'
ERROR(PRK0308);
MSGPARM(DTL.Th_State_code_New);

ENDIF;

ENDIF;

ENDDO;

// IF LCL.PL Site ID Required is No
IF LCL.PL_Site_ID_Required = 'N';

// AND DTL.TH Hog Class Type is Not Resale
AND DTL.TH_Hog_Class_Type = 'M'/'S';

// WRK.Allow Change Usr Y/N ST = CND.Yes
WRK.Allow_Change_Usr_Y_N_ST = 'Y';

ENDIF;

EXECUTE FUNCTION(Rtv ProdSubsidiaryPrc RT) TYPE(RTVOBJ) FILE(PLA8REP)           AB1291791;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(WRK.Producer_Subsidiary_SUSR);

CASE;

// IF WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
IF WRK.Producer_Subsidiary_SUSR = 'Y';

// AND PAR.TH Hog Class Type is Not Resale
AND PAR.TH_Hog_Class_Type = 'M'/'S';

//?Select on Producer Subsidiary
CASE;

// IF WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
IF WRK.Producer_Subsidiary_SUSR = 'Y';

//?** F4 = Select Producer subsidiary
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.Prod Subsidiary New Usr
AND PGM.*Cursor_field = DTL.Prod_Subsidiary_New_Usr;

// Call program Zzz ProdSubsidiary    SR.
CALL PROGRAM(Zzz ProdSubsidiary    SR) ('PLM2SRR');
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Prod_Subsidiary_New_Usr);

ENDIF;

ENDIF;

//?Validation on Producer subsidiary
CASE;

// IF DTL.Prod Subsidiary New Usr is Blank
IF DTL.Prod_Subsidiary_New_Usr = *BLANK;

// AND WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
AND WRK.Producer_Subsidiary_SUSR = 'Y';

// Send error message - 'Producer Subsidiary is required'
ERROR(PRK1215);
MSGPARM(DTL.Prod_Subsidiary_New_Usr);

//?Validation on Producer subsidiary
// IF DTL.Prod Subsidiary New Usr is Entered
IF DTL.Prod_Subsidiary_New_Usr <> *BLANK;

// AND WRK.Producer Subsidiary SUSR is Allow Producer Subsidiary
AND WRK.Producer_Subsidiary_SUSR = 'Y';

// PGM.*Return code = CND.*Normal
PGM.*Return_code = *BLANK;

EXECUTE FUNCTION(Val ProdSubsidiary    RT) TYPE(RTVOBJ) FILE(PLA8REP)           AB1291790;
PARAMETER(DTL.Producer_Code_New);
PARAMETER(DTL.Prod_Subsidiary_New_Usr);

CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Producer Subsidiary NotFn'
ERROR(PRK1216);
MSGPARM(DTL.Prod_Subsidiary_New_Usr);

ENDIF;

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Prod Subsidiary New Usr = CON.*BLANK
DTL.Prod_Subsidiary_New_Usr = *BLANK;

// WRK.Allow Change Usr Y/N Subs = CND.No
WRK.Allow_Change_Usr_Y_N_Subs = 'N';

ENDIF;

//?** Validate state code
CASE;

// IF DTL.Th State code New EQ WRK.Blank USR
IF DTL.Th_State_code_New = WRK.Blank_USR;

// Send error message - 'State Code is Invalid'
ERROR(PRK0308);
MSGPARM(DTL.Th_State_code_New);

//?** Validate state code
// IF *OTHERWISE
IF *OTHERWISE;

// Call program Rtv State Description UP.
CALL PROGRAM(Rtv State Description UP) ('STATERET');
PARAMETER(LCL.Return_Code_USR);
PARAMETER(DTL.Th_State_code_New);
PARAMETER(NLL.State_Desc_30_USR);

//?Invalid state code send message
CASE;

// IF LCL.Return Code USR is *Normal
IF LCL.Return_Code_USR = *BLANK;

//?Invalid state code send message
// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'State Code is Invalid'
ERROR(PRK0308);
MSGPARM(DTL.Th_State_code_New);

ENDIF;

ENDIF;

EXECUTE FUNCTION(Val Tto/KlDt Exst Wrn RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1223951;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Tattoo_Number_New_User);
PARAMETER(DTL.Kill_Date_Usr);
PARAMETER(DTL.TH_Source_Type);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Kill_Date);

EXECUTE FUNCTION(Val Tattoo Existance  RT) TYPE(RTVOBJ) FILE(PKFJCPP)           AB1243996;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Kill_Date_Usr);
PARAMETER(DTL.Tattoo_Number_New_User);

CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Tattoo Pending already exists.'
ERROR(PRK1013);

ENDIF;

//?CALC: Screen function fields

// DTL.Text 10 1 USR = Condition name of DTL.Print Scale Tkt       USR
DTL.Text_10_1_USR = RTVCND(DTL.Print_Scale_Tkt_USR);

//?USER: User defined action

//?Pass in the Site & Subsidiary if they need to change
//?then transfer site id and transfer subsidiary = Y will then
//?direct the next function to change the site id or the subsidary
//?Pass in the status fields and the site id new, and subsidiary new
// LCL.Transfer Site Id Usr = CND.No
LCL.Transfer_Site_Id_Usr = 'N';

// LCL.Transfer Subsidiary Usr = CND.No
LCL.Transfer_Subsidiary_Usr = 'N';

// LCL.Transfer State User = CND.No
LCL.Transfer_State_User = 'N';

//?If Site ID changes
CASE;

// IF DTL.PS Site ID NE DTL.Site Id New
IF DTL.PS_Site_ID <> DTL.Site_Id_New;

// LCL.Transfer Site Id Usr = CND.Yes
LCL.Transfer_Site_Id_Usr = 'Y';

ENDIF;

//?If Producer Subsidiary changes
CASE;

// IF DTL.Producer Subsidiary Code NE DTL.Prod Subsidiary New Usr
IF DTL.Producer_Subsidiary_Code <> DTL.Prod_Subsidiary_New_Usr;

// LCL.Transfer Subsidiary Usr = CND.Yes
LCL.Transfer_Subsidiary_Usr = 'Y';

ENDIF;

//?If State code changes
CASE;

// IF DTL.TH State NE DTL.Th State code New
IF DTL.TH_State <> DTL.Th_State_code_New;

// LCL.Transfer State User = CND.Yes
LCL.Transfer_State_User = 'Y';

ENDIF;

//?If Held Over
CASE;

// IF WRK.@Status (Yes/No) is Yes
IF WRK.@Status_Yes_No = 'Y';

//?Held over process the first and then the second kill date
//? Kill date 1   *note: heldover cant be transferred to a diff kill dt.
// Call program Exc TrnsfrTtt-AllFiles XF.
CALL PROGRAM(Exc TrnsfrTtt-AllFiles XF) ('PKVFXFR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(WRK.Kill_Date_1_Usr);
PARAMETER(DTL.Tattoo_Number_New_User);
PARAMETER(DTL.Print_Scale_Tkt_USR);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(WRK.Kill_Date_1_Usr);
PARAMETER(DTL.Status_1);
PARAMETER(DTL.Site_Id_New);
PARAMETER(LCL.Transfer_Site_Id_Usr);
PARAMETER(DTL.Prod_Subsidiary_New_Usr);
PARAMETER(LCL.Transfer_Subsidiary_Usr);
PARAMETER(DTL.Th_State_code_New);
PARAMETER(LCL.Transfer_State_User);
PARAMETER(WRK.Process_EditTattooHdr_USR);

//? Kill date 2
// Call program Exc TrnsfrTtt-AllFiles XF.
CALL PROGRAM(Exc TrnsfrTtt-AllFiles XF) ('PKVFXFR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(WRK.Kill_Date_2_USR);
PARAMETER(DTL.Tattoo_Number_New_User);
PARAMETER(DTL.Print_Scale_Tkt_USR);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(WRK.Kill_Date_2_USR);
PARAMETER(DTL.Status_1);
PARAMETER(DTL.Site_Id_New);
PARAMETER(LCL.Transfer_Site_Id_Usr);
PARAMETER(DTL.Prod_Subsidiary_New_Usr);
PARAMETER(LCL.Transfer_Subsidiary_Usr);
PARAMETER(DTL.Th_State_code_New);
PARAMETER(LCL.Transfer_State_User);
PARAMETER(WRK.Process_EditTattooHdr_USR);

//?If Held Over
// IF *OTHERWISE
IF *OTHERWISE;

// Call program Exc TrnsfrTtt-AllFiles XF.
CALL PROGRAM(Exc TrnsfrTtt-AllFiles XF) ('PKVFXFR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(DTL.Tattoo_Number_New_User);
PARAMETER(DTL.Print_Scale_Tkt_USR);
PARAMETER(DTL.Buy_Order_New_Usr);
PARAMETER(DTL.Buy_Order_Load_New_Usr);
PARAMETER(DTL.Kill_Date_Usr);
PARAMETER(DTL.Status_1);
PARAMETER(DTL.Site_Id_New);
PARAMETER(LCL.Transfer_Site_Id_Usr);
PARAMETER(DTL.Prod_Subsidiary_New_Usr);
PARAMETER(LCL.Transfer_Subsidiary_Usr);
PARAMETER(DTL.Th_State_code_New);
PARAMETER(LCL.Transfer_State_User);
PARAMETER(WRK.Process_EditTattooHdr_USR);

ENDIF;

//?Repayment changes and updates
DO;

// LCL.Update Flag = CND.No
LCL.Update_Flag = 'N';

//?If Buy Order Number changes value
CASE;

// IF DTL.BOH Buy Order Number NE DTL.Buy Order New Usr
IF DTL.BOH_Buy_Order_Number <> DTL.Buy_Order_New_Usr;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.Buy Order Number New Txt = CVTVAR(DTL.Buy Order New Usr)
LCL.Buy_Order_Number_New_Txt = CVTVAR(DTL.Buy_Order_New_Usr);

// LCL.TRC Comment = CONCAT(CON.Buy Order transfered from,LCL.Buy Order Number Orig Txt,CND.*One)
LCL.TRC_Comment = 'Buy Order transfered from' + LCL.Buy_Order_Number_Orig_Txt (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,LCL.Buy Order Number New Txt,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + LCL.Buy_Order_Number_New_Txt (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Load# changes value
CASE;

// IF DTL.BOL Load Number NE DTL.Buy Order Load New Usr
IF DTL.BOL_Load_Number <> DTL.Buy_Order_Load_New_Usr;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.Buy Order Load New Txt = CVTVAR(DTL.Buy Order Load New Usr)
LCL.Buy_Order_Load_New_Txt = CVTVAR(DTL.Buy_Order_Load_New_Usr);

// LCL.TRC Comment = CONCAT(CON.Load# transferred from,LCL.Buy Order Load New Txt,CND.*One)
LCL.TRC_Comment = 'Load# transferred from' + LCL.Buy_Order_Load_New_Txt (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,LCL.Buy Order Load New Txt,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + LCL.Buy_Order_Load_New_Txt (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Tattoo# changes value
CASE;

// IF DTL.BOL Load Number NE DTL.Buy Order Load New Usr
IF DTL.BOL_Load_Number <> DTL.Buy_Order_Load_New_Usr;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.Tattoo Number New Txt = CVTVAR(DTL.Tattoo Number New User)
LCL.Tattoo_Number_New_Txt = CVTVAR(DTL.Tattoo_Number_New_User);

// LCL.TRC Comment = CONCAT(CON.Tattoo# transferred from,LCL.Tattoo Number Orig Txt,CND.*One)
LCL.TRC_Comment = 'Tattoo# transferred from' + LCL.Tattoo_Number_Orig_Txt (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,LCL.Tattoo Number New Txt,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + LCL.Tattoo_Number_New_Txt (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Kill Date changes value (this should never happen)
CASE;

// IF DTL.TH Kill Date NE DTL.Kill Date Usr
IF DTL.TH_Kill_Date <> DTL.Kill_Date_Usr;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

//?If Transfer Kill Date entered, convert to mm/dd/yy
CASE;

// IF DTL.Kill Date Usr is Entered
IF DTL.Kill_Date_Usr <> 0;

// Call program Cvt cyymmdd to mm/dd/yyUP.
CALL PROGRAM(Cvt cyymmdd to mm/dd/yyUP) ('PWMZUPR');
PARAMETER(DTL.Kill_Date_Usr);
PARAMETER(LCL.Kill_Date_New_Txt_8);

ENDIF;

// LCL.TRC Comment = CONCAT(CON.Kill Date transfered from,LCL.Kill Date Orig Txt 8,CND.*One)
LCL.TRC_Comment = 'Kill Date transfered from' + LCL.Kill_Date_Orig_Txt_8 (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,LCL.Kill Date New Txt 8,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + LCL.Kill_Date_New_Txt_8 (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Producer changed
CASE;

// IF DTL.PD Producer Code NE DTL.Producer Code New
IF DTL.PD_Producer_Code <> DTL.Producer_Code_New;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.TRC Comment = CONCAT(CON.Producer transferred from,DTL.PD Producer Code,CND.*One)
LCL.TRC_Comment = 'Producer transferred from' + DTL.PD_Producer_Code (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,DTL.Producer Code New,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + DTL.Producer_Code_New (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Location changed
CASE;

// IF DTL.PL Location Code NE DTL.Location Code New
IF DTL.PL_Location_Code <> DTL.Location_Code_New;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.TRC Comment = CONCAT(CON.Location transferred from,DTL.PL Location Code,CND.*One)
LCL.TRC_Comment = 'Location transferred from' + DTL.PL_Location_Code (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,DTL.Location Code New,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + DTL.Location_Code_New (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Site ID changed
CASE;

// IF DTL.PS Site ID NE DTL.Site Id New
IF DTL.PS_Site_ID <> DTL.Site_Id_New;

// LCL.Update Flag = CND.Yes
LCL.Update_Flag = 'Y';

// LCL.TRC Comment = CONCAT(CON.Site ID transferred from,DTL.PS Site ID,CND.*One)
LCL.TRC_Comment = 'Site ID transferred from' + DTL.PS_Site_ID (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,CON.to,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + 'to' (1);

// LCL.TRC Comment = CONCAT(LCL.TRC Comment,DTL.Site Id New,CND.*One)
LCL.TRC_Comment = LCL.TRC_Comment + DTL.Site_Id_New (1);

EXECUTE FUNCTION(Crt Tattoo Repay Cmnt CR) TYPE(CRTOBJ) FILE(PWAYCPP)           AB1364775;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(DTL.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(LCL.TRC_Comment);
PARAMETER('S');

ENDIF;

//?If Update flag is Yes, mark Tattoo Repayment Detail as Edited
CASE;

// IF LCL.Update Flag is Yes
IF LCL.Update_Flag = 'Y';

// Call program Chg Tatt Repay Dtl Sts XF.
CALL PROGRAM(Chg Tatt Repay Dtl Sts XF) ('PWNQXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER(PAR.TRH_Repayment_ID);
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER('E');

ENDIF;

ENDDO;

RETURN;

