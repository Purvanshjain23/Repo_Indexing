/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CL PROGRAM FOR DOWNLOADING MANDATORY PRICE REPORING  */
/*             FILES TO THE MPR PC WITHOUT DOING THE BUILD.        */
/*             REPORTING TIME 3 SENDS THE A.M. PRIOR DAY FILES     */
/*             REPORTING TIME 1,2 SENDS THE DAILY PURCH. FILES     */
/*                                                                  */
/*  NOTE  ***** MUST BE COMPILED USER PROFILE(*OWNER)   *****       */
/*                                                                  */
/*  SYSTEM    - HOG PROCUREMENT AND EVALUATION                      */
/*  DATE      - 09/25/00                                            */
/*  DEVELOPER - ROSE CENTONZE                                       */
/*                                                                  */
/********************************************************************/
/* MODIFICATIONS:                                                   */
/* RMC  9/24/01  SEND THE FILES WITHOUT RUNNING THE BUILD -       */
/*               DATE & RPT TIME ARE SENT FROM THE PROMPT.       */
/* RMC  5/16/02  DONT PRINT TO PRKPRT04                           */
/* RMC  11/16/5  NEW FTPMPRPLT, COMMENT SETHPELIB, PASS PLANT & CO AS PARM */
/* RMC  04/25/6  WHEN  E7UZPR IS ZERO, OUTPUT BLANKS-PKE7CPP     */
/* RMC  05/17/6  CHG &DOC TO HAVE THE &PLTNO ALSO- 1ST DIGIT OF COMPANY */
/* RMC  06/20/08 E00175 -  ADDED PARM TO FTPMPRPLT FOR FTP TO NEW FOLDER Y/N */
/*               IT WILL BE "N" IN THIS PGM                        */
/* RMC  07/18/08 E00175 -  CHG NEWFLD PARM VALUE TO "Y"  */
/* RMC R14015 05/15/19 CHANGED TO NEW SERVER - CODE HERE REPLACES FTPMPRPLT */
/*             6/11/19 CHANGE &IDIR TO 47 LONG  */
/********************************************************************/
             PGM        PARM(&RETURN &RPTDTEX &RPTTMEX &PLTEST &PLTCO )

/* WORK FIELDS */
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7) /*REPORTING DATE    */
             DCL        VAR(&PLTEST) TYPE(*CHAR) LEN(5)   /*PLT ESTABLISHMENT#*/
             DCL        VAR(&RPTDTE) TYPE(*DEC ) LEN(7 0) /*REPORTING DATE    */
             DCL        VAR(&RPTDTEX) TYPE(*CHAR) LEN(7) /*REPORTING DATE    */
             DCL        VAR(&RPTTME) TYPE(*DEC ) LEN(1 0) /*REPORTING TIME    */
             DCL        VAR(&RPTTMEX) TYPE(*CHAR) LEN(1) /*REPORTING TIME    */
             DCL        VAR(&RPTDAY) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&LS118C) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&LS119B) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&YYMD)   TYPE(*CHAR) LEN(8)   /*YYYYMMDD          */
             DCL        VAR(&YYYY)   TYPE(*CHAR) LEN(4)   /*YEAR              */
             DCL        VAR(&MM)     TYPE(*CHAR) LEN(2)   /*MONTH             */
             DCL        VAR(&DD)     TYPE(*CHAR) LEN(2)   /*DAY               */
             DCL        VAR(&TIME)   TYPE(*CHAR) LEN(6)   /*SYSTEM TIME       */
             DCL        VAR(&PLTCO) TYPE(*CHAR) LEN(3) /* PLANT +
                          COMPANY */
             DCL        VAR(&PLTNO) TYPE(*CHAR) LEN(2) /* PLANT 1ST DIGIT */
             DCL        VAR(&USRCLS) TYPE(*CHAR) LEN(10) /*  USER CLASS       */
             DCL        VAR(&NEWFLD) TYPE(*CHAR) LEN(1) VALUE('Y') +
                          /* FTP TO NEW FOLDER */

             DCL        VAR(&DOC)   TYPE(*CHAR) LEN(10)   /*DOCUMENT NAME     */
             DCL        VAR(&PCFILE) TYPE(*CHAR) LEN(32) /*PC FILE           */
                        /* FORMAT: LS118A_PPPPP_YYYYMMDDHHMMSS.MPR */

             DCL        VAR(&RMTCMD) TYPE(*CHAR) LEN(256) /*REMOTE COMMAND*/

             DCL        VAR(&SEL)   TYPE(*CHAR) LEN(800) /*SELECT STATEMENT  */

             DCL        VAR(&DIR1) TYPE(*CHAR) LEN(36)
             DCL        VAR(&DIR) TYPE(*CHAR) LEN(11)
     /*      DCL        VAR(&IDIR) TYPE(*CHAR) LEN(50)    */
             DCL        VAR(&IDIR) TYPE(*CHAR) LEN(47)
             DCL        VAR(&IDIRNM) TYPE(*CHAR) LEN(90)

/*-----------------------------------------------------------------*/
/* INITILIZATION                                                   */
/*-----------------------------------------------------------------*/
/* SET LIBRARY LIST               */
             RTVUSRPRF  USRCLS(&USRCLS)
             IF COND(&USRCLS *NE '*PGMR') THEN(DO)
/*           CALL       PGM(HPEDEVGEN/SETHPELIB)            */
             ENDDO
/* ADD SEQUEL TO THE LIBRARY LIST */
/*           ADDLIBLE   LIB(SEQUEL) POSITION(*LAST)         +
             MONMSG     MSGID(CPF0000)                     */
/*-----------------------------------------------------------------*/
/* MAINLINE                                                        */
/*-----------------------------------------------------------------*/
             /* SET UP DATE AND TIME */
SENDIT:
/*           CHGVAR     VAR(&RPTTMEX) VALUE('3')          */
/*           CHGVAR     VAR(&PLTEST) VALUE('13597')       */
/*           CHGVAR     VAR(&RPTTMEX) VALUE(&RPTTME)   */
/*           CHGVAR     VAR(&RPTDTE) VALUE(&RPTDTEX)   */
PLTNO:       CHGVAR     VAR(&PLTNO) VALUE(%SST(&PLTCO 1 2))
             CVTDAT     DATE(&RPTDTEX) TOVAR(&YYMD) FROMFMT(*CYMD) +
                          TOFMT(*YYMD) TOSEP(*NONE)
             CHGVAR     VAR(&YYYY) VALUE(%sst(&YYMD 1 4))
             CHGVAR     VAR(&MM)   VALUE(%sst(&YYMD 5 2))
             CHGVAR     VAR(&DD)   VALUE(%sst(&YYMD 7 2))

             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)

  /******* SEND FILE A: LS118A MPR PRIOR DAY SCHEDULED (PKE5CPP)   *******/
             IF         COND(&RPTTMEX *EQ '3') THEN(DO)
             CHGVAR     VAR(&DOC)  VALUE('PKE5CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls118a_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

             CHGVAR     VAR(&SEL) VALUE('SELECT +
                          E5H8CD,CHAR(CVTDATE(E5ETDT,CYMD),USA) +
                          LEN(10) NAME(RPTDTE), E5C2A1, E5C4A1, +
                          E5C5A1, E5C6A1, E5C7A1, E5C8A1, E5C9A1, +
                          E5DAA1, E5DBA1, E5DCA1, E5DDA1, E5DEA1, +
                          E5DFA1, E5DGA1, E5DHA1 FROM PKE5CPP WHERE +
                          E5H8CD="' *CAT &PLTEST *CAT '" AND +
                          E5ETDT=' *CAT &RPTDTEX *BCAT 'AND +
                          E5C2A1=' *CAT &RPTTMEX)
  GOTO NEW
          EXECUTE    SQL(&SEL) +
                          TOFLR(GUY.IS) +
                          TODOC(&DOC) PCFMT(*COMMA) +
                          REPLACE(*YES)

             CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW:         MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


  /******* SEND FILE B: LS118B MPR PRIOR DAY SLAUGHTERED (PKE6CPP) *******/
      /* RMC 7.18.08 REMOVE HI & LO NET PRICES:  E6UWPR, E6UXPR   */

NEXT:        CHGVAR     VAR(&DOC)  VALUE('PKE6CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls118B_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')
             CHGVAR     VAR(&SEL) VALUE('SELECT +
                          E6H8CD,CHAR(CVTDATE(E6ETDT,CYMD),USA) +
                          LEN(10) NAME(RPTDTE), E6C2A1, E6IBCD, +
                          E6DOA1, E6DPA1, +
  CASE E6DQA1 WHEN 0 THEN " " ELSE CHAR(E6DQA1) END NAME(DQA1), +
  CASE E6UUPR WHEN 0 THEN "  " ELSE CHAR(E6UUPR) END NAME(UUPR), +
  CASE E6UVPR WHEN 0 THEN "  " ELSE CHAR(E6UVPR) END NAME(UVPR), +
  CASE E6DRA1 WHEN 0 THEN "  " ELSE CHAR(E6DRA1) END NAME(DRA1), +
  CASE E6DSA1 WHEN 0 THEN "  " ELSE CHAR(E6DSA1) END NAME(DSA1), +
  CASE E6UYPR WHEN 0 THEN "  " ELSE CHAR(E6UYPR) END NAME(UYPR), +
  CASE E6DTA1 WHEN 0 THEN "  " ELSE CHAR(E6DTA1) END NAME(DTA1), +
  CASE E6DUA1 WHEN 0 THEN "  " ELSE CHAR(E6DUA1) END NAME(DUA1), +
                          E6DVA1 FROM PKE6CPP WHERE +
                          E6H8CD="' *CAT &PLTEST *CAT '" AND +
                          E6ETDT=' *CAT &RPTDTEX *BCAT 'AND +
                          E6C2A1=' *CAT &RPTTMEX)
 GOTO NEW1
             EXECUTE    SQL(&SEL) +
                          TOFLR(GUY.IS) +
                          TODOC(&DOC) PCFMT(*COMMA) +
                          REPLACE(*YES)

                CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW1:        MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


/***** SEND FILE C: LS118C MPR PRIOR DAY PURCHASED (PKE7CPP)   ****    ***/
      /* RMC76.18.08 ADDED STATE FIELD E7IDCD  TO END OF FILE */

  IF COND(&LS118C *EQ 'N') THEN(GOTO PRINT)
  NEXT2:     CHGVAR     VAR(&DOC)  VALUE('PKE7CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls118C_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

             CHGVAR     VAR(&SEL) VALUE('SELECT +
                          E7H8CD,CHAR(CVTDATE(E7ETDT,CYMD),USA) +
                          LEN(10) NAME(RPTDTE), E7C2A1,E7IBCD, +
                          E7DWA1, E7DXA1, E7DYA1, E7DZA1, +
  CASE E7D0A1 WHEN 0 THEN "  " ELSE CHAR(E7D0A1) END NAME(D0A1), +
  CASE E7UZPR WHEN 0 THEN "  " ELSE CHAR(E7UZPR) END NAME(UZPR), E7IDCD  +
                                 FROM PKE7CPP WHERE E7H8CD="' *CAT +
                          &PLTEST *CAT '" AND E7ETDT=' *CAT +
                          &RPTDTEX *BCAT 'AND E7C2A1=' *CAT &RPTTMEX)
GOTO NEW2
             EXECUTE    SQL(&SEL) TOFLR(GUY.IS) TODOC(&DOC) +
                          PCFMT(*COMMA) REPLACE(*YES)

                CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW2:        MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


/*  SEND SQL REPORT TO GUPPRT201                                   */
/*                                                                 */
    PRINT:      IF COND(&USRCLS *NE '*PGMR') THEN(DO)
   IF   COND(&PLTCO = '360') THEN(DO)
             OVRPRTF    FILE(SQLPRT1) OUTQ(GUPPRT201) HOLD(*NO)
             ENDDO
   IF   COND(&PLTCO = '960') THEN(DO)
             OVRPRTF    FILE(SQLPRT1) OUTQ(TFPRT04A) HOLD(*NO)
             ENDDO
             REPORT     REPORT(SQPKE5CPPR) VIEW(SQPKE5CPPP) +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))
             REPORT     REPORT(SQPKE6CPPR) VIEW(SQPKE6CPPP) +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))
             REPORT     REPORT(SQPKE7CPPR) VIEW(SQPKE7CPPP) +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))
             ENDDO
/*  SEND SQL REPORT TO PRKPRT04                                   */
/*                                                                 */
   /*        OVRPRTF    FILE(SQLPRT1) OUTQ(PRKPRT04) HOLD(*NO)         +
             REPORT     REPORT(SQPKE5CPPR) VIEW(SQPKE5CPPP) +          +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))         +
             REPORT     REPORT(SQPKE6CPPR) VIEW(SQPKE6CPPP) +          +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))         +
             REPORT     REPORT(SQPKE7CPPR) VIEW(SQPKE7CPPP) +          +
                          HOLD(*SAME) SETVAR((&ETDT &RPTDTEX))         */

             ENDDO

 /******* SEND FILE A: LS119A MPR DAILY PURCHASE SUM  (PKE8CPP)   **** ***/


             IF         COND(&RPTTMEX *NE '3') THEN(DO)

             CHGVAR     VAR(&DOC)  VALUE('PKE8CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls119a_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

             CHGVAR     VAR(&SEL) VALUE('SELECT E8H8CD, +
                          CHAR(CVTDATE(E8ETDT,CYMD),USA) LEN(10) +
                          NAME(RPTDTE), E8C2A1, E8D1A1, E8D2A1, +
                          E8D3A1, E8D4A1, E8D5A1, E8D6A1, E8D7A1, +
                          E8D8A1, E8D9A1, E8EAA1, E8EBA1, E8ECA1, +
                          E8EDA1, E8EEA1, E8EFA1, E8EGA1 FROM +
                          PKE8CPP WHERE E8H8CD="' *CAT &PLTEST *CAT +
                          '" AND E8ETDT=' *CAT &RPTDTEX *BCAT 'AND +
                          E8C2A1=' *CAT &RPTTMEX)
GOTO NEW3
             EXECUTE    SQL(&SEL) +
                          TOFLR(GUY.IS) +
                          TODOC(&DOC) PCFMT(*COMMA) +
                          REPLACE(*YES)

                CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW3:        MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


  /****** SEND FILE B: LS119B MPR DAILY PURCHASE DTL    (PKE9CPP) **** ***/

LS119B:      IF COND(&LS119B *EQ 'N') THEN(GOTO PRINT2)

             CHGVAR     VAR(&DOC)  VALUE('PKE9CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls119B_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

             CHGVAR     VAR(&SEL) VALUE('SELECT E9H8CD, +
                          CHAR(CVTDATE(E9ETDT,CYMD),USA) LEN(10) +
                          NAME(RPTDTE), E9C2A1, E9IBCD, E9EIA1, +
CASE E9EJA1 WHEN 0 THEN " " ELSE CHAR(E9EJA1) END NAME(EJA1),E9EKA1, +
CASE E9ELA1  WHEN 0 THEN " " ELSE CHAR(E9ELA1) END NAME(ELA1), +
CASE E9U0PR  WHEN 0 THEN " " ELSE CHAR(E9U0PR) END NAME(U0PR), +
                          E9IDCD +
                          FROM PKE9CPP WHERE E9H8CD="' *CAT &PLTEST +
                          *CAT '" AND E9ETDT=' *CAT &RPTDTEX *BCAT +
                          'AND E9C2A1=' *CAT &RPTTMEX)
GOTO NEW4
             EXECUTE    SQL(&SEL) +
                          TOFLR(GUY.IS) +
                          TODOC(&DOC) PCFMT(*COMMA) +
                          REPLACE(*YES)

                CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW4:        MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


         /******* SEND SQL REPORT TO GUPPRT201                  ****   ***/
 PRINT2:     IF         COND(&USRCLS *NE '*PGMR') THEN(DO)
   IF   COND(&PLTCO = '360') THEN(DO)
             OVRPRTF    FILE(SQLPRT1) OUTQ(GUPPRT201) HOLD(*NO)
             ENDDO
   IF   COND(&PLTCO = '960') THEN(DO)
             OVRPRTF    FILE(SQLPRT1) OUTQ(TFPRT04A) HOLD(*NO)
             ENDDO
             REPORT     REPORT(SQPKE8CPPR) VIEW(SQPKE8CPPP) +
                          HOLD(*SAME) SETVAR((&C2A1 &RPTTMEX) (&ETDT +
                          &RPTDTEX))
             REPORT     REPORT(SQPKE9CPPR) VIEW(SQPKE9CPPP) +
                          HOLD(*SAME) SETVAR((&C2A1 &RPTTMEX) (&ETDT +
                          &RPTDTEX))
                          ENDDO
      /*     OVRPRTF    FILE(SQLPRT1) OUTQ(PRKPRT04) HOLD(*NO)       +
             REPORT     REPORT(SQPKE8CPPR) VIEW(SQPKE8CPPP) +
                          HOLD(*SAME) SETVAR((&C2A1 &RPTTMEX) (&ETDT +
                          &RPTDTEX))                                  +
             REPORT     REPORT(SQPKE9CPPR) VIEW(SQPKE9CPPP) +
                          HOLD(*SAME) SETVAR((&C2A1 &RPTTMEX) (&ETDT +
                          &RPTDTEX))                                  */

             ENDDO

/*-----------------------------------------------------------------*/
/* END PROGRAM                                                     */
/*-----------------------------------------------------------------*/
 ENDPGM:
             DLTOVR     FILE(*ALL)

             ENDPGM
