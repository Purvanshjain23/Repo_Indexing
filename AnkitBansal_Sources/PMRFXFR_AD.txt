// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMRFXFR
// ?Date: 14.08.2025 Time: 03:43:51
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Call Unbooked reports from job scheduler for each plant company
//?  Set parameters
EXECUTE FUNCTION(Rtv Plant Cos all     RT) TYPE(RTVOBJ) FILE(PDJYREP)           AC1809261;
PARAMETER(*ZERO);
PARAMETER(LCL.USR_Company_Number_1);
PARAMETER(LCL.USR_Company_Number_2);
PARAMETER(LCL.USR_Company_Number_3);
PARAMETER(LCL.USR_Company_Number_4);
PARAMETER(LCL.USR_Company_Number_5);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF PAR.USR Company Number 1 is Equal to zero
 IF PAR.USR_Company_Number_1 = *ZERO;

 // PAR.USR Company Number 1 = DB1.Company Number
 PAR.USR_Company_Number_1 = DB1.Company_Number;

 // IF PAR.USR Company Number 2 is Equal to zero
 IF PAR.USR_Company_Number_2 = *ZERO;

 // PAR.USR Company Number 2 = DB1.Company Number
 PAR.USR_Company_Number_2 = DB1.Company_Number;

 // IF PAR.USR Company Number 3 is Equal to zero
 IF PAR.USR_Company_Number_3 = *ZERO;

 // PAR.USR Company Number 3 = DB1.Company Number
 PAR.USR_Company_Number_3 = DB1.Company_Number;

 // IF PAR.USR Company Number 4 is Equal to zero
 IF PAR.USR_Company_Number_4 = *ZERO;

 // PAR.USR Company Number 4 = DB1.Company Number
 PAR.USR_Company_Number_4 = DB1.Company_Number;

 // IF PAR.USR Company Number 5 is Equal to zero
 IF PAR.USR_Company_Number_5 = *ZERO;

 // PAR.USR Company Number 5 = DB1.Company Number
 PAR.USR_Company_Number_5 = DB1.Company_Number;

 ENDIF;

}


EXECUTE FUNCTION(RTV Next Ship Date     RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1417256;
PARAMETER(LCL.USR_Company_Number_1);
PARAMETER(JOB.*Job_date);
PARAMETER(LCL.Scheduled_Ship_Date);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Post to G/L Date EQ PAR.Post to G/L Date
 IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

 // OR DB1.Day of Week is Sunday
 OR DB1.Day_of_Week = '1';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Scheduled Ship Date = DB1.Post to G/L Date
 PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


// LCL.Number Value - 7 = JOB.*Job date
LCL.Number_Value_7 = JOB.*Job_date;

EXECUTE FUNCTION(RTV Next Ship Date     RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1417256;
PARAMETER(LCL.USR_Company_Number_1);
PARAMETER(LCL.Scheduled_Ship_Date);
PARAMETER(LCL.Numeric_Field_Needed_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Post to G/L Date EQ PAR.Post to G/L Date
 IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

 // OR DB1.Day of Week is Sunday
 OR DB1.Day_of_Week = '1';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Scheduled Ship Date = DB1.Post to G/L Date
 PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


//?RMC Run sql instead ... and email to Garry/Damon  01/16/08
//?RMC add a 2pm run with a diff distlist..   03/14/08
//?RMC run for ship date between curr day and curr day+2    03/25/08
//?10/16/08 RMC S00517
//? Added dist list 3 for damon to be able to run from margin mgmt dashbd
//?Set esend dist list
CASE;

// IF PAR.Report Listing        USR is Scheduling
IF PAR.Report_Listing_USR = '1';

// WRK.Text USR = CON.PRKUNBK1
WRK.Text_USR = 'PRKUNBK1';

//?Set esend dist list
// IF PAR.Report Listing        USR is QA
IF PAR.Report_Listing_USR = '2';

// WRK.Text USR = CON.PRKUNBK2
WRK.Text_USR = 'PRKUNBK2';

//?Set esend dist list
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Text USR = CON.PRKUNBK3
WRK.Text_USR = 'PRKUNBK3';

ENDIF;

// Execute command - 'EXECUTE SQL VIEW'
EXECUTE COMMAND(USR3880);
PARAMETER(LCL.Number_Value_7);
PARAMETER(LCL.Numeric_Field_Needed_USR);
PARAMETER(WRK.Text_USR);

//?run extra sql if '1' and send to damon only  10/28/08
CASE;

// IF PAR.Report Listing        USR is Scheduling
IF PAR.Report_Listing_USR = '1';

// WRK.Text USR = CON.PRKUNBK3
WRK.Text_USR = 'PRKUNBK3';

// Execute command - 'EXECUTE SQL VIEW'
EXECUTE COMMAND(USR4075);
PARAMETER(LCL.Number_Value_7);
PARAMETER(LCL.Numeric_Field_Needed_USR);
PARAMETER(WRK.Text_USR);

ENDIF;

