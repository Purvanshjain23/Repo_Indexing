// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POK5PFR
// ?Date: 14.08.2025 Time: 12:06:13
// ?------------------------------------------------------------------------------------------------

//?USER: Print required level headings

CASE;

IF NEW Company_Number;
// SUPPRESSED PRINT Company Number header format

ENDIF;

CASE;

IF NEW Order_Number;
// SUPPRESSED PRINT Order Number header format

ENDIF;

CASE;

IF NEW ED_Export_Document_Type;
// SUPPRESSED PRINT ED Export Document Type header format

ENDIF;

//?USER: Process before print of detail format

CASE;

// IF DB1.ED Document Date is Not entered
IF DB1.ED_Document_Date = *ZERO;

// CUR.Date                  USR = JOB.*Job date
CUR.Date_USR = JOB.*Job_date;

// IF *OTHERWISE
IF *OTHERWISE;

// CUR.Date                  USR = DB1.ED Document Date
CUR.Date_USR = DB1.ED_Document_Date;

ENDIF;

// LCL.Date                  USR = CUR.Date                  USR
LCL.Date_USR = CUR.Date_USR;

// CUR.USR Uom = CON.Lbs
CUR.USR_Uom = 'Lbs';

// WRK.ED Export Certificate Nbr = CUR.ED Export Certificate Nbr
WRK.ED_Export_Certificate_Nbr = CUR.ED_Export_Certificate_Nbr;

// WRK.ED Shipping Marks Txt = CUR.ED Shipping Marks Txt
WRK.ED_Shipping_Marks_Txt = CUR.ED_Shipping_Marks_Txt;

//?S00243 RMC 5/19/08
// CUR.ED Warehouse Sts = CND.Not Selected
CUR.ED_Attachment_Type_Sts = *BLANK;

//?E00265 - Print uom "Boxes"
CASE;

// IF DB1.ED Total Package UOM EQ WRK.Blank for 4           USR
IF DB1.ED_Total_Package_UOM = WRK.Blank_for_4_USR;

EXECUTE FUNCTION(RTV UM/Whs Code        RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1429488;
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER(1);
PARAMETER(1);
PARAMETER(NLL.Warehouse_Code);
PARAMETER(WRK.ED_Total_Package_UOM);
{
 //?USER: Initialize routine

 // WRK.First Time Flag = CND.Yes
 WRK.First_Time_Flag = 'Y';

 // LCL.Boxes Total Quantity = CON.*ZERO
 LCL.Boxes_Total_Quantity = *ZERO;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 MOVE *ALL (To: PAR From: CON);

 QUIT;

 //?USER: Process Data record

 //?PF3280 -- add "Cases" to the case-stmt
 // PAR.Warehouse Code = DB1.Warehouse Code
 PAR.Warehouse_Code = DB1.Warehouse_Code;

 CASE;

 // IF DB1.U/M - Ordered is Combos
 IF DB1.U_M_Ordered = 'CB';

 // OR DB1.U/M - Ordered is EQ Boxes
 OR DB1.U_M_Ordered = 'BX';

 // OR DB1.U/M - Ordered is Mixed
 OR DB1.U_M_Ordered = 'MX';

 // OR DB1.U/M - Ordered is Cases
 OR DB1.U_M_Ordered = 'CS';

 CASE;

 // IF DB1.Detail Line Status is Cancelled
 IF DB1.Detail_Line_Status = 'X';

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Sum for later check
 CASE;

 // IF DB1.U/M - Ordered is EQ Boxes
 IF DB1.U_M_Ordered = 'BX';

 // LCL.Boxes Total Quantity = LCL.Boxes Total Quantity + DB1.Quantity Ordered
 LCL.Boxes_Total_Quantity = LCL.Boxes_Total_Quantity + DB1.Quantity_Ordered;

 ENDIF;

 CASE;

 // IF PAR.USR Unit of Measure is *Blank
 IF PAR.USR_Unit_of_Measure = *BLANK;

 // PAR.USR Unit of Measure = DB1.U/M - Ordered
 PAR.USR_Unit_of_Measure = DB1.U_M_Ordered;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.U/M - Ordered EQ PAR.USR Unit of Measure
 IF DB1.U_M_Ordered = PAR.USR_Unit_of_Measure;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.U/M - Ordered = CND.Mixed
 WRK.U_M_Ordered = 'MX';

 // PAR.USR Unit of Measure = WRK.U/M - Ordered
 PAR.USR_Unit_of_Measure = WRK.U_M_Ordered;

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

 //?USER: Exit processing

 //?E2709 RMC 9/12/13  Classify as BX/CB - never MX
 CASE;

 // IF PAR.USR Unit of Measure is Mixed
 IF PAR.USR_Unit_of_Measure = 'MX';

 EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
 PARAMETER(DB1.Company_Number);
 PARAMETER('BOXLOAD');
 PARAMETER(LCL.Box_Load_Min_Box_Qty_USR);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Boxes Total Quantity LT LCL.Box Load Min Box Qty USR
 IF LCL.Boxes_Total_Quantity < LCL.Box_Load_Min_Box_Qty_USR;

 // PAR.USR Unit of Measure = CND.Combos
 PAR.USR_Unit_of_Measure = 'CB';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.USR Unit of Measure = CND.Boxed
 PAR.USR_Unit_of_Measure = 'BX';

 ENDIF;

 ENDIF;

}


// CUR.UOM Description 10  USR = Condition name of WRK.ED Total Package UOM
CUR.UOM_Description_10_USR = RTVCND(WRK.ED_Total_Package_UOM);

//?E00265 - Print uom "Boxes"
// IF *OTHERWISE
IF *OTHERWISE;

// CUR.UOM Description 10  USR = Condition name of DB1.ED Total Package UOM
CUR.UOM_Description_10_USR = RTVCND(DB1.ED_Total_Package_UOM);

ENDIF;

// LCL.ED Plant Number = CUR.ED Plant Number
LCL.ED_Plant_Number = CUR.ED_Plant_Number;

CASE;

// IF DB1.ED Total Net Weight MT is gt 0
IF DB1.ED_Total_Net_Weight_MT > 0;

// CUR.Text 2 = CON.MT
CUR.Text_2 = 'MT';

ENDIF;

//?PRTOBJ calls after print of detail format

//?Embedded PRTOBJ : Prt MPD Dtl w/o MTCmbBxPO
EXECUTE FUNCTION(Prt MPD Dtl w/o MTCmbBxPO) TYPE(PRTOBJ);
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER(CUR.ED_Export_Document_Type);
PARAMETER(CUR.Country_Code);
PARAMETER(CUR.ED_Shipping_Marks_Txt);
PARAMETER(CUR.ED_Nbr_of_prods_on_1st_pg);
PARAMETER(PAR.USR_Overflow);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Print required level totals

// SUPPRESSED PRINT ED Export Document Type totals format

CASE;

IF NEW Order_Number;
// Print Order Number totals format
PRINT Order Number totals format;

ENDIF;

CASE;

IF NEW Company_Number;
// WRK.Date (Alpha) USR = CVTVAR(LCL.Date                  USR)
WRK.Date_Alpha_USR = CVTVAR(LCL.Date_USR);

// WRK.Month/Day Alpha MMDD = SUBSTRING(WRK.Date (Alpha) USR,CON.4,CON.4)
WRK.Month_Day_Alpha_MMDD = SUBSTRING(WRK.Date_Alpha_USR:4:4);

// WRK.Year  (Char) USR = SUBSTRING(WRK.Date (Alpha) USR,CON.2,CON.2)
WRK.Year_Char_USR = SUBSTRING(WRK.Date_Alpha_USR:2:2);

// WRK.Year Alpha (YYYY) USR = CONCAT(CON.20,WRK.Year  (Char) USR,CON.*ZERO)
WRK.Year_Alpha_YYYY_USR = '20' + WRK.Year_Char_USR (*ZERO);

// WRK.Date (Char-8) USR = CONCAT(WRK.Month/Day Alpha MMDD,WRK.Year Alpha (YYYY) USR,CON.*ZERO)
WRK.Date_Char_8_USR = WRK.Month_Day_Alpha_MMDD + WRK.Year_Alpha_YYYY_USR (*ZERO);

// CUR.Date 8.0 USR = CVTVAR(WRK.Date (Char-8) USR)
CUR.Date_8_0_USR = CVTVAR(WRK.Date_Char_8_USR);

// Print Company Number totals format
PRINT Company Number totals format;

//?Embedded PRTOBJ : Prt MPD Dtl Overfl Cmb PO
CASE;

// IF PAR.USR Overflow is No
IF PAR.USR_Overflow = 'N';

QUIT;

ENDIF;

EXECUTE FUNCTION(Prt MPD Dtl Overfl Cmb PO) TYPE(PRTOBJ);
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER(CUR.ED_Export_Document_Type);
PARAMETER(CUR.Country_Code);
PARAMETER(WRK.ED_Shipping_Marks_Txt);
PARAMETER(CUR.ED_Nbr_of_prods_on_1st_pg);
PARAMETER(WRK.ED_Export_Certificate_Nbr);
PARAMETER(LCL.Date_USR);
PARAMETER(CUR.ED_Inspector_Name);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


ENDIF;

