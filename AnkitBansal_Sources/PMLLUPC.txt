PGM

DCL &REQLIB *CHAR 2
DCL &LIBRARY *CHAR 10

/************************************************************/
/* Process ACCRHIST in DFDATA & PRDATA                      */
/************************************************************/

/* Process ACCRHIST in DFDATA  */
CHGVAR &REQLIB 'DF'

LOOP:
/* EUP Get Dailys Library */
CALL PMLTUPC PARM(&REQLIB &LIBRARY)

/* Clear ACCRHISTNW */
CLRPFM &LIBRARY/ACCRHISTNW

/* Override files to appropriate library */
OVRDBF ACCRHIST &LIBRARY/ACCRHIST
OVRDBF ACCRHISTNW &LIBRARY/ACCRHISTNW

/* Call EUP Cvt Accural History  */
CALL PMLNUPR

/* Save copy of ACCRHIST */
CPYF &LIBRARY/ACCRHIST &LIBRARY/ACCRHISTSV MBROPT(*REPLACE)
/* If there is any error, skip to end. Do not overwrite ACCRHIST */
MONMSG CPF0000 EXEC(GOTO ENDPGM)

/* Move converted records to ACCRHIST */
CPYF &LIBRARY/ACCRHISTNW &LIBRARY/ACCRHIST MBROPT(*REPLACE)

/* Delete file overrides */
DLTOVR ACCRHIST
DLTOVR ACCRHISTNW

/* If library requested is DF, change to JR and loop back */
IF COND(&REQLIB *EQ 'DF') THEN(DO)
             CHGVAR     VAR(&REQLIB) VALUE('JR')
     GOTO LOOP
ENDDO
ELSE DO
/* Both libraries have been processed, we are done  */
     GOTO ENDPGM
ENDDO

ENDPGM:
ENDPGM
