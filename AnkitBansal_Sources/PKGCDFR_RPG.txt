     H/TITLE WW Drive Card         DF  Display file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Display file
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 00:30:55
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPKGCDFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW Drive Card         DF  Display file
      *
     FPKA3REL2IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : Pen                       By Drive Card/Seq
      *
     FPKA2CPL6IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pn/Driven
      *
     FPKA1CPL0IF  E           K        DISK
      * RTV : Tattoo Header             Retrieval index
      *
     FPKAXCPL0IF  E           K        DISK
      * RTV : Buy Order Load            Retrieval index
      *
     FPKA2CPLAIF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pen/Drive crd,Printed
      *
     FPKDXCPL2IF  E           K        DISK
      * RSQ : IS Message Log            IS Message Number (d)
      *
     FPKA2CPL8IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pen
      *
     FPKA3REL1IF  E           K        DISK
      * RTV : Pen                       Retrieval index
      *
     FPKAIREL0IF  E           K        DISK
      * RTV : Genetic                   Retrieval index
      *
     FPKAOCPL1IF  E           K        DISK
      * RTV : Kill/Cut Plan             Retrieval index
      *
     FPKA2CPL5IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pn/Open
      *
     FPKDXCPL0IF  E           K        DISK                      A
      * UPD : IS Message Log            Update index
      *
     FPKA2CPL0UF  E           K        DISK                      A
      * UPD : Tattoo Detail             Update index
      *
     FPKA3REL0UF  E           K        DISK
      * UPD : Pen                       Update index
      *
     FPKAOCPL0UF  E           K        DISK
      * UPD : Kill/Cut Plan             Update index
      *
      * Long constants
     E                    @CN#    1  06  6   @CN    25
     I@A2CPKH
      * Tattoo Detail             Co/Pen/Drive crd,Printed
      * Renamed input format fields
     I              A2HMNB                          WAHMNB
     I              A2BNNB                          WABNNB
     I              A2BONB                          WABONB
     I              A2CVNB                          WACVNB
     I              A2B0DT                          WAB0DT
     I              A2C2NB                          WAC2NB
     I              A2CZNB                          WACZNB
     I              A2C0NB                          WAC0NB
     I              A2D8NB                          WAD8NB
     I              A2H7NB                          WAH7NB
     I              A2GGST                          WAGGST
     I              A2AJTM                          WAAJTM
     I              A2JEA1                          WAJEA1
     I              A2B7CD                          WAB7CD
     I              A2D7NB                          WAD7NB
     I              A2D9ST                          WAD9ST
     I              A2E3ST                          WAE3ST
     I              A2E4ST                          WAE4ST
     I              A2E5ST                          WAE5ST
     I              A2BVDT                          WABVDT
     I              A2BWDT                          WABWDT
     I              A2BXDT                          WABXDT
     I              A2HVNB                          WAHVNB
     I              A2CMCD                          WACMCD
     I              A2B9CD                          WAB9CD
     I              A2H8NB                          WAH8NB
     I              A2CYCD                          WACYCD
     I              A2AAVN                          WAAAVN
     I              A2AADT                          WAAADT
     I              A2AMTM                          WAAMTM
     I              A2AJST                          WAAJST
     I              A2AHVN                          WAAHVN
     I              A2AGVN                          WAAGVN
     I              A2ABVN                          WAABVN
     I              A2ABDT                          WAABDT
     I              A2ABTM                          WAABTM
      *
     I@DXCPXS
      * IS Message Log            Update index
      * Renamed input format fields
     I              DXLMNO                          WBLMNO
     I              DXL8TX                          WBL8TX
     I              DXAAVN                          WBAAVN
     I              DXAADT                          WBAADT
     I              DXAMTM                          WBAMTM
     I              DXAJST                          WBAJST
     I              DXAHVN                          WBAHVN
     I              DXAGVN                          WBAGVN
     I              DXABVN                          WBABVN
     I              DXABDT                          WBABDT
     I              DXABTM                          WBABTM
      *
     I@A2CPDF
      * Tattoo Detail             Update index
      * Renamed input format fields
     I              A2HMNB                          WCHMNB
     I              A2BNNB                          WCBNNB
     I              A2BONB                          WCBONB
     I              A2CVNB                          WCCVNB
     I              A2B0DT                          WCB0DT
     I              A2C2NB                          WCC2NB
     I              A2CZNB                          WCCZNB
     I              A2C0NB                          WCC0NB
     I              A2D8NB                          WCD8NB
     I              A2H7NB                          WCH7NB
     I              A2GGST                          WCGGST
     I              A2AJTM                          WCAJTM
     I              A2JEA1                          WCJEA1
     I              A2B7CD                          WCB7CD
     I              A2D7NB                          WCD7NB
     I              A2D9ST                          WCD9ST
     I              A2E3ST                          WCE3ST
     I              A2E4ST                          WCE4ST
     I              A2E5ST                          WCE5ST
     I              A2BVDT                          WCBVDT
     I              A2BWDT                          WCBWDT
     I              A2BXDT                          WCBXDT
     I              A2HVNB                          WCHVNB
     I              A2CMCD                          WCCMCD
     I              A2B9CD                          WCB9CD
     I              A2H8NB                          WCH8NB
     I              A2CYCD                          WCCYCD
     I              A2AAVN                          WCAAVN
     I              A2AADT                          WCAADT
     I              A2AMTM                          WCAMTM
     I              A2AJST                          WCAJST
     I              A2AHVN                          WCAHVN
     I              A2AGVN                          WCAGVN
     I              A2ABVN                          WCABVN
     I              A2ABDT                          WCABDT
     I              A2ABTM                          WCABTM
      *
     I@A2CPKE
      * Tattoo Detail             Co/Pen
      * Renamed input format fields
     I              A2HMNB                          WDHMNB
     I              A2BNNB                          WDBNNB
     I              A2BONB                          WDBONB
     I              A2CVNB                          WDCVNB
     I              A2B0DT                          WDB0DT
     I              A2C2NB                          WDC2NB
     I              A2CZNB                          WDCZNB
     I              A2C0NB                          WDC0NB
     I              A2D8NB                          WDD8NB
     I              A2H7NB                          WDH7NB
     I              A2GGST                          WDGGST
     I              A2AJTM                          WDAJTM
     I              A2JEA1                          WDJEA1
     I              A2B7CD                          WDB7CD
     I              A2D7NB                          WDD7NB
     I              A2D9ST                          WDD9ST
     I              A2E3ST                          WDE3ST
     I              A2E4ST                          WDE4ST
     I              A2E5ST                          WDE5ST
     I              A2BVDT                          WDBVDT
     I              A2BWDT                          WDBWDT
     I              A2BXDT                          WDBXDT
     I              A2HVNB                          WDHVNB
     I              A2CMCD                          WDCMCD
     I              A2B9CD                          WDB9CD
     I              A2H8NB                          WDH8NB
     I              A2CYCD                          WDCYCD
     I              A2AAVN                          WDAAVN
     I              A2AADT                          WDAADT
     I              A2AMTM                          WDAMTM
     I              A2AJST                          WDAJST
     I              A2AHVN                          WDAHVN
     I              A2AGVN                          WDAGVN
     I              A2ABVN                          WDABVN
     I              A2ABDT                          WDABDT
     I              A2ABTM                          WDABTM
      *
     I@A3REDD
      * Pen                       Retrieval index
      * Renamed input format fields
     I              A3HVNB                          WEHVNB
     I              A3CMCD                          WECMCD
     I              A3BBTX                          WEBBTX
     I              A3CTNB                          WECTNB
     I              A3D6NB                          WED6NB
     I              A3B6CD                          WEB6CD
     I              A3DGST                          WEDGST
     I              A3EBNB                          WEEBNB
     I              A3FWST                          WEFWST
     I              A3HBNB                          WEHBNB
     I              A3AGCD                          WEAGCD
     I              A3AAVN                          WEAAVN
     I              A3AADT                          WEAADT
     I              A3AMTM                          WEAMTM
     I              A3AJST                          WEAJST
     I              A3AHVN                          WEAHVN
     I              A3AGVN                          WEAGVN
     I              A3ABVN                          WEABVN
     I              A3ABDT                          WEABDT
     I              A3ABTM                          WEABTM
      *
     I@A3REDC
      * Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
     I@AOCPAN
      * Kill/Cut Plan             Update index
      * Renamed input format fields
     I              AOHTNB                          WGHTNB
     I              AOADDT                          WGADDT
     I              AOAZST                          WGAZST
     I              AOA0NB                          WGA0NB
     I              AOCBNB                          WGCBNB
     I              AOX2NB                          WGX2NB
     I              AOX3NB                          WGX3NB
     I              AOAAVN                          WGAAVN
     I              AOAADT                          WGAADT
     I              AOAMTM                          WGAMTM
     I              AOAJST                          WGAJST
     I              AOAHVN                          WGAHVN
     I              AOAGVN                          WGAGVN
     I              AOABVN                          WGABVN
     I              AOABDT                          WGABDT
     I              AOABTM                          WGABTM
      *
     I@A2CPI7
      * Tattoo Detail             Co/Pn/Open
      * Renamed input format fields
     I              A2HMNB                          WHHMNB
     I              A2BNNB                          WHBNNB
     I              A2BONB                          WHBONB
     I              A2CVNB                          WHCVNB
     I              A2B0DT                          WHB0DT
     I              A2C2NB                          WHC2NB
     I              A2CZNB                          WHCZNB
     I              A2C0NB                          WHC0NB
     I              A2D8NB                          WHD8NB
     I              A2H7NB                          WHH7NB
     I              A2GGST                          WHGGST
     I              A2AJTM                          WHAJTM
     I              A2JEA1                          WHJEA1
     I              A2B7CD                          WHB7CD
     I              A2D7NB                          WHD7NB
     I              A2D9ST                          WHD9ST
     I              A2E3ST                          WHE3ST
     I              A2E4ST                          WHE4ST
     I              A2E5ST                          WHE5ST
     I              A2BVDT                          WHBVDT
     I              A2BWDT                          WHBWDT
     I              A2BXDT                          WHBXDT
     I              A2HVNB                          WHHVNB
     I              A2CMCD                          WHCMCD
     I              A2B9CD                          WHB9CD
     I              A2H8NB                          WHH8NB
     I              A2CYCD                          WHCYCD
     I              A2AAVN                          WHAAVN
     I              A2AADT                          WHAADT
     I              A2AMTM                          WHAMTM
     I              A2AJST                          WHAJST
     I              A2AHVN                          WHAHVN
     I              A2AGVN                          WHAGVN
     I              A2ABVN                          WHABVN
     I              A2ABDT                          WHABDT
     I              A2ABTM                          WHABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
      * Outward parameters
     IPARC        DS                             10
      * KEY : Tattoo Detail             Co/Dr Crd/Tattoo Drv Cdo
      * I : RST BOH Company Number
     I                                    P   1   20PAHMNB
      * I : RST TD Drive Card Number
     I                                    P   3   40PAB7CD
      * I : RST Pen Number
     I                                        5   7 PACMCD
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
     IQPKDX1    E DSPKDXCPL0
      * UPD : IS Message Log            Update index
      * Renamed input format fields
     I              DXLMNO                          WBLMNO
     I              DXL8TX                          WBL8TX
     I              DXAAVN                          WBAAVN
     I              DXAADT                          WBAADT
     I              DXAMTM                          WBAMTM
     I              DXAJST                          WBAJST
     I              DXAHVN                          WBAHVN
     I              DXAGVN                          WBAGVN
     I              DXABVN                          WBABVN
     I              DXABDT                          WBABDT
     I              DXABTM                          WBABTM
      *
     IQPKA21    E DSPKA2CPL0
      * UPD : Tattoo Detail             Update index
      * Renamed input format fields
     I              A2HMNB                          WCHMNB
     I              A2BNNB                          WCBNNB
     I              A2BONB                          WCBONB
     I              A2CVNB                          WCCVNB
     I              A2B0DT                          WCB0DT
     I              A2C2NB                          WCC2NB
     I              A2CZNB                          WCCZNB
     I              A2C0NB                          WCC0NB
     I              A2D8NB                          WCD8NB
     I              A2H7NB                          WCH7NB
     I              A2GGST                          WCGGST
     I              A2AJTM                          WCAJTM
     I              A2JEA1                          WCJEA1
     I              A2B7CD                          WCB7CD
     I              A2D7NB                          WCD7NB
     I              A2D9ST                          WCD9ST
     I              A2E3ST                          WCE3ST
     I              A2E4ST                          WCE4ST
     I              A2E5ST                          WCE5ST
     I              A2BVDT                          WCBVDT
     I              A2BWDT                          WCBWDT
     I              A2BXDT                          WCBXDT
     I              A2HVNB                          WCHVNB
     I              A2CMCD                          WCCMCD
     I              A2B9CD                          WCB9CD
     I              A2H8NB                          WCH8NB
     I              A2CYCD                          WCCYCD
     I              A2AAVN                          WCAAVN
     I              A2AADT                          WCAADT
     I              A2AMTM                          WCAMTM
     I              A2AJST                          WCAJST
     I              A2AHVN                          WCAHVN
     I              A2AGVN                          WCAGVN
     I              A2ABVN                          WCABVN
     I              A2ABDT                          WCABDT
     I              A2ABTM                          WCABTM
      *
     IQPKA31    E DSPKA3REL0
      * UPD : Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
     IYARDCS      DS                            107
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                            107
     IYCRDCS      DS                            107
     IYDRDCS      DS                            107
     IQPKAO1    E DSPKAOCPL0
      * UPD : Kill/Cut Plan             Update index
      * Renamed input format fields
     I              AOHTNB                          WGHTNB
     I              AOADDT                          WGADDT
     I              AOAZST                          WGAZST
     I              AOA0NB                          WGA0NB
     I              AOCBNB                          WGCBNB
     I              AOX2NB                          WGX2NB
     I              AOX3NB                          WGX3NB
     I              AOAAVN                          WGAAVN
     I              AOAADT                          WGAADT
     I              AOAMTM                          WGAMTM
     I              AOAJST                          WGAJST
     I              AOAHVN                          WGAHVN
     I              AOAGVN                          WGAGVN
     I              AOABVN                          WGABVN
     I              AOABDT                          WGABDT
     I              AOABTM                          WGABTM
      *
     IYERDCS      DS                             76
     IYFRDCS      DS                            133
     IYGRDCS      DS                            107
     IYHRDCS      DS                            107
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Pen
      * N : MAP Pen Company Number
     I                                    P   1   20P1HVNB
      * N : MAP Pen Number
     I                                        3   5 P1CMCD
      * N : MAP Pen Description
     I                                        6  30 P1BBTX
      * N : MAP Pen Maximun Capacity
     I                                    P  31  330P1CTNB
      * N : MAP Pen Current Head
     I                                    P  34  360P1D6NB
      * N : MAP Pen Current Drive Card No
     I                                    P  37  380P1B6CD
      * N : MAP Pen Drive Sequence
     I                                    P  39  400P1EBNB
     IP2PARM      DS
      * N : MAP Head Held Over Usr
     I                                    P   1   30P2EDNB
     IP3PARM      DS
      * FLD: *Arrays
      * N : MAP PRT Description
     I                                        1  25 P3ETTX
      * N : MAP PRT Printer Device
     I                                       26  35 P3ACVN
      * N : MAP PRT Hold Output Sts
     I                                       36  39 P3AKST
      * N : MAP PRT Save Output Sts
     I                                       40  43 P3AMST
      * N : MAP PRT Copies
     I                                       44  450P3AKNB
      * N : MAP PRT Night Queue Run Sts
     I                                       46  46 P3ALST
      * N : MAP PRT Night Queue
     I                                       47  56 P3AIVN
      * N : MAP Oms Application Code
     I                                       57  62 P3C7CD
     IP4PARM      DS
      * FLD: *Arrays
      * N : MAP Oms Warehouse Code
     I                                        1   3 P4J8NB
      * N : MAP CC Company Number
     I                                    P   4   50P4HONB
      * N : MAP Oms SalesPerson Code
     I                                        6   8 P4C8CD
      * N : MAP Oms Allow Multi-Company
     I                                        9   9 P4G8ST
      * N : MAP Oms Default Printer
     I                                       10  19 P4G9ST
      * N : MAP Oms Name
     I                                       20  49 P4EUTX
      * N : MAP Oms System Value Alpha
     I                                       50  89 P4EVTX
      * N : MAP Oms Access Denied (Y/N)
     I                                       90  90 P4HAST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Invalid Company Number'
      * CC Company Number
     I                                    P   1   20ZA0001
      * Message data for 'Tattoos in a pen'
      * Tattoo 1              USR
     I                                        1   4 ZA0002
      * Tattoo 2              USR
     I                                        5   8 ZA0003
      * Tattoo 3              USR
     I                                        9  12 ZA0004
      * Tattoo 4              USR
     I                                       13  16 ZA0005
      * tattoo 5              USR
     I                                       17  20 ZA0006
      * @Status +/-
     I                                       21  21 ZA0007
      * Message data for 'SBM Prt Drive Card List'
      * PRT Printer Device
     I                                        1  10 ZA0008
      * PRT Hold Output Sts
     I                                       11  14 ZA0009
      * PRT Save Output Sts
     I                                       15  18 ZA0010
      * PRT Copies
     I                                    P  19  200ZA0011
      * PRT Night Queue
     I                                       21  30 ZA0012
      * RS Record Status
     I                                       31  31 ZA0013
      * Pen Company Number
     I                                    P  32  330ZA0014
      * Name USR
     I                                       34  73 ZA0015
      * Oms System Value Alpha
     I                                       74 113 ZA0016
      * Message data for 'Opt not allowed for user'
      * *USER
     I                                        1  10 ZA0017
      * Message data for 'Pen has changed since ref'
      * Pen Number
     I                                        1   3 ZA0018
      * Message data for 'IS Message Information 01'
      * @Action
     I                                        1  10 ZA0019
      * BOH Buy Order Number
     I                                    P  11  140ZA0020
      * BOL Load Number
     I                                    P  15  170ZA0021
      * TH Tattoo Number
     I                                    P  18  200ZA0022
      * TH Kill Date
     I                                    P  21  240ZA0023
      * TD Sequence Number
     I                                    P  25  270ZA0024
      * TD Pen Head
     I                                    P  28  300ZA0025
      * TD Drive Card Number
     I                                    P  31  320ZA0026
      * Pen Company Number
     I                                    P  33  340ZA0027
      * Pen Number
     I                                       35  37 ZA0028
      * Pen Sts
     I                                       38  38 ZA0029
      * Pen Drive Sequence
     I                                    P  39  400ZA0030
      * Message data for 'IS Message Information 01'
      * @Action
     I                                        1  10 ZA0031
      * BOH Buy Order Number
     I                                    P  11  140ZA0032
      * BOL Load Number
     I                                    P  15  170ZA0033
      * TH Tattoo Number
     I                                    P  18  200ZA0034
      * TH Kill Date
     I                                    P  21  240ZA0035
      * TD Sequence Number
     I                                    P  25  270ZA0036
      * TD Pen Head
     I                                    P  28  300ZA0037
      * TD Drive Card Number
     I                                    P  31  320ZA0038
      * Pen Company Number
     I                                    P  33  340ZA0039
      * Pen Number
     I                                       35  37 ZA0040
      * Pen Sts
     I                                       38  38 ZA0041
      * Pen Drive Sequence
     I                                    P  39  400ZA0042
      * Message data for 'IS Message Information 01'
      * @Action
     I                                        1  10 ZA0043
      * BOH Buy Order Number
     I                                    P  11  140ZA0044
      * BOL Load Number
     I                                    P  15  170ZA0045
      * TH Tattoo Number
     I                                    P  18  200ZA0046
      * TH Kill Date
     I                                    P  21  240ZA0047
      * TD Sequence Number
     I                                    P  25  270ZA0048
      * TD Pen Head
     I                                    P  28  300ZA0049
      * TD Drive Card Number
     I                                    P  31  320ZA0050
      * Pen Company Number
     I                                    P  33  340ZA0051
      * Pen Number
     I                                       35  37 ZA0052
      * Pen Sts
     I                                       38  38 ZA0053
      * Pen Drive Sequence
     I                                    P  39  400ZA0054
      * Message data for 'IS Message Information 01'
      * @Action
     I                                        1  10 ZA0055
      * BOH Buy Order Number
     I                                    P  11  140ZA0056
      * BOL Load Number
     I                                    P  15  170ZA0057
      * TH Tattoo Number
     I                                    P  18  200ZA0058
      * TH Kill Date
     I                                    P  21  240ZA0059
      * TD Sequence Number
     I                                    P  25  270ZA0060
      * TD Pen Head
     I                                    P  28  300ZA0061
      * TD Drive Card Number
     I                                    P  31  320ZA0062
      * Pen Company Number
     I                                    P  33  340ZA0063
      * Pen Number
     I                                       35  37 ZA0064
      * Pen Sts
     I                                       38  38 ZA0065
      * Pen Drive Sequence
     I                                    P  39  400ZA0066
      * Message data for 'IS Message Information 01'
      * @Action
     I                                        1  10 ZA0067
      * BOH Buy Order Number
     I                                    P  11  140ZA0068
      * BOL Load Number
     I                                    P  15  170ZA0069
      * TH Tattoo Number
     I                                    P  18  200ZA0070
      * TH Kill Date
     I                                    P  21  240ZA0071
      * TD Sequence Number
     I                                    P  25  270ZA0072
      * TD Pen Head
     I                                    P  28  300ZA0073
      * TD Drive Card Number
     I                                    P  31  320ZA0074
      * Pen Company Number
     I                                    P  33  340ZA0075
      * Pen Number
     I                                       35  37 ZA0076
      * Pen Sts
     I                                       38  38 ZA0077
      * Pen Drive Sequence
     I                                    P  39  400ZA0078
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile control
      * CASE: WRK.First Time Flag Usr EQ WRK.Blank USR
     C           WUHBST    IFEQ WUCRTX                     *IF
     C                     Z-ADDWUHVNB    #2HVNB           Pen Company Num
     C                     MOVEL'Y'       WUHJST           Display Print P
     C                     MOVEL'Y'       WUHBST           First Time Flag
     C                     MOVEL'A'       #2AJST           RS Record Statu
     C                     MOVEL'N'       P3ALST           PRT Night Queue
     C                     END                             *FI
      * Val Company Number    IF
      * Val Company Number    XF - STR Order Management Sys  * 
     C                     CALL 'PDGZXFR'              90  Val Company Num
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HVNB    WQ0001  30       CC Company Numb
     C           #CBSTX    PARM *BLANK    WQ0002 30        Oms Name
     C           WUG3ST    PARM *BLANK    WQ0003  1        Invalid Y/N USR
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGZXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * CASE: WRK.Invalid Y/N USR is Yes
     C           WUG3ST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#2HVNB    ZA0001           CC Company Numb
      * Send message 'Invalid Company Number'
     C                     MOVEL'PRK0299' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     MOVELWUG3ST    WUG3ST           Invalid Y/N USR
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3B6CD           Pen Current Dri
     C                     KFLD           A3EBNB           Pen Drive Seque
      * Setup key
     C                     Z-ADD#2HVNB    A3HVNB
     C                     Z-ADD#2B6CD    A3B6CD
     C                     Z-ADD#2EBNB    A3EBNB
     C           KPOS      SETLL@A3REGB
     C                     READ @A3REGB                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2CTNB    WZCTNB
     C                     MOVEL#2CTNB    WZCTNB           Pen Maximun Cap
     C           *LIKE     DEFN #2BBTX    WZBBTX
     C                     MOVEL#2BBTX    WZBBTX           Pen Description
     C           *LIKE     DEFN #2HVNB    WZHVNB
     C                     MOVEL#2HVNB    WZHVNB           Pen Company Num
     C           *LIKE     DEFN #2EBNB    WZEBNB
     C                     MOVEL#2EBNB    WZEBNB           Pen Drive Seque
     C           *LIKE     DEFN #2B6CD    WZB6CD
     C                     MOVEL#2B6CD    WZB6CD           Pen Current Dri
     C           *LIKE     DEFN #2CMCD    WZCMCD
     C                     MOVEL#2CMCD    WZCMCD           Pen Number
     C           *LIKE     DEFN #2D6NB    WZD6NB
     C                     MOVEL#2D6NB    WZD6NB           Pen Current Hea
     C           *LIKE     DEFN #2HBNB    WZHBNB
     C                     MOVEL#2HBNB    WZHBNB           Pen Adjustment
     C           *LIKE     DEFN #2FWST    WZFWST
     C                     MOVEL#2FWST    WZFWST           Pen Type
     C           *LIKE     DEFN #2AJST    WZAJST
     C                     MOVEL#2AJST    WZAJST           RS Record Statu
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@A3REGB                  90*
     C  N82                READ @A3REGB                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,35
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2BBTX    IFNE *BLANK                     Pen Description
     C           A3BBTX    CABNE#2BBTX    BB020            Pen Description
     C                     END
     C           #2HVNB    IFEQ *ZERO                      Pen Company Num
     C           #2B6CD    OREQ *ZERO                      Pen Current Dri
     C           #2EBNB    IFNE *ZERO                      Pen Drive Seque
     C           A3EBNB    CABNE#2EBNB    BB020            Pen Drive Seque
     C                     END
     C                     END
     C           #2HVNB    IFEQ *ZERO                      Pen Company Num
     C           #2B6CD    IFNE *ZERO                      Pen Current Dri
     C           A3B6CD    CABNE#2B6CD    BB020            Pen Current Dri
     C                     END
     C                     END
     C           #2HBNB    IFNE *ZERO                      Pen Adjustment
     C           A3HBNB    CABNE#2HBNB    BB020            Pen Adjustment
     C                     END
     C           #2FWST    IFNE *BLANK                     Pen Type
     C           A3FWST    CABNE#2FWST    BB020            Pen Type
     C                     END
     C           #2AJST    IFNE *BLANK                     RS Record Statu
     C           A3AJST    CABNE#2AJST    BB020            RS Record Statu
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
      * Rtv Tattoos in a pen  RT - Tattoo Detail  * 
     C                     EXSR SARVGN
      * slm remove 5/14 code due to not ever installed 10/24
      * Setup message data for message
     C                     MOVELWUTT1U    ZA0002           Tattoo 1
     C                     MOVELWUTT2U    ZA0003           Tattoo 2
     C                     MOVELWUTT3U    ZA0004           Tattoo 3
     C                     MOVELWUTT4U    ZA0005           Tattoo 4
     C                     MOVELWUNJNB    ZA0006           tattoo 5
     C                     MOVELWUI8ST    ZA0007           @Status +/-
      * Retrieve message Tattoos in a pen
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0743' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           #RI1TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * CASE: RCD.BOL Truck Scale Weigh Sts is None
     C           #RPAST    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    #RJPTX           Text 10 1 USR
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.BOL Truck Scale Weigh Sts is Spread
     C           #RPAST    IFEQ 'S'                        *IF
      * RCD.Text 10 1 USR = Condition name of RCD.BOL Truck Scale Weigh S
     C                     CALL 'PKRVC2R'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1213847   Y2LSNO  70       List number
     C                     PARM #RPAST    W0INVL 25        BOL Truck Scale
     C                     PARM ' '       W0VLMP  1        Value mapped
     C           #RJPTX    PARM           W0CNNM 25        Text 10 1 USR
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL@CN,001   #RJPTX           Text 10 1 USR
     C                     END                             *FI
     C                     END                             *FI
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C                     READ @A3REGB                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN81     IFNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate RS Record Status
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#2AJST    W0NSRQ  1        RS Record Statu
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#2AJST'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1100087   Y2LSNO  70
     C           #2AJST    PARM #2AJST    W0EXVL 25        RS Record Statu
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    CABNE*BLANKS   DATAG1
      * Change of position specified
     C           WZHVNB    CASNE#2HVNB    FBRQRL
     C           WZEBNB    CASNE#2EBNB    FBRQRL
     C           WZB6CD    CASNE#2B6CD    FBRQRL
     C           WZAJST    CASNE#2AJST    FBRQRL
     C                     END
     C           DATAG1    TAG
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
     C                     MOVEL'Y'       W0DCF            *Defer confirm
      * F16=WW Pen Avail
      * CASE: CTL.*CMD key is CF16
     C           *IN16     IFEQ '1'                        *IF
      * WW Pen Availability   DF - Pen  * 
     C                     CALL 'PKGGDFR'              90  WW Pen Availabi
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKGGDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * F21=Print List
      * CASE: CTL.*CMD key is Print List
     C           *IN21     IFEQ '1'                        *IF
      * Pmt Print Options     XF - STR Order Management Sys  * 
     C                     CALL 'PDG0PVR'              90  Pmt Print Optio
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,002   WQ0004 25        PRT Description
     C           P3ACVN    PARM P3ACVN    WQ0005 10        PRT Printer Dev
     C           P3AKST    PARM P3AKST    WQ0006  4        PRT Hold Output
     C           P3AMST    PARM P3AMST    WQ0007  4        PRT Save Output
     C           P3AKNB    PARM P3AKNB    WQ0008  20       PRT Copies
     C           P3ALST    PARM P3ALST    WQ0009  1        PRT Night Queue
     C           P3AIVN    PARM P3AIVN    WQ0010 10        PRT Night Queue
     C                     PARM 'P/S'     WQ0011  6        Oms Application
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG0PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVELP3ACVN    ZA0008           PRT Printer Dev
     C                     MOVELP3AKST    ZA0009           PRT Hold Output
     C                     MOVELP3AMST    ZA0010           PRT Save Output
     C                     Z-ADDP3AKNB    ZA0011           PRT Copies
     C                     MOVELP3AIVN    ZA0012           PRT Night Queue
     C                     MOVEL#2AJST    ZA0013           RS Record Statu
     C                     Z-ADD#2HVNB    ZA0014           Pen Company Num
     C                     MOVEL#CBSTX    ZA0015           Name USR
     C                     MOVELP4EVTX    ZA0016           Oms System Valu
      *
      * Execute message
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2EXMCC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0340' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN   7
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      * Error detected during execution
     C                     SETON                     993431*
     C                     END
      *
     C                     END                             *FI
     C                     MOVEL'Y'       WUHJST           Display Print P
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END                             *FI
      * F5=Refreash
      * CASE: CTL.*CMD key is Refresh
     C           *IN05     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * USER: Final processing (Pre-confirm)
     C                     MOVEL'Y'       WUHJST           Display Print P
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Process subfile (pass 2)
     C                     EXSR EAPRSF
      * If error during 2nd pass exit:
     C           *IN99     CABEQ'1'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98    *
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * SFLNXTCHG
     C                     SETON                     84
      * USER: Process subfile record (Pre-confirm)
      * CASE: RCD.*SFLSEL is Edit Drive Card
     C           #1SEL     IFEQ '2'                        *IF
      * E13964 JJH 10/23/18 - Edit Drive Card
      * Ext Appl Allowed      XF - STR Order Management Sys  * 
     C                     CALL 'PUJWXFR'              90  Ext Appl Allowe
     C                     PARM *BLANK    W0RTN   7
     C                     PARM ##USR     WQ0012 10        User Profile Na
     C                     PARM 'NDRVCD'  WQ0013  6        Application Cod
     C           YL0001    PARM *BLANK    WQ0014  7        Return Code USR
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUJWXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: LCL.Return Code USR is *Normal
     C           YL0001    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
      * Setup message data for message
     C                     MOVEL##USR     ZA0017           *USER
      * Send message 'Opt not allowed for user'
     C                     MOVEL'PRK1126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Edt Drive Card        EF - Tattoo Detail  * 
     C                     CLEARPARC
     C                     Z-ADD#1HVNB    PAHMNB           BOH Company Num
     C                     Z-ADD#1B6CD    PAB7CD           TD Drive Card N
     C                     MOVEL#1CMCD    PACMCD    P      Pen Number
      *
     C                     CALL 'PKGJEFR'              90  Edt Drive Card
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Tattoo Det
     C                     PARM P4EVTX    WQ0015 40        Oms System Valu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKGJEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.*SFLSEL is Sent to Kill
     C           #1SEL     IFEQ '9'                        *IF
     C           #1SEL     OREQ ' 9'
      * Rtv Td to Val SntToKl RT - Tattoo Detail  * 
     C                     EXSR SERVGN
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
      * Force PUTOVR
     C                     SETON                     86
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
     C           *IN81     IFEQ '1'
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END                             WOD *92
     C                     END                             FI *81
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98
      * USER: Process subfile record (Post-confirm)
      * CASE: RCD.*SFLSEL is Sent to Kill
     C           #1SEL     IFEQ '9'                        *IF
     C           #1SEL     OREQ ' 9'
      * H16749 SLM 8/14/2020 replace change date w/system date tattoo dtl
      *
     C                     Z-ADD*ZERO     WN0002  30       BOH Company Num
     C                     Z-ADD*ZERO     WN0003  70       BOH Buy Order N
     C                     Z-ADD*ZERO     WN0004  50       BOL Load Number
     C                     Z-ADD*ZERO     WN0005  50       TH Tattoo Numbe
     C                     Z-ADD*ZERO     WN0006  70       TH Kill Date
     C                     Z-ADD*ZERO     WN0007  50       TD Sequence Num
     C                     Z-ADD*ZERO     WN0008  71       TD Live Wgt
     C                     Z-ADD*ZERO     WN0009  50       TD Pen Head
     C                     Z-ADD*ZERO     WN0010  50       TD Yard Dead
     C                     Z-ADD*ZERO     WN0011  50       TD Held Over
     C                     MOVEL*BLANK    WN0012  1        TD Held Over St
     C                     Z-ADD*ZERO     WN0013  60       TD Drive Time
     C                     Z-ADD*ZERO     WN0014  30       TD Drive Card N
     C                     Z-ADD*ZERO     WN0015  51       TD Avg Live Wgt
     C                     MOVEL*BLANK    WN0016  1        TD Gen Bal To K
     C                     MOVEL*BLANK    WN0017  1        TD Recs Created
     C                     MOVEL*BLANK    WN0018  1        TD User Status
     C                     MOVEL*BLANK    WN0019  1        TD User Status
     C                     Z-ADD*ZERO     WN0020  70       TD User Date 1
     C                     Z-ADD*ZERO     WN0021  70       TD User Date 2
     C                     Z-ADD*ZERO     WN0022  70       TD Drive Date
     C                     MOVEL*BLANK    WN0023  6        TDP Process Cod
     C                     Z-ADD*ZERO     WN0024  30       Held Over Pen C
     C                     MOVEL*BLANK    WN0025  3        Held Over Pen N
     C                     MOVEL*BLANK    WN0026 10        RS User Changed
     C                     Z-ADD*ZERO     WN0027  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0028  60       RS Time Changed
     C                     MOVEL*BLANK    WN0029  1        RS Record Statu
     C                     MOVEL*BLANK    WN0030 10        RS Job
     C                     MOVEL*BLANK    WN0031 10        RS Program
     C                     MOVEL*BLANK    WN0032 10        RS User Added
     C                     Z-ADD*ZERO     WN0033  70       RS Date Added
     C                     Z-ADD*ZERO     WN0034  60       RS Time Added
      *
      * Exc Ttt Sent to Kill   If
      * Retreive/Change the Pen's Tattoo Dtls: Process code     AND
      *  Held Over Processing for any Tattoo Dtls with Held Over Status =
      * IS MESSAGE INFORMATION  Tattoo Detail to be read
     C                     EXSR UASUBR                     IS MESSAGE INFO
      * H16749 SLM 08/14/2020
      * H16749 SLM tattoo detail change date upd with system date
      * Rtv/Chg TttDtl Kill   Rt - Tattoo Detail  * 
     C                     EXSR SHRVGN
      * Rtv/Chg the Pen: Drive card nbr & seq, hd adj., and status 'O'pen
      * and Recount Pen Head
      * IS MESSAGE INFORMATION  Pen information to be read
     C                     EXSR UFSUBR                     IS MESSAGE INFO
      * Upd Re-Open Pen       RT - Pen  * 
     C                     EXSR TERVGN
      *
     C                     MOVEL*BLANK    WN0095 25        Pen Description
     C                     Z-ADD*ZERO     WN0096  50       Pen Current Hea
     C                     MOVEL*BLANK    WN0097  5        GN Genetic Code
      *
      * Upd Pen CurHd/Genetic IF
      * Rtv Pen Head Total    RT - Tattoo Detail  * 
     C                     EXSR TGRVGN
      * CASE: PAR.Pen Current Head is *Zeros
     C           WN0096    IFEQ 0                          *IF
     C                     MOVEL*BLANK    WN0095           Pen Description
     C                     MOVEL*BLANK    WN0097           GN Genetic Code
     C                     ELSE
      * CASE: *OTHERWISE
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
     C                     EXSR THRVGN
     C                     END                             *FI
      * Chg Pen CurHd/Genetic CH - Pen  * 
     C                     EXSR TKCHRC
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C                     SETON                     84    SFLNXTCHG
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     GOTO EBEXIT
     C                     ELSE
      * SFLRCD valid
     C                     SETOF                     84    SFLNXTCHG
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     MOVEL'0'       *IN79
     C           P4G8ST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN78
     C           #CPETX    IFEQ '0'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @A3REGB fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     Z-ADDA3HVNB    #1HVNB           Pen Company Num
     C                     Z-ADDA3CTNB    #1CTNB           Pen Maximun Cap
     C                     MOVELA3DGST    #1DGST           Pen Sts
     C                     MOVELA3BBTX    #1BBTX           Pen Description
     C                     MOVELA3AGCD    #1AGCD           GN Genetic Code
     C                     MOVELA3AAVN    #1AAVN           RS User Changed
     C                     Z-ADDA3AADT    #1AADT           RS Date Changed
     C                     Z-ADDA3AMTM    #1AMTM           RS Time Changed
     C                     MOVELA3AHVN    #1AHVN           RS Job
     C                     MOVELA3AGVN    #1AGVN           RS Program
     C                     MOVELA3ABVN    #1ABVN           RS User Added
     C                     Z-ADDA3ABDT    #1ABDT           RS Date Added
     C                     Z-ADDA3ABTM    #1ABTM           RS Time Added
     C                     Z-ADDA3EBNB    #1EBNB           Pen Drive Seque
     C                     Z-ADDA3B6CD    #1B6CD           Pen Current Dri
     C                     MOVELA3CMCD    #1CMCD           Pen Number
     C                     Z-ADDA3D6NB    #1D6NB           Pen Current Hea
     C                     Z-ADDA3HBNB    #1HBNB           Pen Adjustment
     C                     MOVELA3FWST    #1FWST           Pen Type
     C                     MOVELA3AJST    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #RPAST           BOL Truck Scale
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RPETX           Text 1
     C                     MOVEL*BLANK    #RLIST           TH Schedule Kil
     C                     MOVEL*BLANK    #RI1TX           Condition Name
     C                     MOVEL*BLANK    #RJPTX           Text 10 1 USR
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP3ETTX    #PETTX           PRT Description
     C                     MOVELP3ACVN    #PACVN           PRT Printer Dev
     C                     MOVELP3AKST    #PAKST           PRT Hold Output
     C                     MOVELP3AMST    #PAMST           PRT Save Output
     C                     Z-ADDP3AKNB    #PAKNB           PRT Copies
     C                     MOVELP3ALST    #PALST           PRT Night Queue
     C                     MOVELP3AIVN    #PAIVN           PRT Night Queue
     C                     MOVELP3C7CD    #PC7CD           Oms Application
     C                     MOVELP4J8NB    #PJ8NB           Oms Warehouse C
     C                     Z-ADDP4HONB    #PHONB           CC Company Numb
     C                     MOVELP4C8CD    #PC8CD           Oms SalesPerson
     C                     MOVELP4G8ST    #PG8ST           Oms Allow Multi
     C                     MOVELP4G9ST    #PG9ST           Oms Default Pri
     C                     MOVELP4EUTX    #PEUTX           Oms Name
     C                     MOVELP4EVTX    #PEVTX           Oms System Valu
     C                     MOVELP4HAST    #PHAST           Oms Access Deni
     C                     Z-ADDP2EDNB    #PEDNB           Head Held Over
     C                     Z-ADDP1CTNB    #2CTNB           Pen Maximun Cap
     C                     MOVELP1BBTX    #2BBTX           Pen Description
     C                     Z-ADDP1HVNB    #2HVNB           Pen Company Num
     C                     MOVEL*BLANK    #CBSTX           Name USR
     C                     MOVEL*BLANK    #CPETX           Text 1
     C                     Z-ADDP1EBNB    #2EBNB           Pen Drive Seque
     C                     Z-ADDP1B6CD    #2B6CD           Pen Current Dri
     C                     MOVELP1CMCD    #2CMCD           Pen Number
     C                     Z-ADDP1D6NB    #2D6NB           Pen Current Hea
     C                     Z-ADD*ZERO     #2HBNB           Pen Adjustment
     C                     MOVEL*BLANK    #CLIST           TH Schedule Kil
     C                     MOVEL*BLANK    #CI1TX           Condition Name
     C                     MOVEL*BLANK    #2FWST           Pen Type
     C                     MOVEL*BLANK    #2AJST           RS Record Statu
     C                     MOVEL*BLANK    #CJPTX           Text 10 1 USR
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Tattoos in a pen  RT - Tattoo Detail  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  1        First Time Flag
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUP0NB           Count USR
     C                     MOVELWUCRTX    WUI8ST           @Status +/-
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
     C                     MOVEL'Y'       WN0001           First Time Flag
      * Declare restrictor key work fields
     C           *LIKE     DEFN A2HMNB    WQSA01           BOH Company Num
     C           *LIKE     DEFN A2CMCD    WQSA02           Pen Number
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           BOH Company Num
     C                     KFLD           WQSA02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSA01           BOH Company Num
     C                     MOVEL#1CMCD    WQSA02           Pen Number
      * Establish starting position
     C           KRSSA     SETLL@A2CPKC                    *
     C           KRSSA     READE@A2CPKC                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  1         WUP0NB           Count USR
     C                     Z-ADDA2CVNB    WUMLNB           Tattoo Nbr 4
      * Set up Tattoo's
      * CASE: WRK.Count USR is One
     C           WUP0NB    IFEQ 1                          *IF
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVELWUMLNB    WUTT1U           Tattoo 1
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
     C                     EXSR SBRVGN
     C                     ELSE
      * CASE: WRK.Count USR is Two
     C           WUP0NB    IFEQ 2                          *IF
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVELWUMLNB    WUTT2U           Tattoo 2
     C                     ELSE
      * CASE: WRK.Count USR is Three
     C           WUP0NB    IFEQ 3                          *IF
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVELWUMLNB    WUTT3U           Tattoo 3
     C                     ELSE
      * CASE: WRK.Count USR is Four
     C           WUP0NB    IFEQ 4                          *IF
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVELWUMLNB    WUTT4U           Tattoo 4
     C                     ELSE
      * CASE: WRK.Count USR is Five
     C           WUP0NB    IFEQ 5                          *IF
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
     C                     MOVELWUMLNB    WUNJNB           tattoo 5
     C                     ELSE
      * CASE: WRK.Count USR is Six
     C           WUP0NB    IFEQ 6                          *IF
     C                     MOVEL'+'       WUI8ST           @Status +/-
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Truck Weight Status
      * CASE: PAR.First Time Flag Usr is Yes
     C           WN0001    IFEQ 'Y'                        *IF
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
     C                     EXSR SCRVGN
     C                     MOVEL'N'       WN0001           First Time Flag
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.BOL Truck Scale Weigh Sts is Spread
     C           #RPAST    IFEQ 'S'                        *IF
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSA     READE@A2CPKC                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADDA2HMNB    A1HMNB           BOH Company Num
     C                     Z-ADDA2BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    A1BONB           BOL Load Number
     C                     Z-ADDA2CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDA2B0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSB     CHAIN@A1CPC4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RLIST           TH Schedule Kil
     C                     MOVEL*BLANK    WULJST           TH Shift Held O
     C                     Z-ADD*ZERO     WUT2HD           TH Shift Held O
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELA1LIST    #RLIST           TH Schedule Kil
     C                     MOVELA1LJST    WULJST           TH Shift Held O
     C                     Z-ADDA1T2HD    WUT2HD           TH Shift Held O
     C                     GOTO SBEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
      * Setup key
     C                     Z-ADDA2HMNB    AXHMNB           BOH Company Num
     C                     Z-ADDA2BNNB    AXBNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    AXBONB           BOL Load Number
      * Establish starting position
     C           KRSSC     CHAIN@AXCPBX              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0051' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUH5NB           BOL Head Receiv
     C                     MOVEL*BLANK    #RPAST           BOL Truck Scale
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAXDHNB    WUH5NB           BOL Head Receiv
     C                     MOVELAXPAST    #RPAST           BOL Truck Scale
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
      * Setup key
     C                     Z-ADDA2HMNB    AXHMNB           BOH Company Num
     C                     Z-ADDA2BNNB    AXBNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    AXBONB           BOL Load Number
      * Establish starting position
     C           KRSSD     CHAIN@AXCPBX              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0051' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUH5NB           BOL Head Receiv
     C                     MOVEL*BLANK    #RPAST           BOL Truck Scale
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAXDHNB    WUH5NB           BOL Head Receiv
     C                     MOVELAXPAST    #RPAST           BOL Truck Scale
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Td to Val SntToKl RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'N'       WUH7ST           Record Found US
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSE01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQSE02           Pen Number
     C           *LIKE     DEFN WAB7CD    WQSE03           TD Drive Card N
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           BOH Company Num
     C                     KFLD           WQSE02           Pen Number
     C                     KFLD           WQSE03           TD Drive Card N
      * Setup key
     C                     Z-ADD#1HVNB    WQSE01           BOH Company Num
     C                     MOVEL#1CMCD    WQSE02           Pen Number
     C                     Z-ADD#1B6CD    WQSE03           TD Drive Card N
      * Establish starting position
     C           KRSSE     SETLL@A2CPKH                    *
     C           KRSSE     READE@A2CPKH                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       WUH7ST           Record Found US
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0018           Pen Number
      * Send message 'Pen has changed since ref'
     C                     MOVEL'PRK0740' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO SEEXIT                     *QUIT
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y'       WUH7ST           Record Found US
     C                     GOTO SEEXIT                     *QUIT
     C           KRSSE     READE@A2CPKH                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Get Next Number - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *HIVAL    SETLL@DXCPXU                    *
     C                     READ @DXCPXU                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0728' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WULMNO           Is Message Log
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           DXLMNO    ADD  1         WULMNO           Is Message Log
     C                     GOTO SFEXIT                     *QUIT
     C                     READ @DXCPXU                  90*
     C                     ENDDO
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCRRC    BEGSR
      *================================================================
      * Create IS Message Log - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DXCPXS
     C                     Z-ADDWULMNO    WBLMNO           Is Message Log
     C                     MOVELWUL8TX    WBL8TX           Is Message
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVELWUAJST    WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSG    KLIST
     C                     KFLD           WBLMNO           Is Message Log
      * Check for duplicate primary key
     C           KLCRSG    SETLL@DXCPXS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0729' W0RTN   7
      * Send message 'IS Message Log         EX'
     C                     MOVEL'PRK0729' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C                     WRITE@DXCPXS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Rtv/Chg TttDtl Kill   Rt - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y'       WUHBST           First Time Flag
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSH01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQSH02           Pen Number
     C           *LIKE     DEFN WAB7CD    WQSH03           TD Drive Card N
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           BOH Company Num
     C                     KFLD           WQSH02           Pen Number
     C                     KFLD           WQSH03           TD Drive Card N
      * Setup key
     C                     Z-ADD#1HVNB    WQSH01           BOH Company Num
     C                     MOVEL#1CMCD    WQSH02           Pen Number
     C                     Z-ADD#1B6CD    WQSH03           TD Drive Card N
      * Establish starting position
     C           KRSSH     SETLL@A2CPKH                    *
     C           KRSSH     READE@A2CPKH                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
      * is not found
     C                     EXSR UBSUBR                     is not found
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * is tattoo detail found
     C                     EXSR UCSUBR                     is tattoo detai
     C                     MOVEL*BLANK    WUB9CD           TDP Process Cod
     C                     MOVEL'K'       WUB9CD           TDP Process Cod
     C                     Z-ADDWAC0NB    WUXYNB           Td Pen Head Org
     C                     Z-ADDWACZNB    WUXZNB           td Pen Head Wgt
     C                     Z-ADD*ZERO     WUCZNB           TD Live Wgt
     C                     Z-ADD*ZERO     WUEDNB           Head Held Over
      * Held Over Processing
      * CASE: DB1.TD Held Over Status is Ready-Hld Over Processing
     C           WAGGST    IFEQ 'Y'                        *IF
      * Take care of the carcass detail
      *   HEAD REC - YARD DEADS, HELD OVER = NET HEAD
     C                     EXSR UDSUBR                       HEAD REC - YA
     C                     MOVEL*BLANK    WUGGST           TD Held Over St
      * CASE: DB1.TD Pen Head EQ DB1.TD Held Over
     C           WAC0NB    IFEQ WAH7NB                     *IF
      * Held over all of tattoo detail
     C                     Z-ADDWAH7NB    WUC0NB           TD Pen Head
     C                     Z-ADDWACZNB    WUCZNB           TD Live Wgt
     C                     ELSE
      * CASE: *OTHERWISE
      * Held over only paritial  new record
     C                     Z-ADDWAH7NB    WUC0NB           TD Pen Head
     C           WAH7NB    MULT WAD7NB    WUCZNB           TD Live Wgt
     C                     END                             *FI
     C                     Z-ADDWAB0DT    WUB5DT           Date USR
     C                     Z-ADDWAD8NB    WUWHNB           Yard Dead
     C                     Z-ADDWUC0NB    WUEDNB           Head Held Over
     C                     Z-ADDWAH8NB    WUWGNB           Held Over Pen C
     C                     MOVELWACYCD    WUFECD           Held Over Pen N
      * Rtv Nxt Kill Dt 2 OMS XF - STR Order Management Sys  * 
     C                     CALL 'PDUXXFR'              90  Rtv Nxt Kill Dt
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WAH8NB    WQ0016  30       CC Company Numb
     C                     PARM WAB0DT    WQ0017  70       Kill Date Usr
     C           WUB2DT    PARM *ZERO     WQ0018  70       Next Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDUXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * Create Tattoo dtl with same tattoo, held over pen & head, nxt kil
      *  and recalc live wgt
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAJEA1' defaulted for 'TD Drive Hour'.
      * Create Tattoo Detail - Tattoo Detail  * 
     C                     EXSR SMCRRC
      * Tattoo hdr:  Reduce hd rcvd by the held over head & recalc live w
      * Create Tattoo hdr with same tattoo, held over head, nxt kill dt
      *  and recalc live wgt
      * This routine will split the information into the tattoo hdr
      * for the held over record and change the org record
      * Or if you want to call this the split routine.
      * This routine will split out the tattoo headers, and
      *   the tattoo ded/add, and the Tattoo Header Ext
      * Rtv/Chg Split Tto Rcd XF - Tattoo Header  * 
     C                     CALL 'PKFAXFR'              90  Rtv/Chg Split T
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WAHMNB    WQ0019  30       BOH Company Num
     C                     PARM WABNNB    WQ0020  70       BOH Buy Order N
     C                     PARM WABONB    WQ0021  50       BOL Load Number
     C                     PARM WACVNB    WQ0022  50       TH Tattoo Numbe
     C                     PARM WUB5DT    WQ0023  70       TH Kill Date
     C                     PARM WUEDNB    WQ0024  50       TD Held Over
     C                     PARM WUB2DT    WQ0025  70       Next Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKFAXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * Recount Held Over Pen Head and Chg the Pen
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
     C                     EXSR SNRVGN
      * kill plan held overs
      * Rtv/Chg Hld Ovr       RT - Kill Plan  * 
     C                     EXSR SXRVGN
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWAB0DT    WUB5DT           Date USR
     C                     Z-ADDWAD8NB    WUWHNB           Yard Dead
     C                     Z-ADDWAH8NB    WUWGNB           Held Over Pen C
     C                     MOVELWACYCD    WUFECD           Held Over Pen N
     C                     Z-ADDWAC0NB    WUC0NB           TD Pen Head
     C                     MOVELWAGGST    WUGGST           TD Held Over St
     C                     END                             *FI
      * remainder
     C           WUXZNB    SUB  WUCZNB    WUCZNB           TD Live Wgt
     C           WUXYNB    SUB  WUEDNB    WUC0NB           TD Pen Head
      * is tattoo detail updated
     C                     EXSR UESUBR                     is tattoo detai
      * *---------------------------------------------------------*
      * * 08/30/00 PKP  Job Date/time was being passed into the CHGOBJ.
      * *               This was resuling in inaccurate calculation of
      * *               Rest Time on the Rest Time Evaluation report.
      * Rtv System Date       UP - STR User Source Functions  * 
     C                     CALL 'PKPSUPR'              90  Rtv System Date
     C           YL0002    PARM *ZERO     WQ0026  70       *DATE
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKPSUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     END
      * Rtv Current Time      US - STR User Source Functions  * 
     C                     TIME           YL0003
     C           YL0003    DIV  10000     YL0004           TD Drive Hour
      * *---------------------------------------------------------*
      * H16749 slm 8/14/2020
      * H16749 replace chg date with chg system date
      * Chg Tattoo Detail SysDCH - Tattoo Detail  * 
     C                     EXSR TBCHRC
      * CASE: WRK.First Time Flag Usr is Yes
     C           WUHBST    IFEQ 'Y'                        *IF
      * Crt Tattoo Action Comm XF - Tattoo Header Comment  * 
     C                     CALL 'PKV4XFR'              90  Crt Tattoo Acti
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WAHMNB    WQ0029  30       BOH Company Num
     C                     PARM WABNNB    WQ0030  70       BOH Buy Order N
     C                     PARM WABONB    WQ0031  50       BOL Load Number
     C                     PARM WACVNB    WQ0032  50       TH Tattoo Numbe
     C                     PARM WUB5DT    WQ0033  70       TH Kill Date
     C                     PARM *ZERO     WQ0034  50       TH Head Receive
     C                     PARM *ZERO     WQ0035  50       TH Held Over
     C                     PARM *ZERO     WQ0036  80       TH AP Voucher/D
     C                     PARM *ZERO     WQ0037  70       TH Voucher Paym
     C                     PARM 'SK'      WQ0038  2        Tattoo Action U
     C                     PARM *BLANK    WQ0039  5        Tattoo Nbr Alph
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKV4XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL*BLANK    WUHBST           First Time Flag
     C                     END                             *FI
     C           KRSSH     READE@A2CPKH                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Get Next Number - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *HIVAL    SETLL@DXCPXU                    *
     C                     READ @DXCPXU                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0728' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WULMNO           Is Message Log
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           DXLMNO    ADD  1         WULMNO           Is Message Log
     C                     GOTO SIEXIT                     *QUIT
     C                     READ @DXCPXU                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCRRC    BEGSR
      *================================================================
      * Create IS Message Log - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DXCPXS
     C                     Z-ADDWULMNO    WBLMNO           Is Message Log
     C                     MOVELWUL8TX    WBL8TX           Is Message
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVELWUAJST    WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSJ    KLIST
     C                     KFLD           WBLMNO           Is Message Log
      * Check for duplicate primary key
     C           KLCRSJ    SETLL@DXCPXS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0729' W0RTN   7
      * Send message 'IS Message Log         EX'
     C                     MOVEL'PRK0729' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C                     WRITE@DXCPXS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Get Next Number - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *HIVAL    SETLL@DXCPXU                    *
     C                     READ @DXCPXU                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0728' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WULMNO           Is Message Log
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           DXLMNO    ADD  1         WULMNO           Is Message Log
     C                     GOTO SKEXIT                     *QUIT
     C                     READ @DXCPXU                  90*
     C                     ENDDO
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLCRRC    BEGSR
      *================================================================
      * Create IS Message Log - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DXCPXS
     C                     Z-ADDWULMNO    WBLMNO           Is Message Log
     C                     MOVELWUL8TX    WBL8TX           Is Message
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVELWUAJST    WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSL    KLIST
     C                     KFLD           WBLMNO           Is Message Log
      * Check for duplicate primary key
     C           KLCRSL    SETLL@DXCPXS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0729' W0RTN   7
      * Send message 'IS Message Log         EX'
     C                     MOVEL'PRK0729' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C                     WRITE@DXCPXS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMCRRC    BEGSR
      *================================================================
      * Create Tattoo Detail - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @A2CPDF
     C                     Z-ADDWAHMNB    WCHMNB           BOH Company Num
     C                     Z-ADDWABNNB    WCBNNB           BOH Buy Order N
     C                     Z-ADDWABONB    WCBONB           BOL Load Number
     C                     Z-ADDWACVNB    WCCVNB           TH Tattoo Numbe
     C                     Z-ADDWUB2DT    WCB0DT           TH Kill Date
     C                     Z-ADDWAC2NB    WCC2NB           TD Sequence Num
     C                     Z-ADDWUCZNB    WCCZNB           TD Live Wgt
     C                     Z-ADDWUC0NB    WCC0NB           TD Pen Head
     C                     Z-ADD*ZERO     WCD8NB           TD Yard Dead
     C                     Z-ADD*ZERO     WCH7NB           TD Held Over
     C                     MOVEL*BLANK    WCGGST           TD Held Over St
     C                     Z-ADD*ZERO     WCAJTM           TD Drive Time
     C                     Z-ADDWAJEA1    WCJEA1           TD Drive Hour
     C                     Z-ADD*ZERO     WCB7CD           TD Drive Card N
     C                     Z-ADDWAD7NB    WCD7NB           TD Avg Live Wgt
     C                     MOVELWAD9ST    WCD9ST           TD Gen Bal To K
     C                     MOVEL'Y'       WCE3ST           TD Recs Created
     C                     MOVELWAE4ST    WCE4ST           TD User Status
     C                     MOVELWAE5ST    WCE5ST           TD User Status
     C                     Z-ADDWABVDT    WCBVDT           TD User Date 1
     C                     Z-ADDWABWDT    WCBWDT           TD User Date 2
     C                     Z-ADDWABXDT    WCBXDT           TD Drive Date
     C                     Z-ADDWAH8NB    WCHVNB           Pen Company Num
     C                     MOVELWACYCD    WCCMCD           Pen Number
     C                     MOVE *BLANK    WCB9CD           TDP Process Cod
     C                     MOVEL'O'       WCB9CD           TDP Process Cod
     C                     Z-ADD*ZERO     WCH8NB           Held Over Pen C
     C                     MOVEL*BLANK    WCCYCD           Held Over Pen N
     C                     MOVEL*BLANK    WCAAVN           RS User Changed
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     MOVELWAAJST    WCAJST           RS Record Statu
     C                     MOVELWAAHVN    WCAHVN           RS Job
     C                     MOVELWAAGVN    WCAGVN           RS Program
     C                     MOVELWAABVN    WCABVN           RS User Added
     C                     Z-ADDWAABDT    WCABDT           RS Date Added
     C                     Z-ADDWAABTM    WCABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WCAJST           RS Record Statu
     C                     MOVEL##USR     WCABVN           RS User Added
     C                     Z-ADD##JDT     WCABDT           RS Date Added
     C                     Z-ADD##JTM     WCABTM           RS Time Added
     C                     MOVEL##PGM     WCAGVN           RS Program
     C                     MOVEL##JOB     WCAHVN           RS Job
     C           KLCRSM    KLIST
     C                     KFLD           WCHMNB           BOH Company Num
     C                     KFLD           WCBNNB           BOH Buy Order N
     C                     KFLD           WCBONB           BOL Load Number
     C                     KFLD           WCCVNB           TH Tattoo Numbe
     C                     KFLD           WCB0DT           TH Kill Date
     C                     KFLD           WCC2NB           TD Sequence Num
      * Check for duplicate primary key
     C           KLCRSM    SETLL@A2CPDF                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0064' W0RTN   7
      * Send message 'Tattoo Detail          EX'
     C                     MOVEL'PRK0064' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SMEXIT
     C                     ENDIF
      *
     C                     WRITE@A2CPDF                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Set Pen Totals to Zeros - Pen  * 
     C                     EXSR SORVGN
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDHMNB    WQSN01           BOH Company Num
     C           *LIKE     DEFN WDCMCD    WQSN02           Pen Number
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           WQSN01           BOH Company Num
     C                     KFLD           WQSN02           Pen Number
      * Setup key
     C                     Z-ADDWUWGNB    WQSN01           BOH Company Num
     C                     MOVELWUFECD    WQSN02           Pen Number
      * Establish starting position
     C           KRSSN     SETLL@A2CPKE                    *
     C           KRSSN     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR SQCHRC
     C                     GOTO SNEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Rtv/Chg Pen Totals    RT - Pen  * 
     C                     EXSR SRRVGN
     C           KRSSN     READE@A2CPKE                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
     C                     EXSR STRVGN
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR SWCHRC
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * Set Pen Totals to Zeros - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WEHVNB           Pen Company Num
     C                     KFLD           WECMCD           Pen Number
      * Setup key
     C                     Z-ADDWUWGNB    WEHVNB           Pen Company Num
     C                     MOVELWUFECD    WECMCD           Pen Number
      * Establish starting position
     C           KRSSO     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Pen               CH - Pen  * 
     C                     EXSR SPCHRC
     C                     ENDIF
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWEHVNB    WFHVNB           Pen Company Num
     C                     MOVELWECMCD    WFCMCD    P      Pen Number
      *
     C           KLCHSP    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSP    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SPEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YARDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUCRTX    WFBBTX    P      Pen Description
     C                     Z-ADDWECTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WFD6NB           Pen Current Hea
     C                     Z-ADDWEB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWEDGST    WFDGST    P      Pen Sts
     C                     Z-ADDWEEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWEFWST    WFFWST    P      Pen Type
     C                     Z-ADDWEHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWUCRTX    WFAGCD    P      GN Genetic Code
     C                     MOVELWEAAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDWEAADT    WFAADT           RS Date Changed
     C                     Z-ADDWEAMTM    WFAMTM           RS Time Changed
     C                     MOVELWEAJST    WFAJST    P      RS Record Statu
     C                     MOVELWEAHVN    WFAHVN    P      RS Job
     C                     MOVELWEAGVN    WFAGVN    P      RS Program
     C                     MOVELWEABVN    WFABVN    P      RS User Added
     C                     Z-ADDWEABDT    WFABDT           RS Date Added
     C                     Z-ADDWEABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0035  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0036  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0037  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0038  1        Pen Sts
     C                     Z-ADD*ZERO     WN0039  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0040  1        Pen Type
     C                     Z-ADD*ZERO     WN0041  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0042 10        RS User Changed
     C                     Z-ADD*ZERO     WN0043  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0044  60       RS Time Changed
     C                     MOVEL*BLANK    WN0045  1        RS Record Statu
     C                     MOVEL*BLANK    WN0046 10        RS Job
     C                     MOVEL*BLANK    WN0047 10        RS Program
     C                     MOVEL*BLANK    WN0048 10        RS User Added
     C                     Z-ADD*ZERO     WN0049  70       RS Date Added
     C                     Z-ADD*ZERO     WN0050  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWUWGNB    WFHVNB           Pen Company Num
     C                     MOVELWUFECD    WFCMCD    P      Pen Number
      *
     C           KLCHSQ    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSQ    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SQEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YBRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX    P      Pen Description
     C                     MOVELWUAGCD    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * Rtv/Chg Pen Totals    RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           WEHVNB           Pen Company Num
     C                     KFLD           WECMCD           Pen Number
      * Setup key
     C                     Z-ADDWDHMNB    WEHVNB           Pen Company Num
     C                     MOVELWDCMCD    WECMCD           Pen Number
      * Establish starting position
     C           KRSSR     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           WDC0NB    ADD  WED6NB    WUD6NB           Pen Current Hea
     C                     SUB  WDD8NB    WUD6NB           Pen Current Hea
      * Chg Pen               CH - Pen  * 
     C                     EXSR SSCHRC
     C                     ENDIF
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWEHVNB    WFHVNB           Pen Company Num
     C                     MOVELWECMCD    WFCMCD    P      Pen Number
      *
     C           KLCHSS    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSS    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SSEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SSEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YCRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWEBBTX    WFBBTX    P      Pen Description
     C                     Z-ADDWECTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDWUD6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDWEB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWEDGST    WFDGST    P      Pen Sts
     C                     Z-ADDWEEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWEFWST    WFFWST    P      Pen Type
     C                     Z-ADDWEHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWEAGCD    WFAGCD    P      GN Genetic Code
     C                     MOVELWEAAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDWEAADT    WFAADT           RS Date Changed
     C                     Z-ADDWEAMTM    WFAMTM           RS Time Changed
     C                     MOVELWEAJST    WFAJST    P      RS Record Statu
     C                     MOVELWEAHVN    WFAHVN    P      RS Job
     C                     MOVELWEAGVN    WFAGVN    P      RS Program
     C                     MOVELWEABVN    WFABVN    P      RS User Added
     C                     Z-ADDWEABDT    WFABDT           RS Date Added
     C                     Z-ADDWEABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STRVGN    BEGSR
      *================================================================
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDHMNB    WQST01           BOH Company Num
     C           *LIKE     DEFN WDCMCD    WQST02           Pen Number
      * Define keylist
     C           KRSST     KLIST
     C                     KFLD           WQST01           BOH Company Num
     C                     KFLD           WQST02           Pen Number
      * Setup key
     C                     Z-ADDWDHMNB    WQST01           BOH Company Num
     C                     MOVELWDCMCD    WQST02           Pen Number
      * Establish starting position
     C           KRSST     SETLL@A2CPKE                    *
     C           KRSST     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     GOTO STEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.TDP Process Code is Drive Card Printed
      *   |- c2    : DB1.TDP Process Code is Open
      *   '-
     C           WDB9CD    IFEQ 'D'                        *IF
     C           WDB9CD    OREQ 'O'                        *OR
      * Rtv Tattoo GENETICS - Tattoo Header  * 
     C                     EXSR SURVGN
      * CASE: PAR.GN Genetic Code is BLANKS
     C           WUAGCD    IFEQ *BLANK                     *IF
     C                     MOVELWUA1CD    WUAGCD           GN Genetic Code
     C                     MOVELWUJTTX    WUBBTX           Pen Description
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Genetic Code USR NE PAR.GN Genetic Code
     C           WUA1CD    IFNE WUAGCD                     *IF
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL'MIXED'   WUBBTX           Pen Description
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSST     READE@A2CPKE                  90*
     C                     ENDDO
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SURVGN    BEGSR
      *================================================================
      * Rtv Tattoo GENETICS - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A1HMNB    WQSU01           BOH Company Num
     C           *LIKE     DEFN A1BNNB    WQSU02           BOH Buy Order N
     C           *LIKE     DEFN A1BONB    WQSU03           BOL Load Number
     C           *LIKE     DEFN A1CVNB    WQSU04           TH Tattoo Numbe
      * Define keylist
     C           KRSSU     KLIST
     C                     KFLD           WQSU01           BOH Company Num
     C                     KFLD           WQSU02           BOH Buy Order N
     C                     KFLD           WQSU03           BOL Load Number
     C                     KFLD           WQSU04           TH Tattoo Numbe
      * Setup key
     C                     Z-ADDWDHMNB    WQSU01           BOH Company Num
     C                     Z-ADDWDBNNB    WQSU02           BOH Buy Order N
     C                     Z-ADDWDBONB    WQSU03           BOL Load Number
     C                     Z-ADDWDCVNB    WQSU04           TH Tattoo Numbe
      * Establish starting position
     C           KRSSU     SETLL@A1CPC4                    *
     C           KRSSU     READE@A1CPC4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUA1CD           GN Genetic Code
     C                     MOVEL*BLANK    WUJTTX           Pen Description
     C                     GOTO SUEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA1AGCD    WUA1CD           GN Genetic Code
      * Rtv Genetic Record    RT - Genetic  * 
     C                     EXSR SVRVGN
     C           KRSSU     READE@A1CPC4                  90*
     C                     ENDDO
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * Rtv Genetic Record    RT - Genetic  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Setup key
     C                     MOVELA1AGCD    AIAGCD           GN Genetic Code
      * Establish starting position
     C           KRSSV     CHAIN@AIREA9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0021' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUJTTX           GN Description
     C                     GOTO SVEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAIAWTX    WUJTTX           GN Description
     C                     ENDIF
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         SWCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0051  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0052  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0053  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0054  1        Pen Sts
     C                     Z-ADD*ZERO     WN0055  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0056  1        Pen Type
     C                     Z-ADD*ZERO     WN0057  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0058 10        RS User Changed
     C                     Z-ADD*ZERO     WN0059  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0060  60       RS Time Changed
     C                     MOVEL*BLANK    WN0061  1        RS Record Statu
     C                     MOVEL*BLANK    WN0062 10        RS Job
     C                     MOVEL*BLANK    WN0063 10        RS Program
     C                     MOVEL*BLANK    WN0064 10        RS User Added
     C                     Z-ADD*ZERO     WN0065  70       RS Date Added
     C                     Z-ADD*ZERO     WN0066  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWUWGNB    WFHVNB           Pen Company Num
     C                     MOVELWUFECD    WFCMCD    P      Pen Number
      *
     C           KLCHSW    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSW    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SWEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SWEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YDRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX    P      Pen Description
     C                     MOVELWUAGCD    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SWEXIT    ENDSR
      /EJECT
     CSR         SXRVGN    BEGSR
      *================================================================
      * Rtv/Chg Hld Ovr       RT - Kill Plan  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSX     KLIST
     C                     KFLD           AOHTNB           KP Company Numb
     C                     KFLD           AOADDT           KP Kill/Cut Dat
     C                     KFLD           AOAZST           KP Shift
      * Setup key
     C                     Z-ADDWAHMNB    AOHTNB           KP Company Numb
     C                     Z-ADDWUB5DT    AOADDT           KP Kill/Cut Dat
     C                     MOVEL'1'       AOAZST           KP Shift
      * Establish starting position
     C           KRSSX     CHAIN@AOCPAO              90    *
      * Data record not found
     C   90                MOVEL'PRK0033' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           AOCBNB    ADD  WUEDNB    WUCBNB           KP Head Hold Ov
      * Chg Head Hld Ovr      CH - Kill Plan  * 
     C                     EXSR SYCHRC
     C                     ENDIF
      *================================================================
     CSR         SXEXIT    ENDSR
      /EJECT
     CSR         SYCHRC    BEGSR
      *================================================================
      * Chg Head Hld Ovr      CH - Kill Plan  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0067  50       KP Planned Kill
     C                     MOVEL*BLANK    WN0068 10        RS User Changed
     C                     Z-ADD*ZERO     WN0069  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0070  60       RS Time Changed
     C                     MOVEL*BLANK    WN0071  1        RS Record Statu
     C                     MOVEL*BLANK    WN0072 10        RS Job
     C                     MOVEL*BLANK    WN0073 10        RS Program
     C                     MOVEL*BLANK    WN0074 10        RS User Added
     C                     Z-ADD*ZERO     WN0075  70       RS Date Added
     C                     Z-ADD*ZERO     WN0076  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YERDC   1
      *
      * Move key fields to @AOCPAN
     C                     Z-ADDAOHTNB    WGHTNB           KP Company Numb
     C                     Z-ADDAOADDT    WGADDT           KP Kill/Cut Dat
     C                     MOVELAOAZST    WGAZST    P      KP Shift
      *
     C           KLCHSY    KLIST
     C                     KFLD           WGHTNB           KP Company Numb
     C                     KFLD           WGADDT           KP Kill/Cut Dat
     C                     KFLD           WGAZST           KP Shift
     C           KLCHSY    CHAIN@AOCPAN              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAOCPL0'MDACP
     C                     MOVEL'@AOCPAN' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL005.
     C                     MOVEL'LBL005'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SYEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SYEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKAO1    YERDCS
      * Move non-key fields to @AOCPAN
     C                     Z-ADDWUCBNB    WGCBNB           KP Head Hold Ov
     C                     Z-ADDAOX2NB    WGX2NB           KP Cut Avg Cold
     C                     Z-ADDAOX3NB    WGX3NB           KP Planned Cut
      *
      * Set PGM.*Record Data Changed flag
     C           QPKAO1    IFNE YERDCS
     C           YERDC     ANDNE'N'
     C                     MOVE 'Y'       YERDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WGAAVN           RS User Changed
     C                     Z-ADD##JDT     WGAADT           RS Date Changed
     C                     Z-ADD##JTM     WGAMTM           RS Time Changed
     C                     MOVEL##JOB     WGAHVN           RS Job
     C                     MOVEL##PGM     WGAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKAO1    IFNE YERDCS
     C           YERDC     ANDNE'N'
     C                     MOVE 'Y'       YERDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@AOCPAN                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKAOCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SYEXIT    ENDSR
      /EJECT
     CSR         SZRVGN    BEGSR
      *================================================================
      * Get Next Number - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *HIVAL    SETLL@DXCPXU                    *
     C                     READ @DXCPXU                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0728' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WULMNO           Is Message Log
     C                     GOTO SZEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           DXLMNO    ADD  1         WULMNO           Is Message Log
     C                     GOTO SZEXIT                     *QUIT
     C                     READ @DXCPXU                  90*
     C                     ENDDO
      *================================================================
     CSR         SZEXIT    ENDSR
      /EJECT
     CSR         TACRRC    BEGSR
      *================================================================
      * Create IS Message Log - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DXCPXS
     C                     Z-ADDWULMNO    WBLMNO           Is Message Log
     C                     MOVELWUL8TX    WBL8TX           Is Message
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVELWUAJST    WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRTA    KLIST
     C                     KFLD           WBLMNO           Is Message Log
      * Check for duplicate primary key
     C           KLCRTA    SETLL@DXCPXS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0729' W0RTN   7
      * Send message 'IS Message Log         EX'
     C                     MOVEL'PRK0729' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TAEXIT
     C                     ENDIF
      *
     C                     WRITE@DXCPXS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         TAEXIT    ENDSR
      /EJECT
     CSR         TBCHRC    BEGSR
      *================================================================
      * Chg Tattoo Detail SysDCH - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YFRDC   1
      *
      * Move key fields to @A2CPDF
     C                     Z-ADDWAHMNB    WCHMNB           BOH Company Num
     C                     Z-ADDWABNNB    WCBNNB           BOH Buy Order N
     C                     Z-ADDWABONB    WCBONB           BOL Load Number
     C                     Z-ADDWACVNB    WCCVNB           TH Tattoo Numbe
     C                     Z-ADDWUB5DT    WCB0DT           TH Kill Date
     C                     Z-ADDWAC2NB    WCC2NB           TD Sequence Num
      *
     C           KLCHTB    KLIST
     C                     KFLD           WCHMNB           BOH Company Num
     C                     KFLD           WCBNNB           BOH Buy Order N
     C                     KFLD           WCBONB           BOL Load Number
     C                     KFLD           WCCVNB           TH Tattoo Numbe
     C                     KFLD           WCB0DT           TH Kill Date
     C                     KFLD           WCC2NB           TD Sequence Num
     C           KLCHTB    CHAIN@A2CPDF              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA2CPL0'MDACP
     C                     MOVEL'@A2CPDF' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL006.
     C                     MOVEL'LBL006'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA21    YFRDCS
      * Move non-key fields to @A2CPDF
     C                     Z-ADDWUCZNB    WCCZNB           TD Live Wgt
     C                     Z-ADDWUC0NB    WCC0NB           TD Pen Head
     C                     Z-ADDWUWHNB    WCD8NB           TD Yard Dead
     C                     Z-ADDWUEDNB    WCH7NB           TD Held Over
     C                     MOVELWUGGST    WCGGST    P      TD Held Over St
     C                     Z-ADDYL0003    WCAJTM           TD Drive Time
     C                     Z-ADDYL0004    WCJEA1           TD Drive Hour
     C                     Z-ADDWAB7CD    WCB7CD           TD Drive Card N
     C                     Z-ADDWAD7NB    WCD7NB           TD Avg Live Wgt
     C                     MOVELWAD9ST    WCD9ST    P      TD Gen Bal To K
     C                     MOVELWAE3ST    WCE3ST    P      TD Recs Created
     C                     MOVELWAE4ST    WCE4ST    P      TD User Status
     C                     MOVELWAE5ST    WCE5ST    P      TD User Status
     C                     Z-ADDWABVDT    WCBVDT           TD User Date 1
     C                     Z-ADDWABWDT    WCBWDT           TD User Date 2
     C                     Z-ADDYL0002    WCBXDT           TD Drive Date
     C                     Z-ADDWAHVNB    WCHVNB           Pen Company Num
     C                     MOVELWACMCD    WCCMCD    P      Pen Number
     C                     MOVELWUB9CD    WCB9CD    P      TDP Process Cod
     C                     Z-ADDWUWGNB    WCH8NB           Held Over Pen C
     C                     MOVELWUFECD    WCCYCD    P      Held Over Pen N
     C                     MOVELWAAAVN    WCAAVN    P      RS User Changed
     C                     Z-ADDWAAADT    WCAADT           RS Date Changed
     C                     Z-ADDWAAMTM    WCAMTM           RS Time Changed
     C                     MOVELWAAJST    WCAJST    P      RS Record Statu
     C                     MOVELWAAHVN    WCAHVN    P      RS Job
     C                     MOVELWAAGVN    WCAGVN    P      RS Program
     C                     MOVELWAABVN    WCABVN    P      RS User Added
     C                     Z-ADDWAABDT    WCABDT           RS Date Added
     C                     Z-ADDWAABTM    WCABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YFRDCS
     C           YFRDC     ANDNE'N'
     C                     MOVE 'Y'       YFRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp-SysDtIF
     C                     MOVEL##USR     WCAAVN           RS User Changed
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WCAADT    PARM *ZERO     WQ0027  70       *DATE
     C           WCAMTM    PARM *ZERO     WQ0028  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     END
     C                     MOVEL##JOB     WCAHVN           RS Job
     C                     MOVEL##PGM     WCAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YFRDCS
     C           YFRDC     ANDNE'N'
     C                     MOVE 'Y'       YFRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@A2CPDF                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TBEXIT    ENDSR
      /EJECT
     CSR         TCRVGN    BEGSR
      *================================================================
      * Get Next Number - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *HIVAL    SETLL@DXCPXU                    *
     C                     READ @DXCPXU                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0728' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WULMNO           Is Message Log
     C                     GOTO TCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           DXLMNO    ADD  1         WULMNO           Is Message Log
     C                     GOTO TCEXIT                     *QUIT
     C                     READ @DXCPXU                  90*
     C                     ENDDO
      *================================================================
     CSR         TCEXIT    ENDSR
      /EJECT
     CSR         TDCRRC    BEGSR
      *================================================================
      * Create IS Message Log - IS Message Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DXCPXS
     C                     Z-ADDWULMNO    WBLMNO           Is Message Log
     C                     MOVELWUL8TX    WBL8TX           Is Message
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVELWUAJST    WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRTD    KLIST
     C                     KFLD           WBLMNO           Is Message Log
      * Check for duplicate primary key
     C           KLCRTD    SETLL@DXCPXS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0729' W0RTN   7
      * Send message 'IS Message Log         EX'
     C                     MOVEL'PRK0729' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TDEXIT
     C                     ENDIF
      *
     C                     WRITE@DXCPXS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         TDEXIT    ENDSR
      /EJECT
     CSR         TERVGN    BEGSR
      *================================================================
      * Upd Re-Open Pen       RT - Pen  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0077 25        Pen Description
     C                     Z-ADD*ZERO     WN0078  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0079  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0080  1        Pen Sts
     C                     Z-ADD*ZERO     WN0081  30       Pen Drive Seque
     C                     Z-ADD*ZERO     WN0082  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0083  5        GN Genetic Code
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     MOVEL*BLANK    WN0077           Pen Description
     C                     Z-ADD*ZERO     WN0078           Pen Current Hea
     C                     Z-ADD*ZERO     WN0079           Pen Current Dri
     C                     MOVEL*BLANK    WN0080           Pen Sts
     C                     Z-ADD*ZERO     WN0081           Pen Drive Seque
     C                     Z-ADD*ZERO     WN0082           Pen Adjustment
     C                     MOVEL*BLANK    WN0083           GN Genetic Code
      * Define keylist
     C           KRSTE     KLIST
     C                     KFLD           WEHVNB           Pen Company Num
     C                     KFLD           WECMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WEHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WECMCD           Pen Number
      * Establish starting position
     C           KRSTE     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'O'       WN0080           Pen Sts
      * Chg Re-Open Pen       CH - Pen  * 
     C                     EXSR TFCHRC
     C                     ENDIF
      *================================================================
     CSR         TEEXIT    ENDSR
      /EJECT
     CSR         TFCHRC    BEGSR
      *================================================================
      * Chg Re-Open Pen       CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0084  50       Pen Maximun Cap
     C                     MOVEL*BLANK    WN0085  1        Pen Type
     C                     MOVEL*BLANK    WN0086 10        RS User Changed
     C                     Z-ADD*ZERO     WN0087  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0088  60       RS Time Changed
     C                     MOVEL*BLANK    WN0089  1        RS Record Statu
     C                     MOVEL*BLANK    WN0090 10        RS Job
     C                     MOVEL*BLANK    WN0091 10        RS Program
     C                     MOVEL*BLANK    WN0092 10        RS User Added
     C                     Z-ADD*ZERO     WN0093  70       RS Date Added
     C                     Z-ADD*ZERO     WN0094  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YGRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWEHVNB    WFHVNB           Pen Company Num
     C                     MOVELWECMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTF    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTF    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL007.
     C                     MOVEL'LBL007'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YGRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWN0077    WFBBTX    P      Pen Description
     C                     Z-ADDWN0078    WFD6NB           Pen Current Hea
     C                     Z-ADDWN0079    WFB6CD           Pen Current Dri
     C                     MOVELWN0080    WFDGST    P      Pen Sts
     C                     Z-ADDWN0081    WFEBNB           Pen Drive Seque
     C                     Z-ADDWN0082    WFHBNB           Pen Adjustment
     C                     MOVELWN0083    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YGRDCS
     C           YGRDC     ANDNE'N'
     C                     MOVE 'Y'       YGRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YGRDCS
     C           YGRDC     ANDNE'N'
     C                     MOVE 'Y'       YGRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YGRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TFEXIT    ENDSR
      /EJECT
     CSR         TGRVGN    BEGSR
      *================================================================
      * Rtv Pen Head Total    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     WN0096           Pen Current Hea
      * Declare restrictor key work fields
     C           *LIKE     DEFN WHHMNB    WQTG01           BOH Company Num
     C           *LIKE     DEFN WHCMCD    WQTG02           Pen Number
      * Define keylist
     C           KRSTG     KLIST
     C                     KFLD           WQTG01           BOH Company Num
     C                     KFLD           WQTG02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQTG01           BOH Company Num
     C                     MOVEL#1CMCD    WQTG02           Pen Number
      * Establish starting position
     C           KRSTG     SETLL@A2CPI7                    *
     C           KRSTG     READE@A2CPI7                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Pen Current Head
      * PAR.Pen Current Head =
      *    *COMPUTE (x1 + (x2 - x3))
      * x1    : PAR.Pen Current Head
      * +     : PGM.*Synon (15,0) work field
      * x2    : DB1.TD Pen Head
      * -     : PGM.*Synon (15,0) work field
      * x3    : DB1.TD Yard Dead
     C           WHC0NB    SUB  WHD8NB    W0WJ01           *Synon (15,0) w
     C           WN0096    ADD  W0WJ01    W0WJ00           *Synon (15,0) w
     C                     Z-ADDW0WJ00    WN0096           Pen Current Hea
     C           KRSTG     READE@A2CPI7                  90*
     C                     ENDDO
      *================================================================
     CSR         TGEXIT    ENDSR
      /EJECT
     CSR         THRVGN    BEGSR
      *================================================================
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDHMNB    WQTH01           BOH Company Num
     C           *LIKE     DEFN WDCMCD    WQTH02           Pen Number
      * Define keylist
     C           KRSTH     KLIST
     C                     KFLD           WQTH01           BOH Company Num
     C                     KFLD           WQTH02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQTH01           BOH Company Num
     C                     MOVEL#1CMCD    WQTH02           Pen Number
      * Establish starting position
     C           KRSTH     SETLL@A2CPKE                    *
     C           KRSTH     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WN0095           Pen Description
     C                     MOVEL*BLANK    WN0097           GN Genetic Code
     C                     GOTO THEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.TDP Process Code is Drive Card Printed
      *   |- c2    : DB1.TDP Process Code is Open
      *   '-
     C           WDB9CD    IFEQ 'D'                        *IF
     C           WDB9CD    OREQ 'O'                        *OR
      * Rtv Tattoo GENETICS - Tattoo Header  * 
     C                     EXSR TIRVGN
      * CASE: PAR.GN Genetic Code is BLANKS
     C           WN0097    IFEQ *BLANK                     *IF
     C                     MOVELWUA1CD    WN0097           GN Genetic Code
     C                     MOVELWUJTTX    WN0095           Pen Description
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Genetic Code USR NE PAR.GN Genetic Code
     C           WUA1CD    IFNE WN0097                     *IF
     C                     MOVEL*BLANK    WN0095           Pen Description
     C                     MOVEL'MIXED'   WN0095           Pen Description
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSTH     READE@A2CPKE                  90*
     C                     ENDDO
      *================================================================
     CSR         THEXIT    ENDSR
      /EJECT
     CSR         TIRVGN    BEGSR
      *================================================================
      * Rtv Tattoo GENETICS - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A1HMNB    WQTI01           BOH Company Num
     C           *LIKE     DEFN A1BNNB    WQTI02           BOH Buy Order N
     C           *LIKE     DEFN A1BONB    WQTI03           BOL Load Number
     C           *LIKE     DEFN A1CVNB    WQTI04           TH Tattoo Numbe
      * Define keylist
     C           KRSTI     KLIST
     C                     KFLD           WQTI01           BOH Company Num
     C                     KFLD           WQTI02           BOH Buy Order N
     C                     KFLD           WQTI03           BOL Load Number
     C                     KFLD           WQTI04           TH Tattoo Numbe
      * Setup key
     C                     Z-ADDWDHMNB    WQTI01           BOH Company Num
     C                     Z-ADDWDBNNB    WQTI02           BOH Buy Order N
     C                     Z-ADDWDBONB    WQTI03           BOL Load Number
     C                     Z-ADDWDCVNB    WQTI04           TH Tattoo Numbe
      * Establish starting position
     C           KRSTI     SETLL@A1CPC4                    *
     C           KRSTI     READE@A1CPC4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUA1CD           GN Genetic Code
     C                     MOVEL*BLANK    WUJTTX           Pen Description
     C                     GOTO TIEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA1AGCD    WUA1CD           GN Genetic Code
      * Rtv Genetic Record    RT - Genetic  * 
     C                     EXSR TJRVGN
     C           KRSTI     READE@A1CPC4                  90*
     C                     ENDDO
      *================================================================
     CSR         TIEXIT    ENDSR
      /EJECT
     CSR         TJRVGN    BEGSR
      *================================================================
      * Rtv Genetic Record    RT - Genetic  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTJ     KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Setup key
     C                     MOVELA1AGCD    AIAGCD           GN Genetic Code
      * Establish starting position
     C           KRSTJ     CHAIN@AIREA9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0021' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUJTTX           GN Description
     C                     GOTO TJEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAIAWTX    WUJTTX           GN Description
     C                     ENDIF
      *================================================================
     CSR         TJEXIT    ENDSR
      /EJECT
     CSR         TKCHRC    BEGSR
      *================================================================
      * Chg Pen CurHd/Genetic CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0098  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0099  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0100  1        Pen Sts
     C                     Z-ADD*ZERO     WN0101  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0102  1        Pen Type
     C                     Z-ADD*ZERO     WN0103  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0104 10        RS User Changed
     C                     Z-ADD*ZERO     WN0105  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0106  60       RS Time Changed
     C                     MOVEL*BLANK    WN0107  1        RS Record Statu
     C                     MOVEL*BLANK    WN0108 10        RS Job
     C                     MOVEL*BLANK    WN0109 10        RS Program
     C                     MOVEL*BLANK    WN0110 10        RS User Added
     C                     Z-ADD*ZERO     WN0111  70       RS Date Added
     C                     Z-ADD*ZERO     WN0112  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YHRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HVNB    WFHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTK    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTK    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL008.
     C                     MOVEL'LBL008'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TKEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TKEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YHRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWN0095    WFBBTX    P      Pen Description
     C                     Z-ADDWN0096    WFD6NB           Pen Current Hea
     C                     MOVELWN0097    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YHRDCS
     C           YHRDC     ANDNE'N'
     C                     MOVE 'Y'       YHRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YHRDCS
     C           YHRDC     ANDNE'N'
     C                     MOVE 'Y'       YHRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YHRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TKEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * IS MESSAGE INFORMATION  Tattoo Detail to be read
      *================================================================
      * Setup message data for message
     C                     MOVEL@CN,003   ZA0019           @Action
     C                     Z-ADDWN0003    ZA0020           BOH Buy Order N
     C                     Z-ADDWN0004    ZA0021           BOL Load Number
     C                     Z-ADDWN0005    ZA0022           TH Tattoo Numbe
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  WN0006    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0023
     C                     Z-ADD*ZERO     ZA0024           TD Sequence Num
     C                     Z-ADDWN0009    ZA0025           TD Pen Head
     C                     Z-ADD#1B6CD    ZA0026           Pen Current Dri
     C                     Z-ADD#1HVNB    ZA0027           Pen Company Num
     C                     MOVEL#1CMCD    ZA0028           Pen Number
     C                     MOVELWUDGST    ZA0029           Pen Sts
     C                     Z-ADD*ZERO     ZA0030           Pen Drive Seque
      * Retrieve message IS Message Information 01
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0730' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUL8TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Get Next Number - IS Message Log  * 
     C                     EXSR SFRVGN
      * Create IS Message Log - IS Message Log  * 
     C                     EXSR SGCRRC
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * is not found
      *================================================================
      * Setup message data for message
     C                     MOVEL'TD NF'   ZA0031           @Action
     C                     Z-ADD*ZERO     ZA0032           BOH Buy Order N
     C                     Z-ADD*ZERO     ZA0033           BOL Load Number
     C                     Z-ADD*ZERO     ZA0034           TH Tattoo Numbe
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  *ZERO     XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0035
     C                     Z-ADD*ZERO     ZA0036           TD Sequence Num
     C                     Z-ADD*ZERO     ZA0037           TD Pen Head
     C                     Z-ADD#1B6CD    ZA0038           TD Drive Card N
     C                     Z-ADD#1HVNB    ZA0039           BOH Company Num
     C                     MOVEL#1CMCD    ZA0040           Pen Number
     C                     MOVELWUDGST    ZA0041           Pen Sts
     C                     Z-ADD*ZERO     ZA0042           Pen Drive Seque
      * Retrieve message IS Message Information 01
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0730' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUL8TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Get Next Number - IS Message Log  * 
     C                     EXSR SIRVGN
      * Create IS Message Log - IS Message Log  * 
     C                     EXSR SJCRRC
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * is tattoo detail found
      *================================================================
      * Setup message data for message
     C                     MOVEL@CN,004   ZA0043           @Action
     C                     Z-ADDWABNNB    ZA0044           BOH Buy Order N
     C                     Z-ADDWABONB    ZA0045           BOL Load Number
     C                     Z-ADDWACVNB    ZA0046           TH Tattoo Numbe
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  WAB0DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0047
     C                     Z-ADDWAC2NB    ZA0048           TD Sequence Num
     C                     Z-ADDWAC0NB    ZA0049           TD Pen Head
     C                     Z-ADDWAB7CD    ZA0050           TD Drive Card N
     C                     Z-ADDWAHVNB    ZA0051           Pen Company Num
     C                     MOVELWACMCD    ZA0052           Pen Number
     C                     MOVELWUDGST    ZA0053           Pen Sts
     C                     Z-ADD*ZERO     ZA0054           Pen Drive Seque
      * Retrieve message IS Message Information 01
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0730' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUL8TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Get Next Number - IS Message Log  * 
     C                     EXSR SKRVGN
      * Create IS Message Log - IS Message Log  * 
     C                     EXSR SLCRRC
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      *   HEAD REC - YARD DEADS, HELD OVER = NET HEAD
      *================================================================
     C           WAC0NB    SUB  WAD8NB    WUF6NB           Net Head Usr
     C                     SUB  WAH7NB    WUF6NB           Net Head Usr
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * is tattoo detail updated
      *================================================================
      * Setup message data for message
     C                     MOVEL@CN,005   ZA0055           @Action
     C                     Z-ADDWABNNB    ZA0056           BOH Buy Order N
     C                     Z-ADDWABONB    ZA0057           BOL Load Number
     C                     Z-ADDWACVNB    ZA0058           TH Tattoo Numbe
      * Convert Date USR to display format
      * Convert date
     C           1000000   ADD  WUB5DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0059
     C                     Z-ADDWAC2NB    ZA0060           TD Sequence Num
     C                     Z-ADDWAC0NB    ZA0061           TD Pen Head
     C                     Z-ADDWAB7CD    ZA0062           TD Drive Card N
     C                     Z-ADDWAHVNB    ZA0063           Pen Company Num
     C                     MOVELWACMCD    ZA0064           Pen Number
     C                     MOVELWUDGST    ZA0065           Pen Sts
     C                     Z-ADD*ZERO     ZA0066           Pen Drive Seque
      * Retrieve message IS Message Information 01
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0730' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUL8TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Get Next Number - IS Message Log  * 
     C                     EXSR SZRVGN
      * Create IS Message Log - IS Message Log  * 
     C                     EXSR TACRRC
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * IS MESSAGE INFORMATION  Pen information to be read
      *================================================================
      * Setup message data for message
     C                     MOVEL@CN,006   ZA0067           @Action
     C                     Z-ADDWN0003    ZA0068           BOH Buy Order N
     C                     Z-ADDWN0004    ZA0069           BOL Load Number
     C                     Z-ADDWN0005    ZA0070           TH Tattoo Numbe
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  WN0006    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0071
     C                     Z-ADD*ZERO     ZA0072           TD Sequence Num
     C                     Z-ADDWN0009    ZA0073           TD Pen Head
     C                     Z-ADD#1B6CD    ZA0074           Pen Current Dri
     C                     Z-ADD#1HVNB    ZA0075           Pen Company Num
     C                     MOVEL#1CMCD    ZA0076           Pen Number
     C                     MOVELWUDGST    ZA0077           Pen Sts
     C                     Z-ADD*ZERO     ZA0078           Pen Drive Seque
      * Retrieve message IS Message Information 01
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0730' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUL8TX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Get Next Number - IS Message Log  * 
     C                     EXSR TCRVGN
      * Create IS Message Log - IS Message Log  * 
     C                     EXSR TDCRRC
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * HISTORY
      *================================================================
      * H16749 SLM 08/19/2020 Replace Job Date w/System Date
      * on the tattloo detail
      * E13964 JJH 10/23/18 - Edit Drive Card
      * - Do not allow Option 9=Edit Drive Card if User Application
      *   Profile is assigned Application Code = NDRVCD (Do not allow Edi
      *   Drive Card)
      * E0000 SLM 10/24/2018 *NEVER GOT INSTALL INTO PRODUCTION     N
      * E0000 SLM 10/24/2018 *REMOVE THE FOLLOWING CHANGES FOR 5/14
      * E0000 SLM 05/10/2014  MULTIPLE USERS ARE ON AT THE SAME TIME,
      * This was causing issues with the drive card number on the Pen
      * like the drive card # does not match the drive card on the tattoo
      * detail
      * Solultion: Jancie G, will speak with the group
      * and we will verify the drive card from the pen to the
      * drive card in the tattoo detail
      * if different then update the drive card from the TD into the Pen
      * and only 1 drive card number from the tattoo detail is allowed
      * if we more drive card #'s then we leave all alone
      * H16853 ISE 11/02/20 - Increased the Buy Order Number field
      *  from 5 to 7.
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD13        ZHSTRW  40
     C                     Z-ADD20        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           ZHCSRW    IFEQ 012
     C           ZHCSCL    ANDEQ065
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#2AJST'  YPMTFD           RS Record Statu
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM 'PKGCDFRH'W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Reclaim resources of called programs
     C                     CALL 'Y2RCRSC'
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1HVNB           Pen Company Num
     C                     MOVEL*BLANK    P1CMCD           Pen Number
     C                     MOVEL*BLANK    P1BBTX           Pen Description
     C                     Z-ADD*ZERO     P1CTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     P1D6NB           Pen Current Hea
     C                     Z-ADD*ZERO     P1B6CD           Pen Current Dri
     C                     Z-ADD*ZERO     P1EBNB           Pen Drive Seque
     C                     Z-ADD*ZERO     P2EDNB           Head Held Over
     C                     MOVEL*BLANK    P3ETTX           PRT Description
     C                     MOVEL*BLANK    P3ACVN           PRT Printer Dev
     C                     MOVEL*BLANK    P3AKST           PRT Hold Output
     C                     MOVEL*BLANK    P3AMST           PRT Save Output
     C                     Z-ADD*ZERO     P3AKNB           PRT Copies
     C                     MOVEL*BLANK    P3ALST           PRT Night Queue
     C                     MOVEL*BLANK    P3AIVN           PRT Night Queue
     C                     MOVEL*BLANK    P3C7CD           Oms Application
     C                     MOVEL*BLANK    P4J8NB           Oms Warehouse C
     C                     Z-ADD*ZERO     P4HONB           CC Company Numb
     C                     MOVEL*BLANK    P4C8CD           Oms SalesPerson
     C                     MOVEL*BLANK    P4G8ST           Oms Allow Multi
     C                     MOVEL*BLANK    P4G9ST           Oms Default Pri
     C                     MOVEL*BLANK    P4EUTX           Oms Name
     C                     MOVEL*BLANK    P4EVTX           Oms System Valu
     C                     MOVEL*BLANK    P4HAST           Oms Access Deni
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field First Time Flag Usr
     C                     MOVEL*BLANK    WUHBST  1
      * Define work field Blank USR
     C                     MOVEL*BLANK    WUCRTX 80
      * Define work field Pen Company Number
     C                     Z-ADD*ZERO     WUHVNB  30
      * Define work field Display Print Prompt  Usr
     C                     MOVEL*BLANK    WUHJST  1
      * Define work field Invalid Y/N USR
     C                     MOVEL*BLANK    WUG3ST  1
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Tattoo 1              USR
     C                     MOVEL*BLANK    WUTT1U  4
      * Define work field Tattoo 2              USR
     C                     MOVEL*BLANK    WUTT2U  4
      * Define work field Tattoo 3              USR
     C                     MOVEL*BLANK    WUTT3U  4
      * Define work field Tattoo 4              USR
     C                     MOVEL*BLANK    WUTT4U  4
      * Define work field tattoo 5              USR
     C                     MOVEL*BLANK    WUNJNB  4
      * Define work field @Status +/-
     C                     MOVEL*BLANK    WUI8ST  1
      * Define work field Count USR
     C                     Z-ADD*ZERO     WUP0NB  30
      * Define work field Tattoo Nbr 4          USR
     C                     Z-ADD*ZERO     WUMLNB  40
      * Define work field TH Shift Held Over
     C                     MOVEL*BLANK    WULJST  1
      * Define work field TH Shift Held Over Head
     C                     Z-ADD*ZERO     WUT2HD  50
      * Define work field #Num USR
     C                     Z-ADD*ZERO     WUH5NB  10
      * Define work field Record Found USR
     C                     MOVEL*BLANK    WUH7ST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WAC2NB           TD Sequence Num
     C                     Z-ADD*ZERO     WACZNB           TD Live Wgt
     C                     Z-ADD*ZERO     WAC0NB           TD Pen Head
     C                     Z-ADD*ZERO     WAD8NB           TD Yard Dead
     C                     Z-ADD*ZERO     WAH7NB           TD Held Over
     C                     Z-ADD*ZERO     WAAJTM           TD Drive Time
     C                     Z-ADD*ZERO     WAJEA1           TD Drive Hour
     C                     Z-ADD*ZERO     WAB7CD           TD Drive Card N
     C                     Z-ADD*ZERO     WAD7NB           TD Avg Live Wgt
     C                     Z-ADD*ZERO     WABVDT           TD User Date 1
     C                     Z-ADD*ZERO     WABWDT           TD User Date 2
     C                     Z-ADD*ZERO     WABXDT           TD Drive Date
     C                     Z-ADD*ZERO     WAHVNB           Pen Company Num
     C                     Z-ADD*ZERO     WAH8NB           Held Over Pen C
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field Is Message
     C                     MOVEL*BLANK    WUL8TX 70
      * Define work field Pen Sts
     C                     MOVEL*BLANK    WUDGST  1
      * Define work field Is Message Log Number
     C                     Z-ADD*ZERO     WULMNO  50
      * Define work field RS Record Status
     C                     MOVEL*BLANK    WUAJST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBLMNO           Is Message Log
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Define work field TDP Process Code
     C                     MOVEL*BLANK    WUB9CD  6
      * Define work field Td Pen Head Org Usr
     C                     Z-ADD*ZERO     WUXYNB  50
      * Define work field td Pen Head Wgt Org Usr
     C                     Z-ADD*ZERO     WUXZNB  71
      * Define work field TD Live Wgt
     C                     Z-ADD*ZERO     WUCZNB  71
      * Define work field Head Held Over Usr
     C                     Z-ADD*ZERO     WUEDNB  50
      * Define work field Net Head Usr
     C                     Z-ADD*ZERO     WUF6NB  50
      * Define work field TD Held Over Status
     C                     MOVEL*BLANK    WUGGST  1
      * Define work field TD Pen Head
     C                     Z-ADD*ZERO     WUC0NB  50
      * Define work field Date USR
     C                     Z-ADD*ZERO     WUB5DT  70
      * Define work field Yard Dead             USR
     C                     Z-ADD*ZERO     WUWHNB  50
      * Define work field Held Over Pen Co      USR
     C                     Z-ADD*ZERO     WUWGNB  30
      * Define work field Held Over Pen Nbr     USR
     C                     MOVEL*BLANK    WUFECD  3
      * Define work field Next Kill Date
     C                     Z-ADD*ZERO     WUB2DT  70
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEHVNB           Pen Company Num
     C                     Z-ADD*ZERO     WECTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WED6NB           Pen Current Hea
     C                     Z-ADD*ZERO     WEB6CD           Pen Current Dri
     C                     Z-ADD*ZERO     WEEBNB           Pen Drive Seque
     C                     Z-ADD*ZERO     WEHBNB           Pen Adjustment
     C                     Z-ADD*ZERO     WEAADT           RS Date Changed
     C                     Z-ADD*ZERO     WEAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WEABDT           RS Date Added
     C                     Z-ADD*ZERO     WEABTM           RS Time Added
      * Define work field Pen Description
     C                     MOVEL*BLANK    WUBBTX 25
      * Define work field GN Genetic Code
     C                     MOVEL*BLANK    WUAGCD  5
      * Define work field Pen Current Head
     C                     Z-ADD*ZERO     WUD6NB  50
      * Define work field Genetic Code USR
     C                     MOVEL*BLANK    WUA1CD  5
      * Define work field Pen Desc              USR
     C                     MOVEL*BLANK    WUJTTX 25
      * Define work field KP Head Hold Over
     C                     Z-ADD*ZERO     WUCBNB  50
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGHTNB           KP Company Numb
     C                     Z-ADD*ZERO     WGADDT           KP Kill/Cut Dat
     C                     Z-ADD*ZERO     WGA0NB           KP Planned Kill
     C                     Z-ADD*ZERO     WGCBNB           KP Head Hold Ov
     C                     Z-ADD*ZERO     WGX2NB           KP Cut Avg Cold
     C                     Z-ADD*ZERO     WGX3NB           KP Planned Cut
     C                     Z-ADD*ZERO     WGAADT           RS Date Changed
     C                     Z-ADD*ZERO     WGAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WGABDT           RS Date Added
     C                     Z-ADD*ZERO     WGABTM           RS Time Added
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WJ01 150       *Synon (15,0) w
     C                     Z-ADD*ZEROS    W0WJ00 150       *Synon (15,0) w
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Return Code USR
     C                     MOVEL*BLANK    YL0001  7
      * Define local work field TD Drive Date
     C                     Z-ADD*ZERO     YL0002  70
      * Define local work field TD Drive Time
     C                     Z-ADD*ZERO     YL0003  60
      * Define local work field TD Drive Hour
     C                     Z-ADD*ZERO     YL0004  20
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD08        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * HISTORY
     C                     EXSR UGSUBR                     HISTORY
      * Val Application/User  IF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           P4J8NB    PARM *BLANK    WQ0040  3        Oms Warehouse C
     C           WUHVNB    PARM *ZERO     WQ0041  30       CC Company Numb
     C                     PARM 'HPE'     WQ0042  6        Oms Application
     C           P4C8CD    PARM *BLANK    WQ0043  3        Oms SalesPerson
     C           P4G8ST    PARM *BLANK    WQ0044  1        Oms Allow Multi
     C           P4G9ST    PARM *BLANK    WQ0045 10        Oms Default Pri
     C           P4EUTX    PARM *BLANK    WQ0046 30        Oms Name
     C           P4EVTX    PARM *BLANK    WQ0047 40        Oms System Valu
     C           P4HAST    PARM *BLANK    WQ0048  1        Oms Access Deni
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P4HAST    IFEQ 'Y'                        *IF
      * Send message 'Access Denied for User'
     C                     MOVEL'PRK0298' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP4EVTX    ##CMP
     C                     END                             *FI
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P4HAST    IFEQ 'Y'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Not Spread
00002 Print Drive Card List
00003 TD Parms
00004 TD read
00005 TD Updated
00006 Pen Parms
