     H/TITLE Exc Bld WF A/R Header XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 06/29/21  Time  : 15:42:19
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAEOREL2IF  E           K        DISK
      * RTV : Company Customer          Active Records         N
      *
     FARBDCPL6IF  E           K        DISK
      * RSQ : A/R Header                Co/Customer AR        V
      *
     FPMADCPL1IF  E           K        DISK
      * RTV : A/R Aging Control         Retrieval index
      *
     FPUB5CPL0IF  E           K        DISK                      A
      * UPD : WF A/R Header             Update index
      *
     E                    YDOW        7  1               *Days of week
     I@EOREUB
      * Company Customer          Active Records         N
      * Renamed input format fields
     I              EOAIC3                          WAAIC3
     I              EOBKC7                          WABKC7
     I              EOAQCD                          WAAQCD
     I              EOR4CD                          WAR4CD
     I              EOBYNA                          WABYNA
     I              EOB6NA                          WAB6NA
     I              EOBZNA                          WABZNA
     I              EOLLST                          WALLST
     I              EOPPST                          WAPPST
     I              EOR5NB                          WAR5NB
     I              EOR6NB                          WAR6NB
     I              EOQGST                          WAQGST
     I              EOBOCD                          WABOCD
     I              EOTBNB                          WATBNB
     I              EOMTCU                          WAMTCU
     I              EOW2NB                          WAW2NB
     I              EORPCD                          WARPCD
     I              EOAJCD                          WAAJCD
     I              EOX9ST                          WAX9ST
     I              EOT9CD                          WAT9CD
     I              EOUBCD                          WAUBCD
     I              EOISTX                          WAISTX
     I              EOLQCD                          WALQCD
     I              EONJNA                          WANJNA
     I              EOI0TX                          WAI0TX
     I              EONKNA                          WANKNA
     I              EOI1TX                          WAI1TX
     I              EOVLST                          WAVLST
     I              EORLST                          WARLST
     I              EOMMTX                          WAMMTX
     I              EOOHNA                          WAOHNA
     I              EOQ6ST                          WAQ6ST
     I              EOQ8ST                          WAQ8ST
     I              EORBST                          WARBST
     I              EOREST                          WAREST
     I              EOUVST                          WAUVST
     I              EOUWST                          WAUWST
     I              EOUXST                          WAUXST
     I              EOVSST                          WAVSST
     I              EOAATM                          WAAATM
     I              EOAYNA                          WAAYNA
     I              EOA0NA                          WAA0NA
     I              EOAXDT                          WAAXDT
      *
     I@BDCPGB
      * A/R Header                Co/Customer AR        V
      * Renamed input format fields
     I              BDAIC3                          WBAIC3
     I              BDCONB                          WBCONB
     I              BDCEST                          WBCEST
     I              BDUHCD                          WBUHCD
     I              BDBSVA                          WBBSVA
     I              BDAIVA                          WBAIVA
     I              BDAOVA                          WBAOVA
     I              BDBGVA                          WBBGVA
     I              BDAJST                          WBAJST
     I              BDE3ST                          WBE3ST
     I              BDG4CD                          WBG4CD
     I              BDCKNB                          WBCKNB
     I              BDCAC7                          WBCAC7
     I              BDBKC7                          WBBKC7
     I              BDBCCD                          WBBCCD
     I              BDR4CD                          WBR4CD
     I              BDB4DT                          WBB4DT
     I              BDATDT                          WBATDT
     I              BDH0DT                          WBH0DT
     I              BDH3DT                          WBH3DT
     I              BDH4DT                          WBH4DT
     I              BDH5DT                          WBH5DT
     I              BDANC7                          WBANC7
     I              BDCPTX                          WBCPTX
     I              BDBSDY                          WBBSDY
     I              BDUVST                          WBUVST
     I              BDUWST                          WBUWST
     I              BDUXST                          WBUXST
     I              BDAATM                          WBAATM
     I              BDAYNA                          WBAYNA
     I              BDA0NA                          WBA0NA
     I              BDAXDT                          WBAXDT
      *
     I@ADCPHM
      * A/R Aging Control         Retrieval index
      * Renamed input format fields
     I              ADG8AA                          WCG8AA
     I              ADAEDY                          WCAEDY
     I              ADAFDY                          WCAFDY
     I              ADAGDY                          WCAGDY
     I              ADAHDY                          WCAHDY
     I              ADEUST                          WCEUST
     I              ADA1TX                          WCA1TX
     I              ADUNUS                          WCUNUS
     I              ADUNU2                          WCUNU2
     I              ADUNU3                          WCUNU3
     I              ADFHNY                          WCFHNY
     I              ADQSDT                          WCQSDT
     I              ADQRDT                          WCQRDT
     I              ADI3T1                          WCI3T1
     I              ADVSST                          WCVSST
     I              ADMJDT                          WCMJDT
     I              ADBETM                          WCBETM
     I              ADCCVN                          WCCCVN
     I              ADCDVN                          WCCDVN
     I              ADMKDT                          WCMKDT
     I              ADBFTM                          WCBFTM
     I              ADCEVN                          WCCEVN
     I              ADCFVN                          WCCFVN
      *
     I@B5CPHZ
      * WF A/R Header             Update index
      * Renamed input format fields
     I              B5AIC3                          WDAIC3
     I              B5ANC7                          WDANC7
     I              B5BOCD                          WDBOCD
     I              B5VSST                          WDVSST
     I              B5BGVA                          WDBGVA
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPUB51    E DSPUB5CPL0
      * UPD : WF A/R Header             Update index
      * Renamed input format fields
     I              B5AIC3                          WDAIC3
     I              B5ANC7                          WDANC7
     I              B5BOCD                          WDBOCD
     I              B5VSST                          WDVSST
     I              B5BGVA                          WDBGVA
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Company Number CDE
     I                                    P   1   20P1ATNB
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1ATNB    PARM           WP0001  30       Company Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Bld WF A/R Header XF
      * Exc Bld WF A/R Header RT - Company Customer  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         NASUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         NAEXIT    ENDSR
      /EJECT
     CSR         NBSUBR    BEGSR
      *================================================================
      * Load Output Parameters.
      *================================================================
     C                     Z-ADDWN0013    WN0002           Age $ Due - Cur
     C                     Z-ADDWN0014    WN0003           Age $ Due - Agi
     C                     Z-ADDWN0015    WN0004           Age $ Due - Agi
     C                     Z-ADDWN0016    WN0005           Age $ Due - Agi
     C                     Z-ADDWN0017    WN0006           Age $ Due - Agi
     C                     Z-ADDWN0019    WN0007           Age $ Due - Agi
     C                     Z-ADDWN0031    YN0008           Age $ Due-Curre
     C                     Z-ADDWN0026    YN0009           Age $ Due-Aging
     C                     Z-ADDWN0027    YN0010           Age $ Due-Aging
     C                     Z-ADDWN0028    YN0011           Age $ Due-Aging
     C                     Z-ADDWN0029    YN0012           Age $ Due-Aging
     C                     Z-ADDWN0030    YN0013           Age $ Due-Aging
      *================================================================
     CSR         NBEXIT    ENDSR
      /EJECT
     CSR         NCSUBR    BEGSR
      *================================================================
      * Initialize Neither Parameters.
      *================================================================
     C                     Z-ADD*ZERO     WN0062           USR Age Current
     C                     Z-ADD*ZERO     WN0057           USR Age Value 1
     C                     Z-ADD*ZERO     WN0058           USR Age Value 2
     C                     Z-ADD*ZERO     WN0059           USR Age Value 3
     C                     Z-ADD*ZERO     WN0060           USR Age Value 4
     C                     Z-ADD*ZERO     WN0061           USR Age Value 5
     C                     Z-ADD*ZERO     WN0049           USR Age Current
     C                     Z-ADD*ZERO     WN0039           USR Age Value 1
     C                     Z-ADD*ZERO     WN0040           USR Age Value 2
     C                     Z-ADD*ZERO     WN0041           USR Age Value 3
     C                     Z-ADD*ZERO     WN0042           USR Age Value 4
     C                     Z-ADD*ZERO     WN0043           USR Age Value 5
     C                     Z-ADD*ZERO     WN0044           USR Age Current
     C                     Z-ADD*ZERO     WN0045           USR Age Value 1
     C                     Z-ADD*ZERO     WN0046           USR Age Value 2
     C                     Z-ADD*ZERO     WN0047           USR Age Value 3
     C                     Z-ADD*ZERO     WN0048           USR Age Value 4
     C                     Z-ADD*ZERO     WN0050           USR Age Value 5
     C                     Z-ADD*ZERO     WN0069           USR Total Credi
      *================================================================
     CSR         NCEXIT    ENDSR
      /EJECT
     CSR         NDSUBR    BEGSR
      *================================================================
      * Retrieve Aging Ranges.
      *================================================================
      * ** A/R aging info is now in a file - retrieve from there  12/01/0
      * RTV A/R Aging Control  RT - A/R Aging Control  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELYL0004    WL0009    P      A/R Aging Code
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0010    WN0063           A/R Aging Days
     C                     Z-ADDWL0011    WN0064           A/R Aging Days
     C                     Z-ADDWL0012    WN0065           A/R Aging Days
     C                     Z-ADDWL0013    WN0066           A/R Aging Days
     C                     MOVELWL0014    WUEUST    P      Age by Trans or
     C                     MOVELWL0015    WUA1TX    P      Default Y/N
     C                     MOVELWL0016    WUVSST    P      Record Status
      *================================================================
     CSR         NDEXIT    ENDSR
      /EJECT
     CSR         NESUBR    BEGSR
      *================================================================
      * Sum A/R Cust Invoices with a Remaining Bal.(IN,DM)(CB)(CM,OA)
      *================================================================
      * PAR.Days Past Due  USR = JOB.*Job date - PAR.Due Date *DAYS
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C           WBATDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
      * Negative duration, when date1<date2
     C           XDAY1     IFGE XDAY2
     C                     Z-ADDXDURR     WN0068
     C                     ELSE
     C           XDURR     MULT -1        WN0068
     C                     END
      * CASE: PAR.Days Past Due  USR is <= Zero
     C           WN0068    IFLE 0                          *IF
      * Current.
     C                     EXSR NFSUBR                     Current.
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 1
     C           WN0068    IFLE WN0063                     *IF
      * Past Due Period 1.
     C                     EXSR NJSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 2
     C           WN0068    IFLE WN0064                     *IF
      * Past Due Period 2.
     C                     EXSR NNSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 3
     C           WN0068    IFLE WN0065                     *IF
      * Past Due Period 3.
     C                     EXSR NRSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 4
     C           WN0068    IFLE WN0066                     *IF
      * Past Due Period 4.
     C                     EXSR NVSUBR                     Past Due Period
     C                     ELSE
      * CASE: *OTHERWISE
      * Past Due Period 5.
     C                     EXSR NZSUBR                     Past Due Period
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NEEXIT    ENDSR
      /EJECT
     CSR         NFSUBR    BEGSR
      *================================================================
      * Current.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR NGSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR NHSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NISUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NFEXIT    ENDSR
      /EJECT
     CSR         NGSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0049           Aging - CB    A
     C                     ADD  WBBGVA    WN0044           Aging - IN/DM/C
      *================================================================
     CSR         NGEXIT    ENDSR
      /EJECT
     CSR         NHSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0062           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0044           Aging - IN/DM/C
      *================================================================
     CSR         NHEXIT    ENDSR
      /EJECT
     CSR         NISUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         NIEXIT    ENDSR
      /EJECT
     CSR         NJSUBR    BEGSR
      *================================================================
      * Past Due Period 1.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR NKSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR NLSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NMSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NJEXIT    ENDSR
      /EJECT
     CSR         NKSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0039           Aging - CB    A
     C                     ADD  WBBGVA    WN0045           Aging - IN/DM/C
      *================================================================
     CSR         NKEXIT    ENDSR
      /EJECT
     CSR         NLSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0057           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0045           Aging - IN/DM/C
      *================================================================
     CSR         NLEXIT    ENDSR
      /EJECT
     CSR         NMSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         NMEXIT    ENDSR
      /EJECT
     CSR         NNSUBR    BEGSR
      *================================================================
      * Past Due Period 2.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR NOSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR NPSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NQSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NNEXIT    ENDSR
      /EJECT
     CSR         NOSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0040           Aging - CB    A
     C                     ADD  WBBGVA    WN0046           Aging - IN/DM/C
      *================================================================
     CSR         NOEXIT    ENDSR
      /EJECT
     CSR         NPSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0058           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0046           Aging - IN/DM/C
      *================================================================
     CSR         NPEXIT    ENDSR
      /EJECT
     CSR         NQSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         NQEXIT    ENDSR
      /EJECT
     CSR         NRSUBR    BEGSR
      *================================================================
      * Past Due Period 3.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR NSSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR NTSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NUSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NREXIT    ENDSR
      /EJECT
     CSR         NSSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0041           Aging - CB    A
     C                     ADD  WBBGVA    WN0047           Aging - IN/DM/C
      *================================================================
     CSR         NSEXIT    ENDSR
      /EJECT
     CSR         NTSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0059           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0047           Aging - IN/DM/C
      *================================================================
     CSR         NTEXIT    ENDSR
      /EJECT
     CSR         NUSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         NUEXIT    ENDSR
      /EJECT
     CSR         NVSUBR    BEGSR
      *================================================================
      * Past Due Period 4.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR NWSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR NXSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NYSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NVEXIT    ENDSR
      /EJECT
     CSR         NWSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0042           Aging - CB    A
     C                     ADD  WBBGVA    WN0048           Aging - IN/DM/C
      *================================================================
     CSR         NWEXIT    ENDSR
      /EJECT
     CSR         NXSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0060           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0048           Aging - IN/DM/C
      *================================================================
     CSR         NXEXIT    ENDSR
      /EJECT
     CSR         NYSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         NYEXIT    ENDSR
      /EJECT
     CSR         NZSUBR    BEGSR
      *================================================================
      * Past Due Period 5.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR OASUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR OBSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR OCSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NZEXIT    ENDSR
      /EJECT
     CSR         OASUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0043           Aging - CB    A
     C                     ADD  WBBGVA    WN0050           Aging - IN/DM/C
      *================================================================
     CSR         OAEXIT    ENDSR
      /EJECT
     CSR         OBSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0061           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0050           Aging - IN/DM/C
      *================================================================
     CSR         OBEXIT    ENDSR
      /EJECT
     CSR         OCSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0069           Aging - CM/OA A
      *================================================================
     CSR         OCEXIT    ENDSR
      /EJECT
     CSR         ODSUBR    BEGSR
      *================================================================
      * Load Output Parameters.
      *================================================================
     C                     Z-ADDWN0044    WN0002           Age $ Due - Cur
     C                     Z-ADDWN0045    WN0003           Age $ Due - Agi
     C                     Z-ADDWN0046    WN0004           Age $ Due - Agi
     C                     Z-ADDWN0047    WN0005           Age $ Due - Agi
     C                     Z-ADDWN0048    WN0006           Age $ Due - Agi
     C                     Z-ADDWN0050    WN0007           Age $ Due - Agi
     C                     Z-ADDWN0062    YN0008           Age $ Due-Curre
     C                     Z-ADDWN0057    YN0009           Age $ Due-Aging
     C                     Z-ADDWN0058    YN0010           Age $ Due-Aging
     C                     Z-ADDWN0059    YN0011           Age $ Due-Aging
     C                     Z-ADDWN0060    YN0012           Age $ Due-Aging
     C                     Z-ADDWN0061    YN0013           Age $ Due-Aging
      *================================================================
     CSR         ODEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Exc Bld WF A/R Header RT - Company Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAIC3    WQSA01           Company Number
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Company Number
      * Setup key
     C                     Z-ADDP1ATNB    WQSA01           Company Number
      * Establish starting position
     C           KRSSA     SETLL@EOREUB                    *
     C           KRSSA     READE@EOREUB                  90*
      * Data record not found
     C   90                MOVEL'USR1007' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.Type Code is Inter Company
      *   |- c2    : DB1.Type Code is Inter-Comp Sales Agreemnt
      *   '-
     C           WABOCD    IFEQ 'IC'                       *IF
     C           WABOCD    OREQ 'IS'                       *OR
      * Exc Bld WF A/R Header RT - A/R Header  * 
     C                     EXSR SBRVGN
     C                     END                             *FI
     C           KRSSA     READE@EOREUB                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Exc Bld WF A/R Header RT - A/R Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001 112       Remaining Balan
     C                     Z-ADD*ZERO     WN0002 112       Age $ Due - Cur
     C                     Z-ADD*ZERO     WN0003 112       Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0004 112       Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0005 112       Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0006 112       Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0007 112       Age $ Due - Agi
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y'       YL0001           First Time Flag
     C                     MOVEL'N'       YL0002           Record Processe
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBANC7    WQSB02           A/R Customer Nu
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           A/R Customer Nu
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWABKC7    WQSB02           A/R Customer Nu
      * Establish starting position
     C           KRSSB     SETLL@BDCPGB                    *
     C           KRSSB     READE@BDCPGB                  90*
      * Data record not found
     C   90                MOVEL'USR0174' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * First Time Processing.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.First Time Flag is Yes
      *   |- c2    : DB1.Remaining Balance Due is not equal to zeros
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ 'Y'                        *IF
     C           WBBGVA    IFNE 0                          *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       YL0001           First Time Flag
     C                     MOVEL'Y'       YL0002           Record Processe
     C                     Z-ADDWBANC7    YL0003           A/R Customer Nu
      * RTV Default Aging Code RT - A/R Aging Control  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELYL0004    WL0001    P      A/R Aging Code
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0001    YL0004    P      A/R Aging Code
     C                     Z-ADDWL0002    YN0001           A/R Aging Days
     C                     Z-ADDWL0003    YN0002           A/R Aging Days
     C                     Z-ADDWL0004    YN0003           A/R Aging Days
     C                     Z-ADDWL0005    YN0004           A/R Aging Days
     C                     MOVELWL0006    YN0005    P      Age by Trans or
     C                     MOVELWL0007    YN0006    P      Default Y/N
     C                     MOVELWL0008    YN0007    P      Record Status
     C                     END                             *FI
      * Break By A/R Customer Number
      * CASE: DB1.Remaining Balance Due is not equal to zeros
     C           WBBGVA    IFNE 0                          *IF
      * CASE: DB1.A/R Customer Number EQ LCL.A/R Customer Number
     C           WBANC7    IFEQ YL0003                     *IF
      * SUM Total Balance Due for All Account Types: OA, IN, CM, DM, RB,
      * CASE: DB1.Invoice Suffix is CM or OA
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'
     C                     SUB  WBBGVA    WN0001           Remaining Balan
     C                     ELSE
      * CASE: *OTHERWISE
      *
     C                     Z-ADD*ZERO     WN0008 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0009 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0010 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0011 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0012 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0013 112       USR Age Current
     C                     Z-ADD*ZERO     WN0014 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0015 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0016 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0017 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0018 112       USR Age Current
     C                     Z-ADD*ZERO     WN0019 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0020  70       USR Aging date
     C                     Z-ADD*ZERO     WN0021  70       USR Aging date
     C                     Z-ADD*ZERO     WN0022  70       USR Aging date
     C                     Z-ADD*ZERO     WN0023  70       USR Aging date
     C                     Z-ADD*ZERO     WN0024  70       USR Aging date
     C                     Z-ADD*ZERO     WN0025  70       USR Aging Date
     C                     Z-ADD*ZERO     WN0026 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0027 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0028 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0029 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0030 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0031 112       USR Age Current
     C                     Z-ADD*ZERO     WN0032  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0033  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0034  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0035  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0036 112       Save Total Cred
     C                     Z-ADD*ZERO     WN0037  50       Days Past Due
     C                     Z-ADD*ZERO     WN0038 112       USR Total Credi
      *
      * CLC Age Cust Inv.      IF
      * Initialize Neither Parameters.
     C                     EXSR UASUBR                     Initialize Neit
      * Retrieve Aging Ranges.
     C                     EXSR UBSUBR                     Retrieve Aging
      * CASE: PAR.Remaining Balance Due is not equal to zeros
     C           WBBGVA    IFNE 0                          *IF
      * Sum A/R Cust Invoices with a Remaining Bal.(IN,DM)(CB)(CM,OA)
     C                     EXSR UCSUBR                     Sum A/R Cust In
     C                     END                             *FI
      * Load Output Parameters.
     C                     EXSR NBSUBR                     Load Output Par
      * ***** Change Log and Comments
      * ** 12/01/2006 LJB PK0039
      * ** A/R aging info is now in a file - retrieve from there
      * *****
      * SUM Total Balance Due
      * PAR.Remaining Balance Due =
      *    *COMPUTE (x1 + x2 + x3 + x4 + x5 + x6 + x7)
      * x1    : PAR.Remaining Balance Due
      * +     : PGM.*Synon (17,7) work field
      * x2    : PAR.Age $ Due - Current - CB
      * +     : PGM.*Synon (17,7) work field
      * x3    : PAR.Age $ Due - Aging 1 - CB
      * +     : PGM.*Synon (17,7) work field
      * x4    : PAR.Age $ Due - Aging 2 - CB
      * +     : PGM.*Synon (17,7) work field
      * x5    : PAR.Age $ Due - Aging 3 - CB
      * +     : PGM.*Synon (17,7) work field
      * x6    : PAR.Age $ Due - Aging 4 - CB
      * +     : PGM.*Synon (17,7) work field
      * x7    : PAR.Age $ Due - Aging 5 - CB
     C           WN0001    ADD  WN0002    W0WD05           *Synon (17,7) w
     C           W0WD05    ADD  WN0003    W0WD04           *Synon (17,7) w
     C           W0WD04    ADD  WN0004    W0WD03           *Synon (17,7) w
     C           W0WD03    ADD  WN0005    W0WD02           *Synon (17,7) w
     C           W0WD02    ADD  WN0006    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  WN0007    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    WN0001           Remaining Balan
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Create WF A/R Header Record.
      * CASE: *OTHERWISE
      * Crt WF A/R Header     CR - WF A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWBAIC3    WL0017           Company Number
     C                     Z-ADDYL0003    WL0018           A/R Customer Nu
     C                     MOVELWABOCD    WL0019    P      Type Code
     C                     MOVELWAVSST    WL0020    P      Record Status
     C                     Z-ADDWN0001    WL0021           Remaining Balan
     C                     EXSR SECRRC
      * Reinitialize for next A/R Customer Number.
      * CASE: *OTHERWISE
      * NOTE: Any changes in here, must change in 'Exit Processing' also.
     C                     Z-ADDWBANC7    YL0003           A/R Customer Nu
      * RTV Default Aging Code RT - A/R Aging Control  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELYL0004    WL0001    P      A/R Aging Code
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0001    YL0004    P      A/R Aging Code
     C                     Z-ADDWL0002    YN0001           A/R Aging Days
     C                     Z-ADDWL0003    YN0002           A/R Aging Days
     C                     Z-ADDWL0004    YN0003           A/R Aging Days
     C                     Z-ADDWL0005    YN0004           A/R Aging Days
     C                     MOVELWL0006    YN0005    P      Age by Trans or
     C                     MOVELWL0007    YN0006    P      Default Y/N
     C                     MOVELWL0008    YN0007    P      Record Status
      * Reset All Amount Accumulators.
     C                     Z-ADD*ZERO     WN0001           Remaining Balan
     C                     Z-ADD*ZERO     WN0002           Age $ Due - Cur
     C                     Z-ADD*ZERO     WN0003           Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0004           Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0005           Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0006           Age $ Due - Agi
     C                     Z-ADD*ZERO     WN0007           Age $ Due - Agi
      * SUM Total Balance Due for All Account Types: OA, IN, CM, DM, RB,
      * CASE: DB1.Invoice Suffix is CM or OA
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'
     C                     SUB  WBBGVA    WN0001           Remaining Balan
     C                     ELSE
      * CASE: *OTHERWISE
      *
     C                     Z-ADD*ZERO     WN0039 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0040 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0041 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0042 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0043 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0044 112       USR Age Current
     C                     Z-ADD*ZERO     WN0045 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0046 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0047 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0048 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0049 112       USR Age Current
     C                     Z-ADD*ZERO     WN0050 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0051  70       USR Aging date
     C                     Z-ADD*ZERO     WN0052  70       USR Aging date
     C                     Z-ADD*ZERO     WN0053  70       USR Aging date
     C                     Z-ADD*ZERO     WN0054  70       USR Aging date
     C                     Z-ADD*ZERO     WN0055  70       USR Aging date
     C                     Z-ADD*ZERO     WN0056  70       USR Aging Date
     C                     Z-ADD*ZERO     WN0057 112       USR Age Value 1
     C                     Z-ADD*ZERO     WN0058 112       USR Age Value 2
     C                     Z-ADD*ZERO     WN0059 112       USR Age Value 3
     C                     Z-ADD*ZERO     WN0060 112       USR Age Value 4
     C                     Z-ADD*ZERO     WN0061 112       USR Age Value 5
     C                     Z-ADD*ZERO     WN0062 112       USR Age Current
     C                     Z-ADD*ZERO     WN0063  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0064  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0065  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0066  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0067 112       Save Total Cred
     C                     Z-ADD*ZERO     WN0068  50       Days Past Due
     C                     Z-ADD*ZERO     WN0069 112       USR Total Credi
      *
      * CLC Age Cust Inv.      IF
      * Initialize Neither Parameters.
     C                     EXSR NCSUBR                     Initialize Neit
      * Retrieve Aging Ranges.
     C                     EXSR NDSUBR                     Retrieve Aging
      * CASE: PAR.Remaining Balance Due is not equal to zeros
     C           WBBGVA    IFNE 0                          *IF
      * Sum A/R Cust Invoices with a Remaining Bal.(IN,DM)(CB)(CM,OA)
     C                     EXSR NESUBR                     Sum A/R Cust In
     C                     END                             *FI
      * Load Output Parameters.
     C                     EXSR ODSUBR                     Load Output Par
      * ***** Change Log and Comments
      * ** 12/01/2006 LJB PK0039
      * ** A/R aging info is now in a file - retrieve from there
      * *****
      * SUM Total Balance Due
      * PAR.Remaining Balance Due =
      *    *COMPUTE (x1 + x2 + x3 + x4 + x5 + x6 + x7)
      * x1    : PAR.Remaining Balance Due
      * +     : PGM.*Synon (17,7) work field
      * x2    : PAR.Age $ Due - Current - CB
      * +     : PGM.*Synon (17,7) work field
      * x3    : PAR.Age $ Due - Aging 1 - CB
      * +     : PGM.*Synon (17,7) work field
      * x4    : PAR.Age $ Due - Aging 2 - CB
      * +     : PGM.*Synon (17,7) work field
      * x5    : PAR.Age $ Due - Aging 3 - CB
      * +     : PGM.*Synon (17,7) work field
      * x6    : PAR.Age $ Due - Aging 4 - CB
      * +     : PGM.*Synon (17,7) work field
      * x7    : PAR.Age $ Due - Aging 5 - CB
     C           WN0001    ADD  WN0002    W0WD05           *Synon (17,7) w
     C           W0WD05    ADD  WN0003    W0WD04           *Synon (17,7) w
     C           W0WD04    ADD  WN0004    W0WD03           *Synon (17,7) w
     C           W0WD03    ADD  WN0005    W0WD02           *Synon (17,7) w
     C           W0WD02    ADD  WN0006    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  WN0007    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    WN0001           Remaining Balan
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSB     READE@BDCPGB                  90*
     C                     ENDDO
      * USER: Exit processing
      * Last Record Processing
      * CASE: LCL.Record Processed Usr is Yes
     C           YL0002    IFEQ 'Y'                        *IF
      * Create WF A/R Header Record.
      * CASE: *OTHERWISE
      * Crt WF A/R Header     CR - WF A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWBAIC3    WL0017           Company Number
     C                     Z-ADDYL0003    WL0018           A/R Customer Nu
     C                     MOVELWABOCD    WL0019    P      Type Code
     C                     MOVELWAVSST    WL0020    P      Record Status
     C                     Z-ADDWN0001    WL0021           Remaining Balan
     C                     EXSR SECRRC
     C                     END                             *FI
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Default Aging Code RT - A/R Aging Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL*BLANK    WL0001           A/R Aging Code
      * Establish starting position
     C           *LOVAL    SETLL@ADCPHM                    *
     C                     READ @ADCPHM                  90*
      * Data record not found
     C   90                MOVEL'USR3661' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELWCG8AA    WL0001           A/R Aging Code
      * CASE: DB1.Default Y/N is yes
     C           WCA1TX    IFEQ 'Y'                        *IF
      * PAR = DB1 By name
     C                     MOVELWCG8AA    WL0001           A/R Aging Code
     C                     Z-ADDWCAEDY    WL0002           A/R Aging Days
     C                     Z-ADDWCAFDY    WL0003           A/R Aging Days
     C                     Z-ADDWCAGDY    WL0004           A/R Aging Days
     C                     Z-ADDWCAHDY    WL0005           A/R Aging Days
     C                     MOVELWCEUST    WL0006           Age by Trans or
     C                     MOVELWCA1TX    WL0007           Default Y/N
     C                     MOVELWCVSST    WL0008           Record Status
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C                     READ @ADCPHM                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV A/R Aging Control  RT - A/R Aging Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WCG8AA           A/R Aging Code
      * Setup key
     C                     MOVELWL0009    WCG8AA           A/R Aging Code
      * Establish starting position
     C           KRSSD     CHAIN@ADCPHM              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3661' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WL0010           A/R Aging Days
     C                     Z-ADD*ZERO     WL0011           A/R Aging Days
     C                     Z-ADD*ZERO     WL0012           A/R Aging Days
     C                     Z-ADD*ZERO     WL0013           A/R Aging Days
     C                     MOVEL*BLANK    WL0014           Age by Trans or
     C                     MOVEL*BLANK    WL0015           Default Y/N
     C                     MOVEL*BLANK    WL0016           Record Status
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWCAEDY    WL0010           A/R Aging Days
     C                     Z-ADDWCAFDY    WL0011           A/R Aging Days
     C                     Z-ADDWCAGDY    WL0012           A/R Aging Days
     C                     Z-ADDWCAHDY    WL0013           A/R Aging Days
     C                     MOVELWCEUST    WL0014           Age by Trans or
     C                     MOVELWCA1TX    WL0015           Default Y/N
     C                     MOVELWCVSST    WL0016           Record Status
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt WF A/R Header     CR - WF A/R Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @B5CPHZ
     C                     Z-ADDWL0017    WDAIC3           Company Number
     C                     Z-ADDWL0018    WDANC7           A/R Customer Nu
     C                     MOVELWL0019    WDBOCD           Type Code
     C                     MOVELWL0020    WDVSST           Record Status
     C                     Z-ADDWL0021    WDBGVA           Remaining Balan
      *
     C           KLCRSE    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDANC7           A/R Customer Nu
      * Check for duplicate primary key
     C           KLCRSE    SETLL@B5CPHZ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5202' W0RTN   7
      * Send message 'WF A/R Header          EX'
     C                     MOVEL'USR5202' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@B5CPHZ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Initialize Neither Parameters.
      *================================================================
     C                     Z-ADD*ZERO     WN0031           USR Age Current
     C                     Z-ADD*ZERO     WN0026           USR Age Value 1
     C                     Z-ADD*ZERO     WN0027           USR Age Value 2
     C                     Z-ADD*ZERO     WN0028           USR Age Value 3
     C                     Z-ADD*ZERO     WN0029           USR Age Value 4
     C                     Z-ADD*ZERO     WN0030           USR Age Value 5
     C                     Z-ADD*ZERO     WN0018           USR Age Current
     C                     Z-ADD*ZERO     WN0008           USR Age Value 1
     C                     Z-ADD*ZERO     WN0009           USR Age Value 2
     C                     Z-ADD*ZERO     WN0010           USR Age Value 3
     C                     Z-ADD*ZERO     WN0011           USR Age Value 4
     C                     Z-ADD*ZERO     WN0012           USR Age Value 5
     C                     Z-ADD*ZERO     WN0013           USR Age Current
     C                     Z-ADD*ZERO     WN0014           USR Age Value 1
     C                     Z-ADD*ZERO     WN0015           USR Age Value 2
     C                     Z-ADD*ZERO     WN0016           USR Age Value 3
     C                     Z-ADD*ZERO     WN0017           USR Age Value 4
     C                     Z-ADD*ZERO     WN0019           USR Age Value 5
     C                     Z-ADD*ZERO     WN0038           USR Total Credi
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Retrieve Aging Ranges.
      *================================================================
      * ** A/R aging info is now in a file - retrieve from there  12/01/0
      * RTV A/R Aging Control  RT - A/R Aging Control  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELYL0004    WL0009    P      A/R Aging Code
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0010    WN0032           A/R Aging Days
     C                     Z-ADDWL0011    WN0033           A/R Aging Days
     C                     Z-ADDWL0012    WN0034           A/R Aging Days
     C                     Z-ADDWL0013    WN0035           A/R Aging Days
     C                     MOVELWL0014    WUEUST    P      Age by Trans or
     C                     MOVELWL0015    WUA1TX    P      Default Y/N
     C                     MOVELWL0016    WUVSST    P      Record Status
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Sum A/R Cust Invoices with a Remaining Bal.(IN,DM)(CB)(CM,OA)
      *================================================================
      * PAR.Days Past Due  USR = JOB.*Job date - PAR.Due Date *DAYS
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C           WBATDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
      * Negative duration, when date1<date2
     C           XDAY1     IFGE XDAY2
     C                     Z-ADDXDURR     WN0037
     C                     ELSE
     C           XDURR     MULT -1        WN0037
     C                     END
      * CASE: PAR.Days Past Due  USR is <= Zero
     C           WN0037    IFLE 0                          *IF
      * Current.
     C                     EXSR UDSUBR                     Current.
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 1
     C           WN0037    IFLE WN0032                     *IF
      * Past Due Period 1.
     C                     EXSR UHSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 2
     C           WN0037    IFLE WN0033                     *IF
      * Past Due Period 2.
     C                     EXSR ULSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 3
     C           WN0037    IFLE WN0034                     *IF
      * Past Due Period 3.
     C                     EXSR UPSUBR                     Past Due Period
     C                     ELSE
      * CASE: PAR.Days Past Due  USR LE PAR.A/R Aging Days - 4
     C           WN0037    IFLE WN0035                     *IF
      * Past Due Period 4.
     C                     EXSR UTSUBR                     Past Due Period
     C                     ELSE
      * CASE: *OTHERWISE
      * Past Due Period 5.
     C                     EXSR UXSUBR                     Past Due Period
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Current.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UESUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR UFSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR UGSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0018           Aging - CB    A
     C                     ADD  WBBGVA    WN0013           Aging - IN/DM/C
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0031           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0013           Aging - IN/DM/C
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Past Due Period 1.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UISUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR UJSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR UKSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0008           Aging - CB    A
     C                     ADD  WBBGVA    WN0014           Aging - IN/DM/C
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0026           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0014           Aging - IN/DM/C
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Past Due Period 2.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UMSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR UNSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR UOSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0009           Aging - CB    A
     C                     ADD  WBBGVA    WN0015           Aging - IN/DM/C
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0027           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0015           Aging - IN/DM/C
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Past Due Period 3.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UQSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR URSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR USSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0010           Aging - CB    A
     C                     ADD  WBBGVA    WN0016           Aging - IN/DM/C
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0028           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0016           Aging - IN/DM/C
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         UTSUBR    BEGSR
      *================================================================
      * Past Due Period 4.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UUSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR UVSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR UWSUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UTEXIT    ENDSR
      /EJECT
     CSR         UUSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0011           Aging - CB    A
     C                     ADD  WBBGVA    WN0017           Aging - IN/DM/C
      *================================================================
     CSR         UUEXIT    ENDSR
      /EJECT
     CSR         UVSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0029           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0017           Aging - IN/DM/C
      *================================================================
     CSR         UVEXIT    ENDSR
      /EJECT
     CSR         UWSUBR    BEGSR
      *================================================================
      * Accumulate Credit to Apply.
      *================================================================
     C                     ADD  WBBGVA    WN0038           Aging - CM/OA A
      *================================================================
     CSR         UWEXIT    ENDSR
      /EJECT
     CSR         UXSUBR    BEGSR
      *================================================================
      * Past Due Period 5.
      *================================================================
      * CLC Aging Bucket       IF
      * CASE: PAR.Invoice Suffix is Charge Backs and Rebills
     C           WBCEST    IFEQ 'CB'                       *IF
     C           WBCEST    OREQ 'RB'
      * Age Chargebacks and Rebills.
     C                     EXSR UYSUBR                     Age Chargebacks
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Invoices
      *   |- c2    : PAR.Invoice Suffix is Debit Memos
      *   '-
     C           WBCEST    IFEQ 'IN'                       *IF
     C           WBCEST    OREQ 'DM'                       *OR
      * Age Invoices and Debit Memos.
     C                     EXSR UZSUBR                     Age Invoices an
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Invoice Suffix is Credit Memos
      *   |- c2    : PAR.Invoice Suffix is On Account Cash
      *   '-
     C           WBCEST    IFEQ 'CM'                       *IF
     C           WBCEST    OREQ 'OA'                       *OR
      * Accumulate Credit to Apply.
     C                     EXSR NASUBR                     Accumulate Cred
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UXEXIT    ENDSR
      /EJECT
     CSR         UYSUBR    BEGSR
      *================================================================
      * Age Chargebacks and Rebills.
      *================================================================
     C                     ADD  WBBGVA    WN0012           Aging - CB    A
     C                     ADD  WBBGVA    WN0019           Aging - IN/DM/C
      *================================================================
     CSR         UYEXIT    ENDSR
      /EJECT
     CSR         UZSUBR    BEGSR
      *================================================================
      * Age Invoices and Debit Memos.
      *================================================================
     C                     ADD  WBBGVA    WN0030           Aging - IN/DM A
     C                     ADD  WBBGVA    WN0019           Aging - IN/DM/C
      *================================================================
     CSR         UZEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAR5NB           Deliver after t
     C                     Z-ADD*ZERO     WAR6NB           Deliver before
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAMTCU           Mileage To Cust
     C                     Z-ADD*ZERO     WAW2NB           Co/Cust Overage
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBCONB           Invoice Number
     C                     Z-ADD*ZERO     WBBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WBAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WBAOVA           Amount Paid
     C                     Z-ADD*ZERO     WBBGVA           Remaining Balan
     C                     Z-ADD*ZERO     WBCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WBCAC7           Order Number Re
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WBATDT           Due Date
     C                     Z-ADD*ZERO     WBH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WBH3DT           Original Inv fo
     C                     Z-ADD*ZERO     WBH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WBH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WBANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WBBSDY           Days to Pay
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAEDY           A/R Aging Days
     C                     Z-ADD*ZERO     WCAFDY           A/R Aging Days
     C                     Z-ADD*ZERO     WCAGDY           A/R Aging Days
     C                     Z-ADD*ZERO     WCAHDY           A/R Aging Days
     C                     Z-ADD*ZERO     WCFHNY           Unused Number 1
     C                     Z-ADD*ZERO     WCQSDT           Unused Date 2
     C                     Z-ADD*ZERO     WCQRDT           Unused Date
     C                     Z-ADD*ZERO     WCMJDT           Create Date
     C                     Z-ADD*ZERO     WCBETM           Create Time
     C                     Z-ADD*ZERO     WCMKDT           Change Date
     C                     Z-ADD*ZERO     WCBFTM           Change Time
      * Define work field Age by Trans or Due Date
     C                     MOVEL*BLANK    WUEUST  1
      * Define work field Default Y/N
     C                     MOVEL*BLANK    WUA1TX  1
      * Define work field Record Status
     C                     MOVEL*BLANK    WUVSST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WDBGVA           Remaining Balan
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WD05 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD04 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD03 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD02 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD01 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SCRVGN.
     C                     MOVEL*BLANK    WL0001  6
     C                     Z-ADD*ZERO     WL0002  30
     C                     Z-ADD*ZERO     WL0003  30
     C                     Z-ADD*ZERO     WL0004  30
     C                     Z-ADD*ZERO     WL0005  30
     C                     MOVEL*BLANK    WL0006  1
     C                     MOVEL*BLANK    WL0007  1
     C                     MOVEL*BLANK    WL0008  1
      * Define local variables for subroutine SDRVGN.
     C                     MOVEL*BLANK    WL0009  6
     C                     Z-ADD*ZERO     WL0010  30
     C                     Z-ADD*ZERO     WL0011  30
     C                     Z-ADD*ZERO     WL0012  30
     C                     Z-ADD*ZERO     WL0013  30
     C                     MOVEL*BLANK    WL0014  1
     C                     MOVEL*BLANK    WL0015  1
     C                     MOVEL*BLANK    WL0016  1
      * Define local variables for subroutine SECRRC.
     C                     Z-ADD*ZERO     WL0017  30
     C                     Z-ADD*ZERO     WL0018  70
     C                     MOVEL*BLANK    WL0019  2
     C                     MOVEL*BLANK    WL0020  1
     C                     Z-ADD*ZERO     WL0021 112
      * Define local work field First Time Flag
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Record Processed Usr
     C                     MOVEL*BLANK    YL0002  1
      * Define local work field A/R Customer Number
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field A/R Aging Code
     C                     MOVEL*BLANK    YL0004  6
      * Define null work field A/R Aging Days - 1
     C                     Z-ADD*ZERO     YN0001  30
      * Define null work field A/R Aging Days - 2
     C                     Z-ADD*ZERO     YN0002  30
      * Define null work field A/R Aging Days - 3
     C                     Z-ADD*ZERO     YN0003  30
      * Define null work field A/R Aging Days - 4
     C                     Z-ADD*ZERO     YN0004  30
      * Define null work field Age by Trans or Due Date
     C                     MOVEL*BLANK    YN0005  1
      * Define null work field Default Y/N
     C                     MOVEL*BLANK    YN0006  1
      * Define null work field Record Status
     C                     MOVEL*BLANK    YN0007  1
      * Define null work field Age $ Due-Current-W/O CB
     C                     Z-ADD*ZERO     YN0008 112
      * Define null work field Age $ Due-Aging 1-W/O CB
     C                     Z-ADD*ZERO     YN0009 112
      * Define null work field Age $ Due-Aging 2-W/O CB
     C                     Z-ADD*ZERO     YN0010 112
      * Define null work field Age $ Due-Aging 3-W/O CB
     C                     Z-ADD*ZERO     YN0011 112
      * Define null work field Age $ Due-Aging 4-W/O CB
     C                     Z-ADD*ZERO     YN0012 112
      * Define null work field Age $ Due-Aging 5-W/O CB
     C                     Z-ADD*ZERO     YN0013 112
      *================================================================
     CSR         ZZEXIT    ENDSR
