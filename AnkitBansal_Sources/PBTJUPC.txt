/********************************************************************/
/*                                                                  */
/* PBTJUPC   - SBM SWEEP ORDERS TO MERCURYGATE                      */
/* SYNOPSIS  - CALL PGM TO UPDATE TMS ORDER STATUS = "S"            */
/*             THEN CALL THE EDIT POST OPEN ORDERS TO WRITE         */
/*             THE TRIGGER RECORD TO PBATCPP                        */
/*                                                                  */
/* SYSTEM    - ORDER MANAGEMENT SYSTEM                              */
/* DATE      - 10/21/2015                                           */
/* PROGRAMMER- LARA BUSER                                           */
/*                                                                  */
/* PARAMETERS:                                                      */
/*   &RETURN     - RETURN CODE                                      */
/*   &DTOUTN     - FROM SCHEDULED SHIP DATE                         */
/*   &DTINN      - THRU SCHEDULED SHIP DATE                         */
/*   &COMPN      - COMPANY NUMBER                                   */
/*   &ORDERN     - ORDER (BLANKS=ALL FOR CUSTOMER)                  */
/*   &CUSTN      - A/R CUSTOMER NUMBER                              */
/*   &UPDTYP     - UPDATE TYPE: ONLY 1 OR ALL                       */
/*   &PRCEVENT   - PRICE EVENT (=FROM SWEEP ORDERS TO MG)           */
/********************************************************************/
/*  MODIFICATIONS:                                                  */
/* ---------------------------------------------------------------- */
/*                                                                  */
/********************************************************************/
 PBTJUPC:    PGM        PARM(&RETURN &NAME &CUSTPO &LPR &DTTHRUN +
                          &DTFROMN &RDD &COMPN &CUSTN &ORDERN &WHSE +
                          &CSTTYP &STATE &UPDTYP &CITY &PRCEVENT)

/* PARMS                                                            */
             DCL        VAR(&RETURN)  TYPE(*CHAR) LEN(7)
             DCL        VAR(&STATE)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&UPDTYP)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&CUSTPO)  TYPE(*CHAR) LEN(15)
             DCL        VAR(&CITY)    TYPE(*CHAR) LEN(20)
             DCL        VAR(&RDD)     TYPE(*DEC)
             DCL        VAR(&DTTHRUN) TYPE(*DEC)
             DCL        VAR(&DTFROMN) TYPE(*DEC)
             DCL        VAR(&COMPN)   TYPE(*DEC)
             DCL        VAR(&CUSTN)   TYPE(*DEC)
             DCL        VAR(&ORDERN)  TYPE(*DEC)
             DCL        VAR(&PRCEVENT) TYPE(*CHAR) LEN(3)
             DCL        VAR(&LPR)      TYPE(*CHAR) LEN(2)
             DCL        VAR(&NAME)     TYPE(*CHAR) LEN(30)
             DCL        VAR(&WHSE)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&CSTTYP)   TYPE(*CHAR) LEN(2)

/* ERROR MESSAGE FIELDS                                              */
             DCL        VAR(&MSG) TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL) TYPE(*DEC) LEN(5 0)

/*   MONITOR FOR ALL MESSAGES                                       */
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

/* SUBMIT THE CL THAT CALLS THE EDIT POST OPEN ORDERS PROGRAM        */
/*********   SBMJOB     CMD(CALL PGM(PBTIUPC) PARM(&RETURN &NAME +
                          &CUSTPO &LPR &DTTHRUN &DTFROMN &RDD +
                          &COMPN &CUSTN &ORDERN &WHSE &CSTTYP +
                          &STATE &UPDTYP &CITY &PRCEVENT)) +
                          JOB(SWEEPORDS)                   +
                                                           +
             GOTO       CMDLBL(END)           **********************/

 TESTING:    CALL       PGM(PBTIUPC) PARM(&RETURN &NAME &CUSTPO &LPR +
                          &DTTHRUN &DTFROMN &RDD &COMPN &CUSTN +
                          &ORDERN &WHSE &CSTTYP &STATE &UPDTYP +
                          &CITY &PRCEVENT)

             GOTO       CMDLBL(END)

/*-------------------------USER QUIT--------------------------------*/
/* USER QUIT REQUESTED                                              */
/*------------------------------------------------------------------*/
 USERQUIT:   CHGVAR     VAR(&RETURN) VALUE('Y2U9999')
             GOTO       CMDLBL(END)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             CHGJOB     LOG(4 20 *SECLVL) LOGCLPGM(*YES)

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM
