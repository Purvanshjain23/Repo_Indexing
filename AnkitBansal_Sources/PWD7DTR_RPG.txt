     H/TITLE Dsp Buy Order and LoadDT  Display transactions
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Display DBF header and associated DBF detail records
     H* - DBF header record fields appear on SFL control record
     H* - DBF detail records appear on SFL detail record
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Display transactions
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 01:43:35
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPWD7DTR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Dsp Buy Order and LoadDT  Display transactions
      *
     FPKAWCPL2IF  E           K        DISK
     F                                              KINFDS INFDS1
      * SPN : Buy Order Header          SPN Buy Ord Hdr/Lod
      *
     FPKE3CPL1IF  E           K        DISK
      * RTV : MPR Producer Purch Type   Retrieval index
      *
     FPLAECPL2IF  E           K        DISK
      * RSQ : Delivery Sched Detail     BOH Co/BO/BOL/Kill Dt
      *
     FPLAFCPL2IF  E           K        DISK
      * RSQ : Delivery Tracking         BOH CO/BO/BOL/KillDt
      *
     FPWACCPL1IF  E           K        DISK
      * RTV : Buy Order Load Reference  Retrieval index
      *
     FPKAQCPL0IF  E           K        DISK
      * RTV : Producer Sub-Contract     Retrieval index
      *
     FPKAIREL0IF  E           K        DISK
      * RTV : Genetic                   Retrieval index
      *
     FPKAKREL0IF  E           K        DISK
      * RTV : Pricing Option            Retrieval index
      *
     FPKARREL0IF  E           K        DISK
      * RTV : Carcass Merit Program     Retrieval index
      *
     FPKADREL0IF  E           K        DISK
      * RTV : Hog Buyer                 Retrieval index
      *
     FPKBFREL1IF  E           K        DISK
      * RTV : Producer Std Split        Retrieval index
      *
     FPKACREL1IF  E           K        DISK
      * RTV : Producer                  Retrieval index
      *
     FPKAAREL0IF  E           K        DISK
      * RTV : Source                    Retrieval index
      *
     FPKAFREL0IF  E           K        DISK
      * RTV : Producer Location         Retrieval index
      *
      * Screen: Field position and name array
     E                    W0BEG   7 031  5 0A
     E                    W0END   7 031  5 0A
     E                    W0NAM   7 031 10
      * Long constants
     E                    @CN#    1  01  6   @CN    25
     I@ACREAI
      * Producer                  Retrieval index
      * Renamed input format fields
     I              ACABCD                          WAABCD
     I              ACAGTX                          WAAGTX
     I              ACALNB                          WAALNB
     I              ACAATH                          WAAATH
     I              ACAMNB                          WAAMNB
     I              ACIWST                          WAIWST
     I              ACAPST                          WAAPST
     I              ACGCNB                          WAGCNB
     I              ACGJNB                          WAGJNB
     I              ACC2TX                          WAC2TX
     I              ACAACD                          WAAACD
     I              ACACCD                          WAACCD
     I              ACADCD                          WAADCD
     I              ACAAVN                          WAAAVN
     I              ACAADT                          WAAADT
     I              ACAMTM                          WAAMTM
     I              ACAJST                          WAAJST
     I              ACAHVN                          WAAHVN
     I              ACAGVN                          WAAGVN
     I              ACABVN                          WAABVN
     I              ACABDT                          WAABDT
     I              ACABTM                          WAABTM
      *
     I@AFREAR
      * Producer Location         Retrieval index
      * Renamed input format fields
     I              AFABCD                          WBABCD
     I              AFAECD                          WBAECD
     I              AFA8TX                          WBA8TX
     I              AFGLNB                          WBGLNB
     I              AFATST                          WBATST
     I              AFASNB                          WBASNB
     I              AFAUST                          WBAUST
     I              AFQNST                          WBQNST
     I              AFQOST                          WBQOST
     I              AFQPST                          WBQPST
     I              AFQQST                          WBQQST
     I              AFQRST                          WBQRST
     I              AFN0TX                          WBN0TX
     I              AFQSST                          WBQSST
     I              AFQTST                          WBQTST
     I              AFQUST                          WBQUST
     I              AFQVST                          WBQVST
     I              AFR8ST                          WBR8ST
     I              AFR9ST                          WBR9ST
     I              AFSAST                          WBSAST
     I              AFSBST                          WBSBST
     I              AFSDST                          WBSDST
     I              AFSEST                          WBSEST
     I              AFSFST                          WBSFST
     I              AFHWNB                          WBHWNB
     I              AFFUCD                          WBFUCD
     I              AFAAVN                          WBAAVN
     I              AFAADT                          WBAADT
     I              AFAMTM                          WBAMTM
     I              AFAJST                          WBAJST
     I              AFAHVN                          WBAHVN
     I              AFAGVN                          WBAGVN
     I              AFABVN                          WBABVN
     I              AFABDT                          WBABDT
     I              AFABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
      * Outward parameters
     IPARC        DS                              8
      * KEY : Buy Order Comment         Retrieval index
      * I : RST BOH Company Number
     I                                    P   1   20PAHMNB
      * I : RST BOH Buy Order Number
     I                                    P   3   60PABNNB
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
      * Parameter declarations
     IP1PARM      DS                              6
      * KEY: Buy Order Header          Retrieval index
      * I : RST BOH Company Number
     I                                    P   1   20P1HMNB
      * I : RST BOH Buy Order Number
     I                                    P   3   60P1BNNB
     IP2PARM      DS
      * O : MAP Head Total USR
     I                                    P   1   40P2B5NB
     IP3PARM      DS
      * FLD: *Arrays
      * I : MAP Oms Name
     I                                        1  30 P3EUTX
      * I : MAP Oms System Value Alpha
     I                                       31  70 P3EVTX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Buy Order
     C           P2B5NB    PARM P2B5NB    WP0001  70       Head Total USR
     C           P3EUTX    PARM           WP0002 30        Oms Name
     C           P3EVTX    PARM           WP0003 40        Oms System Valu
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Set first cycle indicator
     C                     MOVEL'Y'       W01ST   1
      * Conduct program process
      * Set first cycle indicator
     C                     MOVEL'Y'       W01ST   1
     C                     DO   *HIVAL                     DO
      * Initialize screen
     C                     EXSR ABIZSF
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'                        DO
      * Convert fields to external form
     C                     EXSR MOCV#1
      * Bypass screen on first cycle
     C           W01ST     IFNE 'Y'
      * Display screen
     C                     EXSR CAEXFM
     C                     END
      * Cancel first cycle indicator
     C                     MOVEL'N'       W01ST
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG           CAS
      * HOME: Request subfile reload
     C   30                CAS            ADHMKY
      * Validate screen input
     C                     CAS            DAPRSF
     C                     END                             SAC
      *
     C                     END                             OD
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      * Set first cycle indicator
     C           W0TRN     IFEQ 'N'                        IF
     C                     MOVEL'Y'       W01ST   1
     C                     SETOF                     30    *
     C                     END                             IF
     C                     END                             OD
      *****************************************************************
      /EJECT
     CSR         ABIZSF    BEGSR
      *================================================================
      * Initialize screen
      *================================================================
     C                     SETOF                     81    *
      * Initialise subfile control
     C                     EXSR MAIZ#1
      * Initialise screen detail record
     C                     EXSR MDIZ#2
      * Clear subfile
     C                     SETON                     80    *
     C                     WRITE#SFLCTL
     C                     SETOF                     80    *
      * Reset count of SFL records
     C                     Z-ADD*ZERO     ##RRMX  50
     C                     Z-ADD*ZERO     ##RR    50
     C                     MOVEL'KEY'     W0SCR   3
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
     C                     MOVEL'Y'       W0TRN   1
     C                     MOVEL'Y'       W0FST   1
      *================================================================
     CSR         ABEXIT    ENDSR
      /EJECT
     CSR         ADHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN   1
      *================================================================
     CSR         ADEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      *
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN88     IFNE CAIN88
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN88     CAIN88  1
     C                     MOVE *IN81     CAIN81  1
     C                     MOVELW0SCR     W0GRP   1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END                              UOD
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSF    BEGSR
      *================================================================
      * Process subfile records
      *================================================================
      * Confirm/update is not deferred
     C           YPMTFD    IFEQ *BLANKS
     C                     MOVEL'N'       W0DCF   1
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Initialise derived fields
     C                     EXSR MJIZ#2
     C                     END
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Validate SFL control keys if input
     C           W0SCR     IFEQ 'KEY'
     C                     EXSR DCVLH1
     C                     END
      * QUIT if error:
     C   99                GOTO DAEXIT
      * If keys only, now get the rest of the data
     C           W0SCR     IFEQ 'KEY'
     C           YPMTFD    ANDEQ*BLANKS
     C                     EXSR DBLDSF
     C                     GOTO DAEXIT
     C                     END
      * Validate SFL control non keys
     C                     EXSR DEVLH2
      *................................................................
      * Process subfile records
     C           *IN81     IFEQ '1'
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
      * Setof record error indicators
      * 98Invalid SFLRCD
     C                     SETOF                         98
      * Copy header keys to detail record
     C                     Z-ADDP1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADDP1BNNB    #1BNNB           BOH Buy Order N
      * Validate subfile record
     C                     EXSR DIVLSF
      * If SFLRCD invalid, note that errors present
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C                     END                             FI
      *................................................................
      * Quit if subfile invalid:
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * USER: Validate totals
      * Command 14 comments
      * CASE: CTL.*CMD key is CF14
     C           *IN14     IFEQ '1'                        *IF
      * Edt BO Comments       EF - Buy Order Comment  * 
     C                     CLEARPARC
     C                     Z-ADD#2HMNB    PAHMNB           BOH Company Num
     C                     Z-ADD#2BNNB    PABNNB           BOH Buy Order N
      *
     C                     CALL 'PKASEFR'              90  Edt BO Comments
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Buy Order
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKASEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * F15 EDIT PRODUCER SPLITE WAS removed this is a payment function
      * and should not be here
      * Quit if user errors signalled
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * User update processing
     C                     EXSR EAUPFL
     C           *IN99     CABEQ'1'       DAEXIT
      * USER: Process command keys
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
      * Exit after successful update
     C                     EXSR ZXEXPG
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBLDSF    BEGSR
      *================================================================
      * Load screen fields from DBF
      *================================================================
      * Load subfile control from DBF
     C                     EXSR MBFL#1
      * Validate SFL control non keys
     C                     EXSR DFVLH3
      * Read all DBF detail records for header
      * Read ahead
     C           KSPNH     READE@AXCPB0                  82*
     C           *IN82     DOWEQ'0'
      * For each DBF detail record read:
     C                     ADD  1         ##RR    50
     C                     EXSR MDIZ#2
     C                     EXSR MEFL#2
      * USER: Initialize subfile record
      * CASE: DB1.BOH MPR Purchase Type is *ALL values
     C           AWU1ST    IFEQ '01'                       *IF
     C           AWU1ST    OREQ '02'
     C           AWU1ST    OREQ '03'
     C           AWU1ST    OREQ '04'
     C           AWU1ST    OREQ '05'
     C           AWU1ST    OREQ '06'
     C           AWU1ST    OREQ '07'
     C           AWU1ST    OREQ '08'
     C           AWU1ST    OREQ '09'
     C           AWU1ST    OREQ '10'
     C           AWU1ST    OREQ '11'
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV MPR Prdcr Purch TpRT - MPR Producer Purch Type  * 
     C                     EXSR SARVGN
     C                     MOVELYL0001    #2U1ST           BOH MPR Purchas
     C                     END                             *FI
      * Rtv Mvmnt,Farm f/BOL  RT - Delivery Sched Detail  * 
     C                     EXSR SBRVGN
      * CASE: RCD.TH HPS Movement Ref # is Not entered
     C           #ROXNB    IFEQ *ZERO                      *IF
      * Rtv Movement Number   RT - Delivery Tracking  * 
     C                     EXSR SCRVGN
     C                     END                             *FI
      * 1/21/03 Save date/time to check for Delivery tracking change nece
     C                     Z-ADDAXABTH    #RADTH           Time USR
     C                     Z-ADDAXAUDT    #RERDT           Date Beg USR
      * CASE: DB1.RS Record Status is InActive
     C           AWAJST    IFEQ 'I'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     Z-ADDAXAUDT    #1AUDT           BOL Pln Delv Da
      * E3577 SET STS TO YES IF A DETAIL EXISTS
     C                     MOVEL'Y'       YL0003           Status 1
      * Rtv Buy Order Load Ref RT - Buy Order Load Reference  * 
     C                     EXSR SDRVGN
      *  5/22/17 JBB C9426 - Remove validation of the REF fields.
     C           YPMTFD    IFEQ *BLANKS
      * Validate details
     C                     EXSR DJVLSF
     C                     END
      * Output DBF to subfile
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
      * Read next Data record
     C           KSPNH     READE@AXCPB0                  82*
     C                     END                             WOD
     C                     Z-ADD##RR      ##RRMX     81    *
     C                     MOVEL'DTL'     W0SCR
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCVLH1    BEGSR
      *================================================================
      * Validate header keys
      *================================================================
      * Check restriction within
     C                     EXSR VACKRL
      * Check existence of header
     C           YPMTFD    IFEQ *BLANKS
     C           KSPNH     KLIST
     C                     KFLD           AWHMNB           BOH Company Num
     C                     KFLD           AWBNNB           BOH Buy Order N
      * Setup key
     C                     Z-ADD#2HMNB    AWHMNB
     C                     Z-ADD#2BNNB    AWBNNB
     C           KSPNH     CHAIN@AWCPBW              90    *
      * If header not found, error
     C   90                DO
     C                     SETON                     99    PC
      * Send message 'Buy Order Header       NF'
     C                     MOVEL'PRK0049' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DEVLH2    BEGSR
      *================================================================
      * Validate header non-key fields
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate header non-key fields
     C                     END
      * Validate relations if no field errors
     C           *IN99     IFNE '1'
     C                     EXSR DFVLH3
     C                     END
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFVLH3    BEGSR
      *================================================================
      * Validate header non-key relations
      *================================================================
      * Check reference to Producer Sub-Contract
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Genetic
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Pricing Option
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Carcass Merit Program
     C                     EXSR VECKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Hog Buyer
     C                     EXSR VFCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate header non-key relations
      * Rtv Producer Split    RT - Producer Std Split  * 
     C                     EXSR SERVGN
      * Rtv Producer TrkSz,Src RT - Producer  * 
     C                     EXSR SFRVGN
      * Rtv Source Type       RT - Source  * 
     C                     EXSR SGRVGN
      * CTL.BOH Status Desc Usr = Condition name of CTL.BOH Status
     C                     CALL 'PKRVC2R'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1121854   Y2LSNO  70       List number
     C                     PARM #2A6ST    W0INVL 25        BOH Status
     C                     PARM ' '       W0VLMP  1        Value mapped
     C           #CDBTX    PARM           W0CNNM 25        BOH Status Desc
      *
      * ********** 08/02/95 PKP **********
      * If Payment Type = Carcass Merit, validate Base Quote & Type.
      * If Payment Type = Live, Base Quote must be 0 and Type is blank.
      * **********************************
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DIVLSF    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record fields
     C                     MOVEL*BLANK    #1PCST           BOL MPR Prior D
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Validate relations if no field errors
     C  N98                EXSR DJVLSF
     C                     END
      *================================================================
     CSR         DIEXIT    ENDSR
      /EJECT
     CSR         DJVLSF    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Check reference to Producer Location
     C                     EXSR VGCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      *
      * CALC: Subfile record function fields
     C                     ADD  #1BPNB    #CB4NB           Head Total SUM
      *================================================================
     CSR         DJEXIT    ENDSR
      /EJECT
     CSR         EAUPFL    BEGSR
      *================================================================
      * User update processing
      *================================================================
      * Process subfile records
     C           *IN81     IFEQ '1'
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
      * Process detail record
      * USER: Subfile record update processing
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C                     END                             FI
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN78
     C           #1DHNB    IFGT *ZERO                      *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
      * Set 87 = Detail screen, 88 = Key screen
     C           W0SCR     COMP 'DTL'                    87*
     C           W0SCR     COMP 'KEY'                    88*
     C                     MOVEL'0'       *IN79
     C           YL0005    IFEQ *BLANK                     *IF
     C           YL0005    OREQ 'N'
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise header fields
      *================================================================
     C                     MOVELP3EUTX    #PEUTX           Oms Name
     C                     MOVELP3EVTX    #PEVTX           Oms System Valu
     C                     Z-ADD*ZERO     #PB5NB           Head Total USR
     C                     Z-ADD*ZERO     #2KOFF           BOH Hedge Refer
     C                     MOVEL*BLANK    #2A6ST           BOH Status
     C                     MOVEL*BLANK    #2A7ST           BOH Delv Plan P
     C                     Z-ADD*ZERO     #2JOEJ           BOH Hedge Head
     C                     Z-ADD*ZERO     #2D5DT           BOH MPR Reporti
     C                     Z-ADD*ZERO     #2D6DT           BOH Hedge Date
     C                     Z-ADD*ZERO     #2D7DT           BOH Unused Date
     C                     Z-ADD*ZERO     #2D8DT           BOH Unused Date
     C                     Z-ADD*ZERO     #2D9DT           BOH Unused Date
     C                     Z-ADD*ZERO     #2KWPE           BOH Hedge Time
     C                     Z-ADD*ZERO     #2IMBF           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2OPTR           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2OEJD           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2IRMF           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2JIRM           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2JRKF           BOH Unused Nbr
     C                     Z-ADD*ZERO     #2KFIR           BOH Unused Nbr
     C                     MOVEL*BLANK    #2UZST           BOH MPR Reporti
     C                     MOVEL*BLANK    #2U0ST           BOH MPR EST RPT
     C                     MOVEL*BLANK    #2U2ST           BOH Status 4
     C                     MOVEL*BLANK    #2U3ST           BOH Status 5
     C                     Z-ADD*ZERO     #2HXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     #2GANB           CW Year
     C                     Z-ADD*ZERO     #2GBNB           CW Week Number
     C                     MOVEL*BLANK    #2AAVN           RS User Changed
     C                     Z-ADD*ZERO     #2AADT           RS Date Changed
     C                     Z-ADD*ZERO     #2AMTM           RS Time Changed
     C                     MOVEL*BLANK    #2AJST           RS Record Statu
     C                     MOVEL*BLANK    #2AHVN           RS Job
     C                     MOVEL*BLANK    #2AGVN           RS Program
     C                     MOVEL*BLANK    #2ABVN           RS User Added
     C                     Z-ADD*ZERO     #2ABDT           RS Date Added
     C                     Z-ADD*ZERO     #2ABTM           RS Time Added
     C                     Z-ADDP1HMNB    #2HMNB           BOH Company Num
     C                     Z-ADDP1BNNB    #2BNNB           BOH Buy Order N
     C                     MOVEL*BLANK    #CDBTX           BOH Status Desc
     C                     Z-ADD*ZERO     #2ARDT           BOH Buy Order D
      * Clear external version also
     C                     Z-ADD*ZERO     V2ARDT
     C                     MOVEL*BLANK    #2ABCD           PD Producer Cod
     C                     Z-ADD*ZERO     #CBAPC           Primary Split %
     C                     Z-ADD*ZERO     #2ASDT           BOH Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V2ASDT
     C                     MOVEL*BLANK    #2AECD           PL Location Cod
     C                     MOVEL*BLANK    #2AKCD           PC Contract Cod
     C                     MOVEL*BLANK    #2ALCD           PSC Sub-Contrac
     C                     Z-ADD*ZERO     #CAMNB           PD Std Truck Si
     C                     MOVEL*BLANK    #2ACCD           HB Buyer Code
     C                     MOVEL*BLANK    #2A5ST           BOH Buy Order T
     C                     MOVEL*BLANK    #2AGCD           GN Genetic Code
     C                     MOVEL*BLANK    #2A4ST           BOH Payment Typ
     C                     MOVEL*BLANK    #2AMCD           CMP Program Cod
     C                     MOVEL*BLANK    #2AICD           PO Option Code
     C                     Z-ADD*ZERO     #2ALPR           BOH Quoted Base
     C                     MOVEL*BLANK    #2B3ST           BOH Quote Price
     C                     Z-ADD*ZERO     #2AAPR           BOH Market Add/
     C                     MOVEL*BLANK    #2ETCD           BOH Commodity M
     C                     MOVEL*BLANK    #2EUCD           BOH Commodity P
     C                     MOVEL*BLANK    #2J5TX           BOH Market Date
     C                     MOVEL*BLANK    #2U1ST           BOH MPR Purchas
     C                     Z-ADD*ZERO     #CBPTH           Time Beg 4.0 US
     C                     Z-ADD*ZERO     #CB4NB           Head Total SUM
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move file header fields to screen header
      *================================================================
     C                     Z-ADDAWKOFF    #2KOFF           BOH Hedge Refer
     C                     MOVELAWA6ST    #2A6ST           BOH Status
     C                     MOVELAWA7ST    #2A7ST           BOH Delv Plan P
     C                     Z-ADDAWJOEJ    #2JOEJ           BOH Hedge Head
     C                     Z-ADDAWD5DT    #2D5DT           BOH MPR Reporti
     C                     Z-ADDAWD6DT    #2D6DT           BOH Hedge Date
     C                     Z-ADDAWD7DT    #2D7DT           BOH Unused Date
     C                     Z-ADDAWD8DT    #2D8DT           BOH Unused Date
     C                     Z-ADDAWD9DT    #2D9DT           BOH Unused Date
     C                     Z-ADDAWKWPE    #2KWPE           BOH Hedge Time
     C                     Z-ADDAWIMBF    #2IMBF           BOH Unused Nbr
     C                     Z-ADDAWOPTR    #2OPTR           BOH Unused Nbr
     C                     Z-ADDAWOEJD    #2OEJD           BOH Unused Nbr
     C                     Z-ADDAWIRMF    #2IRMF           BOH Unused Nbr
     C                     Z-ADDAWJIRM    #2JIRM           BOH Unused Nbr
     C                     Z-ADDAWJRKF    #2JRKF           BOH Unused Nbr
     C                     Z-ADDAWKFIR    #2KFIR           BOH Unused Nbr
     C                     MOVELAWUZST    #2UZST           BOH MPR Reporti
     C                     MOVELAWU0ST    #2U0ST           BOH MPR EST RPT
     C                     MOVELAWU2ST    #2U2ST           BOH Status 4
     C                     MOVELAWU3ST    #2U3ST           BOH Status 5
     C                     Z-ADDAWHXNB    #2HXNB           PPWS Company Nu
     C                     Z-ADDAWGANB    #2GANB           CW Year
     C                     Z-ADDAWGBNB    #2GBNB           CW Week Number
     C                     MOVELAWAAVN    #2AAVN           RS User Changed
     C                     Z-ADDAWAADT    #2AADT           RS Date Changed
     C                     Z-ADDAWAMTM    #2AMTM           RS Time Changed
     C                     MOVELAWAJST    #2AJST           RS Record Statu
     C                     MOVELAWAHVN    #2AHVN           RS Job
     C                     MOVELAWAGVN    #2AGVN           RS Program
     C                     MOVELAWABVN    #2ABVN           RS User Added
     C                     Z-ADDAWABDT    #2ABDT           RS Date Added
     C                     Z-ADDAWABTM    #2ABTM           RS Time Added
     C                     Z-ADDAWHMNB    #2HMNB           BOH Company Num
     C                     Z-ADDAWBNNB    #2BNNB           BOH Buy Order N
     C                     Z-ADDAWARDT    #2ARDT           BOH Buy Order D
     C                     MOVELAWABCD    #2ABCD           PD Producer Cod
     C                     Z-ADDAWASDT    #2ASDT           BOH Kill Date
     C                     MOVELAWAECD    #2AECD           PL Location Cod
     C                     MOVELAWAKCD    #2AKCD           PC Contract Cod
     C                     MOVELAWALCD    #2ALCD           PSC Sub-Contrac
     C                     MOVELAWACCD    #2ACCD           HB Buyer Code
     C                     MOVELAWA5ST    #2A5ST           BOH Buy Order T
     C                     MOVELAWAGCD    #2AGCD           GN Genetic Code
     C                     MOVELAWA4ST    #2A4ST           BOH Payment Typ
     C                     MOVELAWAMCD    #2AMCD           CMP Program Cod
     C                     MOVELAWAICD    #2AICD           PO Option Code
     C                     Z-ADDAWALPR    #2ALPR           BOH Quoted Base
     C                     MOVELAWB3ST    #2B3ST           BOH Quote Price
     C                     Z-ADDAWAAPR    #2AAPR           BOH Market Add/
     C                     MOVELAWETCD    #2ETCD           BOH Commodity M
     C                     MOVELAWEUCD    #2EUCD           BOH Commodity P
     C                     MOVELAWJ5TX    #2J5TX           BOH Market Date
     C                     MOVELAWU1ST    #2U1ST           BOH MPR Purchas
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#2    BEGSR
      *================================================================
      * Initialise screen detail record
      *================================================================
     C                     Z-ADDP1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADDP1BNNB    #1BNNB           BOH Buy Order N
     C                     MOVEL*BLANK    #1O9ST           BOL Scheduled K
     C                     Z-ADD*ZERO     #1ABTH           BOL Pln Delv St
     C                     Z-ADD*ZERO     #1BPNB           BOL Pln Head De
     C                     Z-ADD*ZERO     #1ACTH           BOL Pln Delv En
     C                     Z-ADD*ZERO     #1CSNB           BOL Shipped Wgt
     C                     MOVEL*BLANK    #1BNCD           TRK Trucker Cod
     C                     MOVEL*BLANK    #1ABCD           PD Producer Cod
     C                     MOVEL*BLANK    #1AECD           PL Location Cod
     C                     Z-ADD*ZERO     #1AUDT           BOL Pln Delv Da
     C                     MOVEL*BLANK    #1PDST           BOL Violated Au
     C                     Z-ADD*ZERO     #ROXNB           TH HPS Movement
     C                     MOVEL*BLANK    #1CMST           BOL Freight UOM
     C                     Z-ADD*ZERO     #1AGPR           BOL Freight Uni
     C                     Z-ADD*ZERO     #1ATVA           BOL Freight Amt
     C                     MOVEL*BLANK    #1I1ST           BOL Freight All
     C                     Z-ADD*ZERO     #1DINB           BOL Live Wgt Re
     C                     MOVEL*BLANK    #1CNST           BOL Trucker Pay
     C                     Z-ADD*ZERO     #1GINB           BOL Trucker Che
     C                     Z-ADD*ZERO     #1BZDT           BOL Trucker Che
     C                     Z-ADD*ZERO     #1LSNB           BOL AP Voucher
     C                     MOVEL*BLANK    #1F3TX           BOL Trailer
     C                     MOVEL*BLANK    #1O8ST           BOL Freight Exp
     C                     MOVEL*BLANK    #1PAST           BOL Truck Scale
     C                     Z-ADD*ZERO     #1LDSH           BOL Shipped Hea
     C                     MOVEL*BLANK    #1PBST           Reported to USD
     C                     MOVEL*BLANK    #1PCST           BOL MPR Prior D
     C                     MOVEL*BLANK    #1UWST           BOL Status 5
     C                     MOVEL*BLANK    #1UXST           BOL Status 6
     C                     MOVEL*BLANK    #1UYST           BOL Status 7
     C                     Z-ADD*ZERO     #1JKRU           BOL HPS Movemen
     C                     Z-ADD*ZERO     #1KEOR           BOL Head LFT
     C                     Z-ADD*ZERO     #1IOEW           BOL Head EUT/KO
     C                     Z-ADD*ZERO     #1KJIO           BOL Auth Gate E
     C                     Z-ADD*ZERO     #1IOJR           BOL Head Receiv
     C                     Z-ADD*ZERO     #1EIRR           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1ITMF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1ODJE           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1RJIF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1OEJF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1D0DT           BOL Auth Gate E
     C                     Z-ADD*ZERO     #1D1DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D2DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D3DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D4DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1CQDT           BOL Kill Date
     C                     Z-ADD*ZERO     #RADTH           Time USR
     C                     Z-ADD*ZERO     #RERDT           Date Beg USR
     C                     MOVEL*BLANK    #RGJST           Std Truck Size
     C                     MOVEL*BLANK    #1AAVN           RS User Changed
     C                     Z-ADD*ZERO     #1AADT           RS Date Changed
     C                     Z-ADD*ZERO     #1AMTM           RS Time Changed
     C                     MOVEL*BLANK    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1AHVN           RS Job
     C                     MOVEL*BLANK    #1AGVN           RS Program
     C                     MOVEL*BLANK    #1ABVN           RS User Added
     C                     Z-ADD*ZERO     #1ABDT           RS Date Added
     C                     Z-ADD*ZERO     #1ABTM           RS Time Added
     C                     Z-ADD*ZERO     #1BONB           BOL Load Number
     C                     Z-ADD*ZERO     #1DHNB           BOL Head Receiv
     C                     MOVEL*BLANK    #RDIT1           BOL Ref 1
     C                     MOVEL*BLANK    #RDJT1           BOL Ref 2
     C                     MOVEL*BLANK    #RIJSS           BOL Ref Status
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         MEFL#2    BEGSR
      *================================================================
      * Load screen detail record
      *================================================================
     C                     Z-ADDAXHMNB    #1HMNB           BOH Company Num
     C                     Z-ADDAXBNNB    #1BNNB           BOH Buy Order N
     C                     MOVELAXO9ST    #1O9ST           BOL Scheduled K
     C                     Z-ADDAXABTH    #1ABTH           BOL Pln Delv St
     C                     Z-ADDAXBPNB    #1BPNB           BOL Pln Head De
     C                     Z-ADDAXACTH    #1ACTH           BOL Pln Delv En
     C                     Z-ADDAXCSNB    #1CSNB           BOL Shipped Wgt
     C                     MOVELAXBNCD    #1BNCD           TRK Trucker Cod
     C                     MOVELAXABCD    #1ABCD           PD Producer Cod
     C                     MOVELAXAECD    #1AECD           PL Location Cod
     C                     Z-ADDAXAUDT    #1AUDT           BOL Pln Delv Da
     C                     MOVELAXPDST    #1PDST           BOL Violated Au
     C                     MOVELAXCMST    #1CMST           BOL Freight UOM
     C                     Z-ADDAXAGPR    #1AGPR           BOL Freight Uni
     C                     Z-ADDAXATVA    #1ATVA           BOL Freight Amt
     C                     MOVELAXI1ST    #1I1ST           BOL Freight All
     C                     Z-ADDAXDINB    #1DINB           BOL Live Wgt Re
     C                     MOVELAXCNST    #1CNST           BOL Trucker Pay
     C                     Z-ADDAXGINB    #1GINB           BOL Trucker Che
     C                     Z-ADDAXBZDT    #1BZDT           BOL Trucker Che
     C                     Z-ADDAXLSNB    #1LSNB           BOL AP Voucher
     C                     MOVELAXF3TX    #1F3TX           BOL Trailer
     C                     MOVELAXO8ST    #1O8ST           BOL Freight Exp
     C                     MOVELAXPAST    #1PAST           BOL Truck Scale
     C                     Z-ADDAXLDSH    #1LDSH           BOL Shipped Hea
     C                     MOVELAXPBST    #1PBST           Reported to USD
     C                     MOVELAXPCST    #1PCST           BOL MPR Prior D
     C                     MOVELAXUWST    #1UWST           BOL Status 5
     C                     MOVELAXUXST    #1UXST           BOL Status 6
     C                     MOVELAXUYST    #1UYST           BOL Status 7
     C                     Z-ADDAXJKRU    #1JKRU           BOL HPS Movemen
     C                     Z-ADDAXKEOR    #1KEOR           BOL Head LFT
     C                     Z-ADDAXIOEW    #1IOEW           BOL Head EUT/KO
     C                     Z-ADDAXKJIO    #1KJIO           BOL Auth Gate E
     C                     Z-ADDAXIOJR    #1IOJR           BOL Head Receiv
     C                     Z-ADDAXEIRR    #1EIRR           BOL Unused Wgt
     C                     Z-ADDAXITMF    #1ITMF           BOL Unused Wgt
     C                     Z-ADDAXODJE    #1ODJE           BOL Unused Wgt
     C                     Z-ADDAXRJIF    #1RJIF           BOL Unused Wgt
     C                     Z-ADDAXOEJF    #1OEJF           BOL Unused Wgt
     C                     Z-ADDAXD0DT    #1D0DT           BOL Auth Gate E
     C                     Z-ADDAXD1DT    #1D1DT           BOL Unused Date
     C                     Z-ADDAXD2DT    #1D2DT           BOL Unused Date
     C                     Z-ADDAXD3DT    #1D3DT           BOL Unused Date
     C                     Z-ADDAXD4DT    #1D4DT           BOL Unused Date
     C                     Z-ADDAXCQDT    #1CQDT           BOL Kill Date
     C                     MOVELAXAAVN    #1AAVN           RS User Changed
     C                     Z-ADDAXAADT    #1AADT           RS Date Changed
     C                     Z-ADDAXAMTM    #1AMTM           RS Time Changed
     C                     MOVELAXAJST    #1AJST           RS Record Statu
     C                     MOVELAXAHVN    #1AHVN           RS Job
     C                     MOVELAXAGVN    #1AGVN           RS Program
     C                     MOVELAXABVN    #1ABVN           RS User Added
     C                     Z-ADDAXABDT    #1ABDT           RS Date Added
     C                     Z-ADDAXABTM    #1ABTM           RS Time Added
     C                     Z-ADDAXBONB    #1BONB           BOL Load Number
     C                     Z-ADDAXDHNB    #1DHNB           BOL Head Receiv
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MJIZ#2    BEGSR
      *================================================================
      * Initialise derived fields
      *================================================================
     C                     Z-ADD*ZERO     #CB4NB           Head Total SUM
      *================================================================
     CSR         MJEXIT    ENDSR
      /EJECT
     CSR         MOCV#1    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert BOH Buy Order Date to display format
      * Convert date
     C           1000000   ADD  #2ARDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2ARDT
      * Convert BOH Kill Date to display format
      * Convert date
     C           1000000   ADD  #2ASDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2ASDT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV MPR Prdcr Purch TpRT - MPR Producer Purch Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN E3ABCD    WQSA01           PD Producer Cod
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PD Producer Cod
      * Setup key
     C                     MOVEL#2ABCD    WQSA01           PD Producer Cod
      * Establish starting position
     C           KRSSA     SETLL@E3CPF4                    *
     C           KRSSA     READE@E3CPF4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0967' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           MPR Purchase Ty
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDE3C0A1    YL0001           MPR Purchase Ty
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@E3CPF4                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Mvmnt,Farm f/BOL  RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN AEHMNB    WQSB01           BOH Company Num
     C           *LIKE     DEFN AEBNNB    WQSB02           BOH Buy Order N
     C           *LIKE     DEFN AEBONB    WQSB03           BOL Load Number
     C           *LIKE     DEFN AEE0DT    WQSB04           DSH Kill Date
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           BOH Company Num
     C                     KFLD           WQSB02           BOH Buy Order N
     C                     KFLD           WQSB03           BOL Load Number
     C                     KFLD           WQSB04           DSH Kill Date
      * Setup key
     C                     Z-ADDAXHMNB    WQSB01           BOH Company Num
     C                     Z-ADDAXBNNB    WQSB02           BOH Buy Order N
     C                     Z-ADDAXBONB    WQSB03           BOL Load Number
     C                     Z-ADDAXCQDT    WQSB04           DSH Kill Date
      * Establish starting position
     C           KRSSB     SETLL@AECPI5                    *
     C           KRSSB     READE@AECPI5                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1028' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0002           DSD Farm Site C
     C                     Z-ADD*ZERO     #ROXNB           DSD Movement Nu
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAEH1A1    YL0002           DSD Farm Site C
     C                     Z-ADDAEH3A1    #ROXNB           DSD Movement Nu
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@AECPI5                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Movement Number   RT - Delivery Tracking  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN AFHMNB    WQSC01           BOH Company Num
     C           *LIKE     DEFN AFBNNB    WQSC02           BOH Buy Order N
     C           *LIKE     DEFN AFBONB    WQSC03           BOL Load Number
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           BOH Company Num
     C                     KFLD           WQSC02           BOH Buy Order N
     C                     KFLD           WQSC03           BOL Load Number
      * Setup key
     C                     Z-ADDAXHMNB    WQSC01           BOH Company Num
     C                     Z-ADDAXBNNB    WQSC02           BOH Buy Order N
     C                     Z-ADDAXBONB    WQSC03           BOL Load Number
      * Establish starting position
     C           KRSSC     SETLL@AFCPI4                    *
     C           KRSSC     READE@AFCPI4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1030' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     #ROXNB           DT Movement Num
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAFIEA1    #ROXNB           DT Movement Num
     C           KRSSC     READE@AFCPI4                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Buy Order Load Ref RT - Buy Order Load Reference  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           ACHMNB           BOH Company Num
     C                     KFLD           ACBNNB           BOH Buy Order N
     C                     KFLD           ACBONB           BOL Load Number
      * Setup key
     C                     Z-ADDAXHMNB    ACHMNB           BOH Company Num
     C                     Z-ADDAXBNNB    ACBNNB           BOH Buy Order N
     C                     Z-ADDAXBONB    ACBONB           BOL Load Number
      * Establish starting position
     C           KRSSD     CHAIN@ACCPW8              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1418' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RDIT1           BOL Ref 1
     C                     MOVEL*BLANK    #RDJT1           BOL Ref 2
     C                     MOVEL*BLANK    #RIJSS           BOL Ref Status
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELACDIT1    #RDIT1           BOL Ref 1
     C                     MOVELACDJT1    #RDJT1           BOL Ref 2
     C                     MOVELACIJSS    #RIJSS           BOL Ref Status
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Producer Split    RT - Producer Std Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           BFABCD           PD Producer Cod
     C                     KFLD           BFBTCD           BOS Split Produ
      * Setup key
     C                     MOVEL#2ABCD    BFABCD           PD Producer Cod
     C                     MOVEL#2ABCD    BFBTCD           BOS Split Produ
      * Establish starting position
     C           KRSSE     CHAIN@BFREE4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0089' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD100       #CBAPC           PSS Split Perce
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDBFABPC    #CBAPC           PSS Split Perce
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv Producer TrkSz,Src RT - Producer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WAABCD           PD Producer Cod
      * Setup key
     C                     MOVEL#2ABCD    WAABCD           PD Producer Cod
      * Establish starting position
     C           KRSSF     CHAIN@ACREAI              90    *
      * Data record not found
     C   90                MOVEL'PRK0009' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAAMNB    #CAMNB           PD Std Truck Si
     C                     MOVELWAIWST    YL0004           PD Freight Exp
     C                     MOVELWAAACD    WUAACD           SR Source Code
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Source Type       RT - Source  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           AAAACD           SR Source Code
      * Setup key
     C                     MOVELWUAACD    AAAACD           SR Source Code
      * Establish starting position
     C           KRSSG     CHAIN@AAREAC              90    *
      * Data record not found
     C   90                MOVEL'PRK0005' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAAIXST    WUIXST           SR Type
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * E11288 JJH 07/31/17 - Tattoo Header Modifications
      * - Copied from Edt Buy Order and Load ET (PKAOETR)
      * - Hide Movement Number
      * - Comment out Error Messages
      * - Comment out all validation and error messages
      * - Remove Options 5=Move Time, F14=Edit Comments, F15=
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#2HMNB'
     C           YPMTFD    OREQ '#2BNNB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2HMNB' defaulted for 'BOH Company Number'.
      * Field '(CTL) #2BNNB' defaulted for 'BOH Buy Order Number'.
     C                     CALL 'PKLTSRR'              90  Tst Select kill
     C                     PARM *BLANK    W0RTN   7
     C           #2HMNB    PARM #2HMNB    WQ0001  30       BOH Company Num
     C           #2BNNB    PARM #2BNNB    WQ0002  70       BOH Buy Order N
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKLTSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2HMNB    IFNE *ZERO                      BOH Company Num
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Producer Sub-Contract
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#2AKCD    WK1X01  1
     C                     MOVEL#2ALCD    WK1X02  1
     C           WK1X01    IFEQ '?'                        PC Contract Cod
     C           YPMTFD    OREQ '#2AKCD'
     C           WK1X02    OREQ '?'                        PSC Sub-Contrac
     C           YPMTFD    OREQ '#2ALCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2AKCD' defaulted for 'PC Contract Code'.
      * Field '(CTL) #2ALCD' defaulted for 'PSC Sub-Contract Code'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2ABCD' defaulted for 'PD Producer Code'.
      * Field '(CTL) #2AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PKFFSRR'              90  Sel Sub-Contrac
     C                     PARM *BLANK    W0RTN   7
     C           #2AKCD    PARM #2AKCD    WQ0003  5        PC Contract Cod
     C           #2ALCD    PARM #2ALCD    WQ0004  5        PSC Sub-Contrac
     C                     PARM #2ABCD    WQ0005  6        PD Producer Cod
     C                     PARM #2AECD    WQ0006  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKFFSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2AKCD    IFNE *BLANK                     PC Contract Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2ALCD    IFNE *BLANK                     PSC Sub-Contrac
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2AKCD    IFEQ *BLANK                     PC Contract Cod
     C           #2ALCD    ANDEQ*BLANK                     PSC Sub-Contrac
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBAQ    KLIST
     C                     KFLD           AQAKCD           PC Contract Cod
     C                     KFLD           AQALCD           PSC Sub-Contrac
      * Setup key
     C                     MOVEL#2AKCD    AQAKCD
     C                     MOVEL#2ALCD    AQALCD
     C           KLVBAQ    CHAIN@AQCPA0              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Producer Sub-Contract  NF'
     C                     MOVEL'PRK0037' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0037' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Genetic
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#2AGCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        GN Genetic Code
     C           YPMTFD    OREQ '#2AGCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2AGCD' defaulted for 'GN Genetic Code'.
     C                     CALL 'PKNASRR'              90  Sel Genetic Act
     C                     PARM *BLANK    W0RTN   7
     C           #2AGCD    PARM #2AGCD    WQ0007  5        GN Genetic Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKNASRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2AGCD    IFNE *BLANK                     GN Genetic Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2AGCD    IFEQ *BLANK                     GN Genetic Code
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCAI    KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Setup key
     C                     MOVEL#2AGCD    AIAGCD
     C           KLVCAI    CHAIN@AIREA9              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Genetic                NF'
     C                     MOVEL'PRK0021' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0021' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Pricing Option
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#2AICD    WK1X01  1
     C           WK1X01    IFEQ '?'                        PO Option Code
     C           YPMTFD    OREQ '#2AICD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2AICD' defaulted for 'PO Option Code'.
     C                     CALL 'PKELSRR'              90  Sel Pricing Opt
     C                     PARM *BLANK    W0RTN   7
     C           #2AICD    PARM #2AICD    WQ0008  3        PO Option Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKELSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2AICD    IFNE *BLANK                     PO Option Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2AICD    IFEQ *BLANK                     PO Option Code
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDAK    KLIST
     C                     KFLD           AKAICD           PO Option Code
      * Setup key
     C                     MOVEL#2AICD    AKAICD
     C           KLVDAK    CHAIN@AKREBC              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Pricing Option         NF'
     C                     MOVEL'PRK0025' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0025' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         VECKRL    BEGSR
      *================================================================
      * Check reference to Carcass Merit Program
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#2AMCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        CMP Program Cod
     C           YPMTFD    OREQ '#2AMCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2AMCD' defaulted for 'CMP Program Code'.
     C                     CALL 'PKXZSRR'              90  Sel CMP Sbd onl
     C                     PARM *BLANK    W0RTN   7
     C           #2AMCD    PARM #2AMCD    WQ0009  3        CMP Program Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKXZSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2AMCD    IFNE *BLANK                     CMP Program Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VEEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2AMCD    IFEQ *BLANK                     CMP Program Cod
     C                     GOTO VEEXIT
     C                     END
      *
     C           KLVEAR    KLIST
     C                     KFLD           ARAMCD           CMP Program Cod
      * Setup key
     C                     MOVEL#2AMCD    ARAMCD
     C           KLVEAR    CHAIN@ARREBF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VEEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VEEXIT
     C                     END
      * Send message 'Carcass Merit Program  NF'
     C                     MOVEL'PRK0039' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0039' W0RTN
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         VFCKRL    BEGSR
      *================================================================
      * Check reference to Hog Buyer
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#2ACCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        HB Buyer Code
     C           YPMTFD    OREQ '#2ACCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2ACCD' defaulted for 'HB Buyer Code'.
     C                     CALL 'PKD3SRR'              90  Sel Hog Buyer
     C                     PARM *BLANK    W0RTN   7
     C           #2ACCD    PARM #2ACCD    WQ0010  3        HB Buyer Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKD3SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2ACCD    IFNE *BLANK                     HB Buyer Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VFEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2ACCD    IFEQ *BLANK                     HB Buyer Code
     C                     GOTO VFEXIT
     C                     END
      *
     C           KLVFAD    KLIST
     C                     KFLD           ADACCD           HB Buyer Code
      * Setup key
     C                     MOVEL#2ACCD    ADACCD
     C           KLVFAD    CHAIN@ADREAF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VFEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VFEXIT
     C                     END
      * Send message 'Hog Buyer              NF'
     C                     MOVEL'PRK0011' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0011' W0RTN
      *================================================================
     CSR         VFEXIT    ENDSR
      /EJECT
     CSR         VGCKRL    BEGSR
      *================================================================
      * Check reference to Producer Location
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1ABCD    WK1X01  1
     C                     MOVEL#1AECD    WK1X02  1
     C           WK1X01    IFEQ '?'                        PD Producer Cod
     C           YPMTFD    OREQ '#1ABCD'
     C           ##RR      ANDEQYPMRRN
     C           WK1X02    OREQ '?'                        PL Location Cod
     C           YPMTFD    OREQ '#1AECD'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1ABCD' defaulted for 'PD Producer Code'.
      * Field '(RCD) #1AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PWF5SRR'              90  Sel Prod Loc by
     C                     PARM *BLANK    W0RTN   7
     C           #1ABCD    PARM #1ABCD    WQ0011  6        PD Producer Cod
     C           #1AECD    PARM #1AECD    WQ0012  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWF5SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1ABCD    IFNE *BLANK                     PD Producer Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1AECD    IFNE *BLANK                     PL Location Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VGEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ABCD    IFEQ *BLANK                     PD Producer Cod
     C           #1AECD    ANDEQ*BLANK                     PL Location Cod
     C                     GOTO VGEXIT
     C                     END
      *
     C           KLVGWB    KLIST
     C                     KFLD           WBABCD           PD Producer Cod
     C                     KFLD           WBAECD           PL Location Cod
      * Setup key
     C                     MOVEL#1ABCD    WBABCD
     C                     MOVEL#1AECD    WBAECD
     C           KLVGWB    CHAIN@AFREAR              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VGEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VGEXIT
     C                     END
      * Send message 'Producer Location      NF'
     C                     MOVEL'PRK0015' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0015' W0RTN
      *================================================================
     CSR         VGEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C           ZINPOS    IFGE 03584
     C           ZINPOS    ANDLE06144
      * Cursor in the subfile record area
      * Reset cursor position to the basic (first) record for lookup
     C           W0CRW     SUB  14        W0CSRR  50
     C           03584     ADD  W0CCL     ZINPOS
      * Calculate rrn of the cursor position
     C                     ADD  ##SFRC    W0CSRR
     C                     ENDIF
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     ENDIF
     C           W0CFL     IFEQ *BLANK
     C                     Z-ADD0         W0CSRR
     C                     ENDIF
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD14        ZHSTRW  40
     C                     Z-ADD23        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field SR Source Code
     C                     MOVEL*BLANK    WUAACD  3
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAALNB           PD Production C
     C                     Z-ADD*ZERO     WAAATH           PD Std Delv Tim
     C                     Z-ADD*ZERO     WAAMNB           PD Std Truck Si
     C                     Z-ADD*ZERO     WAGCNB           PD VND Address
     C                     Z-ADD*ZERO     WAGJNB           PD EDI Trading
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field SR Type
     C                     MOVEL*BLANK    WUIXST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBGLNB           Pl VND Address
     C                     Z-ADD*ZERO     WBASNB           PL Miles/Unused
     C                     Z-ADD*ZERO     WBHWNB           PL Primary Comp
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Define work field Co Uses HPE & HPS usr
     C                     MOVEL*BLANK    WUD3SS  1
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field MPR Purchase Type Code
     C                     Z-ADD*ZERO     YL0001  20
      * Define local work field DSD Farm Site Code
     C                     Z-ADD*ZERO     YL0002  50
      * Define local work field Status 1
     C                     MOVEL*BLANK    YL0003  1
      * Define null work field RS Record Status
     C                     MOVEL*BLANK    YN0001  1
      * Define local work field PD Freight Exp Paid By
     C                     MOVEL*BLANK    YL0004  1
      * Define local work field Tattoo is paid Usr
     C                     MOVEL*BLANK    YL0005  1
      * Define local work field Company Value Code    USR
     C                     MOVEL*BLANK    YL0006 10
      * Define local work field System Value Alpha    USR
     C                     MOVEL*BLANK    YL0007 40
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      * Subfile page size
     C                     Z-ADD10        ##SFPG  30       SFLPAG
      * Initialise subfile positioner
     C                     Z-ADD1         ##SFRC
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * RMC 11/04/16 R7805 add BOH MPR purch type
      * RMC Comment hedge stuff.. never installed 9/27/16
      * E3577 11/5/14 RMC Allow new BOH Type is Hedge. Hedge wont have an
      *  Loads.  They will have BOH Hedge Head and get reported to USDA M
      * HPE034
      * Create a Trucker edit. - Dwight Shepard
      * Purpose:
      * Clone the Trucker report that post and remove
      * all update of vouchers.  Producer the report
      * for the user to sight review before continue on.
      * Modification History
      * Date        Person   Description
      * PK0495 12/12/02 Make subfile fields output & dsp movement#
      *   & Comment SFL Detail validations
      * PK0495 01/20/03 Allow subfile input and validate.
      * H16853 ISE 11/02/2020 CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP3EVTX    ##CMP
     C                     MOVEL@CN,001   YL0006           Company Value C
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HMNB    WQ0013  30       BOH Company Num
     C                     PARM YL0006    WQ0014 10        Company Value C
     C           YL0007    PARM *BLANK    WQ0015 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0007    WUD3SS           Co Uses HPE & H
      *****************************************************************
      *================================================================
     CSR         ZZEXIT    ENDSR
** W0BEG
01039010640107201096012950132401352
01551015720158401610018100184301863
02066020990211902322023320235502578
02584026110263502639028260358703594
036040361603628
** W0END
01041010700108101103013000132601359
01556015760158801614018120184301867
02066021010212102328023330236102580
02590026130263602643028330359103601
036130362503629
** W0NAM
#2HMNB    #2BNNB    #CDBTX    V2ARDT    #2ABCD    #CBAPC    V2ASDT
#2AECD    #2AKCD    #2ALCD    #CAMNB    #2ACCD    #2A5ST    #2AGCD
#2A4ST    #2AMCD    #2AICD    #2ALPR    #2B3ST    #2AAPR    #2ETCD
#2EUCD    #2J5TX    #2U1ST    #CBPTH    #CB4NB    #1BONB    #1DHNB
#RDIT1    #RDJT1    #RIJSS
** @CN
00001 DLVTRKRULE
