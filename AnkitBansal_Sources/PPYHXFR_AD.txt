// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPYHXFR
// ?Date: 14.08.2025 Time: 03:42:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?E5262 JJH 09/09/16 - Chargebacks and Rebills
//?- RSQ Cust,PIF Date/IN,DM,CB,RB ARBDCPQO modified to include RB
//?- This is a FIX program so recompiled, and NOT promoted
ENDDO;

EXECUTE FUNCTION(FIX Bal Avg Days to PayRT) TYPE(RTVOBJ) FILE(PDLDCPP)          AC1782200;
PARAMETER(PAR.A_R_Balance_Year);
PARAMETER(PAR.A_R_Balance_Month);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?E5262 JJH 09/09/16 - Chargebacks and Rebills
 //?- RSQ Cust,PIF Date/IN,DM,CB,RB ARBDCPQO modified to include RB
 //?- This is a FIX program so recompiled, and NOT promoted
 //?*****
 //?** 05/23/2006 LJB
 //?** Read through the A/R Balance file for a specific year and month
 //?** Retrieve the Days to Pay and the Number of Invoices Paid
 //?** from the A/R Header. Calculate the Average Days to Pay and
 //?** update the A/R Balance file.
 //?*****
 //?** 09/11/2006 LJB L60906C
 //?** Move the Days to pay from the A/R Header to the
 //?** Days to Pay in the A/R Balance file.
 //?*****
 ENDDO;

 //?USER: Process Data record

 CASE;

 // IF DB1.A/R Balance Year EQ PAR.A/R Balance Year
 IF DB1.A_R_Balance_Year = PAR.A_R_Balance_Year;

 // AND DB1.A/R Balance Month EQ PAR.A/R Balance Month
 AND DB1.A_R_Balance_Month = PAR.A_R_Balance_Month;

 //?** Build date as CYYMMDD for first day of the month
 // WRK.Year  NBR USR = DB1.A/R Balance Year
 WRK.Year_NBR_USR = DB1.A_R_Balance_Year;

 // WRK.Text 1 Length USR = CON.1
 WRK.Text_1_Length_USR = 1;

 // WRK.Day   (Char) USR = CON.01
 WRK.Day_Char_USR = 01;

 // WRK.Year Alpha (YY) USR = WRK.Year  NBR USR
 WRK.Year_Alpha_YY_USR = WRK.Year_NBR_USR;

 // WRK.Month USR = DB1.A/R Balance Month
 WRK.Month_USR = DB1.A_R_Balance_Month;

 // WRK.Day 1 3A = CONCAT(WRK.Text 1 Length USR,WRK.Year Alpha (YY) USR,CON.*ZERO)
 WRK.Day_1_3A = WRK.Text_1_Length_USR + WRK.Year_Alpha_YY_USR (*ZERO);

 // WRK.Text USR 5 = CONCAT(WRK.Day 1 3A,WRK.Month USR,CON.*ZERO)
 WRK.Text_USR_5 = WRK.Day_1_3A + WRK.Month_USR (*ZERO);

 // WRK.Date (Alpha) USR = CONCAT(WRK.Text USR 5,WRK.Day   (Char) USR,CON.*ZERO)
 WRK.Date_Alpha_USR = WRK.Text_USR_5 + WRK.Day_Char_USR (*ZERO);

 // WRK.Date                  USR = CVTVAR(WRK.Date (Alpha) USR)
 WRK.Date_USR = CVTVAR(WRK.Date_Alpha_USR);

 //?** Get Days to Pay from the A/R Header file
 // PAR.Bal Avg Days to Pay = CON.*ZERO
 PAR.Bal_Avg_Days_to_Pay = *ZERO;

 // PAR.Days to Pay = CON.*ZERO
 PAR.Days_to_Pay = *ZERO;

 EXECUTE FUNCTION(RTV Days Paid MTD      RT) TYPE(RTVOBJ) FILE(ARBDCPP)          AC1357656;
 PARAMETER(DB1.Company_Number);
 PARAMETER(WRK.Date_USR);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(PAR.Days_to_Pay);
 PARAMETER(DB1.A_R_Balance_Month);
 PARAMETER(WRK.Year_NBR_USR);
 PARAMETER(PAR.Count_USR);
 {
  //?USER: Initialize routine

  // PAR.Days to Pay = CND.equal to zero
  PAR.Days_to_Pay = *ZERO;

  // PAR.MTD Invoices Paid = CND.Equal zero
  PAR.MTD_Invoices_Paid = *ZERO;

  //?USER: Process Data record

  CASE;

  // IF DB1.Remaining Balance Due is equal to zero
  IF DB1.Remaining_Balance_Due = *ZERO;

  // AND DB1.Invoice Suffix is Invoice or Debit Memo
  AND DB1.Invoice_Suffix = 'DM'/'IN';

  // PAR.USR Job Year = DB1.Paid in Full Date *YEAR
  PAR.USR_Job_Year = DATEDTLS(DB1.Paid_in_Full_Date 'YR' 1111111 'NONE' 'N' 1);

  // PAR.USR Job Month = DB1.Paid in Full Date *MONTH
  PAR.USR_Job_Month = DATEDTLS(DB1.Paid_in_Full_Date 'MO' 1111111 'NONE' 'N' 1);

  CASE;

  // IF PAR.USR Job Year EQ PAR.*Job year
  IF PAR.USR_Job_Year = PAR.*Job_year;

  // AND PAR.USR Job Month EQ PAR.USR Current Month
  AND PAR.USR_Job_Month = PAR.USR_Current_Month;

  // PAR.Days to Pay = DB1.Days to Pay + PAR.Days to Pay
  PAR.Days_to_Pay = DB1.Days_to_Pay + PAR.Days_to_Pay;

  // PAR.MTD Invoices Paid = PAR.MTD Invoices Paid + CON.1
  PAR.MTD_Invoices_Paid = PAR.MTD_Invoices_Paid + 1;

  // IF *OTHERWISE
  IF *OTHERWISE;

  QUIT;

  ENDIF;

  ENDIF;

 }

 CASE;

 // IF PAR.Count USR is GT 0
 IF PAR.Count_USR > *ZERO;

 // PAR.Bal Avg Days to Pay = PAR.Days to Pay / PAR.Count USR *Rounded
 PAR.Bal_Avg_Days_to_Pay = PAR.Days_to_Pay / PAR.Count_USR 'H';

 EXECUTE FUNCTION(CHG Fix A/R Avg Days   CH) TYPE(CHGOBJ) FILE(PDLDCPP)          AC1782207;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(PAR.A_R_Balance_Year);
 PARAMETER(PAR.A_R_Balance_Month);
 PARAMETER(PAR.Count_USR);
 PARAMETER(PAR.Bal_Avg_Days_to_Pay);
 PARAMETER(PAR.Days_to_Pay);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 ENDIF;

}


