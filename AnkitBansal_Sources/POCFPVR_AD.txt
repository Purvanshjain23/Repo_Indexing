// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POCFPVR
// ?Date: 14.08.2025 Time: 03:36:44
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?*** Modification Log ***
DO;

//?TPA071607 - Authorized salseperson not held on Sales Route file
//?Get the first record from Sales Route Authority file instead
ENDDO;

//?USER: Load screen

// DTL.Description = PAR.Description
DTL.Description = PAR.Description;

//?TPA071607 - Get first rec from Sales Route Authority instead.
EXECUTE FUNCTION(RTV 1st Act rec by routRT) TYPE(RTVOBJ) FILE(PMA7REP)          AC1836394;
PARAMETER(DTL.Sales_Route_Code);
PARAMETER(DTL.Authorized_Salesperson_Sa);
PARAMETER('PA');
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Approval Type EQ PAR.Approval Type
 IF DB1.Approval_Type = PAR.Approval_Type;

 // AND DB1.Record Status is Active
 AND DB1.Record_Status = 'A';

 // PAR.Salesperson Code = DB1.Salesperson Code
 PAR.Salesperson_Code = DB1.Salesperson_Code;

 QUIT;

 ENDIF;

}


EXECUTE FUNCTION(RTV Salesperson        RT) TYPE(RTVOBJ) FILE(CAAPREP)          AC1369411;
PARAMETER(DTL.Authorized_Salesperson_Sa);
PARAMETER(DTL.Name_25A_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Process command keys

CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.USR User ID Selected
IF PGM.*Cursor_field = DTL.USR_User_ID_Selected;

// Call program SEL User Profile Contr SR.
CALL PROGRAM(SEL User Profile Contr SR) ('CAXPSRR');
PARAMETER(DTL.USR_User_ID_Selected);

ENDIF;

ENDIF;

//?USER: Validate relations

EXECUTE FUNCTION(Rtv Profile Model     RT) TYPE(RTVOBJ) FILE(CADRREP)           AC1445577;
PARAMETER(DTL.USR_User_ID_Selected);
PARAMETER(LCL.User_Code_Model);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF LCL.User Code Model is equal to blank
IF LCL.User_Code_Model = *BLANK;

// Send error message - 'User profile not allowed for transfer.'
ERROR(USR2948);
MSGPARM(DTL.USR_User_ID_Selected);

ENDIF;

//?USER: User defined action

// PAR.User Original Entry = DTL.USR User ID Selected
PAR.User_Original_Entry = DTL.USR_User_ID_Selected;

//?USER: Exit program processing

CASE;

// IF DTL.*CMD key is *Exit
IF DTL.*CMD_key = '03';

// PAR.*Return code = CND.*User QUIT requested
PAR.*Return_code = 'Y2U9999';

ENDIF;

