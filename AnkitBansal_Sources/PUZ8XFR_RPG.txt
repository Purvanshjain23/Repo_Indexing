     H/TITLE Upd Block Order Qtemp XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSHENR
     H* Date          : 09/28/23  Time  : 17:39:56
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOPBFCPL1  IF   E           K DISK
      * RTV : Order Header TRG          Retrieval index       NV
      *
     FOPBFCPL0  UF   E           K DISK
      * UPD : Order Header TRG          Update index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QOPBF1        E DS                  EXTNAME(OPBFCPL0)
      * UPD : Order Header TRG          Update index
      * Renamed input format fields
     D  WBAIC3       E                     EXTFLD(BEAIC3)
     D  WBC4NB       E                     EXTFLD(BEC4NB)
     D  WBJNCD       E                     EXTFLD(BEJNCD)
     D  WBANC7       E                     EXTFLD(BEANC7)
     D  WBBKC7       E                     EXTFLD(BEBKC7)
     D  WBBRTX       E                     EXTFLD(BEBRTX)
     D  WBHMNA       E                     EXTFLD(BEHMNA)
     D  WBHONA       E                     EXTFLD(BEHONA)
     D  WBHPNA       E                     EXTFLD(BEHPNA)
     D  WBHNNA       E                     EXTFLD(BEHNNA)
     D  WBDBCD       E                     EXTFLD(BEDBCD)
     D  WBCKTX       E                     EXTFLD(BECKTX)
     D  WBB0C7       E                     EXTFLD(BEB0C7)
     D  WBAETX       E                     EXTFLD(BEAETX)
     D  WBB1NA       E                     EXTFLD(BEB1NA)
     D  WBB3NA       E                     EXTFLD(BEB3NA)
     D  WBB4NA       E                     EXTFLD(BEB4NA)
     D  WBB2NA       E                     EXTFLD(BEB2NA)
     D  WBBHCD       E                     EXTFLD(BEBHCD)
     D  WBC8TX       E                     EXTFLD(BEC8TX)
     D  WBBCNA       E                     EXTFLD(BEBCNA)
     D  WBA0DT       E                     EXTFLD(BEA0DT)
     D  WBA5DT       E                     EXTFLD(BEA5DT)
     D  WBGNDT       E                     EXTFLD(BEGNDT)
     D  WBACDT       E                     EXTFLD(BEACDT)
     D  WBAQCD       E                     EXTFLD(BEAQCD)
     D  WBB6NA       E                     EXTFLD(BEB6NA)
     D  WBBYNA       E                     EXTFLD(BEBYNA)
     D  WBBZNA       E                     EXTFLD(BEBZNA)
     D  WBGTST       E                     EXTFLD(BEGTST)
     D  WBGVST       E                     EXTFLD(BEGVST)
     D  WBGUST       E                     EXTFLD(BEGUST)
     D  WBQFST       E                     EXTFLD(BEQFST)
     D  WBCQCD       E                     EXTFLD(BECQCD)
     D  WBGJST       E                     EXTFLD(BEGJST)
     D  WBGWST       E                     EXTFLD(BEGWST)
     D  WBGXST       E                     EXTFLD(BEGXST)
     D  WBGYST       E                     EXTFLD(BEGYST)
     D  WBAODT       E                     EXTFLD(BEAODT)
     D  WBAIVN       E                     EXTFLD(BEAIVN)
     D  WBCXDT       E                     EXTFLD(BECXDT)
     D  WBJZVA       E                     EXTFLD(BEJZVA)
     D  WBA1WG       E                     EXTFLD(BEA1WG)
     D  WBXIST       E                     EXTFLD(BEXIST)
     D  WBXJST       E                     EXTFLD(BEXJST)
     D  WBXKST       E                     EXTFLD(BEXKST)
     D  WBEIDT       E                     EXTFLD(BEEIDT)
     D  WBAFTM       E                     EXTFLD(BEAFTM)
     D  WBE8CD       E                     EXTFLD(BEE8CD)
     D  WBE9CD       E                     EXTFLD(BEE9CD)
     D  WBRMNB       E                     EXTFLD(BERMNB)
     D  WBTBNB       E                     EXTFLD(BETBNB)
     D  WBR1NB       E                     EXTFLD(BER1NB)
     D  WBPJST       E                     EXTFLD(BEPJST)
     D  WBU0ST       E                     EXTFLD(BEU0ST)
     D  WBU1ST       E                     EXTFLD(BEU1ST)
     D  WBQ2CD       E                     EXTFLD(BEQ2CD)
     D  WBU2ST       E                     EXTFLD(BEU2ST)
     D  WBVEST       E                     EXTFLD(BEVEST)
     D  WBVFST       E                     EXTFLD(BEVFST)
     D  WBVGST       E                     EXTFLD(BEVGST)
     D  WBRPCD       E                     EXTFLD(BERPCD)
     D  WBRNNB       E                     EXTFLD(BERNNB)
     D  WBVDST       E                     EXTFLD(BEVDST)
     D  WBATIN       E                     EXTFLD(BEATIN)
     D  WBU4ST       E                     EXTFLD(BEU4ST)
     D  WBU5ST       E                     EXTFLD(BEU5ST)
     D  WBRSRN       E                     EXTFLD(BERSRN)
     D  WBMHNA       E                     EXTFLD(BEMHNA)
     D  WBMINA       E                     EXTFLD(BEMINA)
     D  WBWBST       E                     EXTFLD(BEWBST)
     D  WBR4CD       E                     EXTFLD(BER4CD)
     D  WBBFCD       E                     EXTFLD(BEBFCD)
     D  WBQ4CD       E                     EXTFLD(BEQ4CD)
     D  WBT3NB       E                     EXTFLD(BET3NB)
     D  WBSICD       E                     EXTFLD(BESICD)
     D  WBCONB       E                     EXTFLD(BECONB)
     D  WBCEST       E                     EXTFLD(BECEST)
     D  WBAWDT       E                     EXTFLD(BEAWDT)
     D  WBJPCD       E                     EXTFLD(BEJPCD)
     D  WBXUST       E                     EXTFLD(BEXUST)
     D  WBZ1ST       E                     EXTFLD(BEZ1ST)
     D  WBVRVA       E                     EXTFLD(BEVRVA)
     D  WBOBST       E                     EXTFLD(BEOBST)
     D  WBBCST       E                     EXTFLD(BEBCST)
     D  WBBDST       E                     EXTFLD(BEBDST)
     D  WBB7VL       E                     EXTFLD(BEB7VL)
     D  WBGASX       E                     EXTFLD(BEGASX)
     D  WBGBSX       E                     EXTFLD(BEGBSX)
     D  WBGCSX       E                     EXTFLD(BEGCSX)
     D  WBGDSX       E                     EXTFLD(BEGDSX)
     D  WBFNSX       E                     EXTFLD(BEFNSX)
     D  WBFOSX       E                     EXTFLD(BEFOSX)
     D  WBFPSX       E                     EXTFLD(BEFPSX)
     D  WBFQSX       E                     EXTFLD(BEFQSX)
     D  WBFRSX       E                     EXTFLD(BEFRSX)
     D  WBFSSX       E                     EXTFLD(BEFSSX)
     D  WBFTSX       E                     EXTFLD(BEFTSX)
     D  WBFUSX       E                     EXTFLD(BEFUSX)
     D  WBFVSX       E                     EXTFLD(BEFVSX)
     D  WBFWSX       E                     EXTFLD(BEFWSX)
     D  WBFXSX       E                     EXTFLD(BEFXSX)
     D  WBFYSX       E                     EXTFLD(BEFYSX)
     D  WBNODT       E                     EXTFLD(BENODT)
     D  WBNPDT       E                     EXTFLD(BENPDT)
     D  WBNQDT       E                     EXTFLD(BENQDT)
     D  WBNRDT       E                     EXTFLD(BENRDT)
     D  WBNSDT       E                     EXTFLD(BENSDT)
     D  WBBPTM       E                     EXTFLD(BEBPTM)
     D  WBBQTM       E                     EXTFLD(BEBQTM)
     D  WBBRTM       E                     EXTFLD(BEBRTM)
     D  WBBSTM       E                     EXTFLD(BEBSTM)
     D  WBBTTM       E                     EXTFLD(BEBTTM)
     D  WBH0NX       E                     EXTFLD(BEH0NX)
     D  WBH1NX       E                     EXTFLD(BEH1NX)
     D  WBH2NX       E                     EXTFLD(BEH2NX)
     D  WBH3NX       E                     EXTFLD(BEH3NX)
     D  WBH4NX       E                     EXTFLD(BEH4NX)
     D  WBC0C7       E                     EXTFLD(BEC0C7)
     D  WBUVST       E                     EXTFLD(BEUVST)
     D  WBUWST       E                     EXTFLD(BEUWST)
     D  WBUXST       E                     EXTFLD(BEUXST)
     D  WBAATM       E                     EXTFLD(BEAATM)
     D  WBAYNA       E                     EXTFLD(BEAYNA)
     D  WBA0NA       E                     EXTFLD(BEA0NA)
     D  WBAXDT       E                     EXTFLD(BEAXDT)
      *
     D YARDCS          DS           779
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              3  0
     D  WP0002         S              7  0
     D  WP0003         S              3
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  WN0001         S              2
     D  WN0002         S              7  0
     D  WN0003         S              7  0
     D  WN0004         S             30
     D  WN0005         S             30
     D  WN0006         S             30
     D  WN0007         S             30
     D  WN0008         S             20
     D  WN0009         S              2
     D  WN0010         S             11
     D  WN0011         S              7  0
     D  WN0012         S             30
     D  WN0013         S             30
     D  WN0014         S             30
     D  WN0015         S             30
     D  WN0016         S             20
     D  WN0017         S              2
     D  WN0018         S             11
     D  WN0019         S             15
     D  WN0020         S              7  0
     D  WN0021         S              7  0
     D  WN0022         S              7  0
     D  WN0023         S              7  0
     D  WN0024         S              2
     D  WN0025         S             40
     D  WN0026         S             40
     D  WN0027         S              3
     D  WN0028         S              1
     D  WN0029         S              1
     D  WN0030         S              1
     D  WN0031         S              1
     D  WN0032         S              3
     D  WN0033         S              1
     D  WN0034         S              1
     D  WN0035         S              1
     D  WN0036         S              1
     D  WN0037         S              7  0
     D  WN0038         S             10
     D  WN0039         S              7  0
     D  WN0040         S             11  2
     D  WN0041         S             11  2
     D  WN0042         S              1
     D  WN0043         S              1
     D  WN0044         S              1
     D  WN0045         S              7  0
     D  WN0046         S              4  0
     D  WN0047         S              4
     D  WN0048         S             12
     D  WN0049         S              7  0
     D  WN0050         S              5  2
     D  WN0051         S             11  2
     D  WN0052         S              1
     D  WN0053         S              1
     D  WN0054         S              1
     D  WN0055         S              2
     D  WN0056         S              1
     D  WN0057         S              1
     D  WN0058         S              1
     D  WN0059         S              1
     D  WN0060         S              1
     D  WN0061         S              5  2
     D  WN0062         S              1
     D  WN0063         S              7  0
     D  WN0064         S              1
     D  WN0065         S              1
     D  WN0066         S              7  0
     D  WN0067         S             30
     D  WN0068         S             30
     D  WN0069         S              1
     D  WN0070         S              3
     D  WN0071         S              2
     D  WN0072         S              3
     D  WN0073         S              7  0
     D  WN0074         S              3
     D  WN0075         S              7  0
     D  WN0076         S              2
     D  WN0077         S              7  0
     D  WN0078         S              2
     D  WN0079         S              1
     D  WN0080         S              1
     D  WN0081         S             11  2
     D  WN0082         S              1
     D  WN0083         S              1
     D  WN0084         S              1
     D  WN0085         S             11  2
     D  WN0086         S              1
     D  WN0087         S              1
     D  WN0088         S              1
     D  WN0089         S              1
     D  WN0090         S              1
     D  WN0091         S              1
     D  WN0092         S              1
     D  WN0093         S              1
     D  WN0094         S              1
     D  WN0095         S              1
     D  WN0096         S              1
     D  WN0097         S              2
     D  WN0098         S              2
     D  WN0099         S              2
     D  WN0100         S              3
     D  WN0101         S              7  0
     D  WN0102         S              7  0
     D  WN0103         S              7  0
     D  WN0104         S              7  0
     D  WN0105         S              7  0
     D  WN0106         S              6  0
     D  WN0107         S              6  0
     D  WN0108         S              6  0
     D  WN0109         S              6  0
     D  WN0110         S              6  0
     D  WN0111         S             11  2
     D  WN0112         S             11  2
     D  WN0113         S             11  2
     D  WN0114         S             11  2
     D  WN0115         S             11  2
     D  WN0116         S              7  0
     D  WN0117         S              1
     D  WN0118         S              1
     D  WN0119         S              1
     D  WN0120         S              6  0
     D  WN0121         S             10
     D  WN0122         S             10
     D  WN0123         S              7  0
     D  YARDC          S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * FLD: Order Header TRG
      * I :  Company Number
     D  P1AIC3                 1      2P 0
      * I :  Order Number
     D  P1C4NB                 3      6P 0
      * I :  OH TF Exempt Code
     D  P1FYSX                 7      9
     D                 DS
     D  ZAMSDA                 1    132
     I@BECPFK
      * Order Header TRG          Retrieval index       NV
      * Renamed input format fields
     I              BEAIC3                      WAAIC3
     I              BEC4NB                      WAC4NB
     I              BEJNCD                      WAJNCD
     I              BEANC7                      WAANC7
     I              BEBKC7                      WABKC7
     I              BEBRTX                      WABRTX
     I              BEHMNA                      WAHMNA
     I              BEHONA                      WAHONA
     I              BEHPNA                      WAHPNA
     I              BEHNNA                      WAHNNA
     I              BEDBCD                      WADBCD
     I              BECKTX                      WACKTX
     I              BEB0C7                      WAB0C7
     I              BEAETX                      WAAETX
     I              BEB1NA                      WAB1NA
     I              BEB3NA                      WAB3NA
     I              BEB4NA                      WAB4NA
     I              BEB2NA                      WAB2NA
     I              BEBHCD                      WABHCD
     I              BEC8TX                      WAC8TX
     I              BEBCNA                      WABCNA
     I              BEA0DT                      WAA0DT
     I              BEA5DT                      WAA5DT
     I              BEGNDT                      WAGNDT
     I              BEACDT                      WAACDT
     I              BEAQCD                      WAAQCD
     I              BEB6NA                      WAB6NA
     I              BEBYNA                      WABYNA
     I              BEBZNA                      WABZNA
     I              BEGTST                      WAGTST
     I              BEGVST                      WAGVST
     I              BEGUST                      WAGUST
     I              BEQFST                      WAQFST
     I              BECQCD                      WACQCD
     I              BEGJST                      WAGJST
     I              BEGWST                      WAGWST
     I              BEGXST                      WAGXST
     I              BEGYST                      WAGYST
     I              BEAODT                      WAAODT
     I              BEAIVN                      WAAIVN
     I              BECXDT                      WACXDT
     I              BEJZVA                      WAJZVA
     I              BEA1WG                      WAA1WG
     I              BEXIST                      WAXIST
     I              BEXJST                      WAXJST
     I              BEXKST                      WAXKST
     I              BEEIDT                      WAEIDT
     I              BEAFTM                      WAAFTM
     I              BEE8CD                      WAE8CD
     I              BEE9CD                      WAE9CD
     I              BERMNB                      WARMNB
     I              BETBNB                      WATBNB
     I              BER1NB                      WAR1NB
     I              BEPJST                      WAPJST
     I              BEU0ST                      WAU0ST
     I              BEU1ST                      WAU1ST
     I              BEQ2CD                      WAQ2CD
     I              BEU2ST                      WAU2ST
     I              BEVEST                      WAVEST
     I              BEVFST                      WAVFST
     I              BEVGST                      WAVGST
     I              BERPCD                      WARPCD
     I              BERNNB                      WARNNB
     I              BEVDST                      WAVDST
     I              BEATIN                      WAATIN
     I              BEU4ST                      WAU4ST
     I              BEU5ST                      WAU5ST
     I              BERSRN                      WARSRN
     I              BEMHNA                      WAMHNA
     I              BEMINA                      WAMINA
     I              BEWBST                      WAWBST
     I              BER4CD                      WAR4CD
     I              BEBFCD                      WABFCD
     I              BEQ4CD                      WAQ4CD
     I              BET3NB                      WAT3NB
     I              BESICD                      WASICD
     I              BECONB                      WACONB
     I              BECEST                      WACEST
     I              BEAWDT                      WAAWDT
     I              BEJPCD                      WAJPCD
     I              BEXUST                      WAXUST
     I              BEZ1ST                      WAZ1ST
     I              BEVRVA                      WAVRVA
     I              BEOBST                      WAOBST
     I              BEBCST                      WABCST
     I              BEBDST                      WABDST
     I              BEB7VL                      WAB7VL
     I              BEGASX                      WAGASX
     I              BEGBSX                      WAGBSX
     I              BEGCSX                      WAGCSX
     I              BEGDSX                      WAGDSX
     I              BEFNSX                      WAFNSX
     I              BEFOSX                      WAFOSX
     I              BEFPSX                      WAFPSX
     I              BEFQSX                      WAFQSX
     I              BEFRSX                      WAFRSX
     I              BEFSSX                      WAFSSX
     I              BEFTSX                      WAFTSX
     I              BEFUSX                      WAFUSX
     I              BEFVSX                      WAFVSX
     I              BEFWSX                      WAFWSX
     I              BEFXSX                      WAFXSX
     I              BEFYSX                      WAFYSX
     I              BENODT                      WANODT
     I              BENPDT                      WANPDT
     I              BENQDT                      WANQDT
     I              BENRDT                      WANRDT
     I              BENSDT                      WANSDT
     I              BEBPTM                      WABPTM
     I              BEBQTM                      WABQTM
     I              BEBRTM                      WABRTM
     I              BEBSTM                      WABSTM
     I              BEBTTM                      WABTTM
     I              BEH0NX                      WAH0NX
     I              BEH1NX                      WAH1NX
     I              BEH2NX                      WAH2NX
     I              BEH3NX                      WAH3NX
     I              BEH4NX                      WAH4NX
     I              BEC0C7                      WAC0C7
     I              BEUVST                      WAUVST
     I              BEUWST                      WAUWST
     I              BEUXST                      WAUXST
     I              BEAATM                      WAAATM
     I              BEAYNA                      WAAYNA
     I              BEA0NA                      WAA0NA
     I              BEAXDT                      WAAXDT
      *
     I@BECPFJ
      * Order Header TRG          Update index
      * Renamed input format fields
     I              BEAIC3                      WBAIC3
     I              BEC4NB                      WBC4NB
     I              BEJNCD                      WBJNCD
     I              BEANC7                      WBANC7
     I              BEBKC7                      WBBKC7
     I              BEBRTX                      WBBRTX
     I              BEHMNA                      WBHMNA
     I              BEHONA                      WBHONA
     I              BEHPNA                      WBHPNA
     I              BEHNNA                      WBHNNA
     I              BEDBCD                      WBDBCD
     I              BECKTX                      WBCKTX
     I              BEB0C7                      WBB0C7
     I              BEAETX                      WBAETX
     I              BEB1NA                      WBB1NA
     I              BEB3NA                      WBB3NA
     I              BEB4NA                      WBB4NA
     I              BEB2NA                      WBB2NA
     I              BEBHCD                      WBBHCD
     I              BEC8TX                      WBC8TX
     I              BEBCNA                      WBBCNA
     I              BEA0DT                      WBA0DT
     I              BEA5DT                      WBA5DT
     I              BEGNDT                      WBGNDT
     I              BEACDT                      WBACDT
     I              BEAQCD                      WBAQCD
     I              BEB6NA                      WBB6NA
     I              BEBYNA                      WBBYNA
     I              BEBZNA                      WBBZNA
     I              BEGTST                      WBGTST
     I              BEGVST                      WBGVST
     I              BEGUST                      WBGUST
     I              BEQFST                      WBQFST
     I              BECQCD                      WBCQCD
     I              BEGJST                      WBGJST
     I              BEGWST                      WBGWST
     I              BEGXST                      WBGXST
     I              BEGYST                      WBGYST
     I              BEAODT                      WBAODT
     I              BEAIVN                      WBAIVN
     I              BECXDT                      WBCXDT
     I              BEJZVA                      WBJZVA
     I              BEA1WG                      WBA1WG
     I              BEXIST                      WBXIST
     I              BEXJST                      WBXJST
     I              BEXKST                      WBXKST
     I              BEEIDT                      WBEIDT
     I              BEAFTM                      WBAFTM
     I              BEE8CD                      WBE8CD
     I              BEE9CD                      WBE9CD
     I              BERMNB                      WBRMNB
     I              BETBNB                      WBTBNB
     I              BER1NB                      WBR1NB
     I              BEPJST                      WBPJST
     I              BEU0ST                      WBU0ST
     I              BEU1ST                      WBU1ST
     I              BEQ2CD                      WBQ2CD
     I              BEU2ST                      WBU2ST
     I              BEVEST                      WBVEST
     I              BEVFST                      WBVFST
     I              BEVGST                      WBVGST
     I              BERPCD                      WBRPCD
     I              BERNNB                      WBRNNB
     I              BEVDST                      WBVDST
     I              BEATIN                      WBATIN
     I              BEU4ST                      WBU4ST
     I              BEU5ST                      WBU5ST
     I              BERSRN                      WBRSRN
     I              BEMHNA                      WBMHNA
     I              BEMINA                      WBMINA
     I              BEWBST                      WBWBST
     I              BER4CD                      WBR4CD
     I              BEBFCD                      WBBFCD
     I              BEQ4CD                      WBQ4CD
     I              BET3NB                      WBT3NB
     I              BESICD                      WBSICD
     I              BECONB                      WBCONB
     I              BECEST                      WBCEST
     I              BEAWDT                      WBAWDT
     I              BEJPCD                      WBJPCD
     I              BEXUST                      WBXUST
     I              BEZ1ST                      WBZ1ST
     I              BEVRVA                      WBVRVA
     I              BEOBST                      WBOBST
     I              BEBCST                      WBBCST
     I              BEBDST                      WBBDST
     I              BEB7VL                      WBB7VL
     I              BEGASX                      WBGASX
     I              BEGBSX                      WBGBSX
     I              BEGCSX                      WBGCSX
     I              BEGDSX                      WBGDSX
     I              BEFNSX                      WBFNSX
     I              BEFOSX                      WBFOSX
     I              BEFPSX                      WBFPSX
     I              BEFQSX                      WBFQSX
     I              BEFRSX                      WBFRSX
     I              BEFSSX                      WBFSSX
     I              BEFTSX                      WBFTSX
     I              BEFUSX                      WBFUSX
     I              BEFVSX                      WBFVSX
     I              BEFWSX                      WBFWSX
     I              BEFXSX                      WBFXSX
     I              BEFYSX                      WBFYSX
     I              BENODT                      WBNODT
     I              BENPDT                      WBNPDT
     I              BENQDT                      WBNQDT
     I              BENRDT                      WBNRDT
     I              BENSDT                      WBNSDT
     I              BEBPTM                      WBBPTM
     I              BEBQTM                      WBBQTM
     I              BEBRTM                      WBBRTM
     I              BEBSTM                      WBBSTM
     I              BEBTTM                      WBBTTM
     I              BEH0NX                      WBH0NX
     I              BEH1NX                      WBH1NX
     I              BEH2NX                      WBH2NX
     I              BEH3NX                      WBH3NX
     I              BEH4NX                      WBH4NX
     I              BEC0C7                      WBC0C7
     I              BEUVST                      WBUVST
     I              BEUWST                      WBUWST
     I              BEUXST                      WBUXST
     I              BEAATM                      WBAATM
     I              BEAYNA                      WBAYNA
     I              BEA0NA                      WBA0NA
     I              BEAXDT                      WBAXDT
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1AIC3        PARM                    WP0001                         Company Number
     C     P1C4NB        PARM                    WP0002                         Order Number
     C     P1FYSX        PARM                    WP0003                         OH TF Exempt Co
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Upd Block Order Qtemp XF
      * Update Order Header TRG (OPBFCPP) Existing Record in QTEMP.
      * Is this needed??? Yes.
      * The following needs to be updated after PUC3CPP validations
      * routine:
      * OH TF Exempt Code
      * Upd Block Order Qtemp RT - Order Header TRG  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Upd Block Order Qtemp RT - Order Header TRG  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WAAIC3                         Company Number
     C                   KFLD                    WAC4NB                         Order Number
      * Setup key
     C                   Z-ADD     P1AIC3        WAAIC3                         Company Number
     C                   Z-ADD     P1C4NB        WAC4NB                         Order Number
      * Establish starting position
     C     KRSSA         CHAIN     @BECPFK                            90        *
      * Data record not found
     C   90              MOVEL     'USR0176'     W0RTN
      * USER: Process Data record
      * Chg TF Exempt         CH - Order Header TRG  * 
     C                   IF        NOT *IN90
     C                   EXSR      SBCHRC
     C                   ENDIF
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBCHRC        BEGSR
      *================================================================
      * Chg TF Exempt         CH - Order Header TRG  * 
      *================================================================
      *
     C                   EVAL      WN0001 = ' '                                 Order Type_Sale
     C                   Z-ADD     *ZERO         WN0002                         AR Customer Num
     C                   Z-ADD     *ZERO         WN0003                         Ship To Custome
     C                   EVAL      WN0004 = ' '                                 Ship To Name
     C                   EVAL      WN0005 = ' '                                 Ship To Address
     C                   EVAL      WN0006 = ' '                                 Ship To Address
     C                   EVAL      WN0007 = ' '                                 Ship To Address
     C                   EVAL      WN0008 = ' '                                 Ship To City
     C                   EVAL      WN0009 = ' '                                 Ship To State C
     C                   EVAL      WN0010 = ' '                                 Ship To Zip_Pos
     C                   Z-ADD     *ZERO         WN0011                         Bill to Custome
     C                   EVAL      WN0012 = ' '                                 Bill to Name
     C                   EVAL      WN0013 = ' '                                 Bill to Address
     C                   EVAL      WN0014 = ' '                                 Bill to Address
     C                   EVAL      WN0015 = ' '                                 Bill to Address
     C                   EVAL      WN0016 = ' '                                 Bill to City
     C                   EVAL      WN0017 = ' '                                 Bill to State C
     C                   EVAL      WN0018 = ' '                                 Bill to Zip_Pos
     C                   EVAL      WN0019 = ' '                                 Customer Purcha
     C                   Z-ADD     *ZERO         WN0020                         Order Date
     C                   Z-ADD     *ZERO         WN0021                         Requested Ship
     C                   Z-ADD     *ZERO         WN0022                         Actual Shipped
     C                   Z-ADD     *ZERO         WN0023                         Cancel Date
     C                   EVAL      WN0024 = ' '                                 Terms Code
     C                   EVAL      WN0025 = ' '                                 Special Instruc
     C                   EVAL      WN0026 = ' '                                 Special Instruc
     C                   EVAL      WN0027 = ' '                                 Carrier Code
     C                   EVAL      WN0028 = ' '                                 Comment Print A
     C                   EVAL      WN0029 = ' '                                 Comment Print I
     C                   EVAL      WN0030 = ' '                                 Comment Print P
     C                   EVAL      WN0031 = ' '                                 Comment Print S
     C                   EVAL      WN0032 = ' '                                 Reason Code
     C                   EVAL      WN0033 = ' '                                 Order in Use
     C                   EVAL      WN0034 = ' '                                 Header Status
     C                   EVAL      WN0035 = ' '                                 Header Status L
     C                   EVAL      WN0036 = ' '                                 Order Type Prin
     C                   Z-ADD     *ZERO         WN0037                         Scheduled Ship
     C                   EVAL      WN0038 = ' '                                 User Original E
     C                   Z-ADD     *ZERO         WN0039                         Date of Origina
     C                   Z-ADD     *ZERO         WN0040                         Order Value Tot
     C                   Z-ADD     *ZERO         WN0041                         Order Weight To
     C                   EVAL      WN0042 = ' '                                 Credit Hold
     C                   EVAL      WN0043 = ' '                                 Production Hold
     C                   EVAL      WN0044 = ' '                                 New Customer Ho
     C                   Z-ADD     *ZERO         WN0045                         Requested Deliv
     C                   Z-ADD     *ZERO         WN0046                         Requested Deliv
     C                   EVAL      WN0047 = ' '                                 Accounts Receiv
     C                   EVAL      WN0048 = ' '                                 Accounts Receiv
     C                   Z-ADD     *ZERO         WN0049                         Load ID
     C                   Z-ADD     *ZERO         WN0050                         Absorbed Freigh
     C                   Z-ADD     *ZERO         WN0051                         Rated Freight
     C                   EVAL      WN0052 = ' '                                 LTL Flag
     C                   EVAL      WN0053 = ' '                                 Price Audit
     C                   EVAL      WN0054 = ' '                                 Price Status
     C                   EVAL      WN0055 = ' '                                 Shipping Method
     C                   EVAL      WN0056 = ' '                                 Export Status
     C                   EVAL      WN0057 = ' '                                 Palletize
     C                   EVAL      WN0058 = ' '                                 Shrink Wrap
     C                   EVAL      WN0059 = ' '                                 Slip Sheet
     C                   EVAL      WN0060 = ' '                                 Age Code
     C                   Z-ADD     *ZERO         WN0061                         Reefer Temperat
     C                   EVAL      WN0062 = ' '                                 Load Type
     C                   Z-ADD     *ZERO         WN0063                         Attach to Invoi
     C                   EVAL      WN0064 = ' '                                 Load Plan Order
     C                   EVAL      WN0065 = ' '                                 Print Pick Slip
     C                   Z-ADD     *ZERO         WN0066                         Resell Referenc
     C                   EVAL      WN0067 = ' '                                 Special Comment
     C                   EVAL      WN0068 = ' '                                 Special Comment
     C                   EVAL      WN0069 = ' '                                 Affect Auto Acc
     C                   EVAL      WN0070 = ' '                                 Sales Route Cod
     C                   EVAL      WN0071 = ' '                                 Manager Level C
     C                   EVAL      WN0072 = ' '                                 VP Level Code
     C                   Z-ADD     *ZERO         WN0073                         Attach to Order
     C                   EVAL      WN0074 = ' '                                 Reason for Pric
     C                   Z-ADD     *ZERO         WN0075                         Invoice Number
     C                   EVAL      WN0076 = ' '                                 Invoice Suffix
     C                   Z-ADD     *ZERO         WN0077                         Invoice Date
     C                   EVAL      WN0078 = ' '                                 Event Code
     C                   EVAL      WN0079 = ' '                                 Trans Contol AS
     C                   EVAL      WN0080 = ' '                                 Modified Flag
     C                   Z-ADD     *ZERO         WN0081                         A/R order Value
     C                   EVAL      WN0082 = ' '                                 Billing Activit
     C                   EVAL      WN0083 = ' '                                 Block Order Fla
     C                   EVAL      WN0084 = ' '                                 Order Certifica
     C                   Z-ADD     *ZERO         WN0085                         Invoice Order V
     C                   EVAL      WN0086 = ' '                                 Process Sts for
     C                   EVAL      WN0087 = ' '                                 Order Conf Fax
     C                   EVAL      WN0088 = ' '                                 Manifest Fax St
     C                   EVAL      WN0089 = ' '                                 Invoice Fax Sts
     C                   EVAL      WN0090 = ' '                                 Transfer in Sto
     C                   EVAL      WN0091 = ' '                                 Email Cust On O
     C                   EVAL      WN0092 = ' '                                 Order Emailed
     C                   EVAL      WN0093 = ' '                                 Export Docs Go
     C                   EVAL      WN0094 = ' '                                 Shipping Temp C
     C                   EVAL      WN0095 = ' '                                 Broker Order St
     C                   EVAL      WN0096 = ' '                                 Air Freight Ord
     C                   EVAL      WN0097 = ' '                                 Order Requires
     C                   EVAL      WN0098 = ' '                                 OH Load Plan Re
     C                   EVAL      WN0099 = ' '                                 Export USDA App
     C                   EVAL      WN0100 = ' '                                 HPB Ship to War
     C                   Z-ADD     *ZERO         WN0101                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WN0102                         JPN Invoice Iss
     C                   Z-ADD     *ZERO         WN0103                         Load Actual Shi
     C                   Z-ADD     *ZERO         WN0104                         Load BOL Comple
     C                   Z-ADD     *ZERO         WN0105                         Load Truck Depa
     C                   Z-ADD     *ZERO         WN0106                         Maximum Gross W
     C                   Z-ADD     *ZERO         WN0107                         Time of Origina
     C                   Z-ADD     *ZERO         WN0108                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WN0109                         Load BOL Comple
     C                   Z-ADD     *ZERO         WN0110                         Load Truck Depa
     C                   Z-ADD     *ZERO         WN0111                         Act Frt Referen
     C                   Z-ADD     *ZERO         WN0112                         Act Non_Ref Frt
     C                   Z-ADD     *ZERO         WN0113                         OH Fuel Surchar
     C                   Z-ADD     *ZERO         WN0114                         OH Total Non_Re
     C                   Z-ADD     *ZERO         WN0115                         OH Total Ref Fr
     C                   Z-ADD     *ZERO         WN0116                         Claim Number
     C                   EVAL      WN0117 = ' '                                 EDI Status 1
     C                   EVAL      WN0118 = ' '                                 EDI Status 2
     C                   EVAL      WN0119 = ' '                                 EDI Status 3
     C                   Z-ADD     *ZERO         WN0120                         Job Time
     C                   EVAL      WN0121 = ' '                                 User Id
     C                   EVAL      WN0122 = ' '                                 Job Name
     C                   Z-ADD     *ZERO         WN0123                         Job Date
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to @BECPFJ
     C                   Z-ADD     WAAIC3        WBAIC3                         Company Number
     C                   Z-ADD     WAC4NB        WBC4NB                         Order Number
      *
     C     KLCHSB        KLIST
     C                   KFLD                    WBAIC3                         Company Number
     C                   KFLD                    WBC4NB                         Order Number
     C     KLCHSB        CHAIN     @BECPFJ                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'OPBFCPL0'    MDACP
     C                   MOVEL     '@BECPFJ'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QOPBF1        YARDCS
      * Move non-key fields to @BECPFJ
     C                   MOVEL(P)  P1FYSX        WBFYSX                         OH TF Exempt Co
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QOPBF1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * USER: Processing before Data update
      * Set Record Stamp CHGOB IF
     C                   Z-ADD     ##JTM         WBAATM                         Job Time
     C                   MOVEL     ##USR         WBAYNA                         User Id
     C                   MOVEL     ##PGM         WBA0NA                         Job Name
     C                   Z-ADD     ##JDT         WBAXDT                         Job Date
      * Set PGM.*Record Data Changed flag
     C                   IF        QOPBF1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    @BECPFJ                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    OPBFCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WAC4NB                         Order Number
     C                   Z-ADD     *ZERO         WAANC7                         AR Customer Num
     C                   Z-ADD     *ZERO         WABKC7                         Ship To Custome
     C                   Z-ADD     *ZERO         WAB0C7                         Bill to Custome
     C                   Z-ADD     *ZERO         WAA0DT                         Order Date
     C                   Z-ADD     *ZERO         WAA5DT                         Requested Ship
     C                   Z-ADD     *ZERO         WAGNDT                         Actual Shipped
     C                   Z-ADD     *ZERO         WAACDT                         Cancel Date
     C                   Z-ADD     *ZERO         WAAODT                         Scheduled Ship
     C                   Z-ADD     *ZERO         WACXDT                         Date of Origina
     C                   Z-ADD     *ZERO         WAJZVA                         Order Value Tot
     C                   Z-ADD     *ZERO         WAA1WG                         Order Weight To
     C                   Z-ADD     *ZERO         WAEIDT                         Requested Deliv
     C                   Z-ADD     *ZERO         WAAFTM                         Requested Deliv
     C                   Z-ADD     *ZERO         WARMNB                         Load ID
     C                   Z-ADD     *ZERO         WATBNB                         Absorbed Freigh
     C                   Z-ADD     *ZERO         WAR1NB                         Rated Freight
     C                   Z-ADD     *ZERO         WARNNB                         Reefer Temperat
     C                   Z-ADD     *ZERO         WAATIN                         Attach to Invoi
     C                   Z-ADD     *ZERO         WARSRN                         Resell Referenc
     C                   Z-ADD     *ZERO         WAT3NB                         Attach to Order
     C                   Z-ADD     *ZERO         WACONB                         Invoice Number
     C                   Z-ADD     *ZERO         WAAWDT                         Invoice Date
     C                   Z-ADD     *ZERO         WAVRVA                         A/R order Value
     C                   Z-ADD     *ZERO         WAB7VL                         Invoice Order V
     C                   Z-ADD     *ZERO         WANODT                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WANPDT                         JPN Invoice Iss
     C                   Z-ADD     *ZERO         WANQDT                         Load Actual Shi
     C                   Z-ADD     *ZERO         WANRDT                         Load BOL Comple
     C                   Z-ADD     *ZERO         WANSDT                         Load Truck Depa
     C                   Z-ADD     *ZERO         WABPTM                         Maximum Gross W
     C                   Z-ADD     *ZERO         WABQTM                         Time of Origina
     C                   Z-ADD     *ZERO         WABRTM                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WABSTM                         Load BOL Comple
     C                   Z-ADD     *ZERO         WABTTM                         Load Truck Depa
     C                   Z-ADD     *ZERO         WAH0NX                         Act Frt Referen
     C                   Z-ADD     *ZERO         WAH1NX                         Act Non_Ref Frt
     C                   Z-ADD     *ZERO         WAH2NX                         OH Fuel Surchar
     C                   Z-ADD     *ZERO         WAH3NX                         OH Total Non_Re
     C                   Z-ADD     *ZERO         WAH4NX                         OH Total Ref Fr
     C                   Z-ADD     *ZERO         WAC0C7                         Claim Number
     C                   Z-ADD     *ZERO         WAAATM                         Job Time
     C                   Z-ADD     *ZERO         WAAXDT                         Job Date
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
