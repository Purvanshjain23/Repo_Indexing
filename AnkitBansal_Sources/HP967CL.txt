/*********************************************************************/
/*                                                                   */
/*  PROGRAM NUMBER:  HP967CL                                         */
/*  PROGRAM NAME:    Purge HPS Feed Tickets                          */
/*  PROGRAMMER:      Brad Baden                                      */
/*  CREATE DATE:      8/07/2020                                      */
/*  WHD / TFS:       WHD67665 / TFS# 16740                           */
/*                                                                   */
/*  FUNCTION:  This program was copied from HP465CL.  It's purpose   */
/*             is to purge records from the Feed Ticket files        */
/*             HSP037, HSP038, and HSP059.                           */
/*                                                                   */
/*********************************************************************/
/* MODIFICATIONS                                                     */
/*                                                                   */
/* xx/xx/xxxx  programmer   tfs#                                     */
/*             xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx     */
/*             xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxz     */
/*                                                                   */
/*********************************************************************/

             PGM        PARM(&CUTOFFDTA &FMILLOFC)

             DCL        VAR(&CUTOFFDTA) TYPE(*CHAR) LEN(8) +
                          /*  Cut off date  - alpha */
             DCL        VAR(&FMILLOFC) TYPE(*CHAR) LEN(5) +
                          /*  Feed Mill Office */

             DCL        VAR(&CUTOFFDT) TYPE(*DEC) LEN(8 0) +
                          /*  Cut off date - numeric */

             DCL        VAR(&GROUP) TYPE(*CHAR) LEN(10) +
                          /*  Group Profile */

             DCL        VAR(&MESSAGE) TYPE(*CHAR) LEN(100) /*  Group +
                          Profile */

             PSHLIBL

             CHGVAR     VAR(&CUTOFFDT) VALUE(&CUTOFFDTA)

/*-------------------------------------------------------------------*/
/* Determine purge library to use                                    */
/*-------------------------------------------------------------------*/

             /* Retieve group profile for user id                    */
             RTVUSRPRF  GRPPRF(&GROUP)

             SELECT

             /* When SBDPGMR, set the library list for PRKTESTF      */
             WHEN       COND(&GROUP *EQ 'SBDPGMR') THEN(DO)
             SETLIBL    JOBD(PRKINTT)
             CHKOBJ     OBJ(HSP037PRX) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGVAR     VAR(&MESSAGE) VALUE('Unable to determine +
                          Feed Mill purge library.')
             ESNDMAIL   RECIPIENT(FEEDMILLMSG) SUBJECT('Feed Mill +
                          Purge Error') MSG(&MESSAGE)
             GOTO       CMDLBL(ENDIT)
             ENDDO
             ENDDO

             OTHERWISE  CMD(DO)

             /* Add production purge library to library list         */
             SETLIBL    JOBD(PRKPRDGUY)
             ADDLIBLE   LIB(PRGHPSF)
             MONMSG     MSGID(CPF0000)
             ENDDO

             ENDSELECT

/*-------------------------------------------------------------------*/
/* Call the Purge Program for Individual files.                      */
/*-------------------------------------------------------------------*/

             CALL       PGM(HP967) PARM(&CUTOFFDT &FMILLOFC)

             CHGVAR     VAR(&MESSAGE) VALUE('Feed ticket purge +
                          process for feed mill ' *CAT &FMILLOFC +
                          *CAT ' has completed.')
             ESNDMAIL   RECIPIENT(FEEDMILLMSG) SUBJECT('Feed Mill +
                          Purge Process') MSG(&MESSAGE)

/*-------------------------------------------------------------------*/
/* Deallocate files and restore library list                         */
/*-------------------------------------------------------------------*/

 ENDIT:      POPLIBL

             ENDPGM
