/********************************************************************/
/*                                                                  */
/*  PROGRAM  -  PMTSUPC - PRINT MAKE SHEET WITH VARIANCE            */
/*  SYNOPSIS -  THIS CL IS CALLED FROM INVNIGHTTRS FROM THE         */
/*              JOB SCHEDULER FOR TRIUMPH FOODS TO PRINT AND        */
/*              SEND THE MAKE SHEET.                                */
/*                                                                  */
/*  PROCESS  -  FIRST TIME IS FROM INVNIGHTTRS IMMEDIATELY AFTER    */
/*              THE PRODUCTION SCHEDULE BUILD AND AFTER SUNDAY IS   */
/*              REMOVED FROM THE FILE                               */
/*                 &DAYSTS WILL = T FOR TODAY                       */
/*                 &DATE WILL BE THE JOB DATE                       */
/*              WHEN RUNNING FOR TODAY THE PRODUCTION DATE WILL BE  */
/*              TODAY'S DATE. WHEN RUNNING FOR YESTERDAY SUBTRACT 1 */
/*              FROM TODAYS DATE.                                   */
/*              IF SCHEDULE RECORDS EXIST FOR THE PASSED IN DATE    */
/*              THEN THE MAKE SHEET WILL BE CREATED AND SENT        */
/*              TO THE OUTPUT QUEUE IN THE COMPANY DOCUMENT         */
/*              DEFAULTS FILE. THIS REPORT WILL ALSO BE EMAILED TO  */
/*              A DISTRIBUTION LIST.                                */
/*                                                                  */
/*  SYSTEM   -  OMS - SCHEDULING                                    */
/*  DATE     -  04/02/2008                                          */
/*                                                                  */
/*  PARAMETERS:                                                     */
/*  I    &COMPN      = COMPANY NUMBER                               */
/*  I    &DAYSTS     = "T" FOR TODAY                                */
/*  I    &DATEN      = TODAY'S DATE                                 */
/****************************************************************** */
/* 04/02/2008 LJB FP1235                                            */
/*            NEW                                                   */
/* 06/17/2008 LJB FP1235                                            */
/*            RENAME THE ESEND MAILING LIST                         */
/* 06/04/2008 RMC FP1054                                            */
/*            PUT THE ESEND MAILING LIST IN COMPANY VALUE "MAKESHEET" */
/*******************************************************************/
 PMTSUPC:    PGM        PARM(&COMPN &DATEN &DAYSTS)

             DCL        VAR(&DAYSTS) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DATEN) TYPE(*DEC)
             DCL        VAR(&DATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&DATECVT) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATEA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&CYMDTO) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&DURATION) TYPE(*DEC) LEN(8 0)
             DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DESC) TYPE(*CHAR) LEN(50)
             DCL        VAR(&PRODTYPE) TYPE(*CHAR) LEN(1) VALUE('S')
             DCL        VAR(&APPLIC) TYPE(*CHAR) LEN(6) VALUE('P/S')
             DCL        VAR(&COMPN) TYPE(*DEC)
             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&COMPA) TYPE(*CHAR) LEN(3)
             DCL        VAR(&PRNTCMMTS) TYPE(*CHAR) LEN(1) VALUE('Y')
             DCL        VAR(&RPTTYPE) TYPE(*CHAR) LEN(1) VALUE('M')
/*----------------------------------------------------------------- */
/* PARMS FOR THE RETRIEVE OVERLAY PARAMETERS PROGRAM                */
/*----------------------------------------------------------------- */
        DCL        VAR(&DISTSCH) TYPE(*CHAR) LEN(30) /* TF MAKESHEET DIST */
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(2) VALUE(PF)
             DCL        VAR(&DEPT) TYPE(*CHAR) LEN(6) VALUE(SCHED)
             DCL        VAR(&OVERLAY) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ADDLOBJ) TYPE(*CHAR) LEN(10)
             DCL        VAR(&SENDPHONE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&SENDFAX) TYPE(*CHAR) LEN(10)
             DCL        VAR(&OUTQ) TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL        VAR(&DRAWER) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&PRTDEVTYPE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LENGTH) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&WIDTH) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&CPI) TYPE(*DEC) LEN(3 1)
             DCL        VAR(&LPI) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&OVERFLOW) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&ROTATE) TYPE(*CHAR) LEN(5)
             DCL        VAR(&COMMENT1) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMMENT2) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMMENT3) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMMENT4) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMMENT5) TYPE(*CHAR) LEN(50)
             DCL        VAR(&RECSTS) TYPE(*CHAR) LEN(1)

             MONMSG     MSGID(CPF0000) /* EXEC(GOTO CMDLBL(NOSPOOL))*/

             CHGJOB     LOG(4 00 *SECLVL)

             CHGVAR     VAR(&COMP) VALUE(&COMPN) /* 15.5 TO 3.0 */
             CHGVAR     VAR(&COMPA) VALUE(&COMP) /* 3.0 TO CHAR */
             CHGVAR     VAR(&DATE) VALUE(&DATEN) /* 15.5 TO 7.0 */

/* IF THIS IS BEING RUN FOR YESTERDAY'S DATE, SUBTRACT 1 FROM THE   */
/* DATE AND PRINT THE REPORT FOR YESTERDAY                          */
             IF         COND(&DAYSTS *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&DURATION) VALUE(&DURATION -1)
             CALL       PGM(PDX8XFR) PARM('' &DATE &CYMDTO &DURATION)
             CHGVAR     VAR(&DATE) VALUE(&CYMDTO)
             ENDDO

             CHGVAR     VAR(&DATEA) VALUE(&DATE) /* 7.0 TO CHAR */
             CVTDAT     DATE(&DATEA) TOVAR(&DATECVT) FROMFMT(*CYMD) +
                          TOFMT(*MDYY) TOSEP('/')
             CHGVAR     VAR(&DESC) VALUE('MAKE SHEET for Company' +
                          *BCAT &COMPA *BCAT 'for' *BCAT &DATECVT)

/*----------------------------------------------------------------- */
/* CALL THE GENERIC RETRIEVE COMPANY DOCUMENT DEFAULTS FIELDS       */
/* PROGRAM. COMPANY, TYPE, DEPARTMENT, AND OVERLAY NAME ARE         */
/* INPUT RESTRICTED, THE REST ARE OUTPUT PARMS.                     */
/*                                                                  */
/* GET THE PRINTER FILE AND ANY OVERRIDES                           */
/*----------------------------------------------------------------- */
             CALL       PGM(PMG9XFR) PARM(' ' &COMP &TYPE &DEPT +
                          &OVERLAY &PGM &PRTF &ADDLOBJ &SENDPHONE +
                          &SENDFAX &OUTQ &HOLD &SAVE &DRAWER +
                          &PRTDEVTYPE &LENGTH &WIDTH &LPI &CPI +
                          &OVERFLOW &ROTATE &COMMENT1 &COMMENT2 +
                          &COMMENT3 &COMMENT4 &COMMENT5 &RECSTS)

             OVRPRTF    FILE(&PRTF) OUTQ(&OUTQ) HOLD(&HOLD) +
                          SAVE(&SAVE) USRDTA('MAKESHEET')

/* CALL THE PROGRAM TO PRINT THE MAKE SHEET WITH VARIANCE REPORT     */
             CALL       PGM(PMRVPFR) PARM('' &COMP &PRODTYPE &DATE +
                          &APPLIC &PRNTCMMTS &RPTTYPE)

/* SEND THE REPORT TO THE OUTQ FROM COMPANY DOCUMENT DEFAULT FILE    */
             DUPSPLF    FILE(&PRTF) JOB(*) OUTQ(&OUTQ) SPLNBR(*LAST) +
                          COPIES(2) USRDTA('MAKESHEET')

/* SEND THE SPOOLFILE TO THE MAKESHEET DISTRIBUTION LIST             */
/* GET EMAIL DIST LIST FOR TF MAKESHEET      */
GETEMLSC:     CALL       PGM(POMTXFR) PARM(' ' X'960F' 'MAKESHEET' &DISTSCH)
             ESEND/ESNDMAIL RECIPIENT(&DISTSCH) SUBJECT(&DESC) +
                          ATTLIST((* *PDF *N &PRTF))

/********    DLTSPLF    FILE(&PRTF) SELECT(*ALL)      ***************/
             MONMSG     MSGID(CPF3309)
             GOTO       CMDLBL(END)

 NOSPOOL:    SNDMSG     MSG('Send Make Sheet failed, please call +
                          Information Services') TOUSR(*REQUESTER)

 END:        ENDPGM
