// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKR2XFR
// ?Date: 14.08.2025 Time: 02:52:36
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Number
ENDDO;

EXECUTE FUNCTION(Upd Sorting Amount    RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1222008;
PARAMETER(PAR.Sorting_Amount_Type_USR);
{
 //?USER: Process Data record

 // PAR.Addt Cst Ttl Usr = CON.*ZERO
 PAR.Addt_Cst_Ttl_Usr = *ZERO;

 // PAR.TH Sorting Amount = CON.*ZERO
 PAR.TH_Sorting_Amount = *ZERO;

 EXECUTE FUNCTION(Rtv Ded/Add Seaboards RT) TYPE(RTVOBJ) FILE(PKCDCPP)           AB1211532;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(PAR.Addt_Cst_Ttl_Usr);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Addt Cst Ttl Usr = PAR.Addt Cst Ttl Usr + DB1.THD Ded/Add Amount
  PAR.Addt_Cst_Ttl_Usr = PAR.Addt_Cst_Ttl_Usr + DB1.THD_Ded_Add_Amount;

 }

 CASE;

 // IF PAR.Sorting Amount Type USR is Gross Margin /Hd
 IF PAR.Sorting_Amount_Type_USR = '2';

 CASE;

 // IF DB1.TH Head Killed is Not Zero
 IF DB1.TH_Head_Killed <> *ZERO;

 // Gross Margin
 PAR.TH_Sorting_Amount = ( ( ( DB1.TH_Kill_Product_Value + DB1.TH_Cut_Product_Value )
 + DB1.TH_Render_Product_Value ) - ( DB1.TH_Payment_Gross + PAR.Addt_Cst_Ttl_Usr ) )               +
 / DB1.TH_Head_Killed;

 ENDIF;

 // IF PAR.Sorting Amount Type USR is Gross Value /Live CWT
 IF PAR.Sorting_Amount_Type_USR = '1';

 CASE;

 // IF DB1.TH Live Wgt is Not Zero
 IF DB1.TH_Live_Wgt > *ZERO;

 // Gross Value /Live CWT
 PAR.TH_Sorting_Amount = ( DB1.TH_Payment_Gross + PAR.Addt_Cst_Ttl_Usr ) / (
 DB1.TH_Live_Wgt / 100 ) + 'H';

 ENDIF;

 ENDIF;

 EXECUTE FUNCTION(Upd Sorting Amount    CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1222009;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(PAR.TH_Sorting_Amount);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


