     H/TITLE Exc Upd CIR 2 Prod-EDI XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 02/18/25  Time  : 10:26:41
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FECP004L1IF  E           K        DISK
      * RTV : EDI Purchase Order Header Retrieval index
      *
     FECP005L3IF  E           K        DISK
      * RSQ : EDI Purchase Order Detail ST02-TRANS SET Ctl/Seq
      *
     FPOBIREL1IF  E           K        DISK
      * RTV : Customer Item Reference   Retrieval index
      *
     FPOBIREL2IF  E           K        DISK
      * RSQ : Customer Item Reference   Ship to, CIR Resource
      *
     FPUBQREL1IF  E           K        DISK
      * RTV : Customer Item Ref for EDI Retrieval index
      *
     FPUBQREL0UF  E           K        DISK                      A
      * UPD : Customer Item Ref for EDI Update index
      *
     FPOBIREL0IF  E           K        DISK                      A
      * UPD : Customer Item Reference   Update index
      *
     FPUBSCPL0IF  E           K        DISK                      A
      * UPD : WF EDI PO Detail          Update index
      *
     E                    A1         07  1
     E                    A2         07  1
     I@P004LA
      * EDI Purchase Order Header Retrieval index
      * Renamed input format fields
     I              BQTSCN                          WATSCN
     I              BQL3SX                          WAL3SX
     I              BQOSDT                          WAOSDT
     I              BQPONO                          WAPONO
     I              BQDKAA                          WADKAA
     I              BQNAME                          WANAME
     I              BQCQLF                          WACQLF
     I              BQCNUM                          WACNUM
     I              BQINRF                          WAINRF
     I              BQGNTX                          WAGNTX
     I              BQHUAA                          WAHUAA
     I              BQHUVL                          WAHUVL
     I              BQHVAA                          WAHVAA
     I              BQX8T1                          WAX8T1
     I              BQJ2AA                          WAJ2AA
     I              BQT6DT                          WAT6DT
     I              BQQLFX                          WAQLFX
     I              BQDELV                          WADELV
     I              BQSHMT                          WASHMT
     I              BQMTTY                          WAMTTY
     I              BQPLEX                          WAPLEX
     I              BQLDOP                          WALDOP
     I              BQROUT                          WAROUT
     I              BQFOBP                          WAFOBP
     I              BQD3VL                          WAD3VL
     I              BQUNIT                          WAUNIT
     I              BQD4VL                          WAD4VL
     I              BQAMTX                          WAAMTX
     I              BQDSTS                          WADSTS
     I              BQSRAA                          WASRAA
     I              BQBRU1                          WABRU1
     I              BQSSAA                          WASSAA
     I              BQBSU1                          WABSU1
     I              BQSTAA                          WASTAA
     I              BQBTU1                          WABTU1
     I              BQSUAA                          WASUAA
     I              BQBUU1                          WABUU1
     I              BQSVAA                          WASVAA
     I              BQBVU1                          WABVU1
     I              BQSWAA                          WASWAA
     I              BQBWU1                          WABWU1
     I              BQSXAA                          WASXAA
     I              BQBXU1                          WABXU1
     I              BQYDT1                          WAYDT1
     I              BQNLST                          WANLST
     I              BQUFDT                          WAUFDT
     I              BQOJAA                          WAOJAA
     I              BQJ5NX                          WAJ5NX
      *
     I@P005O1
      * EDI Purchase Order Detail ST02-TRANS SET Ctl/Seq
      * Renamed input format fields
     I              BRTSCN                          WBTSCN
     I              BRSEQX                          WBSEQX
     I              BRLEST                          WBLEST
     I              BRS2NY                          WBS2NY
     I              BRD5VL                          WBD5VL
     I              BRUNIT                          WBUNIT
     I              BRPRCX                          WBPRCX
     I              BRUPCX                          WBUPCX
     I              BRPRQL                          WBPRQL
     I              BRPRID                          WBPRID
     I              BRDESC                          WBDESC
     I              BRR2AA                          WBR2AA
     I              BRAOU1                          WBAOU1
     I              BRR4AA                          WBR4AA
     I              BRAQU1                          WBAQU1
     I              BRR3AA                          WBR3AA
     I              BRAPU1                          WBAPU1
     I              BRYCT1                          WBYCT1
     I              BRNKST                          WBNKST
     I              BRUEDT                          WBUEDT
     I              BROIAA                          WBOIAA
     I              BRMJVL                          WBMJVL
     I              BRUINY                          WBUINY
      *
     I@BIREKY
      * Customer Item Reference   Retrieval index
      * Renamed input format fields
     I              BIBKC7                          WCBKC7
     I              BIHGCD                          WCHGCD
     I              BICOAA                          WCCOAA
     I              BICPAA                          WCCPAA
     I              BIPSNA                          WCPSNA
     I              BIPTNA                          WCPTNA
     I              BIPUNA                          WCPUNA
     I              BILBSX                          WCLBSX
     I              BILCSX                          WCLCSX
     I              BILDSX                          WCLDSX
     I              BILESX                          WCLESX
     I              BILFSX                          WCLFSX
     I              BIVSST                          WCVSST
     I              BIMJDT                          WCMJDT
     I              BIBETM                          WCBETM
     I              BICCVN                          WCCCVN
     I              BICDVN                          WCCDVN
     I              BIMKDT                          WCMKDT
     I              BIBFTM                          WCBFTM
     I              BICEVN                          WCCEVN
     I              BICFVN                          WCCFVN
      *
     I@BIRECZ
      * Customer Item Reference   Ship to, CIR Resource
      * Renamed input format fields
     I              BIBKC7                          WDBKC7
     I              BIHGCD                          WDHGCD
     I              BICOAA                          WDCOAA
     I              BICPAA                          WDCPAA
     I              BIPSNA                          WDPSNA
     I              BIPTNA                          WDPTNA
     I              BIPUNA                          WDPUNA
     I              BILBSX                          WDLBSX
     I              BILCSX                          WDLCSX
     I              BILDSX                          WDLDSX
     I              BILESX                          WDLESX
     I              BILFSX                          WDLFSX
     I              BIVSST                          WDVSST
     I              BIMJDT                          WDMJDT
     I              BIBETM                          WDBETM
     I              BICCVN                          WDCCVN
     I              BICDVN                          WDCDVN
     I              BIMKDT                          WDMKDT
     I              BIBFTM                          WDBFTM
     I              BICEVN                          WDCEVN
     I              BICFVN                          WDCFVN
      *
     I@BQREF3
      * Customer Item Ref for EDI Retrieval index
      * Renamed input format fields
     I              BQJ5NX                          WEJ5NX
     I              BQHGCD                          WEHGCD
     I              BQLDSX                          WELDSX
     I              BQCPAA                          WECPAA
     I              BQCOAA                          WECOAA
     I              BQVLNA                          WEVLNA
     I              BQPTNA                          WEPTNA
     I              BQPUNA                          WEPUNA
     I              BQLBSX                          WELBSX
     I              BQLCSX                          WELCSX
     I              BQLESX                          WELESX
     I              BQLFSX                          WELFSX
     I              BQVSST                          WEVSST
     I              BQMJDT                          WEMJDT
     I              BQBETM                          WEBETM
     I              BQCCVN                          WECCVN
     I              BQCDVN                          WECDVN
     I              BQMKDT                          WEMKDT
     I              BQBFTM                          WEBFTM
     I              BQCEVN                          WECEVN
     I              BQCFVN                          WECFVN
      *
     I@BQREF2
      * Customer Item Ref for EDI Update index
      * Renamed input format fields
     I              BQJ5NX                          WFJ5NX
     I              BQHGCD                          WFHGCD
     I              BQLDSX                          WFLDSX
     I              BQCPAA                          WFCPAA
     I              BQCOAA                          WFCOAA
     I              BQVLNA                          WFVLNA
     I              BQPTNA                          WFPTNA
     I              BQPUNA                          WFPUNA
     I              BQLBSX                          WFLBSX
     I              BQLCSX                          WFLCSX
     I              BQLESX                          WFLESX
     I              BQLFSX                          WFLFSX
     I              BQVSST                          WFVSST
     I              BQMJDT                          WFMJDT
     I              BQBETM                          WFBETM
     I              BQCCVN                          WFCCVN
     I              BQCDVN                          WFCDVN
     I              BQMKDT                          WFMKDT
     I              BQBFTM                          WFBFTM
     I              BQCEVN                          WFCEVN
     I              BQCFVN                          WFCFVN
      *
     I@BIREKX
      * Customer Item Reference   Update index
      * Renamed input format fields
     I              BIBKC7                          WGBKC7
     I              BIHGCD                          WGHGCD
     I              BICOAA                          WGCOAA
     I              BICPAA                          WGCPAA
     I              BIPSNA                          WGPSNA
     I              BIPTNA                          WGPTNA
     I              BIPUNA                          WGPUNA
     I              BILBSX                          WGLBSX
     I              BILCSX                          WGLCSX
     I              BILDSX                          WGLDSX
     I              BILESX                          WGLESX
     I              BILFSX                          WGLFSX
     I              BIVSST                          WGVSST
     I              BIMJDT                          WGMJDT
     I              BIBETM                          WGBETM
     I              BICCVN                          WGCCVN
     I              BICDVN                          WGCDVN
     I              BIMKDT                          WGMKDT
     I              BIBFTM                          WGBFTM
     I              BICEVN                          WGCEVN
     I              BICFVN                          WGCFVN
      *
     I@BSCPGI
      * WF EDI PO Detail          Update index
      * Renamed input format fields
     I              BSE3NZ                          WHE3NZ
     I              BSSEQX                          WHSEQX
     I              BSJ5NX                          WHJ5NX
     I              BSPONO                          WHPONO
     I              BSOSDT                          WHOSDT
     I              BSUPCX                          WHUPCX
     I              BSDESC                          WHDESC
     I              BSPRQL                          WHPRQL
     I              BSPRID                          WHPRID
     I              BSR2AA                          WHR2AA
     I              BSAOU1                          WHAOU1
     I              BSR4AA                          WHR4AA
     I              BSAQU1                          WHAQU1
     I              BSR3AA                          WHR3AA
     I              BSAPU1                          WHAPU1
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPUBQ1    E DSPUBQREL0
      * UPD : Customer Item Ref for EDI Update index
      * Renamed input format fields
     I              BQJ5NX                          WFJ5NX
     I              BQHGCD                          WFHGCD
     I              BQLDSX                          WFLDSX
     I              BQCPAA                          WFCPAA
     I              BQCOAA                          WFCOAA
     I              BQVLNA                          WFVLNA
     I              BQPTNA                          WFPTNA
     I              BQPUNA                          WFPUNA
     I              BQLBSX                          WFLBSX
     I              BQLCSX                          WFLCSX
     I              BQLESX                          WFLESX
     I              BQLFSX                          WFLFSX
     I              BQVSST                          WFVSST
     I              BQMJDT                          WFMJDT
     I              BQBETM                          WFBETM
     I              BQCCVN                          WFCCVN
     I              BQCDVN                          WFCDVN
     I              BQMKDT                          WFMKDT
     I              BQBFTM                          WFBFTM
     I              BQCEVN                          WFCEVN
     I              BQCFVN                          WFCFVN
      *
     IYARDCS      DS                            190
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPOBI1    E DSPOBIREL0
      * UPD : Customer Item Reference   Update index
      * Renamed input format fields
     I              BIBKC7                          WGBKC7
     I              BIHGCD                          WGHGCD
     I              BICOAA                          WGCOAA
     I              BICPAA                          WGCPAA
     I              BIPSNA                          WGPSNA
     I              BIPTNA                          WGPTNA
     I              BIPUNA                          WGPUNA
     I              BILBSX                          WGLBSX
     I              BILCSX                          WGLCSX
     I              BILDSX                          WGLDSX
     I              BILESX                          WGLESX
     I              BILFSX                          WGLFSX
     I              BIVSST                          WGVSST
     I              BIMJDT                          WGMJDT
     I              BIBETM                          WGBETM
     I              BICCVN                          WGCCVN
     I              BICDVN                          WGCDVN
     I              BIMKDT                          WGMKDT
     I              BIBFTM                          WGBFTM
     I              BICEVN                          WGCEVN
     I              BICFVN                          WGCFVN
      *
     IQPUBS1    E DSPUBSCPL0
      * UPD : WF EDI PO Detail          Update index
      * Renamed input format fields
     I              BSE3NZ                          WHE3NZ
     I              BSSEQX                          WHSEQX
     I              BSJ5NX                          WHJ5NX
     I              BSPONO                          WHPONO
     I              BSOSDT                          WHOSDT
     I              BSUPCX                          WHUPCX
     I              BSDESC                          WHDESC
     I              BSPRQL                          WHPRQL
     I              BSPRID                          WHPRID
     I              BSR2AA                          WHR2AA
     I              BSAOU1                          WHAOU1
     I              BSR4AA                          WHR4AA
     I              BSAQU1                          WHAQU1
     I              BSR3AA                          WHR3AA
     I              BSAPU1                          WHAPU1
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: EDI Purchase Order Header
      * I :  ST02-TRANS SET CONTROL NU
     I                                    P   1   50P1TSCN
     IP2PARM      DS
      * I :  Ship To Customer
     I                                    P   1   40P2BKC7
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1TSCN    PARM           WP0001  90       ST02-TRANS SET
     C           P2BKC7    PARM           WP0002  70       Ship To Custome
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Upd CIR 2 Prod-EDI XF
      * ***NOTE: Similar logic also exist in PUOEXFR. Any logic changes
      *          here should also consider changing in PUOEXFR. ***
      * Rtv Upd CIR 2 Prod-EDI RT - EDI Purchase Order Header  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Upd CIR 2 Prod-EDI RT - EDI Purchase Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WATSCN           ST02-TRANS SET
      * Setup key
     C                     Z-ADDP1TSCN    WATSCN           ST02-TRANS SET
      * Establish starting position
     C           KRSSA     CHAIN@P004LA              90    *
      * Data record not found
     C   90                MOVEL'USR3103' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * RTV Upd CIR 2 Product RT - EDI Purchase Order Detail  * 
     C                     EXSR SBRVGN
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Upd CIR 2 Product RT - EDI Purchase Order Detail  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  2        CIR Resource No
     C                     MOVEL*BLANK    WN0002 14        CIR Resource No
     C                     Z-ADD*ZERO     WN0003  70       Item Code Numbe
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * WI 458 RMC 1/25/2021 add resource "IN" (Walmrt sends it)
      *   sent in G6807/PO110 Prod ID Qual
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBTSCN    WQSB01           ST02-TRANS SET
      * Define keylist
     C           KPSSB     KLIST
     C                     KFLD           WQSB01           ST02-TRANS SET
     C                     KFLD           WBSEQX           ITEM SEQUENCE N
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           ST02-TRANS SET
      * Setup key
     C                     Z-ADDWATSCN    WQSB01           ST02-TRANS SET
     C                     Z-ADD*ZERO     WBSEQX           ITEM SEQUENCE N
      * Establish starting position
     C           KPSSB     SETLL@P005O1                    *
     C           KRSSB     READE@P005O1                  90*
      * Data record not found
     C   90                MOVEL'USR3105' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * W103972 DN 07/19/22-Initialize.
     C                     MOVEL'N'       YL0001           Crt Cust Item R
      * Get Seaboard Item code
     C                     MOVEL*BLANK    YL0002           CIR Resource No
     C                     Z-ADD*ZERO     WN0003           Item Code Numbe
      * CASE: DB1.POD SBD Item Number is Entered
     C           WBMJVL    IFNE 0                          *IF
     C                     Z-ADDWBMJVL    WN0003           Item Code Numbe
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     END                             *FI
      * CASE: PAR.Item Code Number 7.0  USR is Not Entered
     C           WN0003    IFEQ 0                          *IF
      * G6805 check
      * CASE:
      *  - c1 OR c2 OR c3
      *   |- c1    : DB1.G6805/P108 PROD ID QUAL is Vendor Product
      *   |- c2    : DB1.G6805/P108 PROD ID QUAL is Vendor Product 2
      *   |- c3    : DB1.G6805/P108 PROD ID QUAL is Manufacturer Part Num
      *   '-
     C           WBPRQL    IFEQ 'VP'                       *IF
     C           WBPRQL    OREQ 'VN'                       *OR
     C           WBPRQL    OREQ 'MG'                       *OR
     C                     MOVELWBPRID    WUY8TX           Text USR 7
      * RTV Right Just  7 Alph US - /UT User Source  * 
     C                     MOVEAWUY8TX    A1
     C                     MOVEA*BLANKS   A2
     C                     MOVE 07        C1      20
     C                     MOVE 07        C2      20
     C           C1        DOWGT0
     C           A1,C1     IFNE ' '
     C                     MOVE A1,C1     A2,C2
     C           C2        SUB  1         C2
     C                     END
     C           C1        SUB  1         C1
     C                     END
     C                     MOVEAA2        WUZ3TX
     C                     MOVE WUZ3TX    YL0004           USR Item Code 7
     C                     Z-ADDYL0004    YL0005           Item Code Numbe
      * Rtv CIR Resource      RT - Customer Item Reference  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP2BKC7    WL0001           Ship To Custome
     C                     Z-ADDYL0005    WL0002           Item Code
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    YL0002    P      CIR Resource No
      * CASE: LCL.CIR Resource No is Entered
     C           YL0002    IFNE *BLANK                     *IF
     C                     Z-ADDYL0005    WN0003           Item Code Numbe
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     YL0005           Item Code Numbe
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * G6807 check
      * CASE: PAR.Item Code Number 7.0  USR is Not Entered
     C           WN0003    IFEQ 0                          *IF
      * CASE:
      *  - c1ORc2ORc3ORc4
      *   |- c1    : DB1.G6807/PO110 Prod ID Qual is Vendor Product 1
      *   |- c2    : DB1.G6807/PO110 Prod ID Qual is Vendor Product 2
      *   |- c3    : DB1.G6807/PO110 Prod ID Qual is Manufacturer Part Nu
      *   |- c4    : DB1.G6807/PO110 Prod ID Qual is GTIN/UPC Code
      *   '-
     C           WBR2AA    IFEQ 'VP'                       *IF
     C           WBR2AA    OREQ 'VN'                       *OR
     C           WBR2AA    OREQ 'MG'                       *OR
     C           WBR2AA    OREQ 'UK'                       *OR
      * S17059 DN 04/28/21-Added 'GTIN/UPC Code' (UK) Condition c4.
     C                     MOVELWBAOU1    WUY8TX           Text USR 7
      * RTV Right Just  7 Alph US - /UT User Source  * 
     C                     MOVEAWUY8TX    A1
     C                     MOVEA*BLANKS   A2
     C                     MOVE 07        C1      20
     C                     MOVE 07        C2      20
     C           C1        DOWGT0
     C           A1,C1     IFNE ' '
     C                     MOVE A1,C1     A2,C2
     C           C2        SUB  1         C2
     C                     END
     C           C1        SUB  1         C1
     C                     END
     C                     MOVEAA2        WUZ3TX
     C                     MOVE WUZ3TX    YL0004           USR Item Code 7
     C                     Z-ADDYL0004    YL0005           Item Code Numbe
      * Rtv CIR Resource      RT - Customer Item Reference  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP2BKC7    WL0001           Ship To Custome
     C                     Z-ADDYL0005    WL0002           Item Code
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    YL0002    P      CIR Resource No
      * CASE: LCL.CIR Resource No is Entered
     C           YL0002    IFNE *BLANK                     *IF
     C                     Z-ADDYL0005    WN0003           Item Code Numbe
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WN0003           Item Code Numbe
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 11/30/22 DN W108770-Removed 'UK' Qualifier. Check IDUPC Field Ins
      *   Commented out & moved 'UK' check below.
      * IT = purch item code
      * CASE: PAR.Item Code Number 7.0  USR is Not Entered
     C           WN0003    IFEQ 0                          *IF
      * CASE: DB1.G6807/PO110 Prod ID Qual is Purchaser Product 3
     C           WBR2AA    IFEQ 'IT'                       *IF
      * CASE: DB1.G6808/PO111 Prod ID is Entered
     C           WBAOU1    IFNE *BLANK                     *IF
      * Rtv CIR Ref item      RT - Customer Item Reference  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP2BKC7    WL0004           Ship To Custome
     C                     MOVELWBAOU1    WL0006    P      CIR Resource No
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0005    YL0006           Item Code
     C                     MOVELWL0007    YN0001    P      CIR UM Base Pri
      * CASE: LCL.Item Code is Entered
     C           YL0006    IFNE 0                          *IF
     C                     Z-ADDYL0006    WN0003           Item Code Numbe
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Catchall
      * CASE: PAR.Item Code Number 7.0  USR is Not Entered
     C           WN0003    IFEQ 0                          *IF
     C                     Z-ADD*ZERO     YL0006           Item Code
      * CASE: DB1.G6806/P109 PRODUCT ID is Not Blank
     C           WBPRID    IFNE *BLANK                     *IF
      * Rtv CIR Ref item      RT - Customer Item Reference  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP2BKC7    WL0004           Ship To Custome
     C                     MOVELWBPRID    WL0006    P      CIR Resource No
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0005    YL0006           Item Code
     C                     MOVELWL0007    YN0001    P      CIR UM Base Pri
      * CASE: LCL.Item Code is Entered
     C           YL0006    IFNE 0                          *IF
     C                     Z-ADDYL0006    WN0003           Item Code Numbe
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     END                             *FI
     C                     END                             *FI
      * CASE: LCL.Item Code is Not Entered
     C           YL0006    IFEQ 0                          *IF
      * CASE: DB1.G6808/PO111 Prod ID is Entered
     C           WBAOU1    IFNE *BLANK                     *IF
      * Rtv CIR Ref item      RT - Customer Item Reference  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP2BKC7    WL0004           Ship To Custome
     C                     MOVELWBAOU1    WL0006    P      CIR Resource No
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0005    YL0006           Item Code
     C                     MOVELWL0007    YN0001    P      CIR UM Base Pri
      * CASE: LCL.Item Code is Entered
     C           YL0006    IFNE 0                          *IF
     C                     Z-ADDYL0006    WN0003           Item Code Numbe
     C                     MOVELWBAOU1    YL0002           CIR Resource No
     C                     MOVEL'Y'       YL0003           Item Code Exist
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * If no product id then zero out SBD item number
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Item Code Number 7.0  USR is Not Entered
      *   |- c2    : LCL.Item Code Exist USR is No
      *   '-
     C           WN0003    IFEQ 0                          *IF
     C           YL0003    OREQ 'N'                        *OR
     C                     Z-ADD*ZERO     WN0003           Item Code Numbe
     C                     END                             *FI
     C                     MOVELYL0002    WN0002           CIR Resource No
      * CASE: PAR.Item Code Number 7.0  USR is Entered
     C           WN0003    IFNE 0                          *IF
      * UPC
      * CASE: DB1.POD Unused GTIN is Entered
     C           WBAPU1    IFNE *BLANK                     *IF
     C                     MOVEL'UP'      WN0001           CIR Resource No
     C                     MOVELWBAPU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * VP/VN/MF/UA/PI G807
      * CASE:
      *  - c1ORc2ORc3ORc4ORc5ORc6
      *   |- c1    : DB1.G6807/PO110 Prod ID Qual is Vendor Product 1
      *   |- c2    : DB1.G6807/PO110 Prod ID Qual is Vendor Product 2
      *   |- c3    : DB1.G6807/PO110 Prod ID Qual is Manufacturer Part Nu
      *   |- c4    : DB1.G6807/PO110 Prod ID Qual is Purchaser Product 1
      *   |- c5    : DB1.G6807/PO110 Prod ID Qual is UA
      *   |- c6    : DB1.G6807/PO110 Prod ID Qual is Purchaser Product 2
      *   '-
     C           WBR2AA    IFEQ 'VP'                       *IF
     C           WBR2AA    OREQ 'VN'                       *OR
     C           WBR2AA    OREQ 'MG'                       *OR
     C           WBR2AA    OREQ 'PI'                       *OR
     C           WBR2AA    OREQ 'UA'                       *OR
     C           WBR2AA    OREQ 'IN'                       *OR
      * CASE: DB1.G6807/PO110 Prod ID Qual is UA
     C           WBR2AA    IFEQ 'UA'                       *IF
     C                     MOVEL'PI'      WN0001           CIR Resource No
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWBR2AA    WN0001           CIR Resource No
     C                     END                             *FI
     C                     MOVELWBAOU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * VP  G805
      * CASE:
      *  - c1ORc2ORc3ORc4
      *   |- c1    : DB1.G6805/P108 PROD ID QUAL is Vendor Product
      *   |- c2    : DB1.G6805/P108 PROD ID QUAL is Vendor Product 2
      *   |- c3    : DB1.G6805/P108 PROD ID QUAL is Manufacturer Part Num
      *   |- c4    : DB1.G6805/P108 PROD ID QUAL is Purchaser Product 1
      *   '-
     C           WBPRQL    IFEQ 'VP'                       *IF
     C           WBPRQL    OREQ 'VN'                       *OR
     C           WBPRQL    OREQ 'MG'                       *OR
     C           WBPRQL    OREQ 'PI'                       *OR
     C                     MOVELWBPRQL    WN0001           CIR Resource No
     C                     MOVEL*BLANK    WN0002           CIR Resource No
     C                     MOVELWBPRID    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * SK = SKU
      * CASE: DB1.G6807/PO110 Prod ID Qual is Sku
     C           WBR2AA    IFEQ 'SK'                       *IF
     C                     MOVEL'SK'      WN0001           CIR Resource No
     C                     MOVELWBAOU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * UP = consumer pkg code
      * CASE: DB1.G6807/PO110 Prod ID Qual is UPC Comsumer Pkg Code
     C           WBR2AA    IFEQ 'UP'                       *IF
     C                     MOVEL'UP'      WN0001           CIR Resource No
     C                     MOVELWBAOU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * IT = item code
      * CASE: DB1.G6807/PO110 Prod ID Qual is Purchaser Product 3
     C           WBR2AA    IFEQ 'IT'                       *IF
     C                     MOVEL'IT'      WN0001           CIR Resource No
     C                     MOVELWBAOU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * 07/19/22 DN W103972-Add Additional Resource Type to Process Here.
      * CASE: *OTHERWISE
      * CB = Buyer Catalog Number
      * CASE: DB1.G6807/PO110 Prod ID Qual is Buyer Catalog Number
     C           WBR2AA    IFEQ 'CB'                       *IF
     C                     MOVEL'CB'      WN0001           CIR Resource No
     C                     MOVELWBAOU1    WN0002           CIR Resource No
     C                     MOVEL'Y'       YL0001           Crt Cust Item R
     C                     END                             *FI
      * BP = Buyer Part Nbr
      * CASE: DB1.G6807/PO110 Prod ID Qual is Buyer Part Nbr
     C           WBR2AA    IFEQ 'BP'                       *IF
     C                     MOVEL'BP'      WN0001           CIR Resource No
     C                     MOVELWBAOU1    WN0002           CIR Resource No
     C                     MOVEL'Y'       YL0001           Crt Cust Item R
     C                     END                             *FI
      * Create Customer Item Ref for EDI Record?
      * CASE: LCL.Crt Cust Item Ref for EDI is Yes
     C           YL0001    IFEQ 'Y'                        *IF
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * UP = UP Case code     rmc added 3/26/21
      * CASE: DB1.P106 UPC/GTIN QUAL is UPC Package Code
     C           WBR3AA    IFEQ 'UP'                       *IF
     C                     MOVEL'UP'      WN0001           CIR Resource No
     C                     MOVELWBAPU1    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
      * GTIN = UK                                    12/07/22 DN W108770
      * CASE: DB1.G6804/P107 UPC/GTIN CODE is Entered
     C           WBUPCX    IFNE *BLANK                     *IF
      * Val UK Val Data Length XF - EDI Purchase Order Detail  * 
     C                     CALL 'PUXVXFR'              90  Val UK Val Data
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WBUPCX    WQ0001 15        G6804/P107 UPC/
     C           YL0012    PARM *BLANK    WQ0002  1        Validation Pass
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUXVXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * 'UK' Data Value Length is 14, Then Proceed.
      * CASE: LCL.Validation Pass USR is Yes
     C           YL0012    IFEQ 'Y'                        *IF
     C                     MOVEL'UK'      WN0001           CIR Resource No
     C                     MOVELWBUPCX    WN0002           CIR Resource No
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWAJ5NX    WL0008    P      EDI Trading Par
     C                     Z-ADDWN0003    WL0009           Item Code
     C                     MOVELWN0001    WL0010    P      CIR Resource No
     C                     MOVELWN0002    WL0011    P      CIR Resource No
     C                     MOVELWBDESC    WL0012    P      CIR Description
     C                     EXSR SERVGN
     C                     END                             *FI
     C                     END                             *FI
      * S17059 DN 04/26/21-Create Customer Item Reference Record if Not F
      * CASE: DB1.G6807/PO110 Prod ID Qual is Entered
     C           WBR2AA    IFNE *BLANK                     *IF
      * W100147 DN 05/27/22-Added 'CIR UM Base Price' as Input Parm.
      * Upd Crt Cust Item Ref  RT - Customer Item Reference  * 
     C                     EXSR SHRVGN
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Crt WF EDI PO Detail  CR - WF EDI PO Detail  * 
     C                     EXSR SJCRRC
     C                     END                             *FI
     C           KRSSB     READE@P005O1                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv CIR Resource      RT - Customer Item Reference  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCBKC7           Ship To Custome
     C                     KFLD           WCHGCD           Item Code
      * Setup key
     C                     Z-ADDWL0001    WCBKC7           Ship To Custome
     C                     Z-ADDWL0002    WCHGCD           Item Code
      * Establish starting position
     C           KRSSC     CHAIN@BIREKY              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3081' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0003           CIR Resource No
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCCOAA    WL0003           CIR Resource No
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv CIR Ref item      RT - Customer Item Reference  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDBKC7    WQSD01           Ship To Custome
     C           *LIKE     DEFN WDCOAA    WQSD02           CIR Resource No
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Ship To Custome
     C                     KFLD           WQSD02           CIR Resource No
      * Setup key
     C                     Z-ADDWL0004    WQSD01           Ship To Custome
     C                     MOVELWL0006    WQSD02           CIR Resource No
      * Establish starting position
     C           KRSSD     SETLL@BIRECZ                    *
     C           KRSSD     READE@BIRECZ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3081' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WL0005           Item Code
     C                     MOVEL*BLANK    WL0007           CIR UM Base Pri
     C                     GOTO SDEXIT                     *QUIT
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWDHGCD    WL0005           Item Code
     C                     MOVELWDLESX    WL0007           CIR UM Base Pri
     C                     GOTO SDEXIT                     *QUIT
     C           KRSSD     READE@BIRECZ                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Chg/Ct CIR EDI    RT - Customer Item Ref for EDI  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WEJ5NX           EDI Trading Par
     C                     KFLD           WEHGCD           Item Code
     C                     KFLD           WELDSX           CIR Resource No
      * Setup key
     C                     MOVELWL0008    WEJ5NX           EDI Trading Par
     C                     Z-ADDWL0009    WEHGCD           Item Code
     C                     MOVELWL0010    WELDSX           CIR Resource No
      * Establish starting position
     C           KRSSE     CHAIN@BQREF3              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR5150' W0RTN   7
      * USER: Processing if Data record not found
      * Crt Customer Item Ref  CR - Customer Item Ref for EDI  * 
     C                     EXSR SFCRRC
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE: DB1.CIR Resource No NE PAR.CIR Resource No
     C           WECOAA    IFNE WL0011                     *IF
      * Chg Customer Item Ref CH - Customer Item Ref for EDI  * 
     C                     EXSR SGCHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * Crt Customer Item Ref  CR - Customer Item Ref for EDI  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BQREF2
     C                     MOVELWL0008    WFJ5NX           EDI Trading Par
     C                     Z-ADDWL0009    WFHGCD           Item Code
     C                     MOVELWL0010    WFLDSX           CIR Resource No
     C                     MOVEL*BLANK    WFCPAA           CIR Item No
     C                     MOVELWL0011    WFCOAA           CIR Resource No
     C                     MOVEL*BLANK    WFVLNA           CIR Description
     C                     MOVEL*BLANK    WFPTNA           CIR Description
     C                     MOVEL*BLANK    WFPUNA           CIR Description
     C                     MOVELYL0007    WFLBSX           CIR Unused Stat
     C                     MOVELYL0008    WFLCSX           CIR Unused Stat
     C                     MOVELYL0009    WFLESX           CIR UM Base Pri
     C                     MOVELYL0010    WFLFSX           CIR Unused Stat
     C                     MOVELYL0011    WFVSST           Record Status
     C                     Z-ADD*ZERO     WFMJDT           Create Date
     C                     Z-ADD*ZERO     WFBETM           Create Time
     C                     MOVEL*BLANK    WFCCVN           Create User
     C                     MOVEL*BLANK    WFCDVN           Create Program
     C                     Z-ADD*ZERO     WFMKDT           Change Date
     C                     Z-ADD*ZERO     WFBFTM           Change Time
     C                     MOVEL*BLANK    WFCEVN           Change User
     C                     MOVEL*BLANK    WFCFVN           Change Program
      *
      * USER: Processing before Data update
      * Set Crt Date/Time      IF
      * *** Set RECORD STATUS field. ***
     C                     MOVEL'A'       WFVSST           Record Status
      * *** Set CREATE fields. ***
     C                     Z-ADD##JDT     WFMJDT           Create Date
     C                     Z-ADD##JTM     WFBETM           Create Time
     C                     MOVEL##USR     WFCCVN           Create User
     C                     MOVEL##PGM     WFCDVN           Create Program
      * *** Set CHANGE fields. ***
     C                     Z-ADD*ZERO     WFMKDT           Change Date
     C                     Z-ADD*ZERO     WFBFTM           Change Time
     C                     MOVEL*BLANK    WFCEVN           Change User
     C                     MOVEL*BLANK    WFCFVN           Change Program
     C           KLCRSF    KLIST
     C                     KFLD           WFJ5NX           EDI Trading Par
     C                     KFLD           WFHGCD           Item Code
     C                     KFLD           WFLDSX           CIR Resource No
      * Check for duplicate primary key
     C           KLCRSF    SETLL@BQREF2                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5151' W0RTN   7
      * USER: Processing if Data record already exists
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@BQREF2                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCHRC    BEGSR
      *================================================================
      * Chg Customer Item Ref CH - Customer Item Ref for EDI  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BQREF2
     C                     MOVELWEJ5NX    WFJ5NX    P      EDI Trading Par
     C                     Z-ADDWEHGCD    WFHGCD           Item Code
     C                     MOVELWELDSX    WFLDSX    P      CIR Resource No
      *
     C           KLCHSG    KLIST
     C                     KFLD           WFJ5NX           EDI Trading Par
     C                     KFLD           WFHGCD           Item Code
     C                     KFLD           WFLDSX           CIR Resource No
     C           KLCHSG    CHAIN@BQREF2              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PUBQREL0'MDACP
     C                     MOVEL'@BQREF2' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPUBQ1    YARDCS
      * Move non-key fields to @BQREF2
     C                     MOVELWECPAA    WFCPAA    P      CIR Item No
     C                     MOVELWL0011    WFCOAA    P      CIR Resource No
     C                     MOVELWEVLNA    WFVLNA    P      CIR Description
     C                     MOVELWEPTNA    WFPTNA    P      CIR Description
     C                     MOVELWEPUNA    WFPUNA    P      CIR Description
     C                     MOVELWELBSX    WFLBSX    P      CIR Unused Stat
     C                     MOVELWELCSX    WFLCSX    P      CIR Unused Stat
     C                     MOVELWELESX    WFLESX    P      CIR UM Base Pri
     C                     MOVELWELFSX    WFLFSX    P      CIR Unused Stat
     C                     MOVELWEVSST    WFVSST    P      Record Status
     C                     Z-ADD*ZERO     WFMJDT           Create Date
     C                     Z-ADD*ZERO     WFBETM           Create Time
     C                     MOVEL*BLANK    WFCCVN    P      Create User
     C                     MOVEL*BLANK    WFCDVN    P      Create Program
     C                     Z-ADD*ZERO     WFMKDT           Change Date
     C                     Z-ADD*ZERO     WFBFTM           Change Time
     C                     MOVEL*BLANK    WFCEVN    P      Change User
     C                     MOVEL*BLANK    WFCFVN    P      Change Program
      *
      * Set PGM.*Record Data Changed flag
     C           QPUBQ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Chg Date/Time      IF
     C                     Z-ADD##JDT     WFMKDT           Change Date
     C                     Z-ADD##JTM     WFBFTM           Change Time
     C                     MOVEL##USR     WFCEVN           Change User
     C                     MOVEL##PGM     WFCFVN           Change Program
      * Set PGM.*Record Data Changed flag
     C           QPUBQ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BQREF2                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPUBQREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Upd Crt Cust Item Ref  RT - Customer Item Reference  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WCBKC7           Ship To Custome
     C                     KFLD           WCHGCD           Item Code
      * Setup key
     C                     Z-ADDP2BKC7    WCBKC7           Ship To Custome
     C                     Z-ADDWN0003    WCHGCD           Item Code
      * Establish starting position
     C           KRSSH     CHAIN@BIREKY              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3081' W0RTN   7
      * USER: Processing if Data record not found
      * W100147 DN 05/27/22-Added 'CIR UM Base Price' for Update.
      * Crt Cust Item Ref     CR - Customer Item Reference  * 
     C                     EXSR SICRRC
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICRRC    BEGSR
      *================================================================
      * Crt Cust Item Ref     CR - Customer Item Reference  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BIREKX
     C                     Z-ADDP2BKC7    WGBKC7           Ship To Custome
     C                     Z-ADDWN0003    WGHGCD           Item Code
     C                     MOVELWBAOU1    WGCOAA           CIR Resource No
     C                     MOVEL*BLANK    WGCPAA           CIR Item No
     C                     MOVEL*BLANK    WGPSNA           CIR Description
     C                     MOVEL*BLANK    WGPTNA           CIR Description
     C                     MOVEL*BLANK    WGPUNA           CIR Description
     C                     MOVELYL0013    WGLBSX           CIR Unused Stat
     C                     MOVELYL0013    WGLCSX           CIR Unused Stat
     C                     MOVELWBR2AA    WGLDSX           CIR Resource No
     C                     MOVELWBOIAA    WGLESX           CIR UM Base Pri
     C                     MOVELYL0013    WGLFSX           CIR Unused Stat
     C                     MOVEL'A'       WGVSST           Record Status
     C                     Z-ADD##JDT     WGMJDT           Create Date
     C                     Z-ADD##JTM     WGBETM           Create Time
     C                     MOVEL##USR     WGCCVN           Create User
     C                     MOVEL##PGM     WGCDVN           Create Program
     C                     Z-ADD*ZERO     WGMKDT           Change Date
     C                     Z-ADD*ZERO     WGBFTM           Change Time
     C                     MOVEL*BLANK    WGCEVN           Change User
     C                     MOVEL*BLANK    WGCFVN           Change Program
      *
      * USER: Processing before Data update
      * Set Crt Date/Time      IF
      * *** Set RECORD STATUS field. ***
     C                     MOVEL'A'       WGVSST           Record Status
      * *** Set CREATE fields. ***
     C                     Z-ADD##JDT     WGMJDT           Create Date
     C                     Z-ADD##JTM     WGBETM           Create Time
     C                     MOVEL##USR     WGCCVN           Create User
     C                     MOVEL##PGM     WGCDVN           Create Program
      * *** Set CHANGE fields. ***
     C                     Z-ADD*ZERO     WGMKDT           Change Date
     C                     Z-ADD*ZERO     WGBFTM           Change Time
     C                     MOVEL*BLANK    WGCEVN           Change User
     C                     MOVEL*BLANK    WGCFVN           Change Program
     C           KLCRSI    KLIST
     C                     KFLD           WGBKC7           Ship To Custome
     C                     KFLD           WGHGCD           Item Code
      * Check for duplicate primary key
     C           KLCRSI    SETLL@BIREKX                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3082' W0RTN   7
      * Send message 'Customer Item Referenc EX'
     C                     MOVEL'USR3082' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C                     WRITE@BIREKX                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCRRC    BEGSR
      *================================================================
      * Crt WF EDI PO Detail  CR - WF EDI PO Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BSCPGI
     C                     Z-ADDWBTSCN    WHE3NZ           ST02-TRANS SET
     C                     Z-ADDWBSEQX    WHSEQX           ITEM SEQUENCE N
     C                     MOVELWAJ5NX    WHJ5NX           EDI Trading Par
     C                     MOVELWAPONO    WHPONO           G5003-PURCHASE
     C                     Z-ADDWAOSDT    WHOSDT           G5002-ORDER DAT
     C                     MOVELWBUPCX    WHUPCX           G6804/P107 UPC/
     C                     MOVELWBDESC    WHDESC           G6901-ITEM DESC
     C                     MOVELWBPRQL    WHPRQL           G6805/P108 PROD
     C                     MOVELWBPRID    WHPRID           G6806/P109 PROD
     C                     MOVELWBR2AA    WHR2AA           G6807/PO110 Pro
     C                     MOVELWBAOU1    WHAOU1           G6808/PO111 Pro
     C                     MOVELWBR4AA    WHR4AA           PO112 Prod ID Q
     C                     MOVELWBAQU1    WHAQU1           PO113 Prod ID
     C                     MOVELWBR3AA    WHR3AA           P106 UPC/GTIN Q
     C                     MOVELWBAPU1    WHAPU1           POD Unused GTIN
      *
     C           KLCRSJ    KLIST
     C                     KFLD           WHE3NZ           ST02-TRANS SET
     C                     KFLD           WHSEQX           ITEM SEQUENCE N
      * Check for duplicate primary key
     C           KLCRSJ    SETLL@BSCPGI                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5159' W0RTN   7
      * Send message 'WF EDI PO Detail       EX'
     C                     MOVEL'USR5159' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C                     WRITE@BSCPGI                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      *
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WATSCN           ST02-TRANS SET
     C                     Z-ADD*ZERO     WAOSDT           G5002-ORDER DAT
     C                     Z-ADD*ZERO     WAHUVL           SAC05-$$ AMT OF
     C                     Z-ADD*ZERO     WAT6DT           G6202 Ship Date
     C                     Z-ADD*ZERO     WADELV           G6202-DELIVERY
     C                     Z-ADD*ZERO     WAD3VL           G7601-QUANTITY
     C                     Z-ADD*ZERO     WAD4VL           G7603-WEIGHT OR
     C                     Z-ADD*ZERO     WAAMTX           G7608-ORDER AMO
     C                     Z-ADD*ZERO     WAUFDT           POH Date Stamp
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBTSCN           ST02-TRANS SET
     C                     Z-ADD*ZERO     WBSEQX           ITEM SEQUENCE N
     C                     Z-ADD*ZERO     WBS2NY           POD Item Age Da
     C                     Z-ADD*ZERO     WBD5VL           G6801-QUANTITY
     C                     Z-ADD*ZERO     WBPRCX           G6803-ITEM LIST
     C                     Z-ADD*ZERO     WBUEDT           POD unused date
     C                     Z-ADD*ZERO     WBMJVL           POD SBD Item Nu
     C                     Z-ADD*ZERO     WBUINY           POD Pack Qty
      * Define work field Text USR 7
     C                     MOVEL*BLANK    WUY8TX  7
      * Define work field Text 7 Alpha Usr
     C                     MOVEL*BLANK    WUZ3TX  7
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCHGCD           Item Code
     C                     Z-ADD*ZERO     WCMJDT           Create Date
     C                     Z-ADD*ZERO     WCBETM           Create Time
     C                     Z-ADD*ZERO     WCMKDT           Change Date
     C                     Z-ADD*ZERO     WCBFTM           Change Time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WHE3NZ           ST02-TRANS SET
     C                     Z-ADD*ZERO     WHSEQX           ITEM SEQUENCE N
     C                     Z-ADD*ZERO     WHOSDT           G5002-ORDER DAT
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SCRVGN.
     C                     Z-ADD*ZERO     WL0001  70
     C                     Z-ADD*ZERO     WL0002  70
     C                     MOVEL*BLANK    WL0003 14
      * Define local variables for subroutine SDRVGN.
     C                     Z-ADD*ZERO     WL0004  70
     C                     Z-ADD*ZERO     WL0005  70
     C                     MOVEL*BLANK    WL0006 14
     C                     MOVEL*BLANK    WL0007  2
      * Define local variables for subroutine SERVGN.
     C                     MOVEL*BLANK    WL0008  6
     C                     Z-ADD*ZERO     WL0009  70
     C                     MOVEL*BLANK    WL0010  2
     C                     MOVEL*BLANK    WL0011 14
     C                     MOVEL*BLANK    WL0012 30
      * Define local work field Crt Cust Item Ref for EDI
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field CIR Resource No
     C                     MOVEL*BLANK    YL0002 14
      * Define local work field Item Code Exist USR
     C                     MOVEL*BLANK    YL0003  1
      * Define local work field USR Item Code 7,0 signed
     C                     Z-ADD*ZERO     YL0004  70
      * Define local work field Item Code Number 7.0  USR
     C                     Z-ADD*ZERO     YL0005  70
      * Define local work field Item Code
     C                     Z-ADD*ZERO     YL0006  70
      * Define null work field CIR UM Base Price
     C                     MOVEL*BLANK    YN0001  2
      * Define local work field CIR Unused Status 1
     C                     MOVEL*BLANK    YL0007  1
      * Define local work field CIR Unused Status 2
     C                     MOVEL*BLANK    YL0008  1
      * Define local work field CIR UM Base Price
     C                     MOVEL*BLANK    YL0009  2
      * Define local work field CIR Unused Status 5
     C                     MOVEL*BLANK    YL0010  3
      * Define local work field Record Status
     C                     MOVEL*BLANK    YL0011  1
      * Define local work field Validation Pass USR
     C                     MOVEL*BLANK    YL0012  1
      * Define local work field Blank 1 USR
     C                     MOVEL*BLANK    YL0013  1
      *================================================================
     CSR         ZZEXIT    ENDSR
