     H/TITLE Bal Kill Day          XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISRCENT
     H* Date          : 10/21/21  Time  : 09:49:56
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKC4REL1IF  E           K        DISK
      * RTV : Payment Processing Parms  Retrieval index
      *
     FPKCPCPL8IF  E           K        DISK
      * RSQ : Eval Trans UPL            Co/KillDte/Shift/Tattoo
      *
     FPKEXCPL1IF  E           K        DISK
      * RTV : Company Event             Retrieval index
      *
      * Long constants
     E                    @CN#    1  04  6   @CN    25
     I@C4REO7
      * Payment Processing Parms  Retrieval index
      * Renamed input format fields
     I              C4HONB                          WAHONB
     I              C4CKDT                          WACKDT
     I              C4M1NB                          WAM1NB
     I              C4KHST                          WAKHST
     I              C4KJST                          WAKJST
     I              C4PINB                          WAPINB
     I              C4KKST                          WAKKST
     I              C4AAVN                          WAAAVN
     I              C4AADT                          WAAADT
     I              C4AMTM                          WAAMTM
     I              C4AJST                          WAAJST
     I              C4AHVN                          WAAHVN
     I              C4AGVN                          WAAGVN
     I              C4ABVN                          WAABVN
     I              C4ABDT                          WAABDT
     I              C4ABTM                          WAABTM
      *
     I@CPCPZW
      * Eval Trans UPL            Co/KillDte/Shift/Tattoo
      * Renamed input format fields
     I              CPHKST                          WBHKST
     I              CPB7DT                          WBB7DT
     I              CPKINB                          WBKINB
     I              CPKHNB                          WBKHNB
     I              CPLNNB                          WBLNNB
     I              CPHLST                          WBHLST
     I              CPKJNB                          WBKJNB
     I              CPKKNB                          WBKKNB
     I              CPBQPC                          WBBQPC
     I              CPBRPC                          WBBRPC
     I              CPHMST                          WBHMST
     I              CPHNST                          WBHNST
     I              CPHTST                          WBHTST
     I              CPHUST                          WBHUST
     I              CPX6NB                          WBX6NB
     I              CPFQPC                          WBFQPC
     I              CPFRPC                          WBFRPC
     I              CPM7CD                          WBM7CD
     I              CPX7ST                          WBX7ST
     I              CPX8ST                          WBX8ST
     I              CPX9ST                          WBX9ST
     I              CPYAST                          WBYAST
     I              CPYBST                          WBYBST
     I              CPYCST                          WBYCST
     I              CPZJST                          WBZJST
     I              CPZKST                          WBZKST
     I              CPZLST                          WBZLST
     I              CPB8DT                          WBB8DT
     I              CPAOTM                          WBAOTM
      *
     I@EXCPEP
      * Company Event             Retrieval index
      * Renamed input format fields
     I              EXHONB                          WCHONB
     I              EXHECD                          WCHECD
     I              EXEMDT                          WCEMDT
     I              EXVUST                          WCVUST
     I              EXVVST                          WCVVST
     I              EXHXCD                          WCHXCD
     I              EXVWST                          WCVWST
     I              EXVXST                          WCVXST
     I              EXAAVN                          WCAAVN
     I              EXAADT                          WCAADT
     I              EXAMTM                          WCAMTM
     I              EXAJST                          WCAJST
     I              EXAHVN                          WCAHVN
     I              EXAGVN                          WCAGVN
     I              EXABVN                          WCABVN
     I              EXABDT                          WCABDT
     I              EXABTM                          WCABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  CC Company Number
     I                                    P   1   20P1HONB
     IP2PARM      DS
      * I :  MPR Job               USR
     I                                        1   1 P2WDST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Bal Hot Scl Trn Strt'
      * Kill Date Usr
     I                                    P   1   40ZA0001
      * Current Time
     I                                    P   5   80ZA0002
      * CC Company Number
     I                                    P   9  100ZA0003
      * Message data for 'Bal Upload Not Avail'
      * EA Shift
     I                                        1   1 ZA0004
      * Kill Date Usr
     I                                    P   2   50ZA0005
      * CC Company Number
     I                                    P   6   70ZA0006
      * Message data for 'SND Pager Message'
      * Pager Name USR
     I                                        1  10 ZA0007
      * Pager Msg USR
     I                                       11  90 ZA0008
      * Message data for 'Condemn Entry Pager Msg'
      * Current Kill Date
     I                                    P   1   40ZA0009
      * EA Shift
     I                                        5   5 ZA0010
      * CC Company Number
     I                                    P   6   70ZA0011
      * Message data for 'Condemn Entry Pager Msg'
      * Current Kill Date
     I                                    P   1   40ZA0012
      * EA Shift
     I                                        5   5 ZA0013
      * CC Company Number
     I                                    P   6   70ZA0014
      * Message data for 'Bal Create Eval Tran'
      * Kill Date Usr
     I                                    P   1   40ZA0015
      * Current Time
     I                                    P   5   80ZA0016
      * CC Company Number
     I                                    P   9  100ZA0017
      * Message data for 'Bal Val/Bal All Tattoos'
      * Kill Date Usr
     I                                    P   1   40ZA0018
      * Current Time
     I                                    P   5   80ZA0019
      * CC Company Number
     I                                    P   9  100ZA0020
      * Message data for 'Bal Val/Bal Completed'
      * Kill Date Usr
     I                                    P   1   40ZA0021
      * Current Time
     I                                    P   5   80ZA0022
      * CC Company Number
     I                                    P   9  100ZA0023
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HONB    PARM           WP0001  30       CC Company Numb
     C           P2WDST    PARM           WP0002  1        MPR Job
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Bal Kill Day          XF
      * RMC 10/21/21 WHD 86412 Validate for Eval Trans UPL not shift spec
      * ISE 11/04/20 H16853-Recompiled due to change in Buy Order Number
      * RMC 11/23/05 Added company to all messages:
      *        prk0913,-0914,-915,-0916,-0917, -0930
     C                     Z-ADDP1HONB    YL0001           CC Company Numb
      * RTV Payment Prc        RT - Payment Processing Parms  * 
     C                     EXSR SARVGN
      * Rtv Current Time      US - STR User Source Functions  * 
     C                     TIME           YL0004
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0001  30       BOH Company Num
     C                     PARM @CN,001   WQ0002 10        Company Value C
     C           YL0005    PARM *BLANK    WQ0003 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0005    YL0006           Office Dist Lis
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0001
     C                     Z-ADDYL0004    ZA0002           Current Time
     C                     Z-ADDYL0001    ZA0003           CC Company Numb
      * Retrieve message Bal Hot Scl Trn Strt
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0913' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0004 10        Office Dist Lis
     C                     PARM YL0007    WQ0005132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Validate Hot Scale Upload
     C                     EXSR UASUBR                     Validate Hot Sc
      * Validate Condemns Entry
     C                     EXSR UBSUBR                     Validate Condem
      * Continue Processing.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.Record Found Shift 1 USR is Yes/Blank
      *   |- c2    : LCL.Record Found Shift 2 USR is Yes/Blank
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0009    IFEQ *BLANK                     *IF
     C           YL0009    OREQ 'Y'
     C           YL0012    IFEQ *BLANK                     *IF
     C           YL0012    OREQ 'Y'
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Rtv Current Time      US - STR User Source Functions  * 
     C                     TIME           YL0004
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0015
     C                     Z-ADDYL0004    ZA0016           Current Time
     C                     Z-ADDYL0001    ZA0017           CC Company Numb
      * Retrieve message Bal Create Eval Tran
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0915' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0021 10        Office Dist Lis
     C                     PARM YL0007    WQ0022132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * UPD EvUPL - EvTrans    XF - Eval Trans UPL  * 
     C                     CALL 'PKO7XFR'              90  UPD EvUPL - EvT
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0023  30       EA Company Numb
     C                     PARM YL0002    WQ0024  70       EA Kill Date
     C                     PARM YL0013    WQ0025  1        EA Shift
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKO7XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rtv Current Time      US - STR User Source Functions  * 
     C                     TIME           YL0004
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0018
     C                     Z-ADDYL0004    ZA0019           Current Time
     C                     Z-ADDYL0001    ZA0020           CC Company Numb
      * Retrieve message Bal Val/Bal All Tattoos
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0916' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0026 10        Office Dist Lis
     C                     PARM YL0007    WQ0027132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Bal All Tattoos       XF - Tattoo Header  * 
     C                     CALL 'PKS8XFR'              90  Bal All Tattoos
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0028  30       CC Company Numb
     C                     PARM YL0002    WQ0029  70       Current Kill Da
     C                     PARM YL0014    WQ0030 40        Oms System Valu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKS8XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rtv Current Time      US - STR User Source Functions  * 
     C                     TIME           YL0004
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0021
     C                     Z-ADDYL0004    ZA0022           Current Time
     C                     Z-ADDYL0001    ZA0023           CC Company Numb
      * Retrieve message Bal Val/Bal Completed
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0917' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0031 10        Office Dist Lis
     C                     PARM YL0007    WQ0032132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Payment Prc        RT - Payment Processing Parms  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAHONB           CC Company Numb
      * Setup key
     C                     Z-ADDYL0001    WAHONB           CC Company Numb
      * Establish starting position
     C           KRSSA     CHAIN@C4REO7              90    *
      * Data record not found
     C   90                MOVEL'PRK0434' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWACKDT    YL0002           Pmt Current Pay
     C                     Z-ADDWAM1NB    YL0003           Pmt Current Pay
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Val Evl Trn b/Sft     RT - Eval Trans UPL  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHKST    WQSB01           EA Company Numb
     C           *LIKE     DEFN WBB7DT    WQSB02           EA Kill Date
      * Define keylist
     C           KPSSB     KLIST
     C                     KFLD           WQSB01           EA Company Numb
     C                     KFLD           WQSB02           EA Kill Date
     C                     KFLD           WBHLST           EA Shift
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           EA Company Numb
     C                     KFLD           WQSB02           EA Kill Date
      * Setup key
     C                     Z-ADDYL0001    WQSB01           EA Company Numb
     C                     Z-ADDYL0002    WQSB02           EA Kill Date
     C                     MOVEL'1'       WBHLST           EA Shift
      * Establish starting position
     C           KPSSB     SETLL@CPCPZW                    *
     C           KRSSB     READE@CPCPZW                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0341' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       YL0008           Record Found US
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y'       YL0008           Record Found US
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@CPCPZW                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Company Event     RT - Company Event  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCHONB           CC Company Numb
     C                     KFLD           WCHECD           EV Event Code
     C                     KFLD           WCEMDT           CE Kill Date
     C                     KFLD           WCVUST           CE Shift
      * Setup key
     C                     Z-ADDYL0001    WCHONB           CC Company Numb
     C                     MOVEL'CONDMN'  WCHECD           EV Event Code
     C                     Z-ADDYL0002    WCEMDT           CE Kill Date
     C                     MOVEL'1'       WCVUST           CE Shift
      * Establish starting position
     C           KRSSC     CHAIN@EXCPEP              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0923' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0010           CE Data Exist
     C                     MOVEL*BLANK    YL0011           CE User Initial
     C                     MOVEL*BLANK    YL0008           Record Found US
     C                     MOVEL'N'       YL0008           Record Found US
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCVVST    YL0010           CE Data Exist
     C                     MOVELWCHXCD    YL0011           CE User Initial
     C                     MOVEL'Y'       YL0008           Record Found US
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Company Event     RT - Company Event  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WCHONB           CC Company Numb
     C                     KFLD           WCHECD           EV Event Code
     C                     KFLD           WCEMDT           CE Kill Date
     C                     KFLD           WCVUST           CE Shift
      * Setup key
     C                     Z-ADDYL0001    WCHONB           CC Company Numb
     C                     MOVEL'CONDMN'  WCHECD           EV Event Code
     C                     Z-ADDYL0002    WCEMDT           CE Kill Date
     C                     MOVEL'2'       WCVUST           CE Shift
      * Establish starting position
     C           KRSSD     CHAIN@EXCPEP              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0923' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0010           CE Data Exist
     C                     MOVEL*BLANK    YL0011           CE User Initial
     C                     MOVEL*BLANK    YL0008           Record Found US
     C                     MOVEL'N'       YL0008           Record Found US
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCVVST    YL0010           CE Data Exist
     C                     MOVELWCHXCD    YL0011           CE User Initial
     C                     MOVEL'Y'       YL0008           Record Found US
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Validate Hot Scale Upload
      *================================================================
      * Validate for any hot scale record -> not shift specific  10/21/21
      *      Change shift to POS instead of RST                     RMC
      * Val Evl Trn b/Sft     RT - Eval Trans UPL  * 
     C                     EXSR SBRVGN
     C                     MOVELYL0008    YL0009           Record Found Sh
      * CASE: LCL.Record Found USR is Record Not Found
     C           YL0008    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL*BLANK    ZA0004           EA Shift
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0005
     C                     Z-ADDYL0001    ZA0006           CC Company Numb
      * Retrieve message Bal Upload Not Avail
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0914' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0006 10        Office Dist Lis
     C                     PARM YL0007    WQ0007132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      *
     C                     MOVEL*BLANK    WN0001 40        System Value Al
     C                     MOVEL*BLANK    WN0002 10        Pager Name USR
      *
      * Snd Pager Message     IF
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0008  30       BOH Company Num
     C                     PARM @CN,002   WQ0009 10        Company Value C
     C           WN0001    PARM *BLANK    WQ0010 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELWN0001    WN0002           Pager Name USR
      * Setup message data for message
     C                     MOVELWN0002    ZA0007           Pager Name USR
     C                     MOVEL@CN,003   ZA0008           Pager Msg USR
      *
      * Execute message
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2EXMCC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0920' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN   7
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      * Error detected during execution
     C                     SETON                     99    *
     C                     END
      *
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Validate Condemns Entry
      *================================================================
      * Shift 1
      * Rtv Company Event     RT - Company Event  * 
     C                     EXSR SCRVGN
      * CASE: LCL.Record Found USR is Record Not Found
     C           YL0008    IFEQ 'N'                        *IF
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0011  30       BOH Company Num
     C                     PARM @CN,004   WQ0012 10        Company Value C
     C           YL0005    PARM *BLANK    WQ0013 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0005    YL0006           Office Dist Lis
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0009
     C                     MOVEL'1'       ZA0010           EA Shift
     C                     Z-ADDYL0001    ZA0011           CC Company Numb
      * Retrieve message Condemn Entry Pager Msg
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0930' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0014 10        Office Dist Lis
     C                     PARM YL0007    WQ0015132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Shift 2
      * Rtv Company Event     RT - Company Event  * 
     C                     EXSR SDRVGN
      * CASE: LCL.Record Found USR is Record Not Found
     C           YL0008    IFEQ 'N'                        *IF
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM YL0001    WQ0016  30       BOH Company Num
     C                     PARM @CN,004   WQ0017 10        Company Value C
     C           YL0005    PARM *BLANK    WQ0018 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0005    YL0006           Office Dist Lis
      * Setup message data for message
      * Convert Current Kill Date to display format
      * Convert date
     C           1000000   ADD  YL0002    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0012
     C                     MOVEL'2'       ZA0013           EA Shift
     C                     Z-ADDYL0001    ZA0014           CC Company Numb
      * Retrieve message Condemn Entry Pager Msg
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0930' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           YL0007    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Snd Pager Msg (MPLUS) UP - STR Order Management Sys  * 
     C                     CALL 'POMSUPC'              90  Snd Pager Msg (
     C                     PARM YL0006    WQ0019 10        Office Dist Lis
     C                     PARM YL0007    WQ0020132        Office Dist Mes
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POMSUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WACKDT           Pmt Current Pay
     C                     Z-ADD*ZERO     WAM1NB           Pmt Current Pay
     C                     Z-ADD*ZERO     WAPINB           PP Unused Nbr 1
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHKST           EA Company Numb
     C                     Z-ADD*ZERO     WBB7DT           EA Kill Date
     C                     Z-ADD*ZERO     WBKINB           EA Scale Sequen
     C                     Z-ADD*ZERO     WBKHNB           EA Tattoo Numbe
     C                     Z-ADD*ZERO     WBLNNB           EA Lot
     C                     Z-ADD*ZERO     WBKJNB           EA Hot Weight
     C                     Z-ADD*ZERO     WBKKNB           EA Backfat Thic
     C                     Z-ADD*ZERO     WBBQPC           EA Loin-Eye Dep
     C                     Z-ADD*ZERO     WBBRPC           EA Light Reflec
     C                     Z-ADD*ZERO     WBX6NB           EA Backfat MM
     C                     Z-ADD*ZERO     WBFQPC           EA LoinEye MM
     C                     Z-ADD*ZERO     WBFRPC           EA Light Refl M
     C                     Z-ADD*ZERO     WBB8DT           RU Date
     C                     Z-ADD*ZERO     WBAOTM           RU Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHONB           CC Company Numb
     C                     Z-ADD*ZERO     WCEMDT           CE Kill Date
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field CC Company Number
     C                     Z-ADD*ZERO     YL0001  30
      * Define local work field Current Kill Date
     C                     Z-ADD*ZERO     YL0002  70
      * Define local work field Pmt Current Payment Step
     C                     Z-ADD*ZERO     YL0003  50
      * Define local work field Current Time
     C                     Z-ADD*ZERO     YL0004  60
      * Define local work field System Value Alpha    USR
     C                     MOVEL*BLANK    YL0005 40
      * Define local work field Office Dist List USR
     C                     MOVEL*BLANK    YL0006 10
      * Define local work field Office Dist Message USR
     C                     MOVEL*BLANK    YL0007132
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0008  1
      * Define local work field Record Found Shift 1 USR
     C                     MOVEL*BLANK    YL0009  1
      * Define local work field CE Data Exist
     C                     MOVEL*BLANK    YL0010  1
      * Define local work field CE User Initials
     C                     MOVEL*BLANK    YL0011  3
      * Define local work field Record Found Shift 2 USR
     C                     MOVEL*BLANK    YL0012  1
      * Define local work field EA Shift
     C                     MOVEL*BLANK    YL0013  1
      * Define local work field Oms System Value Alpha
     C                     MOVEL*BLANK    YL0014 40
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 HOTSCLBAL
00002 BALERRPGR
00003 400-100-002
00004 CNDENTPGR
