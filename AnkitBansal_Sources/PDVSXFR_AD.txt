// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDVSXFR
// ?Date: 14.08.2025 Time: 03:30:14
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV Cust. Detail       RT) TYPE(RTVOBJ) FILE(PDJ5CPP)          AC1343252;
PARAMETER(*ZERO);
PARAMETER(PAR.Bank_Code);
PARAMETER(PAR.Deposit_Date);
PARAMETER(*ZERO);
PARAMETER(PAR.A_R_Processing_Status);
{
 //?USER: Initialize routine

 // PAR.USR First Time = CND.Yes
 PAR.USR_First_Time = 'Y';

 // PAR.USR Amount Applied = CND.Zero
 PAR.USR_Amount_Applied = *ZERO;

 //?***** Change log and comments
 DO;

 //?** 02/08/2010 LJB E000512   New field added to ARACTRET. Retrieve
 //?** to a null field value
 //?**
 ENDDO;

 //?USER: Processing if Data record not found

 QUIT;

 //?USER: Process Data record

 //?First time flag
 CASE;

 // IF PAR.USR First Time is Yes
 IF PAR.USR_First_Time = 'Y';

 // WRK.A/R Customer Number = DB1.A/R Customer Number
 WRK.AR_Customer_Number = DB1.AR_Customer_Number;

 // WRK.Company Number = DB1.Company Number
 WRK.Company_Number = DB1.Company_Number;

 // PAR.USR First Time = CND.No
 PAR.USR_First_Time = 'N';

 ENDIF;

 CASE;

 // IF PAR.A/R Processing Status EQ DB1.A/R Processing Status
 IF PAR.A_R_Processing_Status = DB1.A_R_Processing_Status;

 //?Break on A/R Cust or Company (1/09/06 RMC added company break)
 CASE;

 // IF DB1.A/R Customer Number EQ WRK.A/R Customer Number
 IF DB1.AR_Customer_Number = WRK.AR_Customer_Number;

 // AND DB1.Company Number EQ WRK.Company Number
 AND DB1.Company_Number = WRK.Company_Number;

 // PAR.USR Amount Applied = DB1.Transaction Amount + PAR.USR Amount Applied
 PAR.USR_Amount_Applied = DB1.Transaction_Amount + PAR.USR_Amount_Applied;

 //?Break on A/R Cust or Company (1/09/06 RMC added company break)
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.Status - Y or N = CND.blank
 WRK.Status_Y_or_N = *BLANK;

 //?Get Customers G/L A/R Code
 //?Get A/R G/L if cust# or Non Cash A/R if no cust #
 CASE;

 // IF WRK.A/R Customer Number is not equal to zero
 IF WRK.AR_Customer_Number <> *ZERO;

 EXECUTE FUNCTION(RTV G/L Code           RT) TYPE(RTVOBJ) FILE(CAEOREP)          AC1348132;
 PARAMETER(WRK.Company_Number);
 PARAMETER(WRK.AR_Customer_Number);
 PARAMETER(PAR.G_L_Alpha_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  // PAR.G/L Code = DB1.G/L Code
  PAR.G_L_Code = DB1.G_L_Code;

 }

 // Call program Val G/L Act Cde 2 HPE XF.
 CALL PROGRAM(Val G/L Act Cde 2 HPE XF) ('PKVBXFR');
 PARAMETER(WRK.Company_Number);
 PARAMETER(PAR.G_L_Alpha_Code);
 PARAMETER(WRK.G_L_Code_Desc_USR);
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(WRK.Record_Found_USR);

 // WRK.Adjustment Type Code = CND.A/R Entry by Customer
 WRK.Adjustment_Type_Code = 'ARC';

 //?Get A/R G/L if cust# or Non Cash A/R if no cust #
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?   If Customer number is zero the record is a non-a/r cash
 EXECUTE FUNCTION(RTV G/L Code           RT) TYPE(RTVOBJ) FILE(PDJ3CPP)          AC1345062;
 PARAMETER(WRK.Company_Number);
 PARAMETER('ARM');
 PARAMETER(PAR.G_L_ID_Code_JDE);
 {
  //?USER: Process Data record

  // PAR.G/L ID Code JDE = DB1.G/L ID Code JDE
  PAR.G_L_ID_Code_JDE = DB1.G_L_ID_Code_JDE;

 }

 // WRK.Adjustment Type Code = CND.A/R Miscellaneous Acct
 WRK.Adjustment_Type_Code = 'ARM';

 ENDIF;

 //?  A/R G/L account code is a Credit Entry - Reverse the sign
 // PAR.USR Amount Applied = CON.*ZERO - PAR.USR Amount Applied
 PAR.USR_Amount_Applied = *ZERO - PAR.USR_Amount_Applied;

 //?  Save Data from record just read into buffer
 // PAR.USR A/R Customer Number = DB1.A/R Customer Number
 PAR.USR_A_R_Customer_Number = DB1.AR_Customer_Number;

 // PAR.Company Number     041405 = DB1.Company Number
 PAR.Company_Number_041405 = DB1.Company_Number;

 // PAR.USR Check Amount = DB1.Transaction Amount
 PAR.USR_Check_Amount = DB1.Transaction_Amount;

 //?   Create Credit to A/R Record
 //?   OMS036 RMC 4/4/05 with DB1.company.. not par.company
 //?   E000512 LJB 02/23/2010   Rcv new post edit code
 // Call program VAL Acct ID JDE-8 dgt  UP.
 CALL PROGRAM(VAL Acct ID JDE-8 dgt  UP) ('ARACTRET');
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(WRK.Cost_Center);
 PARAMETER(WRK.Object_Account);
 PARAMETER(WRK.Subsidiary);
 PARAMETER(NLL.Description);
 PARAMETER(PAR.G_L_Posting_Company);
 PARAMETER(WRK.JDE_Posting_Edit_Code_USR);
 PARAMETER(WRK.Error_Return_text);

 //?** Rtv sub ledger if GMPEC = "L", else set to zeros   E000512
 CASE;

 // IF WRK.JDE Posting Edit Code USR is Ledger Required
 IF WRK.JDE_Posting_Edit_Code_USR = 'L';

 // Call program Zzz G/L Sub Ledger Cd  XF.
 CALL PROGRAM(Zzz G/L Sub Ledger Cd  XF) ('PNG4XFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Sequence_Number);
 PARAMETER(WRK.G_L_Sub_Ledger_Code);

 //?** Rtv sub ledger if GMPEC = "L", else set to zeros   E000512
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.G/L Sub-Ledger Code = CND.equal to zero
 WRK.G_L_Sub_Ledger_Code = *ZERO;

 ENDIF;

 EXECUTE FUNCTION(CRT Crd-A/R to G/L     CR) TYPE(CRTOBJ) FILE(PDJ5CPP)          AC1343269;
 PARAMETER(WRK.Company_Number);
 PARAMETER(PAR.Bank_Code);
 PARAMETER(PAR.Deposit_Date);
 PARAMETER(WRK.AR_Customer_Number);
 PARAMETER(*ZERO);
 PARAMETER(*BLANK);
 PARAMETER(*ZERO);
 PARAMETER(WRK.Adjustment_Type_Code);
 PARAMETER(PAR.USR_Amount_Applied);
 PARAMETER(*BLANK);
 PARAMETER(PAR.G_L_Posting_Company);
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(DB1.Effect_Cust_Acct);
 PARAMETER('A/R Account Number');
 PARAMETER(DB1.Reference_Field);
 PARAMETER(PAR.A_R_Processing_Status);
 PARAMETER(DB1.Originating_File_Code);
 PARAMETER(DB1.GL_Document_Number);
 PARAMETER(DB1.Post_to_G_L_Date);
 PARAMETER(WRK.Bank_G_L_ID_Code);
 PARAMETER(WRK.G_L_Sub_Ledger_Code);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER('A');
 PARAMETER(JOB.*Job_time);
 PARAMETER(JOB.*USER);
 PARAMETER(JOB.*PROGRAM);
 PARAMETER(JOB.*Job_date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 // PAR.USR Amount Applied = PAR.USR Check Amount
 PAR.USR_Amount_Applied = PAR.USR_Check_Amount;

 // WRK.A/R Customer Number = PAR.USR A/R Customer Number
 WRK.AR_Customer_Number = PAR.USR_A_R_Customer_Number;

 // WRK.Company Number = PAR.Company Number     041405
 WRK.Company_Number = PAR.Company_Number_041405;

 ENDIF;

 ENDIF;

 //?USER: Exit processing

 //?Get Customers G/L A/R Code
 CASE;

 // IF WRK.A/R Customer Number is not equal to zero
 IF WRK.AR_Customer_Number <> *ZERO;

 EXECUTE FUNCTION(RTV G/L Code           RT) TYPE(RTVOBJ) FILE(CAEOREP)          AC1348132;
 PARAMETER(WRK.Company_Number);
 PARAMETER(WRK.AR_Customer_Number);
 PARAMETER(PAR.G_L_Alpha_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  // PAR.G/L Code = DB1.G/L Code
  PAR.G_L_Code = DB1.G_L_Code;

 }

 // Call program Val G/L Act Cde 2 HPE XF.
 CALL PROGRAM(Val G/L Act Cde 2 HPE XF) ('PKVBXFR');
 PARAMETER(WRK.Company_Number);
 PARAMETER(PAR.G_L_Alpha_Code);
 PARAMETER(WRK.G_L_Code_Desc_USR);
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(WRK.Record_Found_USR);

 // WRK.Adjustment Type Code = CND.A/R Entry by Customer
 WRK.Adjustment_Type_Code = 'ARC';

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?   If Customer number is zero the record is a non-a/r cash
 EXECUTE FUNCTION(RTV G/L Code           RT) TYPE(RTVOBJ) FILE(PDJ3CPP)          AC1345062;
 PARAMETER(WRK.Company_Number);
 PARAMETER('ARM');
 PARAMETER(PAR.G_L_ID_Code_JDE);
 {
  //?USER: Process Data record

  // PAR.G/L ID Code JDE = DB1.G/L ID Code JDE
  PAR.G_L_ID_Code_JDE = DB1.G_L_ID_Code_JDE;

 }

 // WRK.Adjustment Type Code = CND.A/R Miscellaneous Acct
 WRK.Adjustment_Type_Code = 'ARM';

 ENDIF;

 //?    A/R G/L account code is a Credit Entry
 // PAR.USR Amount Applied = CON.*ZERO - PAR.USR Amount Applied
 PAR.USR_Amount_Applied = *ZERO - PAR.USR_Amount_Applied;

 // Call program VAL Acct ID JDE-8 dgt  UP.
 CALL PROGRAM(VAL Acct ID JDE-8 dgt  UP) ('ARACTRET');
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(NLL.Cost_Center);
 PARAMETER(NLL.Object_Account);
 PARAMETER(NLL.Subsidiary);
 PARAMETER(NLL.Description);
 PARAMETER(PAR.G_L_Posting_Company);
 PARAMETER(WRK.JDE_Posting_Edit_Code_USR);
 PARAMETER(NLL.Error_Return_text);

 //?** Rtv sub ledger if GMPEC = "L", else set to zeros   E000512
 CASE;

 // IF WRK.JDE Posting Edit Code USR is Ledger Required
 IF WRK.JDE_Posting_Edit_Code_USR = 'L';

 // Call program Zzz G/L Sub Ledger Cd  XF.
 CALL PROGRAM(Zzz G/L Sub Ledger Cd  XF) ('PNG4XFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Sequence_Number);
 PARAMETER(WRK.G_L_Sub_Ledger_Code);

 //?** Rtv sub ledger if GMPEC = "L", else set to zeros   E000512
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.G/L Sub-Ledger Code = CND.equal to zero
 WRK.G_L_Sub_Ledger_Code = *ZERO;

 ENDIF;

 EXECUTE FUNCTION(CRT Crd-A/R to G/L     CR) TYPE(CRTOBJ) FILE(PDJ5CPP)          AC1343269;
 PARAMETER(WRK.Company_Number);
 PARAMETER(PAR.Bank_Code);
 PARAMETER(PAR.Deposit_Date);
 PARAMETER(WRK.AR_Customer_Number);
 PARAMETER(*ZERO);
 PARAMETER(*BLANK);
 PARAMETER(*ZERO);
 PARAMETER(WRK.Adjustment_Type_Code);
 PARAMETER(PAR.USR_Amount_Applied);
 PARAMETER(*BLANK);
 PARAMETER(PAR.G_L_Posting_Company);
 PARAMETER(PAR.G_L_ID_Code_JDE);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(DB1.Effect_Cust_Acct);
 PARAMETER('A/R Account Number');
 PARAMETER(DB1.Reference_Field);
 PARAMETER(PAR.A_R_Processing_Status);
 PARAMETER(DB1.Originating_File_Code);
 PARAMETER(DB1.GL_Document_Number);
 PARAMETER(DB1.Post_to_G_L_Date);
 PARAMETER(WRK.Bank_G_L_ID_Code);
 PARAMETER(WRK.G_L_Sub_Ledger_Code);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER('A');
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


//?***** Change Log and Comments
DO;

//?02/08/2010 LJB E000512  New field added to ARACTRET, ARACTEDT.
//?  Subledger entered on Edit Cash App and validated there
//?OMS036 RMC - 01/09/6 break on Cust or Company, not just customer
//?Create Credit G/L Entry for a credit to A/R
//?OMS036 RMC - 12/23/5 output g/l posting company to a/r posting file
//?OMS036 RMC - 4/4/05 Read file without Co as part of the key. want to
//?  read all of the records for that bank/date
ENDDO;

