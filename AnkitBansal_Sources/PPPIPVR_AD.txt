// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPPIPVR
// ?Date: 14.08.2025 Time: 03:41:31
// ?------------------------------------------------------------------------------------------------

//?USER: Load screen

//?R12069 11/15/17 DN-Set 2nd IVF Grouping Info.
CASE;

// IF PAR.IVF Valuation Grouping is Guymon & Triumph
IF PAR.IVF_Valuation_Grouping = 'G';

// LCL.IVF Valuation Grouping = CND.Seaboard Triumph Foods
LCL.IVF_Valuation_Grouping = 'S';

// DTL.Text 1 Length USR = LCL.IVF Valuation Grouping
DTL.Text_1_Length_USR = LCL.IVF_Valuation_Grouping;

// DTL.Inv Valuation Group Desc2 = Condition name of LCL.IVF Valuation Grouping
DTL.Inv_Valuation_Group_Desc2 = RTVCND(LCL.IVF_Valuation_Grouping);

//?R12069 11/15/17 DN-Set 2nd IVF Grouping Info.
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.IVF Valuation Grouping = CND.Guymon & Triumph
LCL.IVF_Valuation_Grouping = 'G';

// DTL.Text 1 Length USR = LCL.IVF Valuation Grouping
DTL.Text_1_Length_USR = LCL.IVF_Valuation_Grouping;

// DTL.Inv Valuation Group Desc2 = Condition name of LCL.IVF Valuation Grouping
DTL.Inv_Valuation_Group_Desc2 = RTVCND(LCL.IVF_Valuation_Grouping);

ENDIF;

//?USER: Validate fields

//?R9083 02/08/17 DN-Modified to Also RST by IVF Valuation Grouping.
EXECUTE FUNCTION(Rtv Post Inv Sts-1st  RT) TYPE(RTVOBJ) FILE(PPBTCPP)           AC1740674;
PARAMETER(DTL.IVF_Valuation_Grouping);
PARAMETER(DTL.IVF_Week_Ending_Date);
PARAMETER(WRK.IVF_Post_Inventory_Sts);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// LCL.IVF Week Ending Date = DTL.IVF Week Ending Date + CON.-7 *DAYS
LCL.IVF_Week_Ending_Date = DATEINCR(DTL.IVF_Week_Ending_Date '-7' 'DY' 1111111 'NONE'              +
'N' 1);

//?R9083 02/08/17 DN-Modified to Also RST by IVF Valuation Grouping.
EXECUTE FUNCTION(Rtv Post Inv Sts-1st  RT) TYPE(RTVOBJ) FILE(PPBTCPP)           AC1740674;
PARAMETER(DTL.IVF_Valuation_Grouping);
PARAMETER(DTL.IVF_Week_Ending_Date);
PARAMETER(LCL.IVF_Post_Inventory_Sts);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


CASE;

// IF WRK.IVF Post Inventory Sts is Posted
IF WRK.IVF_Post_Inventory_Sts = 'P';

//?R12069 11/15/17 DN-Removed IVF Valuation Grouping from Message.
// Send error message - 'Posting has already occurred, Invalid request.'
ERROR(USR3534);
MSGPARM(DTL.IVF_Week_Ending_Date);

ENDIF;

//?Check last week's post sts
CASE;

// IF LCL.IVF Post Inventory Sts is Open
IF LCL.IVF_Post_Inventory_Sts = 'O';

ENDIF;

//?USER: User defined action

// PAR.PRT Night Queue Run Sts = CND.no
PAR.PRT_Night_Queue_Run_Sts = 'N';

// Call program PMT Prt Opt w/PSz SHR  PV.
CALL PROGRAM(PMT Prt Opt w/PSz SHR  PV) ('PDV8PVR');
PARAMETER('Inventory Value Report');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Number_of_Copies);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER('I/C');
PARAMETER(*MISSING);
PARAMETER(1);

CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.System Value Numeric = PAR.PRT Number of Copies
PAR.System_Value_Numeric = PAR.PRT_Number_of_Copies;

//?R9083 02/17/17 DN-Added IVF Valuation Grouping & Group Desc to Parm.
// Call program Exc Post Inv Values   XF.
SBMJOB;
CALL PROGRAM(Exc Post Inv Values   XF) ('PPPHXFR');
PARAMETER(DTL.IVF_Valuation_Grouping);
PARAMETER(DTL.IVF_Week_Ending_Date);
PARAMETER(PAR.IVF_Post_Inventory_Sts);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.System_Value_Numeric);
PARAMETER(DTL.Inv_Valuation_Group_Desc);
SBMJOBOVR JOB(POST_INVEN);
SBMJOBOVR JOBD(*USRPRF);
SBMJOBEND;

// PAR.Post Flag USR = CND.Yes
PAR.Post_Flag_USR = 'Y';

ENDIF;

