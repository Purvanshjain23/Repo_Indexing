// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPIEXFR
// ?Date: 14.08.2025 Time: 03:40:44
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?The email address is PRKCREDIT  hard coded in the ESNDFILE
//?Modifications:
//?** SZ  12/07/15
//?** Moved the TRANS SET CONTROL move to the top and added the EDI
//?** address to the key to define the numeric Trans set control #
//?** Rmv esend - it is now part of the user's libl    2/23/06 LJB
//?** Call CL program so the command can be monitored  2/23/2006 LJB
// PAR.ST02-TRANS SET CONTROL NU = CVTVAR(PAR.TRANS SET CONTROL APLHA)
PAR.ST02_TRANS_SET_CONTROL_NU = CVTVAR(PAR.TRANS_SET_CONTROL_APLHA);

// Call program Zzz Add/Rmv lible cmd  UP.
CALL PROGRAM(Zzz Add/Rmv lible cmd  UP) ('PPW8UPC');
PARAMETER('EDIFLIB');
PARAMETER('A');

CASE;

// IF PAR.EDI Function Sts USR is Error
IF PAR.EDI_Function_Sts_USR = 'E';

EXECUTE FUNCTION(RTV default Company    IF) TYPE(EXCINTFUN)                     AC1592222;
PARAMETER(LCL.Company_Number);
{
 //?Execute internal function

 EXECUTE FUNCTION(Rtv Profile Model     RT) TYPE(RTVOBJ) FILE(CADRREP)           AC1445577;
 PARAMETER(JOB.*USER);
 PARAMETER(PAR.User_Code_Model);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PAR.User Code Model is equal to blank
 IF PAR.User_Code_Model = *BLANK;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(JOB.*USER);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(PAR.User_Code_Model);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

}


EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
PARAMETER(LCL.Company_Number);
PARAMETER('DFTPOEMAIL');
PARAMETER(LCL.System_Value_Alpha);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Email Address = LCL.System Value Alpha
LCL.Email_Address = LCL.System_Value_Alpha;

// Retrieve message - 'Error occured for Trading Partner &1 Transaction Set Control &2. Contact the
LCL.Office_Message_USR = RTVMSG(USR3137);
PARAMETER(PAR.EDI_Trading_Partner_No);
PARAMETER(PAR.TRANS_SET_CONTROL_APLHA);
PARAMETER(PAR.EDI_Function_Sts_USR);
PARAMETER(PAR.EDI_In_Process_Sts_USR);

// Execute command - 'ESNDMAIL'
EXECUTE COMMAND(USR3136);
PARAMETER(LCL.Email_Address);
PARAMETER(LCL.Office_Message_USR);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Zzz EDI Addresses     PF.
CALL PROGRAM(Zzz EDI Addresses     PF) ('PPIFPFR');
PARAMETER(PAR.ST02_TRANS_SET_CONTROL_NU);
PARAMETER(PAR.EDI_Trading_Partner_No);

// LCL.Customer Comment Line = CONCAT(PAR.EDI Trading Partner No.,CON.Addresses,CON.1)
LCL.Customer_Comment_Line = PAR.EDI_Trading_Partner_No + 'Addresses' (1);

// Execute command - 'ESNDMAIL'
EXECUTE COMMAND(USR3109);
PARAMETER('PRKCREDIT');
PARAMETER('PPIFPFR$');
PARAMETER(LCL.Customer_Comment_Line);
PARAMETER(*YES);

ENDIF;

