// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLWPXFR
// ?Date: 14.08.2025 Time: 02:55:37
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?E3773 JJH 12/29/14 - Hot Weight Data Source
//? The purpose of this function is to create the records in QTEMP
//? for the Eval Trans UPL ERP Sum (PLB7CPP) file.  A seperate record
//? is created for each day in the Kill Date Range with a ERS Period
//? Total Type of D=Daily.
//?E3773 JJH 01/03/14 - Hot Weight Data Source
//? It was decided not to generate any P=Period records.  Therefore,
//? all of the code regarding the accumulation and creating Period
//? records has been commented out.  Just in case this logic is
//? required in future.
//?E3841 JJH 01/15/15 - Correct Divide by Zero Error
EXECUTE FUNCTION(Bld Evl Trn UPL ERP SmRT) TYPE(RTVOBJ) FILE(PLBUCPP)           AB1323605;
PARAMETER(PAR.ER_Company_Number);
PARAMETER(PAR.ER_Kill_Date);
PARAMETER(PAR.Kill_Date_To_USR);
{
 //?USER: Initialize routine

 //?Set the First Kill Date
 // LCL.ERS Kill Date = PAR.ER Kill Date
 LCL.ERS_Kill_Date = PAR.ER_Kill_Date;

 //?Get the first ERS Period From Date and ERS Period To Date
 // Call program Rtv 1st Pd Fm/To Date XF.
 CALL PROGRAM(Rtv 1st Pd Fm/To Date XF) ('PLWQXFR');
 PARAMETER(PAR.ER_Company_Number);
 PARAMETER(PAR.ER_Kill_Date);
 PARAMETER(LCL.ERS_Period_From_Date);
 PARAMETER(LCL.ERS_Period_To_Date);

 //?Initialize Summary Fields for Daily Totals
 // LCL.ERS Total Kill = CON.*ZERO
 LCL.ERS_Total_Kill = *ZERO;

 // LCL.ERS Invalid Tattoo = CON.*ZERO
 LCL.ERS_Invalid_Tattoo = *ZERO;

 // LCL.ERS Invalid Tattoo % = CON.*ZERO
 LCL.ERS_Invalid_Tattoo = *ZERO;

 //?USER: Process Data record

 CASE;

 // IF DB1.ER Kill Date GT PAR.Kill Date To USR
 IF DB1.ER_Kill_Date > PAR.Kill_Date_To_USR;

 //?Kill Date To Exceeded
 //?Create Eval Trans UPL ERP Smmry - Daily
 //?E3841 JJH 01/15/15 - Correct Divide by Zero Error
 CASE;

 // IF LCL.ERS Total Kill is EQ Zero
 IF LCL.ERS_Total_Kill = *ZERO;

 // LCL.Invalid Tattoo % 5.4 = CND.EQ ZERO
 LCL.Invalid_Tattoo_5_4 = *ZERO;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Invalid Tattoo % 5.4 = LCL.ERS Invalid Tattoo / LCL.ERS Total Kill *
 LCL.Invalid_Tattoo_5_4 = LCL.ERS_Invalid_Tattoo / LCL.ERS_Total_Kill;

 ENDIF;

 // LCL.ERS Invalid Tattoo % = LCL.Invalid Tattoo % 5.4 * CON.100 *
 LCL.ERS_Invalid_Tattoo = LCL.Invalid_Tattoo_5_4 * 100;

 EXECUTE FUNCTION(Crt Evl Trn UPL ERP SmCR) TYPE(CRTOBJ) FILE(PLB7CPP)           AB1323601;
 PARAMETER(PAR.ER_Company_Number);
 PARAMETER(LCL.ERS_Period_From_Date);
 PARAMETER(LCL.ERS_Period_To_Date);
 PARAMETER('D');
 PARAMETER(LCL.ERS_Kill_Date);
 PARAMETER(LCL.ERS_Total_Kill);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?*****************************************************************
 //?Accumulate Daily Totals
 CASE;

 // IF DB1.ER Kill Date EQ LCL.ERS Kill Date
 IF DB1.ER_Kill_Date = LCL.ERS_Kill_Date;

 // LCL.ERS Total Kill = LCL.ERS Total Kill + CON.1
 LCL.ERS_Total_Kill = LCL.ERS_Total_Kill + 1;

 CASE;

 // IF DB1.ER Sp Producer/Text is GUY-INVTAT
 IF DB1.ER_Sp_Producer_Text = 'GUY-INVTAT';

 // OR DB1.ER Sp Producer/Text is STJ-INVTAT
 OR DB1.ER_Sp_Producer_Text = 'STJ-INVTAT';

 // LCL.ERS Invalid Tattoo = LCL.ERS Invalid Tattoo + CON.1
 LCL.ERS_Invalid_Tattoo = LCL.ERS_Invalid_Tattoo + 1;

 ENDIF;

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Create Eval Trans UPL ERP Smmry - Daily
 //?E3841 JJH 01/15/15 - Correct Divide by Zero Error
 CASE;

 // IF LCL.ERS Total Kill is EQ Zero
 IF LCL.ERS_Total_Kill = *ZERO;

 // LCL.Invalid Tattoo % 5.4 = CND.EQ ZERO
 LCL.Invalid_Tattoo_5_4 = *ZERO;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Invalid Tattoo % 5.4 = LCL.ERS Invalid Tattoo / LCL.ERS Total Kill *
 LCL.Invalid_Tattoo_5_4 = LCL.ERS_Invalid_Tattoo / LCL.ERS_Total_Kill;

 ENDIF;

 // LCL.ERS Invalid Tattoo % = LCL.Invalid Tattoo % 5.4 * CON.100 *
 LCL.ERS_Invalid_Tattoo = LCL.Invalid_Tattoo_5_4 * 100;

 EXECUTE FUNCTION(Crt Evl Trn UPL ERP SmCR) TYPE(CRTOBJ) FILE(PLB7CPP)           AB1323601;
 PARAMETER(PAR.ER_Company_Number);
 PARAMETER(LCL.ERS_Period_From_Date);
 PARAMETER(LCL.ERS_Period_To_Date);
 PARAMETER('D');
 PARAMETER(LCL.ERS_Kill_Date);
 PARAMETER(LCL.ERS_Total_Kill);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
 //?Reset Daily Accumulators
 // LCL.ERS Kill Date = DB1.ER Kill Date
 LCL.ERS_Kill_Date = DB1.ER_Kill_Date;

 // LCL.ERS Total Kill = CON.*ZERO
 LCL.ERS_Total_Kill = *ZERO;

 // LCL.ERS Invalid Tattoo = CON.*ZERO
 LCL.ERS_Invalid_Tattoo = *ZERO;

 // LCL.ERS Invalid Tattoo % = CON.*ZERO
 LCL.ERS_Invalid_Tattoo = *ZERO;

 //?Accumulate Daily Total
 // LCL.ERS Total Kill = LCL.ERS Total Kill + CON.1
 LCL.ERS_Total_Kill = LCL.ERS_Total_Kill + 1;

 CASE;

 // IF DB1.ER Sp Producer/Text is GUY-INVTAT
 IF DB1.ER_Sp_Producer_Text = 'GUY-INVTAT';

 // OR DB1.ER Sp Producer/Text is STJ-INVTAT
 OR DB1.ER_Sp_Producer_Text = 'STJ-INVTAT';

 // LCL.ERS Invalid Tattoo = LCL.ERS Invalid Tattoo + CON.1
 LCL.ERS_Invalid_Tattoo = LCL.ERS_Invalid_Tattoo + 1;

 ENDIF;

 ENDIF;

 //?*****************************************************************
 ENDIF;

 //?USER: Exit processing

 //?Create Eval Trans UPL ERP Smmry - Daily
 //?E3841 JJH 01/15/15 - Correct Divide by Zero Error
 CASE;

 // IF LCL.ERS Total Kill is EQ Zero
 IF LCL.ERS_Total_Kill = *ZERO;

 // LCL.Invalid Tattoo % 5.4 = CND.EQ ZERO
 LCL.Invalid_Tattoo_5_4 = *ZERO;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Invalid Tattoo % 5.4 = LCL.ERS Invalid Tattoo / LCL.ERS Total Kill *
 LCL.Invalid_Tattoo_5_4 = LCL.ERS_Invalid_Tattoo / LCL.ERS_Total_Kill;

 ENDIF;

 EXECUTE FUNCTION(Crt Evl Trn UPL ERP SmCR) TYPE(CRTOBJ) FILE(PLB7CPP)           AB1323601;
 PARAMETER(PAR.ER_Company_Number);
 PARAMETER(LCL.ERS_Period_From_Date);
 PARAMETER(LCL.ERS_Period_To_Date);
 PARAMETER('D');
 PARAMETER(LCL.ERS_Kill_Date);
 PARAMETER(LCL.ERS_Total_Kill);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
 PARAMETER(LCL.ERS_Invalid_Tattoo);
}


