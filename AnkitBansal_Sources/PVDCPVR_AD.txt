// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVDCPVR
// ?Date: 14.08.2025 Time: 03:51:55
// ?------------------------------------------------------------------------------------------------

//?USER: Process command keys

CASE;

// IF DTL.*CMD key is CF07
IF DTL.*CMD_key = '07';

EXECUTE FUNCTION(CHG 3 AES Fields   CH) TYPE(CHGOBJ) FILE(PMAMREP)              AC2221738;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Order_Number);
PARAMETER(DTL.Load_ID);
PARAMETER(DTL.Stop_Drop_Sequence_Number);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Set Date/Time Stamp 2 IF) TYPE(EXCINTFUN)                      AC2165057;
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?Execute internal function

  // PAR.Job Time = JOB.*Job time
  PAR.Job_Time = JOB.*Job_time;

  // PAR.User Id = JOB.*USER
  PAR.User_Id = JOB.*USER;

  // PAR.Job Name = JOB.*PROGRAM
  PAR.Job_Name = JOB.*PROGRAM;

  // PAR.Job Date = JOB.*Job date
  PAR.Job_Date = JOB.*Job_date;

 }

}


EXECUTE FUNCTION(Chg AES Fields CH) TYPE(CHGOBJ) FILE(ECP136)                   AC2221754;
PARAMETER(DTL.ST02_TRANS_SET_CONTROL_NU);
PARAMETER('X');
PARAMETER('Y');

ENDIF;

//?USER: Validate fields

EXECUTE FUNCTION(Rtv All fields        RT) TYPE(RTVOBJ) FILE(PMAMREP)           AC2202538;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Order_Number);
PARAMETER(DTL.Load_ID);
PARAMETER(DTL.Stop_Drop_Sequence_Number);
PARAMETER(NLL.Shipping_Line);
PARAMETER(NLL.Port_Delv_Terminal);
PARAMETER(NLL.OHE_City);
PARAMETER(NLL.OHE_Vessel_Airline);
PARAMETER(NLL.OHE_Voyage_Flight);
PARAMETER(NLL.OHE_Booking_Number);
PARAMETER(NLL.OHE_Discharge_Port_Airprt);
PARAMETER(NLL.OHE_Sail_Flight_Date);
PARAMETER(NLL.OHE_Port_Cut_Date);
PARAMETER(NLL.OHE_Arrival_Date);
PARAMETER(NLL.OHE_Late_Delivery_Code);
PARAMETER(NLL.OHE_Ship_Status);
PARAMETER(NLL.OHE_Container_Number);
PARAMETER(NLL.OHE_Comment_1);
PARAMETER(NLL.OHE_Comment_2);
PARAMETER(NLL.OHE_Unused_Number_1_11_0);
PARAMETER(NLL.OHE_Unused_Number_2_11_0);
PARAMETER(NLL.OHE_Unused_Number_3_11_0);
PARAMETER(NLL.OHE_Unused_Number_4_11_0);
PARAMETER(NLL.OHE_HPB_RIN_Equiv_Value);
PARAMETER(NLL.OHE_HPB_RIN_Price);
PARAMETER(NLL.Transload_Terminal_Fees);
PARAMETER(NLL.OHE_Est_Arrv_at_Dest_Date);
PARAMETER(NLL.OHE_Backhaul_ETA_RtrnDate);
PARAMETER(NLL.OHE_Port_Pier_Paid_Date);
PARAMETER(NLL.OHE_Actual_Ship_Date);
PARAMETER(NLL.OHE_Carrier_SCAC_Code);
PARAMETER(NLL.OHE_Spot_Buy);
PARAMETER(NLL.OHE_PO_ACK_Flag);
PARAMETER(NLL.OHE_Override_Type_Code);
PARAMETER(NLL.OHE_Backhaul_Status);
PARAMETER(NLL.OHE_Backhaul_ETA_AM_PM);
PARAMETER(NLL.OHE_Load_Haul_Type);
PARAMETER(NLL.OHE_Backhaul_Carrier_Code);
PARAMETER(NLL.OHE_Bookings_Confirmed);
PARAMETER(NLL.OHE_EDI_Error_Reasons);
PARAMETER(NLL.OHE_EDI_Error_Reasons_2);
PARAMETER(NLL.HPB_COA_Batch_Number);
PARAMETER(NLL.Delivery_P_O_Number);
PARAMETER(NLL.OHE_Intended_for_ExportCC);
PARAMETER(NLL.OHE_EDI_943_Action);
PARAMETER(NLL.OHE_EDI_944_Action);
PARAMETER(NLL.OHE_EDI_940_Action);
PARAMETER(NLL.OHE_EDI_945_Action);
PARAMETER(NLL.OHE_EDI_856_Action);
PARAMETER(DTL.OHE_EDI_824_Action_USR);
PARAMETER(NLL.OHE_Transload_Seal_Nbr);
PARAMETER(NLL.OHE_Abs_Rate_Override_Rsn);
PARAMETER(NLL.OHE_Appt_Confirmation_#);
PARAMETER(NLL.OHE_Backhaul_Container#);
PARAMETER(NLL.OHE_Backhaul_Chassis_#);
PARAMETER(NLL.OHE_Transload_Container#);
PARAMETER(NLL.OHE_Pier_Pass_Invoice);
PARAMETER(NLL.OHE_Carrier_Nm);
PARAMETER(NLL.OHE_Appt_Confirmation_Nm);
PARAMETER(NLL.OHE_Backhaul_Comment);
PARAMETER(NLL.Letter_of_Credit_Number);
PARAMETER(NLL.OHE_Backhaul_Return_to_Co);
PARAMETER(NLL.LD_Stop_Drop);
PARAMETER(NLL.OHE_Unused_Number_3_0);
PARAMETER(NLL.OHE_Pier_Pass_Fee_Amount);
PARAMETER(NLL.OHE_Port_Check_Fee_Amount);
PARAMETER(NLL.OHE_Port_Cut_Time);
PARAMETER(NLL.OHE_Backhaul_Truck_Number);
PARAMETER(NLL.OHE_Load_Sched_Seq_Num);
PARAMETER(NLL.Original_Appointment_Date);
PARAMETER(NLL.Original_Appointment_Time);
PARAMETER(NLL.OHE_PowerPro_Load#_Outbnd);
PARAMETER(NLL.OHE_PowerPro_Load#_Bckhl);
PARAMETER(NLL.OHE_Unused_Numeric_9_0_3);
PARAMETER(NLL.OHE_Orig_ABS_Freight_Rate);
PARAMETER(NLL.OHE_Genset_Number);
PARAMETER(NLL.OHE_Email_BOL_Sent);
PARAMETER(NLL.OHE_EDI_Order_Automated);
PARAMETER(DTL.OHE_EDI_601_Action_USR);
PARAMETER(NLL.OHE_Unused_Status_4);
PARAMETER(NLL.OHE_Unused_Text_1);
PARAMETER(NLL.OHE_Unused_Text_2);
PARAMETER(NLL.OHE_Customer_Vendor_f_PO);
PARAMETER(DTL.OHE_EDI_824_AES_ITN_#_US);
PARAMETER(NLL.OHE_Unused_Text_5);
PARAMETER(NLL.OHE_Unused_Date_1);
PARAMETER(NLL.OHE_Unused_Date_2);
PARAMETER(NLL.EDI_Status_1);
PARAMETER(NLL.EDI_Status_2);
PARAMETER(NLL.EDI_Status_3);
PARAMETER(NLL.Record_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If NF = error message
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// Send error message - 'Export Instructions not found for order.'
ERROR(USR3697);

ENDIF;

EXECUTE FUNCTION(RTV All Fields RT) TYPE(RTVOBJ) FILE(ECP136)                   AC2221753;
PARAMETER(DTL.ST02_TRANS_SET_CONTROL_NU);
PARAMETER(DTL.EDI_Record_Processed_USR);
PARAMETER(NLL.TRADE_PARTNER_CODE);
PARAMETER(NLL.BA101_Related_Company);
PARAMETER(NLL.BA102_Action_Code);
PARAMETER(NLL.BA103_Transportation_Type);
PARAMETER(NLL.BA104_Country_Code_ISO_2A);
PARAMETER(DTL.BA105_Shpt_Ref_#_Ld_USR);
PARAMETER(NLL.BA108_Ship_From_State_Cde);
PARAMETER(NLL.BA109_IRS_Identifier_EIN);
PARAMETER(NLL.BA110_SCAC);
PARAMETER(NLL.BA112_Vessel_Name);
PARAMETER(NLL.YNQ01_Type_of_Filing);
PARAMETER(NLL.DTM02_Sail_Date);
PARAMETER(NLL.PS03_Port_of_Export);
PARAMETER(NLL.P503_Port_of_Unlading);
PARAMETER(NLL.REF02_Ref_ITN);
PARAMETER(NLL.M1201_Customs_Entry_Type);
PARAMETER(NLL.M1202_Customs_Entry_Nbr);
PARAMETER(NLL.M1203_Location_ID);
PARAMETER(NLL.M1204_Foreign_Party_Ind);
PARAMETER(NLL.EDI_ESIH_Unused_1);
PARAMETER(NLL.ESIH_OHE_Booking_Nbr);
PARAMETER(NLL.EDI_ESIH_Unused_3);
PARAMETER(NLL.Create_Date_D8#);
PARAMETER(NLL.Create_Time);
PARAMETER(DTL.EDI_824_Received_Sts_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If NF = error message
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// Send error message - 'EDI Export Shpmnt Inf HDR not found.'
ERROR(USR5267);

ENDIF;

