     H/TITLE Rtv Loin Range Count  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1135
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL                     n
     H* System        : HPEDEVMDL
     H* User name     : ISLBUSE
     H* Date          : 02/27/06  Time  : 11:19:56
     H* Copyright     : HPEDEVMDL                     n
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKFFREL1IF  E           K        DISK
      * RTV : Export Loin Weight Range  Retrieval index
      *
     FPKDLCPL2IF  E           K        DISK
      * RSQ : Primal Scale Detail       Co/Dte/Scl/Wgt
      *
     FPKFECPL1IF  E           K        DISK
      * RTV : Export Loin Range Prm Sum Retrieval index
      *
     FPKFECPL0UF  E           K        DISK                      A
      * UPD : Export Loin Range Prm Sum Update index
      *
     I@FFREHE
      * Export Loin Weight Range  Retrieval index
      * Renamed input format fields
     I              FFHONB                          WAHONB
     I              FFHBA1                          WAHBA1
     I              FFHCA1                          WAHCA1
     I              FFHDA1                          WAHDA1
     I              FFHEA1                          WAHEA1
     I              FFHFA1                          WAHFA1
     I              FFHGA1                          WAHGA1
     I              FFQCTX                          WAQCTX
     I              FFQDTX                          WAQDTX
     I              FFQETX                          WAQETX
     I              FFAAVN                          WAAAVN
     I              FFAADT                          WAAADT
     I              FFAMTM                          WAAMTM
     I              FFAJST                          WAAJST
     I              FFAHVN                          WAAHVN
     I              FFAGVN                          WAAGVN
     I              FFABVN                          WAABVN
     I              FFABDT                          WAABDT
     I              FFABTM                          WAABTM
      *
     I@DLCPUK
      * Primal Scale Detail       Co/Dte/Scl/Wgt
      * Renamed input format fields
     I              DLHONB                          WBHONB
     I              DLYSNB                          WBYSNB
     I              DLCZDT                          WBCZDT
     I              DLAQTM                          WBAQTM
     I              DLYZNB                          WBYZNB
     I              DLYUNB                          WBYUNB
     I              DLYWNB                          WBYWNB
     I              DLYXNB                          WBYXNB
     I              DLPWST                          WBPWST
     I              DLM9CD                          WBM9CD
     I              DLAAVN                          WBAAVN
     I              DLAADT                          WBAADT
     I              DLAMTM                          WBAMTM
     I              DLAJST                          WBAJST
     I              DLAHVN                          WBAHVN
     I              DLAGVN                          WBAGVN
     I              DLABVN                          WBABVN
     I              DLABDT                          WBABDT
     I              DLABTM                          WBABTM
      *
     I@FECPHB
      * Export Loin Range Prm Sum Retrieval index
      * Renamed input format fields
     I              FEHONB                          WCHONB
     I              FEEVDT                          WCEVDT
     I              FEG5A1                          WCG5A1
     I              FEG6A1                          WCG6A1
     I              FEG7A1                          WCG7A1
     I              FEG8A1                          WCG8A1
     I              FEG9A1                          WCG9A1
     I              FEHAA1                          WCHAA1
     I              FEQCTX                          WCQCTX
     I              FEQDTX                          WCQDTX
     I              FEQETX                          WCQETX
     I              FEAAVN                          WCAAVN
     I              FEAADT                          WCAADT
     I              FEAMTM                          WCAMTM
     I              FEAJST                          WCAJST
     I              FEAHVN                          WCAHVN
     I              FEAGVN                          WCAGVN
     I              FEABVN                          WCABVN
     I              FEABDT                          WCABDT
     I              FEABTM                          WCABTM
      *
     I@FECPHA
      * Export Loin Range Prm Sum Update index
      * Renamed input format fields
     I              FEHONB                          WDHONB
     I              FEEVDT                          WDEVDT
     I              FEG5A1                          WDG5A1
     I              FEG6A1                          WDG6A1
     I              FEG7A1                          WDG7A1
     I              FEG8A1                          WDG8A1
     I              FEG9A1                          WDG9A1
     I              FEHAA1                          WDHAA1
     I              FEQCTX                          WDQCTX
     I              FEQDTX                          WDQDTX
     I              FEQETX                          WDQETX
     I              FEAAVN                          WDAAVN
     I              FEAADT                          WDAADT
     I              FEAMTM                          WDAMTM
     I              FEAJST                          WDAJST
     I              FEAHVN                          WDAHVN
     I              FEAGVN                          WDAGVN
     I              FEABVN                          WDABVN
     I              FEABDT                          WDABDT
     I              FEABTM                          WDABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKFE1    E DSPKFECPL0
      * UPD : Export Loin Range Prm Sum Update index
      * Renamed input format fields
     I              FEHONB                          WDHONB
     I              FEEVDT                          WDEVDT
     I              FEG5A1                          WDG5A1
     I              FEG6A1                          WDG6A1
     I              FEG7A1                          WDG7A1
     I              FEG8A1                          WDG8A1
     I              FEG9A1                          WDG9A1
     I              FEHAA1                          WDHAA1
     I              FEQCTX                          WDQCTX
     I              FEQDTX                          WDQDTX
     I              FEQETX                          WDQETX
     I              FEAAVN                          WDAAVN
     I              FEAADT                          WDAADT
     I              FEAMTM                          WDAMTM
     I              FEAJST                          WDAJST
     I              FEAHVN                          WDAHVN
     I              FEAGVN                          WDAGVN
     I              FEABVN                          WDABVN
     I              FEABDT                          WDABDT
     I              FEABTM                          WDABTM
      *
     IYARDCS      DS                            132
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Export Loin Range Prm Sum
      * I :  Production Date
     I                                    P   1   40P1EVDT
      * N :  Shift A Low Count
     I                                    P   5   70P1G5A1
      * N :  Shift A Export Count
     I                                    P   8  100P1G6A1
      * N :  Shift A High Count
     I                                    P  11  130P1G7A1
      * N :  Shift B Low Count
     I                                    P  14  160P1G8A1
      * N :  Shift B Export Count
     I                                    P  17  190P1G9A1
      * N :  Shift B High Count
     I                                    P  20  220P1HAA1
     IP2PARM      DS
      * FLD: Export Loin Weight Range
      * N :  Low Range Min Weight
     I                                    P   1   31P2HBA1
      * N :  Low Range Max Weight
     I                                    P   4   61P2HCA1
      * N :  Export Range Min Weight
     I                                    P   7   91P2HDA1
      * N :  Export Range Max Weight
     I                                    P  10  121P2HEA1
      * N :  High Range Min Weight
     I                                    P  13  151P2HFA1
      * N :  High Range Max Weight
     I                                    P  16  181P2HGA1
      * N :  Low Description
     I                                       19  35 P2QCTX
      * N :  Export Description
     I                                       36  52 P2QDTX
      * N :  High Description
     I                                       53  69 P2QETX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1EVDT    PARM           WP0001  70       Production Date
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Rtv Loin Range Count  XF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           WUJ8NB    PARM *BLANK    WQ0001  3        Oms Warehouse C
     C           YL0001    PARM *ZERO     WQ0002  30       CC Company Numb
     C                     PARM 'HPE'     WQ0003  6        Oms Application
     C           WUC8CD    PARM *BLANK    WQ0004  3        Oms SalesPerson
     C           WUG8ST    PARM *BLANK    WQ0005  1        Oms Allow Multi
     C           WUG9ST    PARM *BLANK    WQ0006 10        Oms Default Pri
     C           WUEUTX    PARM *BLANK    WQ0007 30        Oms Name
     C           WUEVTX    PARM *BLANK    WQ0008 40        Oms System Valu
     C           WUHAST    PARM *BLANK    WQ0009  1        Oms Access Deni
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rtv Exp Loin Wt Rngs  RT - Export Loin Weight Range  * 
     C                     EXSR SARVGN
      * Rtv Loin Range Count  RT - Primal Scale Detail  * 
     C                     EXSR SBRVGN
      * Rtv Loin Range Count  RT - Primal Scale Detail  * 
     C                     EXSR SCRVGN
      * Rtv/Chg/Crt Exp Loin  RT - Export Loin Range Prm Sum  * 
     C                     EXSR SDRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Exp Loin Wt Rngs  RT - Export Loin Weight Range  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAHONB           CC Company Numb
      * Setup key
     C                     Z-ADDYL0001    WAHONB           CC Company Numb
      * Establish starting position
     C           KRSSA     CHAIN@FFREHE              90    *
      * Data record not found
     C   90                MOVEL'PRK1003' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAHBA1    P2HBA1           Low Range Min W
     C                     Z-ADDWAHCA1    P2HCA1           Low Range Max W
     C                     Z-ADDWAHDA1    P2HDA1           Export Range Mi
     C                     Z-ADDWAHEA1    P2HEA1           Export Range Ma
     C                     Z-ADDWAHFA1    P2HFA1           High Range Min
     C                     Z-ADDWAHGA1    P2HGA1           High Range Max
     C                     MOVELWAQCTX    P2QCTX           Low Description
     C                     MOVELWAQDTX    P2QDTX           Export Descript
     C                     MOVELWAQETX    P2QETX           High Descriptio
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Loin Range Count  RT - Primal Scale Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHONB    WQSB01           CC Company Numb
     C           *LIKE     DEFN WBCZDT    WQSB02           PSA Cut Date
     C           *LIKE     DEFN WBYSNB    WQSB03           PSA Scale ID
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           CC Company Numb
     C                     KFLD           WQSB02           PSA Cut Date
     C                     KFLD           WQSB03           PSA Scale ID
      * Setup key
     C                     Z-ADDYL0001    WQSB01           CC Company Numb
     C                     Z-ADDP1EVDT    WQSB02           PSA Cut Date
     C                     MOVEL'03'      WQSB03           PSA Scale ID
      * Establish starting position
     C           KRSSB     SETLL@DLCPUK                    *
     C           KRSSB     READE@DLCPUK                  90*
      * Data record not found
     C   90                MOVEL'PRK0622' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Low Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.Low Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.Low Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HBA1                     *IF
     C           WBYWNB    IFLE P2HCA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G5A1           Shift A Low Cou
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1G8A1           Shift B Low Cou
     C                     END                             *FI
     C                     END                             *FI
      * Export Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.Export Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.Export Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HDA1                     *IF
     C           WBYWNB    IFLE P2HEA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G6A1           Shift A Export
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1G9A1           Shift B Export
     C                     END                             *FI
     C                     END                             *FI
      * High Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.High Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.High Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HFA1                     *IF
     C           WBYWNB    IFLE P2HGA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G7A1           Shift A High Co
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1HAA1           Shift B High Co
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSB     READE@DLCPUK                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Loin Range Count  RT - Primal Scale Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHONB    WQSC01           CC Company Numb
     C           *LIKE     DEFN WBCZDT    WQSC02           PSA Cut Date
     C           *LIKE     DEFN WBYSNB    WQSC03           PSA Scale ID
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           CC Company Numb
     C                     KFLD           WQSC02           PSA Cut Date
     C                     KFLD           WQSC03           PSA Scale ID
      * Setup key
     C                     Z-ADDYL0001    WQSC01           CC Company Numb
     C                     Z-ADDP1EVDT    WQSC02           PSA Cut Date
     C                     MOVEL'04'      WQSC03           PSA Scale ID
      * Establish starting position
     C           KRSSC     SETLL@DLCPUK                    *
     C           KRSSC     READE@DLCPUK                  90*
      * Data record not found
     C   90                MOVEL'PRK0622' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Low Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.Low Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.Low Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HBA1                     *IF
     C           WBYWNB    IFLE P2HCA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G5A1           Shift A Low Cou
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1G8A1           Shift B Low Cou
     C                     END                             *FI
     C                     END                             *FI
      * Export Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.Export Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.Export Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HDA1                     *IF
     C           WBYWNB    IFLE P2HEA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G6A1           Shift A Export
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1G9A1           Shift B Export
     C                     END                             *FI
     C                     END                             *FI
      * High Range Count
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.PSA Weight GE PAR.High Range Min Weight
      *   |- c2    : DB1.PSA Weight LE PAR.High Range Max Weight
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBYWNB    IFGE P2HFA1                     *IF
     C           WBYWNB    IFLE P2HGA1                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.PSA Shift is Shift 1
     C           WBPWST    IFEQ '1'                        *IF
     C                     ADD  1         P1G7A1           Shift A High Co
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  1         P1HAA1           Shift B High Co
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSC     READE@DLCPUK                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv/Chg/Crt Exp Loin  RT - Export Loin Range Prm Sum  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WCHONB           CC Company Numb
     C                     KFLD           WCEVDT           Production Date
      * Setup key
     C                     Z-ADDYL0001    WCHONB           CC Company Numb
     C                     Z-ADDP1EVDT    WCEVDT           Production Date
      * Establish starting position
     C           KRSSD     CHAIN@FECPHB              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1001' W0RTN   7
      * USER: Processing if Data record not found
      * Create Export Loin Range - Export Loin Range Prm Sum  * 
     C                     EXSR SECRRC
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Change Export Loin Range - Export Loin Range Prm Sum  * 
     C                     EXSR SFCHRC
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Create Export Loin Range - Export Loin Range Prm Sum  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001 10        RS User Changed
     C                     Z-ADD*ZERO     WN0002  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0003  60       RS Time Changed
     C                     MOVEL*BLANK    WN0004  1        RS Record Statu
     C                     MOVEL*BLANK    WN0005 10        RS Job
     C                     MOVEL*BLANK    WN0006 10        RS Program
     C                     MOVEL*BLANK    WN0007 10        RS User Added
     C                     Z-ADD*ZERO     WN0008  70       RS Date Added
     C                     Z-ADD*ZERO     WN0009  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @FECPHA
     C                     Z-ADDYL0001    WDHONB           CC Company Numb
     C                     Z-ADDP1EVDT    WDEVDT           Production Date
     C                     Z-ADDP1G5A1    WDG5A1           Shift A Low Cou
     C                     Z-ADDP1G6A1    WDG6A1           Shift A Export
     C                     Z-ADDP1G7A1    WDG7A1           Shift A High Co
     C                     Z-ADDP1G8A1    WDG8A1           Shift B Low Cou
     C                     Z-ADDP1G9A1    WDG9A1           Shift B Export
     C                     Z-ADDP1HAA1    WDHAA1           Shift B High Co
     C                     MOVELP2QCTX    WDQCTX           Low Description
     C                     MOVELP2QDTX    WDQDTX           Export Descript
     C                     MOVELP2QETX    WDQETX           High Descriptio
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WDAJST           RS Record Statu
     C                     MOVEL##USR     WDABVN           RS User Added
     C                     Z-ADD##JDT     WDABDT           RS Date Added
     C                     Z-ADD##JTM     WDABTM           RS Time Added
     C                     MOVEL##PGM     WDAGVN           RS Program
     C                     MOVEL##JOB     WDAHVN           RS Job
     C           KLCRSE    KLIST
     C                     KFLD           WDHONB           CC Company Numb
     C                     KFLD           WDEVDT           Production Date
      * Check for duplicate primary key
     C           KLCRSE    SETLL@FECPHA                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1002' W0RTN   7
      * Send message 'Export Loin Range Prm  EX'
     C                     MOVEL'PRK1002' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@FECPHA                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * Change Export Loin Range - Export Loin Range Prm Sum  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0010 10        RS User Changed
     C                     Z-ADD*ZERO     WN0011  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0012  60       RS Time Changed
     C                     MOVEL*BLANK    WN0013  1        RS Record Statu
     C                     MOVEL*BLANK    WN0014 10        RS Job
     C                     MOVEL*BLANK    WN0015 10        RS Program
     C                     MOVEL*BLANK    WN0016 10        RS User Added
     C                     Z-ADD*ZERO     WN0017  70       RS Date Added
     C                     Z-ADD*ZERO     WN0018  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @FECPHA
     C                     Z-ADDYL0001    WDHONB           CC Company Numb
     C                     Z-ADDP1EVDT    WDEVDT           Production Date
      *
     C           KLCHSF    KLIST
     C                     KFLD           WDHONB           CC Company Numb
     C                     KFLD           WDEVDT           Production Date
     C           KLCHSF    CHAIN@FECPHA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKFECPL0'MDACP
     C                     MOVEL'@FECPHA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKFE1    YARDCS
      * Move non-key fields to @FECPHA
     C                     Z-ADDP1G5A1    WDG5A1           Shift A Low Cou
     C                     Z-ADDP1G6A1    WDG6A1           Shift A Export
     C                     Z-ADDP1G7A1    WDG7A1           Shift A High Co
     C                     Z-ADDP1G8A1    WDG8A1           Shift B Low Cou
     C                     Z-ADDP1G9A1    WDG9A1           Shift B Export
     C                     Z-ADDP1HAA1    WDHAA1           Shift B High Co
     C                     MOVELP2QCTX    WDQCTX    P      Low Description
     C                     MOVELP2QDTX    WDQDTX    P      Export Descript
     C                     MOVELP2QETX    WDQETX    P      High Descriptio
      *
      * Set PGM.*Record Data Changed flag
     C           QPKFE1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WDAAVN           RS User Changed
     C                     Z-ADD##JDT     WDAADT           RS Date Changed
     C                     Z-ADD##JTM     WDAMTM           RS Time Changed
     C                     MOVEL##JOB     WDAHVN           RS Job
     C                     MOVEL##PGM     WDAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKFE1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@FECPHA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKFECPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1G5A1           Shift A Low Cou
     C                     Z-ADD*ZERO     P1G6A1           Shift A Export
     C                     Z-ADD*ZERO     P1G7A1           Shift A High Co
     C                     Z-ADD*ZERO     P1G8A1           Shift B Low Cou
     C                     Z-ADD*ZERO     P1G9A1           Shift B Export
     C                     Z-ADD*ZERO     P1HAA1           Shift B High Co
     C                     Z-ADD*ZERO     P2HBA1           Low Range Min W
     C                     Z-ADD*ZERO     P2HCA1           Low Range Max W
     C                     Z-ADD*ZERO     P2HDA1           Export Range Mi
     C                     Z-ADD*ZERO     P2HEA1           Export Range Ma
     C                     Z-ADD*ZERO     P2HFA1           High Range Min
     C                     Z-ADD*ZERO     P2HGA1           High Range Max
     C                     MOVEL*BLANK    P2QCTX           Low Description
     C                     MOVEL*BLANK    P2QDTX           Export Descript
     C                     MOVEL*BLANK    P2QETX           High Descriptio
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Oms Warehouse Code
     C                     MOVEL*BLANK    WUJ8NB  3
      * Define work field Oms SalesPerson Code
     C                     MOVEL*BLANK    WUC8CD  3
      * Define work field Oms Allow Multi-Company
     C                     MOVEL*BLANK    WUG8ST  1
      * Define work field Oms Default Printer
     C                     MOVEL*BLANK    WUG9ST 10
      * Define work field Oms Name
     C                     MOVEL*BLANK    WUEUTX 30
      * Define work field Oms System Value Alpha
     C                     MOVEL*BLANK    WUEVTX 40
      * Define work field Oms Access Denied (Y/N)
     C                     MOVEL*BLANK    WUHAST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WAHBA1           Low Range Min W
     C                     Z-ADD*ZERO     WAHCA1           Low Range Max W
     C                     Z-ADD*ZERO     WAHDA1           Export Range Mi
     C                     Z-ADD*ZERO     WAHEA1           Export Range Ma
     C                     Z-ADD*ZERO     WAHFA1           High Range Min
     C                     Z-ADD*ZERO     WAHGA1           High Range Max
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHONB           CC Company Numb
     C                     Z-ADD*ZERO     WBCZDT           PSA Cut Date
     C                     Z-ADD*ZERO     WBAQTM           PSA Cut Time
     C                     Z-ADD*ZERO     WBYZNB           PSA Sequence
     C                     Z-ADD*ZERO     WBYUNB           PSA Count
     C                     Z-ADD*ZERO     WBYWNB           PSA Weight
     C                     Z-ADD*ZERO     WBYXNB           PSA Tattoo
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHONB           CC Company Numb
     C                     Z-ADD*ZERO     WCEVDT           Production Date
     C                     Z-ADD*ZERO     WCG5A1           Shift A Low Cou
     C                     Z-ADD*ZERO     WCG6A1           Shift A Export
     C                     Z-ADD*ZERO     WCG7A1           Shift A High Co
     C                     Z-ADD*ZERO     WCG8A1           Shift B Low Cou
     C                     Z-ADD*ZERO     WCG9A1           Shift B Export
     C                     Z-ADD*ZERO     WCHAA1           Shift B High Co
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Clear all neither parameters
      * Create Export Loin Range - Export Loin Range Prm Sum  * 
     C                     Z-ADD*ZERO     WDAADT           RS Date Changed
     C                     Z-ADD*ZERO     WDAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WDABDT           RS Date Added
     C                     Z-ADD*ZERO     WDABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Define local work field CC Company Number
     C                     Z-ADD*ZERO     YL0001  30
      *================================================================
     CSR         ZZEXIT    ENDSR
