// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBBOXFR
// ?Date: 14.08.2025 Time: 03:47:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** If the trailer is not on an active load, delete it.
EXECUTE FUNCTION(DLT Unassigned TrailersIF) TYPE(EXCINTFUN)                     AC2084371;
{
 //?Execute internal function

 //?** If the trailer is not on an active load, delete it.
 EXECUTE FUNCTION(RTV/DLT Unassgnd Trlrs RT) TYPE(RTVOBJ) FILE(PDLYREP)          AC2084372;
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 {
  //?USER: Process Data record

  // LCL.Delete/Init Sts USR = CND.Initialize
  LCL.Delete_Init_Sts_USR = 'I';

  //?Delete if inactive or deleted (I or D)
  CASE;

  // IF DB1.Record Status is Inactive/Delete
  IF DB1.Record_Status = 'D'/'I';

  // LCL.Delete/Init Sts USR = CND.Delete
  LCL.Delete_Init_Sts_USR = 'D';

  // PAR.USR Active Load = CND.no
  PAR.USR_Active_Load = 'N';

  //?Delete if inactive or deleted (I or D)
  // IF *OTHERWISE
  IF *OTHERWISE;

  //?** Check the Load Header by Carrier/Trailer.
  //?** If the trailer is not on an active load, flag to delete
  EXECUTE FUNCTION(RTV Load for Purge TrlrRT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC2084362;
  PARAMETER(LCL.Load_ID);
  PARAMETER(LCL.Company_Number);
  PARAMETER(LCL.Load_Status);
  PARAMETER(DB1.Trailer_Id);
  PARAMETER(DB1.Carrier_Code);
  PARAMETER(LCL.Load_Type);
  PARAMETER(LCL.BOL_Complete_Date);
  PARAMETER(LCL.BOL_Complete_Time);
  PARAMETER(LCL.Truck_Departure_Date);
  PARAMETER(LCL.Truck_Departure_Time);
  PARAMETER(LCL.Deadline_Departure_Date);
  PARAMETER(LCL.Deadline_Departure_Time);
  PARAMETER(PAR.USR_Active_Load);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   //?USER: Process Data record

   CASE;

   // IF DB1.Load Status is Invoiced
   IF DB1.Load_Status = 'I';

   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   // IF DB1.Truck Departure Date is not entered
   IF DB1.Truck_Departure_Date = *ZERO;

   //?Active load
   MOVE *ALL (To: PAR From: DB1);

   // PAR.USR Active Load = CND.yes
   PAR.USR_Active_Load = 'Y';

   QUIT;

   // IF *OTHERWISE
   IF *OTHERWISE;

   //?NOT Active load
   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   ENDIF;

  }

  CASE;

  // IF PGM.*Return code is *Record does not exist
  IF PGM.*Return_code = 'Y2U0005';

  // LCL.Delete/Init Sts USR = CND.Delete
  LCL.Delete_Init_Sts_USR = 'D';

  // IF PAR.USR Active Load is no
  IF PAR.USR_Active_Load = 'N';

  // LCL.Delete/Init Sts USR = CND.Delete
  LCL.Delete_Init_Sts_USR = 'D';

  ENDIF;

  //?** Check the Load Header by Carrier/Container# (for Exports)
  //?** If the container is not on an active load, flag to delete
  EXECUTE FUNCTION(RTV Load for Purge CNTNRT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC2086373;
  PARAMETER(LCL.Load_ID);
  PARAMETER(LCL.Company_Number);
  PARAMETER(LCL.Load_Status);
  PARAMETER(DB1.Carrier_Code);
  PARAMETER(LCL.Load_Type);
  PARAMETER(LCL.BOL_Complete_Date);
  PARAMETER(LCL.BOL_Complete_Time);
  PARAMETER(LCL.Truck_Departure_Date);
  PARAMETER(LCL.Truck_Departure_Time);
  PARAMETER(DB1.Trailer_Id);
  PARAMETER(LCL.Deadline_Departure_Date);
  PARAMETER(LCL.Deadline_Departure_Time);
  PARAMETER(PAR.USR_Active_Load);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   //?USER: Process Data record

   CASE;

   // IF DB1.Load Status is Invoiced
   IF DB1.Load_Status = 'I';

   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   // IF DB1.Truck Departure Date is not entered
   IF DB1.Truck_Departure_Date = *ZERO;

   //?Active load
   MOVE *ALL (To: PAR From: DB1);

   // PAR.USR Active Load = CND.yes
   PAR.USR_Active_Load = 'Y';

   QUIT;

   // IF *OTHERWISE
   IF *OTHERWISE;

   //?NOT Active load
   // PAR.USR Active Load = CND.no
   PAR.USR_Active_Load = 'N';

   ENDIF;

  }

  ENDIF;

  //?Delete if trailer or container not on active load
  CASE;

  // IF LCL.Delete/Init Sts USR is Delete
  IF LCL.Delete_Init_Sts_USR = 'D';

  // AND PAR.USR Active Load is no
  AND PAR.USR_Active_Load = 'N';

  EXECUTE FUNCTION(RTV/DLT Assigned Trlr  RT) TYPE(RTVOBJ) FILE(PDLYREP)          AC2086635;
  PARAMETER(DB1.Carrier_Code);
  PARAMETER(DB1.Trailer_Id);
  {
   //?USER: Processing if Data record not found

   //?* Not an error, may have been deleted from another order on load
   // PGM.*Return code = CND.*Normal
   PGM.*Return_code = *BLANK;

   //?USER: Process Data record

   EXECUTE FUNCTION(DLT Trailer            DO) TYPE(DLTOBJ) FILE(PDLYREP)          AC1496470;
   PARAMETER(DB1.Carrier_Code);
   PARAMETER(DB1.Trailer_Id);
  }

  ENDIF;

 }

}


