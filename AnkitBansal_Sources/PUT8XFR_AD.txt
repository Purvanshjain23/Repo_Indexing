// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUT8XFR
// ?Date: 14.08.2025 Time: 03:51:23
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(ECP004)            AC2199654;
PARAMETER(1210911);
{
 //?USER: Process Data record

 //?Quit If Order Date is Prior to 01/01/2020. Read Order Date in DESC Seq.
 CASE;

 // IF DB1.G5002-ORDER DATE is LT 01/01/2020
 IF DB1.G5002_ORDER_DATE < 1200101;

 QUIT;

 //?Quit If Order Date is Prior to 01/01/2020. Read Order Date in DESC Seq.
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Order Number & PO# Must Exist.
 CASE;

 // IF DB1.OH Order Number is Not Blanks
 IF DB1.OH_Order_Number <> *BLANK;

 // AND DB1.G5003-PURCHASE ORDER NUMB is Entered
 AND DB1.G5003_PURCHASE_ORDER_NUMB <> *BLANK;

 //?SST & Convert Order Number.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Order Number Alpha = SUBSTRING(DB1.OH Order Number,CON.1,CON.7)
 LCL.Order_Number_Alpha = SUBSTRING(DB1.OH_Order_Number:1:7);

 // LCL.Order Number = CVTVAR(LCL.Order Number Alpha)
 LCL.Order_Number = CVTVAR(LCL.Order_Number_Alpha);

 ENDIF;

 CASE;

 // IF LCL.Order Number is Greater then zero
 IF LCL.Order_Number > *ZERO;

 //?Scan for '+' Which Indicates Multiple Orders Were Created.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // Execute function Eus Scan for '+'      US.
 EXECUTE FUNCTION(Eus Scan for '+'      US) TYPE(EXCUSRSRC) ('PUUDUFR');
 PARAMETER(DB1.OH_Order_Number);
 PARAMETER(LCL.Character_Found_USR);
 {
  * Scan for '+' which indicates multiple Orders were created.
  d $string_data    s             30a   inz(*blank)
  d $pos            s              5u 0 inz(*zero)
  *
  /free
  $string_data = #IBXU1;
  $pos = %scan ('+' : $string_data);
  If $pos = 0;
  #OMGSC = 'N';
  Else;
  #OMGSC = 'Y';
  EndIf;
  /end-free
 }

 ENDIF;

 //?Multiple Orders Found, Then RST Only on PO# Else RST PO#/Order#.
 CASE;

 // IF LCL.Character Found USR is Yes
 IF LCL.Character_Found_USR = 'Y';

 EXECUTE FUNCTION(Cnv Upd EDI Ord Auto2 RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC2200182;
 PARAMETER(DB1.G5003_PURCHASE_ORDER_NUMB);
 PARAMETER(DB1.G5002_ORDER_DATE);
 PARAMETER(DB1.EDI_Trading_Partner_No);
 {
  //?USER: Process Data record

  // LCL.USR From Date = DB1.Order Date + CON.-5 *DAYS
  LCL.USR_From_Date = DATEINCR(DB1.Order_Date '-5' 'DY' 1111111 'NONE' 'N' 1);

  // LCL.USR Through Date = DB1.Order Date + CON.5 *DAYS
  LCL.USR_Through_Date = DATEINCR(DB1.Order_Date 5 'DY' 1111111 'NONE' 'N' 1);

  //?Order Date Must Be Within +/- 5 Days of PO Date.
  CASE;

  // IF PAR.G5002-ORDER DATE GE LCL.USR From Date
  IF PAR.G5002_ORDER_DATE >= LCL.USR_From_Date;

  // AND PAR.G5002-ORDER DATE LE LCL.USR Through Date
  AND PAR.G5002_ORDER_DATE <= LCL.USR_Through_Date;

  EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(PNGQREP)           AC2199659;
  PARAMETER(DB1.Bill_to_Customer);
  PARAMETER(PAR.EDI_Trading_Partner_No);
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  {
   //?USER: Process Data record

   //?EDI Trading Partner No. Must Match.
   CASE;

   // IF PAR.EDI Trading Partner No. EQ DB1.EDI Trading Partner No.
   IF PAR.EDI_Trading_Partner_No = DB1.EDI_Trading_Partner_No;

   //?Update OHE EDI Order Automated='Y' in OHE File.
   EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(PMAMREP)           AC2199661;
   PARAMETER(PAR.Company_Number);
   PARAMETER(PAR.Order_Number);
   {
    //?USER: Process Data record

    CASE;

    // IF NOT DB1.OHE EDI Order Automated is Yes
    IF ! DB1.OHE_EDI_Order_Automated = 'Y';

    EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  CH) TYPE(CHGOBJ) FILE(PMAMREP)           AC2199662;
    PARAMETER(DB1.Company_Number);
    PARAMETER(DB1.Order_Number);
    PARAMETER('Y');
    {
     //?USER: Processing before Data update

     // DB1.Job Time = JOB.*Job time
     DB1.Job_Time = JOB.*Job_time;

     // DB1.Job Date = JOB.*Job date
     DB1.Job_Date = JOB.*Job_date;

     // DB1.Job Name = JOB.*PROGRAM
     DB1.Job_Name = JOB.*PROGRAM;

     // DB1.User Id = JOB.*USER
     DB1.User_Id = JOB.*USER;

    }

    ENDIF;

   }

   QUIT;

   ENDIF;

  }

  ENDIF;

 }

 //?Multiple Orders Found, Then RST Only on PO# Else RST PO#/Order#.
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC2199658;
 PARAMETER(DB1.G5003_PURCHASE_ORDER_NUMB);
 PARAMETER(LCL.Order_Number);
 PARAMETER(DB1.G5002_ORDER_DATE);
 PARAMETER(DB1.EDI_Trading_Partner_No);
 {
  //?USER: Process Data record

  // LCL.USR From Date = DB1.Order Date + CON.-5 *DAYS
  LCL.USR_From_Date = DATEINCR(DB1.Order_Date '-5' 'DY' 1111111 'NONE' 'N' 1);

  // LCL.USR Through Date = DB1.Order Date + CON.5 *DAYS
  LCL.USR_Through_Date = DATEINCR(DB1.Order_Date 5 'DY' 1111111 'NONE' 'N' 1);

  //?Order Date Must Be Within +/- 5 Days of PO Date.
  CASE;

  // IF PAR.G5002-ORDER DATE GE LCL.USR From Date
  IF PAR.G5002_ORDER_DATE >= LCL.USR_From_Date;

  // AND PAR.G5002-ORDER DATE LE LCL.USR Through Date
  AND PAR.G5002_ORDER_DATE <= LCL.USR_Through_Date;

  EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(PNGQREP)           AC2199659;
  PARAMETER(DB1.Bill_to_Customer);
  PARAMETER(PAR.EDI_Trading_Partner_No);
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  {
   //?USER: Process Data record

   //?EDI Trading Partner No. Must Match.
   CASE;

   // IF PAR.EDI Trading Partner No. EQ DB1.EDI Trading Partner No.
   IF PAR.EDI_Trading_Partner_No = DB1.EDI_Trading_Partner_No;

   //?Update OHE EDI Order Automated='Y' in OHE File.
   EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  RT) TYPE(RTVOBJ) FILE(PMAMREP)           AC2199661;
   PARAMETER(PAR.Company_Number);
   PARAMETER(PAR.Order_Number);
   {
    //?USER: Process Data record

    CASE;

    // IF NOT DB1.OHE EDI Order Automated is Yes
    IF ! DB1.OHE_EDI_Order_Automated = 'Y';

    EXECUTE FUNCTION(Cnv Upd EDI Ord Auto  CH) TYPE(CHGOBJ) FILE(PMAMREP)           AC2199662;
    PARAMETER(DB1.Company_Number);
    PARAMETER(DB1.Order_Number);
    PARAMETER('Y');
    {
     //?USER: Processing before Data update

     // DB1.Job Time = JOB.*Job time
     DB1.Job_Time = JOB.*Job_time;

     // DB1.Job Date = JOB.*Job date
     DB1.Job_Date = JOB.*Job_date;

     // DB1.Job Name = JOB.*PROGRAM
     DB1.Job_Name = JOB.*PROGRAM;

     // DB1.User Id = JOB.*USER
     DB1.User_Id = JOB.*USER;

    }

    ENDIF;

   }

   QUIT;

   ENDIF;

  }

  ENDIF;

 }

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


