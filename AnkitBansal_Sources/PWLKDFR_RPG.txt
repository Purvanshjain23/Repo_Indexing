     H/TITLE WW Tattoo Repay Dtl   DF  Display file
     H            Y
     Z* CRTRPGPGM
     Z* OPTION(*SRCDBG) CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Display file
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISJMIST
     H* Date          : 01/18/24  Time  : 08:11:44
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPWLKDFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW Tattoo Repay Dtl   DF  Display file
      *
     FPWAXCPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Tattoo Repayment Detail   Retrieval index
      *
     FPKC4REL1IF  E           K        DISK
      * RTV : Payment Processing Parms  Retrieval index
      *
     FPKAWCPL1IF  E           K        DISK
      * RTV : Buy Order Header          Retrieval index
      *
     FPKA1CPL0IF  E           K        DISK
      * RTV : Tattoo Header             Retrieval index
      *
     FPWAWCPL0IF  E           K        DISK
      * RTV : Tattoo Repayment Header   Retrieval index
      *
     FPWAYCPL3IF  E           K        DISK
      * RSQ : Tattoo Repayment Comment  Co#/Repay ID/Seq# (d)
      *
     FPWAWCPL1UF  E           K        DISK
      * UPD : Tattoo Repayment Header   Update index
      *
     FPWAYCPL0IF  E           K        DISK                      A
      * UPD : Tattoo Repayment Comment  Update index
      *
     FPKC4REL0UF  E           K        DISK
      * UPD : Payment Processing Parms  Update index
      *
     FPWAXCPL0UF  E           K        DISK
      * UPD : Tattoo Repayment Detail   Update index
      *
      * Long constants
     E                    @CN#    1  33  6   @CN    25
     E                    YDOW        7  1               *Days of week
     I@AWCPAQ
      * Tattoo Repayment Header   Retrieval index
      * Renamed input format fields
     I              AWHONB                          WAHONB
     I              AWCDNZ                          WACDNZ
     I              AWMASS                          WAMASS
     I              AWIDDT                          WAIDDT
     I              AWCATM                          WACATM
     I              AWIEDT                          WAIEDT
     I              AWCBTM                          WACBTM
     I              AWIFDT                          WAIFDT
     I              AWCTNZ                          WACTNZ
     I              AWHOT1                          WAHOT1
     I              AWAAVN                          WAAAVN
     I              AWAADT                          WAAADT
     I              AWAMTM                          WAAMTM
     I              AWAJST                          WAAJST
     I              AWAHVN                          WAAHVN
     I              AWAGVN                          WAAGVN
     I              AWABVN                          WAABVN
     I              AWABDT                          WAABDT
     I              AWABTM                          WAABTM
      *
     I@AWCPAR
      * Tattoo Repayment Header   Update index
      * Renamed input format fields
     I              AWHONB                          WBHONB
     I              AWCDNZ                          WBCDNZ
     I              AWMASS                          WBMASS
     I              AWIDDT                          WBIDDT
     I              AWCATM                          WBCATM
     I              AWIEDT                          WBIEDT
     I              AWCBTM                          WBCBTM
     I              AWIFDT                          WBIFDT
     I              AWCTNZ                          WBCTNZ
     I              AWHOT1                          WBHOT1
     I              AWAAVN                          WBAAVN
     I              AWAADT                          WBAADT
     I              AWAMTM                          WBAMTM
     I              AWAJST                          WBAJST
     I              AWAHVN                          WBAHVN
     I              AWAGVN                          WBAGVN
     I              AWABVN                          WBABVN
     I              AWABDT                          WBABDT
     I              AWABTM                          WBABTM
      *
     I@AYCPA6
      * Tattoo Repayment Comment  Co#/Repay ID/Seq# (d)
      * Renamed input format fields
     I              AYHONB                          WCHONB
     I              AYCDNZ                          WCCDNZ
     I              AYCINZ                          WCCINZ
     I              AYHMNB                          WCHMNB
     I              AYBNNB                          WCBNNB
     I              AYBONB                          WCBONB
     I              AYCVNB                          WCCVNB
     I              AYB0DT                          WCB0DT
     I              AYG7T1                          WCG7T1
     I              AYMKSS                          WCMKSS
     I              AYAAVN                          WCAAVN
     I              AYAADT                          WCAADT
     I              AYAMTM                          WCAMTM
     I              AYAJST                          WCAJST
     I              AYAHVN                          WCAHVN
     I              AYAGVN                          WCAGVN
     I              AYABVN                          WCABVN
     I              AYABDT                          WCABDT
     I              AYABTM                          WCABTM
      *
     I@C4REO6
      * Payment Processing Parms  Update index
      * Renamed input format fields
     I              C4HONB                          WDHONB
     I              C4CKDT                          WDCKDT
     I              C4M1NB                          WDM1NB
     I              C4KHST                          WDKHST
     I              C4KJST                          WDKJST
     I              C4PINB                          WDPINB
     I              C4KKST                          WDKKST
     I              C4AAVN                          WDAAVN
     I              C4AADT                          WDAADT
     I              C4AMTM                          WDAMTM
     I              C4AJST                          WDAJST
     I              C4AHVN                          WDAHVN
     I              C4AGVN                          WDAGVN
     I              C4ABVN                          WDABVN
     I              C4ABDT                          WDABDT
     I              C4ABTM                          WDABTM
      *
     I@AXCPAW
      * Tattoo Repayment Detail   Update index
      * Renamed input format fields
     I              AXHONB                          WEHONB
     I              AXCDNZ                          WECDNZ
     I              AXHMNB                          WEHMNB
     I              AXBNNB                          WEBNNB
     I              AXBONB                          WEBONB
     I              AXCVNB                          WECVNB
     I              AXB0DT                          WEB0DT
     I              AXCGNZ                          WECGNZ
     I              AXCENZ                          WECENZ
     I              AXCFNZ                          WECFNZ
     I              AXIIDT                          WEIIDT
     I              AXTOCD                          WETOCD
     I              AXTPCD                          WETPCD
     I              AXINT1                          WEINT1
     I              AXMCSS                          WEMCSS
     I              AXC1NZ                          WEC1NZ
     I              AXMZSS                          WEMZSS
     I              AXTNCD                          WETNCD
     I              AXABCD                          WEABCD
     I              AXNYCD                          WENYCD
     I              AXNASS                          WENASS
     I              AXAACD                          WEAACD
     I              AXAECD                          WEAECD
     I              AXAKCD                          WEAKCD
     I              AXALCD                          WEALCD
     I              AXAAVN                          WEAAVN
     I              AXAADT                          WEAADT
     I              AXAMTM                          WEAMTM
     I              AXAJST                          WEAJST
     I              AXAHVN                          WEAHVN
     I              AXAGVN                          WEAGVN
     I              AXABVN                          WEABVN
     I              AXABDT                          WEABDT
     I              AXABTM                          WEABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     IQPWAW1    E DSPWAWCPL1
      * UPD : Tattoo Repayment Header   Update index
      * Renamed input format fields
     I              AWHONB                          WBHONB
     I              AWCDNZ                          WBCDNZ
     I              AWMASS                          WBMASS
     I              AWIDDT                          WBIDDT
     I              AWCATM                          WBCATM
     I              AWIEDT                          WBIEDT
     I              AWCBTM                          WBCBTM
     I              AWIFDT                          WBIFDT
     I              AWCTNZ                          WBCTNZ
     I              AWHOT1                          WBHOT1
     I              AWAAVN                          WBAAVN
     I              AWAADT                          WBAADT
     I              AWAMTM                          WBAMTM
     I              AWAJST                          WBAJST
     I              AWAHVN                          WBAHVN
     I              AWAGVN                          WBAGVN
     I              AWABVN                          WBABVN
     I              AWABDT                          WBABDT
     I              AWABTM                          WBABTM
      *
     IYARDCS      DS                             92
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPWAY1    E DSPWAYCPL0
      * UPD : Tattoo Repayment Comment  Update index
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPKC41    E DSPKC4REL0
      * UPD : Payment Processing Parms  Update index
      * Renamed input format fields
     I              C4HONB                          WDHONB
     I              C4CKDT                          WDCKDT
     I              C4M1NB                          WDM1NB
     I              C4KHST                          WDKHST
     I              C4KJST                          WDKJST
     I              C4PINB                          WDPINB
     I              C4KKST                          WDKKST
     I              C4AAVN                          WDAAVN
     I              C4AADT                          WDAADT
     I              C4AMTM                          WDAMTM
     I              C4AJST                          WDAJST
     I              C4AHVN                          WDAHVN
     I              C4AGVN                          WDAGVN
     I              C4ABVN                          WDABVN
     I              C4ABDT                          WDABDT
     I              C4ABTM                          WDABTM
      *
     IYBRDCS      DS                             72
     IYCRDCS      DS                             92
     IQPWAX1    E DSPWAXCPL0
      * UPD : Tattoo Repayment Detail   Update index
      * Renamed input format fields
     I              AXHONB                          WEHONB
     I              AXCDNZ                          WECDNZ
     I              AXHMNB                          WEHMNB
     I              AXBNNB                          WEBNNB
     I              AXBONB                          WEBONB
     I              AXCVNB                          WECVNB
     I              AXB0DT                          WEB0DT
     I              AXCGNZ                          WECGNZ
     I              AXCENZ                          WECENZ
     I              AXCFNZ                          WECFNZ
     I              AXIIDT                          WEIIDT
     I              AXTOCD                          WETOCD
     I              AXTPCD                          WETPCD
     I              AXINT1                          WEINT1
     I              AXMCSS                          WEMCSS
     I              AXC1NZ                          WEC1NZ
     I              AXMZSS                          WEMZSS
     I              AXTNCD                          WETNCD
     I              AXABCD                          WEABCD
     I              AXNYCD                          WENYCD
     I              AXNASS                          WENASS
     I              AXAACD                          WEAACD
     I              AXAECD                          WEAECD
     I              AXAKCD                          WEAKCD
     I              AXALCD                          WEALCD
     I              AXAAVN                          WEAAVN
     I              AXAADT                          WEAADT
     I              AXAMTM                          WEAMTM
     I              AXAJST                          WEAJST
     I              AXAHVN                          WEAHVN
     I              AXAGVN                          WEAGVN
     I              AXABVN                          WEABVN
     I              AXABDT                          WEABDT
     I              AXABTM                          WEABTM
      *
     IYDRDCS      DS                            160
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Tattoo Repayment Detail
      * I : RST CC Company Number
     I                                    P   1   20P1HONB
      * I : RST TRH Repayment ID
     I                                    P   3   50P1CDNZ
     IP2PARM      DS
      * FLD: Tattoo Repayment Header
      * B :  TRH Repayment Status
     I                                        1   1 P2MASS
      * I :  TRH Date Start
     I                                    P   2   50P2IDDT
      * I :  TRH Time Start
     I                                    P   6   90P2CATM
      * I :  TRH Date Complete
     I                                    P  10  130P2IEDT
      * I :  TRH Time Complete
     I                                    P  14  170P2CBTM
      * I :  TRH Payment Date
     I                                    P  18  210P2IFDT
      * I :  TRH Payment Step
     I                                    P  22  240P2CTNZ
      * I :  TRH Backup File Prefix
     I                                       25  30 P2HOT1
      * Submit job processing data structures.
     I#SRQS       DS                           3000
     I                                        1   1 #SDMY1
     I#SSTR       DS                           3000
     I                                        1   1 #SDMY2
     I#SWRK       DS                           3000
     I                                        1   1 #SDMY3
     I#SMRG       DS                            256
     I                                        1   1 #SDMY4
     I            DS
     I I            'CMD(CALL PGM('           1  13 #SCLL
     I I            'PARM('                  14  18 #SPRM
     I I            ')'                      19  19 #SPRN
     I I            '          '             20  29 #SPRG
      * Submit job command strings.
     I            DS
     I I            'SBMJOB     JOB(REPAY-    1 256 #S0001
     I              'BKUP) LOG(4 00 *SECL-
     I              'VL)                 '
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Repay: Can't FKey+Reason'
      * Text 10 1 USR
     I                                        1  10 ZA0001
      * Message data for 'Repay: Can't FKey+Reason'
      * Text 10 1 USR
     I                                        1  10 ZA0002
      * Message data for 'Repay: Can't SFLSEL-Cancl'
      * *SFLSEL
     I                                        1   1 ZA0003
      * Message data for 'Repay: Can't Dlt Tattoo'
      * *SFLSEL
     I                                        1   1 ZA0004
      * Message data for 'Repay: Can't SFLSEL-Cancl'
      * *SFLSEL
     I                                        1   1 ZA0005
      * Message data for 'Repay: Can't SFLSEL-Xfer'
      * *SFLSEL
     I                                        1   1 ZA0006
      * Message data for 'Repay: Can't Edit-Unpay'
      * *SFLSEL
     I                                        1   1 ZA0007
      * Message data for 'Repay: Option E Not Valid'
      * *SFLSEL
     I                                        1   1 ZA0008
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HONB    PARM           WP0001  30       CC Company Numb
     C           P1CDNZ    PARM           WP0002  50       TRH Repayment I
     C           P2MASS    PARM P2MASS    WP0003  1        TRH Repayment S
     C           P2IDDT    PARM           WP0004  70       TRH Date Start
     C           P2CATM    PARM           WP0005  60       TRH Time Start
     C           P2IEDT    PARM           WP0006  70       TRH Date Comple
     C           P2CBTM    PARM           WP0007  60       TRH Time Comple
     C           P2IFDT    PARM           WP0008  70       TRH Payment Dat
     C           P2CTNZ    PARM           WP0009  50       TRH Payment Ste
     C           P2HOT1    PARM           WP0010  6        TRH Backup File
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile control
     C                     Z-ADDP1HONB    #2HONB           CC Company Numb
     C                     Z-ADDP1HONB    #2HMNB           BOH Company Num
     C                     Z-ADDP1CDNZ    #2CDNZ           TRH Repayment I
      * Cvt Repay Sts to Text IF
      * CASE: PAR.TRH Repayment Status is Cancelled
     C           P2MASS    IFEQ 'X'                        *IF
     C                     MOVEL@CN,001   #CICT1           TRH Repay Statu
     C                     ELSE
      * CASE: PAR.TRH Repayment Status is Created
     C           P2MASS    IFEQ 'C'                        *IF
     C                     MOVEL@CN,002   #CICT1           TRH Repay Statu
     C                     ELSE
      * CASE: PAR.TRH Repayment Status is In Progress
     C           P2MASS    IFEQ 'I'                        *IF
     C                     MOVEL@CN,003   #CICT1           TRH Repay Statu
     C                     ELSE
      * CASE: PAR.TRH Repayment Status is Repaid
     C           P2MASS    IFEQ 'R'                        *IF
     C                     MOVEL@CN,004   #CICT1           TRH Repay Statu
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADDP2IFDT    #CCKDT           Pmt Current Pay
      * Rtv Payment Processing RT - Payment Processing Parms  * 
     C                     EXSR SARVGN
      * Determine Payment Step
      * CASE: LCL.Pmt Current Payment Date EQ PAR.TRH Payment Date
     C           YL0001    IFEQ P2IFDT                     *IF
     C                     Z-ADDYL0002    #CMDNB           @Sequence 1.0
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD1         #CMDNB           @Sequence 1.0
     C                     END                             *FI
      * Retrieve current file backup status
      * CASE: LCL.User Class f/usrprf   USR is *PGMR
     C           YL0005    IFEQ '*PGMR'                    *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,005   CAT  'd up.':ZQ#COBTX    P      Text descriptio
     C                     MOVEL'C'       #CK8SS           File Backup Sta
     C                     ELSE
      * CASE: PAR.TRH Repayment Status is Cancelled or Repaid
     C           P2MASS    IFEQ 'X'                        *IF
     C           P2MASS    OREQ 'R'
     C                     ELSE
      * CASE: *OTHERWISE
      * Rtv Company Values    XF - STR Order Management Sys  * HPEREPAYBU
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HMNB    WQ0001  30       BOH Company Num
     C                     PARM @CN,006   WQ0002 10        Company Value C
     C           YL0006    PARM *BLANK    WQ0003 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Breakout Repayment Backup file values
      * CASE: *OTHERWISE
      * 1. Backup Status (position 1)
     C                     Z-ADD1         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00040
     C           ZQ        ORGT 00040
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0006:ZQ #CK8SS    P  90  File Backup Sta
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * 2. Date of Backup (positions 2-8)
     C                     Z-ADD7         YRSW00
     C                     Z-ADD2         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00040
     C           ZQ        ORGT 00040
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0006:ZQ YL0007    P  90  Date Alpha USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     MOVE YL0007    YL0008           Last Run Date
     C                     MOVEL*BLANK    YL0009           Date From Conve
     C                     MOVELYL0008    YL0009           Date From Conve
      * 3. Last file backed up (positions 9 - 18)
     C                     Z-ADD10        YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00040
     C           ZQ        ORGT 00040
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0006:ZQ YL0010    P  90  File
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * Determine screen backup message
      * CASE: CTL.File Backup Status USR is Backup completed
     C           #CK8SS    IFEQ 'C'                        *IF
      * If Backup Date <> Job Date, files not backed up
      * CASE: LCL.Last Run Date NE JOB.*Job date
     C           YL0008    IFNE ##JDT                      *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,007   CAT  @CN,008:ZQ#COBTX    P      Text descriptio
     C                     ELSE
      * CASE: LCL.Last Run Date EQ JOB.*Job date
     C           YL0008    IFEQ ##JDT                      *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,005   CAT  'd up.':ZQ#COBTX    P      Text descriptio
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: CTL.File Backup Status USR is Backup in progress
     C           #CK8SS    IFEQ 'P'                        *IF
     C                     Z-ADD1         ZQ      50
     C           @CN,009   CAT  @CN,010:ZQ#COBTX    P      Text descriptio
     C                     Z-ADD1         ZQ      50
     C           #COBTX    CAT  YL0010:ZQ #COBTX    P      Text descriptio
     C                     MOVEL'N'       #CK8SS           File Backup Sta
     C                     ELSE
      * CASE: CTL.File Backup Status USR is Error during backup
     C           #CK8SS    IFEQ 'E'                        *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,011   CAT  @CN,012:ZQ#COBTX    P      Text descriptio
     C                     Z-ADD1         ZQ      50
     C           #COBTX    CAT  YL0010:ZQ #COBTX    P      Text descriptio
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           AXHONB           CC Company Numb
     C                     KFLD           AXCDNZ           TRH Repayment I
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
     C                     KFLD           AXCVNB           TH Tattoo Numbe
     C                     KFLD           AXB0DT           TH Kill Date
      * Setup key
     C                     Z-ADD#2HONB    AXHONB
     C                     Z-ADD#2CDNZ    AXCDNZ
     C                     Z-ADD#2HMNB    AXHMNB
     C                     Z-ADD#2BNNB    AXBNNB
     C                     Z-ADD#2BONB    AXBONB
     C                     Z-ADD#2CVNB    AXCVNB
     C                     Z-ADD#2B0DT    AXB0DT
     C           KPOS      SETLL@AXCPAX
     C           KRST      KLIST
     C                     KFLD           AXHONB           CC Company Numb
     C                     KFLD           AXCDNZ           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    AXHONB
     C                     Z-ADD#2CDNZ    AXCDNZ
     C           KRST      READE@AXCPAX                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2HMNB    WZHMNB
     C                     MOVEL#2HMNB    WZHMNB           BOH Company Num
     C           *LIKE     DEFN #2BNNB    WZBNNB
     C                     MOVEL#2BNNB    WZBNNB           BOH Buy Order N
     C           *LIKE     DEFN #2BONB    WZBONB
     C                     MOVEL#2BONB    WZBONB           BOL Load Number
     C           *LIKE     DEFN #2CVNB    WZCVNB
     C                     MOVEL#2CVNB    WZCVNB           TH Tattoo Numbe
     C           *LIKE     DEFN #2B0DT    WZB0DT
     C                     MOVEL#2B0DT    WZB0DT           TH Kill Date
     C           *LIKE     DEFN #2MZSS    WZMZSS
     C                     MOVEL#2MZSS    WZMZSS           TRD Payment Sts
     C           *LIKE     DEFN #2HONB    WZHONB
     C                     MOVEL#2HONB    WZHONB           CC Company Numb
     C           *LIKE     DEFN #2CDNZ    WZCDNZ
     C                     MOVEL#2CDNZ    WZCDNZ           TRH Repayment I
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@AXCPAX                  90*
     C  N82                READ @AXCPAX                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,31
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2HMNB    IFEQ *ZERO                      BOH Company Num
     C           #2BNNB    IFNE *ZERO                      BOH Buy Order N
     C           AXBNNB    CABNE#2BNNB    BB020            BOH Buy Order N
     C                     END
     C                     END
     C           #2HMNB    IFEQ *ZERO                      BOH Company Num
     C           #2BNNB    OREQ *ZERO                      BOH Buy Order N
     C           #2BONB    IFNE *ZERO                      BOL Load Number
     C           AXBONB    CABNE#2BONB    BB020            BOL Load Number
     C                     END
     C                     END
     C           #2HMNB    IFEQ *ZERO                      BOH Company Num
     C           #2BNNB    OREQ *ZERO                      BOH Buy Order N
     C           #2BONB    OREQ *ZERO                      BOL Load Number
     C           #2CVNB    IFNE *ZERO                      TH Tattoo Numbe
     C           AXCVNB    CABNE#2CVNB    BB020            TH Tattoo Numbe
     C                     END
     C                     END
     C           #2HMNB    IFEQ *ZERO                      BOH Company Num
     C           #2BNNB    OREQ *ZERO                      BOH Buy Order N
     C           #2BONB    OREQ *ZERO                      BOL Load Number
     C           #2CVNB    OREQ *ZERO                      TH Tattoo Numbe
     C           #2B0DT    IFNE *ZERO                      TH Kill Date
     C           AXB0DT    CABNE#2B0DT    BB020            TH Kill Date
     C                     END
     C                     END
     C           #2MZSS    IFNE *BLANK                     TRD Payment Sts
     C           AXMZSS    CABNE#2MZSS    BB020            TRD Payment Sts
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
      * Rtv BOH Lock Sts      RT - Buy Order Header  * BO Status
     C                     EXSR SBRVGN
      * Determine Buy Order Status description
      * CASE: RCD.BOH Status is Locked
     C           #RA6ST    IFEQ 'L'                        *IF
     C                     MOVEL'Lock'    #RG9T1           Buy Order Statu
     C                     ELSE
      * CASE: RCD.BOH Status is Open
     C           #RA6ST    IFEQ 'O'                        *IF
     C                     MOVEL'Open'    #RG9T1           Buy Order Statu
     C                     END                             *FI
     C                     END                             *FI
      * Rtv All Values - Tattoo Header  * PaySts/HldOvr/ProcCd
     C                     EXSR SCRVGN
      * If Repayment Detail Status is Payment Edit Executed
      * CASE: RCD.TRD Repayment Status is Payment Edit Executed
     C           #1MCSS    IFEQ 'X'                        *IF
      * If Step = 5 and Payment Errors = No Errors
      * CASE: Payment Step = 5 AND No Errors
      *  - c1 AND c2 AND c3
      *   |- c1    : LCL.Pmt Current Payment Date EQ CTL.Pmt Current Paym
      *   |- c2    : LCL.Pmt Current Payment Step is 00005 Payment Listin
      *   |- c3    : LCL.PP Payment Error is No Error/No val
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ #CCKDT                     *IF
     C           YL0002    IFEQ 00005                      *IF
     C           YL0003    IFEQ 'N'                        *IF
     C           YL0003    OREQ *BLANK
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'P'       #1MCSS           TRD Repayment S
     C                     ELSE
      * CASE: Payment Step = 5 AND Errors
      *  - c1 AND c2 AND c3
      *   |- c1    : LCL.Pmt Current Payment Date EQ CTL.Pmt Current Paym
      *   |- c2    : LCL.Pmt Current Payment Step is 00005 Payment Listin
      *   |- c3    : LCL.PP Payment Error is Errors
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ #CCKDT                     *IF
     C           YL0002    IFEQ 00005                      *IF
     C           YL0003    IFEQ 'E'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'X'       #1MCSS           TRD Repayment S
     C                     ELSE
      * CASE: Payment Step <= 4
      *  - c1 AND c2
      *   |- c1    : LCL.Pmt Current Payment Date EQ CTL.Pmt Current Paym
      *   |- c2    : LCL.Pmt Current Payment Step is Less or Equal to Ste
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ #CCKDT                     *IF
     C           YL0002    IFLE 00004                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'X'       #1MCSS           TRD Repayment S
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Upd All Repay Dtl Sts XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWNSXFR'              90  Upd All Repay D
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0004  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0005  50       TRH Repayment I
     C                     PARM #1MCSS    WQ0006  1        TRD Repayment S
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWNSXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
      * Determine Tattoo Repayment Detail Status description
      * CASE: RCD.TRD Repayment Status is Created
     C           #1MCSS    IFEQ 'C'                        *IF
     C                     MOVEL@CN,002   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Unpaid
     C           #1MCSS    IFEQ 'U'                        *IF
     C                     MOVEL@CN,013   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Difference Query Executed
     C           #1MCSS    IFEQ 'D'                        *IF
     C                     MOVEL@CN,014   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Edited
     C           #1MCSS    IFEQ 'E'                        *IF
     C                     MOVEL@CN,015   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Transfered
     C           #1MCSS    IFEQ 'T'                        *IF
     C                     MOVEL@CN,016   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Payment Edit Executed
     C           #1MCSS    IFEQ 'X'                        *IF
     C                     MOVEL@CN,017   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Payment Edit Complete
     C           #1MCSS    IFEQ 'P'                        *IF
     C                     MOVEL@CN,018   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Payment Edit Error
     C           #1MCSS    IFEQ 'Q'                        *IF
     C                     MOVEL@CN,019   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Payment Edit Incomplete
     C           #1MCSS    IFEQ 'I'                        *IF
     C                     MOVEL@CN,020   #RHVT1           Tattoo Repay Dt
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Repaid
     C           #1MCSS    IFEQ 'R'                        *IF
     C                     MOVEL@CN,004   #RHVT1           Tattoo Repay Dt
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL#1MCSS    #CNBSS           Repay Detail Hi
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C           KRST      READE@AXCPAX                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN81     IFNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
      * Process command keys - check status
      * CASE: CTL.*CMD key is *Refresh
     C           *IN05     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: PAR.TRH Repayment Status is Repaid
     C           P2MASS    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVEL@CN,021   ZA0001           Text 10 1 USR
      * Send message 'Repay: Can't FKey+Reason'
     C                     MOVEL'PRK1597' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: Repay Status is Cancelled and FKey pressed
      *  - c1 AND (c2 OR c3 OR c4 OR c5 OR c6 OR c7)
      *   |- c1    : PAR.TRH Repayment Status is Cancelled
      *   |- c2    : CTL.*CMD key is CF06
      *   |- c3    : CTL.*CMD key is CF08
      *   |- c4    : CTL.*CMD key is CF10
      *   |- c5    : CTL.*CMD key is CF14
      *   |- c6    : CTL.*CMD key is CF16
      *   |- c7    : CTL.*CMD key is CF17
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P2MASS    IFEQ 'X'                        *IF
     C                     MOVEL'0'       Y0CX02  1
     C           *IN06     IFEQ '1'                        *IF
     C           *IN08     OREQ '1'                        *OR
     C           *IN10     OREQ '1'                        *OR
     C           *IN14     OREQ '1'                        *OR
     C           *IN16     OREQ '1'                        *OR
     C           *IN17     OREQ '1'                        *OR
     C                     MOVEL'1'       Y0CX02
     C                     END                             *FI
     C           Y0CX02    IFEQ '1'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL@CN,022   ZA0002           Text 10 1 USR
      * Send message 'Repay: Can't FKey+Reason'
     C                     MOVEL'PRK1597' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Process command keys
      * CASE: CTL.*CMD key is CF06
     C           *IN06     IFEQ '1'                        *IF
      * Select Tattoos for Repayment
     C                     EXSR UASUBR                     Select Tattoos
     C                     ELSE
      * CASE: CTL.*CMD key is CF08
     C           *IN08     IFEQ '1'                        *IF
      * Unpay all selected tattoos
     C                     EXSR UBSUBR                     Unpay all selec
     C                     ELSE
      * CASE: CTL.*CMD key is CF10
     C           *IN10     IFEQ '1'                        *IF
      * Backup Files for Repayment
     C                     EXSR UCSUBR                     Backup Files fo
     C                     ELSE
      * CASE: CTL.*CMD key is CF14
     C           *IN14     IFEQ '1'                        *IF
      * Run Payment Edit
     C                     EXSR UFSUBR                     Run Payment Edi
     C                     ELSE
      * CASE: CTL.*CMD key is CF16
     C           *IN16     IFEQ '1'                        *IF
      * Run Payment Difference Queries
     C                     EXSR UHSUBR                     Run Payment Dif
     C                     ELSE
      * CASE: CTL.*CMD key is CF17
     C           *IN17     IFEQ '1'                        *IF
      * Approve differences, mark tattoos and repayment as Repaid
     C                     EXSR UJSUBR                     Approve differe
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     98    *
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * USER: Process subfile record (Pre-confirm)
      * 4=Remove  5=Display  7=Edit Tattoo  9=Edit/View Comments  E=Mark
      * CASE: RCD.*SFLSEL is *Delete
     C           #1SEL     IFEQ '4'                        *IF
     C           #1SEL     OREQ ' 4'
      * Remove tattoo
     C                     EXSR UKSUBR                     Remove tattoo
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Option 5 request
     C           #1SEL     IFEQ '5'                        *IF
     C           #1SEL     OREQ ' 5'
      * Dsp Tattoo Repay Dtl  DR - Tattoo Repayment Detail  * 
     C                     CALL 'PWOHD1R'              90  Dsp Tattoo Repa
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HONB    WQ0079  30       CC Company Numb
     C                     PARM #1CDNZ    WQ0080  50       TRH Repayment I
     C                     PARM #1HMNB    WQ0081  30       BOH Company Num
     C                     PARM #1BNNB    WQ0082  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0083  50       BOL Load Number
     C                     PARM #1CVNB    WQ0084  50       TH Tattoo Numbe
     C                     PARM #1B0DT    WQ0085  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWOHD1R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Option 7 request
     C           #1SEL     IFEQ '7'                        *IF
     C           #1SEL     OREQ ' 7'
      * Edit tattoo
     C                     EXSR UMSUBR                     Edit tattoo
     C                     ELSE
      * CASE: RCD.*SFLSEL is *option 9 request
     C           #1SEL     IFEQ '9'                        *IF
     C           #1SEL     OREQ ' 9'
      * Display or Edit Comments
     C                     EXSR UOSUBR                     Display or Edit
     C                     ELSE
      * CASE: RCD.*SFLSEL is Edited
     C           #1SEL     IFEQ 'E'                        *IF
      * No Change, Mark as Edited
     C                     EXSR UPSUBR                     No Change, Mark
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
      * SFLNXTCHG
     C                     SETON                     84
     C                     ELSE
      * SFLRCD valid
      * SFLNXTCHG
     C                     SETOF                     84
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @AXCPAX fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     Z-ADDAXHONB    #1HONB           CC Company Numb
     C                     Z-ADDAXCDNZ    #1CDNZ           TRH Repayment I
     C                     Z-ADDAXHMNB    #1HMNB           BOH Company Num
     C                     MOVELAXMCSS    #1MCSS           TRD Repayment S
     C                     MOVELAXMZSS    #1MZSS           TRD Payment Sts
     C                     MOVELAXTNCD    #1TNCD           TRD Process Cod
     C                     MOVELAXNASS    #1NASS           TRD Trucker Pay
     C                     MOVELAXAECD    #1AECD           PL Location Cod
     C                     MOVELAXAKCD    #1AKCD           PC Contract Cod
     C                     MOVELAXALCD    #1ALCD           PSC Sub-Contrac
     C                     MOVELAXNYCD    #1NYCD           PS Site ID
     C                     MOVELAXAACD    #1AACD           SR Source Code
     C                     Z-ADDAXCGNZ    #1CGNZ           Transfer Buy Or
     C                     Z-ADDAXCENZ    #1CENZ           Transfer Buy Or
     C                     Z-ADDAXCFNZ    #1CFNZ           Transfer Tattoo
     C                     Z-ADDAXIIDT    #1IIDT           Transfer Kill D
     C                     MOVELAXTOCD    #1TOCD           Transfer Site I
     C                     MOVELAXTPCD    #1TPCD           Transfer Subsid
     C                     MOVELAXINT1    #1INT1           Transfer State
     C                     MOVELAXAAVN    #1AAVN           RS User Changed
     C                     Z-ADDAXAADT    #1AADT           RS Date Changed
     C                     Z-ADDAXAMTM    #1AMTM           RS Time Changed
     C                     MOVELAXAJST    #1AJST           RS Record Statu
     C                     MOVELAXAHVN    #1AHVN           RS Job
     C                     MOVELAXAGVN    #1AGVN           RS Program
     C                     MOVELAXABVN    #1ABVN           RS User Added
     C                     Z-ADDAXABDT    #1ABDT           RS Date Added
     C                     Z-ADDAXABTM    #1ABTM           RS Time Added
     C                     Z-ADDAXBNNB    #1BNNB           BOH Buy Order N
     C                     Z-ADDAXBONB    #1BONB           BOL Load Number
     C                     Z-ADDAXCVNB    #1CVNB           TH Tattoo Numbe
     C                     Z-ADDAXB0DT    #1B0DT           TH Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V1B0DT
     C                     Z-ADDAXC1NZ    #1C1NZ           TRD Pen Head
     C                     MOVELAXABCD    #1ABCD           PD Producer Cod
     C                     MOVEL*BLANK    #RA6ST           BOH Status
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RG9T1           Buy Order Statu
     C                     MOVEL*BLANK    #RE1ST           TH Held Over Re
     C                     MOVEL*BLANK    #RCWST           TH Payment Sts
     C                     MOVEL*BLANK    #RCSCD           THP Process Cod
     C                     MOVEL*BLANK    #RHVT1           Tattoo Repay Dt
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #CNBSS           Repay Detail Hi
     C                     MOVEL*BLANK    #CK8SS           File Backup Sta
     C                     Z-ADD*ZERO     #2HMNB           BOH Company Num
     C                     Z-ADD*ZERO     #2BNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     #2BONB           BOL Load Number
     C                     Z-ADD*ZERO     #2CVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     #2B0DT           TH Kill Date
     C                     MOVEL*BLANK    #2MZSS           TRD Payment Sts
     C                     Z-ADDP1HONB    #2HONB           CC Company Numb
     C                     Z-ADDP1CDNZ    #2CDNZ           TRH Repayment I
     C                     MOVEL*BLANK    #CICT1           TRH Repay Statu
     C                     Z-ADD*ZERO     #CCKDT           Pmt Current Pay
      * Clear external version also
     C                     Z-ADD*ZERO     VCCKDT
     C                     Z-ADD*ZERO     #CMDNB           @Sequence 1.0
     C                     MOVEL*BLANK    #COBTX           Text descriptio
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  #1B0DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1B0DT
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Pmt Current Payment Date to display format
      * Convert date
     C           1000000   ADD  #CCKDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCCKDT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Payment Processing RT - Payment Processing Parms  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           C4HONB           CC Company Numb
      * Setup key
     C                     Z-ADD#2HONB    C4HONB           CC Company Numb
      * Establish starting position
     C           KRSSA     CHAIN@C4REO7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0434' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           Pmt Current Pay
     C                     Z-ADD*ZERO     YL0002           Pmt Current Pay
     C                     MOVEL*BLANK    YL0003           PP Payment Erro
     C                     MOVEL*BLANK    YL0004           PP Repayment St
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDC4CKDT    YL0001           Pmt Current Pay
     C                     Z-ADDC4M1NB    YL0002           Pmt Current Pay
     C                     MOVELC4KJST    YL0003           PP Payment Erro
     C                     MOVELC4KKST    YL0004           PP Repayment St
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv BOH Lock Sts      RT - Buy Order Header  * BO Status
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           AWHMNB           BOH Company Num
     C                     KFLD           AWBNNB           BOH Buy Order N
      * Setup key
     C                     Z-ADD#1HMNB    AWHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    AWBNNB           BOH Buy Order N
      * Establish starting position
     C           KRSSB     CHAIN@AWCPBI              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0049' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RA6ST           BOH Status
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAWA6ST    #RA6ST           BOH Status
     C                     GOTO SBEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv All Values - Tattoo Header  * PaySts/HldOvr/ProcCd
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADD#1HMNB    A1HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A1BONB           BOL Load Number
     C                     Z-ADD#1CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSC     CHAIN@A1CPC4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RCWST           TH Payment Sts
     C                     MOVEL*BLANK    #RE1ST           TH Held Over Re
     C                     MOVEL*BLANK    #RCSCD           THP Process Cod
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELA1CWST    #RCWST           TH Payment Sts
     C                     MOVELA1E1ST    #RE1ST           TH Held Over Re
     C                     MOVELA1CSCD    #RCSCD           THP Process Cod
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Tattoo Repay Hdr  RT - Tattoo Repayment Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WAHONB           CC Company Numb
     C                     KFLD           WACDNZ           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WAHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    WACDNZ           TRH Repayment I
      * Establish starting position
     C           KRSSD     CHAIN@AWCPAQ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1564' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0011           TRH Repayment S
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAMASS    YL0011           TRH Repayment S
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Chg Tattoo Repay Hdr  CH - Tattoo Repayment Header  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001 10        RS User Changed
     C                     Z-ADD*ZERO     WN0002  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0003  60       RS Time Changed
     C                     MOVEL*BLANK    WN0004 10        RS Job
     C                     MOVEL*BLANK    WN0005 10        RS Program
     C                     MOVEL*BLANK    WN0006 10        RS User Added
     C                     Z-ADD*ZERO     WN0007  70       RS Date Added
     C                     Z-ADD*ZERO     WN0008  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @AWCPAR
     C                     Z-ADD#2HONB    WBHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    WBCDNZ           TRH Repayment I
      *
     C           KLCHSE    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C                     KFLD           WBCDNZ           TRH Repayment I
     C           KLCHSE    CHAIN@AWCPAR              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PWAWCPL1'MDACP
     C                     MOVEL'@AWCPAR' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPWAW1    YARDCS
      * Move non-key fields to @AWCPAR
     C                     MOVEL'I'       WBMASS    P      TRH Repayment S
     C                     Z-ADDP2IDDT    WBIDDT           TRH Date Start
     C                     Z-ADDP2CATM    WBCATM           TRH Time Start
     C                     Z-ADDP2IEDT    WBIEDT           TRH Date Comple
     C                     Z-ADDP2CBTM    WBCBTM           TRH Time Comple
     C                     Z-ADDP2IFDT    WBIFDT           TRH Payment Dat
     C                     Z-ADDP2CTNZ    WBCTNZ           TRH Payment Ste
     C                     MOVELP2HOT1    WBHOT1    P      TRH Backup File
     C                     MOVEL'A'       WBAJST    P      RS Record Statu
      *
      * Set PGM.*Record Data Changed flag
     C           QPWAW1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WBAAVN           RS User Changed
     C                     Z-ADD##JDT     WBAADT           RS Date Changed
     C                     Z-ADD##JTM     WBAMTM           RS Time Changed
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPWAW1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AWCPAR                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPWAWCPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0009  50       TRC Sequence
     C                     MOVEL*BLANK    WN0010 10        RS User Changed
     C                     Z-ADD*ZERO     WN0011  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0012  60       RS Time Changed
     C                     MOVEL*BLANK    WN0013  1        RS Record Statu
     C                     MOVEL*BLANK    WN0014 10        RS Job
     C                     MOVEL*BLANK    WN0015 10        RS Program
     C                     MOVEL*BLANK    WN0016 10        RS User Added
     C                     Z-ADD*ZERO     WN0017  70       RS Date Added
     C                     Z-ADD*ZERO     WN0018  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AYCPAP
     C                     Z-ADD#2HONB    AYHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    AYCDNZ           TRH Repayment I
     C                     Z-ADD#2HMNB    AYHMNB           BOH Company Num
     C                     Z-ADD#2BNNB    AYBNNB           BOH Buy Order N
     C                     Z-ADD#2BONB    AYBONB           BOL Load Number
     C                     Z-ADD#2CVNB    AYCVNB           TH Tattoo Numbe
     C                     Z-ADD#2B0DT    AYB0DT           TH Kill Date
     C                     MOVELYL0014    AYG7T1           TRC Comment
     C                     MOVEL'S'       AYMKSS           TRC Comment Typ
      *
      * USER: Processing before Data update
      * Make sure BOH Company Number is populated
      * CASE: PAR.BOH Company Number is *ZERO
     C           #2HMNB    IFEQ 0                          *IF
     C                     Z-ADD#2HONB    AYHMNB           BOH Company Num
     C                     END                             *FI
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
     C                     EXSR SGRVGN
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AYAJST           RS Record Statu
     C                     MOVEL##USR     AYABVN           RS User Added
     C                     Z-ADD##JDT     AYABDT           RS Date Added
     C                     Z-ADD##JTM     AYABTM           RS Time Added
     C                     MOVEL##PGM     AYAGVN           RS Program
     C                     MOVEL##JOB     AYAHVN           RS Job
     C           KLCRSF    KLIST
     C                     KFLD           AYHONB           CC Company Numb
     C                     KFLD           AYCDNZ           TRH Repayment I
     C                     KFLD           AYCINZ           TRC Sequence
      * Check for duplicate primary key
     C           KLCRSF    SETLL@AYCPAP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1569' W0RTN   7
      * Send message 'Tattoo Repayment Comme EX'
     C                     MOVEL'PRK1569' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@AYCPAP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHONB    WQSG01           CC Company Numb
     C           *LIKE     DEFN WCCDNZ    WQSG02           TRH Repayment I
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           CC Company Numb
     C                     KFLD           WQSG02           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WQSG01           CC Company Numb
     C                     Z-ADD#2CDNZ    WQSG02           TRH Repayment I
      * Establish starting position
     C           KRSSG     SETLL@AYCPA6                    *
     C           KRSSG     READE@AYCPA6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1568' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         AYCINZ           TRC Sequence
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WCCINZ    ADD  1         AYCINZ           TRC Sequence
     C                     GOTO SGEXIT                     *QUIT
     C           KRSSG     READE@AYCPA6                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Chk All Rcds Edited   RT - Tattoo Repayment Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Assume all Tattoos are unpaid.  Change to No if not true.
     C                     MOVEL'Y'       YL0026           All Tattoos Edi
      * Declare restrictor key work fields
     C           *LIKE     DEFN AXHONB    WQSH01           CC Company Numb
     C           *LIKE     DEFN AXCDNZ    WQSH02           TRH Repayment I
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           CC Company Numb
     C                     KFLD           WQSH02           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WQSH01           CC Company Numb
     C                     Z-ADD#2CDNZ    WQSH02           TRH Repayment I
      * Establish starting position
     C           KRSSH     SETLL@AXCPAX                    *
     C           KRSSH     READE@AXCPAX                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1566' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       YL0026           All Tattoos Edi
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * If record not Edited, set Y/N flag to No
      * CASE: DB1.TRD Repayment Status is Transfered
     C           AXMCSS    IFEQ 'T'                        *IF
     C                     ELSE
      * CASE: DB1.TRD Repayment Status is Valid for Payment Edit
     C           AXMCSS    IFEQ 'D'                        *IF
     C           AXMCSS    OREQ 'E'
     C           AXMCSS    OREQ 'P'
     C           AXMCSS    OREQ 'Q'
     C           AXMCSS    OREQ 'X'
     C           AXMCSS    OREQ 'I'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       YL0026           All Tattoos Edi
     C                     GOTO SHEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSH     READE@AXCPAX                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Rtv Payment Processing RT - Payment Processing Parms  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           C4HONB           CC Company Numb
      * Setup key
     C                     Z-ADD#2HONB    C4HONB           CC Company Numb
      * Establish starting position
     C           KRSSI     CHAIN@C4REO7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0434' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           Pmt Current Pay
     C                     Z-ADD*ZERO     YL0002           Pmt Current Pay
     C                     MOVEL*BLANK    YL0027           PP Commission P
     C                     MOVEL*BLANK    YL0003           PP Payment Erro
     C                     MOVEL*BLANK    YL0004           PP Repayment St
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDC4CKDT    YL0001           Pmt Current Pay
     C                     Z-ADDC4M1NB    YL0002           Pmt Current Pay
     C                     MOVELC4KHST    YL0027           PP Commission P
     C                     MOVELC4KJST    YL0003           PP Payment Erro
     C                     MOVELC4KKST    YL0004           PP Repayment St
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Chg Payment Date/Step  CH - Payment Processing Parms  * Step = 1
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0019  50       PP Unused Nbr 1
     C                     MOVEL*BLANK    WN0020  1        PP Repayment St
     C                     MOVEL*BLANK    WN0021 10        RS User Changed
     C                     Z-ADD*ZERO     WN0022  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0023  60       RS Time Changed
     C                     MOVEL*BLANK    WN0024  1        RS Record Statu
     C                     MOVEL*BLANK    WN0025 10        RS Job
     C                     MOVEL*BLANK    WN0026 10        RS Program
     C                     MOVEL*BLANK    WN0027 10        RS User Added
     C                     Z-ADD*ZERO     WN0028  70       RS Date Added
     C                     Z-ADD*ZERO     WN0029  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data read
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WN0021           RS User Changed
     C                     Z-ADD##JDT     WN0022           RS Date Changed
     C                     Z-ADD##JTM     WN0023           RS Time Changed
     C                     MOVEL##JOB     WN0025           RS Job
     C                     MOVEL##PGM     WN0026           RS Program
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @C4REO6
     C                     Z-ADD#2HONB    WDHONB           CC Company Numb
      *
     C           KLCHSJ    KLIST
     C                     KFLD           WDHONB           CC Company Numb
     C           KLCHSJ    CHAIN@C4REO6              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKC4REL0'MDACP
     C                     MOVEL'@C4REO6' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKC41    YBRDCS
      * Move non-key fields to @C4REO6
     C                     Z-ADD#CCKDT    WDCKDT           Pmt Current Pay
     C                     Z-ADD1         WDM1NB           Pmt Current Pay
     C                     MOVELYL0027    WDKHST    P      PP Commission P
     C                     MOVELYL0003    WDKJST    P      PP Payment Erro
      *
      * Set PGM.*Record Data Changed flag
     C           QPKC41    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@C4REO6                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKC4REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCRRC    BEGSR
      *================================================================
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0030  50       TRC Sequence
     C                     MOVEL*BLANK    WN0031 10        RS User Changed
     C                     Z-ADD*ZERO     WN0032  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0033  60       RS Time Changed
     C                     MOVEL*BLANK    WN0034  1        RS Record Statu
     C                     MOVEL*BLANK    WN0035 10        RS Job
     C                     MOVEL*BLANK    WN0036 10        RS Program
     C                     MOVEL*BLANK    WN0037 10        RS User Added
     C                     Z-ADD*ZERO     WN0038  70       RS Date Added
     C                     Z-ADD*ZERO     WN0039  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AYCPAP
     C                     Z-ADD#2HONB    AYHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    AYCDNZ           TRH Repayment I
     C                     Z-ADD*ZERO     AYHMNB           BOH Company Num
     C                     Z-ADD*ZERO     AYBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     AYBONB           BOL Load Number
     C                     Z-ADD*ZERO     AYCVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     AYB0DT           TH Kill Date
     C                     MOVELYL0014    AYG7T1           TRC Comment
     C                     MOVEL'S'       AYMKSS           TRC Comment Typ
      *
      * USER: Processing before Data update
      * Make sure BOH Company Number is populated
      * CASE: PAR.BOH Company Number is *ZERO
     C           *ZERO     IFEQ 0                          *IF
     C                     Z-ADD#2HONB    AYHMNB           BOH Company Num
     C                     END                             *FI
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
     C                     EXSR SLRVGN
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AYAJST           RS Record Statu
     C                     MOVEL##USR     AYABVN           RS User Added
     C                     Z-ADD##JDT     AYABDT           RS Date Added
     C                     Z-ADD##JTM     AYABTM           RS Time Added
     C                     MOVEL##PGM     AYAGVN           RS Program
     C                     MOVEL##JOB     AYAHVN           RS Job
     C           KLCRSK    KLIST
     C                     KFLD           AYHONB           CC Company Numb
     C                     KFLD           AYCDNZ           TRH Repayment I
     C                     KFLD           AYCINZ           TRC Sequence
      * Check for duplicate primary key
     C           KLCRSK    SETLL@AYCPAP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1569' W0RTN   7
      * Send message 'Tattoo Repayment Comme EX'
     C                     MOVEL'PRK1569' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C                     WRITE@AYCPAP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHONB    WQSL01           CC Company Numb
     C           *LIKE     DEFN WCCDNZ    WQSL02           TRH Repayment I
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           WQSL01           CC Company Numb
     C                     KFLD           WQSL02           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WQSL01           CC Company Numb
     C                     Z-ADD#2CDNZ    WQSL02           TRH Repayment I
      * Establish starting position
     C           KRSSL     SETLL@AYCPA6                    *
     C           KRSSL     READE@AYCPA6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1568' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         AYCINZ           TRC Sequence
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WCCINZ    ADD  1         AYCINZ           TRC Sequence
     C                     GOTO SLEXIT                     *QUIT
     C           KRSSL     READE@AYCPA6                  90*
     C                     ENDDO
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Rtv Payment Processing RT - Payment Processing Parms  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           C4HONB           CC Company Numb
      * Setup key
     C                     Z-ADD#2HONB    C4HONB           CC Company Numb
      * Establish starting position
     C           KRSSM     CHAIN@C4REO7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0434' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           Pmt Current Pay
     C                     Z-ADD*ZERO     YL0002           Pmt Current Pay
     C                     MOVEL*BLANK    YL0003           PP Payment Erro
     C                     MOVEL*BLANK    YL0004           PP Repayment St
     C                     GOTO SMEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDC4CKDT    YL0001           Pmt Current Pay
     C                     Z-ADDC4M1NB    YL0002           Pmt Current Pay
     C                     MOVELC4KJST    YL0003           PP Payment Erro
     C                     MOVELC4KKST    YL0004           PP Repayment St
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNCHRC    BEGSR
      *================================================================
      * Chg Tattoo Repay Step CH - Tattoo Repayment Header  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0040  1        TRH Repayment S
     C                     Z-ADD*ZERO     WN0041  70       TRH Date Start
     C                     Z-ADD*ZERO     WN0042  60       TRH Time Start
     C                     Z-ADD*ZERO     WN0043  70       TRH Date Comple
     C                     Z-ADD*ZERO     WN0044  60       TRH Time Comple
     C                     Z-ADD*ZERO     WN0045  70       TRH Payment Dat
     C                     MOVEL*BLANK    WN0046  6        TRH Backup File
     C                     MOVEL*BLANK    WN0047 10        RS User Changed
     C                     Z-ADD*ZERO     WN0048  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0049  60       RS Time Changed
     C                     MOVEL*BLANK    WN0050  1        RS Record Statu
     C                     MOVEL*BLANK    WN0051 10        RS Job
     C                     MOVEL*BLANK    WN0052 10        RS Program
     C                     MOVEL*BLANK    WN0053 10        RS User Added
     C                     Z-ADD*ZERO     WN0054  70       RS Date Added
     C                     Z-ADD*ZERO     WN0055  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @AWCPAR
     C                     Z-ADD#2HONB    WBHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    WBCDNZ           TRH Repayment I
      *
     C           KLCHSN    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C                     KFLD           WBCDNZ           TRH Repayment I
     C           KLCHSN    CHAIN@AWCPAR              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PWAWCPL1'MDACP
     C                     MOVEL'@AWCPAR' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SNEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SNEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPWAW1    YCRDCS
      * Move non-key fields to @AWCPAR
     C                     Z-ADDYL0002    WBCTNZ           TRH Payment Ste
      *
      * Set PGM.*Record Data Changed flag
     C           QPWAW1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WBAAVN           RS User Changed
     C                     Z-ADD##JDT     WBAADT           RS Date Changed
     C                     Z-ADD##JTM     WBAMTM           RS Time Changed
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPWAW1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@AWCPAR                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPWAWCPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SOCRRC    BEGSR
      *================================================================
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * Differenc
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0056  50       TRC Sequence
     C                     MOVEL*BLANK    WN0057 10        RS User Changed
     C                     Z-ADD*ZERO     WN0058  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0059  60       RS Time Changed
     C                     MOVEL*BLANK    WN0060  1        RS Record Statu
     C                     MOVEL*BLANK    WN0061 10        RS Job
     C                     MOVEL*BLANK    WN0062 10        RS Program
     C                     MOVEL*BLANK    WN0063 10        RS User Added
     C                     Z-ADD*ZERO     WN0064  70       RS Date Added
     C                     Z-ADD*ZERO     WN0065  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AYCPAP
     C                     Z-ADD#2HONB    AYHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    AYCDNZ           TRH Repayment I
     C                     Z-ADD*ZERO     AYHMNB           BOH Company Num
     C                     Z-ADD*ZERO     AYBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     AYBONB           BOL Load Number
     C                     Z-ADD*ZERO     AYCVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     AYB0DT           TH Kill Date
     C                     MOVELYL0014    AYG7T1           TRC Comment
     C                     MOVEL'S'       AYMKSS           TRC Comment Typ
      *
      * USER: Processing before Data update
      * Make sure BOH Company Number is populated
      * CASE: PAR.BOH Company Number is *ZERO
     C           *ZERO     IFEQ 0                          *IF
     C                     Z-ADD#2HONB    AYHMNB           BOH Company Num
     C                     END                             *FI
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
     C                     EXSR SPRVGN
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AYAJST           RS Record Statu
     C                     MOVEL##USR     AYABVN           RS User Added
     C                     Z-ADD##JDT     AYABDT           RS Date Added
     C                     Z-ADD##JTM     AYABTM           RS Time Added
     C                     MOVEL##PGM     AYAGVN           RS Program
     C                     MOVEL##JOB     AYAHVN           RS Job
     C           KLCRSO    KLIST
     C                     KFLD           AYHONB           CC Company Numb
     C                     KFLD           AYCDNZ           TRH Repayment I
     C                     KFLD           AYCINZ           TRC Sequence
      * Check for duplicate primary key
     C           KLCRSO    SETLL@AYCPAP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1569' W0RTN   7
      * Send message 'Tattoo Repayment Comme EX'
     C                     MOVEL'PRK1569' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SOEXIT
     C                     ENDIF
      *
     C                     WRITE@AYCPAP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHONB    WQSP01           CC Company Numb
     C           *LIKE     DEFN WCCDNZ    WQSP02           TRH Repayment I
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP01           CC Company Numb
     C                     KFLD           WQSP02           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WQSP01           CC Company Numb
     C                     Z-ADD#2CDNZ    WQSP02           TRH Repayment I
      * Establish starting position
     C           KRSSP     SETLL@AYCPA6                    *
     C           KRSSP     READE@AYCPA6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1568' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         AYCINZ           TRC Sequence
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WCCINZ    ADD  1         AYCINZ           TRC Sequence
     C                     GOTO SPEXIT                     *QUIT
     C           KRSSP     READE@AYCPA6                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Rtv Tattoo RepHdrSts  RT - Tattoo Repayment Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WAHONB           CC Company Numb
     C                     KFLD           WACDNZ           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WAHONB           CC Company Numb
     C                     Z-ADD#2CDNZ    WACDNZ           TRH Repayment I
      * Establish starting position
     C           KRSSQ     CHAIN@AWCPAQ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1564' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    P2MASS           TRH Repayment S
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAMASS    P2MASS           TRH Repayment S
     C                     ENDIF
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRCRRC    BEGSR
      *================================================================
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0066  50       TRC Sequence
     C                     MOVEL*BLANK    WN0067 10        RS User Changed
     C                     Z-ADD*ZERO     WN0068  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0069  60       RS Time Changed
     C                     MOVEL*BLANK    WN0070  1        RS Record Statu
     C                     MOVEL*BLANK    WN0071 10        RS Job
     C                     MOVEL*BLANK    WN0072 10        RS Program
     C                     MOVEL*BLANK    WN0073 10        RS User Added
     C                     Z-ADD*ZERO     WN0074  70       RS Date Added
     C                     Z-ADD*ZERO     WN0075  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AYCPAP
     C                     Z-ADD#1HONB    AYHONB           CC Company Numb
     C                     Z-ADD#1CDNZ    AYCDNZ           TRH Repayment I
     C                     Z-ADD#1HMNB    AYHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    AYBNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    AYBONB           BOL Load Number
     C                     Z-ADD#1CVNB    AYCVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    AYB0DT           TH Kill Date
     C                     MOVELYL0014    AYG7T1           TRC Comment
     C                     MOVEL'S'       AYMKSS           TRC Comment Typ
      *
      * USER: Processing before Data update
      * Make sure BOH Company Number is populated
      * CASE: PAR.BOH Company Number is *ZERO
     C           #1HMNB    IFEQ 0                          *IF
     C                     Z-ADD#1HONB    AYHMNB           BOH Company Num
     C                     END                             *FI
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
     C                     EXSR SSRVGN
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AYAJST           RS Record Statu
     C                     MOVEL##USR     AYABVN           RS User Added
     C                     Z-ADD##JDT     AYABDT           RS Date Added
     C                     Z-ADD##JTM     AYABTM           RS Time Added
     C                     MOVEL##PGM     AYAGVN           RS Program
     C                     MOVEL##JOB     AYAHVN           RS Job
     C           KLCRSR    KLIST
     C                     KFLD           AYHONB           CC Company Numb
     C                     KFLD           AYCDNZ           TRH Repayment I
     C                     KFLD           AYCINZ           TRC Sequence
      * Check for duplicate primary key
     C           KLCRSR    SETLL@AYCPAP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1569' W0RTN   7
      * Send message 'Tattoo Repayment Comme EX'
     C                     MOVEL'PRK1569' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SREXIT
     C                     ENDIF
      *
     C                     WRITE@AYCPAP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHONB    WQSS01           CC Company Numb
     C           *LIKE     DEFN WCCDNZ    WQSS02           TRH Repayment I
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           WQSS01           CC Company Numb
     C                     KFLD           WQSS02           TRH Repayment I
      * Setup key
     C                     Z-ADD#1HONB    WQSS01           CC Company Numb
     C                     Z-ADD#1CDNZ    WQSS02           TRH Repayment I
      * Establish starting position
     C           KRSSS     SETLL@AYCPA6                    *
     C           KRSSS     READE@AYCPA6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1568' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         AYCINZ           TRC Sequence
     C                     GOTO SSEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WCCINZ    ADD  1         AYCINZ           TRC Sequence
     C                     GOTO SSEXIT                     *QUIT
     C           KRSSS     READE@AYCPA6                  90*
     C                     ENDDO
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STCHRC    BEGSR
      *================================================================
      * Chg Tattoo Repay Dtl  CH - Tattoo Repayment Detail  * Edited
      *================================================================
      *
     C                     MOVEL*BLANK    WN0076 10        RS User Changed
     C                     Z-ADD*ZERO     WN0077  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0078  60       RS Time Changed
     C                     MOVEL*BLANK    WN0079 10        RS Job
     C                     MOVEL*BLANK    WN0080 10        RS Program
     C                     MOVEL*BLANK    WN0081 10        RS User Added
     C                     Z-ADD*ZERO     WN0082  70       RS Date Added
     C                     Z-ADD*ZERO     WN0083  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @AXCPAW
     C                     Z-ADD#1HONB    WEHONB           CC Company Numb
     C                     Z-ADD#1CDNZ    WECDNZ           TRH Repayment I
     C                     Z-ADD#1HMNB    WEHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    WEBNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    WEBONB           BOL Load Number
     C                     Z-ADD#1CVNB    WECVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    WEB0DT           TH Kill Date
      *
     C           KLCHST    KLIST
     C                     KFLD           WEHONB           CC Company Numb
     C                     KFLD           WECDNZ           TRH Repayment I
     C                     KFLD           WEHMNB           BOH Company Num
     C                     KFLD           WEBNNB           BOH Buy Order N
     C                     KFLD           WEBONB           BOL Load Number
     C                     KFLD           WECVNB           TH Tattoo Numbe
     C                     KFLD           WEB0DT           TH Kill Date
     C           KLCHST    CHAIN@AXCPAW              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PWAXCPL0'MDACP
     C                     MOVEL'@AXCPAW' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO STEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO STEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPWAX1    YDRDCS
      * Move non-key fields to @AXCPAW
     C                     Z-ADD#1CGNZ    WECGNZ           Transfer Buy Or
     C                     Z-ADD#1CENZ    WECENZ           Transfer Buy Or
     C                     Z-ADD#1CFNZ    WECFNZ           Transfer Tattoo
     C                     Z-ADD#1IIDT    WEIIDT           Transfer Kill D
     C                     MOVEL#1TOCD    WETOCD    P      Transfer Site I
     C                     MOVEL#1TPCD    WETPCD    P      Transfer Subsid
     C                     MOVEL#1INT1    WEINT1    P      Transfer State
     C                     MOVEL'E'       WEMCSS    P      TRD Repayment S
     C                     Z-ADD#1C1NZ    WEC1NZ           TRD Pen Head
     C                     MOVEL#1MZSS    WEMZSS    P      TRD Payment Sts
     C                     MOVEL#1TNCD    WETNCD    P      TRD Process Cod
     C                     MOVEL#1ABCD    WEABCD    P      PD Producer Cod
     C                     MOVEL#1NYCD    WENYCD    P      PS Site ID
     C                     MOVEL#1NASS    WENASS    P      TRD Trucker Pay
     C                     MOVEL#1AACD    WEAACD    P      SR Source Code
     C                     MOVEL#1AECD    WEAECD    P      PL Location Cod
     C                     MOVEL#1AKCD    WEAKCD    P      PC Contract Cod
     C                     MOVEL#1ALCD    WEALCD    P      PSC Sub-Contrac
     C                     MOVEL#1AJST    WEAJST    P      RS Record Statu
      *
      * Set PGM.*Record Data Changed flag
     C           QPWAX1    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WEAAVN           RS User Changed
     C                     Z-ADD##JDT     WEAADT           RS Date Changed
     C                     Z-ADD##JTM     WEAMTM           RS Time Changed
     C                     MOVEL##JOB     WEAHVN           RS Job
     C                     MOVEL##PGM     WEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPWAX1    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AXCPAW                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPWAXCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SUCRRC    BEGSR
      *================================================================
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0084  50       TRC Sequence
     C                     MOVEL*BLANK    WN0085 10        RS User Changed
     C                     Z-ADD*ZERO     WN0086  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0087  60       RS Time Changed
     C                     MOVEL*BLANK    WN0088  1        RS Record Statu
     C                     MOVEL*BLANK    WN0089 10        RS Job
     C                     MOVEL*BLANK    WN0090 10        RS Program
     C                     MOVEL*BLANK    WN0091 10        RS User Added
     C                     Z-ADD*ZERO     WN0092  70       RS Date Added
     C                     Z-ADD*ZERO     WN0093  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AYCPAP
     C                     Z-ADD#1HONB    AYHONB           CC Company Numb
     C                     Z-ADD#1CDNZ    AYCDNZ           TRH Repayment I
     C                     Z-ADD#1HMNB    AYHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    AYBNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    AYBONB           BOL Load Number
     C                     Z-ADD#1CVNB    AYCVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    AYB0DT           TH Kill Date
     C                     MOVELYL0014    AYG7T1           TRC Comment
     C                     MOVEL'S'       AYMKSS           TRC Comment Typ
      *
      * USER: Processing before Data update
      * Make sure BOH Company Number is populated
      * CASE: PAR.BOH Company Number is *ZERO
     C           #1HMNB    IFEQ 0                          *IF
     C                     Z-ADD#1HONB    AYHMNB           BOH Company Num
     C                     END                             *FI
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
     C                     EXSR SVRVGN
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AYAJST           RS Record Statu
     C                     MOVEL##USR     AYABVN           RS User Added
     C                     Z-ADD##JDT     AYABDT           RS Date Added
     C                     Z-ADD##JTM     AYABTM           RS Time Added
     C                     MOVEL##PGM     AYAGVN           RS Program
     C                     MOVEL##JOB     AYAHVN           RS Job
     C           KLCRSU    KLIST
     C                     KFLD           AYHONB           CC Company Numb
     C                     KFLD           AYCDNZ           TRH Repayment I
     C                     KFLD           AYCINZ           TRC Sequence
      * Check for duplicate primary key
     C           KLCRSU    SETLL@AYCPAP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1569' W0RTN   7
      * Send message 'Tattoo Repayment Comme EX'
     C                     MOVEL'PRK1569' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SUEXIT
     C                     ENDIF
      *
     C                     WRITE@AYCPAP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * Rtv Next Comment Seq# RT - Tattoo Repayment Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHONB    WQSV01           CC Company Numb
     C           *LIKE     DEFN WCCDNZ    WQSV02           TRH Repayment I
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           WQSV01           CC Company Numb
     C                     KFLD           WQSV02           TRH Repayment I
      * Setup key
     C                     Z-ADD#1HONB    WQSV01           CC Company Numb
     C                     Z-ADD#1CDNZ    WQSV02           TRH Repayment I
      * Establish starting position
     C           KRSSV     SETLL@AYCPA6                    *
     C           KRSSV     READE@AYCPA6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1568' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         AYCINZ           TRC Sequence
     C                     GOTO SVEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WCCINZ    ADD  1         AYCINZ           TRC Sequence
     C                     GOTO SVEXIT                     *QUIT
     C           KRSSV     READE@AYCPA6                  90*
     C                     ENDDO
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Select Tattoos for Repayment
      *================================================================
      * If File Back Up completed, perform Tattoo Select
      * CASE: CTL.File Backup Status USR is Backup completed
     C           #CK8SS    IFEQ 'C'                        *IF
      * Rtv Tattoo Repay Hdr  RT - Tattoo Repayment Header  * 
     C                     EXSR SDRVGN
      * If Tattoo Repayment Header Status is Not Repaid, select Tattoos
      * CASE:
      *  - NOTc1
      *   |- c1    : LCL.TRH Repayment Status is Repaid
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0011    IFEQ 'R'                        *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Sel Tattoo BU Repay   DF - Tattoo Header  * 
     C                     CALL 'PWLODFR'              90  Sel Tattoo BU R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HMNB    WQ0007  30       BOH Company Num
     C           #2BNNB    PARM #2BNNB    WQ0008  70       BOH Buy Order N
     C           #2BONB    PARM #2BONB    WQ0009  50       BOL Load Number
     C           #2CVNB    PARM #2CVNB    WQ0010  50       TH Tattoo Numbe
     C           #CCKDT    PARM #CCKDT    WQ0011  70       TH Kill Date
     C                     PARM #2CDNZ    WQ0012  50       TRH Repayment I
     C           YL0012    PARM YL0012    WQ0013  30       Count USR 2
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWLODFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Update Tattoo Repayment Header status to In progress
      * CASE: Header Repay Status = C AND Count <> 0
      *  - c1 AND c2
      *   |- c1    : PAR.TRH Repayment Status is Created
      *   |- c2    : LCL.Count USR 2 is Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P2MASS    IFEQ 'C'                        *IF
     C           YL0012    IFNE *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Chg Tattoo Repay Hdr  CH - Tattoo Repayment Header  * 
     C                     EXSR SECHRC
      * RMC Added upd to par so screen will be updated
     C                     MOVEL'I'       P2MASS           TRH Repayment S
      * Update Tattoo Repayment Detail record status to Created
     C                     MOVEL*BLANK    YL0013           Tattoo Number A
     C                     MOVEL#2CVNB    YL0013           Tattoo Number A
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,023   CAT  'ess.':ZQ YL0014    P      TRC Comment
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
     C                     EXSR SFCRRC
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     ELSE
      * CASE: CTL.File Backup Status USR is Error during backup
     C           #CK8SS    IFEQ 'E'                        *IF
      * Send message 'Repay: Can't Unpay-BackUp'
     C                     MOVEL'PRK1578' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Repay: Can't Unpay-No BU'
     C                     MOVEL'PRK1579' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Unpay all selected tattoos
      *================================================================
      * If file backup completed
      * CASE: CTL.File Backup Status USR is Backup completed
     C           #CK8SS    IFEQ 'C'                        *IF
      * Rtv Pymt Parms+Repay  XF - Payment Processing Parms  * 
     C                     CALL 'PWIOXFR'              90  Rtv Pymt Parms+
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0014  30       CC Company Numb
     C           YL0001    PARM *ZERO     WQ0015  70       Pmt Current Pay
     C           YL0002    PARM *ZERO     WQ0016  50       Pmt Current Pay
     C           YL0004    PARM *BLANK    WQ0017  1        PP Repayment St
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWIOXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Check Date/Step/Repay Sts combination
      * CASE: LCL.PP Repayment Status is Yes
     C           YL0004    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: Curr Pymt Date/Step = Job Dte/1 AND Repay Sts = No
      *  - c1 AND c2 AND c3
      *   |- c1    : LCL.Pmt Current Payment Date EQ JOB.*Job date
      *   |- c2    : LCL.Pmt Current Payment Step is Less or Equal to Ste
      *   |- c3    : LCL.PP Repayment Status is No
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ ##JDT                      *IF
     C           YL0002    IFLE 00001                      *IF
     C           YL0004    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Repay: Can't Unpay-PymEdt'
     C                     MOVEL'PRK1602' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UBEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Chk Status for Unpay  XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWM3XFR'              90  Chk Status for
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0018  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0019  50       TRH Repayment I
     C           YL0015    PARM *BLANK    WQ0020  1        Continue Proces
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWM3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If Continue Flag = No, send error message
      * CASE: LCL.Continue Process USR is No
     C           YL0015    IFEQ 'N'                        *IF
      * Send message 'Repay: Can't Unpay-TRD St'
     C                     MOVEL'PRK1576' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UBEXIT                     *QUIT
     C                     END                             *FI
      * Exc Unpay Tattoos     XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWM5XFR'              90  Exc Unpay Tatto
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0021  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0022  50       TRH Repayment I
     C                     PARM P2IFDT    WQ0023  70       TRH Payment Dat
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWM5XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Backup Files for Repayment
      *================================================================
      * If user class is *PGMR, do not backup files. Instead, update
      * Company Values file for HPEREPAYBU with completion value.
      * Rtv User Class        UP - STR Miscellaneous  * 
     C                     CALL 'PKU3UPR'              90  Rtv User Class
     C           YL0005    PARM YL0005    WQ0024 10        User Class f/us
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKU3UPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Check if Backup completed.  If not, then submit backup process
      * CASE: CTL.File Backup Status USR is Backup completed
     C           #CK8SS    IFEQ 'C'                        *IF
      * Send message 'Repay: Backup Completed'
     C                     MOVEL'PRK1580' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: LCL.User Class f/usrprf   USR is *PGMR
     C           YL0005    IFEQ '*PGMR'                    *IF
     C                     MOVEL'N'       YL0016           Display Warning
     C                     MOVEL*BLANK    YL0007           Date Alpha USR
     C                     MOVEL##JDT     YL0007           Date Alpha USR
     C                     Z-ADD*ZEROS    ZQ      50
     C           'C'       CAT  YL0007:ZQ YL0006    P      System Value Al
      * Upd Repayment Backup  XF - STR Order Management Sys  * HPEREPAUBU
     C                     CALL 'PUKMXFR'              90  Upd Repayment B
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HONB    WQ0025  30       Company Number
     C                     PARM @CN,006   WQ0026 10        Company Value C
     C                     PARM YL0006    WQ0027 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUKMXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ELSE
      * CASE: *OTHERWISE
      * Perform backups
     C                     EXSR UDSUBR                     Perform backups
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Perform backups
      *================================================================
      * Retrieve From and To library names for backup files and Co# Abbre
      * Rtv Company Values    XF - STR Order Management Sys  * HPEREPAYLB
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0028  30       BOH Company Num
     C                     PARM @CN,024   WQ0029 10        Company Value C
     C           YL0017    PARM *BLANK    WQ0030 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If From and To libraries found, break them out; build suffix
      * CASE: LCL.Libraries: From/To is Entered
     C           YL0017    IFNE *BLANK                     *IF
     C                     Z-ADD10        YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00020
     C           ZQ        ORGT 00020
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0017:ZQ YL0018    P  90  Library From US
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD10        YRSW00
     C                     Z-ADD11        ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00020
     C           ZQ        ORGT 00020
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0017:ZQ YL0019    P  90  Library To USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * Build backup file prefix
     C                     EXSR UESUBR                     Build backup fi
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Repay: From/To Libs Empty'
     C                     MOVEL'PRK1573' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UDEXIT                     *QUIT
     C                     END                             *FI
      * LCL.Back Up Date From = JOB.*Job date + CON.-14 *DAYS
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD-14       XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     YL0025
     C                     ELSE
     C           XDINDT    SUB  1000000   YL0025
     C                     END
      * SBMJOB: Exc Repay File Backup CL - Tattoo Repayment Header  * 
      *
     C                     MOVEL*BLANK    W0RTN
      * Build call string for processing in batch.
     C                     MOVEL#S0001    #SRQS     P
     C           #SRQS     CAT  #SCLL:1   #SRQS            Call command
     C                     MOVEL'PWMWUPC '#SPRG     P      Load pgm name
     C           #SRQS     CAT  #SPRG:0   #SRQS            Add pgm name
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *................................................................
      * Build parameters string.
     C           #SRQS     CAT  #SPRM:1   #SRQS            Parameters
      *
     C                     Z-ADD#2HMNB    #SPAK  309       BOH Company Num
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 3         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELYL0018    #SSTR     P      Library From US
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 10        #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELYL0019    #SSTR     P      Library To USR
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 10        #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELYL0024    #SSTR     P      Backup File Pre
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 6         #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADD##JDT     #SPAK  309       Current Date US
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 7         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADDYL0025    #SPAK  309       Back Up Date Fr
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 7         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADD#CCKDT    #SPAK  309       Back Up Date To
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 7         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *................................................................
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *
     C           W0RTN     IFNE *BLANK
      * Build of submit job string ended in error.
     C                     MOVEL'Y2U0065' W0RTN
     C                     MOVEL'PWMWUPC 'W0CLPG 10 P
      * Send message '*Error occured on SBMJOB'
     C                     MOVEL'Y2U0065' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           W0SJO     IFNE *BLANK
      * Merge variable submit job overrides.
     C                     CALL 'Y2MGRQR'              90  *
     C                     PARM #SRQS     #SWRK
     C                     PARM W0SJO     #SMRG
     C  N90                MOVEL#SWRK     #SRQS     P
     C                     MOVE *BLANK    W0SJO
     C                     END
      * Submit request.
     C                     CALL 'Y2CMEXC'              90  *
     C                     PARM           #SRQS
     C                     PARM 3000      #SRQL  155
     C                     PARM           W0JVN  10
     C                     PARM           W0JUN  10
     C                     PARM           W0JNB   6
     C                     END
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWMWUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Send message 'Repay: File Backup Submit'
     C                     MOVEL'PRK1574' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Build backup file prefix
      *================================================================
      * The files will be named as follows: LLMMDDFFFF    ex: GU0505PKAW
      * LL   = Location abreviation:  GU, ST, TF, or T2
      * MM   = Month
      * DD   = Day
      * FFFF = first four characters of the file name
      * Breakout date and make it MMDD alpha
      * CASE: *OTHERWISE
      * LCL.Month USR = JOB.*Job date *MONTH
     C           ##JDT     ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0020
      * LCL.Day of Month USR = JOB.*Job date *DAY OF MONTH
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0021
      * Month and Day combined
      * LCL.Month and Day 4.0 =
      *    *COMPUTE ((x1 * x2) + x3)
      * x1    : LCL.Month USR
      * *     : PGM.*Synon (17,7) work field *
      * x2    : CON.100
      * +     : PGM.*Synon (17,7) work field
      * x3    : LCL.Day of Month USR
     C           YL0020    MULT 100       W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  YL0021    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    YL0022           Month and Day 4
     C                     MOVEL*BLANK    YL0023           @Text 4
     C                     MOVELYL0022    YL0023           @Text 4
      * Build file prefix: Company abbreviation + MMDD
      * CASE: *OTHERWISE
      * Build file suffix for specific companies
      * CASE: PAR.CC Company Number is SBD Farms of Guymon, Ok
     C           P1HONB    IFEQ 360                        *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           'GU'      CAT  YL0023:ZQ YL0024    P      Backup File Pre
     C                     ELSE
      * CASE: PAR.CC Company Number is Sioux City
     C           P1HONB    IFEQ 440                        *IF
     C                     Z-ADD*ZEROS    ZQ      50
     C           'ST'      CAT  YL0023:ZQ YL0024    P      Backup File Pre
     C                     ELSE
      * CASE: Company is Triumph Foods OR Seaboard Triumph Foods
      *  - c1 OR c2
      *   |- c1    : PAR.CC Company Number is Triumph Foods Market
      *   |- c2    : PAR.CC Company Number is Triumph Foods-2
      *   '-
     C           P1HONB    IFEQ 960                        *IF
     C           P1HONB    OREQ 961                        *OR
     C                     Z-ADD*ZEROS    ZQ      50
     C           'TF'      CAT  YL0023:ZQ YL0024    P      Backup File Pre
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Run Payment Edit
      *================================================================
      * 1. Validate all records are ready to be paid
      * Chk All Rcds Edited   RT - Tattoo Repayment Detail  * 
     C                     EXSR SHRVGN
      * If any Tattoos in a status other than Edited, send error message
      * CASE: LCL.All Tattoos Edited Y/N is No
     C           YL0026    IFEQ 'N'                        *IF
      * Send message 'Repay: Can't run Pymt Edt'
     C                     MOVEL'PRK1588' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UFEXIT                     *QUIT
     C                     END                             *FI
      * 2. Validate regular daily Payment process completed
      * Rtv Payment Processing RT - Payment Processing Parms  * 
     C                     EXSR SIRVGN
      * Payment Date/Step validation
      * CASE: Repayment Sts = Y AND Payment Date matches
      *  - c1 AND c2
      *   |- c1    : LCL.PP Repayment Status is Yes
      *   |- c2    : LCL.Pmt Current Payment Date EQ CTL.Pmt Current Paym
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0004    IFEQ 'Y'                        *IF
     C           YL0001    IFEQ #CCKDT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Repay: Pymt Edt not run'
     C                     MOVEL'PRK1584' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UFEXIT                     *QUIT
     C                     END                             *FI
      * 3. Delete Carcass Detail and Tattoo D/A (except FRT records)
     C                     EXSR UGSUBR                     3. Delete Carca
      * 4. Run Payment Edit process
      * Run the Payment Edit process
      * CASE: *OTHERWISE
      * Chg Payment Date/Step  CH - Payment Processing Parms  * Step = 1
     C                     EXSR SJCHRC
     C                     MOVEL#2MZSS    YL0028           Payment Status
      * Chg Process Code-Repay XF - Tattoo Repayment Detail  * Slaughter
     C                     CALL 'PWN9XFR'              90  Chg Process Cod
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0031  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0032  50       TRH Repayment I
     C                     PARM 'SLG'     WQ0033  6        THP Process Cod
     C           YL0029    PARM *BLANK    WQ0034  6        Process Code -
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWN9XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * PMT Payment Process   PV - Company Control HPE  * for Repayment
     C                     CALL 'PKXAPVR'              90  PMT Payment Pro
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2CDNZ    WQ0035  50       TRH Repayment I
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKXAPVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If F3 pressed from previous program, skip message create
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ @CN,025                    *IF
      * Chg Process Code-Repay XF - Tattoo Repayment Detail  * Prev value
     C                     CALL 'PWN9XFR'              90  Chg Process Cod
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0036  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0037  50       TRH Repayment I
     C                     PARM YL0029    WQ0038  6        THP Process Cod
     C                     PARM *BLANK    WQ0039  6        Process Code -
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWN9XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ELSE
      * CASE: *OTHERWISE
      * Upd All Repay Dtl Sts XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWNSXFR'              90  Upd All Repay D
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0040  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0041  50       TRH Repayment I
     C                     PARM 'X'       WQ0042  1        TRD Repayment S
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWNSXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'X'       #CNBSS           Repay Detail Hi
     C                     Z-ADD1         ZQ      50
     C           @CN,026   CAT  @CN,027:ZQYL0014    P      TRC Comment
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
     C                     EXSR SKCRRC
      * Rtv Pymt Parms+Repay  XF - Payment Processing Parms  * 
     C                     CALL 'PWIOXFR'              90  Rtv Pymt Parms+
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0043  30       CC Company Numb
     C           #CCKDT    PARM *ZERO     WQ0044  70       Pmt Current Pay
     C           YL0002    PARM *ZERO     WQ0045  50       Pmt Current Pay
     C                     PARM *BLANK    WQ0046  1        PP Repayment St
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWIOXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Update Payment Step
      * CASE: LCL.Pmt Current Payment Step GT CTL.@Sequence 1.0
     C           YL0002    IFGT #CMDNB                     *IF
     C                     Z-ADDYL0002    #CMDNB           @Sequence 1.0
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * 3. Delete Carcass Detail and Tattoo D/A (except FRT records)
      *================================================================
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Run Payment Difference Queries
      *================================================================
      * Update the Tattoo Repayment Header Payment Step
      * Rtv Payment Processing RT - Payment Processing Parms  * 
     C                     EXSR SMRVGN
     C                     Z-ADDYL0002    #CMDNB           @Sequence 1.0
      * Chg Tattoo Repay Step CH - Tattoo Repayment Header  * 
     C                     EXSR SNCHRC
      * Determine if Payment Edit completed successfully
      * CASE: LCL.PP Payment Error is Errors
     C           YL0003    IFEQ 'E'                        *IF
     C                     MOVEL'Q'       #CNBSS           Repay Detail Hi
      * Send message 'Repay: Pymt Edit Errors'
     C                     MOVEL'PRK1605' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UHEXIT                     *QUIT
     C                     ELSE
      * CASE: LCL.Pmt Current Payment Step is Less or Equal to Step 4
     C           YL0002    IFLE 00004                      *IF
     C                     MOVEL'I'       #CNBSS           Repay Detail Hi
      * Send message 'Repay: Pymt Edit Incmplt'
     C                     MOVEL'PRK1606' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO UHEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'P'       #CNBSS           Repay Detail Hi
     C                     END                             *FI
     C                     END                             *FI
      * Chk Status for Apprvl XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWN3XFR'              90  Chk Status for
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0047  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0048  50       TRH Repayment I
     C           YL0015    PARM *BLANK    WQ0049  1        Continue Proces
     C           YL0030    PARM *BLANK    WQ0050  2        TRD Payment Sts
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWN3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If Continue flag is Yes, prompt for Approval Listing
      * CASE: LCL.Continue Process USR is Yes
     C           YL0015    IFEQ 'Y'                        *IF
      * Run Payment Difference listing
     C                     EXSR UISUBR                     Run Payment Dif
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Run Payment Difference listing
      *================================================================
      * Prt Repay Diff Report PV - Tattoo Repayment Header  * 
     C                     CALL 'PWNNPVR'              90  Prt Repay Diff
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0051  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0052  50       TRH Repayment I
     C                     PARM P2IFDT    WQ0053  70       TRH Payment Dat
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWNNPVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If F3 not pressed, continue
      * CASE:
      *  - NOTc1
      *   |- c1    : PGM.*Return code is *User QUIT requested
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           W0RTN     IFEQ @CN,025                    *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Upd All Repay Dtl Sts XF - Tattoo Repayment Detail  * Diff Sequel
     C                     CALL 'PWNSXFR'              90  Upd All Repay D
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0054  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0055  50       TRH Repayment I
     C                     PARM 'D'       WQ0056  1        TRD Repayment S
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWNSXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'D'       #CNBSS           Repay Detail Hi
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,028   CAT  @CN,029:ZQYL0014    P      TRC Comment
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * Difference
     C                     EXSR SOCRRC
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Approve differences, mark tattoos and repayment as Repaid
      *================================================================
      * Chk Status for Repaid XF - Tattoo Repayment Detail  * 
     C                     CALL 'PWN4XFR'              90  Chk Status for
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0057  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0058  50       TRH Repayment I
     C           YL0015    PARM *BLANK    WQ0059  1        Continue Proces
     C           YL0030    PARM *BLANK    WQ0060  2        TRD Payment Sts
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWN4XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If Approval sequel has been executed
      * CASE: LCL.Continue Process USR is Yes
     C           YL0015    IFEQ 'Y'                        *IF
     C                     MOVEL'D'       #CNBSS           Repay Detail Hi
      * Pmt Repay Approval    PV - Tattoo Repayment Detail  * 
     C                     CALL 'PWMSPVR'              90  Pmt Repay Appro
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HONB    WQ0061  30       CC Company Numb
     C                     PARM #2CDNZ    WQ0062  50       TRH Repayment I
     C                     PARM #CCKDT    WQ0063  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWMSPVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rtv Tattoo RepHdrSts  RT - Tattoo Repayment Header  * 
     C                     EXSR SQRVGN
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Repay: Can't Approve-Step'
     C                     MOVEL'PRK1600' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Remove tattoo
      *================================================================
      * If record is in a created status, delete the record
      * CASE: PAR.TRH Repayment Status is Cancelled
     C           P2MASS    IFEQ 'X'                        *IF
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0003           *SFLSEL
      * Send message 'Repay: Can't SFLSEL-Cancl'
     C                     MOVEL'PRK1598' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Created
     C           #1MCSS    IFEQ 'C'                        *IF
      * Remove Tattoo Repayment Detail record
     C                     EXSR ULSUBR                     Remove Tattoo R
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0004           *SFLSEL
      * Send message 'Repay: Can't Dlt Tattoo'
     C                     MOVEL'PRK1581' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Remove Tattoo Repayment Detail record
      *================================================================
      * Dlt Tattoo Repay Dtl  PV - Tattoo Repayment Detail  * 
     C                     CALL 'PWM6PVR'              90  Dlt Tattoo Repa
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HONB    WQ0064  30       CC Company Numb
     C                     PARM #1CDNZ    WQ0065  50       TRH Repayment I
     C                     PARM #1HMNB    WQ0066  30       BOH Company Num
     C                     PARM #1BNNB    WQ0067  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0068  50       BOL Load Number
     C                     PARM #1CVNB    WQ0069  50       TH Tattoo Numbe
     C                     PARM #1B0DT    WQ0070  70       TH Kill Date
     C                     PARM #1MCSS    WQ0071  1        TRD Repayment S
     C                     PARM #1C1NZ    WQ0072  50       TRD Pen Head
     C                     PARM #1ABCD    WQ0073  6        PD Producer Cod
     C                     PARM #1NYCD    WQ0074 10        PS Site ID
     C                     PARM #1AACD    WQ0075  3        SR Source Code
     C                     PARM #1AECD    WQ0076  6        PL Location Cod
     C                     PARM #1AKCD    WQ0077  5        PC Contract Cod
     C                     PARM #1ALCD    WQ0078  5        PSC Sub-Contrac
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWM6PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,030   CAT  @CN,031:ZQYL0014    P      TRC Comment
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
     C                     EXSR SRCRRC
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Edit tattoo
      *================================================================
      * If Tattoo record is Unpaid or Edited, go to Edit screen
      * CASE: PAR.TRH Repayment Status is Cancelled
     C           P2MASS    IFEQ 'X'                        *IF
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0005           *SFLSEL
      * Send message 'Repay: Can't SFLSEL-Cancl'
     C                     MOVEL'PRK1598' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: RCD.TRD Repayment Status is Transfered
     C           #1MCSS    IFEQ 'T'                        *IF
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0006           *SFLSEL
      * Send message 'Repay: Can't SFLSEL-Xfer'
     C                     MOVEL'PRK1609' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: TRD Repayment Status is Unpaid/Edited/PayEdt/Diff
      *  - c1 OR c2 OR c3 OR c4
      *   |- c1    : RCD.TRD Repayment Status is Unpaid
      *   |- c2    : RCD.TRD Repayment Status is Edited
      *   |- c3    : RCD.TRD Repayment Status is In Payment Edit Process
      *   |- c4    : RCD.TRD Repayment Status is Difference Query Execute
      *   '-
     C           #1MCSS    IFEQ 'U'                        *IF
     C           #1MCSS    OREQ 'E'                        *OR
     C           #1MCSS    OREQ 'Q'                        *OR
     C           #1MCSS    OREQ 'I'
     C           #1MCSS    OREQ 'P'
     C           #1MCSS    OREQ 'X'
     C           #1MCSS    OREQ 'D'                        *OR
      * Perform pre-repayment Edits
     C                     EXSR UNSUBR                     Perform pre-rep
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0007           *SFLSEL
      * Send message 'Repay: Can't Edit-Unpay'
     C                     MOVEL'PRK1594' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Perform pre-repayment Edits
      *================================================================
      * Pmt Pre-Repay Edits   PV - Tattoo Repayment Detail  * 
     C                     CALL 'PWL3PVR'              90  Pmt Pre-Repay E
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HONB    WQ0086  30       CC Company Numb
     C                     PARM #1CDNZ    WQ0087  50       TRH Repayment I
     C                     PARM #1HMNB    WQ0088  30       BOH Company Num
     C                     PARM #1BNNB    WQ0089  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0090  50       BOL Load Number
     C                     PARM #1CVNB    WQ0091  50       TH Tattoo Numbe
     C                     PARM #1B0DT    WQ0092  70       TH Kill Date
     C                     PARM #1MCSS    WQ0093  1        TRD Repayment S
     C                     PARM #1C1NZ    WQ0094  50       TRD Pen Head
     C                     PARM #1MZSS    WQ0095  2        TRD Payment Sts
     C                     PARM #1TNCD    WQ0096  6        TRD Process Cod
     C                     PARM #1ABCD    WQ0097  6        PD Producer Cod
     C                     PARM #1NYCD    WQ0098 10        PS Site ID
     C                     PARM #1AACD    WQ0099  3        SR Source Code
     C                     PARM #1AECD    WQ0100  6        PL Location Cod
     C                     PARM #1AKCD    WQ0101  5        PC Contract Cod
     C                     PARM #1ALCD    WQ0102  5        PSC Sub-Contrac
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWL3PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Display or Edit Comments
      *================================================================
      * If Repayment is cancelled, only display the comments
      * CASE: PAR.TRH Repayment Status is Cancelled
     C           P2MASS    IFEQ 'X'                        *IF
      * Dsp Tattoo Repay Cmnt DF - Tattoo Repayment Comment  * 
     C                     CALL 'PWMGDFR'              90  Dsp Tattoo Repa
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HONB    WQ0103  30       CC Company Numb
     C                     PARM #1CDNZ    WQ0104  50       TRH Repayment I
     C                     PARM #1HMNB    WQ0105  30       BOH Company Num
     C                     PARM #1BNNB    WQ0106  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0107  50       BOL Load Number
     C                     PARM #1CVNB    WQ0108  50       TH Tattoo Numbe
     C                     PARM #1B0DT    WQ0109  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWMGDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     ELSE
      * CASE: *OTHERWISE
      * Edt Tattoo Repay Cmnt EF - Tattoo Repayment Comment  * 
     C                     CALL 'PWLJEFR'              90  Edt Tattoo Repa
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HONB    WQ0110  30       CC Company Numb
     C                     PARM #1CDNZ    WQ0111  50       TRH Repayment I
     C                     PARM #1HMNB    WQ0112  30       BOH Company Num
     C                     PARM #1BNNB    WQ0113  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0114  50       BOL Load Number
     C                     PARM #1CVNB    WQ0115  50       TH Tattoo Numbe
     C                     PARM #1B0DT    WQ0116  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWLJEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * No Change, Mark as Edited
      *================================================================
      * CASE: RCD.TRD Repayment Status is Unpaid
     C           #1MCSS    IFEQ 'U'                        *IF
      * Chg Tattoo Repay Dtl  CH - Tattoo Repayment Detail  * Edited
     C                     EXSR STCHRC
     C                     Z-ADD*ZEROS    ZQ      50
     C           @CN,032   CAT  @CN,033:ZQYL0014    P      TRC Comment
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
     C                     EXSR SUCRRC
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0008           *SFLSEL
      * Send message 'Repay: Option E Not Valid'
     C                     MOVEL'PRK1613' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Modification history
      *================================================================
      * 12/28/2023 JM  S000219 - Fix unintentional deletion of Carcass De
      *                          Tattoo Ded/Add.
      *  8/30/2021 JBB HD83251 - Allow Repayment on Previous Day
      *                          Function modified. Allow the business us
      *                          to perform a repayment on the previous
      *                          business day.
      *  5/05/2021 JBB F17058 - Tattoo Repayments by Business User
      *                         Function created.
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      *
     C           KLVAWA    KLIST
     C                     KFLD           WAHONB           CC Company Numb
     C                     KFLD           WACDNZ           TRH Repayment I
      * Setup key
     C                     Z-ADD#2HONB    WAHONB
     C                     Z-ADD#2CDNZ    WACDNZ
     C           KLVAWA    CHAIN@AWCPAQ              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Restrictor relation not satisfied
      * Send message 'Tattoo Repayment Heade NF'
     C                     MOVEL'PRK1564' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'PRK1564' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         XCVFA     BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C           XDAY1     IFGT 109267
     C                     ADD  2         XDAY1
     C                     ELSE
     C           XDAY1     IFGT 36218
     C                     ADD  1         XDAY1
     C                     END
     C                     END
      * Full years (up to the date)
     C           XDAY1     DIV  365.25    XDWK1   80
     C                     MVR            XDWK3   71
     C                     Z-ADDXDWK1     XDINYY
     C           XDWK3     IFEQ 0
      * The date is the end of a year
     C                     Z-ADD12        XDINMM
     C                     Z-ADD31        XDINDD
     C                     ELSE
      * Year days up to the date
     C           XDWK1     MULT 365.25    XDWK2   60
     C                     SUB  XDWK2     XDAY1
     C                     ADD  1         XDINYY
      * Leap year ?
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
      * March 1 (relative day of the year)
     C           XDWK1     IFEQ 0
     C                     Z-ADD60        XDWK1
     C                     ELSE
     C                     Z-ADD59        XDWK1
     C                     END
      * Define date base month and offset day -
     C           XDAY1     IFLE XDWK1
      *  - January (thru February)
     C                     Z-ADD1         XDINMM
     C                     ELSE
     C                     SUB  XDWK1     XDAY1
     C           XDAY1     IFLE 153
      *  - March (thru July)
     C                     Z-ADD3         XDINMM
     C                     ELSE
      *  - August (thru December)
     C                     Z-ADD8         XDINMM
     C                     SUB  153       XDAY1
     C                     END
      * Calculate 2 month base and offset day
     C           XDAY1     SUB  1         XDWK1
     C                     DIV  61        XDWK1
     C                     MVR            XDAY1
     C                     ADD  1         XDAY1
     C                     MULT 2         XDWK1
     C                     ADD  XDWK1     XDINMM
     C                     END
      * Calculate date increment,
     C           XDAY1     IFGT 31
     C                     ADD  1         XDINMM
     C                     SUB  31        XDAY1
     C                     END
     C                     Z-ADDXDAY1     XDINDD
     C                     END
      *================================================================
     CSR         XCVFAE    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDADY     BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C           XDURR     IFEQ 0
     C           XDWSL     OREQ 0
      * None days of week selected
     C                     Z-ADDXDAY2     XDAY1
     C           XDURR     IFNE *ZERO
      * Return Code: Unable to increment date.
     C                     MOVEL'Y2U0059' W0RTN   7
     C                     ENDIF
     C                     GOTO XDADYE
     C                     ENDIF
     C           XDWSL     IFEQ 7
      * All days of week selected
     C           XDAY2     ADD  XDURR     XDAY1
     C                     GOTO XDADYM
     C                     ENDIF
      * Some days of week selected
     C           XDURR     IFGE 0
     C                     Z-ADD1         XDSTP   10
     C                     ELSE
     C                     Z-ADD-1        XDSTP
     C                     ENDIF
      * Get number of full weeks in the duration
     C           XDURR     DIV  XDWSL     XDWNB   60
      * Isolate the last week
     C                     MVR            XDLSW   10
     C           XDLSW     IFEQ 0
     C           XDWSL     MULT XDSTP     XDLSW
     C                     SUB  XDSTP     XDWNB
     C                     ENDIF
      * Increment the date by the full weeks
     C           XDWNB     MULT 7         XDWK1   80
     C           XDAY2     ADD  XDWK1     XDAY1   60
      * Determine day of week of the beginning date
     C           XDAY2     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ENDIF
      * Loop: Increment the date by the last week
     C           XDLSW     DOWNE0
      * Increment the date
     C                     ADD  XDSTP     XDAY1
      * Increment the day of week
     C                     ADD  XDSTP     YY
      * Put day of week into the range 1-7
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ELSE
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     ELSE
     C           YY        IFEQ -1
     C                     Z-ADD6         YY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           YDOW,YY   IFEQ XDSEL
      * Selected day of the last week has been processed
     C                     SUB  XDSTP     XDLSW
     C                     ENDIF
      * End of loop
     C                     ENDDO
     C           XDADYM    TAG
     C           XDINDD    IFLT 1
     C                     Z-ADD1         XDINDD
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         XDADYE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD14        ZHSTRW  40
     C                     Z-ADD20        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      *
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WACDNZ           TRH Repayment I
     C                     Z-ADD*ZERO     WAIDDT           TRH Date Start
     C                     Z-ADD*ZERO     WACATM           TRH Time Start
     C                     Z-ADD*ZERO     WAIEDT           TRH Date Comple
     C                     Z-ADD*ZERO     WACBTM           TRH Time Comple
     C                     Z-ADD*ZERO     WAIFDT           TRH Payment Dat
     C                     Z-ADD*ZERO     WACTNZ           TRH Payment Ste
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Clear all neither parameters
      * Crt Tattoo Repay Cmnt CR - Tattoo Repayment Comment  * 
     C                     Z-ADD*ZERO     AYCINZ           TRC Sequence
     C                     Z-ADD*ZERO     AYAADT           RS Date Changed
     C                     Z-ADD*ZERO     AYAMTM           RS Time Changed
     C                     Z-ADD*ZERO     AYABDT           RS Date Added
     C                     Z-ADD*ZERO     AYABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHONB           CC Company Numb
     C                     Z-ADD*ZERO     WCCDNZ           TRH Repayment I
     C                     Z-ADD*ZERO     WCCINZ           TRC Sequence
     C                     Z-ADD*ZERO     WCHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WCBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WCBONB           BOL Load Number
     C                     Z-ADD*ZERO     WCCVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WCB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDHONB           CC Company Numb
     C                     Z-ADD*ZERO     WDCKDT           Pmt Current Pay
     C                     Z-ADD*ZERO     WDM1NB           Pmt Current Pay
     C                     Z-ADD*ZERO     WDPINB           PP Unused Nbr 1
     C                     Z-ADD*ZERO     WDAADT           RS Date Changed
     C                     Z-ADD*ZERO     WDAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WDABDT           RS Date Added
     C                     Z-ADD*ZERO     WDABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEHONB           CC Company Numb
     C                     Z-ADD*ZERO     WECDNZ           TRH Repayment I
     C                     Z-ADD*ZERO     WEHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WEBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WEBONB           BOL Load Number
     C                     Z-ADD*ZERO     WECVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WEB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WECGNZ           Transfer Buy Or
     C                     Z-ADD*ZERO     WECENZ           Transfer Buy Or
     C                     Z-ADD*ZERO     WECFNZ           Transfer Tattoo
     C                     Z-ADD*ZERO     WEIIDT           Transfer Kill D
     C                     Z-ADD*ZERO     WEC1NZ           TRD Pen Head
     C                     Z-ADD*ZERO     WEAADT           RS Date Changed
     C                     Z-ADD*ZERO     WEAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WEABDT           RS Date Added
     C                     Z-ADD*ZERO     WEABTM           RS Time Added
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    W0WD01 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL@CN,1     @CN,1
     C                     MOVEL'N'       W0PMT   1
      *
     C                     MOVEL*BLANK    W0SJO 132        *Sbmjob overrid
      * Define local work field Pmt Current Payment Date
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field Pmt Current Payment Step
     C                     Z-ADD*ZERO     YL0002  50
      * Define null work field PP Commission Paym Error
     C                     MOVEL*BLANK    YN0001  1
      * Define local work field PP Payment Error
     C                     MOVEL*BLANK    YL0003  1
      * Define null work field PP Unused Nbr 1
     C                     Z-ADD*ZERO     YN0002  50
      * Define local work field PP Repayment Status
     C                     MOVEL*BLANK    YL0004  1
      * Define local work field User Class f/usrprf   USR
     C                     MOVEL*BLANK    YL0005 10
      * Define local work field System Value Alpha    USR
     C                     MOVEL*BLANK    YL0006 40
      * Define local work field Date Alpha USR
     C                     MOVEL*BLANK    YL0007  7
      * Define local work field Last Run Date
     C                     Z-ADD*ZERO     YL0008  70
      * Define local work field Date From Convert USR
     C                     MOVEL*BLANK    YL0009 10
      * Define local work field File
     C                     MOVEL*BLANK    YL0010 10
      * Define null work field TH Purchase Date
     C                     Z-ADD*ZERO     YN0003  70
      * Define null work field TH Group Reference
     C                     MOVEL*BLANK    YN0004 10
      * Define null work field TH Live Purchase UOM
     C                     MOVEL*BLANK    YN0005  2
      * Define null work field TH Live Purchase Price
     C                     Z-ADD*ZERO     YN0006  52
      * Define null work field TH Live Gross Amt
     C                     Z-ADD*ZERO     YN0007  72
      * Define null work field TH LIve Net Amt
     C                     Z-ADD*ZERO     YN0008  72
      * Define null work field TH Resale UOM
     C                     MOVEL*BLANK    YN0009  2
      * Define null work field TH Recalc Live Wgt Yld
     C                     Z-ADD*ZERO     YN0010  52
      * Define null work field TH Pricing Date
     C                     Z-ADD*ZERO     YN0011  70
      * Define null work field TH Resale Spread Sts
     C                     MOVEL*BLANK    YN0012  1
      * Define null work field TH Dead On Arrival
     C                     Z-ADD*ZERO     YN0013  50
      * Define null work field TH Head Received
     C                     Z-ADD*ZERO     YN0014  50
      * Define null work field TH Yard Deads
     C                     Z-ADD*ZERO     YN0015  50
      * Define null work field TH Held Over
     C                     Z-ADD*ZERO     YN0016  50
      * Define null work field TH Head Condemned
     C                     Z-ADD*ZERO     YN0017  50
      * Define null work field TH Head Killed
     C                     Z-ADD*ZERO     YN0018  50
      * Define null work field TH Head Adds
     C                     Z-ADD*ZERO     YN0019  50
      * Define null work field TH Head Accepted
     C                     Z-ADD*ZERO     YN0020  50
      * Define null work field TH Live Wgt
     C                     Z-ADD*ZERO     YN0021  71
      * Define null work field TH Adj Live Wgt
     C                     Z-ADD*ZERO     YN0022  71
      * Define null work field TH Hot Wgt
     C                     Z-ADD*ZERO     YN0023  71
      * Define null work field TH Tot Loin Eye Depth
     C                     Z-ADD*ZERO     YN0024  61
      * Define null work field TH Tot Backfat Inches
     C                     Z-ADD*ZERO     YN0025  61
      * Define null work field TH Tot Light Reflectance
     C                     Z-ADD*ZERO     YN0026  61
      * Define null work field TH Avg Live Wgt
     C                     Z-ADD*ZERO     YN0027  51
      * Define null work field TH Avg Hot Wgt
     C                     Z-ADD*ZERO     YN0028  51
      * Define null work field TH Avg Light Reflectance
     C                     Z-ADD*ZERO     YN0029  31
      * Define null work field TH Avg Lean Percent
     C                     Z-ADD*ZERO     YN0030  31
      * Define null work field TH Avg Loin Eye Depth
     C                     Z-ADD*ZERO     YN0031  31
      * Define null work field TH Avg Backfat
     C                     Z-ADD*ZERO     YN0032  31
      * Define null work field TH Std Yield Percent
     C                     Z-ADD*ZERO     YN0033  52
      * Define null work field TH Actual Yield %
     C                     Z-ADD*ZERO     YN0034  52
      * Define null work field TH Adj Actual Yield %
     C                     Z-ADD*ZERO     YN0035  52
      * Define null work field TH Yield Difference
     C                     Z-ADD*ZERO     YN0036  52
      * Define null work field TH Recalc Live Wgt
     C                     Z-ADD*ZERO     YN0037  31
      * Define null work field TH CM Market Price
     C                     Z-ADD*ZERO     YN0038  52
      * Define null work field TH CM Base Mkt Price
     C                     Z-ADD*ZERO     YN0039  52
      * Define null work field TH CM Base Mkt Price Amt
     C                     Z-ADD*ZERO     YN0040  72
      * Define null work field TH CM Sort Discount Amt
     C                     Z-ADD*ZERO     YN0041  72
      * Define null work field TH CM Yield Gain/Loss Amt
     C                     Z-ADD*ZERO     YN0042  72
      * Define null work field TH CM Base Carcass Value
     C                     Z-ADD*ZERO     YN0043  72
      * Define null work field TH CM LN AddOn/Deduct Amt
     C                     Z-ADD*ZERO     YN0044  72
      * Define null work field TH CM Carcass Gross Amt
     C                     Z-ADD*ZERO     YN0045  72
      * Define null work field TH Deduction Amt
     C                     Z-ADD*ZERO     YN0046  72
      * Define null work field TH Total Net WO Adds
     C                     Z-ADD*ZERO     YN0047  72
      * Define null work field TH Carcass Net Amt
     C                     Z-ADD*ZERO     YN0048  72
      * Define null work field TH Additions Amt
     C                     Z-ADD*ZERO     YN0049  72
      * Define null work field TH Payment Gross
     C                     Z-ADD*ZERO     YN0050  72
      * Define null work field Th Payment Net Amt
     C                     Z-ADD*ZERO     YN0051  72
      * Define null work field TH AP Voucher/Document#
     C                     Z-ADD*ZERO     YN0052  80
      * Define null work field TH Freight Amount
     C                     Z-ADD*ZERO     YN0053  72
      * Define null work field TH Accrual Amount
     C                     Z-ADD*ZERO     YN0054  72
      * Define null work field TH Fixed Cost Amount
     C                     Z-ADD*ZERO     YN0055  72
      * Define null work field TH Calc Net Sts
     C                     MOVEL*BLANK    YN0056  1
      * Define null work field TH Header Error Sts
     C                     MOVEL*BLANK    YN0057  1
      * Define null work field TH Detail Error Sts
     C                     MOVEL*BLANK    YN0058  1
      * Define null work field TH Kill Balancing Sts
     C                     MOVEL*BLANK    YN0059  1
      * Define null work field TH Bal to Kill Gen
     C                     MOVEL*BLANK    YN0060  1
      * Define null work field TH Commission A/P Voucher
     C                     Z-ADD*ZERO     YN0061  80
      * Define null work field TH Voucher Payment Date
     C                     Z-ADD*ZERO     YN0062  70
      * Define null work field TH User Error Override
     C                     MOVEL*BLANK    YN0063  1
      * Define null work field TH Sex
     C                     MOVEL*BLANK    YN0064  1
      * Define null work field TH Held/Ovr Completed Dte
     C                     Z-ADD*ZERO     YN0065  70
      * Define null work field TH Commission Paid Date
     C                     Z-ADD*ZERO     YN0066  70
      * Define null work field TH Actual Check Date
     C                     Z-ADD*ZERO     YN0067  70
      * Define null work field TH Shipped Weight
     C                     Z-ADD*ZERO     YN0068  71
      * Define null work field TH Avg Hot Wgt EXC/ADD
     C                     Z-ADD*ZERO     YN0069  71
      * Define null work field TH FFLI
     C                     Z-ADD*ZERO     YN0070  31
      * Define null work field TH Kill Product Value
     C                     Z-ADD*ZERO     YN0071  72
      * Define null work field TH Cut Product Value
     C                     Z-ADD*ZERO     YN0072  72
      * Define null work field TH Render Product Value
     C                     Z-ADD*ZERO     YN0073  72
      * Define null work field TH Head Excluded
     C                     Z-ADD*ZERO     YN0074  50
      * Define null work field TH CM Bse Mkt Live /CWT
     C                     Z-ADD*ZERO     YN0075  52
      * Define null work field TH CM Bse Mkt Carc /CWT
     C                     Z-ADD*ZERO     YN0076  52
      * Define null work field TH CM Srt Dsc Live /CWT
     C                     Z-ADD*ZERO     YN0077  52
      * Define null work field TH CM Srt Dsc Carc /CWT
     C                     Z-ADD*ZERO     YN0078  52
      * Define null work field TH CM Yld G/L Live /CWT
     C                     Z-ADD*ZERO     YN0079  52
      * Define null work field TH CM Yld G/L Carc /CWT
     C                     Z-ADD*ZERO     YN0080  52
      * Define null work field TH CM Crc Val Live /CWT
     C                     Z-ADD*ZERO     YN0081  52
      * Define null work field TH CM Crc Val Carc /CWT
     C                     Z-ADD*ZERO     YN0082  52
      * Define null work field TH CM Lean Prem Live /CWT
     C                     Z-ADD*ZERO     YN0083  52
      * Define null work field TH CM Lean Prem Carc /CWT
     C                     Z-ADD*ZERO     YN0084  52
      * Define null work field TH CM Gross Live /CWT
     C                     Z-ADD*ZERO     YN0085  52
      * Define null work field TH CM Gross Carc /CWT
     C                     Z-ADD*ZERO     YN0086  52
      * Define null work field TH Source Type
     C                     MOVEL*BLANK    YN0087  1
      * Define null work field TH Scale Ticket Sts
     C                     MOVEL*BLANK    YN0088  1
      * Define null work field TH Payment Type
     C                     MOVEL*BLANK    YN0089  1
      * Define null work field TH HPS Movement Ref #
     C                     Z-ADD*ZERO     YN0090  70
      * Define null work field TH Source Code
     C                     MOVEL*BLANK    YN0091  3
      * Define null work field TH Hog Class Type
     C                     MOVEL*BLANK    YN0092  1
      * Define null work field TH Posted to HPS Flag
     C                     MOVEL*BLANK    YN0093  1
      * Define null work field TH Schedule Kill Shift
     C                     MOVEL*BLANK    YN0094  1
      * Define null work field TH Shift Held Over
     C                     MOVEL*BLANK    YN0095  1
      * Define null work field TH State
     C                     MOVEL*BLANK    YN0096  3
      * Define null work field TH Unused Code
     C                     MOVEL*BLANK    YN0097  3
      * Define null work field TH Unused Sts 2 Pos
     C                     MOVEL*BLANK    YN0098  2
      * Define null work field TH Commission Status
     C                     MOVEL*BLANK    YN0099  1
      * Define null work field TH Paid 2 Week Avg Y/N
     C                     MOVEL*BLANK    YN0100  1
      * Define null work field TH Unused Sts 1 Pos -3
     C                     MOVEL*BLANK    YN0101  1
      * Define null work field TH DOA Weight
     C                     Z-ADD*ZERO     YN0102  71
      * Define null work field TH Avg Lean % EXC/ADD
     C                     Z-ADD*ZERO     YN0103  71
      * Define null work field TH HPS Farm Site
     C                     Z-ADD*ZERO     YN0104  50
      * Define null work field TH Shift Held Over Head
     C                     Z-ADD*ZERO     YN0105  50
      * Define null work field TH Sorting Amount
     C                     Z-ADD*ZERO     YN0106  72
      * Define null work field TH Head Identified
     C                     Z-ADD*ZERO     YN0107  50
      * Define null work field TH Percent Identified
     C                     Z-ADD*ZERO     YN0108  52
      * Define null work field TH Percent Accepted
     C                     Z-ADD*ZERO     YN0109  52
      * Define null work field TH Head Adjusted-LN%
     C                     Z-ADD*ZERO     YN0110  50
      * Define null work field TH PHA Head Adds
     C                     Z-ADD*ZERO     YN0111  50
      * Define null work field TH PHA Add Type
     C                     MOVEL*BLANK    YN0112  1
      * Define null work field TH PHA Average Type
     C                     MOVEL*BLANK    YN0113  3
      * Define null work field TH PHA Add Reason
     C                     MOVEL*BLANK    YN0114  1
      * Define null work field TH PHA Yield Percent
     C                     Z-ADD*ZERO     YN0115  52
      * Define null work field TH PHA Lean Prm /Crc CWT
     C                     Z-ADD*ZERO     YN0116  52
      * Define null work field TH VC Gross Value /HD
     C                     Z-ADD*ZERO     YN0117  52
      * Define null work field TH Excluded Gross Value
     C                     Z-ADD*ZERO     YN0118  72
      * Define null work field TH Avg Lean %
     C                     Z-ADD*ZERO     YN0119  50
      * Define null work field TH Broken Back Hd Count
     C                     Z-ADD*ZERO     YN0120  50
      * Define null work field TH Hot Scl Upload Time
     C                     Z-ADD*ZERO     YN0121  70
      * Define null work field TH Unused Nbr 4
     C                     Z-ADD*ZERO     YN0122  70
      * Define null work field TH Excluded Carc Val
     C                     Z-ADD*ZERO     YN0123  72
      * Define null work field TH Excluded Premium
     C                     Z-ADD*ZERO     YN0124  72
      * Define null work field TH Unused Nbr 7
     C                     Z-ADD*ZERO     YN0125  71
      * Define null work field TH Unused Nbr 8
     C                     Z-ADD*ZERO     YN0126  71
      * Define null work field TH Unused Nbr 9
     C                     Z-ADD*ZERO     YN0127 111
      * Define null work field TH Unused Nbr 10
     C                     Z-ADD*ZERO     YN0128 111
      * Define null work field TH Break Even Price/CWT
     C                     Z-ADD*ZERO     YN0129 112
      * Define null work field TH Meat Value Factor Amt
     C                     Z-ADD*ZERO     YN0130 112
      * Define null work field TH Yld Parm Adj Yield%
     C                     Z-ADD*ZERO     YN0131  52
      * Define null work field TH PHA Sort Disc Fctr %
     C                     Z-ADD*ZERO     YN0132  52
      * Define null work field TH Avg Loin Eye - 2 dec
     C                     Z-ADD*ZERO     YN0133  52
      * Define null work field TH Avg Backfat - 2 Dec
     C                     Z-ADD*ZERO     YN0134  52
      * Define null work field TH HITCH Old Pay Net Amt
     C                     Z-ADD*ZERO     YN0135  92
      * Define null work field TH MPR Sort Loss
     C                     Z-ADD*ZERO     YN0136  92
      * Define null work field TH Unused Nbr 19
     C                     Z-ADD*ZERO     YN0137  90
      * Define null work field TH Unused Nbr 20
     C                     Z-ADD*ZERO     YN0138  90
      * Define null work field TH Cold Scl Upload Date
     C                     Z-ADD*ZERO     YN0139  70
      * Define null work field TH Cold Scl Upload Time
     C                     Z-ADD*ZERO     YN0140  70
      * Define null work field TH Head LFT
     C                     Z-ADD*ZERO     YN0141  70
      * Define null work field TH Head EUT/KOA
     C                     Z-ADD*ZERO     YN0142  70
      * Define null work field TH Unused Date 5
     C                     Z-ADD*ZERO     YN0143  70
      * Define null work field TH Unused Sts 1
     C                     MOVEL*BLANK    YN0144  1
      * Define null work field TH Unused Sts 2
     C                     MOVEL*BLANK    YN0145  1
      * Define null work field TH Unused Sts 3
     C                     MOVEL*BLANK    YN0146  1
      * Define null work field TH Unused Sts 4
     C                     MOVEL*BLANK    YN0147  2
      * Define null work field TH Unused Sts 5
     C                     MOVEL*BLANK    YN0148  2
      * Define null work field TH Unused Sts 6
     C                     MOVEL*BLANK    YN0149  3
      * Define null work field TH Unused Sts 7
     C                     MOVEL*BLANK    YN0150  3
      * Define null work field TH Unused Sts 8
     C                     MOVEL*BLANK    YN0151  1
      * Define null work field DF Defect Code
     C                     MOVEL*BLANK    YN0152  6
      * Define null work field PD Producer Code
     C                     MOVEL*BLANK    YN0153  6
      * Define null work field PL Location Code
     C                     MOVEL*BLANK    YN0154  6
      * Define null work field HB Buyer Code
     C                     MOVEL*BLANK    YN0155  3
      * Define null work field GN Genetic Code
     C                     MOVEL*BLANK    YN0156  5
      * Define null work field HC Class Code
     C                     MOVEL*BLANK    YN0157  3
      * Define null work field RS User Changed
     C                     MOVEL*BLANK    YN0158 10
      * Define null work field RS Date Changed
     C                     Z-ADD*ZERO     YN0159  70
      * Define null work field RS Time Changed
     C                     Z-ADD*ZERO     YN0160  60
      * Define null work field RS Record Status
     C                     MOVEL*BLANK    YN0161  1
      * Define null work field RS Job
     C                     MOVEL*BLANK    YN0162 10
      * Define null work field RS Program
     C                     MOVEL*BLANK    YN0163 10
      * Define null work field RS User Added
     C                     MOVEL*BLANK    YN0164 10
      * Define null work field RS Date Added
     C                     Z-ADD*ZERO     YN0165  70
      * Define null work field RS Time Added
     C                     Z-ADD*ZERO     YN0166  60
      * Define local work field TRH Repayment Status
     C                     MOVEL*BLANK    YL0011  1
      * Define null work field TRH Date Start
     C                     Z-ADD*ZERO     YN0167  70
      * Define null work field TRH Time Start
     C                     Z-ADD*ZERO     YN0168  60
      * Define null work field TRH Date Complete
     C                     Z-ADD*ZERO     YN0169  70
      * Define null work field TRH Time Complete
     C                     Z-ADD*ZERO     YN0170  60
      * Define null work field TRH Payment Date
     C                     Z-ADD*ZERO     YN0171  70
      * Define null work field TRH Payment Step
     C                     Z-ADD*ZERO     YN0172  50
      * Define null work field TRH Backup File Prefix
     C                     MOVEL*BLANK    YN0173  6
      * Define local work field Count USR 2
     C                     Z-ADD*ZERO     YL0012  30
      * Define local work field Tattoo Number Alpha
     C                     MOVEL*BLANK    YL0013  5
      * Define local work field TRC Comment
     C                     MOVEL*BLANK    YL0014 60
      * Define local work field Continue Process USR
     C                     MOVEL*BLANK    YL0015  1
      * Define local work field Display Warning on Screen
     C                     MOVEL*BLANK    YL0016  1
      * Define local work field Libraries: From/To
     C                     MOVEL*BLANK    YL0017 20
      * Define local work field Library From USR
     C                     MOVEL*BLANK    YL0018 10
      * Define local work field Library To USR
     C                     MOVEL*BLANK    YL0019 10
      * Define local work field Month USR
     C                     Z-ADD*ZERO     YL0020  20
      * Define local work field Day of Month USR
     C                     Z-ADD*ZERO     YL0021  20
      * Define local work field Month and Day 4.0
     C                     Z-ADD*ZERO     YL0022  40
      * Define local work field @Text 4
     C                     MOVEL*BLANK    YL0023  4
      * Define local work field Backup File Prefix
     C                     MOVEL*BLANK    YL0024  6
      * Define local work field Back Up Date From
     C                     Z-ADD*ZERO     YL0025  70
      * Define local work field All Tattoos Edited Y/N
     C                     MOVEL*BLANK    YL0026  1
      * Define local work field PP Commission Paym Error
     C                     MOVEL*BLANK    YL0027  1
      * Define local work field Payment Status - Saved
     C                     MOVEL*BLANK    YL0028  2
      * Define local work field Process Code - Saved
     C                     MOVEL*BLANK    YL0029  6
      * Define null work field Process Code - Saved
     C                     MOVEL*BLANK    YN0174  6
      * Define null work field PP Repayment Status
     C                     MOVEL*BLANK    YN0175  1
      * Define local work field TRD Payment Sts
     C                     MOVEL*BLANK    YL0030  2
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD07        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Modification history
     C                     EXSR UQSUBR                     Modification hi
      * Rtv User Class        UP - STR Miscellaneous  * 
     C                     CALL 'PKU3UPR'              90  Rtv User Class
     C           YL0005    PARM YL0005    WQ0117 10        User Class f/us
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKU3UPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Cancelled
00002 Created
00003 In progress
00004 Repaid
00005 Repayment files are backe
00006 HPEREPAYBU
00007 Repayment files not backe
00008 d for a repayment today.
00009 Repayment file backup in
00010 progress, step
00011 Error backing up Repaymen
00012 t file
00013 Unpaid
00014 DifRpt
00015 Edited
00016 Transfer
00017 PayEdtEx
00018 PayEdtCm
00019 PayEdtEr
00020 PayEdtIc
00021 Completed.
00022 Cancelled.
00023 Tattoo Repayment In Progr
00024 HPEREPAYLB
00025 Y2U9999
00026 The Payment Edit has been
00027 executed
00028 Tattoo Repayment Differen
00029 ce Sequel executed
00030 Tattoo Repayment Detail r
00031 ecord removed from list.
00032 No edit needed, mark as E
00033 dited for Payment Edit.
