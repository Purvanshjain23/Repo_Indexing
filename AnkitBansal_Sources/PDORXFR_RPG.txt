     H/TITLE CLC Formula Details    XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/22/10  Time  : 17:11:05
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDIMCPL2IF  E           K        DISK
      * RSQ : Order Detail Pricing      Ord/Detail/Price Seq
      *
     FPDIMCPW2IF  E           K        DISK
      * RSQ : Order Detail Pricing      Ord/Dtl/Prc Seq Work
      *
     I@IMCPZ0
      * Order Detail Pricing      Ord/Detail/Price Seq
      * Renamed input format fields
     I              IMAIC3                          WAAIC3
     I              IMC4NB                          WAC4NB
     I              IMDPNB                          WADPNB
     I              IMUENB                          WAUENB
     I              IMQ9CD                          WAQ9CD
     I              IMPDSQ                          WAPDSQ
     I              IMBNPR                          WABNPR
     I              IMU6ST                          WAU6ST
     I              IMUVST                          WAUVST
     I              IMUWST                          WAUWST
     I              IMUXST                          WAUXST
     I              IMAATM                          WAAATM
     I              IMAYNA                          WAAYNA
     I              IMA0NA                          WAA0NA
     I              IMAXDT                          WAAXDT
      *
     I@IMPCZW0
      * Order Detail Pricing      Ord/Dtl/Prc Seq Work
      * Renamed input format fields
     I              IMAIC3                          WBAIC3
     I              IMC4NB                          WBC4NB
     I              IMDPNB                          WBDPNB
     I              IMUENB                          WBUENB
     I              IMQ9CD                          WBQ9CD
     I              IMPDSQ                          WBPDSQ
     I              IMBNPR                          WBBNPR
     I              IMU6ST                          WBU6ST
     I              IMUVST                          WBUVST
     I              IMUWST                          WBUWST
     I              IMUXST                          WBUXST
     I              IMAATM                          WBAATM
     I              IMAYNA                          WBAYNA
     I              IMA0NA                          WBA0NA
     I              IMAXDT                          WBAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Dtl Formula Dtl
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Order Number
     I                                    P   3   60P1C4NB
      * I :  Order Sequence Number
     I                                    P   7   80P1DPNB
      * I :  Order Secondary Line Seq
     I                                    P   9  100P1UENB
     IP2PARM      DS
      * FLD: *Arrays
      * B :  PRC STRITM Field USR
     I                                    P   1   62P2T3VA
      * B :  PRC CIDIFF Field USR
     I                                    P   7  122P2T4VA
      * B :  PRC TOTAL 1 USR
     I                                    P  13  182P2T5VA
      * B :  PRC SUBCRD USR
     I                                    P  19  242P2T8VA
      * B :  PRC TOTAL 2 USR
     I                                    P  25  302P2T6VA
      * B :  PRC TOTAL 3 USR
     I                                    P  31  362P2UFVA
      * B :  PRC MSCYLD USR
     I                                    P  37  422P2T9VA
      * B :  PRC CALCED TOTAL USR
     I                                    P  43  482P2UAVA
      * B :  PRC CIFMPF USR
     I                                    P  49  542P2UBVA
      * B :  PRC IOVRFM USR
     I                                    P  55  602P2UCVA
      * B :  PRC CFRTOV USR
     I                                    P  61  662P2UDVA
      * B :  PRC OVERAGES USR
     I                                    P  67  722P2UEVA
      * B :  PRC TOTAL PRICE USR
     I                                    P  73  782P2T7VA
     IP3PARM      DS
      * FLD: *Arrays
      * I :  Event Called From
     I                                        1   2 P3SJCD
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P1DPNB    PARM           WP0003  30       Order Sequence
     C           P1UENB    PARM           WP0004  30       Order Secondary
     C           P2T3VA    PARM P2T3VA    WP0005 112       PRC STRITM Fiel
     C           P2T4VA    PARM P2T4VA    WP0006 112       PRC CIDIFF Fiel
     C           P2T5VA    PARM P2T5VA    WP0007 112       PRC TOTAL 1 USR
     C           P2T8VA    PARM P2T8VA    WP0008 112       PRC SUBCRD USR
     C           P2T6VA    PARM P2T6VA    WP0009 112       PRC TOTAL 2 USR
     C           P2UFVA    PARM P2UFVA    WP0010 112       PRC TOTAL 3 USR
     C           P2T9VA    PARM P2T9VA    WP0011 112       PRC MSCYLD USR
     C           P2UAVA    PARM P2UAVA    WP0012 112       PRC CALCED TOTA
     C           P2UBVA    PARM P2UBVA    WP0013 112       PRC CIFMPF USR
     C           P2UCVA    PARM P2UCVA    WP0014 112       PRC IOVRFM USR
     C           P2UDVA    PARM P2UDVA    WP0015 112       PRC CFRTOV USR
     C           P2UEVA    PARM P2UEVA    WP0016 112       PRC OVERAGES US
     C           P2T7VA    PARM P2T7VA    WP0017 112       PRC TOTAL PRICE
     C           P3SJCD    PARM           WP0018  2        Event Called Fr
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CLC Formula Details    XF
      * Zero Parameters
      * PAR = CON By name
     C                     Z-ADD*ZERO     P2T3VA           PRC STRITM Fiel
     C                     Z-ADD*ZERO     P2T4VA           PRC CIDIFF Fiel
     C                     Z-ADD*ZERO     P2T5VA           PRC TOTAL 1 USR
     C                     Z-ADD*ZERO     P2T8VA           PRC SUBCRD USR
     C                     Z-ADD*ZERO     P2T6VA           PRC TOTAL 2 USR
     C                     Z-ADD*ZERO     P2UFVA           PRC TOTAL 3 USR
     C                     Z-ADD*ZERO     P2T9VA           PRC MSCYLD USR
     C                     Z-ADD*ZERO     P2UAVA           PRC CALCED TOTA
     C                     Z-ADD*ZERO     P2UBVA           PRC CIFMPF USR
     C                     Z-ADD*ZERO     P2UCVA           PRC IOVRFM USR
     C                     Z-ADD*ZERO     P2UDVA           PRC CFRTOV USR
     C                     Z-ADD*ZERO     P2UEVA           PRC OVERAGES US
     C                     Z-ADD*ZERO     P2T7VA           PRC TOTAL PRICE
      * Call Program to load return parameters
      * CASE: PAR.Event Called From is Invoice Update
     C           P3SJCD    IFEQ '02'                       *IF
      * CLC Formula Dtls       RT - PD Ship Detail Pricing  * 
     C                     EXSR SARVGN
     C                     ELSE
      * CASE: PAR.Event Called From is Pre-Update Invoice
     C           P3SJCD    IFEQ '**'                       *IF
      * CLC Formula Dtls Work  RT - PD Ship Detail Pricing  * 
     C                     EXSR SBRVGN
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * CLC Formula Dtls       RT - PD Ship Detail Pricing  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001 114       Starting Produc
     C                     Z-ADD*ZERO     WN0002 114       Credit Value
     C                     Z-ADD*ZERO     WN0003 114       Muscle Yield Pr
     C                     Z-ADD*ZERO     WN0004 114       Standard Overag
     C                     Z-ADD*ZERO     WN0005 114       USR Cust/Item D
     C                     Z-ADD*ZERO     WN0006 114       Formula Process
     C                     Z-ADD*ZERO     WN0007 114       Item Overage PR
     C                     Z-ADD*ZERO     WN0008 114       Freight Cost
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAIC3    WQSA01           Company Number
     C           *LIKE     DEFN WAC4NB    WQSA02           Order Number
     C           *LIKE     DEFN WADPNB    WQSA03           Order Sequence
     C           *LIKE     DEFN WAUENB    WQSA04           Order Secondary
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Company Number
     C                     KFLD           WQSA02           Order Number
     C                     KFLD           WQSA03           Order Sequence
     C                     KFLD           WQSA04           Order Secondary
      * Setup key
     C                     Z-ADDP1AIC3    WQSA01           Company Number
     C                     Z-ADDP1C4NB    WQSA02           Order Number
     C                     Z-ADDP1DPNB    WQSA03           Order Sequence
     C                     Z-ADDP1UENB    WQSA04           Order Secondary
      * Establish starting position
     C           KRSSA     SETLL@IMCPZ0                    *
     C           KRSSA     READE@IMCPZ0                  90*
      * Data record not found
     C   90                MOVEL'USR1675' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      *        01=Unused ( MKTPRC )
      * *** 02 PROCESS COMPONANT STRITM IF SELECTED *
      * CASE: Calculate Formula Price
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is STRITM
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'STRITM'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0001           Starting Produc
     C                     END                             *FI
      * *** 03 PROCESS COMPONANT CIDIFF IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CIDIFF
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'CIDIFF'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0005           USR Cust/Item D
     C                     END                             *FI
      *        04=Unused ( TCRDVY )
      * *** 05 PROCESS COMPONANT SUBCRD IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is SUBCRD
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'SUBCRD'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0002           Credit Value
     C                     END                             *FI
      * *** 06 PROCESS COMPONANT MSCYLD IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is MSCYLD
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'MSCYLD'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0003           Muscle Yield Pr
     C                     END                             *FI
      * *** 07 PROCESS COMPONANT CIFMPF IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CIFMPF
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'CIFMPF'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0006           Formula Process
     C                     END                             *FI
      * *** 08 PROCESS COMPONANT IOVRFM IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is IOVRFM
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'IOVRFM'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0007           Item Overage PR
     C                     END                             *FI
      * *** 09 PROCESS COMPONANT CFRTOV IF SELECTED *
      * CASE: Retrieve Freight Overage
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CFRTOV
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAQ9CD    IFEQ 'CFRTOV'                   *IF
     C           WAU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WABNPR    WN0008           Freight Cost
     C                     END                             *FI
      *        10=Unused ( CIOVMK )
      *        11=Unused ( IOVMKT )
     C           KRSSA     READE@IMCPZ0                  90*
     C                     ENDDO
      * USER: Exit processing
     C           WN0001    MULT 1         P2T3VA    H      PRC STRITM Fiel
     C           WN0005    MULT 1         P2T4VA    H      PRC CIDIFF Fiel
     C           P2T3VA    ADD  P2T4VA    P2T5VA           PRC TOTAL 1 USR
     C           WN0001    ADD  WN0005    WUCQPR           USR Subtotal 1
     C           WN0002    MULT 1         P2T8VA    H      PRC SUBCRD USR
     C           WUCQPR    ADD  WN0002    WUCRPR           USR Subtotal 2
     C           P2T5VA    ADD  P2T8VA    P2T6VA           PRC TOTAL 2 USR
     C                     Z-ADDP2T6VA    P2UFVA           PRC TOTAL 3 USR
     C           WN0003    MULT 1         P2T9VA    H      PRC MSCYLD USR
     C           WN0003    DIV  100       WUCHPR           Muscle Yield Pr
      * Divide running Unit Price total by Muscle Yield (if not equal 0)
      * CASE: WRK.Muscle Yield Price NE WRK.ZERO
     C           WUCHPR    IFNE WUW0NB                     *IF
     C           WUCRPR    DIV  WUCHPR    P2UAVA    H      PRC CALCED TOTA
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     P2UAVA           PRC CALCED TOTA
     C                     END                             *FI
     C           WN0006    MULT 1         P2UBVA    H      PRC CIFMPF USR
     C           WN0007    MULT 1         P2UCVA    H      PRC IOVRFM USR
     C           WN0008    MULT 1         P2UDVA    H      PRC CFRTOV USR
     C           P2UCVA    ADD  P2UDVA    P2UEVA           PRC OVERAGES US
     C           P2UAVA    ADD  P2UBVA    P2T7VA           PRC TOTAL PRICE
     C                     ADD  P2UEVA    P2T7VA           PRC TOTAL PRICE
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * CLC Formula Dtls Work  RT - PD Ship Detail Pricing  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0009 114       Starting Produc
     C                     Z-ADD*ZERO     WN0010 114       Credit Value
     C                     Z-ADD*ZERO     WN0011 114       Muscle Yield Pr
     C                     Z-ADD*ZERO     WN0012 114       Standard Overag
     C                     Z-ADD*ZERO     WN0013 114       USR Cust/Item D
     C                     Z-ADD*ZERO     WN0014 114       Formula Process
     C                     Z-ADD*ZERO     WN0015 114       Item Overage PR
     C                     Z-ADD*ZERO     WN0016 114       Freight Cost
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBC4NB    WQSB02           Order Number
     C           *LIKE     DEFN WBDPNB    WQSB03           Order Sequence
     C           *LIKE     DEFN WBUENB    WQSB04           Order Secondary
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
     C                     KFLD           WQSB03           Order Sequence
     C                     KFLD           WQSB04           Order Secondary
      * Setup key
     C                     Z-ADDP1AIC3    WQSB01           Company Number
     C                     Z-ADDP1C4NB    WQSB02           Order Number
     C                     Z-ADDP1DPNB    WQSB03           Order Sequence
     C                     Z-ADDP1UENB    WQSB04           Order Secondary
      * Establish starting position
     C           KRSSB     SETLL@IMPCZW0                   *
     C           KRSSB     READE@IMPCZW0                 90*
      * Data record not found
     C   90                MOVEL'USR1675' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      *        01=Unused ( MKTPRC )
      * *** 02 PROCESS COMPONANT STRITM IF SELECTED *
      * CASE: Calculate Formula Price
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is STRITM
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'STRITM'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0009           Starting Produc
     C                     END                             *FI
      * *** 03 PROCESS COMPONANT CIDIFF IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CIDIFF
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'CIDIFF'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0013           USR Cust/Item D
     C                     END                             *FI
      *        04=Unused ( TCRDVY )
      * *** 05 PROCESS COMPONANT SUBCRD IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is SUBCRD
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'SUBCRD'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0010           Credit Value
     C                     END                             *FI
      * *** 06 PROCESS COMPONANT MSCYLD IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is MSCYLD
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'MSCYLD'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0011           Muscle Yield Pr
     C                     END                             *FI
      * *** 07 PROCESS COMPONANT CIFMPF IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CIFMPF
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'CIFMPF'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0014           Formula Process
     C                     END                             *FI
      * *** 08 PROCESS COMPONANT IOVRFM IF SELECTED *
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is IOVRFM
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'IOVRFM'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0015           Item Overage PR
     C                     END                             *FI
      * *** 09 PROCESS COMPONANT CFRTOV IF SELECTED *
      * CASE: Retrieve Freight Overage
      *  - c1 AND c2
      *   |- c1    : DB1.Price Method Componant is CFRTOV
      *   |- c2    : DB1.PD Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBQ9CD    IFEQ 'CFRTOV'                   *IF
     C           WBU6ST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ADD  WBBNPR    WN0016           Freight Cost
     C                     END                             *FI
      *        10=Unused ( CIOVMK )
      *        11=Unused ( IOVMKT )
     C           KRSSB     READE@IMPCZW0                 90*
     C                     ENDDO
      * USER: Exit processing
     C           WN0009    MULT 1         P2T3VA    H      PRC STRITM Fiel
     C           WN0013    MULT 1         P2T4VA    H      PRC CIDIFF Fiel
     C           P2T3VA    ADD  P2T4VA    P2T5VA           PRC TOTAL 1 USR
     C           WN0009    ADD  WN0013    WUCQPR           USR Subtotal 1
     C           WN0010    MULT 1         P2T8VA    H      PRC SUBCRD USR
     C           WUCQPR    ADD  WN0010    WUCRPR           USR Subtotal 2
     C           P2T5VA    ADD  P2T8VA    P2T6VA           PRC TOTAL 2 USR
     C                     Z-ADDP2T6VA    P2UFVA           PRC TOTAL 3 USR
     C           WN0011    MULT 1         P2T9VA    H      PRC MSCYLD USR
     C           WN0011    DIV  100       WUCHPR           Muscle Yield Pr
      * Divide running Unit Price total by Muscle Yield (if not equal 0)
      * CASE: WRK.Muscle Yield Price NE WRK.ZERO
     C           WUCHPR    IFNE WUW0NB                     *IF
     C           WUCRPR    DIV  WUCHPR    P2UAVA    H      PRC CALCED TOTA
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     P2UAVA           PRC CALCED TOTA
     C                     END                             *FI
     C           WN0014    MULT 1         P2UBVA    H      PRC CIFMPF USR
     C           WN0015    MULT 1         P2UCVA    H      PRC IOVRFM USR
     C           WN0016    MULT 1         P2UDVA    H      PRC CFRTOV USR
     C           P2UCVA    ADD  P2UDVA    P2UEVA           PRC OVERAGES US
     C           P2UAVA    ADD  P2UBVA    P2T7VA           PRC TOTAL PRICE
     C                     ADD  P2UEVA    P2T7VA           PRC TOTAL PRICE
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WAPDSQ           Price Detail Se
     C                     Z-ADD*ZERO     WABNPR           Componant Price
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field USR Subtotal 1 Price
     C                     Z-ADD*ZERO     WUCQPR 114
      * Define work field USR Subtotal 2 Price
     C                     Z-ADD*ZERO     WUCRPR 114
      * Define work field Muscle Yield Price
     C                     Z-ADD*ZERO     WUCHPR 114
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
