     F*****************************************************************
     H*
      *  Program number:  TRNVCH - moved into E1IDEVMDL
      *  Program name:    Create Vouchers in JD Edwards for payment.
      *  Programmer:      Barb Gutierrez    /  Rose Centonze
      *  Date created:    11/19/2008       / 4/07/2020
      *  Program purpose: Create Vouchers for Truckers in JDE from transporation
      *                   software.  (PowerPro)
      *                   -This is a copy of STCVCH with some modifications.
      *                   -STCVCH will go away when the last trucker payments are mde out
      *                    of the PCS software.
      *                   -The records will be written as Unposted.
      *                   -This program is executed from a script written in Visual studio.
      *                    Visual Studio then publish's to directory:
      *                    \\corkcapp1dev\ClickOnce Deployments\PowerProAcctInterface\
      *
      *  Modified by:     Barb Gutierrez   10/26/2011
      *                   Extract company number out of the cost center when writing the 911.  The
      *                   truck payments need to get expensed out into a different company number.
      *
      *  Modified by:     Rose Centonze 08/18/2020  (P16169)
      *                   Update glcff1 with "I" so it wont sync to E1
      *****************************************************************\
      *
     FSTC001L2  IF   E           K DISK
      *   Transportation Interface File
      *
     FF0101LA   IF   E           K DISK
      * JDE ADRESS BOOK
      *
     FF0401LA   IF   E           K DISK
     F* SUPPLIER MASTER
      *
     FF0901LB   IF   E           K DISK
     F                                     RENAME(I0901:I0901LB)
     F* ACCOUNT MASTER
      *
     FF0012     IF   E           K DISK
     F* AUTOMATIC ACCOUNTING INSTRUCTIONS MASTER
      *
     FF0011     UF A E           K DISK
      * JDE BATCH HEADER FILE
      *
     FF0411     O    E             DISK
     F* JDE A/P LEDGER FILE
      *
     FF0911     O    E             DISK
      * JDE G/L LEDGER FILE
      *
      *
      * For call to JDE account routine
      *
     d xxsym           s              1
     d xxomod          s              1
     d xximod          s              1
     d xxerrm          s              4
      *
     d xxani           s                   like(glani)
     d wkani           s                   like(glani)
     d wkmcu           s                   like(glmcu)
     d wkobj           s                   like(globj)
     d wksub           s                   like(glsub)
     d wkacct          s                   like(glani)
     d xxbatch         s              8
      *
      * Workfields
      *
     D NET             S             15  0 DIM(14)
     D JARB            S              1    DIM(8)                               NEW
     D VIDAR           S              1    DIM(8)                               @NUM
     d start           s              2  0
     d wk3co           s              3
      *
      *    G/L DATE  CCYYMMDD
      *
     D                 DS
     D  GLDATE                 1      7  0
     D  GLCENT                 1      1  0
     D  GLYR                   2      3  0
     D  GLMO                   4      5  0
     D  GLDA                   6      7  0
      *
      *    G/L DATE FROM VOUCHER HEADER  MMDDYY
      *
     D                 DS
     D  GLMDY                  1      6  0
     D  MOGL                   1      2  0
     D  DAGL                   3      4  0
     D  YRGL                   5      6  0
      *
      *    CHECK DATE  CCYYMMDD
      *
     D                 DS
     D  CKCYMD                 1      7  0
     D  CKCC                   1      1  0
     D  CKYR                   2      3  0
     D  CKMO                   4      5  0
     D  CKDA                   6      7  0
      *
      *    CHECK DATE  MMDDYY
      *
     D                 DS
     D  CKMDY                  1      6  0
     D  MOCK                   1      2  0
     D  DACK                   3      4  0
     D  YRCK                   5      6  0
      *
      *    INPUT DATE MMDDCCYY
      *
     D                 DS
     D  INPDTE                 1      8
     D  INMM                   1      2  0
     D  INDD                   3      4  0
     D  INMD                   1      4  0
     D  INCC                   5      6  0
     D  INYY                   7      8  0
      *    INPUT DATE YYMMDD
      *
     D                 DS
     D  INPDT                  1      6  0
     D  INPYY                  1      2  0
     D  INPMD                  3      6  0
      *
      *
      *    TRANSACTION DATE MMDDCCYY
      *
     D                 DS
     D  TRNDTE                 1      8
     D  TRMM                   1      2  0
     D  TRDD                   3      4  0
     D  TRMD                   1      4  0
     D  TRCC                   5      6  0
     D  TRYY                   7      8  0
      *    TRANSACTION DATE YYMMDD
      *
     D                 DS
     D  TRANDT                 1      6  0
     D  TRANYY                 1      2  0
     D  TRANMD                 3      6  0
      *
      *    UDATE MMDDYY
      *
     D                 DS
     D  WKUDAT                 1      6  0
     D  WKUMO                  1      2  0
     D  WKUDA                  3      4  0
     D  WKUYR                  5      6  0
      *
      *    UDATE CCYYMMDD
      *
     D                 DS
     D  UDT                    1      8  0
     D  UCC                    1      2  0
     D  UYY                    3      4  0
     D  UMM                    5      6  0
     D  UDD                    7      8  0
      *
     D                 DS
     D  WAMT2                  1     15  2
     D  WAMT2D                 1     15  0
     D                 DS
     D  DBTAMT                 1     12  2
     D  DBTAMD                 1     12  0
     D                 DS
     D  CRAMT                  1     12  2
     D  CRAMD                  1     12  0
     D                 DS
     D  JDEVID                 1      8
     D  VID8                   8      8
     D  VID8#                  1      8  0
     D  VID7                   7      7
     D  VID7#                  1      7  0
     D  VID6                   6      6
     D  VID6#                  1      6  0
     D  VID5                   5      5
     D  VID5#                  1      5  0
     D  VID4                   4      4
     D  VID4#                  1      4  0
     D  VID3                   3      3
     D  VID3#                  1      3  0
     D  VID2                   2      2
     D  VID2#                  1      2  0
     D  VID1                   1      1
     D  VID1#                  1      1  0
      *
     d i0901ds         ds           500
     d xxco                                like(gmco)
     d xxaid                               like(gmaid)
     d xxmcu                               like(gmmcu)
     d xxobj                               like(gmobj)
     d xxsub                               like(gmsub)
     d xxans                               like(gmans)
     d xxdl01                              like(gmdl01)
     d xxlda                               like(gmlda)
     d xxbpc                               like(gmbpc)
     d xxpec                               like(gmpec)
     d xxbill                              like(gmbill)
     d xxcrcd                              like(gmcrcd)
     d xxum                                like(gmum)
     d xxr001                              like(gmr001)
     d xxr002                              like(gmr002)
     d xxr003                              like(gmr003)
     d xxr004                              like(gmr004)
     d xxr005                              like(gmr005)
     d xxr006                              like(gmr006)
     d xxr007                              like(gmr007)
     d xxr008                              like(gmr008)
     d xxr009                              like(gmr009)
     d xxr010                              like(gmr010)
     d xxr011                              like(gmr011)
     d xxr012                              like(gmr012)
     d xxr013                              like(gmr013)
     d xxr014                              like(gmr014)
     d xxr015                              like(gmr015)
     d xxr016                              like(gmr016)
     d xxr017                              like(gmr017)
     d xxr018                              like(gmr018)
     d xxr019                              like(gmr019)
     d xxr020                              like(gmr020)
     d xxr021                              like(gmr021)
     d xxr022                              like(gmr022)
     d xxr023                              like(gmr023)
     d xxobja                              like(gmobja)
     d xxsuba                              like(gmsuba)
     d xxwcmp                              like(gmwcmp)
     d xxcct                               like(gmcct)
     d xxerc                               like(gmerc)
     d xxhtc                               like(gmhtc)
     d xxqlda                              like(gmqlda)
     d xxccc                               like(gmccc)
     d xxfmod                              like(gmfmod)
     d xxuser                              like(gmuser)
     d xxpid                               like(gmpid)
     d xxjobn                              like(gmjobn)
     d xxupmj                              like(gmupmj)
     d xxupmt                              like(gmupmt)
      *
     D                SDS
     D  PGMSGQ           *PROC
     D  PGMID                  1     10
     D  WRKSTN               244    253
     D  USRNAM               254    263
     D  JOB#                 264    269  0
      *
      *   INTIALIZE FIELDS THAT ARE DEFAULTED TO A PARTICULAR VALUE
      *
     D ACO             C                   CONST('390')
     D GLAM            C                   CONST('2')
     D PAYROL          C                   CONST('Payroll   ')
     D BILDET          C                   CONST('BillDet  ')
     D RPAM            C                   CONST('2')
     D WKUSER          C                   CONST('TRSSI     ')
      *
     C/EJECT
      *----------------------------------------------------------------
      * MAIN PROCESSING LOOP
      *----------------------------------------------------------------
      *
     C                   READ      STC001L2                               50
B1   C     *IN50         DOUEQ     *ON
      *
     C                   MOVE      *ON           *IN52                          PROCESS
B2   C     *IN50         IFEQ      *OFF
      *
      *DO NOT PROCESS RECORDS WITH ZEROS AMOUNTS.
     C     DBTAMT        ANDEQ     *ZEROS
     C     CRAMT         ANDEQ     *ZEROS
     C                   MOVE      *OFF          *IN52                          DON'T PROCESS
     C                   ENDIF
      *PROCESS
B2   C     *IN52         IFEQ      *ON
      *
B3   C     *IN53         IFEQ      *OFF
     C                   MOVE      *ON           *IN53
     C                   ENDIF
      *
      * ONLY PROCESS RECORDS READY TO BE CREATED IN JDE
      *
     C                   Z-ADD     0             GLJELN                         JE LINE CNT
      *
      *      RETRIEVE VENDOR NAME
      *
     C                   EXSR      $VID
B3   C     JDEVIN        IFNE      *ZEROS                                       40 = OFF
     C     JDEVIN        CHAIN     F0101LA                            40
B4   C     *IN40         IFEQ      *OFF                                         40 = OFF
     C                   MOVEL     ABALPH        WKALPH           40            NAME
     C                   MOVE      ABMCU         WKRPMC           12            BUSINESS UNT
X4   C                   ELSE                                                   40 = ON
     C                   MOVE      *BLANKS       WKALPH                         NAME
     C                   MOVE      *BLANKS       WKRPMC                         BUSINESS UNT
E4   C                   ENDIF                                                  40 = OFF
E3   C                   ENDIF
      *
      *   RETRIEVE JULIAN DATE FOR INPUT DATE BY USING JDE'S ROUTINE...
      *
     C                   TIME                    $TIME            12 0
     C                   MOVE      $TIME         $DATE             6 0
     C                   MOVE      INMD          INPMD
     C                   MOVE      INYY          INPYY
     C                   MOVE      INPDT         #SIDAT            6
     C                   MOVE      *BLANK        #EDAT             8
     C                   MOVEL     '*YMD   '     #FFMT             7
     C                   MOVEL     '*JUL   '     #TFMT             7
     C                   MOVEL     '*NONE'       #SEP              7
     C                   MOVE      *BLANK        $ERTST            1
     C                   CALL      'X0028   '
     C                   PARM                    #SIDAT
     C                   PARM                    #EDAT
     C                   PARM                    #FFMT
     C                   PARM                    #TFMT
     C                   PARM                    #SEP
     C                   PARM                    $ERTST
     C                   PARM      *BLANKS       $CTRY
     C                   MOVE      #SIDAT        SVGLDT            6            INPUT DATE
      *
      *   RETRIEVE JULIAN DATE FOR TRANS DATE BY USING JDE'S ROUTINE...
      *
     C                   TIME                    $TIME
     C                   MOVE      $TIME         $DATE
     C                   MOVE      TRMD          TRANMD
     C                   MOVE      TRYY          TRANYY
     C                   MOVE      TRANDT        #SIDAT
     C                   MOVE      *BLANK        #EDAT
     C                   MOVEL     '*YMD   '     #FFMT
     C                   MOVEL     '*JUL   '     #TFMT
     C                   MOVEL     '*NONE'       #SEP
     C                   MOVE      *BLANK        $ERTST
     C                   CALL      'X0028   '
     C                   PARM                    #SIDAT
     C                   PARM                    #EDAT
     C                   PARM                    #FFMT
     C                   PARM                    #TFMT
     C                   PARM                    #SEP
     C                   PARM                    $ERTST
     C                   PARM      *BLANKS       $CTRY
     C                   MOVE      #SIDAT        SVTRDT            6            TRANS DATE
      *  CONVERT G/L DATE FROM YYMMDD TO MMDDYY
      *
     C                   Z-ADD     INPDT         GLDATE
     C                   Z-ADD     GLYR          YRGL
     C                   Z-ADD     GLMO          MOGL
     C                   Z-ADD     GLDA          DAGL
      *
      *      CALCULATE PERIOD & FISCAL YEAR FROM G/L DATE
      *
     C                   CALL      'X09031'
     C                   PARM      '1'           #CALC             1
     C                   PARM      WKCO          #CO               5
     C                   PARM      GLMDY         #DG               6 0
     C                   PARM                    #PN               2 0
     C                   PARM                    #FY               2 0
     C                   PARM                    #CTRY             2 0
     C                   PARM                    #EDT              1
     C                   PARM                    #DGSY             1
      *
     C                   Z-ADD     #PN           WKPN              2 0
     C                   Z-ADD     #FY           WKFY              2 0
     C                   Z-ADD     #CTRY         WKCEN             2 0
      *
      * SETUP DOCUMENT NUMBER/TYPE AND BATCH NUMBER/
      *
      * CALL PGM TO GENERATE NEXT AVAILABLE DOCUMENT # FROM JDE
      *
     C                   CALL      'X0010'
     C                   PARM      '04  '        PSSY
     C                   PARM      '01'          PSIDX
     C                   PARM                    PSNBR
      *
     C                   Z-ADD     PSNBR         SVDOC             8 0
      *
      *----------------------------------------------------------------
      *   CHECK DETAIL............
      *----------------------------------------------------------------
      *
     C                   Z-ADD     DBTAMT        WKAMT            15 2
     C     WKAMT         SUB       CRAMT         WKAMT
      *
      *   WRITE RECORD TO G/L FILE
      *
B3   C     WKAMT         IFNE      *ZEROS
     C                   EXSR      $911
E3   C                   ENDIF
      *
     C                   EXSR      $411
      *
E2   C                   ENDIF
      *
     C                   READ      STC001L2                               50
      *
E1   C                   ENDDO                                                  DETAIL
      *
     C/EJECT
      *----------------------------------------------------------------
      * EOF PROCESSING:
      *----------------------------------------------------------------
      *
      *   WRITE BATCH RECORD IF BATCH NUMBER GENERATED
      *
     C                   MOVE      PVICUT        WKICUT
     C                   MOVE      PVICU         WKICU
      *
      *  CREATE BATCH HEADER RECORD
      *
B1   C     *IN53         IFEQ      *ON
     C     KEY11         CHAIN     I0011                              51
B2   C     *IN51         IFEQ      *ON                                          51 = ON
     C                   MOVE      PVICU         ICICU
     C                   MOVEL     ' '           ICIST
     C                   MOVE      PVAMT         ICAICU
     C                   MOVE      PVCNT         ICNDO
     C                   MOVE      PVAMT         ICAME
     C                   MOVE      PVCNT         ICDOCN
     C                   MOVE      PVICUT        ICICUT
     C                   MOVE      'A'           ICIAPP
     C                   MOVE      'Y'           ICBAL
     C                   MOVE      ' '           ICBALJ
     C                   MOVE      'N'           ICPOB
     C                   MOVE      'Y'           ICIBOI
      *
     C                   WRITE     I0011
E2   C                   ENDIF                                                  51 = ON
E1   C                   ENDIF                                                  53 = ON
      *
      *
      * THIS WILL CLOSE ANY FILES THAT ARE LEFT OPEN FROM ANY CALLED
      * PROGRAMS WITHIN THIS PROGRAM.
      *
     C                   CALL      'UTRCRSC'
      *
     C                   MOVE      *ON           *INLR
      *
      /EJECT
      **************************************************************
      *   CONVERT ALPHA VENDOR NUMBER TO NUMERIC VENDOR NUMBER
      **************************************************************
     C     $VID          BEGSR
      *
     C     VID1          IFEQ      *BLANK
     C                   Z-ADD     *ZEROS        JDEVIN            8 0
     C                   ELSE
     C     VID2          IFEQ      *BLANK
     C                   Z-ADD     VID1#         JDEVIN
     C                   ELSE
     C     VID3          IFEQ      *BLANK
     C                   Z-ADD     VID2#         JDEVIN
     C                   ELSE
     C     VID4          IFEQ      *BLANK
     C                   Z-ADD     VID3#         JDEVIN
     C                   ELSE
     C     VID5          IFEQ      *BLANK
     C                   Z-ADD     VID4#         JDEVIN
     C                   ELSE
     C     VID6          IFEQ      *BLANK
     C                   Z-ADD     VID5#         JDEVIN
     C                   ELSE
     C     VID7          IFEQ      *BLANK
     C                   Z-ADD     VID6#         JDEVIN
     C                   ELSE
     C     VID8          IFEQ      *BLANK
     C                   Z-ADD     VID7#         JDEVIN
     C                   ELSE
     C                   Z-ADD     VID8#         JDEVIN
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *
     C                   ENDSR
      **************************************************************
      *   RIGHT JUSTIFY AND ZERO FILL VENDOR NUMBER IN THE SUBLEDGER
      *   FIELD.
      **************************************************************
     C     $VSBL         BEGSR
      *
     C                   Z-ADD     0             X                 1 0
     C                   Z-ADD     8             Y                 1 0
     C                   Z-ADD     8             Z                 1 0
     C                   MOVE      *BLANKS       JARB
     C                   MOVEA     JDEVID        VIDAR
      *RIGHT JUSTIFY THE VENDOR NUMBER
     C                   DO        8             X
     C     VIDAR(Z)      IFNE      *BLANKS
     C                   MOVE      VIDAR(Z)      JARB(Y)
     C                   SUB       1             Y
     C                   ENDIF
     C                   SUB       1             Z
     C                   ENDDO
      *
      *ZERO FILL THE BLANKS AFTER RIGHT JUSTIFING
     C                   Z-ADD     0             X
     C                   Z-ADD     1             Y
     C                   DO        8             X
     C     JARB(Y)       IFEQ      *BLANKS
     C                   MOVE      *ZERO         JARB(Y)
     C                   ADD       1             Y
     C                   ELSE
     C                   ADD       1             Y
     C                   ENDIF
     C                   ENDDO
      *
     C                   ENDSR
      *
      /EJECT
      **************************************************************
      *   Format the GLACCT number to Object and Subledger.
      **************************************************************
     C     $GLACT        BEGSR
     C*
     C                   MOVE      *BLANKS       wkacct
     C                   MOVEL     GLACCT        wkacct
     C*
      * Call pgm to parse out account number that was passed in.
     C*
     C                   CALL      'X0901'
     C                   PARM                    xxsym
     C                   PARM      '9'           xxomod
     C                   PARM      '2'           xximod
     C                   PARM      WKACCT        xxani
     C     wkmcu         PARM                    xxmcu
     C     wkobj         PARM                    xxobj
     C     wksub         PARM                    xxsub
     C                   PARM                    xxerrm
     C                   PARM                    i0901ds
     C*
     C                   if        xxerrm = *blanks
     C                   MOVEL     wkmcu         glmcu
     C                   MOVEL     wkobj         globj
     C                   MOVEL     wksub         glsub
     C                   MOVEL     wkacct        GLANI
     C                   ELSE
     C                   MOVEL     *blanks       glmcu
     C                   MOVEL     *blanks       globj
     C                   MOVEL     *blanks       glsub
     C                   MOVE      *BLANKS       GLANI
     C                   ENDIF
      *
      *GET THE ACCOUNT ID
      *
     C     F09KEY        CHAIN     I0901LB                            40
B3   C     *IN40         IFEQ      *OFF                                         40 = OFF
     C                   MOVE      GMAID         GLAID
X3   C                   ELSE
     C                   MOVE      *BLANKS       GLAID
E3   C                   ENDIF                                                  40 = OFF
      *
     C                   ENDSR
      *
      /EJECT
      **************************************************************
      *   WRITE VOUCHER ENTRY RECORD TO JD EDWARDS
      **************************************************************
     C     $411          BEGSR
      *GET PAYMENT INSTRUMENT
     C     JDEVIN        CHAIN     I0401                              40
B1   C     *IN40         IFEQ      *OFF                                         40 = OFF
     C                   MOVE      A6PYIN        RPPYIN                         PYMNT INSTRUMNT
E1   C                   ELSE                                                   NOT FOUND
     C                   MOVE      *BLANKS       RPPYIN                         PYMNT INSTRUMNT
E1   C                   ENDIF                                                  40 = OFF
      *
      * Move in the security cost center retrieved from the vendor master.
      *
B1   C     WKRPMC        IFEQ      *BLANKS
     C                   MOVE      *BLANKS       RPMCU
X1   C                   ELSE
     C                   MOVE      WKRPMC        RPMCU
E1   C                   ENDIF
      *
     C                   Z-ADD     SVDOC         RPDOC                          DOCUMENT #
     C                   MOVE      '  '          RPDCT                          DOC TYPE
B1   C     CRAMT         IFNE      *ZEROS
     C                   MOVE      'PD'          RPDCT                          DOC TYPE
X1   C                   ELSE
B1   C     DBTAMT        IFNE      *ZEROS
     C                   MOVE      'PV'          RPDCT                          DOC TYPE
X1   C                   ENDIF
E1   C                   ENDIF
     C                   MOVE      '001'         RPSFX                          PAY ITEM
     C                   MOVE      '001'         RPSFXO                         ORDER SUFFIX
     C                   MOVE      *ZEROS        RPSFXE                         PAY ITM EXT#
     C                   MOVE      *BLANKS       RPDCTA                         ADJ.DOC TYPE
     C                   Z-ADD     JDEVIN        RPAN8                          VENDOR #
     C                   Z-ADD     JDEVIN        RPPYE                          PAYEE ADR #
     C                   MOVE      *ZEROS        RPSNTO                         APROVER#
     C                   MOVE      SVGLDT        RPDIVJ                         INVOICE DATE
     C                   MOVE      SVGLDT        RPDSVJ                         SERV/TAX DATE
     C                   MOVE      SVTRDT        RPDDJ                          DUE DATE
     C                   MOVE      *ZEROS        RPDDNJ                         DISCOUNT DUE DATE
     C                   MOVE      SVGLDT        RPDGJ                          G/L DATE
     C                   Z-ADD     WKFY          RPFY                           FISCAL YR
     C                   Z-ADD     WKCEN         RPCTRY                         CENTURY
     C                   Z-ADD     WKPN          RPPN                           PERIOD #
     C                   MOVE      PVICU         RPICU                          BATCH #
     C                   MOVE      PVICUT        RPICUT                         BATCH TYPE
     C                   MOVE      *BLANKS       RPBALJ                         BAL. J.E'S
     C                   MOVE      'A'           RPPST                          PAY STATUS
      *
     C                   Z-ADD     DBTAMT        WAMT2
     C     WAMT2         SUB       CRAMT         WAMT2
      *
     C                   Z-ADD     WAMT2D        RPAG                           GROSS AMT
     C                   Z-ADD     WAMT2D        RPAAP                          OPEN AMT
     C                   MOVE      *ZEROS        RPADSC                         DISCOUNT AVAILABLE
     C                   MOVE      *ZEROS        RPADSA                         DISCOUNT TAKEN
     C                   MOVE      *ZEROS        RPATXA                         TAXABLE AMT
     C                   MOVE      *ZEROS        RPATXN                         NON-TAXABLE AMT
     C                   MOVE      *ZEROS        RPSTAM                         TAX
     C                   MOVE      *BLANKS       RPTXA1                         TAX RATE/AREA
     C                   MOVE      *BLANKS       RPEXR1                         TAX EMPL/CODE
     C                   MOVE      *BLANKS       RPCRRM                         MODE (F)
     C                   MOVE      *BLANKS       RPCRCD                         CURRENCY CODE
     C                   MOVE      *ZEROS        RPCRR                          EXCHG RATE
     C                   MOVE      *ZEROS        RPACR                          CURRENCY AMT
     C                   MOVE      *ZEROS        RPFAP                          FOREIGN OPEN AMT
     C                   MOVE      *ZEROS        RPCDS                          FOREIGN DISCOUNT AVA
     C                   MOVE      *ZEROS        RPCDSA                         FOREIGN DISCOUNT TAK
     C                   MOVE      *ZEROS        RPCTXA                         FOREIGN TAXABLE AMT
     C                   MOVE      *ZEROS        RPCTXN                         FOREIGN NON-TAX AMT
     C                   MOVE      *ZEROS        RPCTAM                         FOREIGN TAX AMT
     C                   MOVE      *BLANKS       RPGLC                          G/L OFFSET
     C                   MOVE      *BLANKS       RPGLBA                         G/L BANK ACC
      *
      *  Retrieve the GL Class to use in retrieving the bank account id.
      *
     C     JDEVIN        CHAIN     I0401                              40
B1   C     *IN40         IFEQ      *OFF                                         40 = OFF
     C                   MOVE      A6APC         RPGLC                          G/L OFFSET
     C                   MOVE      'PB    '      F12KY1            6
     C                   MOVE      A6APC         F12KY1
     C                   MOVE      '00390'       F12KY2            5
      *
      * Get the cost center/object/sub from the automatic accounting instructions file.
      *
     C     F12KEY        CHAIN     I0012                              40
B2   C     *IN40         IFEQ      *OFF                                         40 = OFF
      *
      * Now get the account id for the bank account.
      *
     C     F09KY2        CHAIN     I0901LB                            40
B3   C     *IN40         IFEQ      *OFF                                         40 = OFF
     C                   MOVE      GMAID         RPGLBA
E3   C                   ENDIF                                                  40 = OFF
E2   C                   ENDIF                                                  40 = OFF
E1   C                   ENDIF                                                  40 = OFF
      *
     C                   MOVE      *BLANKS       RPPOST                         G/L POSTED
     C                   MOVE      *BLANKS       RPAID2                         G/L CR ACCT
     C                   MOVE      *BLANKS       RPOBJ                          OBJECT
     C                   MOVE      *BLANKS       RPSUB                          SUBSIDIARY
     C                   MOVE      *BLANKS       RPSBLT                         SUBLEGER TYP
     C                   MOVE      *BLANKS       RPSBL                          SUBLEDGER
     C                   MOVE      *BLANKS       RPBAID                         BANK TRANS
     C                   MOVE      *BLANKS       RPPTC                          PAY TERMS
     C                   MOVE      *BLANKS       RPVOD                          VOID FLAG
     C                   MOVE      *BLANKS       RPOKCO                         ORIG ORD DOC
     C                   MOVE      *BLANKS       RPODCT                         ORIG DOC TYP
     C                   MOVE      *ZEROS        RPODOC                         ORIG DOC#   OUNT AVA
     C                   MOVE      *BLANKS       RPOSFX                         ORIG PAY ITM
     C                   MOVE      *BLANKS       RPCRC                          PAY HAND CDE
     C                   MOVE      *BLANKS       RPVINV                         INVOICE #
     C                   MOVEL     LOADID        RPVINV                         INVOICE #
     C                   MOVE      *BLANKS       RPPKCO                         PO DOC CDE
     C                   MOVE      *BLANKS       RPPO                           PO#
     C                   MOVE      *BLANKS       RPPDCT                         PO DOC TYPE
     C                   MOVE      *ZEROS        RPLNID                         LINE#
     C                   MOVE      *BLANKS       RPSFXO                         ORDER SFX
     C                   MOVE      *ZEROS        RPOPSQ                         OPERATONS#
     C                   MOVE      *BLANKS       RPVR01                         REFERENCE
     C                   MOVE      *BLANKS       RPUNIT                         UNIT NO
     C                   MOVE      *BLANKS       RPMCU2                         BUSINESS U
      *
      *IF THIS TRANSACTION IS BILL DETAIL, MOVE THE EXTREF TO THE REMRK
      *FIELD SO THAT IT PRINTS ON THE CHECK. THE EXTREF FIELD IS THE
      *INVOICE NUMBER AND NEEDS TO PRINT ON THE CHECK.
      *
     C     TRNTYP        IFEQ      BILDET
     C                   MOVEL     EXTREF        RPRMK
     C                   ELSE
     C                   MOVE      *BLANKS       RPRMK                          REMARK
     C                   ENDIF
      *
     C                   MOVE      *BLANKS       RPRF                           RECUR FREQ
     C                   MOVE      *ZEROS        RPDRF                          # OF PMTS
     C                   MOVE      *BLANKS       RPCTL                          STMT #
     C                   MOVE      *BLANKS       RPFNLP                         CLOSED ITEM
     C                   MOVE      *ZEROS        RPU                            UNITS
     C                   MOVE      *BLANKS       RPUM                           UNIT OF MEAS
     C                   MOVE      *BLANKS       RPTXA3                         TAXAREA 3
     C                   MOVE      *BLANKS       RPEXR3                         TAXEXPL 3
     C                   MOVE      *BLANKS       RPRP1                          MISC CDE 1
     C                   MOVE      *BLANKS       RPRP2                          MISC CDE 2
     C                   MOVE      *BLANKS       RPRP3                          CASH RECPT
     C                   MOVE      *BLANKS       RPAC07                         1099 RPTING
     C                   MOVE      *BLANKS       RPTNN                          FLG FOR 1099
     C                   MOVE      *BLANKS       RPDMCD                         DOMESTIC ENT
     C                   MOVE      *ZEROS        RPITM                          ITEM# SHORT
     C                   MOVE      *ZEROS        RPHCRR                         HIST EXCHG
     C                   MOVE      *ZEROS        RPHDGJ                         HIST DATE
     C                   MOVE      *BLANKS       RPURC1                         USR RSRV CDE
     C                   MOVE      *ZEROS        RPURDT                         USR RSRV DTE
     C                   MOVE      *ZEROS        RPURAT                         USR RSRV AMT
     C                   MOVE      *ZEROS        RPURAB                         USR RSRV NBR
     C                   MOVE      *BLANKS       RPURRF                         USR RSRV REF
     C                   MOVEL     PGMID         RPPID
     C                   MOVEL     WRKSTN        RPJOBN                         JOB
     C                   ADD       1             PVCNT             5 0          BATCH COUNT
     C                   ADD       WAMT2         PVAMT            15 2          BATCH AMT
      *
      *   WRITE RECORD TO JDE A/P LEDGER (F0411)
      *
     C                   WRITE     I0411
      *
     C                   ENDSR
      /EJECT
      **************************************************************
      *   WRITE JOURNAL ENTRY RECORD TO JD EDWARDS SUBROUTINE
      **************************************************************
     C     $911          BEGSR
      *
     C                   MOVE      '  '          GLDCT                          DOC TYPE
      *
B1   C     CRAMT         IFNE      *ZEROS
     C                   MOVE      'PD'          GLDCT                          DOC TYPE
X1   C                   ELSE
B1   C     DBTAMT        IFNE      *ZEROS
     C                   MOVE      'PV'          GLDCT                          DOC TYPE
X1   C                   ENDIF
E1   C                   ENDIF
      *
     C                   Z-ADD     SVDOC         GLDOC                          DOCUMENT #
     C                   MOVE      SVGLDT        GLDGJ                          G/L DATE
     C                   ADD       1             GLJELN                         LINE NUMBER
     C                   MOVE      *BLANKS       GLEXTL                         LINE EXT CDE
     C                   MOVE      *BLANKS       GLPOST                         GL POSTEDCDE
     C                   Z-ADD     PVICU         GLICU                          BATCH #
     C                   MOVE      'V '          GLICUT                         BATCH TYPE
     C                   MOVE      '00390'       GLCO                           COMPANY
      *
      * Extract company number out of the 1st 3 digits of the cost center.
      *
     C                   move      *zeros        wk3co
     C     '.'           check     glacct        start
     C                   if        start > 0
     C                   if        start <= 12
     C                   eval      wk3co = %subst(glacct:start:3)
     C                   else
     C                   eval      wk3co = %subst(glacct:start)
     C                   endif
     C                   endif
     C                   move      *zeros        glco
     C                   move      wk3co         glco
      *
      * FORMAT ACCOUNT NUMBER
      *
     C                   EXSR      $GLACT
      *
     C                   MOVEL     'AA'          GLLT                           LEDGER TYPE
     C                   Z-ADD     WKPN          GLPN                           G/L PERIOD#
     C                   Z-ADD     WKCEN         GLCTRY                         CENTURY
     C                   Z-ADD     WKFY          GLFY                           FISCAL YEAR
     C                   MOVE      *BLANKS       GLFQ                           FISCAL QTR
     C                   MOVE      *BLANKS       GLCRCD                         CURRENCY CDE
     C                   MOVE      *BLANKS       GLCRR                          EXCHG RATE
     C                   MOVE      *BLANKS       GLHCRR                         HIST EXCHG R
     C                   MOVE      *BLANKS       GLHDGJ                         HIST EXCHG D
      *
     C                   Z-ADD     DBTAMD        GLAA                           DTL AMT
     C     GLAA          SUB       CRAMD         GLAA                           DTL AMT
      *
     C                   MOVE      *ZEROS        GLU                            UNITS
     C                   MOVE      *BLANKS       GLUM                           UNIT OF MEAS
     C                   MOVE      *BLANKS       GLGLC                          GL OFFSET
     C                   MOVE      *BLANKS       GLRE                           REVERSE OR V
     C                   MOVEL     WKALPH        GLEXA                          ALPHA NAME
     C                   MOVE      *BLANKS       GLEXR                          REMARK
     C                   MOVE      *BLANKS       GLR1                           JE VOUCHER
     C                   MOVE      *BLANKS       GLR2                           ADDRESS #
     C                   MOVE      *BLANKS       GLR3                           ADDRESS REC
     C                   MOVE      *BLANKS       GLSFX                          PAY ITEM
     C                   MOVE      *ZEROS        GLODOC                         ORIG.DOC#
     C                   MOVE      *BLANKS       GLODCT                         ORIG.DOCTYPE
     C                   MOVE      *BLANKS       GLOSFX                         ORIG.PAYITEM
     C                   MOVE      *BLANKS       GLPKCO                         PO DOC
     C                   MOVE      *BLANKS       GLOKCO                         ORIG.ORD DOC
     C                   MOVE      *BLANKS       GLPDCT                         PO DOC TYPE
     C                   MOVE      ABAN8         GLAN8                          VENDOR NUMBER
     C                   MOVE      *BLANKS       GLCN                           CHECK #
     C                   MOVE      *ZEROS        GLDKJ                          CHECK DATE
     C                   MOVE      *ZEROS        GLDKC                          CHL CLEARED
     C                   MOVE      *BLANKS       GLASID                         SERIAL#
     C                   MOVE      *BLANKS       GLBRE                          BATCH CDE
     C                   MOVE      *BLANKS       GLRCND                         RECONCILED?
     C                   MOVE      *BLANKS       GLSUMM                         SUMMARIZECDE
     C                   MOVE      *BLANKS       GLPRGE                         PURGE CODE
     C                   MOVE      *BLANKS       GLTNN                          FLAG 1099
     C                   MOVE      *BLANKS       GLALT1                         ALT GL POST1
     C                   MOVE      *BLANKS       GLALT2                         ALT GL POST2
     C                   MOVE      *BLANKS       GLALT3                         ALT GL POST3
     C                   MOVE      *BLANKS       GLALT4                         ALT GL POST4
     C                   MOVE      *BLANKS       GLALT5                         MULT. CURR.
     C                   MOVE      *BLANKS       GLALT6                         CASH BASIS
     C                   MOVE      *BLANKS       GLALT7                         COMM RELFLG
     C                   MOVE      *BLANKS       GLALT8                         BILLING CTL
     C                   MOVE      *BLANKS       GLALT9                         CURRENCY UPD
     C                   MOVE      *BLANKS       GLALT0                         LABOR COST
     C                   MOVE      *BLANKS       GLALTT                         FUTURE USE
     C                   MOVE      *BLANKS       GLALTV                         FUTURE USE
     C                   MOVE      *BLANKS       GLALTU                         FUTURE USE
     C                   MOVE      *BLANKS       GLALTW                         FUTURE USE
     C                   MOVE      *BLANKS       GLALTX                         CONS TX XREF
     C                   MOVE      *BLANKS       GLALTZ                         FUTURE USE
     C                   MOVE      *BLANKS       GLDLNA                         DLT NOT ALLO
     C***                MOVE      *BLANKS       GLCFF1                         FUTURE USE
     C                   move      'I'           glcff1                         p16169
     C                   MOVE      *BLANKS       GLCFF2                         FUTURE USE
     C                   MOVE      *BLANKS       GLASM                          LSE COST LED
     C                   MOVE      *BLANKS       GLBC                           BILL CODE
     C                   MOVE      *BLANKS       GLVINV                         INVOICE #
     C                   MOVEL     LOADID        GLVINV                         INVOICE #
     C                   Z-ADD     INPDT         GLIVD                          INVOICE DTE
     C                   MOVE      *BLANKS       GLWR01                         PHASE
     C                   MOVE      *BLANKS       GLPO                           PO NUMBER
     C                   MOVE      *BLANKS       GLPSFX                         PO SFX
     C                   MOVE      *BLANKS       GLDCTO                         ORDER TYPE
     C                   MOVE      *ZEROS        GLLNID                         LINE NUMBER
     C                   MOVE      *ZEROS        GLWY                           FISCAL YR WE
     C                   MOVE      *ZEROS        GLWN                           FISCAL PERIO
     C                   MOVE      *BLANKS       GLFNLP                         CLOSED ITEM
     C                   MOVE      *ZEROS        GLOPSQ                         OPER.SEQ#
     C                   MOVE      *BLANKS       GLJBCD                         JOB TYPE
     C                   MOVE      *BLANKS       GLJBST                         JOB STEP
     C                   MOVE      *BLANKS       GLHMCU                         HOME BUS.UNI
     C                   MOVE      *ZEROS        GLDOI                          DOI SUB
     C                   MOVE      *BLANKS       GLALID                         OUTSIDER
     C                   MOVE      *BLANKS       GLALTY                         ID TYPE
     C                   MOVE      *ZEROS        GLDSVJ                         SERVIC DATE
     C                   MOVE      *ZEROS        GLREG#                         REGIST. NBR
     C                   MOVE      *ZEROS        GLPYID                         PAYMENT ID
     C                   MOVEL     PGMID         GLPID                          PROGRAM ID
     C                   MOVEL     WRKSTN        GLJOBN                         JOB
     C                   MOVE      #SIDAT        GLUPMJ                         UPDATE DATE
     C                   TIME                    GLUPMT                         TIME UPDATED
      *
     C                   MOVE      *BLANKS       GLSBL                          SUBLEDGER
     C                   MOVE      *BLANKS       GLSBLT                         SUBLEDG TYPE
      *
      *IF PAYROLL PUT JDE VENDOR NUMBER IN THE SUBledger. HAS TO BE RIGHT
      *JUSTIFIED AND ZERO FILLED.
      *
B1   C     TRNTYP        IFEQ      PAYROL
      *
     C                   EXSR      $VSBL
     C                   MOVEA     JARB          GLSBL
     C                   MOVE      'A'           GLSBLT
      *
X1   C                   ELSE                                                   NOT PAYROLL
      *
B2   C     TRNTYP        IFEQ      BILDET
      *
      *IF BILDET PUT LOAD ID INTO SUBLEDGER, LEFT JUSTIFIED.
      *
     C                   MOVEL     LOADID        GLSBL
     C                   MOVE      'X'           GLSBLT
E2   C                   ENDIF                                                  TRNTYP = BILLDT
E1   C                   ENDIF                                                  Trntyp = payrol
      *
     C                   WRITE     I0911
      *
      *  UPDATE BALANCE FILE
      *
      *  IF THIS IS A ZERO AMOUNT CHECK, WRITE A REVERSAL ENTRY WITH A
      *  DIFFERENT DOCUMENT TYPE...
      *
     C                   Z-ADD     DBTAMT        WAMT2
     C     WAMT2         SUB       CRAMT         WAMT2
B1   C     WAMT2         IFEQ      0                                            NET = 0
     C                   MOVE      'PD'          GLDCT                          DOC TYPE
     C                   MOVE      'V'           GLRE                           REVERSAL/VOID
     C     WKAMT         MULT      -1            GLAA                           AMOUNT
     C                   ADD       1             GLJELN                         J/E LINE CNT
      *
      *   WRITE RECORD TO JDE G/L LEDGER (F0911)
      *
     C                   WRITE     I0911
     C                   MOVE      *BLANKS       GLEXR
      *
      *  UPDATE BALANCE FILE
      *
E1   C                   ENDIF                                                  NET = 0
      *
      *  ONLY ACCUMULATE DEBIT AMOUNTS FOR BATCH HEADER
      *
B1   C     GLAA          IFGT      0                                            GLAA > 0
     C                   ADD       GLAA          BATAMT           15 0
     C                   ADD       1             BATNDO            5 0
E1   C                   ENDIF                                                  GLAA > 0
      *
     C                   ENDSR
      /EJECT
      **************************************************************
     C     *INZSR        BEGSR                                                          *
      **************************************************************
      * Parm list
     C     *entry        plist
     C                   parm                    xxbatch
      *
      * KEY LISTS
      *
      * KEY USED FOR VOUCHER HEADER
      *
     C     KEYHD         KLIST                                                  PKBKCPL0
     C                   KFLD                    CO
     C                   KFLD                    BATCH
      *
      *
      * KEY USED FOR BATCH HEADER IN JDE
      *
     C     KEY11         KLIST                                                    F0011
     C                   KFLD                    WKICUT            2
     C                   KFLD                    WKICU             8 0
      *
      * KEY USED FOR BATCH HEADER IN JDE
      *
     C     F09KEY        KLIST                                                    F0901LB
     C                   KFLD                    GLMCU
     C                   KFLD                    GLOBJ
     C                   KFLD                    GLSUB
      *
     C     F09KY2        KLIST                                                    F0901LB
     C                   KFLD                    KGMCU
     C                   KFLD                    KGOBJ
     C                   KFLD                    KGSUB
      *
     C     F12KEY        KLIST                                                    F0012
     C                   KFLD                    F12KY1                           ITEM#
     C                   KFLD                    F12KY2                           COMPANY
      *
      *   RETRIEVE JULIAN DATE FOR UDATE BY USING JDE'S ROUTINE...
      *
     C                   MOVEL     'PB    '      PB                6
     C                   TIME                    $TIME            12 0
     C                   MOVE      $TIME         $DATE             6 0
     C                   MOVE      $DATE         #SIDAT            6
     C                   MOVE      *BLANK        #EDAT             8
     C                   MOVEL     '*SYSVAL'     #FFMT             7
     C                   MOVEL     '*JUL   '     #TFMT             7
     C                   MOVEL     '*NONE'       #SEP              7
     C                   MOVE      *BLANK        $ERTST            1
     C                   CALL      'X0028   '
     C                   PARM                    #SIDAT
     C                   PARM                    #EDAT
     C                   PARM                    #FFMT
     C                   PARM                    #TFMT
     C                   PARM                    #SEP
     C                   PARM                    $ERTST
     C                   PARM      *BLANKS       $CTRY             2
     C                   MOVE      #SIDAT        GLUPMJ                         UPDATE DATE
     C                   MOVE      #SIDAT        RPUPMJ                         UPDATE DATE
     C                   MOVE      #SIDAT        GLDSYJ                         SYSTEM DATE
     C                   MOVE      #SIDAT        GLDICJ                         BATCH DATE
     C                   MOVE      #SIDAT        icdicj                         BATCH DATE
      *
     C                   TIME                    GLTICU                         TIME
     C                   TIME                    GLUPMT                         TIME UPDATED
     C                   TIME                    RPUPMT                         TIME UPDATED
     C                   MOVEL     WKUSER        ICUSER                         UPDATE USER F0011
     C                   MOVEL     WKUSER        GLUSER                         UPDATE USER F0911
     C                   MOVEL     WKUSER        RPUSER                         UPDATE USER F0411
     C                   MOVEL     WKUSER        RPTORG                         TRANS ORIGINATOR 411
     C                   MOVEL     WKUSER        GLTORG                         TRANS ORIGINATOR 911
      *
     C                   MOVE      ACO           CO                3 0
     C                   MOVE      *ZEROS        BATCH             5 0
     C                   MOVE      *ZEROS        WKCO              5
     C                   MOVE      *ZEROS        PVAMT
     C                   MOVE      ACO           WKCO
     C                   MOVE      '00390'       RPCO
     C                   MOVE      '00390'       RPKCO
     C                   MOVE      '00390'       GLKCO
     C                   MOVEL     'AA'          GLLT
      *
     C                   MOVEL     WRKSTN        GLJOBN                         JOB
     C                   MOVEL     WRKSTN        RPJOBN                         JOB
      *
      *
      * CALL PGM TO GENERATE NEXT AVAILABLE BATCH # FROM JDE FOR VOUCHER
      *
     C                   CALL      'X0010'
     C                   PARM      '00  '        PSSY              4
     C                   PARM      '01'          PSIDX             2
     C                   PARM                    PSNBR             8 0
     C                   Z-ADD     PSNBR         PVICU             8 0          BATCH NUM
     C                   MOVEL     'V'           PVICUT            2            BATCH TYPE
      *
     C                   move      PSNBR         xxbatch                        BATCH NUM
     C                   MOVE      *ON           *IN92
     C                   MOVE      *OFF          *IN53
     C                   ENDSR
