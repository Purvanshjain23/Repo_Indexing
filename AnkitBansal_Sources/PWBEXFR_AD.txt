// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWBEXFR
// ?Date: 14.08.2025 Time: 02:55:53
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//? 3/31/2017 JBB E9815 - Add Company Number to Producer Files
//?                       Function created.  Part of this project
//?                       is to add a company number field to the
//?                       Producer History WKLY file.  This program
//?                       uses the library suffix to determine the
//?                       number to populate into the field.
ENDDO;

//?If incoming library is entered, continue processing
CASE;

// IF PAR.Library is Entered
IF PAR.Library <> *BLANK;

// LCL.Count USR = CND.One
LCL.Count_USR = 1;

//?Determine library suffix
// DOW LCL.Count USR is LE 10
DOW LCL.Count_USR <= 10;

// LCL.Text 1                USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.1)
LCL.Text_1_USR = SUBSTRING(PAR.Library:LCL.Count_USR:1);

//?If character is blank, get last library suffix
CASE;

// IF LCL.Text 1                USR is Blank
IF LCL.Text_1_USR = *BLANK;

// LCL.Count USR = LCL.Count USR - CON.3
LCL.Count_USR = LCL.Count_USR - 3;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

//?If character is blank, get last library suffix
// IF LCL.Count USR is Ten
IF LCL.Count_USR = 10;

// LCL.Count USR = LCL.Count USR - CON.2
LCL.Count_USR = LCL.Count_USR - 2;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

ENDIF;

// LCL.Count USR = LCL.Count USR + CON.1
LCL.Count_USR = LCL.Count_USR + 1;

ENDDO;

//?Load company number based upon library suffix
CASE;

// IF LCL.Text 3 USR is Guymon
IF LCL.Text_3_USR = 'GUP';

// LCL.PH Company Number = CND.SBD Farms of Guymon, Ok
LCL.PH_Company_Number = 360;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods
IF LCL.Text_3_USR = 'TFP';

// LCL.PH Company Number = CND.Triumph Foods Market
LCL.PH_Company_Number = 960;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Seaboard Triumph Foods
IF LCL.Text_3_USR = 'STP';

// LCL.PH Company Number = CND.Sioux City
LCL.PH_Company_Number = 440;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods-2
IF LCL.Text_3_USR = 'T2P';

// LCL.PH Company Number = CND.Triumph Foods-2
LCL.PH_Company_Number = 961;

//?Load company number based upon library suffix
// IF *OTHERWISE
IF *OTHERWISE;

PGM.*Return_code = 'ERROR';

RETURN;

ENDIF;

//?Read all Producer History WKLY records and update Company Number
EXECUTE FUNCTION(Fix Add Co# to PH WKLY RT) TYPE(RTVOBJ) FILE(PKCGCPP)          AB1332140;
PARAMETER(LCL.PH_Company_Number);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.PH Company Number is *ZERO
 IF DB1.PH_Company_Number = *ZERO;

 //?First, create a new record with the Company Number
 EXECUTE FUNCTION(Fix Add Co# to PH WKLY CR) TYPE(CRTOBJ) FILE(PKCGCPP)          AB1332213;
 PARAMETER(PAR.PH_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PH_Summary_Type);
 PARAMETER(DB1.PH_Week_Ending_Date);
 PARAMETER(DB1.PH_ALL_DOA);
 PARAMETER(DB1.PH_ALL_Head_Received);
 PARAMETER(DB1.PH_ALL_Yard_Deads);
 PARAMETER(DB1.PH_ALL_Head_Condemned);
 PARAMETER(DB1.PH_ALL_Head_Killed);
 PARAMETER(DB1.PH_ALL_Live_Weight);
 PARAMETER(DB1.PH_ALL_Avg_Live_Wgt);
 PARAMETER(DB1.PH_ALL_Hot_Weight);
 PARAMETER(DB1.PH_ALL_Avg_Hot_Wgt);
 PARAMETER(DB1.PH_ALL_Actual_Yield);
 PARAMETER(DB1.PH_ALL_Adj_Live_Weight);
 PARAMETER(DB1.PH_ALL_Adjusted_Yield);
 PARAMETER(DB1.PH_ALL_Avg_Lean);
 PARAMETER(DB1.PH_ALL_Avg_Backfat);
 PARAMETER(DB1.PH_ALL_Avg_Loin_Eye);
 PARAMETER(DB1.PH_ALL_Avg_Light_Ref);
 PARAMETER(DB1.PH_ALL_Base_Live_CWT);
 PARAMETER(DB1.PH_ALL_Base_Carc_CWT);
 PARAMETER(DB1.PH_ALL_Sort_Dsc_Live_CWT);
 PARAMETER(DB1.PH_ALL_Sort_Dsc_Carc_CWT);
 PARAMETER(DB1.PH_ALL_Lean_Prm_Live_CWT);
 PARAMETER(DB1.PH_ALL_Lean_Prm_Carc_CWT);
 PARAMETER(DB1.PH_ALL_Gross_Live_CWT);
 PARAMETER(DB1.PH_ALL_Gross_Carc_CWT);
 PARAMETER(DB1.PH_ALL_Avg_Srt_Disc_Fctr);
 PARAMETER(DB1.PH_GA_DOA);
 PARAMETER(DB1.PH_GA_Head_Received);
 PARAMETER(DB1.PH_GA_Yard_Deads);
 PARAMETER(DB1.PH_GA_Head_Condemned);
 PARAMETER(DB1.PH_GA_Head_Killed);
 PARAMETER(DB1.PH_GA_Live_Weight);
 PARAMETER(DB1.PH_GA_Avg_Live_Wgt);
 PARAMETER(DB1.PH_GA_Hot_Weight);
 PARAMETER(DB1.PH_GA_Avg_Hot_Wgt);
 PARAMETER(DB1.PH_GA_Actual_Yield);
 PARAMETER(DB1.PH_GA_Adj_Live_Weight);
 PARAMETER(DB1.PH_GA_Adjusted_Yield);
 PARAMETER(DB1.PH_GA_Avg_Lean);
 PARAMETER(DB1.PH_GA_Avg_Backfat);
 PARAMETER(DB1.PH_GA_Avg_Loin_Eye);
 PARAMETER(DB1.PH_GA_Avg_Light_Ref);
 PARAMETER(DB1.PH_GA_Base_Live_CWT);
 PARAMETER(DB1.PH_GA_Base_Carc_CWT);
 PARAMETER(DB1.PH_GA_Sort_Dsc_Live_CWT);
 PARAMETER(DB1.PH_GA_Sort_Dsc_Carc_CWT);
 PARAMETER(DB1.PH_GA_Lean_Prm_Live_CWT);
 PARAMETER(DB1.PH_GA_Lean_Prm_Carc_CWT);
 PARAMETER(DB1.PH_GA_Gross_Live_CWT);
 PARAMETER(DB1.PH_GA_Gross_Carc_CWT);
 PARAMETER(DB1.PH_GA_Avg_Srt_Disc_Fctr);
 //?Then delete existing record that does not have a Company Number
 EXECUTE FUNCTION(Dlt Producer History WKLY) TYPE(DLTOBJ) FILE(PKCGCPP)          AB1332142;
 PARAMETER(DB1.PH_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PH_Summary_Type);
 PARAMETER(DB1.PH_Week_Ending_Date);
 ENDIF;

}


ENDIF;

