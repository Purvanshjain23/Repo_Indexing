      *****************  RPG PROGRAM HEADING  ************************
      *
      * SYSTEM:      Hog Production System
      * PROGRAM:     Safedata: Write BGF Daily Production Receiving File
      *                        to Editing File
      * PROGRAMMER:  LeAnne Fedor
      * CREATED:     01/15/02
      *
      *        !!!!! NO WEB DATA IS PROCESSED IN THIS PROGRAM !!!!!!!
      *
      *              This program reads records from the Receiving file and writes
      *              them to the Editing file. Thus, this program is only processing
      *              Safedata data...not WEB data.
      *
      *
      ****************************************************************
      * MODIFICATIONS:
      ****************************************************************
      * DATE      PROGRAMMER
      *
      * 10/22/03  LeAnne Fedor
      *           Increased record length from 192 to 217 characters to accommodate 5 new
      *           fields (which were added at the end of the record prior to SDI reference
      *           number):
      *               gilt total stillborns
      *               gilt total mummies
      *               17+ day weaned sows
      *               euthanized gilts
      *               euthanized sows
      *
      * 02/03/05  LeAnne Fedor
      *           Increased record length from 217 to 222 characters to accommodate 1 new
      *           field (which was added at the end of the record prior to SDI reference
      *           number):
      *                transferred in open gilts
      *
      * 08/23/05  LeAnne Fedor
      *           Increased record length from 222 to 229 characters to accommodate 1 new
      *           field (which was added at the end of the record prior to SDI reference
      *           number):
      *                man hours
      *
      * 08/04/08  LeAnne Ramsey
      *           Decreased record length from 229 to 214. The following fields were deleted:
      *             XXOOGLHD-Gilts transferred out--open  (position 152)
      *             XX17WNLT-17-Day weaned sows           (position 197)
      *             XXIOGLHD-Transferred in open gilts    (position 212)
      *
      *  2/25/20  Brad Baden   E15763
      *           Use System Date instead of UDATE to calculate the Week Ending Date
      *           and Create Date.
      *
      /eject
      ****************************************************************
      * FILE SPECIFICATIONS
      ****************************************************************
      *
     Fhsp265    if   e           k disk
      *  Safedata: BGF daily production receiving file
      *
      *
     Fhsp266    o    e           k disk
      *  Safedata/WEB: BGF daily production editing file
      *
      /eject
      ****************************************************************
      * DEFINITION SPECIFICATIONS
      ****************************************************************
      *
      ****************************************************************
      * CONSTANTS
      ****************************************************************
      *
     D yes             c                   'Y'
     D no              c                   'N'
      *
      *
      ****************************************************************
      * ARRAYS AND TABLES
      ****************************************************************
      *
      *
      ****************************************************************
      * STANDALONE FIELDS
      ****************************************************************
      *
      * System Date
     d sysdate         s               d   inz(*sys)
      *
      * Workfields
      *
     D wknum30         s              3  0
     D wknum70         s              7  0
      *
      *
      * Workfields for date manipulation
      *
     D wkmdy           s              8  0
     D wkcymdiso       s               D   datfmt(*iso)
     D wkcrdt          s                   like(bdcrdt)
     D wkcrtm          s                   like(bdcrtm)
      *
      ****************************************************************
      * DATA STRUCTURES
      ****************************************************************
      *
      *---------------------------------------------------------------
      * Standard program status data structure
      *---------------------------------------------------------------
      *    externally defined as UTPGFR (record format: PGMDSR)
     D pgmds         esds                  extname(utpgfr)
      *
      *
      *---------------------------------------------------------------
      * Break out single-field input record into individual fields
      *---------------------------------------------------------------
      *
     D inputrec        ds
     D   allfields                  214
      *
     D   xxfscd                       5    overlay(allfields:1)
     D   xxdt                         8    overlay(allfields:6)
      *
     D   xxwnsv                       5    overlay(allfields:14)
     D   xxlwnsv                      5    overlay(allfields:19)
     D   xxrtsv                       5    overlay(allfields:24)
     D   xxglsv                       5    overlay(allfields:29)
      *
     D   xxopglhd                     5    overlay(allfields:34)
     D   xxopsohd                     5    overlay(allfields:39)
     D   xxglabhd                     5    overlay(allfields:44)
     D   xxabhd                       5    overlay(allfields:49)
     D   xxnipqt                      5    overlay(allfields:54)
      *
     D   xxgllt                       5    overlay(allfields:59)
     D   xxglbahd                     5    overlay(allfields:64)
     D   xxtolt                       5    overlay(allfields:69)
     D   xxbahd                       5    overlay(allfields:74)
     D   xxsbhd                       5    overlay(allfields:79)
     D   xxmmhd                       5    overlay(allfields:84)
      *
     D   xxtolshd                     5    overlay(allfields:89)
      *
     D   xxewnlt                      5    overlay(allfields:94)
     D   xxwnlt                       5    overlay(allfields:99)
     D   xxtownhd                     5    overlay(allfields:104)
     D   xxadwn                       3    overlay(allfields:109)
      *
     D   xxarglhd                     5    overlay(allfields:112)
     D   xxibglhd                     5    overlay(allfields:117)
     D   xxarsohd                     5    overlay(allfields:122)
     D   xxibsohd                     5    overlay(allfields:127)
      *
     D   xxslglhd                     5    overlay(allfields:132)
     D   xxslsohd                     5    overlay(allfields:137)
     D   xxddglhd                     5    overlay(allfields:142)
     D   xxddsohd                     5    overlay(allfields:147)
      *
     D   xxobglhd                     5    overlay(allfields:152)
     D   xxoosohd                     5    overlay(allfields:157)
     D   xxobsohd                     5    overlay(allfields:162)
      *
     D   xxarbohd                     5    overlay(allfields:167)
     D   xxslbohd                     5    overlay(allfields:172)
     D   xxddbohd                     5    overlay(allfields:177)
      *
     D   xxglsbhd                     5    overlay(allfields:182)
     D   xxglmmhd                     5    overlay(allfields:187)
      *
     D   xxeuglhd                     5    overlay(allfields:192)
     D   xxeusohd                     5    overlay(allfields:197)
      *
     D   xxmanhr                      7    overlay(allfields:202)
      *
     D   xxsdino                      6    overlay(allfields:209)
      *
      *
      * The following is a dummy C-spec to keep the D-specs from
      * running over into the C-specs on the compile listing. It
      * serves no other purpose and can be deleted at any time.
      *
     C                   if        sdpgm = *blank
     C                   endif
      /EJECT
      ****************************************************************
      * MAINLINE
      ****************************************************************
      *
      * Read each record in the Receiving file and extract fields for the
      * record you will write to the editing file.
      *
     C                   dou       *in90 = *on                                  Main do
     C                   read      hsp265                                 90
     C                   if        *in90 = *off                                 If not EOF
      *
     C                   move(p)   u1field       inputrec
      *
      * Test all fields for numerics; set non-numeric fields to 0.
      *
     C                   testn                   xxfscd               92
     C                   if        *in92 = *on
     C                   move      xxfscd        bdfscd
     C                   else
     C                   z-add     0             bdfscd
     C                   endif
      *
      *
     C                   z-add     0             bddpdt
     C                   testn                   xxdt                 92
     C                   if        *in92 = *on                                  If numeric
     C                   movel     xxdt          wkmdy
     C     *usa          test(d)                 wkmdy                  92
     C                   if        *in92 = *off                                 If good date
     C     *usa          movel     wkmdy         wkcymdiso
     C                   movel     wkcymdiso     bddpdt
     C                   endif                                                  If good date
     C                   endif                                                  If numeric
      *
     C                   testn                   xxwnsv               92
     C                   if        *in92 = *on
     C                   move      xxwnsv        bdwnsv
     C                   else
     C                   z-add     0             bdwnsv
     C                   endif
      *
     C                   testn                   xxlwnsv              92
     C                   if        *in92 = *on
     C                   move      xxlwnsv       bdlwnsv
     C                   else
     C                   z-add     0             bdlwnsv
     C                   endif
      *
     C                   testn                   xxrtsv               92
     C                   if        *in92 = *on
     C                   move      xxrtsv        bdrtsv
     C                   else
     C                   z-add     0             bdrtsv
     C                   endif
      *
     C                   testn                   xxglsv               92
     C                   if        *in92 = *on
     C                   move      xxglsv        bdglsv
     C                   else
     C                   z-add     0             bdglsv
     C                   endif
      *
     C                   testn                   xxopglhd             92
     C                   if        *in92 = *on
     C                   move      xxopglhd      bdopglhd
     C                   else
     C                   z-add     0             bdopglhd
     C                   endif
      *
     C                   testn                   xxopsohd             92
     C                   if        *in92 = *on
     C                   move      xxopsohd      bdopsohd
     C                   else
     C                   z-add     0             bdopsohd
     C                   endif
      *
     C                   testn                   xxabhd               92
     C                   if        *in92 = *on
     C                   move      xxabhd        bdabhd
     C                   else
     C                   z-add     0             bdabhd
     C                   endif
      *
     C                   testn                   xxglabhd             92
     C                   if        *in92 = *on
     C                   move      xxglabhd      bdglabhd
     C                   else
     C                   z-add     0             bdglabhd
     C                   endif
      *
     C                   testn                   xxnipqt              92
     C                   if        *in92 = *on
     C                   move      xxnipqt       bdnipqt
     C                   else
     C                   z-add     0             bdnipqt
     C                   endif
      *
      *
     C                   testn                   xxgllt               92
     C                   if        *in92 = *on
     C                   move      xxgllt        bdgllt
     C                   else
     C                   z-add     0             bdgllt
     C                   endif
      *
     C                   testn                   xxglbahd             92
     C                   if        *in92 = *on
     C                   move      xxglbahd      bdglbahd
     C                   else
     C                   z-add     0             bdglbahd
     C                   endif
      *
     C                   testn                   xxtolt               92
     C                   if        *in92 = *on
     C                   move      xxtolt        bdtolt
     C                   else
     C                   z-add     0             bdtolt
     C                   endif
      *
     C                   testn                   xxbahd               92
     C                   if        *in92 = *on
     C                   move      xxbahd        bdbahd
     C                   else
     C                   z-add     0             bdbahd
     C                   endif
      *
     C                   testn                   xxsbhd               92
     C                   if        *in92 = *on
     C                   move      xxsbhd        bdsbhd
     C                   else
     C                   z-add     0             bdsbhd
     C                   endif
      *
     C                   testn                   xxmmhd               92
     C                   if        *in92 = *on
     C                   move      xxmmhd        bdmmhd
     C                   else
     C                   z-add     0             bdmmhd
     C                   endif
      *
     C                   testn                   xxtolshd             92
     C                   if        *in92 = *on
     C                   move      xxtolshd      bdtolshd
     C                   else
     C                   z-add     0             bdtolshd
     C                   endif
      *
     C                   testn                   xxewnlt              92
     C                   if        *in92 = *on
     C                   move      xxewnlt       bdewnlt
     C                   else
     C                   z-add     0             bdewnlt
     C                   endif
      *
     C                   testn                   xxwnlt               92
     C                   if        *in92 = *on
     C                   move      xxwnlt        bdwnlt
     C                   else
     C                   z-add     0             bdwnlt
     C                   endif
      *
     C                   testn                   xxtownhd             92
     C                   if        *in92 = *on
     C                   move      xxtownhd      bdtownhd
     C                   else
     C                   z-add     0             bdtownhd
     C                   endif
      *
      * Get the 'implied decimal' into Average Days Weaned
      *
     C                   testn                   xxadwn               92
     C                   if        *in92 = *on
     C                   move      xxadwn        wknum30
     C     wknum30       mult      .1            bdadwn
     C                   else
     C                   z-add     0             bdadwn
     C                   endif
      *
     C                   testn                   xxarglhd             92
     C                   if        *in92 = *on
     C                   move      xxarglhd      bdarglhd
     C                   else
     C                   z-add     0             bdarglhd
     C                   endif
      *
     C                   testn                   xxibglhd             92
     C                   if        *in92 = *on
     C                   move      xxibglhd      bdibglhd
     C                   else
     C                   z-add     0             bdibglhd
     C                   endif
      *
     C                   testn                   xxarsohd             92
     C                   if        *in92 = *on
     C                   move      xxarsohd      bdarsohd
     C                   else
     C                   z-add     0             bdarsohd
     C                   endif
      *
     C                   testn                   xxibsohd             92
     C                   if        *in92 = *on
     C                   move      xxibsohd      bdibsohd
     C                   else
     C                   z-add     0             bdibsohd
     C                   endif
      *
     C                   testn                   xxslglhd             92
     C                   if        *in92 = *on
     C                   move      xxslglhd      bdslglhd
     C                   else
     C                   z-add     0             bdslglhd
     C                   endif
      *
     C                   testn                   xxslsohd             92
     C                   if        *in92 = *on
     C                   move      xxslsohd      bdslsohd
     C                   else
     C                   z-add     0             bdslsohd
     C                   endif
      *
     C                   testn                   xxddglhd             92
     C                   if        *in92 = *on
     C                   move      xxddglhd      bdddglhd
     C                   else
     C                   z-add     0             bdddglhd
     C                   endif
      *
     C                   testn                   xxddsohd             92
     C                   if        *in92 = *on
     C                   move      xxddsohd      bdddsohd
     C                   else
     C                   z-add     0             bdddsohd
     C                   endif
      *
     C                   testn                   xxobglhd             92
     C                   if        *in92 = *on
     C                   move      xxobglhd      bdobglhd
     C                   else
     C                   z-add     0             bdobglhd
     C                   endif
      *
     C                   testn                   xxoosohd             92
     C                   if        *in92 = *on
     C                   move      xxoosohd      bdoosohd
     C                   else
     C                   z-add     0             bdoosohd
     C                   endif
      *
     C                   testn                   xxobsohd             92
     C                   if        *in92 = *on
     C                   move      xxobsohd      bdobsohd
     C                   else
     C                   z-add     0             bdobsohd
     C                   endif
      *
     C                   testn                   xxarbohd             92
     C                   if        *in92 = *on
     C                   move      xxarbohd      bdarbohd
     C                   else
     C                   z-add     0             bdarbohd
     C                   endif
      *
     C                   testn                   xxslbohd             92
     C                   if        *in92 = *on
     C                   move      xxslbohd      bdslbohd
     C                   else
     C                   z-add     0             bdslbohd
     C                   endif
      *
     C                   testn                   xxddbohd             92
     C                   if        *in92 = *on
     C                   move      xxddbohd      bdddbohd
     C                   else
     C                   z-add     0             bdddbohd
     C                   endif
      *
     C                   testn                   xxglsbhd             92
     C                   if        *in92 = *on
     C                   move      xxglsbhd      bdglsbhd
     C                   else
     C                   z-add     0             bdglsbhd
     C                   endif
      *
     C                   testn                   xxglmmhd             92
     C                   if        *in92 = *on
     C                   move      xxglmmhd      bdglmmhd
     C                   else
     C                   z-add     0             bdglmmhd
     C                   endif
      *
     C                   testn                   xxeuglhd             92
     C                   if        *in92 = *on
     C                   move      xxeuglhd      bdeuglhd
     C                   else
     C                   z-add     0             bdeuglhd
     C                   endif
      *
     C                   testn                   xxeusohd             92
     C                   if        *in92 = *on
     C                   move      xxeusohd      bdeusohd
     C                   else
     C                   z-add     0             bdeusohd
     C                   endif
      *
      * Get the 'implied decimals' into Man Hours
      *
     C                   testn                   xxmanhr              92
     C                   if        *in92 = *on
     C                   move      xxmanhr       wknum70
     C     wknum70       mult      .01           bdmanhr
     C                   else
     C                   z-add     0             bdmanhr
     C                   endif
      *
      * Safedata (SDI) reference number
      *
     C                   testn                   xxsdino              92
     C                   if        *in92 = *on
     C                   move      xxsdino       bdsdino
     C                   else
     C                   z-add     0             bdsdino
     C                   endif
      *
      *
      * Set the 'source' field to say 'safedata'.
      *
     C                   move      'S'           bddscd
      *
      * Put 'system date/time' into the 'create date/time' fields
      *
     C                   z-add     wkcrdt        bdcrdt
     C                   z-add     wkcrtm        bdcrtm
      *
      *
      * Write a record to the editing file.
      *
     C                   write     bdrec
      *
     C                   clear                   bdrec
     C
     C                   endif                                                  If not EOF
     C                   enddo                                                  Main do
      *
     C                   seton                                        lr
      /eject
      *---------------------------------------------------------------
      * Initialization subroutine
      *---------------------------------------------------------------
      *
     C     *inzsr        begsr
      *
      * Put system date/time into work fields to use as 'upload date/time'.
      *
      **  2/26/2020 JBB E15763 - Use System Date instead of UDATE
     C*    *mdy          movel     udate         wkcymdiso
     c                   movel     sysdate       wkcymdiso
     C                   movel     wkcymdiso     wkcrdt
     C                   time                    wkcrtm
      *
      *
     C                   endsr
      /eject
