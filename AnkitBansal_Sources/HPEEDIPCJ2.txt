/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  EDIPCC                                        */
/*  PROGRAM NAME:    EDI CARCASS SUMMARY & DETAIL                  */
/*  PROGRAMMER:      JOHN ERICSON                                  */
/*  CREATE DATE:     ??/??/??                                      */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/* 10/18/01 CHANGED TO SEND THE FILES TO A FTP SITE INSTEAD OF     */
/*          THE EDIPC IF THE TRADING PARTNER IS GE 10000.          */
/*                                                                 */
/* 11/14/01 COMMENTED OUT DOWNLOAD TO EDIPC.                       */
/* 10/15/10 CHANGE THE .TXT TO .XLS                                */
/*                                                                 */
/* 11/10/14 E3503 JJH - Add logic to support SFTP with new parm    */
/*          FTPMETHOD.                                             */
/*******************************************************************/
             PGM        PARM(&CO &DATEIN &FTPMETHOD &FUN)

/* INPUT PARAMETERS*/
             DCL        VAR(&CO) TYPE(*CHAR) LEN(6)      /* TRADING PARTNER  */
             DCL        VAR(&DATEIN) TYPE(*CHAR) LEN(6)  /* YMD-KILL +
                          DATE */
             DCL        VAR(&FTPMETHOD) TYPE(*CHAR) LEN(1)  /* FTP METHOD    */
             DCL        VAR(&FUN) TYPE(*CHAR) LEN(1)        /* FUNCTION      */

/* FTP VARIABLES       */
             DCL        VAR(&FTPDIR) TYPE(*CHAR) LEN(64) /* FTP DIRECTORY     */

             DCL        VAR(&CS) TYPE(*CHAR) LEN(64)     /* SUMMARY PCFILE    */
             DCL        VAR(&CD) TYPE(*CHAR) LEN(64)     /* DETAIL PCFILE     */

             DCL        VAR(&PCCS) TYPE(*CHAR) LEN(12)   /* SUMMARY FILE NAME */
             DCL        VAR(&PCCD) TYPE(*CHAR) LEN(12)   /* DETAIL FILE NAME  */

             DCL        VAR(&FTPCS) TYPE(*CHAR) LEN(64)  /* SUMMARY FILE NAME */
             DCL        VAR(&FTPCD) TYPE(*CHAR) LEN(64)  /* DETAIL FILE NAME  */

             DCL        VAR(&DATE) TYPE(*CHAR) LEN(6)    /* JOB DATE          */
             DCL        VAR(&SEQ) TYPE(*CHAR) LEN(1)     /* SEQUENCE NUMBER   */
             DCL        VAR(&CONUM) TYPE(*DEC) LEN(6 0)  /* COMPANY NUMERIC   */
             DCL        VAR(&DATE8) TYPE(*CHAR) LEN(8)   /* YYMD FORMAT DATE  */

/* SFTP VARIABLES       */
             DCL        VAR(&RMTDIR) TYPE(*CHAR) LEN(24)
             DCL        VAR(&LOCALDIR) TYPE(*CHAR) LEN(7)
             DCL        VAR(&URL) TYPE(*CHAR) LEN(20)

             DCL        VAR(&TDOCSUM) TYPE(*CHAR) LEN(7)
             DCL        VAR(&TDOCDTL) TYPE(*CHAR) LEN(7)
/*-----------------------------------------------------------------*/
/* INITIALIZE                                                      */
/*-----------------------------------------------------------------*/
/* CONVERT TRADING PARTNER TO NUMERIC */
             CHGVAR     VAR(&CONUM) VALUE(&CO)

/* RETRIEVE & CONVERT JOB DATE        */
/*           RTVJOBA    DATE(&DATE) */
             /* CONVERT DATE TO YMD FORMAT */
/*           CHGVAR     VAR(&DATE) VALUE(%SST(&DATE 5 2) *CAT +
                          %SST(&DATE 1 4)) */
             /* CONVERT DATE TO YYMD FORMAT */
             CVTDAT     DATE(&DATEIN) TOVAR(&DATE8) FROMFMT(*YMD) +
                          TOFMT(*YYMD) TOSEP(*NONE)

/* FORMAT PC FILE NAME ON THE AS400 */
             /* SOURCE FILE NAME FOR FTP */
             CHGVAR     VAR(&CS) VALUE('GUY.IS/S' *CAT &CO)
             CHGVAR     VAR(&CD) VALUE('GUY.IS/D' *CAT &CO)

             /* SOURCE FILE NAME FOR SFTP */
             CHGVAR     VAR(&TDOCSUM)  VALUE('S' *CAT &CO)
             CHGVAR     VAR(&TDOCDTL)  VALUE('D' *CAT &CO)

             /* FORMAT TARGET FILE NAME FTP & SFTP */
             CALL       PGM(HPEEDIPCCR) PARM(&CO &DATEIN &SEQ)
             IF         COND(&SEQ *EQ ' ') THEN(CHGVAR VAR(&SEQ) +
                          VALUE(0))
             CHGVAR     VAR(&FTPCS) VALUE('SUM_' *CAT &DATE8 *CAT '_' +
                          *CAT &SEQ *TCAT '.XLS')
             CHGVAR     VAR(&FTPCD) VALUE('DTL_' *CAT &DATE8 *CAT '_' +
                          *CAT &SEQ *TCAT '.XLS')

/*-----------------------------------------------------------------*/
/* MAIN LINE                                                       */
/*-----------------------------------------------------------------*/

/**********  SEND FILES TO FTP SITE ON SERVER USING FTP      ************/

             IF         COND(&FTPMETHOD *EQ 'F' *OR &FTPMETHOD +
                          *EQ 'P') THEN(DO)

/* ADD FTP LIBRARY TO THE THE LIBRARY LIST */
             ADDLIBLE   LIB(FTP_REMOTE) POSITION(*LAST)
             MONMSG     MSGID(CPF0000)

/* DOWNLOAD TO FTP SITE ON THE SERVER */
             IF         COND(&CONUM *GE 10000) THEN(DO)
             CHGVAR     VAR(&FTPDIR) VALUE('/PRODCR_ACCTS/' *CAT &CO)
             FTP_DOC2   FUNCTION(*SEND) IDIR(&FTPDIR) IFILE(&FTPCS) +
                          HDOC(&CS) URL(ftp.seaboardpork.com) +
                          USER('PDINETPRRP') PASS('prodcr36') +
                          ASCII(*NO)
             FTP_DOC2   FUNCTION(*SEND) IDIR(&FTPDIR) IFILE(&FTPCD) +
                          HDOC(&CD) URL(ftp.seaboardpork.com) +
                          USER('PDINETPRRP') PASS('prodcr36') +

             RMVLIBLE   LIB(FTP_REMOTE)
             MONMSG     MSGID(CPF0000)

             ENDDO
             ENDDO

/**********  SEND FILES TO BRICKFTP USING SFTP               ************/
             IF         COND(&FTPMETHOD *EQ 'S' *OR &FTPMETHOD +
                          *EQ 'P') THEN(DO)

             ADDLIBLE   LIB(SFTPREMOTE) POSITION(*LAST)
             MONMSG     MSGID(CPF0000)

             CHGVAR     VAR(&RMTDIR)  VALUE('/ProducerServices/' *TCAT +
                          &CO)
             CHGVAR     VAR(&LOCALDIR) VALUE('/' *CAT &CO)

             SFTP_IFS   FUNCTION(*SEND) +
                          RMTDIR(&RMTDIR) +
                          RMTFILE(&FTPCS) +
                          LOCALDIR(&LOCALDIR) +
                          LOCALFILE(&TDOCSUM) +
                          URL('Seaboard.BrickFTP.com') +
                          USER('PDSECOFR@Seaboard.BrickFTP.com')

             SFTP_IFS   FUNCTION(*SEND) +
                           RMTDIR(&RMTDIR) +
                           RMTFILE(&FTPCD) +
                           LOCALDIR(&LOCALDIR) +
                           LOCALFILE(&TDOCDTL) +
                           URL('Seaboard.BrickFTP.com') +
                           USER('PDSECOFR@Seaboard.BrickFTP.com')

             RMVLIBLE   LIB(SFTPREMOTE)
             MONMSG     MSGID(CPF0000)

             ENDDO

/*-----------------------------------------------------------------*/
/* END PROGRAM                                                     */
/*-----------------------------------------------------------------*/
             ENDPGM
