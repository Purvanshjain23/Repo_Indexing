     H/TITLE Exc Phone Lookup      XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 05/08/13  Time  : 11:20:36
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCABBRELAIF  E           K        DISK
      * RTV : Customer                  Active Only
      *
     FPDM3REL1IF  E           K        DISK
      * RTV : Customer Fax              Retrieval index
      *
     FPNF7REL1IF  E           K        DISK
      * RTV : Cust Distribution Entry   Retrieval index
      *
     I@BBREWG
      * Customer                  Active Only
      * Renamed input format fields
     I              BBBKC7                          WABKC7
     I              BBAYTX                          WAAYTX
     I              BBACNA                          WAACNA
     I              BBADNA                          WAADNA
     I              BBAENA                          WAAENA
     I              BBAJNA                          WAAJNA
     I              BBBGCD                          WABGCD
     I              BBG5CD                          WAG5CD
     I              BBBTTX                          WABTTX
     I              BBBVTX                          WABVTX
     I              BBBWTX                          WABWTX
     I              BBABTX                          WAABTX
     I              BBA2NA                          WAA2NA
     I              BBCBST                          WACBST
     I              BBB0NA                          WAB0NA
     I              BBP3NB                          WAP3NB
     I              BBAXNA                          WAAXNA
     I              BBI6DT                          WAI6DT
     I              BBAYDT                          WAAYDT
     I              BBANC7                          WAANC7
     I              BBBTC7                          WABTC7
     I              BBK6ST                          WAK6ST
     I              BBUZST                          WAUZST
     I              BBKXCD                          WAKXCD
     I              BBLTCD                          WALTCD
     I              BBQNST                          WAQNST
     I              BBS2NB                          WAS2NB
     I              BBVHVA                          WAVHVA
     I              BBI7DT                          WAI7DT
     I              BBRJST                          WARJST
     I              BBRKST                          WARKST
     I              BBQWST                          WAQWST
     I              BBQXST                          WAQXST
     I              BBQYST                          WAQYST
     I              BBUNCS                          WAUNCS
     I              BBUVST                          WAUVST
     I              BBUWST                          WAUWST
     I              BBUXST                          WAUXST
     I              BBVSST                          WAVSST
     I              BBAATM                          WAAATM
     I              BBAYNA                          WAAYNA
     I              BBA0NA                          WAA0NA
     I              BBAXDT                          WAAXDT
      *
     I@M3REZE
      * Customer Fax              Retrieval index
      * Renamed input format fields
     I              M3BKC7                          WBBKC7
     I              M3A0AA                          WBA0AA
     I              M3HXNX                          WBHXNX
     I              M3TFTX                          WBTFTX
     I              M3W5T1                          WBW5T1
     I              M3HYNX                          WBHYNX
     I              M3TGTX                          WBTGTX
     I              M3HZNX                          WBHZNX
     I              M3THTX                          WBTHTX
     I              M3D7T1                          WBD7T1
     I              M3D8T1                          WBD8T1
     I              M3D9T1                          WBD9T1
     I              M3EAT1                          WBEAT1
     I              M3FISX                          WBFISX
     I              M3FJSX                          WBFJSX
     I              M3FKSX                          WBFKSX
     I              M3FLSX                          WBFLSX
     I              M3FMSX                          WBFMSX
     I              M3VSST                          WBVSST
     I              M3MJDT                          WBMJDT
     I              M3BETM                          WBBETM
     I              M3CCVN                          WBCCVN
     I              M3CDVN                          WBCDVN
     I              M3MKDT                          WBMKDT
     I              M3BFTM                          WBBFTM
     I              M3CEVN                          WBCEVN
     I              M3CFVN                          WBCFVN
      *
     I@F7REFP
      * Cust Distribution Entry   Retrieval index
      * Renamed input format fields
     I              F7BKC7                          WCBKC7
     I              F7MNAA                          WCMNAA
     I              F7RNNY                          WCRNNY
     I              F7WLT1                          WCWLT1
     I              F7IRST                          WCIRST
     I              F7WMT1                          WCWMT1
     I              F7VSST                          WCVSST
     I              F7MJDT                          WCMJDT
     I              F7BETM                          WCBETM
     I              F7CCVN                          WCCCVN
     I              F7CDVN                          WCCDVN
     I              F7MKDT                          WCMKDT
     I              F7BFTM                          WCBFTM
     I              F7CEVN                          WCCEVN
     I              F7CFVN                          WCCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Telephone Number FF
     I                                        1  25 P1BVTX
     IP2PARM      DS
      * B :  Ship To Customer
     I                                    P   1   40P2BKC7
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BVTX    PARM           WP0001 25        Telephone Numbe
     C           P2BKC7    PARM P2BKC7    WP0002  70       Ship To Custome
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Phone Lookup      XF
      * C01578 new pgm
     C                     Z-ADD*ZERO     P2BKC7           Ship To Custome
      * RTV Phone Lookup cust RT - Customer  * 
     C                     EXSR SARVGN
      * CASE: PAR.Ship To Customer is equal to zero
     C           P2BKC7    IFEQ *ZERO                      *IF
      * RTV Phone Lookup      RT - Cust Distribution Entry  * 
     C                     EXSR SCRVGN
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Phone Lookup cust RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@BBREWG                    *
     C                     READ @BBREWG                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0170' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     P2BKC7           Ship To Custome
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Rtv Cust Fax Buyer NbrsRT - Customer Fax  * 
     C                     EXSR SBRVGN
      * CASE:
      *  - c1ORc2ORc3
      *   |- c1    : DB1.Telephone Number FF EQ PAR.Telephone Number FF
      *   |- c2    : DB1.Fax Number FF EQ PAR.Telephone Number FF
      *   |- c3    : LCL.Buyer Fax Number EQ PAR.Telephone Number FF
      *   '-
     C           WABVTX    IFEQ P1BVTX                     *IF
     C           WABWTX    OREQ P1BVTX                     *OR
     C           YL0001    OREQ P1BVTX                     *OR
      * PAR = DB1 By name
     C                     Z-ADDWABKC7    P2BKC7           Ship To Custome
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     READ @BBREWG                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Cust Fax Buyer NbrsRT - Customer Fax  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBBKC7           Ship To Custome
     C                     KFLD           WBA0AA           Fax Application
      * Setup key
     C                     Z-ADDWABKC7    WBBKC7           Ship To Custome
     C                     MOVEL*BLANK    WBA0AA           Fax Application
      * Establish starting position
     C           KRSSB     CHAIN@M3REZE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2843' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           Buyer Fax Numbe
     C                     MOVEL*BLANK    YL0002           Buyer Fax Name
     C                     MOVEL*BLANK    YL0003           Buyer Email Add
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBHXNX    YL0001           Buyer Fax Numbe
     C                     MOVELWBTFTX    YL0002           Buyer Fax Name
     C                     MOVELWBW5T1    YL0003           Buyer Email Add
     C                     GOTO SBEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Phone Lookup      RT - Cust Distribution Entry  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@F7REFP                    *
     C                     READ @F7REFP                  90*
      * Data record not found
     C   90                MOVEL'USR4289' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.CDE Destination EQ PAR.CDE Destination
      *   |- c2    : DB1.Record Status is Active
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WCWMT1    IFEQ P1BVTX                     *IF
     C           WCVSST    IFEQ 'A'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * PAR = DB1 By name
     C                     Z-ADDWCBKC7    P2BKC7           Ship To Custome
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C                     READ @F7REFP                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAP3NB           D & B Number
     C                     Z-ADD*ZERO     WAI6DT           Date of D & B R
     C                     Z-ADD*ZERO     WAAYDT           Credit Line Exp
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABTC7           Parent Customer
     C                     Z-ADD*ZERO     WAS2NB           Parent Credit L
     C                     Z-ADD*ZERO     WAVHVA           A/R Credit Limi
     C                     Z-ADD*ZERO     WAI7DT           Order Entry Hol
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBMJDT           Create Date
     C                     Z-ADD*ZERO     WBBETM           Create Time
     C                     Z-ADD*ZERO     WBMKDT           Change Date
     C                     Z-ADD*ZERO     WBBFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCRNNY           CDE Sequence Nu
     C                     Z-ADD*ZERO     WCMJDT           Create Date
     C                     Z-ADD*ZERO     WCBETM           Create Time
     C                     Z-ADD*ZERO     WCMKDT           Change Date
     C                     Z-ADD*ZERO     WCBFTM           Change Time
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Buyer Fax Number
     C                     MOVEL*BLANK    YL0001 25
      * Define local work field Buyer Fax Name
     C                     MOVEL*BLANK    YL0002 25
      * Define local work field Buyer Email Address
     C                     MOVEL*BLANK    YL0003 50
      *================================================================
     CSR         ZZEXIT    ENDSR
