// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWAOXFR
// ?Date: 14.08.2025 Time: 02:55:51
// ?------------------------------------------------------------------------------------------------

//?Execute user function

CASE;

// IF PAR.PDW Input is Prt Delivery Schedule PV
IF PAR.PDW_Input = 'P';

//?T13559 DN 08/10/18-Pass in Producer Location.
EXECUTE FUNCTION(Bld Producer Dist WRK RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1330311;
PARAMETER(PAR.PDW_Producer_Code);
PARAMETER(PAR.PDW_Company_Number);
PARAMETER(PAR.PDW_BOL_Kill_Date);
PARAMETER(PAR.PDW_BOL_Kill_Date_To);
PARAMETER(PAR.SR_Type);
PARAMETER(PAR.SR_Source_Code);
PARAMETER(PAR.PDW_Producer_Loc_Code);
{
 //?USER: Process Data record

 //?Initialize Selection Criteria Fields
 // PGM.*Record selected = CND.*YES
 PGM.*Record_selected = 'Y';

 // LCL.Blank Usr 1 fld Usr = CND.Blank
 LCL.Blank_Usr_1_fld_Usr = *BLANK;

 // LCL.Blank Usr 3 char = CND.Blank
 LCL.Blank_Usr_3_char = *BLANK;

 //?Record Selection for Producer
 CASE;

 // IF PAR.PD Producer Code is Entered
 IF PAR.PD_Producer_Code <> *BLANK;

 // AND PAR.PD Producer Code NE DB1.PD Producer Code
 AND PAR.PD_Producer_Code <> DB1.PD_Producer_Code;

 QUIT;

 //?Record Selection for Producer
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Validate Source Code
 CASE;

 // IF PAR.SR Source Code NE LCL.Blank Usr 3 char
 IF PAR.SR_Source_Code <> LCL.Blank_Usr_3_char;

 // AND PAR.SR Source Code NE DB1.SR Source Code
 AND PAR.SR_Source_Code <> DB1.SR_Source_Code;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Validate Souce Type
 EXECUTE FUNCTION(Rtv Source Type       RT) TYPE(RTVOBJ) FILE(PKAAREP)           AB1141829;
 PARAMETER(DB1.SR_Source_Code);
 PARAMETER(LCL.SR_Type);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PAR.SR Type NE LCL.Blank Usr 1 fld Usr
 IF PAR.SR_Type <> LCL.Blank_Usr_1_fld_Usr;

 // AND PAR.SR Type NE LCL.SR Type
 AND PAR.SR_Type <> LCL.SR_Type;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?T13559 DN 08/10/18-Added Logic to also Process by Producer Location.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF PAR.PDW Producer Loc Code is Blank
 IF PAR.PDW_Producer_Loc_Code = *BLANK;

 //?Create Producer Distribution Wrk Record by Producer Level.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Validate at least 1 Qualifed Buy Order Load
 //?E11641 - Pass in PAR.PDW BOL Kill Date To for PDW BOL Kill Date
 EXECUTE FUNCTION(Rtv Producer Dist WRK RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1330317;
 PARAMETER(PAR.PDW_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(PAR.PDW_BOL_Kill_Date);
 PARAMETER(PAR.PDW_BOL_Kill_Date_To);
 PARAMETER(LCL.Record_Found_USR);
 {
  //?USER: Initialize routine

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.BOL Kill Date LE PAR.PDW BOL Kill Date From
  IF DB1.BOL_Kill_Date <= PAR.PDW_BOL_Kill_Date;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

  QUIT;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  QUIT;

  ENDIF;

 }

 CASE;

 // IF LCL.Record Found USR is Record Found
 IF LCL.Record_Found_USR = 'Y';

 //?Create Producer Distribution WRK record for each Email
 //?record set up for Producer
 //?E11641 - Delivery Scheduling Report
 //?- Only print Emails if the Producer Distribution Ent record is
 //?  A=Active.
 EXECUTE FUNCTION(Crt Prdcr Dlv Sch Rpt RT) TYPE(RTVOBJ) FILE(PVCRREP)           AB1330319;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER('HPE-DLVRCV');
 PARAMETER(PAR.PDW_Company_Number);
 PARAMETER(PAR.PDW_BOL_Kill_Date);
 PARAMETER(PAR.PDW_BOL_Kill_Date_To);
 {
  //?USER: Process Data record

  //?E11641 - Delivery Scheduling Report
  //?- Only print Emails if the Producer Distribution Ent record is
  //?  A=Active.
  CASE;

  // IF DB1.PDE Destination Type is Email
  IF DB1.PDE_Destination_Type = 'E';

  // AND DB1.RS Record Status is Active
  AND DB1.RS_Record_Status = 'A';

  EXECUTE FUNCTION(Crt Producer Dist WRK CR) TYPE(CRTOBJ) FILE(PWABCPP)           AB1330177;
  PARAMETER(PAR.PDW_Company_Number);
  PARAMETER(DB1.PD_Producer_Code);
  PARAMETER(DB1.PDE_Destination);
  PARAMETER(PAR.PDW_BOL_Kill_Date);
  PARAMETER(PAR.PDW_BOL_Kill_Date_To);
  ENDIF;

 }

 ENDIF;

 ENDIF;

 //?Create Producer Loc Distrib Wrk Record by Producer/Producer Loc Level.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Crt Prod Loc Dist Wrk RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1346273;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(PAR.PDW_Company_Number);
 PARAMETER(PAR.PDW_BOL_Kill_Date);
 PARAMETER(PAR.PDW_BOL_Kill_Date_To);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv Prod Loc Dist Wrk RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1346271;
  PARAMETER(PAR.PDW_Company_Number);
  PARAMETER(PAR.PD_Producer_Code);
  PARAMETER(DB1.PL_Location_Code);
  PARAMETER(PAR.PDW_BOL_Kill_Date);
  PARAMETER(PAR.PDW_BOL_Kill_Date_To);
  PARAMETER(LCL.Record_Found_USR);
  {
   //?USER: Initialize routine

   // PAR.Record Found USR = CND.Record Not Found
   PAR.Record_Found_USR = 'N';

   //?USER: Process Data record

   CASE;

   // IF DB1.BOL Kill Date LE PAR.PDW BOL Kill Date To
   IF DB1.BOL_Kill_Date <= PAR.PDW_BOL_Kill_Date_To;

   // PAR.Record Found USR = CND.Record Found
   PAR.Record_Found_USR = 'Y';

   // IF *OTHERWISE
   IF *OTHERWISE;

   // PAR.Record Found USR = CND.Record Not Found
   PAR.Record_Found_USR = 'N';

   ENDIF;

   QUIT;

  }

  //?At Least 1 Qualified Buy Order Load then Create It.
  CASE;

  // IF LCL.Record Found USR is Record Found
  IF LCL.Record_Found_USR = 'Y';

  EXECUTE FUNCTION(Crt Prod Loc Dist Wrk RT) TYPE(RTVOBJ) FILE(PWALREP)           AB1346272;
  PARAMETER(PAR.PD_Producer_Code);
  PARAMETER(DB1.PL_Location_Code);
  PARAMETER('HPE-DLVRCV');
  PARAMETER(PAR.PDW_Company_Number);
  PARAMETER(PAR.PDW_BOL_Kill_Date);
  PARAMETER(PAR.PDW_BOL_Kill_Date_To);
  {
   //?USER: Process Data record

   //?Create a Producer Loc Distrib Ent record for each active email.
   CASE;

   // IF DB1.PDE Destination Type is Email
   IF DB1.PDE_Destination_Type = 'E';

   // AND DB1.RS Record Status is Active
   AND DB1.RS_Record_Status = 'A';

   EXECUTE FUNCTION(Crt Prod Loc Dist Ent CR) TYPE(CRTOBJ) FILE(PWAMCPP)           AB1343690;
   PARAMETER(PAR.PDW_Company_Number);
   PARAMETER(PAR.PD_Producer_Code);
   PARAMETER(PAR.PL_Location_Code);
   PARAMETER(DB1.PDE_Destination);
   PARAMETER(PAR.PDW_BOL_Kill_Date);
   PARAMETER(PAR.PDW_BOL_Kill_Date_To);
   ENDIF;

  }

  ENDIF;

 }

 ENDIF;

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Create Producer Loc Distrib Wrk Record by Producer/Producer Loc Level.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Rtv Prod Loc Dist Wrk RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1346271;
 PARAMETER(PAR.PDW_Company_Number);
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PDW_Producer_Loc_Code);
 PARAMETER(PAR.PDW_BOL_Kill_Date);
 PARAMETER(PAR.PDW_BOL_Kill_Date_To);
 PARAMETER(LCL.Record_Found_USR);
 {
  //?USER: Initialize routine

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.BOL Kill Date LE PAR.PDW BOL Kill Date To
  IF DB1.BOL_Kill_Date <= PAR.PDW_BOL_Kill_Date_To;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  ENDIF;

  QUIT;

 }

 //?At Least 1 Qualified Buy Order Load then Create It.
 CASE;

 // IF LCL.Record Found USR is Record Found
 IF LCL.Record_Found_USR = 'Y';

 EXECUTE FUNCTION(Crt Prod Loc Dist Wrk RT) TYPE(RTVOBJ) FILE(PWALREP)           AB1346272;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PDW_Producer_Loc_Code);
 PARAMETER('HPE-DLVRCV');
 PARAMETER(PAR.PDW_Company_Number);
 PARAMETER(PAR.PDW_BOL_Kill_Date);
 PARAMETER(PAR.PDW_BOL_Kill_Date_To);
 {
  //?USER: Process Data record

  //?Create a Producer Loc Distrib Ent record for each active email.
  CASE;

  // IF DB1.PDE Destination Type is Email
  IF DB1.PDE_Destination_Type = 'E';

  // AND DB1.RS Record Status is Active
  AND DB1.RS_Record_Status = 'A';

  EXECUTE FUNCTION(Crt Prod Loc Dist Ent CR) TYPE(CRTOBJ) FILE(PWAMCPP)           AB1343690;
  PARAMETER(PAR.PDW_Company_Number);
  PARAMETER(PAR.PD_Producer_Code);
  PARAMETER(PAR.PL_Location_Code);
  PARAMETER(DB1.PDE_Destination);
  PARAMETER(PAR.PDW_BOL_Kill_Date);
  PARAMETER(PAR.PDW_BOL_Kill_Date_To);
  ENDIF;

 }

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


// IF PAR.PDW Input is Delivery Sched Detail UPL
IF PAR.PDW_Input = 'D';

ENDIF;

