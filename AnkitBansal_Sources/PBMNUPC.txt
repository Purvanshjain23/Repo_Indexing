/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  SUBMITTED PROGRAM TO UPDATE CARRIER RATES           */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PROCESSES AND UPDATES CARRIER RATE ADJUSTMENT       */
/*  DATE      - 05/19/2014                                          */
/*  PROGRAMMER- LARA BUSER                                          */
/*                                                                  */
/*  PARAMETERS:                                                     */
/*  O    &RETURN     - RETURN CODE                                  */
/*  B    &COMPNYN    -  COMPANY CODE 15.5                           */
/*  B    &CARRIER    -  CARRIER CODE                                */
/*  B    &REGION     -  REGION CODE                                 */
/*  B    &WHSE       -  WAREHOUSE CODE                              */
/*  B    &ADJUSTN    -  RATE ADJUSTMENT AMOUNT 15.5                 */
/*  B    &ADJTYPE    -  RATE ADJUSTMENT TYPE - INCR, DECR, PERCENT  */
/*  B    &SELECT     -  SELECT REPORT TYPE - 1, 2, OR 3             */
/********************************************************************/
/* 66/66/6666 XXX E666666  DESCRIPTION OF CHANGES                   */
/*                                                                  */
/********************************************************************/
 PBMNUPC:    PGM        PARM(&RETURN &COMPNYN &CARRIER &REGION &WHSE +
                          &SELECT &ADJUSTN &ADJTYPE)

             DCL        VAR(&RETURN)    TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMPNYN)   TYPE(*DEC)
             DCL        VAR(&COMPNY)    TYPE(*DEC)  LEN(3 0)
             DCL        VAR(&COMPA)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&COMPANY)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&CARRIER)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&REGION)    TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE)      TYPE(*CHAR) LEN(3)
             DCL        VAR(&SELECT)    TYPE(*CHAR) LEN(1)
             DCL        VAR(&ADJUSTN)   TYPE(*DEC)
             DCL        VAR(&ADJUST)    TYPE(*DEC)  LEN(5 2)
             DCL        VAR(&ADJUSTA)   TYPE(*CHAR) LEN(5)
             DCL        VAR(&ADJTYPE)   TYPE(*CHAR) LEN(1)
             DCL        VAR(&RATEADJ)   TYPE(*CHAR) LEN(5)
             DCL        VAR(&NEWRATE)   TYPE(*DEC)  LEN(11 4)
             DCL        VAR(&SEL)       TYPE(*CHAR) LEN(300)
/* ERROR MESSAGE FIELDS                                             */
             DCL        VAR(&MSG)       TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID)     TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)      TYPE(*DEC)  LEN(5 0)
             DCL        VAR(&SUBJECT)   TYPE(*CHAR) LEN(80)

             MONMSG     MSGID(CPF0000)

/*** FOR TESTING ONLY           +
RMVLIBLE PRKDEVQRY              +
MONMSG CPF0000                  +
ADDLIBLE PRKDEVQRY *LAST        +
MONMSG CPF0000               *****/

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&ADJUST) VALUE(&ADJUSTN)
             CHGVAR     VAR(&ADJUSTA) VALUE(&ADJUST)
             CHGVAR     VAR(&COMPNY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPNY)

             DLTF       FILE(QTEMP/PBBHCPL0)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PBBHCPL1)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PBBHCPP)

             CRTDUPOBJ  OBJ(PBBHCPP) FROMLIB(PRKTESTF) +
                          OBJTYPE(*FILE) TOLIB(QTEMP) CST(*NO) TRG(*NO)
             CHGPF      FILE(QTEMP/PBBHCPP) LVLCHK(*NO)
             CRTDUPOBJ  OBJ(PBBHCPL0) FROMLIB(PRKTESTF) +
                          OBJTYPE(*FILE) TOLIB(QTEMP) CST(*NO) TRG(*NO)
             CHGLF      FILE(QTEMP/PBBHCPL0) LVLCHK(*NO)
             CRTDUPOBJ  OBJ(PBBHCPL1) FROMLIB(PRKTESTF) +
                          OBJTYPE(*FILE) TOLIB(QTEMP) CST(*NO) TRG(*NO)
             CHGLF      FILE(QTEMP/PBBHCPL1) LVLCHK(*NO)

/*-------------------------------------------------------------------*/
/* BUILD THE RECORDS IN THE WORK FILE BASED ON THE USER SELECTION    */
/* CRITERIA                                                          */
/*-------------------------------------------------------------------*/

             IF         COND(&SELECT *EQ '1') THEN(EXECUTE +
                          VIEW(PDKHREL3_1) OUTFILE(QTEMP/PBBHCPP) +
                          SETVAR((&COMPANY &COMPA) (&CARRIER +
                          &CARRIER)))

             IF         COND(&SELECT *EQ '2') THEN(EXECUTE +
                          VIEW(PDKHREL3_2) OUTFILE(QTEMP/PBBHCPP) +
                          SETVAR((&COMPANY &COMPA) (&CARRIER +
                          &CARRIER) (&REGION &REGION)))

             IF         COND(&SELECT *EQ '3') THEN(EXECUTE +
                          VIEW(PDKHREL3_3) OUTFILE(QTEMP/PBBHCPP) +
                          SETVAR((&COMPANY &COMPA) (&CARRIER +
                          &CARRIER) (&REGION &REGION) (&WAREHOUSE +
                          &WHSE)))

             IF         COND(&SELECT *EQ '4') THEN(EXECUTE +
                          VIEW(PDKHREL3_4) OUTFILE(QTEMP/PBBHCPP) +
                          SETVAR((&COMPANY &COMPA) (&CARRIER +
                          &CARRIER) (&WAREHOUSE &WHSE)))

/*-------------------------------------------------------------------*/
/* CALL WF PROGRAM TO UPDATE THE RECORDS THAT MATCH THE SELECTION    */
/* OPTION.                                                           */
/*-------------------------------------------------------------------*/
             CALL       PGM(PBMQXFR) PARM(&RETURN &COMPNY &CARRIER +
                          &REGION &WHSE &ADJUST &ADJTYPE &SELECT)

             GOTO       CMDLBL(END)

/*-------------------------USER QUIT--------------------------------*/
 QFILERROR:  CHGVAR     VAR(&RETURN) VALUE('Y2U0005')
             GOTO       CMDLBL(END)

/*----------------------RECEIVE MESSAGES----------------------------*/
 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM
/*------------------------------------------------------------------*/
