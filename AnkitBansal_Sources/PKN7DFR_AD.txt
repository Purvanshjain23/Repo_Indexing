// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKN7DFR
// ?Date: 14.08.2025 Time: 02:52:18
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Commenets
DO;

//?H16853 ISE 01/23/2021 - Increased the length from 5 to 7 and corrected the
//?                        alignment of Buy Order Number field.
ENDDO;

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Process subfile control (Pre-confirm)

//?Accept payment from producer
CASE;

// IF CTL.*CMD key is CF13
IF CTL.*CMD_key = '13';

// CTL.PAD Transaction Date = JOB.*Job date
CTL.PAD_Transaction_Date = JOB.*Job_date;

EXECUTE FUNCTION(Rtv Last Seq# for Dte RT) TYPE(RTVOBJ) FILE(PKEFCPP)           AB1208742;
PARAMETER(CTL.PC_Contract_Code);
PARAMETER(CTL.PAD_Transaction_Date);
PARAMETER(CTL.PAD_Transaction_Sequence);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// CTL.PAD Transaction Sequence = CTL.PAD Transaction Sequence + CON.1
CTL.PAD_Transaction_Sequence = CTL.PAD_Transaction_Sequence + 1;

// Call program Zzz Reserve Acct Dtl  E1.
CALL PROGRAM(Zzz Reserve Acct Dtl  E1) ('PKN8E1R');
PARAMETER(CTL.PC_Contract_Code);
PARAMETER(CTL.PAD_Transaction_Date);
PARAMETER(CTL.PAD_Transaction_Sequence);
PARAMETER('PAY');

// CTL.PAD Transaction Date = CON.*ZERO
CTL.PAD_Transaction_Date = *ZERO;

// CTL.PAD Transaction Sequence = CON.*ZERO
CTL.PAD_Transaction_Sequence = *ZERO;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?Account Adjustment
CASE;

// IF CTL.*CMD key is CF14
IF CTL.*CMD_key = '14';

// CTL.PAD Transaction Date = JOB.*Job date
CTL.PAD_Transaction_Date = JOB.*Job_date;

EXECUTE FUNCTION(Rtv Last Seq# for Dte RT) TYPE(RTVOBJ) FILE(PKEFCPP)           AB1208742;
PARAMETER(CTL.PC_Contract_Code);
PARAMETER(CTL.PAD_Transaction_Date);
PARAMETER(CTL.PAD_Transaction_Sequence);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// CTL.PAD Transaction Sequence = CTL.PAD Transaction Sequence + CON.1
CTL.PAD_Transaction_Sequence = CTL.PAD_Transaction_Sequence + 1;

// Call program Zzz Reserve Acct Dtl  E1.
CALL PROGRAM(Zzz Reserve Acct Dtl  E1) ('PKN8E1R');
PARAMETER(CTL.PC_Contract_Code);
PARAMETER(CTL.PAD_Transaction_Date);
PARAMETER(CTL.PAD_Transaction_Sequence);
PARAMETER('ADJ');

// CTL.PAD Transaction Date = CON.*ZERO
CTL.PAD_Transaction_Date = *ZERO;

// CTL.PAD Transaction Sequence = CON.*ZERO
CTL.PAD_Transaction_Sequence = *ZERO;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

