// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPFDXFR
// ?Date: 14.08.2025 Time: 03:40:10
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** Retrieve overlay info for coversheet
// PAR.CDD Type = CND.Fax
PAR.CDD_Type = 'FX';

// PAR.CDD Department Code = CND.Acknowledgements
PAR.CDD_Department_Code = 'ACKNW';

EXECUTE FUNCTION(RTV CDD for Overlays   RT) TYPE(RTVOBJ) FILE(PPAQREP)          AC1822864;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.CDD_Type);
PARAMETER(PAR.CDD_Department_Code);
PARAMETER(PAR.CDD_Name_of_Overlay);
PARAMETER(PAR.CDD_Program_Name);
PARAMETER(PAR.CDD_Printer_File_Name);
PARAMETER(PAR.CDD_Additional_Object);
PARAMETER(PAR.CDD_Sender_Phone);
PARAMETER(PAR.CDD_Sender_Fax);
PARAMETER(PAR.Output_Queue);
PARAMETER(PAR.Hold_File);
PARAMETER(PAR.Save_File);
PARAMETER(PAR.Source_Drawer);
PARAMETER(PAR.Printer_Device_Type);
PARAMETER(PAR.Page_Length_2);
PARAMETER(PAR.Page_Width_2);
PARAMETER(PAR.Page_LPI);
PARAMETER(PAR.Page_CPI);
PARAMETER(PAR.Page_Overflow);
PARAMETER(PAR.Page_Rotation);
PARAMETER(PAR.CDD_Comment_1);
PARAMETER(PAR.CDD_Comment_2);
PARAMETER(PAR.CDD_Comment_3);
PARAMETER(PAR.CDD_Comment_4);
PARAMETER(PAR.CDD_Comment_5);
PARAMETER(PAR.Record_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(RTV Name Only          RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1493704;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Company_Recipient_Name);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 QUIT;

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// PAR.Buyer Fax Number = CON.*BLANK
PAR.Buyer_Fax_Number = *BLANK;

// PAR.Buyer Fax Name = CON.*BLANK
PAR.Buyer_Fax_Name = *BLANK;

// PAR.Salesperson Name = CON.*BLANK
PAR.Salesperson_Name = *BLANK;

// PAR.Fax Phone Number = CON.*BLANK
PAR.Fax_Phone_Number = *BLANK;

//?Buyer
CASE;

// IF PAR.USR Update Flag is Yes
IF PAR.USR_Update_Flag = 'Y';

EXECUTE FUNCTION(Rtv Cust Fax Buyer NbrsRT) TYPE(RTVOBJ) FILE(PDM3REP)          AC1718279;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(*BLANK);
PARAMETER(PAR.Buyer_Fax_Number);
PARAMETER(PAR.Buyer_Fax_Name);
PARAMETER(LCL.Buyer_Email_Address);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


ENDIF;

//?Rgn Sls Manager
CASE;

// IF PAR.USR Check Y/N Status is yes
IF PAR.USR_Check_Y_N_Status = 'Y';

EXECUTE FUNCTION(RTV Order/ShipState    RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1718268;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.Ship_To_State_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(PDLWREP)          AC1718261;
PARAMETER(LCL.Ship_To_State_Code);
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Fax_Phone_Number);
PARAMETER(LCL.Regional_Salesperson_Code);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.Territory State        NF
 PGM.*Return_code = 'USR0650';

 //?USER: Process Data record

 // PAR.Salesperson Name = CON.*BLANK
 PAR.Salesperson_Name = *BLANK;

 // PAR.Fax Number FF = CON.*BLANK
 PAR.Fax_Number_FF = *BLANK;

 EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(PDLVREP)          AC1718262;
 PARAMETER(DB1.Territory_Code);
 PARAMETER(PAR.Regional_Salesperson_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  QUIT;

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(CAAPREP)          AC1718263;
 PARAMETER(PAR.Regional_Salesperson_Code);
 PARAMETER(PAR.Salesperson_Name);
 PARAMETER(PAR.Fax_Number_FF);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  QUIT;

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 QUIT;

 ENDIF;

}


ENDIF;

//?** Retrieve customer fax if requested
CASE;

// IF PAR.Status Flag 7  Y/N is Yes
IF PAR.Status_Flag_7_Y_N = 'Y';

EXECUTE FUNCTION(RTV Fax number ff      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1698920;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(WRK.Customer_Name);
PARAMETER(WRK.Fax_Number_FF);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 QUIT;

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


ENDIF;

//?** Fax the acknowledgement if at least one fax number is entered.
CASE;

// IF PAR.Buyer Fax Number is Not equal to blanks
IF PAR.Buyer_Fax_Number <> *BLANK;

// OR PAR.Broker Fax Number is Not equal to blanks
OR PAR.Broker_Fax_Number <> *BLANK;

// OR WRK.Fax Number FF is Not equal to blanks
OR WRK.Fax_Number_FF <> *BLANK;

// OR PAR.Fax Phone Number is NE Blanks
OR PAR.Fax_Phone_Number <> *BLANK;

// Call program PRT Acknowledgements UP.
CALL PROGRAM(PRT Acknowledgements UP) ('PDJWPCLP');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*BLANK);
PARAMETER(WRK.Blank_for_4_USR);
PARAMETER(1);
PARAMETER('A');
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER('S');
PARAMETER('FAXQ');
PARAMETER(*NO);
PARAMETER(*NO);
PARAMETER(1);
PARAMETER(*JOBD);
PARAMETER(*ZERO);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER('N');

//?par.fax number ff not used anymore 5/3/13 removed from cond stmt
// Call program PRC Call Telex 3       UP.
CALL PROGRAM(PRC Call Telex 3       UP) ('PPFEUPC');
PARAMETER('PDKOPFR$');
PARAMETER(PAR.Fax_Recipient);
PARAMETER(WRK.Customer_Name);
PARAMETER(*BLANK);
PARAMETER(PAR.Fax_Phone_Number);
PARAMETER('Print Acknowledgements');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.CDD_Type);
PARAMETER(PAR.CDD_Department_Code);
PARAMETER(PAR.CDD_Name_of_Overlay);
PARAMETER(PAR.CDD_Program_Name);
PARAMETER(PAR.CDD_Printer_File_Name);
PARAMETER(PAR.Output_Queue);
PARAMETER(PAR.Hold_File);
PARAMETER(PAR.Save_File);
PARAMETER(PAR.Source_Drawer);
PARAMETER(PAR.Printer_Device_Type);
PARAMETER(PAR.Page_Length_2);
PARAMETER(PAR.Page_Width_2);
PARAMETER(PAR.Page_LPI);
PARAMETER(PAR.Page_CPI);
PARAMETER(PAR.Page_Overflow);
PARAMETER(PAR.Page_Rotation);
PARAMETER(PAR.Buyer_Fax_Number);
PARAMETER(PAR.Buyer_Fax_Name);
PARAMETER(WRK.Fax_Number_FF);
PARAMETER(WRK.Fax_Recipient);
PARAMETER(PAR.Broker_Name);
PARAMETER(PAR.Broker_Fax_Number);

ENDIF;

//?08/06/24 SP S312312 (Add C3 "Email to Broker Usr")
//?** Email acknowledgement if buyer or regional selected
CASE;

// IF PAR.USR Update Flag is Yes
IF PAR.USR_Update_Flag = 'Y';

// OR PAR.USR Check Y/N Status is yes
OR PAR.USR_Check_Y_N_Status = 'Y';

// OR PAR.Email to Broker Usr is Yes
OR PAR.Email_to_Broker_Usr = 'Y';

// LCL.Company Number Pass   USR = PAR.Company Number
LCL.Company_Number_Pass_USR = PAR.Company_Number;

// LCL.Order Number 1  PASS  USR = PAR.Order Number
LCL.Order_Number_1_PASS_USR = PAR.Order_Number;

// LCL.Order Number 2  PASS  USR = PAR.Order Number
LCL.Order_Number_2_PASS_USR = PAR.Order_Number;

// LCL.Customer Number Pass  USR = PAR.Ship To Customer
LCL.Customer_Number_Pass_USR = PAR.Ship_To_Customer;

//?08/21/2017 DN T11489-Use Salesperson Code to set Sales Route Code.
//?08/06/24 SP S312312-Start
//?Get "Email to Broker"
CASE;

// IF PAR.Email to Broker Usr is Yes
IF PAR.Email_to_Broker_Usr = 'Y';

EXECUTE FUNCTION(Rtv Ship to Broker Eml RT) TYPE(RTVOBJ) FILE(OMHOREP)          AC2230823;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(JOB.*Job_date);
PARAMETER(NLL.Broker_Code);
PARAMETER(LCL.Broker_Email_Address);
{
 //?USER: Initialize routine

 // PAR.Broker Code = CND.Not entered
 PAR.Broker_Code = *BLANK;

 // PAR.Broker Email Address = CND.Blank
 PAR.Broker_Email_Address = *BLANK;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Period Beginning Date LE PAR.Date From             USR
 IF DB1.Period_Beginning_Date <= PAR.Date_From_USR;

 // AND DB1.Period Ending Date GE PAR.Date From             USR
 AND DB1.Period_Ending_Date >= PAR.Date_From_USR;

 CASE;

 // IF DB1.Broker Code is Entered
 IF DB1.Broker_Code <> *BLANK;

 EXECUTE FUNCTION(Rtv All details        RT) TYPE(RTVOBJ) FILE(POC5REP)          AC2232586;
 PARAMETER(DB1.Broker_Code);
 PARAMETER(NLL.Broker_Name);
 PARAMETER(NLL.Broker_Address_Line_1);
 PARAMETER(NLL.Broker_Address_Line_2);
 PARAMETER(NLL.Broker_City);
 PARAMETER(NLL.Broker_State);
 PARAMETER(NLL.Broker_Zip);
 PARAMETER(NLL.Broker_Office_Manager);
 PARAMETER(NLL.Broker_Telephone_Number);
 PARAMETER(NLL.Broker_Fax_Number);
 PARAMETER(LCL.Broker_Email_Address);
 PARAMETER(NLL.Broker_G_L_Vendor_Number);
 PARAMETER(NLL.Broker_unused_txt_1);
 PARAMETER(NLL.Broker_M3_Supplier);
 PARAMETER(NLL.Broker_EDI_Trade_Partner);
 PARAMETER(NLL.Broker_Fax_Email_Inv);
 PARAMETER(NLL.Broker_Fax_Email_Prc_Sht);
 PARAMETER(NLL.Payee_Type);
 PARAMETER(NLL.Broker_unused_sts_4);
 PARAMETER(NLL.Salesperson_Code);
 PARAMETER(NLL.EDI_Status_1);
 PARAMETER(NLL.EDI_Status_2);
 PARAMETER(NLL.EDI_Status_3);
 PARAMETER(LCL.Record_Status);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Record Status is Active
 IF LCL.Record_Status = 'A';

 // PAR.Broker Code = DB1.Broker Code
 PAR.Broker_Code = DB1.Broker_Code;

 // PAR.Broker Email Address = LCL.Broker Email Address
 PAR.Broker_Email_Address = LCL.Broker_Email_Address;

 QUIT;

 ENDIF;

 ENDIF;

 ENDIF;

}


//?Get "Email to Broker"
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Broker Email Address = CND.Blank
LCL.Broker_Email_Address = *BLANK;

ENDIF;

// Call program Eml Acknowledgements UP.
CALL PROGRAM(Eml Acknowledgements UP) ('PBIQUPC');
PARAMETER(LCL.Company_Number_Pass_USR);
PARAMETER(LCL.Order_Number_1_PASS_USR);
PARAMETER(LCL.Order_Number_2_PASS_USR);
PARAMETER(LCL.Customer_Number_Pass_USR);
PARAMETER(PAR.Salesperson_Code);
PARAMETER(PAR.USR_Update_Flag);
PARAMETER(PAR.USR_Check_Y_N_Status);
PARAMETER(LCL.Broker_Email_Address);

//?08/06/24 SP S312312-End
ENDIF;

