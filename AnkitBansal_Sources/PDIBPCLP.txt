/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT SALES INVENTORY VARIANCE REPORT                */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - PEG LYONS                                           */
/*  DATE      - 02/15/96                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - THROUGH DATE                              */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT FLAG                           */
/*          &SAVE       - SAVE PRINT FLAG                           */
/*          &COPIESL    - NUMBER OF COPIES                          */
/*          &NIGHTQ     - FORMS TYPE                                */
/*          &FLAG1      - INCLUDE ALL PRODUCTS FLAG                 */
/*          &FLAG2      - INCLUDE CM/DM FLAG                        */
/********************************************************************/

 PDIBPCLP:   PGM        PARM(&COMPL &FDATEL &TDATEL &OUTQ +
                        &HOLD &SAVE &COPIESL &NIGHTQ &FLAG1 &FLAG2)

        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #      */
        DCL    &COMPL     *DEC                    /*  FOR PASSING    */
        DCL    &FDATE     *DEC    (7 0)           /*  FROM DATE      */
        DCL    &FDATEL    *DEC                    /*  FOR PASSING    */
        DCL    &TDATE     *DEC    (7 0)           /*  THROUGH DATE   */
        DCL    &TDATEL    *DEC                    /*  FOR PASSING    */
        DCL    &COPIES    *DEC    (3 0)           /*  # OF COPIES    */
        DCL    &COPIESL   *DEC                    /*  FOR PASSING    */
        DCL    &OUTQ      *CHAR   10              /*  OUTPUT QUEUE   */
        DCL    &NIGHTQ    *CHAR   10              /*  NIGHT JOB QUEUE*/
        DCL    &FLAG1     *CHAR   1               /*  INCLUDE ALL PRD*/
        DCL    &FLAG2     *CHAR   1               /*  INCLUDE CM/DM  */
        DCL    &HOLD       *CHAR   (4)            /* Hold Status     */
        DCL    &SAVE       *CHAR   (4)            /* Save Status     */
        DCL    &PGM       *CHAR   10              /*  PGM NAME       */
        DCL    &COMPA     *CHAR   3               /*  COMPANY ALPHA  */
        DCL    &TDATEA    *CHAR   7               /*  TO DATE ALPHA  */
        DCL    &FDATEA    *CHAR   7               /*  FROM DT ALPHA  */
        DCL    &COMMAND    *CHAR   (512)

/* SEND PROGRAM MESSAGE PARAMETERS  */

        DCL     &PGMO     *CHAR   10              /*  PRINTER FILE   */
        DCL     &A        *CHAR   20              /* QRY FRM DATE    */
        DCL     &B        *CHAR   25              /* QRY TO DATE     */
        DCL     &C        *CHAR   25              /* QRY COMPANY     */
        DCL     &D        *CHAR   70              /* QRY ALL         */
        DCL     &DATA     *CHAR   10              /* DATA FILES      */
        DCL     &DATAH    *CHAR   10              /* HIST FILES      */

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&COMPA) VALUE(&COMP) /* Change to alpha +
                          for message data */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATEA) VALUE(&FDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&TDATE) VALUE(&TDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&TDATEA) VALUE(&TDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&COPIES) VALUE(&COPIESL) /* change to +
                          length for print program */

/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/
             CHGVAR     VAR(&PGM)  VALUE('PDIBPFR')
             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')

/********************************************************************/
/* Retrieve Data Library name and Data History library name         */
/********************************************************************/

/******       COMMENTED OUT 8/27/96   MEA                      ******/
/******       THE REAL HISTORY FILE WILL BE UPDATED NIGHTLY    ******/

/****        CALL       PGM(CAQXXFR) PARM(' ' &DATA &DATAH)       ****/

/*********************************************************************/
/*   CREATE WORK FILES IN QTEMP                                      */
/*********************************************************************/

/******      RMVLIBLE   LIB(QTEMP)                                ****/
/******      MONMSG     MSGID(CPF0000)                            ****/
/******      ADDLIBLE   LIB(QTEMP)                                ****/
/******      MONMSG     MSGID(CPF0000)                            ****/

/******      CRTDUPOBJ  OBJ(OMHSTPP) FROMLIB(&DATA) OBJTYPE(*FILE)****/
/******                   TOLIB(QTEMP) DATA(*YES)                 ****/
/******      CRTDUPOBJ  OBJ(OMHSTPL0) FROMLIB(&DATA) OBJTYPE(*FILE)***/
/******                   TOLIB(QTEMP) DATA(*YES)                 ****/
/******      CRTDUPOBJ  OBJ(OMHSTPM1) FROMLIB(&DATA) OBJTYPE(*FILE)***/
/******                   TOLIB(QTEMP) DATA(*YES)                 ****/

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORT                    */
/*********************************************************************/

             CHGVAR     VAR(&A) VALUE('F4GNDT *GE ' *CAT +
                         &FDATEA)

             CHGVAR     VAR(&B) VALUE('*AND F4GNDT *LE ' *CAT +
                         &TDATEA)

             CHGVAR     VAR(&C) VALUE('*AND F4AIC3 *EQ ' *CAT +
                         &COMPA)

             CHGVAR     VAR(&D) VALUE(&A *BCAT &B *BCAT &C)

             OVRDBF     FILE(OMHSTPM1) SHARE(*YES)
             OPNQRYF    FILE(OMHSTPM1) +
                        QRYSLT(&D) +
                        KEYFLD(*FILE)
/*           CPYFRMQRYF FROMOPNID(OMHSTPM1) TOFILE(SLSFLIB/OMHSTPM1) + */
/*                        MBROPT(*REPLACE) CRTFILE(*YES)  */
/********************************************************************/
/* UPDATE QUERY FILE WITH CURRENT ITEM STRUCTURE VALUES             */
/********************************************************************/

/******       COMMENTED OUT 8/27/96   MEA                      ******/
/******       THE REAL HISTORY FILE WILL BE UPDATED NIGHTLY    ******/
/******      CALL       PGM(PDVOXFR) PARM('')                 *******/

/********************************************************************/
/* REPOSITION TO 1ST RECORD FOR SUBSEQUENT PROCESSING               */
/********************************************************************/

/******      POSDBF     OPNID(OMHSTPM1) POSITION(*START)      *******/

/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

/*********************************************************************/
/*   CALL LISTING PROGRAM                                            */
/*********************************************************************/

             CALL       PGM(&PGM) PARM('' &COMP &FDATE &TDATE &FLAG1 +
                          &FLAG2)
             CLOF       OPNID(OMHSTPM1)
             DLTOVR     FILE(OMHSTPM1)

/******       COMMENTED OUT 8/27/96   MEA                      ******/
/******       THE REAL HISTORY FILE WILL BE UPDATED NIGHTLY    ******/
/*   DELETE WORK FILES IN QTEMP.  */

/*****       DLTF       FILE(QTEMP/OMHSTPL0)                   ******/
/*****       DLTF       FILE(QTEMP/OMHSTPM1)                   ******/
/*****       DLTF       FILE(QTEMP/OMHSTPP)                    ******/

 END:        ENDPGM
