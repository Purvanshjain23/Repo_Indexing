/*********************************************************************/
/* PROGRAM    : PNX2UPC                                              */
/* TITLE      : BUILD EMAIL MESSAGE THEN SEND TO TRAFFIC             */
/* DATE       : 07/01/2011                                           */
/* Description: RECEIVE CITY AND STATE FOR THE ORDER THAT IS         */
/*                MISSING A MILEAGE BETWEEN CITIES RECORD AND        */
/*                SEND AN EMAIL TO BO BOSTIC, TOM ALEMAN, AND        */
/*                MELISSA THOMAS-ROWLES (FROM AND TO CITY/STATE)     */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &FCITY      FROM CITY                                    */
/*    I     &FSTATE     FROM STATE                                   */
/*    I     &TCITY      TO CITY                                      */
/*    I     &TSTATE     TO STATE                                     */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*                                                                   */
/*********************************************************************/
 PNX2UPC:    PGM        PARM(&FCITY &FSTATE &TCITY &TSTATE)

             DCL        VAR(&FCITY)    TYPE(*CHAR) LEN(20)
             DCL        VAR(&FSTATE)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&TCITY)    TYPE(*CHAR) LEN(20)
             DCL        VAR(&TSTATE)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&ESUBJECT) TYPE(*CHAR) LEN(80)
             DCL        VAR(&EADDRESS) TYPE(*CHAR) LEN(50)
             DCL        VAR(&EMESSAGE) TYPE(*CHAR) LEN(150)
             DCL        VAR(&MSG)      TYPE(*CHAR) LEN(256)

/*-------------------------------------------------------------------*/
/* BUILD THE SUBJECT LINE AND THE MESSAGE CONTENTS, THEN             */
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ADDLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF2103 CPF9999)

             CHGVAR     VAR(&EADDRESS) VALUE('TRAFFIC')
/***         CHGVAR     VAR(&EADDRESS) VALUE('PRKDEV')       ***/
             CHGVAR     VAR(&ESUBJECT) VALUE('Mileage Between Cities +
                          missing is missing')
             CHGVAR     VAR(&EMESSAGE) VALUE('Mileage Between Cities +
                          missing:' *CAT &FCITY *TCAT ', ' *CAT +
                          &FSTATE *CAT ' and ' *CAT &TCITY *TCAT ', +
                          ' *CAT &TSTATE)
             ESNDMAIL   RECIPIENT(&EADDRESS) SUBJECT(&ESUBJECT) +
                          MSG(&EMESSAGE)
             MONMSG     MSGID(CPF9999 EML9999 CPF0000 EML0000) +
                          EXEC(GOTO CMDLBL(MSGTRAP))

             CHGVAR     VAR(&MSG) VALUE('EMAIL sent to ' *BCAT +
                          &EADDRESS *BCAT ' - ' *BCAT &EMESSAGE)
             SNDPGRMSG  TOPGR(SEABOARD) MSG(&MSG)
             MONMSG     MSGID(CPF0000)

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    SNDMSG     MSG('ERROR IN ESNDMAIL FOR ' *CAT &EADDRESS +
                          *CAT ' - ' *CAT &EMESSAGE *CAT ' - in +
                          program PNX2UPC') TOUSR(SEABOARD)
             CHGJOB     LOG(4 0 *SECLVL)

 ENDPGM:     RMVLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF0000)

             ENDPGM
