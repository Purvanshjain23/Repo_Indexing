// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLQ9XFR
// ?Date: 14.08.2025 Time: 02:55:15
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// WRK.CC Company Number = CND.Triumph Foods Market
WRK.CC_Company_Number = 960;

EXECUTE FUNCTION(Prc Company Process ValRT) TYPE(RTVOBJ) FILE(PLBEREP)          AB1305890;
PARAMETER(WRK.CC_Company_Number);
PARAMETER('TRKRCVDTME');
{
 //?USER: Initialize routine

 // Call program Rtv Prev Kill Date    XF.
 CALL PROGRAM(Rtv Prev Kill Date    XF) ('PDRUXFR');
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(JOB.*Job_date);
 PARAMETER(WRK.Date_USR);

 //?USER: Process Data record

 CASE;

 // IF DB1.RS Record Status is Active
 IF DB1.RS_Record_Status = 'A';

 CASE;

 // IF DB1.COPR Value is TRKRCVDTME
 IF DB1.COPR_Value = 'TRKRCVDTME';

 //?SELECT THE TRKRCVDTME
 //?AND if inside the print there is a record select
 //?send out a message on the subject line only
 //?the emails load should be the cell phone + the carrier
 // WRK.DT Delivery Date = WRK.Date USR
 WRK.DT_Delivery_Date = WRK.Date_USR;

 EXECUTE FUNCTION(Rtv Company ProcValDtl RT) TYPE(RTVOBJ) FILE(PLBFREP)          AB1305891;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.COPR_Value);
 PARAMETER(WRK.DT_Delivery_Date);
 PARAMETER('R');
 {
  //?USER: Initialize routine

  // WRK.Record was selected usr = CND.*NO
  WRK.Record_was_selected_usr = 'N';

  // Call program Prt Truck WaitTime ExcPF.
  CALL PROGRAM(Prt Truck WaitTime ExcPF) ('PLQ6PFR');
  PARAMETER(PAR.CC_Company_Number);
  PARAMETER(PAR.DT_Delivery_Date);
  PARAMETER(WRK.Record_was_selected_usr);

  // WRK.Spool File Selection = CON.PLQ6PFR$
  WRK.Spool_File_Selection = 'PLQ6PFR$';

  // WRK.@Comment = CON.*BLANK
  WRK.@Comment = *BLANK;

  // WRK.@Comment = CON.Truck Wait Time Exceeded
  WRK.@Comment = 'Truck Wait Time Exceeded';

  // WRK.@Comment = CONCAT(WRK.@Comment,CON. report,CON.*ZERO)
  WRK.@Comment = WRK.@Comment + ' report' (0);

  //?USER: Process Data record

  CASE;

  // IF WRK.Record was selected usr is *YES
  IF WRK.Record_was_selected_usr = 'Y';

  //?Read each record and send report to this email
  // Call program CLP Email Routine MultEUP.
  CALL PROGRAM(CLP Email Routine MultEUP) ('PLRAUPC');
  PARAMETER(WRK.Spool_File_Selection);
  PARAMETER(DB1.CPVD_Email_Line);
  PARAMETER(WRK.@Comment);
  PARAMETER(PAR.Attachment_Txt_10);

  ENDIF;

  //?USER: Exit processing

  // Call program DltSplf              Clp.
  CALL PROGRAM(DltSplf              Clp) ('PLRBUPR');
  PARAMETER(WRK.Spool_File_Selection);

  //?SEND txt WITHOUT ATTACHMENT
  //?ADDRESS SHOULD BE THE CELL PHONE NUMBER + CARRIER
  CASE;

  // IF WRK.Record was selected usr is *YES
  IF WRK.Record_was_selected_usr = 'Y';

  //?SELECT THE TRKNOATTXT
  // LCL.COPR Value = CND.TRKNOATTXT
  LCL.COPR_Value = 'TRKNOATTXT';

  EXECUTE FUNCTION(Rtv Company ValdtlNrpt RT) TYPE(RTVOBJ) FILE(PLBFREP)          AB1306158;
  PARAMETER(PAR.CC_Company_Number);
  PARAMETER(LCL.COPR_Value);
  PARAMETER(PAR.DT_Delivery_Date);
  PARAMETER('NOATT');
  {
   //?USER: Initialize routine

   // WRK.@Comment = CON.*BLANK
   WRK.@Comment = *BLANK;

   // WRK.@Comment = CON.Truck Wait Time Exceeded
   WRK.@Comment = 'Truck Wait Time Exceeded';

   // WRK.@Comment = CONCAT(WRK.@Comment,CON. message,CON.*ZERO)
   WRK.@Comment = WRK.@Comment + ' message' (0);

   //?USER: Process Data record

   CASE;

   // IF WRK.Record was selected usr is *YES
   IF WRK.Record_was_selected_usr = 'Y';

   //?Read each record and send report to this email
   // Call program CLP Email Routine MultEUP.
   CALL PROGRAM(CLP Email Routine MultEUP) ('PLRAUPC');
   PARAMETER(WRK.Spool_File_Selection);
   PARAMETER(DB1.CPVD_Email_Line);
   PARAMETER(WRK.@Comment);
   PARAMETER(PAR.Attachment_Txt_10);

   ENDIF;

  }

  ENDIF;

 }

 ENDIF;

 ENDIF;

}


