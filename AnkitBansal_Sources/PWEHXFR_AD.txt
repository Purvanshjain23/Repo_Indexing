// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWEHXFR
// ?Date: 14.08.2025 Time: 02:56:15
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?E13790 JJH 10/29/18 - BrickFTP for Guymon
//?- Get the FTP Method from the Producer Trading Partner file.
//?- If FTP Method = F(FTP) get the program used to process the Carcass
//?  Summary/Detail from the Company Value: HPEFTPPGM.
//?- If FTP Method = S(SFTP) get the program used to process the Carcass
//?  Summary/Detail from the Company Value: HPESFTPPGM.
//?E10169 JBB 11/27/17 - Payment Producer Post Modifications
//?- Hard Coded Office Dist List User for POMSUPC.
//?E10169 JJH 08/22/17 - Payment Producer Post Modifications
//?- Temporarily disable the logic that submits a job to PRKFTPQ
//?  because we were unable to succesfull test this process in testing.
//?E10169 JJH 08/07/17 - Payment Producer Post Modifications
//?- Submit using QGPL/PORKFTPQ
//?- Submit Create EDI Carcass Summary/Detail
//?- This function was created to submit the EDI Carcass Summary and
//?  Detail as a seperate job.  If this job fails, it can be
//?  cancelled without affecting the other portions of the Post
//?  Producer Payments.
//?- Because this process uses FTP, and SFTP these processes some
//?  sometimes fail and it takes time to resolve, and this causes
//?  other jobs in the job queue to be delayed.
//?- This will allow the Post Payment Processing to complete, instead
//?  of waiting to resolve issues regarding FTP and SFTP.
//?- We have the option to run the ReCreate the EDI files for a
//?  Kill Date (PLGIPVR) as an on-demand job.
ENDDO;

// LCL.Office Dist List USR = CON.PRKHPPST
LCL.Office_Dist_List_USR = 'PRKHPPST';

EXECUTE FUNCTION(Current Time) TYPE(DRVFLD)                                     AB1204687;
PARAMETER(PAR.Current_Time);
{
 //?Calculate derived field

 // Execute function Rtv Current Time      US.
 EXECUTE FUNCTION(Rtv Current Time      US) TYPE(EXCUSRSRC) ('PKM1UFR');
 PARAMETER(PAR.Current_Time);
 {
  C                     TIME           #OA1TM
 }

}


// Retrieve message - 'Creation of HPE EDI File for &3 &1 started at &2.'
LCL.Office_Dist_Message_USR = RTVMSG(PRK0786);
PARAMETER(PAR.Pmt_Current_Payment_Date);
PARAMETER(PAR.Current_Time);
PARAMETER(PAR.CC_Company_Number);

// Call program Snd Pager Msg (MPLUS) UP.
CALL PROGRAM(Snd Pager Msg (MPLUS) UP) ('POMSUPC');
PARAMETER(LCL.Office_Dist_List_USR);
PARAMETER(LCL.Office_Dist_Message_USR);

// Call program Crt EDI Carc Sum/Dtl  XF.
CALL PROGRAM(Crt EDI Carc Sum/Dtl  XF) ('PKLNXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER(PAR.Pmt_Current_Payment_Date);
PARAMETER('S');

EXECUTE FUNCTION(Current Time) TYPE(DRVFLD)                                     AB1204687;
PARAMETER(PAR.Current_Time);
{
 //?Calculate derived field

 // Execute function Rtv Current Time      US.
 EXECUTE FUNCTION(Rtv Current Time      US) TYPE(EXCUSRSRC) ('PKM1UFR');
 PARAMETER(PAR.Current_Time);
 {
  C                     TIME           #OA1TM
 }

}


// Retrieve message - 'Creation of HPE EDI File for &3 &1 completed at &2.'
LCL.Office_Dist_Message_USR = RTVMSG(PRK0787);
PARAMETER(PAR.Pmt_Current_Payment_Date);
PARAMETER(PAR.Current_Time);
PARAMETER(PAR.CC_Company_Number);

// Call program Snd Pager Msg (MPLUS) UP.
CALL PROGRAM(Snd Pager Msg (MPLUS) UP) ('POMSUPC');
PARAMETER(LCL.Office_Dist_List_USR);
PARAMETER(LCL.Office_Dist_Message_USR);

EXECUTE FUNCTION(Current Time) TYPE(DRVFLD)                                     AB1204687;
PARAMETER(PAR.Current_Time);
{
 //?Calculate derived field

 // Execute function Rtv Current Time      US.
 EXECUTE FUNCTION(Rtv Current Time      US) TYPE(EXCUSRSRC) ('PKM1UFR');
 PARAMETER(PAR.Current_Time);
 {
  C                     TIME           #OA1TM
 }

}


// Retrieve message - 'Creation of EDI Message Files for &3 &1 started at &2.'
LCL.Office_Dist_Message_USR = RTVMSG(PRK0793);
PARAMETER(PAR.Pmt_Current_Payment_Date);
PARAMETER(PAR.Current_Time);
PARAMETER(PAR.CC_Company_Number);

// Call program Snd Pager Msg (MPLUS) UP.
CALL PROGRAM(Snd Pager Msg (MPLUS) UP) ('POMSUPC');
PARAMETER(LCL.Office_Dist_List_USR);
PARAMETER(LCL.Office_Dist_Message_USR);

// LCL.Date Alpha USR = CVTVAR(PAR.Pmt Current Payment Date)
LCL.Date_Alpha_USR = CVTVAR(PAR.Pmt_Current_Payment_Date);

// Call program Rtv User Class        UP.
CALL PROGRAM(Rtv User Class        UP) ('PKU3UPR');
PARAMETER(LCL.User_Class_f_usrprf_USR);

//?E13790 JJH 10/30/18 - BrickFTP for Guymon
//?Temporary Logic - Comment out for Test Environments
CASE;

//?Temporary Logic - Comment out for Test Environments
// IF *OTHERWISE
IF *OTHERWISE;

//?- Test the Company Values for which program to run
//?Pass in the trading partner for this producer
//?EDI:Selection on Carcass Summary/Detail- for All Producer that
DO;

//?If this is Guymon, then the cl will read all of the sequels
//?and process them all right behind each other
//?If this is the TF
//?Then all Edi producer will be read to get the trading partner
//?and then the producer event file will be read.  And if there is
//?a one event for this trading number then the edi will be sent.
//?Read The Company Value for - HPEEDICSD
//?This company value record is used to determine which way to
//?process the EDI, at the present time there are two ways
//?One is for Guymon
//?and one is for TF
// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER('HPEEDICSD');
PARAMETER(LCL.EDI_Selection_Process_Usr);

// LCL.EDI Sel Process Pgm Usr = CND.EDISUMDTL
LCL.EDI_Sel_Process_Pgm_Usr = 'EDISUMDTL';

CASE;

// IF LCL.EDI Selection Process Usr EQ LCL.EDI Sel Process Pgm Usr
IF LCL.EDI_Selection_Process_Usr = LCL.EDI_Sel_Process_Pgm_Usr;

// Call program EDI Carcass Sum/DtlGUYUP.
CALL PROGRAM(EDI Carcass Sum/DtlGUYUP) ('EDISUMDTL');
PARAMETER(LCL.Date_Alpha_USR);
PARAMETER(*BLANK);

// IF *OTHERWISE
IF *OTHERWISE;

// LCL.EDI Sel Process Pgm Usr = CND.EDISUMDTTF
LCL.EDI_Sel_Process_Pgm_Usr = 'EDISUMDTTF';

//?R10169 JJH 07/10/17 - Add logic to Print Emails during Testing
//?This will be used for 960, 961 and 440.
//?440 will always use Email until we develop .NET
CASE;

// IF LCL.EDI Selection Process Usr EQ LCL.EDI Sel Process Pgm Usr
IF LCL.EDI_Selection_Process_Usr = LCL.EDI_Sel_Process_Pgm_Usr;

// Call program Crt EDI CarcSumDtlEvn XF.
CALL PROGRAM(Crt EDI CarcSumDtlEvn XF) ('PLGDXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER(LCL.Date_Alpha_USR);

ENDIF;

ENDIF;

ENDDO;

ENDIF;

