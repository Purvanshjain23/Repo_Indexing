/********************************************************************/
/*                                                                  */
/* 5716SS1 V3R6M0 950929     RTVCLSRC Output     05/09/97 15:17:57  */
/*                                                                  */
/* Program name . . . . . . . . . . . . . . :   PDX9CLP           PN*/
/* Library name . . . . . . . . . . . . . . :   OMSDEVGEN         PL*/
/* Original source file . . . . . . . . . . :   QCLSRC            SN*/
/* Library name . . . . . . . . . . . . . . :   OMSDEVGEN         SL*/
/* Original source member . . . . . . . . . :   PDX9CLP           SM*/
/* Source file change                                               */
/*   date/time  . . . . . . . . . . . . . . :   05/09/97 15:01:54 SC*/
/*                                                                ED*/
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR DAILY HOLDOVER RPT.*/
/*             COMPANY, SCHEDULED SHIP DATE                         */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT DAILY HOLDOVER REPORT                         */
/*  DATE      -  3/26/97                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FRMDATN    - SCHEDULED SHIP DATE                       */
/*          &THRDATN    - NOT CURRENT USED                          */
/*          &RPTTYP     - REPORT TYPE 1: ALL HOLDOVERS 2: 1 DAY     */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/********************************************************************/
/* 12/97 PLL  OMS304   ADDED NEW REPORT TYPE                        */
/*                     ALSO CHANGED SELECTION FOR BOTH RPTS TO      */
/*                     EXCLUDE PR AND CR SHIPPING METHODS           */
/* 10/00 RMC  C11300   RPT TYPE 2 - INCLUDE RECORDS WITH SHIP DEAD- */
/*                     LINE LE 12 HOURS FROM THE REPORT RUN TIME    */
/* 08/01 RMC  PK0327   RPT TYPE 3 - BUSINESS DAY 0600-0559 AM :     */
/*                     THE PGM CALCULATES THE BUSINESS DAY AS THE   */
/*                     SCHED SHIP DATE AT 6:00 AM THROUGH THE NEXT  */
/*                     DAY AT 5:59 AM. THIS DATE RANGE IS COMPARED  */
/*                     TO THE DEADLINE DEPARTURE DATE/TIME ON THE   */
/*                     LOAD TO DETERMINE ITS INCLUSION ON THE RPT.  */
/*                     EX. SCHED SHIP DATE = 08/17/01, THE BUSINESS */
/*                     DAY = 8/17/01 0600AM THRU 8/18/01 0559AM     */
/*                     AND WILL BE COMPARED TO THE LOAD DEPART DT/TM*/
/* 05/04 RMC  PKTR01   MAKE COMPANY OPTIONAL IN QRYSLT              */
/* 06/22/06 RMC        REPORT 2 - IF THE DEPARTURE IS 0 & LOAD IS   */
/*                     S/I  DONT COMP TO BOL CMPLT DT/TM            */
/* 06/29/06 RMC        REPORT 2 - IF THE DEPARTURE IS 0 & LOAD IS   */
/*                     S/I COMP DEADL DEPRTR <= CURR + 12 HOURS     */
/* 10/21/08 LJB E00240 ADD SELECT/OMIT FLAG AND 10 WAREHOUSES       */
/* 05/18/09 LJB E00393 RPT TYPE 2 & 3, ADD TEST FOR DEADLINE DEPART */
/*                     DATE <> ZEROS TO ELIMINATE SHIPMENTS WITH    */
/*                     DATES THAT ARE IN THE FUTURE                 */
/* 04/02/2014 LJB E003072  PASS IN "TARGET DEILVERY DATE"           */
/* 03/05/2015 LJB E003914  PASS IN THE CARRIER CODE                 */
/* 04/17/2015 LJB E004076  PASS IN A SEND Y/N FLAG-DON'T EMAIL IF N */
/*                     OR IF EMAIL ADDRESS IS BLANKS                */
/*                     ADD ESEND/EMAIL COMMAND                      */
/* 06/13/2023 PIO REPLACE OPNQRYF WITH OPNSQLF FOR OMFJCPLF FILE    */
/*                ADDED NEEDED OVRDBF AROUND THE COMMAND            */
/*                CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=*/
/*                *GT TO > IN &D                                    */
/********************************************************************/
 PDX9CLP:    PGM        PARM(&COMPNYN &FRMDATN &THRDATN &RPTTYP +
                          &FRMTIMN &THRTIMN &OUTQ &HOLD &SAVE +
                          &COPYN &NIGHTQ &WHSE1 &WHSE2 &WHSE3 +
                          &WHSE4 &WHSE5 &WHSE6 &WHSE7 &WHSE8 &WHSE9 +
                          &WHSE10 &SELOMIT &DELIVDTN &CARRIER +
                          &SENDYN &EMAIL1 &EMAIL2)

/* PARMS                                                                      */
             DCL        VAR(&COMPNYN) TYPE(*DEC)
             DCL        VAR(&FRMDATN) TYPE(*DEC)
             DCL        VAR(&THRDATN) TYPE(*DEC)
             DCL        VAR(&FRMTIMN) TYPE(*DEC)
             DCL        VAR(&THRTIMN) TYPE(*DEC)
             DCL        VAR(&DELIVDTN) TYPE(*DEC)
             DCL        VAR(&DELIVDT) TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&RPTTYP)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&DESC)    TYPE(*CHAR) LEN(25)
             DCL        VAR(&COPYN)   TYPE(*DEC)
             DCL        VAR(&OUTQ)    TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD)    TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE)    TYPE(*CHAR) LEN(4)
             DCL        VAR(&NIGHTQ)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&COMMAND) TYPE(*CHAR) LEN(512)
             DCL        VAR(&SELOMIT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&WHSE1) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE2) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE3) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE4) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE5) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE6) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE7) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE8) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE9) TYPE(*CHAR) LEN(3)
             DCL        VAR(&WHSE10) TYPE(*CHAR) LEN(3)
E003914:     DCL        VAR(&CARRIER) TYPE(*CHAR) LEN(3)
E004076:     DCL        VAR(&SENDYN)  TYPE(*CHAR) LEN(1)
E004076_2:   DCL        VAR(&EMAIL)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&EMAIL1)  TYPE(*CHAR) LEN(25)
             DCL        VAR(&EMAIL2)  TYPE(*CHAR) LEN(25)
             DCL        VAR(&SUBJECT) TYPE(*CHAR) LEN(100)

/* INTERNAL FIELDS                                                            */
             DCL        VAR(&COPY)    TYPE(*DEC) LEN(2 0)
             DCL        VAR(&COMPANY) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&FRMDAT)  TYPE(*DEC) LEN(7 0)
             DCL        VAR(&CURDAT)  TYPE(*CHAR) LEN(6)
             DCL        VAR(&CURTIM)  TYPE(*CHAR) LEN(8)
             DCL        VAR(&CURTIM6) TYPE(*CHAR) LEN(6)
             DCL        VAR(&CURYYA)  TYPE(*CHAR) LEN(2)
             DCL        VAR(&CURYY)   TYPE(*DEC)  LEN(2 0)
C11300:      DCL        VAR(&ENDDAT)  TYPE(*DEC) LEN(7 0)
             DCL        VAR(&ENDTIM) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&CURDAT7)  TYPE(*DEC) LEN(7 0)
             DCL        VAR(&FRMTIM6) TYPE(*DEC) LEN(6)
             DCL        VAR(&HOURS) TYPE(*DEC) LEN(5 0) VALUE(12)
             DCL        VAR(&ENDDATA)  TYPE(*CHAR) LEN(7)
             DCL        VAR(&ENDTIMA) TYPE(*CHAR) LEN(6)

/* OPNQRYF FIELDS                                                             */
             DCL        VAR(&COMPA)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&FRMDATA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&CURDATA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&RPTCO)   TYPE(*CHAR) LEN(14)
             DCL        VAR(&FRMTIMA) TYPE(*CHAR) LEN(6)
             DCL        VAR(&THRTIMA) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FRMTIM)  TYPE(*DEC) LEN(6 0)
             DCL        VAR(&THRTIM)  TYPE(*DEC) LEN(6 0)
             DCL        VAR(&THRDAT)  TYPE(*DEC) LEN(7 0)
             DCL        VAR(&THRDATA) TYPE(*CHAR) LEN(7)

             DCL        VAR(&A)       TYPE(*CHAR) LEN(25)
             DCL        VAR(&B)       TYPE(*CHAR) LEN(75)
             DCL        VAR(&BB)      TYPE(*CHAR) LEN(50)
             DCL        VAR(&C)       TYPE(*CHAR) LEN(150)
             DCL        VAR(&F)       TYPE(*CHAR) LEN(150)
             DCL        VAR(&G)       TYPE(*CHAR) LEN(200)
             DCL        VAR(&H)       TYPE(*CHAR) LEN(150)
             DCL        VAR(&D)       TYPE(*CHAR) LEN(500)
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&FRMDAT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FRMDAT)
             CHGVAR     VAR(&DELIVDT) VALUE(&DELIVDTN)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)

             RTVSYSVAL  SYSVAL(QDATE) RTNVAR(&CURDAT)
             CVTDAT     DATE(&CURDAT) TOVAR(&CURDATA) FROMFMT(*MDY) +
                          TOFMT(*CYMD) TOSEP(*NONE)

/*           CVTDAT     DATE(&CURDAT) TOVAR(&CURDAT) FROMFMT(*MDY) +
                         TOFMT(*YMD) TOSEP(*NONE)                  +
                                                                   +
             CHGVAR VAR(&CURYYA) VALUE(%SUBSTRING(&CURDAT 1 2))    +
             CHGVAR VAR(&CURYY)  VALUE(&CURYYA)                    +
                                                                   +
             IF (&CURYYA *LT '40') +                               +
                CHGVAR VAR(&CURDATA) VALUE('1' *CAT &CURDAT)       +
             ELSE +                                                +
                CHGVAR VAR(&CURDATA) VALUE('0' *CAT &CURDAT)       */

/* FOR RPT TYPE 2:  USE CURRENT DATE/TIME FOR COMPARISON          */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&CURTIM)
             CHGVAR VAR(&CURTIM6) VALUE(%SST(&CURTIM 1 6))

/* RMC C11300 FOR RPT TYPE 2:  GET CURRENT DATE/TIME + 12 HOURS    */
             CHGVAR VAR(&FRMTIM6) VALUE(&CURTIM6)
             CHGVAR VAR(&CURDAT7) VALUE(&CURDATA)
             CALL       PGM(POIUXFR) PARM('' &CURDAT7 &FRMTIM6 +
                          &ENDDAT &ENDTIM &HOURS)
             CHGVAR VAR(&ENDDATA) VALUE(&ENDDAT)
             CHGVAR VAR(&ENDTIMA) VALUE(&ENDTIM)

/* RPT3  -- FROM TIME AND THRU TIME                    */
             CHGVAR     VAR(&FRMTIM) VALUE(&FRMTIMN)
             CHGVAR     VAR(&FRMTIMA) VALUE(&FRMTIM)
             CHGVAR     VAR(&THRTIM) VALUE(&THRTIMN)
             CHGVAR     VAR(&THRTIMA) VALUE(&THRTIM)
             CHGVAR     VAR(&THRDAT) VALUE(&THRDATN)
             CHGVAR     VAR(&THRDATA) VALUE(&THRDAT)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORTING                 */
/*********************************************************************/
/* COMPANY                                                           */
             IF         COND(&COMPA *NE '000') THEN(DO)
   /*PIO     CHGVAR     VAR(&A) VALUE('FJAIC3 *EQ ' *CAT &COMPA +  +
                          *BCAT '*AND')                           */
   /*PIO*/   CHGVAR     VAR(&A) VALUE('FJAIC3 =   ' *CAT &COMPA +
                          *BCAT ' AND')
             ENDDO

             IF (&RPTTYP *EQ '2') GOTO RPT2
             IF (&RPTTYP *EQ '3') GOTO RPT3

/* * * * * * * * REPORT TYPE 1 * * * * * * * * * * * * * * * * * * * */
/*'SCHED SHP DT EQ FRMDATA' & 'BOL COMPLETE DATE GT SCHED SHP DT'  */
 /*PIO  RPT1:        CHGVAR     VAR(&BB) VALUE('*AND FJJ7DT *GT FJAODT') */
 /*PIO*/ RPT1:        CHGVAR     VAR(&BB) VALUE(' AND FJJ7DT >   FJAODT')

  /*PIO      CHGVAR     VAR(&B) VALUE('*AND FJAODT *EQ ' *CAT + +
                          &FRMDATA *BCAT &BB)                  */
  /*PIO*/    CHGVAR     VAR(&B) VALUE(' AND FJAODT =   ' *CAT +
                          &FRMDATA *BCAT &BB)

/* OR 'LOAD IS NOT SHIPPED AND SCHED SHIP DATE IS LE FRMDATA'  */
  /*PIO      CHGVAR     VAR(&G) VALUE('*OR *NOT (FJPKST *EQ +     +
                          %VALUES("I" "S")) *AND FJAODT *LE ' *CAT + +
                          &FRMDATA)                                */
  /*PIO*/    CHGVAR     VAR(&G) VALUE(' OR  NOT (FJPKST  = "I" +
                        OR  FJPKST  = "S" )  AND FJAODT  <= ' *CAT +
                          &FRMDATA)

/* EXCLUDE CR,PR SHIPPING METHOD   (RAIL)                           */
  /*PIO      CHGVAR   VAR(&C) VALUE('*NOT (FJQ2CD *EQ +  +
                %VALUES("CR" "PR"))')                   */
  /*PIO*/    CHGVAR   VAR(&C) VALUE(' NOT (FJQ2CD  = "CR" OR +
                FJQ2CD  = "PR")')


             CHGVAR     VAR(&F) VALUE(&A *BCAT &C *BCAT &B)
             CHGVAR     VAR(&D) VALUE(&F *BCAT &G)
             CHGVAR     VAR(%SST(&RPTCO 1 3)) VALUE(&COMPA)

  /*PIO      OVRDBF     FILE(OMFJCPLF) SHARE(*YES)   +
             OPNQRYF    FILE((OMFJCPLF)) +           +
                            QRYSLT(&D) +             +
                            KEYFLD(*FILE)           */

  /*PIO*/    OVRDBF     FILE(OMFJCPP) TOFILE(OMFJCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMFJCPP Where  ' *BCAT &D +
                          *BCAT ' ORDER BY FJVPCD ASC, FJAODT ASC, +
                          FJRMNB ASC') OPNID(OMFJCPLF) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@FJCPN3) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OMFJCPLF) TOFILE(OMFJCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

             GOTO PRINTIT

/* * * * * * * * * REPORT TYPE 2 * * * * * * * * * * * * * * * * * */
/* IF LOAD NOT SHIPPED:  EXCLUDING STATUS "E"                      */
/*   DEADLINE DEP DTE <> ZEROS AND     <-----LJB 5/18/09 E00393    */
/*   DEADLINE DEP DTE < TODAY OR                                   */
/*   DEADLINE DEP DTE = TODAY & DEADLINE DEP TME < NOW)            */
/* 10/17/00 RMC: C11300 CHANGE AS FOLLOWS:                         */
/*   DEADLINE DEP DTE <= (NOW + 12 HOURS)                          */
/* IF LOAD SHIPPED:                                                */
/*   DEADLINE DEP DTE >= SELECTED DATE &                           */
/*   DEADLINE DEP DTE/TME <= CURR+12 HOURS        <--- 6/29/06 DO  */
/* ALSO EXCLUDE PR,CR,CT SHIPPING METHODS (RAIL & COLLECT)         */
/* 12/31/97 PLL: CHANGE AS FOLLOWS                                 */
/* IF TRUCK DEPARTURE DATE =  0, DO AS ABOVE                       */
/* IF TRUCK DEPARTURE DATE <> 0:                                   */
/*   DEADLINE DEP DTE >= SELECTED DATE                             */
/*   DEADLINE DEP DTE/TME <= TRUCK DEPART DTE/TME                  */
/* &B:  EXCLUDE BUYERS TRUCK AND RAIL                              */
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 /*PIO RPT2:        CHGVAR VAR(&B) VALUE('FJQ2CD *NE +  +
                     "CT" *AND FJQ2CD *NE "CR" *AND FJQ2CD *NE "PR"') */
 /*PIO*/ RPT2:        CHGVAR VAR(&B) VALUE('FJQ2CD  <> +
                     "CT"  AND FJQ2CD <>  "CR"  AND FJQ2CD  <> "PR"')

/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
/* &C:  TRUCK DEPART DATE <> ZEROS AND                             */
/*      DEADLINE DEPART DATE >= DATE REQUESTED AND                 */
/*      DEADLINE DEPART DATE <  TRUCK DEPART DATE                  */
/*      OR DEADLINE DEPART DATE = TRUCK DEPART DATE AND            */
/*      DEADLINE DEPART TIME <= TRUCK DEPART TIME                  */
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
   /*PIO     CHGVAR     VAR(&C) VALUE('*AND ((FJKIDT *NE 0 *AND +    +
                           FJKZDT *GE ' *CAT &FRMDATA *CAT ' *AND +  +
                          (FJKZDT *LT FJKIDT  *OR (FJKZDT *EQ +      +
                          FJKIDT *AND FJAXTM *LE FJASTM)))')        */
   /*PIO*/   CHGVAR     VAR(&C) VALUE(' AND ((FJKIDT <>  0  AND +
                           FJKZDT >=  ' *CAT &FRMDATA *CAT '  AND +
                          (FJKZDT  <  FJKIDT   OR (FJKZDT  =  +
                          FJKIDT  AND FJAXTM <=  FJASTM)))')
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
/* &G:  TRUCK DEPART DATE = 0 AND LOAD STATUS =  U, L, OR C         */
/*      AND DEADLINE DEPART DATE NOT ZEROS                          */
/*      AND DEADLINE DEPART DATE IS LT 12 HOURS FROM NOW            */
/*      OR  DEADLINE DEPART DATE = 12 HOURS FROM NOW (IE TOMORROW)  */
/*      AND DEADLINE DEPART TIME IS <= 12 HOURS FROM NOW            */
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
  /*PIO      CHGVAR     VAR(&G) VALUE('*OR (FJKIDT *EQ 0 *AND +    +
                          ((FJPKST *EQ %VALUES("U" "L" "C") *AND + +
                          (FJKZDT *NE 0 *AND (FJKZDT *LT ' *CAT +  +
                          &ENDDATA *CAT ' *OR (FJKZDT *EQ ' *CAT + +
                          &ENDDATA *CAT ' *AND FJAXTM *LE ' *CAT + +
                          &ENDTIMA *CAT '))))')                  */
 /*PIO*/     CHGVAR     VAR(&G) VALUE(' OR (FJKIDT  =  0  AND +
                          (((FJPKST = "U" OR FJPKST = "L" OR +
                            FJPKST = "C" )  AND +
                          (FJKZDT <>  0  AND (FJKZDT  <  ' *CAT +
                          &ENDDATA *CAT '  OR (FJKZDT  =  ' *CAT +
                          &ENDDATA *CAT '  AND FJAXTM  <= ' *CAT +
                          &ENDTIMA *CAT '))))')
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
/* &F:  LOAD STATUS IS SHIPPED OR INVOICED                          */
/*      AND DEADLINE DEPART DATE IS GREATER THAN REQUESTED DATE     */
/*      AND DEADLINE DEPART DATE IS LT 12 HOURS FROM NOW            */
/*      OR  DEADLINE DEPART DATE = 12 HOURS FROM NOW (IE TOMORROW)  */
/*      AND DEADLINE DEPART TIME IS <= 12 HOURS FROM NOW            */
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 /*PIO       CHGVAR     VAR(&F) VALUE('*OR (FJPKST *EQ  %VALUES(I" +  +
                          "S") *AND FJKZDT *GE ' *CAT &FRMDATA *CAT + +
                          ' *OR  (FJKZDT *EQ ' *CAT &ENDDATA *CAT ' + +
                          *AND FJAXTM *LE ' *CAT &ENDTIMA *CAT +      +
                          ')))))')                             */
 /*PIO*/     CHGVAR     VAR(&F) VALUE(' OR ((FJPKST  = "I" OR FJPKST = +
                          "S")  AND FJKZDT >=  ' *CAT &FRMDATA *CAT +
                          '  OR  (FJKZDT  =  ' *CAT &ENDDATA *CAT ' +
                           AND FJAXTM <=  ' *CAT &ENDTIMA *CAT +
                          ')))))')

/********    CHGVAR     VAR(&F) VALUE('*OR (FJPKST *EQ %VALUES("I" +
                          "S") ' *CAT '*AND FJKZDT *GE ' *CAT +
                          &FRMDATA *CAT ' *AND (FJKZDT *LT ' *CAT +
                          &ENDDATA *CAT ' *OR  (FJKZDT *EQ ' *CAT +
                          &ENDDATA *CAT ' *AND FJAXTM *LE ' *CAT +
                          &ENDTIMA *CAT '))))))')     ***/

             CHGVAR VAR(&D) +
              VALUE(&A *BCAT &B *BCAT &C *BCAT &G *BCAT &F)

  /*PIO      OVRDBF     FILE(OMFJCPLF) SHARE(*YES)   +
             OPNQRYF    FILE((OMFJCPLF)) +           +
                            QRYSLT(&D) +             +
                            KEYFLD(*FILE)           */

 /*PIO*/     OVRDBF     FILE(OMFJCPP) TOFILE(OMFJCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMFJCPP Where  ' *BCAT &D +
                          *BCAT ' ORDER BY FJVPCD ASC, FJAODT ASC, +
                          FJRMNB ASC') OPNID(OMFJCPLF) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@FJCPN3) +
                          ALWCPY(*IFRQD) /*PIO*/
 /*PIO*/     OVRDBF     FILE(OMFJCPLF) TOFILE(OMFJCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


             GOTO PRINTIT

/* * * * * * * * REPORT TYPE 3 * * * * * * * * * * * * * * * * * * * */
/*'DEADL DPT DT/TM BETWEEN FRMDATA/FRMTIM6 AND ENDDATA/ENDTIMA       */
/*         &   'BOL COMPLETE DATE GT SCHED SHP DT'                   */
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
RPT3:
  /*PIO      CHGVAR     VAR(&C) VALUE('((FJKZDT *EQ' *BCAT +        +
                          &FRMDATA *BCAT '*AND FJAXTM *GE' *BCAT +  +
                          &FRMTIMA *CAT ') *OR (FJKZDT *EQ' *BCAT + +
                          &THRDATA *BCAT '*AND FJAXTM *LE ' *CAT +  +
                          &THRTIMA *CAT '))')                      */
  /*PIO*/    CHGVAR     VAR(&C) VALUE('((FJKZDT =  ' *BCAT +
                          &FRMDATA *BCAT ' AND FJAXTM >= ' *BCAT +
                          &FRMTIMA *CAT ')  OR (FJKZDT =  ' *BCAT +
                          &THRDATA *BCAT ' AND FJAXTM <=  ' *CAT +
                          &THRTIMA *CAT '))')

 /*PIO       CHGVAR     VAR(&BB) VALUE('*AND FJJ7DT *GT FJAODT') */
 /*PIO*/     CHGVAR     VAR(&BB) VALUE(' AND FJJ7DT  >  FJAODT')
             CHGVAR     VAR(&F) VALUE(&A *BCAT &C *BCAT &BB)

/* EXCLUDE CR,PR SHIPPING METHOD                                    */
  /*PIO      CHGVAR     VAR(&H) VALUE('*AND *NOT (FJQ2CD *EQ + +
                          %VALUES("CR" "PR"))')           */
  /*PIO*/    CHGVAR     VAR(&H) VALUE(' AND  NOT (FJQ2CD = "CR" OR +
                          FJQ2CD = "PR")')

/* OR 'LOAD IS NOT SHIPPED AND DEADL DEPART DATE IS LE FRMDATA      */
/* AND DEADLINE DEPART DATE IS NOT ZEROS   <--- LJB 5/18/09 E00393  */
   /*PIO     CHGVAR     VAR(&G) VALUE('*OR *NOT (FJPKST *EQ +     +
                          %VALUES("I" "S")) *AND FJKZDT *NE 0  +  +
                          *AND FJKZDT *LE ' *CAT &FRMDATA)       */
   /*PIO*/   CHGVAR     VAR(&G) VALUE(' OR  NOT (FJPKST  = "I" OR +
                          FJPKST  = "S" )  AND FJKZDT <>  0  +
                           AND FJKZDT <=  ' *CAT &FRMDATA)

             CHGVAR     VAR(&D) VALUE(&F *BCAT &H *BCAT &G)

  /*PIO      OVRDBF     FILE(OMFJCPLF) SHARE(*YES) +
             OPNQRYF    FILE((OMFJCPLF)) +         +
                            QRYSLT(&D) +           +
                            KEYFLD(*FILE)         */

  /*PIO*/    OVRDBF     FILE(OMFJCPP) TOFILE(OMFJCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMFJCPP Where ' *BCAT &D +
                          *BCAT ' ORDER BY FJVPCD ASC, FJAODT ASC, +
                          FJRMNB ASC') OPNID(OMFJCPLF) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@FJCPN3) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OMFJCPLF) TOFILE(OMFJCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


             GOTO PRINTIT
/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
PRINTIT:     SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDX9PFR$) OUTQ(&OUTQ) +
                          DRAWER(1) COPIES(&COPY) HOLD(&HOLD) +
                          SAVE(&SAVE)

             IF         COND(&EMAIL *NE '           ') THEN(DO)
             CHGVAR     VAR(&HOLD) VALUE(*YES)
             CHGVAR     VAR(&SAVE) VALUE(*YES)
             ENDDO
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

/*********************************************************************/
/*   CALL PRINT PROGRAM                  (E003914 ADD CARRIER CODE)  */
/*********************************************************************/
             CHGVAR     VAR(&SENDYN) VALUE(' ')
             CALL       PGM(PDX9PFR) PARM(' ' &COMPANY &FRMDAT +
                          &RPTTYP &THRDAT &DELIVDT &FRMTIM &THRTIM +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 &WHSE5 &WHSE6 +
                          &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SELOMIT +
                          &CARRIER &SENDYN)

/* ONLY EMAIL IF AN EMAIL ADDRESS WAS PROVIDED AND IF THERE WAS      */
/* AT LEAST ONE RECORD ON THE REPORT         E004076                 */
             IF         COND(&EMAIL1 *GT '               ') THEN(DO)
             IF         COND(&SENDYN *EQ 'Y') THEN(DO)
             IF         COND(&CARRIER *NE 'BUY') THEN(DO)
             CHGVAR     VAR(&EMAIL) VALUE(&EMAIL1 *TCAT &EMAIL2)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&SUBJECT) VALUE('Daily Holdover Report' +
                          *BCAT 'for' *BCAT &CARRIER *CAT '/' *CAT +
                          &COMPA)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&SUBJECT) +
                          MSG(&SUBJECT) ATTLIST((* *DFT *N PDX9PFR$))
             ENDDO
             ENDDO
             ENDDO

             CLOF       OPNID(OMFJCPLF)
 /*PIO*/     DLTOVR     FILE(*ALL) LVL(*JOB)

 END:        ENDPGM
