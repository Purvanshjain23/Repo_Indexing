// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBX9XFR
// ?Date: 14.08.2025 Time: 03:49:44
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?TMS Order Sweep Error
//?Get when last error check was run, and run it again, upd last run dt/tm
EXECUTE FUNCTION(Rtv Last Upd per Code  RT) TYPE(RTVOBJ) FILE(PDMXCPP)          AC1548400;
PARAMETER(360);
PARAMETER('TMSERO');
PARAMETER(LCL.AS_Last_Update_Date);
PARAMETER(LCL.AS_Last_Update_Time);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


EXECUTE FUNCTION(RTV Alpha Value W/O Co RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1754635;
PARAMETER('TMSERO');
PARAMETER(LCL.Email_addr_1);
{
 //?USER: Initialize routine

 // PAR.System Value Alpha = CON.*BLANK
 PAR.System_Value_Alpha = *BLANK;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// LCL.Numeric Field Needed  USR = LCL.AS Last Update Date
LCL.Numeric_Field_Needed_USR = LCL.AS_Last_Update_Date;

// Execute command - 'EXECUTE SQL VIEW'
EXECUTE COMMAND(USR4956);
PARAMETER(LCL.Email_addr_1);
PARAMETER(LCL.Numeric_Field_Needed_USR);
PARAMETER(LCL.AS_Last_Update_Time);

EXECUTE FUNCTION(Rtv/Chg Last Dt Cllctn RT) TYPE(RTVOBJ) FILE(PDMXCPP)          AC1547055;
PARAMETER(360);
PARAMETER('TMSERO');
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Last Data Collectn CH) TYPE(CHGOBJ) FILE(PDMXCPP)          AC1546931;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AS_Data_Collection_Code);
 PARAMETER(DB1.AS_Hours_Between_Cllctns);
 PARAMETER(DB1.AS_Minutes_Btwn_Cllctns);
 PARAMETER(JOB.*Job_date);
 PARAMETER(JOB.*Job_time);
 PARAMETER(DB1.AS_Shift_Uploaded);
 PARAMETER(DB1.AS_Data_Collection_Desc);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Record_Status);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


//?TMS Load Build
//?Get when last error check was run, and run it again, upd last run dt/tm
EXECUTE FUNCTION(Rtv Last Upd per Code  RT) TYPE(RTVOBJ) FILE(PDMXCPP)          AC1548400;
PARAMETER(360);
PARAMETER('TMSERL');
PARAMETER(LCL.AS_Last_Update_Date);
PARAMETER(LCL.AS_Last_Update_Time);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// WRK.Date (Alpha) USR = CVTVAR(LCL.AS Last Update Date)
WRK.Date_Alpha_USR = CVTVAR(LCL.AS_Last_Update_Date);

// WRK.Date (Char-6) USR = SUBSTRING(WRK.Date (Alpha) USR,CON.2,CON.6)
WRK.Date_Char_6_USR = SUBSTRING(WRK.Date_Alpha_USR:2:6);

// WRK.Date (Char-8) USR = CONCAT(CON.20,WRK.Date (Char-6) USR,CON.*ZERO)
WRK.Date_Char_8_USR = '20' + WRK.Date_Char_6_USR (*ZERO);

// LCL.DATE = CVTVAR(WRK.Date (Char-8) USR)
LCL.DATE = CVTVAR(WRK.Date_Char_8_USR);

// LCL.USR Time 4.0 = LCL.AS Last Update Time / CON.100 *
LCL.USR_Time_4_0 = LCL.AS_Last_Update_Time / 100;

// WRK.Time  4A             USR = LCL.USR Time 4.0
WRK.Time_4A_USR = LCL.USR_Time_4_0;

EXECUTE FUNCTION(RTV Alpha Value W/O Co RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1754635;
PARAMETER('TMSERL');
PARAMETER(LCL.Email_addr_1);
{
 //?USER: Initialize routine

 // PAR.System Value Alpha = CON.*BLANK
 PAR.System_Value_Alpha = *BLANK;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// Execute command - 'EXECUTE SQL VIEW'
EXECUTE COMMAND(USR4957);
PARAMETER(LCL.Email_addr_1);
PARAMETER(WRK.Date_Char_8_USR);
PARAMETER(WRK.Time_4A_USR);

EXECUTE FUNCTION(Rtv/Chg Last Dt Cllctn RT) TYPE(RTVOBJ) FILE(PDMXCPP)          AC1547055;
PARAMETER(360);
PARAMETER('TMSERL');
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Last Data Collectn CH) TYPE(CHGOBJ) FILE(PDMXCPP)          AC1546931;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AS_Data_Collection_Code);
 PARAMETER(DB1.AS_Hours_Between_Cllctns);
 PARAMETER(DB1.AS_Minutes_Btwn_Cllctns);
 PARAMETER(JOB.*Job_date);
 PARAMETER(JOB.*Job_time);
 PARAMETER(DB1.AS_Shift_Uploaded);
 PARAMETER(DB1.AS_Data_Collection_Desc);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Record_Status);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


