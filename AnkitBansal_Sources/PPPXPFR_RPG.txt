     H/TITLE Prt Inv Value Rpt-EXC PF  Print file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Print report of file contents
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Print file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 06/14/17  Time  : 15:37:55
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPPBTCPL1IF  E           K        DISK
      * RTV : Inventory Value File      Retrieval index
      *
     FOMBYREL1IF  E           K        DISK
      * RTV : Item Default              Retrieval index
      *
     FCAASREL3IF  E           K        DISK
      * RTV : Company Control           Retrieval Active Only
      *
     FOMF0CPL2IF  E           K        DISK
      * RSQ : Commodity Mrkt Price      Market Date Descending
      *
     FPPPXPFR$O   E             97     PRINTER
     F                                              KINFDS INFDS$
      * PRT: Prt Inv Value Rpt-EXC PF  Print file
      *
     E                    UCT        40  1               CENTER TABLE
     E                    #L7         7  1
      * Long constants
     E                    @CN#    1  01  6   @CN    25
     E                    YDOW        7  1               *Days of week
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IINFDS$    E DSY2I$DSP
      * Printer file information data structure
      *
      /EJECT
     IXDI8T       DS
      * Internal date
     I                                        1   80XDI8DT
     I                                        1   40XDI8CY
     I                                        1   10XDI8CC
     I                                        2   40XDI8YY
     I                                        5   60XDI8MM
     I                                        7   80XDI8DD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Inventory Value File
      * I : RST IVF Valuation Grouping
     I                                        1   1 P1WQSX
      * I : RST IVF Week Ending Date
     I                                    P   2   60P1AJDX
     IP2PARM      DS
      * I :  Days
     I                                    P   1   30P2NPNX
     IP3PARM      DS
      * I :  Status - Y or N
     I                                        1   1 P3B8ST
     IP4PARM      DS
      * I :  Status Flag 2  Y/N
     I                                        1   1 P4Q2ST
     IP5PARM      DS
      * I : MAP Inv Valuation Group Desc
     I                                        1  30 P5GBU1
     IP6PARM      DS
      * FLD: *Arrays
      * N :  Warehouse Code
     I                                        1   3 P6AJCD
      * N :  Company Number
     I                                    P   4   50P6AIC3
      * N :  Application Code
     I                                        6  11 P6DNCD
      * N :  Enterprise Code 1
     I                                       12  15 P6DQCD
      * N :  Enterprise Code 2
     I                                       16  27 P6DRCD
      * N :  Salesperson Code
     I                                       28  30 P6BCCD
      * N :  System Date Format
     I                                       31  33 P6B8NA
      * N :  User Profile Name
     I                                       34  43 P6AJVN
      * N :  Allow Multi-Company
     I                                       44  44 P6I6ST
      * N :  Allow Multi Warehouse
     I                                       45  45 P6I8ST
      * N :  Default Printer
     I                                       46  55 P6MPNA
      * N :  First Time Flag
     I                                       56  56 P6TAST
     IP7PARM      DS
      * FLD: Company Control
      * N :  Manual Price Accept Prcnt
     I                                    P   1   32P7AIPC
      * N :  CoPk/FdSrv ManPrc Acpt%
     I                                    P   4   62P7ASPC
     IP8PARM      DS
      * N :  Projected Market Price
     I                                    P   1   64P8B8PR
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0001
      * Application Code
     I                                       11  16 ZA0002
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0003
      * Application Code
     I                                       11  16 ZA0004
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1WQSX    PARM           WP0001  1        IVF Valuation G
     C           P1AJDX    PARM           WP0002  80       IVF Week Ending
     C           P2NPNX    PARM           WP0003  50       Days
     C           P3B8ST    PARM           WP0004  1        Status - Y or N
     C           P4Q2ST    PARM           WP0005  1        Status Flag 2
     C           P5GBU1    PARM           WP0006 30        Inv Valuation G
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Prt Inv Value Rpt-EXC PF: Mainline
     C                     EXSR A0MAIN
      * Print headers then End of report format
     C                     EXSR Q0PRNT
     C                     WRITE$GENDRPT
      * Exit program
     C                     EXSR ZXEXPG
      * ------------------------------------------------------
      /EJECT
     CSR         A0MAIN    BEGSR
      *================================================================
      * Prt Inv Value Rpt-EXC PF: Mainline
      *================================================================
      * Declare restrictor key work fields
     C           *LIKE     DEFN BTWQSX    WQKA01           IVF Valuation G
     C           *LIKE     DEFN BTAJDX    WQKA02           IVF Week Ending
      * Define keylist
     C           KRSA      KLIST
     C                     KFLD           WQKA01           IVF Valuation G
     C                     KFLD           WQKA02           IVF Week Ending
      * Setup key
     C                     MOVELP1WQSX    WQKA01           IVF Valuation G
     C                     Z-ADDP1AJDX    WQKA02           IVF Week Ending
      * Establish starting position
     C           KRSA      SETLL@BTCPA9                    *
      * Read first record with user selection
     C                     EXSR A3READ
     C           W0EOFA    IFNE '0'                        IF
      * USER: Null report processing
      * CLC Set for Null Rpt   US - /UT User Source  * 
     C                     MOVEL'Y'       W0AP1P
     C                     MOVEL'Y'       W0NEWP
     C                     MOVEL'Y'       WUGGST           USR Display fie
     C                     ELSE
      * Request all headings
     C                     MOVEL'Y'       W0AL1P  1        First page
     C                     MOVEL'Y'       W0AL00  1        IVF Valuation G
     C                     MOVEL'Y'       W0AL01  1        IVF Week Ending
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
      * Print report body
     C           W0EOFA    DOWEQ'0'                        DOW
      * Prepare heading formats for printing
     C                     EXSR A1PHDR
      * Print report detail line
     C                     EXSR A2PDTL
      * Read next record with user selection
     C                     EXSR A3READ
      * Print totals
     C                     EXSR A4PTOT
     C                     END                             WOD
     C                     END                             FI
      *================================================================
     CSR         A0EXIT    ENDSR
      /EJECT
     CSR         A1PHDR    BEGSR
      *================================================================
      * Prepare heading formats for printing
      *================================================================
     C           W0AL1P    IFEQ 'Y'
      * Load key header format
     C                     Z-ADD*ZERO     $CAJDX           IVF Week Ending
     C                     MOVEL*BLANK    $CWQSX           IVF Valuation G
     C                     MOVEL*BLANK    $CGBU1           Inv Valuation G
     C                     Z-ADD*ZERO     $CNPNX           Days
     C                     MOVEL*BLANK    $CB8ST           Status - Y or N
     C                     MOVEL*BLANK    $CQ2ST           Status Flag 2
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP1P  1
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP00  1
     C                     END
      *
     C           W0AL01    IFEQ 'Y'
      * Load key header format
     C                     Z-ADDBTAJDX    $DAJDX           IVF Week Ending
      * Load related totals format
     C                     Z-ADDBTAJDX    $FAJDX           IVF Week Ending
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP01  1
     C                     END
      *
      *================================================================
     CSR         A1EXIT    ENDSR
      /EJECT
     CSR         A2PDTL    BEGSR
      *================================================================
      * Process detail record
      *================================================================
      * Load details format
     C                     Z-ADDBTAJDX    $EAJDX           IVF Week Ending
     C                     Z-ADDBTEKC7    $EEKC7           IVF Item Code
     C                     MOVEL*BLANK    $EOONA           Item Desc DRV
     C                     Z-ADDBTELC7    $EELC7           IVF WIP - FG It
     C                     Z-ADDBTFSVL    $EFSVL           IVF Beg Inv Pri
     C                     Z-ADDBTFTVL    $EFTVL           IVF Sales Price
     C                     MOVEL*BLANK    $EPFTX           Text 1 Length U
     C                     Z-ADDBTAKDX    $EAKDX           IVF Sales Price
     C                     Z-ADDBTFUVL    $EFUVL           IVF Market Pric
     C                     Z-ADDBTFVVL    $EFVVL           IVF Warehouse P
     C                     Z-ADDBTM8WG    $EM8WG           IVF Warehouse P
     C                     MOVELBTWHSX    $EWHSX           IVF Item Type
     C                     MOVELBTWFSX    $EWFSX           IVF Unused Sts
     C                     MOVELBTGUAA    $EGUAA           IVF Item Cmdty
     C                     MOVELBTGVAA    $EGVAA           IVF Item Dft Cm
     C                     Z-ADDBTBVNY    $EBVNY           IVF Item Struct
     C                     Z-ADDBTBWNY    $EBWNY           IVF Item Struct
     C                     Z-ADDBTBXNY    $EBXNY           IVF Item Struct
     C                     Z-ADDBTF5PR    $EF5PR           IVF Item Market
     C                     MOVELBTGWAA    $EGWAA           IVF Item G/L Su
     C                     MOVELBTGXAA    $EGXAA           IVF Item U/M -
     C                     MOVELBTWISX    $EWISX           IVF Inventory V
     C                     Z-ADDBTFZVL    $EFZVL           IVF Cur Wk Inv
     C                     Z-ADDBTFYVL    $EFYVL           IVF Ovrrde Inv
     C                     MOVELBTWLSX    $EWLSX           IVF Cur Wk Inv
     C                     MOVELBTWJSX    $EWJSX           IVF Production
     C                     Z-ADDBTFXVL    $EFXVL           IVF Curr Wk Pro
     C                     Z-ADDBTFWVL    $EFWVL           IVF Ovrrde Prod
     C                     MOVELBTRGNA    $ERGNA           IVF Ovrrde Prod
     C                     MOVELBTWKSX    $EWKSX           IVF Curr Wk Pro
     C                     MOVELBTRFNA    $ERFNA           IVF Ovrrde Inv
     C                     Z-ADDBTM9WG    $EM9WG           IVF Unused Weig
     C                     MOVELBTWPSX    $EWPSX           IVF Post Invent
     C                     MOVELBTWQSX    $EWQSX           IVF Valuation G
     C                     Z-ADDBTQDDT    $EQDDT           IVF Unused Date
     C                     MOVELBTVSST    $EVSST           Record Status
     C                     Z-ADDBTMJDT    $EMJDT           Create Date
     C                     Z-ADDBTBETM    $EBETM           Create Time
     C                     MOVELBTCCVN    $ECCVN           Create User
     C                     MOVELBTCDVN    $ECDVN           Create Program
     C                     Z-ADDBTMKDT    $EMKDT           Change Date
     C                     Z-ADDBTBFTM    $EBFTM           Change Time
     C                     MOVELBTCEVN    $ECEVN           Change User
     C                     MOVELBTCFVN    $ECFVN           Change Program
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0APDT  1
      * Call print routine
     C                     EXSR Q0PRNT
      *
      *================================================================
     CSR         A2EXIT    ENDSR
      /EJECT
     CSR         A3READ    BEGSR
      *================================================================
      * Read next record
      *================================================================
      * Hold current values
     C           *LIKE     DEFN BTWQSX    WZA001           IVF Valuation G
     C                     MOVELBTWQSX    WZA001
     C           *LIKE     DEFN BTAJDX    WZA002           IVF Week Ending
     C                     Z-ADDBTAJDX    WZA002
      * Read next record
     C           W0RSL     DOUEQ'Y'                        DOU
     C           W0EOFA    OREQ '1'
     C           KRSA      READE@BTCPA9                  90*
      * Transfer error indicator to EOF flag
     C                     MOVEL*IN90     W0EOFA  1
      * Quit if no record read
     C           W0EOFA    IFNE '1'                        IF
      * Select record unless user action states otherwise
     C                     MOVEL'Y'       W0RSL   1
      * USER: Record selection processing
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     MOVEL*BLANK    WUPFTX           Text 1 Length U
      * Sel: Unapproved Inventory Values
      * CASE: PAR.Status - Y or N is yes
     C           P3B8ST    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.IVF Curr Wk Prod Status is Unapproved
      *   |- c2    : DB1.IVF Cur Wk Inv Val Status is Unapproved
      *   '-
     C           BTWKSX    IFEQ 'U'                        *IF
     C           BTWLSX    OREQ 'U'                        *OR
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * Sel: If Sales Date older than nn days
      * CASE: PAR.Days is GT Zero
     C           P2NPNX    IFGT *ZERO                      *IF
      * CASE: DB1.IVF Sales Price/Pound Dt is Entered
     C           BTAKDX    IFGT *ZERO                      *IF
      * R9083 06/14/17 DN-Update date conversion due to Synon version dif
      * WRK.Date                  USR = DB1.IVF Sales Price/Pound Dt
     C           BTAKDX    IFEQ *ZERO
     C                     Z-ADD*ZERO     WUMBDT
     C                     ELSE
     C           BTAKDX    SUB  19000000  WUMBDT           Date
     C                     END
      * WRK.Days = JOB.*Job date - WRK.Date                  USR *DAYS
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C           WUMBDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
      * Negative duration, when date1<date2
     C           XDAY1     IFGE XDAY2
     C                     Z-ADDXDURR     WUNPNX
     C                     ELSE
     C           XDURR     MULT -1        WUNPNX
     C                     END
      * CASE: WRK.Days GT PAR.Days
     C           WUNPNX    IFGT P2NPNX                     *IF
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * RTV Manual Price Accpt RT - Company Control  * 
     C                     EXSR SFRVGN
      * Food Service and Co-Pack Items
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.IVF Item Dft Cmdty Mkt Bs is Food Service
      *   |- c2    : DB1.IVF Item Dft Cmdty Mkt Bs is Co-Pack
      *   '-
     C           BTGVAA    IFEQ 'FSV'                      *IF
     C           BTGVAA    OREQ 'CPK'                      *OR
     C                     Z-ADDP7ASPC    P7AIPC           Manual Price Ac
     C                     END                             *FI
      * RTV Market Price       RT - Commodity Mrkt Price  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELBTGVAA    WL0007    P      Commodity Marke
     C                     MOVELBTGUAA    WL0008    P      Commodity Price
     C                     Z-ADD9999999   WL0009           Market Price Da
     C                     EXSR SGRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0010    P8B8PR           Commodity Marke
     C                     Z-ADDWL0011    WUE7DT           USR Date Priced
      * Absorbed freight rate is by by customer so we dont have it here.
     C                     Z-ADD0         WUTBNB           Absorbed Freigh
      * Projected Market Price
      * PAR.Projected Market Price =
      *    *COMPUTE (x1 + x2 + (x3 / x4))
      * x1    : PAR.Projected Market Price
      * +     : PGM.*Synon (15,5) work field
      * x2    : DB1.IVF Item Market Overage
      * +     : PGM.*Synon (15,5) work field
      * x3    : WRK.Absorbed Freight Rate CWT
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x4    : CON.100
     C           P8B8PR    ADD  BTF5PR    W0WB01           *Synon (15,5) w
     C           WUTBNB    DIV  100       W0WB02    H      *Synon (15,5) w
     C           W0WB01    ADD  W0WB02    W0WB00           *Synon (15,5) w
     C                     Z-ADDW0WB00    P8B8PR           Projected Marke
      * If a market price is found for co/cust market code default
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Minimum price allowed
      * WRK.Minimum Price   USR =
      *    *COMPUTE (((x4 - (x1 / x2)) * x3))
      * x4    : CON.1
      * -     : PGM.*Synon (17,7) work field
      * x1    : PAR.Manual Price Accept Prcnt
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CON.100
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Projected Market Price
     C           P7AIPC    DIV  100       W0WD02    H      *Synon (17,7) w
     C           1         SUB  W0WD02    W0WD01           *Synon (17,7) w
     C           W0WD01    MULT P8B8PR    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    WUC9PR           Minimum Price
     C                     MULT 100       WUC9PR           Minimum Price
      * Maximum price allowed
      * WRK.Maximum Price  USR =
      *    *COMPUTE ((((x1 / x2) + x4) * x3))
      * x1    : PAR.Manual Price Accept Prcnt
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CON.100
      * +     : PGM.*Synon (17,7) work field
      * x4    : CON.1
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Projected Market Price
     C           P7AIPC    DIV  100       W0WD02    H      *Synon (17,7) w
     C           W0WD02    ADD  1         W0WD01           *Synon (17,7) w
     C           W0WD01    MULT P8B8PR    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    WUDAPR           Maximum Price
     C                     MULT 100       WUDAPR           Maximum Price
      * If the Price Override is within the range then error status is no
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.IVF Sales Price/CWT GE WRK.Minimum Price   USR
      *   |- c2    : DB1.IVF Sales Price/CWT LE WRK.Maximum Price  USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           BTFTVL    IFGE WUC9PR                     *IF
     C           BTFTVL    IFLE WUDAPR                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'*'       WUPFTX           Text 1 Length U
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * If no price for co/cust market code then use co/item market code
      * RTV Market Price       RT - Commodity Mrkt Price  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELBTGVAA    WL0007    P      Commodity Marke
     C                     MOVELBTGUAA    WL0008    P      Commodity Price
     C                     Z-ADD9999999   WL0009           Market Price Da
     C                     EXSR SGRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0010    P8B8PR           Commodity Marke
     C                     Z-ADDWL0011    WUE7DT           USR Date Priced
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Minimum price allowed
      * WRK.Minimum Price   USR =
      *    *COMPUTE (((x1 / x2) * x3))
      * x1    : PAR.Manual Price Accept Prcnt
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CON.100
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Projected Market Price
     C           P7AIPC    DIV  100       W0WD01    H      *Synon (17,7) w
     C           W0WD01    MULT P8B8PR    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    WUC9PR           Minimum Price
     C                     MULT 100       WUC9PR           Minimum Price
      * Maximum price allowed
      * WRK.Maximum Price  USR =
      *    *COMPUTE ((((x1 / x2) + x4) * x3))
      * x1    : PAR.Manual Price Accept Prcnt
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CON.100
      * +     : PGM.*Synon (17,7) work field
      * x4    : CON.1
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Projected Market Price
     C           P7AIPC    DIV  100       W0WD02    H      *Synon (17,7) w
     C           W0WD02    ADD  1         W0WD01           *Synon (17,7) w
     C           W0WD01    MULT P8B8PR    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    WUDAPR           Maximum Price
     C                     MULT 100       WUDAPR           Maximum Price
      * If the Price Override is within the range then error status is no
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.IVF Sales Price/CWT GE WRK.Minimum Price   USR
      *   |- c2    : DB1.IVF Sales Price/CWT LE WRK.Maximum Price  USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           BTFTVL    IFGE WUC9PR                     *IF
     C           BTFTVL    IFLE WUDAPR                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'*'       WUPFTX           Text 1 Length U
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Print * on report if out of Range
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.IVF Sales Price/Pound LT WRK.Minimum Price   USR
      *   |- c2    : DB1.IVF Sales Price/Pound GT WRK.Maximum Price  USR
      *   '-
     C           BTFTVL    IFLT WUC9PR                     *IF
     C           BTFTVL    ORGT WUDAPR                     *OR
     C                     MOVEL'*'       WUPFTX           Text 1 Length U
     C                     END                             *FI
      * Sel: Out of min max audit range
      * CASE: PAR.Status Flag 2  Y/N is Yes
     C           P4Q2ST    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.IVF Sales Price/CWT LT WRK.Minimum Price   USR
      *   |- c2    : DB1.IVF Sales Price/CWT GT WRK.Maximum Price  USR
      *   '-
     C           BTFTVL    IFLT WUC9PR                     *IF
     C           BTFTVL    ORGT WUDAPR                     *OR
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             FI
     C                     END                             UOD
      *
      * Reset key level breaks
     C                     MOVEL*BLANK    W0AL00  1        IVF Valuation G
     C                     MOVEL*BLANK    W0AL01  1        IVF Week Ending
     C           W0EOFA    IFEQ '1'
      * End of file - Signal all level breaks
     C                     MOVEL'Y'       W0AL00  1        IVF Valuation G
     C                     MOVEL'Y'       W0AL01  1        IVF Week Ending
     C                     ELSE
      * Next record - Detect level breaks
     C           BTWQSX    IFNE WZA001                     IVF Valuation G
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL00
     C                     END
     C           BTAJDX    IFNE WZA002                     IVF Week Ending
     C           W0AL00    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL01
     C                     END
     C                     END
      *================================================================
     CSR         A3EXIT    ENDSR
      /EJECT
     CSR         A4PTOT    BEGSR
      *================================================================
      * Print report Totals
      *================================================================
      * Print level break totals as required
     C           W0AL01    IFEQ 'Y'
      * If there is not enough space on the
      * physical page for this format:
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 2
      * Signal new page required
     C                     MOVE 'Y'       W0NEWP
      * Start new page
     C                     EXSR Q0PRNT
     C                     END
      * Print format
     C                     WRITE$FKEYTTL
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP01
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP00
     C                     END
      *
     C           W0EOFA    IFEQ '1'
     C                     END
      *
      *================================================================
     CSR         A4EXIT    ENDSR
      /EJECT
     CSR         Q0PRNT    BEGSR
      *================================================================
      * Print report formats
      *================================================================
      * Select formats to print
     C                     EXSR Q1FSEL
      * Calculate length of formats selected for printing
     C                     EXSR Q2PLEN
      * Add column heading length to print length
     C                     ADD  W0COLN    W0FSUM
     C           W0NEWP    IFNE 'Y'
      * Signal overflow if requested headings would cause
      * detail format to start past the overflow line
     C           W0FSUM    IFGT W0OFL
     C                     MOVE 'Y'       W0NEWP
     C                     ELSE
      * Signal overflow if requested headings would cause
      * Detail format to be printed past end of page
     C                     ADD  W0DTLN    W0FSUM
     C           W0FSUM    IFGT W0PGL
     C                     MOVE 'Y'       W0NEWP
     C                     END
     C                     END
     C                     END
      * Print Standard report header of Prt Inv Value Rpt-EXC PF
      * If it is ready to print, then do so,
     C           W0NEWP    IFEQ 'Y'                        IF
     C                     EXSR Q3PTNP
     C                     END                             FI
      *
      * Print First Page Format of Prt Inv Value Rpt-EXC PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP1P    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP1P    ANDEQ'P'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of first page format
      * R9083 02/16/17 DN-Move All PAR to 1PG Format.
      * 1PG = PAR By name
     C                     Z-ADDP1AJDX    $CAJDX           IVF Week Ending
     C                     MOVELP1WQSX    $CWQSX           IVF Valuation G
     C                     MOVELP5GBU1    $CGBU1           Inv Valuation G
     C                     Z-ADDP2NPNX    $CNPNX           Days
     C                     MOVELP3B8ST    $CB8ST           Status - Y or N
     C                     MOVELP4Q2ST    $CQ2ST           Status Flag 2
     C           W0PFM     IFEQ 'Y'
      * Convert fields to external form
      * Convert IVF Week Ending Date to display format
      * Convert date
     C                     Z-ADD$CAJDX    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    VCAJDX
     C                     MOVEL'0'       *IN79
     C           WUGGST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      * Print format
     C                     WRITE$C1STPAG
     C                     END                             FI
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0AP1P
      * Clear first page flag.
     C                     MOVE *BLANK    W0AL1P
     C                     END                             FI
      * Print IVF Valuation Grouping of Prt Inv Value Rpt-EXC PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP00    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP00    ANDEQ'P'
      * Reset format print flag
     C                     MOVE *BLANK    W0AP00
     C                     END                             FI
      * Print IVF Week Ending Date of Prt Inv Value Rpt-EXC PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP01    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP01    ANDEQ'P'
      * Print format
     C                     WRITE$DKEYHDR
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
      *
      * Reset format print flag
     C                     MOVE 'P'       W0AP01
     C                     END                             FI
      * Print Detail line. of Prt Inv Value Rpt-EXC PF
      * If new page then set column headings active
     C           W0NEWP    IFEQ 'Y'
     C                     MOVE 'Y'       W0ACDT  1
     C                     END
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0APDT    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0APDT    ANDEQ'P'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of detail format
     C                     MOVEL*BLANK    $EOONA           Item Desc DRV
      * Item Desc DRV
      * Rtv Item Descriptions  RT - OM Item  * 
     C                     EXSR SERVGN
     C                     MOVELWUPFTX    $EPFTX           Text 1 Length U
     C           W0PFM     IFEQ 'Y'
      * Convert fields to external form
      * Convert IVF Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           $EEKC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL$EEKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VEEKC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VEEKC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert IVF WIP - FG Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           $EELC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL$EELC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VEELC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VEELC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert IVF Sales Price/Pound Dt to display format
      * Convert date
     C                     Z-ADD$EAKDX    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    VEAKDX
      * Print column headings if required
     C           W0ACDT    IFEQ 'Y'
     C                     WRITE$ECOLHDG
      * Clear column headings control flag
     C                     MOVE *BLANK    W0ACDT
     C                     END                             FI
      * Print format
     C                     WRITE$EDTLRCD
     C                     END                             FI
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0APDT
     C                     END                             FI
      * Clear new page flag
     C                     MOVE *BLANK    W0NEWP
      *================================================================
     CSR         Q0EXIT    ENDSR
      /EJECT
     CSR         Q1FSEL    BEGSR
      *================================================================
      * Format select
      *================================================================
      *================================================================
     CSR         Q1EXIT    ENDSR
      /EJECT
     CSR         Q2PLEN    BEGSR
      *================================================================
      * Evaluate print length
      *================================================================
     C           *LIKE     DEFN @$CLN     W0FSUM
     C           *LIKE     DEFN @$CLN     W0DTLN
     C           *LIKE     DEFN @$CLN     W0COLN
     C                     Z-ADD@$CLN     W0FSUM
     C                     Z-ADD*ZERO     W0DTLN
     C                     Z-ADD*ZERO     W0COLN
      * * First Page Format of Prt Inv Value Rpt-EXC PF
     C           W0AP1P    IFEQ 'Y'
     C                     ADD  7         W0FSUM
     C                     END                             FI
      *
      * * IVF Valuation Grouping of Prt Inv Value Rpt-EXC PF
     C           W0AP00    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * IVF Week Ending Date of Prt Inv Value Rpt-EXC PF
     C           W0AP01    IFEQ 'Y'
     C                     ADD  3         W0FSUM
     C                     END                             FI
      *
      * * Detail line. of Prt Inv Value Rpt-EXC PF
     C           W0APDT    IFEQ 'Y'
     C                     Z-ADD1         W0DTLN
     C           W0ACDT    IFEQ 'Y'
     C                     Z-ADD0         W0COLN
     C                     END                             FI
     C                     END                             FI
      *
      *================================================================
     CSR         Q2EXIT    ENDSR
      /EJECT
     CSR         Q3PTNP    BEGSR
      *================================================================
      * Format select
      *================================================================
     C                     WRITE$APAGHDR
      * Clear page overflow indicator
     C                     SETOF                     97    *
      *================================================================
     CSR         Q3EXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0001    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSA     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDRAIC3    YL0001           Company Number
     C                     MOVELDRBUVN    WN0002           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - User Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0001    DTAJVN           User Profile Na
     C                     MOVELWL0002    DTDNCD           Application Cod
      * Establish starting position
     C           KRSSB     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0003           Company Number
     C                     MOVELDTAJCD    WL0004           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSC01           Application Cod
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Application Cod
      * Setup key
     C                     MOVELWL0005    WQSC01           Application Cod
      * Establish starting position
     C           KRSSC     SETLL@DNRESF                    *
     C           KRSSC     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WL0006           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
     C           KRSSC     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSD01           Application Cod
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSD01           Application Cod
      * Establish starting position
     C           KRSSD     SETLL@DNRESF                    *
     C           KRSSD     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0006           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WL0006           Description
     C           KRSSD     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Item Descriptions  RT - OM Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           BYHGCD           Item Code
      * Setup key
     C                     Z-ADD$EEKC7    BYHGCD           Item Code
      * Establish starting position
     C           KRSSE     CHAIN@BYREA1              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1160' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    $EOONA           Description Lin
     C                     MOVEL*BLANK    WUAWNA           Description Lin
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBYAVNA    $EOONA           Description Lin
     C                     MOVELBYAWNA    WUAWNA           Description Lin
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV Manual Price Accpt RT - Company Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           ASAIC3           Company Number
      * Setup key
     C                     Z-ADDP6AIC3    ASAIC3           Company Number
      * Establish starting position
     C           KRSSF     CHAIN@ASREVL              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0049' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * PAR = CON By name
     C                     Z-ADD*ZERO     P7AIPC           Manual Price Ac
     C                     Z-ADD*ZERO     P7ASPC           CoPk/FdSrv ManP
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDASAIPC    P7AIPC           Manual Price Ac
     C                     Z-ADDASASPC    P7ASPC           CoPk/FdSrv ManP
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Market Price       RT - Commodity Mrkt Price  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN F0LQCD    WQSG01           Commodity Marke
     C           *LIKE     DEFN F0LRCD    WQSG02           Commodity Price
      * Define keylist
     C           KPSSG     KLIST
     C                     KFLD           WQSG01           Commodity Marke
     C                     KFLD           WQSG02           Commodity Price
     C                     KFLD           F0EQDT           Market Price Da
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           Commodity Marke
     C                     KFLD           WQSG02           Commodity Price
      * Setup key
     C                     MOVELWL0007    WQSG01           Commodity Marke
     C                     MOVELWL0008    WQSG02           Commodity Price
     C                     Z-ADDWL0009    F0EQDT           Market Price Da
      * Establish starting position
     C           KPSSG     SETLL@F0CPEP                    *
     C           KRSSG     READE@F0CPEP                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1222' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * PAR = CON By name
     C                     Z-ADD*ZERO     WL0010           Commodity Marke
     C                     Z-ADD*ZERO     WL0011           USR Date Priced
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     Z-ADDF0A5PR    WL0010           Commodity Marke
     C                     Z-ADDF0EQDT    WL0011           USR Date Priced
     C                     GOTO SGEXIT                     *QUIT
     C           KRSSG     READE@F0CPEP                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         XDV84T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDI8DD    XDEX01           DD
     C                     Z-ADDXDI8MM    XDEX02           MM
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDI8MM    XDEX01           MM
     C                     Z-ADDXDI8DD    XDEX02           DD
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
      * YMD format
     C           1000      MULT XDI8CC    XDEY01           Y
     C                     ADD  XDI8YY    XDEY01            YYY
     C                     Z-ADDXDI8MM    XDEX03           MM
     C                     Z-ADDXDI8DD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDV84E    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P6AJCD           Warehouse Code
     C                     Z-ADD*ZERO     P6AIC3           Company Number
     C                     MOVEL*BLANK    P6DNCD           Application Cod
     C                     MOVEL*BLANK    P6DQCD           Enterprise Code
     C                     MOVEL*BLANK    P6DRCD           Enterprise Code
     C                     MOVEL*BLANK    P6BCCD           Salesperson Cod
     C                     MOVEL*BLANK    P6B8NA           System Date For
     C                     MOVEL*BLANK    P6AJVN           User Profile Na
     C                     MOVEL*BLANK    P6I6ST           Allow Multi-Com
     C                     MOVEL*BLANK    P6I8ST           Allow Multi War
     C                     MOVEL*BLANK    P6MPNA           Default Printer
     C                     MOVEL*BLANK    P6TAST           First Time Flag
     C                     Z-ADD*ZERO     P7AIPC           Manual Price Ac
     C                     Z-ADD*ZERO     P7ASPC           CoPk/FdSrv ManP
     C                     Z-ADD*ZERO     P8B8PR           Projected Marke
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Define work field USR Display field
     C                     MOVEL*BLANK    WUGGST  1
      * Initialize KEY fields.
     C                     MOVEL*LOVAL    BTWQSX           IVF Valuation G
     C                     MOVEL*LOVAL    BTAJDX           IVF Week Ending
     C                     MOVEL*LOVAL    BTEKC7           IVF Item Code
      * Define work field Description Line Two
     C                     MOVEL*BLANK    WUAWNA 30
      * Define work field Text 1 Length USR
     C                     MOVEL*BLANK    WUPFTX  1
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Define work field Date                  USR
     C                     Z-ADD*ZERO     WUMBDT  70
      * Define work field Days
     C                     Z-ADD*ZERO     WUNPNX  50
      * Define work field USR Date Priced
     C                     Z-ADD*ZERO     WUE7DT  70
      * Define work field Absorbed Freight Rate CWT
     C                     Z-ADD*ZERO     WUTBNB  52
      * Define work field Minimum Price   USR
     C                     Z-ADD*ZERO     WUC9PR 114
      * Define work field Maximum Price  USR
     C                     Z-ADD*ZERO     WUDAPR 114
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WB01 155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WB02 155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WB00 155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WD02 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD01 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBRVGN.
     C                     MOVEL*BLANK    WL0001 10
     C                     MOVEL*BLANK    WL0002  6
     C                     Z-ADD*ZERO     WL0003  30
     C                     MOVEL*BLANK    WL0004  3
      * Define local variables for subroutine SCRVGN.
     C                     MOVEL*BLANK    WL0005  6
     C                     MOVEL*BLANK    WL0006 30
      * Define local variables for subroutine SGRVGN.
     C                     MOVEL*BLANK    WL0007  3
     C                     MOVEL*BLANK    WL0008  7
     C                     Z-ADD*ZERO     WL0009  70
     C                     Z-ADD*ZERO     WL0010 114
     C                     Z-ADD*ZERO     WL0011  70
      * Define null work field Warehouse Code
     C                     MOVEL*BLANK    YN0001  3
      * Define null work field Salesperson Code
     C                     MOVEL*BLANK    YN0002  3
      * Define null work field Allow Multi-Company
     C                     MOVEL*BLANK    YN0003  1
      * Define null work field Default Printer
     C                     MOVEL*BLANK    YN0004 10
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0001  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0002  3
      * Declare initial value data areas
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   $ACMP
     C                     IN   *NAMVAR
      *................................................................
     C                     MOVEL##PGM     $APGM
     C                     MOVEL##USR     $AUSR
     C                     MOVEL*BLANK    W0PFM   1
     C                     Z-ADD*ZERO     @$WRK   40
     C                     Z-ADD*ZERO     @$HDL   40
     C                     Z-ADD*ZERO     @$CLN
     C                     Z-ADD*ZERO     @$PGN
      * Adjust page length and overflow as necessary
     C           @$PGL     SUB  2         W0PGL   40
     C           @$OFL     IFGE W0PGL
     C           W0PGL     SUB  2         W0OFL   40
     C                     ELSE
     C                     Z-ADD@$OFL     W0OFL
     C                     END
      * Clear overflow indicator
     C                     SETOF                     97
      * Request new page
     C                     MOVEL'Y'       W0NEWP  1
      * USER: Initialize program
      *
     C                     MOVEL*BLANK    WN0001 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0001           User Profile Na
      *
     C                     MOVEL*BLANK    WN0002 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SARVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0001    ZA0001           User Profile Na
     C                     MOVEL'I/C'     ZA0002           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0002    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0001    WL0001    P      User Profile Na
     C                     MOVEL'I/C'     WL0002    P      Application Cod
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0003    P6AIC3           Company Number
     C                     MOVELWL0004    YL0002    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0002    WL0001    P      User Profile Na
     C                     MOVEL'I/C'     WL0002    P      Application Cod
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0003    P6AIC3           Company Number
     C                     MOVELWL0004    YL0002    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0002    YN0001           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0001    ZA0003           User Profile Na
     C                     MOVEL'I/C'     ZA0004           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0001    IFNE 0                          *IF
     C                     Z-ADDYL0001    P6AIC3           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0002    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C                     PARM *BLANK    WQ0001  3        Warehouse Code
     C                     PARM YL0001    WQ0002  30       Shipping Compan
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL'I/C'     WL0005    P      Application Cod
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    WUAUNA    P      Description
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
      * VAL Rtv & Ctr Prt Hdg  IF
      * SET Setup Prt Headings IF
      * RTV Applic. Group Desc RT - Application  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL'I/C'     WL0005    P      Application Cod
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    WUAUNA    P      Description
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * Center Txt String 40 - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc to PrtCo US - /UT User Source  * 
     C                     MOVE WUDE40    $ACMP
     C                     MOVEL'N'       WUGGST           USR Display fie
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Y2U0005
