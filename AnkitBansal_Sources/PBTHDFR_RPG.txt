     H/TITLE WW TMS Order Sweep     DFDisplay file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Display file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 03/28/25  Time  : 12:04:19
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPBTHDFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW TMS Order Sweep     DF Display file
      *
     FOPBFCPOAIF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : Order Header TRG          Co,SSD,Ord,Not X,OrSts-D
      *
     FPMAMREL1IF  E           K        DISK
      * RTV : Order Header Extension    Retrieval index
      *
     FOPBGWKL1IF  E           K        DISK
      * RTV : Order Detail              Retrieval index
      *
     FPDKMREL1IF  E           K        DISK
      * RTV : Company Values            Retrieval index
      *
     FPDLHCPLMIF  E           K        DISK
      * RSQ : Load Order Change Log     Ord/Dte/Tm/Seq/Load
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FOPBFCPL0UF  E           K        DISK
      * UPD : Order Header TRG          Update index
      *
     E                    AR1        30  1               ARRAY 1
     E                    AR2        30  1               ARRAY 2
     E                    J3          3  1
     E                    K3          3  1
      * RIGHT JUSTIFY INPUT FIELD
      * Days in month for date validation
     E                    @XD    12  12  2 0
     E                    J7          7  1
     E                    K7          7  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    #L3         3  1
     E                    #L7         7  1
     E                    UCT        40  1               CENTER TABLE
      * Long constants
     E                    @CN#    1  11  6   @CN    25
     I@BECPFJ
      * Order Header TRG          Update index
      * Renamed input format fields
     I              BEAIC3                          WAAIC3
     I              BEC4NB                          WAC4NB
     I              BEJNCD                          WAJNCD
     I              BEANC7                          WAANC7
     I              BEBKC7                          WABKC7
     I              BEBRTX                          WABRTX
     I              BEHMNA                          WAHMNA
     I              BEHONA                          WAHONA
     I              BEHPNA                          WAHPNA
     I              BEHNNA                          WAHNNA
     I              BEDBCD                          WADBCD
     I              BECKTX                          WACKTX
     I              BEB0C7                          WAB0C7
     I              BEAETX                          WAAETX
     I              BEB1NA                          WAB1NA
     I              BEB3NA                          WAB3NA
     I              BEB4NA                          WAB4NA
     I              BEB2NA                          WAB2NA
     I              BEBHCD                          WABHCD
     I              BEC8TX                          WAC8TX
     I              BEBCNA                          WABCNA
     I              BEA0DT                          WAA0DT
     I              BEA5DT                          WAA5DT
     I              BEGNDT                          WAGNDT
     I              BEACDT                          WAACDT
     I              BEAQCD                          WAAQCD
     I              BEB6NA                          WAB6NA
     I              BEBYNA                          WABYNA
     I              BEBZNA                          WABZNA
     I              BEGTST                          WAGTST
     I              BEGVST                          WAGVST
     I              BEGUST                          WAGUST
     I              BEQFST                          WAQFST
     I              BECQCD                          WACQCD
     I              BEGJST                          WAGJST
     I              BEGWST                          WAGWST
     I              BEGXST                          WAGXST
     I              BEGYST                          WAGYST
     I              BEAODT                          WAAODT
     I              BEAIVN                          WAAIVN
     I              BECXDT                          WACXDT
     I              BEJZVA                          WAJZVA
     I              BEA1WG                          WAA1WG
     I              BEXIST                          WAXIST
     I              BEXJST                          WAXJST
     I              BEXKST                          WAXKST
     I              BEEIDT                          WAEIDT
     I              BEAFTM                          WAAFTM
     I              BEE8CD                          WAE8CD
     I              BEE9CD                          WAE9CD
     I              BERMNB                          WARMNB
     I              BETBNB                          WATBNB
     I              BER1NB                          WAR1NB
     I              BEPJST                          WAPJST
     I              BEU0ST                          WAU0ST
     I              BEU1ST                          WAU1ST
     I              BEQ2CD                          WAQ2CD
     I              BEU2ST                          WAU2ST
     I              BEVEST                          WAVEST
     I              BEVFST                          WAVFST
     I              BEVGST                          WAVGST
     I              BERPCD                          WARPCD
     I              BERNNB                          WARNNB
     I              BEVDST                          WAVDST
     I              BEATIN                          WAATIN
     I              BEU4ST                          WAU4ST
     I              BEU5ST                          WAU5ST
     I              BERSRN                          WARSRN
     I              BEMHNA                          WAMHNA
     I              BEMINA                          WAMINA
     I              BEWBST                          WAWBST
     I              BER4CD                          WAR4CD
     I              BEBFCD                          WABFCD
     I              BEQ4CD                          WAQ4CD
     I              BET3NB                          WAT3NB
     I              BESICD                          WASICD
     I              BECONB                          WACONB
     I              BECEST                          WACEST
     I              BEAWDT                          WAAWDT
     I              BEJPCD                          WAJPCD
     I              BEXUST                          WAXUST
     I              BEZ1ST                          WAZ1ST
     I              BEVRVA                          WAVRVA
     I              BEOBST                          WAOBST
     I              BEBCST                          WABCST
     I              BEBDST                          WABDST
     I              BEB7VL                          WAB7VL
     I              BEGASX                          WAGASX
     I              BEGBSX                          WAGBSX
     I              BEGCSX                          WAGCSX
     I              BEGDSX                          WAGDSX
     I              BEFNSX                          WAFNSX
     I              BEFOSX                          WAFOSX
     I              BEFPSX                          WAFPSX
     I              BEFQSX                          WAFQSX
     I              BEFRSX                          WAFRSX
     I              BEFSSX                          WAFSSX
     I              BEFTSX                          WAFTSX
     I              BEFUSX                          WAFUSX
     I              BEFVSX                          WAFVSX
     I              BEFWSX                          WAFWSX
     I              BEFXSX                          WAFXSX
     I              BEFYSX                          WAFYSX
     I              BENODT                          WANODT
     I              BENPDT                          WANPDT
     I              BENQDT                          WANQDT
     I              BENRDT                          WANRDT
     I              BENSDT                          WANSDT
     I              BEBPTM                          WABPTM
     I              BEBQTM                          WABQTM
     I              BEBRTM                          WABRTM
     I              BEBSTM                          WABSTM
     I              BEBTTM                          WABTTM
     I              BEH0NX                          WAH0NX
     I              BEH1NX                          WAH1NX
     I              BEH2NX                          WAH2NX
     I              BEH3NX                          WAH3NX
     I              BEH4NX                          WAH4NX
     I              BEC0C7                          WAC0C7
     I              BEUVST                          WAUVST
     I              BEUWST                          WAUWST
     I              BEUXST                          WAUXST
     I              BEAATM                          WAAATM
     I              BEAYNA                          WAAYNA
     I              BEA0NA                          WAA0NA
     I              BEAXDT                          WAAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXTCK        DS
      * Time: hours, minutes, seconds
     I                                        1   60XTTIM
     I                                        1   20XTHH
     I                                        3   40XTNN
     I                                        5   60XTSS
      /EJECT
     IXDOFF       DS
      * Cut-off year
     I                                        1   40XOFF
     I                                        3   40XOFFYY
     IQOPBF1    E DSOPBFCPL0
      * UPD : Order Header TRG          Update index
      * Renamed input format fields
     I              BEAIC3                          WAAIC3
     I              BEC4NB                          WAC4NB
     I              BEJNCD                          WAJNCD
     I              BEANC7                          WAANC7
     I              BEBKC7                          WABKC7
     I              BEBRTX                          WABRTX
     I              BEHMNA                          WAHMNA
     I              BEHONA                          WAHONA
     I              BEHPNA                          WAHPNA
     I              BEHNNA                          WAHNNA
     I              BEDBCD                          WADBCD
     I              BECKTX                          WACKTX
     I              BEB0C7                          WAB0C7
     I              BEAETX                          WAAETX
     I              BEB1NA                          WAB1NA
     I              BEB3NA                          WAB3NA
     I              BEB4NA                          WAB4NA
     I              BEB2NA                          WAB2NA
     I              BEBHCD                          WABHCD
     I              BEC8TX                          WAC8TX
     I              BEBCNA                          WABCNA
     I              BEA0DT                          WAA0DT
     I              BEA5DT                          WAA5DT
     I              BEGNDT                          WAGNDT
     I              BEACDT                          WAACDT
     I              BEAQCD                          WAAQCD
     I              BEB6NA                          WAB6NA
     I              BEBYNA                          WABYNA
     I              BEBZNA                          WABZNA
     I              BEGTST                          WAGTST
     I              BEGVST                          WAGVST
     I              BEGUST                          WAGUST
     I              BEQFST                          WAQFST
     I              BECQCD                          WACQCD
     I              BEGJST                          WAGJST
     I              BEGWST                          WAGWST
     I              BEGXST                          WAGXST
     I              BEGYST                          WAGYST
     I              BEAODT                          WAAODT
     I              BEAIVN                          WAAIVN
     I              BECXDT                          WACXDT
     I              BEJZVA                          WAJZVA
     I              BEA1WG                          WAA1WG
     I              BEXIST                          WAXIST
     I              BEXJST                          WAXJST
     I              BEXKST                          WAXKST
     I              BEEIDT                          WAEIDT
     I              BEAFTM                          WAAFTM
     I              BEE8CD                          WAE8CD
     I              BEE9CD                          WAE9CD
     I              BERMNB                          WARMNB
     I              BETBNB                          WATBNB
     I              BER1NB                          WAR1NB
     I              BEPJST                          WAPJST
     I              BEU0ST                          WAU0ST
     I              BEU1ST                          WAU1ST
     I              BEQ2CD                          WAQ2CD
     I              BEU2ST                          WAU2ST
     I              BEVEST                          WAVEST
     I              BEVFST                          WAVFST
     I              BEVGST                          WAVGST
     I              BERPCD                          WARPCD
     I              BERNNB                          WARNNB
     I              BEVDST                          WAVDST
     I              BEATIN                          WAATIN
     I              BEU4ST                          WAU4ST
     I              BEU5ST                          WAU5ST
     I              BERSRN                          WARSRN
     I              BEMHNA                          WAMHNA
     I              BEMINA                          WAMINA
     I              BEWBST                          WAWBST
     I              BER4CD                          WAR4CD
     I              BEBFCD                          WABFCD
     I              BEQ4CD                          WAQ4CD
     I              BET3NB                          WAT3NB
     I              BESICD                          WASICD
     I              BECONB                          WACONB
     I              BECEST                          WACEST
     I              BEAWDT                          WAAWDT
     I              BEJPCD                          WAJPCD
     I              BEXUST                          WAXUST
     I              BEZ1ST                          WAZ1ST
     I              BEVRVA                          WAVRVA
     I              BEOBST                          WAOBST
     I              BEBCST                          WABCST
     I              BEBDST                          WABDST
     I              BEB7VL                          WAB7VL
     I              BEGASX                          WAGASX
     I              BEGBSX                          WAGBSX
     I              BEGCSX                          WAGCSX
     I              BEGDSX                          WAGDSX
     I              BEFNSX                          WAFNSX
     I              BEFOSX                          WAFOSX
     I              BEFPSX                          WAFPSX
     I              BEFQSX                          WAFQSX
     I              BEFRSX                          WAFRSX
     I              BEFSSX                          WAFSSX
     I              BEFTSX                          WAFTSX
     I              BEFUSX                          WAFUSX
     I              BEFVSX                          WAFVSX
     I              BEFWSX                          WAFWSX
     I              BEFXSX                          WAFXSX
     I              BEFYSX                          WAFYSX
     I              BENODT                          WANODT
     I              BENPDT                          WANPDT
     I              BENQDT                          WANQDT
     I              BENRDT                          WANRDT
     I              BENSDT                          WANSDT
     I              BEBPTM                          WABPTM
     I              BEBQTM                          WABQTM
     I              BEBRTM                          WABRTM
     I              BEBSTM                          WABSTM
     I              BEBTTM                          WABTTM
     I              BEH0NX                          WAH0NX
     I              BEH1NX                          WAH1NX
     I              BEH2NX                          WAH2NX
     I              BEH3NX                          WAH3NX
     I              BEH4NX                          WAH4NX
     I              BEC0C7                          WAC0C7
     I              BEUVST                          WAUVST
     I              BEUWST                          WAUWST
     I              BEUXST                          WAUXST
     I              BEAATM                          WAAATM
     I              BEAYNA                          WAAYNA
     I              BEA0NA                          WAA0NA
     I              BEAXDT                          WAAXDT
      *
     IYARDCS      DS                            779
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Header TRG
      * N :  Order Number
     I                                    P   1   40P1C4NB
      * N :  Order Type_Sales
     I                                        5   6 P1JNCD
      * N :  AR Customer Number
     I                                    P   7  100P1ANC7
      * N :  Ship To Name
     I                                       11  40 P1BRTX
      * N :  Customer Purchase Order #
     I                                       41  55 P1BCNA
      * N :  Shipping Method
     I                                       56  57 P1Q2CD
      * N :  Export Status
     I                                       58  58 P1U2ST
      * N :  Sales Route Code
     I                                       59  61 P1R4CD
      * N :  OH Load Plan Ready
     I                                       62  63 P1FVSX
     IP2PARM      DS
      * FLD: *Arrays
      * N :  Warehouse Code
     I                                        1   3 P2AJCD
      * N :  Company Number
     I                                    P   4   50P2AIC3
      * N :  Application Code
     I                                        6  11 P2DNCD
      * N :  Salesperson Code
     I                                       12  14 P2BCCD
      * N :  Allow Multi_Company
     I                                       15  15 P2I6ST
      * N :  Default Printer
     I                                       16  25 P2MPNA
      * N :  First Time Flag
     I                                       26  26 P2TAST
      * N :  Live with TPM
     I                                       27  27 P2O1ST
     IP3PARM      DS
      * FLD: *Arrays
      * N :  Company Number Pass   USR
     I                                    P   1   85P3AJAA
      * N :  Customer Number Pass  USR
     I                                    P   9  165P3AJNC
      * N :  Order Number 1  PASS  USR
     I                                    P  17  245P3AJAE
      * N :  Warehouse Code PASS   USR
     I                                       25  27 P3T3CD
      * N :  Trans Type 1 PASS     USR
     I                                       28  29 P3ZSST
      * N :  Trans Type 2 PASS     USR
     I                                       30  31 P3ZTST
      * N :  Change Flag USR
     I                                       32  32 P3HWSX
      * N :  USR Description 20
     I                                       33  52 P3L3NA
     IP4PARM      DS
      * FLD: *Arrays
      * N :  Date In
     I                                    P   1   40P4KCDT
      * N :  Date Out
     I                                    P   5   80P4KDDT
      * N :  Thru Date Pass        USR
     I                                    P   9  165P4AJAG
      * N :  From Date Pass        USR
     I                                    P  17  245P4AJAD
      * N :  Date 0          PASS  USR
     I                                    P  25  325P4U1AQ
     IP5PARM      DS
      * N :  Pricing Event Called From
     I                                        1   3 P5PECF
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'CD3 Non numeric data'
      * Message data for 'CD7 Non numeric data'
      * Message data for 'CD7 Non numeric data'
      * Message data for 'Date must be entered'
      * Message data for 'Date must be entered'
      * Message data for 'Company Number Req'
      * Company Number
     I                                        1   3 ZA0001
      * Message data for 'Generic Message 80'
      * Generic Message 80 USR
     I                                        1  80 ZA0002
      * Message data for 'Date must be entered'
      * Message data for 'Sweep order to MG sched'
      * Order Number
     I                                        1   7 ZA0003
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0004
      * Application Code
     I                                       11  16 ZA0005
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0006
      * Application Code
     I                                       11  16 ZA0007
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile control
      * CASE: PAR.First Time Flag is Yes
     C           P2TAST    IFEQ 'Y'                        *IF
     C                     Z-ADDP2AIC3    #2AIC3           Company Number
      * Initialize Sweep date range calculated using today's date
      * CLC TMS Sweep Dates    XF - Calendar  * From sweep date
     C                     CALL 'PBTGXFR'              90  CLC TMS Sweep D
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0001  30       Company Number
     C                     PARM ##JDT     WQ0002  70       Post to G_L Dat
     C           YL0001    PARM *ZERO     WQ0003  70       Date 0 RGT
     C           YL0002    PARM *ZERO     WQ0004  70       Date 1 RGT
     C           YL0003    PARM *ZERO     WQ0005  70       Date 2 RGT
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBTGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * For Mon, Tue, Wed, or Fri date 0 is used for From date
     C                     Z-ADDYL0001    #CHODT           Scheduled Ship
      * For Thur: Sat, Sun, Mon dates are put into date 2 for end date
      * CASE: LCL.Date 2 RGT is Entered
     C           YL0003    IFNE *ZERO                      *IF
     C                     Z-ADDYL0003    #CBEDT           USR Through Dat
     C                     ELSE
      * CASE: *OTHERWISE
      * For all other dates use date 0 for end date
     C                     Z-ADDYL0001    #CBEDT           USR Through Dat
     C                     END                             *FI
      * 9.7.16 E4119  default current day for from date
     C                     Z-ADD##JDT     #CHODT           Scheduled Ship
     C                     Z-ADD#CHODT    WUHODT           Scheduled Ship
     C                     Z-ADD#CHODT    #2AODT           Scheduled Ship
     C                     Z-ADD#CBEDT    WUBEDT           USR Through Dat
     C                     Z-ADD#2AIC3    WUAIC3           Company Number
     C                     MOVEL'N'       P2TAST           First Time Flag
     C                     END                             *FI
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEAODT           Scheduled Ship
     C                     KFLD           BEC4NB           Order Number
      * Setup key
     C                     Z-ADD#2AIC3    BEAIC3
     C                     Z-ADD#2AODT    BEAODT
     C                     Z-ADD#2C4NB    BEC4NB
     C           KPOS      SETLL@BFCPTT
     C                     READ @BFCPTT                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2RMNB    WZRMNB
     C                     MOVEL#2RMNB    WZRMNB           Load ID
     C           *LIKE     DEFN #2NPDT    WZNPDT
     C                     MOVEL#2NPDT    WZNPDT           JPN Invoice Iss
     C           *LIKE     DEFN #2BRTX    WZBRTX
     C                     MOVEL#2BRTX    WZBRTX           Ship To Name
     C           *LIKE     DEFN #2HNNA    WZHNNA
     C                     MOVEL#2HNNA    WZHNNA           Ship To City
     C           *LIKE     DEFN #2R4CD    WZR4CD
     C                     MOVEL#2R4CD    WZR4CD           Sales Route Cod
     C           *LIKE     DEFN #2Q2CD    WZQ2CD
     C                     MOVEL#2Q2CD    WZQ2CD           Shipping Method
     C           *LIKE     DEFN #2U2ST    WZU2ST
     C                     MOVEL#2U2ST    WZU2ST           Export Status
     C           *LIKE     DEFN #2AIC3    WZAIC3
     C                     MOVEL#2AIC3    WZAIC3           Company Number
     C           *LIKE     DEFN #2AODT    WZAODT
     C                     MOVEL#2AODT    WZAODT           Scheduled Ship
     C           *LIKE     DEFN #2C4NB    WZC4NB
     C                     MOVEL#2C4NB    WZC4NB           Order Number
     C           *LIKE     DEFN #2JNCD    WZJNCD
     C                     MOVEL#2JNCD    WZJNCD           Order Type_Sale
     C           *LIKE     DEFN #2VDST    WZVDST
     C                     MOVEL#2VDST    WZVDST           Load Type
     C           *LIKE     DEFN #2BKC7    WZBKC7
     C                     MOVEL#2BKC7    WZBKC7           Ship To Custome
     C           *LIKE     DEFN #2DBCD    WZDBCD
     C                     MOVEL#2DBCD    WZDBCD           Ship To State C
     C           *LIKE     DEFN #2BCNA    WZBCNA
     C                     MOVEL#2BCNA    WZBCNA           Customer Purcha
     C           *LIKE     DEFN #2EIDT    WZEIDT
     C                     MOVEL#2EIDT    WZEIDT           Requested Deliv
     C           *LIKE     DEFN #2AFTM    WZAFTM
     C                     MOVEL#2AFTM    WZAFTM           Requested Deliv
      * Translate search mask for text field
     C                     MOVEL'QSYST'   WQB10X 10
     C                     MOVE 'RNTBL'   WQB10X
     C           *LIKE     DEFN #2BRTX    WQBRTX           Ship To Name
     C                     CALL 'QDCXLATE'
      * Length
     C                     PARM 30        WQA5N   50
     C                     PARM #2BRTX    WQBRTX           Ship To Name
     C                     PARM           WQB10X           QSYSTRNTBL
     C                     PARM 'QSYS'    WQC10X 10
     C           *LIKE     DEFN #2HNNA    WQHNNA           Ship To City
     C                     CALL 'QDCXLATE'
      * Length
     C                     PARM 20        WQA5N   50
     C                     PARM #2HNNA    WQHNNA           Ship To City
     C                     PARM           WQB10X           QSYSTRNTBL
     C                     PARM 'QSYS'    WQC10X 10
     C           *LIKE     DEFN #2BCNA    WQBCNA           Customer Purcha
     C                     CALL 'QDCXLATE'
      * Length
     C                     PARM 15        WQA5N   50
     C                     PARM #2BCNA    WQBCNA           Customer Purcha
     C                     PARM           WQB10X           QSYSTRNTBL
     C                     PARM 'QSYS'    WQC10X 10
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@BFCPTT                  90*
     C  N82                READ @BFCPTT                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,46
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2RMNB    IFNE *ZERO                      Load ID
     C           BERMNB    CABNE#2RMNB    BB020            Load ID
     C                     END
     C           #2NPDT    IFNE *ZERO                      JPN Invoice Iss
     C           BENPDT    CABNE#2NPDT    BB020            JPN Invoice Iss
     C                     END
     C           #2BRTX    IFNE *BLANK                     Ship To Name
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BEBRTX           Ship To Name
      * Length
     C                     PARM 30        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           WQBRTX
      * Length
     C                     PARM 30        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2HNNA    IFNE *BLANK                     Ship To City
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BEHNNA           Ship To City
      * Length
     C                     PARM 20        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           WQHNNA
      * Length
     C                     PARM 20        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2R4CD    IFNE *BLANK                     Sales Route Cod
     C           BER4CD    CABNE#2R4CD    BB020            Sales Route Cod
     C                     END
     C           #2Q2CD    IFNE *BLANK                     Shipping Method
     C           BEQ2CD    CABNE#2Q2CD    BB020            Shipping Method
     C                     END
     C           #2U2ST    IFNE *BLANK                     Export Status
     C           BEU2ST    CABNE#2U2ST    BB020            Export Status
     C                     END
     C           #2AIC3    IFEQ *ZERO                      Company Number
     C           #2AODT    IFNE *ZERO                      Scheduled Ship
     C           BEAODT    CABNE#2AODT    BB020            Scheduled Ship
     C                     END
     C                     END
     C           #2AIC3    IFEQ *ZERO                      Company Number
     C           #2AODT    OREQ *ZERO                      Scheduled Ship
     C           #2C4NB    IFNE *ZERO                      Order Number
     C           BEC4NB    CABNE#2C4NB    BB020            Order Number
     C                     END
     C                     END
     C           #2JNCD    IFNE *BLANK                     Order Type_Sale
     C           BEJNCD    CABNE#2JNCD    BB020            Order Type_Sale
     C                     END
     C           #2VDST    IFNE *BLANK                     Load Type
     C           BEVDST    CABNE#2VDST    BB020            Load Type
     C                     END
     C           #2BKC7    IFNE *ZERO                      Ship To Custome
     C           BEBKC7    CABNE#2BKC7    BB020            Ship To Custome
     C                     END
     C           #2DBCD    IFNE *BLANK                     Ship To State C
     C           BEDBCD    CABNE#2DBCD    BB020            Ship To State C
     C                     END
     C           #2BCNA    IFNE *BLANK                     Customer Purcha
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BEBCNA           Customer Purcha
      * Length
     C                     PARM 15        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           WQBCNA
      * Length
     C                     PARM 15        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2EIDT    IFNE *ZERO                      Requested Deliv
     C           BEEIDT    CABNE#2EIDT    BB020            Requested Deliv
     C                     END
     C           #2AFTM    IFNE *ZERO                      Requested Deliv
     C           BEAFTM    CABNE#2AFTM    BB020            Requested Deliv
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
     C                     MOVEL'Y'       W0RSL            *Record selecte
     C                     MOVEL'Y'       WURSL            *Record selecte
      * RTV Type              RT - Order Header Extension  * 
     C                     EXSR SARVGN
      * ** Skip if Block Orders
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: DB1.Block Order Flag is Block Order
     C           BEBCST    IFEQ 'B'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Skip if LTL = NO
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: DB1.LTL Flag is No
     C           BEPJST    IFEQ 'N'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Skip if Load ID is not zeros
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: DB1.Load ID is Entered
     C           BERMNB    IFNE *ZERO                      *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Skip if OH Load Plan Ready is not *blanks
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** Skip if TMS Order Status is not blanks or "N"
      * CASE: DB1.OH Load Plan Ready is OH Sent to TMS
     C           BEFVSX    IFEQ 'Y'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** If Cust Type is blank display all except 'ES' if live with DOM
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: CTL.Type Code is EQ Blank
     C           #CBOCD    IFEQ *BLANK                     *IF
      * CASE: LCL.OHE Override Type Code EQ WRK.Text 2
     C           YL0004    IFEQ WUHKT1                     *IF
      * only want ES when live with tpm, and Accusort = N (live with dom/
      *                   ( Y= live with dom/ex only)
      * CASE:
      *  - c1ANDc2
      *   |- c1    : LCL.Live with TPM is Yes
      *   |- c2    : LCL.PFS AccuSort Active is No
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0005    IFEQ 'Y'                        *IF
     C           YL0006    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVELYL0004    #RBOCD           Type Code
     C                     END                             *FI
      * ** If Cust Type entered, match. If blank, select all except 'ES'
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: CTL.Type Code is Entered
     C           #CBOCD    IFNE *BLANK                     *IF
      * CASE: LCL.OHE Override Type Code NE CTL.Type Code
     C           YL0004    IFNE #CBOCD                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELYL0004    #RBOCD           Type Code
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test date range
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * CASE: DB1.Scheduled Ship Date is not entered
     C           BEAODT    IFEQ *ZERO                      *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     ELSE
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.Scheduled Ship Date LT CTL.Scheduled Ship Date U
      *   |- c2    : DB1.Scheduled Ship Date GT CTL.USR Through Date
      *   '-
     C           BEAODT    IFLT #CHODT                     *IF
     C           BEAODT    ORGT #CBEDT                     *OR
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching company number
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Company Number passed in, only select matching
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.Company Number is greater than zero
      *   |- c2    : DB1.Company Number NE CTL.Company Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #2AIC3    IFGT *ZERO                      *IF
     C           BEAIC3    IFNE #2AIC3                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching order#
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Order# requested, only select matching
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.Order Number is Greater then zero
      *   |- c2    : DB1.Order Number NE CTL.Order Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #2C4NB    IFGT *ZERO                      *IF
     C           BEC4NB    IFNE #2C4NB                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching PO#
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If PO# is requested, select matching
      * CASE: CTL.Customer Purchase Order # is NE Blank
     C           #2BCNA    IFNE *BLANK                     *IF
      * * Select if PO# matches exactly
      * CASE: CTL.Customer Purchase Order # NE DB1.Customer Purchase Orde
     C           #2BCNA    IFNE BEBCNA                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching Ship To Number
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Ship To# is requested, select matching
      * CASE: CTL.Ship To Customer is not equal to zero
     C           #2BKC7    IFNE *ZERO                      *IF
      * CASE: CTL.Ship To Customer NE DB1.Ship To Customer
     C           #2BKC7    IFNE BEBKC7                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching Ship To Name
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Ship To Name is requested, select matching
      * CASE: CTL.Name 25A USR is Not blank
     C           #CUJTX    IFGT *BLANK                     *IF
      * CVT Str to Upper Alpha US - /UT User Source  * 
     C                     MOVEA#CUJTX    AR1              LOAD ARRAY
     C                     MOVEA*BLANK    AR2              LOAD ARRAY
     C                     Z-ADD1         X1      20       SET COUNTER
     C                     Z-ADD1         Y1      20       SET COUNTER
      * * * * * * * CHECK FOR ALPHABETIC CHARACTERS * * * * * * *
     C           X1        DOWLT31
     C           AR1,X1    IFEQ ' '
     C           AR1,X1    ORGE 'a'
     C           AR1,X1    ANDLE'Z'
     C           AR1,X1    ANDNE'~'
     C           AR1,X1    ANDNE'{'
     C           AR1,X1    ANDNE'}'
     C           AR1,X1    ANDNE'\'
     C                     MOVE AR1,X1    AR2,Y1
     C                     ADD  1         Y1
     C                     ADD  1         X1
     C                     ELSE
     C                     ADD  1         X1
     C                     END
     C                     END
     C                     Z-ADD1         Y1
     C           Y1        DOWLT31
     C           AR2,Y1    IFEQ 'a'
     C                     MOVEL'A'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'b'
     C                     MOVEL'B'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'c'
     C                     MOVEL'C'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'd'
     C                     MOVEL'D'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'e'
     C                     MOVEL'E'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'f'
     C                     MOVEL'F'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'g'
     C                     MOVEL'G'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'h'
     C                     MOVEL'H'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'i'
     C                     MOVEL'I'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'j'
     C                     MOVEL'J'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'k'
     C                     MOVEL'K'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'l'
     C                     MOVEL'L'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'm'
     C                     MOVEL'M'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'n'
     C                     MOVEL'N'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'o'
     C                     MOVEL'O'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'p'
     C                     MOVEL'P'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'q'
     C                     MOVEL'Q'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'r'
     C                     MOVEL'R'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 's'
     C                     MOVEL'S'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 't'
     C                     MOVEL'T'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'u'
     C                     MOVEL'U'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'v'
     C                     MOVEL'V'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'w'
     C                     MOVEL'W'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'x'
     C                     MOVEL'X'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'y'
     C                     MOVEL'Y'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'z'
     C                     MOVEL'Z'       AR2,Y1
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     ADD  1         Y1
     C                     END
     C                     MOVEAAR2       WUWGT1           LOAD OUTPUT
      * CLC Call Qclscan       UP - /UT User Source  * 
     C                     CALL 'QCLSCAN'              90  CLC Call Qclsca
     C                     PARM #1BRTX    WQ0006256        USR Qclscan fie
     C                     PARM 30        WQ0007  30       USR Qclscan Len
     C                     PARM 1         WQ0008  30       USR Qclscan Sta
     C                     PARM WUWGT1    WQ0009256        USR Qclscan Mas
     C                     PARM 30        WQ0010  30       USR Qclscan Mas
     C                     PARM '1'       WQ0011  1        USR Qclscan Tra
     C                     PARM '1'       WQ0012  1        USR Qclscan Tri
     C                     PARM *BLANK    WQ0013  1        USR Qclscan Wil
     C           WUY8NB    PARM WUY8NB    WQ0014  30       USR Qclscan Res
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'QCLSCAN' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.USR Qclscan Result ? is Does contain
     C           WUY8NB    IFGT 0                          *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching Ship To City
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Ship To City is requested, select matching
      * CASE: CTL.City 11 USR is Entered
     C           #CMPT1    IFNE *BLANK                     *IF
      * CVT Str to Upper Alpha US - /UT User Source  * 
     C                     MOVEA#CMPT1    AR1              LOAD ARRAY
     C                     MOVEA*BLANK    AR2              LOAD ARRAY
     C                     Z-ADD1         X1      20       SET COUNTER
     C                     Z-ADD1         Y1      20       SET COUNTER
     C           X1        DOWLT31
     C           AR1,X1    IFEQ ' '
     C           AR1,X1    ORGE 'a'
     C           AR1,X1    ANDLE'Z'
     C           AR1,X1    ANDNE'~'
     C           AR1,X1    ANDNE'{'
     C           AR1,X1    ANDNE'}'
     C           AR1,X1    ANDNE'\'
     C                     MOVE AR1,X1    AR2,Y1
     C                     ADD  1         Y1
     C                     ADD  1         X1
     C                     ELSE
     C                     ADD  1         X1
     C                     END
     C                     END
     C                     Z-ADD1         Y1
     C           Y1        DOWLT31
     C           AR2,Y1    IFEQ 'a'
     C                     MOVEL'A'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'b'
     C                     MOVEL'B'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'c'
     C                     MOVEL'C'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'd'
     C                     MOVEL'D'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'e'
     C                     MOVEL'E'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'f'
     C                     MOVEL'F'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'g'
     C                     MOVEL'G'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'h'
     C                     MOVEL'H'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'i'
     C                     MOVEL'I'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'j'
     C                     MOVEL'J'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'k'
     C                     MOVEL'K'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'l'
     C                     MOVEL'L'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'm'
     C                     MOVEL'M'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'n'
     C                     MOVEL'N'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'o'
     C                     MOVEL'O'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'p'
     C                     MOVEL'P'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'q'
     C                     MOVEL'Q'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'r'
     C                     MOVEL'R'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 's'
     C                     MOVEL'S'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 't'
     C                     MOVEL'T'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'u'
     C                     MOVEL'U'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'v'
     C                     MOVEL'V'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'w'
     C                     MOVEL'W'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'x'
     C                     MOVEL'X'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'y'
     C                     MOVEL'Y'       AR2,Y1
     C                     ELSE
     C           AR2,Y1    IFEQ 'z'
     C                     MOVEL'Z'       AR2,Y1
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     ADD  1         Y1
     C                     END
     C                     MOVEAAR2       WUSZTX           LOAD OUTPUT
      * CLC Call Qclscan       UP - /UT User Source  * 
     C                     CALL 'QCLSCAN'              90  CLC Call Qclsca
     C                     PARM #1HNNA    WQ0015256        USR Qclscan fie
     C                     PARM 20        WQ0016  30       USR Qclscan Len
     C                     PARM 1         WQ0017  30       USR Qclscan Sta
     C                     PARM WUSZTX    WQ0018256        USR Qclscan Mas
     C                     PARM 20        WQ0019  30       USR Qclscan Mas
     C                     PARM '1'       WQ0020  1        USR Qclscan Tra
     C                     PARM '1'       WQ0021  1        USR Qclscan Tri
     C                     PARM *BLANK    WQ0022  1        USR Qclscan Wil
     C           WUY8NB    PARM WUY8NB    WQ0023  30       USR Qclscan Res
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'QCLSCAN' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.USR Qclscan Result ? is Does contain
     C           WUY8NB    IFGT 0                          *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching Ship To State
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Ship To State is requested, select matching
      * CASE: CTL.Ship To State Code is State code not Blanks
     C           #2DBCD    IFNE *BLANK                     *IF
      * CASE: CTL.Ship To State Code NE DB1.Ship To State Code
     C           #2DBCD    IFNE BEDBCD                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching Requested Delivery Date
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** If Requested Delivery date is requested, select matching
      * CASE: CTL.Requested Delivery Date is entered
     C           #2EIDT    IFNE *ZERO                      *IF
      * CASE: CTL.Requested Delivery Date NE DB1.Requested Delivery Date
     C           #2EIDT    IFNE BEEIDT                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for orders = 'A',  'H'
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * ** Allow if header status is available, allocated,entered or held
      * CASE: DB1.Header Status is Available/Held
     C           BEGWST    IFEQ 'A'                        *IF
     C           BEGWST    OREQ 'H'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** Test for matching warehouse, skip EF4 regardless
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * S17054 DN 04/07/21-Count Cases as Boxes. Replaced function with
      *   'RTV UM/Whs Code-Add CS RT'.
      * RTV UM/Whs Code-Add CS RT - Order Detail  * 
     C                     EXSR SBRVGN
      * ** If Whse requested, only select matching
      * CASE:
      *  - c1ANDc2
      *   |- c1    : CTL.Warehouse Code is Not Blanks
      *   |- c2    : CTL.Warehouse Code NE RCD.Warehouse Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #CAJCD    IFNE *BLANK                     *IF
     C           #CAJCD    IFNE #RAJCD                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * SEL:  Order detail must exist ACTIVE  11/29/18 s14166
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * RTV Chk Any DtlExists  RT - Order Detail  * 
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * SEL:  Check for < ctl.Weight Adjust         USR  -E04119 9/9/16
      * CASE:
      *  - c1ANDc2
      *   |- c1    : CTL.Weight Adjust is Not Equal to Zero
      *   |- c2    : RCD.Order Weight Total GT CTL.Weight Adjust
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #CDTWG    IFNE *ZERO                      *IF
     C           #1A1WG    IFGT #CDTWG                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * HI the warehouse if the company was changed
      * VAL RTV Ord/Type existsRT - Load Order Change Log  * 
     C                     EXSR SERVGN
     C                     Z-ADD#1A1WG    #RDTWG           Weight Adjust
     C                     END                             *FI
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C                     READ @BFCPTT                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate Company Number and convert to internal.
      * CD3 Ext/Int
     C                     MOVELV2AIC3    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC3  3
     C                     MOVEA*BLANKS   K3
     C                     Z-ADD3         C       30
     C                     Z-ADD3         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUDMCD    J3
     C                     MOVE *BLANKS   W0RTN
     C                     DO   3
     C           J3,C      IFNE ' '
     C                     MOVEAJ3,C      K3,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK3        JUSTC3
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC3    TESTC   1
     C           TESTC     IFGT '?'
     C           TESTC     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC3     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC3    WUDMCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,002                    *IF
      * Setup message data for message
      * Send message 'CD3 Non numeric data'
     C                     MOVEL'USR0752' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2AIC3           CD3 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUDMCD    #2AIC3           CD3 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Scheduled Ship Date USR
      * External date
     C                     Z-ADDVCHODT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDXDINDT    #CHODT
      * Validate USR Through Date
      * External date
     C                     Z-ADDVCBEDT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
     C                     Z-ADDXDINDT    #CBEDT
      * Validate Order Number and convert to internal.
      * CD7 Ext/Int
     C                     MOVELV2C4NB    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,002                    *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2C4NB           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #2C4NB           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Ship To Customer and convert to internal.
      * CD7 Ext/Int
     C                     MOVELV2BKC7    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2BKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,002                    *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2BKC7           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #2BKC7           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Requested Delivery Date
      * External date
     C                     Z-ADDV2EIDT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9944  *
     C                     END
     C                     Z-ADDXDINDT    #2EIDT
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    CABNE*BLANKS   DATAG1
      * Change of position specified
     C           WZAIC3    CASNE#2AIC3    FBRQRL
     C           WZC4NB    CASNE#2C4NB    FBRQRL
     C           WZJNCD    CASNE#2JNCD    FBRQRL
     C           WZVDST    CASNE#2VDST    FBRQRL
     C           WZBKC7    CASNE#2BKC7    FBRQRL
     C           WZDBCD    CASNE#2DBCD    FBRQRL
     C           WZBCNA    CASNE#2BCNA    FBRQRL
     C           WZEIDT    CASNE#2EIDT    FBRQRL
     C                     END
     C           DATAG1    TAG
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
      * * Company#, From Date, and Through Date are required
      * CASE: CTL.Scheduled Ship Date USR is Not Entered
     C           #CHODT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Send message 'Date must be entered'
     C                     MOVEL'USR0231' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: CTL.USR Through Date is not entered
     C           #CBEDT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Send message 'Date must be entered'
     C                     MOVEL'USR0231' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     ELSE
      * CASE: CTL.Company Number is Equal to zero
     C           #2AIC3    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #2AIC3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    ZA0001           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0001           CD3 Ext Numeric
     C                     END                             *FI
      * Send message 'Company Number Req'
     C                     MOVEL'USR2183' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: CTL.City 11 USR NE WRK.City 11 USR
     C           #CMPT1    IFNE WUMPT1                     *IF
     C                     MOVEL*BLANK    #2HNNA           Ship To City
     C                     MOVEL#CMPT1    #2HNNA           Ship To City
     C                     MOVEL#CMPT1    WUMPT1           City 11 USR
     C                     MOVEL#2HNNA    WUHNNA           Ship To City
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Scheduled Ship Date USR NE WRK.Scheduled Ship Date USR
     C           #CHODT    IFNE WUHODT                     *IF
     C                     Z-ADD#CHODT    WUHODT           Scheduled Ship
     C                     Z-ADD#CHODT    #2AODT           Scheduled Ship
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.USR Through Date NE WRK.USR Through Date
     C           #CBEDT    IFNE WUBEDT                     *IF
     C                     Z-ADD#CBEDT    WUBEDT           USR Through Dat
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Company Number NE WRK.Company Number
     C           #2AIC3    IFNE WUAIC3                     *IF
     C                     Z-ADD#2AIC3    WUAIC3           Company Number
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Type Code NE WRK.Type Code
     C           #CBOCD    IFNE WUBOCD                     *IF
     C                     MOVEL#CBOCD    WUBOCD           Type Code
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Name 25A USR NE WRK.Name 25A USR
     C           #CUJTX    IFNE WUUJTX                     *IF
     C                     MOVEL#CUJTX    WUUJTX           Name 25A USR
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Weight Adjust NE WRK.Weight Adjust
     C           #CDTWG    IFNE WUDTWG                     *IF
     C                     Z-ADD#CDTWG    WUDTWG           Weight Adjust
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE: CTL.Warehouse Code NE WRK.Warehouse Code
     C           #CAJCD    IFNE WUAJCD                     *IF
     C                     MOVEL#CAJCD    WUAJCD           Warehouse Code
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * * Command Keys: F6=Sweep all to MG, F5=Refresh, F3=Exit
      * CASE: CTL.*CMD key is Sweep Orders to MG
     C           *IN06     IFEQ '1'                        *IF
      * F6=Sweep all to MG
      * 03/27/25 DN SR27558-Deactivated. Throw Info Message.
     C                     Z-ADD*ZERO     ZQ      50
     C           @CN,003   CAT  @CN,004:ZQYL0010    P      Generic Message
     C                     Z-ADD1         ZQ      50
     C           YL0010    CAT  @CN,005:ZQYL0010    P      Generic Message
      * Setup message data for message
     C                     MOVELYL0010    ZA0002           Generic Message
      * Send message 'Generic Message 80'
     C                     MOVEL'USR4976' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     GOTO DAEXIT                     *QUIT
     C                     ELSE
      * CASE: CTL.*CMD key is *Refresh
     C           *IN05     IFEQ '1'                        *IF
      * F5=Refresh
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: CTL.*CMD key is CF08
     C           *IN08     IFEQ '1'                        *IF
      * EDT Reset LPR Status   EF - TMS Order Header Trigger  * 
     C                     CALL 'PBWPEFR'              90  EDT Reset LPR S
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBWPEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * * Command Keys: F3/F5/F10= ww tms load --temp
      * CASE: CTL.*CMD key is CF10
     C           *IN10     IFEQ '1'                        *IF
      * WW TMS Load           DF - TMS Load  * 
     C                     CALL 'PBXFDFR'              90  WW TMS Load
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBXFDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ELSE
      * CASE: CTL.*CMD key is *Refresh
     C           *IN05     IFEQ '1'                        *IF
      * F5=Refresh
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * * Command Keys: F09= pmt reset lpr flag -- restrict users
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
      * CASE:
      *  - c1ORc2ORc3ORc4ORc5ORc6
      *   |- c1    : JOB.*USER is Rose - God
      *   |- c2    : JOB.*USER is Mike Booth PROD
      *   |- c3    : JOB.*USER is TPMTEST
      *   |- c4    : JOB.*USER is PRKTEST
      *   |- c5    : JOB.*USER is Rose Centonze
      *   |- c6    : JOB.*USER is Jeff Armstrong
      *   '-
     C           ##USR     IFEQ @CN,006                    *IF
     C           ##USR     OREQ @CN,007                    *OR
     C           ##USR     OREQ @CN,008                    *OR
     C           ##USR     OREQ @CN,009                    *OR
     C           ##USR     OREQ @CN,010                    *OR
     C           ##USR     OREQ @CN,011                    *OR
      * PMT Chg Load Plan Rdy PV - Order Header TRG  * 
     C                     CALL 'PBYLPVR'              90  PMT Chg Load Pl
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBYLPVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Process subfile (pass 2)
     C                     EXSR EAPRSF
      * If error during 2nd pass exit:
     C           *IN99     CABEQ'1'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,46
     C                     SETOF                     98    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * SFLNXTCHG
     C                     SETON                     84
      * USER: Process subfile record (Pre-confirm)
      * From Date must be entered
      * CASE: CTL.Scheduled Ship Date USR is Not Entered
     C           #CHODT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Send message 'Date must be entered'
     C                     MOVEL'USR0231' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
      * Set Thru date = From date if it is blank
      * CASE: CTL.USR Through Date is not entered
     C           #CBEDT    IFEQ *ZERO                      *IF
     C                     Z-ADD#CHODT    #CBEDT           USR Through Dat
     C                     END                             *FI
      * 5=Display Order Inquiry
      * CASE: RCD.*SFLSEL is *Display
     C           #1SEL     IFEQ '5'                        *IF
     C           #1SEL     OREQ ' 5'
      * DSP Ord Inquiry Detail DF - Order Detail  * 
     C                     CALL 'PDPZDFR'              90  DSP Ord Inquiry
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1AIC3    WQ0024  30       Company Number
     C                     PARM #1C4NB    WQ0025  70       Order Number
     C           YL0011    PARM *ZERO     WQ0026  30       Order Sequence
     C           YL0012    PARM *ZERO     WQ0027  30       Order Secondary
     C           P2DNCD    PARM P2DNCD    WQ0028  6        Application Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPZDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * USER: Process subfile control (Post-confirm)
      * * Command Keys
      * CASE: CTL.*CMD key is Sweep Orders to MG
     C           *IN06     IFEQ '1'                        *IF
      * 03/27/25 DN SR27558-Deactivated. JS 'TMSORDSWP' will auto run eve
     C                     GOTO EAEXIT                     *QUIT
      * F6=Sweep all to MG
     C                     MOVEL*BLANK    YL0013           Return Code Usr
      * PAR.Thru Date Pass        USR = CTL.USR Through Date
     C                     Z-ADD#CBEDT    P4AJAG           Thru Date Pass
      * PAR.From Date Pass        USR = CTL.Scheduled Ship Date USR
     C                     Z-ADD#CHODT    P4AJAD           From Date Pass
     C                     Z-ADD#2AIC3    P3AJAA           Company Number
     C                     Z-ADD#2C4NB    P3AJAE           Order Number 1
     C                     Z-ADD#2BKC7    P3AJNC           Customer Number
     C                     MOVEL#CUTNA    P1BCNA           Customer Purcha
     C                     MOVEL*BLANK    P1FVSX           OH Load Plan Re
     C                     MOVEL'Y'       P1FVSX           OH Load Plan Re
     C                     MOVEL'SWP'     P5PECF           Pricing Event C
     C                     MOVEL'A'       P3HWSX           Change Flag USR
     C                     MOVEL#2BRTX    P1BRTX           Ship To Name
     C                     MOVEL#2HNNA    P3L3NA           USR Description
      * PAR.Date 0          PASS  USR = CTL.Requested Delivery Date
     C                     Z-ADD#2EIDT    P4U1AQ           Date 0
     C                     MOVEL#CBOCD    P3ZSST           Trans Type 1 PA
     C                     MOVEL#2DBCD    P3ZTST           Trans Type 2 PA
     C                     MOVEL#CAJCD    P3T3CD           Warehouse Code
      * SBM Sweep Ords to MG   CL - Order Header TRG  * 
     C                     CALL 'PBTJUPC'              90  SBM Sweep Ords
     C           YL0013    PARM *BLANK    WQ0029  7        Return Code Usr
     C                     PARM P1BRTX    WQ0030 30        Ship To Name
     C                     PARM P1BCNA    WQ0031 15        Customer Purcha
     C                     PARM P1FVSX    WQ0032  2        OH Load Plan Re
     C                     PARM P4AJAG    WQ0033 155       Thru Date Pass
     C                     PARM P4AJAD    WQ0034 155       From Date Pass
     C                     PARM P4U1AQ    WQ0035 155       Date 0
     C                     PARM P3AJAA    WQ0036 155       Company Number
     C                     PARM P3AJNC    WQ0037 155       Customer Number
     C                     PARM P3AJAE    WQ0038 155       Order Number 1
     C                     PARM P3T3CD    WQ0039  3        Warehouse Code
     C                     PARM P3ZSST    WQ0040  2        Trans Type 1 PA
     C                     PARM P3ZTST    WQ0041  2        Trans Type 2 PA
     C                     PARM P3HWSX    WQ0042  1        Change Flag USR
     C                     PARM P3L3NA    WQ0043 20        USR Description
     C                     PARM P5PECF    WQ0044  3        Pricing Event C
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBTJUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Send message 'Sweep all ords to MG'
     C                     MOVEL'USR4858' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     ELSE
      * CASE: CTL.*CMD key is *Refresh
     C           *IN05     IFEQ '1'                        *IF
      * F5=Refresh
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     ELSE
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           *IN81     IFEQ '1'
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END                             WOD *92
     C                     END                             FI *81
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      * USER: Final processing (Post-confirm)
     C                     MOVEL'Y'       W0DCF            *Defer confirm
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,46
     C                     SETOF                     98
      * USER: Process subfile record (Post-confirm)
      * 1=Select to sweep to MG
      * CASE: RCD.*SFLSEL is *Select
     C           #1SEL     IFEQ '1'                        *IF
     C           #1SEL     OREQ ' 1'
      * Rtv Crt OH Trigger    XF - TMS Order Header Trigger  * 
     C                     CALL 'PBWVXFR'              90  Rtv Crt OH Trig
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1C4NB    WQ0045  70       Order Number
     C                     PARM #1AIC3    WQ0046  30       Company Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBWVXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: RCD.OH Load Plan Ready is Not Sent to TMS
     C           #1FVSX    IFEQ *BLANK                     *IF
     C           #1FVSX    OREQ 'N'
      * CHG OH Load Plan Ready CH - Order Header TRG  * 
     C                     EXSR SFCHRC
     C                     END                             *FI
     C                     MOVEL*BLANK    YL0013           Return Code Usr
      * Setup message data for message
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1C4NB    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    ZA0003           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0003           CD7 Ext Numeric
     C                     END                             *FI
      * Send message 'Sweep order to MG sched'
     C                     MOVEL'USR4857' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C                     SETON                     84    SFLNXTCHG
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     GOTO EBEXIT
     C                     ELSE
      * SFLRCD valid
     C                     SETOF                     84    SFLNXTCHG
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN79
     C           #RBQC3    IFGT *ZERO                      *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BFCPTT fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     Z-ADDBEANC7    #1ANC7           AR Customer Num
     C                     Z-ADDBEGNDT    #1GNDT           Actual Shipped
     C                     Z-ADDBEAIC3    #1AIC3           Company Number
     C                     MOVELBEHMNA    #1HMNA           Ship To Address
     C                     MOVELBEHONA    #1HONA           Ship To Address
     C                     MOVELBEHPNA    #1HPNA           Ship To Address
     C                     MOVELBECKTX    #1CKTX           Ship To Zip_Pos
     C                     Z-ADDBEB0C7    #1B0C7           Bill to Custome
     C                     MOVELBEAETX    #1AETX           Bill to Name
     C                     MOVELBEB1NA    #1B1NA           Bill to Address
     C                     MOVELBEB3NA    #1B3NA           Bill to Address
     C                     MOVELBEB4NA    #1B4NA           Bill to Address
     C                     MOVELBEB2NA    #1B2NA           Bill to City
     C                     MOVELBEBHCD    #1BHCD           Bill to State C
     C                     MOVELBEC8TX    #1C8TX           Bill to Zip_Pos
     C                     MOVELBER4CD    #1R4CD           Sales Route Cod
     C                     MOVELBEQ2CD    #1Q2CD           Shipping Method
     C                     MOVELBEU2ST    #1U2ST           Export Status
     C                     Z-ADDBEA0DT    #1A0DT           Order Date
     C                     Z-ADDBEA5DT    #1A5DT           Requested Ship
     C                     Z-ADDBEACDT    #1ACDT           Cancel Date
     C                     MOVELBEAQCD    #1AQCD           Terms Code
     C                     MOVELBEB6NA    #1B6NA           Special Instruc
     C                     MOVELBEBYNA    #1BYNA           Special Instruc
     C                     MOVELBEBZNA    #1BZNA           Carrier Code
     C                     MOVELBEGTST    #1GTST           Comment Print A
     C                     MOVELBEGVST    #1GVST           Comment Print I
     C                     MOVELBEGUST    #1GUST           Comment Print P
     C                     MOVELBEQFST    #1QFST           Comment Print S
     C                     MOVELBECQCD    #1CQCD           Reason Code
     C                     MOVELBEGJST    #1GJST           Order in Use
     C                     MOVELBEGXST    #1GXST           Header Status L
     C                     MOVELBEGYST    #1GYST           Order Type Prin
     C                     MOVELBEAIVN    #1AIVN           User Original E
     C                     Z-ADDBECXDT    #1CXDT           Date of Origina
     C                     Z-ADDBEJZVA    #1JZVA           Order Value Tot
     C                     Z-ADDBEA1WG    #1A1WG           Order Weight To
     C                     MOVELBEXIST    #1XIST           Credit Hold
     C                     MOVELBEXJST    #1XJST           Production Hold
     C                     MOVELBEXKST    #1XKST           New Customer Ho
     C                     MOVELBEE8CD    #1E8CD           Accounts Receiv
     C                     MOVELBEE9CD    #1E9CD           Accounts Receiv
     C                     Z-ADDBERMNB    #1RMNB           Load ID
     C                     Z-ADDBETBNB    #1TBNB           Absorbed Freigh
     C                     Z-ADDBER1NB    #1R1NB           Rated Freight
     C                     MOVELBEPJST    #1PJST           LTL Flag
     C                     MOVELBEU0ST    #1U0ST           Price Audit
     C                     MOVELBEU1ST    #1U1ST           Price Status
     C                     MOVELBEGWST    #1GWST           Header Status
     C                     MOVELBEVEST    #1VEST           Palletize
     C                     MOVELBEVFST    #1VFST           Shrink Wrap
     C                     MOVELBEVGST    #1VGST           Slip Sheet
     C                     MOVELBERPCD    #1RPCD           Age Code
     C                     Z-ADDBERNNB    #1RNNB           Reefer Temperat
     C                     Z-ADDBEATIN    #1ATIN           Attach to Invoi
     C                     MOVELBEU4ST    #1U4ST           Load Plan Order
     C                     MOVELBEU5ST    #1U5ST           Print Pick Slip
     C                     Z-ADDBERSRN    #1RSRN           Resell Referenc
     C                     MOVELBEMHNA    #1MHNA           Special Comment
     C                     MOVELBEMINA    #1MINA           Special Comment
     C                     MOVELBEWBST    #1WBST           Affect Auto Acc
     C                     MOVELBEBFCD    #1BFCD           Manager Level C
     C                     MOVELBEQ4CD    #1Q4CD           VP Level Code
     C                     Z-ADDBET3NB    #1T3NB           Attach to Order
     C                     MOVELBESICD    #1SICD           Reason for Pric
     C                     Z-ADDBECONB    #1CONB           Invoice Number
     C                     MOVELBECEST    #1CEST           Invoice Suffix
     C                     Z-ADDBEAWDT    #1AWDT           Invoice Date
     C                     MOVELBEJPCD    #1JPCD           Event Code
     C                     MOVELBEXUST    #1XUST           Trans Contol AS
     C                     MOVELBEZ1ST    #1Z1ST           Modified Flag
     C                     Z-ADDBEVRVA    #1VRVA           A_R order Value
     C                     MOVELBEOBST    #1OBST           Billing Activit
     C                     MOVELBEBCST    #1BCST           Block Order Fla
     C                     MOVELBEBDST    #1BDST           Order Certifica
     C                     Z-ADDBEB7VL    #1B7VL           Invoice Order V
     C                     MOVELBEGASX    #1GASX           Process Sts for
     C                     MOVELBEGBSX    #1GBSX           Order Conf Fax
     C                     MOVELBEGCSX    #1GCSX           Manifest Fax St
     C                     MOVELBEGDSX    #1GDSX           Invoice Fax Sts
     C                     MOVELBEFNSX    #1FNSX           Transfer in Sto
     C                     MOVELBEFOSX    #1FOSX           Email Cust On O
     C                     MOVELBEFPSX    #1FPSX           Order Emailed
     C                     MOVELBEFQSX    #1FQSX           Export Docs Go
     C                     MOVELBEFRSX    #1FRSX           Shipping Temp C
     C                     MOVELBEFSSX    #1FSSX           Broker Order St
     C                     MOVELBEFTSX    #1FTSX           Air Freight Ord
     C                     MOVELBEFUSX    #1FUSX           Order Requires
     C                     MOVELBEFVSX    #1FVSX           OH Load Plan Re
     C                     MOVELBEFWSX    #1FWSX           Export USDA App
     C                     MOVELBEFXSX    #1FXSX           HPB Ship to War
     C                     MOVELBEFYSX    #1FYSX           OH TF Exempt Co
     C                     Z-ADDBENODT    #1NODT           OH Appt Confirm
     C                     Z-ADDBENPDT    #1NPDT           JPN Invoice Iss
     C                     Z-ADDBENQDT    #1NQDT           Load Actual Shi
     C                     Z-ADDBENRDT    #1NRDT           Load BOL Comple
     C                     Z-ADDBENSDT    #1NSDT           Load Truck Depa
     C                     Z-ADDBEBPTM    #1BPTM           Maximum Gross W
     C                     Z-ADDBEBQTM    #1BQTM           Time of Origina
     C                     Z-ADDBEBRTM    #1BRTM           OH Appt Confirm
     C                     Z-ADDBEBSTM    #1BSTM           Load BOL Comple
     C                     Z-ADDBEBTTM    #1BTTM           Load Truck Depa
     C                     Z-ADDBEH0NX    #1H0NX           Act Frt Referen
     C                     Z-ADDBEH1NX    #1H1NX           Act Non_Ref Frt
     C                     Z-ADDBEH2NX    #1H2NX           OH Fuel Surchar
     C                     Z-ADDBEH3NX    #1H3NX           OH Total Non_Re
     C                     Z-ADDBEH4NX    #1H4NX           OH Total Ref Fr
     C                     Z-ADDBEC0C7    #1C0C7           Claim Number
     C                     MOVELBEUVST    #1UVST           EDI Status 1
     C                     MOVELBEUWST    #1UWST           EDI Status 2
     C                     MOVELBEUXST    #1UXST           EDI Status 3
     C                     Z-ADDBEAATM    #1AATM           Job Time
     C                     MOVELBEAYNA    #1AYNA           User Id
     C                     MOVELBEA0NA    #1A0NA           Job Name
     C                     Z-ADDBEAXDT    #1AXDT           Job Date
     C                     Z-ADDBEAODT    #1AODT           Scheduled Ship
      * Clear external version also
     C                     Z-ADD*ZERO     V1AODT
     C                     Z-ADDBEC4NB    #1C4NB           Order Number
      * Clear external version also
     C                     MOVEL*BLANK    V1C4NB
     C                     MOVELBEJNCD    #1JNCD           Order Type_Sale
     C                     MOVELBEVDST    #1VDST           Load Type
     C                     Z-ADDBEBKC7    #1BKC7           Ship To Custome
      * Clear external version also
     C                     MOVEL*BLANK    V1BKC7
     C                     MOVELBEBRTX    #1BRTX           Ship To Name
     C                     MOVELBEHNNA    #1HNNA           Ship To City
     C                     MOVELBEDBCD    #1DBCD           Ship To State C
     C                     MOVELBEBCNA    #1BCNA           Customer Purcha
     C                     Z-ADDBEEIDT    #1EIDT           Requested Deliv
      * Clear external version also
     C                     Z-ADD*ZERO     V1EIDT
     C                     Z-ADDBEAFTM    #1AFTM           Requested Deliv
     C                     Z-ADD*ZERO     #RBQC3           Company Number
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RAJCD           Warehouse Code
     C                     Z-ADD*ZERO     #RDTWG           Weight Adjust
     C                     MOVEL*BLANK    #RODCD           USR Unit of Mea
     C                     MOVEL*BLANK    #RBOCD           Type Code
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #CUTNA           USR Customer PO
     C                     Z-ADD*ZERO     #2RMNB           Load ID
     C                     Z-ADD*ZERO     #2NPDT           JPN Invoice Iss
     C                     MOVEL*BLANK    #2BRTX           Ship To Name
     C                     MOVEL*BLANK    #2HNNA           Ship To City
     C                     MOVEL*BLANK    #2R4CD           Sales Route Cod
     C                     MOVEL*BLANK    #2Q2CD           Shipping Method
     C                     MOVEL*BLANK    #2U2ST           Export Status
     C                     Z-ADD*ZERO     #2AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V2AIC3
     C                     Z-ADD*ZERO     #CHODT           Scheduled Ship
      * Clear external version also
     C                     Z-ADD*ZERO     VCHODT
     C                     Z-ADD*ZERO     #CBEDT           USR Through Dat
      * Clear external version also
     C                     Z-ADD*ZERO     VCBEDT
     C                     Z-ADD*ZERO     #2AODT           Scheduled Ship
      * Clear external version also
     C                     Z-ADD*ZERO     V2AODT
     C                     MOVEL*BLANK    #CAJCD           Warehouse Code
     C                     Z-ADD*ZERO     #2C4NB           Order Number
      * Clear external version also
     C                     MOVEL*BLANK    V2C4NB
     C                     MOVEL*BLANK    #2JNCD           Order Type_Sale
     C                     MOVEL*BLANK    #2VDST           Load Type
     C                     Z-ADD*ZERO     #2BKC7           Ship To Custome
      * Clear external version also
     C                     MOVEL*BLANK    V2BKC7
     C                     MOVEL*BLANK    #CUJTX           Name 25A USR
     C                     MOVEL*BLANK    #CMPT1           City 11 USR
     C                     MOVEL*BLANK    #2DBCD           Ship To State C
     C                     MOVEL*BLANK    #2BCNA           Customer Purcha
     C                     Z-ADD*ZERO     #CDTWG           Weight Adjust
     C                     MOVEL*BLANK    #CODCD           USR Unit of Mea
     C                     Z-ADD*ZERO     #2EIDT           Requested Deliv
      * Clear external version also
     C                     Z-ADD*ZERO     V2EIDT
     C                     Z-ADD*ZERO     #2AFTM           Requested Deliv
     C                     MOVEL*BLANK    #CBOCD           Type Code
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert Scheduled Ship Date to display format
      * Convert date
     C           1000000   ADD  #1AODT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1AODT
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1C4NB    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V1C4NB           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1C4NB           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Ship To Customer to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1BKC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1BKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V1BKC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1BKC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Requested Delivery Date to display format
      * Convert date
     C           1000000   ADD  #1EIDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1EIDT
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #2AIC3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V2AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2AIC3           CD3 Ext Numeric
     C                     END                             *FI
      * Convert Scheduled Ship Date USR to display format
      * Convert date
     C           1000000   ADD  #CHODT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCHODT
      * Convert USR Through Date to display format
      * Convert date
     C           1000000   ADD  #CBEDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCBEDT
      * Convert Scheduled Ship Date to display format
      * Convert date
     C           1000000   ADD  #2AODT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2AODT
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #2C4NB    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#2C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V2C4NB           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2C4NB           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Ship To Customer to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #2BKC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#2BKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V2BKC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2BKC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Requested Delivery Date to display format
      * Convert date
     C           1000000   ADD  #2EIDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2EIDT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Type              RT - Order Header Extension  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           AMAIC3           Company Number
     C                     KFLD           AMC4NB           Order Number
      * Setup key
     C                     Z-ADD#1AIC3    AMAIC3           Company Number
     C                     Z-ADD#1C4NB    AMC4NB           Order Number
      * Establish starting position
     C           KRSSA     CHAIN@AMREJF              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3697' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0004           OHE Override Ty
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAMCHTX    YL0004           OHE Override Ty
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV UM/Whs Code-Add CS RT - Order Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y'       WUTAST           First Time Flag
     C                     Z-ADD*ZERO     YL0007           Boxes Total Qua
      * Declare restrictor key work fields
     C           *LIKE     DEFN OMAIC3    WQSB01           Company Number
     C           *LIKE     DEFN OMC4NB    WQSB02           Order Number
      * Define keylist
     C           KPSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
      * Setup key
     C                     Z-ADD#1AIC3    WQSB01           Company Number
     C                     Z-ADD#1C4NB    WQSB02           Order Number
     C                     Z-ADD1         OMDPNB           Order Sequence
     C                     Z-ADD0         OMUENB           Order Secondary
      * Establish starting position
     C           KPSSB     SETLL@BGWKL1                    *
     C           KRSSB     READE@BGWKL1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1309' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = CON By name
     C                     MOVEL*BLANK    #RAJCD           Warehouse Code
     C                     MOVEL*BLANK    #RODCD           USR Unit of Mea
     C                     GOTO SBEXIT                     *QUIT
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PF3280 -- add "Cases" to the case-stmt
     C                     MOVELOMAJCD    #RAJCD           Warehouse Code
      * CASE:
      *  - c1ORc2ORc3ORc4
      *   |- c1    : DB1.U/M - Ordered is Combos
      *   |- c2    : DB1.U/M - Ordered is EQ Boxes
      *   |- c3    : DB1.U/M - Ordered is Mixed
      *   |- c4    : DB1.U/M - Ordered is Cases
      *   '-
     C           OMAGCD    IFEQ 'CB'                       *IF
     C           OMAGCD    OREQ 'BX'                       *OR
     C           OMAGCD    OREQ 'MX'                       *OR
     C           OMAGCD    OREQ 'CS'                       *OR
      * CASE: DB1.Detail Line Status is Cancelled
     C           OMGMST    IFEQ 'X'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * S17054 DN 04/06/21-Beyond this point, changed all 'U/M - Ordered'
      *   to reference LCL Context instead of DB1.
      * S17054 DN 04/06/21-Count Type 'Cases' (CS) as 'Boxes' (BX).
      * CASE: *OTHERWISE
     C                     MOVELOMAGCD    YL0008           U_M_Ordered
      * CASE: LCL.U/M - Ordered is Cases
     C           YL0008    IFEQ 'CS'                       *IF
     C                     MOVEL'BX'      YL0008           U_M_Ordered
     C                     END                             *FI
      * Sum for later check
      * CASE: LCL.U/M - Ordered is EQ Boxes
     C           YL0008    IFEQ 'BX'                       *IF
     C                     ADD  OMAVQT    YL0007           Boxes Total Qua
     C                     END                             *FI
      * CASE: PAR.USR Unit of Measure is *Blank
     C           #RODCD    IFEQ *BLANK                     *IF
     C                     MOVELYL0008    #RODCD           USR Unit of Mea
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: LCL.U/M - Ordered EQ PAR.USR Unit of Measure
     C           YL0008    IFEQ #RODCD                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'MX'      WUAGCD           U_M_Ordered
     C                     MOVELWUAGCD    #RODCD           USR Unit of Mea
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSB     READE@BGWKL1                  90*
     C                     ENDDO
      * USER: Exit processing
      * E2709 RMC 9/12/13  Classify as BX/CB - never MX
      * CASE: PAR.USR Unit of Measure is Mixed
     C           #RODCD    IFEQ 'MX'                       *IF
      * RTV Numeric Value      RT - Company Values  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDOMAIC3    WL0001           Company Number
     C                     MOVEL'BOXLOAD' WL0002    P      Company Value C
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0003    YL0009           System Value Nu
      * CASE: LCL.Boxes Total Quantity LT LCL.Box Load Min Box Qty USR
     C           YL0007    IFLT YL0009                     *IF
     C                     MOVEL'CB'      #RODCD           USR Unit of Mea
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'BX'      #RODCD           USR Unit of Mea
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Numeric Value      RT - Company Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           KMAIC3           Company Number
     C                     KFLD           KMV8CD           Company Value C
      * Setup key
     C                     Z-ADDWL0001    KMAIC3           Company Number
     C                     MOVELWL0002    KMV8CD           Company Value C
      * Establish starting position
     C           KRSSC     CHAIN@KMREHC              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2221' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDKMM8NB    WL0003           System Value Nu
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Chk Any DtlExists  RT - Order Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * Declare restrictor key work fields
     C           *LIKE     DEFN OMAIC3    WQSD01           Company Number
     C           *LIKE     DEFN OMC4NB    WQSD02           Order Number
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Order Number
      * Setup key
     C                     Z-ADDBEAIC3    WQSD01           Company Number
     C                     Z-ADDBEC4NB    WQSD02           Order Number
      * Establish starting position
     C           KRSSD     SETLL@BGWKL1                    *
     C           KRSSD     READE@BGWKL1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1309' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Detail Line Status is Not cancelled
     C           OMGMST    IFEQ 'L'                        *IF
     C           OMGMST    OREQ 'A'
     C           OMGMST    OREQ 'C'
     C           OMGMST    OREQ 'R'
     C           OMGMST    OREQ 'E'
     C           OMGMST    OREQ 'H'
     C           OMGMST    OREQ 'I'
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
     C           KRSSD     READE@BGWKL1                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * VAL RTV Ord/Type existsRT - Load Order Change Log  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN LHC4NB    WQSE02           Order Number
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE02           Order Number
      * Setup key
     C                     Z-ADD#1C4NB    WQSE02           Order Number
      * Establish starting position
     C           KRSSE     SETLL@LHCPZ1                    *
     C           KRSSE     READE@LHCPZ1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2471' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     #RBQC3           Company Number
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: PAR.Load Change Type EQ DB1.Load Change Type
     C           'ORDCMP'  IFEQ LHRVST                     *IF
      * PAR = DB1 By name
     C                     Z-ADDLHAIC3    #RBQC3           Company Number
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSE     READE@LHCPZ1                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * CHG OH Load Plan Ready CH - Order Header TRG  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  2        Order Type_Sale
     C                     Z-ADD*ZERO     WN0002  70       AR Customer Num
     C                     Z-ADD*ZERO     WN0003  70       Ship To Custome
     C                     MOVEL*BLANK    WN0004 30        Ship To Name
     C                     MOVEL*BLANK    WN0005 30        Ship To Address
     C                     MOVEL*BLANK    WN0006 30        Ship To Address
     C                     MOVEL*BLANK    WN0007 30        Ship To Address
     C                     MOVEL*BLANK    WN0008 20        Ship To City
     C                     MOVEL*BLANK    WN0009  2        Ship To State C
     C                     MOVEL*BLANK    WN0010 11        Ship To Zip_Pos
     C                     Z-ADD*ZERO     WN0011  70       Bill to Custome
     C                     MOVEL*BLANK    WN0012 30        Bill to Name
     C                     MOVEL*BLANK    WN0013 30        Bill to Address
     C                     MOVEL*BLANK    WN0014 30        Bill to Address
     C                     MOVEL*BLANK    WN0015 30        Bill to Address
     C                     MOVEL*BLANK    WN0016 20        Bill to City
     C                     MOVEL*BLANK    WN0017  2        Bill to State C
     C                     MOVEL*BLANK    WN0018 11        Bill to Zip_Pos
     C                     MOVEL*BLANK    WN0019 15        Customer Purcha
     C                     Z-ADD*ZERO     WN0020  70       Order Date
     C                     Z-ADD*ZERO     WN0021  70       Requested Ship
     C                     Z-ADD*ZERO     WN0022  70       Actual Shipped
     C                     Z-ADD*ZERO     WN0023  70       Cancel Date
     C                     MOVEL*BLANK    WN0024  2        Terms Code
     C                     MOVEL*BLANK    WN0025 40        Special Instruc
     C                     MOVEL*BLANK    WN0026 40        Special Instruc
     C                     MOVEL*BLANK    WN0027  3        Carrier Code
     C                     MOVEL*BLANK    WN0028  1        Comment Print A
     C                     MOVEL*BLANK    WN0029  1        Comment Print I
     C                     MOVEL*BLANK    WN0030  1        Comment Print P
     C                     MOVEL*BLANK    WN0031  1        Comment Print S
     C                     MOVEL*BLANK    WN0032  3        Reason Code
     C                     MOVEL*BLANK    WN0033  1        Order in Use
     C                     MOVEL*BLANK    WN0034  1        Header Status
     C                     MOVEL*BLANK    WN0035  1        Header Status L
     C                     MOVEL*BLANK    WN0036  1        Order Type Prin
     C                     Z-ADD*ZERO     WN0037  70       Scheduled Ship
     C                     MOVEL*BLANK    WN0038 10        User Original E
     C                     Z-ADD*ZERO     WN0039  70       Date of Origina
     C                     Z-ADD*ZERO     WN0040 112       Order Value Tot
     C                     Z-ADD*ZERO     WN0041 112       Order Weight To
     C                     MOVEL*BLANK    WN0042  1        Credit Hold
     C                     MOVEL*BLANK    WN0043  1        Production Hold
     C                     MOVEL*BLANK    WN0044  1        New Customer Ho
     C                     Z-ADD*ZERO     WN0045  70       Requested Deliv
     C                     Z-ADD*ZERO     WN0046  40       Requested Deliv
     C                     MOVEL*BLANK    WN0047  4        Accounts Receiv
     C                     MOVEL*BLANK    WN0048 12        Accounts Receiv
     C                     Z-ADD*ZERO     WN0049  70       Load ID
     C                     Z-ADD*ZERO     WN0050  52       Absorbed Freigh
     C                     Z-ADD*ZERO     WN0051 112       Rated Freight
     C                     MOVEL*BLANK    WN0052  1        LTL Flag
     C                     MOVEL*BLANK    WN0053  1        Price Audit
     C                     MOVEL*BLANK    WN0054  1        Price Status
     C                     MOVEL*BLANK    WN0055  2        Shipping Method
     C                     MOVEL*BLANK    WN0056  1        Export Status
     C                     MOVEL*BLANK    WN0057  1        Palletize
     C                     MOVEL*BLANK    WN0058  1        Shrink Wrap
     C                     MOVEL*BLANK    WN0059  1        Slip Sheet
     C                     MOVEL*BLANK    WN0060  1        Age Code
     C                     Z-ADD*ZERO     WN0061  52       Reefer Temperat
     C                     MOVEL*BLANK    WN0062  1        Load Type
     C                     Z-ADD*ZERO     WN0063  70       Attach to Invoi
     C                     MOVEL*BLANK    WN0064  1        Load Plan Order
     C                     MOVEL*BLANK    WN0065  1        Print Pick Slip
     C                     Z-ADD*ZERO     WN0066  70       Resell Referenc
     C                     MOVEL*BLANK    WN0067 30        Special Comment
     C                     MOVEL*BLANK    WN0068 30        Special Comment
     C                     MOVEL*BLANK    WN0069  1        Affect Auto Acc
     C                     MOVEL*BLANK    WN0070  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0071  2        Manager Level C
     C                     MOVEL*BLANK    WN0072  3        VP Level Code
     C                     Z-ADD*ZERO     WN0073  70       Attach to Order
     C                     MOVEL*BLANK    WN0074  3        Reason for Pric
     C                     Z-ADD*ZERO     WN0075  70       Invoice Number
     C                     MOVEL*BLANK    WN0076  2        Invoice Suffix
     C                     Z-ADD*ZERO     WN0077  70       Invoice Date
     C                     MOVEL*BLANK    WN0078  2        Event Code
     C                     MOVEL*BLANK    WN0079  1        Trans Contol AS
     C                     MOVEL*BLANK    WN0080  1        Modified Flag
     C                     Z-ADD*ZERO     WN0081 112       A_R order Value
     C                     MOVEL*BLANK    WN0082  1        Billing Activit
     C                     MOVEL*BLANK    WN0083  1        Block Order Fla
     C                     MOVEL*BLANK    WN0084  1        Order Certifica
     C                     Z-ADD*ZERO     WN0085 112       Invoice Order V
     C                     MOVEL*BLANK    WN0086  1        Process Sts for
     C                     MOVEL*BLANK    WN0087  1        Order Conf Fax
     C                     MOVEL*BLANK    WN0088  1        Manifest Fax St
     C                     MOVEL*BLANK    WN0089  1        Invoice Fax Sts
     C                     MOVEL*BLANK    WN0090  1        Transfer in Sto
     C                     MOVEL*BLANK    WN0091  1        Email Cust On O
     C                     MOVEL*BLANK    WN0092  1        Order Emailed
     C                     MOVEL*BLANK    WN0093  1        Export Docs Go
     C                     MOVEL*BLANK    WN0094  1        Shipping Temp C
     C                     MOVEL*BLANK    WN0095  1        Broker Order St
     C                     MOVEL*BLANK    WN0096  1        Air Freight Ord
     C                     MOVEL*BLANK    WN0097  2        Order Requires
     C                     MOVEL*BLANK    WN0098  2        Export USDA App
     C                     MOVEL*BLANK    WN0099  3        HPB Ship to War
     C                     MOVEL*BLANK    WN0100  3        OH TF Exempt Co
     C                     Z-ADD*ZERO     WN0101  70       OH Appt Confirm
     C                     Z-ADD*ZERO     WN0102  70       JPN Invoice Iss
     C                     Z-ADD*ZERO     WN0103  70       Load Actual Shi
     C                     Z-ADD*ZERO     WN0104  70       Load BOL Comple
     C                     Z-ADD*ZERO     WN0105  70       Load Truck Depa
     C                     Z-ADD*ZERO     WN0106  60       Maximum Gross W
     C                     Z-ADD*ZERO     WN0107  60       Time of Origina
     C                     Z-ADD*ZERO     WN0108  60       OH Appt Confirm
     C                     Z-ADD*ZERO     WN0109  60       Load BOL Comple
     C                     Z-ADD*ZERO     WN0110  60       Load Truck Depa
     C                     Z-ADD*ZERO     WN0111 112       Act Frt Referen
     C                     Z-ADD*ZERO     WN0112 112       Act Non_Ref Frt
     C                     Z-ADD*ZERO     WN0113 112       OH Fuel Surchar
     C                     Z-ADD*ZERO     WN0114 112       OH Total Non_Re
     C                     Z-ADD*ZERO     WN0115 112       OH Total Ref Fr
     C                     Z-ADD*ZERO     WN0116  70       Claim Number
     C                     MOVEL*BLANK    WN0117  1        EDI Status 1
     C                     MOVEL*BLANK    WN0118  1        EDI Status 2
     C                     MOVEL*BLANK    WN0119  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0120  60       Job Time
     C                     MOVEL*BLANK    WN0121 10        User Id
     C                     MOVEL*BLANK    WN0122 10        Job Name
     C                     Z-ADD*ZERO     WN0123  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BECPFJ
     C                     Z-ADD#1AIC3    WAAIC3           Company Number
     C                     Z-ADD#1C4NB    WAC4NB           Order Number
      *
     C           KLCHSF    KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
     C           KLCHSF    CHAIN@BECPFJ              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C           W0RTN     IFNE *BLANK                     IF
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'OPBFCPL0'MDACP
     C                     MOVEL'@BECPFJ' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     ENDIF
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOPBF1    YARDCS
      * Move non-key fields to @BECPFJ
     C                     MOVEL'Y'       WAFVSX    P      OH Load Plan Re
      *
      * Set PGM.*Record Data Changed flag
     C           QOPBF1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp.PgmIF
     C                     Z-ADD##JTM     WAAATM           Job Time
     C                     MOVEL##USR     WAAYNA           User Id
     C                     MOVEL##PGM     WAA0NA           Job Name
     C                     Z-ADD##JDT     WAAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QOPBF1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BECPFJ                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOPBFCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0124    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSG     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    P2I6ST           Allow Multi_Com
     C                     MOVELDRMPNA    P2MPNA           Default Printer
     C                     MOVELDRBCCD    P2BCCD           Salesperson Cod
     C                     Z-ADDDRAIC3    YL0014           Company Number
     C                     MOVELDRBUVN    WN0125           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - User Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0004    DTAJVN           User Profile Na
     C                     MOVELWL0005    DTDNCD           Application Cod
      * Establish starting position
     C           KRSSH     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0006           Company Number
     C                     MOVELDTAJCD    WL0007           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSI01           Application Cod
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           Application Cod
      * Setup key
     C                     MOVELP2DNCD    WQSI01           Application Cod
      * Establish starting position
     C           KRSSI     SETLL@DNRESF                    *
     C           KRSSI     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SJRVGN
     C                     END                             *FI
     C           KRSSI     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSJ01           Application Cod
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSJ01           Application Cod
      * Establish starting position
     C           KRSSJ     SETLL@DNRESF                    *
     C           KRSSJ     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSJ     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         XDCK2     BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
     C                     Z-ADD*ZERO     XDINDT
      * If external date is zero, do not check
     C           XDEXDT    CABEQ*ZERO     XDCK2E
      *................................................................
      * Map external to internal according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDEX02    XDINDD           DD
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDEX02    XDINMM           MM
     C                     Z-ADDXDEX03    XDINDD           DD
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDEX02    XDINYY           YY
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINDD           DD
     C                     END
     C                     END
      * If YY prior to the 'cut-off' year treat as 20YY.
     C           XDINYY    IFLT XOFFYY
     C                     ADD  100       XDINYY
     C                     END
     C           YPMTFD    CABNE*BLANK    XDCK2E
      *................................................................
      * Check months in range 1 to 12
     C           XDINMM    CABLT1         XDCK2M
     C           XDINMM    CABGT12        XDCK2M
      *................................................................
      * Check days in range 1 to maximum for month
     C           XDINDD    CABLT1         XDCK2M
     C           XDINDD    CABGT@XD,XDINMMXDCK2M
      *................................................................
      * Special case: leap year
     C           XDINMM    IFEQ 2
     C           XDINYY    IFNE *ZERO
     C           XDINYY    ANDNE200
     C           XDINYY    DIV  4         XDWK1   80
     C                     MVR            XDWK1
     C                     ELSE
     C                     Z-ADD1         XDWK1
     C                     END
      * Year is not leap
     C           XDWK1     IFNE *ZERO
     C           XDINDD    CABGT28        XDCK2M
     C                     END
     C                     END
     C                     GOTO XDCK2E
      *................................................................
      * Send error message
     C           XDCK2M    TAG
      * Send message '*Invalid date'
     C                     MOVEL'Y2U0006' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0006' W0RTN
      * Disable time portion if timestamp is validated
     C                     Z-ADD*ZERO     XTTIM
      *================================================================
     CSR         XDCK2E    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD11        ZHSTRW  40
     C                     Z-ADD23        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Reclaim resources of called programs
     C                     CALL 'Y2RCRSC'
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      *
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1C4NB           Order Number
     C                     MOVEL*BLANK    P1JNCD           Order Type_Sale
     C                     Z-ADD*ZERO     P1ANC7           AR Customer Num
     C                     MOVEL*BLANK    P1BRTX           Ship To Name
     C                     MOVEL*BLANK    P1BCNA           Customer Purcha
     C                     MOVEL*BLANK    P1Q2CD           Shipping Method
     C                     MOVEL*BLANK    P1U2ST           Export Status
     C                     MOVEL*BLANK    P1R4CD           Sales Route Cod
     C                     MOVEL*BLANK    P1FVSX           OH Load Plan Re
      * Clear all neither parameters
     C                     MOVEL*BLANK    P2AJCD           Warehouse Code
     C                     Z-ADD*ZERO     P2AIC3           Company Number
     C                     MOVEL*BLANK    P2DNCD           Application Cod
     C                     MOVEL*BLANK    P2BCCD           Salesperson Cod
     C                     MOVEL*BLANK    P2I6ST           Allow Multi_Com
     C                     MOVEL*BLANK    P2MPNA           Default Printer
     C                     MOVEL*BLANK    P2TAST           First Time Flag
     C                     MOVEL*BLANK    P2O1ST           Live with TPM
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P3AJAA           Company Number
     C                     Z-ADD*ZERO     P3AJNC           Customer Number
     C                     Z-ADD*ZERO     P3AJAE           Order Number 1
     C                     MOVEL*BLANK    P3T3CD           Warehouse Code
     C                     MOVEL*BLANK    P3ZSST           Trans Type 1 PA
     C                     MOVEL*BLANK    P3ZTST           Trans Type 2 PA
     C                     MOVEL*BLANK    P3HWSX           Change Flag USR
     C                     MOVEL*BLANK    P3L3NA           USR Description
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P4KCDT           Date In
     C                     Z-ADD*ZERO     P4KDDT           Date Out
     C                     Z-ADD*ZERO     P4AJAG           Thru Date Pass
     C                     Z-ADD*ZERO     P4AJAD           From Date Pass
     C                     Z-ADD*ZERO     P4U1AQ           Date 0
      * Clear all neither parameters
     C                     MOVEL*BLANK    P5PECF           Pricing Event C
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Scheduled Ship Date USR
     C                     Z-ADD*ZERO     WUHODT  70
      * Define work field USR Through Date
     C                     Z-ADD*ZERO     WUBEDT  70
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field *Record selected
     C                     MOVEL*BLANK    WURSL   1
      * Define work field Text 2
     C                     MOVEL*BLANK    WUHKT1  2
      * Define work field SH Genset Number
     C                     MOVEL*BLANK    WUWGT1 30
      * Define work field USR Qclscan Result ?
     C                     Z-ADD*ZERO     WUY8NB  30
      * Define work field Text 20               USR
     C                     MOVEL*BLANK    WUSZTX 20
      * Define work field First Time Flag
     C                     MOVEL*BLANK    WUTAST  1
      * Define work field U_M_Ordered
     C                     MOVEL*BLANK    WUAGCD  2
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Define work field City 11 USR
     C                     MOVEL*BLANK    WUMPT1 11
      * Define work field Ship To City
     C                     MOVEL*BLANK    WUHNNA 20
      * Define work field Type Code
     C                     MOVEL*BLANK    WUBOCD  2
      * Define work field Name 25A USR
     C                     MOVEL*BLANK    WUUJTX 25
      * Define work field Weight Adjust
     C                     Z-ADD*ZERO     WUDTWG  70
      * Define work field Warehouse Code
     C                     MOVEL*BLANK    WUAJCD  3
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WAANC7           AR Customer Num
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WACXDT           Date of Origina
     C                     Z-ADD*ZERO     WAJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WAA1WG           Order Weight To
     C                     Z-ADD*ZERO     WAEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WAAFTM           Requested Deliv
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WARNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAVRVA           A_R order Value
     C                     Z-ADD*ZERO     WAB7VL           Invoice Order V
     C                     Z-ADD*ZERO     WANODT           OH Appt Confirm
     C                     Z-ADD*ZERO     WANPDT           JPN Invoice Iss
     C                     Z-ADD*ZERO     WANQDT           Load Actual Shi
     C                     Z-ADD*ZERO     WANRDT           Load BOL Comple
     C                     Z-ADD*ZERO     WANSDT           Load Truck Depa
     C                     Z-ADD*ZERO     WABPTM           Maximum Gross W
     C                     Z-ADD*ZERO     WABQTM           Time of Origina
     C                     Z-ADD*ZERO     WABRTM           OH Appt Confirm
     C                     Z-ADD*ZERO     WABSTM           Load BOL Comple
     C                     Z-ADD*ZERO     WABTTM           Load Truck Depa
     C                     Z-ADD*ZERO     WAH0NX           Act Frt Referen
     C                     Z-ADD*ZERO     WAH1NX           Act Non_Ref Frt
     C                     Z-ADD*ZERO     WAH2NX           OH Fuel Surchar
     C                     Z-ADD*ZERO     WAH3NX           OH Total Non_Re
     C                     Z-ADD*ZERO     WAH4NX           OH Total Ref Fr
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL@CN,1     @CN,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SCRVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     MOVEL*BLANK    WL0002 10
     C                     Z-ADD*ZERO     WL0003 155
      * Define local variables for subroutine SHRVGN.
     C                     MOVEL*BLANK    WL0004 10
     C                     MOVEL*BLANK    WL0005  6
     C                     Z-ADD*ZERO     WL0006  30
     C                     MOVEL*BLANK    WL0007  3
      * Define local work field Date 0 RGT
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field Date 1 RGT
     C                     Z-ADD*ZERO     YL0002  70
      * Define local work field Date 2 RGT
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field OHE Override Type Code
     C                     MOVEL*BLANK    YL0004  2
      * Define local work field Live with TPM
     C                     MOVEL*BLANK    YL0005  1
      * Define local work field PFS AccuSort Active
     C                     MOVEL*BLANK    YL0006  1
      * Define local work field Boxes Total Quantity
     C                     Z-ADD*ZERO     YL0007 112
      * Define local work field U_M_Ordered
     C                     MOVEL*BLANK    YL0008  2
      * Define local work field Box Load Min Box Qty USR
     C                     Z-ADD*ZERO     YL0009  50
      * Define local work field Generic Message 80 USR
     C                     MOVEL*BLANK    YL0010 80
      * Define local work field Order Sequence Number
     C                     Z-ADD*ZERO     YL0011  30
      * Define local work field Order Secondary Line Seq
     C                     Z-ADD*ZERO     YL0012  30
      * Define local work field Return Code Usr
     C                     MOVEL*BLANK    YL0013  7
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0014  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0015  3
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * Retrieve the 'cut-off' year YY: 19YY-1999,2000-20(YY-1).
     C           *NAMVAR   DEFN Y2CTOFF   XOFF
     C                     IN   XOFF
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD13        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
     C                     MOVEL*BLANK    P2DNCD           Application Cod
     C                     MOVEL'OMS'     P2DNCD           Application Cod
      *
     C                     MOVEL*BLANK    WN0124 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0124           User Profile Na
      *
     C                     MOVEL*BLANK    WN0125 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SGRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0124    ZA0004           User Profile Na
     C                     MOVELP2DNCD    ZA0005           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0125    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0124    WL0004    P      User Profile Na
     C                     MOVELP2DNCD    WL0005    P      Application Cod
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0006    P2AIC3           Company Number
     C                     MOVELWL0007    YL0015    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0125    WL0004    P      User Profile Na
     C                     MOVELP2DNCD    WL0005    P      Application Cod
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0006    P2AIC3           Company Number
     C                     MOVELWL0007    YL0015    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0015    P2AJCD           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0124    ZA0006           User Profile Na
     C                     MOVELP2DNCD    ZA0007           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0014    IFNE 0                          *IF
     C                     Z-ADDYL0014    P2AIC3           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0015    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C           P2AJCD    PARM *BLANK    WQ0047  3        Warehouse Code
     C                     PARM YL0014    WQ0048  30       Shipping Compan
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SIRVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
     C                     Z-ADD9999999   W0SLM            *Scan limit
     C                     MOVEL'Y'       P2TAST           First Time Flag
     C                     MOVEL'ES'      WUHKT1           Text 2
      * EXC Rtv Status        XF - PFS Interface  * 
     C                     CALL 'PBXNXFR'              90  EXC Rtv Status
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2AIC3    WQ0049  30       PFS Company Num
     C                     PARM 'TMSLDP'  WQ0050  6        PFS Interface C
     C           YL0005    PARM *BLANK    WQ0051  1        PFS Carlisle Ac
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBXNXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * EXC Rtv Status-AS     XF - PFS Interface  * 
     C                     CALL 'PBX2XFR'              90  EXC Rtv Status-
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2AIC3    WQ0052  30       PFS Company Num
     C                     PARM 'TMSLDP'  WQ0053  6        PFS Interface C
     C           YL0006    PARM *BLANK    WQ0054  1        PFS AccuSort Ac
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBX2XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @XD
312931303130313130313031
** @CN
00001 Y2U0005
00002 USR0752
00003 F6 is invalid. Job Schedu
00004 le TMSORDSWP will auto
00005 sweep every 30 mins.
00006 ISROSEM
00007 ISMIKEB
00008 TPMTEST
00009 PRKTEST
00010 ISRCENT
00011 TRJARMS
