     H/TITLE TSTPrt Load Schdlng SBMXF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISJHIGH
     H* Date          : 10/13/14  Time  : 09:36:51
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
      * Long constants
     E                    @CN#    1  03  6   @CN    25
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * Outward parameters
     IPARC        DS                             30
      * RCD : PAR Load Schdlng Rpt
      * I :  Company Number
     I                                    P   1   20PAAIC3
      * I :  From Date             USR
     I                                    P   3   60PAL9DT
      * I :  To Date               USR
     I                                    P   7  100PAMADT
      * I :  From Load ID  USR
     I                                    P  11  140PAHQNX
      * I :  To Load ID  USR
     I                                    P  15  180PAHRNX
      * I :  Export Status
     I                                       19  19 PAU2ST
      * I :  U/M - Load Scheduling USR
     I                                       20  21 PAFGSX
      * I :  Load Grade
     I                                       22  22 PABPSX
      * I :  Untied Orders Flag USR
     I                                       23  23 PAFHSX
      * I :  USR Radio Button 1
     I                                       24  24 PAYGST
      * I :  USR Radio Button 2
     I                                       25  25 PAYHST
      * I :  USR Radio Button 3
     I                                       26  26 PAFFSX
      * I :  Warehouse Code
     I                                       27  29 PAAJCD
      *
      * Outward parameters
     IPBRC        DS                            270
      * RCD : Reporting Parms
      * I :  PRT Printer Device
     I                                       26  35 PBWRST
      * I :  PRT Hold Output Sts
     I                                       36  39 PBWSST
      * I :  PRT Save Output Sts
     I                                       40  43 PBWTST
      * I :  PRT Number of Copies
     I                                       44  450PBDYNB
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             30
      * RCD: PAR Load Schdlng Rpt
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  From Date             USR
     I                                    P   3   60P1L9DT
      * I :  To Date               USR
     I                                    P   7  100P1MADT
      * I :  From Load ID  USR
     I                                    P  11  140P1HQNX
      * I :  To Load ID  USR
     I                                    P  15  180P1HRNX
      * I :  Export Status
     I                                       19  19 P1U2ST
      * I :  U/M - Load Scheduling USR
     I                                       20  21 P1FGSX
      * I :  Load Grade
     I                                       22  22 P1BPSX
      * I :  Untied Orders Flag USR
     I                                       23  23 P1FHSX
      * I :  USR Radio Button 1
     I                                       24  24 P1YGST
      * I :  USR Radio Button 2
     I                                       25  25 P1YHST
      * I :  USR Radio Button 3
     I                                       26  26 P1FFSX
      * I :  Warehouse Code
     I                                       27  29 P1AJCD
     IP2PARM      DS                            270
      * RCD: Reporting Parms
      * I :  PRT Printer Device
     I                                       26  35 P2WRST
      * I :  PRT Hold Output Sts
     I                                       36  39 P2WSST
      * I :  PRT Save Output Sts
     I                                       40  43 P2WTST
      * I :  PRT Number of Copies
     I                                       44  450P2DYNB
     IP3PARM      DS
      * N :  Nbr of Copies-Alpha   USR
     I                                        1   2 P3YZCD
     IP4PARM      DS
      * N :  Printer File
     I                                        1  10 P4CPVN
     IP5PARM      DS
      * N :  From Library USR
     I                                        1  10 P5CWVN
     IP6PARM      DS
      * I : MAP Create Requested
     I                                        1   1 P6R5ST
     IP7PARM      DS
      * I :  Qty Less Than Zero    USR
     I                                        1   1 P7BDSC
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           RCD: *Arrays
     C                     PARM           P2PARM           RCD: *Arrays
     C           P6R5ST    PARM           WP0001  1        Create Requeste
     C           P7BDSC    PARM           WP0002  1        Qty Less Than Z
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * TSTPrt Load Schdlng SBMXF
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * 1. Override Printer File.
     C                     EXSR UBSUBR                     1. Override Pri
      * Files will be done based on the data libary that is ready
      * 2. Copy files from PRKFLIB TO qtemp
     C                     EXSR UCSUBR                     2. Copy files f
      * 3. Print Report.  Get Data Area, cpyf to qtemp & print report(s)
     C                     EXSR UDSUBR                     3. Print Report
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * E3328 JJH 10/13/14 - New option to print Quantities Less Than Zer
      *  This is test program that is in PRKPLIB, so program updated
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * 1. Override Printer File.
      *================================================================
     C                     MOVELP2DYNB    P3YZCD           Nbr of Copies-A
      * Report 1 (Sort by Load Id)
      * CASE: PAR.USR Radio Button 1 is Select X
     C           P1YGST    IFEQ 'X'                        *IF
     C                     MOVEL@CN,001   P4CPVN           Printer File
      * EXC Command SBDOVR     UP - /UT User Programs  * 
     C                     CALL 'PDPOUPR'              90  EXC Command SBD
     C                     PARM P4CPVN    WQ0001 10        Printer File
     C                     PARM P2WRST    WQ0002 10        PRT Printer Dev
     C                     PARM P2WSST    WQ0003  4        PRT Hold Output
     C                     PARM P2WTST    WQ0004  4        PRT Save Output
     C                     PARM P3YZCD    WQ0005  2        Nbr of Copies-A
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPOUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Report 2 (Sort by Scheduled Sequence Number)
      * CASE: PAR.USR Radio Button 2 is Select X
     C           P1YHST    IFEQ 'X'                        *IF
     C                     MOVEL@CN,002   P4CPVN           Printer File
      * EXC Command SBDOVR     UP - /UT User Programs  * 
     C                     CALL 'PDPOUPR'              90  EXC Command SBD
     C                     PARM P4CPVN    WQ0006 10        Printer File
     C                     PARM P2WRST    WQ0007 10        PRT Printer Dev
     C                     PARM P2WSST    WQ0008  4        PRT Hold Output
     C                     PARM P2WTST    WQ0009  4        PRT Save Output
     C                     PARM P3YZCD    WQ0010  2        Nbr of Copies-A
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPOUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Report 3 (Sort by Deadline Departure Date/Time)
      * CASE: PAR.USR Radio Button 3 is Select X
     C           P1FFSX    IFEQ 'X'                        *IF
     C                     MOVEL@CN,003   P4CPVN           Printer File
      * EXC Command SBDOVR     UP - /UT User Programs  * 
     C                     CALL 'PDPOUPR'              90  EXC Command SBD
     C                     PARM P4CPVN    WQ0011 10        Printer File
     C                     PARM P2WRST    WQ0012 10        PRT Printer Dev
     C                     PARM P2WSST    WQ0013  4        PRT Hold Output
     C                     PARM P2WTST    WQ0014  4        PRT Save Output
     C                     PARM P3YZCD    WQ0015  2        Nbr of Copies-A
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPOUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * 2. Copy files from PRKFLIB TO qtemp
      *================================================================
      * TSTPrt Load SchdlnQTEMPUP - Load Schdlng Position  * 
     C                     MOVEL'PMD5UCLP'WXPGM  10
     C                     MOVE 'T '      WXPGM
     C                     CALL WXPGM                  90  TSTPrt Load Sch
     C           YL0001    PARM YL0001    WQ0016  7        Return Code Usr
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL'PMD5UCLP'W0CLPG 10
     C                     MOVE 'T '      W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * 3. Print Report.  Get Data Area, cpyf to qtemp & print report(s)
      *================================================================
      * E3328 JJH 10/13/14 - New option to print Quantities Less Than Zer
      *  This is test program that is in PRKPLIB, so program updated
      * TSTPrt Load Schdlng S3 XF - Load Schdlng Position  * 
     C                     CLEARPARC
     C                     Z-ADDP1AIC3    PAAIC3           Company Number
     C                     Z-ADDP1L9DT    PAL9DT           From Date
     C                     Z-ADDP1MADT    PAMADT           To Date
     C                     Z-ADDP1HQNX    PAHQNX           From Load ID  U
     C                     Z-ADDP1HRNX    PAHRNX           To Load ID  USR
     C                     MOVELP1U2ST    PAU2ST    P      Export Status
     C                     MOVELP1FGSX    PAFGSX    P      U/M - Load Sche
     C                     MOVELP1BPSX    PABPSX    P      Load Grade
     C                     MOVELP1FHSX    PAFHSX    P      Untied Orders F
     C                     MOVELP1YGST    PAYGST    P      USR Radio Butto
     C                     MOVELP1YHST    PAYHST    P      USR Radio Butto
     C                     MOVELP1FFSX    PAFFSX    P      USR Radio Butto
     C                     MOVELP1AJCD    PAAJCD    P      Warehouse Code
     C                     CLEARPBRC
     C                     MOVELP2WRST    PBWRST    P      PRT Printer Dev
     C                     MOVELP2WSST    PBWSST    P      PRT Hold Output
     C                     MOVELP2WTST    PBWTST    P      PRT Save Output
     C                     Z-ADDP2DYNB    PBDYNB           PRT Number of C
      *
     C                     CALL 'PNODXFR'              90  TSTPrt Load Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: *Arrays
     C                     PARM           PBRC             RCD: *Arrays
     C                     PARM P6R5ST    WQ0017  1        Create Requeste
     C                     PARM P7BDSC    WQ0018  1        Qty Less Than Z
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNODXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P3YZCD           Nbr of Copies-A
     C                     MOVEL*BLANK    P4CPVN           Printer File
     C                     MOVEL*BLANK    P5CWVN           From Library US
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Return Code Usr
     C                     MOVEL*BLANK    YL0001  7
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 PDSEPFR$
00002 PDUCPFR$
00003 PDUDPFR$
