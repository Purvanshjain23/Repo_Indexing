// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKO2XFR
// ?Date: 14.08.2025 Time: 02:52:22
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?H16853 ISE 11/02/20 - Increased the Buy Order Number field
//?                      length from 5 to 7.
ENDDO;

EXECUTE FUNCTION(FIX HPE133 prob       RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1210916;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.TH Source Type is Internal
 IF DB1.TH_Source_Type = 'I';

 // AND DB1.TH Hog Class Type is Not Resale
 AND DB1.TH_Hog_Class_Type = 'M'/'S';

 // AND DB1.TH Head Killed is Not Zero
 AND DB1.TH_Head_Killed <> *ZERO;

 // AND DB1.TH Recalc Live Wgt is Greater than 0
 AND DB1.TH_Recalc_Live_Wgt > *ZERO;

 // PAR.Live wgt total 11.1   USR = CON.*ZERO
 PAR.Live_wgt_total_11_1_USR = *ZERO;

 EXECUTE FUNCTION(FIX HPE133 prob       RT) TYPE(RTVOBJ) FILE(PKB1CPP)           AB1210917;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(PAR.Live_wgt_total_11_1_USR);
 {
  //?USER: Process Data record

  // Call program Clc Live Weight       XF.
  CALL PROGRAM(Clc Live Weight       XF) ('PDO1XFR');
  PARAMETER(PAR.BOH_Company_Number);
  PARAMETER(DB1.CD_Carcass_Hot_Weight);
  PARAMETER(WRK.Num_Field_Not_Needed);
  PARAMETER(WRK.Live_wgt_total_11_1_USR);
  PARAMETER(WRK.Num_Field_Not_Needed);

  // PAR.Live wgt total 11.1   USR = PAR.Live wgt total 11.1   USR + WRK.Live wgt total 11.1   USR
  PAR.Live_wgt_total_11_1_USR = PAR.Live_wgt_total_11_1_USR + WRK.Live_wgt_total_11_1_USR;

 }

 // WRK.TH Adj Live Wgt = PAR.Live wgt total 11.1   USR
 WRK.TH_Adj_Live_Wgt = PAR.Live_wgt_total_11_1_USR;

 // WRK.TH Avg Live Wgt = PAR.Live wgt total 11.1   USR / DB1.TH Head Killed *
 WRK.TH_Avg_Live_Wgt = PAR.Live_wgt_total_11_1_USR / DB1.TH_Head_Killed;

 // Compute: Live wgt f/adj
 WRK.TH_Live_Wgt = WRK.TH_Adj_Live_Wgt + ( WRK.TH_Avg_Live_Wgt * ( DB1.TH_Yard_Deads
 + DB1.TH_Head_Condemned ) );

 //?Actual Yield
 CASE;

 // IF WRK.TH Live Wgt is Greater then Zero
 IF WRK.TH_Live_Wgt > *ZERO;

 // Compute: Actual Yield %
 WRK.TH_Actual_Yield = ( DB1.TH_Hot_Wgt / WRK.TH_Live_Wgt ) * 100;

 //?Actual Yield
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.TH Actual Yield % = CON.*ZERO
 WRK.TH_Actual_Yield = *ZERO;

 ENDIF;

 //?Adj Actual Yield
 CASE;

 // IF WRK.TH Adj Live Wgt is Greater then Zero
 IF WRK.TH_Adj_Live_Wgt > *ZERO;

 // Compute: Adj Actual Yield
 WRK.TH_Adj_Actual_Yield = ( DB1.TH_Hot_Wgt / WRK.TH_Adj_Live_Wgt ) * 100;

 //?Adj Actual Yield
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.TH Adj Actual Yield % = CON.*ZERO
 WRK.TH_Adj_Actual_Yield = *ZERO;

 ENDIF;

 // WRK.TH Yield Difference = WRK.TH Actual Yield % - DB1.TH Std Yield Percent
 WRK.TH_Yield_Difference = WRK.TH_Actual_Yield - DB1.TH_Std_Yield_Percent;

 EXECUTE FUNCTION(FIX HPE133 prob       CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1210918;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(WRK.TH_Live_Wgt);
 PARAMETER(WRK.TH_Adj_Live_Wgt);
 PARAMETER(WRK.TH_Avg_Live_Wgt);
 PARAMETER(WRK.TH_Actual_Yield);
 PARAMETER(WRK.TH_Adj_Actual_Yield);
 PARAMETER(WRK.TH_Yield_Difference);
 ENDIF;

}


