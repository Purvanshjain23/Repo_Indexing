// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKU3XFR
// ?Date: 14.08.2025 Time: 02:53:00
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// Call program Val Application/User  XF.
CALL PROGRAM(Val Application/User  XF) ('PDGXXFR');
PARAMETER(PAR.Oms_Warehouse_Code);
PARAMETER(PAR.CC_Company_Number);
PARAMETER('HPE');
PARAMETER(PAR.Oms_SalesPerson_Code);
PARAMETER(PAR.Oms_Allow_Multi_Company);
PARAMETER(PAR.Oms_Default_Printer);
PARAMETER(PAR.Oms_Name);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(PAR.Oms_Access_Denied_Y_N);

// LCL.CSD Year = JOB.*Job date *YEAR
LCL.CSD_Year = DATEDTLS(JOB.*Job_date 'YR' 1111111 'NONE' 'N' 1);

// LCL.CSD Month = JOB.*Job date *MONTH
LCL.CSD_Month = DATEDTLS(JOB.*Job_date 'MO' 1111111 'NONE' 'N' 1);

// LCL.CSD Month = LCL.CSD Month - CON.1
LCL.CSD_Month = LCL.CSD_Month - 1;

//?Prior Year
CASE;

// IF LCL.CSD Month is EQ Zero
IF LCL.CSD_Month = *ZERO;

// LCL.CSD Month = CON.12
LCL.CSD_Month = 12;

// LCL.CSD Year = LCL.CSD Year - CON.1
LCL.CSD_Year = LCL.CSD_Year - 1;

ENDIF;

// LCL.Year Alpha Usr = CVTVAR(LCL.CSD Year)
LCL.Year_Alpha_Usr = CVTVAR(LCL.CSD_Year);

// LCL.Month Alpha USR = CVTVAR(LCL.CSD Month)
LCL.Month_Alpha_USR = CVTVAR(LCL.CSD_Month);

//?From Date
// LCL.Date From Convert USR = CONCAT(LCL.Year Alpha Usr,LCL.Month Alpha USR,CON.*ZERO)
LCL.Date_From_Convert_USR = LCL.Year_Alpha_Usr + LCL.Month_Alpha_USR (*ZERO);

// LCL.Date From Convert USR = CONCAT(LCL.Date From Convert USR,CON.01,CON.*ZERO)
LCL.Date_From_Convert_USR = LCL.Date_From_Convert_USR + '01' (*ZERO);

// Call program Cvt Date              UP.
CALL PROGRAM(Cvt Date              UP) ('PKPOUPR');
PARAMETER(LCL.Date_From_Convert_USR);
PARAMETER(LCL.Date_To_Convert_USR);
PARAMETER(*YYMD);
PARAMETER(*CYMD);
PARAMETER(*NONE);

// LCL.Date Alpha USR = LCL.Date To Convert USR
LCL.Date_Alpha_USR = LCL.Date_To_Convert_USR;

// LCL.Date From USR = CVTVAR(LCL.Date Alpha USR)
LCL.Date_From_USR = CVTVAR(LCL.Date_Alpha_USR);

//?To Date
// LCL.Month Days USR = LCL.Date From USR *MONTH LENGTH
LCL.Month_Days_USR = DATEDTLS(LCL.Date_From_USR 'ML' 1111111 'NONE' 'N' 1);

// LCL.Number 1 USR = LCL.Month Days USR
LCL.Number_1_USR = LCL.Month_Days_USR;

// LCL.Text 2 USR = CVTVAR(LCL.Number 1 USR)
LCL.Text_2_USR = CVTVAR(LCL.Number_1_USR);

// LCL.Date From Convert USR = CONCAT(LCL.Year Alpha Usr,LCL.Month Alpha USR,CON.*ZERO)
LCL.Date_From_Convert_USR = LCL.Year_Alpha_Usr + LCL.Month_Alpha_USR (*ZERO);

// LCL.Date From Convert USR = CONCAT(LCL.Date From Convert USR,LCL.Text 2 USR,CON.*ZERO)
LCL.Date_From_Convert_USR = LCL.Date_From_Convert_USR + LCL.Text_2_USR (*ZERO);

// Call program Cvt Date              UP.
CALL PROGRAM(Cvt Date              UP) ('PKPOUPR');
PARAMETER(LCL.Date_From_Convert_USR);
PARAMETER(LCL.Date_To_Convert_USR);
PARAMETER(*YYMD);
PARAMETER(*CYMD);
PARAMETER(*NONE);

// LCL.Date Alpha USR = LCL.Date To Convert USR
LCL.Date_Alpha_USR = LCL.Date_To_Convert_USR;

// LCL.Date To   USR = CVTVAR(LCL.Date Alpha USR)
LCL.Date_To_USR = CVTVAR(LCL.Date_Alpha_USR);

// Call program Crt Std Deviation     UP.
CALL PROGRAM(Crt Std Deviation     UP) ('PKUUUPR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER('M');
PARAMETER(LCL.Date_From_USR);
PARAMETER(LCL.Date_To_USR);
PARAMETER(LCL.CSD_Month);
PARAMETER(*ZERO);

