     H/TITLE RTV Invent Stock Purge XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 02/22/17  Time  : 10:02:10
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPPBSCPLBIF  E           K        DISK
      * RSQ : Inventory Stock Closing   WeekEnd(D)/WhsCo/Whs/Itm
      *
     FPPBTCPL2IF  E           K        DISK
      * RSQ : Inventory Value File      WeekEnd-d
      *
     FPPBSCPL7IF  E           K        DISK                      A
      * UPD : Inventory Stock Closing   Update index for Purge
      *
     FPPBSCPL0UF  E           K        DISK
      * UPD : Inventory Stock Closing   Update index
      *
     FPPBTCPL4IF  E           K        DISK                      A
      * UPD : Inventory Value File      Update index for Purge
      *
     FPPBTCPL0UF  E           K        DISK
      * UPD : Inventory Value File      Update index
      *
     E                    YDOW        7  1               *Days of week
     I@BSCPZF
      * Inventory Stock Closing   WeekEnd(D)/WhsCo/Whs/Itm
      * Renamed input format fields
     I              BSAIDX                          WAAIDX
     I              BSB2C3                          WAB2C3
     I              BSGRAA                          WAGRAA
     I              BSEJC7                          WAEJC7
     I              BSV8SX                          WAV8SX
     I              BSGPAA                          WAGPAA
     I              BSGQAA                          WAGQAA
     I              BSW1SX                          WAW1SX
     I              BSF3PR                          WAF3PR
     I              BSBSNY                          WABSNY
     I              BSBTNY                          WABTNY
     I              BSBUNY                          WABUNY
     I              BSGSAA                          WAGSAA
     I              BSGTAA                          WAGTAA
     I              BSOEQT                          WAOEQT
     I              BSMQWG                          WAMQWG
     I              BSOFQT                          WAOFQT
     I              BSMRWG                          WAMRWG
     I              BSOGQT                          WAOGQT
     I              BSMXWG                          WAMXWG
     I              BSOHQT                          WAOHQT
     I              BSMSWG                          WAMSWG
     I              BSOWQT                          WAOWQT
     I              BSNAWG                          WANAWG
     I              BSOIQT                          WAOIQT
     I              BSMTWG                          WAMTWG
     I              BSOJQT                          WAOJQT
     I              BSMUWG                          WAMUWG
     I              BSOKQT                          WAOKQT
     I              BSMVWG                          WAMVWG
     I              BSOLQT                          WAOLQT
     I              BSMWWG                          WAMWWG
     I              BSFQVL                          WAFQVL
     I              BSOMQT                          WAOMQT
     I              BSMYWG                          WAMYWG
     I              BSONQT                          WAONQT
     I              BSMZWG                          WAMZWG
     I              BSOOQT                          WAOOQT
     I              BSM0WG                          WAM0WG
     I              BSDGVN                          WADGVN
     I              BSP9DT                          WAP9DT
     I              BSCTTM                          WACTTM
     I              BSOPQT                          WAOPQT
     I              BSM1WG                          WAM1WG
     I              BSOQQT                          WAOQQT
     I              BSM2WG                          WAM2WG
     I              BSORQT                          WAORQT
     I              BSM3WG                          WAM3WG
     I              BSOSQT                          WAOSQT
     I              BSM4WG                          WAM4WG
     I              BSRCNA                          WARCNA
     I              BSDFVN                          WADFVN
     I              BSP8DT                          WAP8DT
     I              BSCSTM                          WACSTM
     I              BSOTQT                          WAOTQT
     I              BSM5WG                          WAM5WG
     I              BSF4PR                          WAF4PR
     I              BSWBSX                          WAWBSX
     I              BSWNSX                          WAWNSX
     I              BSWOSX                          WAWOSX
     I              BSOUQT                          WAOUQT
     I              BSM6WG                          WAM6WG
     I              BSOVQT                          WAOVQT
     I              BSM7WG                          WAM7WG
     I              BSWCSX                          WAWCSX
     I              BSQADT                          WAQADT
     I              BSWDSX                          WAWDSX
     I              BSVSST                          WAVSST
     I              BSMJDT                          WAMJDT
     I              BSBETM                          WABETM
     I              BSCCVN                          WACCVN
     I              BSCDVN                          WACDVN
     I              BSMKDT                          WAMKDT
     I              BSBFTM                          WABFTM
     I              BSCEVN                          WACEVN
     I              BSCFVN                          WACFVN
      *
     I@BSCPNI
      * Inventory Stock Closing   Update index for Purge
      * Renamed input format fields
     I              BSAIDX                          WBAIDX
     I              BSB2C3                          WBB2C3
     I              BSGRAA                          WBGRAA
     I              BSEJC7                          WBEJC7
     I              BSV8SX                          WBV8SX
     I              BSGPAA                          WBGPAA
     I              BSGQAA                          WBGQAA
     I              BSW1SX                          WBW1SX
     I              BSF3PR                          WBF3PR
     I              BSBSNY                          WBBSNY
     I              BSBTNY                          WBBTNY
     I              BSBUNY                          WBBUNY
     I              BSGSAA                          WBGSAA
     I              BSGTAA                          WBGTAA
     I              BSOEQT                          WBOEQT
     I              BSMQWG                          WBMQWG
     I              BSOFQT                          WBOFQT
     I              BSMRWG                          WBMRWG
     I              BSOGQT                          WBOGQT
     I              BSMXWG                          WBMXWG
     I              BSOHQT                          WBOHQT
     I              BSMSWG                          WBMSWG
     I              BSOWQT                          WBOWQT
     I              BSNAWG                          WBNAWG
     I              BSOIQT                          WBOIQT
     I              BSMTWG                          WBMTWG
     I              BSOJQT                          WBOJQT
     I              BSMUWG                          WBMUWG
     I              BSOKQT                          WBOKQT
     I              BSMVWG                          WBMVWG
     I              BSOLQT                          WBOLQT
     I              BSMWWG                          WBMWWG
     I              BSFQVL                          WBFQVL
     I              BSOMQT                          WBOMQT
     I              BSMYWG                          WBMYWG
     I              BSONQT                          WBONQT
     I              BSMZWG                          WBMZWG
     I              BSOOQT                          WBOOQT
     I              BSM0WG                          WBM0WG
     I              BSDGVN                          WBDGVN
     I              BSP9DT                          WBP9DT
     I              BSCTTM                          WBCTTM
     I              BSOPQT                          WBOPQT
     I              BSM1WG                          WBM1WG
     I              BSOQQT                          WBOQQT
     I              BSM2WG                          WBM2WG
     I              BSORQT                          WBORQT
     I              BSM3WG                          WBM3WG
     I              BSOSQT                          WBOSQT
     I              BSM4WG                          WBM4WG
     I              BSRCNA                          WBRCNA
     I              BSDFVN                          WBDFVN
     I              BSP8DT                          WBP8DT
     I              BSCSTM                          WBCSTM
     I              BSOTQT                          WBOTQT
     I              BSM5WG                          WBM5WG
     I              BSF4PR                          WBF4PR
     I              BSWBSX                          WBWBSX
     I              BSWNSX                          WBWNSX
     I              BSWOSX                          WBWOSX
     I              BSOUQT                          WBOUQT
     I              BSM6WG                          WBM6WG
     I              BSOVQT                          WBOVQT
     I              BSM7WG                          WBM7WG
     I              BSWCSX                          WBWCSX
     I              BSQADT                          WBQADT
     I              BSWDSX                          WBWDSX
     I              BSVSST                          WBVSST
     I              BSMJDT                          WBMJDT
     I              BSBETM                          WBBETM
     I              BSCCVN                          WBCCVN
     I              BSCDVN                          WBCDVN
     I              BSMKDT                          WBMKDT
     I              BSBFTM                          WBBFTM
     I              BSCEVN                          WBCEVN
     I              BSCFVN                          WBCFVN
      *
     I@BSCPA5
      * Inventory Stock Closing   Update index
      * Renamed input format fields
     I              BSAIDX                          WCAIDX
     I              BSB2C3                          WCB2C3
     I              BSGRAA                          WCGRAA
     I              BSEJC7                          WCEJC7
     I              BSV8SX                          WCV8SX
     I              BSGPAA                          WCGPAA
     I              BSGQAA                          WCGQAA
     I              BSW1SX                          WCW1SX
     I              BSF3PR                          WCF3PR
     I              BSBSNY                          WCBSNY
     I              BSBTNY                          WCBTNY
     I              BSBUNY                          WCBUNY
     I              BSGSAA                          WCGSAA
     I              BSGTAA                          WCGTAA
     I              BSOEQT                          WCOEQT
     I              BSMQWG                          WCMQWG
     I              BSOFQT                          WCOFQT
     I              BSMRWG                          WCMRWG
     I              BSOGQT                          WCOGQT
     I              BSMXWG                          WCMXWG
     I              BSOHQT                          WCOHQT
     I              BSMSWG                          WCMSWG
     I              BSOWQT                          WCOWQT
     I              BSNAWG                          WCNAWG
     I              BSOIQT                          WCOIQT
     I              BSMTWG                          WCMTWG
     I              BSOJQT                          WCOJQT
     I              BSMUWG                          WCMUWG
     I              BSOKQT                          WCOKQT
     I              BSMVWG                          WCMVWG
     I              BSOLQT                          WCOLQT
     I              BSMWWG                          WCMWWG
     I              BSFQVL                          WCFQVL
     I              BSOMQT                          WCOMQT
     I              BSMYWG                          WCMYWG
     I              BSONQT                          WCONQT
     I              BSMZWG                          WCMZWG
     I              BSOOQT                          WCOOQT
     I              BSM0WG                          WCM0WG
     I              BSDGVN                          WCDGVN
     I              BSP9DT                          WCP9DT
     I              BSCTTM                          WCCTTM
     I              BSOPQT                          WCOPQT
     I              BSM1WG                          WCM1WG
     I              BSOQQT                          WCOQQT
     I              BSM2WG                          WCM2WG
     I              BSORQT                          WCORQT
     I              BSM3WG                          WCM3WG
     I              BSOSQT                          WCOSQT
     I              BSM4WG                          WCM4WG
     I              BSRCNA                          WCRCNA
     I              BSDFVN                          WCDFVN
     I              BSP8DT                          WCP8DT
     I              BSCSTM                          WCCSTM
     I              BSOTQT                          WCOTQT
     I              BSM5WG                          WCM5WG
     I              BSF4PR                          WCF4PR
     I              BSWBSX                          WCWBSX
     I              BSWNSX                          WCWNSX
     I              BSWOSX                          WCWOSX
     I              BSOUQT                          WCOUQT
     I              BSM6WG                          WCM6WG
     I              BSOVQT                          WCOVQT
     I              BSM7WG                          WCM7WG
     I              BSWCSX                          WCWCSX
     I              BSQADT                          WCQADT
     I              BSWDSX                          WCWDSX
     I              BSVSST                          WCVSST
     I              BSMJDT                          WCMJDT
     I              BSBETM                          WCBETM
     I              BSCCVN                          WCCCVN
     I              BSCDVN                          WCCDVN
     I              BSMKDT                          WCMKDT
     I              BSBFTM                          WCBFTM
     I              BSCEVN                          WCCEVN
     I              BSCFVN                          WCCFVN
      *
     I@BTCPBM
      * Inventory Value File      WeekEnd-d
      * Renamed input format fields
     I              BTWQSX                          WDWQSX
     I              BTAJDX                          WDAJDX
     I              BTEKC7                          WDEKC7
     I              BTELC7                          WDELC7
     I              BTWHSX                          WDWHSX
     I              BTWFSX                          WDWFSX
     I              BTGUAA                          WDGUAA
     I              BTGVAA                          WDGVAA
     I              BTBVNY                          WDBVNY
     I              BTBWNY                          WDBWNY
     I              BTBXNY                          WDBXNY
     I              BTF5PR                          WDF5PR
     I              BTGWAA                          WDGWAA
     I              BTGXAA                          WDGXAA
     I              BTWISX                          WDWISX
     I              BTWJSX                          WDWJSX
     I              BTFSVL                          WDFSVL
     I              BTFTVL                          WDFTVL
     I              BTAKDX                          WDAKDX
     I              BTFUVL                          WDFUVL
     I              BTM8WG                          WDM8WG
     I              BTFVVL                          WDFVVL
     I              BTFWVL                          WDFWVL
     I              BTRGNA                          WDRGNA
     I              BTFXVL                          WDFXVL
     I              BTWKSX                          WDWKSX
     I              BTFYVL                          WDFYVL
     I              BTRFNA                          WDRFNA
     I              BTFZVL                          WDFZVL
     I              BTWLSX                          WDWLSX
     I              BTM9WG                          WDM9WG
     I              BTWPSX                          WDWPSX
     I              BTQDDT                          WDQDDT
     I              BTVSST                          WDVSST
     I              BTMJDT                          WDMJDT
     I              BTBETM                          WDBETM
     I              BTCCVN                          WDCCVN
     I              BTCDVN                          WDCDVN
     I              BTMKDT                          WDMKDT
     I              BTBFTM                          WDBFTM
     I              BTCEVN                          WDCEVN
     I              BTCFVN                          WDCFVN
      *
     I@BTCPNJ
      * Inventory Value File      Update index for Purge
      * Renamed input format fields
     I              BTWQSX                          WEWQSX
     I              BTAJDX                          WEAJDX
     I              BTEKC7                          WEEKC7
     I              BTELC7                          WEELC7
     I              BTWHSX                          WEWHSX
     I              BTWFSX                          WEWFSX
     I              BTGUAA                          WEGUAA
     I              BTGVAA                          WEGVAA
     I              BTBVNY                          WEBVNY
     I              BTBWNY                          WEBWNY
     I              BTBXNY                          WEBXNY
     I              BTF5PR                          WEF5PR
     I              BTGWAA                          WEGWAA
     I              BTGXAA                          WEGXAA
     I              BTWISX                          WEWISX
     I              BTWJSX                          WEWJSX
     I              BTFSVL                          WEFSVL
     I              BTFTVL                          WEFTVL
     I              BTAKDX                          WEAKDX
     I              BTFUVL                          WEFUVL
     I              BTM8WG                          WEM8WG
     I              BTFVVL                          WEFVVL
     I              BTFWVL                          WEFWVL
     I              BTRGNA                          WERGNA
     I              BTFXVL                          WEFXVL
     I              BTWKSX                          WEWKSX
     I              BTFYVL                          WEFYVL
     I              BTRFNA                          WERFNA
     I              BTFZVL                          WEFZVL
     I              BTWLSX                          WEWLSX
     I              BTM9WG                          WEM9WG
     I              BTWPSX                          WEWPSX
     I              BTQDDT                          WEQDDT
     I              BTVSST                          WEVSST
     I              BTMJDT                          WEMJDT
     I              BTBETM                          WEBETM
     I              BTCCVN                          WECCVN
     I              BTCDVN                          WECDVN
     I              BTMKDT                          WEMKDT
     I              BTBFTM                          WEBFTM
     I              BTCEVN                          WECEVN
     I              BTCFVN                          WECFVN
      *
     I@BTCPA8
      * Inventory Value File      Update index
      * Renamed input format fields
     I              BTWQSX                          WFWQSX
     I              BTAJDX                          WFAJDX
     I              BTEKC7                          WFEKC7
     I              BTELC7                          WFELC7
     I              BTWHSX                          WFWHSX
     I              BTWFSX                          WFWFSX
     I              BTGUAA                          WFGUAA
     I              BTGVAA                          WFGVAA
     I              BTBVNY                          WFBVNY
     I              BTBWNY                          WFBWNY
     I              BTBXNY                          WFBXNY
     I              BTF5PR                          WFF5PR
     I              BTGWAA                          WFGWAA
     I              BTGXAA                          WFGXAA
     I              BTWISX                          WFWISX
     I              BTWJSX                          WFWJSX
     I              BTFSVL                          WFFSVL
     I              BTFTVL                          WFFTVL
     I              BTAKDX                          WFAKDX
     I              BTFUVL                          WFFUVL
     I              BTM8WG                          WFM8WG
     I              BTFVVL                          WFFVVL
     I              BTFWVL                          WFFWVL
     I              BTRGNA                          WFRGNA
     I              BTFXVL                          WFFXVL
     I              BTWKSX                          WFWKSX
     I              BTFYVL                          WFFYVL
     I              BTRFNA                          WFRFNA
     I              BTFZVL                          WFFZVL
     I              BTWLSX                          WFWLSX
     I              BTM9WG                          WFM9WG
     I              BTWPSX                          WFWPSX
     I              BTQDDT                          WFQDDT
     I              BTVSST                          WFVSST
     I              BTMJDT                          WFMJDT
     I              BTBETM                          WFBETM
     I              BTCCVN                          WFCCVN
     I              BTCDVN                          WFCDVN
     I              BTMKDT                          WFMKDT
     I              BTBFTM                          WFBFTM
     I              BTCEVN                          WFCEVN
     I              BTCFVN                          WFCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPPBS1    E DSPPBSCPL7
      * UPD : Inventory Stock Closing   Update index for Purge
      * Renamed input format fields
     I              BSAIDX                          WBAIDX
     I              BSB2C3                          WBB2C3
     I              BSGRAA                          WBGRAA
     I              BSEJC7                          WBEJC7
     I              BSV8SX                          WBV8SX
     I              BSGPAA                          WBGPAA
     I              BSGQAA                          WBGQAA
     I              BSW1SX                          WBW1SX
     I              BSF3PR                          WBF3PR
     I              BSBSNY                          WBBSNY
     I              BSBTNY                          WBBTNY
     I              BSBUNY                          WBBUNY
     I              BSGSAA                          WBGSAA
     I              BSGTAA                          WBGTAA
     I              BSOEQT                          WBOEQT
     I              BSMQWG                          WBMQWG
     I              BSOFQT                          WBOFQT
     I              BSMRWG                          WBMRWG
     I              BSOGQT                          WBOGQT
     I              BSMXWG                          WBMXWG
     I              BSOHQT                          WBOHQT
     I              BSMSWG                          WBMSWG
     I              BSOWQT                          WBOWQT
     I              BSNAWG                          WBNAWG
     I              BSOIQT                          WBOIQT
     I              BSMTWG                          WBMTWG
     I              BSOJQT                          WBOJQT
     I              BSMUWG                          WBMUWG
     I              BSOKQT                          WBOKQT
     I              BSMVWG                          WBMVWG
     I              BSOLQT                          WBOLQT
     I              BSMWWG                          WBMWWG
     I              BSFQVL                          WBFQVL
     I              BSOMQT                          WBOMQT
     I              BSMYWG                          WBMYWG
     I              BSONQT                          WBONQT
     I              BSMZWG                          WBMZWG
     I              BSOOQT                          WBOOQT
     I              BSM0WG                          WBM0WG
     I              BSDGVN                          WBDGVN
     I              BSP9DT                          WBP9DT
     I              BSCTTM                          WBCTTM
     I              BSOPQT                          WBOPQT
     I              BSM1WG                          WBM1WG
     I              BSOQQT                          WBOQQT
     I              BSM2WG                          WBM2WG
     I              BSORQT                          WBORQT
     I              BSM3WG                          WBM3WG
     I              BSOSQT                          WBOSQT
     I              BSM4WG                          WBM4WG
     I              BSRCNA                          WBRCNA
     I              BSDFVN                          WBDFVN
     I              BSP8DT                          WBP8DT
     I              BSCSTM                          WBCSTM
     I              BSOTQT                          WBOTQT
     I              BSM5WG                          WBM5WG
     I              BSF4PR                          WBF4PR
     I              BSWBSX                          WBWBSX
     I              BSWNSX                          WBWNSX
     I              BSWOSX                          WBWOSX
     I              BSOUQT                          WBOUQT
     I              BSM6WG                          WBM6WG
     I              BSOVQT                          WBOVQT
     I              BSM7WG                          WBM7WG
     I              BSWCSX                          WBWCSX
     I              BSQADT                          WBQADT
     I              BSWDSX                          WBWDSX
     I              BSVSST                          WBVSST
     I              BSMJDT                          WBMJDT
     I              BSBETM                          WBBETM
     I              BSCCVN                          WBCCVN
     I              BSCDVN                          WBCDVN
     I              BSMKDT                          WBMKDT
     I              BSBFTM                          WBBFTM
     I              BSCEVN                          WBCEVN
     I              BSCFVN                          WBCFVN
      *
     IQPPBS2    E DSPPBSCPL0
      * UPD : Inventory Stock Closing   Update index
      * Renamed input format fields
     I              BSAIDX                          WCAIDX
     I              BSB2C3                          WCB2C3
     I              BSGRAA                          WCGRAA
     I              BSEJC7                          WCEJC7
     I              BSV8SX                          WCV8SX
     I              BSGPAA                          WCGPAA
     I              BSGQAA                          WCGQAA
     I              BSW1SX                          WCW1SX
     I              BSF3PR                          WCF3PR
     I              BSBSNY                          WCBSNY
     I              BSBTNY                          WCBTNY
     I              BSBUNY                          WCBUNY
     I              BSGSAA                          WCGSAA
     I              BSGTAA                          WCGTAA
     I              BSOEQT                          WCOEQT
     I              BSMQWG                          WCMQWG
     I              BSOFQT                          WCOFQT
     I              BSMRWG                          WCMRWG
     I              BSOGQT                          WCOGQT
     I              BSMXWG                          WCMXWG
     I              BSOHQT                          WCOHQT
     I              BSMSWG                          WCMSWG
     I              BSOWQT                          WCOWQT
     I              BSNAWG                          WCNAWG
     I              BSOIQT                          WCOIQT
     I              BSMTWG                          WCMTWG
     I              BSOJQT                          WCOJQT
     I              BSMUWG                          WCMUWG
     I              BSOKQT                          WCOKQT
     I              BSMVWG                          WCMVWG
     I              BSOLQT                          WCOLQT
     I              BSMWWG                          WCMWWG
     I              BSFQVL                          WCFQVL
     I              BSOMQT                          WCOMQT
     I              BSMYWG                          WCMYWG
     I              BSONQT                          WCONQT
     I              BSMZWG                          WCMZWG
     I              BSOOQT                          WCOOQT
     I              BSM0WG                          WCM0WG
     I              BSDGVN                          WCDGVN
     I              BSP9DT                          WCP9DT
     I              BSCTTM                          WCCTTM
     I              BSOPQT                          WCOPQT
     I              BSM1WG                          WCM1WG
     I              BSOQQT                          WCOQQT
     I              BSM2WG                          WCM2WG
     I              BSORQT                          WCORQT
     I              BSM3WG                          WCM3WG
     I              BSOSQT                          WCOSQT
     I              BSM4WG                          WCM4WG
     I              BSRCNA                          WCRCNA
     I              BSDFVN                          WCDFVN
     I              BSP8DT                          WCP8DT
     I              BSCSTM                          WCCSTM
     I              BSOTQT                          WCOTQT
     I              BSM5WG                          WCM5WG
     I              BSF4PR                          WCF4PR
     I              BSWBSX                          WCWBSX
     I              BSWNSX                          WCWNSX
     I              BSWOSX                          WCWOSX
     I              BSOUQT                          WCOUQT
     I              BSM6WG                          WCM6WG
     I              BSOVQT                          WCOVQT
     I              BSM7WG                          WCM7WG
     I              BSWCSX                          WCWCSX
     I              BSQADT                          WCQADT
     I              BSWDSX                          WCWDSX
     I              BSVSST                          WCVSST
     I              BSMJDT                          WCMJDT
     I              BSBETM                          WCBETM
     I              BSCCVN                          WCCCVN
     I              BSCDVN                          WCCDVN
     I              BSMKDT                          WCMKDT
     I              BSBFTM                          WCBFTM
     I              BSCEVN                          WCCEVN
     I              BSCFVN                          WCCFVN
      *
     IQPPBT1    E DSPPBTCPL4
      * UPD : Inventory Value File      Update index for Purge
      * Renamed input format fields
     I              BTWQSX                          WEWQSX
     I              BTAJDX                          WEAJDX
     I              BTEKC7                          WEEKC7
     I              BTELC7                          WEELC7
     I              BTWHSX                          WEWHSX
     I              BTWFSX                          WEWFSX
     I              BTGUAA                          WEGUAA
     I              BTGVAA                          WEGVAA
     I              BTBVNY                          WEBVNY
     I              BTBWNY                          WEBWNY
     I              BTBXNY                          WEBXNY
     I              BTF5PR                          WEF5PR
     I              BTGWAA                          WEGWAA
     I              BTGXAA                          WEGXAA
     I              BTWISX                          WEWISX
     I              BTWJSX                          WEWJSX
     I              BTFSVL                          WEFSVL
     I              BTFTVL                          WEFTVL
     I              BTAKDX                          WEAKDX
     I              BTFUVL                          WEFUVL
     I              BTM8WG                          WEM8WG
     I              BTFVVL                          WEFVVL
     I              BTFWVL                          WEFWVL
     I              BTRGNA                          WERGNA
     I              BTFXVL                          WEFXVL
     I              BTWKSX                          WEWKSX
     I              BTFYVL                          WEFYVL
     I              BTRFNA                          WERFNA
     I              BTFZVL                          WEFZVL
     I              BTWLSX                          WEWLSX
     I              BTM9WG                          WEM9WG
     I              BTWPSX                          WEWPSX
     I              BTQDDT                          WEQDDT
     I              BTVSST                          WEVSST
     I              BTMJDT                          WEMJDT
     I              BTBETM                          WEBETM
     I              BTCCVN                          WECCVN
     I              BTCDVN                          WECDVN
     I              BTMKDT                          WEMKDT
     I              BTBFTM                          WEBFTM
     I              BTCEVN                          WECEVN
     I              BTCFVN                          WECFVN
      *
     IQPPBT2    E DSPPBTCPL0
      * UPD : Inventory Value File      Update index
      * Renamed input format fields
     I              BTWQSX                          WFWQSX
     I              BTAJDX                          WFAJDX
     I              BTEKC7                          WFEKC7
     I              BTELC7                          WFELC7
     I              BTWHSX                          WFWHSX
     I              BTWFSX                          WFWFSX
     I              BTGUAA                          WFGUAA
     I              BTGVAA                          WFGVAA
     I              BTBVNY                          WFBVNY
     I              BTBWNY                          WFBWNY
     I              BTBXNY                          WFBXNY
     I              BTF5PR                          WFF5PR
     I              BTGWAA                          WFGWAA
     I              BTGXAA                          WFGXAA
     I              BTWISX                          WFWISX
     I              BTWJSX                          WFWJSX
     I              BTFSVL                          WFFSVL
     I              BTFTVL                          WFFTVL
     I              BTAKDX                          WFAKDX
     I              BTFUVL                          WFFUVL
     I              BTM8WG                          WFM8WG
     I              BTFVVL                          WFFVVL
     I              BTFWVL                          WFFWVL
     I              BTRGNA                          WFRGNA
     I              BTFXVL                          WFFXVL
     I              BTWKSX                          WFWKSX
     I              BTFYVL                          WFFYVL
     I              BTRFNA                          WFRFNA
     I              BTFZVL                          WFFZVL
     I              BTWLSX                          WFWLSX
     I              BTM9WG                          WFM9WG
     I              BTWPSX                          WFWPSX
     I              BTQDDT                          WFQDDT
     I              BTVSST                          WFVSST
     I              BTMJDT                          WFMJDT
     I              BTBETM                          WFBETM
     I              BTCCVN                          WFCCVN
     I              BTCDVN                          WFCDVN
     I              BTMKDT                          WFMKDT
     I              BTBFTM                          WFBFTM
     I              BTCEVN                          WFCEVN
     I              BTCFVN                          WFCFVN
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Purge Date USR
     I                                    P   1   40P1NGDT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1NGDT    PARM           WP0001  70       Purge Date USR
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * RTV Invent Stock Purge XF
      * ** Convert CYYMMDD date to YYYYMMDD
      *
     C                     MOVEL*BLANK    WN0001  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0002  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0003  2        Month (Char) US
     C                     MOVEL*BLANK    WN0004  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           P1NGDT    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0001
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           P1NGDT    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0002
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           P1NGDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0003
     C                     MOVEL*BLANK    WN0002           Year Alpha (YYY
     C                     MOVELYL0001    WN0002           Year Alpha (YYY
     C                     MOVELYL0002    WN0003           Month (Char) US
     C                     MOVELYL0003    WN0004           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0002    CAT  WN0003:ZQ WN0001    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0001    CAT  WN0004:ZQ WN0001    P      Date (Char-8) U
     C                     MOVE WN0001    WUAIDX           Date Out (8,0)
      * R9083 02/22/17 DN-Changed to Use New Access Path PPBSCPLB.
      * RTV Inventory Stock Purge - Inventory Stock Closing  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWUAIDX    WL0001           ISC Week Ending
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Inventory Stock Purge - Inventory Stock Closing  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAAIDX           ISC Week Ending
      * Setup key
     C                     Z-ADDWL0001    WAAIDX           ISC Week Ending
      * Establish starting position
     C           KPSSA     SETLL@BSCPZF                    *
     C                     READ @BSCPZF                  90*
      * Data record not found
     C   90                MOVEL'USR3529' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT Inventory Stock Purge - Inventory Stock Closing  * 
     C                     EXSR SBCRRC
      * Del Inventory Stock   DO - Inventory Stock Closing  * 
     C                     EXSR SCDLRC
     C                     READ @BSCPZF                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * CRT Inventory Stock Purge - Inventory Stock Closing  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BSCPNI
     C                     Z-ADDWAAIDX    WBAIDX           ISC Week Ending
     C                     Z-ADDWAB2C3    WBB2C3           ISC Warehouse C
     C                     MOVELWAGRAA    WBGRAA           ISC Warehouse C
     C                     Z-ADDWAEJC7    WBEJC7           ISC Item Code
     C                     MOVELWAV8SX    WBV8SX           ISC Warehouse T
     C                     MOVELWAGPAA    WBGPAA           ISC Item Cmdty
     C                     MOVELWAGQAA    WBGQAA           ISC Item Dft Cm
     C                     MOVELWAW1SX    WBW1SX           ISC Item Type
     C                     Z-ADDWAF3PR    WBF3PR           ISC Item Market
     C                     Z-ADDWABSNY    WBBSNY           ISC Item Struct
     C                     Z-ADDWABTNY    WBBTNY           ISC Item Struct
     C                     Z-ADDWABUNY    WBBUNY           ISC Item Struct
     C                     MOVELWAGSAA    WBGSAA           ISC Item G/L Su
     C                     MOVELWAGTAA    WBGTAA           ISC Item U/M -
     C                     Z-ADDWAOEQT    WBOEQT           ISC Beg Inv Fin
     C                     Z-ADDWAMQWG    WBMQWG           ISC Beg Inv Fin
     C                     Z-ADDWAOFQT    WBOFQT           ISC Beg Inv Adj
     C                     Z-ADDWAMRWG    WBMRWG           ISC Beg Inv Adj
     C                     Z-ADDWAOGQT    WBOGQT           ISC Beg Inv Qty
     C                     Z-ADDWAMXWG    WBMXWG           ISC Beg Inv Lbs
     C                     Z-ADDWAOHQT    WBOHQT           ISC Floor Produ
     C                     Z-ADDWAMSWG    WBMSWG           ISC Floor Produ
     C                     Z-ADDWAOWQT    WBOWQT           ISC Floor Prod
     C                     Z-ADDWANAWG    WBNAWG           ISC Floor Prod
     C                     Z-ADDWAOIQT    WBOIQT           ISC Sales Produ
     C                     Z-ADDWAMTWG    WBMTWG           ISC Sales Produ
     C                     Z-ADDWAOJQT    WBOJQT           ISC Inventory S
     C                     Z-ADDWAMUWG    WBMUWG           ISC Inventory S
     C                     Z-ADDWAOKQT    WBOKQT           ISC Ord Dtl Shi
     C                     Z-ADDWAMVWG    WBMVWG           ISC Ord Dtl Shi
     C                     Z-ADDWAOLQT    WBOLQT           ISC Shipment Fi
     C                     Z-ADDWAMWWG    WBMWWG           ISC Shipment Fi
     C                     Z-ADDWAFQVL    WBFQVL           ISC FOB Gross A
     C                     Z-ADDWAOMQT    WBOMQT           ISC Inventory T
     C                     Z-ADDWAMYWG    WBMYWG           ISC Inventory T
     C                     Z-ADDWAONQT    WBONQT           ISC Misc Invntr
     C                     Z-ADDWAMZWG    WBMZWG           ISC Misc Invntr
     C                     Z-ADDWAOOQT    WBOOQT           ISC Ending Inve
     C                     Z-ADDWAM0WG    WBM0WG           ISC Ending Inve
     C                     MOVELWADGVN    WBDGVN           ISC End Inv Use
     C                     Z-ADDWAP9DT    WBP9DT           ISC End Inv Dat
     C                     Z-ADDWACTTM    WBCTTM           ISC End Inv Tim
     C                     Z-ADDWAOPQT    WBOPQT           ISC Sun Shp Inv
     C                     Z-ADDWAM1WG    WBM1WG           ISC Sun Shp Inv
     C                     Z-ADDWAOQQT    WBOQQT           ISC Unsh/Ship I
     C                     Z-ADDWAM2WG    WBM2WG           ISC Unsh/Ship I
     C                     Z-ADDWAORQT    WBORQT           ISC End Inv Par
     C                     Z-ADDWAM3WG    WBM3WG           ISC End Inv Par
     C                     Z-ADDWAOSQT    WBOSQT           ISC End Inv Adj
     C                     Z-ADDWAM4WG    WBM4WG           ISC End Inv Adj
     C                     MOVELWARCNA    WBRCNA           ISC End Inv Adj
     C                     MOVELWADFVN    WBDFVN           ISC Ending Inv
     C                     Z-ADDWAP8DT    WBP8DT           ISC Ending Inv
     C                     Z-ADDWACSTM    WBCSTM           ISC Ending Inv
     C                     Z-ADDWAOTQT    WBOTQT           ISC End Inv Fin
     C                     Z-ADDWAM5WG    WBM5WG           ISC End Inv Fin
     C                     Z-ADDWAF4PR    WBF4PR           ISC Warehouse P
     C                     MOVELWAWBSX    WBWBSX           ISC Warehouse P
     C                     MOVELWAWNSX    WBWNSX           ISC Post Balanc
     C                     MOVELWAWOSX    WBWOSX           ISC Post Wareho
     C                     Z-ADDWAOUQT    WBOUQT           ISC Commission
     C                     Z-ADDWAM6WG    WBM6WG           ISC Unused Lbs
     C                     Z-ADDWAOVQT    WBOVQT           ISC TF Exempt N
     C                     Z-ADDWAM7WG    WBM7WG           ISC TF Exempt L
     C                     MOVELWAWCSX    WBWCSX           ISC Valuation G
     C                     Z-ADDWAQADT    WBQADT           ISC Unused Date
     C                     MOVELWAWDSX    WBWDSX           ISC Unused Sts
     C                     MOVELWAVSST    WBVSST           Record Status
     C                     Z-ADDWAMJDT    WBMJDT           Create Date
     C                     Z-ADDWABETM    WBBETM           Create Time
     C                     MOVELWACCVN    WBCCVN           Create User
     C                     MOVELWACDVN    WBCDVN           Create Program
     C                     Z-ADDWAMKDT    WBMKDT           Change Date
     C                     Z-ADDWABFTM    WBBFTM           Change Time
     C                     MOVELWACEVN    WBCEVN           Change User
     C                     MOVELWACFVN    WBCFVN           Change Program
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBAIDX           ISC Week Ending
     C                     KFLD           WBB2C3           ISC Warehouse C
     C                     KFLD           WBGRAA           ISC Warehouse C
     C                     KFLD           WBEJC7           ISC Item Code
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BSCPNI                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3530' W0RTN   7
      * Send message 'Inventory Stock Closin EX'
     C                     MOVEL'USR3530' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@BSCPNI                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * Del Inventory Stock   DO - Inventory Stock Closing  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data update
      * R9083 02/22/17 DN-Access Path is Read by WeekEnd. Removed RST on
      * RTV Inventory Value Purge - Inventory Value File  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWAAIDX    WL0002           IVF Week Ending
     C                     EXSR SDRVGN
      * Move key fields to @BSCPA5
     C                     Z-ADDWAAIDX    WCAIDX           ISC Week Ending
     C                     Z-ADDWAB2C3    WCB2C3           ISC Warehouse C
     C                     MOVELWAGRAA    WCGRAA           ISC Warehouse C
     C                     Z-ADDWAEJC7    WCEJC7           ISC Item Code
      *
     C           KLDLSC    KLIST
     C                     KFLD           WCAIDX           ISC Week Ending
     C                     KFLD           WCB2C3           ISC Warehouse C
     C                     KFLD           WCGRAA           ISC Warehouse C
     C                     KFLD           WCEJC7           ISC Item Code
     C           KLDLSC    CHAIN@BSCPA5              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PPBSCPL0'MDACP
     C                     MOVEL'@BSCPA5' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BSCPA5                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Inventory Value Purge - Inventory Value File  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WDAJDX           IVF Week Ending
      * Setup key
     C                     Z-ADDWL0002    WDAJDX           IVF Week Ending
      * Establish starting position
     C           KPSSD     SETLL@BTCPBM                    *
     C                     READ @BTCPBM                  90*
      * Data record not found
     C   90                MOVEL'USR3531' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT Inventory Value Purge - Inventory Value File  * 
     C                     EXSR SECRRC
      * Del Inventory Value   DO - Inventory Value File  * 
     C                     EXSR SFDLRC
     C                     READ @BTCPBM                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * CRT Inventory Value Purge - Inventory Value File  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BTCPNJ
     C                     MOVELWDWQSX    WEWQSX           IVF Valuation G
     C                     Z-ADDWDAJDX    WEAJDX           IVF Week Ending
     C                     Z-ADDWDEKC7    WEEKC7           IVF Item Code
     C                     Z-ADDWDELC7    WEELC7           IVF WIP - FG It
     C                     MOVELWDWHSX    WEWHSX           IVF Item Type
     C                     MOVELWDWFSX    WEWFSX           IVF Unused Sts
     C                     MOVELWDGUAA    WEGUAA           IVF Item Cmdty
     C                     MOVELWDGVAA    WEGVAA           IVF Item Dft Cm
     C                     Z-ADDWDBVNY    WEBVNY           IVF Item Struct
     C                     Z-ADDWDBWNY    WEBWNY           IVF Item Struct
     C                     Z-ADDWDBXNY    WEBXNY           IVF Item Struct
     C                     Z-ADDWDF5PR    WEF5PR           IVF Item Market
     C                     MOVELWDGWAA    WEGWAA           IVF Item G/L Su
     C                     MOVELWDGXAA    WEGXAA           IVF Item U/M -
     C                     MOVELWDWISX    WEWISX           IVF Inventory V
     C                     MOVELWDWJSX    WEWJSX           IVF Production
     C                     Z-ADDWDFSVL    WEFSVL           IVF Beg Inv Pri
     C                     Z-ADDWDFTVL    WEFTVL           IVF Sales Price
     C                     Z-ADDWDAKDX    WEAKDX           IVF Sales Price
     C                     Z-ADDWDFUVL    WEFUVL           IVF Market Pric
     C                     Z-ADDWDM8WG    WEM8WG           IVF Warehouse P
     C                     Z-ADDWDFVVL    WEFVVL           IVF Warehouse P
     C                     Z-ADDWDFWVL    WEFWVL           IVF Ovrrde Prod
     C                     MOVELWDRGNA    WERGNA           IVF Ovrrde Prod
     C                     Z-ADDWDFXVL    WEFXVL           IVF Curr Wk Pro
     C                     MOVELWDWKSX    WEWKSX           IVF Curr Wk Pro
     C                     Z-ADDWDFYVL    WEFYVL           IVF Ovrrde Inv
     C                     MOVELWDRFNA    WERFNA           IVF Ovrrde Inv
     C                     Z-ADDWDFZVL    WEFZVL           IVF Cur Wk Inv
     C                     MOVELWDWLSX    WEWLSX           IVF Cur Wk Inv
     C                     Z-ADDWDM9WG    WEM9WG           IVF Unused Weig
     C                     MOVELWDWPSX    WEWPSX           IVF Post Invent
     C                     Z-ADDWDQDDT    WEQDDT           IVF Unused Date
     C                     MOVELWDVSST    WEVSST           Record Status
     C                     Z-ADDWDMJDT    WEMJDT           Create Date
     C                     Z-ADDWDBETM    WEBETM           Create Time
     C                     MOVELWDCCVN    WECCVN           Create User
     C                     MOVELWDCDVN    WECDVN           Create Program
     C                     Z-ADDWDMKDT    WEMKDT           Change Date
     C                     Z-ADDWDBFTM    WEBFTM           Change Time
     C                     MOVELWDCEVN    WECEVN           Change User
     C                     MOVELWDCFVN    WECFVN           Change Program
      *
     C           KLCRSE    KLIST
     C                     KFLD           WEWQSX           IVF Valuation G
     C                     KFLD           WEAJDX           IVF Week Ending
     C                     KFLD           WEEKC7           IVF Item Code
      * Check for duplicate primary key
     C           KLCRSE    SETLL@BTCPNJ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3532' W0RTN   7
      * Send message 'Inventory Value File   EX'
     C                     MOVEL'USR3532' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@BTCPNJ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * Del Inventory Value   DO - Inventory Value File  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BTCPA8
     C                     MOVELWDWQSX    WFWQSX           IVF Valuation G
     C                     Z-ADDWDAJDX    WFAJDX           IVF Week Ending
     C                     Z-ADDWDEKC7    WFEKC7           IVF Item Code
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFWQSX           IVF Valuation G
     C                     KFLD           WFAJDX           IVF Week Ending
     C                     KFLD           WFEKC7           IVF Item Code
     C           KLDLSF    CHAIN@BTCPA8              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PPBTCPL0'MDACP
     C                     MOVEL'@BTCPA8' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BTCPA8                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field ISC Week Ending Date
     C                     Z-ADD*ZERO     WUAIDX  80
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIDX           ISC Week Ending
     C                     Z-ADD*ZERO     WAB2C3           ISC Warehouse C
     C                     Z-ADD*ZERO     WAEJC7           ISC Item Code
     C                     Z-ADD*ZERO     WAF3PR           ISC Item Market
     C                     Z-ADD*ZERO     WABSNY           ISC Item Struct
     C                     Z-ADD*ZERO     WABTNY           ISC Item Struct
     C                     Z-ADD*ZERO     WABUNY           ISC Item Struct
     C                     Z-ADD*ZERO     WAOEQT           ISC Beg Inv Fin
     C                     Z-ADD*ZERO     WAMQWG           ISC Beg Inv Fin
     C                     Z-ADD*ZERO     WAOFQT           ISC Beg Inv Adj
     C                     Z-ADD*ZERO     WAMRWG           ISC Beg Inv Adj
     C                     Z-ADD*ZERO     WAOGQT           ISC Beg Inv Qty
     C                     Z-ADD*ZERO     WAMXWG           ISC Beg Inv Lbs
     C                     Z-ADD*ZERO     WAOHQT           ISC Floor Produ
     C                     Z-ADD*ZERO     WAMSWG           ISC Floor Produ
     C                     Z-ADD*ZERO     WAOWQT           ISC Floor Prod
     C                     Z-ADD*ZERO     WANAWG           ISC Floor Prod
     C                     Z-ADD*ZERO     WAOIQT           ISC Sales Produ
     C                     Z-ADD*ZERO     WAMTWG           ISC Sales Produ
     C                     Z-ADD*ZERO     WAOJQT           ISC Inventory S
     C                     Z-ADD*ZERO     WAMUWG           ISC Inventory S
     C                     Z-ADD*ZERO     WAOKQT           ISC Ord Dtl Shi
     C                     Z-ADD*ZERO     WAMVWG           ISC Ord Dtl Shi
     C                     Z-ADD*ZERO     WAOLQT           ISC Shipment Fi
     C                     Z-ADD*ZERO     WAMWWG           ISC Shipment Fi
     C                     Z-ADD*ZERO     WAFQVL           ISC FOB Gross A
     C                     Z-ADD*ZERO     WAOMQT           ISC Inventory T
     C                     Z-ADD*ZERO     WAMYWG           ISC Inventory T
     C                     Z-ADD*ZERO     WAONQT           ISC Misc Invntr
     C                     Z-ADD*ZERO     WAMZWG           ISC Misc Invntr
     C                     Z-ADD*ZERO     WAOOQT           ISC Ending Inve
     C                     Z-ADD*ZERO     WAM0WG           ISC Ending Inve
     C                     Z-ADD*ZERO     WAP9DT           ISC End Inv Dat
     C                     Z-ADD*ZERO     WACTTM           ISC End Inv Tim
     C                     Z-ADD*ZERO     WAOPQT           ISC Sun Shp Inv
     C                     Z-ADD*ZERO     WAM1WG           ISC Sun Shp Inv
     C                     Z-ADD*ZERO     WAOQQT           ISC Unsh/Ship I
     C                     Z-ADD*ZERO     WAM2WG           ISC Unsh/Ship I
     C                     Z-ADD*ZERO     WAORQT           ISC End Inv Par
     C                     Z-ADD*ZERO     WAM3WG           ISC End Inv Par
     C                     Z-ADD*ZERO     WAOSQT           ISC End Inv Adj
     C                     Z-ADD*ZERO     WAM4WG           ISC End Inv Adj
     C                     Z-ADD*ZERO     WAP8DT           ISC Ending Inv
     C                     Z-ADD*ZERO     WACSTM           ISC Ending Inv
     C                     Z-ADD*ZERO     WAOTQT           ISC End Inv Fin
     C                     Z-ADD*ZERO     WAM5WG           ISC End Inv Fin
     C                     Z-ADD*ZERO     WAF4PR           ISC Warehouse P
     C                     Z-ADD*ZERO     WAOUQT           ISC Commission
     C                     Z-ADD*ZERO     WAM6WG           ISC Unused Lbs
     C                     Z-ADD*ZERO     WAOVQT           ISC TF Exempt N
     C                     Z-ADD*ZERO     WAM7WG           ISC TF Exempt L
     C                     Z-ADD*ZERO     WAQADT           ISC Unused Date
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAJDX           IVF Week Ending
     C                     Z-ADD*ZERO     WDEKC7           IVF Item Code
     C                     Z-ADD*ZERO     WDELC7           IVF WIP - FG It
     C                     Z-ADD*ZERO     WDBVNY           IVF Item Struct
     C                     Z-ADD*ZERO     WDBWNY           IVF Item Struct
     C                     Z-ADD*ZERO     WDBXNY           IVF Item Struct
     C                     Z-ADD*ZERO     WDF5PR           IVF Item Market
     C                     Z-ADD*ZERO     WDFSVL           IVF Beg Inv Pri
     C                     Z-ADD*ZERO     WDFTVL           IVF Sales Price
     C                     Z-ADD*ZERO     WDAKDX           IVF Sales Price
     C                     Z-ADD*ZERO     WDFUVL           IVF Market Pric
     C                     Z-ADD*ZERO     WDM8WG           IVF Warehouse P
     C                     Z-ADD*ZERO     WDFVVL           IVF Warehouse P
     C                     Z-ADD*ZERO     WDFWVL           IVF Ovrrde Prod
     C                     Z-ADD*ZERO     WDFXVL           IVF Curr Wk Pro
     C                     Z-ADD*ZERO     WDFYVL           IVF Ovrrde Inv
     C                     Z-ADD*ZERO     WDFZVL           IVF Cur Wk Inv
     C                     Z-ADD*ZERO     WDM9WG           IVF Unused Weig
     C                     Z-ADD*ZERO     WDQDDT           IVF Unused Date
     C                     Z-ADD*ZERO     WDMJDT           Create Date
     C                     Z-ADD*ZERO     WDBETM           Create Time
     C                     Z-ADD*ZERO     WDMKDT           Change Date
     C                     Z-ADD*ZERO     WDBFTM           Change Time
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SARVGN.
     C                     Z-ADD*ZERO     WL0001  80
      * Define local variables for subroutine SDRVGN.
     C                     Z-ADD*ZERO     WL0002  80
      * Define local work field Year Code
     C                     Z-ADD*ZERO     YL0001  40
      * Define local work field Month NBR USR
     C                     Z-ADD*ZERO     YL0002  20
      * Define local work field Day of Month USR
     C                     Z-ADD*ZERO     YL0003  20
      *================================================================
     CSR         ZZEXIT    ENDSR
