// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDXUXFR
// ?Date: 14.08.2025 Time: 03:33:32
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(FIX MTD/YTD Days Paid  RT) TYPE(RTVOBJ) FILE(ARBCREP)          AC1459439;
{
 //?USER: Process Data record

 // PAR.USR Process status = CND.yes
 PAR.USR_Process_status = 'Y';

 // PAR.MTD Days Paid = CON.*ZERO
 PAR.MTD_Days_Paid = *ZERO;

 // PAR.YTD Days Paid = CON.*ZERO
 PAR.YTD_Days_Paid = *ZERO;

 // PAR.MTD Invoices Paid = CON.*ZERO
 PAR.MTD_Invoices_Paid = *ZERO;

 // PAR.YTD Invoices Paid = CON.*ZERO
 PAR.YTD_Invoices_Paid = *ZERO;

 //?run for April 1996 through March 1997
 // PAR.Current Month = JOB.*Job month
 PAR.Current_Month = JOB.*Job_month;

 // PAR.*Job year = JOB.*Job year - CON.1
 PAR.*Job_year = JOB.*Job_year - 1;

 CASE;

 // IF PAR.*Job year is Negative
 IF PAR.*Job_year < 0;

 // PAR.*Job year = CON.99
 PAR.*Job_year = 99;

 ENDIF;

 //?Process YTD for last 12 months
 // DOW PAR.USR Process status is yes
 DOW PAR.USR_Process_status = 'Y';

 //?process next month; 1st time, this will set month to Next month, last year
 // PAR.Current Month = PAR.Current Month + CON.1
 PAR.Current_Month = PAR.Current_Month + 1;

 //?Set up current year
 CASE;

 // IF PAR.Current Month is January
 IF PAR.Current_Month = 1;

 // PAR.*Job year = PAR.*Job year + CON.1
 PAR.*Job_year = PAR.*Job_year + 1;

 ENDIF;

 // 1st day of current month
 PAR.Paid_in_Full_Date = PAR.*Job_year * 10000;

 CASE;

 // IF PAR.Paid in Full Date is < 410101
 IF PAR.Paid_in_Full_Date < 410101;

 // PAR.Paid in Full Date = PAR.Paid in Full Date + CON.1000000
 PAR.Paid_in_Full_Date = PAR.Paid_in_Full_Date + 1000000;

 ENDIF;

 // 1st day of current month
 PAR.Paid_in_Full_Date = ( PAR.Paid_in_Full_Date + ( PAR.Current_Month * 100 ) ) + 01;

 EXECUTE FUNCTION(RTV Days Paid MTD      RT) TYPE(RTVOBJ) FILE(ARBDCPP)          AC1357656;
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Paid_in_Full_Date);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(PAR.MTD_Days_Paid);
 PARAMETER(PAR.Current_Month);
 PARAMETER(PAR.*Job_year);
 PARAMETER(PAR.MTD_Invoices_Paid);
 {
  //?USER: Initialize routine

  // PAR.Days to Pay = CND.equal to zero
  PAR.Days_to_Pay = *ZERO;

  // PAR.MTD Invoices Paid = CND.Equal zero
  PAR.MTD_Invoices_Paid = *ZERO;

  //?USER: Process Data record

  CASE;

  // IF DB1.Remaining Balance Due is equal to zero
  IF DB1.Remaining_Balance_Due = *ZERO;

  // AND DB1.Invoice Suffix is Invoice or Debit Memo
  AND DB1.Invoice_Suffix = 'DM'/'IN';

  // PAR.USR Job Year = DB1.Paid in Full Date *YEAR
  PAR.USR_Job_Year = DATEDTLS(DB1.Paid_in_Full_Date 'YR' 1111111 'NONE' 'N' 1);

  // PAR.USR Job Month = DB1.Paid in Full Date *MONTH
  PAR.USR_Job_Month = DATEDTLS(DB1.Paid_in_Full_Date 'MO' 1111111 'NONE' 'N' 1);

  CASE;

  // IF PAR.USR Job Year EQ PAR.*Job year
  IF PAR.USR_Job_Year = PAR.*Job_year;

  // AND PAR.USR Job Month EQ PAR.USR Current Month
  AND PAR.USR_Job_Month = PAR.USR_Current_Month;

  // PAR.Days to Pay = DB1.Days to Pay + PAR.Days to Pay
  PAR.Days_to_Pay = DB1.Days_to_Pay + PAR.Days_to_Pay;

  // PAR.MTD Invoices Paid = PAR.MTD Invoices Paid + CON.1
  PAR.MTD_Invoices_Paid = PAR.MTD_Invoices_Paid + 1;

  // IF *OTHERWISE
  IF *OTHERWISE;

  QUIT;

  ENDIF;

  ENDIF;

 }

 // PAR.YTD Days Paid = PAR.YTD Days Paid + PAR.MTD Days Paid
 PAR.YTD_Days_Paid = PAR.YTD_Days_Paid + PAR.MTD_Days_Paid;

 // PAR.YTD Invoices Paid = PAR.YTD Invoices Paid + PAR.MTD Invoices Paid
 PAR.YTD_Invoices_Paid = PAR.YTD_Invoices_Paid + PAR.MTD_Invoices_Paid;

 //?End processing when have processed current month
 CASE;

 // IF PAR.*Job year EQ JOB.*Job year
 IF PAR.*Job_year = JOB.*Job_year;

 // AND PAR.Current Month EQ JOB.*Job month
 AND PAR.Current_Month = JOB.*Job_month;

 // PAR.USR Process status = CND.no
 PAR.USR_Process_status = 'N';

 ENDIF;

 ENDDO;

 EXECUTE FUNCTION(FIX MTD/YTD Days Paid  CH) TYPE(CHGOBJ) FILE(ARBCREP)          AC1459441;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(PAR.MTD_Invoices_Paid);
 PARAMETER(PAR.YTD_Invoices_Paid);
 PARAMETER(PAR.MTD_Days_Paid);
 PARAMETER(PAR.YTD_Days_Paid);
 {
  //?USER: Processing after Data read

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


