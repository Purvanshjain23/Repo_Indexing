/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CL PROGRAM TO BE RUN AT NIGHT TO BUILD THE 1ST LEVEL  */
/*             CUT FOR PLANT IN THE PARM. SPLIT OUT SO ALL 3 CAN        */
/*             BE RUNNING AT THE SAME TIME. THEN THE JOB IS SUBMITTED TO */
/*             ALLOCATE THE ORDERS - INVBUILDPS.                    */
/*             THESE RUNS BEFORE INVNIGHTRN, INVNIGHTRS, INVNIGHTSP  */
/*                                                                  */
/*  SYSTEM     - PPS                                                 */
/*  DATE       - 09/13/17                                            */
/*  PROGRAMMER - ROSE CENTONZE                                       */
/*                                                                  */
/*------------------------------------------------------------------*/
/* RMC 5/12/09 MONMSG AND CHGJOB LOGGING TO CRT JOB LOG FOR PROCESSES UP */
/*             TO ALLOCATING THE ORDERS. WE WANT THE JOB TO FALL OUT IF */
/*             THERE'S A CPF MSG IN THE 1ST LEVEL CUT OR HOG POP BUILD   */
/*             SO THE ORDERS WONT BE SCHEDULED WITH -0- QTY AND PUT ON HOLD */
/*                                                                   */
/* JBB 2/15/17 Adding company 440 (Iowa) processing to this program. */
/*     E9064   Continuing to hardcode the company values.  Additions */
/*             to this program is to call each program that is       */
/*             company specific for new company 440. Also, instead   */
/*             of going to tag ROLLDATE is program PXXXXFR fails,    */
/*             go to tag END so dates are not rolled.                */
/* RMC 9/07/17 CHG CHGCURLIB TO ADDLIBLE. IT ISNT RUNNING FORM 440/960   */
/*                                                                      */
/*------------------------------------------------------------------*/
 INVBLD1ST:  PGM        PARM(&COMP)
             DCL        &COMP       *DEC     (3 0)
             DCL        VAR(&TDATE) TYPE(*DEC) LEN(7 0) +
                          VALUE(0000000) /* PROD DATE RGT */
             DCL        &JOBDATE    *CHAR   6
             DCL        &JOBDTE     *CHAR   7
             DCL        &HOLD       *CHAR    4
             DCL        &SAVE       *CHAR    4
             DCL        &COPY       *DEC     2 0
             DCL        &OUTQ5      *CHAR    10
             DCL        &HOLD5      *CHAR    4
             DCL        &HOLDNO     *CHAR    4
             DCL        &SAVE5      *CHAR    4
             DCL        &COPY5      *DEC     2 0
             DCL        &LIBNNN     *CHAR    10
             DCL        &COMMAND    *CHAR    512
             CHGVAR     VAR(&HOLD) VALUE(*NO)
             CHGVAR     VAR(&SAVE) VALUE(*YES)
             CHGVAR     VAR(&COPY) VALUE(1)
/*------------------------------------------------------------------*/
/* INIT TO DATE TO A DATE                                                 */
/*------------------------------------------------------------------*/
             RTVJOBA    DATE(&JOBDATE)
             CVTDAT     DATE(&JOBDATE) TOVAR(&JOBDTE) FROMFMT(*MDY) +
                          TOFMT(*CYMD) TOSEP(*NONE)
             CHGVAR     VAR(&TDATE) VALUE(&JOBDTE)
/*------------------------------------------------------------------*/
/* BUILD PRODUCTION SCHEDULE                                               */
/*------------------------------------------------------------------*/

             SNDMSG     MSG('Build 1st Level cut has started for the +
                          nightly run program') TOUSR(SEABOARD)

/* GET OUTQ -- WHICH IS CURRENTLY PRKPRT05     */
 GETOUTQ:    CALL       PGM(POMTXFR) PARM(' ' X'360F' 'INVNIGHTQ' &OUTQ5)

/* DEFAULT HOLDNO TO OVERRIDE SELECT OUTQ'S FOR PRKPRT05    T070     */
             CHGVAR     VAR(&HOLDNO) VALUE(*NO)
             CHGVAR     VAR(&HOLD5) VALUE(*YES)
             CHGVAR     VAR(&SAVE5) VALUE(*YES)
             CHGVAR     VAR(&COPY5) VALUE(1)

/* RETURN TO THE ORIGINAL CALL WITH NO HOLD(*YES)            T070    */
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDZ9PFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDAEPFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PKY2PFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PMFPPFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/*-------------------------------------------------------------------*/
/* CALCULATE BONING RATE   */
/*-------------------------------------------------------------------*/
/*    GOTO       CMDLBL(SKIPBONE)                                 */

             CALL       PGM(POSTUPR) PARM(&COMP  &OUTQ5)
             MONMSG     MSGID(CPF0000)
SKIPBONE:
/*-------------------------------------------------------------------*/
/* BUILD 1ST LEVEL CUT FOR PLANT IN PARM                           */
/*   PMFZXFR CALLS PMFVXFR WHICH CALLS                               */
/*                    PDAEPFR AND PDZ9PFR REPORTS.          */
/*-------------------------------------------------------------------*/
/* GET HPE DATA LIBRARY PER PLANT IN PARM      */
 GETLIB3:   CALL       PGM(POMTXFR) PARM(' ' &COMP 'HPELIB   ' &LIBNNN)
/*-------------------------------------------------------------------*/
/*-------------------------------------------------------------------*/
/*                  HOG POP AND 1ST LEVEL CUT                         */
/*-------------------------------------------------------------------*/
             CHGCURLIB  CURLIB(&LIBNNN)
             CALL       PGM(PMFZXFR) PARM('' &COMP  &TDATE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGJOB     LOG(4 00 *SECLVL)
             SNDPGRMSG  TOPGR(PRKSCHERR) MSG('Build 1ST Level Cut +
                          has ended abnormally from the nightly run')
             GOTO END

             ENDDO
/*-------------------------------------------------------------------*/
/*   RLS SPOOL FILE 1ST FEW PAGES FOR DAMON    ---------------------*/
/*-------------------------------------------------------------------*/
             CHGSPLFA   FILE(PDAEPFR$) PAGERANGE(1 4) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDAEPFR$)
             MONMSG     MSGID(CPF0000)

             CHGSPLFA   FILE(PDZ9PFR$) PAGERANGE(1 7) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDZ9PFR$)
             MONMSG     MSGID(CPF0000)
  END:                    ENDPGM
