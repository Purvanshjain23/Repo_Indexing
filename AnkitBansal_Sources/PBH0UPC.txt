/*********************************************************************/
/* PROGRAM    : PMUNUPC                                             */
/* TITLE      : EXECUTE THE SHPNOTINV SQL AND EMAIL TO RECIPS          */
/* DATE       : 03/13/2013                                           */
/* Description: EXECUTE THE SQL SHIPNOTINV AND EMAIL TO RECIP IN THE   */
/*                EMAIL PARM                                       */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &EADDRESS   EMAIL ADDRESS TO SEND TO                     */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*********************************************************************/
 PBHZUPC:    PGM        PARM(&RETURN &FDATED         &COMPD &EADDR)
/*-------------------------------------------------------------------*/
/* Declare Variables                                                 */
/*-------------------------------------------------------------------*/
             DCL        VAR(&RETURN)   TYPE(*CHAR) LEN(7)

             DCL        VAR(&COMPD) TYPE(*DEC)
             DCL        VAR(&FDATED) TYPE(*DEC)
             DCL        VAR(&EADDR) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMP) TYPE(*CHAR) LEN(3)
             DCL        VAR(&COMP3) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&FDAT7) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&FDATE) TYPE(*CHAR) LEN(7)
   /*        DCL        VAR(&TDATED) TYPE(*DEC)                 */
   /*        DCL        VAR(&TDAT7) TYPE(*DEC) LEN(7 0)          */
   /*        DCL        VAR(&TDATE) TYPE(*CHAR) LEN(7)          */

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

/*-------------------------------------------------------------------*/
             CHGVAR     VAR(&FDAT7) VALUE(&FDATED)
             CHGVAR     VAR(&FDATE) VALUE(&FDAT7)
         /*  CHGVAR     VAR(&TDAT7) VALUE(&TDATED)              */
          /* CHGVAR     VAR(&TDATE) VALUE(&TDAT7)               */
             CHGVAR     VAR(&COMP3) VALUE(&COMPD)
             CHGVAR     VAR(&COMP) VALUE(&COMP3)
/*-------------------------------------------------------------------*/
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ADDLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF2103 CPF9999)

             EXECUTE    VIEW(SHPNOTINV) PCFMT(*XLS) +
                          RECIPIENT(&EADDR) EMLMSG('Orders shipped +
                          not Invoiced') SETVAR((&FDATE &FDATE) +
                          (&COMP &COMP)) JTYPE(*PARTOUT)
             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ENDPGM))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     RMVLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF0000)

             ENDPGM
