// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBJ0XFR
// ?Date: 14.08.2025 Time: 03:48:16
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?E3796 JJH 03/02/15 - Requested Ship Date for Production Schedule
//?- This function is used to calulate the 1Day Work Ahead and
//?  and 2Day Work Ahead fields on the Production Schedule reports.
//?- Changed Access Path from: Co/Item/Whse/SchdShpDt    OPBGWKLT
//?  To Access Path:           Co/Item/Whse/ReqShpDt     OPBGWKN8.
//?- Replace Parameter: Scheduled Ship Date           I     POS
//?  With Parameter:    Requested Ship Date           I     POS
//?- Changed all logic using Scheduled Ship Date to use Requested
//?  Ship Date in  Rtv Day0,Day1...Etc   RT.
ENDDO;

EXECUTE FUNCTION(Rtv Day0,Day1...Etc   RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC2073823;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Requested_Ship_Date);
PARAMETER(PAR.Date_0_RGF);
PARAMETER(PAR.Date_1_RGF);
PARAMETER(PAR.Date_2_RGF);
PARAMETER(PAR.Date_3_RGF);
PARAMETER(PAR.Date_3_RGT);
PARAMETER(PAR.PSP_Day_0);
PARAMETER(PAR.PSP_Day_1);
PARAMETER(PAR.PSP_Day_2);
PARAMETER(PAR.PSP_Week_Ending_Summary);
{
 //?USER: Initialize routine

 //?Modifications and Comments
 DO;

 //?E3796 JJH 03/02/15 - Requested Ship Date for Production Schedule
 //?- This function is used to calulate the 1Day Work Ahead and
 //?  and 2Day Work Ahead fields on the Production Schedule reports.
 //?- Changed Access Path from: Co/Item/Whse/SchdShpDt    OPBGWKLT
 //?  To Access Path:           Co/Item/Whse/ReqShpDt     OPBGWKN8.
 //?- Replace Parameter: Scheduled Ship Date           I     POS
 //?  With Parameter:    Requested Ship Date           I     POS
 //?- Changed all logic using Scheduled Ship Date to use Requested
 //?  Ship Date.
 ENDDO;

 // PAR.PSP Day 0 = CON.*ZERO
 PAR.PSP_Day_0 = *ZERO;

 // PAR.PSP Day 1 = CON.*ZERO
 PAR.PSP_Day_1 = *ZERO;

 // PAR.PSP Day 2 = CON.*ZERO
 PAR.PSP_Day_2 = *ZERO;

 // PAR.PSP Week Ending Summary = CON.*ZERO
 PAR.PSP_Week_Ending_Summary = *ZERO;

 //?USER: Processing if Data record not found

 QUIT;

 //?USER: Process Data record

 // PGM.*Record selected = CND.*YES
 PGM.*Record_selected = 'Y';

 //?E3796 JJH 03/02/15 - Replace Scheduled Ship Date with Requested
 //? Ship Date.
 //?Selection only no c/x/r and date ranage
 CASE;

 // IF DB1.Requested Ship Date GT PAR.Date 3 RGT
 IF DB1.Requested_Ship_Date > PAR.Date_3_RGT;

 //?This should end the process due to date is not in the range
 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 QUIT;

 //?Selection only no c/x/r and date ranage
 // IF DB1.Requested Ship Date LT PAR.Date 0 RGF
 IF DB1.Requested_Ship_Date < PAR.Date_0_RGF;

 //?this should not happend since we are performing a position
 //?do NOT select this record but continue with next record
 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 //?Selection only no c/x/r and date ranage
 // IF DB1.Detail Line Status is Cancelled
 IF DB1.Detail_Line_Status = 'X';

 // OR DB1.Detail Line Status is Complete
 OR DB1.Detail_Line_Status = 'C';

 // OR DB1.Detail Line Status is Confirmed
 OR DB1.Detail_Line_Status = 'R';

 //?do NOT select this record but continue with next record
 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?if *YES, chk the order header and only want OR or TF else *no
 CASE;

 // IF PGM.*Record selected is *YES
 IF PGM.*Record_selected = 'Y';

 //?Check if the order type from the Order Header
 EXECUTE FUNCTION(RTV Order Type         RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1564834;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Order_Type_Sales);
 {
  //?USER: Process Data record

  // PAR.Order Type - Sales = DB1.Order Type - Sales
  PAR.Order_Type_Sales = DB1.Order_Type_Sales;

  QUIT;

 }

 CASE;

 // IF LCL.Order Type - Sales is Regular Order
 IF LCL.Order_Type_Sales = 'OR';

 // OR LCL.Order Type - Sales is Transfer Order
 OR LCL.Order_Type_Sales = 'TR';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 ENDIF;

 //?E3796 JJH 03/02/15 - Replace Scheduled Ship Date with Requested
 //? Ship Date.
 //?if *YES process record and get the order detail schedule records
 CASE;

 // IF PGM.*Record selected is *YES
 IF PGM.*Record_selected = 'Y';

 // LCL.Qty Ordered USR = CON.*ZERO
 LCL.Qty_Ordered_USR = *ZERO;

 EXECUTE FUNCTION(Rtv InvAlloc  Co/OrdKeyRT) TYPE(RTVOBJ) FILE(PDKNCPP)          AC2073824;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Quantity_Inv_Alloc_Usr);
 {
  //?USER: Initialize routine

  // PAR.Quantity Inv Alloc Usr = CON.*ZERO
  PAR.Quantity_Inv_Alloc_Usr = *ZERO;

  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Quantity Inv Alloc Usr = PAR.Quantity Inv Alloc Usr + DB1.OD Quantity Inv Sched
  PAR.Quantity_Inv_Alloc_Usr = PAR.Quantity_Inv_Alloc_Usr + DB1.OD_Quantity_Inv_Sched;

 }

 // LCL.Qty Ordered USR = DB1.Quantity Ordered - LCL.Quantity Inv Alloc Usr
 LCL.Qty_Ordered_USR = DB1.Quantity_Ordered - LCL.Quantity_Inv_Alloc_Usr;

 CASE;

 // IF DB1.Requested Ship Date LT PAR.Date 1 RGF
 IF DB1.Requested_Ship_Date < PAR.Date_1_RGF;

 //?Get pd order detail schedule information
 //?add into Day 0
 // PAR.PSP Day 0 = PAR.PSP Day 0 + LCL.Qty Ordered USR
 PAR.PSP_Day_0 = PAR.PSP_Day_0 + LCL.Qty_Ordered_USR;

 // IF DB1.Requested Ship Date LT PAR.Date 2 RGF
 IF DB1.Requested_Ship_Date < PAR.Date_2_RGF;

 //?Get pd order detail schedule information
 //?add into Day 1
 // PAR.PSP Day 1 = PAR.PSP Day 1 + LCL.Qty Ordered USR
 PAR.PSP_Day_1 = PAR.PSP_Day_1 + LCL.Qty_Ordered_USR;

 // IF DB1.Requested Ship Date LT PAR.Date 3 RGF
 IF DB1.Requested_Ship_Date < PAR.Date_3_RGF;

 //?Get pd order detail schedule information
 //?add into Day 2
 // PAR.PSP Day 2 = PAR.PSP Day 2 + LCL.Qty Ordered USR
 PAR.PSP_Day_2 = PAR.PSP_Day_2 + LCL.Qty_Ordered_USR;

 // IF DB1.Requested Ship Date LE PAR.Date 3 RGT
 IF DB1.Requested_Ship_Date <= PAR.Date_3_RGT;

 //?Get pd order detail schedule information
 //?add into week summary
 // PAR.PSP Week Ending Summary = PAR.PSP Week Ending Summary + LCL.Qty Ordered USR
 PAR.PSP_Week_Ending_Summary = PAR.PSP_Week_Ending_Summary + LCL.Qty_Ordered_USR;

 ENDIF;

 ENDIF;

}


