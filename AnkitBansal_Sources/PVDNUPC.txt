/*********************************************************************/
/*  PROGRAM NUMBER:  PVDNUPC (AFTER PPU1UPC)                         */
/*  PROGRAM NAME:    SEND PFS DOWNLOAD FILE  (MAN HDR/DTL)           */
/*  PROGRAMMER:      DANNY NGUYEN                                    */
/*  PROJECT:         WI616 - CARLISLE PALLET ID SCAN INTO INVENTORY  */
/*  CREATE DATE:     03/27/24                                        */
/*                                                                   */
/*  FUNCTION:        THIS CLP CREATES A FILE IN QTEMP FOR SENDING    */
/*                   TO THE PLANT FLOOR SYSTEM SERVER                */
/*                                                                   */
/*                 ! !    =============    ! !                       */
/*                 ! !    W A R N I N G    ! !                       */
/*                 ! !    =============    ! !                       */
/*                                                                   */
/*  MUST NOT RUN AT THE SAME TIME AS THE OTHER PFSDWNXXX JOBS        */
/*  IF IT DID - DUPLICATE RECORDS WOULD BE CREATED                   */
/*  =========================================================        */
/*  THE FILE LIBRARY IS PASSED AS A PARM. IT IS USED TO              */
/*  CREATE FILES IN QTEMP.                                           */
/*  =========================================================        */
/*                                                                   */
/*********************************************************************/
/*                              FILE    UPDIDX   PGM     UPDDELPGM   */
/*                              ------- -------- ------- ---------   */
/* PFS MANIFEST HEADER          PPBRCPP          PVCHXFR PVCIXFR     */
/* PFS MANIFEST DETAIL          PPBNCPP          PVCHXFR PVCIXFR     */
/*                                                                   */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  PROJ      CHANGE DESCRIPTION                         */
/* -------- --- --------- ------------------------------------------ */
/* 3/27/24  DN  WI616     ALLOW TO CREATE THE PFS MANIFEST HEADER    */
/*                        (PPBRCPP*) & PFS MANIFEST DETAIL (PPBNCPP*)*/
/*                        IN THE SUFFIX TABLES IN ORDER FOR CARLISLE */
/*                        TO PICKUP & PROCESS ON THEIR END.          */
/*                                                                   */
/*********************************************************************/

             PGM        PARM(&COA)

             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&COA) TYPE(*CHAR) LEN(3)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DWNFILE2) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&UPDDELPGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GRPPRFL)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ENV) TYPE(*CHAR) LEN(6) VALUE(' ')


             CHGJOB     LOG(4 0 *SECLVL) LOGCLPGM(*YES)

/*********************************************************************/
/*  GET DATA LIBRARY - PROD OR TEST ENV?                             */
/*********************************************************************/
             CALL       PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

             CHGVAR     VAR(&LIB) VALUE(&DATA)

             IF         COND(&LIB *NE 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&ENV) VALUE('- TEST')
             ENDDO

/*********************************************************************/
/* CHECK IF COMPANY NUMBER EXIST                                     */
/*********************************************************************/
             IF         COND(&COA *EQ '   ') THEN(DO)
             GOTO       CMDLBL(NOCMP)
             ENDDO

/*********************************************************************/
/* PFS MANIFEST HEADER (PPBRCPP) & PFS MANIFEST DETAIL (PPBNCPP)     */
/* PROCESSING IN QTEMP.                                              */
/*********************************************************************/
             CHGVAR     VAR(&FILE) VALUE(PPBRCPP)
             CHGVAR     VAR(&PGM) VALUE(PVCHXFR)
             CHGVAR     VAR(&UPDDELPGM) VALUE(PVCIXFR)

             CALL       PGM(PVCLUPC) PARM((&COA) (&LIB) (&PGM) +
                          (&UPDDELPGM) (&ENV))
             MONMSG     MSGID(CPF0000) EXEC(SNDPGRMSG +
                          TOPGR(PRKPFSDWN) MSG('ERROR:  Call to +
                          create QTEMP file for' *BCAT &FILE *BCAT +
                          'from Download PFS Manifest Header +
                          Program.' *BCAT &ENV))

             GOTO       CMDLBL(ENDPGM)


 /************************* ERROR PROCESSING *************************/
 NOCMP:
             SNDPGRMSG  TOPGR(PRKPFSDWN) MSG('ERROR:  Company Number +
                          is Blanks for Download PFS Manifest +
                          Hdr/Dtl Process (PVEKXFR).' *BCAT &ENV)

 ENDPGM:
             ENDPGM
