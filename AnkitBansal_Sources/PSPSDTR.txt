// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PSPSDTR
// ?Date: 14.08.2025 Time: 03:47:10
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?PIO 11/26/24 We are recompiling the program as new field is added in WHS
//?FP1271 01/25/08 RMC - chgd packaging qty from 5.0 to 7.3
//?FP1271 01/28/08 RMC - Update FG Item Misc Tare when Qty changes,
//?       if Include in Misc Calc is Yes on the pkg type,
//?       dsp pkg tare wt
//?E01630 - new display without updates
EXECUTE FUNCTION(VAL Set Inter. Access  IF) TYPE(EXCINTFUN)                     AC1144606;
PARAMETER('C/S');
PARAMETER(NLL.Company_Number);
PARAMETER(NLL.Warehouse_Code);
PARAMETER(NLL.Allow_Multi_Company);
PARAMETER(NLL.Default_Printer);
PARAMETER(NLL.Salesperson_Code);

// PAR.USR Display field = CND.no
PAR.USR_Display_field = 'N';

EXECUTE FUNCTION(RTV Box Item code      RT) TYPE(RTVOBJ) FILE(PDIOREP)          AC1402262;
PARAMETER(CTL.Company_Number);
PARAMETER(CTL.Item_Code);
PARAMETER(PAR.Item_Code_USR);

//?CALC: Subfile record function fields

EXECUTE FUNCTION(RTV Packaging Itm All RT) TYPE(RTVOBJ) FILE(POARREP)           AC1608356;
PARAMETER(RCD.Company_Number);
PARAMETER(RCD.Packaging_Item_Code);
PARAMETER(LCL.Pckg_Item_Description);
PARAMETER(LCL.Pckg_List_Sequence);
PARAMETER(RCD.Pckg_Item_Type);
PARAMETER(RCD.Item_Code_USR);
PARAMETER(LCL.Pckg_Unit_Cost);
PARAMETER(LCL.Pckg_Tare_Weight);
PARAMETER(RCD.Pckg_Reporting_Group);
PARAMETER(RCD.Pckg_Group_Category);
PARAMETER(LCL.Pckg_Modified_Weight);
PARAMETER(LCL.Pckg_Unused_Sts_2);

// RCD.Misc Tare Weight = LCL.Pckg Tare Weight
RCD.Misc_Tare_Weight = LCL.Pckg_Tare_Weight;

//?Add up number of boxes
CASE;

// IF RCD.Pckg Item Type is Box
IF RCD.Pckg_Item_Type = 'BX';

// OR RCD.Pckg Item Type is Combo box
OR RCD.Pckg_Item_Type = 'CB';

// WRK.USR number = CON.1
WRK.USR_number = 1;

CTL.Total_Box_Comp_Items_SUM = SUM(WRK.USR_number);

ENDIF;

//?USER: Process command keys

// PGM.*Continue transaction = CND.*NO
PGM.*Continue_transaction = 'N';

QUIT;

