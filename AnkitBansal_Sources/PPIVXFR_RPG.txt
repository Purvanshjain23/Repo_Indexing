     H/TITLE Del Verification      XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/23/10  Time  : 09:12:42
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMDDREL2IF  E           K        DISK
      * RSQ : Sales Market              Broker/Market
      *
     FOMHOREL6IF  E           K        DISK
      * RSQ : Customer Accrual          Broker/Ship To
      *
     FOMHRCPL8IF  E           K        DISK
      * RSQ : Shipping Dtl Accrual      Brkr/ShipTo/ShpDt/Ordr
      *
     I@DDREB9
      * Sales Market              Broker/Market
      * Renamed input format fields
     I              DDISAA                          WAISAA
     I              DDR3NA                          WAR3NA
     I              DDRSTY                          WARSTY
     I              DDHHAA                          WAHHAA
     I              DDBCCD                          WABCCD
     I              DDITAA                          WAITAA
     I              DDKBAA                          WAKBAA
     I              DDVSST                          WAVSST
     I              DDMJDT                          WAMJDT
     I              DDBETM                          WABETM
     I              DDCCVN                          WACCVN
     I              DDCDVN                          WACDVN
     I              DDMKDT                          WAMKDT
     I              DDBFTM                          WABFTM
     I              DDCEVN                          WACEVN
     I              DDCFVN                          WACFVN
      *
     I@HOREKB
      * Customer Accrual          Broker/Ship To
      * Renamed input format fields
     I              HOBKC7                          WBBKC7
     I              HOOJCD                          WBOJCD
     I              HOGUNY                          WBGUNY
     I              HOBFDT                          WBBFDT
     I              HOA2DT                          WBA2DT
     I              HOBKPR                          WBBKPR
     I              HOTTST                          WBTTST
     I              HOSHSX                          WBSHSX
     I              HOQDSX                          WBQDSX
     I              HOPJDT                          WBPJDT
     I              HOPKDT                          WBPKDT
     I              HOECVL                          WBECVL
     I              HOQESX                          WBQESX
     I              HOQFSX                          WBQFSX
     I              HOHHAA                          WBHHAA
     I              HOHQVL                          WBHQVL
     I              HOQGSX                          WBQGSX
     I              HOQHSX                          WBQHSX
     I              HOQISX                          WBQISX
     I              HOQJSX                          WBQJSX
     I              HOUVST                          WBUVST
     I              HOUWST                          WBUWST
     I              HOUXST                          WBUXST
     I              HOAATM                          WBAATM
     I              HOAYNA                          WBAYNA
     I              HOA0NA                          WBA0NA
     I              HOAXDT                          WBAXDT
      *
     I@HRCPK6
      * Shipping Dtl Accrual      Brkr/ShipTo/ShpDt/Ordr
      * Renamed input format fields
     I              HRAIC3                          WCAIC3
     I              HRC4NB                          WCC4NB
     I              HRDPNB                          WCDPNB
     I              HRUENB                          WCUENB
     I              HRDXNB                          WCDXNB
     I              HRBKPR                          WCBKPR
     I              HRC5PC                          WCC5PC
     I              HRAYVA                          WCAYVA
     I              HREDVL                          WCEDVL
     I              HRHGCD                          WCHGCD
     I              HRBKC7                          WCBKC7
     I              HRDUC7                          WCDUC7
     I              HRHHAA                          WCHHAA
     I              HRPODT                          WCPODT
     I              HRBYWG                          WCBYWG
     I              HRBVST                          WCBVST
     I              HRP7SX                          WCP7SX
     I              HROKCD                          WCOKCD
     I              HRP8SX                          WCP8SX
     I              HRP9SX                          WCP9SX
     I              HRQASX                          WCQASX
     I              HRQBSX                          WCQBSX
     I              HRPPDT                          WCPPDT
     I              HRPQDT                          WCPQDT
     I              HREEVL                          WCEEVL
     I              HREFVL                          WCEFVL
     I              HRFITX                          WCFITX
     I              HRFJTX                          WCFJTX
     I              HRQ8DT                          WCQ8DT
     I              HRFKTX                          WCFKTX
     I              HRH0NY                          WCH0NY
     I              HRKQT1                          WCKQT1
     I              HRKTT1                          WCKTT1
     I              HRHIAA                          WCHIAA
     I              HRHLAA                          WCHLAA
     I              HROJCD                          WCOJCD
     I              HRAVNB                          WCAVNB
     I              HRDSCD                          WCDSCD
     I              HRUVST                          WCUVST
     I              HRUWST                          WCUWST
     I              HRUXST                          WCUXST
     I              HRAATM                          WCAATM
     I              HRAYNA                          WCAYNA
     I              HRA0NA                          WCA0NA
     I              HRAXDT                          WCAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Broker
      * I :  Broker Code
     I                                        1   6 P1HHAA
     IP2PARM      DS
      * B :  Record Status
     I                                        1   1 P2VSST
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HHAA    PARM           WP0001  6        Broker Code
     C           P2VSST    PARM P2VSST    WP0002  1        Record Status
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Del Verification      XF
     C                     MOVEL'N'       YL0001           Broker Records
     C                     MOVEL*BLANK    YL0002           Record Found Sl
      * Sale Market file review for records.
      * Vry Broker            rt - Sales Market  * 
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       YL0001           Broker Records
     C                     END                             *FI
      * Customer Accrual - if active rcds exist, broker must stay Active
      * Val Accr for Broker   RT - Customer Accrual  * 
     C                     EXSR SBRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       YL0001           Broker Records
     C                     END                             *FI
      * *********
      * Val Shipping dtl Accrual - if broker fouund it can go inactive
      * CASE: LCL.Broker Records Found Usr is no
     C           YL0001    IFEQ 'N'                        *IF
      * Val Broker Exists     RT - Shipping Dtl Accrual  * 
     C                     EXSR SCRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       YL0001           Broker Records
     C                     END                             *FI
     C                     END                             *FI
      * *********
      * Set record status based on findings
      * CASE: LCL.Broker Records Found Usr is yes
     C           YL0001    IFEQ 'Y'                        *IF
      * CASE: LCL.Record Found SlsMrk  Usr is Record Found
     C           YL0002    IFEQ 'Y'                        *IF
     C                     MOVEL'A'       P2VSST           Record Status
     C                     ELSE
      * CASE: LCL.Rec Inact/Del Cust Usr is no
     C           YL0003    IFEQ 'N'                        *IF
     C                     MOVEL'A'       P2VSST           Record Status
     C                     ELSE
      * CASE: LCL.Rec Inact/Del ShHs Usr is no
     C           YL0004    IFEQ 'N'                        *IF
     C                     MOVEL'I'       P2VSST           Record Status
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'I'       P2VSST           Record Status
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: LCL.Broker Records Found Usr is no
     C           YL0001    IFEQ 'N'                        *IF
      * leave the records status
      * what it was coming in. could be "D" or "I"
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Vry Broker            rt - Sales Market  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHHAA    WQSA01           Broker Code
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Broker Code
      * Setup key
     C                     MOVELP1HHAA    WQSA01           Broker Code
      * Establish starting position
     C           KRSSA     SETLL@DDREB9                    *
     C           KRSSA     READE@DDREB9                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3863' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       YL0002           Record Found Sl
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     MOVEL'Y'       YL0002           Record Found Sl
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@DDREB9                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Val Accr for Broker   RT - Customer Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHHAA    WQSB01           Broker Code
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Broker Code
      * Setup key
     C                     MOVELP1HHAA    WQSB01           Broker Code
      * Establish starting position
     C           KRSSB     SETLL@HOREKB                    *
     C           KRSSB     READE@HOREKB                  90*
      * Data record not found
     C   90                MOVEL'USR1520' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * CASE: JOB.*Job date LE DB1.Period Ending Date
     C           ##JDT     IFLE WBA2DT                     *IF
     C                     MOVEL'N'       YL0003           Rec Inact/Del C
     C                     GOTO SBEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       YL0003           Rec Inact/Del C
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSB     READE@HOREKB                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Val Broker Exists     RT - Shipping Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHHAA    WQSC01           Broker Code
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Broker Code
      * Setup key
     C                     MOVELP1HHAA    WQSC01           Broker Code
      * Establish starting position
     C           KRSSC     SETLL@HRCPK6                    *
     C           KRSSC     READE@HRCPK6                  90*
      * Data record not found
     C   90                MOVEL'USR1526' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     MOVEL'Y'       YL0004           Rec Inact/Del S
     C                     GOTO SCEXIT                     *QUIT
     C           KRSSC     READE@HRCPK6                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBGUNY           CAH Sequence No
     C                     Z-ADD*ZERO     WBBFDT           Period Beginnin
     C                     Z-ADD*ZERO     WBA2DT           Period Ending D
     C                     Z-ADD*ZERO     WBBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WBPJDT           CAH Unused Date
     C                     Z-ADD*ZERO     WBPKDT           CAH Unused Date
     C                     Z-ADD*ZERO     WBECVL           Comm Min Amt /P
     C                     Z-ADD*ZERO     WBHQVL           Max Accrual Amo
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCC4NB           Order Number
     C                     Z-ADD*ZERO     WCDPNB           Order Sequence
     C                     Z-ADD*ZERO     WCUENB           Order Secondary
     C                     Z-ADD*ZERO     WCDXNB           Sequence Number
     C                     Z-ADD*ZERO     WCBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WCC5PC           Accrual Percent
     C                     Z-ADD*ZERO     WCAYVA           Extended Amount
     C                     Z-ADD*ZERO     WCEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WCHGCD           Item Code
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCDUC7           A/R Customer
     C                     Z-ADD*ZERO     WCPODT           SDA Actual Ship
     C                     Z-ADD*ZERO     WCBYWG           Weight Billed
     C                     Z-ADD*ZERO     WCPPDT           SDA Ord Dtl Acr
     C                     Z-ADD*ZERO     WCPQDT           SDA Unused Date
     C                     Z-ADD*ZERO     WCEEVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WCEFVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WCQ8DT           SDA Invoice Dat
     C                     Z-ADD*ZERO     WCH0NY           SDA G/L Sub Led
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Broker Records Found Usr
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Record Found SlsMrk  Usr
     C                     MOVEL*BLANK    YL0002  1
      * Define local work field Rec Inact/Del Cust Usr
     C                     MOVEL*BLANK    YL0003  1
      * Define local work field Rec Inact/Del ShHs Usr
     C                     MOVEL*BLANK    YL0004  1
      *================================================================
     CSR         ZZEXIT    ENDSR
