     H/TITLE Edt Primal Schd Rpt C06EF Edit file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated or deleted
     H* - Key changes are not allowed
     H* - Program functions in two modes : *ADD and *CHANGE
     H* - Multiple new records may be added by changing to add mode
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Edit file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 09/10/13  Time  : 14:37:02
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPBDWEFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Edt Primal Schd Rpt C06EF Edit file
      *
     FPDJIREL0IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Item Category             Retrieval index
      *
     FPOBHREL0IF  E           K        DISK
      * RTV : Item Category Type        Retrieval index
      *
     FPDJYREL3IF  E           K        DISK
      * RTV : Company Defaults Internal Plant Companies Only CO
      *
     FCAABREL1IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       V
      *
     FCABZREMGIF  E           K        DISK
      * RSQ : Company Item              PrmSch/Co/Item
      *
     FPOBHREL2IF  E           K        DISK
      * RSQ : Item Category Type        By Item Category Code
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPOBHREL1UF  E           K        DISK                      A
      * UPD : Item Category Type        Update index
      *
     FPDJIREL1UF  E           K        DISK                      A
      * UPD : Item Category             Update index
      *
     E                    J3          3  1
     E                    K3          3  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    #L3         3  1
     E                    UCT        40  1               CENTER TABLE
      * Long constants
     E                    @CN#    1  16  6   @CN    25
     I@BHREN0
      * Item Category Type        By Item Category Code
      * Renamed input format fields
     I              BHOHNX                          WAOHNX
     I              BHCNAA                          WACNAA
     I              BHPPNA                          WAPPNA
     I              BHUVST                          WAUVST
     I              BHUWST                          WAUWST
     I              BHUXST                          WAUXST
     I              BHVSST                          WAVSST
     I              BHAATM                          WAAATM
     I              BHAYNA                          WAAYNA
     I              BHA0NA                          WAA0NA
     I              BHAXDT                          WAAXDT
      *
     I@BHREKU
      * Item Category Type        Update index
      * Renamed input format fields
     I              BHOHNX                          WBOHNX
     I              BHCNAA                          WBCNAA
     I              BHPPNA                          WBPPNA
     I              BHUVST                          WBUVST
     I              BHUWST                          WBUWST
     I              BHUXST                          WBUXST
     I              BHVSST                          WBVSST
     I              BHAATM                          WBAATM
     I              BHAYNA                          WBAYNA
     I              BHA0NA                          WBA0NA
     I              BHAXDT                          WBAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSPDJIREL1
      * UPD : Item Category             Update index
      * Current/previous master file format fields for change control
      *
     IQPOBH1    E DSPOBHREL1
      * UPD : Item Category Type        Update index
      * Renamed input format fields
     I              BHOHNX                          WBOHNX
     I              BHCNAA                          WBCNAA
     I              BHPPNA                          WBPPNA
     I              BHUVST                          WBUVST
     I              BHUWST                          WBUWST
     I              BHUXST                          WBUXST
     I              BHVSST                          WBVSST
     I              BHAATM                          WBAATM
     I              BHAYNA                          WBAYNA
     I              BHA0NA                          WBA0NA
     I              BHAXDT                          WBAXDT
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYARDCS      DS                             67
     IYBRDCS      DS                             74
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: *Arrays
      * N :  Warehouse Code
     I                                        1   3 P1AJCD
      * N :  Company Number
     I                                    P   4   50P1AIC3
      * N :  Application Code
     I                                        6  11 P1DNCD
      * N :  Enterprise Code 1
     I                                       12  15 P1DQCD
      * N :  Enterprise Code 2
     I                                       16  27 P1DRCD
      * N :  Salesperson Code
     I                                       28  30 P1BCCD
      * N :  System Date Format
     I                                       31  33 P1B8NA
      * N :  User Profile Name
     I                                       34  43 P1AJVN
      * N :  Allow Multi-Company
     I                                       44  44 P1I6ST
      * N :  Allow Multi Warehouse
     I                                       45  45 P1I8ST
      * N :  Default Printer
     I                                       46  55 P1MPNA
      * N :  First Time Flag
     I                                       56  56 P1TAST
      * N :  Name
     I                                       57  86 P1ADTX
      * N :  System Value Alpha
     I                                       87 126 P1BXTX
      * N :  Access Denied (Y/N)
     I                                      127 127 P1WVST
      * N :  Requested Delivery Date
     I                                    P 128 1310P1EIDT
      * N :  *Initial call
     I                                      132 132 P1ICL
     IP2PARM      DS
      * FLD: Print Options
      * N :  PRT Description
     I                                        1  25 P2G3TX
      * N :  PRT Printer Device
     I                                       26  35 P2WRST
      * N :  PRT Hold Output Sts
     I                                       36  39 P2WSST
      * N :  PRT Save Output Sts
     I                                       40  43 P2WTST
      * N :  PRT Number of Copies
     I                                       44  450P2DYNB
      * N :  PRT Night Queue Run Sts
     I                                       46  46 P2WUST
      * N :  PRT Night Queue
     I                                       47  56 P2BVVN
     IP3PARM      DS
      * N :  System Value Numeric
     I                                    P   1   85P3M8NB
     IP4PARM      DS
      * FLD: Item Category
      * N : MAP Record Status
     I                                        1   1 P4VSST
      * Submit job processing data structures.
     I#SRQS       DS                           3000
     I                                        1   1 #SDMY1
     I#SSTR       DS                           3000
     I                                        1   1 #SDMY2
     I#SWRK       DS                           3000
     I                                        1   1 #SDMY3
     I#SMRG       DS                            256
     I                                        1   1 #SDMY4
     I            DS
     I I            'CMD(CALL PGM('           1  13 #SCLL
     I I            'PARM('                  14  18 #SPRM
     I I            ')'                      19  19 #SPRN
     I I            '          '             20  29 #SPRG
      * Submit job command strings.
     I            DS
     I I            'SBMJOB     JOB(ITEMC-    1 256 #S0001
     I              'ATEGO) JOBD(*USRPRF)'
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'CD3 Non numeric data'
      * Message data for 'CD3 Non numeric data'
      * Message data for 'Option Not Allowed'
      * *SFLSEL
     I                                        1   1 ZA0001
      * Message data for 'Option Not Allowed'
      * *SFLSEL
     I                                        1   1 ZA0002
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0003
      * Application Code
     I                                       11  16 ZA0004
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0005
      * Application Code
     I                                       11  16 ZA0006
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile header
     C                     Z-ADD6         #2USNB           Item Category N
      * CASE: LCL.First Time Flag is Yes
     C           YL0001    IFEQ 'Y'                        *IF
     C                     Z-ADDP1AIC3    #2AIC3           Company Number
     C                     MOVEL'N'       YL0001           First Time Flag
     C                     MOVEL'A'       #PVSST           Record Status
     C                     MOVEL#PVSST    WUVSST           Record Status
     C                     END                             *FI
     C                     END
      *................................................................
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           *LIKE     DEFN #2AIC3    WZAIC3
     C                     MOVEL#2AIC3    WZAIC3           Company Number
     C           *LIKE     DEFN #2SLCD    WZSLCD
     C                     MOVEL#2SLCD    WZSLCD           Item Category C
     C           KPOS      KLIST
     C                     KFLD           JIAIC3           Company Number
     C                     KFLD           JIUSNB           Item Category N
     C                     KFLD           JISLCD           Item Category C
      * Setup key
     C                     Z-ADD#2AIC3    JIAIC3
     C                     Z-ADD#2USNB    JIUSNB
     C                     MOVEL#2SLCD    JISLCD
      * 82=EOF
     C           KPOS      SETLL@JIREXX              82    *
      * 82=EOF
     C  N82                READ @JIREXX                9182*
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@JIREXX                  90*
     C  N82                READ @JIREXX                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  7
     C                     MOVE *ALL'1'   WKIND1  7
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
      * CASE: DB1.Item Category Number is Entered
     C           JIUSNB    IFNE *ZERO                      *IF
      * CASE: DB1.Item Category Number NE CTL.Item Category Number
     C           JIUSNB    IFNE #2USNB                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * Rtv Item Catefory TypeRT - Item Category Type  * 
     C                     EXSR SARVGN
      * CASE: CTL.Record Status is Active/Inactive
     C           #PVSST    IFEQ 'A'                        *IF
     C           #PVSST    OREQ 'I'
      * CASE: DB1.Record Status EQ CTL.Record Status
     C           JIVSST    IFEQ #PVSST                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     ELSE
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile record (new record)
     C                     MOVEL'A'       #1VSST           Record Status
     C                     Z-ADD06        #1USNB           Item Category N
     C                     END
     C                     END
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C                     READ @JIREXX                  82*
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Validate EDI Status 3
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#CUXST    W0NSRQ  1        EDI Status 3
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#CUXST'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1305379   Y2LSNO  70
     C           #CUXST    PARM #CUXST    W0EXVL 25        EDI Status 3
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate Record Status
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#PVSST    W0NSRQ  1        Record Status
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#PVSST'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1255478   Y2LSNO  70
     C           #PVSST    PARM #PVSST    W0EXVL 25        Record Status
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           W0PMD     IFNE 'ADD'
      * Validate Company Number and convert to internal.
      * CD3 Ext/Int
     C                     MOVELV2AIC3    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC3  3
     C                     MOVEA*BLANKS   K3
     C                     Z-ADD3         C       30
     C                     Z-ADD3         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUDMCD    J3
     C                     MOVE *BLANKS   W0RTN
     C                     DO   3
     C           J3,C      IFNE ' '
     C                     MOVEAJ3,C      K3,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK3        JUSTC3
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC3    TESTC   1
     C           TESTC     IFGT '?'
     C           TESTC     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC3     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC3    WUDMCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,001                    *IF
      * Setup message data for message
      * Send message 'CD3 Non numeric data'
     C                     MOVEL'USR0752' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #2AIC3           CD3 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUDMCD    #2AIC3           CD3 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
      * Change of position specified
     C           YPMTFD    IFEQ *BLANKS
     C           WZAIC3    CASNE#2AIC3    FBRQRL           Company Number
     C           WZSLCD    CASNE#2SLCD    FBRQRL           Item Category C
     C                     END
     C                     END
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile control
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.Record Status NE WRK.Record Status
      *   |- c2    : PGM.*Program mode is *CHANGE
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #PVSST    IFNE WUVSST                     *IF
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL#PVSST    WUVSST           Record Status
     C                     END                             *FI
     C                     END
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process command keys
      * ** Prompt for print options first time around **
      * CASE: CTL.*CMD key is *Print List
     C           *IN21     IFEQ '1'                        *IF
     C                     MOVEL@CN,002   P2G3TX           PRT Description
      * PMT Print Option  SHR  PV - Print Options  * 
     C                     CALL 'PDG0PVR'              90  PMT Print Optio
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2G3TX    WQ0001 25        PRT Description
     C           P2WRST    PARM P2WRST    WQ0002 10        PRT Printer Dev
     C           P2WSST    PARM P2WSST    WQ0003  4        PRT Hold Output
     C           P2WTST    PARM P2WTST    WQ0004  4        PRT Save Output
     C           P2DYNB    PARM P2DYNB    WQ0005  20       PRT Number of C
     C           P2WUST    PARM P2WUST    WQ0006  1        PRT Night Queue
     C           P2BVVN    PARM P2BVVN    WQ0007 10        PRT Night Queue
     C                     PARM 'C/S'     WQ0008  6        Application Cod
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG0PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * ** Submit print job unless quit is requested **
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ @CN,003                    *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDP2DYNB    P3M8NB           System Value Nu
      * Prt PD Item Category   IF
      * RTV for Print Item Cats - Company Defaults Internal  * 
     C                     EXSR SBRVGN
      * ** Send print job submitted message to the user **
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Send message 'Print has been Submitted'
     C                     MOVEL'USR1832' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,35
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C           ##RR      ANDNEYPMRRN
      * Clear all record fields
     C                     EXSR MAIZ#1
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * If delete request, bypass validation
     C           #1SEL     IFEQ '4'
     C                     GOTO DCEXIT
     C                     END
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           V1AIC3    CABNE*BLANK    DDEXIT           Company Number
     C           #1SLCD    CABNE*BLANK    DDEXIT           Item Category C
     C           #1AUNA    CABNE*BLANK    DDEXIT           Description
     C           #RPPNA    CABNE*BLANK    DDEXIT           Item Category T
     C           #1UXST    CABNE*BLANK    DDEXIT           EDI Status 3
     C           #1VSST    CABNE*BLANK    DDEXIT           Record Status
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate Company Number and convert to internal.
      * CD3 Ext/Int
     C                     MOVELV1AIC3    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC3  3
     C                     MOVEA*BLANKS   K3
     C                     Z-ADD3         C       30
     C                     Z-ADD3         D       30
     C                     MOVEAWUDMCD    J3
     C                     MOVE *BLANKS   W0RTN
     C                     DO   3
     C           J3,C      IFNE ' '
     C                     MOVEAJ3,C      K3,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK3        JUSTC3
     C                     MOVE JUSTC3    TESTC   1
     C           TESTC     IFGT '?'
     C           TESTC     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC3     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC3    WUDMCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,001                    *IF
      * Setup message data for message
      * Send message 'CD3 Non numeric data'
     C                     MOVEL'USR0752' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     Z-ADD*ZERO     #1AIC3           CD3 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUDMCD    #1AIC3           CD3 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate EDI Status 3
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1UXST    W0NSRQ  1        EDI Status 3
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#1UXST'  OREQ YPMTFD
     C           ##RR      ANDEQYPMRRN
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1305379   Y2LSNO  70
     C           #1UXST    PARM #1UXST    W0EXVL 25        EDI Status 3
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate Record Status
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1VSST    W0NSRQ  1        Record Status
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#1VSST'  OREQ YPMTFD
     C           ##RR      ANDEQYPMRRN
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1667643   Y2LSNO  70
     C           #1VSST    PARM #1VSST    W0EXVL 25        Record Status
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate subfile record relations
     C                     EXSR DFV2RC
      * Company Number required
     C           #1AIC3    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9836  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Item Category Code required
     C           #1SLCD    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9837  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Description required
     C           #1AUNA    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9838  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Item Category Type Desc required
     C           #RPPNA    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9839  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Company Name and Address
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     9836  *
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record relations
      * Physical Delete only allowed if the IS staff performs this
      * CASE: Delete but only allow for prktest usr and IT staff
      *  - c1 AND c2
      *   |- c1    : RCD.*SFLSEL is *Delete
      *   |- c2    : JOB.*USER is All IS DEV/PRD & Prktest
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1SEL     IFEQ '4'                        *IF
     C           #1SEL     OREQ ' 4'
     C           ##USR     IFEQ @CN,004                    *IF
     C           ##USR     OREQ @CN,005
     C           ##USR     OREQ @CN,006
     C           ##USR     OREQ @CN,007
     C           ##USR     OREQ @CN,008
     C           ##USR     OREQ @CN,009
     C           ##USR     OREQ @CN,010
     C           ##USR     OREQ @CN,011
     C           ##USR     OREQ @CN,012
     C           ##USR     OREQ @CN,013
     C           ##USR     OREQ @CN,014
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Val PrmGrp        CT06RT - Company Item  * 
     C                     EXSR SCRVGN
      * CASE: WRK.Return Code Usr is Record Found
     C           WUH3TX    IFEQ @CN,015                    *IF
      * Send message 'PRMGRP Found on Co/Item'
     C                     MOVEL'USR4527' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0001           *SFLSEL
      * Send message 'Option Not Allowed'
     C                     MOVEL'USR2262' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Delete
     C           #1SEL     IFEQ '4'                        *IF
     C           #1SEL     OREQ ' 4'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0002           *SFLSEL
      * Send message 'Option Not Allowed'
     C                     MOVEL'USR2262' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                     EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C                     MOVEL*BLANK    #1SEL
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE '4'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ '4'
      * Process delete request
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      *
     C                     MOVEL*BLANK    WN0001  1        Record Status
     C                     Z-ADD*ZERO     WN0002  60       Job Time
     C                     MOVEL*BLANK    WN0003 10        User Id
     C                     MOVEL*BLANK    WN0004 10        Job Name
     C                     Z-ADD*ZERO     WN0005  70       Job Date
      *
      * CRT PD Item CategoryC06IF
     C                     MOVEL#1SLCD    #1CNAA           Item Category T
      * Rtv Item Categ Number RT - Item Category Type  * 
     C                     EXSR SDRVGN
      * CRT PD Item Category   CR - Item Category  * 
     C                     EXSR SFCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,35
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Dlt Item Category  C06IF
      * Dlt Item Category TypeRT - Item Category Type  * 
     C                     EXSR SGRVGN
      * Delete Item Category - Item Category  * 
     C                     EXSR SIDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,35
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Chg Item Category Ct06IF
      * Change Item Category Type - Item Category Type  * 
     C                     EXSR SJCHRC
      * Change Item Category - Item Category  * 
     C                     EXSR SKCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,35
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           W0PMD     IFEQ 'ADD'                      *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     Z-ADD*ZERO     #1OHNX           Item Category T
     C                     MOVEL*BLANK    #1CNAA           Item Category T
     C                     MOVEL*BLANK    #1UVST           EDI Status 1
     C                     MOVEL*BLANK    #1UWST           EDI Status 2
     C                     Z-ADD*ZERO     #1AATM           Job Time
     C                     MOVEL*BLANK    #1AYNA           User Id
     C                     MOVEL*BLANK    #1A0NA           Job Name
     C                     Z-ADD*ZERO     #1AXDT           Job Date
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     Z-ADD*ZERO     #1AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V1AIC3
     C                     Z-ADD*ZERO     #1USNB           Item Category N
     C                     MOVEL*BLANK    #1SLCD           Item Category C
     C                     MOVEL*BLANK    #1AUNA           Description
     C                     MOVEL*BLANK    #RPPNA           Item Category T
     C                     MOVEL*BLANK    #1UXST           EDI Status 3
     C                     MOVELP4VSST    #1VSST           Record Status
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @JIREXX fields to subfile
      *================================================================
     C                     Z-ADDJIOHNX    #1OHNX           Item Category T
     C                     MOVELJICNAA    #1CNAA           Item Category T
     C                     MOVELJIUVST    #1UVST           EDI Status 1
     C                     MOVELJIUWST    #1UWST           EDI Status 2
     C                     Z-ADDJIAATM    #1AATM           Job Time
     C                     MOVELJIAYNA    #1AYNA           User Id
     C                     MOVELJIA0NA    #1A0NA           Job Name
     C                     Z-ADDJIAXDT    #1AXDT           Job Date
     C                     Z-ADDJIAIC3    #1AIC3           Company Number
     C                     Z-ADDJIUSNB    #1USNB           Item Category N
     C                     MOVELJISLCD    #1SLCD           Item Category C
     C                     MOVELJIAUNA    #1AUNA           Description
     C                     MOVELJIUXST    #1UXST           EDI Status 3
     C                     MOVELJIVSST    #1VSST           Record Status
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADD*ZERO     #2AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V2AIC3
     C                     Z-ADD*ZERO     #2USNB           Item Category N
     C                     MOVEL*BLANK    #2SLCD           Item Category C
     C                     MOVEL*BLANK    #CUXST           EDI Status 3
     C                     MOVELP4VSST    #PVSST           Record Status
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #1AIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V1AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1AIC3           CD3 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #2AIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V2AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2AIC3           CD3 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Item Catefory TypeRT - Item Category Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           BHOHNX           Item Category T
     C                     KFLD           BHCNAA           Item Category T
      * Setup key
     C                     Z-ADD#1OHNX    BHOHNX           Item Category T
     C                     MOVEL#1CNAA    BHCNAA           Item Category T
      * Establish starting position
     C           KRSSA     CHAIN@BHREKT              90    *
      * Data record not found
     C   90                MOVEL'USR3079' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVELBHPPNA    #RPPNA           Item Category T
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV for Print Item Cats - Company Defaults Internal  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@JYREEY                    *
     C                     READ @JYREEY                  90*
      * Data record not found
     C   90                MOVEL'USR2025' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * SBMJOB: Prt Item Category      UP - /UT User Programs  * 
      *
     C                     MOVEL*BLANK    W0RTN
      * Build call string for processing in batch.
     C                     MOVEL#S0001    #SRQS     P
     C           #SRQS     CAT  #SCLL:1   #SRQS            Call command
     C                     MOVEL'PPU6UPC '#SPRG     P      Load pgm name
     C           #SRQS     CAT  #SPRG:0   #SRQS            Add pgm name
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *................................................................
      * Build parameters string.
     C           #SRQS     CAT  #SPRM:1   #SRQS            Parameters
      *
     C                     MOVELWUH3TX    #SSTR     P      Return Code Usr
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 7         #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELP2WRST    #SSTR     P      PRT Printer Dev
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 10        #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELP2WSST    #SSTR     P      PRT Hold Output
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 4         #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     MOVELP2WTST    #SSTR     P      PRT Save Output
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'A'       #STYP   1
     C                     PARM 4         #SLEN   50
     C                     PARM           #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADDP3M8NB    #SPAK  309       System Value Nu
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 15        #SLEN   50
     C                     PARM 5         #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADDJYAIC3    #SPAK  309       Company Number
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 3         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C                     Z-ADD#2USNB    #SPAK  309       Item Category N
     C                     MOVEL#SPAK     #SSTR     P
     C                     CALL 'Y2BLSJR'
     C                     PARM           W0RTN
     C                     PARM           #SSTR
     C                     PARM 'P'       #STYP   1
     C                     PARM 2         #SLEN   50
     C                     PARM 0         #SDEC   10
     C                     PARM           #SRQS
      *
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *................................................................
     C           #SRQS     CAT  #SPRN:0   #SRQS            Parenthesis
      *
     C           W0RTN     IFNE *BLANK
      * Build of submit job string ended in error.
     C                     MOVEL'Y2U0065' W0RTN
     C                     MOVEL'PPU6UPC 'W0CLPG 10 P
      * Send message '*Error occured on SBMJOB'
     C                     MOVEL'Y2U0065' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           W0SJO     IFNE *BLANK
      * Merge variable submit job overrides.
     C                     CALL 'Y2MGRQR'              90  *
     C                     PARM #SRQS     #SWRK
     C                     PARM W0SJO     #SMRG
     C  N90                MOVEL#SWRK     #SRQS     P
     C                     MOVE *BLANK    W0SJO
     C                     END
      * Submit request.
     C                     CALL 'Y2CMEXC'              90  *
     C                     PARM           #SRQS
     C                     PARM 3000      #SRQL  155
     C                     PARM           W0JVN  10
     C                     PARM           W0JUN  10
     C                     PARM           W0JNB   6
     C                     END
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PPU6UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     READ @JYREEY                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Val PrmGrp        CT06RT - Company Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN BZICN6    WQSC01           Item Category N
     C           *LIKE     DEFN BZS0CD    WQSC02           Item Primal Sch
     C           *LIKE     DEFN BZAIC3    WQSC03           Company Number
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Item Category N
     C                     KFLD           WQSC02           Item Primal Sch
     C                     KFLD           WQSC03           Company Number
      * Setup key
     C                     Z-ADD#1USNB    WQSC01           Item Category N
     C                     MOVEL#1SLCD    WQSC02           Item Primal Sch
     C                     Z-ADD#1AIC3    WQSC03           Company Number
      * Establish starting position
     C           KRSSC     SETLL@BZRENZ                    *
     C           KRSSC     READE@BZRENZ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0326' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUH3TX           Return Code Usr
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL@CN,015   WUH3TX           Return Code Usr
     C           KRSSC     READE@BZRENZ                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Item Categ Number RT - Item Category Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     #1OHNX           Item Category T
      * Declare restrictor key work fields
     C           *LIKE     DEFN WACNAA    WQSD01           Item Category T
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Item Category T
      * Setup key
     C                     MOVEL#1CNAA    WQSD01           Item Category T
      * Establish starting position
     C           KRSSD     SETLL@BHREN0                    *
     C           KRSSD     READE@BHREN0                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3079' W0RTN   7
      * USER: Processing if Data record not found
      * Item Category Code and Item Category Type Code are the same
      * get the last item category type number and add 1 to it
     C                     Z-ADD1         #1OHNX           Item Category T
      * Create Item Category Type - Item Category Type  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1OHNX    WL0001           Item Category T
     C                     MOVEL#1SLCD    WL0002    P      Item Category T
     C                     MOVEL#RPPNA    WL0003    P      Item Category T
     C                     MOVELWUUVST    WL0004    P      EDI Status 1
     C                     MOVELWUUWST    WL0005    P      EDI Status 2
     C                     MOVELWUUXST    WL0006    P      EDI Status 3
     C                     MOVEL'A'       WL0007    P      Record Status
     C                     Z-ADDWUAATM    WL0008           Job Time
     C                     MOVELWUAYNA    WL0009    P      User Id
     C                     MOVELWUA0NA    WL0010    P      Job Name
     C                     Z-ADDWUAXDT    WL0011           Job Date
     C                     EXSR SECRRC
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Item Category Code and Item Category Type Code are the same
      * get the last item category type number and add 1 to it
     C           WAOHNX    ADD  1         #1OHNX           Item Category T
      * Create Item Category Type - Item Category Type  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1OHNX    WL0001           Item Category T
     C                     MOVEL#1SLCD    WL0002    P      Item Category T
     C                     MOVEL#RPPNA    WL0003    P      Item Category T
     C                     MOVELWUUVST    WL0004    P      EDI Status 1
     C                     MOVELWUUWST    WL0005    P      EDI Status 2
     C                     MOVELWUUXST    WL0006    P      EDI Status 3
     C                     MOVEL'A'       WL0007    P      Record Status
     C                     Z-ADDWUAATM    WL0008           Job Time
     C                     MOVELWUAYNA    WL0009    P      User Id
     C                     MOVELWUA0NA    WL0010    P      Job Name
     C                     Z-ADDWUAXDT    WL0011           Job Date
     C                     EXSR SECRRC
     C           KRSSD     READE@BHREN0                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Create Item Category Type - Item Category Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BHREKU
     C                     Z-ADDWL0001    WBOHNX           Item Category T
     C                     MOVELWL0002    WBCNAA           Item Category T
     C                     MOVELWL0003    WBPPNA           Item Category T
     C                     MOVELWL0004    WBUVST           EDI Status 1
     C                     MOVELWL0005    WBUWST           EDI Status 2
     C                     MOVELWL0006    WBUXST           EDI Status 3
     C                     MOVELWL0007    WBVSST           Record Status
     C                     Z-ADDWL0008    WBAATM           Job Time
     C                     MOVELWL0009    WBAYNA           User Id
     C                     MOVELWL0010    WBA0NA           Job Name
     C                     Z-ADDWL0011    WBAXDT           Job Date
      *
      * USER: Processing before Data update
      * SET Record Stamp CRTOB IF
     C                     MOVEL'A'       WBVSST           Record Status
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
     C           KLCRSE    KLIST
     C                     KFLD           WBOHNX           Item Category T
     C                     KFLD           WBCNAA           Item Category T
      * Check for duplicate primary key
     C           KLCRSE    SETLL@BHREKU                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3080' W0RTN   7
      * Send message 'Item Category Type     EX'
     C                     MOVEL'USR3080' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@BHREKU                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * CRT PD Item Category   CR - Item Category  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @JIREXY
     C                     Z-ADD#1AIC3    JIAIC3           Company Number
     C                     Z-ADD#2USNB    JIUSNB           Item Category N
     C                     MOVEL#1SLCD    JISLCD           Item Category C
     C                     MOVEL#1AUNA    JIAUNA           Description
     C                     Z-ADD#1OHNX    JIOHNX           Item Category T
     C                     MOVEL#1CNAA    JICNAA           Item Category T
     C                     MOVEL#1UVST    JIUVST           EDI Status 1
     C                     MOVEL#1UWST    JIUWST           EDI Status 2
     C                     MOVEL#1UXST    JIUXST           EDI Status 3
     C                     MOVELWN0001    JIVSST           Record Status
     C                     Z-ADDWN0002    JIAATM           Job Time
     C                     MOVELWN0003    JIAYNA           User Id
     C                     MOVELWN0004    JIA0NA           Job Name
     C                     Z-ADDWN0005    JIAXDT           Job Date
      *
      * USER: Processing before Data update
      * SET Record Stamp CRTOB IF
     C                     MOVEL'A'       JIVSST           Record Status
     C                     Z-ADD##JTM     JIAATM           Job Time
     C                     MOVEL##USR     JIAYNA           User Id
     C                     MOVEL##JOB     JIA0NA           Job Name
     C                     Z-ADD##JDT     JIAXDT           Job Date
     C           KLCRSF    KLIST
     C                     KFLD           JIAIC3           Company Number
     C                     KFLD           JIUSNB           Item Category N
     C                     KFLD           JISLCD           Item Category C
      * Check for duplicate primary key
     C           KLCRSF    SETLL@JIREXY                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1855' W0RTN   7
      * Send message 'Item Category          EX'
     C                     MOVEL'USR1855' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@JIREXY                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Dlt Item Category TypeRT - Item Category Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           BHOHNX           Item Category T
     C                     KFLD           BHCNAA           Item Category T
      * Setup key
     C                     Z-ADD#1USNB    BHOHNX           Item Category T
     C                     MOVEL#1SLCD    BHCNAA           Item Category T
      * Establish starting position
     C           KRSSG     CHAIN@BHREKT              90    *
      * Data record not found
     C   90                MOVEL'USR3079' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Delete Item Category Type - Item Category Type  * 
     C                     EXSR SHDLRC
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHDLRC    BEGSR
      *================================================================
      * Delete Item Category Type - Item Category Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BHREKU
     C                     Z-ADDBHOHNX    WBOHNX           Item Category T
     C                     MOVELBHCNAA    WBCNAA           Item Category T
      *
     C           KLDLSH    KLIST
     C                     KFLD           WBOHNX           Item Category T
     C                     KFLD           WBCNAA           Item Category T
     C           KLDLSH    CHAIN@BHREKU              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'POBHREL1'MDACP
     C                     MOVEL'@BHREKU' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BHREKU                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIDLRC    BEGSR
      *================================================================
      * Delete Item Category - Item Category  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @JIREXY
     C                     Z-ADD#1AIC3    JIAIC3           Company Number
     C                     Z-ADD#1USNB    JIUSNB           Item Category N
     C                     MOVEL#1SLCD    JISLCD           Item Category C
      *
     C           KLDLSI    KLIST
     C                     KFLD           JIAIC3           Company Number
     C                     KFLD           JIUSNB           Item Category N
     C                     KFLD           JISLCD           Item Category C
     C           KLDLSI    CHAIN@JIREXY              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDJIREL1'MDACP
     C                     MOVEL'@JIREXY' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@JIREXY                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Change Item Category Type - Item Category Type  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0006  60       Job Time
     C                     MOVEL*BLANK    WN0007 10        User Id
     C                     MOVEL*BLANK    WN0008 10        Job Name
     C                     Z-ADD*ZERO     WN0009  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BHREKU
     C                     Z-ADD#1OHNX    WBOHNX           Item Category T
     C                     MOVEL#1CNAA    WBCNAA    P      Item Category T
      *
     C           KLCHSJ    KLIST
     C                     KFLD           WBOHNX           Item Category T
     C                     KFLD           WBCNAA           Item Category T
     C           KLCHSJ    CHAIN@BHREKU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'POBHREL1'MDACP
     C                     MOVEL'@BHREKU' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPOBH1    YARDCS
      * USER: Processing after Data read
      * Set Record Stamp CHGOB IF
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
      * Move non-key fields to @BHREKU
     C                     MOVEL#RPPNA    WBPPNA    P      Item Category T
     C                     MOVEL#1UVST    WBUVST    P      EDI Status 1
     C                     MOVEL#1UWST    WBUWST    P      EDI Status 2
     C                     MOVEL#1UXST    WBUXST    P      EDI Status 3
     C                     MOVEL#1VSST    WBVSST    P      Record Status
      *
      * Set PGM.*Record Data Changed flag
     C           QPOBH1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BHREKU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPOBHREL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCHRC    BEGSR
      *================================================================
      * Change Item Category - Item Category  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @JIREXY
     C                     Z-ADD#1AIC3    JIAIC3           Company Number
     C                     Z-ADD#1USNB    JIUSNB           Item Category N
     C                     MOVEL#1SLCD    JISLCD    P      Item Category C
      *
     C           KLCHSK    KLIST
     C                     KFLD           JIAIC3           Company Number
     C                     KFLD           JIUSNB           Item Category N
     C                     KFLD           JISLCD           Item Category C
     C           KLCHSK    CHAIN@JIREXY              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDJIREL1'MDACP
     C                     MOVEL'@JIREXY' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE @1DBRC    YBRDCS
      * Move non-key fields to @JIREXY
     C                     MOVEL#1AUNA    JIAUNA    P      Description
     C                     Z-ADD#1OHNX    JIOHNX           Item Category T
     C                     MOVEL#1CNAA    JICNAA    P      Item Category T
     C                     MOVEL#1UVST    JIUVST    P      EDI Status 1
     C                     MOVEL#1UWST    JIUWST    P      EDI Status 2
     C                     MOVEL#1UXST    JIUXST    P      EDI Status 3
     C                     MOVEL#1VSST    JIVSST    P      Record Status
     C                     Z-ADDWUAATM    JIAATM           Job Time
     C                     MOVELWUAYNA    JIAYNA    P      User Id
     C                     MOVELWUA0NA    JIA0NA    P      Job Name
     C                     Z-ADDWUAXDT    JIAXDT           Job Date
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Record Stamp CHGOB IF
     C                     Z-ADD##JTM     JIAATM           Job Time
     C                     MOVEL##USR     JIAYNA           User Id
     C                     MOVEL##JOB     JIA0NA           Job Name
     C                     Z-ADD##JDT     JIAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@JIREXY                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDJIREL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0010    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSL     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL@CN,016   W0RTN            *Return code
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    P1I6ST           Allow Multi-Com
     C                     MOVELDRMPNA    P1MPNA           Default Printer
     C                     MOVELDRBCCD    P1BCCD           Salesperson Cod
     C                     Z-ADDDRAIC3    YL0002           Company Number
     C                     MOVELDRBUVN    WN0011           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0012    DTAJVN           User Profile Na
     C                     MOVELWL0013    DTDNCD           Application Cod
      * Establish starting position
     C           KRSSM     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0014           Company Number
     C                     MOVELDTAJCD    WL0015           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSN01           Application Cod
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           WQSN01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSN01           Application Cod
     C                     MOVEL'C/S'     WQSN01           Application Cod
      * Establish starting position
     C           KRSSN     SETLL@DNRESF                    *
     C           KRSSN     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SORVGN
     C                     END                             *FI
     C           KRSSN     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSO01           Application Cod
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WQSO01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSO01           Application Cod
      * Establish starting position
     C           KRSSO     SETLL@DNRESF                    *
     C           KRSSO     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL@CN,016   W0RTN            *Return code
     C                     GOTO SOEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSO     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * ***  Modifications  ***
      *================================================================
      * TPA071110 - Take out explicit creation of Item Category for
      *             St Joseph 960 and replace with read to Company Def
      *             Internal. All plant companies will have G/L codes
      *             created for them.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Company Name and Address
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVELV1AIC3    WK1X01  1
     C           WK1X01    IFEQ '?'                        Company Number
     C           YPMTFD    OREQ '#1AIC3'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1AIC3' defaulted for 'Company Number'.
     C                     CALL 'PDL7SRR'              90  SEL Co - Rtn 0
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0009  30       Company Number
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL7SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9836  *
     C                     END
      *
     C           #1AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1AIC3    IFEQ *ZERO                      Company Number
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAAB    KLIST
     C                     KFLD           ABAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    ABAIC3
     C           KLVAAB    CHAIN@ABREAK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Company Name and Addre NF'
     C                     MOVEL'USR0003' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0003' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD12        ZHSTRW  40
     C                     Z-ADD23        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           ZHCSRW    IFEQ 011
     C           ZHCSCL    ANDEQ087
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#CUXST'  YPMTFD           EDI Status 3
     C                     END
      *
     C           ZHCSRW    IFEQ 011
     C           ZHCSCL    ANDEQ096
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#PVSST'  YPMTFD           Record Status
     C                     END
      *
     C           ZHF4RW    IFEQ 012
     C           ZHCSCL    ANDGE005
     C           ZHCSCL    ANDLE007
     C           *IN89     ANDEQ'1'
     C                     MOVEL'#1AIC3'  YPMTFD           Company Number
     C                     END
      *
     C           ZHF4RW    IFEQ 012
     C           ZHCSCL    ANDEQ087
     C                     MOVEL'#1UXST'  YPMTFD           EDI Status 3
     C                     END
      *
     C           ZHF4RW    IFEQ 012
     C           ZHCSCL    ANDEQ096
     C                     MOVEL'#1VSST'  YPMTFD           Record Status
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P1AJCD           Warehouse Code
     C                     Z-ADD*ZERO     P1AIC3           Company Number
     C                     MOVEL*BLANK    P1DNCD           Application Cod
     C                     MOVEL*BLANK    P1DQCD           Enterprise Code
     C                     MOVEL*BLANK    P1DRCD           Enterprise Code
     C                     MOVEL*BLANK    P1BCCD           Salesperson Cod
     C                     MOVEL*BLANK    P1B8NA           System Date For
     C                     MOVEL*BLANK    P1AJVN           User Profile Na
     C                     MOVEL*BLANK    P1I6ST           Allow Multi-Com
     C                     MOVEL*BLANK    P1I8ST           Allow Multi War
     C                     MOVEL*BLANK    P1MPNA           Default Printer
     C                     MOVEL*BLANK    P1TAST           First Time Flag
     C                     MOVEL*BLANK    P1ADTX           Name
     C                     MOVEL*BLANK    P1BXTX           System Value Al
     C                     MOVEL*BLANK    P1WVST           Access Denied (
     C                     Z-ADD*ZERO     P1EIDT           Requested Deliv
     C                     MOVEL*BLANK    P1ICL            *Initial call
     C                     MOVEL*BLANK    P2G3TX           PRT Description
     C                     MOVEL*BLANK    P2WRST           PRT Printer Dev
     C                     MOVEL*BLANK    P2WSST           PRT Hold Output
     C                     MOVEL*BLANK    P2WTST           PRT Save Output
     C                     Z-ADD*ZERO     P2DYNB           PRT Number of C
     C                     MOVEL*BLANK    P2WUST           PRT Night Queue
     C                     MOVEL*BLANK    P2BVVN           PRT Night Queue
     C                     Z-ADD*ZERO     P3M8NB           System Value Nu
     C                     MOVEL*BLANK    P4VSST           Record Status
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Record Status
     C                     MOVEL*BLANK    WUVSST  1
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Return Code Usr
     C                     MOVEL*BLANK    WUH3TX  7
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAOHNX           Item Category T
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field EDI Status 1
     C                     MOVEL*BLANK    WUUVST  1
      * Define work field EDI Status 2
     C                     MOVEL*BLANK    WUUWST  1
      * Define work field EDI Status 3
     C                     MOVEL*BLANK    WUUXST  1
      * Define work field Job Time
     C                     Z-ADD*ZERO     WUAATM  60
      * Define work field User Id
     C                     MOVEL*BLANK    WUAYNA 10
      * Define work field Job Name
     C                     MOVEL*BLANK    WUA0NA 10
      * Define work field Job Date
     C                     Z-ADD*ZERO     WUAXDT  70
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      *
     C                     MOVEL*BLANK    W0SJO 132        *Sbmjob overrid
      * Define local variables for subroutine SECRRC.
     C                     Z-ADD*ZERO     WL0001  20
     C                     MOVEL*BLANK    WL0002  3
     C                     MOVEL*BLANK    WL0003 30
     C                     MOVEL*BLANK    WL0004  1
     C                     MOVEL*BLANK    WL0005  1
     C                     MOVEL*BLANK    WL0006  1
     C                     MOVEL*BLANK    WL0007  1
     C                     Z-ADD*ZERO     WL0008  60
     C                     MOVEL*BLANK    WL0009 10
     C                     MOVEL*BLANK    WL0010 10
     C                     Z-ADD*ZERO     WL0011  70
      * Define local variables for subroutine SMRVGN.
     C                     MOVEL*BLANK    WL0012 10
     C                     MOVEL*BLANK    WL0013  6
     C                     Z-ADD*ZERO     WL0014  30
     C                     MOVEL*BLANK    WL0015  3
      * Define local work field First Time Flag
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0002  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0003  3
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      *
     C                     Z-ADD12        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * ***  Modifications  ***
     C                     EXSR UASUBR                     ***  Modificati
      *
     C                     MOVEL*BLANK    WN0010 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0010           User Profile Na
      *
     C                     MOVEL*BLANK    WN0011 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SLRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,016                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0010    ZA0003           User Profile Na
     C                     MOVEL'C/S'     ZA0004           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL@CN,003   P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0011    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0010    WL0012    P      User Profile Na
     C                     MOVEL'C/S'     WL0013    P      Application Cod
     C                     EXSR SMRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0014    P1AIC3           Company Number
     C                     MOVELWL0015    YL0003    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0011    WL0012    P      User Profile Na
     C                     MOVEL'C/S'     WL0013    P      Application Cod
     C                     EXSR SMRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0014    P1AIC3           Company Number
     C                     MOVELWL0015    YL0003    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0003    P1AJCD           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0010    ZA0005           User Profile Na
     C                     MOVEL'C/S'     ZA0006           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL@CN,003   P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0002    IFNE *ZERO                      *IF
     C                     Z-ADDYL0002    P1AIC3           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0003    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C           P1AJCD    PARM *BLANK    WQ0010  3        Warehouse Code
     C                     PARM YL0002    WQ0011  30       Shipping Compan
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SNRVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
     C                     MOVEL'Y'       YL0001           First Time Flag
      * ** Set up parameters for submit of print **
     C                     MOVEL'N'       P2WUST           PRT Night Queue
     C                     MOVEL*BLANK    P2WRST           PRT Printer Dev
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 USR0752
00002 Primal Group Report
00003 Y2U9999
00004 ALICEB
00005 ISALICEB
00006 PRKTEST
00007 ISPURVAP
00008 ISPPATE
00009 ISROSEM
00010 ISRCENT
00011 ISSMASO
00012 ISSUSANM
00013 ISLBUSE
00014 ISLARAB
00015 RCDFND
00016 Y2U0005
