// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBJBXFR
// ?Date: 14.08.2025 Time: 03:48:13
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?*****************************************************************
//?**** 6/26/13 Created to run for scale 38 only, serials 38nnnnnn
//?*****************************************************************
EXECUTE FUNCTION(RTV default Company    IF) TYPE(EXCINTFUN)                     AC1592222;
PARAMETER(LCL.Company_Number);
{
 //?Execute internal function

 EXECUTE FUNCTION(Rtv Profile Model     RT) TYPE(RTVOBJ) FILE(CADRREP)           AC1445577;
 PARAMETER(JOB.*USER);
 PARAMETER(PAR.User_Code_Model);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PAR.User Code Model is equal to blank
 IF PAR.User_Code_Model = *BLANK;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(JOB.*USER);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(PAR.User_Code_Model);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

}


//?****  OLD Tattoo match Processing    06/04/04   comment 10/26/04
//?****  NEW Trolley Tracking Processing    10/26/04
//?       Use date in parm from calling pgm to position the file
//?****  End
CASE;

// IF PAR.PT Serial Number is Entered
IF PAR.PT_Serial_Number > *ZERO;

EXECUTE FUNCTION(Rtv PT-upd per scale  RT) TYPE(RTVOBJ) FILE(POB2CPP)           AC2069537;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.PT_Serial_Number);
PARAMETER(PAR.PT_From_FG_Serial_Nbr);
PARAMETER(LCL.Count_USR);
{
 //?USER: Initialize routine

 //?****************************************
 //?6/26/13 RMC CREATED TO RUN FOR SCALE 38NNNNNN RCDS ONLY
 //?****************************************
 //?8/15/03
 //?Will be yes when Pump Dump Date/Times are being entered for WIPs
 EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
 PARAMETER(PAR.Company_Number);
 PARAMETER('PUMPDUMP');
 PARAMETER(LCL.Status_Y_or_N);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?6/04/04  RMC NEW Trolley Tracking Processing
 //?10/26/04  RMC NEW Trolley Tracking Processing again
 //?USER: Process Data record

 CASE;

 // IF DB1.PT Serial Number GE PAR.PT Serial Number
 IF DB1.PT_Serial_Number >= PAR.PT_Serial_Number;

 // AND DB1.PT Serial Number LT PAR.PT From FG Serial Nbr
 AND DB1.PT_Serial_Number < PAR.PT_From_FG_Serial_Nbr;

 //?Get the closest tattoo in the Cold Scale Tattoo UPL file
 // WRK.Production Date UPL = CVTVAR(DB1.PT Offset Prod Date)
 WRK.Production_Date_UPL = CVTVAR(DB1.PT_Offset_Prod_Date);

 // WRK.Production Time UPL = CVTVAR(DB1.PT Offset Prod Time)
 WRK.Production_Time_UPL = CVTVAR(DB1.PT_Offset_Prod_Time);

 // LCL.Production Date USR = DB1.PT Offset Prod Date
 LCL.Production_Date_USR = DB1.PT_Offset_Prod_Date;

 EXECUTE FUNCTION(RTV Kill Dt w/Prd Dt   RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1301549;
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Production_Date_USR);
 PARAMETER(LCL.Kill_Date);
 {
  //?USER: Initialize routine

  // WRK.First Time Flag = CND.Yes
  WRK.First_Time_Flag = 'Y';

  //?USER: Process Data record

  CASE;

  // IF WRK.First Time Flag is Yes
  IF WRK.First_Time_Flag = 'Y';

  // WRK.First Time Flag = CND.NO
  WRK.First_Time_Flag = 'N';

  // IF *OTHERWISE
  IF *OTHERWISE;

  CASE;

  // IF DB1.Kill Day Status is yes
  IF DB1.Kill_Day_Status = 'Y';

  // PAR.Kill Date = DB1.Plant Date of Last Order
  PAR.Kill_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

  ENDIF;

 }

 //? Look for closest date (rst/asc) and time (pos./desc.)   9/25/02
 //?****  OLD Cold scale -- comment on  06/04/04 again on 10/26/04
 //?****  NEW Trolley Tracking Processing    06/04/04  uncomment 10/26/04
 // Call program Rtv Close Trlly 4 OMS XF.
 CALL PROGRAM(Rtv Close Trlly 4 OMS XF) ('PLEWXFR');
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Kill_Date);
 PARAMETER(LCL.PT_Tattoo_Number);
 PARAMETER(WRK.Production_Date_UPL);
 PARAMETER(WRK.Production_Time_UPL);

 //?If time is before 6:45, go back one day and set time to 23:59:59
 CASE;

 // IF LCL.PT Tattoo Number is EQ 0
 IF LCL.PT_Tattoo_Number = *ZERO;

 // AND DB1.PT Offset Prod Time is Before 6:45 am
 AND DB1.PT_Offset_Prod_Time < 064500;

 // LCL.PT Offset Prod Date = DB1.PT Offset Prod Date + CON.-1 *DAYS
 LCL.PT_Offset_Prod_Date = DATEINCR(DB1.PT_Offset_Prod_Date '-1' 'DY' 1111110 'NONE' 'N'
 1);

 // LCL.Production Date USR = LCL.PT Offset Prod Date
 LCL.Production_Date_USR = LCL.PT_Offset_Prod_Date;

 EXECUTE FUNCTION(RTV Kill Dt w/Prd Dt   RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1301549;
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Production_Date_USR);
 PARAMETER(LCL.Kill_Date);
 {
  //?USER: Initialize routine

  // WRK.First Time Flag = CND.Yes
  WRK.First_Time_Flag = 'Y';

  //?USER: Process Data record

  CASE;

  // IF WRK.First Time Flag is Yes
  IF WRK.First_Time_Flag = 'Y';

  // WRK.First Time Flag = CND.NO
  WRK.First_Time_Flag = 'N';

  // IF *OTHERWISE
  IF *OTHERWISE;

  CASE;

  // IF DB1.Kill Day Status is yes
  IF DB1.Kill_Day_Status = 'Y';

  // PAR.Kill Date = DB1.Plant Date of Last Order
  PAR.Kill_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

  ENDIF;

 }

 // WRK.Production Date UPL = CVTVAR(LCL.PT Offset Prod Date)
 WRK.Production_Date_UPL = CVTVAR(LCL.PT_Offset_Prod_Date);

 // WRK.Production Time UPL = CVTVAR(CON.235959)
 WRK.Production_Time_UPL = CVTVAR(235959);

 // Call program Rtv Close Trlly 4 OMS XF.
 CALL PROGRAM(Rtv Close Trlly 4 OMS XF) ('PLEWXFR');
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Kill_Date);
 PARAMETER(LCL.PT_Tattoo_Number);
 PARAMETER(WRK.Production_Date_UPL);
 PARAMETER(WRK.Production_Time_UPL);

 //?Go back one more day, in case of weekend.
 CASE;

 // IF LCL.Tattoo Number UPL EQ WRK.Blank 6 USR
 IF LCL.Tattoo_Number_UPL = WRK.Blank_6_USR;

 // LCL.PT Offset Prod Date = LCL.PT Offset Prod Date + CON.-1 *DAYS
 LCL.PT_Offset_Prod_Date = DATEINCR(LCL.PT_Offset_Prod_Date '-1' 'DY' 1111110 'NONE' 'N'
 1);

 // LCL.Production Date USR = LCL.PT Offset Prod Date
 LCL.Production_Date_USR = LCL.PT_Offset_Prod_Date;

 EXECUTE FUNCTION(RTV Kill Dt w/Prd Dt   RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1301549;
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Production_Date_USR);
 PARAMETER(LCL.Kill_Date);
 {
  //?USER: Initialize routine

  // WRK.First Time Flag = CND.Yes
  WRK.First_Time_Flag = 'Y';

  //?USER: Process Data record

  CASE;

  // IF WRK.First Time Flag is Yes
  IF WRK.First_Time_Flag = 'Y';

  // WRK.First Time Flag = CND.NO
  WRK.First_Time_Flag = 'N';

  // IF *OTHERWISE
  IF *OTHERWISE;

  CASE;

  // IF DB1.Kill Day Status is yes
  IF DB1.Kill_Day_Status = 'Y';

  // PAR.Kill Date = DB1.Plant Date of Last Order
  PAR.Kill_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

  ENDIF;

 }

 // WRK.Production Date UPL = CVTVAR(LCL.PT Offset Prod Date)
 WRK.Production_Date_UPL = CVTVAR(LCL.PT_Offset_Prod_Date);

 // WRK.Production Time UPL = CVTVAR(CON.235959)
 WRK.Production_Time_UPL = CVTVAR(235959);

 // Call program Rtv Close Trlly 4 OMS XF.
 CALL PROGRAM(Rtv Close Trlly 4 OMS XF) ('PLEWXFR');
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Kill_Date);
 PARAMETER(LCL.PT_Tattoo_Number);
 PARAMETER(WRK.Production_Date_UPL);
 PARAMETER(WRK.Production_Time_UPL);

 ENDIF;

 ENDIF;

 //?****  END
 //?Tattoo not found then ** else CHANGE the record
 CASE;

 // IF LCL.PT Tattoo Number is EQ 0
 IF LCL.PT_Tattoo_Number = *ZERO;

 //?Tattoo not found then ** else CHANGE the record
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?HPE Tattoo Info  and  HPS Farm Info
 DO;

 // Call program Rtv Tattoo Trace 2 HPE XF.
 CALL PROGRAM(Rtv Tattoo Trace 2 HPE XF) ('PKYUXFR');
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Kill_Date);
 PARAMETER(LCL.PT_Tattoo_Number);
 PARAMETER(LCL.PT_Producer_Farm_Code);
 PARAMETER(LCL.PT_Producer_Farm_Name);
 PARAMETER(LCL.PT_Source_Type);
 PARAMETER(LCL.PT_Source_Code);
 PARAMETER(LCL.PT_Source_Code_Desc);
 PARAMETER(LCL.PT_Producer_Location_Code);
 PARAMETER(LCL.PT_Producer_Farm_City);
 PARAMETER(LCL.PT_Producer_Farm_State);
 PARAMETER(LCL.PT_Genetic_Code);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Code);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Name);
 PARAMETER(LCL.Tattoo_GN_Description);
 PARAMETER(LCL.Gender_Code);

 ENDDO;

 EXECUTE FUNCTION(RTV State Description  RT) TYPE(RTVOBJ) FILE(CAACREP)          AC1227485;
 PARAMETER(LCL.PT_Producer_Farm_State);
 PARAMETER(LCL.PT_Producer_Farm_State_Nm);
 PARAMETER(NLL.Record_Status);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(Rtv/Crt Farm Site Sum RT) TYPE(RTVOBJ) FILE(POB3CPP)           AC1646447;
 PARAMETER(DB1.PT_Warehouse_ID_Code);
 PARAMETER(DB1.PT_Prod_Date_YYYYMMDD);
 PARAMETER(DB1.PT_Shift_Number);
 PARAMETER(LCL.Address_Number_6A);
 PARAMETER(LCL.PT_Producer_Location_Code);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Code);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Name);
 PARAMETER(LCL.PT_Producer_Farm_Name);
 PARAMETER(LCL.PT_Producer_Farm_City);
 PARAMETER(LCL.PT_Producer_Farm_State);
 PARAMETER(LCL.PT_Producer_Farm_State_Nm);
 {
  //?USER: Processing if Data record not found

  EXECUTE FUNCTION(Crt Farm Site Summary CR) TYPE(CRTOBJ) FILE(POB3CPP)           AC1646307;
  PARAMETER(PAR.FS_Warehouse_ID_Code);
  PARAMETER(PAR.FS_Prod_Date_YYYYMMDD);
  PARAMETER(PAR.FS_Shift_Number);
  PARAMETER(PAR.FS_Producer_Farm_Code);
  PARAMETER(PAR.FS_Producer_Location_Code);
  PARAMETER(PAR.FS_Producer_Cell_Mgr_Code);
  PARAMETER(PAR.FS_Producer_Cell_Mgr_Name);
  PARAMETER(PAR.FS_Producer_Farm_Name);
  PARAMETER(PAR.FS_Producer_Farm_City);
  PARAMETER(PAR.FS_Producer_Farm_State);
  PARAMETER(PAR.FS_Producer_Farm_State_Nm);
  PARAMETER(*ZERO);
  PARAMETER(*BLANK);
  PARAMETER(*BLANK);
  PARAMETER(*ZERO);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*JOB
    PAR.Job_Name = JOB.*JOB;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 ENDIF;

 CASE;

 // IF LCL.PT Tattoo Number is GT 0
 IF LCL.PT_Tattoo_Number > *ZERO;

 EXECUTE FUNCTION(Chg Product Trace     CH) TYPE(CHGOBJ) FILE(POB2CPP)           AC1646386;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.PT_Serial_Number);
 PARAMETER(DB1.PT_Prod_Date_YYYYMMDD);
 PARAMETER(DB1.PT_Production_Time);
 PARAMETER(LCL.PT_Tattoo_Number);
 PARAMETER(LCL.PT_Source_Type);
 PARAMETER(LCL.PT_Source_Code);
 PARAMETER(LCL.PT_Source_Code_Desc);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Code);
 PARAMETER(LCL.PT_Producer_Cell_Mgr_Name);
 PARAMETER(LCL.PT_Producer_Farm_Code);
 PARAMETER(LCL.PT_Producer_Location_Code);
 PARAMETER(LCL.PT_Producer_Farm_Name);
 PARAMETER(LCL.PT_Producer_Farm_City);
 PARAMETER(LCL.PT_Producer_Farm_State);
 PARAMETER(LCL.PT_Producer_Farm_State_Nm);
 PARAMETER(LCL.PT_Genetic_Code);
 PARAMETER(LCL.Tattoo_GN_Description);
 PARAMETER(LCL.Gender_Code);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(DB1.PT_WIP_Dump_Production_Dt);
 PARAMETER(DB1.PT_WIP_Dump_Production_Tm);
 PARAMETER(DB1.PT_WIP_Dump_Production_Sh);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*JOB
   PAR.Job_Name = JOB.*JOB;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 // PAR.Count USR = PAR.Count USR + CON.1
 PAR.Count_USR = PAR.Count_USR + 1;

 //?Update array with kill date to calc kill to cut average in calling rtn
 EXECUTE FUNCTION(UPD Kill Date to Cut  RT) TYPE(RTVOBJ) ARRAY(ARR_Kill_Dates_KilAC1674888;
 PARAMETER(LCL.Kill_Date);
 {
  //?USER: Processing if Data record not found

  EXECUTE FUNCTION(CRT Kill Date to Cut  CR) TYPE(CRTOBJ) ARRAY(ARR_Kill_Dates_KilAC1674886;
  PARAMETER(PAR.Kill_Date);
 }

 ENDIF;

 // IF *OTHERWISE
 IF *OTHERWISE;

 QUIT;

 ENDIF;

}


//?Calculate Kill to Cut avgs for any kill dates matched to Ttts 9/10/03
EXECUTE FUNCTION(Rtv Kill date to Cut  RT) TYPE(RTVOBJ) ARRAY(ARR_Kill_Dates_KilAC1674890;
{
 //?USER: Process Data record

 CASE;

 // IF DB1.Kill Date is GT 0
 IF DB1.Kill_Date > *ZERO;

 // Call program Upd Kill Date to Cut   XF.
 CALL PROGRAM(Upd Kill Date to Cut   XF) ('PLDWXFR');
 PARAMETER(DB1.Kill_Date);

 ENDIF;

}


//?Update PT closest 4 farm codes, per offset time        4/11/03
// LCL.Date 8.0 USR = CON.*ZERO
LCL.Date_8_0_USR = *ZERO;

// Call program Zzz Upd Closest-P/SCL XF.
SBMJOB;
CALL PROGRAM(Zzz Upd Closest-P/SCL XF) ('PBJCXFR');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.PT_Serial_Number);
PARAMETER(PAR.PT_From_FG_Serial_Nbr);
SBMJOBOVR JOB(COLDSCALE2);
SBMJOBOVR JOBD(*USRPRF);
SBMJOBOVR JOBQ(QPGMR);
SBMJOBEND;

ENDIF;

//?RMC 11/23/05 Added co to completion msg
EXECUTE FUNCTION(SndMsg Prod Trace MtchIF) TYPE(EXCINTFUN)                      AC1666652;
PARAMETER(LCL.Company_Number);
PARAMETER(PAR.PT_Serial_Number);
PARAMETER(LCL.Count_USR);
{
 //?Execute internal function

 EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
 PARAMETER(PAR.Company_Number);
 PARAMETER('PRODTRACE');
 PARAMETER(PAR.System_Value_Alpha);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 // WRK.DL List ID = PAR.System Value Alpha
 WRK.DL_List_ID = PAR.System_Value_Alpha;

 // Retrieve message - 'Product Trace match complete for production co/date &3 &1. Records matched:
 PAR.Office_Message_USR = RTVMSG(USR3253);
 PARAMETER(PAR.PT_Prod_Date_YYYYMMDD);
 PARAMETER(PAR.Count_USR);
 PARAMETER(PAR.Company_Number);

 // Call program SND Pager Msg (MPLUS) UP.
 CALL PROGRAM(SND Pager Msg (MPLUS) UP) ('POMSUPC');
 PARAMETER(WRK.DL_List_ID);
 PARAMETER(PAR.Office_Message_USR);

 ENDIF;

}


