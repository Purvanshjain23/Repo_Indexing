     H/TITLE UPL DP FUTURE  FOR IHUB FILE FROM SPREADSHEET USING DPACTUAL.DTT
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : COOL:2E  Version:  1000
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 09/16/14  Time  : 15:00:00
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
     M* 10/26/18  Danny Nguyen    (R13981-Spanish Desc on Export Docs)
     M* - Recompile only due to Item Default Extsn file change.
     M* 02/05/18  Danny Nguyen    (R12488-DP Sub Brand)
     M* - Recompile only due to DP Product (PBBNREP) file change.
      *================================================================
     FDPFUTUREIF  E                    DISK
      * UPLOAD DP FUTURE DEMAND FOR IHUB FILE
      *
     FPDNIREL3IF  E           K        DISK
      * CUST
     FOME5REL1IF  E           K        DISK
      * COUNTRIES
     FPBBNREL2IF  E           K        DISK
      * DP PRODUCT - DONT CREATE ACTUAL IF PRODUCT NOT FOUND HERE
     FCABBREL1IF  E           K        DISK
      * CUSTOMER    - GET CUSTOMER NAME
     FCAEOREL3IF  E           K        DISK
      * CUSTOMER COMPANY   - GET SALESPERSON IF NEW PROD LOCAITON
     FPDJEREL1IF  E           K        DISK
      * SALES ROUTE - GET SALES ROUTE NAME
     FPBBPREL2IF  E           K        DISK
      * DP PRODUCT LOCATION - GET SALESPERSON
     FPBBTREL1IF  E           K        DISK
      * ITEM DFT EXTENSION FOR FORECAST IN DP STS
      *
     FPBBVCPL0UF  E           K        DISK                      A
      * RTV : DP FUTURE ORDERS FOR IHUB FOR BI SALES FORECAST REVIEW
      *
     C           *ENTRY    PLIST
     C                     PARM           P1      6         PROFILE
     C                     PARM           P2      4         SCENARIO
     C           P1        CABEQ' '       END
     C           P2        CABEQ' '       END
      * DP FUTURE
     C           KVBPR     KLIST
     C                     KFLD           BVTAAA
     C                     KFLD           BVTBAA
     C                     KFLD           BVFWC7
     C                     KFLD           BVTEAA
     C                     KFLD           BVABNB
     C                     KFLD           BVZ9NY
     C                     KFLD           BVAODX
     C                     KFLD           BVF0C7           SHIP TO
      * DP PROD LOCAITON
     C           KBBPR     KLIST
     C                     KFLD           BVFWC7
     C                     KFLD           BVTEAA
      * SET SYSTEM OF RECORD AND DATE STAMP FOR THIS PROCESS
      *
     C                     MOVEL'AS400'   BVS9AA              SYS OF RECORD
     C                     MOVEL'Demand'  BVTAAA              PROFILE
     C                     MOVEL'Base'    BVTBAA              SCNENARIO
     C                     Z-ADD1         BVABNB              HISTORY TYPE
     C                     Z-ADD2         BVZ9NY              PERIOD TYPE
      * DATE STAMP YYYYMMDDHHMMSS
     C                     CALL 'PBN2UPC'
     C                     PARM           BVANDX
      *
     C*  READ FILE SQL TO AS400
      *
     C           *IN90     DOWEQ'0'
     C                     READ VIEWFMT                  90*
     C           *IN90     IFEQ '0'
      *
     C* SKIP ITEM IF NOT IN DP PRODUCT
      *
     C           OMHGCD    CHAIN@BNRETL              56
     C           *IN56     IFEQ '1'
     C                     GOTO SKIPIT
     C                     END
      *
     C* SKIP ITEM IF FORECAST IN DP = NO
      *
     C           OMHGCD    CHAIN@BTRETK              55
     C           *IN55     IFEQ '0'
     C           BTALSC    ANDEQ'N'
     C                     GOTO SKIPIT
     C                     END
      *
     C                     Z-ADDOMHGCD    BVFWC7              PRODUCT
     C                     Z-ADDREQSHP    BVAODX              REQ SHIP
     C                     Z-ADDBEBKC7    BVF0C7           SHIP TO
     C*
     C*  DONT CREATE RCD FOR C CLASS CUSTS
     C*
     C                     MOVE ' '       NIH9ST
     C           BBBTC7    CHAIN@NIRETO              50
     C           *IN50     IFEQ '0'
     C           NIH9ST    IFEQ 'C'
     C           NIH9ST    OREQ ' '
     C* DO C CLASS 9-25    GOTO SKIPIT                     ** DONT ADD C CLASS *
     C                     Z-ADD99999     BBBTC7
     C                     END
     C                     END
     C* FORMAT CHANNEL
     C                     MOVE *BLANKS   LOCA   14
     C           BBBTC7    IFLT 100000
     C                     MOVE BBBTC7    CUST5   5           CUST
     C*                    MOVELCUST5     LOCA                CUST|TYP|REG
     C           CUST5     CAT  '-':0     LOCA                CHANNEL/LOCATION
     C                     ELSE
     C           BBBTC7    IFLT 1000000
     C                     MOVE BBBTC7    CUST6   6
     C*                    MOVELCUST6     LOCA                CUST|TYP|REG
     C           CUST6     CAT  '-':0     LOCA                CHANNEL/LOCATION
     C                     ELSE
     C           BBBTC7    IFLT 10000000
     C                     MOVE BBBTC7    CUST7   7
     C*                    MOVELCUST7     LOCA                CUST|TYP|REG
     C           CUST7     CAT  '-':0     LOCA                CHANNEL/LOCATION
     C                     END
     C                     END
     C                     END
     C*
     C* ADDITIONAL TRANSLATION FOR EXPORT ORDERS
     C*   ***  DO   LEAVE EX AND USA AS VALID COMBINATION 8/7/14-- 09/16/14
     C           TYPE      IFEQ 'EX'
     C           REGION    IFEQ 'USA'
     C*                    MOVEL'FP'      TYPE                FROM CUST
     C*                    MOVEL'NE'      REGION
     C                     ELSE
     C                     MOVELREGION    E5KXCD
     C           E5KXCD    CHAIN@E5REB8              50       VALID COUNTRY?
     C           *IN50     IFEQ '1'                           NOT A COUNTRY
     C                     MOVEL'USA'     REGION
     C                     END
     C                     END
     C                     END
     C*
     C           REGION    IFEQ 'CAN'
     C           TYPE      ANDNE'EX'
     C                     MOVEL'EX'      TYPE
     C                     END
     C*
     C           BBBTC7    IFEQ 99999
     C           TYPE      ANDEQ'EX'
     C                     MOVE 'EXP'     REGION
     C                     END
     C*
     C*
     C*                    MOVELTYPE      TYPRG5  5           TYPE|REGION
     C           TYPE      CAT  '-':0     TYPRG6  6           TYPE-REGION
     C                     MOVE REGION    TYPRG6              TYPE-REGION
     C           LOCA      CAT  TYPRG6:0  LOCA                CHANNEL/LOCATION
     C                     MOVELLOCA      BVTEAA              CHANNEL/LOCATION
     C*
     C*  OUTPUT OTHER FIELDS
     C*
     C                     Z-ADDREQSHP    BVAPDX
     C                     CALL 'PBPOXFR'
     C                     PARM           RTNCDE
     C                     PARM           BVAPDX                 EO WEEK DATE
      *
     C                     MOVE BNUYNA    BVUYNA                 PROD DESC
     C                     MOVE BNCFU1    BVCFU1                 TYPE
     C                     MOVE BNCGU1    BVCGU1                 GROUP
     C                     MOVE BNCHU1    BVCHU1                 CLASS
     C                     MOVE BNTCAA    BVTCAA                 UOM
     C                     MOVE BNCIU1    BVCIU1                 FORM
     C                     MOVE BNCJU1    BVCJU1                 BRAND
     C                     MOVE BBBTC7    BVFZC7                 PARENT CUST
      * SALES # AND NAME
     C           KBBPR     CHAIN@BPRETM              61
     C           *IN61     IFEQ '0'
     C                     MOVELBPTIAA    BVTIAA            SALES NUMBER
     C                     MOVELBPCWU1    BVCWU1            SALES  NAME
     C                     ELSE
     C                     MOVEL*BLANKS   BVTIAA            SALES NUMBER
     C                     MOVEL*BLANKS   BVCWU1            SALES  NAME
     C           BBBTC7    IFNE 99999                       IF NE 99999
     C           BBBTC7    CHAIN@EOREU0              62
     C           *IN62     IFEQ '0'
     C                     MOVELEOR4CD    BVTIAA
     C           EOR4CD    CHAIN@JEREWF              63
     C           *IN63     IFEQ '0'
     C                     MOVELJEMZNA    BVCWU1            SALES  NAME
     C                     END
     C                     END
     C                     END                              NE 99999
     C                     END
      * PARENT NAME
     C           BBBTC7    CHAIN@BBREE9              60
     C           *IN60     IFEQ '0'
     C                     MOVELBBAYTX    BVCKU1            PARENT NAME
     C                     ELSE
     C                     MOVE *BLANKS   BVCKU1
     C                     MOVELBBBTC7    BVCKU1
     C                     END
      * USER: Process Data record
     C*
     C           KVBPR     CHAIN@BVCPT1              91
     C           *IN91     IFEQ '1'
     C                     Z-ADDSUMQTY    BVACNB              QTY
     C                     WRITE@BVCPT1
     C                     ELSE
     C                     ADD  SUMQTY    BVACNB
     C                     UPDAT@BVCPT1
     C                     END
      *
      * CREATE LOCATION AND PRODUCT LOCATION IF NEW
      *
     C                     CALL 'PBO9XFR'
     C                     PARM           RTNCDE  7
     C                     PARM           BVFWC7                  PRODUCT
     C                     PARM           BVTEAA                  LOCATION
     C                     PARM           BBBTC7                  CUST
     C                     PARM           TYPRG6                  TYPE-REG
     C           SKIPIT    TAG
     C                     END
     C                     END
     C           END       TAG
     C                     SETON                     LR
