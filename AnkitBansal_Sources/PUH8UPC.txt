/*********************************************************************/
/* PROGRAM : PUH8UPC                                                 */
/* DESC    : EXC PRT OVRDE AFR VAR CL  EXECUTE USER PROGRAM          */
/* DATE    : 06/20/2018                                              */
/* PROJECT : R12926 - ABSORBED FREIGHT RATE OVERRIDE                 */
/* BY      : DANNY NGUYEN                                            */
/* PURPOSE : Call SEQUEL to print Absorbed Freight Rate Override     */
/*           Variance report as excel & send via ESEND.              */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  CHANGE DESCRIPTION                                   */
/* -------- --- ---------------------------------------------------- */
/* MM/DD/YY xxx Project ID. Desc                                     */
/* 06/28/22 E.L 82816 MONTHLY REPORT ADDED                           */
/*********************************************************************/

             PGM        PARM(&FRDATEA &EMAIL)

             DCL        VAR(&FRDATEA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&FRDATE)  TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&BEGPER)  TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&TODATEA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&TODATE)  TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&RTNLIB)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&EMAIL)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&EMLMSG)  TYPE(*CHAR) LEN(100) +
                          VALUE('Absorbed Freight Rate Override +
                          Variance Report')

             CHGVAR     VAR(&FRDATE) VALUE(&FRDATEA)

    /* If PDLHCPP Return Library Not PRKFLIB Then Set 'Test' in Email Msg */
             RTVOBJD    OBJ(PDLHCPP) OBJTYPE(*FILE) RTNLIB(&RTNLIB)
             IF         COND(&RTNLIB *NE 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&EMLMSG) VALUE(&EMLMSG *BCAT '- TEST')
             ENDDO

/*-------------------------------------------------------------------*/
/* Create Excel Spreadsheet with SEQUEL Viewpoint and email to       */
/* receipient.                                                       */
/*-------------------------------------------------------------------*/
             EXECUTE    VIEW(ABSFRTOVR) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&EMLMSG) +
                          SETVAR((&FRDATE &FRDATEA))

    /*-------------------------------------------------------------------*/
    /* &FRDATE = TODAY = DAY OF THE REPORT                               */
    /* CHECK IF TODAY = PERIOD END - IF SO RUN THE MONTHLY REPORT        */
    /*-------------------------------------------------------------------*/
    /* &FRDATE IS NOW &TODATE  -   &FRDATEA IS NOW &TODATEA              */
    /*-------------------------------------------------------------------*/
             CHGVAR     VAR(&TODATEA) VALUE(&FRDATEA)
             CHGVAR     VAR(&TODATE)  VALUE(&FRDATE)
             CALL PUVZXFR ('' &BEGPER)
    /*-------------------------------------------------------------------*/
    /* &BEGPER IS NOW &FRDATE  -                                         */
    /*-------------------------------------------------------------------*/
        IF  COND(&BEGPER *NE 0) THEN(DO)
             CHGVAR     VAR(&FRDATEA) VALUE(&BEGPER)
             CHGVAR     VAR(&FRDATE ) VALUE(&BEGPER)
            /*-------------------------------------------------------------*/
            /* CREATE EXCEL SPREADSHEET WITH SEQUEL VIEWPOINT AND EMAIL TO */
            /* RECIPIENT. M O N T H L Y                                    */
            /*-------------------------------------------------------------*/
             EXECUTE    VIEW(ABSFRTOVRM) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&EMLMSG) +
                          SETVAR((&FRDATE &FRDATEA) (&TODATE &TODATEA))

        ENDDO
    /*-------------------------------------------------------------------*/

 ENDPGM:
             ENDPGM
