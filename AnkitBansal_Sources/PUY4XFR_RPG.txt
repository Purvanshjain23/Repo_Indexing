     H/TITLE Prt WIM 846 Raw Data  XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 05/02/23  Time  : 14:13:28
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FECP780L2  IF   E           K DISK
      * RSQ : WIM EDI Whs InvInqAdv HDR Adj Dte/TP/Sggte
      *
     FCADPREL1  IF   E           K DISK
      * RTV : System Values             Retrieval index       NV
      *
     FECP782L2  IF   E           K DISK
      * RSQ : WIM EDI Whs InvInqAdv NAM Sggte#/NameType/IDCode
      *
     FCAADREL1  IF   E           K DISK
      * RTV : Warehouse Codes           Retrieval index       NV
      *
     FPDKMREL1  IF   E           K DISK
      * RTV : Company Values            Retrieval index
      *
      * Long constants
     D @CN#            S              6    DIM(07)CTDATA PERRCD(1)
     D @CN             S             25    DIM(07) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  YL0001         S              8  0
     D  WN0001         S              1
     D  WN0002         S             50
     D  WN0003         S             50
     D  YL0002         S             50
     D  ZQ             S              5  0
     D  YL0003         S             10
     D  YN0001         S             10
     D  WQSA01         S                   LIKE(WAHHSC)
     D  YL0004         S              3
     D  WQSC01         S                   LIKE(WCH9NY)
     D  WQSC02         S                   LIKE(WCTYPC)
     D  YL0005         S              3  0
     D  YL0006         S             50
     D  YL0007         S             30
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZADFMF         S             10
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
      * Message data for 'Exe Sequel EDI846WIM RwDt'
      * EDI SURROGATE NUMBER
     D  ZA0001                 1      5P 0
      * Email Address
     D  ZA0002                 6     55
      * Message Line 1
     D  ZA0003                56     85
     I@P780MO
      * WIM EDI Whs InvInqAdv HDR Adj Dte/TP/Sggte
      * Renamed input format fields
     I              CVH9NY                      WAH9NY
     I              CVHPAA                      WAHPAA
     I              CVA0ST                      WAA0ST
     I              CVXVAA                      WAXVAA
     I              CVXWAA                      WAXWAA
     I              CVIYU1                      WAIYU1
     I              CVHHSC                      WAHHSC
     I              CVHISC                      WAHISC
     I              CVARTH                      WAARTH
      *
     I@DPRETD
      * System Values             Retrieval index       NV
      * Renamed input format fields
     I              DPDOCD                      WBDOCD
     I              DPAUNA                      WBAUNA
     I              DPI5ST                      WBI5ST
     I              DPBXTX                      WBBXTX
     I              DPM8NB                      WBM8NB
     I              DPUVST                      WBUVST
     I              DPUWST                      WBUWST
     I              DPUXST                      WBUXST
     I              DPVSST                      WBVSST
     I              DPAATM                      WBAATM
     I              DPAYNA                      WBAYNA
     I              DPA0NA                      WBA0NA
     I              DPAXDT                      WBAXDT
      *
     I@P782MZ
      * WIM EDI Whs InvInqAdv NAM Sggte#/NameType/IDCode
      * Renamed input format fields
     I              CXH9NY                      WCH9NY
     I              CXTYPC                      WCTYPC
     I              CXAMEX                      WCAMEX
     I              CXDCDQ                      WCDCDQ
     I              CXDCDE                      WCDCDE
     I              CXDD1X                      WCDD1X
     I              CXDD2X                      WCDD2X
     I              CXITYX                      WCITYX
     I              CXTATE                      WCTATE
     I              CXIPXX                      WCIPXX
     I              CXWFAA                      WCWFAA
      *
     I@ADREAO
      * Warehouse Codes           Retrieval index       NV
      * Renamed input format fields
     I              ADAJCD                      WDAJCD
     I              ADF8NA                      WDF8NA
     I              ADACNA                      WDACNA
     I              ADADNA                      WDADNA
     I              ADAENA                      WDAENA
     I              ADAJNA                      WDAJNA
     I              ADBTTX                      WDBTTX
     I              ADAOCD                      WDAOCD
     I              ADBGCD                      WDBGCD
     I              ADVHST                      WDVHST
     I              ADMPNA                      WDMPNA
     I              ADWPST                      WDWPST
     I              ADXUST                      WDXUST
     I              ADT0ST                      WDT0ST
     I              ADT1ST                      WDT1ST
     I              ADDBNB                      WDDBNB
     I              ADT2ST                      WDT2ST
     I              ADT3ST                      WDT3ST
     I              ADT4ST                      WDT4ST
     I              ADT6ST                      WDT6ST
     I              ADBWC3                      WDBWC3
     I              ADBTC3                      WDBTC3
     I              ADBUC3                      WDBUC3
     I              ADBVC3                      WDBVC3
     I              ADFCAA                      WDFCAA
     I              ADRQSX                      WDRQSX
     I              ADRRSX                      WDRRSX
     I              ADRSSX                      WDRSSX
     I              ADRTSX                      WDRTSX
     I              ADT7ST                      WDT7ST
     I              ADT8ST                      WDT8ST
     I              ADRNSX                      WDRNSX
     I              ADROSX                      WDROSX
     I              ADRPSX                      WDRPSX
     I              ADUVST                      WDUVST
     I              ADUWST                      WDUWST
     I              ADUXST                      WDUXST
     I              ADVSST                      WDVSST
     I              ADAATM                      WDAATM
     I              ADAYNA                      WDAYNA
     I              ADA0NA                      WDA0NA
     I              ADAXDT                      WDAXDT
      *
     I@KMREHC
      * Company Values            Retrieval index
      * Renamed input format fields
     I              KMAIC3                      WEAIC3
     I              KMV8CD                      WEV8CD
     I              KMAUNA                      WEAUNA
     I              KMI5ST                      WEI5ST
     I              KMBXTX                      WEBXTX
     I              KMM8NB                      WEM8NB
     I              KMUVST                      WEUVST
     I              KMUWST                      WEUWST
     I              KMUXST                      WEUXST
     I              KMVSST                      WEVSST
     I              KMAATM                      WEAATM
     I              KMAYNA                      WEAYNA
     I              KMA0NA                      WEA0NA
     I              KMAXDT                      WEAXDT
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Prt WIM 846 Raw Data  XF
      * NOTE: JS 'INVRSTEDIW' calls this program.
      * Get System Date       US - /UT User Source  * 
      * Get System Date - CCYYMMDD
     c                   eval      YL0001 = *date
      * Prt WIM 846 Raw Data  RT - WIM EDI Whs InvInqAdv HDR  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Prt WIM 846 Raw Data  RT - WIM EDI Whs InvInqAdv HDR  * 
      *================================================================
      *
     C                   EVAL      WN0001 = ' '                                 EDI-Record Proc
     C                   EVAL      WN0002 = ' '                                 EDI 846 Error D
     C                   EVAL      WN0003 = ' '                                 Email Subject U
      *
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   Z-ADD     0             ZQ
     C     @CN(001)      CAT(P)    'le:':ZQ      YL0002                         Email Subject U
      * RTV Data Libraries     RT - System Values  * In TEST or PROD
     C                   EXSR      SBRVGN
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WQSA01                         BAI04 Adjustmen
      * Setup key
     C                   Z-ADD     YL0001        WQSA01                         BAI04 Adjustmen
      * Establish starting position
     C     KRSSA         SETLL     @P780MO                                      *
     C     KRSSA         READE     @P780MO                                90    *
      * Data record not found
     C   90              MOVEL     'USR5281'     W0RTN
      * USER: Process Data record
      * Send raw data as is even if it is 'Error'.
      * Rtv Warehouse Code    RT - WIM EDI Whs InvInqAdv NAM  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SCRVGN
      * RTV Shipping Co        RT - Warehouse Codes  * 
     C                   EXSR      SDRVGN
      * RTV Alpha Value        RT - Company Values  * EDI846CMP
     C                   EXSR      SERVGN
     C                   Z-ADD     1             ZQ
     C     @CN(005)      CAT(P)    YL0004:ZQ     YL0007                         Message Line 1
      * If Not PROD Then Append 'TEST' to Subject Line.
      * CASE: LCL.Library List Code is Not PRKFLIB
     C                   IF        YL0003 <> @CN(006)
     C                   Z-ADD     1             ZQ
     C     YL0007        CAT(P)    @CN(007):ZQ   YL0007                         Message Line 1
     C                   END                                                    *FI
      * Setup message data for message
     C                   Z-ADD     WAH9NY        ZA0001                         EDI SURROGATE N
     C                   MOVEL     YL0006        ZA0002                         Email Address
     C                   MOVEL     YL0007        ZA0003                         Message Line 1
      *
      * Execute message
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   CALL      'Y2EXMCC'                            90      *
     C                   PARM      *BLANK        W0RTN                          Return code
     C                   PARM      'USR5315'     ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSGF = ' '
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   END
      *
      * Error detected during execution
     C                   IF        W0RTN <> ' '
     C                   SETON                                        99        *
     C                   END
      *
     C     KRSSA         READE     @P780MO                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * RTV Data Libraries     RT - System Values  * In TEST or PROD
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KPSSB         KLIST
     C                   KFLD                    WBDOCD                         System Value Co
      * Setup key
     C                   EVALR     WBDOCD = ' '                                 System Value Co
     C                   MOVEL     'DTALIB'      WBDOCD                         System Value Co
      * Establish starting position
     C     KPSSB         SETLL     @DPRETD                                      *
     C                   READ      @DPRETD                                90    *
      * Data record not found
     C   90              MOVEL     'USR0759'     W0RTN
      * USER: Process Data record
      * CASE: DB1.System Value Code is Data File Library
     C                   DOW       NOT *IN90
     C                   IF        WBDOCD = @CN(002)
     C                   MOVEL     WBBXTX        YL0003                         Library List Co
     C                   ELSE
      * CASE: DB1.System Value Code is History File Library
     C                   IF        WBDOCD = @CN(003)
     C                   MOVEL     WBBXTX        YN0001                         @Library List C
     C                   GOTO      SBEXIT                                       *QUIT
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   READ      @DPRETD                                90    *
     C                   ENDDO
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Rtv Warehouse Code    RT - WIM EDI Whs InvInqAdv NAM  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   EVAL      YL0004 = ' '                                 Warehouse Code
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WQSC01                         EDI SURROGATE N
     C                   KFLD                    WQSC02                         N101-NAME TYPE
      * Setup key
     C                   Z-ADD     WAH9NY        WQSC01                         EDI SURROGATE N
     C                   EVALR     WQSC02 = ' '                                 N101-NAME TYPE
     C                   MOVEL     'WH'          WQSC02                         N101-NAME TYPE
      * Establish starting position
     C     KRSSC         SETLL     @P782MZ                                      *
     C     KRSSC         READE     @P782MZ                                90    *
      * Data record not found
     C   90              MOVEL     'USR5285'     W0RTN
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   MOVEL     WCDCDE        YL0004                         Warehouse Code
     C     KRSSC         READE     @P782MZ                                90    *
     C                   ENDDO
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * RTV Shipping Co        RT - Warehouse Codes  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    WDAJCD                         Warehouse Code
      * Setup key
     C                   MOVEL     YL0004        WDAJCD                         Warehouse Code
      * Establish starting position
     C     KRSSD         CHAIN     @ADREAO                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR0007'     W0RTN
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                   Z-ADD     *ZERO         YL0005                         Shipping Compan
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   Z-ADD     WDBWC3        YL0005                         Shipping Compan
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SERVGN        BEGSR
      *================================================================
      * RTV Alpha Value        RT - Company Values  * EDI846CMP
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSE         KLIST
     C                   KFLD                    WEAIC3                         Company Number
     C                   KFLD                    WEV8CD                         Company Value C
      * Setup key
     C                   Z-ADD     YL0005        WEAIC3                         Company Number
     C                   MOVEL     @CN(004)      WEV8CD                         Company Value C
      * Establish starting position
     C     KRSSE         CHAIN     @KMREHC                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR2221'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     WEBXTX        YL0006                         System Value Al
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WAHHSC                         BAI04 Adjustmen
     C                   Z-ADD     *ZERO         WAARTH                         BAI05 Adjustmen
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBM8NB                         System Value Nu
     C                   Z-ADD     *ZERO         WBAATM                         Job Time
     C                   Z-ADD     *ZERO         WBAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCH9NY                         EDI SURROGATE N
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WDDBNB                         Warehouse Chill
     C                   Z-ADD     *ZERO         WDBWC3                         Shipping Compan
     C                   Z-ADD     *ZERO         WDBTC3                         Accounting Comp
     C                   Z-ADD     *ZERO         WDBUC3                         WHS Sched Prod
     C                   Z-ADD     *ZERO         WDBVC3                         WHS Inventory C
     C                   Z-ADD     *ZERO         WDAATM                         Job Time
     C                   Z-ADD     *ZERO         WDAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WEAIC3                         Company Number
     C                   Z-ADD     *ZERO         WEM8NB                         System Value Nu
     C                   Z-ADD     *ZERO         WEAATM                         Job Time
     C                   Z-ADD     *ZERO         WEAXDT                         Job Date
      * Obtain default message file
     C     *DTAARA       DEFINE    CAMGFLA       ZADFMF
     C                   IN        ZADFMF
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      * Define local work field System Date Nbr USR
     C                   Z-ADD     *ZERO         YL0001
      * Define local work field Email Subject USR
     C                   EVAL      YL0002 = ' '
      * Define local work field Library List Code
     C                   EVAL      YL0003 = ' '
      * Define null work field @Library List Code
     C                   EVAL      YN0001 = ' '
      * Define local work field Warehouse Code
     C                   EVAL      YL0004 = ' '
      * Define local work field Shipping Company
     C                   Z-ADD     *ZERO         YL0005
      * Define local work field Email Address
     C                   EVAL      YL0006 = ' '
      * Define local work field Message Line 1
     C                   EVAL      YL0007 = ' '
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 EDI 846 Error-Inv Reconci
00002 DTALIB
00003 HISLIB
00004 EDI846CMP
00005 WIM EDI 846 Raw Data For
00006 PRKFLIB
00007 - TEST
