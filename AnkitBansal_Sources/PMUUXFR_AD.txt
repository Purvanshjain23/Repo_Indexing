// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMUUXFR
// ?Date: 14.08.2025 Time: 03:44:09
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(BLD Signal Demand BOM RT) TYPE(RTVOBJ) FILE(PDIOREP)           AC1882984;
PARAMETER(PAR.Company_Number);
{
 //?USER: Initialize routine

 EXECUTE FUNCTION(Clr SD BOM Required   DL) TYPE(DLTOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883005;
 EXECUTE FUNCTION(Clr SD BOM RM Option  DL) TYPE(DLTOBJ) ARRAY(ARR_SD_Item_BOM_RMAC1883006;
 // LCL.First Time Flag = CND.Yes
 LCL.First_Time_Flag = 'Y';

 //?USER: Process Data record

 //?FIRST TIME
 CASE;

 // IF LCL.First Time Flag is Yes
 IF LCL.First_Time_Flag = 'Y';

 //?***** Save Item Code
 // LCL.Item Code = DB1.Item Code
 LCL.Item_Code = DB1.Item_Code;

 //?***** Clear Consumed Percent
 // LCL.Consume Priority % = CON.*ZERO
 LCL.Consume_Priority_Percent = *ZERO;

 //?***** Retrieve Item Status
 EXECUTE FUNCTION(Rtv Record Sts        RT) TYPE(RTVOBJ) FILE(OMBYREP)           AC1842965;
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.Record_Status);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

 }

 // LCL.First Time Flag = CND.NO
 LCL.First_Time_Flag = 'N';

 ENDIF;

 //?CHG: Item Code
 CASE;

 // IF DB1.Item Code NE LCL.Item Code
 IF DB1.Item_Code <> LCL.Item_Code;

 //?***** Consume Priority % for RM Options
 // PAR.Consume Priority %
 PAR.Consume_Priority_Percent = 100 - LCL.Consume_Priority_Percent;

 //?*** Build Signal Demand BOM File
 EXECUTE FUNCTION(Bld SD BOM            RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_RMAC1883012;
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.Item_Code);
 PARAMETER(PAR.Consume_Priority_Percent);
 {
  //?USER: Initialize routine

  // LCL.Sequence Number = CON.*ZERO
  LCL.Sequence_Number = *ZERO;

  //?USER: Processing if Data record not found

  //?***** Create Required portion of the BOM
  EXECUTE FUNCTION(BLD SD BOM Required   RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883013;
  PARAMETER(PAR.Company_Number);
  PARAMETER(PAR.Item_Code);
  PARAMETER(1);
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Sequence_Number);
   PARAMETER(DB1.Component_Item_Code);
   PARAMETER(DB1.Production_Yield);
   PARAMETER(DB1.BOM_Type);
   PARAMETER(DB1.Consume_Priority);
   PARAMETER(DB1.Consume_Priority_Percent);
   PARAMETER(DB1.BOM_Pumped_Percent);
   PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
  }

  //?USER: Process Data record

  //?***** Add 1 to the Sequence Number for each RM Option
  // LCL.Sequence Number = LCL.Sequence Number + CON.1
  LCL.Sequence_Number = LCL.Sequence_Number + 1;

  //?***** Create Required portion of the BOM
  EXECUTE FUNCTION(BLD SD BOM Required   RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883013;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(LCL.Sequence_Number);
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Sequence_Number);
   PARAMETER(DB1.Component_Item_Code);
   PARAMETER(DB1.Production_Yield);
   PARAMETER(DB1.BOM_Type);
   PARAMETER(DB1.Consume_Priority);
   PARAMETER(DB1.Consume_Priority_Percent);
   PARAMETER(DB1.BOM_Pumped_Percent);
   PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
  }

  //?***** Create RM Option of the BOM
  EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(LCL.Sequence_Number);
  PARAMETER(DB1.Component_Item_Code);
  PARAMETER(DB1.Production_Yield);
  PARAMETER(DB1.BOM_Type);
  PARAMETER(1);
  PARAMETER(PAR.Consume_Priority_Percent);
  PARAMETER(DB1.BOM_Pumped_Percent);
  PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
 }

 //?***** Clear both arrays before building for new item code.
 EXECUTE FUNCTION(Clr SD BOM Required   DL) TYPE(DLTOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883005;
 EXECUTE FUNCTION(Clr SD BOM RM Option  DL) TYPE(DLTOBJ) ARRAY(ARR_SD_Item_BOM_RMAC1883006;
 //?***** Save new Item Code
 // LCL.Item Code = DB1.Item Code
 LCL.Item_Code = DB1.Item_Code;

 //?***** Retrieve Item Status
 EXECUTE FUNCTION(Rtv Record Sts        RT) TYPE(RTVOBJ) FILE(OMBYREP)           AC1842965;
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.Record_Status);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

 }

 //?***** Initialize
 // LCL.Consume Priority % = CON.*ZERO
 LCL.Consume_Priority_Percent = *ZERO;

 // LCL.BOM Pumped Percent = CON.*ZERO
 LCL.BOM_Pumped_Percent = *ZERO;

 ENDIF;

 //?CRT: BOM Arrays for Active Items Only
 CASE;

 // IF LCL.Record Status is Active
 IF LCL.Record_Status = 'A';

 //?Create Array record for Required portion of BOM
 CASE;

 // IF DB1.BOM Multi-RM Option is Required
 IF DB1.BOM_Multi_RM_Option = *BLANK;

 EXECUTE FUNCTION(Crt SD BOM Required   CR) TYPE(CRTOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883009;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Component_Item_Code);
 PARAMETER(DB1.BOM_Type);
 PARAMETER(DB1.Production_Yield);
 PARAMETER(DB1.Consume_Priority);
 PARAMETER(DB1.Consume_Priority_Percent);
 PARAMETER(DB1.BOM_Pumped_Percent);
 PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
 //?Save Pump Percent for FG Item
 CASE;

 // IF DB1.Item Code EQ DB1.Component Item Code
 IF DB1.Item_Code = DB1.Component_Item_Code;

 // AND DB1.BOM Pumped Percent is GT Zero
 AND DB1.BOM_Pumped_Percent > *ZERO;

 // LCL.BOM Pumped Percent = DB1.BOM Pumped Percent
 LCL.BOM_Pumped_Percent = DB1.BOM_Pumped_Percent;

 ENDIF;

 //?Accumulate the Consume Priority Percent for Required Items
 CASE;

 // IF DB1.BOM Type is Consumed - Meat
 IF DB1.BOM_Type = 'C';

 // LCL.Consume Priority % = LCL.Consume Priority % + DB1.Consume Priority %
 LCL.Consume_Priority_Percent = LCL.Consume_Priority_Percent
 + DB1.Consume_Priority_Percent;

 ENDIF;

 ENDIF;

 //?Create Array for Raw Material Options
 CASE;

 // IF DB1.BOM Multi-RM Option is RM Option
 IF DB1.BOM_Multi_RM_Option = 'O';

 EXECUTE FUNCTION(Crt SD BOM RM Option  CR) TYPE(CRTOBJ) ARRAY(ARR_SD_Item_BOM_RMAC1883010;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Component_Item_Code);
 PARAMETER(DB1.BOM_Type);
 PARAMETER(DB1.Production_Yield);
 PARAMETER(DB1.Consume_Priority);
 PARAMETER(DB1.Consume_Priority_Percent);
 PARAMETER(DB1.BOM_Pumped_Percent);
 PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
 ENDIF;

 ENDIF;

 //?USER: Exit processing

 //?***** Consume Priority % for RM Options
 // PAR.Consume Priority %
 PAR.Consume_Priority_Percent = 100 - LCL.Consume_Priority_Percent;

 //?***** Build BOM for last Item processed
 EXECUTE FUNCTION(Bld SD BOM            RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_RMAC1883012;
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Item_Code);
 PARAMETER(PAR.Consume_Priority_Percent);
 {
  //?USER: Initialize routine

  // LCL.Sequence Number = CON.*ZERO
  LCL.Sequence_Number = *ZERO;

  //?USER: Processing if Data record not found

  //?***** Create Required portion of the BOM
  EXECUTE FUNCTION(BLD SD BOM Required   RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883013;
  PARAMETER(PAR.Company_Number);
  PARAMETER(PAR.Item_Code);
  PARAMETER(1);
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Sequence_Number);
   PARAMETER(DB1.Component_Item_Code);
   PARAMETER(DB1.Production_Yield);
   PARAMETER(DB1.BOM_Type);
   PARAMETER(DB1.Consume_Priority);
   PARAMETER(DB1.Consume_Priority_Percent);
   PARAMETER(DB1.BOM_Pumped_Percent);
   PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
  }

  //?USER: Process Data record

  //?***** Add 1 to the Sequence Number for each RM Option
  // LCL.Sequence Number = LCL.Sequence Number + CON.1
  LCL.Sequence_Number = LCL.Sequence_Number + 1;

  //?***** Create Required portion of the BOM
  EXECUTE FUNCTION(BLD SD BOM Required   RT) TYPE(RTVOBJ) ARRAY(ARR_SD_Item_BOM_ReAC1883013;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(LCL.Sequence_Number);
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Sequence_Number);
   PARAMETER(DB1.Component_Item_Code);
   PARAMETER(DB1.Production_Yield);
   PARAMETER(DB1.BOM_Type);
   PARAMETER(DB1.Consume_Priority);
   PARAMETER(DB1.Consume_Priority_Percent);
   PARAMETER(DB1.BOM_Pumped_Percent);
   PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
  }

  //?***** Create RM Option of the BOM
  EXECUTE FUNCTION(Crt Item BOM SD       CR) TYPE(CRTOBJ) FILE(PMDYCPP)           AC1882993;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(LCL.Sequence_Number);
  PARAMETER(DB1.Component_Item_Code);
  PARAMETER(DB1.Production_Yield);
  PARAMETER(DB1.BOM_Type);
  PARAMETER(1);
  PARAMETER(PAR.Consume_Priority_Percent);
  PARAMETER(DB1.BOM_Pumped_Percent);
  PARAMETER(DB1.BOM_Meat_Cost_ConsumedPCT);
 }

}


