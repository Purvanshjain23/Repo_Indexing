/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  DOWNLOAD INVENTORY STK AND VALUES - EMAIL           */
/*                                                                  */
/*  SYSTEM    - INVENTORY MANAGEMENT SYSTEM                         */
/*  DATE      - 01/25/06                                            */
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     O    &RETURN     - RETURN CODE                               */
/*          &EMAIL      -  EMAIL ADDR                               */
/*          &CO         - COMPANY                                  */
/*          &DATE       - WEEKEND DATE                              */
/*          &WHSE       - WAREHOUSE                                */
/********************************************************************/
/* RMC 2/24/06   DONT EMAIL IF USER CLASS IS *PGMR                 */
/* DN  03/02/17  R9083 - STF OMS Inventory ISC-IVF                  */
/*               Commented out &USRCLS check since hard coding has  */
/*               been removed.                                      */
/*               Changed Company to be required hence commented out */
/*               CATCHALL label processing. Changed SEQUEL to also  */
/*               join by Inventory Valuation Grouping. Removed      */
/*               PRKPLIB hard coding.                               */
/********************************************************************/

 PPWOUPC:    PGM        PARM(&RETURN &COMPN &WHSE &WEEKA &EMAIL &EMAIL2)

/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */
        DCL    &COMPN      *DEC                  /* WHSE COMPANY              */
        DCL    &WHSE       *CHAR (3)             /* WHSE                      */
        DCL    &WEEKA      *CHAR   (8)           /* WEEK ENDING CHAR          */
        DCL    &WEEKN      *DEC    (8 0)         /* WEEK ENDING DEC           */
        DCL    &EMAIL      *CHAR   (25)          /* EMAIL                     */
        DCL    &EMAIL2     *CHAR   (25)          /* EMAIL                     */
        DCL    &PCFILE     *CHAR   (50)          /* EMAIL                     */
        DCL    &USRCLS     *CHAR (10)  /* USER CLASS */

/* INTERNAL FIELDS                                                            */
        DCL    &COMP       *DEC    (3 0)         /* COMPANY                   */
        DCL    &COMPA      *CHAR   (3)        /* COMPANY                   */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)

/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&COMP) VALUE(&COMPN)
             CHGVAR     VAR(&COMPA) VALUE(&COMP)
             CHGVAR     VAR(&WEEKN) VALUE(&WEEKA)
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))
             MONMSG     MSGID(QRY7023) EXEC(GOTO CMDLBL(MSGTRAP))
   /*------------------------------------------------*/
   /* IF *PGMR DONT DO THE SQL EMAIL                   */
   /*-----------------------------------------------*/

             RTVUSRPRF  USRCLS(&USRCLS)
         /* R9083 - Hard coding has been removed here & in SEQUEL. +
              Commented out &USRCLS check. */
          /* IF COND(&USRCLS *EQ '*PGMR') THEN(GOTO END) */

   /*------------------------------------------------*/
   /* EXECUTE SEQUEL TO CREATE THE ISC AND IVF WEEK ENDING FILE  */
   /*-----------------------------------------------*/

             CHGVAR     VAR(&PCFILE) VALUE(&EMAIL *CAT &EMAIL2)
      IF COND(&WHSE>'   ') THEN(DO)
         /* R9083 - Removed PRKPLIB hard coding. */
          /* EXECUTE    VIEW(PRKPLIB/PPBSCPPSO) PCFMT(*XLS) +
                          RECIPIENT(&PCFILE) SETVAR((&WEEKQ +
                          &WEEKA) (&WHSEQ &WHSE)) */
             EXECUTE    VIEW(*LIBL/PPBSCPPSO) PCFMT(*XLS) +
                          RECIPIENT(&PCFILE) SETVAR((&WEEKQ &WEEKA) +
                          (&WHSEQ &WHSE))
                          GOTO END
                          ENDDO
      IF COND(&COMPN>0) THEN(DO)
         /* R9083 - Removed PRKPLIB hard coding. */
          /* EXECUTE    VIEW(PRKPLIB/PPBSCPPSN) PCFMT(*XLS) +
                          RECIPIENT(&PCFILE) SETVAR((&WEEKQ +
                          &WEEKA) (&COMPQ &COMPA)) */
             EXECUTE    VIEW(*LIBL/PPBSCPPSN) PCFMT(*XLS) +
                          RECIPIENT(&PCFILE) SETVAR((&WEEKQ &WEEKA) +
                          (&COMPQ &COMPA))
                          GOTO END
                          ENDDO
    /* R9083 - Company is now required, CATCHALL is not required. */
/* CATCHALL:    EXECUTE    VIEW(PRKPLIB/PPBSCPPSM) PCFMT(*XLS) +
                          RECIPIENT(&PCFILE) SETVAR((&WEEKQ +
                          &WEEKA)) */
   /*-----------------------------------------------*/

/*------------------------------------------------------------------*/
             GOTO       CMDLBL(END)
/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM

