/********************************************************************/
/*                                                                  */
/*  PROGRAM  -  PMXZUPC - FAX OR DUPSPLF LOAD CONFIRMATION          */
/*  SYNOPSIS -  THIS CL IS CALLED TO EITHER FAX A LOAD CONFIRMATION */
/*              TO THE DISPATCHER OR THE SHIP FROM WAREHOUSE OR     */
/*              TO DUPLICATE THE SPOOLED FILE TO THEIR OUTQ         */
/*                                                                  */
/*  SYSTEM   -  OMS - TRAFFIC                                       */
/*  DATE     -  09/03/2008                                          */
/*                                                                  */
/*  PARAMETERS:                                                     */
/*   &PRTF       = SPOOL FILE NAME                                  */
/*   &DESC       = DESCRIPTION                                      */
/*   &COVER      = COVER SHEET                                      */
/*   &FAXRECIP1  = RECIPIENT NAME                                   */
/*   &FAXCOMP    = RECIPIENT COMPANY                                */
/*   &FAXNBR1    = RECIPIENT FAX NUMBER                             */
/*   &PRIORITY   = NOT USED IN THIS PROGRAM                         */
/*   &FAXNBR2    = DISPATCH OR WAREHOUSE FAX NUMBER                 */
/*   &FAXRECIP2  = "DISPATCH" OR WAREHOUSE NUMBER                   */
/*   &FAXDSPTCH  = FAX TO DISPATCH Y/N FLAG                         */
/*   &OUTQ       = OUTPUT QUEUE FOR THE DUPSPLF COMMAND             */
/****************************************************************** */
/* 09/03/2008 LJB E00170                                            */
/*   NEW                                                            */
/* 01/14/2009 LJB E00330  ADD HOLD AND SAVE AS PASSED IN PARMS      */
/*   COMMENT OUT WHERE THEY ARE BEING DEFAULTED IN THIS PROGRAM     */
/********************************************************************/
 PMXZUPC:    PGM        PARM(&PRTF &DESC &COVER &FAXRECIP1 &FAXCOMP +
                          &FAXNBR1 &PRIORITY &FAXNBR2 &FAXRECIP2 +
                          &FAXDSPTCH &OUTQ &HOLD &SAVE)

             DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DESC) TYPE(*CHAR) LEN(50)
             DCL        VAR(&COVER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FAXRECIP1) TYPE(*CHAR) LEN(25)
             DCL        VAR(&FAXCOMP) TYPE(*CHAR) LEN(25)
             DCL        VAR(&FAXNBR1) TYPE(*CHAR) LEN(25)
             DCL        VAR(&PRIORITY) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FAXNBR2) TYPE(*CHAR) LEN(25)
             DCL        VAR(&FAXRECIP2) TYPE(*CHAR) LEN(25)
             DCL        VAR(&FAXDSPTCH) TYPE(*CHAR) LEN(1)
             DCL        VAR(&OUTQ) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FTX2) TYPE(*CHAR) LEN(75) /* EMAIL ADDR */
             DCL        VAR(&ADDR) TYPE(*CHAR) LEN(50) /* Fax server +
                          address */
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)

             MONMSG     MSGID(CPF0000)

             CHGJOB     LOG(4 00 *SECLVL)

/*****       CHGVAR     VAR(&HOLD) VALUE(*YES)                    +
             CHGVAR     VAR(&SAVE) VALUE(*YES)                    +
             OVRPRTF    FILE(&PRTF) OUTQ(&OUTQ) HOLD(&HOLD) +
                          SAVE(&SAVE) USRDTA('LDCONFIRM')   ******/

/* DUP THE SPOOLFILE TO THE OUTQ FROM COMPANY DOCUMENT DEFAULT FILE  */
             IF         COND(&OUTQ *NE '         ') THEN(DO)
             DUPSPLF    FILE(&PRTF) JOB(*) OUTQ(&OUTQ) SPLNBR(*LAST) +
                          COPIES(1) HOLD(&HOLD) SAVE(&SAVE) +
                          USRDTA('LDCONFIRM')
             GOTO       CMDLBL(END)
             ENDDO

/* OTHERWISE, FAX THE SPOOLFILE TO THE FAX NUMBER FROM THE          */
/* COMPANY DOCUMENT DEFAULT FILE. RETRIEVE THE FAX                  */
/* SYSTEM VALUE FOR FAXSERVER = '@FAX.SEABOARDCORP.COM'             */
             IF         COND(&FAXNBR2 *NE '         ') THEN(DO)
             CALL       PGM(PPJXXFR) PARM(' ' 'FAXSERVER' &ADDR)

             CHGVAR     VAR(&FTX2) VALUE(&FAXNBR2 *TCAT &ADDR)
             ESEND/ESNDMAIL RECIPIENT(&FTX2) SUBJECT(&DESC) +
                          MSGTYPE(*TEXT) ATTLIST((* *PDF *N &PRTF))
             GOTO       CMDLBL(END)
             ENDDO

/********    DLTSPLF    FILE(&PRTF) SELECT(*ALL)      +
             MONMSG     MSGID(CPF3309)                +
             GOTO       CMDLBL(END)                   ***************/

 END:        ENDPGM
