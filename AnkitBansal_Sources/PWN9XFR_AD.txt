// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWN9XFR
// ?Date: 14.08.2025 Time: 02:57:09
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//?12/28/2023 JM S000219 - Fix unintentional deletion of Carcass Detail &
//?                        Tattoo Ded/Add.
//?                        Moved call of CHGOBJ if RTVOBJ finds record.
//? 1/19/2022 WHD83251 - Set th payment sts for internal
//? 8/27/2021 WHD83251 - Set Repayment Tattoos to SLG
ENDDO;

EXECUTE FUNCTION(Chg Process Code-Repay RT) TYPE(RTVOBJ) FILE(PWAXCPP)          AB1370647;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(PAR.TRH_Repayment_ID);
PARAMETER(PAR.THP_Process_Code);
PARAMETER(PAR.Process_Code_Saved);
{
 //?USER: Process Data record

 //?RMC added  this 1/19/21
 CASE;

 // IF DB1.PD Producer Code is Not Seaboard
 IF DB1.PD_Producer_Code <> 'SEABOA';

 // LCL.TH Payment Sts = CND.Sl Carcass Merit
 LCL.TH_Payment_Sts = 'SC';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.TH Payment Sts = CND.Sl Int Carc
 LCL.TH_Payment_Sts = 'IC';

 ENDIF;

 EXECUTE FUNCTION(Rtv All Values) TYPE(RTVOBJ) FILE(PKA1CPP)                     AB1366550;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(NLL.TH_Purchase_Date);
 PARAMETER(NLL.TH_Group_Reference);
 PARAMETER(NLL.TH_Live_Purchase_UOM);
 PARAMETER(NLL.TH_Live_Purchase_Price);
 PARAMETER(NLL.TH_Live_Gross_Amt);
 PARAMETER(NLL.TH_LIve_Net_Amt);
 PARAMETER(NLL.TH_Resale_UOM);
 PARAMETER(NLL.TH_Recalc_Live_Wgt_Yld);
 PARAMETER(NLL.TH_Pricing_Date);
 PARAMETER(NLL.TH_Resale_Spread_Sts);
 PARAMETER(NLL.TH_Dead_On_Arrival);
 PARAMETER(NLL.TH_Head_Received);
 PARAMETER(NLL.TH_Yard_Deads);
 PARAMETER(NLL.TH_Held_Over);
 PARAMETER(NLL.TH_Head_Condemned);
 PARAMETER(NLL.TH_Head_Killed);
 PARAMETER(NLL.TH_Head_Adds);
 PARAMETER(NLL.TH_Head_Accepted);
 PARAMETER(NLL.TH_Live_Wgt);
 PARAMETER(NLL.TH_Adj_Live_Wgt);
 PARAMETER(NLL.TH_Hot_Wgt);
 PARAMETER(NLL.TH_Tot_Loin_Eye_Depth);
 PARAMETER(NLL.TH_Tot_Backfat_Inches);
 PARAMETER(NLL.TH_Tot_Light_Reflectance);
 PARAMETER(NLL.TH_Avg_Live_Wgt);
 PARAMETER(NLL.TH_Avg_Hot_Wgt);
 PARAMETER(NLL.TH_Avg_Light_Reflectance);
 PARAMETER(NLL.TH_Avg_Lean_Percent);
 PARAMETER(NLL.TH_Avg_Loin_Eye_Depth);
 PARAMETER(NLL.TH_Avg_Backfat);
 PARAMETER(NLL.TH_Std_Yield_Percent);
 PARAMETER(NLL.TH_Actual_Yield);
 PARAMETER(NLL.TH_Adj_Actual_Yield);
 PARAMETER(NLL.TH_Yield_Difference);
 PARAMETER(NLL.TH_Recalc_Live_Wgt);
 PARAMETER(NLL.TH_CM_Market_Price);
 PARAMETER(NLL.TH_CM_Base_Mkt_Price);
 PARAMETER(NLL.TH_CM_Base_Mkt_Price_Amt);
 PARAMETER(NLL.TH_CM_Sort_Discount_Amt);
 PARAMETER(NLL.TH_CM_Yield_Gain_Loss_Amt);
 PARAMETER(NLL.TH_CM_Base_Carcass_Value);
 PARAMETER(NLL.TH_CM_LN_AddOn_Deduct_Amt);
 PARAMETER(NLL.TH_CM_Carcass_Gross_Amt);
 PARAMETER(NLL.TH_Deduction_Amt);
 PARAMETER(NLL.TH_Total_Net_WO_Adds);
 PARAMETER(NLL.TH_Carcass_Net_Amt);
 PARAMETER(NLL.TH_Additions_Amt);
 PARAMETER(NLL.TH_Payment_Gross);
 PARAMETER(NLL.Th_Payment_Net_Amt);
 PARAMETER(NLL.TH_AP_Voucher_Document#);
 PARAMETER(NLL.TH_Freight_Amount);
 PARAMETER(NLL.TH_Accrual_Amount);
 PARAMETER(NLL.TH_Fixed_Cost_Amount);
 PARAMETER(NLL.TH_Calc_Net_Sts);
 PARAMETER(NLL.TH_Payment_Sts);
 PARAMETER(NLL.TH_Header_Error_Sts);
 PARAMETER(NLL.TH_Detail_Error_Sts);
 PARAMETER(NLL.TH_Kill_Balancing_Sts);
 PARAMETER(NLL.TH_Bal_to_Kill_Gen);
 PARAMETER(NLL.TH_Commission_A_P_Voucher);
 PARAMETER(NLL.TH_Voucher_Payment_Date);
 PARAMETER(NLL.TH_User_Error_Override);
 PARAMETER(NLL.TH_Held_Over_Record);
 PARAMETER(NLL.TH_Sex);
 PARAMETER(NLL.TH_Held_Ovr_Completed_Dte);
 PARAMETER(NLL.TH_Commission_Paid_Date);
 PARAMETER(NLL.TH_Actual_Check_Date);
 PARAMETER(NLL.TH_Shipped_Weight);
 PARAMETER(NLL.TH_Avg_Hot_Wgt_EXC_ADD);
 PARAMETER(NLL.TH_FFLI);
 PARAMETER(NLL.TH_Kill_Product_Value);
 PARAMETER(NLL.TH_Cut_Product_Value);
 PARAMETER(NLL.TH_Render_Product_Value);
 PARAMETER(NLL.TH_Head_Excluded);
 PARAMETER(NLL.TH_CM_Bse_Mkt_Live_CWT);
 PARAMETER(NLL.TH_CM_Bse_Mkt_Carc_CWT);
 PARAMETER(NLL.TH_CM_Srt_Dsc_Live_CWT);
 PARAMETER(NLL.TH_CM_Srt_Dsc_Carc_CWT);
 PARAMETER(NLL.TH_CM_Yld_G_L_Live_CWT);
 PARAMETER(NLL.TH_CM_Yld_G_L_Carc_CWT);
 PARAMETER(NLL.TH_CM_Crc_Val_Live_CWT);
 PARAMETER(NLL.TH_CM_Crc_Val_Carc_CWT);
 PARAMETER(NLL.TH_CM_Lean_Prem_Live_CWT);
 PARAMETER(NLL.TH_CM_Lean_Prem_Carc_CWT);
 PARAMETER(NLL.TH_CM_Gross_Live_CWT);
 PARAMETER(NLL.TH_CM_Gross_Carc_CWT);
 PARAMETER(NLL.TH_Source_Type);
 PARAMETER(NLL.TH_Scale_Ticket_Sts);
 PARAMETER(NLL.TH_Payment_Type);
 PARAMETER(NLL.TH_HPS_Movement_Ref_#);
 PARAMETER(NLL.TH_Source_Code);
 PARAMETER(NLL.TH_Hog_Class_Type);
 PARAMETER(NLL.TH_Posted_to_HPS_Flag);
 PARAMETER(NLL.TH_Schedule_Kill_Shift);
 PARAMETER(NLL.TH_Shift_Held_Over);
 PARAMETER(NLL.TH_State);
 PARAMETER(NLL.TH_Unused_Code);
 PARAMETER(NLL.TH_Unused_Sts_2_Pos);
 PARAMETER(NLL.TH_Commission_Status);
 PARAMETER(NLL.TH_Paid_2_Week_Avg_Y_N);
 PARAMETER(NLL.TH_Unused_Sts_1_Pos_3);
 PARAMETER(NLL.TH_DOA_Weight);
 PARAMETER(NLL.TH_Avg_Lean_EXC_ADD);
 PARAMETER(NLL.TH_HPS_Farm_Site);
 PARAMETER(NLL.TH_Shift_Held_Over_Head);
 PARAMETER(NLL.TH_Sorting_Amount);
 PARAMETER(NLL.TH_Head_Identified);
 PARAMETER(NLL.TH_Percent_Identified);
 PARAMETER(NLL.TH_Percent_Accepted);
 PARAMETER(NLL.TH_Head_Adjusted_LN);
 PARAMETER(NLL.TH_PHA_Head_Adds);
 PARAMETER(NLL.TH_PHA_Add_Type);
 PARAMETER(NLL.TH_PHA_Average_Type);
 PARAMETER(NLL.TH_PHA_Add_Reason);
 PARAMETER(NLL.TH_PHA_Yield_Percent);
 PARAMETER(NLL.TH_PHA_Lean_Prm_Crc_CWT);
 PARAMETER(NLL.TH_VC_Gross_Value_HD);
 PARAMETER(NLL.TH_Excluded_Gross_Value);
 PARAMETER(NLL.TH_Avg_Lean);
 PARAMETER(NLL.TH_Broken_Back_Hd_Count);
 PARAMETER(NLL.TH_Hot_Scl_Upload_Time);
 PARAMETER(NLL.TH_Unused_Nbr_4);
 PARAMETER(NLL.TH_Excluded_Carc_Val);
 PARAMETER(NLL.TH_Excluded_Premium);
 PARAMETER(NLL.TH_Unused_Nbr_7);
 PARAMETER(NLL.TH_Unused_Nbr_8);
 PARAMETER(NLL.TH_Unused_Nbr_9);
 PARAMETER(NLL.TH_Unused_Nbr_10);
 PARAMETER(NLL.TH_Break_Even_Price_CWT);
 PARAMETER(NLL.TH_Meat_Value_Factor_Amt);
 PARAMETER(NLL.TH_Yld_Parm_Adj_Yield);
 PARAMETER(NLL.TH_PHA_Sort_Disc_Fctr);
 PARAMETER(NLL.TH_Avg_Loin_Eye_2_dec);
 PARAMETER(NLL.TH_Avg_Backfat_2_Dec);
 PARAMETER(NLL.TH_HITCH_Old_Pay_Net_Amt);
 PARAMETER(NLL.TH_MPR_Sort_Loss);
 PARAMETER(NLL.TH_Unused_Nbr_19);
 PARAMETER(NLL.TH_Unused_Nbr_20);
 PARAMETER(NLL.TH_Cold_Scl_Upload_Date);
 PARAMETER(NLL.TH_Cold_Scl_Upload_Time);
 PARAMETER(NLL.TH_Head_LFT);
 PARAMETER(NLL.TH_Head_EUT_KOA);
 PARAMETER(NLL.TH_Unused_Date_5);
 PARAMETER(NLL.TH_Unused_Sts_1);
 PARAMETER(NLL.TH_Unused_Sts_2);
 PARAMETER(NLL.TH_Unused_Sts_3);
 PARAMETER(NLL.TH_Unused_Sts_4);
 PARAMETER(NLL.TH_Unused_Sts_5);
 PARAMETER(NLL.TH_Unused_Sts_6);
 PARAMETER(NLL.TH_Unused_Sts_7);
 PARAMETER(NLL.TH_Unused_Sts_8);
 PARAMETER(NLL.DF_Defect_Code);
 PARAMETER(NLL.THP_Process_Code);
 PARAMETER(NLL.PD_Producer_Code);
 PARAMETER(NLL.PL_Location_Code);
 PARAMETER(NLL.HB_Buyer_Code);
 PARAMETER(NLL.GN_Genetic_Code);
 PARAMETER(NLL.HC_Class_Code);
 PARAMETER(NLL.RS_User_Changed);
 PARAMETER(NLL.RS_Date_Changed);
 PARAMETER(NLL.RS_Time_Changed);
 PARAMETER(NLL.RS_Record_Status);
 PARAMETER(NLL.RS_Job);
 PARAMETER(NLL.RS_Program);
 PARAMETER(NLL.RS_User_Added);
 PARAMETER(NLL.RS_Date_Added);
 PARAMETER(NLL.RS_Time_Added);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 EXECUTE FUNCTION(Chg Process Code-Repay CH) TYPE(CHGOBJ) FILE(PKA1CPP)          AB1370636;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(LCL.TH_Payment_Sts);
 PARAMETER(PAR.THP_Process_Code);
 PARAMETER(PAR.Process_Code_Saved);
 {
  //?USER: Processing after Data read

  //?Save the current value incase F3 pressed to cancel process
  // PAR.Process Code - Saved = DB1.THP Process Code
  PAR.Process_Code_Saved = DB1.THP_Process_Code;

  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

 ENDIF;

}


