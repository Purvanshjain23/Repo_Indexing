// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWBHXFR
// ?Date: 14.08.2025 Time: 02:55:53
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//? 3/31/2017 JBB E9815 - Add Company Number to Producer Files
//?                       Function created.  Part of this project
//?                       is to add a company number field to the
//?                       Producer History MNTH file.  This program
//?                       uses the library suffix to determine the
//?                       number to populate into the field if the
//?                       incoming company number is zero.
ENDDO;

//?If incoming library is entered, continue processing
CASE;

// IF PAR.Library is Entered
IF PAR.Library <> *BLANK;

// LCL.Count USR = CND.One
LCL.Count_USR = 1;

//?Determine library suffix
// DOW LCL.Count USR is LE 10
DOW LCL.Count_USR <= 10;

// LCL.Text 1                USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.1)
LCL.Text_1_USR = SUBSTRING(PAR.Library:LCL.Count_USR:1);

//?If character is blank, get last library suffix
CASE;

// IF LCL.Text 1                USR is Blank
IF LCL.Text_1_USR = *BLANK;

// LCL.Count USR = LCL.Count USR - CON.3
LCL.Count_USR = LCL.Count_USR - 3;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

//?If character is blank, get last library suffix
// IF LCL.Count USR is Ten
IF LCL.Count_USR = 10;

// LCL.Count USR = LCL.Count USR - CON.2
LCL.Count_USR = LCL.Count_USR - 2;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

ENDIF;

// LCL.Count USR = LCL.Count USR + CON.1
LCL.Count_USR = LCL.Count_USR + 1;

ENDDO;

//?Load company number based upon library suffix
CASE;

// IF LCL.Text 3 USR is Guymon
IF LCL.Text_3_USR = 'GUP';

// LCL.PHM Company Number = CND.SBD Farms of Guymon, Ok
LCL.PHM_Company_Number = 360;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods
IF LCL.Text_3_USR = 'TFP';

// LCL.PHM Company Number = CND.Triumph Foods Market
LCL.PHM_Company_Number = 960;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Seaboard Triumph Foods
IF LCL.Text_3_USR = 'STP';

// LCL.PHM Company Number = CND.Sioux City
LCL.PHM_Company_Number = 440;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods-2
IF LCL.Text_3_USR = 'T2P';

// LCL.PHM Company Number = CND.Triumph Foods-2
LCL.PHM_Company_Number = 961;

//?Load company number based upon library suffix
// IF *OTHERWISE
IF *OTHERWISE;

PGM.*Return_code = 'ERROR';

RETURN;

ENDIF;

//?Read all Producer History WKLY records and update Company Number
EXECUTE FUNCTION(Fix Add Co# to PH MNTH RT) TYPE(RTVOBJ) FILE(PKE1CPP)          AB1332145;
PARAMETER(LCL.PHM_Company_Number);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.PHM Company Number is *ZERO
 IF DB1.PHM_Company_Number = *ZERO;

 //?First, create a new record with the Company Number
 EXECUTE FUNCTION(Fix Add Co# to PH MNTH CR) TYPE(CRTOBJ) FILE(PKE1CPP)          AB1332214;
 PARAMETER(PAR.PHM_Company_Number);
 PARAMETER(DB1.PHM_Producer_Code);
 PARAMETER(DB1.PHM_Loc_Farm_Code);
 PARAMETER(DB1.PHM_Month_Ending_Date);
 PARAMETER(DB1.PHM_Source_Code);
 PARAMETER(DB1.PHM_Payment_Type);
 PARAMETER(DB1.PHM_Hog_Class_Type);
 PARAMETER(DB1.PHM_Dead_on_Arrival);
 PARAMETER(DB1.PHM_Head_Received);
 PARAMETER(DB1.PHM_Yard_Deads);
 PARAMETER(DB1.PHM_Head_Condemned);
 PARAMETER(DB1.PHM_Head_Killed);
 PARAMETER(DB1.PHM_Head_Identified);
 PARAMETER(DB1.PHM_Head_Adjusted_LN);
 PARAMETER(DB1.PHM_Head_Analyzed);
 PARAMETER(DB1.PHM_Head_Excluded);
 PARAMETER(DB1.PHM_Head_Adds);
 PARAMETER(DB1.PHM_Head_PHA_Adds);
 PARAMETER(DB1.PHM_Live_Weight);
 PARAMETER(DB1.PHM_Adjusted_Live_Weight);
 PARAMETER(DB1.PHM_Hot_Weight);
 PARAMETER(DB1.PHM_Avg_Light_Ref);
 PARAMETER(DB1.PHM_Avg_Lean);
 PARAMETER(DB1.PHM_Avg_Loin_Eye);
 PARAMETER(DB1.PHM_Avg_Backfat);
 PARAMETER(DB1.PHM_Base_Mkt_Amt);
 PARAMETER(DB1.PHM_Sort_Disc_Amt);
 PARAMETER(DB1.PHM_Yield_G_L_Amt);
 PARAMETER(DB1.PHM_Base_Carc_Amt);
 PARAMETER(DB1.PHM_Prem_Ded_Add_Amt);
 PARAMETER(DB1.PHM_Payment_Gross_Amt);
 PARAMETER(DB1.PHM_Sbd_Addtnl_Exp_Amt);
 PARAMETER(DB1.PHM_Cutout_Value);
 PARAMETER(DB1.PHM_Source_Type);
 //?Then delete existing record that does not have a Company Number
 EXECUTE FUNCTION(Delete Producer History M) TYPE(DLTOBJ) FILE(PKE1CPP)          AB1234421;
 PARAMETER(DB1.PHM_Company_Number);
 PARAMETER(DB1.PHM_Producer_Code);
 PARAMETER(DB1.PHM_Loc_Farm_Code);
 PARAMETER(DB1.PHM_Month_Ending_Date);
 PARAMETER(DB1.PHM_Source_Code);
 PARAMETER(DB1.PHM_Payment_Type);
 PARAMETER(DB1.PHM_Hog_Class_Type);
 ENDIF;

}


ENDIF;

