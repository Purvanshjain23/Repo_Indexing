/*********************************************************************/
/* MODIFIED:                                                         */
/*  RMC 5/24/02  ADD FAX TO DISPATCH PROCESSING- FAX TO              */
/*               FAX 2 AND RECIPIENT 2                               */
/*  RMC 2/28/05  ADDED CODE FOR GENIFAX SOFTWARE                     */
/*  RMC 3/30/05  DONT PRINT COVER PAGE FOR THIS ONE                  */
/*  LJB 5/16/06  CHANGED FAX WORK FIELD TO 25 CHAR TO                */
/*      ACCOMMODATE INTERNATIONAL FAX NUMBER SIZES.                  */
/*  LJB 8/31/06  REMOVE DELETE OF SPOOL FILE SO IT                   */
/*      CAN BE FAXED TO MULTIPLE FAX NUMBERS AND ALSO                */
/*      EMAILED TO MULTIPLE EMAIL ADDRESSES. DELETE                  */
/*      SPOOLED FILES IN THE CALLING PROGRAM.                        */
/*  RMC 3/13/08  CHANGE THIS PARAM:MSG('LOAD..') ON ESNDMAILS TO     */
/*      MSG(*NONE) SO LEADING BLANK PAGE WONT GET FAXED              */
/*********************************************************************/
PODYUPR:    PGM        PARM(&PRTF &DESC &COVER &FAXR  +
                         &FAXC &PHONE &PRIORITY &FAX2 &REC2)

            DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
            DCL        VAR(&DESC) TYPE(*CHAR) LEN(25)
            DCL        VAR(&COVER) TYPE(*CHAR) LEN(10)
            DCL        VAR(&FAXR) TYPE(*CHAR) LEN(25)
            DCL        VAR(&FAX#)     TYPE(*CHAR) LEN(25)
            DCL        VAR(&FAXC) TYPE(*CHAR) LEN(25)
            DCL        VAR(&PHONE)  TYPE(*CHAR) LEN(25)
            DCL        VAR(&PRIORITY)  TYPE(*CHAR) LEN(1)
            DCL        VAR(&FAX2)  TYPE(*CHAR) LEN(25)
            DCL        VAR(&REC2)  TYPE(*CHAR) LEN(25)
            DCL        VAR(&BLANK) TYPE(*CHAR) LEN(25)
            DCL        VAR(&GENIFAX)  TYPE(*CHAR) LEN(1)
            DCL        VAR(&FTX2) TYPE(*CHAR) LEN(75)  /* EMAIL ADDR */
            DCL        VAR(&ADDR) TYPE(*CHAR) LEN(100) /* location +
                          of fax server  */

/*----------------------------------------------------------------- */
/* SYSTEM VALUE FOR FAXSOFT = 'Y' (FAX SOFTWARE IS GENIFAX Y/N)     */
             CALL       PGM(PPJXXFR) PARM(' ' 'FAXSOFT' &GENIFAX)
/* SYSTEM VALUE FOR FAXSERVER = '@FAX.SEABOARDCORP.COM'             */
             CALL       PGM(PPJXXFR) PARM(' ' 'FAXSERVER' &ADDR)

/*******************************************************************/
/* FAX TO CARRIER                                                  */
/*******************************************************************/
 IF COND(&PHONE *NE &BLANK)  THEN(DO)
GENICARR:
             CHGVAR     VAR(&FTX2) VALUE(&PHONE *TCAT &ADDR)
             CHGVAR     VAR(&DESC) VALUE(&FAXC) /*company name */

             ESEND/ESNDMAIL RECIPIENT(&FTX2) SUBJECT(&DESC) +
                          MSG(*NONE) MSGTYPE(*TEXT) +
                          ATTLIST((* *PDF *N &PRTF))
             MONMSG     MSGID(CPF3309) EXEC(GOTO CMDLBL(NOSPOOL))
             ENDDO
 /****************************************************************/
/* FAX TO DISPATCH                                            */
 /****************************************************************/
 DISPATCH:
 IF COND(&FAX2 *NE &BLANK) THEN(DO)
 GENIDISP:
             CHGVAR     VAR(&FTX2) VALUE(&FAX2 *TCAT &ADDR)
             CHGVAR     VAR(&DESC) VALUE(&FAXC) /*company name */

             ESEND/ESNDMAIL RECIPIENT(&FTX2) SUBJECT(&DESC) +
                          MSG(*NONE) MSGTYPE(*TEXT) +
                          ATTLIST((* *PDF *N &PRTF))

             ENDDO
 /****************************************************************/
             GOTO       CMDLBL(END)

NOSPOOL:
             SNDMSG     MSG('Faxing attempt failed, please retry or +
                          call Information Services') TOUSR(*REQUESTER)

 END:        ENDPGM
