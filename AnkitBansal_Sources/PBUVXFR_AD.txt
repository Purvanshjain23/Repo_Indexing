// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBUVXFR
// ?Date: 14.08.2025 Time: 03:49:30
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV Inv with ACH Pmt  RT) TYPE(RTVOBJ) FILE(ARBDCPP)           AC2116749;
{
 //?USER: Initialize routine

 // WRK.Date                  USR = CON.1150101
 WRK.Date_USR = 1150101;

 //?USER: Process Data record

 CASE;

 // IF DB1.Transaction Date Code GT WRK.Date                  USR
 IF DB1.Transaction_Date_Code > WRK.Date_USR;

 EXECUTE FUNCTION(Rtv Pmt ACH Payment    RT) TYPE(RTVOBJ) FILE(ARBECPP)          AC2116751;
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(1151204);
 PARAMETER(LCL.Record_Selected_USR);
 {
  //?USER: Initialize routine

  //?** This subroutine is used to select invoices that have an ACH
  //?** paid later than the input date for M3 erp
  // LCL.Bank Code = CON.ACHSLC
  LCL.Bank_Code = 'ACHSLC';

  // LCL.Text USR 6 = CON.ACHMSL
  LCL.Text_USR_6 = 'ACHMSL';

  // PAR.Record Selected       USR = CND.no
  PAR.Record_Selected_USR = 'N';

  //?USER: Process Data record

  //?** Select ACHnn bank records only
  CASE;

  // IF DB1.Transaction Date Code GT PAR.Date From             USR
  IF DB1.Transaction_Date_Code > PAR.Date_From_USR;

  //?** Select record if it is within the date range requested
  CASE;

  // IF DB1.Bank Code EQ LCL.Bank Code
  IF DB1.Bank_Code = LCL.Bank_Code;

  // OR DB1.Bank Code EQ LCL.Text USR 6
  OR DB1.Bank_Code = LCL.Text_USR_6;

  // PAR.Record Selected       USR = CND.yes
  PAR.Record_Selected_USR = 'Y';

  QUIT;

  ENDIF;

  ENDIF;

 }

 CASE;

 // IF LCL.Record Selected       USR is yes
 IF LCL.Record_Selected_USR = 'Y';

 CASE;

 // IF DB1.Invoice Suffix is IN, DM, or CM
 IF DB1.Invoice_Suffix = 'CM'/'DM'/'IN';

 // Call program M3 OMS AR Open Invoice UP.
 CALL PROGRAM(M3 OMS AR Open Invoice UP) ('M3OPNINV');
 PARAMETER(LCL.Return_Code_Usr);
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number_Ref);

 // IF DB1.Invoice Suffix is On Account Cash
 IF DB1.Invoice_Suffix = 'OA';

 // OR DB1.Invoice Suffix is Charge Backs
 OR DB1.Invoice_Suffix = 'CB';

 // Call program M3 OMS AR Open CB      UP.
 CALL PROGRAM(M3 OMS AR Open CB      UP) ('M3OPNCBOA');
 PARAMETER(LCL.Return_Code_Usr);
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number_Ref);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Transaction_Amount);

 ENDIF;

 ENDIF;

 ENDIF;

}


