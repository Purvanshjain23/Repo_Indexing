// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLGIPVR
// ?Date: 14.08.2025 Time: 02:54:12
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?E14473 JJH 02/14/19 - Set PC Format to *DELIMITED if T=Text
//?E14473 JJH 02/08/19 - Add Field PT SQL Format
//?E14404 JJH 01/21/19 - BrickFTP Re-Create for a EDI Trading #
//? - Add option to re-create or re-create and send by EDI Trading #
//?R10169 JJH 07/26/17 - Payment Producer Post Modifications
//?- Changed to process in Job Queue QGPL/PORKFTPQ
//?R10169 JJH 07/26/17 - Payment Producer Post Modifications
//?- Recompile so that the Payment ProdPostEdiSnd XF is SBMJOB.
//?H16853 ISE 11/05/2020 - Recompiled due to change in Buy Order Number
ENDDO;

//?USER: User defined action

//?E14404 JJH 01/21/19 - BrickFTP Re-Create for a EDI Trading #
//?Re-Create EDI Carcass Summary & Detail
CASE;

// IF DTL.EDI Trading Partner # is Entered
IF DTL.EDI_Trading_Partner_# <> 0;

//?By EDI Trading Partner #
//?*** Purge record to allow rerun of EDI
//?    By Company and Date
//?*** Purge EDI Carcass Summary
EXECUTE FUNCTION(Del EDI CarcSumReRun1 RT) TYPE(RTVOBJ) FILE(PKD3CPP)           AB1348788;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
PARAMETER(DTL.EDI_Trading_Partner_#);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.EDI Trading Partner # EQ PAR.EDI Trading Partner #
 IF DB1.EDI_Trading_Partner_# = PAR.EDI_Trading_Partner_#;

 EXECUTE FUNCTION(Del EDI Carc Summ     DO) TYPE(DLTOBJ) FILE(PKD3CPP)           AB1200905;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 ENDIF;

}


//?*** Purge EDI Carcass detail
EXECUTE FUNCTION(Del EDI Carc DetReRun1RT) TYPE(RTVOBJ) FILE(PKD4CPP)           AB1348789;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
PARAMETER(DTL.EDI_Trading_Partner_#);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.EDI Trading Partner # EQ PAR.EDI Trading Partner #
 IF DB1.EDI_Trading_Partner_# = PAR.EDI_Trading_Partner_#;

 EXECUTE FUNCTION(Del EDI Carc Detail   DO) TYPE(DLTOBJ) FILE(PKD4CPP)           AB1200934;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(DB1.CD_Carcass_Number);
 ENDIF;

}


//?*** Purge Producer Event
EXECUTE FUNCTION(Del ProdEvent ReRun1  RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1348797;
PARAMETER(DTL.EDI_Trading_Partner_#);
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del ProdEvent ReRun1  RT) TYPE(RTVOBJ) FILE(PKD9CPP)           AB1348790;
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER('EDI');
 PARAMETER(PAR.Current_Kill_Date);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Del Producer Event    DL) TYPE(DLTOBJ) FILE(PKD9CPP)           AB1205070;
  PARAMETER(DB1.CC_Company_Number);
  PARAMETER(DB1.PD_Producer_Code);
  PARAMETER(DB1.EV_Event_Code);
  PARAMETER(DB1.PE_Kill_Date);
 }

}


//?** Create the EDI CARCASS SUMMARY & CARCASS DETAIL & PRODUCER EVENT
// Call program Crt EDI Carc Sum/Dtl1 XF.
CALL PROGRAM(Crt EDI Carc Sum/Dtl1 XF) ('PWIAXFR');
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
PARAMETER(DTL.EDI_Trading_Partner_#);
PARAMETER(DTL.Recreate_EDI_Files_Usr);

//?Re-Create EDI Carcass Summary & Detail
// IF *OTHERWISE
IF *OTHERWISE;

//?By Kill Date
CASE;

// IF DTL.Recreate EDI Files Usr is *ALL values
IF DTL.Recreate_EDI_Files_Usr = 'R'/'S'/'O';

//?*** Purge record to allow rerun of EDI
//?    By Company and Date
//?*** Purge EDI Carcass Summary
EXECUTE FUNCTION(Del EDI CarcSumReRun  RT) TYPE(RTVOBJ) FILE(PKD3CPP)           AB1281686;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del EDI Carc Summ     DO) TYPE(DLTOBJ) FILE(PKD3CPP)           AB1200905;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
}


//?*** Purge EDI Carcass detail
EXECUTE FUNCTION(Del EDI Carc DetReRun RT) TYPE(RTVOBJ) FILE(PKD4CPP)           AB1283926;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del EDI Carc Detail   DO) TYPE(DLTOBJ) FILE(PKD4CPP)           AB1200934;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(DB1.CD_Carcass_Number);
}


//?*** Purge Producer Event
EXECUTE FUNCTION(Del ProdEvent ReRun   RT) TYPE(RTVOBJ) FILE(PKD9CPP)           AB1283904;
PARAMETER(DTL.CC_Company_Number);
PARAMETER('EDI');
PARAMETER(DTL.Current_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del Producer Event    DL) TYPE(DLTOBJ) FILE(PKD9CPP)           AB1205070;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.EV_Event_Code);
 PARAMETER(DB1.PE_Kill_Date);
}


//?** Create the EDI CARCASS SUMMARY & CARCASS DETAIL & PRODUCER EVENT
// Call program Crt EDI Carc Sum/Dtl  XF.
CALL PROGRAM(Crt EDI Carc Sum/Dtl  XF) ('PKLNXFR');
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
PARAMETER(DTL.Recreate_EDI_Files_Usr);

ENDIF;

ENDIF;

//?E14404 JJH 01/22/19 - BrickFTP Re-Create and Send for a EDI Trading #
//?Recreate and Send EDI Files Usr is ReCreate & Send Out
CASE;

// IF DTL.Recreate EDI Files Usr is ReCreate & Send Out
IF DTL.Recreate_EDI_Files_Usr = 'S';

//?E14473 JJH 02/08/19 - Add Field PT SQL Format
CASE;

// IF DTL.EDI Trading Partner # is Entered
IF DTL.EDI_Trading_Partner_# <> 0;

EXECUTE FUNCTION(Rtv Producer Trd PtMthRT) TYPE(RTVOBJ) FILE(PLB6REP)           AB1322407;
PARAMETER(DTL.EDI_Trading_Partner_#);
PARAMETER(LCL.PT_FTP_Method);
PARAMETER(LCL.PT_Summary_View);
PARAMETER(LCL.PT_Detail_View);
PARAMETER(LCL.PT_SQL_Format);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF LCL.PT SQL Format is TXT
IF LCL.PT_SQL_Format = 'T';

// LCL.PCFMT USR = CON.*DELIMITED
LCL.PCFMT_USR = *DELIMITED;

// IF LCL.PT SQL Format is XLS
IF LCL.PT_SQL_Format = 'X';

// LCL.PCFMT USR = CON.*XLS
LCL.PCFMT_USR = *XLS;

ENDIF;

CASE;

// IF LCL.PT FTP Method is SFTP
IF LCL.PT_FTP_Method = 'S';

// LCL.Company Number Alpha Usr = CVTVAR(DTL.CC Company Number)
LCL.Company_Number_Alpha_Usr = CVTVAR(DTL.CC_Company_Number);

// LCL.Date Alpha USR = CVTVAR(DTL.Current Kill Date)
LCL.Date_Alpha_USR = CVTVAR(DTL.Current_Kill_Date);

// LCL.EDI TradingPart Alpha Usr = CVTVAR(DTL.EDI Trading Partner #)
LCL.EDI_TradingPart_Alpha_Usr = CVTVAR(DTL.EDI_Trading_Partner_#);

// Call program EDI Carcass Sum/DtlTF UP.
CALL PROGRAM(EDI Carcass Sum/DtlTF UP) ('EDISUMDTTF');
PARAMETER(LCL.Company_Number_Alpha_Usr);
PARAMETER(LCL.Date_Alpha_USR);
PARAMETER(LCL.EDI_TradingPart_Alpha_Usr);
PARAMETER(LCL.PT_FTP_Method);
PARAMETER(LCL.PT_Summary_View);
PARAMETER(LCL.PT_Detail_View);
PARAMETER(LCL.PCFMT_USR);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

//?R10169 JJH 07/26/17 - SBMJOB
// Call program Payment ProdPostEdiSnd XF.
SBMJOB;
CALL PROGRAM(Payment ProdPostEdiSnd XF) ('PLLGXFR');
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Current_Kill_Date);
PARAMETER(LCL.Oms_System_Value_Alpha);
PARAMETER(LCL.PRT_Printer_Device);
PARAMETER(LCL.PRT_Hold_Output_Sts);
PARAMETER(LCL.PRT_Save_Output_Sts);
PARAMETER(LCL.PRT_Copies);
SBMJOBOVR JOB(HPEEDIMENU);
SBMJOBOVR JOBQ(QGPL/PORKFTPQ);
SBMJOBOVR LOG(4;
SBMJOBOVR 00;
SBMJOBOVR *SECLVL);
SBMJOBEND;

ENDIF;

ENDIF;

