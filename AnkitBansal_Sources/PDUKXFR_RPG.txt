     H/TITLE CRT A/R Header         XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISJBADE
     H* Date          : 09/16/16  Time  : 09:32:42
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAEOREL3IF  E           K        DISK
      * RSQ : Company Customer          Customer/Company
      *
     FARBDCPL0IF  E           K        DISK                      A
      * UPD : A/R Header                Update index
      *
     I@EOREU0
      * Company Customer          Customer/Company
      * Renamed input format fields
     I              EOAIC3                          WAAIC3
     I              EOBKC7                          WABKC7
     I              EOAQCD                          WAAQCD
     I              EOR4CD                          WAR4CD
     I              EOBYNA                          WABYNA
     I              EOB6NA                          WAB6NA
     I              EOBZNA                          WABZNA
     I              EOLLST                          WALLST
     I              EOPPST                          WAPPST
     I              EOR5NB                          WAR5NB
     I              EOR6NB                          WAR6NB
     I              EOQGST                          WAQGST
     I              EOBOCD                          WABOCD
     I              EOTBNB                          WATBNB
     I              EOMTCU                          WAMTCU
     I              EOW2NB                          WAW2NB
     I              EORPCD                          WARPCD
     I              EOAJCD                          WAAJCD
     I              EOX9ST                          WAX9ST
     I              EOT9CD                          WAT9CD
     I              EOUBCD                          WAUBCD
     I              EOISTX                          WAISTX
     I              EOLQCD                          WALQCD
     I              EONJNA                          WANJNA
     I              EOI0TX                          WAI0TX
     I              EONKNA                          WANKNA
     I              EOI1TX                          WAI1TX
     I              EOVLST                          WAVLST
     I              EORLST                          WARLST
     I              EOMMTX                          WAMMTX
     I              EOOHNA                          WAOHNA
     I              EOQ6ST                          WAQ6ST
     I              EOQ8ST                          WAQ8ST
     I              EORBST                          WARBST
     I              EOREST                          WAREST
     I              EOUVST                          WAUVST
     I              EOUWST                          WAUWST
     I              EOUXST                          WAUXST
     I              EOVSST                          WAVSST
     I              EOAATM                          WAAATM
     I              EOAYNA                          WAAYNA
     I              EOA0NA                          WAA0NA
     I              EOAXDT                          WAAXDT
      *
     I@BDCPFG
      * A/R Header                Update index
      * Renamed input format fields
     I              BDAIC3                          WBAIC3
     I              BDCONB                          WBCONB
     I              BDCEST                          WBCEST
     I              BDUHCD                          WBUHCD
     I              BDBSVA                          WBBSVA
     I              BDAIVA                          WBAIVA
     I              BDAOVA                          WBAOVA
     I              BDBGVA                          WBBGVA
     I              BDAJST                          WBAJST
     I              BDE3ST                          WBE3ST
     I              BDG4CD                          WBG4CD
     I              BDCKNB                          WBCKNB
     I              BDCAC7                          WBCAC7
     I              BDBKC7                          WBBKC7
     I              BDBCCD                          WBBCCD
     I              BDR4CD                          WBR4CD
     I              BDB4DT                          WBB4DT
     I              BDATDT                          WBATDT
     I              BDH0DT                          WBH0DT
     I              BDH3DT                          WBH3DT
     I              BDH4DT                          WBH4DT
     I              BDH5DT                          WBH5DT
     I              BDANC7                          WBANC7
     I              BDCPTX                          WBCPTX
     I              BDBSDY                          WBBSDY
     I              BDUVST                          WBUVST
     I              BDUWST                          WBUWST
     I              BDUXST                          WBUXST
     I              BDAATM                          WBAATM
     I              BDAYNA                          WBAYNA
     I              BDA0NA                          WBA0NA
     I              BDAXDT                          WBAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQARBD1    E DSARBDCPL0
      * UPD : A/R Header                Update index
      * Renamed input format fields
     I              BDAIC3                          WBAIC3
     I              BDCONB                          WBCONB
     I              BDCEST                          WBCEST
     I              BDUHCD                          WBUHCD
     I              BDBSVA                          WBBSVA
     I              BDAIVA                          WBAIVA
     I              BDAOVA                          WBAOVA
     I              BDBGVA                          WBBGVA
     I              BDAJST                          WBAJST
     I              BDE3ST                          WBE3ST
     I              BDG4CD                          WBG4CD
     I              BDCKNB                          WBCKNB
     I              BDCAC7                          WBCAC7
     I              BDBKC7                          WBBKC7
     I              BDBCCD                          WBBCCD
     I              BDR4CD                          WBR4CD
     I              BDB4DT                          WBB4DT
     I              BDATDT                          WBATDT
     I              BDH0DT                          WBH0DT
     I              BDH3DT                          WBH3DT
     I              BDH4DT                          WBH4DT
     I              BDH5DT                          WBH5DT
     I              BDANC7                          WBANC7
     I              BDCPTX                          WBCPTX
     I              BDBSDY                          WBBSDY
     I              BDUVST                          WBUVST
     I              BDUWST                          WBUWST
     I              BDUXST                          WBUXST
     I              BDAATM                          WBAATM
     I              BDAYNA                          WBAYNA
     I              BDA0NA                          WBA0NA
     I              BDAXDT                          WBAXDT
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R Header
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Invoice Number
     I                                    P   3   60P1CONB
      * I :  Invoice Suffix
     I                                        7   8 P1CEST
      * I :  Adjustment Type Code
     I                                        9  11 P1UHCD
      * I :  Transaction Amount
     I                                    P  12  172P1BSVA
      * I :  Adjustment Amount
     I                                    P  18  232P1AIVA
      * I :  Amount Paid
     I                                    P  24  292P1AOVA
      * I :  Remaining Balance Due
     I                                    P  30  352P1BGVA
      * I :  A/R Processing Status
     I                                       36  36 P1AJST
      * I :  Purge Status
     I                                       37  37 P1E3ST
      * I :  Bank Code
     I                                       38  43 P1G4CD
      * I :  G/L Document Number
     I                                    P  44  480P1CKNB
      * I :  Order Number Ref
     I                                    P  49  520P1CAC7
      * I :  Ship To Customer
     I                                    P  53  560P1BKC7
      * I :  Salesperson Code
     I                                       57  59 P1BCCD
      * I :  Sales Route Code
     I                                       60  62 P1R4CD
      * I :  Transaction Date Code
     I                                    P  63  660P1B4DT
      * I :  Due Date
     I                                    P  67  700P1ATDT
      * I :  Last Payment Date
     I                                    P  71  740P1H0DT
      * I :  Original Inv for CB
     I                                    P  75  780P1H3DT
      * I :  Paid in Full Date
     I                                    P  79  820P1H4DT
      * I :  Last G/L Post Date
     I                                    P  83  860P1H5DT
      * I :  A/R Customer Number
     I                                    P  87  900P1ANC7
      * I :  A/R Check Number
     I                                       91 100 P1CPTX
      * I :  Days to Pay
     I                                    P 101 1030P1BSDY
      * I :  EDI Status 1
     I                                      104 104 P1UVST
      * I :  EDI Status 2
     I                                      105 105 P1UWST
      * I :  EDI Status 3
     I                                      106 106 P1UXST
      * N :  Job Time
     I                                    P 107 1100P1AATM
      * N :  User Id
     I                                      111 120 P1AYNA
      * N :  Job Name
     I                                      121 130 P1A0NA
      * N :  Job Date
     I                                    P 131 1340P1AXDT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1CONB    PARM           WP0002  70       Invoice Number
     C           P1CEST    PARM           WP0003  2        Invoice Suffix
     C           P1UHCD    PARM           WP0004  3        Adjustment Type
     C           P1BSVA    PARM           WP0005 112       Transaction Amo
     C           P1AIVA    PARM           WP0006 112       Adjustment Amou
     C           P1AOVA    PARM           WP0007 112       Amount Paid
     C           P1BGVA    PARM           WP0008 112       Remaining Balan
     C           P1AJST    PARM           WP0009  1        A/R Processing
     C           P1E3ST    PARM           WP0010  1        Purge Status
     C           P1G4CD    PARM           WP0011  6        Bank Code
     C           P1CKNB    PARM           WP0012  80       G/L Document Nu
     C           P1CAC7    PARM           WP0013  70       Order Number Re
     C           P1BKC7    PARM           WP0014  70       Ship To Custome
     C           P1BCCD    PARM           WP0015  3        Salesperson Cod
     C           P1R4CD    PARM           WP0016  3        Sales Route Cod
     C           P1B4DT    PARM           WP0017  70       Transaction Dat
     C           P1ATDT    PARM           WP0018  70       Due Date
     C           P1H0DT    PARM           WP0019  70       Last Payment Da
     C           P1H3DT    PARM           WP0020  70       Original Inv fo
     C           P1H4DT    PARM           WP0021  70       Paid in Full Da
     C           P1H5DT    PARM           WP0022  70       Last G/L Post D
     C           P1ANC7    PARM           WP0023  70       A/R Customer Nu
     C           P1CPTX    PARM           WP0024 10        A/R Check Numbe
     C           P1BSDY    PARM           WP0025  50       Days to Pay
     C           P1UVST    PARM           WP0026  1        EDI Status 1
     C           P1UWST    PARM           WP0027  1        EDI Status 2
     C           P1UXST    PARM           WP0028  1        EDI Status 3
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CRT A/R Header         XF
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * Rtv Customer Type     RT - Company Customer  * 
     C                     EXSR SARVGN
      * ** No A/R Header and Detail records for Inter-Plant orders
      * CASE: LCL.Type Code is Inter-Plant Transfer
     C           YL0001    IFEQ 'IP'                       *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CRT A/R Header         CO - A/R Header  * 
     C                     EXSR SBCRRC
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Customer Type     RT - Company Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WABKC7    WQSA01           Ship To Custome
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Ship To Custome
      * Setup key
     C                     Z-ADDP1BKC7    WQSA01           Ship To Custome
      * Establish starting position
     C           KRSSA     SETLL@EOREU0                    *
     C           KRSSA     READE@EOREU0                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1007' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           Type Code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWABOCD    YL0001           Type Code
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@EOREU0                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * CRT A/R Header         CO - A/R Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  60       Job Time
     C                     MOVEL*BLANK    WN0002 10        User Id
     C                     MOVEL*BLANK    WN0003 10        Job Name
     C                     Z-ADD*ZERO     WN0004  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BDCPFG
     C                     Z-ADDP1AIC3    WBAIC3           Company Number
     C                     Z-ADDP1CONB    WBCONB           Invoice Number
     C                     MOVELP1CEST    WBCEST           Invoice Suffix
     C                     MOVELP1UHCD    WBUHCD           Adjustment Type
     C                     Z-ADDP1BSVA    WBBSVA           Transaction Amo
     C                     Z-ADDP1AIVA    WBAIVA           Adjustment Amou
     C                     Z-ADDP1AOVA    WBAOVA           Amount Paid
     C                     Z-ADDP1BGVA    WBBGVA           Remaining Balan
     C                     MOVELP1AJST    WBAJST           A/R Processing
     C                     MOVELP1E3ST    WBE3ST           Purge Status
     C                     MOVELP1G4CD    WBG4CD           Bank Code
     C                     Z-ADDP1CKNB    WBCKNB           G/L Document Nu
     C                     Z-ADDP1CAC7    WBCAC7           Order Number Re
     C                     Z-ADDP1BKC7    WBBKC7           Ship To Custome
     C                     MOVELP1BCCD    WBBCCD           Salesperson Cod
     C                     MOVELP1R4CD    WBR4CD           Sales Route Cod
     C                     Z-ADDP1B4DT    WBB4DT           Transaction Dat
     C                     Z-ADDP1ATDT    WBATDT           Due Date
     C                     Z-ADDP1H0DT    WBH0DT           Last Payment Da
     C                     Z-ADDP1H3DT    WBH3DT           Original Inv fo
     C                     Z-ADDP1H4DT    WBH4DT           Paid in Full Da
     C                     Z-ADDP1H5DT    WBH5DT           Last G/L Post D
     C                     Z-ADDP1ANC7    WBANC7           A/R Customer Nu
     C                     MOVELP1CPTX    WBCPTX           A/R Check Numbe
     C                     Z-ADD*ZERO     WBBSDY           Days to Pay
     C                     MOVELP1UVST    WBUVST           EDI Status 1
     C                     MOVELP1UWST    WBUWST           EDI Status 2
     C                     MOVELP1UXST    WBUXST           EDI Status 3
      *
      * USER: Processing before Data update
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
     C           KLCRSB    KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBCONB           Invoice Number
     C                     KFLD           WBCEST           Invoice Suffix
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BDCPFG                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR0175' W0RTN   7
      * Send message 'A/R Header             EX'
     C                     MOVEL'USR0175' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@BDCPFG                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * E6933 DN  08/12/16 - Create A/R Header Ext record.
      * Crt A/R Header Ext    XF - A/R Header Ext  * 
     C                     CALL 'PBX3XFR'              90  Crt A/R Header
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WBAIC3    WQ0001  30       Company Number
     C                     PARM WBCONB    WQ0002  70       Invoice Number
     C                     PARM WBCEST    WQ0003  2        Invoice Suffix
     C                     PARM WBBGVA    WQ0004 112       Remaining Balan
     C                     PARM WBCAC7    WQ0005  70       Order Number Re
     C                     PARM WBH3DT    WQ0006  70       Original Inv fo
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBX3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * E6933 DN  08/12/16 - Create A/R Header Ext record.
      * - Modified CRT A/R Header         CO - A/R Header.
      * ** E00351 LJB 04/22/2009
      * ** Don't create the A/R Header and Detail records for IP customer
      * ** for Daily's transactions between MSLA and SLC
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1AATM           Job Time
     C                     MOVEL*BLANK    P1AYNA           User Id
     C                     MOVEL*BLANK    P1A0NA           Job Name
     C                     Z-ADD*ZERO     P1AXDT           Job Date
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAR5NB           Deliver after t
     C                     Z-ADD*ZERO     WAR6NB           Deliver before
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAMTCU           Mileage To Cust
     C                     Z-ADD*ZERO     WAW2NB           Co/Cust Overage
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBCONB           Invoice Number
     C                     Z-ADD*ZERO     WBBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WBAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WBAOVA           Amount Paid
     C                     Z-ADD*ZERO     WBBGVA           Remaining Balan
     C                     Z-ADD*ZERO     WBCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WBCAC7           Order Number Re
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WBATDT           Due Date
     C                     Z-ADD*ZERO     WBH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WBH3DT           Original Inv fo
     C                     Z-ADD*ZERO     WBH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WBH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WBANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WBBSDY           Days to Pay
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Type Code
     C                     MOVEL*BLANK    YL0001  2
      *================================================================
     CSR         ZZEXIT    ENDSR
