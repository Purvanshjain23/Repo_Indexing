/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  THIS CL IS CALLED FROM THE PRINT CUSTOMER STATEMNTS */
/*              STATEMENTS MENU OPTION AND WEEKLY BATCH RUN.        */
/*              THE CL WILL CALL CL THAT WILL PRINT STATEMNT AND    */
/*              RETURN HERE TO FAX AND/OR EMAIL IT.                 */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - FAX CUSTOMER A/R STATEMENT                          */
/*  DATE      - 08/12/02                                            */
/*                                                                  */
/* PARAMETERS:                                                      */
/* &RETURN     - RETURN CODE                                        */
/* &PGM        - CL PROGRAM TO SUBMIT                               */
/* &COMPNYN    - COMPANY NUMBER (PASSED)                            */
/* &CUSTNBR    - CUSTOMER NUMBER (PASSED)                           */
/* &JOBCDE     - JOB NAME CODE                                      */
/* &CRDFLAG    - USE CREDIT CONTACT INFO (PASSED)                   */
/* &CREDIT     - INCLUDE NEG BALANCES                               */
/* &CHARGE     - INCLUDE CHARGEBACKS                                */
/* &REBILL     - INCLUDE REBILLS                                    */
/* &STMTTP     - A=AGED STMT, N=NOT AGED                            */
/*                                                                  */
/********************************************************************/
/*  REVISIONS                                                       */
/*  RMC 04/28/05 REMOVE COMPANY FROM PAR TO AR605CLP                */
/* 8/30/05  RMC        NEW PARM &PRTCO - PRINT CO ON STMT           */
/* 7/11/06  SLM        *NOTE ADD 8/30/05 BACK IN FOR FAX            */
/*                     HALTED DURING TESTING OF CUSTOMER STATMENT   */
/*                     PROBLEM L060606.                             */
/*                     THE &PRTCO WILL BE SENT TO AR605CLP AS       */
/*                     *BLANKS, FAXING TO THE CUSTOMER WILL         */
/*                     NOT NEED TO PRINT THE CUSTOMER NUMBER        */
/*                     ON THE FAX                                   */
/* 05/17/2007 LJB DLY029  REMOVED UNUSED COVER SHEET NAME PARM      */
/*                     COMPANY NUMBER NEEDS TO BE PASSED TO THE FAX */
/*                     PROGRAM. NEW COMPANY DOCUMENT DEFAULTS FILE  */
/*                     NOW STORES PRINT FILES AND OVERLAY INFO      */
/*                     BY COMPANY NUMBER.                           */
/* 04/01/2010 LJB P000198   STATEMENTS CAN NOW BE FAXED OR EMAILED  */
/*                     TO ONE OR MORE NUMBERS.   THESE NUMBERS      */
/*                     ARE STORED IN CUST DISTRIBUTION ENTRY FILE.  */
/*                     ADD DRAWER IN CALL TO AR605CLP. DEFAULT=1.   */
/*                     A/R CUSTOMER NUMBER IS PASSED IN.            */
/* 05/01/2012 LJB E000909   THIS IS NOW CALLED FROM PORGXFR WHICH   */
/*   IS A BATCH PROGRAM SO ADDITIONAL PARMS NEED TO BE PASSED       */
/*   THAT ARE NOT ON THE SCREEN.                                    */
/* 05/30/2012 LJB E002121   SONI WANTS MORE CONTROL OVER THE PRINT  */
/*   FAX AND EMAIL OPTIONS. SHE WANTS IT CONTROLLED FROM THE CUST   */
/*   DISTRIBUTION ENTRY FILE, EVEN FOR THE JOB SCHEDULER. REMOVE    */
/*   PRTFAX AND ADD IN SEPARATE FLAGS FOR PRINT, FAX, EMAIL.        */
/*   MOVE CALL TO POQ2XFR TO AR605CLP SO REPORT ISN'T CREATED       */
/*   FOR EACH SEND TYPE.                                            */
/* 07/09/2012 LJB E002169   FOR JOB SCHEDULER JOBS, DON'T RETRIEVE  */
/*   THE OUTQ, USE THE PASSED IN PER HELEN CRAW. (CHANGED FROM      */
/*   ROB WALLACE'S REQUEST)                                         */
/* 06/14/2016 JBB E5262  Added Include Rebills flag to *ENTRY       */
/*                       and passed value to another CL program.    */
/* 01/08/2018 RMC S12271 FIX PRINTING STMTS FROM JOB SCHED           */
/********************************************************************/
 POQ1UPC:    PGM        PARM(&OUTQ &HOLD &SAVE &COMPNYN &CUSTNBR +
                          &COPYN &CREDIT &CHARGE &CUSTNM &STMTTP +
                          &CRDFLAG &FAX &PRINT &EMAIL &PRTCO +
                          &COMPORG &JOBSCHED &AROUTQ &DRAWER +
                          &DISTCODE &RECSTS &REBILL)
/* PARMS                                                                      */
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMPNYN) TYPE(*DEC)
             DCL        VAR(&CUSTNBR) TYPE(*DEC)
/*********   DCL        VAR(&JOBCDE) TYPE(*CHAR) LEN(10)   **********/
             DCL        VAR(&CRDFLAG) TYPE(*CHAR) LEN(01)
             DCL        VAR(&CREDIT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&CHARGE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&REBILL) TYPE(*CHAR) LEN(1)
             DCL        VAR(&STMTTP) TYPE(*CHAR) LEN(1)
/*****       DCL        VAR(&PRTFAX) TYPE(*CHAR) LEN(1)   *********/
             DCL        VAR(&PRTCO) TYPE(*CHAR) LEN(1)
             DCL        VAR(&OUTQ) TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL        VAR(&COPYN) TYPE(*DEC)
             DCL        VAR(&COMPANY) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&CUSTNM) TYPE(*CHAR) LEN(30)
             DCL        VAR(&CUSTNO) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&DRAWER) TYPE(*CHAR) LEN(1)
             DCL        VAR(&AROUTQ) TYPE(*CHAR) LEN(10)
             DCL        VAR(&COMPORG) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DRAWER) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FAX) TYPE(*CHAR) LEN(1)
             DCL        VAR(&PRINT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(1)
             DCL        VAR(&JOBSCHED) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DISTTYPE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&DISTCODE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DISTSEQ) TYPE(*DEC) LEN(3 0) VALUE(1)
             DCL        VAR(&NAME) TYPE(*CHAR) LEN(30)
             DCL        VAR(&DESTINAT) TYPE(*CHAR) LEN(30)
             DCL        VAR(&RECSTS) TYPE(*CHAR) LEN(1)

/* INTERNAL FIELDS                                                            */
             DCL        VAR(&MSG) TYPE(*CHAR) LEN(512) /* MESSAGE */
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7) /* MESSAGE ID */
             DCL        VAR(&MSGL) TYPE(*DEC) LEN(5 0)
             DCL        VAR(&APPLIC) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DESC)    TYPE(*CHAR) LEN(25)
             DCL        VAR(&OUTQ)    TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD)    TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE)    TYPE(*CHAR) LEN(4)
             DCL        VAR(&COPYN)   TYPE(*DEC)
             DCL        VAR(&COPY)    TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&NQSTAT)  TYPE(*CHAR) LEN(01)
             DCL        VAR(&NIGHTQ)  TYPE(*CHAR) LEN(10)

/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

             CHGJOB     LOG(4 0 *SECLVL) LOGCLPGM(*YES)
/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/
             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&CUSTNO) VALUE(&CUSTNBR)
/******      CHGVAR     VAR(&DRAWER) VALUE('1')         ************/
             CHGVAR     VAR(&DRAWER) VALUE(&DRAWER)
/* SEND IN BLANKS ON PRTCO  DO NOT WANT COMPANY NUMBER ON FAX        */
             CHGVAR     VAR(&PRTCO) VALUE(' ')

/* RETRIEVE PRINTER FROM CUST DISTRIBUTION ENTRY FILE, IF ONE IS */
/* THERE, ALLOW TO BE CHANGED IF THEY WANT TO.                   */
             CHGVAR     VAR(&DISTTYPE) VALUE('P')
             CALL       PGM(PBDUXFR) PARM('' &CUSTNO &DISTCODE +
                          &DISTSEQ &NAME &DISTTYPE &DESTINAT &RECSTS)

             IF         COND(&DESTINAT *NE '      ') THEN(CHGVAR +
                          VAR(&OUTQ) VALUE(&DESTINAT))
             IF         COND(&DESTINAT *EQ '      ') THEN(CHGVAR +
                          VAR(&OUTQ) VALUE('      '))

/* IF CALLED FROM THE JOB SCHEDULER SKIP PROMPT FOR PRINTER OPTIONS */
             IF         COND(&JOBSCHED *EQ 'Y') THEN(GOTO +
                          CMDLBL(PRINTSTMT))

   /* RMC MOVED THIS DOWN FROM ABOVE THE CALL PBDUXFR -- NEED TO CALL THAT +
     WHETHER IS JOB SCHD OR NOT SO OUTQ GETS SET TO BLANK IF CUST DOESNT HAVE +
     PRINT SPECIFIED ON THEIR SETTINGS   1/08/17   */
             IF         COND((&PRINT *EQ 'Y') *OR (&JOBSCHED *NE +
                          'Y')) THEN(DO)

/* Call Print Options Prompt Program - SETUP PRINT OPTION PARAMETERS */
             CHGVAR VAR(&RETURN) VALUE(' ')
             CHGVAR VAR(&DESC)   VALUE('A/R Aging by as of Date')
             CHGVAR VAR(&HOLD)   VALUE(' ')
             CHGVAR VAR(&SAVE)   VALUE(' ')
             CHGVAR VAR(&COPY)   VALUE(0)
             CHGVAR VAR(&NQSTAT) VALUE('N')
             CHGVAR VAR(&NIGHTQ) VALUE(' ')

/* Call print option prompt                                          */
             CALL       PGM(PDG0PVR) PARM(&RETURN &DESC &OUTQ &HOLD +
                          &SAVE &COPY &NQSTAT &NIGHTQ &APPLIC)
             IF         COND(&RETURN *NE '   ') THEN(GOTO +
                          CMDLBL(END))

             CHGVAR     VAR(&DESTINAT) VALUE(&OUTQ)
             CHGVAR     VAR(&COPYN) VALUE(&COPY)

             ENDDO   /* &PRINT EQ 'Y' */
/********************************************************************/
/* CREATE SPOOL FILE TO USER OUTQ OR A/R OUTQ-PRKPRT02 IF PRINT='Y'.*/
/* FAX IF REQUIRED. EMAIL IF REQUIRED.                              */
/********************************************************************/
/*********   CALL       PGM(AR605CLP) PARM(&COMPNYN &CUSTNBR &AROUTQ +
                          &COMPORG &CUSTNM &CREDIT &CHARGE &STMTTP +
                          &PRTFAX &OUTQ &HOLD &SAVE &COPYN &PRTCO +
                          &DRAWER)                        ************/

 PRINTSTMT:  CALL       PGM(AR605CLP) PARM(&COMPNYN &CUSTNBR &COPYN +
                          &AROUTQ &CUSTNM &CREDIT &CHARGE &REBILL +
                          &STMTTP &OUTQ &HOLD &SAVE &FAX &PRINT +
                          &EMAIL &PRTCO &COMPORG &JOBSCHED &DRAWER)

/* THE FOLLOWING IS NOW DONE IN AR605CLP                             */
/*******     IF         COND(&FAX *EQ 'Y') THEN(CALL PGM(POQ2XFR) +
                          PARM(&RETURN &COMPANY &CUSTNO &CRDFLAG +
                          &STMTTP))                                 +
             IF         COND(&EMAIL *EQ 'Y') THEN(CALL PGM(POQ2XFR) +
                          PARM(&RETURN &COMPANY &CUSTNO &CRDFLAG +
                          &STMTTP))                         **********/

/*----------------------RECEIVE MESSAGES----------------------------*/
 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))
             IF         COND(&MSGID *EQ ' ') THEN(GOTO +
                          CMDLBL(END))

             IF         COND(&MSG *EQ ' ') THEN(GOTO +
                          CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM
