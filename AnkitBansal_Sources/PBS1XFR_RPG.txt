     H/TITLE IJS PFS Prd Sch Bt Dt XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 11/19/19  Time  : 14:05:06
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPBB2CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index
      *
     FPBB1CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Dtl  Retrieval index
      *
     FPBB2CPL4IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index (2)
      *
     FPDKMREL1IF  E           K        DISK
      * RTV : Company Values            Retrieval index
      *
     FPBB2CPL0UF  E           K        DISK                      A
      * UPD : PFS Prod Sched Batch Hdr  Update index
      *
     FPBC3CPL0IF  E           K        DISK                      A
      * UPD : PFS Prod Sched Batch Cgn  Update index
      *
      * Long constants
     E                    @CN#    1  08  6   @CN    25
     E                    YDOW        7  1               *Days of week
     I@B2CPUP
      * PFS Prod Sched Batch Hdr  Update index
      * Renamed input format fields
     I              B2Y1NX                          WAY1NX
     I              B2ASD8                          WAASD8
     I              B2AOTS                          WAAOTS
     I              B2TVAA                          WATVAA
     I              B2B0SC                          WAB0SC
     I              B2ATD8                          WAATD8
     I              B2APTS                          WAAPTS
     I              B2UWSX                          WAUWSX
     I              B2UXSX                          WAUXSX
     I              B2V3SX                          WAV3SX
     I              B2AHNY                          WAAHNY
     I              B2AINY                          WAAINY
     I              B2AJNY                          WAAJNY
     I              B2AKNY                          WAAKNY
      *
     I@B2CPUQ
      * PFS Prod Sched Batch Hdr  Retrieval index
      * Renamed input format fields
     I              B2Y1NX                          WBY1NX
     I              B2ASD8                          WBASD8
     I              B2AOTS                          WBAOTS
     I              B2TVAA                          WBTVAA
     I              B2B0SC                          WBB0SC
     I              B2ATD8                          WBATD8
     I              B2APTS                          WBAPTS
     I              B2UWSX                          WBUWSX
     I              B2UXSX                          WBUXSX
     I              B2V3SX                          WBV3SX
     I              B2AHNY                          WBAHNY
     I              B2AINY                          WBAINY
     I              B2AJNY                          WBAJNY
     I              B2AKNY                          WBAKNY
      *
     I@B1CPUT
      * PFS Prod Sched Batch Dtl  Retrieval index
      * Renamed input format fields
     I              B1Y1NX                          WCY1NX
     I              B1ASD8                          WCASD8
     I              B1AOTS                          WCAOTS
     I              B1TVAA                          WCTVAA
     I              B1BTSQ                          WCBTSQ
     I              B1P7DT                          WCP7DT
     I              B1Y2NX                          WCY2NX
     I              B1U2SX                          WCU2SX
     I              B1ZPNX                          WCZPNX
     I              B1ZXNX                          WCZXNX
     I              B1CSSC                          WCCSSC
     I              B1ODQY                          WCODQY
     I              B1INAL                          WCINAL
     I              B1C6NB                          WCC6NB
     I              B1C8NB                          WCC8NB
     I              B1FLQ1                          WCFLQ1
     I              B1FLQ2                          WCFLQ2
     I              B1ZGNX                          WCZGNX
     I              B1ZWNX                          WCZWNX
     I              B1ZSNX                          WCZSNX
     I              B1ZJNX                          WCZJNX
     I              B1ZKNX                          WCZKNX
     I              B1DNNB                          WCDNNB
     I              B1DONB                          WCDONB
     I              B1DRNB                          WCDRNB
     I              B1U0SX                          WCU0SX
     I              B1BZSC                          WCBZSC
     I              B1B3SC                          WCB3SC
     I              B1B0SC                          WCB0SC
     I              B1VISX                          WCVISX
     I              B1ZLSX                          WCZLSX
     I              B1VGSX                          WCVGSX
     I              B1OJU1                          WCOJU1
     I              B1UWSX                          WCUWSX
     I              B1UXSX                          WCUXSX
     I              B1V3SX                          WCV3SX
     I              B1AHNY                          WCAHNY
     I              B1AINY                          WCAINY
     I              B1AJNY                          WCAJNY
     I              B1AKNY                          WCAKNY
      *
     I@C3CPY0
      * PFS Prod Sched Batch Cgn  Update index
      * Renamed input format fields
     I              C3Y1NX                          WDY1NX
     I              C3ASD8                          WDASD8
     I              C3AOTS                          WDAOTS
     I              C3TVAA                          WDTVAA
     I              C3BTSQ                          WDBTSQ
     I              C3P7DT                          WDP7DT
     I              C3Y2NX                          WDY2NX
     I              C3U2SX                          WDU2SX
     I              C3ZPNX                          WDZPNX
     I              C3ZXNX                          WDZXNX
     I              C3CSSC                          WDCSSC
     I              C3ODQY                          WDODQY
     I              C3INAL                          WDINAL
     I              C3C6NB                          WDC6NB
     I              C3C8NB                          WDC8NB
     I              C3FLQ1                          WDFLQ1
     I              C3FLQ2                          WDFLQ2
     I              C3ZGNX                          WDZGNX
     I              C3ZWNX                          WDZWNX
     I              C3ZSNX                          WDZSNX
     I              C3ZJNX                          WDZJNX
     I              C3ZKNX                          WDZKNX
     I              C3DNNB                          WDDNNB
     I              C3DONB                          WDDONB
     I              C3DRNB                          WDDRNB
     I              C3U0SX                          WDU0SX
     I              C3BZSC                          WDBZSC
     I              C3B3SC                          WDB3SC
     I              C3B0SC                          WDB0SC
     I              C3VISX                          WDVISX
     I              C3ZLSX                          WDZLSX
     I              C3VGSX                          WDVGSX
     I              C3OJU1                          WDOJU1
     I              C3UWSX                          WDUWSX
     I              C3UXSX                          WDUXSX
     I              C3V3SX                          WDV3SX
     I              C3AHNY                          WDAHNY
     I              C3AINY                          WDAINY
     I              C3AJNY                          WDAJNY
     I              C3AKNY                          WDAKNY
      *
     I@B2CPZE
      * PFS Prod Sched Batch Hdr  Retrieval index (2)
      * Renamed input format fields
     I              B2Y1NX                          WEY1NX
     I              B2ASD8                          WEASD8
     I              B2AOTS                          WEAOTS
     I              B2TVAA                          WETVAA
     I              B2B0SC                          WEB0SC
     I              B2ATD8                          WEATD8
     I              B2APTS                          WEAPTS
     I              B2UWSX                          WEUWSX
     I              B2UXSX                          WEUXSX
     I              B2V3SX                          WEV3SX
     I              B2AHNY                          WEAHNY
     I              B2AINY                          WEAINY
     I              B2AJNY                          WEAJNY
     I              B2AKNY                          WEAKNY
      *
     I@KMREHC
      * Company Values            Retrieval index
      * Renamed input format fields
     I              KMAIC3                          WFAIC3
     I              KMV8CD                          WFV8CD
     I              KMAUNA                          WFAUNA
     I              KMI5ST                          WFI5ST
     I              KMBXTX                          WFBXTX
     I              KMM8NB                          WFM8NB
     I              KMUVST                          WFUVST
     I              KMUWST                          WFUWST
     I              KMUXST                          WFUXST
     I              KMVSST                          WFVSST
     I              KMAATM                          WFAATM
     I              KMAYNA                          WFAYNA
     I              KMA0NA                          WFA0NA
     I              KMAXDT                          WFAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPBB21    E DSPBB2CPL0
      * UPD : PFS Prod Sched Batch Hdr  Update index
      * Renamed input format fields
     I              B2Y1NX                          WAY1NX
     I              B2ASD8                          WAASD8
     I              B2AOTS                          WAAOTS
     I              B2TVAA                          WATVAA
     I              B2B0SC                          WAB0SC
     I              B2ATD8                          WAATD8
     I              B2APTS                          WAAPTS
     I              B2UWSX                          WAUWSX
     I              B2UXSX                          WAUXSX
     I              B2V3SX                          WAV3SX
     I              B2AHNY                          WAAHNY
     I              B2AINY                          WAAINY
     I              B2AJNY                          WAAJNY
     I              B2AKNY                          WAAKNY
      *
     IYARDCS      DS                             78
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPBC31    E DSPBC3CPL0
      * UPD : PFS Prod Sched Batch Cgn  Update index
      * Renamed input format fields
     I              C3Y1NX                          WDY1NX
     I              C3ASD8                          WDASD8
     I              C3AOTS                          WDAOTS
     I              C3TVAA                          WDTVAA
     I              C3BTSQ                          WDBTSQ
     I              C3P7DT                          WDP7DT
     I              C3Y2NX                          WDY2NX
     I              C3U2SX                          WDU2SX
     I              C3ZPNX                          WDZPNX
     I              C3ZXNX                          WDZXNX
     I              C3CSSC                          WDCSSC
     I              C3ODQY                          WDODQY
     I              C3INAL                          WDINAL
     I              C3C6NB                          WDC6NB
     I              C3C8NB                          WDC8NB
     I              C3FLQ1                          WDFLQ1
     I              C3FLQ2                          WDFLQ2
     I              C3ZGNX                          WDZGNX
     I              C3ZWNX                          WDZWNX
     I              C3ZSNX                          WDZSNX
     I              C3ZJNX                          WDZJNX
     I              C3ZKNX                          WDZKNX
     I              C3DNNB                          WDDNNB
     I              C3DONB                          WDDONB
     I              C3DRNB                          WDDRNB
     I              C3U0SX                          WDU0SX
     I              C3BZSC                          WDBZSC
     I              C3B3SC                          WDB3SC
     I              C3B0SC                          WDB0SC
     I              C3VISX                          WDVISX
     I              C3ZLSX                          WDZLSX
     I              C3VGSX                          WDVGSX
     I              C3OJU1                          WDOJU1
     I              C3UWSX                          WDUWSX
     I              C3UXSX                          WDUXSX
     I              C3V3SX                          WDV3SX
     I              C3AHNY                          WDAHNY
     I              C3AINY                          WDAINY
     I              C3AJNY                          WDAJNY
     I              C3AKNY                          WDAKNY
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  PFS Company Number
     I                                        1   30P1Y1NX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1Y1NX    PARM           WP0001  30       PFS Company Num
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * IJS PFS Prd Sch Bt Dt XF
      * Convert PFS Change Date to YYYYMMDD
      * Rtv System Date *CYMD IF
      * LCL.*System timestamp = JOB.*System timestamp
     C                     EXSR XSTMS
     C                     MOVEL##TMS     YL0002           *System timesta
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0003    P  90  Year USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD6         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0004    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0005    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD0         ZQ      50
     C           YL0003    CAT  YL0004:ZQ YL0006    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           YL0006    CAT  YL0005:ZQ YL0006    P      Date (Char-8) U
     C                     MOVE YL0006    YL0007           DATE
      *
     C                     Z-ADD*ZERO     WN0001  40       Year Code
     C                     Z-ADD*ZERO     WN0002  20       Month
     C                     Z-ADD*ZERO     WN0003  20       Day of Month US
     C                     MOVEL*BLANK    WN0004  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0005  2        Month (Char) US
     C                     MOVEL*BLANK    WN0006  2        Day   (Char) US
     C                     Z-ADD*ZERO     WN0007  20       Year  NBR USR
     C                     MOVEL*BLANK    WN0008  2        Year  (Char) US
     C                     MOVEL*BLANK    WN0009  7        Date (Alpha) US
      *
      * CVT *YYMD to *CYMD    IF
      * ** YEAR **
     C           YL0007    DIV  10000     WN0001           Year Code
     C                     Z-ADDWN0001    WN0007           Year  NBR USR
     C                     MOVELWN0007    WN0008           Year  (Char) US
      * ** MONTH **
     C           YL0007    DIV  100       WN0002           Month
     C                     MOVELWN0002    WN0005           Month (Char) US
      * ** DAY **
     C                     Z-ADDYL0007    WN0003           Day of Month US
     C                     MOVELWN0003    WN0006           Day   (Char) US
      * CENTURY+YEAR
      * CASE: PAR.Year Code is Twentieth Century
     C           WN0001    IFLE 1999                       *IF
     C                     Z-ADD0         ZQ      50
     C           '0'       CAT  WN0008:ZQ WN0009    P      Date (Alpha) US
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD0         ZQ      50
     C           '1'       CAT  WN0008:ZQ WN0009    P      Date (Alpha) US
     C                     END                             *FI
     C                     Z-ADD0         ZQ      50
     C           WN0009    CAT  WN0005:ZQ WN0009    P      Date (Alpha) US
     C                     Z-ADD0         ZQ      50
     C           WN0009    CAT  WN0006:ZQ WN0009    P      Date (Alpha) US
     C                     MOVE WN0009    YL0001           Date
      *
     C                     MOVEL*BLANK    WN0010  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0011  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0012  2        Month (Char) US
     C                     MOVEL*BLANK    WN0013  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           YL0001    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0009
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           YL0001    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0010
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           YL0001    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0011
     C                     MOVEL*BLANK    WN0011           Year Alpha (YYY
     C                     MOVELYL0009    WN0011           Year Alpha (YYY
     C                     MOVELYL0010    WN0012           Month (Char) US
     C                     MOVELYL0011    WN0013           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0011    CAT  WN0012:ZQ WN0010    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0010    CAT  WN0013:ZQ WN0010    P      Date (Char-8) U
     C                     MOVE WN0010    YL0008           Date Out (8,0)
      * Initialize PFS Prod Sched Batch Dtl fields
     C                     Z-ADD##JTM     YL0012           PFS Batch Time
     C                     MOVEL##USR     YL0013           PFS User ID
     C                     MOVEL'B'       YL0014           PFS Baseline Sc
     C                     MOVEL'A'       YL0015           PFS Record Stat
     C                     Z-ADD*ZERO     YL0016           PFS Process Sta
     C                     MOVEL*BLANK    YL0017           PFS Error Reaso
     C                     Z-ADDYL0008    YL0018           PFS Create Date
     C                     Z-ADDYL0012    YL0019           PFS Create Time
      * Create PFS Prod Sched Batch Hdr
      * Crt PFS Prd Sch Bt Hd CR - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SACRRC
      * Create PFS Prod Sched Batch Sel records for all Company Items
      * Crt PFS Prd Sch Bt Sl XF - Company Item  * 
     C                     CALL 'PBSCXFR'              90  Crt PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1Y1NX    WQ0001  30       Company Number
     C                     PARM YL0008    WQ0002  80       PFS Batch Date
     C                     PARM YL0012    WQ0003  60       PFS Batch Time
     C                     PARM YL0013    WQ0004 10        PFS User ID
     C                     PARM YL0018    WQ0005  80       PFS Create Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSCXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Convert PFS Change Date to YYYYMMDD
      * Rtv System Date *CYMD IF
      * LCL.*System timestamp = JOB.*System timestamp
     C                     EXSR XSTMS
     C                     MOVEL##TMS     YL0002           *System timesta
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0003    P  90  Year USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD6         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0004    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00026
     C           ZQ        ORGT 00026
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0002:ZQ YL0005    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD0         ZQ      50
     C           YL0003    CAT  YL0004:ZQ YL0006    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           YL0006    CAT  YL0005:ZQ YL0006    P      Date (Char-8) U
     C                     MOVE YL0006    YL0007           DATE
      *
     C                     Z-ADD*ZERO     WN0014  40       Year Code
     C                     Z-ADD*ZERO     WN0015  20       Month
     C                     Z-ADD*ZERO     WN0016  20       Day of Month US
     C                     MOVEL*BLANK    WN0017  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0018  2        Month (Char) US
     C                     MOVEL*BLANK    WN0019  2        Day   (Char) US
     C                     Z-ADD*ZERO     WN0020  20       Year  NBR USR
     C                     MOVEL*BLANK    WN0021  2        Year  (Char) US
     C                     MOVEL*BLANK    WN0022  7        Date (Alpha) US
      *
      * CVT *YYMD to *CYMD    IF
      * ** YEAR **
     C           YL0007    DIV  10000     WN0014           Year Code
     C                     Z-ADDWN0014    WN0020           Year  NBR USR
     C                     MOVELWN0020    WN0021           Year  (Char) US
      * ** MONTH **
     C           YL0007    DIV  100       WN0015           Month
     C                     MOVELWN0015    WN0018           Month (Char) US
      * ** DAY **
     C                     Z-ADDYL0007    WN0016           Day of Month US
     C                     MOVELWN0016    WN0019           Day   (Char) US
      * CENTURY+YEAR
      * CASE: PAR.Year Code is Twentieth Century
     C           WN0014    IFLE 1999                       *IF
     C                     Z-ADD0         ZQ      50
     C           '0'       CAT  WN0021:ZQ WN0022    P      Date (Alpha) US
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD0         ZQ      50
     C           '1'       CAT  WN0021:ZQ WN0022    P      Date (Alpha) US
     C                     END                             *FI
     C                     Z-ADD0         ZQ      50
     C           WN0022    CAT  WN0018:ZQ WN0022    P      Date (Alpha) US
     C                     Z-ADD0         ZQ      50
     C           WN0022    CAT  WN0019:ZQ WN0022    P      Date (Alpha) US
     C                     MOVE WN0022    YL0001           Date
      *
     C                     MOVEL*BLANK    WN0023  8        Date (Char-8) U
     C                     MOVEL*BLANK    WN0024  4        Year Alpha (YYY
     C                     MOVEL*BLANK    WN0025  2        Month (Char) US
     C                     MOVEL*BLANK    WN0026  2        Day   (Char) US
      *
      * CNV cyymmdd to yyyymmdd
      * LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
     C           YL0001    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    YL0009
      * LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
     C           YL0001    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    YL0010
      * LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
     C           YL0001    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     YL0011
     C                     MOVEL*BLANK    WN0024           Year Alpha (YYY
     C                     MOVELYL0009    WN0024           Year Alpha (YYY
     C                     MOVELYL0010    WN0025           Month (Char) US
     C                     MOVELYL0011    WN0026           Day   (Char) US
     C                     Z-ADD0         ZQ      50
     C           WN0024    CAT  WN0025:ZQ WN0023    P      Date (Char-8) U
     C                     Z-ADD0         ZQ      50
     C           WN0023    CAT  WN0026:ZQ WN0023    P      Date (Char-8) U
     C                     MOVE WN0023    YL0020           Date Out (8,0)
      * Create PFS Prod Sched Batch Dtl
      * Snd PFS Prd Sch Bt Dt XF - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PBSGXFR'              90  Snd PFS Prd Sch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1Y1NX    WQ0006  30       PFS Company Num
     C                     PARM YL0008    WQ0007  80       PFS Batch Date
     C                     PARM YL0012    WQ0008  60       PFS Batch Time
     C                     PARM YL0013    WQ0009 10        PFS User ID
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBSGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Convert Numeric Fields to Alpha Fields
     C                     MOVELP1Y1NX    YL0021           PFS Company Num
     C                     MOVELYL0008    YL0022           PFS Batch Date
     C                     MOVELYL0012    YL0023           PFS Batch Time
      * CPYF PBB1CPP to PBB1CPPGUY or PBB1CPPSTJ
      * IJS PFS Prd Sch Bt Dt CL - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PBS3UPR'              90  IJS PFS Prd Sch
     C                     PARM YL0021    WQ0010  3        PFS Company Num
     C                     PARM YL0022    WQ0011  8        PFS Batch Date
     C                     PARM YL0023    WQ0012  6        PFS Batch Time
     C                     PARM YL0013    WQ0013 10        PFS User ID
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBS3UPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Update PFS Prod Sched Batch Hdr
      * Chg PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SBRVGN
      * R9441 JJH 03/01/17 - Create PFS Prod Sched Cgn
      * Create PFS Prod Sched Batch Cgn
      * Crt PFS PrdSchBtCg Bs RT - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SDRVGN
      * R12915 DN 04/18/18-Send Email if 1st Baseline Prod Sched has been
      * CASE: *OTHERWISE
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SFRVGN
      * CASE: LCL.PFS Baseline Schedule Cnt is Equal (1)
     C           YL0024    IFEQ 1                          *IF
      * Format Email Subject & Message and Send Email.
      * CASE: *OTHERWISE
     C                     Z-ADD1         ZQ      50
     C           'Co'      CAT  YL0021:ZQ YL0026    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           YL0026    CAT  @CN,002:ZQYL0026    P      Email Subject U
     C                     Z-ADD0         ZQ      50
     C           YL0026    CAT  @CN,003:ZQYL0026    P      Email Subject U
     C                     Z-ADD0         ZQ      50
     C           @CN,004   CAT  @CN,005:ZQYL0027    P      Email Message U
     C                     Z-ADD0         ZQ      50
     C           YL0027    CAT  @CN,006:ZQYL0027    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0027    CAT  YL0021:ZQ YL0027    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0027    CAT  @CN,007:ZQYL0027    P      Email Message U
      * Format Batch Date.
      * CASE: *OTHERWISE
     C                     Z-ADD2         YRSW00
     C                     Z-ADD5         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0022:ZQ YL0028    P  90  Month (Char) US
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD7         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0022:ZQ YL0029    P  90  Day   (Char) US
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD4         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0022:ZQ YL0030    P  90  Year Alpha (YYY
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0028    CAT  '/':ZQ    YL0031    P      Date MM/DD/YYYY
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0031    CAT  YL0029:ZQ YL0031    P      Date MM/DD/YYYY
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0031    CAT  '/':ZQ    YL0031    P      Date MM/DD/YYYY
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0031    CAT  YL0030:ZQ YL0031    P      Date MM/DD/YYYY
     C                     Z-ADD1         ZQ      50
     C           YL0027    CAT  YL0031:ZQ YL0027    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0027    CAT  'at':ZQ   YL0027    P      Email Message U
      * Format Batch Time.
      * CASE: *OTHERWISE
     C                     Z-ADD2         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00006
     C           ZQ        ORGT 00006
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0023:ZQ YL0032    P  90  Hours  2A
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD3         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00006
     C           ZQ        ORGT 00006
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTYL0023:ZQ YL0033    P  90  Minutes  2A
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0032    CAT  ':':ZQ    YL0034    P      AS Time HH:MM
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0034    CAT  YL0033:ZQ YL0034    P      AS Time HH:MM
     C                     Z-ADD1         ZQ      50
     C           YL0027    CAT  YL0034:ZQ YL0027    P      Email Message U
     C                     Z-ADD0         ZQ      50
     C           YL0027    CAT  '.':ZQ    YL0027    P      Email Message U
      * Exc ESNDMAIL Generic  IF
      * Excecute ESNDMAIL to Send Email Message.
      * RTV Alpha Value 2     RT - Company Values  * Get Email Address
     C                     EXSR SGRVGN
      * CASE: LCL.Email Address is Entered
     C           YL0035    IFNE *BLANK                     *IF
      * Exc ESNDMAIL Generic  CL - /UT User Programs  * Send Email
     C                     CALL 'PUE8UPC'              90  Exc ESNDMAIL Ge
     C                     PARM YL0035    WQ0014 50        Email Address
     C                     PARM YL0026    WQ0015 50        Email Subject U
     C                     PARM YL0027    WQ0016256        Email Message U
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUE8UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACRRC    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Hd CR - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @B2CPUP
     C                     Z-ADDP1Y1NX    WAY1NX           PFS Company Num
     C                     Z-ADDYL0008    WAASD8           PFS Batch Date
     C                     Z-ADDYL0012    WAAOTS           PFS Batch Time
     C                     MOVELYL0013    WATVAA           PFS User ID
     C                     MOVELYL0014    WAB0SC           PFS Baseline Sc
     C                     Z-ADD*ZERO     WAATD8           PFS Batch Sent
     C                     Z-ADD*ZERO     WAAPTS           PFS Batch Sent
     C                     MOVELYL0015    WAUWSX           PFS Record Stat
     C                     Z-ADDYL0016    WAUXSX           PFS Process Sta
     C                     MOVELYL0017    WAV3SX           PFS Error Reaso
     C                     Z-ADDYL0018    WAAHNY           PFS Create Date
     C                     Z-ADDYL0019    WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      *
     C           KLCRSA    KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAASD8           PFS Batch Date
     C                     KFLD           WAAOTS           PFS Batch Time
     C                     KFLD           WATVAA           PFS User ID
      * Check for duplicate primary key
     C           KLCRSA    SETLL@B2CPUP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR4807' W0RTN   7
      * Send message 'PFS Prod Sched Batch H EX'
     C                     MOVEL'USR4807' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C                     WRITE@B2CPUP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Chg PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBY1NX           PFS Company Num
     C                     KFLD           WBASD8           PFS Batch Date
     C                     KFLD           WBAOTS           PFS Batch Time
     C                     KFLD           WBTVAA           PFS User ID
      * Setup key
     C                     Z-ADDP1Y1NX    WBY1NX           PFS Company Num
     C                     Z-ADDYL0008    WBASD8           PFS Batch Date
     C                     Z-ADDYL0012    WBAOTS           PFS Batch Time
     C                     MOVELYL0013    WBTVAA           PFS User ID
      * Establish starting position
     C           KRSSB     CHAIN@B2CPUQ              90    *
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg PFS Prd Sch Bt Hd CH - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SCCHRC
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg PFS Prd Sch Bt Hd CH - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @B2CPUP
     C                     Z-ADDWBY1NX    WAY1NX           PFS Company Num
     C                     Z-ADDWBASD8    WAASD8           PFS Batch Date
     C                     Z-ADDWBAOTS    WAAOTS           PFS Batch Time
     C                     MOVELWBTVAA    WATVAA    P      PFS User ID
      *
     C           KLCHSC    KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAASD8           PFS Batch Date
     C                     KFLD           WAAOTS           PFS Batch Time
     C                     KFLD           WATVAA           PFS User ID
     C           KLCHSC    CHAIN@B2CPUP              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PBB2CPL0'MDACP
     C                     MOVEL'@B2CPUP' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPBB21    YARDCS
      * Move non-key fields to @B2CPUP
     C                     MOVELWBB0SC    WAB0SC    P      PFS Baseline Sc
     C                     Z-ADDYL0008    WAATD8           PFS Batch Sent
     C                     Z-ADDYL0012    WAAPTS           PFS Batch Sent
     C                     MOVELWBUWSX    WAUWSX    P      PFS Record Stat
     C                     Z-ADD9         WAUXSX           PFS Process Sta
     C                     MOVELWBV3SX    WAV3SX    P      PFS Error Reaso
     C                     Z-ADDWBAHNY    WAAHNY           PFS Create Date
     C                     Z-ADDWBAINY    WAAINY           PFS Create Time
     C                     Z-ADDYL0018    WAAJNY           PFS Change Date
     C                     Z-ADDYL0019    WAAKNY           PFS Change time
      *
      * Set PGM.*Record Data Changed flag
     C           QPBB21    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@B2CPUP                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPBB2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Crt PFS PrdSchBtCg Bs RT - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * The purpose of this RTVOBJ is to populate the PFS Prod Sched
      * Batch Cgn file with every record from the PFS Prod Batch Dtl
      * whenever the INVBUILDPS job runs.
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCY1NX    WQSD01           PFS Company Num
     C           *LIKE     DEFN WCASD8    WQSD02           PFS Batch Date
     C           *LIKE     DEFN WCAOTS    WQSD03           PFS Batch Time
     C           *LIKE     DEFN WCTVAA    WQSD04           PFS User ID
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           PFS Company Num
     C                     KFLD           WQSD02           PFS Batch Date
     C                     KFLD           WQSD03           PFS Batch Time
     C                     KFLD           WQSD04           PFS User ID
      * Setup key
     C                     Z-ADDP1Y1NX    WQSD01           PFS Company Num
     C                     Z-ADDYL0008    WQSD02           PFS Batch Date
     C                     Z-ADDYL0012    WQSD03           PFS Batch Time
     C                     MOVELYL0013    WQSD04           PFS User ID
      * Establish starting position
     C           KRSSD     SETLL@B1CPUT                    *
     C           KRSSD     READE@B1CPUT                  90*
      * Data record not found
     C   90                MOVEL'USR4804' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * R15794 DN 11/19/19-Set New Fields.
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
     C                     EXSR SECRRC
     C           KRSSD     READE@B1CPUT                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Dt Cg - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @C3CPY0
     C                     Z-ADDWCY1NX    WDY1NX           PFS Company Num
     C                     Z-ADDWCASD8    WDASD8           PFS Batch Date
     C                     Z-ADDWCAOTS    WDAOTS           PFS Batch Time
     C                     MOVELWCTVAA    WDTVAA           PFS User ID
     C                     Z-ADDWCBTSQ    WDBTSQ           PFS Batch Seq
     C                     Z-ADDWCP7DT    WDP7DT           PFS Production
     C                     Z-ADDWCY2NX    WDY2NX           PFS Item Code
     C                     MOVELWCU2SX    WDU2SX           PFS Label Type
     C                     Z-ADDWCZPNX    WDZPNX           PFS Order Numbe
     C                     Z-ADDWCZXNX    WDZXNX           PFS Order Line
     C                     MOVELWCCSSC    WDCSSC           PFS Order Line
     C                     Z-ADDWCODQY    WDODQY           PFS Ordered Qty
     C                     Z-ADDWCINAL    WDINAL           PFS Inventory A
     C                     Z-ADDWCC6NB    WDC6NB           PFS Fill Qty Pr
     C                     Z-ADDWCC8NB    WDC8NB           PFS Fill Qty Sh
     C                     Z-ADDWCFLQ1    WDFLQ1           PFS Fill Qty Sh
     C                     Z-ADDWCFLQ2    WDFLQ2           PFS Fill Qty Sh
     C                     Z-ADDWCZGNX    WDZGNX           PFS Load ID
     C                     Z-ADDWCZWNX    WDZWNX           PFS Loading Seq
     C                     Z-ADDWCZSNX    WDZSNX           PFS Scheduled S
     C                     Z-ADDWCZJNX    WDZJNX           PFS Load Deadli
     C                     Z-ADDWCZKNX    WDZKNX           PFS Load Deadli
     C                     Z-ADDWCDNNB    WDDNNB           PFS Item Struct
     C                     Z-ADDWCDONB    WDDONB           PFS Item Struct
     C                     Z-ADDWCDRNB    WDDRNB           PFS Item Struct
     C                     MOVELWCU0SX    WDU0SX           PFS Primary UOM
     C                     MOVELWCBZSC    WDBZSC           PFS Fresh/Froze
     C                     MOVELWCB3SC    WDB3SC           PFS Base/Conver
     C                     MOVELWCB0SC    WDB0SC           PFS Baseline Sc
     C                     MOVELWCVISX    WDVISX           PFS Palletize
     C                     MOVELWCZLSX    WDZLSX           PFS Pallet Type
     C                     MOVELWCVGSX    WDVGSX           PFS Slip Sheet
     C                     MOVELWCOJU1    WDOJU1           PFS Customer Na
     C                     MOVELWCUWSX    WDUWSX           PFS Record Stat
     C                     Z-ADDWCUXSX    WDUXSX           PFS Process Sta
     C                     MOVELWCV3SX    WDV3SX           PFS Error Reaso
     C                     Z-ADDWCAHNY    WDAHNY           PFS Create Date
     C                     Z-ADDWCAINY    WDAINY           PFS Create Time
     C                     Z-ADDWCAJNY    WDAJNY           PFS Change Date
     C                     Z-ADDWCAKNY    WDAKNY           PFS Change time
      *
     C           KLCRSE    KLIST
     C                     KFLD           WDY1NX           PFS Company Num
     C                     KFLD           WDASD8           PFS Batch Date
     C                     KFLD           WDAOTS           PFS Batch Time
     C                     KFLD           WDTVAA           PFS User ID
     C                     KFLD           WDBTSQ           PFS Batch Seq
      * Check for duplicate primary key
     C           KLCRSE    SETLL@C3CPY0                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR4966' W0RTN   7
      * Send message 'PFS Prod Sched Batch C EX'
     C                     MOVEL'USR4966' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@C3CPY0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0025           PFS Baseline Sc
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEY1NX    WQSF01           PFS Company Num
     C           *LIKE     DEFN WEASD8    WQSF02           PFS Batch Date
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           PFS Company Num
     C                     KFLD           WQSF02           PFS Batch Date
      * Setup key
     C                     Z-ADDP1Y1NX    WQSF01           PFS Company Num
     C                     Z-ADDYL0008    WQSF02           PFS Batch Date
      * Establish starting position
     C           KRSSF     SETLL@B2CPZE                    *
     C           KRSSF     READE@B2CPZE                  90*
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Baseline Schedule is Baseline
     C           WEB0SC    IFEQ 'B'                        *IF
     C                     ADD  1         YL0025           PFS Baseline Sc
     C                     END                             *FI
     C           KRSSF     READE@B2CPZE                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     Z-ADDYL0025    YL0024           PFS Baseline Sc
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Alpha Value 2     RT - Company Values  * Get Email Address
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0035           System Value Al
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WFAIC3           Company Number
     C                     KFLD           WFV8CD           Company Value C
      * Setup key
     C                     Z-ADDP1Y1NX    WFAIC3           Company Number
     C                     MOVEL@CN,008   WFV8CD           Company Value C
      * Establish starting position
     C           KRSSG     CHAIN@KMREHC              90    *
      * Data record not found
     C   90                MOVEL'USR2221' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWFBXTX    YL0035           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         XSTMS     BEGSR
      *================================================================
      * Refresh System timestamp
      *================================================================
     C                     CALL 'Y2RTTSK'
     C                     PARM           ##TMS  26        System timestam
      *================================================================
     CSR         XSTMSE    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
     C                     MOVE '0'       XDTSDL 26 P
     C                     MOVEL@CN,001   XDTSDL
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WAAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WAATD8           PFS Batch Sent
     C                     Z-ADD*ZERO     WAAPTS           PFS Batch Sent
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WCASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WCAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WCBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WCP7DT           PFS Production
     C                     Z-ADD*ZERO     WCY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WCZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WCZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WCODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WCINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WCC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WCC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WCZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WCZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WCZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WCZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WCZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WCDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WCDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WCDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WCUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WCAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WCAINY           PFS Create Time
     C                     Z-ADD*ZERO     WCAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WCAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WDASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WDAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WDBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WDP7DT           PFS Production
     C                     Z-ADD*ZERO     WDY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WDZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WDZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WDODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WDINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WDC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WDC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WDZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WDZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WDZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WDZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WDDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WDDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WDDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WDUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WDAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WDAINY           PFS Create Time
     C                     Z-ADD*ZERO     WDAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WDAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFAIC3           Company Number
     C                     Z-ADD*ZERO     WFM8NB           System Value Nu
     C                     Z-ADD*ZERO     WFAATM           Job Time
     C                     Z-ADD*ZERO     WFAXDT           Job Date
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field System Date USR
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field *System timestamp
     C                     MOVELXDTSDL    YL0002 26
      * Define local work field Year USR
     C                     MOVEL*BLANK    YL0003  4
      * Define local work field Month USR
     C                     MOVEL*BLANK    YL0004  2
      * Define local work field Day USR
     C                     MOVEL*BLANK    YL0005  2
      * Define local work field Date (Char-8) USR
     C                     MOVEL*BLANK    YL0006  8
      * Define local work field DATE
     C                     Z-ADD*ZERO     YL0007  80
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0008  80
      * Define local work field Year Code
     C                     Z-ADD*ZERO     YL0009  40
      * Define local work field Month NBR USR
     C                     Z-ADD*ZERO     YL0010  20
      * Define local work field Day of Month USR
     C                     Z-ADD*ZERO     YL0011  20
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0012  60
      * Define local work field PFS User ID
     C                     MOVEL*BLANK    YL0013 10
      * Define local work field PFS Baseline Schedule
     C                     MOVEL*BLANK    YL0014  1
      * Define local work field PFS Record Status
     C                     MOVEL*BLANK    YL0015  1
      * Define local work field PFS Process Status
     C                     Z-ADD*ZERO     YL0016  10
      * Define local work field PFS Error Reason
     C                     MOVEL*BLANK    YL0017  6
      * Define local work field PFS Create Date
     C                     Z-ADD*ZERO     YL0018  80
      * Define local work field PFS Create Time
     C                     Z-ADD*ZERO     YL0019  60
      * Define local work field PFS Change Date
     C                     Z-ADD*ZERO     YL0020  80
      * Define local work field PFS Company Number Alpha
     C                     MOVEL*BLANK    YL0021  3
      * Define local work field PFS Batch Date Alpha
     C                     MOVEL*BLANK    YL0022  8
      * Define local work field PFS Batch Time Alpha
     C                     MOVEL*BLANK    YL0023  6
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0024  20
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0025  20
      * Define local work field Email Subject USR
     C                     MOVEL*BLANK    YL0026 50
      * Define local work field Email Message USR
     C                     MOVEL*BLANK    YL0027256
      * Define local work field Month (Char) USR
     C                     MOVEL*BLANK    YL0028  2
      * Define local work field Day   (Char) USR
     C                     MOVEL*BLANK    YL0029  2
      * Define local work field Year Alpha (YYYY) USR
     C                     MOVEL*BLANK    YL0030  4
      * Define local work field Date MM/DD/YYYY     USR
     C                     MOVEL*BLANK    YL0031 10
      * Define local work field Hours  2A            USR
     C                     MOVEL*BLANK    YL0032  2
      * Define local work field Minutes  2A          USR
     C                     MOVEL*BLANK    YL0033  2
      * Define local work field AS Time HH:MM
     C                     MOVEL*BLANK    YL0034  5
      * Define local work field Email Address
     C                     MOVEL*BLANK    YL0035 50
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 0001-01-01-00.00.00.00000
00002 Initial Baseline Product
00003 ion Sched Created
00004 The initial Baseline Prod
00005 uction Schedule was creat
00006 ed for Company
00007 on Batch Date/Time:
00008 PSBASELINE
