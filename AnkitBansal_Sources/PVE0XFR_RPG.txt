     H/TITLE Cnv Del Old OMFNCPP RcdXF Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 04/10/24  Time  : 15:19:05
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOMFNCPL1  IF   E           K DISK
      * RTV : Manifest Detail           Retrieval index
      *
     FOMFNCPL0  UF   E           K DISK
      * UPD : Manifest Detail           Update index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QOMFN1        E DS                  EXTNAME(OMFNCPL0)
      * UPD : Manifest Detail           Update index
      * Renamed input format fields
     D  WBAIC3       E                     EXTFLD(FNAIC3)
     D  WBC4NB       E                     EXTFLD(FNC4NB)
     D  WBDPNB       E                     EXTFLD(FNDPNB)
     D  WBUENB       E                     EXTFLD(FNUENB)
     D  WBRZNB       E                     EXTFLD(FNRZNB)
     D  WBFOQT       E                     EXTFLD(FNFOQT)
     D  WBR0NB       E                     EXTFLD(FNR0NB)
     D  WBPMST       E                     EXTFLD(FNPMST)
     D  WBK7DT       E                     EXTFLD(FNK7DT)
     D  WBPFNX       E                     EXTFLD(FNPFNX)
     D  WBHGCD       E                     EXTFLD(FNHGCD)
     D  WBAJCD       E                     EXTFLD(FNAJCD)
     D  WBELDT       E                     EXTFLD(FNELDT)
     D  WBN5WG       E                     EXTFLD(FNN5WG)
     D  WBRZNA       E                     EXTFLD(FNRZNA)
     D  WBH5NY       E                     EXTFLD(FNH5NY)
     D  WBH6NY       E                     EXTFLD(FNH6NY)
     D  WBH7NY       E                     EXTFLD(FNH7NY)
     D  WBGBTX       E                     EXTFLD(FNGBTX)
     D  WBN6WG       E                     EXTFLD(FNN6WG)
     D  WBN7WG       E                     EXTFLD(FNN7WG)
     D  WBGCTX       E                     EXTFLD(FNGCTX)
     D  WBGDTX       E                     EXTFLD(FNGDTX)
     D  WBRBDT       E                     EXTFLD(FNRBDT)
     D  WBITNY       E                     EXTFLD(FNITNY)
     D  WBIVNY       E                     EXTFLD(FNIVNY)
     D  WBIUNY       E                     EXTFLD(FNIUNY)
     D  WBIWNY       E                     EXTFLD(FNIWNY)
     D  WBIXNY       E                     EXTFLD(FNIXNY)
     D  WBIYNY       E                     EXTFLD(FNIYNY)
     D  WBUVST       E                     EXTFLD(FNUVST)
     D  WBUWST       E                     EXTFLD(FNUWST)
     D  WBUXST       E                     EXTFLD(FNUXST)
     D  WBVSST       E                     EXTFLD(FNVSST)
     D  WBAATM       E                     EXTFLD(FNAATM)
     D  WBAYNA       E                     EXTFLD(FNAYNA)
     D  WBA0NA       E                     EXTFLD(FNA0NA)
     D  WBAXDT       E                     EXTFLD(FNAXDT)
      *
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  Y0CX01         S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
     I@FNCPCT
      * Manifest Detail           Retrieval index
      * Renamed input format fields
     I              FNAIC3                      WAAIC3
     I              FNC4NB                      WAC4NB
     I              FNDPNB                      WADPNB
     I              FNUENB                      WAUENB
     I              FNRZNB                      WARZNB
     I              FNFOQT                      WAFOQT
     I              FNR0NB                      WAR0NB
     I              FNPMST                      WAPMST
     I              FNK7DT                      WAK7DT
     I              FNPFNX                      WAPFNX
     I              FNHGCD                      WAHGCD
     I              FNAJCD                      WAAJCD
     I              FNELDT                      WAELDT
     I              FNN5WG                      WAN5WG
     I              FNRZNA                      WARZNA
     I              FNH5NY                      WAH5NY
     I              FNH6NY                      WAH6NY
     I              FNH7NY                      WAH7NY
     I              FNGBTX                      WAGBTX
     I              FNN6WG                      WAN6WG
     I              FNN7WG                      WAN7WG
     I              FNGCTX                      WAGCTX
     I              FNGDTX                      WAGDTX
     I              FNRBDT                      WARBDT
     I              FNITNY                      WAITNY
     I              FNIVNY                      WAIVNY
     I              FNIUNY                      WAIUNY
     I              FNIWNY                      WAIWNY
     I              FNIXNY                      WAIXNY
     I              FNIYNY                      WAIYNY
     I              FNUVST                      WAUVST
     I              FNUWST                      WAUWST
     I              FNUXST                      WAUXST
     I              FNVSST                      WAVSST
     I              FNAATM                      WAAATM
     I              FNAYNA                      WAAYNA
     I              FNA0NA                      WAA0NA
     I              FNAXDT                      WAAXDT
      *
     I@FNCPCS
      * Manifest Detail           Update index
      * Renamed input format fields
     I              FNAIC3                      WBAIC3
     I              FNC4NB                      WBC4NB
     I              FNDPNB                      WBDPNB
     I              FNUENB                      WBUENB
     I              FNRZNB                      WBRZNB
     I              FNFOQT                      WBFOQT
     I              FNR0NB                      WBR0NB
     I              FNPMST                      WBPMST
     I              FNK7DT                      WBK7DT
     I              FNPFNX                      WBPFNX
     I              FNHGCD                      WBHGCD
     I              FNAJCD                      WBAJCD
     I              FNELDT                      WBELDT
     I              FNN5WG                      WBN5WG
     I              FNRZNA                      WBRZNA
     I              FNH5NY                      WBH5NY
     I              FNH6NY                      WBH6NY
     I              FNH7NY                      WBH7NY
     I              FNGBTX                      WBGBTX
     I              FNN6WG                      WBN6WG
     I              FNN7WG                      WBN7WG
     I              FNGCTX                      WBGCTX
     I              FNGDTX                      WBGDTX
     I              FNRBDT                      WBRBDT
     I              FNITNY                      WBITNY
     I              FNIVNY                      WBIVNY
     I              FNIUNY                      WBIUNY
     I              FNIWNY                      WBIWNY
     I              FNIXNY                      WBIXNY
     I              FNIYNY                      WBIYNY
     I              FNUVST                      WBUVST
     I              FNUWST                      WBUWST
     I              FNUXST                      WBUXST
     I              FNVSST                      WBVSST
     I              FNAATM                      WBAATM
     I              FNAYNA                      WBAYNA
     I              FNA0NA                      WBA0NA
     I              FNAXDT                      WBAXDT
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Cnv Del Old OMFNCPP RcdXF
      * Cnv Del Old OMFNCPP RcdRT - Manifest Detail  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Cnv Del Old OMFNCPP RcdRT - Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Establish starting position
     C     *LOVAL        SETLL     @FNCPCT                                      *
     C                   READ      @FNCPCT                                90    *
      * Data record not found
     C   90              MOVEL     'USR1196'     W0RTN
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Production Date is Less Than 1190701
      *   |- c2    : DB1.Production Date is entered
      *   '-
     C                   DOW       NOT *IN90
     C                   MOVEL     '0'           Y0CX01
     C                   IF        WAELDT < 1190701
     C                   IF        WAELDT <> 0
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
      * DLT OM Manifest Detail DL - Manifest Detail  * 
     C                   IF        Y0CX01 = '1'
     C                   EXSR      SBDLRC
     C                   END                                                    *FI
     C                   READ      @FNCPCT                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBDLRC        BEGSR
      *================================================================
      * DLT OM Manifest Detail DL - Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to @FNCPCS
     C                   Z-ADD     WAAIC3        WBAIC3                         Company Number
     C                   Z-ADD     WAC4NB        WBC4NB                         Order Number
     C                   Z-ADD     WADPNB        WBDPNB                         Order Sequence
     C                   Z-ADD     WAUENB        WBUENB                         Order Secondary
     C                   Z-ADD     WARZNB        WBRZNB                         Case Sequence N
      *
     C     KLDLSB        KLIST
     C                   KFLD                    WBAIC3                         Company Number
     C                   KFLD                    WBC4NB                         Order Number
     C                   KFLD                    WBDPNB                         Order Sequence
     C                   KFLD                    WBUENB                         Order Secondary
     C                   KFLD                    WBRZNB                         Case Sequence N
     C     KLDLSB        CHAIN     @FNCPCS                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'OMFNCPL0'    MDACP
     C                   MOVEL     '@FNCPCS'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    @FNCPCS                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      *
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WAC4NB                         Order Number
     C                   Z-ADD     *ZERO         WADPNB                         Order Sequence
     C                   Z-ADD     *ZERO         WAUENB                         Order Secondary
     C                   Z-ADD     *ZERO         WARZNB                         Case Sequence N
     C                   Z-ADD     *ZERO         WAFOQT                         Case Quantity
     C                   Z-ADD     *ZERO         WAR0NB                         Case Weight
     C                   Z-ADD     *ZERO         WAK7DT                         Label Date
     C                   Z-ADD     *ZERO         WAPFNX                         PT Serial Numbe
     C                   Z-ADD     *ZERO         WAHGCD                         Item Code
     C                   Z-ADD     *ZERO         WAELDT                         Production Date
     C                   Z-ADD     *ZERO         WAN5WG                         Manifest Gross
     C                   Z-ADD     *ZERO         WAH5NY                         Manifest Total
     C                   Z-ADD     *ZERO         WAH6NY                         Manifest Co_Par
     C                   Z-ADD     *ZERO         WAH7NY                         Manifest Pallet
     C                   Z-ADD     *ZERO         WAN6WG                         HPB Meter Net G
     C                   Z-ADD     *ZERO         WAN7WG                         Manifest Net We
     C                   Z-ADD     *ZERO         WARBDT                         Manifest Unused
     C                   Z-ADD     *ZERO         WAITNY                         HPB COA Batch N
     C                   Z-ADD     *ZERO         WAIVNY                         HPB Meter Start
     C                   Z-ADD     *ZERO         WAIUNY                         HPB Meter Endin
     C                   Z-ADD     *ZERO         WAIWNY                         HPB Meter Total
     C                   Z-ADD     *ZERO         WAIXNY                         HPB Meter Net W
     C                   Z-ADD     *ZERO         WAIYNY                         HPB Density Ref
     C                   Z-ADD     *ZERO         WAAATM                         Job Time
     C                   Z-ADD     *ZERO         WAAXDT                         Job Date
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
