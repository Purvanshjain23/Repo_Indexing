// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMP7DFR
// ?Date: 14.08.2025 Time: 03:43:44
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// PGM.*Scan limit = CON.999999
PGM.*Scan_limit = 999999;

//?USER: Initialize subfile record from DBF record

EXECUTE FUNCTION(Customer Name DRV) TYPE(DRVFLD)                                AC1631131;
PARAMETER(RCD.Customer_Name_DRV);
PARAMETER(RCD.CUSTOMER_NUMBER);
{
 //?Calculate derived field

 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(PAR.Ship_To_Customer);
 PARAMETER(PAR.Customer_Name_DRV);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?SEL:  Customer Number
CASE;

// IF CTL.CUSTOMER NUMBER is Entered
IF CTL.CUSTOMER_NUMBER <> *ZERO;

CASE;

// IF RCD.CUSTOMER NUMBER NE CTL.CUSTOMER NUMBER
IF RCD.CUSTOMER_NUMBER <> CTL.CUSTOMER_NUMBER;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: Process subfile control (Pre-confirm)

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?F4=Prompt
CASE;

// IF CTL.*CMD key is *Prompt
IF CTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> CTL.CUSTOMER NUMBER
IF PGM.*Cursor_field = CTL.CUSTOMER_NUMBER;

// Call program SEL Cust/ShpTo Flag 'Y'SR.
CALL PROGRAM(SEL Cust/ShpTo Flag 'Y'SR) ('PDYSSRR');
PARAMETER(CTL.CUSTOMER_NUMBER);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

ENDIF;

//?F6=Create
CASE;

// IF CTL.*CMD key is *Create
IF CTL.*CMD_key = '06';

// Call program Zzz Cust Accr Payment ER.
CALL PROGRAM(Zzz Cust Accr Payment ER) ('PMP8E1R');
PARAMETER(CTL.RECORD_ID_3_4_5);
PARAMETER(CTL.CUSTOMER_NUMBER);
PARAMETER(CTL.DATE);
PARAMETER(CTL.INVOICE_NUMBER_0049582);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?USER: Process subfile record (Pre-confirm)

//?2=Edit
CASE;

// IF RCD.*SFLSEL is *Edit
IF RCD.*SFLSEL = '2'/'2';

CASE;

// IF RCD.RECORD ID 3/4/5 is Not Payment
IF RCD.RECORD_ID_3_4_5 = '3'/'4';

// Send error message - 'Option is not allowed.'
ERROR(USR2262);
MSGPARM(RCD.*SFLSEL);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Zzz Cust Accr Payment ER.
CALL PROGRAM(Zzz Cust Accr Payment ER) ('PMP8E1R');
PARAMETER(RCD.RECORD_ID_3_4_5);
PARAMETER(RCD.CUSTOMER_NUMBER);
PARAMETER(RCD.DATE);
PARAMETER(RCD.INVOICE_NUMBER_0049582);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

ENDIF;

//?4=Delete
CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

CASE;

// IF RCD.RECORD ID 3/4/5 is Not Payment
IF RCD.RECORD_ID_3_4_5 = '3'/'4';

// Send error message - 'Option is not allowed.'
ERROR(USR2262);
MSGPARM(RCD.*SFLSEL);

QUIT;

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

ENDIF;

//?USER: Process subfile record (Post-confirm)

CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Dlt Accrual Trans     DL) TYPE(DLTOBJ) FILE(ACCRUALS)          AC1859000;
PARAMETER(RCD.PRODUCT_CODE_0049572);
PARAMETER(*MISSING);
PARAMETER(RCD.CUSTOMER_NUMBER);
PARAMETER(RCD.DATE);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

