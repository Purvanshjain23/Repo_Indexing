// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDZ4XFR
// ?Date: 14.08.2025 Time: 03:30:48
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?RMC 05/08/08 get latest act ship date from orders on the load
//?** 08/18/08 LJB E00207 Pass override miles to Calc freight function
EXECUTE FUNCTION(UPD Load w/ Ship Sts   RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1366561;
PARAMETER(PAR.Load_ID);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?* 08/18/08 LJB E00207 Pass Override miles to the calc freight function
 //?* 05/08/08 RMC get latest Actual Ship Date, instead of last order's date
 //?* 04/21/06 RMC pass in bol complete date
 //?* 11/12/02 RMC Update Actual Ship Date
 ENDDO;

 //?USER: Process Data record

 EXECUTE FUNCTION(RTV All Ords Shipped?  RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1366564;
 PARAMETER(DB1.Load_ID);
 PARAMETER(PAR.Status_Y_or_N);
 {
  //?USER: Initialize routine

  // PAR.Status - Y or N = CND.yes
  PAR.Status_Y_or_N = 'Y';

  //?USER: Process Data record

  //?Assume all orders are shipped, unless find one that isn't
  EXECUTE FUNCTION(RTV Order Status       RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1131568;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(PAR.Header_Status);
  PARAMETER(WRK.TXT_field_not_needed);
  {
   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF PAR.Header Status is Conf/Comp/Canc
  IF PAR.Header_Status = 'X'/'C'/'R';

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Status - Y or N = CND.no
  PAR.Status_Y_or_N = 'N';

  QUIT;

  ENDIF;

 }

 CASE;

 // IF PAR.Status - Y or N is yes
 IF PAR.Status_Y_or_N = 'Y';

 CASE;

 // IF DB1.Shipping Method is Prepaid
 IF DB1.Shipping_Method = 'PR'/'PT';

 // Call program UPD Rated Frt Post Shp XF.
 CALL PROGRAM(UPD Rated Frt Post Shp XF) ('PDJVXFR');
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Company_Number);

 //?*------------------------------------------------------------*
 //?* 04/21/06 RMC pass in bol complete date
 //?* 08/18/08 LJB E00207 Pass Override miles
 //?* 12/51/16 RMC only create freight charge for not mg created loads
 CASE;

 // IF DB1.MG Created Load is Not MG Created Load
 IF DB1.MG_Created_Load = *BLANK;

 // Call program Clc Freight Charges   XF.
 CALL PROGRAM(Clc Freight Charges   XF) ('POL2XFR');
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Scheduled_Ship_Date);
 PARAMETER(DB1.Load_Status);
 PARAMETER(DB1.Flat_Amount);
 PARAMETER(DB1.Total_Stops);
 PARAMETER(DB1.Carrier_Code);
 PARAMETER(DB1.Load_Type);
 PARAMETER(DB1.Total_Load_Miles);
 PARAMETER(DB1.Shipping_Method);
 PARAMETER(DB1.Ship_From_Warehouse);
 PARAMETER(DB1.Ship_To_State_Code);
 PARAMETER(DB1.Export_Status);
 PARAMETER(DB1.BOL_Complete_Date);
 PARAMETER(DB1.Shipping_Line);
 PARAMETER(DB1.Discharge_Port);
 PARAMETER(DB1.Load_Shag_Flag);
 PARAMETER(DB1.Load_Wash_Flag);
 PARAMETER(DB1.Override_Total_Load_Miles);

 ENDIF;

 //?*------------------------------------------------------------*
 ENDIF;

 //?11/12/02 RMC Update Actual Ship Date
 //?05/08/08 RMC get latest Actual Ship Date, instead of last order's date
 EXECUTE FUNCTION(RTV Act ShpDt Last Ord RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1444830;
 PARAMETER(DB1.Load_ID);
 PARAMETER(9999);
 PARAMETER(LCL.Actual_Ship_Date);
 PARAMETER(NLL.Ship_To_Name);
 PARAMETER(NLL.Ship_To_City);
 PARAMETER(NLL.Ship_To_State_Code);
 {
  //?USER: Initialize routine

  // PAR.Actual Shipped Date = CON.*ZERO
  PAR.Actual_Shipped_Date = *ZERO;

  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv Actual Ship Date  RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1444831;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(PAR.Ship_To_Name);
  PARAMETER(PAR.Ship_To_City);
  PARAMETER(PAR.Ship_To_State_Code);
  PARAMETER(WRK.Actual_Shipped_Date);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF WRK.Actual Shipped Date GT PAR.Actual Shipped Date
  IF WRK.Actual_Shipped_Date > PAR.Actual_Shipped_Date;

  // PAR.Actual Shipped Date = WRK.Actual Shipped Date
  PAR.Actual_Shipped_Date = WRK.Actual_Shipped_Date;

  ENDIF;

 }

 EXECUTE FUNCTION(CHG Load Status/ActShp CH) TYPE(CHGOBJ) FILE(OMFJCPP)          AC1657719;
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Scheduled_Ship_Date);
 PARAMETER('S');
 PARAMETER(LCL.Actual_Ship_Date);
 {
  //?USER: Processing before Data update

  // DB1.Job Time = JOB.*Job time
  DB1.Job_Time = JOB.*Job_time;

  // DB1.User Id = JOB.*USER
  DB1.User_Id = JOB.*USER;

  // DB1.Job Name = JOB.*JOB
  DB1.Job_Name = JOB.*JOB;

  // DB1.Job Date = JOB.*Job date
  DB1.Job_Date = JOB.*Job_date;

 }

 ENDIF;

}


