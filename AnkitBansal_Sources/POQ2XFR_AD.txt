// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POQ2XFR
// ?Date: 14.08.2025 Time: 03:38:43
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** Pass in A/R Customer Number
EXECUTE FUNCTION(RTV Name.Address,Fax   RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1449132;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(NLL.Customer_Name);
PARAMETER(NLL.Address_Line_1);
PARAMETER(NLL.Address_Line_2);
PARAMETER(NLL.City);
PARAMETER(NLL.State_Code);
PARAMETER(NLL.Zip_Postal_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Send fax if customer is valid
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// PGM.*Return code = CND.*Record does not exist
PGM.*Return_code = 'Y2U0005';

//?Send fax if customer is valid
// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(CNV cyymmdd to mmddyy) TYPE(EXCINTFUN)                         AC1563472;
PARAMETER(JOB.*Job_date);
PARAMETER(PAR.Send_Date);
{
 //?Execute internal function

 //?convert numeric date to character date.
 // PAR.Date (Alpha) USR = CVTVAR(PAR.Date In  (7,0) USR)
 PAR.Date_Alpha_USR = CVTVAR(PAR.Date_In_70_USR);

 //?extract month, day, and year.
 // PAR.Year  (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.2,CON.2)
 PAR.Year_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:2:2);

 // PAR.Month (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.4,CON.2)
 PAR.Month_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:4:2);

 // PAR.Day   (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.6,CON.2)
 PAR.Day_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:6:2);

 //?reconstruct date in mmddyy format.
 // PAR.Date (Char-6) USR = CONCAT(PAR.Month (Char) USR,PAR.Day   (Char) USR,CON.*ZE
 PAR.Date_Char_6_USR = PAR.Month_Char_USR + PAR.Day_Char_USR (*ZERO);

 // PAR.Date (Char-6) USR = CONCAT(PAR.Date (Char-6) USR,PAR.Year  (Char) USR,CON.*Z
 PAR.Date_Char_6_USR = PAR.Date_Char_6_USR + PAR.Year_Char_USR (*ZERO);

 //?convert character date to numeric date.
 // PAR.Date Out (6,0) USR = CVTVAR(PAR.Date (Char-6) USR)
 PAR.Date_Out_60_USR = CVTVAR(PAR.Date_Char_6_USR);

}


// PAR.Printer Name or Outq = CND.Fax Output Queue
PAR.Printer_Name_or_Outq = 'FAXQ';

// PAR.Country Description = CON.A/R Statements
PAR.Country_Description = 'A/R Statements';

// PAR.Display Fax Select Screen = PAR.Statement Type
PAR.Display_Fax_Select_Screen = PAR.Statement_Type;

//?** Spool File Selection is received as &PRTF in the CL
//?** Spool file based on Statement type (from the menu)
CASE;

// IF PAR.Statement Type is Aged Statement
IF PAR.Statement_Type = 'A';

// PAR.Spool File Selection = CON.PPRKPFR$
PAR.Spool_File_Selection = 'PPRKPFR$';

//?** Spool file based on Statement type (from the menu)
// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Spool File Selection = CON.QPRINT
PAR.Spool_File_Selection = 'QPRINT';

ENDIF;

//?** Rtv fax number and fax statement if requested      E002121
CASE;

// IF PAR.Status Flag 1  Y/N is Yes
IF PAR.Status_Flag_1_Y_N = 'Y';

EXECUTE FUNCTION(RTV Snd CDE Faxes only RT) TYPE(RTVOBJ) FILE(PNF7REP)          AC2044833;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER('AR-STMTS');
PARAMETER('F');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(PAR.Display_Fax_Select_Screen);
PARAMETER(PAR.Send_Date);
PARAMETER(PAR.Printer_Name_or_Outq);
PARAMETER(PAR.Outq_Library);
PARAMETER(PAR.Country_Description);
PARAMETER(*BLANK);
PARAMETER(PAR.Company_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?** Customer name
 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(WRK.Customer_Name);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?Fax Routine
 CASE;

 // IF PAR.CDE Destination Type is Fax
 IF PAR.CDE_Destination_Type = 'F';

 // AND DB1.CDE Destination Type EQ PAR.CDE Destination Type
 AND DB1.CDE_Destination_Type = PAR.CDE_Destination_Type;

 // AND DB1.Record Status is Active
 AND DB1.Record_Status = 'A';

 //?** Cover sheet default values:
 // PAR.CDD Type = CND.Fax
 PAR.CDD_Type = 'FX';

 // PAR.CDD Department Code = CND.Accounting
 PAR.CDD_Department_Code = 'ACCTG';

 // PAR.Fax Invoice Fax Number = DB1.CDE Destination
 PAR.Fax_Invoice_Fax_Number = DB1.CDE_Destination;

 //?** Fax invoice for Invoices or for Statements
 CASE;

 // IF PAR.Distribution Code is Invoice
 IF PAR.Distribution_Code = 'AR-INVOICE';

 // OR PAR.Distribution Code is Statements
 OR PAR.Distribution_Code = 'AR-STMTS';

 // Call program PRC Call Telex Invoice UP.
 CALL PROGRAM(PRC Call Telex Invoice UP) ('POD2UPC');
 PARAMETER(PAR.Spool_File_Selection);
 PARAMETER(PAR.Display_Fax_Select_Screen);
 PARAMETER(PAR.Send_Date);
 PARAMETER(PAR.Printer_Name_or_Outq);
 PARAMETER(PAR.Outq_Library);
 PARAMETER(PAR.Country_Description);
 PARAMETER(PAR.Spool_File_Selection_2);
 PARAMETER(PAR.Company_Number);
 PARAMETER(PAR.CDD_Type);
 PARAMETER(PAR.CDD_Department_Code);
 PARAMETER(DB1.CDE_Name);
 PARAMETER(DB1.CDE_Destination);

 ENDIF;

 ENDIF;

 ENDIF;

}


ENDIF;

//?** Rtv email address and email if requested           E002121
CASE;

// IF PAR.Status Flag 3  Y/N is Yes
IF PAR.Status_Flag_3_Y_N = 'Y';

EXECUTE FUNCTION(RTV Snd CDE Email only RT) TYPE(RTVOBJ) FILE(PNF7REP)          AC2044836;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER('AR-STMTS');
PARAMETER('E');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(PAR.Display_Fax_Select_Screen);
PARAMETER(PAR.Send_Date);
PARAMETER(PAR.Printer_Name_or_Outq);
PARAMETER(PAR.Outq_Library);
PARAMETER(PAR.Country_Description);
PARAMETER(*BLANK);
PARAMETER(PAR.Company_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?** Customer name
 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(WRK.Customer_Name);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?Email Routine
 CASE;

 // IF PAR.CDE Destination Type is Email
 IF PAR.CDE_Destination_Type = 'E';

 // AND DB1.CDE Destination Type EQ PAR.CDE Destination Type
 AND DB1.CDE_Destination_Type = PAR.CDE_Destination_Type;

 // AND DB1.Record Status is Active
 AND DB1.Record_Status = 'A';

 //?Invoice, Statement, BOL
 CASE;

 // IF PAR.Distribution Code is Invoice
 IF PAR.Distribution_Code = 'AR-INVOICE';

 // OR PAR.Distribution Code is Statements
 OR PAR.Distribution_Code = 'AR-STMTS';

 //?Invoice or Statement:
 CASE;

 // IF PAR.Spool File Selection is Entered
 IF PAR.Spool_File_Selection <> *BLANK;

 // Call program Exc ESNDMAIL w/Attchmt UP.
 CALL PROGRAM(Exc ESNDMAIL w/Attchmt UP) ('PMB8UPC');
 PARAMETER(PAR.Spool_File_Selection);
 PARAMETER(DB1.CDE_Name);
 PARAMETER(DB1.CDE_Destination);
 PARAMETER(*PDF);

 ENDIF;

 //?BOL:
 CASE;

 // IF PAR.Spool File Selection 2 is Entered
 IF PAR.Spool_File_Selection_2 <> *BLANK;

 // Call program Exc ESNDMAIL w/Attchmt UP.
 CALL PROGRAM(Exc ESNDMAIL w/Attchmt UP) ('PMB8UPC');
 PARAMETER(PAR.Spool_File_Selection_2);
 PARAMETER(DB1.CDE_Name);
 PARAMETER(DB1.CDE_Destination);
 PARAMETER(*PDF);

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


ENDIF;

ENDIF;

//?***** Change Log and Comments
DO;

//?** NOTE:  Be sure to pass Blanks, not zeros, in spool file 2.
//?*****
//?** 06/01/2012 LJB E002121
//?** Pass in new Fax or Email flag.
//?** Rtv fax # and email addresses separately since Soni may want to
//?** do one but not the other, based on passed in flag.
//?*****
//?** 05/04/2012 LJB E000909
//?** Dup spool files to A/R outq per Soni Martin. She needs them.
//?** The spooled file will delete after it has
//?** printed. Soni wants her statements to fax and to print from
//?** her A/R output queue.
//?*****
//?** 04/01/2010 LJB P000198 (sub task: E000673)
//?** Stmts can now be faxed or emailed to one or multiple customers.
//?** Fax/Email is now stored in Cust Distr Entry file. The RTV will
//?** retrieve the number/address and send to all entries.
//?*****
//?FP1110 RMC 7/22/08 Pass *blank for spool file selection 2 -- its only
//? used to HPB invoice faxing
//?*****
//?** 05/17/2007 LJB DLY029
//?** Added retrieve of Company Document Defaults to get overlay info
//?** for Company sepcific overlay information. Updated parms to match
//?** the called program. Removed unused Cover Sheet Name parm.
//?*****
//?7/18/2006 SLM L060606   -- FAX PRINTER FILE PPRKPFR$
//?*****
//?** 05/16/2006 LJB T00008
//?** Result field length for fax number work field was changed
//?** to 25 characters to accommodate international fax numbers.
//?*****
ENDDO;

