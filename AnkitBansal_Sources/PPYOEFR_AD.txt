// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPYOEFR
// ?Date: 14.08.2025 Time: 03:42:21
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize subfile record (new record)

// RCD.Record Status = CND.Active
RCD.Record_Status = 'A';

//?USER: Validate subfile record fields

CASE;

// IF CTL.*CMD key is *Delete
IF CTL.*CMD_key = '11';

EXECUTE FUNCTION(RTV Ck On Time Rea ExstRT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1786578;
PARAMETER(RCD.On_Time_Reason_Code);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 QUIT;

 //?USER: Process Data record

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 QUIT;

}


CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

// Send error message - 'On Time Reason Code is being used. Cannot be deleted at this time.'
ERROR(USR3640);
MSGPARM(RCD.On_Time_Reason_Code);

// RCD.*SFLSEL = CND.*Reset to blank
RCD.*SFLSEL = *BLANK;

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(Create On Time Reasons) TYPE(CRTOBJ) FILE(PPB5REP)             AC1783596;
PARAMETER(RCD.On_Time_Reason_Code);
PARAMETER(RCD.OTR_Description);
PARAMETER(RCD.OTR_Department_Code);
PARAMETER(RCD.OTR_Dept_Description);
PARAMETER(RCD.OTR_Group_Code);
PARAMETER(RCD.OTR_Group_Description);
PARAMETER(RCD.Record_Status);
PARAMETER(RCD.Create_Date);
PARAMETER(RCD.Create_Time);
PARAMETER(RCD.Create_User);
PARAMETER(RCD.Create_Program);
PARAMETER(RCD.Change_Date);
PARAMETER(RCD.Change_Time);
PARAMETER(RCD.Change_User);
PARAMETER(RCD.Change_Program);
{
 //?USER: Processing before Data update

 // DB1.Create Date = JOB.*Job date
 DB1.Create_Date = JOB.*Job_date;

 // DB1.Create Time = JOB.*Job time
 DB1.Create_Time = JOB.*Job_time;

 // DB1.Create User = JOB.*USER
 DB1.Create_User = JOB.*USER;

 // DB1.Create Program = JOB.*PROGRAM
 DB1.Create_Program = JOB.*PROGRAM;

}


//?USER: Delete DBF record

EXECUTE FUNCTION(Delete On Time Reasons) TYPE(DLTOBJ) FILE(PPB5REP)             AC1783598;
PARAMETER(RCD.On_Time_Reason_Code);

//?USER: Change DBF record

EXECUTE FUNCTION(Change On Time Reasons) TYPE(CHGOBJ) FILE(PPB5REP)             AC1783597;
PARAMETER(RCD.On_Time_Reason_Code);
PARAMETER(RCD.OTR_Description);
PARAMETER(RCD.OTR_Department_Code);
PARAMETER(RCD.OTR_Dept_Description);
PARAMETER(RCD.OTR_Group_Code);
PARAMETER(RCD.OTR_Group_Description);
PARAMETER(RCD.Record_Status);
PARAMETER(RCD.Create_Date);
PARAMETER(RCD.Create_Time);
PARAMETER(RCD.Create_User);
PARAMETER(RCD.Create_Program);
PARAMETER(RCD.Change_Date);
PARAMETER(RCD.Change_Time);
PARAMETER(RCD.Change_User);
PARAMETER(RCD.Change_Program);
{
 //?USER: Processing before Data update

 // DB1.Change Date = JOB.*Job date
 DB1.Change_Date = JOB.*Job_date;

 // DB1.Change Time = JOB.*Job time
 DB1.Change_Time = JOB.*Job_time;

 // DB1.Change User = JOB.*USER
 DB1.Change_User = JOB.*USER;

 // DB1.Change Program = JOB.*PROGRAM
 DB1.Change_Program = JOB.*PROGRAM;

}


