// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUQMPFR
// ?Date: 14.08.2025 Time: 12:07:03
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?T16276 RMC 3/11/20 NEW FORM FOR CANADA FORM 9135-3A CONTINUATION (TYPE H)
//?   USES OVERLAY - CAN9135
// WRK.First Time Flag = CND.Yes
WRK.First_Time_Flag = 'Y';

EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
PARAMETER(PAR.Company_Number);
PARAMETER('EXPDISTRCT');
PARAMETER(LCL.Text_USR_9);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Count USR = CON.*ZERO
LCL.Count_USR = *ZERO;

// LCL.Status Flag 14 Y/N = CND.No
LCL.Status_Flag_14_Y_N = 'N';

EXECUTE FUNCTION(RTV Header Status      RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1231329;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.Header_Status);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Record selection processing

EXECUTE FUNCTION(Rtv Appl Overflow    RT) TYPE(RTVOBJ) FILE(PDMRREP)            AC2156040;
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.Order_Number);
PARAMETER(DB1.ED_Export_Document_Type);
PARAMETER(DB1.Country_Code);
PARAMETER(LCL.ED_Xlate_Desc_to_Country);
PARAMETER(PAR.ED_Shipping_Marks_Txt);
PARAMETER(LCL.ED_USDA_Cert_Nbr_US);
PARAMETER(PAR.ED_Species);
PARAMETER(LCL.ED_Title_of_Official);
PARAMETER(PAR.ED_Nbr_of_prods_on_1st_pg);
PARAMETER(PAR.ED_Export_Certificate_Nbr);
PARAMETER(LCL.ED_Document_Date);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


CASE;

// IF DB1.ED Product Net Weight lbs EQ WRK.ZERO
IF DB1.ED_Product_Net_Weight_lbs = WRK.ZERO;

// AND LCL.Header Status is Confirmed & Complete
AND LCL.Header_Status = 'C'/'R';

// AND DB1.Company Number is NE 960
AND DB1.Company_Number <> 960;

//?RMC added above for 960  - print 0 weights on shpped doc
// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

// IF *OTHERWISE
IF *OTHERWISE;

CASE;

// IF DB1.ED Item Code NE LCL.ED Item Code
IF DB1.ED_Item_Code <> LCL.ED_Item_Code;

// PAR.Count 2 USR = PAR.Count 2 USR + CON.1
PAR.Count_2_USR = PAR.Count_2_USR + 1;

// LCL.ED Item Code = DB1.ED Item Code
LCL.ED_Item_Code = DB1.ED_Item_Code;

CASE;

// IF PAR.Count 2 USR GT PAR.ED Nbr of prods on 1st pg
IF PAR.Count_2_USR > PAR.ED_Nbr_of_prods_on_1st_pg;

// PGM.*Record selected = CND.*YES
PGM.*Record_selected = 'Y';

// LCL.Count USR = LCL.Count USR + CON.1
LCL.Count_USR = LCL.Count_USR + 1;

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

CASE;

// IF PAR.Count 2 USR GT PAR.ED Nbr of prods on 1st pg
IF PAR.Count_2_USR > PAR.ED_Nbr_of_prods_on_1st_pg;

// PGM.*Record selected = CND.*YES
PGM.*Record_selected = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

ENDIF;

//?USER: Print required level headings

// SUPPRESSED PRINT Company Number header format

CASE;

IF NEW Order_Number;
CASE;

// IF WRK.First Time Flag is Yes
IF WRK.First_Time_Flag = 'Y';

// WRK.First Time Flag = CND.NO
WRK.First_Time_Flag = 'N';

// IF *OTHERWISE
IF *OTHERWISE;

ENDIF;

//?print 6 digits to pick up leading 0 as in cert # 021644    7/20/05
//?Export Certificate No.
CASE;

// IF PAR.ED Export Certificate Nbr NE WRK.ZERO
IF PAR.ED_Export_Certificate_Nbr <> WRK.ZERO;

// CUR.Export Cert Nbr 6.0 = PAR.ED Export Certificate Nbr
CUR.Export_Cert_Nbr_6_0 = PAR.ED_Export_Certificate_Nbr;

// CUR.Text USR 4 = LCL.ED USDA Cert Nbr US
CUR.Text_USR_4 = LCL.ED_USDA_Cert_Nbr_US;

ENDIF;

// Print Order Number header format
PRINT Order Number header format;

ENDIF;

// SUPPRESSED PRINT ED Export Document Type header format

// SUPPRESSED PRINT Country Code header format

// SUPPRESSED PRINT ED Item Code header format

// SUPPRESSED PRINT Order Sequence Number header format

//?USER: Process after print of detail format

NXT.Net_Quantity_SUM = SUM(CUR.ED_Product_Nbr_of_Pkgs);

NXT.Net_Weight_SUM_9_1 = SUM(CUR.ED_Product_Net_Weight_lbs);

//?USER: Print required level totals

// SUPPRESSED PRINT Order Sequence Number totals format

CASE;

IF NEW ED_Item_Code;
// LCL.Print Blank Line Usr = CND.no
LCL.Print_Blank_Line_Usr = 'N';

// LCL.Status Flag 1  Y/N = CND.No
LCL.Status_Flag_1_Y_N = 'N';

// LCL.Flag 3 = CND.*NO
LCL.Flag_3 = *NO;

//?blank line counters
CASE;

// IF LCL.Count USR is Two
IF LCL.Count_USR = 2;

// OR LCL.Count USR is Four
OR LCL.Count_USR = 4;

// OR LCL.Count USR is Six
OR LCL.Count_USR = 6;

// OR LCL.Count USR is Eight
OR LCL.Count_USR = 8;

// OR LCL.Count USR is Ten
OR LCL.Count_USR = 10;

// OR LCL.Count USR is Twelve
OR LCL.Count_USR = 12;

// OR LCL.Count USR is Fourteen
OR LCL.Count_USR = 14;

// OR LCL.Count USR is Sixteen
OR LCL.Count_USR = 16;

// OR LCL.Count USR is Eighteen
OR LCL.Count_USR = 18;

// OR LCL.Count USR is Twenty
OR LCL.Count_USR = 20;

// OR LCL.Count USR is twenty-two
OR LCL.Count_USR = 22;

// OR LCL.Count USR is twenty-four
OR LCL.Count_USR = 24;

// LCL.Print Blank Line Usr = CND.yes
LCL.Print_Blank_Line_Usr = 'Y';

ENDIF;

//?RMC 02/10/20 For the new form (01/27/2020)  and added Status 1 line cnd
//?Print Details.
CASE;

//?Print Details.
// IF *OTHERWISE
IF *OTHERWISE;

// CUR.ED Species = PAR.ED Species
CUR.ED_Species = PAR.ED_Species;

// CUR.ED Shipping Marks Txt = PAR.ED Shipping Marks Txt
CUR.ED_Shipping_Marks_Txt = PAR.ED_Shipping_Marks_Txt;

// LCL.ULSD Facility bill # = CUR.ED Plant Number Dtl
LCL.ULSD_Facility_bill_# = CUR.ED_Plant_Number_Dtl;

// CUR.Weight Scheduled 7.1 = CUR.Net Weight SUM 9.1
CUR.Weight_Scheduled_7_1 = CUR.Net_Weight_SUM_9_1;

// CUR.Text USR 40 = CONCAT(CUR.ED Chilled/Frozen Text,CUR.ED Item Label Line 1,CON.1)
CUR.Text_USR_40 = CUR.ED_Chilled_Frozen_Text + CUR.ED_Item_Label_Line_1 (1);

// LCL.Flag 2 = CND.*NO
LCL.Flag_2 = *NO;

// LCL.Flag 3 = CND.*NO
LCL.Flag_3 = *NO;

//?PRINT Continuation line & force new page
CASE;

// IF LCL.Count USR is twenty-six
IF LCL.Count_USR = 26;

//?WAS 26 - BEFORE 2/10/2020
// LCL.Flag 3 = CND.*YES
LCL.Flag_3 = *YES;

// CUR.ED Continue Comment Txt = CONCAT(CON.Continuation of Product A,CON.ttached,CON.*ZERO)
CUR.ED_Continue_Comment_Txt = 'Continuation of Product A' + 'ttached' (*ZERO);

//?RMC moved this here to see if it works 7.10.08
// PGM.*new page flag = CND.*Yes
PGM.*new_page_flag = 'Y';

// LCL.Count USR = CON.*ZERO
LCL.Count_USR = *ZERO;

// PAR.Print On Form = CND.Print on Form
PAR.Print_On_Form = 1;

ENDIF;

ENDIF;

// Print ED Item Code totals format
PRINT ED Item Code totals format;

ENDIF;

// SUPPRESSED PRINT Country Code totals format

// SUPPRESSED PRINT ED Export Document Type totals format

// SUPPRESSED PRINT Order Number totals format

// SUPPRESSED PRINT Company Number totals format

