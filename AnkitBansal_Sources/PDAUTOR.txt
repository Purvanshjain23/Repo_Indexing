/*  SYNOPSIS:                                                      */
/*              CL program that automatically polls the pick file   */
/*              from Acu-Sort to determine orders that have been    */
/*              shipped.                                            */
/*                                                                  */
/*  SYSTEM:                                                         */
/*              Order Management System                             */
/*  DATE:                                                           */
/*              June 9, 1995                                        */
/*  PARAMETERS:                                                     */
/********************************************************************/
PGM
             DCL        VAR(&JOBTM) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&JOBHR) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&JOBMN) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&HRJ) TYPE(*CHAR) LEN(2)
             DCL        VAR(&MNJ) TYPE(*CHAR) LEN(2)
             DCL        VAR(&TMIN) TYPE(*CHAR) LEN(4)
             DCL        VAR(&TMINH) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&TMINM) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&NXTRH) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&NXTRM) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&NXTIM) TYPE(*CHAR) LEN(6)
             DCL        VAR(&HOUR) TYPE(*DEC) LEN(1 0)
             DCL        VAR(&AEND) TYPE(*CHAR) LEN(6)
             DCL        VAR(&END) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&TIME) TYPE(*DEC) LEN(6 0)
             DCL        VAR(&QTM) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10) /*  DATA +
                          FILES     */
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10) /*  DATA +
                          FILES HIST */
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7) /*  RETURN +
                          CODE    */

/********************************************************************/
/* Retrieve Data Library name and Data History library name         */
/********************************************************************/

             CALL       PGM(CAQXXFR) PARM(&RETURN &DATA &DATAH)

 /* *********************************************************/
 /*    RETRIEVE  THE CURRENT TIME FOR HOURS AND MINUTES    */
 /* ************************************************************  */
             RTVSYSVAL  SYSVAL(QHOUR) RTNVAR(&HRJ) /* CURRENT JOB +
                          HOUR */
             CHGVAR     VAR(&JOBHR) VALUE(&HRJ)
             RTVSYSVAL  SYSVAL(QMINUTE) RTNVAR(&MNJ) /* CURRENT +
                          JOB MINUTE */
             CHGVAR     VAR(&JOBMN) VALUE(&MNJ)
 /* ****************************************************************/
 /*  RETRIEVE JOB INTERVAL CONSTANTS     POLLING RATE   */
 /* ****************************************************************/
             RTVDTAARA  DTAARA(&DATA/ASAUTODTA (1 4)) RTNVAR(&TMIN)
             CHGVAR     VAR(&TMINH) VALUE(%SST(&TMIN 1 2))
             CHGVAR     VAR(&TMINM) VALUE(%SST(&TMIN 3 2))
 /* **********************************************************/
 /*  INSERT PROGRAMS TO BE INTERMITANTLY RUN                 */
 /* ****************************************************************/
 PROGRAMS:
 /*         * PROCESS AS PICK ACKNOWLEDGMENT                         */

             CALL       PGM(PDPCKXFR) PARM(' ')


 /*         * PROCESS AS SHIP ORDER HEADER (LOAD)                    */

             CALL       PGM(PDZ5XFR) PARM(' ')


 /*         * PROCESS AS SHIP ORDER DETAIL                           */

             CALL       PGM(PDRXXFR) PARM(' ')


 /** DELETE BELOW **/
             GOTO       CMDLBL(END)
 /** DELETE ABOVE **/

                                                          /*   */
             RTVSYSVAL  SYSVAL(QHOUR) RTNVAR(&HRJ) /* CURRENT JOB +
                          HOUR */
             CHGVAR     VAR(&JOBHR) VALUE(&HRJ)
             RTVSYSVAL  SYSVAL(QMINUTE) RTNVAR(&MNJ) /* CURRENT +
                          JOB MINUTE */
             CHGVAR     VAR(&JOBMN) VALUE(&MNJ)
             CHGVAR     VAR(&NXTRM) VALUE(&JOBMN + &TMINM)
             IF         COND(&NXTRM *GE 60) THEN(DO)
             CHGVAR     VAR(&NXTRM) VALUE(&NXTRM - 60)
             CHGVAR     VAR(&HOUR) VALUE(1)
             ENDDO
             ELSE       CMD(DO)
             CHGVAR     VAR(&HOUR) VALUE(0)
             ENDDO
             CHGVAR     VAR(&NXTRH) VALUE(&JOBHR + &TMINH + &HOUR)
             IF COND(&NXTRH *GE 24) THEN(DO)
             CHGVAR     VAR(&NXTRH) VALUE(&NXTRH - 24)
             ENDDO
             CHGVAR     VAR(%SST(&NXTIM 1 2)) VALUE(&NXTRH)
             CHGVAR     VAR(%SST(&NXTIM 3 2)) VALUE(&NXTRM)
             CHGVAR     VAR(%SST(&NXTIM 5 2)) VALUE(00)
/* ************************************************************/
/*  PROGRAM TIMING LOOP                                       */
/* ************************************************************/
LOOP:
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&QTM)
             CHGVAR     VAR(&TIME) VALUE(&QTM)
             RTVDTAARA  DTAARA(&DATA/ASAUTODTA (5 6)) +
                          RTNVAR(&AEND) /* TIME TO QUIT RUNNING +
                          PROGRAM */
             CHGVAR     VAR(&END) VALUE(&AEND)
             IF COND(&TIME *GE &END) THEN(DO)
             GOTO       CMDLBL(END)
             ENDDO
             DLYJOB     RSMTIME(&NXTIM) /* Resume program running */
             GOTO       CMDLBL(PROGRAMS)
 END: ENDPGM
