// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDJ7PFR
// ?Date: 14.08.2025 Time: 12:03:59
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

EXECUTE FUNCTION(VAL Rtv & Ctr Prt Hdg  IF) TYPE(EXCINTFUN)                     AC1258755;
PARAMETER('OMS');
{
 //?Execute internal function

 EXECUTE FUNCTION(SET Setup Prt Headings IF) TYPE(EXCINTFUN)                     AC1258771;
 PARAMETER(PAR.Application_Code);
 {
  //?Execute internal function

  EXECUTE FUNCTION(RTV Applic. Group Desc RT) TYPE(RTVOBJ) FILE(CADNREP)          AC1274118;
  PARAMETER(PAR.Application_Code);
  PARAMETER(WRK.Description);
  {
   //?USER: Process Data record

   CASE;

   // IF DB1.Application Group is Blank
   IF DB1.Application_Group = *BLANK;

   MOVE *ALL (To: PAR From: DB1);

   // IF *OTHERWISE
   IF *OTHERWISE;

   EXECUTE FUNCTION(RTV Application Desc   RT) TYPE(RTVOBJ) FILE(CADNREP)          AC1249881;
   PARAMETER(DB1.Application_Group);
   PARAMETER(PAR.Description);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    // PGM.*Return code = CND.*Record does not exist
    PGM.*Return_code = 'Y2U0005';

    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   ENDIF;

  }

  // WRK.USR Description 40 = WRK.Description
  WRK.USR_Description_40 = WRK.Description;

  // Execute function CLC Center Txt Str 40  US.
  EXECUTE FUNCTION(CLC Center Txt Str 40  US) TYPE(EXCUSRSRC) ('PDYJUFR');
  PARAMETER(WRK.USR_Description_40);
  PARAMETER(WRK.USR_Description_40_2);
  {
   E                    UCT        40  1               CENTER TABLE
   C                     MOVEA#IDSC4    UCT              LOAD ARRAY
   C                     Z-ADD40        UX      20       SET COUNTER
   C           UX        DOWGT0
   C           UCT,UX    IFEQ ' '
   C                     SUB  1         UX
   C                     ELSE
   C                     Z-ADDUX        UXH     20
   C                     Z-ADD0         UX
   C                     END
   C                     END
   C           40        SUB  UXH       UX
   C           UX        DIV  2         UX
   C           UX        IFGT 0
   C                     MOVE *BLANKS   UCT
   C                     MOVEA#IDSC4    UCT,UX
   C                     END
   C                     MOVEAUCT       #ODE40           LOAD OUTPUT
  }

  // Execute function MOV Appl Desc to PrtCo US.
  EXECUTE FUNCTION(MOV Appl Desc to PrtCo US) TYPE(EXCUSRSRC) ('PD2KUFR');
  PARAMETER(WRK.USR_Description_40_2);
  {
   C                     MOVE #IDE40    $ACMP
  }

 }

}


// WRK.USR Display field = CND.no
WRK.USR_Display_field = 'N';

//?USER: Record selection processing

//?NOTE:  IF CHANGES ARE MADE TO SELECTION CRITERIA PROCESSING, ALSO
//?       LOOK AT PRE INVOICE REGISTER!!!
//?NOTE:  THIS PROGRAM ONLY RUNS FOR INVOICES.  THE OTHER CODE WAS
//?       LEFT IN FOR DOCUMENTATION PURPOSES.
//?04/26/18 DN R12926-Change AFR parm from both to input only & use from OH.
// Call program PRT Invc Excpt Sel V 2 XF.
CALL PROGRAM(PRT Invc Excpt Sel V 2 XF) ('PDKNXFR');
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.Order_Number);
PARAMETER(DB1.Order_Type_Sales);
PARAMETER(DB1.AR_Customer_Number);
PARAMETER(DB1.Ship_To_Customer);
PARAMETER(DB1.Customer_Purchase_Order_#);
PARAMETER(DB1.Order_Date);
PARAMETER(DB1.Actual_Shipped_Date);
PARAMETER(DB1.Header_Status);
PARAMETER(DB1.Header_Status_Last);
PARAMETER(DB1.Scheduled_Ship_Date);
PARAMETER(DB1.Load_ID);
PARAMETER(DB1.Absorbed_Freight_Rate_CWT);
PARAMETER(DB1.Price_Audit);
PARAMETER(DB1.Price_Status);
PARAMETER(DB1.Shipping_Method);
PARAMETER(DB1.Sales_Route_Code);
PARAMETER(DB1.Event_Code);
PARAMETER(DB1.Billing_Activity_Type);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Billing_Activity_Type);
PARAMETER(PAR.Actual_Shipped_Date);
PARAMETER(PAR.Update_Exception_Status);
PARAMETER(PGM.*Record_selected);
PARAMETER(PAR.Print_Pre_Inv_Exception);
PARAMETER(PAR.Departure_Sts_USR);
PARAMETER(PAR.System_Value_Numeric);
PARAMETER(PAR.Manual_Prc_Err_Sts_USR);
PARAMETER(LCL.Projected_Market_Price);
PARAMETER(PAR.Average_Ship_Wgt_Err_USR);
PARAMETER(PAR.InterCo_Price_Err_USR);
PARAMETER(PAR.Record_Found_USR);
PARAMETER(PAR.Order_Status);
PARAMETER(LCL.GTIN_Error_Sts_USR);
PARAMETER(LCL.GTIN_Error_Item_Code_USR);
PARAMETER(PAR.Item_Code_USR);
PARAMETER(PAR.Item_Code);
PARAMETER(LCL.Default_Commod_Mark_basis);
PARAMETER(LCL.Market_Overage);
PARAMETER(LCL.Commodity_Price_Group);
PARAMETER(LCL.Price_Overage_Override);
PARAMETER(PAR.Process_Cust_Types_Usr);
PARAMETER(PAR.Status_Y_or_N);
PARAMETER(LCL.D_EDI_INV_PROC_FLAG);

CASE;

// IF PGM.*Record selected is *YES
IF PGM.*Record_selected = 'Y';

CASE;

// IF PAR.Print Pre-Inv/Exception is Print on Exception
IF PAR.Print_Pre_Inv_Exception = 'E';

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: Process top of page

//?Billing type   - First part of title
CASE;

// IF PAR.Billing Activity Type is Invoice
IF PAR.Billing_Activity_Type = '1';

// TOP.Description Usr - 50 = CON.*** SALES ORDERS ONLY ***
TOP_Description_Usr_50 = '*** SALES ORDERS ONLY ***';

//?Billing type   - First part of title
// IF PAR.Billing Activity Type is Credit Memo
IF PAR.Billing_Activity_Type = '2';

// TOP.Description Usr - 50 = CON.*** CREDIT MEMOS ONLY ***
TOP_Description_Usr_50 = '*** CREDIT MEMOS ONLY ***';

//?Billing type   - First part of title
// IF PAR.Billing Activity Type is Debit Memo
IF PAR.Billing_Activity_Type = '3';

// TOP.Description Usr - 50 = CON.*** Debit Memos Only ***
TOP_Description_Usr_50 = '*** Debit Memos Only ***';

//?Billing type   - First part of title
// IF *OTHERWISE
IF *OTHERWISE;

// TOP.Description Usr - 50 = CON.*** Cr/Dr Memos Only ***
TOP_Description_Usr_50 = '*** Cr/Dr Memos Only ***';

ENDIF;

//?Last part of title
CASE;

// IF PAR.Process Cust Types Usr is Inter-Co Customer's
IF PAR.Process_Cust_Types_Usr = 'IC';

// TOP.Description Usr - 50 = CONCAT(TOP.Description Usr - 50,CON.- Inter-Co Customers,CON.1)
TOP_Description_Usr_50 = TOP_Description_Usr_50 + '- Inter-Co Customers' (1);

//?Last part of title
// IF PAR.Process Cust Types Usr is 3rd Party Customer(s)
IF PAR.Process_Cust_Types_Usr = 'TP';

// TOP.Description Usr - 50 = CONCAT(TOP.Description Usr - 50,CON.- 3rd Party Customers,CON.1)
TOP_Description_Usr_50 = TOP_Description_Usr_50 + '- 3rd Party Customers' (1);

//?Last part of title
// IF PAR.Process Cust Types Usr is All Customers
IF PAR.Process_Cust_Types_Usr = 'BT';

// TOP.Description Usr - 50 = CONCAT(TOP.Description Usr - 50,CON.- *All Customers,CON.1)
TOP_Description_Usr_50 = TOP_Description_Usr_50 + '- *All Customers' (1);

//?Last part of title
// IF PAR.Process Cust Types Usr is Selection by Order/Load
IF PAR.Process_Cust_Types_Usr = 'OR';

// TOP.Description Usr - 50 = CONCAT(TOP.Description Usr - 50,CON.- Selection by Order/Load,CON.1)
TOP_Description_Usr_50 = TOP_Description_Usr_50 + '- Selection by Order/Load' (1);

ENDIF;

//?USER: On print of first page format

// 1PG.Company Number = PAR.Company Number
X1PG_Company_Number = PAR.Company_Number;

// 1PG.Load ID = PAR.Load ID
X1PG_Load_ID = PAR.Load_ID;

// 1PG.Order Number = PAR.Order Number
X1PG_Order_Number = PAR.Order_Number;

// 1PG.Actual Shipped Date = PAR.Actual Shipped Date
X1PG_Actual_Shipped_Date = PAR.Actual_Shipped_Date;

CASE;

// IF PAR.Order Number is Equal to zeros
IF PAR.Order_Number = *ZERO;

// AND PAR.Load ID is Blank
AND PAR.Load_ID = *ZERO;

// AND PAR.Actual Shipped Date is not entered
AND PAR.Actual_Shipped_Date = *ZERO;

// 1PG.USR Desc. 10 = CON.*ALL
X1PG_USR_Desc_10 = *ALL;

ENDIF;

EXECUTE FUNCTION(RTV Company Name       RT) TYPE(RTVOBJ) FILE(CAABREP)          AC1255767;
PARAMETER(X1PG_Company_Number);
PARAMETER(X1PG_Company_Name);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Billing type - work field
CASE;

// IF PAR.Billing Activity Type is Invoice
IF PAR.Billing_Activity_Type = '1';

// 1PG.USR Work Field 7A = CON.Shipped
X1PG_USR_Work_Field_7A = 'Shipped';

//?Billing type - work field
// IF PAR.Billing Activity Type is Credit Memo
IF PAR.Billing_Activity_Type = '2';

// 1PG.USR Work Field 7A = CON.Entered
X1PG_USR_Work_Field_7A = 'Entered';

//?Billing type - work field
// IF PAR.Billing Activity Type is Debit Memo
IF PAR.Billing_Activity_Type = '3';

// 1PG.USR Work Field 7A = CON.Entered
X1PG_USR_Work_Field_7A = 'Entered';

//?Billing type - work field
// IF *OTHERWISE
IF *OTHERWISE;

// 1PG.USR Work Field 7A = CON.Entered
X1PG_USR_Work_Field_7A = 'Entered';

ENDIF;

//?USER: Null report processing

// Execute function CLC Set for Null Rpt   US.
EXECUTE FUNCTION(CLC Set for Null Rpt   US) TYPE(EXCUSRSRC) ('PDUUUFR');
{
 C                     MOVEL'Y'       W0AP1P
 C                     MOVEL'Y'       W0NEWP
}


// WRK.USR Display field = CND.yes
WRK.USR_Display_field = 'Y';

//?USER: Print required level headings

// SUPPRESSED PRINT Accounting Company Number header format

//?USER: On print of detail format

EXECUTE FUNCTION(One Invoice Per PO DRV) TYPE(DRVFLD)                           AC1805255;
PARAMETER(CUR.One_Invoice_Per_PO_DRV);
PARAMETER(CUR.Ship_To_Customer);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv One Invoice /PO   RT) TYPE(RTVOBJ) FILE(PDNEREP)           AC1801817;
 PARAMETER(PAR.Ship_To_Customer);
 PARAMETER(PAR.One_Invoice_Per_PO_DRV);
 {
  //?USER: Processing if Data record not found

  // PAR.One Invoice Per PO = CND.No
  PAR.One_Invoice_Per_PO = 'N';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


EXECUTE FUNCTION(RTV Salesman Code      RT) TYPE(RTVOBJ) FILE(PDJEREP)          AC1284971;
PARAMETER(CUR.Sales_Route_Code);
PARAMETER(CUR.Salesperson_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?05/23/16 RMC E4119 remove live with tpm check
EXECUTE FUNCTION(Rtv Sts/BOLDt/DptDtTm RT) TYPE(RTVOBJ) FILE(OMFJCPP)           AC1564871;
PARAMETER(CUR.Load_ID);
PARAMETER(CUR.Load_Status);
PARAMETER(CUR.BOL_Complete_Date);
PARAMETER(CUR.Truck_Departure_Date);
PARAMETER(CUR.Truck_Departure_Time);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// WRK.USR Display 1 = CND.No
WRK.USR_Display_1 = 'N';

// WRK.USR Display 2 = CND.No
WRK.USR_Display_2 = 'N';

// WRK.USR Display 3 = CND.No
WRK.USR_Display_3 = 'N';

// WRK.USR Display 4 = CND.No
WRK.USR_Display_4 = 'N';

// WRK.USR Display 5 = CND.No
WRK.USR_Display_5 = 'N';

// WRK.USR Display 6 = CND.No
WRK.USR_Display_6 = 'N';

// WRK.USR Display 7 = CND.No
WRK.USR_Display_7 = 'N';

// WRK.USR Display 8 = CND.No
WRK.USR_Display_8 = 'N';

// WRK.USR Display 9 = CND.No
WRK.USR_Display_9 = 'N';

// WRK.Display Flag 1 USR = CND.no
WRK.Display_Flag_1_USR = 'N';

// WRK.USR Display 11 = CND.No
WRK.USR_Display_11 = 'N';

// WRK.USR Display 12 = CND.No
WRK.USR_Display_12 = 'N';

// WRK.USR Display 13 = CND.No
WRK.USR_Display_13 = 'N';

// WRK.USR Display 15 = CND.No
WRK.USR_Display_15 = 'N';

// WRK.USR Display 16 = CND.No
WRK.USR_Display_16 = 'N';

//?Reason 1:  Order Unpriced
CASE;

// IF DB1.Price Status is Unpriced
IF DB1.Price_Status = 'U';

// CUR.Error Reason Descript 1 = CON.Order Unpriced
CUR.Error_Reason_Descript_1 = 'Order Unpriced';

// WRK.USR Display 1 = CND.Yes
WRK.USR_Display_1 = 'Y';

ENDIF;

//?Reason 2:  Order Marked for Price Audit
CASE;

// IF DB1.Price Audit is Needs Price Audit
IF DB1.Price_Audit = 'N';

// CUR.Error Reason Descript 2 = CON.Price Audit Required
CUR.Error_Reason_Descript_2 = 'Price Audit Required';

// WRK.USR Display 2 = CND.Yes
WRK.USR_Display_2 = 'Y';

ENDIF;

//?Reason 3:  Load status not= "S"
CASE;

// IF CUR.Load Status is Not Shipped
IF CUR.Load_Status = 'C'/'E'/'I'/'L'/'U';

// CUR.Error Reason Descript 3 = CON.Load not Shipped
CUR.Error_Reason_Descript_3 = 'Load not Shipped';

// WRK.USR Display 3 = CND.Yes
WRK.USR_Display_3 = 'Y';

ENDIF;

//?Reason 4:  Pricing extension error
CASE;

// IF PAR.Update Exception Status is yes
IF PAR.Update_Exception_Status = 'Y';

// CUR.Error Reason Descript 4 = CON.Pricing Extension Error
CUR.Error_Reason_Descript_4 = 'Pricing Extension Error';

// WRK.USR Display 4 = CND.Yes
WRK.USR_Display_4 = 'Y';

ENDIF;

//?Reason 5:  Departure status
CASE;

// IF PAR.Departure Sts USR is No Dalay
IF PAR.Departure_Sts_USR = 'D'/'B'/'N';

// OR PAR.Departure Sts USR is BOL Not Completed
OR PAR.Departure_Sts_USR = 'C';

// CUR.Error Reason Descript 5 = Condition name of PAR.Departure Sts USR
CUR.Error_Reason_Descript_5 = RTVCND(PAR.Departure_Sts_USR);

// WRK.USR Display 5 = CND.Yes
WRK.USR_Display_5 = 'Y';

//?Reason 5:  Departure status
// IF PAR.Departure Sts USR is Truck departed < ?hrs ago
IF PAR.Departure_Sts_USR = 'T';

// WRK.Hour 1 USR = PAR.System Value Numeric
WRK.Hour_1_USR = PAR.System_Value_Numeric;

// Retrieve message - 'Trk departed < &1hrs ago'
CUR.Error_Reason_Descript_5 = RTVMSG(USR2846);
PARAMETER(WRK.Hour_1_USR);

// WRK.USR Display 5 = CND.Yes
WRK.USR_Display_5 = 'Y';

//?Reason 5:  Departure status
// IF PAR.Departure Sts USR is BOL Completed <?Min ago
IF PAR.Departure_Sts_USR = 'P';

EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
PARAMETER(CUR.Company_Number);
PARAMETER('INVDELAYMN');
PARAMETER(LCL.System_Value_Numeric);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// WRK.Hour 1 USR = LCL.System Value Numeric
WRK.Hour_1_USR = LCL.System_Value_Numeric;

// Retrieve message - 'BOL printed < &1 min ago.'
CUR.Error_Reason_Descript_5 = RTVMSG(USR3833);
PARAMETER(WRK.Hour_1_USR);

// WRK.USR Display 5 = CND.Yes
WRK.USR_Display_5 = 'Y';

ENDIF;

//?Reason 6 & 7:  Manual Price out of range
CASE;

// IF PAR.Manual Prc Err Sts USR is yes
IF PAR.Manual_Prc_Err_Sts_USR = 'Y';

// LCL.Item Code Txt = CVTVAR(PAR.Item Code USR)
LCL.Item_Code_Txt = CVTVAR(PAR.Item_Code_USR);

//?Line 6
// CUR.Error Reason Descript 6 = CONCAT(CON.MAN Price Rng Err for,LCL.Item Code Txt,CON.1)
CUR.Error_Reason_Descript_6 = 'MAN Price Rng Err for' + LCL.Item_Code_Txt (1);

// CUR.Price 6,4 USR = LCL.Price Overage Override
CUR.Price_64_USR = LCL.Price_Overage_Override;

//?Line 7
// CUR.Error Reason Descript 7 = CONCAT(LCL.Default Commod Mark basis,LCL.Commodity Price Group,CON.
CUR.Error_Reason_Descript_7 = LCL.Default_Commod_Mark_basis + LCL.Commodity_Price_Group (0);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,CON.=,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + '=' (*ZERO);

// LCL.Price USR = LCL.Projected Market Price
LCL.Price_USR = LCL.Projected_Market_Price;

// LCL.Price Alpha USR = CVTVAR(LCL.Price USR)
LCL.Price_Alpha_USR = CVTVAR(LCL.Price_USR);

// LCL.Text 1 Length USR = SUBSTRING(LCL.Price Alpha USR,CON.1,CON.1)
LCL.Text_1_Length_USR = SUBSTRING(LCL.Price_Alpha_USR:1:1);

// LCL.USR Work Field 4A     USR = SUBSTRING(LCL.Price Alpha USR,CON.2,CON.4)
LCL.USR_Work_Field_4A_USR = SUBSTRING(LCL.Price_Alpha_USR:2:4);

// LCL.Price Alpha USR = CONCAT(LCL.Text 1 Length USR,CON..,CON.*ZERO)
LCL.Price_Alpha_USR = LCL.Text_1_Length_USR + '.' (0);

// LCL.Price Alpha USR = CONCAT(LCL.Price Alpha USR,LCL.USR Work Field 4A     USR,CON.*ZERO)
LCL.Price_Alpha_USR = LCL.Price_Alpha_USR + LCL.USR_Work_Field_4A_USR (*ZERO);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,LCL.Price Alpha USR,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + LCL.Price_Alpha_USR (*ZERO);

//?Absorbed Freight Rate
//?04/26/18 DN R12926-Use Absorbed Freight Rate from OH instead of Co Cust.
// LCL.Price 6,4 USR = DB1.Absorbed Freight Rate CWT / CON.100 *
LCL.Price_64_USR = DB1.Absorbed_Freight_Rate_CWT / 100;

// LCL.Price 7 Alpha USR = CVTVAR(LCL.Price 6,4 USR)
LCL.Price_7_Alpha_USR = CVTVAR(LCL.Price_64_USR);

// LCL.Text 2 Length USR = SUBSTRING(LCL.Price 7 Alpha USR,CON.1,CON.2)
LCL.Text_2_Length_USR = SUBSTRING(LCL.Price_7_Alpha_USR:1:2);

// LCL.USR Work Field 4A     USR = SUBSTRING(LCL.Price 7 Alpha USR,CON.3,CON.4)
LCL.USR_Work_Field_4A_USR = SUBSTRING(LCL.Price_7_Alpha_USR:3:4);

// LCL.Price 7 Alpha USR = CONCAT(LCL.Text 2 Length USR,CON..,CON.*ZERO)
LCL.Price_7_Alpha_USR = LCL.Text_2_Length_USR + '.' (0);

// LCL.Price 7 Alpha USR = CONCAT(LCL.Price 7 Alpha USR,LCL.USR Work Field 4A     USR,CON.*ZERO)
LCL.Price_7_Alpha_USR = LCL.Price_7_Alpha_USR + LCL.USR_Work_Field_4A_USR (*ZERO);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,CON.+F=,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + '+F=' (0);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,LCL.Price 7 Alpha USR,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + LCL.Price_7_Alpha_USR (*ZERO);

//?Overage
// LCL.Price 6,4 USR = LCL.Market Overage
LCL.Price_64_USR = LCL.Market_Overage;

// LCL.Price 7 Alpha USR = CVTVAR(LCL.Price 6,4 USR)
LCL.Price_7_Alpha_USR = CVTVAR(LCL.Price_64_USR);

// LCL.Text 2 Length USR = SUBSTRING(LCL.Price 7 Alpha USR,CON.1,CON.2)
LCL.Text_2_Length_USR = SUBSTRING(LCL.Price_7_Alpha_USR:1:2);

// LCL.USR Work Field 4A     USR = SUBSTRING(LCL.Price 7 Alpha USR,CON.3,CON.4)
LCL.USR_Work_Field_4A_USR = SUBSTRING(LCL.Price_7_Alpha_USR:3:4);

// LCL.Price 7 Alpha USR = CONCAT(LCL.Text 2 Length USR,CON..,CON.*ZERO)
LCL.Price_7_Alpha_USR = LCL.Text_2_Length_USR + '.' (0);

// LCL.Price 7 Alpha USR = CONCAT(LCL.Price 7 Alpha USR,LCL.USR Work Field 4A     USR,CON.*ZERO)
LCL.Price_7_Alpha_USR = LCL.Price_7_Alpha_USR + LCL.USR_Work_Field_4A_USR (*ZERO);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,CON.+O=,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + '+O=' (0);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,LCL.Price 7 Alpha USR,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + LCL.Price_7_Alpha_USR (*ZERO);

// CUR.Error Reason Descript 7 = CONCAT(CUR.Error Reason Descript 7,CON.=>,CON.*ZERO)
CUR.Error_Reason_Descript_7 = CUR.Error_Reason_Descript_7 + '=>' (*ZERO);

//?Price
//?04/26/18 DN R12926-Use Absorbed Freight Rate from OH instead of Co Cust.
// Comparison Price
CUR.Price_64_2_USR = ( LCL.Projected_Market_Price + ( DB1.Absorbed_Freight_Rate_CWT                +
/ 100 ) ) + LCL.Market_Overage;

// WRK.USR Display 6 = CND.Yes
WRK.USR_Display_6 = 'Y';

// WRK.USR Display 7 = CND.Yes
WRK.USR_Display_7 = 'Y';

ENDIF;

//?Reason 8:  Average Shipped Weight not in range
CASE;

// IF PAR.Average Ship Wgt Err USR is yes
IF PAR.Average_Ship_Wgt_Err_USR = 'Y';

// LCL.Item Code Txt = CVTVAR(PAR.Item Code)
LCL.Item_Code_Txt = CVTVAR(PAR.Item_Code);

// CUR.Error Reason Descript 8 = CONCAT(LCL.Item Code Txt,CON.: Avg Ship Wgt Err,CON.*ZERO)
CUR.Error_Reason_Descript_8 = LCL.Item_Code_Txt + ': Avg Ship Wgt Err' (*ZERO);

// WRK.USR Display 8 = CND.Yes
WRK.USR_Display_8 = 'Y';

ENDIF;

//?Reason 9:  Inter-Company Price Error  IC Invoice Price = 0
CASE;

// IF PAR.InterCo Price Err USR is Yes
IF PAR.InterCo_Price_Err_USR = 'Y';

// LCL.Item Code Txt = CVTVAR(PAR.Item Code)
LCL.Item_Code_Txt = CVTVAR(PAR.Item_Code);

// CUR.Error Reason Descript 9 = CONCAT(LCL.Item Code Txt,CON.:IC Invoice Price = 0,CON.*ZERO)
CUR.Error_Reason_Descript_9 = LCL.Item_Code_Txt + ':IC Invoice Price = 0' (*ZERO);

// WRK.USR Display 9 = CND.Yes
WRK.USR_Display_9 = 'Y';

ENDIF;

//?Reason 10: Revenue week is closed for the Actual Ship Date    LJB
CASE;

// IF PAR.Status - Y or N is yes
IF PAR.Status_Y_or_N = 'Y';

// AND DB1.Order Type - Sales is Regular Order
AND DB1.Order_Type_Sales = 'OR';

// CUR.Explaination Text 1 = CON.Revenue Week closed for
CUR.Explaination_Text_1 = 'Revenue Week closed for';

// CUR.Explaination Text 1 = CONCAT(CUR.Explaination Text 1,CON.Actual Ship Date,CON.1)
CUR.Explaination_Text_1 = CUR.Explaination_Text_1 + 'Actual Ship Date' (1);

// WRK.Display Flag 1 USR = CND.yes
WRK.Display_Flag_1_USR = 'Y';

ENDIF;

//?Reason 11: PFS Ship order detail is unprocessed    RMC 7/31/06
CASE;

// IF PAR.Record Found USR is Record Found
IF PAR.Record_Found_USR = 'Y';

// CUR.Explaination Text 11 = CONCAT(CON.PFS Ship Order Dtl is Unp,CON.rocessed.,CON.*ZERO)
CUR.Explaination_Text_11 = 'PFS Ship Order Dtl is Unp' + 'rocessed.' (*ZERO);

// WRK.USR Display 11 = CND.Yes
WRK.USR_Display_11 = 'Y';

ENDIF;

//?Reason 12: Order Status for One-Invoice Per PO. 12/05/06 PKD PK0040
CASE;

// IF PAR.Order Status is Open
IF PAR.Order_Status = 'O';

// CUR.Explaination Text 12 = CONCAT(CON.Orders for PO,DB1.Customer Purchase Order #,CON.1)
CUR.Explaination_Text_12 = 'Orders for PO' + DB1.Customer_Purchase_Order_# (1);

// CUR.Explaination Text 12 = CONCAT(CUR.Explaination Text 12,CON.not shipped,CON.1)
CUR.Explaination_Text_12 = CUR.Explaination_Text_12 + 'not shipped' (1);

// WRK.USR Display 12 = CND.Yes
WRK.USR_Display_12 = 'Y';

ENDIF;

// CUR.Explaination Text 13 = CON.*BLANK
CUR.Explaination_Text_13 = *BLANK;

// CUR.Explaination Text 13a = CON.*BLANK
CUR.Explaination_Text_13a = *BLANK;

//?Reason 13: Oth Ords for this Combo PO has errors 4/26/07 SLM PK0040
CASE;

// IF PAR.Order Status is Cmb PO has Errors
IF PAR.Order_Status = 'E';

// OR CUR.One Invoice Per PO DRV is Yes
OR CUR.One_Invoice_Per_PO_DRV = 'Y';

EXECUTE FUNCTION(RTV Po and its Orders RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1817155;
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.Ship_To_Customer);
PARAMETER(DB1.Customer_Purchase_Order_#);
PARAMETER(DB1.Scheduled_Ship_Date);
PARAMETER(DB1.Order_Number);
PARAMETER(LCL.Order_Number_1_ALPHA_USR);
PARAMETER(LCL.Order_Number_2_ALPHA_USR);
PARAMETER(LCL.Order_Number_3_ALPHA_USR);
PARAMETER(LCL.Order_Number_4_ALPHA_USR);
PARAMETER(LCL.More_Explanation_USR);
{
 //?USER: Initialize routine

 // PAR.Order Number 1 ALPHA USR = CON.*BLANK
 PAR.Order_Number_1_ALPHA_USR = *BLANK;

 // PAR.Order Number 2 ALPHA USR = CON.*BLANK
 PAR.Order_Number_2_ALPHA_USR = *BLANK;

 // PAR.Order Number 3 ALPHA USR = CVTVAR(CON.*BLANK)
 PAR.Order_Number_3_ALPHA_USR = CVTVAR(*BLANK);

 // PAR.Order Number 4 ALPHA USR = CVTVAR(CON.*BLANK)
 PAR.Order_Number_4_ALPHA_USR = CVTVAR(*BLANK);

 // PAR.More Explanation USR = CVTVAR(CND.Blank)
 PAR.More_Explanation_USR = CVTVAR(*BLANK);

 //?USER: Process Data record

 CASE;

 // IF PAR.Order Number EQ DB1.Order Number
 IF PAR.Order_Number = DB1.Order_Number;

 //?do not perform this on the order = to order being sent in
 // IF PAR.Order Number 1 ALPHA USR EQ WRK.Blank for 12          USR
 IF PAR.Order_Number_1_ALPHA_USR = WRK.Blank_for_12_USR;

 // PAR.Order Number 1 ALPHA USR = CVTVAR(DB1.Order Number)
 PAR.Order_Number_1_ALPHA_USR = CVTVAR(DB1.Order_Number);

 // IF PAR.Order Number 2 ALPHA USR EQ WRK.Blank for 12          USR
 IF PAR.Order_Number_2_ALPHA_USR = WRK.Blank_for_12_USR;

 // PAR.Order Number 2 ALPHA USR = CVTVAR(DB1.Order Number)
 PAR.Order_Number_2_ALPHA_USR = CVTVAR(DB1.Order_Number);

 // IF PAR.Order Number 3 ALPHA USR EQ WRK.Blank for 12          USR
 IF PAR.Order_Number_3_ALPHA_USR = WRK.Blank_for_12_USR;

 // PAR.Order Number 3 ALPHA USR = CVTVAR(DB1.Order Number)
 PAR.Order_Number_3_ALPHA_USR = CVTVAR(DB1.Order_Number);

 // IF PAR.Order Number 4 ALPHA USR EQ WRK.Blank for 12          USR
 IF PAR.Order_Number_4_ALPHA_USR = WRK.Blank_for_12_USR;

 // PAR.Order Number 4 ALPHA USR = CVTVAR(DB1.Order Number)
 PAR.Order_Number_4_ALPHA_USR = CVTVAR(DB1.Order_Number);

 // IF PAR.Order Number 4 ALPHA USR NE WRK.Blank for 12          USR
 IF PAR.Order_Number_4_ALPHA_USR <> WRK.Blank_for_12_USR;

 //?Still more records so this will make the + and quit
 // PAR.More Explanation USR = CND.Yes
 PAR.More_Explanation_USR = 'Y';

 QUIT;

 ENDIF;

}


CASE;

// IF LCL.Order Number 1 ALPHA USR GT WRK.BLANK 1               USR
IF LCL.Order_Number_1_ALPHA_USR > WRK.BLANK_1_USR;

// CUR.Explaination Text 13 = CONCAT(CON.PO #,DB1.Customer Purchase Order #,CON.1)
CUR.Explaination_Text_13 = 'PO #' + DB1.Customer_Purchase_Order_# (1);

CASE;

// IF PAR.Order Status is Cmb PO has Errors
IF PAR.Order_Status = 'E';

// CUR.Explaination Text 13 = CONCAT(CUR.Explaination Text 13,CON.has ords with errors,CON.1)
CUR.Explaination_Text_13 = CUR.Explaination_Text_13 + 'has ords with errors' (1);

// IF *OTHERWISE
IF *OTHERWISE;

// CUR.Explaination Text 13 = CONCAT(CUR.Explaination Text 13,CON.has other orders,CON.1)
CUR.Explaination_Text_13 = CUR.Explaination_Text_13 + 'has other orders' (1);

ENDIF;

// WRK.USR Display 13 = CND.Yes
WRK.USR_Display_13 = 'Y';

// CUR.Explaination Text 13a = CONCAT(CON.Orders:,LCL.Order Number 1 ALPHA USR,CON.1)
CUR.Explaination_Text_13a = 'Orders:' + LCL.Order_Number_1_ALPHA_USR (1);

// CUR.Explaination Text 13a = CONCAT(CUR.Explaination Text 13a,LCL.Order Number 2 ALPHA USR,CND.*On
CUR.Explaination_Text_13a = CUR.Explaination_Text_13a + LCL.Order_Number_2_ALPHA_USR (1);

// CUR.Explaination Text 13a = CONCAT(CUR.Explaination Text 13a,LCL.Order Number 3 ALPHA USR,CND.*On
CUR.Explaination_Text_13a = CUR.Explaination_Text_13a + LCL.Order_Number_3_ALPHA_USR (1);

// CUR.Explaination Text 13a = CONCAT(CUR.Explaination Text 13a,LCL.Order Number 4 ALPHA USR,CND.*On
CUR.Explaination_Text_13a = CUR.Explaination_Text_13a + LCL.Order_Number_4_ALPHA_USR (1);

CASE;

// IF LCL.More Explanation USR is Yes
IF LCL.More_Explanation_USR = 'Y';

// CUR.Explaination Text 13a = CONCAT(CUR.Explaination Text 13a,CON.+,CND.*One)
CUR.Explaination_Text_13a = CUR.Explaination_Text_13a + '+' (1);

ENDIF;

ENDIF;

ENDIF;

//?Reason 15: EDI PO Ack-855 not sent yet for customer that requires one.
CASE;

// IF LCL.D-EDI INV PROC FLAG is Not Yes
IF LCL.D_EDI_INV_PROC_FLAG = 'N'/*BLANK;

// CUR.Explaination Text 15 = CON.EDI PO Ack Sts =
CUR.Explaination_Text_15 = 'EDI PO Ack Sts =';

CASE;

// IF LCL.D-EDI INV PROC FLAG is *No
IF LCL.D_EDI_INV_PROC_FLAG = 'N';

// LCL.Text 10A USR = CON.Pending
LCL.Text_10A_USR = 'Pending';

// IF LCL.D-EDI INV PROC FLAG is Not Processed
IF LCL.D_EDI_INV_PROC_FLAG = *BLANK;

// LCL.Text 10A USR = CON.Not Found
LCL.Text_10A_USR = 'Not Found';

ENDIF;

// CUR.Explaination Text 15 = CONCAT(CUR.Explaination Text 15,LCL.Text 10A USR,CON.1)
CUR.Explaination_Text_15 = CUR.Explaination_Text_15 + LCL.Text_10A_USR (1);

// WRK.USR Display 15 = CND.Yes
WRK.USR_Display_15 = 'Y';

ENDIF;

//?Reason 16: GTIN Error
CASE;

// IF LCL.GTIN Error Sts USR is Error
IF LCL.GTIN_Error_Sts_USR = 'E';

// CUR.Explaination Text 16 = CON.EDI PO Ack Err =
CUR.Explaination_Text_16 = 'EDI PO Ack Err =';

EXECUTE FUNCTION(Item Code DRV) TYPE(DRVFLD)                                    AC1670444;
PARAMETER(LCL.Item_Code_DRV);
PARAMETER(LCL.GTIN_Error_Item_Code_USR);
{
 //?Calculate derived field

 // LCL.Number 5,0            USR = PAR.Item Code
 LCL.Number_50_USR = PAR.Item_Code;

 // LCL.Text USR 5 = CVTVAR(LCL.Number 5,0            USR)
 LCL.Text_USR_5 = CVTVAR(LCL.Number_50_USR);

 // PAR.Item Code DRV = LCL.Text USR 5
 PAR.Item_Code_DRV = LCL.Text_USR_5;

}


// LCL.Item Code 5A = LCL.Item Code DRV
LCL.Item_Code_5A = LCL.Item_Code_DRV;

// CUR.Explaination Text 16 = CONCAT(CUR.Explaination Text 16,LCL.Item Code 5A,CON.1)
CUR.Explaination_Text_16 = CUR.Explaination_Text_16 + LCL.Item_Code_5A (1);

// CUR.Explaination Text 16 = CONCAT(CUR.Explaination Text 16,CON.GTIN,CON.1)
CUR.Explaination_Text_16 = CUR.Explaination_Text_16 + 'GTIN' (1);

// CUR.Explaination Text 16 = CONCAT(CUR.Explaination Text 16,CON.Missing,CON.1)
CUR.Explaination_Text_16 = CUR.Explaination_Text_16 + 'Missing' (1);

// WRK.USR Display 16 = CND.Yes
WRK.USR_Display_16 = 'Y';

ENDIF;

//?USER: Process after print of detail format

CASE;

// IF DB1.Order Type Print Status is yes
IF DB1.Order_Type_Print_Status = 'Y';

EXECUTE FUNCTION(CHG Ord Typ Prt Status CH) TYPE(CHGOBJ) FILE(OPBFCPP)          AC1308691;
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER('N');
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?Execute internal function

  // PAR.Job Time = JOB.*Job time
  PAR.Job_Time = JOB.*Job_time;

  // PAR.User Id = JOB.*USER
  PAR.User_Id = JOB.*USER;

  // PAR.Job Name = JOB.*PROGRAM
  PAR.Job_Name = JOB.*PROGRAM;

  // PAR.Job Date = JOB.*Job date
  PAR.Job_Date = JOB.*Job_date;

 }

 // Call program TRG Order Hdr CHG Trig XT.
 CALL PROGRAM(TRG Order Hdr CHG Trig XT) ('PDW9XFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Type_Sales);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Ship_To_Name);
 PARAMETER(DB1.Ship_To_Address_Line_1);
 PARAMETER(DB1.Ship_To_Address_Line_2);
 PARAMETER(DB1.Ship_To_Address_Line_3);
 PARAMETER(DB1.Ship_To_City);
 PARAMETER(DB1.Ship_To_State_Code);
 PARAMETER(DB1.Ship_To_Zip_Postal_Code);
 PARAMETER(DB1.Bill_to_Customer);
 PARAMETER(DB1.Bill_to_Name);
 PARAMETER(DB1.Bill_to_Address_Line_1);
 PARAMETER(DB1.Bill_to_Address_Line_2);
 PARAMETER(DB1.Bill_to_Address_Line_3);
 PARAMETER(DB1.Bill_to_City);
 PARAMETER(DB1.Bill_to_State_Code);
 PARAMETER(DB1.Bill_to_Zip_Postal_Code);
 PARAMETER(DB1.Customer_Purchase_Order_#);
 PARAMETER(DB1.Order_Date);
 PARAMETER(DB1.Requested_Ship_Date);
 PARAMETER(DB1.Actual_Shipped_Date);
 PARAMETER(DB1.Cancel_Date);
 PARAMETER(DB1.Terms_Code);
 PARAMETER(DB1.Special_Instructions);
 PARAMETER(DB1.Special_Instructions_2);
 PARAMETER(DB1.Carrier_Code);
 PARAMETER(DB1.Comment_Print_Acknowledge);
 PARAMETER(DB1.Comment_Print_Inv_Cr_Memo);
 PARAMETER(DB1.Comment_Print_Pick_Slip);
 PARAMETER(DB1.Comment_Print_Ship_Doc);
 PARAMETER(DB1.Reason_Code);
 PARAMETER(DB1.Order_in_Use);
 PARAMETER(DB1.Header_Status);
 PARAMETER(DB1.Header_Status_Last);
 PARAMETER(PAR.Order_Type_Print_Status);
 PARAMETER(DB1.Scheduled_Ship_Date);
 PARAMETER(DB1.User_Original_Entry);
 PARAMETER(DB1.Date_of_Original_Entry);
 PARAMETER(DB1.Order_Value_Total);
 PARAMETER(DB1.Order_Weight_Total);
 PARAMETER(DB1.Credit_Hold);
 PARAMETER(DB1.Production_Hold);
 PARAMETER(DB1.New_Customer_Hold);
 PARAMETER(DB1.Requested_Delivery_Date);
 PARAMETER(DB1.Requested_Delivery_Time);
 PARAMETER(DB1.Accounts_Receiv_Ent_1);
 PARAMETER(DB1.Accounts_Receiv_Ent_2);
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Absorbed_Freight_Rate_CWT);
 PARAMETER(DB1.Rated_Freight);
 PARAMETER(DB1.LTL_Flag);
 PARAMETER(DB1.Price_Audit);
 PARAMETER(DB1.Price_Status);
 PARAMETER(DB1.Shipping_Method);
 PARAMETER(DB1.Export_Status);
 PARAMETER(DB1.Palletize);
 PARAMETER(DB1.Shrink_Wrap);
 PARAMETER(DB1.Slip_Sheet);
 PARAMETER(DB1.Age_Code);
 PARAMETER(DB1.Reefer_Temperature);
 PARAMETER(DB1.Load_Type);
 PARAMETER(DB1.Attach_to_Invoice_Number);
 PARAMETER(DB1.Load_Plan_Order);
 PARAMETER(DB1.Print_Pick_Slip);
 PARAMETER(DB1.Resell_Reference_Number);
 PARAMETER(DB1.Special_Comment_1);
 PARAMETER(DB1.Special_Comment_2);
 PARAMETER(DB1.Affect_Auto_Accruals);
 PARAMETER(DB1.Sales_Route_Code);
 PARAMETER(DB1.Manager_Level_Code);
 PARAMETER(DB1.VP_Level_Code);
 PARAMETER(DB1.Attach_to_Order_Number);
 PARAMETER(DB1.Reason_for_Price_Audit);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Invoice_Date);
 PARAMETER(DB1.Event_Code);
 PARAMETER(DB1.Trans_Contol_AS400_Plant);
 PARAMETER(DB1.Modified_Flag);
 PARAMETER(DB1.A_R_order_Value_Total);
 PARAMETER(DB1.Billing_Activity_Type);
 PARAMETER(DB1.Block_Order_Flag);
 PARAMETER(DB1.Order_Certification_Flag);
 PARAMETER(DB1.Invoice_Order_Value_Tot);
 PARAMETER(DB1.Process_Sts_for_3C);
 PARAMETER(DB1.Order_Conf_Fax_Sts);
 PARAMETER(DB1.Manifest_Fax_Sts);
 PARAMETER(DB1.Invoice_Fax_Sts);
 PARAMETER(DB1.Transfer_in_Storage_Ind);
 PARAMETER(DB1.Email_Cust_On_Order_Ship);
 PARAMETER(DB1.Order_Emailed);
 PARAMETER(DB1.Export_Docs_Go_w_Driver);
 PARAMETER(DB1.Shipping_Temp_Code_C_F);
 PARAMETER(DB1.Broker_Order_Status);
 PARAMETER(DB1.Air_Freight_Order);
 PARAMETER(DB1.Order_Requires_Review);
 PARAMETER(DB1.OH_Load_Plan_Ready);
 PARAMETER(DB1.Export_USDA_Approved);
 PARAMETER(DB1.HPB_Ship_to_Warehouse);
 PARAMETER(DB1.OH_TF_Exempt_Code);
 PARAMETER(DB1.OH_Appt_Confirmation_Dt);
 PARAMETER(DB1.JPN_Invoice_Issuance_Date);
 PARAMETER(DB1.Load_Actual_Shipped_Date);
 PARAMETER(DB1.Load_BOL_Complete_Date);
 PARAMETER(DB1.Load_Truck_Departure_Date);
 PARAMETER(DB1.Maximum_Gross_Weight);
 PARAMETER(DB1.Time_of_Original_Entry);
 PARAMETER(DB1.OH_Appt_Confirmation_Tm);
 PARAMETER(DB1.Load_BOL_Complete_Time);
 PARAMETER(DB1.Load_Truck_Departure_Time);
 PARAMETER(DB1.Act_Frt_Reference_Amount);
 PARAMETER(DB1.Act_Non_Ref_Frt_Amount);
 PARAMETER(DB1.OH_Fuel_Surcharge_Amount);
 PARAMETER(DB1.OH_Total_Non_Ref_Frt_Amt);
 PARAMETER(DB1.OH_Total_Ref_Frt_Amt);
 PARAMETER(DB1.Claim_Number);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);

}


ENDIF;

//?USER: Print required level totals

// SUPPRESSED PRINT Accounting Company Number totals format

