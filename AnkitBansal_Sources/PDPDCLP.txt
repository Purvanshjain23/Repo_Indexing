/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM FOR ORDER STATUS INQUIRY               */
/*      CO#, CUST#, SALES ROUTE,ORDER NO, PRICE STATUS, PRICE AUDIT,*/
/*             MODIFIED FLAG, LOAD STATUS, ORDER STATUS, SCHED SHIP */
/*             DATE, ACTUAL SHIP DATE, LOAD ID, WAREHOUSE CODE.     */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT ORDER STATUS INQUIRY BY SALES ROUTE           */
/*  DATE      -  9/16/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/*          &COMPNYN    - COMPANY NUMBER (PASSED)                   */
/*          &CUSTN      - CUSTOMER NUMBER (PASSED)                  */
/*          &SCHDATN    - SCHED SHIP DT  (PASSED)                   */
/*          &ACTDATN    - ACTUAL SHIP DT (PASSED)                   */
/*          &ORDERN     - ORDER NUMBER   (PASSED)                   */
/*          &LOADN      - LOAD NUMBER    (PASSED)                   */
/*          &WHSCDE     - WAREHOUSE CODE (PASSED)                   */
/*          &DTLSUM     - DETAIL OR SUMMARY                         */
/*          &RPTSEL     - REPORT SELECTION                          */
/*          &ORDSTS     - ORDER STATUS   (PASSED)                   */
/*          &PRCAUD     - PRICE AUDIT    (PASSED)                   */
/*          &PRCSTS     - PRICE STATUS   (PASSED)                   */
/*          &SLSRTE     - SALES ROUTE     (PASSED)                  */
/*          &MODFLG     - MODIFIED FLAG  (PASSED)                   */
/*          &BLKORD     - BLOCK ORDER FLAG  (PASSED)                */
/*          &LOADSTS    - LOAD STATUS    (PASSED)                   */
/*********************************************************************/
/* MODIFICATIONS:                                                    */
/*  RMC 9/1/6  CLOSE THE OPENID AFTER RUNNING - CLOF COMMAND         */
/*  PKD 6/28/07 ADDED PRICE METHOD CODE                              */
/*-------------------------------------------------------------------*/
/*  LJB 10/3/06 L61002C ADD PRINT STATUS FLAG TO PDPDPFR TO CONTROL  */
/*             DISPLAY OF PRICING INFO ON THE PRINTED REPORT         */
/*  PIO 06/12/23 REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPLX FILE       */
/*               ADDED NEEDED OVRDBF AROUND THE COMMAND              */
/*               CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*               *GT TO > IN &E                                      */
/*  PIO 06/12/23 REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPM7 FILE       */
/*               ADDED NEEDED OVRDBF AROUND THE COMMAND              */
/*               CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*               *GT TO > IN &E                                      */
/*  PIO 05/12/25 REPLACE THE COMMAND                                 */
/*               (BEJPCD >= 06 AND BEJPCD <= 07)')                   */
/*               (BEJPCD IN ("06","07"))')                           */
/*********************************************************************/
/***** PDPDCLP:    PGM        PARM(&COMPNYN &CUSTN &SCHDATN &ACTDATN +
                          &ORDERN &LOADN &WHSCDE &DTLSUM &RPTSEL +
                          &ORDSTS &PRCAUD &PRCSTS &SLSRTE &MODFLG +
                          &BLKORD &LOADSTS +
                          &OUTQ &HOLD &SAVE &COPYN &NIGHTQ) **********/

 PDPDCLP:    PGM        PARM(&COMPNYN &CUSTN &SCHDATN &ACTDATN +
                          &ORDERN &LOADN &WHSCDE &DTLSUM &RPTSEL +
                          &ORDSTS &PRCAUD &PRCSTS &SLSRTE &MODFLG +
                          &BLKORD &LOADSTS &PMTH &OUTQ &HOLD &SAVE +
                          &COPYN &NIGHTQ &PRINTSTS)

/* PARMS                                                                      */
        DCL    &COMPNYN    *DEC                  /* Company Number (Passed)   */
        DCL    &CUSTN      *DEC                  /* CUSTOMER NO.   (Passed)   */
        DCL    &SCHDATN    *DEC                  /* SCHEDULED DATE (Passed)   */
        DCL    &ACTDATN    *DEC                  /* ACTUAL SHIP DT (Passed)   */
        DCL    &ORDERN     *DEC                  /* ORDER NO.      (Passed)   */
        DCL    &LOADN      *DEC                  /* LOAD NO.                  */
        DCL    &WHSCDE     *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &DTLSUM     *CHAR   (1)           /* DETAIL OR SUMMARY         */
        DCL    &RPTSEL     *CHAR   (1)           /* REPORT SELECTION          */
        DCL    &ORDSTS     *CHAR   (1)           /* ORDER STATUS              */
        DCL    &PRCAUD     *CHAR   (1)           /* PRICE AUDIT               */
        DCL    &PRCSTS     *CHAR   (1)           /* PRICE STATUS              */
        DCL    &SLSRTE     *CHAR   (3)           /* SALES ROUTE               */
        DCL    &MODFLG     *CHAR   (1)           /* MODIFIED FLAG             */
        DCL    &BLKORD     *CHAR   (1)           /* BLOCK ORDER FLAG          */
        DCL    &LOADSTS    *CHAR   (1)           /* LOAD STATUS               */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &NIGHTQ     *CHAR   (10)          /* Night Job Queue           */
        DCL    &PGMO       *CHAR    10           /*  PRINTER FILE  */
        DCL    &B          *CHAR    30           /*  QRY-SEL CO.#  */
        DCL    &D          *CHAR    30           /*  QRY-CUSTOMER NO.   */
        DCL    &BB         *CHAR    30           /*  QRY-SEL PRICE AUDIT */
        DCL    &BBB        *CHAR    30           /*  QRY-ORDER STATUS    */
        DCL    &C          *CHAR    30           /*  QRY-SEL PRICE STS  */
        DCL    &CC         *CHAR    30           /*  QRY-SEL ORDER NO   */
        DCL    &CCC        *CHAR    30           /*  QRY-SEL SALES ROUTE*/
        DCL    &DD         *CHAR    30           /*  QRY-SEL LOAD ID     */
        DCL    &DDD        *CHAR    30           /*  QRY-SEL SCHD SHIP DATE  */
        DCL    &EEE        *CHAR    30           /*  QRY-SEL ACT SHP DTDATE  */
 /*PIO  DCL    &E          *CHAR   275   */      /*  QRY COMPLETE SEL. */
 /*PIO*/DCL    &E          *CHAR   325           /*  QRY COMPLETE SEL. */
 /*PIO*/DCL    &F          *CHAR   250
        DCL    &COMMAND    *CHAR   (512)
        DCL    &PRINTSTS   *CHAR   (1)           /* PRINT STATUS              */
        DCL    &PMTH       *CHAR   (3)           /* PRICE METHOD CODE         */

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMPANY    *DEC    (3 0)         /* Company Number            */
        DCL    &CUSTOMER   *DEC    (7 0)         /* CUSTOMER Number           */
        DCL    &ORDER      *DEC    (7 0)         /* From ORDER                */
        DCL    &LOADNO     *DEC    (7 0)         /* LOAD NO                   */
        DCL    &SCHDAT     *DEC    (7 0)         /* SCHEDULED DATE            */
        DCL    &ACTDAT     *DEC    (7 0)         /* ACTUAL SHIP DATE          */

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* COMPANY                   */
        DCL    &CUSTA      *CHAR    7            /* CUSTOMER                  */
        DCL    &ORDERA     *CHAR    7            /* FROM ORDER                */
        DCL    &LOADNOA    *CHAR    7            /* LOAD NO.       (Passed)   */
        DCL    &SCHDATA    *CHAR    7            /* SCHED SHIP DT  (Passed)   */
        DCL    &ACTDATA    *CHAR    7            /* ACTUAL SHIP DT (Passed)   */

/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/

             CHGVAR     VAR(&PGMO) VALUE(PDPDPFR$)
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&CUSTOMER) VALUE(&CUSTN)
             CHGVAR     VAR(&CUSTA) VALUE(&CUSTOMER)
             CHGVAR     VAR(&ORDER) VALUE(&ORDERN)
             CHGVAR     VAR(&ORDERA) VALUE(&ORDER)
             CHGVAR     VAR(&SCHDAT) VALUE(&SCHDATN)
             CHGVAR     VAR(&SCHDATA) VALUE(&SCHDAT)
             CHGVAR     VAR(&ACTDAT) VALUE(&ACTDATN)
             CHGVAR     VAR(&ACTDATA) VALUE(&ACTDAT)
             CHGVAR     VAR(&LOADNO) VALUE(&LOADN)
             CHGVAR     VAR(&LOADNOA) VALUE(&LOADNO)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)

/* ELIMINATE DECIMAL DATA ERROR                    */
             IF         COND(&COMPA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&COMPANY) VALUE(0)
             ENDDO
             IF         COND(&CUSTA *EQ '       ') THEN(DO)
             CHGVAR     VAR(&CUSTOMER) VALUE(0)
             ENDDO
             IF         COND(&ORDERA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&ORDER) VALUE(0)
             ENDDO
             IF         COND(&SCHDATA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&SCHDAT) VALUE(0)
             ENDDO
             IF         COND(&ACTDATA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&ACTDAT) VALUE(0)
             ENDDO
             IF         COND(&LOADNOA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&LOADNO) VALUE(0)
             ENDDO
/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED                               */
/*********************************************************************/

/*  IF CO. NUMBER SELECTED  */
             IF         COND(&COMPA *NE '000') THEN(DO)
 /*PIO       CHGVAR     VAR(&B) VALUE('BEAIC3 *EQ ' *CAT &COMPA) */
 /*PIO*/     CHGVAR     VAR(&B) VALUE('BEAIC3  =  ' *CAT &COMPA)
             ENDDO

/*  IF CUSTOMER NUMBER SELECTED  */
             IF         COND(&CUSTA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&D) VALUE('*AND BEBKC7 *EQ ' *CAT &CUSTA) */
 /*PIO*/     CHGVAR     VAR(&D) VALUE(' AND BEBKC7  =  ' *CAT &CUSTA)
             ENDDO

/*  IF SCHEDULED SHIP DATE IS SELECTED */

             IF         COND(&SCHDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDD) VALUE('*AND BEAODT *LE ' *CAT &SCHDATA)*/
 /*PIO*/     CHGVAR     VAR(&DDD) VALUE(' AND BEAODT  <= ' *CAT &SCHDATA)
             ENDDO

/*  IF ACTUAL SHIPPED DT SELECTED*/

             IF         COND(&ACTDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&EEE) VALUE('*AND BEGNDT *LE ' *CAT &ACTDATA) */
 /*PIO*/     CHGVAR     VAR(&EEE) VALUE(' AND BEGNDT  <= ' *CAT &ACTDATA)
             ENDDO


/*  IF FROM ORDER IS ENTERED */

             IF         COND(&ORDERA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&CC) VALUE('*AND BEC4NB *EQ ' *CAT &ORDERA) */
  /*PIO*/    CHGVAR     VAR(&CC) VALUE(' AND BEC4NB  =  ' *CAT &ORDERA)
             ENDDO

/*  IF LOAD ID IS SELECTED */

             IF         COND(&LOADNOA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DD) VALUE('*AND BERMNB *EQ ' *CAT &LOADNOA)  */
 /*PIO*/     CHGVAR     VAR(&DD) VALUE(' AND BERMNB  =  ' *CAT &LOADNOA)
             ENDDO


/*  IF ORDER STATUS IS SELECTED                                   */
             IF         COND(&ORDSTS *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&BBB) VALUE('*AND BEGWST *EQ "' *CAT + +
                          &ORDSTS *CAT '"')                       */
 /*PIO*/     CHGVAR     VAR(&BBB) VALUE(' AND BEGWST =   "' *CAT +
                          &ORDSTS *CAT '"')
             ENDDO

/*  IF PRICE AUDIT IS SELECTED                                    */
             IF         COND(&PRCAUD *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&BB) VALUE('*AND BEU0ST *EQ "' *CAT &PRCAUD + +
                        *CAT '"')                                        */
 /*PIO*/     CHGVAR     VAR(&BB) VALUE(' AND BEU0ST  =  "' *CAT &PRCAUD +
                        *CAT '"')
             ENDDO

/*  IF PRICE STATUS IS SELECTED                                    */
             IF         COND(&PRCSTS *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&C) VALUE('*AND BEU1ST *EQ "' *CAT &PRCSTS + +
                        *CAT '"')                                      */
 /*PIO*/     CHGVAR     VAR(&C) VALUE(' AND BEU1ST  =  "' *CAT &PRCSTS +
                        *CAT '"')
             ENDDO

/*  IF SALES ROUTE ID ENTERED */

             IF         COND(&SLSRTE *NE '   ') THEN(DO)
 /*PIO       CHGVAR     VAR(&CCC) VALUE('*AND BER4CD *EQ "' *CAT &SLSRTE + +
                        *CAT '"')                                         */
 /*PIO*/     CHGVAR     VAR(&CCC) VALUE(' AND BER4CD  =  "' *CAT &SLSRTE +
                        *CAT '"')
             ENDDO

 /*PIO       CHGVAR     VAR(&F) VALUE(' AND BEGWST IN ("C","X") AND  +
                          (BEJPCD >= 06 AND BEJPCD <= 07)')   */

 /*PIO*/     CHGVAR     VAR(&F) VALUE(' AND BEGWST IN ("C","X") AND  +
                          (BEJPCD IN ("06","07"))')

/* BUILD QUERY STRING                                        */

  /*PIO      CHGVAR     VAR(&E) VALUE(&B *BCAT &D *BCAT &BB *BCAT +  +
                          &BBB *BCAT &C *BCAT &CC *BCAT &CCC *BCAT + +
                          &DD *BCAT &DDD *BCAT &EEE)                */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(&B *BCAT &D *BCAT &BB *BCAT +
                          &BBB *BCAT &C *BCAT &CC *BCAT &CCC *BCAT +
                          &DD *BCAT &DDD *BCAT &EEE *BCAT &F)

/********************************************************************/
/* RUN REPORT BY SALES ROUTE/SCHEDULED SHIP DT/ACTUAL SHIP DT*/
/********************************************************************/
             IF         COND(&RPTSEL *EQ '1') THEN(DO)

  /*PIO      OVRDBF     FILE(OPBFCPLX) SHARE(*YES)      +
             OPNQRYF    FILE((OPBFCPLX)) QRYSLT(&E) KEYFLD(*FILE) + +
                          SEQONLY(*YES 1)                         */

  /*PIO*/    OVRDBF     FILE(OPBFCPP) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP Where  ' *BCAT &E +
                          *BCAT ' ORDER BY BEAIC3 ASC, BER4CD ASC, +
                          BEAODT ASC, BEGNDT ASC, BEC4NB ASC ') +
                          OPNID(OPBFCPLX) OPTION(*ALL) SEQONLY(*NO) +
                          RCDFMT(@BFCPLX) ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPLX) TOFILE(OPBFCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/*********************************************************************/
/*   CALL PRINT PROGRAM - ORDER STATUS INQUIRY LISTING               */
/*********************************************************************/
/*********   CALL       PGM(PDPDPFR) PARM(' ' &COMPANY &ORDER +
                          &CUSTOMER &ACTDAT &ORDSTS &SCHDAT &LOADNO +
                          &PRCAUD &PRCSTS &SLSRTE &MODFLG &BLKORD +
                          &LOADSTS &WHSCDE &DTLSUM &RPTSEL)***********/

             CALL       PGM(PDPDPFR) PARM(' ' &COMPANY &ORDER +
                          &CUSTOMER &ACTDAT &ORDSTS &SCHDAT &LOADNO +
                          &PRCAUD &PRCSTS &SLSRTE &MODFLG &BLKORD +
                          &LOADSTS &WHSCDE &DTLSUM &RPTSEL +
                          &PRINTSTS &PMTH)

             CLOF       OPNID(OPBFCPLX)
             ENDDO

/*********************************************************************/
/* RUN REPORT BY SCHEDULED SHIP DT/ACTUAL SHIP DT                    */
/*********************************************************************/

             IF         COND(&RPTSEL *EQ '2') THEN(DO)

   /*PIO     OVRDBF     FILE(OPBFCPM7) SHARE(*YES)            +
             OPNQRYF    FILE((OPBFCPM7)) QRYSLT(&E) KEYFLD(*FILE) + +
                          SEQONLY(*YES 1)          */

  /*PIO*/    OVRDBF     FILE(OPBFCPP) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP Where  ' *BCAT &E +
                          *BCAT ' ORDER BY BEAIC3 ASC, BEAODT ASC, +
                          BEGNDT ASC, BEC4NB ASC') OPNID(OPBFCPM7) +
                          OPTION(*ALL) SEQONLY(*NO) RCDFMT(@BFCPJ7) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPM7) TOFILE(OPBFCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDPUPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

/*********************************************************************/
/*   CALL PRINT PROGRAM -
/*********************************************************************/

             CALL       PGM(PDPUPFR) PARM(' ' &COMPANY &ORDER +
                          &CUSTOMER &ACTDAT &ORDSTS &SCHDAT &LOADNO +
                          &PRCAUD &PRCSTS &SLSRTE &MODFLG &BLKORD +
                          &LOADSTS &WHSCDE &DTLSUM &RPTSEL &PRINTSTS +
                          &PMTH)
             CLOF       OPNID(OPBFCPM7)
             ENDDO
 END:        ENDPGM
