// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPVMETR
// ?Date: 14.08.2025 Time: 03:42:02
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

EXECUTE FUNCTION(VAL Rtv and Center Hdg IF) TYPE(EXCINTFUN)                     AC1258539;
PARAMETER('C/S');

EXECUTE FUNCTION(RTV Box Item code      RT) TYPE(RTVOBJ) FILE(PDIOREP)          AC1402262;
PARAMETER(CTL.Company_Number);
PARAMETER(CTL.Item_Code);
PARAMETER(PAR.Item_Code_USR);

//?***** Change Log and comments
DO;

//?CST/ITM Santosh 04/14/25 - Recompilation due to DDS to DDL conversion of
//?   "PDIHREP - Price Method Header".
//?** 02/26/2009 LJB E00355
//?PIO 11/26/24 We are recompiling the program as new field is addded in WHS
//?** Sales Yield can now be negative, display the negative sign
//?RMC 05/17/07 Chg Detail was calling a function that did updating.
//?  i changed it to a empty IF, like the Change Header IF
//?** 06/24/2014 JJH E3160
//?** Changed the definition of the "Average if WPA" field to "Upd
//?** Standard Production".  This field is used to NOT increase
//?** by-product production if Upd Standard Production = N(no).
//?** Initially added logic to NOT process 61210 and 64210.
ENDDO;

//?USER: Initialize subfile record (old record)

EXECUTE FUNCTION(Rtv Descriptions      RT) TYPE(RTVOBJ) FILE(CABZREP)           AC1140665;
PARAMETER(DB2.Company_Number);
PARAMETER(DB2.Component_Item_Code);
PARAMETER(RCD.USR_Item_Description);
PARAMETER(NLL.Description_Line_Two);
PARAMETER(NLL.UOM_Primary);
PARAMETER(NLL.UOM_Second);
PARAMETER(NLL.UOM_Third);

// RCD.Display Flag = CND.Yes
RCD.Display_Flag = 'Y';

// RCD.Select Status = CND.yes
RCD.Select_Status = 'Y';

// RCD.Off Line Yield % USR = DB2.BOM Off Line Yield %
RCD.Off_Line_Yield_USR = DB2.BOM_Off_Line_Yield_Pct;

EXECUTE FUNCTION(Rtv Adj Credit Pieces RT) TYPE(RTVOBJ) FILE(PMFDREP)           AC1973401;
PARAMETER(DB2.Company_Number);
PARAMETER(DB2.Item_Code);
PARAMETER(CTL.Adjust_Credit_Pieces);

//?USER: Validate subfile record fields

EXECUTE FUNCTION(Rtv Descriptions      RT) TYPE(RTVOBJ) FILE(CABZREP)           AC1140665;
PARAMETER(CTL.Company_Number);
PARAMETER(RCD.Component_Item_Code);
PARAMETER(RCD.USR_Item_Description);
PARAMETER(NLL.Description_Line_Two);
PARAMETER(NLL.UOM_Primary);
PARAMETER(NLL.UOM_Second);
PARAMETER(NLL.UOM_Third);

//?06/24/2014 JJH E3160 - Average if WPA is now Upd Standard Production
//?If status is blank, move in active
CASE;

// IF RCD.Record Status EQ WRK.BLANK
IF RCD.Record_Status = WRK.BLANK;

// RCD.Record Status = CND.Active
RCD.Record_Status = 'A';

ENDIF;

//?USER: Validate subfile record relations

EXECUTE FUNCTION(Rtv Item Type Code     RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1299967;
PARAMETER(CTL.Company_Number);
PARAMETER(RCD.Component_Item_Code);
PARAMETER(WRK.Item_Type_Code);

//?BOM type is Consumed-Meat
CASE;

// IF RCD.BOM Type is Consumed - Meat
IF RCD.BOM_Type = 'C';

CASE;

// IF CTL.Item Type Code is Finished Goods
IF CTL.Item_Type_Code = 'FG';

//?Converted Base Item
CASE;

// IF CTL.Converted/Base Item is Base
IF CTL.Base_Conv_Loss_Item = 'B';

//?Consumed Item must be Raw Material or Work in Process, else skip
CASE;

// IF WRK.Item Type Code is RM/WP
IF WRK.Item_Type_Code = 'RM'/'WP';

//?Consumed Item must be Raw Material or Work in Process, else skip
// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Converted Base Item
// IF CTL.Converted/Base Item is Converted/Fabricated
IF CTL.Base_Conv_Loss_Item = 'C'/'F';

//?Consumed Item must be Finished Goods /Work in process  (PK0318 5/10/01)
CASE;

// IF WRK.Item Type Code is FG/WP
IF WRK.Item_Type_Code = 'FG'/'WP';

//?Consumed Item must be Finished Goods /Work in process  (PK0318 5/10/01)
// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

ENDIF;

ENDIF;

//?BOM type is Produced-Meat
CASE;

// IF RCD.BOM Type is Produced - Meat
IF RCD.BOM_Type = 'P';

CASE;

// IF CTL.Item Type Code is Finished Goods
IF CTL.Item_Type_Code = 'FG';

EXECUTE FUNCTION(Rtv Credit Item Sts   RT) TYPE(RTVOBJ) FILE(CABZREP)           AC1326370;
PARAMETER(RCD.Company_Number);
PARAMETER(RCD.Component_Item_Code);
PARAMETER(WRK.Credit_Item_Status);

ENDIF;

ENDIF;

//?BOM type is Supplies
CASE;

// IF RCD.BOM Type is Supplies
IF RCD.BOM_Type = 'S';

EXECUTE FUNCTION(Rtv Item Type Code     RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1299967;
PARAMETER(CTL.Company_Number);
PARAMETER(RCD.Component_Item_Code);
PARAMETER(WRK.Item_Type_Code);

//?Item type must be 'PS'
CASE;

// IF WRK.Item Type Code is Packaging and Supplies
IF WRK.Item_Type_Code = 'PS';

//?Item type must be 'PS'
// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: Change header DBF record

EXECUTE FUNCTION(Chg Co/Item BOM       IF) TYPE(EXCINTFUN) FILE(CABZREP)        AC1397808;

//?USER: Change detail DBF record

EXECUTE FUNCTION(Dsp ITM BOM only      IF) TYPE(EXCINTFUN) FILE(PDIOREP)        AC1822267;

