/***************************************************************** */
/*                                                                 */
/*  SYSTEM:          HOG PRODUCTION SYSTEM                         */
/*  PROGRAM NUMBER:  HP263CL                                       */
/*  PROGRAM NAME:    SAFEDATA: UPLOAD GROUP DEATHS                 */
/*  PROGRAMMER:      LEANNE FEDOR                                  */
/*  CREATE DATE:     01/22/01                                      */
/*                                                                 */
/*  FUNCTION:        THIS CL IS CALLED FROM FTPSDIRTV WHICH IS     */
/*                   SUBMITTED FROM THE JOB SCHEDULER UNDER JOB    */
/*                   FTPSDIRTV AT ??? ON MONDAYS ONLY.             */
/*                                                                 */
/*  THE FUNCTION:                                                  */
/*  1) WRITES THE RECEIVING FILE TO EDITING FILES                  */
/*  2) CALLS PROGRAMS TO EDIT/PRINT LISTINGS OVER EDITING FILES    */
/*                                                                 */
/*******************************************************************/
/*  MODIFIED:       BARB GUTIERREZ                                 */
/*                   OVERRIDE PRINT FILE TO GUYPRT02.              */
/*                                                                 */
/*  MODIFIED:        BARB GUTIERREZ     03/13/01                   */
/*                   CHANGED THE NUMBER OF COPIES TO 3 PER RICK    */
/*                   CROSE REQUEST.                                */
/*                                                                 */
/*  MODIFIED:        LEANNE FEDOR       12/05/01                   */
/*                   CHANGED THE NUMBER OF COPIES TO 2 PER RICK    */
/*                   CROSE REQUEST.                                */
/*                                                                 */
/*  MODIFIED:        LEANNE FEDOR       04/01/04                   */
/*                   ADDED A WORKFILE SO WE COULD PRINT THE        */
/*                   'GROUP DEATHS UPLOAD LISTING' WITH ALL        */
/*                   THE 'ERROR' RECORDS FIRST FOLLOWED BY ALL THE */
/*                   'POSTED' RECORDS.                             */
/*                                                                 */
/*  MODIFIED:        LEANNE RAMSEY      04/13/10                   */
/*                   CHANGE THE 'COPIES' VALUE FROM 2 TO 1.        */
/*                   THE USERS ARE NO LONGER PRINTING THESE; WE    */
/*                   HAVE GONE TO ESNDMAIL IN DRIVER CL FTPSDIRTV. */
/*                                                                 */
/*  02/28/23  ERIC LOUCHEZ    TICKET 120610                        */
/*            TRYING TO GET THE REPORT ATTACHED TO THE EMAILS      */
/*            THIS CL IS BEING SUBMITTED BY FTPSDIRTV              */
/*            MOVE ESNDMAIL TO THIS CL FROM FTPSDIRTV              */
/*  03/01/23  ERIC LOUCHEZ    TICKET 120610                        */
/*            CHANGE SUBJECT AND MESSAGE                           */
/*  03/17/23  ERIC LOUCHEZ    TICKET 120610                        */
/*            CPYF - CLRPFM HSP263 MOVED TO THIS CL (FROM HP269CL) */
/*******************************************************************/

             PGM        PARM(&TSTPRDFL)                  /* 120610 */
/*           PGM                                            120610 */

             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(10)
             DCL        VAR(&COPYS) TYPE(*DEC) LEN(2)
             DCL        VAR(&TSTPRDFL) TYPE(*CHAR) LEN(1)  /* 120610 */
             DCL        VAR(&EMAIL  )  TYPE(*CHAR) LEN(38) /* 120610 */

             CHGVAR     VAR(&HOLD) VALUE(*YES)
             CHGVAR     VAR(&COPYS) VALUE(1)

/*------------------------------------------------------------------*/
/*  WRITE THE RECEIVING FILE TO THE EDITING FILES                   */
/*------------------------------------------------------------------*/

             CALL       PGM(HP263)


/*------------------------------------------------------------------*/
/*  CALL PROGRAM TO EDIT GROUP DEATHS                               */
/*------------------------------------------------------------------*/

             OVRPRTF    FILE(QPRINT) OUTQ(GUYPRT02) COPIES(&COPYS) +
                          HOLD(&HOLD) SHARE(*YES)

             CRTDUPOBJL OBJ(HSP391) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CALL       PGM(HP264)
             DLTOVR     FILE(QPRINT)

    /* FORCE QPRINT CLOSED BEFORE EMAILING.                     */
                 RCLRSC                                            /* 120610 */

/*--------------------------------------------------------------*/ /* 120610 */
/*     SENDING EMAILS:                                          */ /* 120610 */
/*--------------------------------------------------------------*/ /* 120610 */
             CHGVAR     VAR(&EMAIL) VALUE('HPS SAFEDATA TEST')     /* 120610 */

  IF         COND(&TSTPRDFL *EQ 'P') THEN(DO)                      /* 120610 */
   CHGVAR VAR(&EMAIL) VALUE('hps Safedata Weekly NurFin Upl')      /* 120610 */
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('NurFin Group +
                          Deaths Upload Listing') MSG('Distribution +
                          List: NurFin Group Deaths Upload +
                          Listing') ATTLIST((QPRINT *PDF *N *ALL * +
                          *LAST *ONLY))
    MONMSG     MSGID(CPF0000)                                      /* 120610 */
    ENDDO                                                          /* 120610 */

  IF         COND(&TSTPRDFL *EQ 'T') THEN(DO)                      /* 120610 */
   CHGVAR     VAR(&EMAIL) VALUE('hps safedata test')               /* 120610 */
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('TEST: NurFin Group +
                           Deaths Upload Listing') +
                           MSG('TEST: NurFin Group Deaths Upload Listing') +
                           ATTLIST((QPRINT *PDF *N *ALL +
                          * *LAST *ONLY))
   MONMSG     MSGID(CPF0000)                                       /* 120610 */
   ENDDO                                                           /* 120610 */

       CPYF FROMFILE(HSP263) TOFILE(HSP263SV) MBROPT(*REPLACE)     /* 120610 */
       CLRPFM     FILE(HSP263)                                     /* 120610 */
             ENDPGM

