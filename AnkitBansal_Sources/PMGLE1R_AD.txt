// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMGLE1R
// ?Date: 14.08.2025 Time: 03:45:09
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

CASE;

// IF PAR.PCG Code is Not Blank
IF PAR.PCG_Code <> *BLANK;

// PGM.*Program mode = CND.*CHANGE
PGM.*Program_mode = 'CHG';

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Program mode = CND.*ADD
PGM.*Program_mode = 'ADD';

ENDIF;

//?USER: Initialize key screen

//?** Fill keys in from par if they are available
CASE;

// IF PAR.PCG Code is Not Blank
IF PAR.PCG_Code <> *BLANK;

// KEY.PCG Code = PAR.PCG Code
KEY.PCG_Code = PAR.PCG_Code;

// KEY.PCG From Library = PAR.PCG From Library
KEY.PCG_From_Library = PAR.PCG_From_Library;

// KEY.File Name = PAR.File Name
KEY.File_Name = PAR.File_Name;

ENDIF;

//?USER: Validate key screen

// PAR.PCG Code = KEY.PCG Code
PAR.PCG_Code = KEY.PCG_Code;

// PAR.PCG From Library = KEY.PCG From Library
PAR.PCG_From_Library = KEY.PCG_From_Library;

//?USER: Initialize detail screen (new record)

// DTL.Record Status = CND.Active
DTL.Record_Status = 'A';

// DTL.Date Format = CND.*CYMD-CYYMMDD
DTL.Date_Format = *CYMD;

//?USER: Delete DBF record

EXECUTE FUNCTION(Delete WF PrePurge Contro) TYPE(DLTOBJ) FILE(PMFECPP)          AC1927753;
PARAMETER(DTL.PCG_Code);
PARAMETER(DTL.PCG_From_Library);
PARAMETER(DTL.File_Name);

//?USER: Validate detail screen fields

// Call program CVT to Upper w/SpclChr XF.
CALL PROGRAM(CVT to Upper w/SpclChr XF) ('PMREXFR');
PARAMETER(DTL.Date_Format);
PARAMETER(DTL.Date_Format);

//?USER: Validate detail screen relations

//?** Verify date is entered
CASE;

// IF DTL.Thru Date, 7.0 ATR is not entered
IF DTL.Thru_Date_7_0_ATR = *ZERO;

// Send error message - 'Date must be entered.'
ERROR(USR0231);
MSGPARM(DTL.Thru_Date_7_0_ATR);

ENDIF;

//?** Verify date format is entered
CASE;

// IF DTL.Date Format is *Blank
IF DTL.Date_Format = *BLANK;

// Send error message - 'Field cannot be blank'
ERROR(USR3741);
MSGPARM(DTL.Date_Format);

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(Create WF PrePurge Contro) TYPE(CRTOBJ) FILE(PMFECPP)          AC1927751;
PARAMETER(DTL.PCG_Code);
PARAMETER(DTL.PCG_From_Library);
PARAMETER(DTL.File_Name);
PARAMETER(DTL.PCG_Purge_To_Library);
PARAMETER(DTL.Field_Name);
PARAMETER(DTL.Date_Format);
PARAMETER(DTL.Thru_Date_8_0_ATR);
PARAMETER(DTL.Thru_Date_7_0_ATR);
PARAMETER(DTL.Thru_Date_7_0_ATR_1);
PARAMETER(DTL.Thru_Date_7_0_ATR_2);
PARAMETER(DTL.Valid_Name_unused_1);
PARAMETER(DTL.Valid_Name_unused_2);
PARAMETER(DTL.Valid_Name_unused_3);
PARAMETER(DTL.Valid_Name_unused_4);
PARAMETER(DTL.Record_Status);
PARAMETER(DTL.Create_Date);
PARAMETER(DTL.Create_Time);
PARAMETER(DTL.Create_User);
PARAMETER(DTL.Create_Program);
PARAMETER(DTL.Change_Date);
PARAMETER(DTL.Change_Time);
PARAMETER(DTL.Change_User);
PARAMETER(DTL.Change_Program);

//?USER: Change DBF record

EXECUTE FUNCTION(Change WF PrePurge Contro) TYPE(CHGOBJ) FILE(PMFECPP)          AC1927752;
PARAMETER(DTL.PCG_Code);
PARAMETER(DTL.PCG_From_Library);
PARAMETER(DTL.File_Name);
PARAMETER(DTL.PCG_Purge_To_Library);
PARAMETER(DTL.Field_Name);
PARAMETER(DTL.Date_Format);
PARAMETER(DTL.Thru_Date_8_0_ATR);
PARAMETER(DTL.Thru_Date_7_0_ATR);
PARAMETER(DTL.Thru_Date_7_0_ATR_1);
PARAMETER(DTL.Thru_Date_7_0_ATR_2);
PARAMETER(DTL.Valid_Name_unused_1);
PARAMETER(DTL.Valid_Name_unused_2);
PARAMETER(DTL.Valid_Name_unused_3);
PARAMETER(DTL.Valid_Name_unused_4);
PARAMETER(DTL.Record_Status);
PARAMETER(DTL.Create_Date);
PARAMETER(DTL.Create_Time);
PARAMETER(DTL.Create_User);
PARAMETER(DTL.Create_Program);
PARAMETER(DTL.Change_Date);
PARAMETER(DTL.Change_Time);
PARAMETER(DTL.Change_User);
PARAMETER(DTL.Change_Program);

//?USER: Process command keys

//?*add
CASE;

// IF DTL.*CMD key is *Add
IF DTL.*CMD_key = '09';

// PGM.*Program mode = CND.*ADD
PGM.*Program_mode = 'ADD';

ENDIF;

//?*change
CASE;

// IF DTL.*CMD key is *Change
IF DTL.*CMD_key = '09';

// PGM.*Program mode = CND.*CHANGE
PGM.*Program_mode = 'CHG';

ENDIF;

