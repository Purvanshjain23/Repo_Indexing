// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMXSXFR
// ?Date: 14.08.2025 Time: 03:44:28
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** Write records for Brokers with All Products = Yes
EXECUTE FUNCTION(RTV/Crt AllPrd BrkrMtx RT) TYPE(RTVOBJ) FILE(OMHLREP)          AC1897206;
PARAMETER(PAR.Accrual_Code);
{
 //?USER: Process Data record

 //?** If Accrual Code passed in and not matching, quit
 CASE;

 // IF PAR.Accrual Code is Entered
 IF PAR.Accrual_Code <> *BLANK;

 // AND DB1.Accrual Code NE PAR.Accrual Code
 AND DB1.Accrual_Code <> PAR.Accrual_Code;

 QUIT;

 //?** If Accrual Code passed in and not matching, quit
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?** Process if accrual code = blank (all) or if matching
 //?** Only write records for Brokers with All Products = Yes
 CASE;

 // IF DB1.All Products (Y/N) is Yes
 IF DB1.All_Products_Y_N = 'Y';

 // AND DB1.Accrual Type is Commission
 AND DB1.Accrual_Type = 'CM';

 // AND DB1.Sub Ledger Code is Broker
 AND DB1.Sub_Ledger_Code = 'B';

 EXECUTE FUNCTION(RTV/Crt-Brkr Comm Mtx  RT) TYPE(RTVOBJ) FILE(OMBYREP)          AC1897194;
 PARAMETER(*ZERO);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(DB1.Accrual_Rate);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(CRT WF Brkr Comm Rate  CR) TYPE(CRTOBJ) FILE(PMECCPP)          AC1897188;
  PARAMETER(PAR.Accrual_Code);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Description_Line_One);
  PARAMETER(PAR.Accrual_Rate);
 }

 ENDIF;

 ENDIF;

}


//?** Write records for Brokers with All Products = No
EXECUTE FUNCTION(RTV/Crt SelPrd BrkrMtx1RT) TYPE(RTVOBJ) FILE(OMHLREP)          AC2104538;
PARAMETER(PAR.Accrual_Code);
PARAMETER(PAR.Date_Entered);
{
 //?USER: Process Data record

 //?** If accrual code passed in and not matching, quit
 CASE;

 // IF PAR.Accrual Code is Entered
 IF PAR.Accrual_Code <> *BLANK;

 // AND DB1.Accrual Code NE PAR.Accrual Code
 AND DB1.Accrual_Code <> PAR.Accrual_Code;

 QUIT;

 //?** If accrual code passed in and not matching, quit
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?** Process if accrual code = blanks (all) or matching
 //?** Write records for Brokers with All Products = No
 CASE;

 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 // AND DB1.Accrual Type is Commission
 AND DB1.Accrual_Type = 'CM';

 // AND DB1.Sub Ledger Code is Broker
 AND DB1.Sub_Ledger_Code = 'B';

 //?** Accrual code must have a current date range (for date entered)
 EXECUTE FUNCTION(Val Accr for date rng RT) TYPE(RTVOBJ) FILE(OMHOREP)           AC1897268;
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(PAR.Date_Entered);
 PARAMETER(WRK.Record_Found_USR);
 {
  //?USER: Initialize routine

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  CASE;

  // IF PAR.Date Entered GE DB1.Period Beginning Date
  IF PAR.Date_Entered >= DB1.Period_Beginning_Date;

  // AND PAR.Date Entered LE DB1.Period Ending Date
  AND PAR.Date_Entered <= DB1.Period_Ending_Date;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

  QUIT;

  ENDIF;

 }

 CASE;

 // IF WRK.Record Found USR is Record Found
 IF WRK.Record_Found_USR = 'Y';

 EXECUTE FUNCTION(RTV Brkr Mtrx Itm/Rate RT) TYPE(RTVOBJ) FILE(OMHPREP)          AC1897269;
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(PAR.Date_Entered);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  EXECUTE FUNCTION(VAL Itm/Rate by AcrCde RT) TYPE(RTVOBJ) FILE(PMECCPP)          AC1897291;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER(PAR.Record_Found_USR);
  {
   //?USER: Initialize routine

   // PAR.Record Found USR = CND.Record Not Found
   PAR.Record_Found_USR = 'N';

   //?USER: Process Data record

   //?** Quit if at least one matching record exists
   CASE;

   // IF DB1.Accrual Rate EQ PAR.Accrual Rate
   IF DB1.Accrual_Rate = PAR.Accrual_Rate;

   // PAR.Record Found USR = CND.Record Found
   PAR.Record_Found_USR = 'Y';

   QUIT;

   ENDIF;

  }

  //?** Process if valid date range
  CASE;

  // IF PAR.Record Found USR is Record Not Found
  IF PAR.Record_Found_USR = 'N';

  EXECUTE FUNCTION(Rtv Item Descriptions  RT) TYPE(RTVOBJ) FILE(OMBYREP)          AC1341279;
  PARAMETER(DB1.Item_Code);
  PARAMETER(WRK.Description_Line_One);
  PARAMETER(WRK.Description_Line_Two);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  EXECUTE FUNCTION(CRT WF Brkr Comm Rate  CR) TYPE(CRTOBJ) FILE(PMECCPP)          AC1897188;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Item_Code);
  PARAMETER(WRK.Description_Line_One);
  PARAMETER(DB1.Accrual_Rate);
  ENDIF;

 }

 ENDIF;

 ENDIF;

 ENDIF;

}


