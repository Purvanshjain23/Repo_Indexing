/*********************************************************************/
/* PROGRAM    : PBOFUPC                                              */
/* TITLE      : EXECUTE OMFNCPL6_3 AND EMAIL TO RECIPIENT            */
/* DATE       : 07/25/2014                                           */
/* Description: EXECUTE THE SQL OMFNCPL6_3 TO BUILD MANIFEST DETAIL  */
/*                RECORDS AS A SPREADSHEET FOR 1 ORDER               */
/*                                                                   */
/*  Parameters:                                                      */
/*  FIELD       FIELD DESCRIPTION                                    */
/*  ----------  ------------------------------------------           */
/*  &RETURN     RETURN CODE                                          */
/*  &COMPN      COMPANY NUMBER AS 15.5                               */
/*  &ORDERN     ORDER NUMBER AS 15.5                                 */
/*  &PONBR      CUSTOMER PURCHASE ORDER NUMBER                       */
/*  &EMAILADDR  EMAIL ADDRESS TO SEND TO                             */
/*  &SUBJECT    SUBJECT LINE                                         */
/*  &SELECT     SELECTED MENU ITEM NUMBER                            */
/*********************************************************************/
/* Modifications:                                                    */
/* ---------- --- ------- -------------------------------------------*/
/* 09/19/2017 DN  E011527  UNDO &SELECT CHANGE FROM 2 BACK TO 1 BYTE */
/*                         AND CHANGED OPT 8 TO REMOVE PRICE         */
/*                         CODE RESTRICTION FROM SEQUEL.             */
/* 08/29/2017 LJB E011527  CHANGE &SELECT TO 2 CHARACTERS.           */
/* 10/15/2018 RMC R13899   SEL ON COMPANY TOO TO SPEED IT UP         */
/*-------------------------------------------------------------------*/
/*********************************************************************/
 PBOFUPC:    PGM        PARM(&RETURN &COMPN &ORDERN &PONBR &MANTYPE +
                          &EMAILADDR &SUBJECT &SELECT)

             DCL        VAR(&RETURN)    TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMPN)     TYPE(*DEC)
             DCL        VAR(&ORDERN)    TYPE(*DEC)
             DCL        VAR(&ORDER )    TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&ORDERA)    TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMP )    TYPE(*DEC)  LEN(3 0)
             DCL        VAR(&COMPA )    TYPE(*CHAR) LEN(3)
             DCL        VAR(&PONBR)     TYPE(*CHAR) LEN(15)
             DCL        VAR(&MANTYPE)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&SUBJECT)   TYPE(*CHAR) LEN(60)
             DCL        VAR(&EMAILADDR) TYPE(*CHAR) LEN(50)
             DCL        VAR(&SELECT)    TYPE(*CHAR) LEN(1)

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

             MONMSG     MSGID(CPF2103 CPF9999)

/* CONVERT ORDER NUMBER TO ALPHA TO PASS TO THE SQL                  */
             CHGVAR     VAR(&ORDER) VALUE(&ORDERN)
             CHGVAR     VAR(&ORDERA) VALUE(&ORDER)

             CHGVAR     VAR(&COMP) VALUE(&COMPN)
             CHGVAR     VAR(&COMPA) VALUE(&COMP)
/*********** GOTO EXECUTE                                +
             RMVLIBLE   LIB(PRKDEVQRY)                   +
             ADDLIBLE   LIB(PRKDEVQRY) POSITION(*LAST)   *************/

 EXECUTE:    EXECUTE    VIEW(OMFNCPL6_3) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADDR) EMLMSG(&SUBJECT) +
                          SETVAR((&COMP &COMPA) (&ORDER &ORDERA))
             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/
 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ENDPGM))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     ENDPGM
