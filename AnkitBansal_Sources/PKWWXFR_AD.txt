// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKWWXFR
// ?Date: 14.08.2025 Time: 02:50:43
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Run this at the beginning of a new year.
//?Some files are kept Y-T-D, some are kept 2 years.
//?For files kept Y-T-D, load the last year end date into the
//?Roll_off date. Read the files in descending kill date seq positioning
//?on the Roll_off date.  Delete the records found.
// WRK.Year 3 USR = JOB.*Job year - CON.1
WRK.Year_3_USR = JOB.*Job_year - 1;

//?Add century digit to the year if it is a 20th century date
CASE;

// IF WRK.Year 3 USR is Less than 40 = 20nn
IF WRK.Year_3_USR < 40;

// WRK.Year 3 USR = WRK.Year 3 USR + CON.100
WRK.Year_3_USR = WRK.Year_3_USR + 100;

ENDIF;

// WRK.Year 3 Alpha  USr = CVTVAR(WRK.Year 3 USR)
WRK.Year_3_Alpha_USr = CVTVAR(WRK.Year_3_USR);

// WRK.Date Alpha USR = CONCAT(WRK.Year 3 Alpha  USr,CON.1231,CON.*ZERO)
WRK.Date_Alpha_USR = WRK.Year_3_Alpha_USr + '1231' (*ZERO);

// WRK.Date USR = CVTVAR(WRK.Date Alpha USR)
WRK.Date_USR = CVTVAR(WRK.Date_Alpha_USR);

// Call program Zzz yrly purged rcds  PF.
CALL PROGRAM(Zzz yrly purged rcds  PF) ('PKWXPFR');
PARAMETER(WRK.Date_USR);

//?For files kept 2 years, load the 3 years ago end date into the
//?Roll_off date. Read the files in descending kill date seq positioning
//?on the Roll_off date.  Delete the records found.
//?Delete Buy order files and tattoos if they have been paid
// WRK.Year 3 USR = JOB.*Job year - CON.3
WRK.Year_3_USR = JOB.*Job_year - 3;

//?Add century digit to the year if it is a 20th century date
CASE;

// IF WRK.Year 3 USR is Less than 40 = 20nn
IF WRK.Year_3_USR < 40;

// WRK.Year 3 USR = WRK.Year 3 USR + CON.100
WRK.Year_3_USR = WRK.Year_3_USR + 100;

ENDIF;

// WRK.Year 3 Alpha  USr = CVTVAR(WRK.Year 3 USR)
WRK.Year_3_Alpha_USr = CVTVAR(WRK.Year_3_USR);

// WRK.Date Alpha USR = CONCAT(WRK.Year 3 Alpha  USr,CON.1231,CON.*ZERO)
WRK.Date_Alpha_USR = WRK.Year_3_Alpha_USr + '1231' (*ZERO);

// WRK.Date USR = CVTVAR(WRK.Date Alpha USR)
WRK.Date_USR = CVTVAR(WRK.Date_Alpha_USR);

// Call program zzt Purged yrly rcds  zz.
CALL PROGRAM(zzt Purged yrly rcds  zz) ('PKWYPFR');
PARAMETER(WRK.Date_USR);

//?Delete voucher header, detail, tattoo d/a
//?Sbmjob to Reorganize purged files to remove deleted records.
