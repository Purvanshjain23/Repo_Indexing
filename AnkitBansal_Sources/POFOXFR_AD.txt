// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POFOXFR
// ?Date: 14.08.2025 Time: 03:37:01
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?RMC 02/02/07 The warehouse will drive the item bal file download:
//?   Read Whse where the acctng company = par.company number
//?   then read the item bal by warehouse
EXECUTE FUNCTION(Rtv Build End InvWrkf RT) TYPE(RTVOBJ) FILE(CAADREP)           AC1808866;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Date_To_USR);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 EXECUTE FUNCTION(Rtv Build End InvWrkf RT) TYPE(RTVOBJ) FILE(CAB0REP)           AC1601945;
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(PAR.Date_To_USR);
 PARAMETER(DB1.Accounting_Company);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv Lot Tracking Flag RT) TYPE(RTVOBJ) FILE(CAADREP)           AC1506123;
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Lot_Tracking_Flag);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF LCL.Lot Tracking Flag is yes
  IF LCL.Lot_Tracking_Flag = 'Y';

  //?RMC 2/23/06 do the same as not lot tracking whses per AMB,Tom,Pkd
  // LCL.On Hand U/M1 Summary = DB1.On Hand U/M1 Summary
  LCL.On_Hand_UOM1_Summary = DB1.On_Hand_UOM1_Summary;

  // LCL.On Hand Weight Summary = DB1.On Hand Weight Summary
  LCL.On_Hand_Weight_Summary = DB1.On_Hand_Weight_Summary;

  EXECUTE FUNCTION(Rtv Prod after Date   RT) TYPE(RTVOBJ) FILE(CAB1REP)           AC1601946;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(PAR.Date_To_USR);
  PARAMETER(LCL.Quantity_On_Hand_USR);
  PARAMETER(LCL.Weight_On_Hand_USR);
  PARAMETER(PAR.Date_To_USR);
  {
   //?USER: Initialize routine

   // PAR.Quantity On Hand   USR = CON.*ZERO
   PAR.Quantity_On_Hand_USR = *ZERO;

   // PAR.Weight On Hand     USR = CON.*ZERO
   PAR.Weight_On_Hand_USR = *ZERO;

   //?USER: Process Data record

   CASE;

   // IF DB1.Production Date GT PAR.USR Production Date
   IF DB1.Production_Date > PAR.USR_Production_Date;

   // PAR.Quantity On Hand   USR = PAR.Quantity On Hand   USR + DB1.Quantity on Hand - U/M1
   PAR.Quantity_On_Hand_USR = PAR.Quantity_On_Hand_USR + DB1.Quantity_on_Hand_UOM1;

   // PAR.Weight On Hand     USR = PAR.Weight On Hand     USR + DB1.Quantity on Hand - Weight
   PAR.Weight_On_Hand_USR = PAR.Weight_On_Hand_USR + DB1.Quantity_on_Hand_Weight;

   ENDIF;

  }

  // LCL.On Hand U/M1 Summary = LCL.On Hand U/M1 Summary - LCL.Quantity On Hand   USR
  LCL.On_Hand_UOM1_Summary = LCL.On_Hand_UOM1_Summary - LCL.Quantity_On_Hand_USR;

  // LCL.On Hand Weight Summary = LCL.On Hand Weight Summary - LCL.Weight On Hand     USR
  LCL.On_Hand_Weight_Summary = LCL.On_Hand_Weight_Summary - LCL.Weight_On_Hand_USR;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // LCL.On Hand U/M1 Summary = DB1.On Hand U/M1 Summary
  LCL.On_Hand_UOM1_Summary = DB1.On_Hand_UOM1_Summary;

  // LCL.On Hand Weight Summary = DB1.On Hand Weight Summary
  LCL.On_Hand_Weight_Summary = DB1.On_Hand_Weight_Summary;

  EXECUTE FUNCTION(Rtv Prod after Date   RT) TYPE(RTVOBJ) FILE(CAB1REP)           AC1601946;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(PAR.Date_To_USR);
  PARAMETER(LCL.Quantity_On_Hand_USR);
  PARAMETER(LCL.Weight_On_Hand_USR);
  PARAMETER(PAR.Date_To_USR);
  {
   //?USER: Initialize routine

   // PAR.Quantity On Hand   USR = CON.*ZERO
   PAR.Quantity_On_Hand_USR = *ZERO;

   // PAR.Weight On Hand     USR = CON.*ZERO
   PAR.Weight_On_Hand_USR = *ZERO;

   //?USER: Process Data record

   CASE;

   // IF DB1.Production Date GT PAR.USR Production Date
   IF DB1.Production_Date > PAR.USR_Production_Date;

   // PAR.Quantity On Hand   USR = PAR.Quantity On Hand   USR + DB1.Quantity on Hand - U/M1
   PAR.Quantity_On_Hand_USR = PAR.Quantity_On_Hand_USR + DB1.Quantity_on_Hand_UOM1;

   // PAR.Weight On Hand     USR = PAR.Weight On Hand     USR + DB1.Quantity on Hand - Weight
   PAR.Weight_On_Hand_USR = PAR.Weight_On_Hand_USR + DB1.Quantity_on_Hand_Weight;

   ENDIF;

  }

  // LCL.On Hand U/M1 Summary = LCL.On Hand U/M1 Summary - LCL.Quantity On Hand   USR
  LCL.On_Hand_UOM1_Summary = LCL.On_Hand_UOM1_Summary - LCL.Quantity_On_Hand_USR;

  // LCL.On Hand Weight Summary = LCL.On Hand Weight Summary - LCL.Weight On Hand     USR
  LCL.On_Hand_Weight_Summary = LCL.On_Hand_Weight_Summary - LCL.Weight_On_Hand_USR;

  ENDIF;

  //?right now this just included monday shipments = job date is Monday
  EXECUTE FUNCTION(Rtv Shpmnt After a Dt RT) TYPE(RTVOBJ) FILE(CAB7CPP)           AC1604433;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(JOB.*Job_date);
  PARAMETER(PAR.Date_To_USR);
  PARAMETER(LCL.Transaction_Qty_Total);
  PARAMETER(LCL.Transaction_Wgt_Total);
  {
   //?USER: Initialize routine

   // PAR.Transaction Qty Total = CON.*ZERO
   PAR.Transaction_Qty_Total = *ZERO;

   // PAR.Transaction Wgt. Total = CON.*ZERO
   PAR.Transaction_Wgt_Total = *ZERO;

   //?USER: Process Data record

   CASE;

   // IF DB1.Production Date LE PAR.To Date               USR
   IF DB1.Production_Date <= PAR.To_Date_USR;

   EXECUTE FUNCTION(Rtv Actual Ship Date  RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1444831;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Order_Number);
   PARAMETER(NLL.Ship_To_Name);
   PARAMETER(NLL.Ship_To_City);
   PARAMETER(NLL.Ship_To_State_Code);
   PARAMETER(LCL.Actual_Shipped_Date);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   CASE;

   // IF LCL.Actual Shipped Date GT PAR.To Date               USR
   IF LCL.Actual_Shipped_Date > PAR.To_Date_USR;

   // PAR.Transaction Qty Total = PAR.Transaction Qty Total + DB1.Transaction Quantity
   PAR.Transaction_Qty_Total = PAR.Transaction_Qty_Total + DB1.Transaction_Quantity;

   // PAR.Transaction Wgt. Total = PAR.Transaction Wgt. Total + DB1.Transaction Weight
   PAR.Transaction_Wgt_Total = PAR.Transaction_Wgt_Total + DB1.Transaction_Weight;

   ENDIF;

   ENDIF;

  }

  //?(Sign is <-> on issues in the trans detail file, so we're actually
  //? adding them back to inventory by subtracting here.)   10/09/01
  // LCL.On Hand U/M1 Summary = LCL.On Hand U/M1 Summary - LCL.Transaction Qty Total
  LCL.On_Hand_UOM1_Summary = LCL.On_Hand_UOM1_Summary - LCL.Transaction_Qty_Total;

  // LCL.On Hand Weight Summary = LCL.On Hand Weight Summary - LCL.Transaction Wgt. Total
  LCL.On_Hand_Weight_Summary = LCL.On_Hand_Weight_Summary - LCL.Transaction_Wgt_Total;

  //?If inventory qty is less than zero then make zero
  CASE;

  // IF LCL.On Hand U/M1 Summary is Less than zero
  IF LCL.On_Hand_UOM1_Summary < *ZERO;

  // LCL.On Hand U/M1 Summary = CON.*ZERO
  LCL.On_Hand_UOM1_Summary = *ZERO;

  ENDIF;

  //?If inventory wgt is less than zero then make zero
  CASE;

  // IF LCL.On Hand Weight Summary is Less than zero
  IF LCL.On_Hand_Weight_Summary < *ZERO;

  // LCL.On Hand Weight Summary = CON.*ZERO
  LCL.On_Hand_Weight_Summary = *ZERO;

  ENDIF;

  CASE;

  // IF LCL.On Hand U/M1 Summary is not equal zero
  IF LCL.On_Hand_UOM1_Summary <> *ZERO;

  EXECUTE FUNCTION(Create W009 Ending Invent) TYPE(CRTOBJ) FILE(POAQCPP)          AC1601958;
  PARAMETER(PAR.Accounting_Company);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(PAR.Date_To_USR);
  PARAMETER(LCL.On_Hand_UOM1_Summary);
  PARAMETER(LCL.On_Hand_Weight_Summary);
  ENDIF;

 }

 ENDIF;

}


