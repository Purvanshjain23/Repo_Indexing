/*********************************************************************/
/* PROGRAM : E1MCUPC                                                 */
/* DESC    : EXC QSH GBA->WNDW->JDE CL EXECUTE USER PROGRAM          */
/* DATE    : 09/10/2020                                              */
/* PROJECT : R16842 - JDE AS400 TO WINDOWS: GBA INTERFACE            */
/* BY      : DANNY NGUYEN                                            */
/* PURPOSE : Execute the QSH workflow from Informatica to send the   */
/*           GBA file to Windows then to JDE.                        */
/*                                                                   */
/*           GBA PROGRAM THAT PUSHES FILE TO THE AS400 IFS:          */
/*           QRPGSRC/FAMSGLMODS - FAGLGO1                            */
/*                                                                   */
/*           Program is called from   ------->FAGLGOL                */
/*                                                                   */
/* PARAMETER:                                                        */
/*           &CREATE -  WILL BE YES FOR PRODUCTION                  */
/*           &TEST   -  WILL BE YES FOR TEST - CHECK THIS FIRST.    */
/*                      IF YES, THEN DO THE TEST STEPS.             */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  CHANGE DESCRIPTION                                   */
/* -------- --- ---------------------------------------------------- */
/* 09/11/2020 RMC -  USE PARMS &TEST AND &CREATE. IF &TEST IS 'Y'    */
/*                   THEN DO THE TEST STEPS, ELSE DO THE PROD STEPS  */
/*                   -- DONT NEED ANYTHING FROM PRKPLIB/PRKFLIB      */
/* 01/27/2021 RMC -  DIFF PASSWORD FOR PROD                         */
/*********************************************************************/

             PGM        PARM(&CREATE &TEST)

             DCL        VAR(&CREATE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TEST  ) TYPE(*CHAR) LEN(1)

             DCL        VAR(&CMD) TYPE(*CHAR) LEN(150)
             DCL        VAR(&PSWD) TYPE(*CHAR) LEN(10)
             DCL        VAR(&WFNAME) TYPE(*CHAR) LEN(28)
             DCL        VAR(&FOLDER) TYPE(*CHAR) LEN(12)

             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(30)
             DCL        VAR(&SUBJECT) TYPE(*CHAR) LEN(50)
             DCL        VAR(&MESSAGE) TYPE(*CHAR) LEN(256)


             CHGVAR     VAR(&SUBJECT) VALUE('Informatica WF +
                          Completed: Send GBA to JDE')
             CHGVAR     VAR(&MESSAGE) VALUE('Informatica WF +
                          Completed: Send GBA to JDE')

/* GOTO EMAIL           */
/*-------------------------------------------------------------------*/
/* Build & Execute the Informatica Workflow Qshell Script.           */
/*-------------------------------------------------------------------*/
             CHGVAR     VAR(&CMD) VALUE(*BLANKS)

    /* Set TEST or PROD Workflow Directory - Is Case Sensitive. */

             IF         COND(&TEST   *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&EMAIL) VALUE('intgbatst')

             CHGVAR     VAR(&PSWD) VALUE('as400')
             CHGVAR     VAR(&CMD) +
                          VALUE('/QOpenSys/infawf/INFA_WF_TST.sh')
             CHGVAR     VAR(&MESSAGE) VALUE(&MESSAGE *BCAT '- TEST')

             ENDDO
             ELSE       CMD(DO)
             CHGVAR     VAR(&EMAIL) VALUE('intgbaprd')
         /*ˆNEED TO CONFIRM WF INFO FOR PROD ENV!!!! **/
             CHGVAR     VAR(&PSWD) VALUE('as400Log1n')
             CHGVAR     VAR(&CMD) +
                          VALUE('/QOpenSys/infawf/INFA_WF_PRD.sh')
             ENDDO

             CHGVAR     VAR(&WFNAME) +
                          VALUE('wf_GBA_to_JDE_Journal_Entry')
             CHGVAR     VAR(&FOLDER) VALUE('Integrations')

             CHGVAR     VAR(&CMD) VALUE(&CMD *BCAT &PSWD)
             CHGVAR     VAR(&CMD) VALUE(&CMD *BCAT &WFNAME)
             CHGVAR     VAR(&CMD) VALUE(&CMD *BCAT &FOLDER)

    /* Call Qshell Command */
             QSH        CMD(&CMD)

    /* Send ESEND Completion Message. */
EMAIL:       ADDLIBLE   LIB(ESEND) POSITION(*LAST)
             MONMSG     MSGID(CPF0000)
             IF         COND(&TEST   *EQ 'Y') +
         THEN(CHGVAR     VAR(&EMAIL) VALUE('intgbatst'))
         ELSE CHGVAR     VAR(&EMAIL) VALUE('INTGBAPRD')

             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT(&SUBJECT) +
                          MSG(&MESSAGE) OVRUSROPT(PDSECOFR)


             ENDPGM
