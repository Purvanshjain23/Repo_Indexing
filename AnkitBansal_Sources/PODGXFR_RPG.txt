     H/TITLE Read all rcds for Prg XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1181
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISLBUSE
     H* Date          : 10/05/07  Time  : 15:56:37
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDJ2CPL8IF  E           K        DISK
      * RSQ : A/R Bank Deposit          Deposit Date(d) no selct
      *
     FARBKCPL1IF  E           K        DISK
      * RTV : A/R Non A/R Cash          Retrieval index       NV
      *
     FPDJ2CPL5IF  E           K        DISK                      A
      * UPD : A/R Bank Deposit          Update index to Purge
      *
     FPDJ2CPL0UF  E           K        DISK
      * UPD : A/R Bank Deposit          Update index
      *
     FARBKCPL3IF  E           K        DISK                      A
      * UPD : A/R Non A/R Cash          Update index to Purge
      *
     FARBKCPL0UF  E           K        DISK
      * UPD : A/R Non A/R Cash          Update index
      *
     I@J2CPOW
      * A/R Bank Deposit          Deposit Date(d) no selct
      * Renamed input format fields
     I              J2G4CD                          WAG4CD
     I              J2HXDT                          WAHXDT
     I              J2YXNX                          WAYXNX
     I              J2UIVA                          WAUIVA
     I              J2UJVA                          WAUJVA
     I              J2AJST                          WAAJST
     I              J2CKNB                          WACKNB
     I              J2BHNB                          WABHNB
     I              J2BINB                          WABINB
     I              J2E2VL                          WAE2VL
     I              J2E3VL                          WAE3VL
     I              J2E4VL                          WAE4VL
     I              J2E5VL                          WAE5VL
     I              J2E6VL                          WAE6VL
     I              J2E7VL                          WAE7VL
     I              J2E8VL                          WAE8VL
     I              J2E9VL                          WAE9VL
     I              J2FAVL                          WAFAVL
     I              J2FBVL                          WAFBVL
     I              J2FCVL                          WAFCVL
     I              J2FDVL                          WAFDVL
     I              J2HYDT                          WAHYDT
     I              J2UVST                          WAUVST
     I              J2UWST                          WAUWST
     I              J2UXST                          WAUXST
     I              J2VSST                          WAVSST
     I              J2AATM                          WAAATM
     I              J2AYNA                          WAAYNA
     I              J2A0NA                          WAA0NA
     I              J2AXDT                          WAAXDT
      *
     I@J2CPDX
      * A/R Bank Deposit          Update index to Purge
      * Renamed input format fields
     I              J2G4CD                          WBG4CD
     I              J2HXDT                          WBHXDT
     I              J2YXNX                          WBYXNX
     I              J2UIVA                          WBUIVA
     I              J2UJVA                          WBUJVA
     I              J2AJST                          WBAJST
     I              J2CKNB                          WBCKNB
     I              J2BHNB                          WBBHNB
     I              J2BINB                          WBBINB
     I              J2E2VL                          WBE2VL
     I              J2E3VL                          WBE3VL
     I              J2E4VL                          WBE4VL
     I              J2E5VL                          WBE5VL
     I              J2E6VL                          WBE6VL
     I              J2E7VL                          WBE7VL
     I              J2E8VL                          WBE8VL
     I              J2E9VL                          WBE9VL
     I              J2FAVL                          WBFAVL
     I              J2FBVL                          WBFBVL
     I              J2FCVL                          WBFCVL
     I              J2FDVL                          WBFDVL
     I              J2HYDT                          WBHYDT
     I              J2UVST                          WBUVST
     I              J2UWST                          WBUWST
     I              J2UXST                          WBUXST
     I              J2VSST                          WBVSST
     I              J2AATM                          WBAATM
     I              J2AYNA                          WBAYNA
     I              J2A0NA                          WBA0NA
     I              J2AXDT                          WBAXDT
      *
     I@J2CPCM
      * A/R Bank Deposit          Update index
      * Renamed input format fields
     I              J2G4CD                          WCG4CD
     I              J2HXDT                          WCHXDT
     I              J2YXNX                          WCYXNX
     I              J2UIVA                          WCUIVA
     I              J2UJVA                          WCUJVA
     I              J2AJST                          WCAJST
     I              J2CKNB                          WCCKNB
     I              J2BHNB                          WCBHNB
     I              J2BINB                          WCBINB
     I              J2E2VL                          WCE2VL
     I              J2E3VL                          WCE3VL
     I              J2E4VL                          WCE4VL
     I              J2E5VL                          WCE5VL
     I              J2E6VL                          WCE6VL
     I              J2E7VL                          WCE7VL
     I              J2E8VL                          WCE8VL
     I              J2E9VL                          WCE9VL
     I              J2FAVL                          WCFAVL
     I              J2FBVL                          WCFBVL
     I              J2FCVL                          WCFCVL
     I              J2FDVL                          WCFDVL
     I              J2HYDT                          WCHYDT
     I              J2UVST                          WCUVST
     I              J2UWST                          WCUWST
     I              J2UXST                          WCUXST
     I              J2VSST                          WCVSST
     I              J2AATM                          WCAATM
     I              J2AYNA                          WCAYNA
     I              J2A0NA                          WCA0NA
     I              J2AXDT                          WCAXDT
      *
     I@BKCPGY
      * A/R Non A/R Cash          Retrieval index       NV
      * Renamed input format fields
     I              BKG4CD                          WDG4CD
     I              BKHXDT                          WDHXDT
     I              BKYXNX                          WDYXNX
     I              BKUJCD                          WDUJCD
     I              BKAIC3                          WDAIC3
     I              BKUHCD                          WDUHCD
     I              BKBSVA                          WDBSVA
     I              BKCPTX                          WDCPTX
     I              BKNGNA                          WDNGNA
     I              BKB4DT                          WDB4DT
     I              BKAJST                          WDAJST
     I              BKHYDT                          WDHYDT
     I              BKCKNB                          WDCKNB
     I              BKIZTX                          WDIZTX
     I              BKEAZT                          WDEAZT
     I              BKUVST                          WDUVST
     I              BKUWST                          WDUWST
     I              BKUXST                          WDUXST
     I              BKVSST                          WDVSST
     I              BKAATM                          WDAATM
     I              BKAYNA                          WDAYNA
     I              BKA0NA                          WDA0NA
     I              BKAXDT                          WDAXDT
      *
     I@BKCPDY
      * A/R Non A/R Cash          Update index to Purge
      * Renamed input format fields
     I              BKG4CD                          WEG4CD
     I              BKHXDT                          WEHXDT
     I              BKYXNX                          WEYXNX
     I              BKUJCD                          WEUJCD
     I              BKAIC3                          WEAIC3
     I              BKUHCD                          WEUHCD
     I              BKBSVA                          WEBSVA
     I              BKCPTX                          WECPTX
     I              BKNGNA                          WENGNA
     I              BKB4DT                          WEB4DT
     I              BKAJST                          WEAJST
     I              BKHYDT                          WEHYDT
     I              BKCKNB                          WECKNB
     I              BKIZTX                          WEIZTX
     I              BKEAZT                          WEEAZT
     I              BKUVST                          WEUVST
     I              BKUWST                          WEUWST
     I              BKUXST                          WEUXST
     I              BKVSST                          WEVSST
     I              BKAATM                          WEAATM
     I              BKAYNA                          WEAYNA
     I              BKA0NA                          WEA0NA
     I              BKAXDT                          WEAXDT
      *
     I@BKCPGX
      * A/R Non A/R Cash          Update index
      * Renamed input format fields
     I              BKG4CD                          WFG4CD
     I              BKHXDT                          WFHXDT
     I              BKYXNX                          WFYXNX
     I              BKUJCD                          WFUJCD
     I              BKAIC3                          WFAIC3
     I              BKUHCD                          WFUHCD
     I              BKBSVA                          WFBSVA
     I              BKCPTX                          WFCPTX
     I              BKNGNA                          WFNGNA
     I              BKB4DT                          WFB4DT
     I              BKAJST                          WFAJST
     I              BKHYDT                          WFHYDT
     I              BKCKNB                          WFCKNB
     I              BKIZTX                          WFIZTX
     I              BKEAZT                          WFEAZT
     I              BKUVST                          WFUVST
     I              BKUWST                          WFUWST
     I              BKUXST                          WFUXST
     I              BKVSST                          WFVSST
     I              BKAATM                          WFAATM
     I              BKAYNA                          WFAYNA
     I              BKA0NA                          WFA0NA
     I              BKAXDT                          WFAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDJ21    E DSPDJ2CPL5
      * UPD : A/R Bank Deposit          Update index to Purge
      * Renamed input format fields
     I              J2G4CD                          WBG4CD
     I              J2HXDT                          WBHXDT
     I              J2YXNX                          WBYXNX
     I              J2UIVA                          WBUIVA
     I              J2UJVA                          WBUJVA
     I              J2AJST                          WBAJST
     I              J2CKNB                          WBCKNB
     I              J2BHNB                          WBBHNB
     I              J2BINB                          WBBINB
     I              J2E2VL                          WBE2VL
     I              J2E3VL                          WBE3VL
     I              J2E4VL                          WBE4VL
     I              J2E5VL                          WBE5VL
     I              J2E6VL                          WBE6VL
     I              J2E7VL                          WBE7VL
     I              J2E8VL                          WBE8VL
     I              J2E9VL                          WBE9VL
     I              J2FAVL                          WBFAVL
     I              J2FBVL                          WBFBVL
     I              J2FCVL                          WBFCVL
     I              J2FDVL                          WBFDVL
     I              J2HYDT                          WBHYDT
     I              J2UVST                          WBUVST
     I              J2UWST                          WBUWST
     I              J2UXST                          WBUXST
     I              J2VSST                          WBVSST
     I              J2AATM                          WBAATM
     I              J2AYNA                          WBAYNA
     I              J2A0NA                          WBA0NA
     I              J2AXDT                          WBAXDT
      *
     IQPDJ22    E DSPDJ2CPL0
      * UPD : A/R Bank Deposit          Update index
      * Renamed input format fields
     I              J2G4CD                          WCG4CD
     I              J2HXDT                          WCHXDT
     I              J2YXNX                          WCYXNX
     I              J2UIVA                          WCUIVA
     I              J2UJVA                          WCUJVA
     I              J2AJST                          WCAJST
     I              J2CKNB                          WCCKNB
     I              J2BHNB                          WCBHNB
     I              J2BINB                          WCBINB
     I              J2E2VL                          WCE2VL
     I              J2E3VL                          WCE3VL
     I              J2E4VL                          WCE4VL
     I              J2E5VL                          WCE5VL
     I              J2E6VL                          WCE6VL
     I              J2E7VL                          WCE7VL
     I              J2E8VL                          WCE8VL
     I              J2E9VL                          WCE9VL
     I              J2FAVL                          WCFAVL
     I              J2FBVL                          WCFBVL
     I              J2FCVL                          WCFCVL
     I              J2FDVL                          WCFDVL
     I              J2HYDT                          WCHYDT
     I              J2UVST                          WCUVST
     I              J2UWST                          WCUWST
     I              J2UXST                          WCUXST
     I              J2VSST                          WCVSST
     I              J2AATM                          WCAATM
     I              J2AYNA                          WCAYNA
     I              J2A0NA                          WCA0NA
     I              J2AXDT                          WCAXDT
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQARBK1    E DSARBKCPL3
      * UPD : A/R Non A/R Cash          Update index to Purge
      * Renamed input format fields
     I              BKG4CD                          WEG4CD
     I              BKHXDT                          WEHXDT
     I              BKYXNX                          WEYXNX
     I              BKUJCD                          WEUJCD
     I              BKAIC3                          WEAIC3
     I              BKUHCD                          WEUHCD
     I              BKBSVA                          WEBSVA
     I              BKCPTX                          WECPTX
     I              BKNGNA                          WENGNA
     I              BKB4DT                          WEB4DT
     I              BKAJST                          WEAJST
     I              BKHYDT                          WEHYDT
     I              BKCKNB                          WECKNB
     I              BKIZTX                          WEIZTX
     I              BKEAZT                          WEEAZT
     I              BKUVST                          WEUVST
     I              BKUWST                          WEUWST
     I              BKUXST                          WEUXST
     I              BKVSST                          WEVSST
     I              BKAATM                          WEAATM
     I              BKAYNA                          WEAYNA
     I              BKA0NA                          WEA0NA
     I              BKAXDT                          WEAXDT
      *
     IQARBK2    E DSARBKCPL0
      * UPD : A/R Non A/R Cash          Update index
      * Renamed input format fields
     I              BKG4CD                          WFG4CD
     I              BKHXDT                          WFHXDT
     I              BKYXNX                          WFYXNX
     I              BKUJCD                          WFUJCD
     I              BKAIC3                          WFAIC3
     I              BKUHCD                          WFUHCD
     I              BKBSVA                          WFBSVA
     I              BKCPTX                          WFCPTX
     I              BKNGNA                          WFNGNA
     I              BKB4DT                          WFB4DT
     I              BKAJST                          WFAJST
     I              BKHYDT                          WFHYDT
     I              BKCKNB                          WFCKNB
     I              BKIZTX                          WFIZTX
     I              BKEAZT                          WFEAZT
     I              BKUVST                          WFUVST
     I              BKUWST                          WFUWST
     I              BKUXST                          WFUXST
     I              BKVSST                          WFVSST
     I              BKAATM                          WFAATM
     I              BKAYNA                          WFAYNA
     I              BKA0NA                          WFA0NA
     I              BKAXDT                          WFAXDT
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R Bank Deposit
      * I :  Deposit Date
     I                                    P   1   40P1HXDT
     IP2PARM      DS
      * B :  Date From             USR
     I                                    P   1   40P2JEDT
     IP3PARM      DS
      * B :  Date In
     I                                    P   1   40P3KCDT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HXDT    PARM           WP0001  70       Deposit Date
     C           P2JEDT    PARM P2JEDT    WP0002  70       Date From
     C           P3KCDT    PARM P3KCDT    WP0003  70       Date In
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Read all rcds for Prg XF
      * Read all rcds for Prg RT - A/R Bank Deposit  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Read all rcds for Prg RT - A/R Bank Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y'       WUTAST           First Time Flag
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAHXDT           Deposit Date
      * Setup key
     C                     Z-ADDP1HXDT    WAHXDT           Deposit Date
      * Establish starting position
     C           KPSSA     SETLL@J2CPOW                    *
     C                     READ @J2CPOW                  90*
      * Data record not found
     C   90                MOVEL'USR2039' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * First Time processing Only
      * CASE: WRK.First Time Flag is Yes
     C           WUTAST    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1ORc2
      *   |- c1    : PAR.Date From             USR LT DB1.Deposit Date
      *   |- c2    : PAR.Date From             USR is Not Entered
      *   '-
     C           P2JEDT    IFLT WAHXDT                     *IF
     C           P2JEDT    OREQ *ZERO                      *OR
     C                     Z-ADDWAHXDT    P2JEDT           Date From
     C                     END                             *FI
     C                     MOVEL'N'       WUTAST           First Time Flag
     C                     END                             *FI
      * CRT AR A/R Bank DepPRG CR - A/R Bank Deposit  * 
     C                     EXSR SBCRRC
      * DLT AR A/R Bank Dp PRG DL - A/R Bank Deposit  * 
     C                     EXSR SCDLRC
      * CASE:
      *  - c1ORc2
      *   |- c1    : PAR.Date In GT DB1.Deposit Date
      *   |- c2    : PAR.Date In is not entered
      *   '-
     C           P3KCDT    IFGT WAHXDT                     *IF
     C           P3KCDT    OREQ *ZERO                      *OR
     C                     Z-ADDWAHXDT    P3KCDT           Date In
     C                     END                             *FI
     C                     READ @J2CPOW                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * CRT AR A/R Bank DepPRG CR - A/R Bank Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @J2CPDX
     C                     MOVELWAG4CD    WBG4CD           Bank Code
     C                     Z-ADDWAHXDT    WBHXDT           Deposit Date
     C                     Z-ADDWAYXNX    WBYXNX           Deposit Time
     C                     Z-ADDWAUIVA    WBUIVA           Deposit Amount
     C                     Z-ADDWAUJVA    WBUJVA           Total Cash Appl
     C                     MOVELWAAJST    WBAJST           A/R Processing
     C                     Z-ADDWACKNB    WBCKNB           G/L Document Nu
     C                     Z-ADDWABHNB    WBBHNB           Number of Depos
     C                     Z-ADDWABINB    WBBINB           Number of Appli
     C                     Z-ADDWAE2VL    WBE2VL           CD TF Internal
     C                     Z-ADDWAE3VL    WBE3VL           CD TF Immediate
     C                     Z-ADDWAE4VL    WBE4VL           CD TF 1 Day Fun
     C                     Z-ADDWAE5VL    WBE5VL           CD TF 2 Day Fun
     C                     Z-ADDWAE6VL    WBE6VL           CD SB Exempt Im
     C                     Z-ADDWAE7VL    WBE7VL           CD SB 1 Day Exe
     C                     Z-ADDWAE8VL    WBE8VL           CD SB 2 Day Exe
     C                     Z-ADDWAE9VL    WBE9VL           SBD Exempt Tota
     C                     Z-ADDWAFAVL    WBFAVL           ARBD Unused Amt
     C                     Z-ADDWAFBVL    WBFBVL           ARBD Unused Amt
     C                     Z-ADDWAFCVL    WBFCVL           ARBD Unused Amt
     C                     Z-ADDWAFDVL    WBFDVL           ARBD Unused Amt
     C                     Z-ADDWAHYDT    WBHYDT           G/L Post Date
     C                     MOVELWAUVST    WBUVST           EDI Status 1
     C                     MOVELWAUWST    WBUWST           EDI Status 2
     C                     MOVELWAUXST    WBUXST           EDI Status 3
     C                     MOVELWAVSST    WBVSST           Record Status
     C                     Z-ADDWAAATM    WBAATM           Job Time
     C                     MOVELWAAYNA    WBAYNA           User Id
     C                     MOVELWAA0NA    WBA0NA           Job Name
     C                     Z-ADDWAAXDT    WBAXDT           Job Date
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBG4CD           Bank Code
     C                     KFLD           WBHXDT           Deposit Date
     C                     KFLD           WBYXNX           Deposit Time
      * Check for duplicate primary key
     C           KLCRSB    SETLL@J2CPDX                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2040' W0RTN   7
      * Send message 'A/R Bank Deposit       EX'
     C                     MOVEL'USR2040' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@J2CPDX                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * DLT AR A/R Bank Dp PRG DL - A/R Bank Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @J2CPCM
     C                     MOVELWAG4CD    WCG4CD           Bank Code
     C                     Z-ADDWAHXDT    WCHXDT           Deposit Date
     C                     Z-ADDWAYXNX    WCYXNX           Deposit Time
      *
     C           KLDLSC    KLIST
     C                     KFLD           WCG4CD           Bank Code
     C                     KFLD           WCHXDT           Deposit Date
     C                     KFLD           WCYXNX           Deposit Time
     C           KLDLSC    CHAIN@J2CPCM              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDJ2CPL0'MDACP
     C                     MOVEL'@J2CPCM' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@J2CPCM                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * Rtv/Dlt Non-A/R PRG    RT - A/R Non A/R Cash  * 
     C                     EXSR SDRVGN
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv/Dlt Non-A/R PRG    RT - A/R Non A/R Cash  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDG4CD    WQSD01           Bank Code
     C           *LIKE     DEFN WDHXDT    WQSD02           Deposit Date
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Bank Code
     C                     KFLD           WQSD02           Deposit Date
      * Setup key
     C                     MOVELWCG4CD    WQSD01           Bank Code
     C                     Z-ADDWCHXDT    WQSD02           Deposit Date
      * Establish starting position
     C           KRSSD     SETLL@BKCPGY                    *
     C           KRSSD     READE@BKCPGY                  90*
      * Data record not found
     C   90                MOVEL'USR0242' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT Non-A/R Cash PRG   CR - A/R Non A/R Cash  * 
     C                     EXSR SECRRC
      * DLT Non-A/R Cash       DL - A/R Non A/R Cash  * 
     C                     EXSR SFDLRC
     C           KRSSD     READE@BKCPGY                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * CRT Non-A/R Cash PRG   CR - A/R Non A/R Cash  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BKCPDY
     C                     MOVELWDG4CD    WEG4CD           Bank Code
     C                     Z-ADDWDHXDT    WEHXDT           Deposit Date
     C                     Z-ADDWDYXNX    WEYXNX           Deposit Time
     C                     MOVELWDUJCD    WEUJCD           Reference Field
     C                     Z-ADDWDAIC3    WEAIC3           Company Number
     C                     MOVELWDUHCD    WEUHCD           Adjustment Type
     C                     Z-ADDWDBSVA    WEBSVA           Transaction Amo
     C                     MOVELWDCPTX    WECPTX           A/R Check Numbe
     C                     MOVELWDNGNA    WENGNA           Explanation
     C                     Z-ADDWDB4DT    WEB4DT           Transaction Dat
     C                     MOVELWDAJST    WEAJST           A/R Processing
     C                     Z-ADDWDHYDT    WEHYDT           G/L Post Date
     C                     Z-ADDWDCKNB    WECKNB           G/L Document Nu
     C                     MOVELWDIZTX    WEIZTX           G/L ID Code JDE
     C                     MOVELWDEAZT    WEEAZT           Effect on Accou
     C                     MOVELWDUVST    WEUVST           EDI Status 1
     C                     MOVELWDUWST    WEUWST           EDI Status 2
     C                     MOVELWDUXST    WEUXST           EDI Status 3
     C                     MOVELWDVSST    WEVSST           Record Status
     C                     Z-ADDWDAATM    WEAATM           Job Time
     C                     MOVELWDAYNA    WEAYNA           User Id
     C                     MOVELWDA0NA    WEA0NA           Job Name
     C                     Z-ADDWDAXDT    WEAXDT           Job Date
      *
     C           KLCRSE    KLIST
     C                     KFLD           WEG4CD           Bank Code
     C                     KFLD           WEHXDT           Deposit Date
     C                     KFLD           WEYXNX           Deposit Time
     C                     KFLD           WEUJCD           Reference Field
      * Check for duplicate primary key
     C           KLCRSE    SETLL@BKCPDY                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR0243' W0RTN   7
      * Send message 'A/R Non A/R Cash       EX'
     C                     MOVEL'USR0243' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@BKCPDY                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * DLT Non-A/R Cash       DL - A/R Non A/R Cash  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BKCPGX
     C                     MOVELWDG4CD    WFG4CD           Bank Code
     C                     Z-ADDWDHXDT    WFHXDT           Deposit Date
     C                     Z-ADDWDYXNX    WFYXNX           Deposit Time
     C                     MOVELWDUJCD    WFUJCD           Reference Field
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFG4CD           Bank Code
     C                     KFLD           WFHXDT           Deposit Date
     C                     KFLD           WFYXNX           Deposit Time
     C                     KFLD           WFUJCD           Reference Field
     C           KLDLSF    CHAIN@BKCPGX              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'ARBKCPL0'MDACP
     C                     MOVEL'@BKCPGX' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BKCPGX                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHXDT           Deposit Date
     C                     Z-ADD*ZERO     WAYXNX           Deposit Time
     C                     Z-ADD*ZERO     WAUIVA           Deposit Amount
     C                     Z-ADD*ZERO     WAUJVA           Total Cash Appl
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WABHNB           Number of Depos
     C                     Z-ADD*ZERO     WABINB           Number of Appli
     C                     Z-ADD*ZERO     WAE2VL           CD TF Internal
     C                     Z-ADD*ZERO     WAE3VL           CD TF Immediate
     C                     Z-ADD*ZERO     WAE4VL           CD TF 1 Day Fun
     C                     Z-ADD*ZERO     WAE5VL           CD TF 2 Day Fun
     C                     Z-ADD*ZERO     WAE6VL           CD SB Exempt Im
     C                     Z-ADD*ZERO     WAE7VL           CD SB 1 Day Exe
     C                     Z-ADD*ZERO     WAE8VL           CD SB 2 Day Exe
     C                     Z-ADD*ZERO     WAE9VL           SBD Exempt Tota
     C                     Z-ADD*ZERO     WAFAVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WAFBVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WAFCVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WAFDVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WAHYDT           G/L Post Date
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field First Time Flag
     C                     MOVEL*BLANK    WUTAST  1
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDHXDT           Deposit Date
     C                     Z-ADD*ZERO     WDYXNX           Deposit Time
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WDB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WDHYDT           G/L Post Date
     C                     Z-ADD*ZERO     WDCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
