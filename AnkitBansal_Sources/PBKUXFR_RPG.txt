     H/TITLE Cnv Calender YR Week  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 11/07/13  Time  : 11:27:34
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMD0CPL1IF  E           K        DISK
      * RTV : Sales History EXT         Retrieval index
      *
     FOMHSTPL1IF  E           K        DISK
      * RTV : Sales History             Retrieval index
      *
     FCAAFREL1IF  E           K        DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FPMD0CPL0UF  E           K        DISK
      * UPD : Sales History EXT         Update index
      *
     I@D0CPTQ
      * Sales History EXT         Retrieval index
      * Renamed input format fields
     I              D0AIC3                          WAAIC3
     I              D0C4NB                          WAC4NB
     I              D0DPNB                          WADPNB
     I              D0UENB                          WAUENB
     I              D0I7VL                          WAI7VL
     I              D0JXAA                          WAJXAA
     I              D0SHES                          WASHES
     I              D0SHS1                          WASHS1
     I              D0SHS2                          WASHS2
     I              D0OVTX                          WAOVTX
     I              D0SADT                          WASADT
     I              D0LMT1                          WALMT1
     I              D0SBDT                          WASBDT
     I              D0I9VL                          WAI9VL
     I              D0JAVL                          WAJAVL
     I              D0JBVL                          WAJBVL
     I              D0GIPR                          WAGIPR
     I              D0GJPR                          WAGJPR
     I              D0TCDT                          WATCDT
     I              D0TDDT                          WATDDT
     I              D0F9ST                          WAF9ST
     I              D0GAST                          WAGAST
     I              D0LXAA                          WALXAA
     I              D0F5ST                          WAF5ST
     I              D0WET1                          WAWET1
     I              D0WFT1                          WAWFT1
     I              D0WGT1                          WAWGT1
     I              D0WHT1                          WAWHT1
     I              D0QRNY                          WAQRNY
     I              D0QSNY                          WAQSNY
     I              D0QNNY                          WAQNNY
     I              D0QONY                          WAQONY
     I              D0QPNY                          WAQPNY
     I              D0QQNY                          WAQQNY
     I              D0QTNY                          WAQTNY
     I              D0QUNY                          WAQUNY
     I              D0VSST                          WAVSST
     I              D0MJDT                          WAMJDT
     I              D0BETM                          WABETM
     I              D0CCVN                          WACCVN
     I              D0CDVN                          WACDVN
     I              D0MKDT                          WAMKDT
     I              D0BFTM                          WABFTM
     I              D0CEVN                          WACEVN
     I              D0CFVN                          WACFVN
      *
     I@FHSTD3
      * Sales History             Retrieval index
      * Renamed input format fields
     I              F4AIC3                          WBAIC3
     I              F4C4NB                          WBC4NB
     I              F4DPNB                          WBDPNB
     I              F4UENB                          WBUENB
     I              F4MONA                          WBMONA
     I              F4RJCD                          WBRJCD
     I              F4RKCD                          WBRKCD
     I              F4GPTX                          WBGPTX
     I              F4ABTX                          WBABTX
     I              F4KXCD                          WBKXCD
     I              F4BOCD                          WBBOCD
     I              F4BTC7                          WBBTC7
     I              F4ANC7                          WBANC7
     I              F4AQTX                          WBAQTX
     I              F4BKC7                          WBBKC7
     I              F4BRTX                          WBBRTX
     I              F4HNNA                          WBHNNA
     I              F4DBCD                          WBDBCD
     I              F4CKTX                          WBCKTX
     I              F4BCNA                          WBBCNA
     I              F4A0DT                          WBA0DT
     I              F4ACDT                          WBACDT
     I              F4R4CD                          WBR4CD
     I              F4R5CD                          WBR5CD
     I              F4BFCD                          WBBFCD
     I              F4Q4CD                          WBQ4CD
     I              F4AQCD                          WBAQCD
     I              F4TBNB                          WBTBNB
     I              F4BZNA                          WBBZNA
     I              F4RLCD                          WBRLCD
     I              F4JNCD                          WBJNCD
     I              F4Q2CD                          WBQ2CD
     I              F4U2ST                          WBU2ST
     I              F4ATIN                          WBATIN
     I              F4T3NB                          WBT3NB
     I              F4RSRN                          WBRSRN
     I              F4ORIT                          WBORIT
     I              F4AJCD                          WBAJCD
     I              F4AVQT                          WBAVQT
     I              F4D0WG                          WBD0WG
     I              F4CCQT                          WBCCQT
     I              F4AUWG                          WBAUWG
     I              F4AGCD                          WBAGCD
     I              F4AKPR                          WBAKPR
     I              F4AUPR                          WBAUPR
     I              F4CRCD                          WBCRCD
     I              F4A5DT                          WBA5DT
     I              F4AWDT                          WBAWDT
     I              F4HDDT                          WBHDDT
     I              F4AGCS                          WBAGCS
     I              F4AQCS                          WBAQCS
     I              F4AVWG                          WBAVWG
     I              F4AYVA                          WBAYVA
     I              F4AMST                          WBAMST
     I              F4ANST                          WBANST
     I              F4VAST                          WBVAST
     I              F4L6NB                          WBL6NB
     I              F4UMCD                          WBUMCD
     I              F4HCDT                          WBHCDT
     I              F4ESNB                          WBESNB
     I              F4ETNB                          WBETNB
     I              F4BZNB                          WBBZNB
     I              F4EXQT                          WBEXQT
     I              F4BYWG                          WBBYWG
     I              F4S5NB                          WBS5NB
     I              F4MAVA                          WBMAVA
     I              F4KDVA                          WBKDVA
     I              F4USVA                          WBUSVA
     I              F4UTVA                          WBUTVA
     I              F4A4WG                          WBA4WG
     I              F4CKNB                          WBCKNB
     I              F4BMST                          WBBMST
     I              F4R8NB                          WBR8NB
     I              F4RMCD                          WBRMCD
     I              F4BZPR                          WBBZPR
     I              F4RDCD                          WBRDCD
     I              F4Q7CD                          WBQ7CD
     I              F4EXDT                          WBEXDT
     I              F4LQCD                          WBLQCD
     I              F4HICD                          WBHICD
     I              F4RBCD                          WBRBCD
     I              F4RGNB                          WBRGNB
     I              F4RHNB                          WBRHNB
     I              F4RINB                          WBRINB
     I              F4R1NB                          WBR1NB
     I              F4CONB                          WBCONB
     I              F4CEST                          WBCEST
     I              F4GNDT                          WBGNDT
     I              F4RMNB                          WBRMNB
     I              F4AODT                          WBAODT
     I              F4LLCD                          WBLLCD
     I              F4LMCD                          WBLMCD
     I              F4SKNB                          WBSKNB
     I              F4SLNB                          WBSLNB
     I              F4SMNB                          WBSMNB
     I              F4G7NA                          WBG7NA
     I              F4ONVA                          WBONVA
     I              F4N0CD                          WBN0CD
     I              F4B4NB                          WBB4NB
     I              F4B5NB                          WBB5NB
     I              F4N1CD                          WBN1CD
     I              F4GIDT                          WBGIDT
     I              F4Z1ST                          WBZ1ST
     I              F4ULVA                          WBULVA
     I              F4UNVA                          WBUNVA
     I              F4UOVA                          WBUOVA
     I              F4UPVA                          WBUPVA
     I              F4UQVA                          WBUQVA
     I              F4SDCD                          WBSDCD
     I              F4QZCD                          WBQZCD
     I              F4XWST                          WBXWST
     I              F4T9CD                          WBT9CD
     I              F4UBCD                          WBUBCD
     I              F4CFC7                          WBCFC7
     I              F4X1CD                          WBX1CD
     I              F4GASX                          WBGASX
     I              F4DUPR                          WBDUPR
     I              F4B6VL                          WBB6VL
     I              F4IANX                          WBIANX
     I              F4IBNX                          WBIBNX
     I              F4RPCD                          WBRPCD
     I              F4NYDT                          WBNYDT
     I              F4BZTM                          WBBZTM
     I              F4Z4NB                          WBZ4NB
     I              F4XACD                          WBXACD
     I              F4OANA                          WBOANA
     I              F4OKTX                          WBOKTX
     I              F4K4TX                          WBK4TX
     I              F4NBBO                          WBNBBO
     I              F4OCFR                          WBOCFR
     I              F4C0C7                          WBC0C7
     I              F4A1AA                          WBA1AA
     I              F4VEST                          WBVEST
     I              F4A5PR                          WBA5PR
     I              F4CDPR                          WBCDPR
     I              F4D0PR                          WBD0PR
     I              F4D0VL                          WBD0VL
     I              F4IRSX                          WBIRSX
     I              F4CEVL                          WBCEVL
     I              F4ISSX                          WBISSX
     I              F4ITSX                          WBITSX
     I              F4IUSX                          WBIUSX
     I              F4OHDT                          WBOHDT
     I              F4D9PR                          WBD9PR
     I              F4CFVL                          WBCFVL
     I              F4UVST                          WBUVST
     I              F4UWST                          WBUWST
     I              F4UXST                          WBUXST
     I              F4AATM                          WBAATM
     I              F4AYNA                          WBAYNA
     I              F4A0NA                          WBA0NA
     I              F4AXDT                          WBAXDT
      *
     I@AFREBE
      * Calendar                  Retrieval index       NV
      * Renamed input format fields
     I              AFAIC3                          WCAIC3
     I              AFBCDT                          WCBCDT
     I              AFCQNB                          WCCQNB
     I              AFESNB                          WCESNB
     I              AFETNB                          WCETNB
     I              AFBZNB                          WCBZNB
     I              AFA9ST                          WCA9ST
     I              AFEINB                          WCEINB
     I              AFC5ST                          WCC5ST
     I              AFAQNB                          WCAQNB
     I              AFCMST                          WCCMST
     I              AFV9ST                          WCV9ST
     I              AFWAST                          WCWAST
     I              AFX2ST                          WCX2ST
     I              AFOJDT                          WCOJDT
     I              AFNQNX                          WCNQNX
     I              AFNRNX                          WCNRNX
     I              AFI9SX                          WCI9SX
     I              AFJASX                          WCJASX
     I              AFOKDT                          WCOKDT
     I              AFOLDT                          WCOLDT
     I              AFUVST                          WCUVST
     I              AFUWST                          WCUWST
     I              AFUXST                          WCUXST
     I              AFAATM                          WCAATM
     I              AFAYNA                          WCAYNA
     I              AFA0NA                          WCA0NA
     I              AFAXDT                          WCAXDT
      *
     I@D0CPTP
      * Sales History EXT         Update index
      * Renamed input format fields
     I              D0AIC3                          WDAIC3
     I              D0C4NB                          WDC4NB
     I              D0DPNB                          WDDPNB
     I              D0UENB                          WDUENB
     I              D0I7VL                          WDI7VL
     I              D0JXAA                          WDJXAA
     I              D0SHES                          WDSHES
     I              D0SHS1                          WDSHS1
     I              D0SHS2                          WDSHS2
     I              D0OVTX                          WDOVTX
     I              D0SADT                          WDSADT
     I              D0LMT1                          WDLMT1
     I              D0SBDT                          WDSBDT
     I              D0I9VL                          WDI9VL
     I              D0JAVL                          WDJAVL
     I              D0JBVL                          WDJBVL
     I              D0GIPR                          WDGIPR
     I              D0GJPR                          WDGJPR
     I              D0TCDT                          WDTCDT
     I              D0TDDT                          WDTDDT
     I              D0F9ST                          WDF9ST
     I              D0GAST                          WDGAST
     I              D0LXAA                          WDLXAA
     I              D0F5ST                          WDF5ST
     I              D0WET1                          WDWET1
     I              D0WFT1                          WDWFT1
     I              D0WGT1                          WDWGT1
     I              D0WHT1                          WDWHT1
     I              D0QRNY                          WDQRNY
     I              D0QSNY                          WDQSNY
     I              D0QNNY                          WDQNNY
     I              D0QONY                          WDQONY
     I              D0QPNY                          WDQPNY
     I              D0QQNY                          WDQQNY
     I              D0QTNY                          WDQTNY
     I              D0QUNY                          WDQUNY
     I              D0VSST                          WDVSST
     I              D0MJDT                          WDMJDT
     I              D0BETM                          WDBETM
     I              D0CCVN                          WDCCVN
     I              D0CDVN                          WDCDVN
     I              D0MKDT                          WDMKDT
     I              D0BFTM                          WDBFTM
     I              D0CEVN                          WDCEVN
     I              D0CFVN                          WDCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPMD01    E DSPMD0CPL0
      * UPD : Sales History EXT         Update index
      * Renamed input format fields
     I              D0AIC3                          WDAIC3
     I              D0C4NB                          WDC4NB
     I              D0DPNB                          WDDPNB
     I              D0UENB                          WDUENB
     I              D0I7VL                          WDI7VL
     I              D0JXAA                          WDJXAA
     I              D0SHES                          WDSHES
     I              D0SHS1                          WDSHS1
     I              D0SHS2                          WDSHS2
     I              D0OVTX                          WDOVTX
     I              D0SADT                          WDSADT
     I              D0LMT1                          WDLMT1
     I              D0SBDT                          WDSBDT
     I              D0I9VL                          WDI9VL
     I              D0JAVL                          WDJAVL
     I              D0JBVL                          WDJBVL
     I              D0GIPR                          WDGIPR
     I              D0GJPR                          WDGJPR
     I              D0TCDT                          WDTCDT
     I              D0TDDT                          WDTDDT
     I              D0F9ST                          WDF9ST
     I              D0GAST                          WDGAST
     I              D0LXAA                          WDLXAA
     I              D0F5ST                          WDF5ST
     I              D0WET1                          WDWET1
     I              D0WFT1                          WDWFT1
     I              D0WGT1                          WDWGT1
     I              D0WHT1                          WDWHT1
     I              D0QRNY                          WDQRNY
     I              D0QSNY                          WDQSNY
     I              D0QNNY                          WDQNNY
     I              D0QONY                          WDQONY
     I              D0QPNY                          WDQPNY
     I              D0QQNY                          WDQQNY
     I              D0QTNY                          WDQTNY
     I              D0QUNY                          WDQUNY
     I              D0VSST                          WDVSST
     I              D0MJDT                          WDMJDT
     I              D0BETM                          WDBETM
     I              D0CCVN                          WDCCVN
     I              D0CDVN                          WDCDVN
     I              D0MKDT                          WDMKDT
     I              D0BFTM                          WDBFTM
     I              D0CEVN                          WDCEVN
     I              D0CFVN                          WDCFVN
      *
     IYARDCS      DS                            314
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Cnv Calender YR Week  XF
      * 11.7.2013 E2872 RMC
      * Cnv Calender YR WK    RT - Sales History EXT  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Cnv Calender YR WK    RT - Sales History EXT  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
      * Setup key
     C                     Z-ADD360       WAAIC3           Company Number
     C                     Z-ADD938001    WAC4NB           Order Number
      * Establish starting position
     C           KPSSA     SETLL@D0CPTQ                    *
     C                     READ @D0CPTQ                  90*
      * Data record not found
     C   90                MOVEL'USR3950' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * RTV Actual Ship Date   RT - Sales History  * 
     C                     EXSR SBRVGN
      * CASE: LCL.Actual Shipped Date is GE 1/1/13
     C           YL0001    IFGE 1130101                    *IF
      * Rtv Week Number       RT - Calendar  * 
     C                     EXSR SCRVGN
      * Chg Sales History EXT CH - Sales History EXT  * 
     C                     EXSR SDCHRC
     C                     END                             *FI
     C                     READ @D0CPTQ                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Actual Ship Date   RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBC4NB    WQSB02           Order Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWAC4NB    WQSB02           Order Number
      * Establish starting position
     C           KRSSB     SETLL@FHSTD3                    *
     C           KRSSB     READE@FHSTD3                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1241' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           Actual Shipped
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWBGNDT    YL0001           Actual Shipped
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@FHSTD3                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Week Number       RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCBCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADDWAAIC3    WCAIC3           Company Number
     C                     Z-ADDYL0001    WCBCDT           Post to G/L Dat
      * Establish starting position
     C           KRSSC     CHAIN@AFREBE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0018' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0002           Accounting Year
     C                     Z-ADD*ZERO     YL0003           Week Number
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWCESNB    YL0002           Accounting Year
     C                     Z-ADDWCEINB    YL0003           Week Number
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Chg Sales History EXT CH - Sales History EXT  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001 112       SH Fuel Surchar
     C                     MOVEL*BLANK    WN0002  3        SH Price Type
     C                     MOVEL*BLANK    WN0003  1        SH Slip Sheet
     C                     MOVEL*BLANK    WN0004  1        SH Unused Sts 1
     C                     MOVEL*BLANK    WN0005  1        SH Unused Sts 2
     C                     MOVEL*BLANK    WN0006  2        SH Order Sales
     C                     Z-ADD*ZERO     WN0007  70       SH Price Type R
     C                     MOVEL*BLANK    WN0008 38        Delivery P.O. N
     C                     Z-ADD*ZERO     WN0009  70       SH Unused Date
     C                     Z-ADD*ZERO     WN0010 112       SH Revenue Adju
     C                     Z-ADD*ZERO     WN0011 112       SH Unused Value
     C                     Z-ADD*ZERO     WN0012 112       SH Unused Value
     C                     Z-ADD*ZERO     WN0013 114       SH Gate Price
     C                     Z-ADD*ZERO     WN0014 114       SH Gate/Final A
     C                     Z-ADD*ZERO     WN0015  70       SH Unused Date
     C                     Z-ADD*ZERO     WN0016  70       SH Unused Date
     C                     MOVEL*BLANK    WN0017  2        SH Unused Statu
     C                     MOVEL*BLANK    WN0018  2        SH Unused Statu
     C                     MOVEL*BLANK    WN0019  6        SH Intended for
     C                     MOVEL*BLANK    WN0020  6        SH Unused Statu
     C                     MOVEL*BLANK    WN0021 10        SH Unused Text
     C                     MOVEL*BLANK    WN0022 15        SH Unused Text
     C                     MOVEL*BLANK    WN0023 30        SH Unused Text
     C                     MOVEL*BLANK    WN0024 50        SH Unused Text
     C                     Z-ADD*ZERO     WN0025  30       SH Unused Numer
     C                     Z-ADD*ZERO     WN0026  50       SH Unused Numer
     C                     Z-ADD*ZERO     WN0027  60       SH Unused Numer
     C                     Z-ADD*ZERO     WN0028  60       SH Unused Numer
     C                     Z-ADD*ZERO     WN0029  90       SH Unused Numer
     C                     Z-ADD*ZERO     WN0030  90       SH Unused Numer
     C                     MOVEL*BLANK    WN0031  1        Record Status
     C                     Z-ADD*ZERO     WN0032  70       Create Date
     C                     Z-ADD*ZERO     WN0033  60       Create Time
     C                     MOVEL*BLANK    WN0034 10        Create User
     C                     MOVEL*BLANK    WN0035 10        Create Program
     C                     Z-ADD*ZERO     WN0036  70       Change Date
     C                     Z-ADD*ZERO     WN0037  60       Change Time
     C                     MOVEL*BLANK    WN0038 10        Change User
     C                     MOVEL*BLANK    WN0039 10        Change Program
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @D0CPTP
     C                     Z-ADDWAAIC3    WDAIC3           Company Number
     C                     Z-ADDWAC4NB    WDC4NB           Order Number
     C                     Z-ADDWADPNB    WDDPNB           Order Sequence
     C                     Z-ADDWAUENB    WDUENB           Order Secondary
      *
     C           KLCHSD    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDC4NB           Order Number
     C                     KFLD           WDDPNB           Order Sequence
     C                     KFLD           WDUENB           Order Secondary
     C           KLCHSD    CHAIN@D0CPTP              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PMD0CPL0'MDACP
     C                     MOVEL'@D0CPTP' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPMD01    YARDCS
      * Move non-key fields to @D0CPTP
     C                     Z-ADDYL0003    WDQRNY           SH Calendar Wee
     C                     Z-ADDYL0002    WDQNNY           SH Calendar Yea
      *
      * Set PGM.*Record Data Changed flag
     C           QPMD01    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Chg Date/Time      IF
     C                     Z-ADD##JDT     WDMKDT           Change Date
     C                     Z-ADD##JTM     WDBFTM           Change Time
     C                     MOVEL##USR     WDCEVN           Change User
     C                     MOVEL##PGM     WDCFVN           Change Program
      * Set PGM.*Record Data Changed flag
     C           QPMD01    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@D0CPTP                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPMD0CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WAI7VL           SH Fuel Surchar
     C                     Z-ADD*ZERO     WASADT           SH Price Type R
     C                     Z-ADD*ZERO     WASBDT           SH Unused Date
     C                     Z-ADD*ZERO     WAI9VL           SH Revenue Adju
     C                     Z-ADD*ZERO     WAJAVL           SH Unused Value
     C                     Z-ADD*ZERO     WAJBVL           SH Unused Value
     C                     Z-ADD*ZERO     WAGIPR           SH Gate Price
     C                     Z-ADD*ZERO     WAGJPR           SH Gate/Final A
     C                     Z-ADD*ZERO     WATCDT           SH Unused Date
     C                     Z-ADD*ZERO     WATDDT           SH Unused Date
     C                     Z-ADD*ZERO     WAQRNY           SH Calendar Wee
     C                     Z-ADD*ZERO     WAQSNY           SH Unused Numer
     C                     Z-ADD*ZERO     WAQNNY           SH Calendar Yea
     C                     Z-ADD*ZERO     WAQONY           SH Unused Numer
     C                     Z-ADD*ZERO     WAQPNY           SH Unused Numer
     C                     Z-ADD*ZERO     WAQQNY           SH Unused Numer
     C                     Z-ADD*ZERO     WAQTNY           SH Unused Numer
     C                     Z-ADD*ZERO     WAQUNY           SH Unused Numer
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBDPNB           Order Sequence
     C                     Z-ADD*ZERO     WBUENB           Order Secondary
     C                     Z-ADD*ZERO     WBBTC7           Parent Customer
     C                     Z-ADD*ZERO     WBANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBA0DT           Order Date
     C                     Z-ADD*ZERO     WBACDT           Cancel Date
     C                     Z-ADD*ZERO     WBTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WBATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WBT3NB           Attach to Order
     C                     Z-ADD*ZERO     WBRSRN           Resell Referenc
     C                     Z-ADD*ZERO     WBORIT           Original Item
     C                     Z-ADD*ZERO     WBAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WBD0WG           Weight Ordered
     C                     Z-ADD*ZERO     WBCCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WBAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WBAKPR           Unit Price
     C                     Z-ADD*ZERO     WBAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WBA5DT           Requested Ship
     C                     Z-ADD*ZERO     WBAWDT           Invoice Date
     C                     Z-ADD*ZERO     WBHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WBAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WBAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WBAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WBAYVA           Extended Amount
     C                     Z-ADD*ZERO     WBL6NB           Contract Number
     C                     Z-ADD*ZERO     WBHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WBESNB           Accounting Year
     C                     Z-ADD*ZERO     WBETNB           Accounting Peri
     C                     Z-ADD*ZERO     WBBZNB           OM Week
     C                     Z-ADD*ZERO     WBEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WBBYWG           Weight Billed
     C                     Z-ADD*ZERO     WBS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WBMAVA           Billing Detail
     C                     Z-ADD*ZERO     WBKDVA           Billing Detail
     C                     Z-ADD*ZERO     WBUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WBUTVA           Standard Overag
     C                     Z-ADD*ZERO     WBA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WBCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WBR8NB           Shipping Compan
     C                     Z-ADD*ZERO     WBBZPR           Price Overage O
     C                     Z-ADD*ZERO     WBEXDT           Market Pricing
     C                     Z-ADD*ZERO     WBRGNB           Item Structure
     C                     Z-ADD*ZERO     WBRHNB           Item Structure
     C                     Z-ADD*ZERO     WBRINB           Item Structure
     C                     Z-ADD*ZERO     WBR1NB           Rated Freight
     C                     Z-ADD*ZERO     WBCONB           Invoice Number
     C                     Z-ADD*ZERO     WBGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WBRMNB           Load ID
     C                     Z-ADD*ZERO     WBAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WBSKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WBSLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WBSMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WBONVA           Actual Freight
     C                     Z-ADD*ZERO     WBB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WBB5NB           PM Line Number
     C                     Z-ADD*ZERO     WBGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WBULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WBUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WBUOVA           Commission Amou
     C                     Z-ADD*ZERO     WBUPVA           Financials Amou
     C                     Z-ADD*ZERO     WBUQVA           Financials Amou
     C                     Z-ADD*ZERO     WBCFC7           Order Group Cod
     C                     Z-ADD*ZERO     WBDUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WBB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WBIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WBIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WBNYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WBBZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WBZ4NB           MPC Number
     C                     Z-ADD*ZERO     WBOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WBC0C7           Claim Number
     C                     Z-ADD*ZERO     WBA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WBA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WBCDPR           Market Value
     C                     Z-ADD*ZERO     WBD0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WBD0VL           Raw Material Co
     C                     Z-ADD*ZERO     WBCEVL           Sales Expense T
     C                     Z-ADD*ZERO     WBOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WBD9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WBCFVL           HST Item Target
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCBCDT           Post to G/L Dat
     C                     Z-ADD*ZERO     WCCQNB           Julian Date
     C                     Z-ADD*ZERO     WCESNB           Accounting Year
     C                     Z-ADD*ZERO     WCETNB           Accounting Peri
     C                     Z-ADD*ZERO     WCBZNB           OM Week
     C                     Z-ADD*ZERO     WCEINB           Week Number
     C                     Z-ADD*ZERO     WCAQNB           Billing Cycle
     C                     Z-ADD*ZERO     WCOJDT           HPS PIC Date
     C                     Z-ADD*ZERO     WCNQNX           HPS Calendar Ye
     C                     Z-ADD*ZERO     WCNRNX           HPS Calendar We
     C                     Z-ADD*ZERO     WCOKDT           Calendar Unused
     C                     Z-ADD*ZERO     WCOLDT           Calendar Unused
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Actual Shipped Date
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field Accounting Year Code
     C                     Z-ADD*ZERO     YL0002  40
      * Define local work field Week Number
     C                     Z-ADD*ZERO     YL0003  20
      *================================================================
     CSR         ZZEXIT    ENDSR
