// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKYWXFR
// ?Date: 14.08.2025 Time: 02:50:52
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Madifications and comments
DO;

//?H16853 ISE 11/03/20 - Increased the Buy Order NUmber field length
//?                      from 5 to 7.
ENDDO;

// WRK.CC Company Number = CVTVAR(PAR.CC Company Num-Alpha)
WRK.CC_Company_Number = CVTVAR(PAR.CC_Company_Num_Alpha);

// WRK.@DATE OF NUMBERIC USR = CVTVAR(PAR.Pmt Cur Payment Dte-Alpha)
WRK.@DATE_OF_NUMBERIC_USR = CVTVAR(PAR.Pmt_Cur_Payment_Dte_Alpha);

// *MO.VE             1183529*Bu = ilt. in functions
WRK.Pmt_Current_Payment_Date = WRK.@DATE_OF_NUMBERIC_USR;

// WRK.@DATE OF NUMBERIC USR = CVTVAR(PAR.Pay Date to Usr Alph)
WRK.@DATE_OF_NUMBERIC_USR = CVTVAR(PAR.Pay_Date_to_Usr_Alph);

// WRK.Payment Date Usr 1 = CVTVAR(WRK.@DATE OF NUMBERIC USR)
WRK.Payment_Date_Usr_1 = CVTVAR(WRK.@DATE_OF_NUMBERIC_USR);

// WRK.Date Alpha USR = CVTVAR(WRK.@DATE OF NUMBERIC USR)
WRK.Date_Alpha_USR = CVTVAR(WRK.@DATE_OF_NUMBERIC_USR);

//?This program should only be run as a prktest user
//?UPDATE THE COMPANY FILE RESTORE WITH THE KILL DATE
//?= TO PAR PAYMENT DATE 1.  AND CALCULATE NEXT KILL DATE,
//?ALSO UPDATE THE NEXT PRODUCTION DATE
// Call program Rtv Nxt Kill Dt 2 OMS XF.
CALL PROGRAM(Rtv Nxt Kill Dt 2 OMS XF) ('PDUXXFR');
PARAMETER(WRK.CC_Company_Number);
PARAMETER(WRK.Payment_Date_Usr_1);
PARAMETER(WRK.Next_Kill_Date);

EXECUTE FUNCTION(Chg Cur/Nxt Dates     CH) TYPE(CHGOBJ) FILE(PKAZREP)           AB1153374;
PARAMETER(WRK.CC_Company_Number);
PARAMETER(WRK.Payment_Date_Usr_1);
PARAMETER(WRK.Next_Kill_Date);
PARAMETER(WRK.Payment_Date_Usr_1);
PARAMETER(WRK.Next_Kill_Date);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 {
  //?Execute internal function

  // PAR.RS User Changed = JOB.*USER
  PAR.RS_User_Changed = JOB.*USER;

  // PAR.RS Date Changed = JOB.*Job date
  PAR.RS_Date_Changed = JOB.*Job_date;

  // PAR.RS Time Changed = JOB.*Job time
  PAR.RS_Time_Changed = JOB.*Job_time;

  // PAR.RS Job = JOB.*JOB
  PAR.RS_Job = JOB.*JOB;

  // PAR.RS Program = JOB.*PROGRAM
  PAR.RS_Program = JOB.*PROGRAM;

 }

}


EXECUTE FUNCTION(Chg Payment Date/Step  CH) TYPE(CHGOBJ) FILE(PKC4REP)          AB1147408;
PARAMETER(WRK.CC_Company_Number);
PARAMETER(WRK.Payment_Date_Usr_1);
PARAMETER(2);
PARAMETER(*MISSING);
PARAMETER(*BLANK);
{
 //?USER: Processing before Data read

 EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
 PARAMETER(PAR.RS_User_Changed);
 PARAMETER(PAR.RS_Date_Changed);
 PARAMETER(PAR.RS_Time_Changed);
 PARAMETER(PAR.RS_Job);
 PARAMETER(PAR.RS_Program);
 {
  //?Execute internal function

  // PAR.RS User Changed = JOB.*USER
  PAR.RS_User_Changed = JOB.*USER;

  // PAR.RS Date Changed = JOB.*Job date
  PAR.RS_Date_Changed = JOB.*Job_date;

  // PAR.RS Time Changed = JOB.*Job time
  PAR.RS_Time_Changed = JOB.*Job_time;

  // PAR.RS Job = JOB.*JOB
  PAR.RS_Job = JOB.*JOB;

  // PAR.RS Program = JOB.*PROGRAM
  PAR.RS_Program = JOB.*PROGRAM;

 }

}


//?Change to unpaid and cmp pgm, tattoo header, buy order
// Call program Zzz BOH/TATTO/For CMP  XF.
CALL PROGRAM(Zzz BOH/TATTO/For CMP  XF) ('PKYTXFR');
PARAMETER(WRK.CC_Company_Number);
PARAMETER(WRK.Pmt_Current_Payment_Date);
PARAMETER(PAR.CMP_Program_Usr);

//?PAYMENT EDIT
// Execute command - 'SBM Payment Producer Edit'
EXECUTE COMMAND(PRK0456);
PARAMETER('QPRINT');
PARAMETER(*YES);
PARAMETER(*YES);
PARAMETER(1);
PARAMETER(*BLANK);
PARAMETER(WRK.CC_Company_Number);
PARAMETER(WRK.Oms_System_Value_Alpha);

// WRK.Tattoo Nbr Alpha Usr = CVTVAR(WRK.Tattoo Number New User)
WRK.Tattoo_Nbr_Alpha_Usr = CVTVAR(WRK.Tattoo_Number_New_User);

