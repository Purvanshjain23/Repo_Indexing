/*******************************************************************/
/* MODIFIED:  RMC 5/02/02  CHANGE TLX400J TO TLX400P               */
/*            RMC 2/01/05  ADDED CODE FOR GENIFAX SOFTWARE         */
/* 05/22/2007 LJB DLY029   THIS IS A SAVE VERSION OF THE ORIGINAL  */
/*                         PROGRAM. SEVERAL CHANGES ARE BEING      */
/*                         MADE. THIS WILL ELIMINATE ALL THE       */
/*                         COMMENTED CODE.                         */
/*******************************************************************/
 PKUQUPR:    PGM        PARM(&PRTF &DESC &COVER &FAXC &FAXR &FAXAREA +
                          &FAXPHONE)

            DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
            DCL        VAR(&DESC) TYPE(*CHAR) LEN(25)
            DCL        VAR(&COVER) TYPE(*CHAR) LEN(10)
            DCL        VAR(&FAXC) TYPE(*CHAR) LEN(25)
            DCL        VAR(&FAXR) TYPE(*CHAR) LEN(25)
            DCL        VAR(&FAXAREA) TYPE(*CHAR) LEN(3)
            DCL        VAR(&FAXPHONE) TYPE(*CHAR) LEN(12)
            DCL        VAR(&FAX#)     TYPE(*CHAR) LEN(15)
            DCL        VAR(&DEPT) TYPE(*CHAR) LEN(6)
            DCL        VAR(&GENIFAX)  TYPE(*CHAR) LEN(1)
            DCL        VAR(&FTX2) TYPE(*CHAR) LEN(75)  /* EMAIL ADDR */
             DCL        VAR(&ADDPHN) TYPE(*CHAR) LEN(25) /* fax to +
                          area and phone */
             DCL        VAR(&ADDR) TYPE(*CHAR) LEN(100) /* location +
                          of fax server  */
 /*----------------------------------------------------------------- */
 /*  IF FAX SOFTWARE IN SYSTEM VALUES IS Y, THEN USE GENIFAX TO FAX  */
             CALL       PGM(PPJXXFR) PARM(' ' 'FAXSOFT' &GENIFAX)
             IF         COND(&GENIFAX = 'Y') THEN(GOTO CMDLBL(GENIFAX))
 /*----------------------------------------------------------------- */
            CHGVAR     VAR(&FAX#) VALUE(&FAXAREA || &FAXPHONE || +
                         ',,.')

            OVRPRTF    FILE(&PRTF) TOFILE(PRKFLIB/FAXQ) HOLD(*NO)

            CRTDTAARA  DTAARA(QTEMP/CVROVR) TYPE(*CHAR) LEN(384)
            MONMSG     MSGID(CPF0000)

            CHGDTAARA  DTAARA(QTEMP/CVROVR (1 30)) VALUE(&FAXC)
            CHGDTAARA  DTAARA(QTEMP/CVROVR (216 25)) VALUE(&FAXR)

             TLX400P/SNDFSPL SPF(&PRTF) DESC('Carcass Reports') +
                          DIAL(*N &FAX# &FAXR) STIME(15.10) CVRID(SC)

             DLTSPLF    FILE(&PRTF) SELECT(*ALL)
             GOTO END
    /***************************************************************/
 GENIFAX:
             CHGVAR     VAR(&ADDPHN) VALUE(&FAXAREA *TCAT &FAXPHONE)
             OVRPRTF    FILE(PPITPFR$) PAGRTT(*AUTO) OUTQ(FAXQ) +
                          HOLD(*NO)
             CHGVAR     VAR(&DEPT) VALUE('HPE   ')
             CALL       PGM(PPITPFR) PARM('' &DEPT &FAXC &FAXR &ADDPHN)

             CALL       PGM(PPJXXFR) PARM(' ' 'FAXSERVER' &ADDR)
             CHGVAR     VAR(&FTX2) VALUE(&ADDPHN *TCAT &ADDR)
             CHGVAR     VAR(&DESC) VALUE(&FAXC) /*company name */

             ESEND/ESNDMAIL RECIPIENT(&FTX2) SUBJECT(&DESC) +
                          MSG(*NONE) MSGTYPE(*TEXT) ATTLIST((* *MSG +
                          *N PPITPFR$) (* *PDF *N &PRTF))
             DLTSPLF    FILE(&PRTF) SELECT(*ALL)
             MONMSG     MSGID(CPF3309)
             DLTSPLF    FILE(PPITPFR$) SELECT(*ALL)
             MONMSG     MSGID(CPF3309)

 END:       ENDPGM
