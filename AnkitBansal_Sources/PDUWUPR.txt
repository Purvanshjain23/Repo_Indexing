/*********************************************************************/
/*     Program: PDUWUPR                                              */
/*       Title: Convert to lotus and FTP                             */
/*        Date: 12/21/98                                             */
/* Description: - Convert download file to Lotus using SEQUEL.       */
/*              - FTP to Novell Network.                             */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*                                                                   */
/*********************************************************************/
/* Modifications:                                                    */
/*                                                                   */
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/* 06/30/00 P DROGE    CHANGED TO CREATE EXCEL FORMAT FILE INSTEAD   */
/*                     OF LOTUS.                                     */
/* 06/27/06 S MASON    ADDED THE COMPANY NUMBER TO THE SELECT        */
/* 03/09/09 S MASON    E00336 ALLOW EMAIL OF DOWNLOAD FILES          */
/*                     THIS WILL BE EITHER DOWNLOAD OR EMAIL NOT     */
/*                     BOTH                                          */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&RPTTYP &EMAIL)

   /*-------------------*/
   /* Declare Variables */
   /*-------------------*/

             /* Internal Fields */
             DCL  VAR(&ALREADY)  TYPE(*CHAR) LEN(1)
             DCL  VAR(&DOCUMENT) TYPE(*CHAR) LEN(10)
             DCL  VAR(&PCFILE)   TYPE(*CHAR) LEN(32)
             DCL  VAR(&PCFMT)    TYPE(*CHAR) LEN(10) VALUE(*XLS)
             DCL  VAR(&PCEXT)    TYPE(*CHAR) LEN(3) VALUE(XLS)
             DCL  VAR(&EMAIL)    TYPE(*CHAR) LEN(50)
             DCL  VAR(&RPTTYP)   TYPE(*CHAR) LEN(1)
             DCL  VAR(&TEXT)     TYPE(*CHAR) LEN(80)


   /*----------------------------*/
   /* Add SEQUEL Library to List */
   /*----------------------------*/
             CHGVAR VAR(&ALREADY) VALUE('N')
             ADDLIBLE LIB(SEQUEL) POSITION(*LAST)
             MONMSG MSGID(CPF2103) EXEC(DO)       /* already in libl */
                CHGVAR VAR(&ALREADY) VALUE('Y')
             ENDDO

             IF         COND(&EMAIL *NE '       ') THEN(GOTO +
                          CMDLBL(EMAIL))
   /*--------------------------------------------*/
   /* Convert "A/R Claim Download Wrkf" to EXCEL */
   /*--------------------------------------------*/

   /*----------------------------------------------------*/
   /* SUSAN REMOVE THE GO TO FURTHER DOWN                */
   /* AND CHANGE THE NAME OF THE FILE THAT WAS USED     .*/
   /* FOR TESTINGTHE NAME OF THE FILE THAT WAS USED     .*/
   /* PDNACPPWK  - CHANGE BACK TO PDNACPP FOR TESTING   .*/
   /*----------------------------------------------------*/
             EXECUTE  VIEW(PDNACPPWK) +
                     TOFLR(GUY.IS) +
                     TODOC(PDNACPPWK) +
                     PCFMT(&PCFMT) +
                     REPLACE(*YES)

   /*----------------------------------------------*/
   /* Convert "A/R Claim Reas Dwnld Wrkf" to Lotus */
   /*----------------------------------------------*/
             EXECUTE SQL('SELECT +
                           nbt3tx COLHDG("Reason" "Code Desc"), +
                           nbivnx COLHDG("Frequency"), +
                           nbb9vl COLHDG("Amount") +
                          FROM pdnbcpp') +
                     TOFLR(GUY.IS) +
                     TODOC(PDNBCPP) +
                     PCFMT(&PCFMT) +
                     REPLACE(*YES)

   /*---------------------------------*/
   /* Remove SEQUEL Library from List */
   /*---------------------------------*/
             IF COND(&ALREADY *EQ 'N') THEN(DO)
                RMVLIBLE   LIB(SEQUEL)
             ENDDO

   /*----------------------------------------------------*/
   /* SUSAN REMOVE THIS  AND CHANGE THE NAME OF THE FILE.*/
   /*----------------------------------------------------*/
   /* SUSAN REMOVE THE GO TO FURTHER DOWN                */
   /* AND CHANGE THE NAME OF THE FILE THAT WAS USED     .*/
   /* FOR TESTINGTHE NAME OF THE FILE THAT WAS USED     .*/
   /* PDNACPPWK  - CHANGE BACK TO PDNACPP FOR TESTING   .*/
   /*----------------------------------------------------*/
   /*----------------------------------------------------*/
             GOTO       CMDLBL(END)
   /*------------------------------------*/
   /* FTP documents to EDIPC/PORK/CLAIMS */
   /*------------------------------------*/
             CHGVAR VAR(&DOCUMENT) VALUE('PDNACPP')
             CHGVAR VAR(&PCFILE)   VALUE('PDNACPP.' *CAT &PCEXT)
             CALL PGM(FTPCLAIMS) PARM(&DOCUMENT &PCFILE)

             CHGVAR VAR(&DOCUMENT) VALUE('PDNBCPP')
             CHGVAR VAR(&PCFILE)   VALUE('PDNBCPP.' *CAT &PCEXT)
             CALL PGM(FTPCLAIMS) PARM(&DOCUMENT &PCFILE)

             GOTO       CMDLBL(END)

EMAIL:
/*********************************************************************/
/********************  SEND EMAIL QUERY   ****************************/
/*********************************************************************/

/* >>>> FOR TESTING <<<<< */

             CPYF       FROMFILE(*LIBL/PDNACPP) +
                          TOFILE(PRKFSAV/PDNACPPSV) +
                          MBROPT(*REPLACE) CRTFILE(*YES)

/* >>>> FOR TESTING <<<<< */

             CHGVAR     VAR(&TEXT) VALUE('PDNACPP WF A/R Claim data')

             IF         COND(&EMAIL *NE '       ') THEN(DO)
             EXECUTE  VIEW(PDNACPPWK) PCFMT(*XLS) REPLACE(*YES) +
                          RECIPIENT(&EMAIL) EMLMSG(&TEXT)

             ENDDO

END:
             ENDPGM
