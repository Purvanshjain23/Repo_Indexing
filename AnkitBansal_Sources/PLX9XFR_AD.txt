// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLX9XFR
// ?Date: 14.08.2025 Time: 02:55:45
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?E4386 JJH 12/08/15 - Truck Delivery Times Report
//?- Builds the WF Truck Delivery Tm file
//?- One record per Buy Order Load
//?- Market Hogs only
//?- Concatenate PS Site ID from Tattoo Header Ext
//?H16853 ISE 11/02/2020 CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
ENDDO;

EXECUTE FUNCTION(Bld WF Truck Delivery RT) TYPE(RTVOBJ) FILE(PLAFCPP)           AB1327331;
PARAMETER(PAR.CC_Company_Number);
PARAMETER(PAR.DT_Delivery_Date);
PARAMETER(PAR.Delivery_Date_To);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.DT Delivery Date GT PAR.Delivery Date To
 IF DB1.DT_Delivery_Date > PAR.Delivery_Date_To;

 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Bld WF Truck Delivery RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1327364;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(LCL.TDT_TF_Member_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(Bld WF Truck Delivery RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1327363;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(LCL.BOL_Truck_Scale_Weigh_Sts);
 PARAMETER(LCL.BOL_Violated_Auth_Tme_Sts);
 PARAMETER(LCL.TDT_PS_Site_ID);
 PARAMETER(LCL.Market_Hog_Flag_USR);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  EXECUTE FUNCTION(Bld WF Truck Delivery RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1327367;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(LCL.TDT_PS_Site_ID);
  PARAMETER(LCL.Market_Hog_Flag_USR);
  {
   //?USER: Initialize routine

   // LCL.PS Site ID 1 USR = CON.*BLANK
   LCL.PS_Site_ID_1_USR = *BLANK;

   // LCL.PS Site ID 2 USR = CON.*BLANK
   LCL.PS_Site_ID_2_USR = *BLANK;

   // LCL.PS Site ID 3 USR = CON.*BLANK
   LCL.PS_Site_ID_3_USR = *BLANK;

   // LCL.TDT PS Site ID = CND.Blank
   LCL.TDT_PS_Site_ID = *BLANK;

   // LCL.Market Hog Flag USR = CND.No
   LCL.Market_Hog_Flag_USR = 'N';

   //?USER: Process Data record

   CASE;

   // IF DB1.TH Hog Class Type is Market
   IF DB1.TH_Hog_Class_Type = 'M';

   EXECUTE FUNCTION(Bld WF Truck Delivery RT) TYPE(RTVOBJ) FILE(PKDNCPP)           AB1327365;
   PARAMETER(DB1.BOH_Company_Number);
   PARAMETER(DB1.BOH_Buy_Order_Number);
   PARAMETER(DB1.BOL_Load_Number);
   PARAMETER(DB1.TH_Tattoo_Number);
   PARAMETER(LCL.PS_Site_ID);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   // LCL.Market Hog Flag USR = CND.Yes
   LCL.Market_Hog_Flag_USR = 'Y';

   //?Set LCL.PS Site ID
   CASE;

   // IF LCL.PS Site ID is Not Blank
   IF LCL.PS_Site_ID <> *BLANK;

   CASE;

   // IF LCL.PS Site ID 1 USR is *Blank
   IF LCL.PS_Site_ID_1_USR = *BLANK;

   // LCL.PS Site ID 1 USR = LCL.PS Site ID
   LCL.PS_Site_ID_1_USR = LCL.PS_Site_ID;

   // IF LCL.PS Site ID 1 USR NE LCL.PS Site ID
   IF LCL.PS_Site_ID_1_USR <> LCL.PS_Site_ID;

   CASE;

   // IF LCL.PS Site ID 2 USR is *Blank
   IF LCL.PS_Site_ID_2_USR = *BLANK;

   // LCL.PS Site ID 2 USR = LCL.PS Site ID
   LCL.PS_Site_ID_2_USR = LCL.PS_Site_ID;

   // IF LCL.PS Site ID 2 USR EQ LCL.PS Site ID
   IF LCL.PS_Site_ID_2_USR = LCL.PS_Site_ID;

   CASE;

   // IF LCL.PS Site ID 3 USR is *Blank
   IF LCL.PS_Site_ID_3_USR = *BLANK;

   // LCL.PS Site ID 3 USR = LCL.PS Site ID
   LCL.PS_Site_ID_3_USR = LCL.PS_Site_ID;

   ENDIF;

   ENDIF;

   ENDIF;

   ENDIF;

   ENDIF;

   //?USER: Exit processing

   //?Concatenate PS Site ID 1 USR, Ps Site ID 2 USR, PS Site ID 3 USR
   // LCL.TDT PS Site ID = CONCAT(LCL.PS Site ID 1 USR,LCL.PS Site ID 2 USR,CND.*All)
   LCL.TDT_PS_Site_ID = LCL.PS_Site_ID_1_USR + LCL.PS_Site_ID_2_USR (*ALL);

   // LCL.TDT PS Site ID = CONCAT(LCL.TDT PS Site ID,LCL.PS Site ID 3 USR,CND.*All)
   LCL.TDT_PS_Site_ID = LCL.TDT_PS_Site_ID + LCL.PS_Site_ID_3_USR (*ALL);

   // PAR.TDT PS Site ID = LCL.TDT PS Site ID
   PAR.TDT_PS_Site_ID = LCL.TDT_PS_Site_ID;

   // PAR.Market Hog Flag USR = LCL.Market Hog Flag USR
   PAR.Market_Hog_Flag_USR = LCL.Market_Hog_Flag_USR;

  }

  CASE;

  // IF PGM.*Return code is *Normal
  IF PGM.*Return_code = *BLANK;

  // PAR.TDT PS Site ID = LCL.TDT PS Site ID
  PAR.TDT_PS_Site_ID = LCL.TDT_PS_Site_ID;

  // PAR.Market Hog Flag USR = LCL.Market Hog Flag USR
  PAR.Market_Hog_Flag_USR = LCL.Market_Hog_Flag_USR;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Market Hog Flag USR = CND.No
  PAR.Market_Hog_Flag_USR = 'N';

  ENDIF;

 }

 CASE;

 // IF LCL.Market Hog Flag USR is Yes
 IF LCL.Market_Hog_Flag_USR = 'Y';

 //?Populate LCL Fields
 // LCL.TDT Company Number = DB1.CC Company Number
 LCL.TDT_Company_Number = DB1.CC_Company_Number;

 // LCL.TDT Producer Code = DB1.PD Producer Code
 LCL.TDT_Producer_Code = DB1.PD_Producer_Code;

 // LCL.TDT Sched Delivery Date = DB1.DT Delivery Date
 LCL.TDT_Sched_Delivery_Date = DB1.DT_Delivery_Date;

 // LCL.TDT Sched Delivery Time = DB1.DT Delivery Time
 LCL.TDT_Sched_Delivery_Time = DB1.DT_Delivery_Time;

 // LCL.TDT Buy Order Number = DB1.BOH Buy Order Number
 LCL.TDT_Buy_Order_Number = DB1.BOH_Buy_Order_Number;

 // LCL.TDT Buy Order Load = DB1.BOL Load Number
 LCL.TDT_Buy_Order_Load = DB1.BOL_Load_Number;

 // LCL.TDT Arrival Plant Date = DB1.DT Arrive @ Plant Date
 LCL.TDT_Arrival_Plant_Date = DB1.DT_Arrive_@_Plant_Date;

 // LCL.TDT Arrival Plant Time = DB1.DT Arrive @ Plant Time
 LCL.TDT_Arrival_Plant_Time = DB1.DT_Arrive_@_Plant_Time;

 // LCL.TDT OT Delv Flag = DB1.DT On Time Delivery
 LCL.TDT_OT_Delv_Flag = DB1.DT_On_Time_Delivery;

 // LCL.TDT Trk Scl Weigh-In Time = DB1.DT TrkScl Weigh-In Time
 LCL.TDT_Trk_Scl_Weigh_In_Time = DB1.DT_TrkScl_Weigh_In_Time;

 // LCL.TDT Recv Dock Time = DB1.DT To Recv Dock Time
 LCL.TDT_Recv_Dock_Time = DB1.DT_To_Recv_Dock_Time;

 // LCL.TDT Start Unload Time = DB1.DT Start Unloading Time
 LCL.TDT_Start_Unload_Time = DB1.DT_Start_Unloading_Time;

 // LCL.TDT End Unload Time = DB1.DT TrkScl Weigh-Out Time
 LCL.TDT_End_Unload_Time = DB1.DT_TrkScl_Weigh_Out_Time;

 // LCL.TDT Truck ID = DB1.DT Truck ID
 LCL.TDT_Truck_ID = DB1.DT_Truck_ID;

 // LCL.TDT Gate Viol = LCL.BOL Violated Auth Tme Sts
 LCL.TDT_Gate_Viol = LCL.BOL_Violated_Auth_Tme_Sts;

 // LCL.TDT Scl Weigh Sts = LCL.BOL Truck Scale Weigh Sts
 LCL.TDT_Scl_Weigh_Sts = LCL.BOL_Truck_Scale_Weigh_Sts;

 // LCL.TDT Delv Head = DB1.DT Head Received
 LCL.TDT_Delv_Head = DB1.DT_Head_Received;

 // LCL.TDT Reference 1 = DB1.DT Movement Number
 LCL.TDT_Reference_1 = DB1.DT_Movement_Number;

 // LCL.TDT Reference 2 = DB1.DT Hog Group Reference
 LCL.TDT_Reference_2 = DB1.DT_Hog_Group_Reference;

 //?Create WF Truck Delivery Times
 EXECUTE FUNCTION(Crt WF Truck Delivery CR) TYPE(CRTOBJ) FILE(PLCHCPP)           AB1327327;
 PARAMETER(LCL.TDT_Company_Number);
 PARAMETER(LCL.TDT_TF_Member_Number);
 PARAMETER(LCL.TDT_Producer_Code);
 PARAMETER(LCL.TDT_Sched_Delivery_Date);
 PARAMETER(LCL.TDT_Sched_Delivery_Time);
 PARAMETER(LCL.TDT_Buy_Order_Number);
 PARAMETER(LCL.TDT_Buy_Order_Load);
 PARAMETER(LCL.TDT_Arrival_Plant_Date);
 PARAMETER(LCL.TDT_Arrival_Plant_Time);
 PARAMETER(LCL.TDT_OT_Delv_Flag);
 PARAMETER(LCL.TDT_Trk_Scl_Weigh_In_Time);
 PARAMETER(LCL.TDT_Recv_Dock_Time);
 PARAMETER(LCL.TDT_Start_Unload_Time);
 PARAMETER(LCL.TDT_End_Unload_Time);
 PARAMETER(LCL.TDT_Truck_ID);
 PARAMETER(LCL.TDT_PS_Site_ID);
 PARAMETER(LCL.TDT_Gate_Viol);
 PARAMETER(LCL.TDT_Scl_Weigh_Sts);
 PARAMETER(LCL.TDT_Delv_Head);
 PARAMETER(LCL.TDT_Reference_1);
 PARAMETER(LCL.TDT_Reference_2);
 ENDIF;

 ENDIF;

}


