// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPV3XFR
// ?Date: 14.08.2025 Time: 03:42:05
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?01/12/06
//?Invoice Post - Cpy Orders to History PDRGXFR has been changed
//? to Not have the SBD Accrual in the Trade fund amount.
//? In this pgm, change the date to reflect that:
//?  Fob Gross amount =  Fob Gross + SBD Accrual Amount
//?  Trade Fund Accrual = Trade Fund Accrual - SBD Accrual Amount
EXECUTE FUNCTION(CNV Fob Gross 2006    RT) TYPE(RTVOBJ) FILE(OMHSTPP)           AC1769169;
{
 //?USER: Process Data record

 //?Run January 12,2006  per AMB,PKD
 //?Recalc Fob Gross  = Fob Gross + SBD Accrual Amount
 //?Recalc Trade Fund = Trade fund - SBD Accrual Amount
 CASE;

 // IF DB1.SBD Accrual Amount is NE Zero
 IF DB1.NonLedgrd_TrdFnd_Acrl_Amt <> *ZERO;

 // WRK.FOB Gross Amount = DB1.FOB Gross Amount + DB1.NonLedgrd TrdFnd Acrl Amt
 WRK.FOB_Gross_Amount = DB1.FOB_Gross_Amount + DB1.NonLedgrd_TrdFnd_Acrl_Amt;

 // WRK.Ledgrd Trd Fund Accrl Amt = DB1.Ledgrd Trd Fund Accrl Amt - DB1.NonLedgrd TrdFnd Acrl Amt
 WRK.Ledgrd_Trd_Fund_Accrl_Amt = DB1.Ledgrd_Trd_Fund_Accrl_Amt
 - DB1.NonLedgrd_TrdFnd_Acrl_Amt;

 EXECUTE FUNCTION(CHG FOB & Trade fund  CH) TYPE(CHGOBJ) FILE(OMHSTPP)           AC1769171;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(WRK.FOB_Gross_Amount);
 PARAMETER(WRK.Ledgrd_Trd_Fund_Accrl_Amt);
 {
  //?USER: Processing after Data read

  // DB1.Data Mart Process Sts = CND.no
  DB1.Data_Mart_Process_Sts = 'N';

  // DB1.Process Sts for 3C = CND.No
  DB1.Process_Sts_for_3C = 'N';

 }

 ENDIF;

 EXECUTE FUNCTION(Rtv Accrl for SlsHst   RT) TYPE(RTVOBJ) FILE(OMHRCPP)          AC1611586;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(1);
 PARAMETER(LCL.Total_Amount);
 {
  //?USER: Initialize routine

  // PAR.Total Amount = CON.*ZERO
  PAR.Total_Amount = *ZERO;

  //?USER: Process Data record

  //?11/13/03 Accum Trade Fund Accruals only ...   PK0519
  //?01/12/06 Dont include SBD Accrual Code
  //?06/14/07 DLY029 - Include Ledger Accr=Y and Affect Sales Realz=Y
  CASE;

  // IF DB1.SH Expense Bucket is Ledgered Accrual
  IF DB1.SH_Expense_Bucket = 'LEDGER';

  // PAR.Total Amount = PAR.Total Amount + DB1.Extended Amount
  PAR.Total_Amount = PAR.Total_Amount + DB1.Extended_Amount;

  ENDIF;

 }

}


