// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBPFXFR
// ?Date: 14.08.2025 Time: 03:48:50
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// PAR.D-EDI INV PROC FLAG = CND.*Yes
PAR.D_EDI_INV_PROC_FLAG = 'Y';

//?Retrieve the flag that tells us if 855 is required before invoicing
//?for this AR Customer.
EXECUTE FUNCTION(RTV BT Intrchg all Fi RT) TYPE(RTVOBJ) FILE(PNGQREP)           AC2085449;
PARAMETER(PAR.AR_Customer_Number);
PARAMETER('POACK');
PARAMETER(NLL.EDI_Trading_Partner_No);
PARAMETER(NLL.EDI_File_Set);
PARAMETER(NLL.EDI_unused_text_10);
PARAMETER(NLL.EDI_unused_text_15);
PARAMETER(NLL.EDI_unused_text_14);
PARAMETER(NLL.EDI_Alt_ST_Cust_Number);
PARAMETER(NLL.EDI_unused_nbr_15);
PARAMETER(NLL.EDI_PO_ACK_Required);
PARAMETER(LCL.EDI_BTI_Req_Pre_Invoice);
PARAMETER(LCL.EDI_BTI_GTIN_Required);
PARAMETER(NLL.Record_Selected_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PAR.EDI PO ACK Required = CND.No
 PAR.EDI_PO_ACK_Required = 'N';

 // PAR.Record Selected       USR = CND.no
 PAR.Record_Selected_USR = 'N';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PAR.Record Selected       USR = CND.yes
 PAR.Record_Selected_USR = 'Y';

}


//?Check if the 855 is required before we invoice.
CASE;

// IF LCL.EDI BTI Req Pre Invoice is Yes
IF LCL.EDI_BTI_Req_Pre_Invoice = 'Y';

//?Validate if an 855 was sent successfully via EDI.
EXECUTE FUNCTION(Rtv EDI INV PROC FLAG RT) TYPE(RTVOBJ) FILE(ECP032)            AC2099167;
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.D_EDI_INV_PROC_FLAG);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF LCL.EDI BTI GTIN Required is Yes
IF LCL.EDI_BTI_GTIN_Required = 'Y';

EXECUTE FUNCTION(Val EDI 855/865 GTIN  RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC2099797;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.GTIN_Error_Sts_USR);
PARAMETER(PAR.GTIN_Error_Item_Code_USR);
{
 //?USER: Initialize routine

 // PAR.GTIN Error Sts USR = CND.No Error
 PAR.GTIN_Error_Sts_USR = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(Rtv GTIN              RT) TYPE(RTVOBJ) FILE(PBBTREP)           AC2099107;
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.IDE_GTIN);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.IDE GTIN is Blank
 IF LCL.IDE_GTIN = *BLANK;

 // PAR.GTIN Error Sts USR = CND.Error
 PAR.GTIN_Error_Sts_USR = 'E';

 // PAR.GTIN Error Item Code USR = DB1.Item Code
 PAR.GTIN_Error_Item_Code_USR = DB1.Item_Code;

 QUIT;

 ENDIF;

}


ENDIF;

ENDIF;

