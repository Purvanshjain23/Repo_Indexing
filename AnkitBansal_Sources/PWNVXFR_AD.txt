// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWNVXFR
// ?Date: 14.08.2025 Time: 02:57:08
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Payment Processing RT) TYPE(RTVOBJ) FILE(PKC4REP)          AB1147409;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(NLL.Pmt_Current_Payment_Date);
PARAMETER(NLL.Pmt_Current_Payment_Step);
PARAMETER(NLL.PP_Commission_Paym_Error);
PARAMETER(NLL.PP_Payment_Error);
PARAMETER(NLL.PP_Unused_Nbr_1);
PARAMETER(LCL.PP_Repayment_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If in Repayment Mode, check Tattoo
CASE;

// IF LCL.PP Repayment Status is Yes
IF LCL.PP_Repayment_Status = 'Y';

EXECUTE FUNCTION(Chk Repay in Progress RT) TYPE(RTVOBJ) FILE(PWAXCPP)           AB1369817;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(PAR.TRD_Repayment_Status);
PARAMETER(PAR.Repayment_in_Progress_Y_N);
{
 //?USER: Initialize routine

 //?Default to No
 // PAR.Repayment in Progress Y/N = CND.No
 PAR.Repayment_in_Progress_Y_N = 'N';

 //?Default to blanks
 // PAR.TRD Repayment Status = LCL.TRD Repayment Status
 PAR.TRD_Repayment_Status = LCL.TRD_Repayment_Status;

 //?USER: Process Data record

 EXECUTE FUNCTION(Rtv Tattoo Repay Hdr  RT) TYPE(RTVOBJ) FILE(PWAWCPP)           AB1367208;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.TRH_Repayment_ID);
 PARAMETER(LCL.TRH_Repayment_Status);
 PARAMETER(NLL.TRH_Date_Start);
 PARAMETER(NLL.TRH_Time_Start);
 PARAMETER(NLL.TRH_Date_Complete);
 PARAMETER(NLL.TRH_Time_Complete);
 PARAMETER(NLL.TRH_Payment_Date);
 PARAMETER(NLL.TRH_Payment_Step);
 PARAMETER(NLL.TRH_Backup_File_Prefix);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?If TRH Repayment Status is In Progress, check TRD Repayment Status
 CASE;

 // IF LCL.TRH Repayment Status is In Progress
 IF LCL.TRH_Repayment_Status = 'I';

 // PAR.TRD Repayment Status = DB1.TRD Repayment Status
 PAR.TRD_Repayment_Status = DB1.TRD_Repayment_Status;

 //?If Tattoo record is valid for a Transfer
 CASE;

 // IF DB1.TRD Repayment Status is Valid for Transfer
 IF DB1.TRD_Repayment_Status = 'E'/'P'/'Q'/'X'/'I'/'U'/'D';

 // PAR.Repayment in Progress Y/N = CND.Yes
 PAR.Repayment_in_Progress_Y_N = 'Y';

 ENDIF;

 ENDIF;

}


//?If in Repayment Mode, check Tattoo
// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Repayment in Progress Y/N = CND.No
PAR.Repayment_in_Progress_Y_N = 'N';

ENDIF;

