      *****************  RPG PROGRAM HEADING  ************************
      *
      * SYSTEM:      Hog Production System
      * PROGRAM:     HP3049
      * TITLE:       Build Workfile: Crt PLCICPP from HSP068DL
      * PROGRAMMER:  Susan Blakey
      * CREATED:     02/02/16
      *
      * FUNCTION:  Batch program to build workfile WF Klled/Dead Hogs
      *            from HSP068 to HPEDEVGEN - PLCICPP
      *
      ****************************************************************
      * MODIFICATIONS:
      ****************************************************************
      * DATE
      *
      ****************************************************************
      * FILE SPECIFICATIONS
      ****************************************************************
     Fhsl068m   if   e           k disk
      *    Killed/dead hogs by business office, and dead date.
      *
     Fplcicpl2  if a e           k disk
      *    Wf to report CF Killed/Dead Hogs (HPEDEVGEN)
      *    only specified here to get the flds to pass to another
      *    program that will create the record for this file
      *
     Fhsl034d   If   E           K disk
      *    Hog group
      *
      *
     FHSP018    IF   E           K DISK
      *    FARM SITE
      *
      * End of File Specifications
      ****************************************************************
      * Declared stand-alone variables
      ****************************************************************
     D  P0RTN          S              7
     D  xxreturn       S              7
      ****************************************************************
      * DEFINITION SPECIFICATIONS
      ****************************************************************
      *
      ****************************************************************
      * CONSTANTS
      ****************************************************************
      *
      *
      ****************************************************************
      * STANDALONE FIELDS
      ****************************************************************
      *
      * Control fields
      *
      ****************************************************************
      * FILE: plcicpp sequence number
      ****************************************************************
     D ZIXXA1          s                   like(CIXXA1)                         WFS Killed/Dead Hogs
      ****************************************************************
      * input parms
      ****************************************************************
      *
     D ibuso           s              5
     D icono           s              3  0
     D iyear4          s              4  0
     D iyearwk         s              2  0
      *
     D xxbuso          s                   like(ibuso)
     D xxcono          s                   like(icono)
     D xxYEAR4         s                   like(iyear4)
     D xxYEARWK        s                   like(iyearwk)
      ****************************************************************
      * MAINLINE
      ****************************************************************
      * Entry parameters
      * Input the Business Office and the Year like 2016
      * and the week like 49.
      *
      ****************************************************************
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C                   PARM                    ibuso
     C                   PARM                    iyear4
     C                   PARM                    iyearwk
     C                   PARM                    wkbeging          8 0
     C                   PARM                    wkending          8 0
      *
     C                   z-add     *ZERO         ZIXXA1                         WFS Week Ending
      *
      * Use company Guymon so we can get general files using company 360
      * all of the data that we will be using for CF WILL use company 360
      * for other standard files - this one is the calendar.
      *
     C                   MOVE      '360'         icono
      *
      * calculate the from date and the to date based on the first day of the
      * week and the 7th day of the week for the ending date.
      * Pass in Business Office and then byh Date - From and to Date
      * EQUAL TO business office and the date is within
      *
      * Setup key
     C                   Z-ADD     icono         xxcono                         Company number
     C                   Z-ADD     iyear4        xxyear4                        HPS Calendar Ye
     C                   Z-ADD     iyearwk       xxyearwk                       HPS Calendar We
     C                   Z-ADD     wkbeging      bccyymmdd         8 0          Pass Out WK Beg
     C                   Z-ADD     wkending      eccyymmdd         8 0          Pass Out WK End
      *
      * EQUAL TO business office and the date is within
      * Begin Week Date and the Ending Week Date
     C     KRSSA         KLIST
     C                   KFLD                    kdfsbo                          Business Office
     C                   KFLD                    kdkddt                          dead date
      * Setup key
     C                   movel     ibuso         kdfsbo                         Business Office
     C                   Z-ADD     bccyymmdd     kdkddt                          dead date
      *
      *
      *
      * Read the detail information from HSl068m
      * Select on Business Office and then by range of Beg Week and End Week.
      *
     C     KRSSA         setll     hsl068m
      *
     C                   dou       *in90 = *on                                  Main do
     C                   read      hsl068m                                90
     C                   if        *in90 = *off                                 If not EOF
      *     Select on business office and beg range and ending range dates
     C                   if        ibuso  =  kdfsbo                             Business Off
     C                   if        kdkddt   >=  bccyymmdd                       Range of dates
     C                   if        kdkddt   <=  eccyymmdd                       Range of dates
      *
     C                   exsr      $bldwrk

     C                   endif
     C                   endif                                                  If not EOF
     C                   endif
      *
     C                   endif
      *
     C                   enddo                                                  Main do
      *
      * EOF processing
      *
     C                   seton                                        lr
      *---------------------------------------------------------------
      *  Read HSL034 to get the group information
      *  Read HSP018 to get the site and the farm reference information
      *---------------------------------------------------------------
      *
     C     $bldwrk       begsr
      *
     C     KDHGSN        chain(n)  hsl034d                            92
     C                   if        *in92 = *off                                 If already exists
     C                   movel     HGHGCD        CIRVCD                         Group number
     C                   else
     C                   movel     *blanks       CIRVCD                         WFS Site Number
     C
     C                   endif
      *
     C     KDFSCD        CHAIN(N)  HSP018                             92
     C                   if        *in92 = *off                                 If already exists
     C                   movel     FSMTECHREF    CIBST1                         WFS Site Number
     C                   else                                                   get the mtechref no
     C                   movel     *blanks       CIBST1                         WFS Site Number
     C                   endif
      *
     C*** move each individaul fld frm HSP068
      *
     C
     C     ZIXXA1        ADD       1             ZIXXA1                         sequence
     C
     C                   Z-ADD     ZIXXA1        CIXXA1                         sequence
     C                   move      *blanks       CIBTT1                         WFS Barn
     C                   movel     eccyymmdd     CIBUT1                         WFS Transaction Date
     C                   z-add     kdkdhd        CIXZA1                         WFS Head Quantity
     C                   move      kddrcd        CIBQT1                         WFS Reason
     C                   move      *blanks       CIBRT1                         WFS Ref Number
     C                   z-add     kdkddt        CIHJDT                         WFS Call Date
     C                   z-add     *zeros        CIB3TM                         WFS Call Time
     C                   movel     ibuso         CIBVT1                         WFS Business Office
     C                   z-add     kdhgsn        CIX1A1                         WFS System hog Group
     C                   z-add     iyear4        CIBYT1                         WFS Year
     C                   z-add     iyearwk       CIX2A1                         WFS Week
     C                   z-add     bccyymmdd     CIHKDT                         WFS Week Beginning
     C                   z-add     eccyymmdd     CIBYT1                         WFS Week Ending
      *
     C                   write     @CICPVT
      *
     C                   endsr
      *---------------------------------------------------------------
      *  end
      *---------------------------------------------------------------
