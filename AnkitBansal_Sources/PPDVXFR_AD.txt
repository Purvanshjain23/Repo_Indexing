// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPDVXFR
// ?Date: 14.08.2025 Time: 03:40:02
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?input last job year
EXECUTE FUNCTION(FIX Last YTD # Ords..  RT) TYPE(RTVOBJ) FILE(ARBCREP)          AC1684423;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.*Job_year);
{
 //?USER: Process Data record

 // LCL.From Date             USR = CON.1030101
 LCL.From_Date_USR = 1030101;

 // LCL.To Date               USR = CON.1031231
 LCL.To_Date_USR = 1031231;

 //?Sales history is by Item Detail. this will give you inaccurate
 //?results.
 EXECUTE FUNCTION(RTV Fix AR Summ #ords RT) TYPE(RTVOBJ) FILE(OMHSTPP)           AC1684424;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(LCL.From_Date_USR);
 PARAMETER(LCL.To_Date_USR);
 PARAMETER(LCL.Last_YTD_Nbr_of_Orders);
 {
  //?USER: Initialize routine

  // PAR.Last YTD Nbr of Orders = CON.*ZERO
  PAR.Last_YTD_Nbr_of_Orders = *ZERO;

  // WRK.USR From Date = PAR.Actual Shipped Date
  WRK.USR_From_Date = PAR.Actual_Shipped_Date;

  //?USER: Process Data record

  //?Edit for date range and continue if valid
  CASE;

  // IF DB1.Actual Shipped Date GE WRK.USR From Date
  IF DB1.Actual_Shipped_Date >= WRK.USR_From_Date;

  // AND DB1.Actual Shipped Date LE PAR.USR To Date
  AND DB1.Actual_Shipped_Date <= PAR.USR_To_Date;

  CASE;

  // IF DB1.Affect Sales Doll Status is yes
  IF DB1.Affect_Sales_Doll_Status = 'Y';

  // AND DB1.Order Type - Sales is Regular Order
  AND DB1.Order_Type_Sales = 'OR';

  // PAR.Last YTD Nbr of Orders = PAR.Last YTD Nbr of Orders + CON.1
  PAR.Last_YTD_Nbr_of_Orders = PAR.Last_YTD_Nbr_of_Orders + 1;

  ENDIF;

  ENDIF;

 }

 EXECUTE FUNCTION(CHG A/R Last YTD Ords  CH) TYPE(CHGOBJ) FILE(ARBCREP)          AC1684425;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(LCL.Last_YTD_Nbr_of_Orders);
}


