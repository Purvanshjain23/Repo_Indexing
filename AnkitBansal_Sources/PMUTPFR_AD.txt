// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMUTPFR
// ?Date: 14.08.2025 Time: 12:05:46
// ?------------------------------------------------------------------------------------------------

//?USER: Record selection processing

// PGM.*Record selected = CND.*YES
PGM.*Record_selected = 'Y';

//?also all of the header status of a without check actual ship date
//?dont for get billing
CASE;

// IF DB1.Header Status is Complete
IF DB1.Header_Status = 'C';

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

// IF DB1.Header Status is Cancelled
IF DB1.Header_Status = 'X';

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

// IF DB1.OH TF Exempt Code is Pre-Commencement
IF DB1.OH_TF_Exempt_Code = 'PC';

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

// LCL.Error Ordtl TFExp Usr = CND.*blanks
LCL.Error_Ordtl_TFExp_Usr = *BLANK;

CASE;

// IF PGM.*Record selected is *YES
IF PGM.*Record_selected = 'Y';

EXECUTE FUNCTION(Vry OrdDtl Exempt to Hdr) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1882287;
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.Order_Number);
PARAMETER(LCL.Ord_TF_Exempt_Code);
PARAMETER(DB1.OH_TF_Exempt_Code);
PARAMETER(LCL.Error_Ordtl_TFExp_Usr);
{
 //?USER: Initialize routine

 // PAR.Error Ordtl TFExp Usr = CND.*blanks
 PAR.Error_Ordtl_TFExp_Usr = *BLANK;

 //?USER: Process Data record

 // PAR.Ord TF Exempt Code = DB1.Ord TF Exempt Code
 PAR.Ord_TF_Exempt_Code = DB1.Ord_TF_Exempt_Code;

 CASE;

 // IF DB1.Ord TF Exempt Code EQ PAR.OH TF Exempt Code
 IF DB1.Ord_TF_Exempt_Code = PAR.OH_TF_Exempt_Code;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Error Ordtl TFExp Usr = CND.Error
 PAR.Error_Ordtl_TFExp_Usr = 'E';

 QUIT;

 ENDIF;

}


CASE;

// IF LCL.Error Ordtl TFExp Usr is Error
IF LCL.Error_Ordtl_TFExp_Usr = 'E';

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: Print required level headings

CASE;

IF NEW Company_Number;
// SUPPRESSED PRINT Company Number header format

ENDIF;

//?USER: On print of detail format

CASE;

// IF PGM.*Record selected is *NO
IF PGM.*Record_selected = 'N';

// PGM.*Print format = CND.Do not print format
PGM.*Print_format = 'N';

QUIT;

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Rtv Cust Tf Exempt    XF.
CALL PROGRAM(Rtv Cust Tf Exempt    XF) ('PPSMXFR');
PARAMETER(CUR.Ship_To_Customer);
PARAMETER(LCL.Customer_TF_Exempt_Code);

// PGM.*Print format = CND.Print format
PGM.*Print_format = 'Y';

ENDIF;

//?PRTOBJ calls after print of detail format

//?Embedded PRTOBJ : PRT ORDDTL TFEXEMPTRevPO
CASE;

// IF PGM.*Record selected is *NO
IF PGM.*Record_selected = 'N';

QUIT;

ENDIF;

EXECUTE FUNCTION(PRT ORDDTL TFEXEMPTRevPO) TYPE(PRTOBJ);
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER(CUR.OH_TF_Exempt_Code);
PARAMETER(CUR.Customer_TF_Exempt_Code);
{
 //?USER: Initialize routine

 // PAR.Error Ordtl TFExp Usr = CND.*blanks
 PAR.Error_Ordtl_TFExp_Usr = *BLANK;

 //?USER: Process Data record

 // PAR.Ord TF Exempt Code = DB1.Ord TF Exempt Code
 PAR.Ord_TF_Exempt_Code = DB1.Ord_TF_Exempt_Code;

 CASE;

 // IF DB1.Ord TF Exempt Code EQ PAR.OH TF Exempt Code
 IF DB1.Ord_TF_Exempt_Code = PAR.OH_TF_Exempt_Code;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Error Ordtl TFExp Usr = CND.Error
 PAR.Error_Ordtl_TFExp_Usr = 'E';

 QUIT;

 ENDIF;

}


//?USER: Print required level totals

// SUPPRESSED PRINT Company Number totals format

