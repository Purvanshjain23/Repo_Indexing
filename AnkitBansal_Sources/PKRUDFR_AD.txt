// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKRUDFR
// ?Date: 14.08.2025 Time: 02:50:20
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?H16853 ISE 11/02/20 - Increased the Buy Order Number field
//?                      length from 5 to 7.
ENDDO;

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Initialize subfile control

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(CTL.Producer_Name_DRV);
PARAMETER(CTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?USER: Initialize subfile record from DBF record

// RCD.Condition Name USR = Condition name of RCD.TH Payment Sts
RCD.Condition_Name_USR = RTVCND(RCD.TH_Payment_Sts);

EXECUTE FUNCTION(Rtv Hog Class Desc    RT) TYPE(RTVOBJ) FILE(PKA8REP)           AB1127790;
PARAMETER(RCD.HC_Class_Code);
PARAMETER(RCD.HC_Description);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.HC_Description = WRK.Blank_USR;

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// RCD.Base Carc /Lv CWT USR = RCD.TH CM Crc Val Live /CWT
RCD.Base_Carc_Lv_CWT_USR = RCD.TH_CM_Crc_Val_Live_CWT;

// RCD.Total Carc /CWT USR = DB1.TH CM Gross Live /CWT
RCD.Total_Carc_CWT_USR = DB1.TH_CM_Gross_Live_CWT;

//?Additional Cost and Gross Amount
DO;

//?Accruals
//?If the accruals are not zero then there is add
//?Additional cost.
// RCD.Addt Cst Ttl Usr = DB1.TH Accrual Amount
RCD.Addt_Cst_Ttl_Usr = DB1.TH_Accrual_Amount;

CASE;

// IF DB1.TH Freight Amount is Not Zeros
IF DB1.TH_Freight_Amount <> *ZERO;

EXECUTE FUNCTION(Rtv Exp Paid By Who) TYPE(RTVOBJ) FILE(PKAXCPP)                AB1193261;
PARAMETER(DB1.BOH_Company_Number);
PARAMETER(DB1.BOH_Buy_Order_Number);
PARAMETER(DB1.BOL_Load_Number);
PARAMETER(WRK.BOL_Freight_Exp_Paid_By);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If Seaboard then add freight
CASE;

// IF WRK.BOL Freight Exp Paid By is Seaboard
IF WRK.BOL_Freight_Exp_Paid_By = 'S';

// RCD.Addt Cst Ttl Usr = RCD.Addt Cst Ttl Usr + DB1.TH Freight Amount
RCD.Addt_Cst_Ttl_Usr = RCD.Addt_Cst_Ttl_Usr + DB1.TH_Freight_Amount;

ENDIF;

ENDIF;

//?Gross
// RCD.Payment Total Usr = DB1.TH Payment Gross
RCD.Payment_Total_Usr = DB1.TH_Payment_Gross;

// RCD.Payment Total Usr = RCD.Payment Total Usr + RCD.Addt Cst Ttl Usr
RCD.Payment_Total_Usr = RCD.Payment_Total_Usr + RCD.Addt_Cst_Ttl_Usr;

ENDDO;

//?Calc Live Avgs AVG BASE MKT, AVG LN PR/DED, YIELD GAIN, VAR
CASE;

// IF DB1.TH Live Wgt NE WRK.Zero USR
IF DB1.TH_Live_Wgt <> WRK.Zero_USR;

// Additional Cost Live
RCD.Addt_Ttl_Cst_Live_Cwt_Usr = RCD.Addt_Cst_Ttl_Usr / ( DB1.TH_Live_Wgt / 100 );

// TH GROSS AMOUNT
RCD.Tot_Cost_Live_CWT_Usr = RCD.Payment_Total_Usr / ( DB1.TH_Live_Wgt / 100 );

//?Calc Live Avgs AVG BASE MKT, AVG LN PR/DED, YIELD GAIN, VAR
// IF *OTHERWISE
IF *OTHERWISE;

// RCD.Addt Ttl Cst Live Cwt Usr = WRK.Zero USR
RCD.Addt_Ttl_Cst_Live_Cwt_Usr = WRK.Zero_USR;

// RCD.Tot Cost Live CWT Usr = WRK.Zero USR
RCD.Tot_Cost_Live_CWT_Usr = WRK.Zero_USR;

ENDIF;

//?USER: Process subfile record (Pre-confirm)

CASE;

// IF RCD.*SFLSEL is *Work With/Display
IF RCD.*SFLSEL = '5';

// Call program Dsp Carcass Detail    DF.
CALL PROGRAM(Dsp Carcass Detail    DF) ('PKD2DFR');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER(RCD.TH_Purchase_Date);
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);

// IF RCD.*SFLSEL is *Option 7 request
IF RCD.*SFLSEL = '7'/'7';

// Call program Edt Tattoo Comment    EF.
CALL PROGRAM(Edt Tattoo Comment    EF) ('PKIVEFR');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER('U');
PARAMETER(PAR.Oms_System_Value_Alpha);

ENDIF;

