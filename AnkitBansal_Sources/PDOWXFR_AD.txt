// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDOWXFR
// ?Date: 14.08.2025 Time: 03:32:37
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Val for Stop Resequenc RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1425060;
PARAMETER(PAR.Load_ID);
PARAMETER(*ZERO);
PARAMETER(PAR.Error_Status);
PARAMETER(PAR.Error_Status_2);
{
 //?USER: Initialize routine

 // PAR.First Time Flag = CND.Yes
 PAR.First_Time_Flag = 'Y';

 //?Error Status used for customer errors
 // PAR.Error Status = CND.no
 PAR.Error_Status = 'N';

 //?Error Status 2  used for delivery date errors
 // PAR.Error Status  2 = CND.No
 PAR.Error_Status_2 = 'N';

 //?USER: Process Data record

 //?First time processing
 CASE;

 // IF WRK.First Time Flag is Yes
 IF WRK.First_Time_Flag = 'Y';

 // PAR.First Time Flag = CND.NO
 PAR.First_Time_Flag = 'N';

 // PAR.USR Stop/Drop = DB1.Stop/Drop
 PAR.USR_Stop_Drop = DB1.Stop_Drop;

 EXECUTE FUNCTION(RTV Cust,Delivery Date RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1424736;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(PAR.Ship_To_Customer);
 PARAMETER(WRK.Ship_To_Name);
 PARAMETER(PAR.Requested_Delivery_Date);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

 CASE;

 // IF PAR.USR Stop/Drop EQ DB1.Stop/Drop
 IF PAR.USR_Stop_Drop = DB1.Stop_Drop;

 EXECUTE FUNCTION(RTV Cust,Delivery Date RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1424736;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(WRK.Ship_To_Customer);
 PARAMETER(WRK.Ship_To_Name);
 PARAMETER(WRK.Requested_Delivery_Date);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?One Customer per Stop
 CASE;

 // IF WRK.Ship To Customer NE PAR.Ship To Customer
 IF WRK.Ship_To_Customer <> PAR.Ship_To_Customer;

 // PAR.Error Status = CND.yes
 PAR.Error_Status = 'Y';

 ENDIF;

 //?Prior stop
 // WRK.Stop/Drop = DB1.Stop/Drop - CON.1
 WRK.Stop_Drop = DB1.Stop_Drop - 1;

 //?Validate Prior Stop Delivery Date
 CASE;

 // IF WRK.Stop/Drop is EQ Zero
 IF WRK.Stop_Drop = *ZERO;

 //?Validate Prior Stop Delivery Date
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Hi DelDt Prior StopRT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1424906;
 PARAMETER(DB1.Load_ID);
 PARAMETER(WRK.Stop_Drop);
 PARAMETER(WRK.Requested_Delivery_Date);
 {
  //?USER: Initialize routine

  // PAR.Scheduled Delivery Date = CON.*ZERO
  PAR.Requested_Delivery_Date = *ZERO;

  // PAR.First Time Flag = CND.Yes
  PAR.First_Time_Flag = 'Y';

  //?USER: Process Data record

  CASE;

  // IF PAR.First Time Flag is Yes
  IF PAR.First_Time_Flag = 'Y';

  // PAR.First Time Flag = CND.NO
  PAR.First_Time_Flag = 'N';

  // PAR.USR Stop/Drop = DB1.Stop/Drop
  PAR.USR_Stop_Drop = DB1.Stop_Drop;

  ENDIF;

  CASE;

  // IF DB1.Stop/Drop EQ PAR.USR Stop/Drop
  IF DB1.Stop_Drop = PAR.USR_Stop_Drop;

  EXECUTE FUNCTION(Rtv Delivery Date     RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1409517;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(WRK.USR_Sched_Delivery_Date);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF WRK.USR Sched Delivery Date GT PAR.Scheduled Delivery Date
  IF WRK.USR_Sched_Delivery_Date > PAR.Requested_Delivery_Date;

  // PAR.Scheduled Delivery Date = WRK.USR Sched Delivery Date
  PAR.Requested_Delivery_Date = WRK.USR_Sched_Delivery_Date;

  ENDIF;

  // IF *OTHERWISE
  IF *OTHERWISE;

  QUIT;

  ENDIF;

 }

 //?Prior stop out of sequence
 CASE;

 // IF WRK.Scheduled Delivery Date GT PAR.Scheduled Delivery Date
 IF WRK.Requested_Delivery_Date > PAR.Requested_Delivery_Date;

 // AND WRK.Scheduled Delivery Date NE WRK.ZERO
 AND WRK.Requested_Delivery_Date <> WRK.ZERO;

 // PAR.Error Status  2 = CND.Yes
 PAR.Error_Status_2 = 'Y';

 ENDIF;

 ENDIF;

 //?Get delivery date for next stop
 // WRK.Stop/Drop = DB1.Stop/Drop + CON.1
 WRK.Stop_Drop = DB1.Stop_Drop + 1;

 //?Validate Next Stop Delivery Date
 CASE;

 // IF WRK.Stop/Drop is EQ Zero
 IF WRK.Stop_Drop = *ZERO;

 //?Validate Next Stop Delivery Date
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Lo DelDt Next Stop RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1424920;
 PARAMETER(DB1.Load_ID);
 PARAMETER(WRK.Stop_Drop);
 PARAMETER(WRK.Requested_Delivery_Date);
 {
  //?USER: Initialize routine

  // PAR.Scheduled Delivery Date = CON.9999999
  PAR.Requested_Delivery_Date = 9999999;

  // PAR.First Time Flag = CND.Yes
  PAR.First_Time_Flag = 'Y';

  //?USER: Process Data record

  //?First time processing:  assumes that are past current stop
  CASE;

  // IF PAR.First Time Flag is Yes
  IF PAR.First_Time_Flag = 'Y';

  // PAR.First Time Flag = CND.NO
  PAR.First_Time_Flag = 'N';

  // PAR.USR Stop/Drop = DB1.Stop/Drop
  PAR.USR_Stop_Drop = DB1.Stop_Drop;

  ENDIF;

  CASE;

  // IF DB1.Stop/Drop EQ PAR.USR Stop/Drop
  IF DB1.Stop_Drop = PAR.USR_Stop_Drop;

  EXECUTE FUNCTION(Rtv Delivery Date     RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1409517;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(WRK.USR_Sched_Delivery_Date);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF WRK.USR Sched Delivery Date LT PAR.Scheduled Delivery Date
  IF WRK.USR_Sched_Delivery_Date < PAR.Requested_Delivery_Date;

  // PAR.Scheduled Delivery Date = WRK.USR Sched Delivery Date
  PAR.Requested_Delivery_Date = WRK.USR_Sched_Delivery_Date;

  ENDIF;

  // IF *OTHERWISE
  IF *OTHERWISE;

  QUIT;

  ENDIF;

 }

 //?Next stop out of sequence
 CASE;

 // IF WRK.Scheduled Delivery Date LT PAR.Scheduled Delivery Date
 IF WRK.Requested_Delivery_Date < PAR.Requested_Delivery_Date;

 // AND WRK.Scheduled Delivery Date NE WRK.ZERO
 AND WRK.Requested_Delivery_Date <> WRK.ZERO;

 // PAR.Error Status  2 = CND.Yes
 PAR.Error_Status_2 = 'Y';

 ENDIF;

 ENDIF;

 ENDIF;

}


