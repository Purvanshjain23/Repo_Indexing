// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMPIXFR
// ?Date: 14.08.2025 Time: 03:43:43
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?------------------------------------------------------------------
//?********** NOTE **********
//?1) If you run this program for Daily's, it needs to be
//?   changed to run by Company.  When you run it, make sure the
//?   library list has the appropriate (363-JRDATA; and 364-DFDATA)
//?   library in the library list.
//?------------------------------------------------------------------
//?11/19/09 PKD A change was made to not calculate the commission
//?             if the Affect Commission = N.  Apparently all of the
//?             Orders are created with Affect Commission = N.
//?             Recalculate the Accruals starting 11/12/09 for
//?             Sales Orders only (Billing Activity = 1).
//?08/03/09 Recalc PF accruals for ROYalty fees
//?11/13/07 Recalc commission and TF accrual for customer accruals that
//?  that have a blank commission/not commission sts
EXECUTE FUNCTION(RTV by inv dte f/fix  RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC1856138;
PARAMETER(1091112);
{
 //?USER: Initialize routine

 // WRK.Invoice Date = CON.1091112
 WRK.Invoice_Date = 1091112;

 // WRK.To Date               USR = CON.1091119
 WRK.To_Date_USR = 1091119;

 //?USER: Process Data record

 CASE;

 // IF DB1.Invoice Date GE WRK.Invoice Date
 IF DB1.Invoice_Date >= WRK.Invoice_Date;

 // AND DB1.Invoice Date LE WRK.To Date               USR
 AND DB1.Invoice_Date <= WRK.To_Date_USR;

 //?SEL: Billing Activity Type = 1
 CASE;

 // IF DB1.Billing Activity Type is Invoice
 IF DB1.Billing_Activity_Type = '1';

 // LCL.Status Flag 1  Y/N = CND.Yes
 LCL.Status_Flag_1_Y_N = 'Y';

 //?SEL: Billing Activity Type = 1
 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Status Flag 1  Y/N = CND.No
 LCL.Status_Flag_1_Y_N = 'N';

 ENDIF;

 CASE;

 // IF LCL.Status Flag 1  Y/N is Yes
 IF LCL.Status_Flag_1_Y_N = 'Y';

 EXECUTE FUNCTION(Rtv & Dlt for Recalc  RT) TYPE(RTVOBJ) FILE(OMHRCPP)           AC1858790;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Dlt OM Ship Dtl Accrl  DL) TYPE(DLTOBJ) FILE(OMHRCPP)          AC1595109;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Sequence_Number);
 }

 EXECUTE FUNCTION(RTV 1st Warehouse      RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1575817;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(1);
 PARAMETER(1);
 PARAMETER(LCL.Warehouse_Code);
 {
  //?USER: Process Data record

  // PAR.Warehouse Code = DB1.Warehouse Code
  PAR.Warehouse_Code = DB1.Warehouse_Code;

  QUIT;

 }

 EXECUTE FUNCTION(Rtv Acct Co          RT) TYPE(RTVOBJ) FILE(CAADREP)            AC1802492;
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER(LCL.Accounting_Company);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(Rtv & Dlt for Recalc RT) TYPE(RTVOBJ) FILE(PDICCPP)            AC1858791;
 PARAMETER(LCL.Accounting_Company);
 PARAMETER(DB1.Order_Number);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Del History Dtl Accrl DL) TYPE(DLTOBJ) FILE(PDICCPP)           AC1845951;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Sequence_Number);
 }

 // Call program UPD Auto Accruals      XF.
 CALL PROGRAM(UPD Auto Accruals      XF) ('PDT5XFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(DB1.Date_of_Original_Entry);
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Absorbed_Freight_Rate_CWT);
 PARAMETER(*MISSING);
 PARAMETER(DB1.Invoice_Date);
 PARAMETER(DB1.Billing_Activity_Type);

 // Call program Zzz Crt Hist Dtl Accr  XF.
 CALL PROGRAM(Zzz Crt Hist Dtl Accr  XF) ('PNK4XFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);

 // Call program Zzz Fix TF/CM/SB Amt  XF.
 CALL PROGRAM(Zzz Fix TF/CM/SB Amt  XF) ('PPF8XFR');
 PARAMETER(LCL.Accounting_Company);
 PARAMETER(DB1.Order_Number);

 ENDIF;

 ENDIF;

}


