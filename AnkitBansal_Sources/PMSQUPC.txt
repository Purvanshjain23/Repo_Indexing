/*********************************************************************/
/* PROGRAM    : PMSQUPC                                             */
/* TITLE      : EXECUTE THE ESNDMAIL CMD TO EMAIL MULTIPLE BOLS-HPB ONLY  */
/* DATE       : 03/04/2008                                           */
/* Description: EXECUTE THE ESNDNMAIL COMMAND, ADD AND REMOVE THE    */
/*                ESEND LIBRARY, MONITOR FOR ERRORS                  */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &EADDRESS   EMAIL ADDRESS TO SEND TO                     */
/*    I     &ESUBJECT   EMAIL SUBJECT                                */
/*    I     &EMESSAGE   MESSAGE TO SEND                              */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/* 4/22/08    RMC      USE DIFF PGM AND OVERLAY FOR EMAIL/FAX THAN PRINT */
/* 10/22/02   RMC      OVRPRTF TO HOLD(*YES)                           */
/* 06/10/09   RMC      NEW OVERLAY FOR NON-AGRI BIODIESEL  HPBBOLFN.  */
/*                     THE OVERLAY FOR AGRI BIODIESEL IS HPBBOLFX  */
/* 12/22/09   RMC      NEW OVERLAY FOR 369 -SO PASS IT IN       */
/* 07/06/16   RMC      CHG MONMSG EML0999 TO EML0030        */
/* 05/20/19   RMC  S15006 CHANGE WRKSPLFA TO CHKSPLF - THE OTHER WAS PRINTING */
/* RMC 7/18/19 T14912- HPB ONLY -- OVRPRTF FOR BOLS - CHG OFFSET TO .3 .3  */
/* 9/13/19 RMC  T15460 - ADD PARM FOR BACK OVERLAY FOR PMUCPFR$, ADD TO     */
/*                     OVRPRTF                                       */
/* 09/23/21 DN  DO2212 - Removed PMUCPFR Front Overlay Offset Down & */
/*                     Across (.3). Overlay is now maintain in       */
/*                     FormDocs tool.                                */
/*********************************************************************/

 PPSQUPC:    PGM        PARM(&RETURN &EADDRESS &ESUBJECT &EMESSAGE +
                    &JOBNAME &BLOVER &BKOVER)
/*-------------------------------------------------------------------*/
/* Declare Variables                                                 */
/*-------------------------------------------------------------------*/
             DCL        VAR(&RETURN)   TYPE(*CHAR) LEN(7)
             DCL        VAR(&EADDRESS) TYPE(*CHAR) LEN(50)
             DCL        VAR(&ESUBJECT) TYPE(*CHAR) LEN(60)
             DCL        VAR(&EMESSAGE) TYPE(*CHAR) LEN(256)
             DCL        VAR(&JOBNAME) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BLOVER) TYPE(*CHAR) LEN(8)  /* FX OVERLAY NME */
             DCL        VAR(&BKOVER) TYPE(*CHAR) LEN(8)  /* BACKOVERLAY NME */


/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)


/*-------------------------------------------------------------------*/
/* EXECUTE OVERRIDE PRINTFILES                                       */
/*-------------------------------------------------------------------*/
/* 7/18/19   OVRPRTF    FILE(PMUCPFR$) PAGESIZE(88 136) LPI(8) +
                          CPI(18) OVRFLW(88) FRONTOVL(&BLOVER 0.2 +
                          .2) HOLD(*YES) USRDTA(&JOBNAME)     */
/* DO2212 - Removed PMUCPFR Front Overlay Offset Down & Across (.3)  */
/* DO2212    OVRPRTF    FILE(PMUCPFR$) PAGESIZE(88 136) LPI(8) +
                          CPI(18) OVRFLW(88) DUPLEX(*YES) +
                          FRONTOVL(&BLOVER .3 .3) BACKOVL(&BKOVER 0 +
                          0 *CONSTANT) HOLD(*YES) USRDTA(&JOBNAME)   */
             OVRPRTF    FILE(PMUCPFR$) PAGESIZE(88 136) LPI(8) +
                          CPI(18) OVRFLW(88) DUPLEX(*YES) +
                          FRONTOVL(&BLOVER) BACKOVL(&BKOVER 0 0 +
                          *CONSTANT) HOLD(*YES) USRDTA(&JOBNAME)
             OVRPRTF    FILE(PMQBPFR$) PAGESIZE(88 136) LPI(8) +
                          CPI(18) OVRFLW(88) FRONTOVL(HPBBOLBY .2) +
                          HOLD(*YES) USRDTA(&JOBNAME)
/*-------------------------------------------------------------------*/
/* PRINT THE BOLS                                                    */
/*-------------------------------------------------------------------*/
 CALL PMSPXFR ('' &JOBNAME)
/*-------------------------------------------------------------------*/
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ADDLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF2103 CPF9999)
/* GOTO ENDPGM       */
   /*        WRKSPLFA   FILE(PMUCPFR$) SPLNBR(*LAST)              +
             MONMSG     MSGID(CPF3303) EXEC(GOTO CMDLBL(BYPROD))  */
             CHKSPLF    SPLF(PMUCPFR$) SPLNBR(*LAST)
             MONMSG     MSGID(TAA9883)  EXEC(GOTO CMDLBL(BYPROD))
 FGPROD:     ESNDMAIL   RECIPIENT(&EADDRESS) SUBJECT(&ESUBJECT) +
                           ATTLIST((* +
                          *PDF *N PMUCPFR$ * *ALL *ALL))
           MONMSG     MSGID(EML0999 CPF9999) EXEC(GOTO     +
                          CMDLBL(BYPROD))

BYPROD:
        /*   WRKSPLFA   FILE(PMQBPFR$) SPLNBR(*LAST)               +
             MONMSG     MSGID(CPF3303) EXEC(GOTO CMDLBL(DELETE))    */
             CHKSPLF    SPLF(PMQBPFR$) SPLNBR(*LAST)
             MONMSG     MSGID(TAA9883)  EXEC(GOTO CMDLBL(ENDPGM))
             MONMSG     MSGID(TAA9883)  EXEC(GOTO CMDLBL(DELETE))
             ESNDMAIL   RECIPIENT(&EADDRESS) SUBJECT(&ESUBJECT) +
                           ATTLIST((* +
                          *PDF *N PMQBPFR$ * *ALL *ALL)) IMAGEUOM(*IN)
             MONMSG     MSGID(EML9999 CPF9999) EXEC(GOTO +
                          CMDLBL(ENDPGM))
   /*                     CMDLBL(DELETE))   */

 DELETE:   DLTSPLF    FILE(*SELECT) SELECT(*CURRENT *ALL *ALL +
                          &JOBNAME)
 DELET2: /*  DLTSPLF    FILE(QPDSPSFA) SELECT(*CURRENT *ALL *ALL +
                          &JOBNAME)                                     */
             MONMSG     MSGID(CPF3309)

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ENDPGM))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     RMVLIBLE   LIB(ESEND)
             MONMSG     MSGID(CPF0000)

             ENDPGM
