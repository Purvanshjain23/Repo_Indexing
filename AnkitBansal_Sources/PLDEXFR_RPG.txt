     H/TITLE Exc Transfer Del WEB  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 02:38:36
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPLAECPL3IF  E           K        DISK
      * RSQ : Delivery Sched Detail     Movement #
      *
     FPKAXCPLEIF  E           K        DISK
      * RSQ : Buy Order Load            Co/Prd/Lc/KlD
      *
     FPKAWCPLBIF  E           K        DISK
      * RSQ : Buy Order Header          Co/Pdrc/Loc/Kill Dte
      *
     FPLAECPLBIF  E           K        DISK
      * RSQ : Delivery Sched Detail     Co/KDt/DDt/DTm/Sq-d
      *
     I@AECPJB
      * Delivery Sched Detail     Movement #
      * Renamed input format fields
     I              AEHONB                          WAHONB
     I              AEE0DT                          WAE0DT
     I              AEE6DT                          WAE6DT
     I              AEAGTH                          WAAGTH
     I              AEHZA1                          WAHZA1
     I              AEH0A1                          WAH0A1
     I              AEH1A1                          WAH1A1
     I              AEJ4CD                          WAJ4CD
     I              AEJ5CD                          WAJ5CD
     I              AELBCD                          WALBCD
     I              AELCCD                          WALCCD
     I              AEIOA1                          WAIOA1
     I              AEH2A1                          WAH2A1
     I              AEIJA1                          WAIJA1
     I              AEK9CD                          WAK9CD
     I              AEK8CD                          WAK8CD
     I              AEJ6CD                          WAJ6CD
     I              AEJ7CD                          WAJ7CD
     I              AEMGCD                          WAMGCD
     I              AEW1ST                          WAW1ST
     I              AEW2ST                          WAW2ST
     I              AEH3A1                          WAH3A1
     I              AEMECD                          WAMECD
     I              AEMFCD                          WAMFCD
     I              AEW4ST                          WAW4ST
     I              AEXWST                          WAXWST
     I              AEFRDT                          WAFRDT
     I              AEBOTH                          WABOTH
     I              AEE7DT                          WAE7DT
     I              AEAHTH                          WAAHTH
     I              AEE8DT                          WAE8DT
     I              AEAITH                          WAAITH
     I              AEXBST                          WAXBST
     I              AEXGST                          WAXGST
     I              AEXPST                          WAXPST
     I              AEXNST                          WAXNST
     I              AEXTST                          WAXTST
     I              AEXLST                          WAXLST
     I              AEW0ST                          WAW0ST
     I              AEYEST                          WAYEST
     I              AEFZDT                          WAFZDT
     I              AEB1TH                          WAB1TH
     I              AEAACD                          WAAACD
     I              AEABCD                          WAABCD
     I              AEAECD                          WAAECD
     I              AEHMNB                          WAHMNB
     I              AEBNNB                          WABNNB
     I              AEBONB                          WABONB
     I              AEY0A1                          WAY0A1
     I              AEY1A1                          WAY1A1
     I              AEDGT1                          WADGT1
     I              AEDHT1                          WADHT1
     I              AEIISS                          WAIISS
     I              AEAAVN                          WAAAVN
     I              AEAADT                          WAAADT
     I              AEAMTM                          WAAMTM
     I              AEAJST                          WAAJST
     I              AEAHVN                          WAAHVN
     I              AEAGVN                          WAAGVN
     I              AEABVN                          WAABVN
     I              AEABDT                          WAABDT
     I              AEABTM                          WAABTM
      *
     I@AXCPJ2
      * Buy Order Load            Co/Prd/Lc/KlD
      * Renamed input format fields
     I              AXHMNB                          WBHMNB
     I              AXBNNB                          WBBNNB
     I              AXBONB                          WBBONB
     I              AXCQDT                          WBCQDT
     I              AXABTH                          WBABTH
     I              AXACTH                          WBACTH
     I              AXBPNB                          WBBPNB
     I              AXCSNB                          WBCSNB
     I              AXAUDT                          WBAUDT
     I              AXCMST                          WBCMST
     I              AXAGPR                          WBAGPR
     I              AXATVA                          WBATVA
     I              AXI1ST                          WBI1ST
     I              AXDHNB                          WBDHNB
     I              AXDINB                          WBDINB
     I              AXCNST                          WBCNST
     I              AXGINB                          WBGINB
     I              AXBZDT                          WBBZDT
     I              AXLSNB                          WBLSNB
     I              AXF3TX                          WBF3TX
     I              AXO8ST                          WBO8ST
     I              AXO9ST                          WBO9ST
     I              AXPAST                          WBPAST
     I              AXLDSH                          WBLDSH
     I              AXPBST                          WBPBST
     I              AXPCST                          WBPCST
     I              AXPDST                          WBPDST
     I              AXUWST                          WBUWST
     I              AXUXST                          WBUXST
     I              AXUYST                          WBUYST
     I              AXJKRU                          WBJKRU
     I              AXKEOR                          WBKEOR
     I              AXIOEW                          WBIOEW
     I              AXKJIO                          WBKJIO
     I              AXIOJR                          WBIOJR
     I              AXEIRR                          WBEIRR
     I              AXITMF                          WBITMF
     I              AXODJE                          WBODJE
     I              AXRJIF                          WBRJIF
     I              AXOEJF                          WBOEJF
     I              AXD0DT                          WBD0DT
     I              AXD1DT                          WBD1DT
     I              AXD2DT                          WBD2DT
     I              AXD3DT                          WBD3DT
     I              AXD4DT                          WBD4DT
     I              AXBNCD                          WBBNCD
     I              AXABCD                          WBABCD
     I              AXAECD                          WBAECD
     I              AXAAVN                          WBAAVN
     I              AXAADT                          WBAADT
     I              AXAMTM                          WBAMTM
     I              AXAJST                          WBAJST
     I              AXAHVN                          WBAHVN
     I              AXAGVN                          WBAGVN
     I              AXABVN                          WBABVN
     I              AXABDT                          WBABDT
     I              AXABTM                          WBABTM
      *
     I@AWCPNB
      * Buy Order Header          Co/Pdrc/Loc/Kill Dte
      * Renamed input format fields
     I              AWHMNB                          WCHMNB
     I              AWBNNB                          WCBNNB
     I              AWARDT                          WCARDT
     I              AWASDT                          WCASDT
     I              AWA4ST                          WCA4ST
     I              AWA5ST                          WCA5ST
     I              AWAAPR                          WCAAPR
     I              AWA6ST                          WCA6ST
     I              AWA7ST                          WCA7ST
     I              AWB3ST                          WCB3ST
     I              AWALPR                          WCALPR
     I              AWETCD                          WCETCD
     I              AWEUCD                          WCEUCD
     I              AWJ5TX                          WCJ5TX
     I              AWD5DT                          WCD5DT
     I              AWD6DT                          WCD6DT
     I              AWD7DT                          WCD7DT
     I              AWD8DT                          WCD8DT
     I              AWD9DT                          WCD9DT
     I              AWJOEJ                          WCJOEJ
     I              AWKOFF                          WCKOFF
     I              AWKWPE                          WCKWPE
     I              AWIMBF                          WCIMBF
     I              AWOPTR                          WCOPTR
     I              AWOEJD                          WCOEJD
     I              AWIRMF                          WCIRMF
     I              AWJIRM                          WCJIRM
     I              AWJRKF                          WCJRKF
     I              AWKFIR                          WCKFIR
     I              AWUZST                          WCUZST
     I              AWU0ST                          WCU0ST
     I              AWU1ST                          WCU1ST
     I              AWU2ST                          WCU2ST
     I              AWU3ST                          WCU3ST
     I              AWHXNB                          WCHXNB
     I              AWGANB                          WCGANB
     I              AWGBNB                          WCGBNB
     I              AWABCD                          WCABCD
     I              AWAECD                          WCAECD
     I              AWAKCD                          WCAKCD
     I              AWALCD                          WCALCD
     I              AWAGCD                          WCAGCD
     I              AWAICD                          WCAICD
     I              AWAMCD                          WCAMCD
     I              AWACCD                          WCACCD
     I              AWAAVN                          WCAAVN
     I              AWAADT                          WCAADT
     I              AWAMTM                          WCAMTM
     I              AWAJST                          WCAJST
     I              AWAHVN                          WCAHVN
     I              AWAGVN                          WCAGVN
     I              AWABVN                          WCABVN
     I              AWABDT                          WCABDT
     I              AWABTM                          WCABTM
      *
     I@AECPJT
      * Delivery Sched Detail     Co/KDt/DDt/DTm/Sq-d
      * Renamed input format fields
     I              AEHONB                          WDHONB
     I              AEE0DT                          WDE0DT
     I              AEE6DT                          WDE6DT
     I              AEAGTH                          WDAGTH
     I              AEHZA1                          WDHZA1
     I              AEH0A1                          WDH0A1
     I              AEH1A1                          WDH1A1
     I              AEJ4CD                          WDJ4CD
     I              AEJ5CD                          WDJ5CD
     I              AELBCD                          WDLBCD
     I              AELCCD                          WDLCCD
     I              AEIOA1                          WDIOA1
     I              AEH2A1                          WDH2A1
     I              AEIJA1                          WDIJA1
     I              AEK9CD                          WDK9CD
     I              AEK8CD                          WDK8CD
     I              AEJ6CD                          WDJ6CD
     I              AEJ7CD                          WDJ7CD
     I              AEMGCD                          WDMGCD
     I              AEW1ST                          WDW1ST
     I              AEW2ST                          WDW2ST
     I              AEH3A1                          WDH3A1
     I              AEMECD                          WDMECD
     I              AEMFCD                          WDMFCD
     I              AEW4ST                          WDW4ST
     I              AEXWST                          WDXWST
     I              AEFRDT                          WDFRDT
     I              AEBOTH                          WDBOTH
     I              AEE7DT                          WDE7DT
     I              AEAHTH                          WDAHTH
     I              AEE8DT                          WDE8DT
     I              AEAITH                          WDAITH
     I              AEXBST                          WDXBST
     I              AEXGST                          WDXGST
     I              AEXPST                          WDXPST
     I              AEXNST                          WDXNST
     I              AEXTST                          WDXTST
     I              AEXLST                          WDXLST
     I              AEW0ST                          WDW0ST
     I              AEYEST                          WDYEST
     I              AEFZDT                          WDFZDT
     I              AEB1TH                          WDB1TH
     I              AEAACD                          WDAACD
     I              AEABCD                          WDABCD
     I              AEAECD                          WDAECD
     I              AEHMNB                          WDHMNB
     I              AEBNNB                          WDBNNB
     I              AEBONB                          WDBONB
     I              AEY0A1                          WDY0A1
     I              AEY1A1                          WDY1A1
     I              AEDGT1                          WDDGT1
     I              AEDHT1                          WDDHT1
     I              AEIISS                          WDIISS
     I              AEAAVN                          WDAAVN
     I              AEAADT                          WDAADT
     I              AEAMTM                          WDAMTM
     I              AEAJST                          WDAJST
     I              AEAHVN                          WDAHVN
     I              AEAGVN                          WDAGVN
     I              AEABVN                          WDABVN
     I              AEABDT                          WDABDT
     I              AEABTM                          WDABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Movement Alpha USR
     I                                        1   7 P1SVTX
     IP2PARM      DS
      * I :  Date Alpha USR
     I                                        1   7 P2CZCD
     IP3PARM      DS
      * I :  Date Alpha Usr 2
     I                                        1   7 P3DHCD
     IP4PARM      DS
      * I :  Time 4 Alpha USR
     I                                        1   4 P4SWTX
     IP5PARM      DS
      * N :  BOL HPS Movement Number
     I                                    P   1   40P5JKRU
     IP6PARM      DS
      * N :  Kill Date Usr
     I                                    P   1   40P6CGDT
     IP7PARM      DS
      * N :  Date To   USR
     I                                    P   1   40P7B4DT
     IP8PARM      DS
      * N :  Time USR
     I                                    P   1   30P8ADTH
     IP9PARM      DS
      * FLD: Buy Order Load
      * N :  BOH Company Number
     I                                    P   1   20P9HMNB
      * N :  BOH Buy Order Number
     I                                    P   3   60P9BNNB
      * N :  BOL Load Number
     I                                    P   7   90P9BONB
      * N :  BOL Kill Date
     I                                    P  10  130P9CQDT
      * N :  PD Producer Code
     I                                       14  19 P9ABCD
      * N :  PL Location Code
     I                                       20  25 P9AECD
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1SVTX    PARM           WP0001  7        Movement Alpha
     C           P2CZCD    PARM           WP0002  7        Date Alpha USR
     C           P3DHCD    PARM           WP0003  7        Date Alpha Usr
     C           P4SWTX    PARM           WP0004  4        Time 4 Alpha US
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Transfer Del WEB  XF
      * *** NOTE  *******************************************************
      * This function is wrapped into a procedure so it can be invoked fr
      * the WEB program. If parms are changed the proc. needs to be recre
      *  From a command line, type STRSQL, then enter the following:
      * CREATE PROCEDURE PRKPLIB/PLDEXFRP(OUT rtncde CHAR (7 ), IN
      * movmnt CHAR (7 ), IN killdt CHAR (7 ), IN delvdt CHAR (7 ), IN
      * delvtm CHAR (4 )) LANGUAGE RPG NOT DETERMINISTIC CONTAINS SQL
      * EXTERNAL NAME PRKPLIB/PLDEXFR PARAMETER STYLE GENERAL
      * *****************************************************************
      * MODIFICATIONS
      * 11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM
     C                     MOVE P1SVTX    P5JKRU           BOL HPS Movemen
      * CASE: PAR.Date Alpha USR is Entered
     C           P2CZCD    IFNE *BLANK                     *IF
     C                     MOVE P2CZCD    P6CGDT           Kill Date Usr
     C                     END                             *FI
      * CASE: PAR.Date Alpha Usr 2 is Entered
     C           P3DHCD    IFNE *BLANK                     *IF
     C                     MOVE P3DHCD    P7B4DT           Date To   USR
     C                     END                             *FI
      * CASE: PAR.Time 4 Alpha USR is Entered
     C           P4SWTX    IFNE *BLANK                     *IF
     C                     MOVE P4SWTX    P8ADTH           Time USR
     C                     END                             *FI
      * *****************************************************************
      * Called from the WEB to transfer a delivery to a new date &/or tim
      * *****************************************************************
      * RMC 11/16/05 get co for user
      * Rtv Co for User       XF - STR Order Management Sys  * 
     C                     CALL 'PLF8XFR'              90  Rtv Co for User
     C                     PARM *BLANK    W0RTN   7
     C           YL0001    PARM *ZERO     WQ0001  30       CC Company Numb
     C                     PARM 'HPE'     WQ0002  6        Oms Application
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLF8XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * *****
      * RTV BOL from Movement RT - Delivery Sched Detail  * 
     C                     EXSR SARVGN
      * CASE: PAR.BOH Buy Order Number is EQ Zero
     C           P9BNNB    IFEQ *ZERO                      *IF
     C                     GOTO AAEXIT                     *QUIT
     C                     END                             *FI
      * *****
      * Get last BO/Load Number used for new Kill Date
      * CASE:
      *  - c1ANDc2
      *   |- c1    : PAR.Kill Date Usr NE LCL.BOL Kill Date
      *   |- c2    : PAR.Kill Date Usr is Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P6CGDT    IFNE YL0002                     *IF
     C           P6CGDT    IFNE 0                          *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Rtv Last BOL f/prd,kl RT - Buy Order Load  * 
     C                     EXSR SBRVGN
      * Maybe header exists without any loads yet.
      * CASE: LCL.Buy Order New Usr is EQ Zero
     C           YL0007    IFEQ *ZERO                      *IF
      * Rtv BOH For Prdcr/Loc RT - Buy Order Header  * 
     C                     EXSR SCRVGN
      * CASE: LCL.Buy Order New Usr is EQ Zero
     C           YL0007    IFEQ *ZERO                      *IF
     C                     MOVEL'ERROR'   P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     END                             *FI
     C                     ADD  1         YL0008           Buy Order Load
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDP9BNNB    YL0007           Buy Order New U
     C                     Z-ADDP9BONB    YL0008           Buy Order Load
     C                     END                             *FI
      * *****
      * Do the Transfer if Kill &/or Delivery Date &/or time changed.
      * CASE:
      *  - c1ORc2ORc3
      *   |- c1    : PAR.Date To   USR NE LCL.DSD Delivery Date
      *   |- c2    : PAR.Time USR NE LCL.DSD Delivery Time
      *   |- c3    : PAR.Kill Date Usr NE LCL.BOL Kill Date
      *   '-
     C           P7B4DT    IFNE YL0003                     *IF
     C           P8ADTH    ORNE YL0004                     *OR
     C           P6CGDT    ORNE YL0002                     *OR
      * *****
     C                     Z-ADDP6CGDT    YL0009           Kill Date Usr
     C                     Z-ADDP7B4DT    YL0010           Date To   USR
     C                     Z-ADDP8ADTH    YL0011           Time USR
      * if new kill date not passed in, use DSD for the BOL
      * CASE: PAR.Kill Date Usr is Not Entered
     C           P6CGDT    IFEQ *ZERO                      *IF
     C                     Z-ADDYL0002    YL0009           Kill Date Usr
     C                     END                             *FI
      * if new delivery date not passed in, use DSD for the BOL
      * CASE: PAR.Date To   USR is Not Entered
     C           P7B4DT    IFEQ *ZERO                      *IF
     C                     Z-ADDYL0003    YL0010           Date To   USR
     C                     END                             *FI
      * if new delivery time not passed in, use DSD for the BOL
      * CASE: PAR.Time USR is Not Entered
     C           P8ADTH    IFEQ *ZERO                      *IF
     C                     Z-ADDYL0004    YL0011           Time USR
     C                     END                             *FI
      * *****
      * Get next sequence nbr new DSD Kill &/or Delivery Date &/or time
      * Rtv Next Seq Num      RT - Delivery Sched Detail  * 
     C                     EXSR SDRVGN
      * *****
      * Call the routine to do the transfer
      * Exc Transfer Delivery XF - Buy Order Load  * 
     C                     CALL 'PLCWXFR'              90  Exc Transfer De
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P9HMNB    WQ0003  30       BOH Company Num
     C                     PARM P9BNNB    WQ0004  70       BOH Buy Order N
     C                     PARM P9BONB    WQ0005  50       BOL Load Number
     C                     PARM YL0002    WQ0006  70       BOL Kill Date
     C                     PARM P5JKRU    WQ0007  70       BOL HPS Movemen
     C                     PARM P9ABCD    WQ0008  6        PD Producer Cod
     C                     PARM YL0009    WQ0009  70       Kill Date Usr
     C                     PARM YL0007    WQ0010  70       Buy Order New U
     C                     PARM YL0008    WQ0011  50       Buy Order Load
     C                     PARM WUP4ST    WQ0012  1        Status 1
     C                     PARM YL0011    WQ0013  40       Time USR
     C                     PARM YL0010    WQ0014  70       Date To   USR
     C                     PARM YL0012    WQ0015  30       New Delivery Ti
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLCWXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * *****
     C                     END                             *FI
      * *****
      * Set return code to done
     C                     MOVEL*BLANK    W0RTN            *Return code
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV BOL from Movement RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL*BLANK    YL0006           Return Code USR
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHONB    WQSA01           CC Company Numb
     C           *LIKE     DEFN WAH3A1    WQSA02           DSD Movement Nu
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           CC Company Numb
     C                     KFLD           WQSA02           DSD Movement Nu
      * Setup key
     C                     Z-ADDYL0001    WQSA01           CC Company Numb
     C                     Z-ADDP5JKRU    WQSA02           DSD Movement Nu
      * Establish starting position
     C           KRSSA     SETLL@AECPJB                    *
     C           KRSSA     READE@AECPJB                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1028' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' YL0006           Return Code USR
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAE0DT    YL0002           DSH Kill Date
     C                     Z-ADDWAE6DT    YL0003           DSD Delivery Da
     C                     Z-ADDWAAGTH    YL0004           DSD Delivery Ti
     C                     Z-ADDWAHZA1    YL0005           DSD Delivery Ti
     C                     MOVELWAABCD    P9ABCD           PD Producer Cod
     C                     MOVELWAAECD    P9AECD           PL Location Cod
     C                     Z-ADDWAHMNB    P9HMNB           BOH Company Num
     C                     Z-ADDWABNNB    P9BNNB           BOH Buy Order N
     C                     Z-ADDWABONB    P9BONB           BOL Load Number
     C           KRSSA     READE@AECPJB                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Last BOL f/prd,kl RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHMNB    WQSB01           BOH Company Num
     C           *LIKE     DEFN WBABCD    WQSB02           PD Producer Cod
     C           *LIKE     DEFN WBAECD    WQSB03           PL Location Cod
     C           *LIKE     DEFN WBCQDT    WQSB04           BOL Kill Date
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           BOH Company Num
     C                     KFLD           WQSB02           PD Producer Cod
     C                     KFLD           WQSB03           PL Location Cod
     C                     KFLD           WQSB04           BOL Kill Date
      * Setup key
     C                     Z-ADDP9HMNB    WQSB01           BOH Company Num
     C                     MOVELP9ABCD    WQSB02           PD Producer Cod
     C                     MOVELP9AECD    WQSB03           PL Location Cod
     C                     Z-ADDP6CGDT    WQSB04           BOL Kill Date
      * Establish starting position
     C           KRSSB     SETLL@AXCPJ2                    *
     C           KRSSB     READE@AXCPJ2                  90*
      * Data record not found
     C   90                MOVEL'PRK0051' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     Z-ADDWBBNNB    YL0007           BOH Buy Order N
     C                     Z-ADDWBBONB    YL0008           BOL Load Number
     C           KRSSB     READE@AXCPJ2                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv BOH For Prdcr/Loc RT - Buy Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     YL0007           BOH Buy Order N
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHMNB    WQSC01           BOH Company Num
     C           *LIKE     DEFN WCABCD    WQSC02           PD Producer Cod
     C           *LIKE     DEFN WCAECD    WQSC03           PL Location Cod
     C           *LIKE     DEFN WCASDT    WQSC04           BOH Kill Date
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           BOH Company Num
     C                     KFLD           WQSC02           PD Producer Cod
     C                     KFLD           WQSC03           PL Location Cod
     C                     KFLD           WQSC04           BOH Kill Date
      * Setup key
     C                     Z-ADDP9HMNB    WQSC01           BOH Company Num
     C                     MOVELP9ABCD    WQSC02           PD Producer Cod
     C                     MOVELP9AECD    WQSC03           PL Location Cod
     C                     Z-ADDP6CGDT    WQSC04           BOH Kill Date
      * Establish starting position
     C           KRSSC     SETLL@AWCPNB                    *
     C           KRSSC     READE@AWCPNB                  90*
      * Data record not found
     C   90                MOVEL'PRK0049' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWCBNNB    YL0007           BOH Buy Order N
     C                     GOTO SCEXIT                     *QUIT
     C           KRSSC     READE@AWCPNB                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Next Seq Num      RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDHONB    WQSD01           CC Company Numb
     C           *LIKE     DEFN WDE0DT    WQSD02           DSH Kill Date
     C           *LIKE     DEFN WDE6DT    WQSD03           DSD Delivery Da
     C           *LIKE     DEFN WDAGTH    WQSD04           DSD Delivery Ti
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           CC Company Numb
     C                     KFLD           WQSD02           DSH Kill Date
     C                     KFLD           WQSD03           DSD Delivery Da
     C                     KFLD           WQSD04           DSD Delivery Ti
      * Setup key
     C                     Z-ADDP9HMNB    WQSD01           CC Company Numb
     C                     Z-ADDYL0009    WQSD02           DSH Kill Date
     C                     Z-ADDYL0010    WQSD03           DSD Delivery Da
     C                     Z-ADDYL0011    WQSD04           DSD Delivery Ti
      * Establish starting position
     C           KRSSD     SETLL@AECPJT                    *
     C           KRSSD     READE@AECPJT                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1028' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0012           DSD Delivery Ti
     C                     Z-ADD1         YL0012           DSD Delivery Ti
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWDHZA1    YL0012           DSD Delivery Ti
     C           WDHZA1    ADD  1         YL0012           DSD Delivery Ti
     C                     GOTO SDEXIT                     *QUIT
     C           KRSSD     READE@AECPJT                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P5JKRU           BOL HPS Movemen
     C                     Z-ADD*ZERO     P6CGDT           Kill Date Usr
     C                     Z-ADD*ZERO     P7B4DT           Date To   USR
     C                     Z-ADD*ZERO     P8ADTH           Time USR
     C                     Z-ADD*ZERO     P9HMNB           BOH Company Num
     C                     Z-ADD*ZERO     P9BNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     P9BONB           BOL Load Number
     C                     Z-ADD*ZERO     P9CQDT           BOL Kill Date
     C                     MOVEL*BLANK    P9ABCD           PD Producer Cod
     C                     MOVEL*BLANK    P9AECD           PL Location Cod
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WAE0DT           DSH Kill Date
     C                     Z-ADD*ZERO     WAE6DT           DSD Delivery Da
     C                     Z-ADD*ZERO     WAAGTH           DSD Delivery Ti
     C                     Z-ADD*ZERO     WAHZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     WAH0A1           DSD Scheduled H
     C                     Z-ADD*ZERO     WAH1A1           DSD Farm Site C
     C                     Z-ADD*ZERO     WAIOA1           DSD Unused Head
     C                     Z-ADD*ZERO     WAH2A1           DSD Scheduled D
     C                     Z-ADD*ZERO     WAIJA1           DSD Scheduled K
     C                     Z-ADD*ZERO     WAH3A1           DSD Movement Nu
     C                     Z-ADD*ZERO     WAFRDT           DSD Sched Route
     C                     Z-ADD*ZERO     WABOTH           DSD Sched Route
     C                     Z-ADD*ZERO     WAE7DT           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WAAHTH           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WAE8DT           DSD Sch Start L
     C                     Z-ADD*ZERO     WAAITH           DSD Sch Start L
     C                     Z-ADD*ZERO     WAFZDT           DSD Unused Date
     C                     Z-ADD*ZERO     WAB1TH           DSD Unused Time
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WAY0A1           DSD PRD Srv Bat
     C                     Z-ADD*ZERO     WAY1A1           DSD PRD Srv Sch
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field Record Found USR
     C                     MOVEL*BLANK    WUH7ST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WBBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WBBONB           BOL Load Number
     C                     Z-ADD*ZERO     WBCQDT           BOL Kill Date
     C                     Z-ADD*ZERO     WBABTH           BOL Pln Delv St
     C                     Z-ADD*ZERO     WBACTH           BOL Pln Delv En
     C                     Z-ADD*ZERO     WBBPNB           BOL Pln Head De
     C                     Z-ADD*ZERO     WBCSNB           BOL Shipped Wgt
     C                     Z-ADD*ZERO     WBAUDT           BOL Pln Delv Da
     C                     Z-ADD*ZERO     WBAGPR           BOL Freight Uni
     C                     Z-ADD*ZERO     WBATVA           BOL Freight Amt
     C                     Z-ADD*ZERO     WBDHNB           BOL Head Receiv
     C                     Z-ADD*ZERO     WBDINB           BOL Live Wgt Re
     C                     Z-ADD*ZERO     WBGINB           BOL Trucker Che
     C                     Z-ADD*ZERO     WBBZDT           BOL Trucker Che
     C                     Z-ADD*ZERO     WBLSNB           BOL AP Voucher
     C                     Z-ADD*ZERO     WBLDSH           BOL Shipped Hea
     C                     Z-ADD*ZERO     WBJKRU           BOL HPS Movemen
     C                     Z-ADD*ZERO     WBKEOR           BOL Head LFT
     C                     Z-ADD*ZERO     WBIOEW           BOL Head EUT/KO
     C                     Z-ADD*ZERO     WBKJIO           BOL Auth Gate E
     C                     Z-ADD*ZERO     WBIOJR           BOL Head Receiv
     C                     Z-ADD*ZERO     WBEIRR           BOL Unused Wgt
     C                     Z-ADD*ZERO     WBITMF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WBODJE           BOL Unused Wgt
     C                     Z-ADD*ZERO     WBRJIF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WBOEJF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WBD0DT           BOL Auth Gate E
     C                     Z-ADD*ZERO     WBD1DT           BOL Unused Date
     C                     Z-ADD*ZERO     WBD2DT           BOL Unused Date
     C                     Z-ADD*ZERO     WBD3DT           BOL Unused Date
     C                     Z-ADD*ZERO     WBD4DT           BOL Unused Date
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WCBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WCARDT           BOH Buy Order D
     C                     Z-ADD*ZERO     WCASDT           BOH Kill Date
     C                     Z-ADD*ZERO     WCAAPR           BOH Market Add/
     C                     Z-ADD*ZERO     WCALPR           BOH Quoted Base
     C                     Z-ADD*ZERO     WCD5DT           BOH MPR Reporti
     C                     Z-ADD*ZERO     WCD6DT           BOH Hedge Date
     C                     Z-ADD*ZERO     WCD7DT           BOH Unused Date
     C                     Z-ADD*ZERO     WCD8DT           BOH Unused Date
     C                     Z-ADD*ZERO     WCD9DT           BOH Unused Date
     C                     Z-ADD*ZERO     WCJOEJ           BOH Hedge Head
     C                     Z-ADD*ZERO     WCKOFF           BOH Hedge Refer
     C                     Z-ADD*ZERO     WCKWPE           BOH Hedge Time
     C                     Z-ADD*ZERO     WCIMBF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCOPTR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCOEJD           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCIRMF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCJIRM           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCJRKF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCKFIR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WCHXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     WCGANB           CW Year
     C                     Z-ADD*ZERO     WCGBNB           CW Week Number
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Define work field Status 1
     C                     MOVEL*BLANK    WUP4ST  1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field CC Company Number
     C                     Z-ADD*ZERO     YL0001  30
      * Define local work field BOL Kill Date
     C                     Z-ADD*ZERO     YL0002  70
      * Define local work field DSD Delivery Date
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field DSD Delivery Time
     C                     Z-ADD*ZERO     YL0004  40
      * Define local work field DSD Delivery Time Seq
     C                     Z-ADD*ZERO     YL0005  30
      * Define local work field Return Code USR
     C                     MOVEL*BLANK    YL0006  7
      * Define local work field Buy Order New Usr
     C                     Z-ADD*ZERO     YL0007  70
      * Define local work field Buy Order Load New Usr
     C                     Z-ADD*ZERO     YL0008  50
      * Define local work field Kill Date Usr
     C                     Z-ADD*ZERO     YL0009  70
      * Define local work field Date To   USR
     C                     Z-ADD*ZERO     YL0010  70
      * Define local work field Time USR
     C                     Z-ADD*ZERO     YL0011  40
      * Define local work field New Delivery Time Seq USR
     C                     Z-ADD*ZERO     YL0012  30
      *================================================================
     CSR         ZZEXIT    ENDSR
