// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for OMNRXFR
// ?Date: 14.08.2025 Time: 03:27:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV Build Sls & Accrls RT) TYPE(RTVOBJ) FILE(OMHSTPP)          AC1224470;
{
 //?USER: Process Data record

 //?For each new order#, set the seq.# to zero, then increment by 1.
 CASE;

 // IF DB1.Order Number NE WRK.Order Number
 IF DB1.Order_Number <> WRK.Order_Number;

 // WRK.USR Sequence Num. New ATR = CON.*ZERO
 WRK.USR_Sequence_Num_New_ATR = *ZERO;

 // WRK.Order Number = DB1.Order Number
 WRK.Order_Number = DB1.Order_Number;

 ENDIF;

 // WRK.USR Sequence Num. New ATR = WRK.USR Sequence Num. New ATR + CON.1
 WRK.USR_Sequence_Num_New_ATR = WRK.USR_Sequence_Num_New_ATR + 1;

 // WRK.Extra Amount 1 = DB1.Absorbed Freight Rate
 WRK.Extra_Amount_1 = DB1.Absorbed_Freight_Rate_CWT;

 EXECUTE FUNCTION(CRT OM Accrual History CR) TYPE(CRTOBJ) FILE(OMHSCPP)          AC1223216;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(WRK.USR_Sequence_Num_New_ATR);
 PARAMETER(*BLANK);
 PARAMETER(*ZERO);
 PARAMETER(DB1.Sales_Route_Code);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(DB1.Invoice_Date);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Quantity_Billed);
 PARAMETER(DB1.Weight_Billed);
 PARAMETER(DB1.FOB_Gross_Amount);
 PARAMETER(DB1.Item_Structure_Type_Code);
 PARAMETER(DB1.Item_Structure_Group_Code);
 PARAMETER(DB1.Item_Structure_Class_Code);
 PARAMETER(DB1.Sales_Route_Code);
 PARAMETER(WRK.Extra_Amount_1);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 EXECUTE FUNCTION(RTV Accrl/ Sls & Accrl RT) TYPE(RTVOBJ) FILE(OMCRWKP)          AC1224471;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Sales_Route_Code);
 PARAMETER(DB1.Original_Salesperson);
 PARAMETER(DB1.Quantity_Billed);
 PARAMETER(DB1.Weight_Billed);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(DB1.Item_Structure_Type_Code);
 PARAMETER(DB1.Item_Structure_Group_Code);
 PARAMETER(DB1.Item_Structure_Class_Code);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Actual_Shipped_Date);
 PARAMETER(WRK.USR_Sequence_Num_New_ATR);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Financial Type is Accrual Charge
  IF DB1.Financial_Type = 'A';

  // PAR.USR Sequence Num. New ATR = PAR.USR Sequence Num. New ATR + CON.1
  PAR.USR_Sequence_Num_New_ATR = PAR.USR_Sequence_Num_New_ATR + 1;

  EXECUTE FUNCTION(CRT OM Accrual History CR) TYPE(CRTOBJ) FILE(OMHSCPP)          AC1223216;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(PAR.USR_Sequence_Num_New_ATR);
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Special_Charge_Rate);
  PARAMETER(PAR.Sales_Route_Code);
  PARAMETER(PAR.Ship_To_Customer);
  PARAMETER(PAR.Shipped_Item_Code);
  PARAMETER(PAR.Actual_Shipped_Date);
  PARAMETER(PAR.Invoice_Number);
  PARAMETER(PAR.Invoice_Suffix);
  PARAMETER(PAR.Quantity_Billed);
  PARAMETER(PAR.Weight_Billed);
  PARAMETER(DB1.Transaction_Amount);
  PARAMETER(PAR.Item_Structure_Type_Code);
  PARAMETER(PAR.Item_Structure_Group_Code);
  PARAMETER(PAR.Item_Structure_Class_Code);
  PARAMETER(PAR.Sales_Route_Code);
  PARAMETER(*ZERO);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  ENDIF;

 }

 EXECUTE FUNCTION(RTV Accrl/Sls & Accrl  RT) TYPE(RTVOBJ) FILE(OMHRCPP)          AC1224472;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Sales_Route_Code);
 PARAMETER(DB1.Original_Salesperson);
 PARAMETER(DB1.Quantity_Billed);
 PARAMETER(DB1.Weight_Billed);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(DB1.Item_Structure_Type_Code);
 PARAMETER(DB1.Item_Structure_Group_Code);
 PARAMETER(DB1.Item_Structure_Class_Code);
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Invoice_Suffix);
 PARAMETER(DB1.Actual_Shipped_Date);
 PARAMETER(WRK.USR_Sequence_Num_New_ATR);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(RTV All Values         RT) TYPE(RTVOBJ) FILE(OMHLREP)          AC1222083;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(PAR.Accrual_Description);
  PARAMETER(PAR.Automatic_Accrual_Y_N);
  PARAMETER(PAR.Print_On_Invoice_Y_N);
  PARAMETER(PAR.Rate_Usage);
  PARAMETER(PAR.Add_on_Allowance);
  PARAMETER(PAR.Accrual_Type);
  PARAMETER(PAR.Reverse_Accrual_Code);
  PARAMETER(PAR.UOM_Primary_Dft);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   // PGM.*Return code = CND.*Normal
   PGM.*Return_code = *BLANK;

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF PAR.Automatic Accrual (Y/N) is Yes
  IF PAR.Automatic_Accrual_Y_N = 'Y';

  // PAR.USR Sequence Num. New ATR = PAR.USR Sequence Num. New ATR + CON.1
  PAR.USR_Sequence_Num_New_ATR = PAR.USR_Sequence_Num_New_ATR + 1;

  EXECUTE FUNCTION(CRT OM Accrual History CR) TYPE(CRTOBJ) FILE(OMHSCPP)          AC1223216;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(PAR.USR_Sequence_Num_New_ATR);
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER(PAR.Sales_Route_Code);
  PARAMETER(PAR.Ship_To_Customer);
  PARAMETER(PAR.Shipped_Item_Code);
  PARAMETER(PAR.Actual_Shipped_Date);
  PARAMETER(PAR.Invoice_Number);
  PARAMETER(PAR.Invoice_Suffix);
  PARAMETER(PAR.Quantity_Billed);
  PARAMETER(PAR.Weight_Billed);
  PARAMETER(DB1.Extended_Amount);
  PARAMETER(PAR.Item_Structure_Type_Code);
  PARAMETER(PAR.Item_Structure_Group_Code);
  PARAMETER(PAR.Item_Structure_Class_Code);
  PARAMETER(PAR.Sales_Route_Code);
  PARAMETER(*ZERO);
  PARAMETER(*ZERO);
  PARAMETER(*ZERO);
  ENDIF;

 }

}


