/*********************************************************************/
/*     Program: PPN2UPC                                              */
/*       Title: Prompt for printer overrides, then submit report.    */
/*        Date: 04/19/05                                             */
/* Description: - Calls print options prompt program                 */
/*              - Submits A/R Customer RECONCILIATION             */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    O     &RETURN     Return code                                  */
/*    I     &APPLIC     Application Code                             */
/*    I     &CUSTNBR    A/R customer number                          */
/*    I     &FDATEA     FROM TRANS DATE                              */
/*    I     &TDATEA     TO TRANS DATE                                */
/*    I     &INVOICE    INVOICE                                      */
/*    I     &CHECK      CHECK NUMBER                                 */
/*                                                                   */
/*********************************************************************/
/* Modifications:                                                    */
/*                                                                   */
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*  04/29/24  PIO      REPLACE OPNQRYF WITH OPNSQLF                  */
/*                     ADDED NEEDED OVRDBF AROUND THE COMMAND        */
/*                     CHANGE *AND TO AND, *EQ TO =, *GE TO >=,      */
/*                     *LE TO <=, *GT TO > IN &QDATA                 */
/*                                                                   */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&RETURN &APPLIC &OUTQ &HOLD &SAVE +
                                  &CUSTNBR &FDATED &TDATED +
                  &COPYN  &INVOICE &CHECK)
   /*-------------------*/
   /* Declare Variables */
   /*-------------------*/

             /* Parameter Fields */
             DCL  VAR(&RETURN)  TYPE(*CHAR) LEN(7)
             DCL  VAR(&APPLIC)  TYPE(*CHAR) LEN(6)
             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0) /* +
                          COMPANY       */
             DCL        VAR(&COMPL) TYPE(*DEC) /* FOR PASSING   */
             DCL  VAR(&CUSTNBR) TYPE(*DEC)
             DCL  VAR(&FDATED) TYPE(*DEC)
             DCL  VAR(&TDATED) TYPE(*DEC)
             DCL  VAR(&INVOICE) TYPE(*CHAR) LEN(7)
             DCL  VAR(&CHECK)  TYPE(*CHAR) LEN(10)
             DCL  VAR(&FDATEN) TYPE(*DEC) LEN(7 0)
             DCL  VAR(&TDATEN) TYPE(*DEC) LEN(7 0)
             DCL  VAR(&INVOICN) TYPE(*DEC) LEN(7 0)
             DCL  VAR(&CUSTN) TYPE(*DEC) LEN(7 0)

             /* Internal Work Fields */
             DCL  VAR(&DESC)    TYPE(*CHAR) LEN(25)
             DCL  VAR(&OUTQ)    TYPE(*CHAR) LEN(10)
             DCL  VAR(&HOLD)    TYPE(*CHAR) LEN(4)
             DCL  VAR(&SAVE)    TYPE(*CHAR) LEN(4)
             DCL  VAR(&COPYN)   TYPE(*DEC)
             DCL  VAR(&COPY)    TYPE(*DEC)  LEN(2 0)
 /*          DCL  VAR(&NQSTAT)  TYPE(*CHAR) LEN(01)     +
             DCL  VAR(&NIGHTQ)  TYPE(*CHAR) LEN(10)            */
             DCL  VAR(&MSG)     TYPE(*CHAR) LEN(512)
             DCL  VAR(&MSGID)   TYPE(*CHAR) LEN(7)
             DCL  VAR(&MSGL)    TYPE(*DEC)  LEN(5 0)
             DCL        VAR(&COMMAND) TYPE(*CHAR) LEN(512)
        DCL    &FRMDATA    *CHAR    7            /* FROM TRAN DATE (Passed)   */
        DCL    &THRDATA    *CHAR    7            /* THRU TRAN DATE (Passed)   */
        DCL    &INVDATA    *CHAR    7            /* INVOICE DATA   (Passed)   */
        DCL    &CUSTDATA   *CHAR    7            /* CUSTOMER DATA  (Passed)   */

        DCL     &A        *CHAR   50              /* QRY FROM TO DATE  */
        DCL     &B        *CHAR   50              /* QRY CUST       */
        DCL     &D        *CHAR  120              /* QRY ALL        */

/*           CHGJOB     LOG(4 99 *SECLVL)    */
   /*----------------------------------------------*/
   /* Monitor for all message at the program level */
   /*----------------------------------------------*/
             MONMSG MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

   /*-----------------------------------*/
   /* CHANGE INPUT PARMS TO CORRECT LENGTH AND TYPE   */
   /*-----------------------------------*/

             CHGVAR VAR(&RETURN) VALUE(' ')
             CHGVAR     VAR(&COMP) VALUE(&COMPL)
             CHGVAR VAR(&CUSTN) VALUE(&CUSTNBR)
             CHGVAR VAR(&FDATEN) VALUE(&FDATED)
             CHGVAR VAR(&TDATEN) VALUE(&TDATED)
             CHGVAR VAR(&INVOICN) VALUE(&INVOICE)
             CHGVAR VAR(&COPY) VALUE(&COPYN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FDATEN)
             CHGVAR     VAR(&THRDATA) VALUE(&TDATEN)
             CHGVAR     VAR(&CUSTDATA) VALUE(&CUSTN)
             CHGVAR     VAR(&INVDATA) VALUE(&INVOICN)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR INVOICING REPORTS         */
/*********************************************************************/
             IF         COND(&FDATEN *NE 0) THEN(DO)
  /*PIO      CHGVAR     VAR(&A) VALUE('(BDB4DT *GE ' *CAT +  +
                         &FRMDATA *CAT ' *AND BDB4DT *LE +   +
                         ' *CAT &THRDATA *CAT ')')          */
  /*PIO*/    CHGVAR     VAR(&A) VALUE('(BDB4DT  >= ' *CAT +
                         &FRMDATA *CAT '  AND BDB4DT <= +
                         ' *CAT &THRDATA *CAT ')')
             ENDDO
             IF         COND(&CUSTN *NE 0) THEN(DO)
  /*PIO      CHGVAR     VAR(&B) VALUE('*AND (BDANC7 *EQ ' *CAT + +
                         &CUSTDATA *CAT ')')                    */
  /*PIO*/    CHGVAR     VAR(&B) VALUE(' AND (BDANC7  =  ' *CAT +
                         &CUSTDATA *CAT ')')
             CHGVAR     VAR(&D) VALUE(&A *BCAT &B)
             GOTO CALLIT
             ENDDO
             IF         COND(&INVOICN *NE 0) THEN(DO)
  /*PIO      CHGVAR     VAR(&A) VALUE('(BDCONB *EQ ' *CAT +  +
                         &INVDATA *CAT ')')                 */
  /*PIO*/    CHGVAR     VAR(&A) VALUE('(BDCONB  =  ' *CAT +
                         &INVDATA *CAT ')')
             CHGVAR     VAR(&D) VALUE(&A)
             GOTO CALLIT
             ENDDO
             IF         COND(&CHECK *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&A) VALUE('(BDCPTX *EQ ' *CAT +  +
                     '"' *CAT &CHECK *CAT '")')             */
  /*PIO*/    CHGVAR     VAR(&A) VALUE('(BDCPTX  =  ' *CAT +
                     '"' *CAT &CHECK *CAT '")')
             CHGVAR     VAR(&D) VALUE(&A)
             ENDDO
   /*---------------------------*/
   /* CALL PRINT PGM           */
   /*---------------------------*/
 CALLIT:     SBDPRTOVR  CMDVAR(&COMMAND) FILE(PPNZPFR$) +
                          OUTQ(&OUTQ) COPIES(&COPY) HOLD(&HOLD) +
                          SAVE(&SAVE)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

   /*PIO     OVRDBF     FILE(ARBDCPLZ) SHARE(*YES)   +
             OPNQRYF    FILE(ARBDCPLZ) +             +
                        QRYSLT(&D) +                 +
                        KEYFLD(*FILE)              */

   /*PIO*/    OVRDBF     FILE(ARBDCPP) TOFILE(ARBDCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from ARBDCPP Where  ' *BCAT +
                          &D      *BCAT ' Order by BDANC7 asc, +
                          BDCONB asc, BDCEST asc') +
                          OPNID(ARBDCPLZ) OPTION(*ALL) SEQONLY(*NO) +
                          RCDFMT(@BDCPAO) ALWCPY(*IFRQD) /*PIO*/
    /*PIO*/  OVRDBF     FILE(ARBDCPLZ) TOFILE(ARBDCPP) LVLCHK(*NO) +
                        OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


             CALL       PGM(PPNZPFR) PARM(''  &INVOICN &CUSTN   +
                  &CHECK  &FDATEN &TDATEN)
             CLOF       OPNID(ARBDCPLZ)
   /*PIO     DLTOVR     FILE(ARBDCPLZ)   */
             DLTOVR     FILE(ARBDCPLZ) LVL(*JOB) /*PIO*/
             GOTO CMDLBL(END)


   /*------------------------------*/
   /* Trap errors and send message */
   /*------------------------------*/
 MSGTRAP:
             RCVMSG MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                    MSGID(&MSGID)
             MONMSG MSGID(CPF0000) EXEC(GOTO CMDLBL(END))
             SNDPGMMSG MSGID(&MSGID) MSGF(QCPFMSG) +
                       MSGDTA(%SST(&MSG 1 &MSGL)) +
                       MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

   /*----------------*/
   /* End of Program */
   /*----------------*/
 END:
             ENDPGM
