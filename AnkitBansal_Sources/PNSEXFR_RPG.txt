     H/TITLE Exc Upd EMTS Spprt InvXF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 08/17/10  Time  : 16:43:39
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMDACPLIIF  E           K        DISK
      * RSQ : COA Batch Header RIN      Co/Order/Seq
      *
     FPMDACPL0UF  E           K        DISK
      * UPD : COA Batch Header RIN      Update index
      *
      * Long constants
     E                    @CN#    1  01  6   @CN    25
     I@DACPHE
      * COA Batch Header RIN      Co/Order/Seq
      * Renamed input format fields
     I              DAAIC3                          WAAIC3
     I              DAL6T1                          WAL6T1
     I              DAI3NY                          WAI3NY
     I              DAJYNY                          WAJYNY
     I              DAQ1NY                          WAQ1NY
     I              DAMUT1                          WAMUT1
     I              DAJZNY                          WAJZNY
     I              DAJ0NY                          WAJ0NY
     I              DAJ2NY                          WAJ2NY
     I              DARIDT                          WARIDT
     I              DAC5TM                          WAC5TM
     I              DAMVT1                          WAMVT1
     I              DAMWT1                          WAMWT1
     I              DARINT                          WARINT
     I              DARJDT                          WARJDT
     I              DAC6TM                          WAC6TM
     I              DAC4NB                          WAC4NB
     I              DADPNB                          WADPNB
     I              DAUENB                          WAUENB
     I              DARZNB                          WARZNB
     I              DANGT1                          WANGT1
     I              DARMNB                          WARMNB
     I              DARKDT                          WARKDT
     I              DAC7TM                          WAC7TM
     I              DARINS                          WARINS
     I              DAMXT1                          WAMXT1
     I              DAG3ST                          WAG3ST
     I              DAQWNY                          WAQWNY
     I              DAL0AA                          WAL0AA
     I              DAMAT1                          WAMAT1
     I              DATDNA                          WATDNA
     I              DACWC3                          WACWC3
     I              DAQXNY                          WAQXNY
     I              DAQZNY                          WAQZNY
     I              DAQ0NY                          WAQ0NY
     I              DALVTX                          WALVTX
     I              DANYT1                          WANYT1
     I              DAG5ST                          WAG5ST
     I              DAG7ST                          WAG7ST
     I              DATFDT                          WATFDT
     I              DATGDT                          WATGDT
     I              DAWIT1                          WAWIT1
     I              DAQYNY                          WAQYNY
     I              DAL7T1                          WAL7T1
     I              DAR8NY                          WAR8NY
     I              DAR0NY                          WAR0NY
     I              DAI7AA                          WAI7AA
     I              DAMXAA                          WAMXAA
     I              DAMSAA                          WAMSAA
     I              DAR7NY                          WAR7NY
     I              DAHEPR                          WAHEPR
     I              DAHFPR                          WAHFPR
     I              DAWVT1                          WAWVT1
     I              DAW0T1                          WAW0T1
     I              DAR5NY                          WAR5NY
     I              DAW1T1                          WAW1T1
     I              DAR6NY                          WAR6NY
     I              DAJ1ST                          WAJ1ST
     I              DAKHST                          WAKHST
     I              DATWDT                          WATWDT
     I              DADUTM                          WADUTM
     I              DAKGST                          WAKGST
     I              DATVDT                          WATVDT
     I              DADTTM                          WADTTM
     I              DAR9NY                          WAR9NY
     I              DASQNY                          WASQNY
     I              DABHR3                          WABHR3
     I              DASRNY                          WASRNY
     I              DAW7T1                          WAW7T1
     I              DAW8T1                          WAW8T1
     I              DAT2DT                          WAT2DT
     I              DASXNY                          WASXNY
     I              DASYNY                          WASYNY
     I              DASZNY                          WASZNY
     I              DAVSST                          WAVSST
     I              DAMJDT                          WAMJDT
     I              DABETM                          WABETM
     I              DACCVN                          WACCVN
     I              DACDVN                          WACDVN
     I              DAMKDT                          WAMKDT
     I              DABFTM                          WABFTM
     I              DACEVN                          WACEVN
     I              DACFVN                          WACFVN
      *
     I@DACPP5
      * COA Batch Header RIN      Update index
      * Renamed input format fields
     I              DAAIC3                          WBAIC3
     I              DAL6T1                          WBL6T1
     I              DAI3NY                          WBI3NY
     I              DAJYNY                          WBJYNY
     I              DAQ1NY                          WBQ1NY
     I              DAMUT1                          WBMUT1
     I              DAJZNY                          WBJZNY
     I              DAJ0NY                          WBJ0NY
     I              DAJ2NY                          WBJ2NY
     I              DARIDT                          WBRIDT
     I              DAC5TM                          WBC5TM
     I              DAMVT1                          WBMVT1
     I              DAMWT1                          WBMWT1
     I              DARINT                          WBRINT
     I              DARJDT                          WBRJDT
     I              DAC6TM                          WBC6TM
     I              DAC4NB                          WBC4NB
     I              DADPNB                          WBDPNB
     I              DAUENB                          WBUENB
     I              DARZNB                          WBRZNB
     I              DANGT1                          WBNGT1
     I              DARMNB                          WBRMNB
     I              DARKDT                          WBRKDT
     I              DAC7TM                          WBC7TM
     I              DARINS                          WBRINS
     I              DAMXT1                          WBMXT1
     I              DAG3ST                          WBG3ST
     I              DAQWNY                          WBQWNY
     I              DAL0AA                          WBL0AA
     I              DAMAT1                          WBMAT1
     I              DATDNA                          WBTDNA
     I              DACWC3                          WBCWC3
     I              DAQXNY                          WBQXNY
     I              DAQZNY                          WBQZNY
     I              DAQ0NY                          WBQ0NY
     I              DALVTX                          WBLVTX
     I              DANYT1                          WBNYT1
     I              DAG5ST                          WBG5ST
     I              DAG7ST                          WBG7ST
     I              DATFDT                          WBTFDT
     I              DATGDT                          WBTGDT
     I              DAWIT1                          WBWIT1
     I              DAQYNY                          WBQYNY
     I              DAL7T1                          WBL7T1
     I              DAR8NY                          WBR8NY
     I              DAR0NY                          WBR0NY
     I              DAI7AA                          WBI7AA
     I              DAMXAA                          WBMXAA
     I              DAMSAA                          WBMSAA
     I              DAR7NY                          WBR7NY
     I              DAHEPR                          WBHEPR
     I              DAHFPR                          WBHFPR
     I              DAWVT1                          WBWVT1
     I              DAW0T1                          WBW0T1
     I              DAR5NY                          WBR5NY
     I              DAW1T1                          WBW1T1
     I              DAR6NY                          WBR6NY
     I              DAJ1ST                          WBJ1ST
     I              DAKHST                          WBKHST
     I              DATWDT                          WBTWDT
     I              DADUTM                          WBDUTM
     I              DAKGST                          WBKGST
     I              DATVDT                          WBTVDT
     I              DADTTM                          WBDTTM
     I              DAR9NY                          WBR9NY
     I              DASQNY                          WBSQNY
     I              DABHR3                          WBBHR3
     I              DASRNY                          WBSRNY
     I              DAW7T1                          WBW7T1
     I              DAW8T1                          WBW8T1
     I              DAT2DT                          WBT2DT
     I              DASXNY                          WBSXNY
     I              DASYNY                          WBSYNY
     I              DASZNY                          WBSZNY
     I              DAVSST                          WBVSST
     I              DAMJDT                          WBMJDT
     I              DABETM                          WBBETM
     I              DACCVN                          WBCCVN
     I              DACDVN                          WBCDVN
     I              DAMKDT                          WBMKDT
     I              DABFTM                          WBBFTM
     I              DACEVN                          WBCEVN
     I              DACFVN                          WBCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPMDA1    E DSPMDACPL0
      * UPD : COA Batch Header RIN      Update index
      * Renamed input format fields
     I              DAAIC3                          WBAIC3
     I              DAL6T1                          WBL6T1
     I              DAI3NY                          WBI3NY
     I              DAJYNY                          WBJYNY
     I              DAQ1NY                          WBQ1NY
     I              DAMUT1                          WBMUT1
     I              DAJZNY                          WBJZNY
     I              DAJ0NY                          WBJ0NY
     I              DAJ2NY                          WBJ2NY
     I              DARIDT                          WBRIDT
     I              DAC5TM                          WBC5TM
     I              DAMVT1                          WBMVT1
     I              DAMWT1                          WBMWT1
     I              DARINT                          WBRINT
     I              DARJDT                          WBRJDT
     I              DAC6TM                          WBC6TM
     I              DAC4NB                          WBC4NB
     I              DADPNB                          WBDPNB
     I              DAUENB                          WBUENB
     I              DARZNB                          WBRZNB
     I              DANGT1                          WBNGT1
     I              DARMNB                          WBRMNB
     I              DARKDT                          WBRKDT
     I              DAC7TM                          WBC7TM
     I              DARINS                          WBRINS
     I              DAMXT1                          WBMXT1
     I              DAG3ST                          WBG3ST
     I              DAQWNY                          WBQWNY
     I              DAL0AA                          WBL0AA
     I              DAMAT1                          WBMAT1
     I              DATDNA                          WBTDNA
     I              DACWC3                          WBCWC3
     I              DAQXNY                          WBQXNY
     I              DAQZNY                          WBQZNY
     I              DAQ0NY                          WBQ0NY
     I              DALVTX                          WBLVTX
     I              DANYT1                          WBNYT1
     I              DAG5ST                          WBG5ST
     I              DAG7ST                          WBG7ST
     I              DATFDT                          WBTFDT
     I              DATGDT                          WBTGDT
     I              DAWIT1                          WBWIT1
     I              DAQYNY                          WBQYNY
     I              DAL7T1                          WBL7T1
     I              DAR8NY                          WBR8NY
     I              DAR0NY                          WBR0NY
     I              DAI7AA                          WBI7AA
     I              DAMXAA                          WBMXAA
     I              DAMSAA                          WBMSAA
     I              DAR7NY                          WBR7NY
     I              DAHEPR                          WBHEPR
     I              DAHFPR                          WBHFPR
     I              DAWVT1                          WBWVT1
     I              DAW0T1                          WBW0T1
     I              DAR5NY                          WBR5NY
     I              DAW1T1                          WBW1T1
     I              DAR6NY                          WBR6NY
     I              DAJ1ST                          WBJ1ST
     I              DAKHST                          WBKHST
     I              DATWDT                          WBTWDT
     I              DADUTM                          WBDUTM
     I              DAKGST                          WBKGST
     I              DATVDT                          WBTVDT
     I              DADTTM                          WBDTTM
     I              DAR9NY                          WBR9NY
     I              DASQNY                          WBSQNY
     I              DABHR3                          WBBHR3
     I              DASRNY                          WBSRNY
     I              DAW7T1                          WBW7T1
     I              DAW8T1                          WBW8T1
     I              DAT2DT                          WBT2DT
     I              DASXNY                          WBSXNY
     I              DASYNY                          WBSYNY
     I              DASZNY                          WBSZNY
     I              DAVSST                          WBVSST
     I              DAMJDT                          WBMJDT
     I              DABETM                          WBBETM
     I              DACCVN                          WBCCVN
     I              DACDVN                          WBCDVN
     I              DAMKDT                          WBMKDT
     I              DABFTM                          WBBFTM
     I              DACEVN                          WBCEVN
     I              DACFVN                          WBCFVN
      *
     IYARDCS      DS                            563
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Header TRG
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Order Number
     I                                    P   3   60P1C4NB
      * I :  Invoice Number
     I                                    P   7  100P1CONB
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P1CONB    PARM           WP0003  70       Invoice Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Upd EMTS Spprt InvXF
      * Rtv Upd Spprt Inv#    RT - COA Batch Header RIN  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Upd Spprt Inv#    RT - COA Batch Header RIN  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAIC3    WQSA01           Company Number
     C           *LIKE     DEFN WAC4NB    WQSA02           Order Number
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Company Number
     C                     KFLD           WQSA02           Order Number
      * Setup key
     C                     Z-ADDP1AIC3    WQSA01           Company Number
     C                     Z-ADDP1C4NB    WQSA02           Order Number
      * Establish starting position
     C           KRSSA     SETLL@DACPHE                    *
     C           KRSSA     READE@DACPHE                  90*
      * Data record not found
     C   90                MOVEL'USR3855' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Chg Support Inv#     CH - COA Batch Header RIN  * 
     C                     EXSR SBCHRC
     C           KRSSA     READE@DACPHE                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCHRC    BEGSR
      *================================================================
      * Chg Support Inv#     CH - COA Batch Header RIN  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  80       COA RIN SSSSSSS
     C                     Z-ADD*ZERO     WN0002  80       COA RIN EEEEEEE
     C                     Z-ADD*ZERO     WN0003  80       COA RIN Volume
     C                     Z-ADD*ZERO     WN0004  70       COA RIN Transac
     C                     Z-ADD*ZERO     WN0005  60       COA RIN Transac
     C                     MOVEL*BLANK    WN0006 30        COA RIN Trans P
     C                     MOVEL*BLANK    WN0007  4        COA RIN Trans P
     C                     MOVEL*BLANK    WN0008  3        COA Retired RIN
     C                     Z-ADD*ZERO     WN0009  70       COA Retired RIN
     C                     Z-ADD*ZERO     WN0010  60       COA Retired RIN
     C                     Z-ADD*ZERO     WN0011  70       Order Number
     C                     Z-ADD*ZERO     WN0012  30       Order Sequence
     C                     Z-ADD*ZERO     WN0013  30       Order Secondary
     C                     Z-ADD*ZERO     WN0014  50       Case Sequence N
     C                     MOVEL*BLANK    WN0015 15        COA Rail Car
     C                     Z-ADD*ZERO     WN0016  70       Load ID
     C                     Z-ADD*ZERO     WN0017  70       COA Date of 1st
     C                     Z-ADD*ZERO     WN0018  60       COA RIN Unused
     C                     MOVEL*BLANK    WN0019  1        COA RIN Modifie
     C                     MOVEL*BLANK    WN0020 25        COA RIN Unused
     C                     MOVEL*BLANK    WN0021  1        COA RIN SoldFul
     C                     Z-ADD*ZERO     WN0022  80       COA RIN Gallons
     C                     MOVEL*BLANK    WN0023  3        COA Ship To War
     C                     MOVEL*BLANK    WN0024  1        COA RIN Type Fl
     C                     MOVEL*BLANK    WN0025 15        COA RIN Custome
     C                     Z-ADD*ZERO     WN0026  30       COA Shipping Co
     C                     Z-ADD*ZERO     WN0027  70       COA Ref Load Id
     C                     Z-ADD*ZERO     WN0028  50       COA Reference B
     C                     Z-ADD*ZERO     WN0029  50       COA Reference B
     C                     MOVEL*BLANK    WN0030  2        RFS Compliance
     C                     MOVEL*BLANK    WN0031  4        RFS Report Year
     C                     MOVEL*BLANK    WN0032  1        COA RIN Int/Ext
     C                     MOVEL*BLANK    WN0033  2        COA BHR Unused
     C                     Z-ADD*ZERO     WN0034  70       COA BHR Net Gal
     C                     Z-ADD*ZERO     WN0035  70       COA BHR Unused
     C                     MOVEL*BLANK    WN0036 25        COA BHR Unused
     C                     Z-ADD*ZERO     WN0037  70       COA BHR Loadout
     C                     MOVEL*BLANK    WN0038  5        COA ULSD Facili
     C                     Z-ADD*ZERO     WN0039  70       COA Batch RIN V
     C                     Z-ADD*ZERO     WN0040  70       COA RIN Quantit
     C                     MOVEL*BLANK    WN0041  3        RFS Transaction
     C                     MOVEL*BLANK    WN0042  3        RFS Trans Reaso
     C                     MOVEL*BLANK    WN0043  1        RFS Fuel Code
     C                     Z-ADD*ZERO     WN0044  40       COA BHR RIN Gen
     C                     Z-ADD*ZERO     WN0045  72       COA BHR RIN Pri
     C                     Z-ADD*ZERO     WN0046  72       COA BHR Gallon
     C                     MOVEL*BLANK    WN0047 50        COA Transaction
     C                     MOVEL*BLANK    WN0048 25        COA RIN Support
     C                     Z-ADD*ZERO     WN0049  70       COA RIN Support
     C                     MOVEL*BLANK    WN0050  1        COA BHR RFS Ver
     C                     MOVEL*BLANK    WN0051  1        COA GEN EMTS St
     C                     Z-ADD*ZERO     WN0052  70       COA GEN EMTS Da
     C                     Z-ADD*ZERO     WN0053  60       COA GEN EMTS Ti
     C                     MOVEL*BLANK    WN0054  1        COA RIN EMTS St
     C                     Z-ADD*ZERO     WN0055  70       COA RIN EMTS Da
     C                     Z-ADD*ZERO     WN0056  60       COA RIN EMTS Ti
     C                     Z-ADD*ZERO     WN0057  70       COA EMTS PTD Nb
     C                     Z-ADD*ZERO     WN0058  80       COA EMTS Batch
     C                     MOVEL*BLANK    WN0059  2        COA BHR Unused
     C                     Z-ADD*ZERO     WN0060  80       COA BHR Unused
     C                     MOVEL*BLANK    WN0061 40        COA EMTS Trans
     C                     MOVEL*BLANK    WN0062 10        COA EMTS Return
     C                     Z-ADD*ZERO     WN0063  70       COA BHR Unused
     C                     Z-ADD*ZERO     WN0064  21       COA BHR Equiv V
     C                     Z-ADD*ZERO     WN0065  70       COA BHR RINs to
     C                     Z-ADD*ZERO     WN0066  70       COA BHR Unused
     C                     MOVEL*BLANK    WN0067  1        Record Status
     C                     Z-ADD*ZERO     WN0068  70       Create Date
     C                     Z-ADD*ZERO     WN0069  60       Create Time
     C                     MOVEL*BLANK    WN0070 10        Create User
     C                     MOVEL*BLANK    WN0071 10        Create Program
     C                     Z-ADD*ZERO     WN0072  70       Change Date
     C                     Z-ADD*ZERO     WN0073  60       Change Time
     C                     MOVEL*BLANK    WN0074 10        Change User
     C                     MOVEL*BLANK    WN0075 10        Change Program
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @DACPP5
     C                     Z-ADDWAAIC3    WBAIC3           Company Number
     C                     MOVELWAL6T1    WBL6T1    P      COA ULSD Compan
     C                     Z-ADDWAI3NY    WBI3NY           COA Batch Numbe
     C                     Z-ADDWAJYNY    WBJYNY           COA Batch Heade
     C                     Z-ADDWAQ1NY    WBQ1NY           COA Batch Hdr R
      *
     C           KLCHSB    KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBL6T1           COA ULSD Compan
     C                     KFLD           WBI3NY           COA Batch Numbe
     C                     KFLD           WBJYNY           COA Batch Heade
     C                     KFLD           WBQ1NY           COA Batch Hdr R
     C           KLCHSB    CHAIN@DACPP5              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PMDACPL0'MDACP
     C                     MOVEL'@DACPP5' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPMDA1    YARDCS
      * Move non-key fields to @DACPP5
     C                     MOVELWAMUT1    WBMUT1    P      COA Batch Heade
     C                     MOVEL@CN,001   WBW1T1    P      COA RIN Support
     C                     Z-ADDP1CONB    WBR6NY           COA RIN Support
      *
      * Set PGM.*Record Data Changed flag
     C           QPMDA1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Chg Date/Time      IF
     C                     Z-ADD##JDT     WBMKDT           Change Date
     C                     Z-ADD##JTM     WBBFTM           Change Time
     C                     MOVEL##USR     WBCEVN           Change User
     C                     MOVEL##PGM     WBCFVN           Change Program
      * Set PGM.*Record Data Changed flag
     C           QPMDA1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@DACPP5                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPMDACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAI3NY           COA Batch Numbe
     C                     Z-ADD*ZERO     WAJYNY           COA Batch Heade
     C                     Z-ADD*ZERO     WAQ1NY           COA Batch Hdr R
     C                     Z-ADD*ZERO     WAJZNY           COA RIN SSSSSSS
     C                     Z-ADD*ZERO     WAJ0NY           COA RIN EEEEEEE
     C                     Z-ADD*ZERO     WAJ2NY           COA RIN Volume
     C                     Z-ADD*ZERO     WARIDT           COA RIN Transac
     C                     Z-ADD*ZERO     WAC5TM           COA RIN Transac
     C                     Z-ADD*ZERO     WARJDT           COA Retired RIN
     C                     Z-ADD*ZERO     WAC6TM           COA Retired RIN
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WARZNB           Case Sequence N
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WARKDT           COA Date of 1st
     C                     Z-ADD*ZERO     WAC7TM           COA RIN Unused
     C                     Z-ADD*ZERO     WAQWNY           COA RIN Gallons
     C                     Z-ADD*ZERO     WACWC3           COA Shipping Co
     C                     Z-ADD*ZERO     WAQXNY           COA Ref Load Id
     C                     Z-ADD*ZERO     WAQZNY           COA Reference B
     C                     Z-ADD*ZERO     WAQ0NY           COA Reference B
     C                     Z-ADD*ZERO     WATFDT           COA BHR Net Gal
     C                     Z-ADD*ZERO     WATGDT           COA BHR Unused
     C                     Z-ADD*ZERO     WAQYNY           COA BHR Loadout
     C                     Z-ADD*ZERO     WAR8NY           COA Batch RIN V
     C                     Z-ADD*ZERO     WAR0NY           COA RIN Quantit
     C                     Z-ADD*ZERO     WAR7NY           COA BHR RIN Gen
     C                     Z-ADD*ZERO     WAHEPR           COA BHR RIN Pri
     C                     Z-ADD*ZERO     WAHFPR           COA BHR Gallon
     C                     Z-ADD*ZERO     WAR5NY           COA RIN Support
     C                     Z-ADD*ZERO     WAR6NY           COA RIN Support
     C                     Z-ADD*ZERO     WATWDT           COA GEN EMTS Da
     C                     Z-ADD*ZERO     WADUTM           COA GEN EMTS Ti
     C                     Z-ADD*ZERO     WATVDT           COA RIN EMTS Da
     C                     Z-ADD*ZERO     WADTTM           COA RIN EMTS Ti
     C                     Z-ADD*ZERO     WAR9NY           COA EMTS PTD Nb
     C                     Z-ADD*ZERO     WASQNY           COA EMTS Batch
     C                     Z-ADD*ZERO     WASRNY           COA BHR Unused
     C                     Z-ADD*ZERO     WAT2DT           COA BHR Unused
     C                     Z-ADD*ZERO     WASXNY           COA BHR Equiv V
     C                     Z-ADD*ZERO     WASYNY           COA BHR RINs to
     C                     Z-ADD*ZERO     WASZNY           COA BHR Unused
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 INVOICE
