// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKKVPVR
// ?Date: 14.08.2025 Time: 02:52:00
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?H16853 - ISE - 02/03/21 - Increased Buy Order length from 5 to 7.
//?                          Recompilation only.
// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Load screen

// DTL.PD Producer Code = CON.SEABOA
DTL.PD_Producer_Code = 'SEABOA';

// DTL.PL Location Code = CON.SB01
DTL.PL_Location_Code = 'SB01';

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(DTL.Producer_Name_DRV);
PARAMETER(DTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(DTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


SET CURSOR;

//?USER: Process command keys

CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.Pen Number
IF PGM.*Cursor_field = DTL.Pen_Number;

// Call program Sel Pen Open/Hc Type  SR.
CALL PROGRAM(Sel Pen Open/Hc Type  SR) ('PKJWSRR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Pen_Number);
PARAMETER('R');

// IF PGM.*Cursor field <IS> DTL.PD Producer Code
IF PGM.*Cursor_field = DTL.PD_Producer_Code;

// Call program Sel Producer Loc      SR.
CALL PROGRAM(Sel Producer Loc      SR) ('PKKMSRR');
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);

// IF PGM.*Cursor field <IS> DTL.PL Location Code
IF PGM.*Cursor_field = DTL.PL_Location_Code;

// Call program Sel Producer Loc      SR.
CALL PROGRAM(Sel Producer Loc      SR) ('PKKMSRR');
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);

ENDIF;

ENDIF;

//?CALC: Screen function fields

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(DTL.Producer_Name_DRV);
PARAMETER(DTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(DTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: User defined action

CASE;

// IF DTL.*CMD key is CF03
IF DTL.*CMD_key = '03';

// IF *OTHERWISE
IF *OTHERWISE;

//?Get Weight Processing
DO;

//?*****************   Weight Processing  ********************
//? 1. Set Weight processing to Yes & repeat while Yes
// WRK.Weightment in process Usr = CND.Yes
WRK.Weightment_in_process_Usr = 'Y';

//? 2. Perform the Get Weight screen, upon ENTER ...
//? 3. Perform the Accept Weight screen, pass the pen and head
//?       and wait for the scale to update the screen
//?       with the scale weight, and dates and times.
//?5.  After the auto. scale update, WW Resale Spread Weight is displayed
//?    * and If F22 the WW Resale Spread Weight is displayed
//?       ( for testing purposes only!)
//?***************************************************************
// WRK.TST Wgt = CON.*ZERO
WRK.TST_Wgt = *ZERO;

// WRK.TST Wgt Date = CON.*ZERO
WRK.TST_Wgt_Date = *ZERO;

// WRK.TST Wgt Time = CON.*ZERO
WRK.TST_Wgt_Time = *ZERO;

// WRK.TST Last Zero Date = CON.*ZERO
WRK.TST_Last_Zero_Date = *ZERO;

// WRK.TST Last Zero Time = CON.*ZERO
WRK.TST_Last_Zero_Time = *ZERO;

// WRK.*Return code = CND.*Normal
WRK.*Return_code = *BLANK;

//?  Allow user to display the accept screen then wait for F22
// PAR.Return Code USR = CND.*Normal
PAR.Return_Code_USR = *BLANK;

// Call program Zzz Accept Tattoo WgtInPV.
CALL PROGRAM(Zzz Accept Tattoo WgtInPV) ('PKKSPVR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(DTL.Name_USR);
PARAMETER(WRK.TST_Sequence_Number);
PARAMETER(DTL.TST_Head);
PARAMETER(WRK.TST_Wgt);
PARAMETER(WRK.TST_Wgt_Date);
PARAMETER(WRK.TST_Wgt_Time);
PARAMETER(WRK.TST_Last_Zero_Date);
PARAMETER(WRK.TST_Last_Zero_Time);
PARAMETER(DTL.Pen_Number);
PARAMETER(PAR.Return_Code_USR);
PARAMETER(DTL.Producer_Name_DRV);
PARAMETER(DTL.PL_Name);

CASE;

// IF PAR.Return Code USR is Create Spread
IF PAR.Return_Code_USR = 'CRTSPRD';

PGM.*Return_code = *BLANK;

RETURN;

ENDIF;

ENDDO;

ENDIF;

