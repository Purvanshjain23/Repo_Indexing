// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMP8E1R
// ?Date: 14.08.2025 Time: 03:43:45
// ?------------------------------------------------------------------------------------------------

//?USER: Validate key screen

EXECUTE FUNCTION(RTV Ship To Flag       RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1464722;
PARAMETER(KEY.CUSTOMER_NUMBER);
PARAMETER(LCL.Ship_To_Customer_Flag);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Ship To Customer = KEY.CUSTOMER NUMBER
LCL.Ship_To_Customer = KEY.CUSTOMER_NUMBER;

CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// Send error message - 'Customer Master not found.'
ERROR(USR0170);
MSGPARM(LCL.Ship_To_Customer);

ENDIF;

CASE;

// IF LCL.Ship To Customer Flag is No Use as Ship to Cust
IF LCL.Ship_To_Customer_Flag = 'N';

// Send error message - 'Invalid Ship To entered - Ship to Customer Flag is 'N'o.'
ERROR(USR2482);
MSGPARM(LCL.Ship_To_Customer);

ENDIF;

//?USER: Initialize detail screen (new record)

//?SAZ 07/06/09 Will now enter the Rcd Id code
// DTL.Usr Record ID = CND.Blank
DTL.Usr_Record_ID = *BLANK;

// DTL.Condition Name USR = CND.Blank
DTL.Condition_Name_USR = *BLANK;

//?USER: Initialize detail screen (existing record)

//?SAZ 07/06/09 Will now enter the Rcd Id code
// DTL.Usr Record ID = DB1.RECORD ID 3/4/5
DTL.Usr_Record_ID = DB1.RECORD_ID_3_4_5;

// DTL.Condition Name USR = Condition name of DTL.RECORD ID 3/4/5
DTL.Condition_Name_USR = RTVCND(DTL.RECORD_ID_3_4_5);

EXECUTE FUNCTION(Customer Name DRV) TYPE(DRVFLD)                                AC1631131;
PARAMETER(DTL.Customer_Name_DRV);
PARAMETER(DTL.CUSTOMER_NUMBER);
{
 //?Calculate derived field

 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(PAR.Ship_To_Customer);
 PARAMETER(PAR.Customer_Name_DRV);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?USER: Validate detail screen fields

//?SAZ 07/06/09 Validate the Rcd Id code
CASE;

// IF DTL.Usr Record ID is Payment
IF DTL.Usr_Record_ID = '5'/'6'/'7'/'8';

// DTL.Condition Name USR = Condition name of DTL.Usr Record ID
DTL.Condition_Name_USR = RTVCND(DTL.Usr_Record_ID);

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Invalid Record ID'
ERROR(USR4175);

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(Crt Cust Accr Payment CR) TYPE(CRTOBJ) FILE(ACCRUALS)          AC1856989;
PARAMETER(DTL.PRODUCT_CODE_0049572);
PARAMETER(DTL.INVOICE_NUMBER_0049582);
PARAMETER(DTL.CUSTOMER_NUMBER);
PARAMETER(DTL.DATE);
PARAMETER(DTL.Usr_Record_ID);
PARAMETER(DTL.DESCRIPTION_0049574);
PARAMETER(DTL.PRO);
PARAMETER(DTL.QUANTITY);
PARAMETER(DTL.AMOUNT);
PARAMETER(DTL.TERRITORY_0049586);
PARAMETER(DTL.LINE);
PARAMETER(DTL.DELETE);
PARAMETER(DTL.A_P_VENDOR#);
PARAMETER(DTL.REBATE);
PARAMETER(DTL.ACCRUAL);
PARAMETER(DTL.FRTC);
PARAMETER(DTL.TOTAL$);
PARAMETER(DTL.ACCRUAL_AMOUNT);

//?USER: Change DBF record

EXECUTE FUNCTION(Chg Accrual Trans     CH) TYPE(CHGOBJ) FILE(ACCRUALS)          AC1859028;
PARAMETER(DTL.PRODUCT_CODE_0049572);
PARAMETER(DTL.INVOICE_NUMBER_0049582);
PARAMETER(DTL.CUSTOMER_NUMBER);
PARAMETER(DTL.DATE);
PARAMETER(DTL.Usr_Record_ID);
PARAMETER(DTL.DESCRIPTION_0049574);
PARAMETER(DTL.PRO);
PARAMETER(DTL.QUANTITY);
PARAMETER(DTL.AMOUNT);
PARAMETER(DTL.TERRITORY_0049586);
PARAMETER(DTL.LINE);
PARAMETER(DTL.DELETE);
PARAMETER(DTL.A_P_VENDOR#);
PARAMETER(DTL.REBATE);
PARAMETER(DTL.ACCRUAL);
PARAMETER(DTL.FRTC);
PARAMETER(DTL.TOTAL$);
PARAMETER(DTL.ACCRUAL_AMOUNT);

