/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR ACKNOWLEDGEMENTS-  */
/*             CO#, FROM ORDER, TO ORDER, ENTRY DATE, REQ. SHIP DATE*/
/*             ORDER TYPE, & USER ID                                */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT ACKNOWLEDGEMENTS                              */
/*  DATE      -  3/27/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FRMORDN    - FROM ORDER                                */
/*          &TOORDRN    - TO ORDER                                  */
/*          &ENTDATN    - ENTRY DATE                                */
/*          &REQDATN    - SCHECULED SHIP DATE                       */
/*          &OTYPE      - ORDER TYPE - BLANK FOR ALL IN BILL TYPE   */
/*          &BILLTYP    - BILL ACT. TYPE - BLANK FOR CR & DR MEMOS  */
/*                                         1 FOR ORDERS             */
/*                                         2 FOR CREDIT MEMOS       */
/*                                         3 FOR DEBIT MEMOS        */
/*          &EXPSLS     - EXPORT SALES                              */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/*          &WHSE1      - WAREHOUSE 1                               */
/*          &WHSE2      - WAREHOUSE 2                               */
/*          &WHSE3      - WAREHOUSE 3                               */
/*          &WHSE4      - WAREHOUSE 4                               */
/*          &WHSE5      - WAREHOUSE 5                               */
/*          &WHSE6      - WAREHOUSE 6                               */
/*          &WHSE7      - WAREHOUSE 7                               */
/*          &WHSE8      - WAREHOUSE 8                               */
/*          &WHSE9      - WAREHOUSE 9                               */
/*          &WHSE10     - WAREHOUSE 10                              */
/*          &SOFLAG     - SELECT/OMIT FLAG                          */
/*          &EMTWHS     - EMAIL TO WAREHOUSE                        */
/*          &EMWHSS     - EMAIL THIS WAREHOUSE SELECTED             */
/*          &EMLSLS     - EMAIL TO SALESPERSON                      */
/********************************************************************/
/* RMC 06/23/04 IF OUTQ IS FAXQ, DO OVRPRTF NOT SBDPRTOVR           */
/* RMC 06/17/13 IF OUTQ IS BLANK, DONT PRINT IT, JUST SEND TO WHSE  */
/* LJB 01/28/15 IF PGMR THEN CHANGE OUTQ TO QPRINT3 (TESTING)       */
/* DN  12/15/20 R16637 - AS400 CONSIGNEE BLOCK WI 423               */
/*     REMOVED THE PAGE ROTATION OF 90 DEGREES. PDKOPFR PRTFIL WAS  */
/*     CHANGED TO USE DEVTYPE FROM '*SCS' TO '*AFPDS' & PAGE WIDTH  */
/*     FROM 95 TO 132.                                              */
/* PIO 06/09/23 REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPP FILE        */
/*              ADDED NEEDED OVRDBF AROUND THE COMMAND              */
/*              CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*              *GT TO > IN &E                                      */
/* SG  04/16/25 Added new parameter to send email to salesperson    */
/*              For each order, email id for salesperson will be    */
/*              read and acknowledgement will be sent by email      */
/* SG  04/24/25 Changed value for flag condition with field EMLSLS  */
/* Tag(S020798) from Y to K to stop emails in production*/
/* SG  05/02/25 SR - 3029516, Project - S029516, Tag - S029516      */
/*              Parameter length is changed for PDKOPFR             */
/*              Condition for flag EMLSLS is changed to Y from K    */
/*              Code commented as email wont be sent to multiple    */
/*              Salespersons. Subject line variations removed.      */
/********************************************************************/
 PDJWPCLP:   PGM        PARM(&COMPNYN &FRMORDN &TOORDRN &ENTDATN +
                          &REQDATN &REQDATN2 &OTYPE &SHPMTH +
                          &BILLTYP &EXPSLS &WHSE1 &WHSE2 &WHSE3 +
                          &WHSE4 &WHSE5 &WHSE6 &WHSE7 &WHSE8 &WHSE9 +
                          &WHSE10 &SOFLAG &OUTQ &HOLD &SAVE &COPYN +
                          &NIGHTQ &ACSDTTN &EMTWHS &EMWHSS &EMLSLS)
/* S020798                &NIGHTQ &ACSDTTN &EMTWHS &EMWHSS)                   */

/* PARMS                                                                      */
        DCL    &COMPNYN    *DEC                  /* Company Number (Passed)   */
        DCL    &FRMORDN    *DEC                  /* FROM ORDER     (Passed)   */
        DCL    &TOORDRN    *DEC                  /* TO ORDER       (Passed)   */
        DCL    &ENTDATN    *DEC                  /* ENTRY DATE     (Passed)   */
        DCL    &REQDATN    *DEC                  /* SCH SHIP DATE  (Passed)   */
        DCL    &REQDATN2   *DEC                  /* SCH SHIP DATE  (Passed)   */
        DCL    &OTYPE      *CHAR   (2)           /* Order Type                */
        DCL    &SHPMTH     *CHAR   (2)           /* SHIPPING METHOD           */
        DCL    &BILLTYP    *CHAR   (1)           /* Billing Activity Type     */
        DCL    &EXPSLS     *CHAR   (1)           /* EXPORT SALES       pe     */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &NIGHTQ     *CHAR   (10)          /* Night Job Queue           */
        DCL    &PGMO       *CHAR    10           /*  PRINTER FILE  */
        DCL    &SOFLAG     *CHAR   (1)           /* WAREHOUSE                 */
        DCL    &WHSE1      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE2      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE3      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE4      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE5      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE6      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE7      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE8      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE9      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE10     *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &ACSDTTN    *DEC                  /* ACTUAL SHIP DT (Passed)   */
        DCL    &EMTWHS     *CHAR   (1)           /* Email To Warehouse select */
        DCL    &EMWHSS     *CHAR   (3)           /* Email to this Warehouse   */
 /* S020798 - Added new parameter to send email to salesperson                */
        DCL    &EMLSLS     *CHAR   (1)           /* Email To Salesperson      */
 /* S020798 - Added new parameter to store email addresses                    */
 /*     DCL    &DISTLST    *CHAR   (1000)        /* Distribution List         */
 /* S029516 - Length of field &DISTLST changed to 50 from 1000                */
        DCL    &DISTLST    *CHAR   (50)          /* Distribution List         */

        DCL    &B          *CHAR    30           /*  QRY-SEL CO.#  */
        DCL    &C          *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &CC         *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &CCC        *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &D          *CHAR    25           /*  QRY-EXPORT SALES  */
        DCL    &DD         *CHAR    30           /*  QRY-SEL ENTRY DATE  */
        DCL    &DDD        *CHAR    50           /*  QRY-SEL REQ. SHIP DATE  */
        DCL    &DDDD       *CHAR    30           /*  QRY-SEL ACT. SHIP DATE  */
        DCL    &DDDDD      *CHAR    30           /*  QRY-SEL SHPPING METHOD  */
        DCL    &F          *CHAR    100
 /*PIO  DCL    &E          *CHAR   275       */
 /*PIO*/DCL    &E          *CHAR   375           /*  QRY COMPLETE SEL. */
        DCL    &COMMAND    *CHAR   (512)

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMPANY    *DEC    (3 0)         /* Company Number            */
/* Name of the distriubtion list that will be used                 */
        DCL    &DISTNME    *CHAR   (60)
        DCL    &EDESC      *CHAR   (50)          /* Email Description         */
        DCL    &ITDESC     *CHAR   (30)          /* Internal desc title       */
        DCL    &EMVALU     *CHAR   (10)          /* Email Distribution Code   */
        DCL    &EADDR      *CHAR   (50)          /* EMAIL Address             */
        DCL    &FRORDR     *DEC    (7 0)         /* From ORDER                */
        DCL    &TOORDR     *DEC    (7 0)         /* To ORDER                  */
        DCL    &ENTDAT     *DEC    (7 0)         /* ENTRY DATE                */
        DCL    &REQDAT     *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &REQDAT2    *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &ACTSDAT    *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &COMMAND    *CHAR   (512)         /* FOR PRT OVERRIDE          */
        DCL    &USER       *CHAR   (10)
        DCL    &GRPPRF     *CHAR   (10)
/* S020798 - New fields added                                                 */
        DCL    &JOBNAME    *CHAR   (10)
        DCL    &JOBNBR     *CHAR   (10)

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* ACK COMPLETE              */
        DCL    &FRMORDA    *CHAR    7            /* FROM ORDER                */
        DCL    &TOORDRA    *CHAR    7            /* TO ORDER       (Passed)   */
        DCL    &ENTDATA    *CHAR    7            /* ENTRY DATE     (Passed)   */
        DCL    &REQDATA    *CHAR    7            /* REQ SHIP DATE  (Passed)   */
        DCL    &REQDATA2   *CHAR    7            /* REQ SHIP DATE  (Passed)   */
        DCL    &ACSDATA    *CHAR    7            /* ACTUAL SHP DT  (Passed)   */
        DCL    &BLK50      *CHAR    50           /* BLANKS                    */

             RTVJOBA    USER(&USER)
             RTVUSRPRF  USRPRF(&USER) GRPPRF(&GRPPRF)
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             CHGVAR     VAR(&PGMO) VALUE(PDKOPFR$)
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&FRORDR) VALUE(&FRMORDN)
             CHGVAR     VAR(&FRMORDA) VALUE(&FRORDR)
             CHGVAR     VAR(&TOORDR) VALUE(&TOORDRN)
             CHGVAR     VAR(&TOORDRA) VALUE(&TOORDR)
             CHGVAR     VAR(&ENTDAT) VALUE(&ENTDATN)
             CHGVAR     VAR(&ENTDATA) VALUE(&ENTDAT)
             CHGVAR     VAR(&REQDAT) VALUE(&REQDATN)
             CHGVAR     VAR(&REQDATA) VALUE(&REQDAT)
             CHGVAR     VAR(&REQDAT2) VALUE(&REQDATN2)
             CHGVAR     VAR(&REQDATA2) VALUE(&REQDAT2)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)
             CHGVAR     VAR(&ACTSDAT) VALUE(&ACSDTTN)
             CHGVAR     VAR(&ACSDATA) VALUE(&ACTSDAT)
/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED TO SELECT ACKS.               */
/*********************************************************************/
/*  IF CO. NUMBER SELECTED  */
             IF         COND(&COMPA *NE '000') THEN(DO)
 /*PIO       CHGVAR     VAR(&B) VALUE('BEAIC3 *EQ ' *CAT &COMPA) */
 /*PIO*/     CHGVAR     VAR(&B) VALUE('BEAIC3  =  ' *CAT &COMPA)
             ENDDO

/*  IF FROM ORDER IS ENTERED */

             IF         COND(&FRMORDA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&CC) VALUE('*AND BEC4NB *GE ' *CAT &FRMORDA) */
 /*PIO*/     CHGVAR     VAR(&CC) VALUE(' AND BEC4NB  >= ' *CAT &FRMORDA)
             ENDDO

/*  IF TO ORDER IS ENTERED */
             IF         COND(&TOORDRA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&CCC) VALUE('*AND BEC4NB *LE ' *CAT &TOORDRA) */
 /*PIO*/     CHGVAR     VAR(&CCC) VALUE(' AND BEC4NB <=  ' *CAT &TOORDRA)
             ENDDO

/*  IF ENTRY DATE IS SELECTED */

             IF         COND(&ENTDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DD) VALUE('*AND BECXDT *EQ ' *CAT &ENTDATA) */
 /*PIO*/     CHGVAR     VAR(&DD) VALUE(' AND BECXDT  =  ' *CAT &ENTDATA)
             ENDDO

/*  IF SCHEDULED SHIP DATE IS SELECTED */

             IF         COND(&REQDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDD) VALUE('*AND BEAODT *GE ' *CAT +   +
                          &REQDATA *BCAT '*AND BEAODT *LE ' *CAT +  +
                          &REQDATA2)                               */
 /*PIO*/     CHGVAR     VAR(&DDD) VALUE(' AND BEAODT >=  ' *CAT +
                          &REQDATA *BCAT ' AND BEAODT  <= ' *CAT +
                          &REQDATA2)
             ENDDO

/*  IF ACTUAL SHIPPED DATE IS SELECTED */

             IF         COND(&ACSDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDDD) VALUE('*AND BEGNDT *EQ ' *CAT + +
                          &ACSDATA)                               */
 /*PIO*/     CHGVAR     VAR(&DDDD) VALUE(' AND BEGNDT =   ' *CAT +
                          &ACSDATA)
             ENDDO

/*  IF SHIPPING METHOD IS SELECTED     */

             IF         COND(&SHPMTH *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDDDD) VALUE('*AND BEQ2CD *EQ "' *CAT + +
                          &SHPMTH *CAT '"')                          */
 /*PIO*/     CHGVAR     VAR(&DDDDD) VALUE(' AND BEQ2CD  =  "' *CAT +
                          &SHPMTH *CAT '"')
             ENDDO

/*  ORDER TYPE - IF NOT BLANK, INCLUDE ONLY THAT SELECT, ELSE  */
/*   INCLUDE ANY EXCEPT 'I ' (INVOICED FROM CONFIRMATION)      */
             IF         COND(&OTYPE *NE '  ') THEN(DO)
  /*PIO      CHGVAR     VAR(&C) VALUE('*AND BEJNCD *EQ "' *CAT &OTYPE + +
                        *CAT '"')                                      */
 /*PIO*/     CHGVAR     VAR(&C) VALUE(' AND BEJNCD =   "' *CAT &OTYPE +
                        *CAT '"')
             ENDDO

             IF         COND(&EXPSLS *EQ 'N') THEN(DO)
  /*PIO      CHGVAR     VAR(&D) VALUE('*AND BEU2ST *NE ' *CAT '"Y"') */
  /*PIO*/    CHGVAR     VAR(&D) VALUE(' AND BEU2ST <>  ' *CAT '"Y"')
             ENDDO
             IF         COND(&EXPSLS *EQ 'E') THEN(DO)
  /*PIO      CHGVAR     VAR(&D) VALUE('*AND BEU2ST *EQ ' *CAT + +
                         '"Y"')                                */
  /*PIO*/    CHGVAR     VAR(&D) VALUE(' AND BEU2ST  =  ' *CAT +
                         '"Y"')
             ENDDO

  /*PIO*/    CHGVAR    VAR(&F) VALUE(' AND BEGJST = "N" AND ' *CAT +
                        ' BEGWST IN ("L","A","C","R","E","H","I")')


  /*PIO      CHGVAR     VAR(&E) VALUE(&B *BCAT &C *BCAT &CC *BCAT +  +
                          &CCC *BCAT &D *BCAT &DD *BCAT &DDD *BCAT + +
                          &DDDD *BCAT &DDDDD)                     */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(&B *BCAT &C *BCAT &CC *BCAT +
                          &CCC *BCAT &D *BCAT &DD *BCAT &DDD *BCAT +
                          &DDDD *BCAT &DDDDD *BCAT &F)

  /*PIO      OVRDBF     FILE(OPBFCPLN) SHARE(*YES)        +
             OPNQRYF    FILE((OPBFCPLN)) QRYSLT(&E) KEYFLD((BEAIC3) + +
                          (BEC4NB)) SEQONLY(*YES)    */

  /*PIO*/    OVRDBF     FILE(OPBFCPP) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP Where  ' *BCAT &E +
                          *BCAT ' ORDER BY BEAIC3 ASC, BEC4NB ASC, +
                          BEBKC7 ASC') OPNID(OPBFCPLN) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@BFCPYX) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPLN) TOFILE(OPBFCPP) LVLCHK(*NO) +
                           OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
    /* R16637 DN 12/15/20-Removed Page Rotation. */
         /*  IF         COND(&OUTQ *EQ 'FAXQ') THEN(OVRPRTF +
                          FILE(PDKOPFR$) PAGRTT(90) OUTQ(PRKFLIB/FAXQ)) */
             IF         COND(&OUTQ *EQ 'FAXQ') THEN(OVRPRTF +
                          FILE(PDKOPFR$) OUTQ(PRKFLIB/FAXQ))
             ELSE       CMD(DO)
             IF         COND(&OUTQ *NE '      ') THEN(DO)
/*  RMC 12-22-20   SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDKOPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE) +
                          USRDTA(&FRMORDA) LETTER(*YES)               */
             OVRPRTF    FILE(PDKOPFR$) OUTQ(&OUTQ) COPIES(&COPY) +
                          HOLD(&HOLD) SAVE(&SAVE) USRDTA(&FRMORDA)
             MONMSG     MSGID(CPF2702 CPF0000)

/* IF A PGMR IS RUNNING THIS PGM THEN CHANGE THE OUTQ TO A TEST OUTQ */
             IF         COND(&GRPPRF *EQ 'SBDPGMR') THEN(DO)
             CHGVAR     VAR(&OUTQ) VALUE(QPRINT3)
             ENDDO

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
             ENDDO
             ENDDO

/*********************************************************************/
/*   CALL PRINT PROGRAM -  IF OUTQ NOT BLANK - IF BLANK THEY DIDN'T  */
/*   SELECT TO PRINT IT.. JUST SEND TO THE WAREHOUSE                 */
/*********************************************************************/
             IF         COND(&OUTQ *NE '      ') THEN(DO)
             CALL       PGM(PDKOPFR) PARM(' ' &COMPANY &BILLTYP +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 &WHSE5 &WHSE6 +
                          &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG &DISTLST)
/* S020798                &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG)      */
             ENDDO
/*********************************************************************/
/* Email of the Acknowledgement if request and Warehouse Dist        */
/* is found                                                          */
/*********************************************************************/
             IF         COND(&EMTWHS *EQ 'Y') THEN(DO)
/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/* TO QPRINT 2 DUE TO REPORT COULD ALREAD BE PRINTED                */
/********************************************************************/

    /* R16637 DN 12/15/20-Removed Page Rotation. */
         /*  OVRPRTF    FILE(PDKOPFR$) PAGRTT(90) OUTQ(QPRINT2) */
             OVRPRTF    FILE(PDKOPFR$) OUTQ(QPRINT2)

/*********************************************************************/
/*   CALL PRINT PROGRAM -                                            */
/*   AGAIN TO MAKE SURE THE SPOOL FILES DOES NOT GO AWAY             */
/*********************************************************************/
             CALL       PGM(PDKOPFR) PARM(' ' &COMPANY &BILLTYP +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 &WHSE5 &WHSE6 +
                          &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG &DISTLST)
/* S020798                &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG)      */

/* Get Warehouse Distribution List for email                         */

             CHGVAR     VAR(&EMVALU) VALUE('SL-ACKNOWL')

             CALL       PGM(PBHVXFR) PARM(' ' &EMWHSS &EMVALU &EADDR)

             CHGVAR     VAR(&EDESC) VALUE(&BLK50)

/*** WAREHOUSE SELECTION ****/
             IF         COND(&FRMORDA *EQ '       ') THEN(DO)
             CHGVAR     VAR(&ITDESC)  VALUE('Acknowledgement')
             CHGVAR     VAR(&EDESC) VALUE(&ITDESC *BCAT 'for' *BCAT +
                          'Warehouse' *BCAT &EMWHSS)
             ENDDO

/*** ORDER/WAREHOUSE SEL ****/
             IF         COND(&FRMORDA *NE '       ') THEN(DO)
             CHGVAR     VAR(&ITDESC)  VALUE('Acknowledgement for Order')
             CHGVAR     VAR(&EDESC) VALUE(&ITDESC *BCAT &FRMORDA +
                          *BCAT ' - ' *BCAT +
                          'WHS' *BCAT &EMWHSS)
             ENDDO

             CHGVAR     VAR(&DISTNME) VALUE('Distribution List: ' +
                          *BCAT &EADDR)


/* ---------------------------------------------------------------   */
/* Email of the Acknowledgement report                               */
/* ---------------------------------------------------------------   */
             IF         COND(&EADDR *NE &BLK50) THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EADDR) SUBJECT(&EDESC) +
                          MSG(&DISTNME) +
                          ATTLIST((* *PDF *N PDKOPFR$))
             ENDDO

             ENDDO

/* ---------------------------------------------------------------   */
/* S020798 - Changes Start - Get email address for salesperson and send   */
/* order acknowledgement to salesperson by email                          */

/* S020798 - CHANGED TEH VALUE FROM Y TO K TO STOP EMAILS IN PRODUCTION */
/* S029516   IF         COND(&EMLSLS *EQ 'K') THEN(DO)                  */
/* S029516 - Changed above condition to check &EMLSLS to be Y           */
             IF         COND(&EMLSLS *EQ 'Y') THEN(DO)

             RTVJOBA    JOB(&JOBNAME) USER(&USER) NBR(&JOBNBR)
             CHKSPLF    SPLF(PDKOPFR$) JOB(&JOBNBR/&USER/&JOBNAME) +
                          SPLNBR(*LAST)
             MONMSG     MSGID(TAA9883) EXEC(DO)
/* Override printer file with user specified values to Qprint2 as   */
/* report could already be printed                                  */
             OVRPRTF    FILE(PDKOPFR$) OUTQ(QPRINT2)

/* Call print program again in case spool might have been gone       */
             CALL       PGM(PDKOPFR) PARM(' ' &COMPANY &BILLTYP +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 &WHSE5 &WHSE6 +
                          &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG &DISTLST)
             ENDDO

/* Set message for email                                             */
/* S029516 - Commented below code as email will be sent to only 1    */
/* Salesperson for an order                                          */
/*           CHGVAR     VAR(&ITDESC)  VALUE('Order Acknowledgement') */
/*           IF         COND(&FRMORDA *EQ &TOORDRA *AND &FRMORDA +   */
/*                              *NE ' ') THEN(DO)                    */
/*           CHGVAR     VAR(&EDESC) VALUE(&ITDESC *BCAT 'for Order' +*/
/*                        *BCAT '- ' *BCAT  &FRMORDA)                */

/*           CHGVAR     VAR(&DISTNME) VALUE('Distribution List: ' +  */
/*                        *BCAT &DISTLST)                            */
/*           ENDDO                                                   */
/*           ELSE       CMD(DO)                                      */
/*           CHGVAR     VAR(&EDESC) VALUE(&ITDESC *BCAT 'for' +      */
/*                        *BCAT 'multiple orders')                   */

/*           CHGVAR     VAR(&DISTNME) VALUE('Distribution List:' +   */
/*                        *BCAT 'Multiple Salesperson')              */
/*           ENDDO                                                   */
/* S029516 - Set subject and message for email                       */
/* Set message for email                                             */
             CHGVAR     VAR(&EDESC)  VALUE('Order Acknowledgement' +
                          *BCAT 'for Order -' *BCAT  &FRMORDA)

             CHGVAR     VAR(&DISTNME) VALUE('Distribution List: ' +
                          *BCAT &DISTLST)

/* Email of the Acknowledgement report                               */
             IF         COND(&DISTLST *NE &BLK50) THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&DISTLST) SUBJECT(&EDESC) +
                          MSG(&DISTNME) ATTLIST((* *PDF *N PDKOPFR$))
             ENDDO
             ENDDO
/* S020798 - Changes end                                                  */

/*   CLOSE OPEN QUERY FILE -
/*********************************************************************/

             CLOF       OPNID(OPBFCPLN)
   /*PIO     DLTOVR     FILE(OPBFCPLN)     */
             DLTOVR     FILE(OPBFCPLN) LVL(*JOB) /*PIO*/

 END:        ENDPGM
