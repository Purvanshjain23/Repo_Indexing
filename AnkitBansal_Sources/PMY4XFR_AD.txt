// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMY4XFR
// ?Date: 14.08.2025 Time: 03:44:35
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification -
DO;

//?E02201 - Susan Mason - 7/25/2012
//?E02201 Allow the selection of non commission as well as commission
//?If the Accrual did not create the header, then the order was missing
//?This process is being looked at for this enhancement
ENDDO;

//?DEFAULT: Invoice Date
CASE;

// IF PAR.Invoice Date is not entered
IF PAR.Invoice_Date = *ZERO;

// PAR.Invoice Date = JOB.*Job date
PAR.Invoice_Date = JOB.*Job_date;

ENDIF;

//?*** BUILD:  Brokered Orders
EXECUTE FUNCTION(Bld WF Fax/Email Hdr  RT) TYPE(RTVOBJ) FILE(POC5REP)           AC1902004;
PARAMETER(PAR.Invoice_Date);
PARAMETER(PAR.Accrual_Type);
{
 //?USER: Process Data record

 // PGM.*Record selected = CND.*YES
 PGM.*Record_selected = 'Y';

 //?SEL: Record Status
 CASE;

 // IF DB1.Record Status is Not Active
 IF DB1.Record_Status = *BLANK/'D'/'I';

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?SEL: Broker Code
 CASE;

 // IF PAR.Accrual Type is Commission
 IF PAR.Accrual_Type = 'CM';

 CASE;

 // IF DB1.Payee Type is Buyer Group
 IF DB1.Payee_Type = 'BG';

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?SEL: Broker Code
 // IF PAR.Accrual Type is Buyer Group/Prod Rebate
 IF PAR.Accrual_Type = 'BG'/'PR';

 CASE;

 // IF DB1.Payee Type is Broker
 IF DB1.Payee_Type = 'BR';

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 ENDIF;

 //?SEL: Email Only
 CASE;

 // IF DB1.Broker Fax/Email Inv is Not Email
 IF DB1.Broker_Fax_Email_Inv = 'B'/'F'/*BLANK;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 CASE;

 // IF PGM.*Record selected is *YES
 IF PGM.*Record_selected = 'Y';

 //?This is research of e02201
 //?This bld will be replaced with using the Sales History
 //?and the dates ranages will be verify with the Customer Accrual
 //?and only the customers that are with a date ranage
 //?get back with purv on this one.
 EXECUTE FUNCTION(Bld WF Fax/Email Hdr  RT) TYPE(RTVOBJ) FILE(PDICCPP)           AC1901995;
 PARAMETER(PAR.Invoice_Date);
 PARAMETER(PAR.Accrual_Type);
 PARAMETER(DB1.Broker_Code);
 PARAMETER(LCL.Create_Requested);
 {
  //?USER: Initialize routine

  // LCL.Order Number = CON.*ZERO
  LCL.Order_Number = *ZERO;

  // PAR.Create Requested = CND.N
  PAR.Create_Requested = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.Order Number NE LCL.Order Number
  IF DB1.Order_Number <> LCL.Order_Number;

  EXECUTE FUNCTION(Crt WF Fax/Email Hdr  CR) TYPE(CRTOBJ) FILE(PMEQCPP)           AC1902016;
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Broker_Code);
  // PAR.Create Requested = CND.Yes
  PAR.Create_Requested = 'Y';

  // LCL.Order Number = DB1.Order Number
  LCL.Order_Number = DB1.Order_Number;

  ENDIF;

 }

 CASE;

 // IF LCL.Create Requested is Yes
 IF LCL.Create_Requested = 'Y';

 EXECUTE FUNCTION(Create WF Fax/Email Drive) TYPE(CRTOBJ) FILE(PPARCPP)          AC1718583;
 PARAMETER(DB1.Broker_Code);
 PARAMETER('B');
 PARAMETER(DB1.Broker_Fax_Number);
 PARAMETER(DB1.Broker_Email_Address);
 PARAMETER(LCL.Fax_Driver_Unused_1);
 PARAMETER(LCL.Fax_Driver_Unused_2);
 PARAMETER(LCL.Fax_Driver_Unused_3);
 PARAMETER(LCL.Fax_Driver_Unused_4);
 ENDIF;

 ENDIF;

}


// Call program Bld WF Fax/Email Dtl  XF.
CALL PROGRAM(Bld WF Fax/Email Dtl  XF) ('PMY5XFR');

