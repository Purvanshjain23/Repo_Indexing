// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKT3XFR
// ?Date: 14.08.2025 Time: 02:50:28
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Number
ENDDO;

EXECUTE FUNCTION(Clc Adj lv Wgt/Adj Yld RT) TYPE(RTVOBJ) FILE(PKA1CPP)          AB1151605;
{
 //?USER: Process Data record

 CASE;

 // IF DB1.TH Hog Class Type is Market
 IF DB1.TH_Hog_Class_Type = 'M';

 // OR DB1.TH Hog Class Type is Subject
 OR DB1.TH_Hog_Class_Type = 'S';

 //?Calculate Adj Live Weight
 CASE;

 // IF DB1.TH Head Received EQ DB1.TH Head Killed
 IF DB1.TH_Head_Received = DB1.TH_Head_Killed;

 // WRK.TH Adj Live Wgt = DB1.TH Live Wgt
 WRK.TH_Adj_Live_Wgt = DB1.TH_Live_Wgt;

 //?Calculate Adj Live Weight
 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.TH Adj Live Wgt = DB1.TH Head Killed * DB1.TH Avg Live Wgt *
 WRK.TH_Adj_Live_Wgt = DB1.TH_Head_Killed * DB1.TH_Avg_Live_Wgt;

 ENDIF;

 //?Calculate Adj Actual Yield
 DO;

 CASE;

 // IF WRK.TH Adj Live Wgt NE WRK.Zero USR
 IF WRK.TH_Adj_Live_Wgt <> WRK.Zero_USR;

 //?actual yield percent: hot w / live wgt * 100
 // Adj Actual Yield
 WRK.TH_Adj_Actual_Yield = ( DB1.TH_Hot_Wgt / WRK.TH_Adj_Live_Wgt ) * 100;

 ENDIF;

 ENDDO;

 EXECUTE FUNCTION(Chg Adj lv Wgt/Adj Yld CH) TYPE(CHGOBJ) FILE(PKA1CPP)          AB1151612;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(WRK.TH_Adj_Live_Wgt);
 PARAMETER(WRK.TH_Adj_Actual_Yield);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

 ENDIF;

}


