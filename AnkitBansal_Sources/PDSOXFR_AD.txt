// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDSOXFR
// ?Date: 14.08.2025 Time: 03:36:00
// ?------------------------------------------------------------------------------------------------

//?Execute user function

CASE;

// IF PAR.Production Date EQ JOB.*Job date
IF PAR.Production_Date = JOB.*Job_date;

// AND PAR.Production Type is Plan
AND PAR.Production_Type = 'P';

// IF PAR.Fresh Chilling Time is GT Zero
IF PAR.Fresh_Chilling_Time > *ZERO;

// AND PAR.Avail Ship Date USR EQ JOB.*Job date
AND PAR.Avail_Ship_Date_USR = JOB.*Job_date;

// IF PAR.Production Date LT JOB.*Job date
IF PAR.Production_Date < JOB.*Job_date;

// AND PAR.Production Type is Plan
AND PAR.Production_Type = 'P';

// AND PAR.Fresh Chilling Time is GT Zero
AND PAR.Fresh_Chilling_Time > *ZERO;

// IF PAR.Production Date LT JOB.*Job date
IF PAR.Production_Date < JOB.*Job_date;

// AND PAR.Avail Ship Date USR GT JOB.*Job date
AND PAR.Avail_Ship_Date_USR > JOB.*Job_date;

//?**** Sales = scheduled order only **** Unscheduled for show only
//?Calculate Production Available and PA
// IF *OTHERWISE
IF *OTHERWISE;

//?Retrieve/Calculate Weight Scheduled Shipments
CASE;

// IF PAR.Avail Dsp/Prt Type USR is Display Detail
IF PAR.Avail_Dsp_Prt_Type_USR = 'D';

// OR PAR.Avail Dsp/Prt Type USR is Print Detail
OR PAR.Avail_Dsp_Prt_Type_USR = 'L';

CASE;

// IF PAR.Piece Count Item is Not Yes
IF PAR.Piece_Count_Item = *BLANK/'N';

// AND PAR.Unit Weight is Greater than zero
AND PAR.Unit_Weight > *ZERO;

// Sched Shipments (No Dec)
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Sched_Ship_USR + ( PAR.Weight_Scheduled_SUM             +
/ PAR.Unit_Weight 'H' );

// Inv Reserved (ie.ALLOC)
PAR.Quantity_Inv_Resrvd_USR = PAR.Weight_Inv_Reserved_SUM / PAR.Unit_Weight 'H';

// Unscheduled ship(ie.ORDS)
PAR.Quantity_Unsched_Ship_USR = PAR.Weight_Unscheduled_SUM / PAR.Unit_Weight 'H';

// Prod Reserved (ie.ALLOC)
PAR.Quantity_Prod_Resrvd_USR = PAR.Weight_Prd_Reserved_SUM / PAR.Unit_Weight 'H';

// IF PAR.Piece Count Item is yes
IF PAR.Piece_Count_Item = 'Y';

// AND PAR.Pieces Per Bag is GT Zero
AND PAR.Pieces_Per_Bag > *ZERO;

// AND PAR.Bags Per Unit is GT Zero
AND PAR.Bags_Per_Unit > *ZERO;

// PAR.Quantity Sched Ship USR = PAR.Quantity Scheduled SUM
PAR.Quantity_Sched_Ship_USR = PAR.Quantity_Scheduled_SUM;

// PAR.Quantity Inv Resrvd USR = PAR.Quantity Inv Reserved SUM
PAR.Quantity_Inv_Resrvd_USR = PAR.Quantity_Inv_Reserved_SUM;

// PAR.Quantity Unsched Ship USR = PAR.Quantity Unscheduled SUM
PAR.Quantity_Unsched_Ship_USR = PAR.Quantity_Unscheduled_SUM;

// PAR.Quantity Prod Resrvd USR = PAR.Quantity Prd Reserved SUM
PAR.Quantity_Prod_Resrvd_USR = PAR.Quantity_Prd_Reserved_SUM;

ENDIF;

ENDIF;

//?Calculate Production & Production Reserved
CASE;

// IF PAR.Piece Count Item is Not Yes
IF PAR.Piece_Count_Item = *BLANK/'N';

// AND PAR.Unit Weight is Greater than zero
AND PAR.Unit_Weight > *ZERO;

// Production (No Dec)
PAR.Quantity_Production_USR = ( ( PAR.PS_Weight_Standard + PAR.PS_Weight_Prod_Adj )                +
- PAR.PS_Weight_Converted ) / PAR.Unit_Weight 'H';

// Prod Reserved (ie. ALLOC)
PAR.Quantity_Prod_Resrvd_USR = PAR.Quantity_Prod_Resrvd_USR - (                                    +
PAR.PS_Weight_Prod_Allocated / PAR.Unit_Weight 'H' );

//?Calculate Production & Production Reserved
// IF PAR.Piece Count Item is yes
IF PAR.Piece_Count_Item = 'Y';

// AND PAR.Pieces Per Bag is GT Zero
AND PAR.Pieces_Per_Bag > *ZERO;

// AND PAR.Bags Per Unit is GT Zero
AND PAR.Bags_Per_Unit > *ZERO;

//? **If Piece count item use  PIECE fields
// Production (No Dec)
PAR.Quantity_Production_USR = ( ( PAR.PS_Pieces_Standard + PAR.PS_Pieces_Prod_Adj )                +
- PAR.PS_Pieces_Converted ) / ( PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) + 'H';

// Prod Reserved (ie. ALLOC)
PAR.Quantity_Prod_Resrvd_USR = PAR.Quantity_Prod_Resrvd_USR - (                                    +
PAR.PS_Pieces_Prod_Allocated / ( PAR.Pieces_Per_Bag * PAR.Bags_Per_Unit ) 'H' );

ENDIF;

//?**** Sales = scheduled order only **** Unscheduled for show only
// PAR.Quantity Sales USR = PAR.Quantity Sched Ship USR
PAR.Quantity_Sales_USR = PAR.Quantity_Sched_Ship_USR;

// PAR.Production Date USR = PAR.Production Date
PAR.Production_Date_USR = PAR.Production_Date;

//?Calculate Production Available and PA
// Production Avail
PAR.Quantity_Prod_Avail_USR = ( ( PAR.Quantity_Inv_Avail_USR                                       +
+ PAR.Quantity_Inv_Resrvd_USR ) + PAR.Quantity_Production_USR )                                   +
+ PAR.Quantity_Prod_Resrvd_USR;

// Availability
PAR.Quantity_Available_USR = PAR.Quantity_Prod_Avail_USR - PAR.Quantity_Sched_Ship_USR;

ENDIF;

