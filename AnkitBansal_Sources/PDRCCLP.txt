/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  PRINT PROGRAM WITH COMPANY, WAREHOUSE, ITEM,        */
/*              ITEM STR TYPE, ITEM STR GROUP, ITEM STR GROUP,      */
/*              FROM DATE, TO DATE, TRANSACTION TYPES, REASON CODES,*/
/*              USER ID, AND REPORT TYPE                            */
/*              OPEN QUERY FILES OVER IC TRANSACTION DETAIL         */
/*                                                                  */
/*  COMPANY   - SEABOARD CORP                                       */
/*  SYSTEM    - INVENTORY CONTROL                                   */
/*  DATE      - 06/14/95                                            */
/*                                                                  */
/*  NOTE      - THIS PROGRAM IS ALSO CALLED FROM                    */
/*              INVNIGHTTRS AND INVNIGHTTRN                         */
/*                                                                  */
/********************************************************************/
/*  MODIFICATIONS:                                                 */
/*  CENTONZE 11/5/98  ADDED FROM/THRU TIME PARMS                   */
/*                    QRYSLT USES  &U,&V VARIABLES                 */
/*  CENTONZE 06/07/01 ADDED COMP. TO SELECT FOR                    */
/*                    PDKLREP FILE - &W VARIABLE                   */
/*  DROGE    10/26/04 ADDED INVENTORY TRANS. ID                    */
/*  RMC      03/09/06 FOR JFLD WITH PDKLREP, JOIN COMPANY TOO.     */
/*  BUSER    01/25/07 ADDED "INCLUDE ZERO QUANTITIES"              */
/*           REMOVED THE SBDPRTOVR - REPLACED WITH OVRPRTF         */
/*           REPLACED THE HEADER/FOOTER FOR ALL PRINTER FILES      */
/*  MASON S  03/04/09 PASS IN THE EMAIL ADDRESS                    */
/*           CREATE DATE TO WORK FILE AND SEND THE WORK FILE       */
/*  BUSER    02/10/10 E000523  REMOVE THE SEQUEL VIEW. IF EMAIL    */
/*           IS REQUESTED, USE ESEND TO SEND A COPY OF THE         */
/*           SPOOLED REPORT.                                       */
/*  RMC      03/21/13 E2516   OVRPRTF - MAXRCDS FROM DFT TO 200000*/
/*  SLM      09/20/13 C0000   NOT GETTING SPREAD SHEET BUT SHOULD */
/*           USER SELECTING TO MUCH DATA NO NEED FOR CHANTGES     */
/*           EXCEPT FOR DMPCLPPGM SO I COULD SEE WHAT WAS         */
/*           WRONG                                                */
/*  RMC      05/20/22 DDSDDL  REPLACE OPNQRYF WITH OPNSQLF        */
/*           ADDED NEEDED OVRDBF AROUND THE COMMAND.              */
/*           CHANGE *AND/*OR TO AND/OR                            */
/********************************************************************/
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - TO DATE                                   */
/*          &FTIMEL     - FROM TIME                                 */
/*          &TTIMEL     - TO TIME                                   */
/*          &WHSE       - WAREHOUSE CODE                            */
/*          &ITEM       - ITEM CODE                                 */
/*          &ITMTYP     - ITEM STR TYPE                             */
/*          &ITMGRP     - ITEM STR GROUP                            */
/*          &ITMCLS     - ITEM STR CLASS                            */
/*          &TTYPE1     - TRANSACTION TYPE 1                        */
/*          &TTYPE2     - TRANSACTION TYPE 2                        */
/*          &TTYPE3     - TRANSACTION TYPE 3                        */
/*          &TTYPE4     - TRANSACTION TYPE 4                        */
/*          &RSN1       - REASON CODE 1                             */
/*          &RSN2       - REASON CODE 2                             */
/*          &RSN3       - REASON CODE 3                             */
/*          &RSN4       - REASON CODE 4                             */
/*          &USER       - USER ID                                   */
/*          &RPTTYP     - REPORT TYPE                               */
/*          &DATETYP    - DATE TYPE                                 */
/*          &ITMTYPL    - ITEM TYPE                                 */
/*          &ITMGRPL    - ITEM GROUP                                */
/*          &ITMCLSL    - ITEM CLASS                                */
/*          &SHFT       - SHIFT NUMBER (BLANK = ALL)                */
/*          &EXPDOM     - EXPORT/DOMESTIC (BLANK = ALL)             */
/*          &AVLGRP     - AVAIL GROUP     (BLANK = ALL)             */
/*          &TRNID      - INVENTORY TRANS. ID (BLANK = ALL)         */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD                                      */
/*          &SAVE       - SAVE                                      */
/*          &COPIESL    - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/********************************************************************/
 PDRCCLP:    PGM        PARM(&PGM &COMPL &FDATEL &TDATEL &WHSE +
                          &ITEML &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &DATETYP &ITMTYPL &ITMGRPL &ITMCLSL +
                          &ZEROQTY &SHFT &EXPDOM &AVLGRP &FTIMEL +
                          &TTIMEL &TRNID &OUTQ &HOLD &SAVE &COPIESL +
                          &EMAIL)

             DCL        &COPIESL    *DEC
             DCL        &COPIES     *DEC     LEN(3 0)
             DCL        &COMPL      *DEC         /*  CO. #       */
             DCL        &COMP       *DEC     LEN(3 0)
             DCL        &FDATEL     *DEC        /*  FROM DATE    */
             DCL        &FDATE      *DEC     LEN(7 0)
             DCL        &TDATEL     *DEC        /*  TO DATE      */
             DCL        &TDATE      *DEC     LEN(7 0)
             DCL        &FTIMEL     *DEC        /*  FROM TIME    */
             DCL        &FTIME      *DEC     LEN(6 0)
             DCL        &TTIMEL     *DEC        /*  TO TIME      */
             DCL        &TTIME      *DEC     LEN(6 0)
             DCL        &ITEML      *DEC         /*  ITEM         */
             DCL        &ITEM       *DEC     LEN(7 0)
             DCL        &ITMTYPL    *DEC         /*  ITEM TYPE    */
             DCL        &ITMTYP     *DEC     LEN(3 0)
             DCL        &ITMGRPL    *DEC         /*  ITEM GROUP   */
             DCL        &ITMGRP     *DEC     LEN(3 0)
             DCL        &ITMCLSL    *DEC         /*  ITEM CLASS   */
             DCL        &ITMCLS     *DEC     LEN(3 0)
             DCL        &SHFT       *CHAR    1   /* SHIFT        */
             DCL        &EXPDOM     *CHAR    1   /* EXPORT/DOMESTIC */
             DCL        &EMAIL      *CHAR    50  /* EMAIL ADDRESS */
             DCL        &AVLGRP     *CHAR    3   /* AVAIL GROUP  */
             DCL        &TRNID      *CHAR    1   /* TRANS. ID    */
             DCL        &OUTQ       *CHAR    10  /* OUTPUT QUEUE */
             DCL        &NIGHTQ     *CHAR   10  /*  NIGHT JOB QUEUE*/
             DCL        &HOLD       *CHAR   4   /* HOLD        */
             DCL        &SAVE       *CHAR   4   /* SAVE        */
             DCL        &PGM        *CHAR    10 /*  PGM NAME    */
             DCL        &COMPA      *CHAR    3  /* CO. # FOR MSG */
             DCL        &FDATEA     *CHAR    7  /* TO DTE FOR QRY*/
             DCL        &TDATEA     *CHAR    7  /* FRM DT FOR QRY*/
             DCL        &FTIMEA     *CHAR    6  /* TO TIM FOR QRY*/
             DCL        &TTIMEA     *CHAR    6  /* FRM TIM FOR QRY*/
             DCL        &ITEMA      *CHAR    7  /* ITEM FOR QRY  */
             DCL        &ITMTYPA    *CHAR    3  /* ITEM TYPE FOR QRY */
             DCL        &ITMGRPA    *CHAR    3  /* ITEM GRP FOR QRY */
             DCL        &ITMCLSA    *CHAR    3  /* ITEM CLS FOR QRY */
             DCL        &WHSE       *CHAR    3  /* WAREHOUSE     */
             DCL        &PGMO       *CHAR    10 /* PRINTER NAME  */
             DCL        &TTYPE1     *CHAR    2  /* TRANS. TYPE   */
             DCL        &TTYPE2     *CHAR    2  /* TRANS. TYPE   */
             DCL        &TTYPE3     *CHAR    2  /* TRANS. TYPE   */
             DCL        &TTYPE4     *CHAR    2  /* TRANS. TYPE   */
             DCL        &RSN1       *CHAR    3  /*  REASON CODE  */
             DCL        &RSN2       *CHAR    3  /*  REASON CODE  */
             DCL        &RSN3       *CHAR    3  /*  REASON CODE  */
             DCL        &RSN4       *CHAR    3  /*  REASON CODE  */
             DCL        &RPTTYP     *CHAR    1  /* REPORT TYPE   */
             DCL        &DATETYP    *CHAR    1  /* DATE TYPE     */
             DCL        &ZEROQTY    *CHAR    1  /* INCL ZERO QTY */
             DCL        &USER       *CHAR    10 /* USER ID       */
             DCL        &RETURN     *CHAR    7
             DCL        &COMMAND    *CHAR    512
             DCL        &TEXT       *CHAR    60 /*  EMAIL TEXT       */
             DCL        &A          *CHAR    25 /* QRY SELECT    */
             DCL        &B          *CHAR    36 /* QRY SELECT    */
             DCL        &C          *CHAR    37 /* QRY SELECT    */
             DCL        &C1         *CHAR    37 /* QRY SELECT    */
             DCL        &C2         *CHAR    35  /* QRY SELECT   */
             DCL        &C3         *CHAR    35  /* QRY SELECT   */
             DCL        &C4         *CHAR    35  /* QRY SELECT   */
             DCL        &D          *CHAR    35 /* QRY SELECT    */
             DCL        &E          *CHAR    35 /* QRY SELECT    */
             DCL        &F          *CHAR    35 /* QRY SELECT    */
             DCL        &G          *CHAR    35 /* QRY SELECT    */
             DCL        &H          *CHAR    35 /* QRY SELECT    */
             DCL        &I          *CHAR    35 /* QRY SELECT    */
             DCL        &J          *CHAR    1   /* QRY SELECT   */
             DCL        &K          *CHAR    35 /* QRY SELECT    */
             DCL        &L          *CHAR    35 /* QRY SELECT    */
             DCL        &M          *CHAR    35 /* QRY SELECT    */
             DCL        &N          *CHAR    35 /* QRY SELECT    */
             DCL        &O          *CHAR    1   /* QRY SELECT   */
             DCL        &S          *CHAR    35  /* QRY SELECT   */
             DCL        &T          *CHAR    35  /* QRY SELECT   */
             DCL        &P          *CHAR    600 /* QRY SELECT   */
             DCL        &U          *CHAR    75  /* QRY SELECT   */
             DCL        &V          *CHAR    75  /* QRY SELECT   */
             DCL        &W          *CHAR    37 /* QRY SELECT    */
             DCL        &X          *CHAR    19 /* QRY SELECT    */
             DCL        &SELECT     *CHAR    1   /* SELECT       */
             DCL        &SELECT2    *CHAR    1   /* SELECT       */
             DCL        &SELTXT     *CHAR    6   VALUE('SELECT')

             MONMSG     MSGID(CPF0000 EML0000)
/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/

             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')
             CHGVAR     VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR     VAR(&COMPA) VALUE(&COMP) /* Change FOR  +
                          MESSAGES for print program */
             CHGVAR     VAR(&COPIES) VALUE(&COPIESL) /* Change to length +
                          for print program */
             CHGVAR     VAR(&FDATE) VALUE(&FDATEL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&FDATEA) VALUE(&FDATE)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&TDATE) VALUE(&TDATEL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&TDATEA) VALUE(&TDATE)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&FTIME) VALUE(&FTIMEL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&FTIMEA) VALUE(&FTIME)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&TTIME) VALUE(&TTIMEL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&TTIMEA) VALUE(&TTIME)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITEM) VALUE(&ITEML) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITEMA) VALUE(&ITEM)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMTYP) VALUE(&ITMTYPL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMTYPA) VALUE(&ITMTYP)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMGRP) VALUE(&ITMGRPL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMGRPA) VALUE(&ITMGRP)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMCLS) VALUE(&ITMCLSL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMCLSA) VALUE(&ITMCLS)  /*  FOR QRY +
                          SELECTION  */

/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/
/***         OVRPRTF    FILE(&PGMO) OUTQ(&OUTQ) COPIES(&COPIES) +
                          HOLD(&HOLD) SAVE(&SAVE)              ******/

/*****       OVRPRTF    FILE(&PGMO) PAGESIZE(98 175) LPI(12) CPI(15) +
                          OVRFLW(90) FONT(254) PAGRTT(270) +
                          REDUCE(*NONE) OUTQ(&OUTQ) COPIES(&COPIES) +
                          HOLD(&HOLD) SAVE(&SAVE)              ******/

             OVRPRTF    FILE(&PGMO) PAGESIZE(96 187) LPI(12) CPI(15) +
                          OVRFLW(90) REDUCE(*NONE) OUTQ(&OUTQ) +
                          COPIES(&COPIES) MAXRCDS(200000) +
                          HOLD(&HOLD) SAVE(&SAVE)

/********************************************************************/
/* CREATE TEMPORARY FILE/LOGICALS IN QTEMP                          */
/********************************************************************/
             DLTF       FILE(QTEMP/PMFCCP*)
             MONMSG     MSGID(CPF2105)
             MONMSG     MSGID(CPF2125)

             CRTDUPOBJ  OBJ(PMFCCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO)
             CRTDUPOBJ  OBJ(PMFCCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO)
             CRTDUPOBJ  OBJ(PMFCCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED TO DISPLAY DETAILS            */
/*********************************************************************/
TRANSDATE:
             IF         COND(&DATETYP *EQ 'T') THEN(DO)
             CHGVAR     VAR(&A) VALUE('((B7B4DT>' *CAT &FDATEA +
                          *CAT ')')
             CHGVAR     VAR(&U) VALUE('OR (B7B4DT =   ' *CAT &FDATEA +
                     *CAT '  AND B7AATM >=  ' *CAT &FTIMEA *CAT '))')

             CHGVAR     VAR(&B) VALUE('AND ((B7B4DT <   ' *CAT +
                          &TDATEA *CAT ')')
             CHGVAR     VAR(&V) VALUE('OR (B7B4DT =   ' *CAT &TDATEA +
                      *CAT '  AND B7AATM <=  ' *CAT &TTIMEA *CAT '))')
             ENDDO
/*********************************************************************/
PRODDATE:
             IF         COND(&DATETYP *EQ 'P') THEN(DO)
             CHGVAR     VAR(&A) VALUE('B7ELDT>=' *CAT &FDATEA)
             CHGVAR     VAR(&B) VALUE('AND B7ELDT<=' *CAT &TDATEA)
             ENDDO
ICOMPANY:
             IF         COND(&COMPA *NE '000') THEN(DO)
             CHGVAR     VAR(&C) VALUE('AND B7AIC3 =   ' *CAT &COMPA)
             ENDDO
ITEM:
             IF         COND(&ITEMA *NE '0000000') THEN(DO)
             CHGVAR     VAR(&C1) VALUE('AND B7HGCD =   ' *CAT &ITEMA)
             ENDDO
ITEMTYPE:
             IF        COND(&ITMTYPA *NE '000') THEN(DO)
             CHGVAR    VAR(&C2) VALUE('AND B7RGNB =   ' *CAT &ITMTYPA)
             ENDDO
ITEMGROUP:
             IF        COND(&ITMGRPA *NE '000') THEN(DO)
             CHGVAR    VAR(&C3) VALUE('AND B7RHNB =   ' *CAT &ITMGRPA)
             ENDDO
ITEMCLASS:
             IF        COND(&ITMCLSA *NE '000') THEN(DO)
             CHGVAR    VAR(&C4) VALUE('AND B7RINB =   ' *CAT &ITMCLSA)
             ENDDO
WAREHOUSE:
             IF         COND(&WHSE *NE '   ') THEN(DO)
             CHGVAR     VAR(&D) VALUE('AND B7AJCD =   "' *CAT &WHSE +
                        *CAT '"')
             ENDDO
USER:
             IF         COND(&USER *NE '          ') THEN(DO)
             CHGVAR     VAR(&E) VALUE('AND B7AYNA =   "' *CAT &USER +
                          *CAT '"')
             ENDDO
TRANTYPE1:
             IF         COND(&TTYPE1 *NE '  ') THEN(DO)
             CHGVAR     VAR(&F) VALUE('AND (B7BSST =   "' *CAT +
                         &TTYPE1 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
TRANTYPE2:
             IF         COND(&TTYPE2 *NE '  ') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&G) VALUE('OR B7BSST =   "' *CAT +
                         &TTYPE2 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&G) VALUE('AND (B7BSST =   "' *CAT +
                         &TTYPE2 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO
TRANTYPE3:
             IF         COND(&TTYPE3 *NE '  ') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&H) VALUE('OR B7BSST  =  "' *CAT +
                         &TTYPE3 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&H) VALUE('AND (B7BSST =   "' *CAT +
                         &TTYPE3 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO
TRANTYPE4:
             IF         COND(&TTYPE4 *NE '  ') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&I) VALUE('OR B7BSST =   "' *CAT +
                         &TTYPE4 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&I) VALUE('AND (B7BSST =   "' *CAT +
                         &TTYPE4 *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO

             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&J) VALUE(')')
             ENDDO
REASON1:
             IF         COND(&RSN1 *NE '   ') THEN(DO)
             CHGVAR     VAR(&K) VALUE('AND (B7CQCD =   "' *CAT +
                         &RSN1 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
REASON2:
             IF         COND(&RSN2 *NE '   ') THEN(DO)
             IF         COND(&SELECT2 *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&L) VALUE('OR B7CQCD =   "' *CAT +
                         &RSN2 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&L) VALUE('AND (B7CQCD =   "' *CAT +
                         &RSN2 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ENDDO
REASON3:
             IF         COND(&RSN3 *NE '   ') THEN(DO)
             IF         COND(&SELECT2 *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&M) VALUE('OR B7CQCD =   "' *CAT +
                         &RSN3 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&M) VALUE('AND (B7CQCD =   "' *CAT +
                         &RSN3 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ENDDO
REASON4:
             IF         COND(&RSN4 *NE '   ') THEN(DO)
             IF         COND(&SELECT2 *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&N) VALUE('OR B7CQCD =   "' *CAT +
                         &RSN4 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&N) VALUE('AND (B7CQCD =   "' *CAT +
                         &RSN4 *CAT '"')
             CHGVAR     VAR(&SELECT2) VALUE('Y')
             ENDDO
             ENDDO

             IF         COND(&SELECT2 =   'Y') THEN(DO)
             CHGVAR     VAR(&O) VALUE(')')
             ENDDO
SHIFT:
             IF         COND(&SHFT *NE ' ') THEN(DO)
             CHGVAR     VAR(&S) VALUE('AND B7XLCD =   "' *CAT +
                         &SHFT *CAT '"')
             ENDDO
AVAILGROUP:
             IF         COND(&AVLGRP *NE ' ') THEN(DO)
             CHGVAR     VAR(&T) VALUE('AND KLV4CD =   "' *CAT +
                         &AVLGRP *CAT '"')

             IF         COND(&COMPA *NE '000') THEN(DO)
             CHGVAR     VAR(&W) VALUE('AND KLAIC3 =   ' *CAT &COMPA)
             ENDDO
TRANSID:
             IF         COND(&TRNID *NE ' ') THEN(DO)
             CHGVAR     VAR(&X) VALUE('AND B7W9ST =   "' *CAT +
                         &TRNID *CAT '"')
             ENDDO
             ENDDO
BLDTRDATE:
             IF         COND(&DATETYP *EQ 'T') THEN(DO)
             CHGVAR     VAR(&P) VALUE(&A *BCAT &U *BCAT &B *BCAT &V +
                          *BCAT &C *BCAT &C1 *BCAT &C2 *BCAT &C3 +
                          *BCAT &C4 *BCAT &D *BCAT &E *BCAT &F +
                          *BCAT &G *BCAT &H *BCAT &I *BCAT &J *BCAT +
                          &K *BCAT &L *BCAT &M *BCAT &N *BCAT &O +
                          *BCAT &S *BCAT &T *BCAT &W *BCAT &X)
                          ENDDO
BLDPRDATE:
             IF         COND(&DATETYP *EQ 'P') THEN(DO)
             CHGVAR     VAR(&P) VALUE(&A *BCAT &B *BCAT &C *BCAT &C1 +
                          *BCAT &C2 *BCAT &C3 *BCAT &C4 *BCAT &D +
                          *BCAT &E *BCAT &F *BCAT &G *BCAT &H *BCAT +
                          &I *BCAT &J *BCAT &K *BCAT &L *BCAT &M +
                          *BCAT &N *BCAT &O *BCAT &S *BCAT &T *BCAT +
                          &W *BCAT &X)
                          ENDDO

/* AVAILABILITY GROUP FILE                                           */
             OVRDBF     FILE(PDKLREP) SHARE(*YES)
             CHGVAR     VAR(&TEXT) VALUE('Inventory Transaction +
                          Journal for' *BCAT &FDATEA *BCAT ' - ' +
                          *BCAT &TDATEA)

/********************  PRINT DETAIL REPORT  **************************/
/**************  PRINT DETAIL REPORT FOR PRODUCTION DATE *************/
/*   OPEN QUERY FOR DETAIL PRINT                                     */

             IF         COND(&RPTTYP = 'D') THEN(DO)

             IF         COND(&DATETYP *EQ 'P') THEN(DO)

  /*         OPNQRYF    FILE((CAB7CPL3) (PDKLREP)) FORMAT(CAB7CPL3) +
                          QRYSLT(&P) KEYFLD(*FILE) JFLD((B7HGCD +
                          KLHGCD) (B7AIC3 KLAIC3)) SEQONLY(*YES)     */

/*   OPEN SQL FOR DETAIL PRINT                                     */

             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
                          Asc,b7ajcd Asc,b7eldt Asc,b7hgcd Asc') +
                          OPNID(CAB7CPL3) RCDFMT(@B7CPOU) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPL3) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)

             CALL       PGM(PDZ1PFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME &TRNID)

             CLOF       OPNID(CAB7CPL3) /* Close query file */
             DLTOVR     FILE(CAB7CPL3) /* Delete override */

             IF         COND(&EMAIL *GT *BLANK)    THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          MSGTYPE(*DFT) ATTLIST((* *PDF *N PDZ1PFR$))
             MONMSG     MSGID(EML0010)
             ENDDO
             ENDDO

/**************  PRINT DETAIL REPORT FOR TRANSACTION DATE ************/
/*   OPEN QUERY FOR DETAIL PRINT                                     */
             IF         COND(&DATETYP *EQ 'T') THEN(DO)
             OVRDBF     FILE(CAB7CPL5) SHARE(*YES)
/*           OPNQRYF    FILE((CAB7CPL5) (PDKLREP)) FORMAT(CAB7CPL5) +
                          QRYSLT(&P) KEYFLD(*FILE) UNIQUEKEY(*NONE) +
                          JFLD((B7HGCD KLHGCD) (B7AIC3 KLAIC3)) +
                          SEQONLY(*YES)                              */

/*   OPEN SQL FOR DETAIL PRINT                                     */
             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
                          Asc,b7ajcd Asc,b7B4dt Asc,b7hgcd Asc') +
                          OPNID(CAB7CPl5) RCDFMT(@B7CPH0) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPL5) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)


             CALL       PGM(ICQHPFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME &TRNID)

             CLOF       OPNID(CAB7CPL5) /* Close query file */
             DLTOVR     FILE(CAB7CPL5) /* Delete override */

             IF         COND(&EMAIL *NE *BLANK) THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          ATTLIST((* *PDF *N ICQHPFR$))
             MONMSG     MSGID(EML0010)
             ENDDO
             ENDDO
             ENDDO

/**************  PRINT ADJUSTMENT TRANSACTION REPORT *****************/

/*   OPEN QUERY FOR ADJUSTMENT TRANSACTION REPORT                    */
             IF         COND(&RPTTYP = 'A') THEN(DO)
             OVRDBF     FILE(CAB7CPMA) SHARE(*YES)

/*           OPNQRYF    FILE((CAB7CPMA) (PDKLREP)) FORMAT(CAB7CPMA) +
                          QRYSLT(&P) KEYFLD(*FILE) UNIQUEKEY(*NONE) +
                          JFLD((B7HGCD KLHGCD) (B7AIC3 KLAIC3)) +
                          SEQONLY(*YES)                                */

/*   OPEN SQL FOR DETAIL PRINT                                     */
             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
                          Asc,b7ajcd Asc,B7W9ST Asc,b7BSST Asc,B7HGCD ASC') +
                          OPNID(CAB7CPMA) RCDFMT(@B7CPV8) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPMA) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)


             CALL       PGM(PPHNPFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME &TRNID)

             CLOF       OPNID(CAB7CPMA) /* Close query file */
             DLTOVR     FILE(CAB7CPMA) /* Delete override */

             IF         COND(&EMAIL *NE +
                          '                                           -
       ') THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          ATTLIST((* *PDF *N PPHNPFR$))
             MONMSG     MSGID(EML0010 EML0004)
             ENDDO
             ENDDO

/********************  PRINT SUMMARY REPORT  *************************/

/*   OPEN QUERY FOR SUMMARY PRINT.   */

             IF         (&RPTTYP = 'S') THEN(DO)
             OVRDBF     FILE(CAB7CPL6) SHARE(*YES)

/*           OPNQRYF    FILE((CAB7CPL6) (PDKLREP)) FORMAT(CAB7CPL6) +
                          QRYSLT(&P) KEYFLD(*FILE) JFLD((B7HGCD +
                          KLHGCD) (B7AIC3 KLAIC3)) SEQONLY(*YES)      */

/*   OPEN SQL FOR DETAIL PRINT                                     */
             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
        Asc,b7ajcd Asc,B7HGCD Asc,b7W9ST Asc,B7BSST ASC,  B7CQCD ASC') +
                          OPNID(CAB7CPL6) RCDFMT(@B7CPH2) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPL6) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)


             CALL       PGM(OMHCPFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME)

             CLOF       OPNID(CAB7CPL6) /* Close query file */
             DLTOVR     FILE(CAB7CPL6) /* Delete override */

             IF         COND(&EMAIL *NE *BLANK)    THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          ATTLIST((* *PDF *N OMHCPFR$))
             MONMSG     MSGID(EML0010 EML0004)
             ENDDO
             ENDDO

/********************  PRINT CONSOLIDATED REPORT  ********************/

/*   OPEN QUERY FOR TOTAL PRINT.   */

             IF         (&RPTTYP = 'T') THEN(DO)
             OVRDBF     FILE(CAB7CPL8) SHARE(*YES)

 /*          OPNQRYF    FILE((CAB7CPL8) (PDKLREP)) FORMAT(CAB7CPL8) +
                          QRYSLT(&P) KEYFLD(*FILE) JFLD((B7HGCD +
                          KLHGCD) (B7AIC3 KLAIC3)) SEQONLY(*YES)        */

/*   OPEN SQL FOR DETAIL PRINT                                     */
             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
                          Asc,b7ajcd Asc,b7eldt Asc,b7hgcd Asc') +
                          OPNID(CAB7CPL8) RCDFMT(@B7CPH8) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPL8) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)


             CALL       PGM(OMQGPFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME)

             CLOF       OPNID(CAB7CPL8) /* Close query file */
             DLTOVR     FILE(CAB7CPL8) /* Delete override */

             IF         COND(&EMAIL *NE +
                          '                                           -
       ') THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          ATTLIST((* *PDF *N OMQGPFR$))
             MONMSG     MSGID(EML0010 EML0004)
             ENDDO
             ENDDO

/********************  PRINT TYPE/GRP/CLS    *************************/

/*   OPEN QUERY FOR TYPE/GRP/CLSS.   */

             IF         (&RPTTYP = 'G') THEN(DO)
             OVRDBF     FILE(CAB7CPLH) SHARE(*YES)

/*           OPNQRYF    FILE((CAB7CPLH) (PDKLREP)) FORMAT(CAB7CPLH) +
                          QRYSLT(&P) KEYFLD(*FILE) JFLD((B7HGCD +
                          KLHGCD) (B7AIC3 KLAIC3)) SEQONLY(*YES)       */

/*   OPEN SQL FOR DETAIL PRINT                                     */
             OVRDBF     FILE(CAB7CPP ) TOFILE(CAB7CPP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM  cab7cpp,pdklrep      +
                          JOIN BY  B7AIC3.CAB7CPP=KLAIC3.PDKLREP +
                          AND B7HGCD.CAB7CPP=KLHGCD.PDKLREP WHERE' +
                          *BCAT &P *BCAT 'ORDER   BY    b7aic3 +
                          Asc,b7ajcd Asc,b7eldt Asc,b7hgcd Asc') +
                          OPNID(CAB7CPLH) RCDFMT(@B7CPBV) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE)

   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB7CPLH) TOFILE(CAB7CPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)
             OVRDBF     FILE(PDKLREP) OVRSCOPE(*JOB) SHARE(*YES) +
                          OPNSCOPE(*JOB)


             CALL       PGM(PDRVPFR) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &SHFT &FDATE +
                          &TDATE &TTYPE1 &TTYPE2 &TTYPE3 &TTYPE4 +
                          &RSN1 &RSN2 &RSN3 &RSN4 &USER &RPTTYP +
                          &ZEROQTY &DATETYP &EXPDOM &AVLGRP &FTIME +
                          &TTIME)

             CLOF       OPNID(CAB7CPLH) /* Close query file */
             DLTOVR     FILE(CAB7CPLH) /* Delete override */

             IF         COND(&EMAIL *NE +
                          '                                           -
       ') THEN(DO)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&TEXT) +
                          ATTLIST((* *PDF *N PDRVPFR$))
             MONMSG     MSGID(EML0010 EML0004)
             ENDDO
             ENDDO

/*********************************************************************/
/********************  SEND EMAIL QUERY   ****************************/
/*********************************************************************/
             IF         (&RPTTYP = 'D') THEN(DO)
             IF         COND(&EMAIL *NE +
                          '                                           -
       ') THEN(DO)
             EXECUTE    VIEW(PMFCCPPA) PCFMT(*XLS) REPLACE(*YES) +
                          RECIPIENT(&EMAIL) EMLMSG(&TEXT *BCAT +
                          '-spreadsheet')
             MONMSG     MSGID(EML0010 EML0004)
             ENDDO
             ENDDO

/* >>>> FOR TESTING <<<<< */
    /*       CPYF       FROMFILE(QTEMP/PMFCCPP) +
                          TOFILE(OMSDEVGEN/PMFCCPP) MBROPT(*REPLACE)    */


 END:        DLTOVR     FILE(*ALL)
             ENDPGM
