// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKAMDFR
// ?Date: 14.08.2025 Time: 02:48:46
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Buy_Order_Copy_Sts_USR = *NO;

//?USER: Initialize subfile control

// *MO.VE             1183529*Bu = ilt. in functions
CTL.Head_Total_USR = *ZERO;

EXECUTE FUNCTION(Calc Bo Header Total) TYPE(RTVOBJ) FILE(PKAWCPP)               AB1139067;
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOH_Kill_Date);
PARAMETER(CTL.Head_Total_USR);
{
 //?USER: Initialize routine

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.Head_Total_USR = *ZERO;

 //?USER: Process Data record

 EXECUTE FUNCTION(Calc BO No of Head    RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1101147;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(PAR.Head_Total_USR);
 {
  //?USER: Process Data record

  // PAR.Head BO USR = PAR.Head BO USR + DB1.BOL Pln Head Delv
  PAR.Head_BO_USR = PAR.Head_BO_USR + DB1.BOL_Pln_Head_Delv;

 }

}


//?USER: Initialize subfile record from DBF record

EXECUTE FUNCTION(Calc BO No of Head    RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1101147;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.Head_BO_USR);
{
 //?USER: Process Data record

 // PAR.Head BO USR = PAR.Head BO USR + DB1.BOL Pln Head Delv
 PAR.Head_BO_USR = PAR.Head_BO_USR + DB1.BOL_Pln_Head_Delv;

}


//?USER: Process subfile control (Pre-confirm)

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Defer_confirm = 'Y';

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Head_Total_5_0_USR = CTL.Head_Total_USR;

//?CMD Key 06: Create Buy Order
CASE;

// IF CTL.*CMD key is Create
IF CTL.*CMD_key = '06';

// Call program Crt Buy Order and Load ET.
CALL PROGRAM(Crt Buy Order and Load ET) ('PKANETR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(CTL.BOH_Kill_Date);
PARAMETER(PAR.PPWS_Company_Number);
PARAMETER(PAR.CW_Year);
PARAMETER(PAR.CW_Week_Number);
PARAMETER(PAR.PD_Producer_Code);
PARAMETER(PAR.PL_Location_Code);
PARAMETER(CTL.Head_Total_USR);
PARAMETER(PAR.Oms_Name);
PARAMETER(PAR.Oms_System_Value_Alpha);

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Head_Total_5_0_USR = CTL.Head_Total_5_0_USR;

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Reload_subfile = 'Y';

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: Process subfile record (Pre-confirm)

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Defer_confirm = 'Y';

//?Option 2:  Edit Buy Order
CASE;

// IF RCD.*SFLSEL is *Revise
IF RCD.*SFLSEL = '2';

// Call program Edt Buy Order and Load ET.
CALL PROGRAM(Edt Buy Order and Load ET) ('PKAOETR');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.Head_BO_USR);
PARAMETER(PAR.Oms_Name);
PARAMETER(PAR.Oms_System_Value_Alpha);

ENDIF;

//?Option 3:  Copy Buy Order
CASE;

// IF RCD.*SFLSEL is *Copy request
IF RCD.*SFLSEL = '3'/'3';

// Call program Zzz Buy Order         PV.
CALL PROGRAM(Zzz Buy Order         PV) ('PKU1PVR');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(PAR.Buy_Order_Number_USR);
PARAMETER(RCD.Head_BO_USR);

CASE;

// IF PAR.Buy Order Number USR GT WRK.Zero USR
IF PAR.Buy_Order_Number_USR > WRK.Zero_USR;

// Send information message - 'Buy Order &1 Created.'
MESSAGE(PRK0493 *INFO);
MSGPARM(PAR.Buy_Order_Number_USR);

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Buy_Order_Copy_Sts_USR = *YES;

ENDIF;

ENDIF;

//?Option 7:  Edit Comments
CASE;

// IF RCD.*SFLSEL is *Option 7 (Reusable)
IF RCD.*SFLSEL = '7';

// Call program Edt BO Comments       EF.
CALL PROGRAM(Edt BO Comments       EF) ('PKASEFR');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);

ENDIF;

//?Option 4:  Delete Buy Order
CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4';

CASE;

// IF RCD.BOH Status is Locked
IF RCD.BOH_Status = 'L';

// Send error message - 'Delete is not allowed'
ERROR(PRK0282);
MSGPARM(RCD.*SFLSEL);

// IF *OTHERWISE
IF *OTHERWISE;

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Return_code = *BLANK;

EXECUTE FUNCTION(Chk Buy Order Dtl     RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1130232;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(PGM.*Return_code);
{
 //?USER: Processing if Data record not found

 // PAR.*Return code = CND.*Normal
 PAR.*Return_code = *BLANK;

 //?USER: Process Data record

 // PAR.*Return code = CND.Record Found
 PAR.*Return_code = 999;

 QUIT;

}


CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Defer_confirm = 'N';

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Delete is not allowed'
ERROR(PRK0282);
MSGPARM(RCD.*SFLSEL);

ENDIF;

ENDIF;

ENDIF;

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Head_Total_5_0_USR = CTL.Head_Total_USR;

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Reload_subfile = 'Y';

//?USER: Final processing (Pre-confirm)

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Head_Total_5_0_USR = CTL.Head_Total_USR;

//?USER: Process subfile record (Post-confirm)

CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4';

EXECUTE FUNCTION(Dlt Buy Order Header  DL) TYPE(DLTOBJ) FILE(PKAWCPP)           AB1100516;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Reload_subfile = 'Y';

ENDIF;

//?USER: Exit program processing

EXECUTE FUNCTION(Calc Bo Header Total) TYPE(RTVOBJ) FILE(PKAWCPP)               AB1139067;
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOH_Kill_Date);
PARAMETER(PAR.Head_Total_5_0_USR);
{
 //?USER: Initialize routine

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.Head_Total_USR = *ZERO;

 //?USER: Process Data record

 EXECUTE FUNCTION(Calc BO No of Head    RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1101147;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(PAR.Head_Total_USR);
 {
  //?USER: Process Data record

  // PAR.Head BO USR = PAR.Head BO USR + DB1.BOL Pln Head Delv
  PAR.Head_BO_USR = PAR.Head_BO_USR + DB1.BOL_Pln_Head_Delv;

 }

}


