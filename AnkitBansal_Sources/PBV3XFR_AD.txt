// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBV3XFR
// ?Date: 14.08.2025 Time: 03:49:32
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Sun/Sat/Yr/Wk HPS2RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC2118797;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.HPS_Calendar_Year);
PARAMETER(PAR.HPS_Calendar_Week);
PARAMETER(PAR.HPS_Beg_Week);
PARAMETER(PAR.HPS_End_Week);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 // PAR.HPS Beg Week = CON.*ZERO
 PAR.HPS_Beg_Week = *ZERO;

 // PAR.HPS End Week = CON.*ZERO
 PAR.HPS_End_Week = *ZERO;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.Calendar not found
 PGM.*Return_code = 'USR0018';

 QUIT;

 //?USER: Process Data record

 CASE;

 // IF DB1.Day of Week is Sunday
 IF DB1.Day_of_Week = '1';

 MOVE *ALL (To: PAR From: DB1);

 // PAR.HPS Beg Week = DB1.Post to G/L Date
 PAR.HPS_Beg_Week = DB1.Post_to_G_L_Date;

 // IF DB1.Day of Week is Saturday
 IF DB1.Day_of_Week = '7';

 MOVE *ALL (To: PAR From: DB1);

 // PAR.HPS End Week = DB1.Post to G/L Date
 PAR.HPS_End_Week = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


DO;

// LCL.YEAR XX USR = PAR.HPS Beg Week *YEAR
LCL.YEAR_XX_USR = DATEDTLS(PAR.HPS_Beg_Week 'YR' 1111111 'NONE' 'N' 1);

//?Take a 7 position date to a 8 position date
DO;

// LCL.Year Alpha (YYYY) USR = CVTVAR(LCL.YEAR XX USR)
LCL.Year_Alpha_YYYY_USR = CVTVAR(LCL.YEAR_XX_USR);

// LCL.Month NBR USR = PAR.HPS Beg Week *MONTH
LCL.Month_NBR_USR = DATEDTLS(PAR.HPS_Beg_Week 'MO' 1111111 'NONE' 'N' 1);

// LCL.Month (Char) USR = CVTVAR(LCL.Month NBR USR)
LCL.Month_Char_USR = CVTVAR(LCL.Month_NBR_USR);

// LCL.Day NBR USR = PAR.HPS Beg Week *DAY OF MONTH
LCL.Day_NBR_USR = DATEDTLS(PAR.HPS_Beg_Week 'DM' 1111111 'NONE' 'N' 1);

// LCL.Day   (Char) USR = CVTVAR(LCL.Day NBR USR)
LCL.Day_Char_USR = CVTVAR(LCL.Day_NBR_USR);

// LCL.Date (Char-8) USR = CONCAT(LCL.Year Alpha (YYYY) USR,LCL.Month (Char) USR,CND.*None)
LCL.Date_Char_8_USR = LCL.Year_Alpha_YYYY_USR + LCL.Month_Char_USR (*ZERO);

// LCL.Date (Char-8) USR = CONCAT(LCL.Date (Char-8) USR,LCL.Day   (Char) USR,CND.*None)
LCL.Date_Char_8_USR = LCL.Date_Char_8_USR + LCL.Day_Char_USR (*ZERO);

// WRK.Date (Char-8) USR = LCL.Date (Char-8) USR
WRK.Date_Char_8_USR = LCL.Date_Char_8_USR;

// WRK.Date 8.0 USR = CVTVAR(WRK.Date (Char-8) USR)
WRK.Date_8_0_USR = CVTVAR(WRK.Date_Char_8_USR);

ENDDO;

// PAR.HPS Beg Week 8/0 = CVTVAR(WRK.Date 8.0 USR)
PAR.HPS_Beg_Week_8_0 = CVTVAR(WRK.Date_8_0_USR);

// LCL.YEAR XX USR = PAR.HPS End Week *YEAR
LCL.YEAR_XX_USR = DATEDTLS(PAR.HPS_End_Week 'YR' 1111111 'NONE' 'N' 1);

//?Take a 7 position date to a 8 position date
DO;

// LCL.Year Alpha (YYYY) USR = CVTVAR(LCL.YEAR XX USR)
LCL.Year_Alpha_YYYY_USR = CVTVAR(LCL.YEAR_XX_USR);

// LCL.Month NBR USR = PAR.HPS End Week *MONTH
LCL.Month_NBR_USR = DATEDTLS(PAR.HPS_End_Week 'MO' 1111111 'NONE' 'N' 1);

// LCL.Month (Char) USR = CVTVAR(LCL.Month NBR USR)
LCL.Month_Char_USR = CVTVAR(LCL.Month_NBR_USR);

// LCL.Day NBR USR = PAR.HPS End Week *DAY OF MONTH
LCL.Day_NBR_USR = DATEDTLS(PAR.HPS_End_Week 'DM' 1111111 'NONE' 'N' 1);

// LCL.Day   (Char) USR = CVTVAR(LCL.Day NBR USR)
LCL.Day_Char_USR = CVTVAR(LCL.Day_NBR_USR);

// LCL.Date (Char-8) USR = CONCAT(LCL.Year Alpha (YYYY) USR,LCL.Month (Char) USR,CND.*None)
LCL.Date_Char_8_USR = LCL.Year_Alpha_YYYY_USR + LCL.Month_Char_USR (*ZERO);

// LCL.Date (Char-8) USR = CONCAT(LCL.Date (Char-8) USR,LCL.Day   (Char) USR,CND.*None)
LCL.Date_Char_8_USR = LCL.Date_Char_8_USR + LCL.Day_Char_USR (*ZERO);

// WRK.Date (Char-8) USR = LCL.Date (Char-8) USR
WRK.Date_Char_8_USR = LCL.Date_Char_8_USR;

// WRK.Date 8.0 USR = CVTVAR(WRK.Date (Char-8) USR)
WRK.Date_8_0_USR = CVTVAR(WRK.Date_Char_8_USR);

ENDDO;

// PAR.HPS End Week 8/0 = CVTVAR(WRK.Date 8.0 USR)
PAR.HPS_End_Week_8_0 = CVTVAR(WRK.Date_8_0_USR);

ENDDO;

