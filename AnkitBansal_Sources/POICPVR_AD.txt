// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POICPVR
// ?Date: 14.08.2025 Time: 03:37:24
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?***** Change Log and Comments
DO;

//?** 01/20/2012 LJB E001889   Remove the *Exit key
//?**  Change to use the F12. Blank out "Fax Carrier" field and
//?**  send error message if it is not filled in. If F3-send error
//?**  message
//?** 11/08/2011 LJB E001792   Disable the *Exit key
//?**  You actually cannot fully disable the F3 key in a Prompt Screen.
//?**  So, I took F3 off the screen and I am processing the
//?**  status fields instead. If "Y" in any field, fax will be sent
//?**  even if F3 is pressed.
//?** 04/04/2011 LJB P000737   Add: Email Transloader, default to NO,
//?**   Fax Mexican Carrier, default to NO, Email Export Coordinator,
//?**   default to NO, Email Shipping Line, default to No,
//?**   and Email To with blank to fill in an extra email address.
//?**   Email address and fax number are in the Carrier file
//?**   Remove PowerPro processing and put into calling program.
//?**   Pass back Fax Carrier Flag to calling program for PowerPro.
//?** 08/24/2009 LJB E00461
//?** Check SSI download flag. If Yes, send info to PowerPro
//?** 5/23/02 Fax to Dispatch office
ENDDO;

//?USER: Load screen

//?Load Screen Fields
DO;

MOVE *ALL (To: DTL From: PAR);

//?** "Fax Carrier" is a required entry (clear out)    E001889
// DTL.Status - Y or N = CND.blank
DTL.Status_Y_or_N = *BLANK;

// DTL.Status Flag 1  Y/N = CND.No
DTL.Status_Flag_1_Y_N = 'N';

// DTL.Status Flag 2  Y/N = CND.No
DTL.Status_Flag_2_Y_N = 'N';

// DTL.Status Flag 3  Y/N = CND.No
DTL.Status_Flag_3_Y_N = 'N';

// DTL.Status Flag 4  Y/N = CND.no
DTL.Status_Flag_4_Y_N = 'N';

// DTL.Status Flag 5  Y/N = CND.No
DTL.Status_Flag_5_Y_N = 'N';

// Call program Rtv Company Values-All XF.
CALL PROGRAM(Rtv Company Values-All XF) ('PNW3XFR');
PARAMETER(PAR.Company_Number);
PARAMETER('EXPCOORD');
PARAMETER(LCL.Description);
PARAMETER(LCL.System_Value_Type);
PARAMETER(DTL.Email_Address);
PARAMETER(NLL.System_Value_Numeric);
PARAMETER(NLL.Record_Status);

//?** Load Export Coordinators name on the screen
CASE;

// IF LCL.Description is not equal to blank
IF LCL.Description <> *BLANK;

// DTL.USR Shortened name = LCL.Description
DTL.USR_Shortened_name = LCL.Description;

//?** Load Export Coordinators name on the screen
// IF *OTHERWISE
IF *OTHERWISE;

// DTL.USR Shortened name = CON.*BLANK
DTL.USR_Shortened_name = *BLANK;

ENDIF;

ENDDO;

//?USER: Process command keys

//?** F12 to Cancel
CASE;

// IF DTL.*CMD key is CF12
IF DTL.*CMD_key = '12';

PGM.*Return_code = 'Y2U9999';

RETURN;

ENDIF;

//?** F3 to exit is not allowed                 E001792 & E001889
CASE;

// IF DTL.*CMD key is *Exit
IF DTL.*CMD_key = '03';

// Send error message - 'F3 is not allowed here, use F12 to Cancel'
ERROR(USR4479);

ENDIF;

//?USER: Validate fields

//?Fax Carrier field MUST be entered
CASE;

// IF DTL.Status - Y or N is blank
IF DTL.Status_Y_or_N = *BLANK;

// Send error message - 'Field cannot be blank'
ERROR(USR3741);
MSGPARM(DTL.Status_Y_or_N);

ENDIF;

//?USER: User defined action

CASE;

// IF DTL.*CMD key is CF12
IF DTL.*CMD_key = '12';

// OR PGM.*Return code is *User QUIT requested
OR PGM.*Return_code = 'Y2U9999';

//?** Cancel fax if fax is cancelled
// IF *OTHERWISE
IF *OTHERWISE;

//?** Set up parms to pass to fax program
// PAR.Company Number Pass   USR = PAR.Company Number
PAR.Company_Number_Pass_USR = PAR.Company_Number;

// PAR.Order Number 1  PASS  USR = PAR.Load ID
PAR.Order_Number_1_PASS_USR = PAR.Load_ID;

// WRK.USR Status (Y/N) = CND.Fax
WRK.USR_Status_Y_N = 'F';

// WRK.Status Description 3  USR = CON.PNW2PFR$
WRK.Status_Description_3_USR = 'PNW2PFR$';

// PAR.PRT Description = CON.FAXLDCNFRM
PAR.PRT_Description = 'FAXLDCNFRM';

// PAR.PRT Printer Device = CON.QPRINT2
PAR.PRT_Printer_Device = 'QPRINT2';

// PAR.PRT Hold Output Sts = CND.*YES
PAR.PRT_Hold_Output_Sts = *YES;

// PAR.PRT Save Output Sts = CND.*NO
PAR.PRT_Save_Output_Sts = *NO;

// PAR.PRT Night Queue Run Sts = CND.no
PAR.PRT_Night_Queue_Run_Sts = 'N';

// PAR.PRT Night Queue = CON.*BLANK
PAR.PRT_Night_Queue = *BLANK;

// PAR.System Value Numeric = CON.1
PAR.System_Value_Numeric = 1;

//?Fax or Email Transloader
CASE;

// IF DTL.Status Flag 2  Y/N is Yes
IF DTL.Status_Flag_2_Y_N = 'Y';

// WRK.Transloader Carrier Code = PAR.Transloader Carrier Code
WRK.Transloader_Carrier_Code = PAR.Transloader_Carrier_Code;

//?Fax or Email Transloader
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Transloader Carrier Code = CON.*BLANK
WRK.Transloader_Carrier_Code = *BLANK;

ENDIF;

//?Fax Mexican Carrier
CASE;

// IF DTL.Status Flag 3  Y/N is Yes
IF DTL.Status_Flag_3_Y_N = 'Y';

// WRK.OHE Mexican Buyer Truck = PAR.OHE Mexican Buyer Truck
WRK.OHE_Carrier_SCAC_Code = PAR.OHE_Carrier_SCAC_Code;

//?Fax Mexican Carrier
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.OHE Mexican Buyer Truck = CND.*Blank
WRK.OHE_Carrier_SCAC_Code = *BLANK;

ENDIF;

//?Fax or Email Shipping Line
CASE;

// IF DTL.Status Flag 5  Y/N is Yes
IF DTL.Status_Flag_5_Y_N = 'Y';

// WRK.Shipping Line = PAR.Shipping Line
WRK.Shipping_Line = PAR.Shipping_Line;

//?Fax or Email Shipping Line
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Shipping Line = CON.*BLANK
WRK.Shipping_Line = *BLANK;

ENDIF;

//?Fax or Email Export Coordinator, and any other email addresses
CASE;

// IF DTL.Status Flag 4  Y/N is yes
IF DTL.Status_Flag_4_Y_N = 'Y';

// AND DTL.Email Address is Entered
AND DTL.Email_Address <> *BLANK;

// WRK.Email Address = DTL.Email Address
WRK.Email_Address = DTL.Email_Address;

//?Fax or Email Export Coordinator, and any other email addresses
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Email Address = CON.*BLANK
WRK.Email_Address = *BLANK;

ENDIF;

//?Fax Carrier or dispatcher
CASE;

// IF DTL.Status - Y or N is yes
IF DTL.Status_Y_or_N = 'Y';

// OR DTL.Status Flag 1  Y/N is Yes
OR DTL.Status_Flag_1_Y_N = 'Y';

//?** Don't blank out Carrier Code, it is used for creating the
//?** subject line for emailed confirmation
// WRK.Carrier Code = PAR.Carrier Code
WRK.Carrier_Code = PAR.Carrier_Code;

ENDIF;

//?Fax unless all flags are "N" or if F12 to exit
CASE;

// IF DTL.Status - Y or N is no
IF DTL.Status_Y_or_N = 'N';

// AND DTL.Status Flag 1  Y/N is No
AND DTL.Status_Flag_1_Y_N = 'N';

// AND DTL.Status Flag 2  Y/N is No
AND DTL.Status_Flag_2_Y_N = 'N';

// AND DTL.Status Flag 3  Y/N is No
AND DTL.Status_Flag_3_Y_N = 'N';

// AND DTL.Status Flag 4  Y/N is no
AND DTL.Status_Flag_4_Y_N = 'N';

// AND DTL.Status Flag 5  Y/N is No
AND DTL.Status_Flag_5_Y_N = 'N';

//?Fax unless all flags are "N" or if F12 to exit
// IF *OTHERWISE
IF *OTHERWISE;

//?** Pass in carrier codes for requested emails
EXECUTE FUNCTION(EXC Load Confirm Fax   IF) TYPE(EXCINTFUN)                     AC1595755;
PARAMETER(PAR.Company_Number_Pass_USR);
PARAMETER(PAR.Order_Number_1_PASS_USR);
PARAMETER(WRK.Transloader_Carrier_Code);
PARAMETER(PAR.Carrier_Code);
PARAMETER(WRK.Shipping_Line);
PARAMETER(WRK.OHE_Carrier_SCAC_Code);
PARAMETER(DTL.Status_Flag_1_Y_N);
PARAMETER(DTL.Status_Flag_2_Y_N);
PARAMETER(DTL.Status_Flag_3_Y_N);
PARAMETER(DTL.Status_Flag_4_Y_N);
PARAMETER(DTL.Status_Flag_5_Y_N);
PARAMETER(DTL.Status_Y_or_N);
PARAMETER(WRK.Status_Description_3_USR);
PARAMETER(WRK.USR_Status_Y_N);
PARAMETER(PAR.PRT_Description);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.System_Value_Numeric);
PARAMETER(WRK.Email_Address);
{
 //?Execute internal function

 //?** See comments for explanation of parms.
 // Call program PRC Submit Fax Load Cn UP.
 CALL PROGRAM(PRC Submit Fax Load Cn UP) ('PDVVUPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(PAR.Company_Number_Pass_USR);
 PARAMETER(PAR.Order_Number_1_PASS_USR);
 PARAMETER(PAR.Transloader_Carrier_Code);
 PARAMETER(PAR.Carrier_Code);
 PARAMETER(PAR.Shipping_Line);
 PARAMETER(PAR.OHE_Carrier_SCAC_Code);
 PARAMETER(PAR.Status_Flag_1_Y_N);
 PARAMETER(PAR.Status_Flag_2_Y_N);
 PARAMETER(PAR.Status_Flag_3_Y_N);
 PARAMETER(PAR.Status_Flag_4_Y_N);
 PARAMETER(PAR.Status_Flag_5_Y_N);
 PARAMETER(PAR.Status_Y_or_N);
 PARAMETER(PAR.Status_Description_3_USR);
 PARAMETER(PAR.USR_Status_Y_N);
 PARAMETER(PAR.PRT_Printer_Device);
 PARAMETER(PAR.PRT_Hold_Output_Sts);
 PARAMETER(PAR.PRT_Save_Output_Sts);
 PARAMETER(PAR.System_Value_Numeric);
 PARAMETER(PAR.Email_Address);

 //?***** Change Log and Comments
 DO;

 //?*****
 //?** 04/24/2011 LJB P000737
 //?** Pgm PODPUPR replaced with PDVVUPC. Parms changed to either
 //?** Print Only or Fax/Email to all carriers that are passed in.
 //?** *** Parms are:
 //?** Status-Y or N = Fax Carrier, Status Flag 1 Y/N=Fax Dispatcher,
 //?** Status Flag 2 Y/N=Fax Transloader, Status Flag 3 Y/N=Fax Mexican,
 //?** Status Flag 4 Y/N=Fax Exp Coordn, Status Flag 5 Y/N=Fax Ocean Shpr,
 //?** Usr Status (Y/N)=Print Only/Fax, Status Description 3=Printer file
 //?*****
 ENDDO;

}


//?Send Fax'd message(s) to the screen
DO;

CASE;

// IF DTL.Status - Y or N is yes
IF DTL.Status_Y_or_N = 'Y';

// Send information message - 'Selected Load(s) have been faxed/emailed to carrier.'
MESSAGE(USR2445 *INFO);

ENDIF;

//?Fax or Email Transloader
CASE;

// IF DTL.Status Flag 2  Y/N is Yes
IF DTL.Status_Flag_2_Y_N = 'Y';

// Send information message - 'Selected Load(s) have been faxed/emailed to transloader.'
MESSAGE(USR4398 *INFO);

ENDIF;

//?Fax Mexican Carrier
CASE;

// IF DTL.Status Flag 3  Y/N is Yes
IF DTL.Status_Flag_3_Y_N = 'Y';

// Send information message - 'Selected Load(s) have been faxed/emailed to Mexican carrier.'
MESSAGE(USR4399 *INFO);

ENDIF;

CASE;

// IF DTL.Status Flag 5  Y/N is Yes
IF DTL.Status_Flag_5_Y_N = 'Y';

// Send information message - 'Selected Load(s) have been faxed/emailed to shipping line.'
MESSAGE(USR4400 *INFO);

ENDIF;

//?Fax or Email Export Coordinator, and any other email addresses
CASE;

// IF DTL.Status Flag 4  Y/N is yes
IF DTL.Status_Flag_4_Y_N = 'Y';

// AND DTL.Email Address is Entered
AND DTL.Email_Address <> *BLANK;

// Send information message - 'Selected Load(s) have been faxed/emailed to export coordinator.'
MESSAGE(USR4401 *INFO);

ENDIF;

ENDDO;

ENDIF;

ENDIF;

//?Old Code (commented out)
DO;

ENDDO;

//?USER: Exit program processing

//?** Pass back fax'd flag
// PAR.Status - Y or N = DTL.Status - Y or N
PAR.Status_Y_or_N = DTL.Status_Y_or_N;

