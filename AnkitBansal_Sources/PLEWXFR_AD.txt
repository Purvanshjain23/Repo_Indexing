// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLEWXFR
// ?Date: 14.08.2025 Time: 02:53:58
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?RMC SDN 475 4/01/2021 recompile for BO number increase from 5.0 to 7.0
//?RMC S14734 04/02/19 change LF Cold Scale of 07 to Cold Scale 46 for Guymon
//?RMC T12136 12/05/17 added sel in lf for 440 scale 03
//?Rtv closest tattoo for prod date/time from the primal scale detail
//?RMC TFS027 5/10/06 added sel in lf for 960-scale 03
// WRK.Date Num 6 Usr = CVTVAR(PAR.CS Date)
WRK.Date_Num_6_Usr = CVTVAR(PAR.CS_Date);

// WRK.End date USR = CVTVAR(WRK.Date Num 6 Usr)
WRK.End_date_USR = CVTVAR(WRK.Date_Num_6_Usr);

// WRK.Date Alpha USR = CONCAT(CON.1,WRK.End date USR,CON.*ZERO)
WRK.Date_Alpha_USR = '1' + WRK.End_date_USR (*ZERO);

// WRK.PSA Cut Date = CVTVAR(WRK.Date Alpha USR)
WRK.PSA_Cut_Date = CVTVAR(WRK.Date_Alpha_USR);

// WRK.PSA Cut Time = CVTVAR(PAR.Production Time UPL)
WRK.PSA_Cut_Time = CVTVAR(PAR.Production_Time_UPL);

EXECUTE FUNCTION(Rtv Tattoo f/trolley  RT) TYPE(RTVOBJ) FILE(PKDLCPP)           AB1260779;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(WRK.PSA_Cut_Date);
PARAMETER(WRK.PSA_Cut_Time);
PARAMETER(PAR.Tattoo_Number_USR);
PARAMETER(PAR.CS_Date);
PARAMETER(PAR.Production_Time_UPL);
PARAMETER(PAR.TH_Kill_Date);
{
 //?USER: Initialize routine

 // PAR.PSA Tattoo = CON.*ZERO
 PAR.PSA_Tattoo = *ZERO;

 // PAR.BOH Buy Order Number = CON.*ZERO
 PAR.BOH_Buy_Order_Number = *ZERO;

 // PAR.BOL Load Number = CON.*ZERO
 PAR.BOL_Load_Number = *ZERO;

 //?USER: Process Data record

 //?Validate Tattoo Number.If invalid, read next prod time's Tattoo
 //?    and try to validate that tattoo
 CASE;

 // IF DB1.PSA Tattoo is NE Zero
 IF DB1.PSA_Tattoo <> *ZERO;

 // WRK.Count USR = CON.1
 WRK.Count_USR = 1;

 // WRK.Kill Date Usr = PAR.TH Kill Date
 WRK.Kill_Date_Usr = PAR.TH_Kill_Date;

 // DOW PAR.BOH Buy Order Number is EQ Zero
 DOW PAR.BOH_Buy_Order_Number = *ZERO;

 // AND WRK.Count USR is LE 4
 AND WRK.Count_USR <= 4;

 // Call program Rtv Tattoo BOL   4 OMS XF.
 CALL PROGRAM(Rtv Tattoo BOL   4 OMS XF) ('PKPFXFR');
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(WRK.Kill_Date_Usr);
 PARAMETER(DB1.PSA_Tattoo);
 PARAMETER(PAR.BOH_Buy_Order_Number);
 PARAMETER(PAR.BOL_Load_Number);
 PARAMETER(DB1.PSA_Cut_Date);
 PARAMETER(DB1.PSA_Cut_Time);

 CASE;

 // IF PAR.BOH Buy Order Number is EQ Zero
 IF PAR.BOH_Buy_Order_Number = *ZERO;

 // WRK.Kill Date Usr = WRK.Kill Date Usr + CON.-1 *DAYS
 WRK.Kill_Date_Usr = DATEINCR(WRK.Kill_Date_Usr '-1' 'DY' 1111111 'NONE' 'N' 1);

 // WRK.Count USR = WRK.Count USR + CON.1
 WRK.Count_USR = WRK.Count_USR + 1;

 ENDIF;

 ENDDO;

 ENDIF;

 CASE;

 // IF PAR.BOH Buy Order Number is NE Zero
 IF PAR.BOH_Buy_Order_Number <> *ZERO;

 // PAR.TH Kill Date = WRK.Kill Date Usr
 PAR.TH_Kill_Date = WRK.Kill_Date_Usr;

 // PAR.PSA Tattoo = DB1.PSA Tattoo
 PAR.PSA_Tattoo = DB1.PSA_Tattoo;

 QUIT;

 ENDIF;

}


