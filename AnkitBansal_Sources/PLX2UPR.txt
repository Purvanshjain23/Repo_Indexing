/***************************************************************** */
/*  PROGRAM NUMBER:  PLX2UPR                                       */
/*  PROGRAM NAME:    READ M3 SUPPLIER UPLOAD FILE AND DISTR TO LIBRARIES */
/*  PROGRAMMER:      ROSE CENTONZE                                 */
/*  CREATE DATE:     09/03/15                                      */
/*                                                                 */
/*  FUNCTION:        THIS CLP CREATES A FILE IN QTEMP FOR DISTRIBUTING */
/*                   TO THE PLANT LIBRARIES WHERE THEIR SUPPLIER ID MASTER  */
/*                   RESIDES                                     */
/*******************************************************************/
/*******************************************************************/
/* Modification History                                            */
/*                                                                 */
/* MM/DD/YY PGMR EXPLANATION OF CHANGE                             */
/* -------- ---- ------------------------------------------------- */
/*******************************************************************/
             PGM        PARM(&RTNCDE)
/*-----------------------------------------------------------------*/
/* PARAMETER                                                       */
/*-----------------------------------------------------------------*/
             DCL        VAR(&CO) TYPE(*CHAR) LEN(3)
             DCL        VAR(&NBRCURRCD) TYPE(*DEC) LEN(10 0) VALUE(0)
             DCL        VAR(&M3LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB360) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB960) TYPE(*CHAR) LEN(10)
             DCL        VAR(&RTNCDE) TYPE(*CHAR) LEN(7)

/*-----------------------------------------------------------------*/
/* PROGRAM VARIABLES                                               */
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
/*-----------------------------------------------------------------*/
/* GET LIBRARIES                                                   */
/*-----------------------------------------------------------------*/
  CALL PBSHXFR ('' &M3LIB)       /* SYSTEM VALUE M3ILIB  */

             CALL       PGM(POMTXFR) PARM('' X'360F' 'M3SUPLIB' +
                          &TOLIB360) /*  COMPANY VALUE  */
             CALL       PGM(POMTXFR) PARM('' X'960F' 'M3SUPLIB' +
                          &TOLIB960) /*  COMPANY VALUE  */
/*-----------------------------------------------------------------*/
/* QTEMP SETUP                                                     */
/*-----------------------------------------------------------------*/
/* PHYSICAL FILE */
  /*         CRTDUPOBJ  OBJ(PLB2REP) FROMLIB(&TOLIB360) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PLB2REP)                  +
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(CRTDUPPF))     */

/* UPDATE INDEX  */
      /*     CRTDUPOBJ  OBJ(PLB2REL0) FROMLIB(TOLIB360) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PLB2REL0)               +
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(CRTDUPLF))     */

/*-----------------------------------------------------------------*/
/* SUPPLIER ID  PLB2REP                                           */
/*-----------------------------------------------------------------*/
/*-----------------------------------------------------------------*/
/* POST PROCESS                               (PPQHUPC)            */
/*-----------------------------------------------------------------*/
/* COPY QTEMP RECORDS TO DOWNLOAD FILE */
             /* CHECK IF DOWNLOAD FILE HAVE ANY RECORDS         */
             RTVMBRD    FILE(&M3LIB/PLB2REPHPE) NBRCURRCD(&NBRCURRCD)
             /* CREATE THE SUFFIXED FILES IF THE FILE IS EMPTY  */
             /* IF THE FILES IS NOT EMPTY, AS400    HAS NOT     */
             /* PULLED DOWN THE DATA FROM THE SUFFIXED FILE YET */
             IF         COND(&NBRCURRCD *EQ 0) +
                             THEN(DO)
               /* ADD RECORDS TO THE SUFFIXED FILE */
             CPYF       FROMFILE(&M3LIB/PLB2REP) +
                          TOFILE(&M3LIB/PLB2REPHPE) MBROPT(*ADD) +
                          FMTOPT(*MAP *DROP)
               MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(CPYSNT))

                  CLRPFM     FILE(&M3LIB/PLB2REP)

               ENDDO
           ELSE DO

               /* RECORDS STILL EXISTS IN THE DOWNLOAD FILE.      */
                  SNDMSG     MSG('WARNING:' *BCAT 'PLB2REP' *BCAT 'not +
                          downloaded.') TOUSR(SEABOARD)
                  GOTO       CMDLBL(ENDPGM)
               ENDDO

UPD360:
             RMVLIBLE   LIB(&TOLIB360)
            MONMSG CPF2103
             ADDLIBLE   LIB(&TOLIB360)
            MONMSG CPF2103
             CALL       PGM(PLX4UPR) PARM(&RTNCDE '360')
UPD960:
             RMVLIBLE   LIB(&TOLIB960)
            MONMSG CPF2103
             ADDLIBLE   LIB(&TOLIB960)
            MONMSG CPF2103
             CALL       PGM(PLX4UPR) PARM(&RTNCDE '960')

   /* FOR TEST!!!!       CLRPFM     FILE(&M3LIB/PLB2REPHPE)       */

             GOTO       CMDLBL(ENDPGM)
/*-----------------------------------------------------------------*/
/*                      ERROR                                      */
/*-----------------------------------------------------------------*/
 CRTDUPPF:
             SNDPGRMSG  TOPGR(ISRCENT) MSG('ERROR:  Create +
                          duplicate file in qtemp for' *BCAT 'PLB2REP')
             CHGJOB     LOG(4 00 *SECLVL)
             GOTO       CMDLBL(ENDPGM)

 CRTDUPLF:
             SNDPGRMSG  TOPGR(ISRCENT) MSG('ERROR:  Create +
                          duplicate file in qtemp for' *BCAT 'PLB2REL0')
             CHGJOB     LOG(4 00 *SECLVL)
             GOTO       CMDLBL(ENDPGM)
 CPYSNT:
             SNDPGRMSG  TOPGR(ISRCENT) MSG('ERROR:  Copy QTEMP +
                          records to PLB2REPHPE file')
             CHGJOB     LOG(4 00 *SECLVL)
             GOTO       CMDLBL(ENDPGM)


/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 ENDPGM:

             ENDPGM
