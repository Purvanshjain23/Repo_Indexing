/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT ORDER FILL BY ITEM FROM HISTORY FILE.          */
/*                                                                  */
/*                                                                  */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - SHEILA SCHERTZ                                      */
/*  DATE      - 08/07/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &OUTQ       - OUTPUT QUEUE                             */
/*          &COPEIS     - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/*          &HOLD       - HOLD PRINT FLAG                           */
/*          &SAVE       - SAVE PRINT FLAG                           */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - TO DATE                                   */
/*          &SHIPTOL    - SHIP TO                                   */
/*          &FLAG       - EXCEPT FLAG                               */
/********************************************************************/
/* RMC 9/12/02  ADDED SHIP TO CUST PARM/SELECTION                   */
/* PKD 4/19/05  ADDED ITEM STRUCTURE TYPE                           */
/* SLM 10/07/05 CHANGE TO USE LOGICAL VIEW                          */
/*              CHANGE TO NOT TO SELECT ON COMPANY                  */
/*              ALSO REMOVE OLD * OUT CODE FOR CLEAN UP             */
/* PIO 05/25/23 - REPLACE OPNQRYF WITH OPNSQLF FOR OMHSTPP FILE     */
/*                ADDED NEEDED OVRDBF AROUND THE COMMAND            */
/*                CHANGE *AND TO AND , *EQ TO =, *GE TO >=, *LE TO  */
/*                <=, &GT TO > IN &D                                */
/********************************************************************/
/********************************************************************/

 OMNIPCLP:   PGM        PARM(&PGM &COMPL &FDATEL &TDATEL &SHIPTOL &FLAG +
          &STRTYP  &OUTQ  &HOLD &SAVE &COPIESL &NIGHTQ)

        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #     */
        DCL    &COMPL     *DEC                    /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)           /*  FROM DATE     */
        DCL    &FDATEL    *DEC                    /*  FOR PASSING   */
        DCL    &TDATE     *DEC    (7 0)           /*  THROUGH DATE  */
        DCL    &TDATEL    *DEC                    /*  FOR PASSING   */
        DCL    &SHIPTO    *DEC    (7 0)           /*  SHIP TO       */
        DCL    &SHIPTOL   *DEC                    /*  FOR PASSING   */
        DCL    &COPIES    *DEC    (3 0)           /*  # OF COPIES   */
        DCL    &COPIESL   *DEC                    /*  FOR PASSING   */
        DCL    &OUTQ      *CHAR   10              /*  OUTPUT QUEUE  */
        DCL    &NIGHTQ    *CHAR   10              /*  NIGHT JOB QUE.*/
        DCL    &HOLD       *CHAR   (4)            /* Hold Status    */
        DCL    &SAVE       *CHAR   (4)            /* Save Status    */
        DCL    &PGM       *CHAR   10              /*  PGM NAME      */
        DCL    &COMPA     *CHAR   3               /*  COMPANY ALPHA */
        DCL    &TDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &FDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &SHIPTOA   *CHAR   7               /*  SHIP TO ALPHA */
        DCL    &FLAG       *CHAR   (1)            /* EXCEPT FLAG    */
        DCL    &STRTYP     *CHAR   (3)            /* ITEM STR TYPE  */
        DCL    &COMMAND    *CHAR   (512)

/* SEND PROGRAM MESSAGE PARAMETERS  */

        DCL    &PGMO      *CHAR   10              /*  PRINTER FILE  */
        DCL     &A        *CHAR   20              /* QRY YTD DATE   */
        DCL     &B        *CHAR   25              /* QRY TO DATE    */
        DCL     &C        *CHAR   25              /* QRY COMPANY    */
        DCL     &E        *CHAR   25              /* QRY SHIP TO    */
        DCL     &D        *CHAR  100              /* QRY ALL        */
        DCL     &DATA     *CHAR   10              /* DATA FILES     */
        DCL     &DATAH    *CHAR   10              /* HIST FILES     */

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&COMPA) VALUE(&COMP) /* Change to alpha +
                          for message data */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATEA) VALUE(&FDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&TDATE) VALUE(&TDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&TDATEA) VALUE(&TDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&SHIPTO) VALUE(&SHIPTOL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&SHIPTOA) VALUE(&SHIPTO) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&COPIES) VALUE(&COPIESL) /* change to +
                          length for print program */

/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/

             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORT                    */
/*********************************************************************/

   /*PIO     CHGVAR     VAR(&A) VALUE('F4GNDT *GE ' *CAT +  +
                         &FDATEA)                         */
   /*PIO*/   CHGVAR     VAR(&A) VALUE('F4GNDT >=  ' *CAT +
                         &FDATEA)

   /*PIO     CHGVAR     VAR(&B) VALUE('*AND F4GNDT *LE ' *CAT + +
                         &TDATEA)                              */
   /*PIO*/   CHGVAR     VAR(&B) VALUE(' AND F4GNDT <=  ' *CAT +
                         &TDATEA)

   /*PIO     CHGVAR     VAR(&C) VALUE('*AND F4AIC3 *EQ ' *CAT + +
                         &COMPA)                              */
   /*PIO*/   CHGVAR     VAR(&C) VALUE(' AND F4AIC3 =   ' *CAT +
                         &COMPA)
/* WITH COMPANY */
             IF         COND(&COMPA *NE '000') THEN(DO)
             IF         COND(&SHIPTOA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&E) VALUE('*AND F4BKC7 *EQ ' *CAT + +
                         &SHIPTOA)                             */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(' AND F4BKC7  =  ' *CAT +
                         &SHIPTOA)
             CHGVAR     VAR(&D) VALUE(&A *BCAT &B *BCAT &C *BCAT &E)
             ENDDO

             IF         COND(&SHIPTOA *EQ '0000000') THEN(DO)
                    CHGVAR VAR(&D) VALUE(&A *BCAT &B *BCAT &C)
             ENDDO
             ENDDO

/* WITH OUT COMPANY */
             IF         COND(&COMPA *EQ '000') THEN(DO)
             IF         COND(&SHIPTOA *NE '0000000') THEN(DO)
   /*PIO     CHGVAR     VAR(&E) VALUE('*AND F4BKC7 *EQ ' *CAT + +
                         &SHIPTOA)                            */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(' AND F4BKC7  =  ' *CAT +
                         &SHIPTOA)
             CHGVAR     VAR(&D) VALUE(&A *BCAT &B *BCAT &E)
             ENDDO

             IF         COND(&SHIPTOA *EQ '0000000') THEN(DO)
                    CHGVAR VAR(&D) VALUE(&A *BCAT &B)
             ENDDO
             ENDDO

/*********************************************************************/
/*   SELECT QUERY BY REPORT BEING RUN                                */
/*********************************************************************/

    /*PIO    OVRDBF     FILE(OMHSTPO3) SHARE(*YES)  +
             OPNQRYF    FILE(OMHSTPO3) +            +
                        QRYSLT(&D) +                +
                        KEYFLD(*FILE)              */
   /*PIO*/   OVRDBF     FILE(OMHSTPP) TOFILE(OMHSTPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMHSTPP Where ' *BCAT &D +
                          *BCAT ' ORDER BY F4RGNB ASC, F4RHNB ASC, +
                          F4RINB ASC, F4S5NB ASC, F4AIC3 ASC') +
                          OPNID(OMHSTPO3) OPTION(*ALL) SEQONLY(*NO) +
                          RCDFMT(@HSTPEN) ALWCPY(*IFRQD) /*PIO*/
   /*PIO*/   OVRDBF     FILE(OMHSTPO3) TOFILE(OMHSTPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) +
                          SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/*********************************************************************/
/*   CALL LISTING PROGRAM                                            */
/*********************************************************************/

             CALL       PGM(&PGM) PARM('' &FDATE &TDATE &FLAG +
                          &STRTYP &SHIPTO &COMPL)

             CLOF       OPNID(OMHSTPO3)
   /*PIO     DLTOVR     FILE(OMHSTPO3)  */
             DLTOVR     FILE(OMHSTPO3) LVL(*JOB) /*PIO*/

 END:        ENDPGM
