// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKGTDFR
// ?Date: 14.08.2025 Time: 02:51:39
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification Log
DO;

//?R10690 JJH 06/27/17 - Producer Location Address
//?- Enable 4=Delete of a Producer Location
//?- Enable 12=Edit D/A
//?R10690 JJH 06/14/17 - Producer Location Address
//?- Temporarily disallow 4=Delete of a Producer Location
//?- This will be re-instated after we promote the Producer Loc
//?  Std D/A file.
//?R10690 JJH 06/09/17 - Producer Location Address
//?- Blank line between records
//?- Hide Pl VND Address Number
//?- Hide M3 Supplier ID
//?- Delete Producer Location Address
//?- Display Producer Location Address
//?T8163 DN  12/30/16 - Recompile only due to M3 Supplier file change.
//?E3580 RMC 08/21/16 - M3 interface changes.
//?      LJB 01/10/06 - Remove Opt 10: Ed Prod Loc Dlvry Co; Per Purva,
//?          this is being done elsewhere now.
//?      SLM 06/20/05 - Add new program to edit Producer Location
//?          Delivery Company
//?      ISE 11/04/20 H16853 - Recompiled due to change in Buy Order Number
ENDDO;

EXECUTE FUNCTION(HPE048) TYPE(EXCINTFUN)                                        AB1190146;
{
 //?Execute internal function

 //?Nppc by Origin State Report
}


// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


EXECUTE FUNCTION(Val Application/User  IF) TYPE(EXCINTFUN)                      AB1129080;
PARAMETER(LCL.Oms_Warehouse_Code);
PARAMETER(LCL.CC_Company_Number);
PARAMETER('HPE');
PARAMETER(LCL.Oms_SalesPerson_Code);
PARAMETER(LCL.Oms_Allow_Multi_Company);
PARAMETER(LCL.Oms_Default_Printer);
PARAMETER(LCL.Oms_Name);
PARAMETER(LCL.Oms_System_Value_Alpha);
PARAMETER(LCL.Oms_Access_Denied_Y_N);
{
 //?Execute internal function

 // Call program Val Application/User  XF.
 CALL PROGRAM(Val Application/User  XF) ('PDGXXFR');
 PARAMETER(PAR.Oms_Warehouse_Code);
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(PAR.Oms_Application_Code);
 PARAMETER(PAR.Oms_SalesPerson_Code);
 PARAMETER(PAR.Oms_Allow_Multi_Company);
 PARAMETER(PAR.Oms_Default_Printer);
 PARAMETER(PAR.Oms_Name);
 PARAMETER(PAR.Oms_System_Value_Alpha);
 PARAMETER(PAR.Oms_Access_Denied_Y_N);

 CASE;

 // IF PAR.Oms Access Denied (Y/N) is Yes
 IF PAR.Oms_Access_Denied_Y_N = 'Y';

 // Send error message - 'Access Denied for User'
 ERROR(PRK0298);

 // IF *OTHERWISE
 IF *OTHERWISE;

 // Execute function Mov ApplN to Company  US.
 EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
 PARAMETER(PAR.Oms_System_Value_Alpha);
 {
  C***   MOVE USER SOURCE                      ***
  C                     MOVEL#IEVTX    ##CMP
 }

 ENDIF;

}


// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(LCL.CC_Company_Number);
PARAMETER('M3VEND');
PARAMETER(PAR.Live_with_M3_USR);

//?USER: Initialize subfile control

CASE;

// IF WRK.First Time Flag Usr EQ WRK.Blank USR
IF WRK.First_Time_Flag_Usr = WRK.Blank_USR;

// CTL.RS Record Status = CND.Active
CTL.RS_Record_Status = 'A';

// WRK.First Time Flag Usr = CND.Yes
WRK.First_Time_Flag_Usr = 'Y';

ENDIF;

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(CTL.Producer_Name_DRV);
PARAMETER(CTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?USER: Initialize subfile record from DBF record

//?R10690 JJH 06/09/17 - Display Producer Location Address
// Call program Rtv Producer Loc Addr XF.
CALL PROGRAM(Rtv Producer Loc Addr XF) ('PWC6XFR');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(NLL.Address_Number);
PARAMETER(NLL.Pass_Name);
PARAMETER(RCD.Address_1);
PARAMETER(NLL.Address_2);
PARAMETER(NLL.Address_3);
PARAMETER(RCD.City);
PARAMETER(RCD.State);
PARAMETER(RCD.Zip);
PARAMETER(RCD.Area_Code);
PARAMETER(RCD.Country_Code);
PARAMETER(RCD.Telephone);
PARAMETER(NLL.Fax_Area_Code_#);
PARAMETER(NLL.Fax_Telephone);
PARAMETER(NLL.Fax_Attn_1);
PARAMETER(NLL.Fax_Area_Code_#_2);
PARAMETER(NLL.Fax_Telephone_2);
PARAMETER(NLL.Fax_Attn_2);
PARAMETER(NLL.Vendor_1099);
PARAMETER(NLL.Vendor_Tax_Id);

//?R10690 JJH 06/09/17 - Do not display M3 Supplier
//?USER: Process subfile control (Pre-confirm)

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?F6=Create
CASE;

// IF CTL.*CMD key is CF06
IF CTL.*CMD_key = '06';

// CTL.PL Location Code = WRK.Blank USR
CTL.PL_Location_Code = WRK.Blank_USR;

// Call program Edt Producer Loc      E1.
CALL PROGRAM(Edt Producer Loc      E1) ('PKGRE1R');
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(CTL.Producer_Name_DRV);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?R10690 JJH 06/09/17 - Do not display M3 Supplier
//?USER: Process subfile record (Pre-confirm)

//?2=Edit
CASE;

// IF RCD.*SFLSEL is *Revise request
IF RCD.*SFLSEL = '2'/'2';

// Call program Edt Producer Loc      E1.
CALL PROGRAM(Edt Producer Loc      E1) ('PKGRE1R');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(CTL.Producer_Name_DRV);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?*************************************************************************
//?*************************************************************************
//?R10690 JJH 06/27/17 - Enable 4=Delete
//?Options 4,7
CASE;

// IF RCD.*SFLSEL is *Option 7 (Reusable)
IF RCD.*SFLSEL = '7';

// Call program Edt Prod Loc Comment  EF.
CALL PROGRAM(Edt Prod Loc Comment  EF) ('PKEGEFR');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?Options 4,7
// IF RCD.*SFLSEL is Select Purge
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Chk Prdcr/Loc f/ Dlt  RT) TYPE(RTVOBJ) FILE(PKAWCPP)           AB1163037;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 // Send error message - 'A Buy Order is using this record.  Delete is not allowed.'
 ERROR(PRK0263);

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = 999;

 QUIT;

}


EXECUTE FUNCTION(Chk Prdcr/Loc for Dlt RT) TYPE(RTVOBJ) FILE(PKAQCPP)           AB1163039;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = 999;

 // Send error message - 'A Producer Sub-Contract is using record.  Delete is invalid.'
 ERROR(PRK0264);

 QUIT;

}


EXECUTE FUNCTION(Chk Prdcr/Loc for Dlt RT) TYPE(RTVOBJ) FILE(PKAVCPP)           AB1163042;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = 999;

 // Send error message - 'Producer Purchase Plan is using the record.  Delete is not allowed.'
 ERROR(PRK0547);

 QUIT;

}


// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?Option 8=Std Delv Schedule
CASE;

// IF RCD.*SFLSEL is *Display request
IF RCD.*SFLSEL = '8'/'8';

// Call program Edt Std Delv Sched    EF.
CALL PROGRAM(Edt Std Delv Sched    EF) ('PKAEEFR');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?Date 03/17/2004 Susan Mason Add new program to edit
//?                            Location D/A for TFM Release 01
//?***********************************************************************
//?***********************************************************************
//?R10690 JJH 06/27/17 - Enable 12=Edt D/A
//?Option 12 Edit Location D/A
CASE;

// IF RCD.*SFLSEL is *Option 12 (Reusable)
IF RCD.*SFLSEL = '12';

// Call program Edt Prod/Loc D/A      EF.
CALL PROGRAM(Edt Prod/Loc D/A      EF) ('PLEFEFR');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?** 1/10/06 LJB - Remove Opt 10: Ed Prod Loc Dlvry Co
//?**       Per Purva - this is being done elsewhere now
//?06/20/05 SLM Add new program to edit
//?               Producer Location Delivery Company
//?USER: Process subfile record (Post-confirm)

//?*************************************************************************
//?*************************************************************************
//?Delete Producer Loc Std D/A
CASE;

// IF RCD.*SFLSEL is *Delete request
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Dlt Production Loc    DO) TYPE(DLTOBJ) FILE(PKAFREP)           AB1100393;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Rtv/Dlt Prod Loc Comm RT) TYPE(RTVOBJ) FILE(PKAHREP)           AB1105515;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PL_Location_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  //?USER: Process Data record

  EXECUTE FUNCTION(Delete Producer Loc Comme) TYPE(DLTOBJ) FILE(PKAHREP)          AB1105459;
  PARAMETER(DB1.PD_Producer_Code);
  PARAMETER(DB1.PL_Location_Code);
  PARAMETER(DB1.PLC_Comment_Line);
 }

 //?03/25/2004 slm Add purge of Producer Loc Std D/A  TFM Release 01
 EXECUTE FUNCTION(Rtv/Dlt Prod Loc D/A  RT) TYPE(RTVOBJ) FILE(PLAPREP)           AB1258776;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PL_Location_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  //?USER: Process Data record

  EXECUTE FUNCTION(Dlt Prod/Loc All D/A  DO) TYPE(DLTOBJ) FILE(PLAPREP)           AB1334216;
  PARAMETER(DB1.PD_Producer_Code);
  PARAMETER(DB1.PL_Location_Code);
 }

}


EXECUTE FUNCTION(Rtv/Dlt Prod Loc Comm RT) TYPE(RTVOBJ) FILE(PKAHREP)           AB1105515;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(Delete Producer Loc Comme) TYPE(DLTOBJ) FILE(PKAHREP)          AB1105459;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.PLC_Comment_Line);
}


EXECUTE FUNCTION(Rtv/Dlt prdcr/loc     RT) TYPE(RTVOBJ) FILE(PKANCPP)           AB1163051;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(Dlt Std Delv Days     DL) TYPE(DLTOBJ) FILE(PKANCPP)           AB1100763;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.PSDS_Effective_Kill_Date);
 PARAMETER(DB1.PSDD_Delv_Day_Of_Week);
}


EXECUTE FUNCTION(Rtv/Dlt Prdcr,Loc     RT) TYPE(RTVOBJ) FILE(PKAMCPP)           AB1163052;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(Dlt Standard Delv     DL) TYPE(DLTOBJ) FILE(PKAMCPP)           AB1100381;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.PSDS_Effective_Kill_Date);
}


EXECUTE FUNCTION(Rtv/Del PL Ext        RT) TYPE(RTVOBJ) FILE(PLB5REP)           AB1326453;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del Producer Loc EXT  DL) TYPE(DLTOBJ) FILE(PLB5REP)           AB1322001;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
}


//?R10690 JJH 06/09/17 - Delete Producer Location Address
EXECUTE FUNCTION(Dlt Producer Loc Addr DR) TYPE(DLTOBJ) FILE(PWAHREP)           AB1335173;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

