// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVCHXFR
// ?Date: 14.08.2025 Time: 03:51:53
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// PAR.Upd Suffix File f/360 USR = CND.No
PAR.Upd_Suffix_File_f_360_USR = 'N';

// PAR.Upd Suffix File f/440 USR = CND.No
PAR.Upd_Suffix_File_f_440_USR = 'N';

// PAR.Upd Suffix File f/960 USR = CND.No
PAR.Upd_Suffix_File_f_960_USR = 'N';

// LCL.PFS Company Number = CVTVAR(PAR.PFS Company Number Alpha)
LCL.PFS_Company_Number = CVTVAR(PAR.PFS_Company_Number_Alpha);

EXECUTE FUNCTION(Snd PFS Manif Hdr&Dtl RT) TYPE(RTVOBJ) FILE(PPBRCPP)           AC2220486;
PARAMETER(LCL.PFS_Company_Number);
PARAMETER(PAR.Upd_Suffix_File_f_360_USR);
PARAMETER(PAR.Upd_Suffix_File_f_440_USR);
PARAMETER(PAR.Upd_Suffix_File_f_960_USR);
{
 //?USER: Initialize routine

 // PAR.Upd Suffix File f/360 USR = CND.No
 PAR.Upd_Suffix_File_f_360_USR = 'N';

 // PAR.Upd Suffix File f/440 USR = CND.No
 PAR.Upd_Suffix_File_f_440_USR = 'N';

 // PAR.Upd Suffix File f/960 USR = CND.No
 PAR.Upd_Suffix_File_f_960_USR = 'N';

 //?USER: Process Data record

 //?Initialization.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Continue (Yes/No) USR = CND.Yes
 LCL.Continue_Yes_No_USR = 'Y';

 //?Get Shipping Company from PFS Ship To Warehouse.
 EXECUTE FUNCTION(RTV Shipping Co        RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1695057;
 PARAMETER(DB1.PFS_Ship_To_Warehouse);
 PARAMETER(LCL.Shipping_Company);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

 //?Validations.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?HDR & DTL Records Must Exist ELSE Set to PFS Process Sts to 'Error'.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Rtv Record Exist      RT) TYPE(RTVOBJ) FILE(PPBNCPP)           AC2224233;
 PARAMETER(DB1.PFS_Manifest_ID);
 {
  //?USER: Process Data record

  QUIT;

 }

 //?Record Exist?
 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 //?Record Exist?
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Per Judi Llupo (Carlisle), we should NEVER have orphan during
 //?their export data to Seaboard.
 // LCL.Continue (Yes/No) USR = CND.No
 LCL.Continue_Yes_No_USR = 'N';

 ENDIF;

 ENDIF;

 ENDIF;

 //?Processing.
 CASE;

 // IF LCL.Continue (Yes/No) USR is Yes
 IF LCL.Continue_Yes_No_USR = 'Y';

 // LCL.PFS Manifest ID Text USR = CVTVAR(DB1.PFS Manifest ID)
 LCL.PFS_Manifest_ID_Text_USR = CVTVAR(DB1.PFS_Manifest_ID);

 //?The Shipping Co will Designate What Suffixed File to Write to.
 //?Copy PFS Manifest HDR Record to Suffixed File in QTEMP - *ADD.
 CASE;

 // IF LCL.Shipping Company is Guymon
 IF LCL.Shipping_Company = 360;

 // PAR.Upd Suffix File f/360 USR = CND.Yes
 PAR.Upd_Suffix_File_f_360_USR = 'Y';

 // Call program Cpy ManHdrDtl to SfxFilCL.
 CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
 PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
 PARAMETER(*BLANKS);
 PARAMETER('PPBRCPP');
 PARAMETER('PPBRCPPGUY');

 //?Copy PFS Manifest HDR Record to Suffixed File in QTEMP - *ADD.
 // IF LCL.Shipping Company is Sioux City
 IF LCL.Shipping_Company = 440;

 // PAR.Upd Suffix File f/440 USR = CND.Yes
 PAR.Upd_Suffix_File_f_440_USR = 'Y';

 // Call program Cpy ManHdrDtl to SfxFilCL.
 CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
 PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
 PARAMETER(*BLANKS);
 PARAMETER('PPBRCPP');
 PARAMETER('PPBRCPPSTF');

 //?Copy PFS Manifest HDR Record to Suffixed File in QTEMP - *ADD.
 // IF LCL.Shipping Company is St. Joseph
 IF LCL.Shipping_Company = 960;

 // PAR.Upd Suffix File f/960 USR = CND.Yes
 PAR.Upd_Suffix_File_f_960_USR = 'Y';

 // Call program Cpy ManHdrDtl to SfxFilCL.
 CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
 PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
 PARAMETER('CON *BLANKS');
 PARAMETER('PPBRCPP');
 PARAMETER('PPBRCPPSTJ');

 ENDIF;

 //?Read PFS Manifest Dtl to Copy Record in Suffixed File in QTEMP - *ADD.
 EXECUTE FUNCTION(Snd PFS Manifest DTL  RT) TYPE(RTVOBJ) FILE(PPBNCPP)           AC2220494;
 PARAMETER(DB1.PFS_Manifest_ID);
 PARAMETER(LCL.Shipping_Company);
 {
  //?USER: Process Data record

  // LCL.PFS Manifest ID Text USR = CVTVAR(DB1.PFS Manifest ID)
  LCL.PFS_Manifest_ID_Text_USR = CVTVAR(DB1.PFS_Manifest_ID);

  // LCL.PFS Manifest Detail ID U = CVTVAR(DB1.PFS Manifest Detail ID)
  LCL.PFS_Manifest_Detail_ID_U = CVTVAR(DB1.PFS_Manifest_Detail_ID);

  //?Copy PFS Manifest DTL Record to Suffixed File in QTEMP - *ADD.
  CASE;

  // IF PAR.Shipping Company is Guymon
  IF PAR.Shipping_Company = 360;

  // Call program Cpy ManHdrDtl to SfxFilCL.
  CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
  PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
  PARAMETER(LCL.PFS_Manifest_Detail_ID_U);
  PARAMETER('PPBNCPP');
  PARAMETER('PPBNCPPGUY');

  //?Copy PFS Manifest DTL Record to Suffixed File in QTEMP - *ADD.
  // IF PAR.Shipping Company is Sioux City
  IF PAR.Shipping_Company = 440;

  // Call program Cpy ManHdrDtl to SfxFilCL.
  CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
  PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
  PARAMETER(LCL.PFS_Manifest_Detail_ID_U);
  PARAMETER('PPBNCPP');
  PARAMETER('PPBNCPPSTF');

  //?Copy PFS Manifest DTL Record to Suffixed File in QTEMP - *ADD.
  // IF PAR.Shipping Company is St. Joseph
  IF PAR.Shipping_Company = 960;

  // Call program Cpy ManHdrDtl to SfxFilCL.
  CALL PROGRAM(Cpy ManHdrDtl to SfxFilCL) ('PVDAUPC');
  PARAMETER(LCL.PFS_Manifest_ID_Text_USR);
  PARAMETER(LCL.PFS_Manifest_Detail_ID_U);
  PARAMETER('PPBNCPP');
  PARAMETER('PPBNCPPSTJ');

  ENDIF;

  EXECUTE FUNCTION(Chg PFS Process Status CH) TYPE(CHGOBJ) FILE(PPBNCPP)          AC2220496;
  PARAMETER(DB1.PFS_Manifest_ID);
  PARAMETER(DB1.PFS_Manifest_Detail_ID);
  PARAMETER(1);
  {
   //?USER: Processing before Data update

   // Call program RTV System Date/Time   UP.
   CALL PROGRAM(RTV System Date/Time   UP) ('PDGFUPC');
   PARAMETER(DB1.PFS_Change_Date);
   PARAMETER(DB1.PFS_Change_Time);

  }

 }

 EXECUTE FUNCTION(Chg PFS Process Status CH) TYPE(CHGOBJ) FILE(PPBRCPP)          AC2220488;
 PARAMETER(DB1.PFS_Manifest_ID);
 PARAMETER(1);
 {
  //?USER: Processing before Data update

  // Call program RTV System Date/Time   UP.
  CALL PROGRAM(RTV System Date/Time   UP) ('PDGFUPC');
  PARAMETER(DB1.PFS_Change_Date);
  PARAMETER(DB1.PFS_Change_Time);

 }

 ENDIF;

 //?If Error, Update PFS Process Status=2 (Error/Void).
 CASE;

 // IF LCL.Continue (Yes/No) USR is No
 IF LCL.Continue_Yes_No_USR = 'N';

 //?This scenario should not happen, per Carlisle.
 EXECUTE FUNCTION(Chg PFS Process Status CH) TYPE(CHGOBJ) FILE(PPBRCPP)          AC2220488;
 PARAMETER(DB1.PFS_Manifest_ID);
 PARAMETER(2);
 {
  //?USER: Processing before Data update

  // Call program RTV System Date/Time   UP.
  CALL PROGRAM(RTV System Date/Time   UP) ('PDGFUPC');
  PARAMETER(DB1.PFS_Change_Date);
  PARAMETER(DB1.PFS_Change_Time);

 }

 ENDIF;

}


