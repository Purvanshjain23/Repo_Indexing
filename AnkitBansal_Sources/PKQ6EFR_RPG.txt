     H/TITLE Edt Carc Dtl Add Flag EF  Edit file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated
     H* - Key changes are not allowed
     H* - New records cannot be added
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Edit file
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 00:45:14
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPKQ6EFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Edt Carc Dtl Add Flag EF  Edit file
      *
     FPKB1CPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Carcass Detail            Retrieval index
      *
     FPKACREL1IF  E           K        DISK
      * RTV : Producer                  Retrieval index
      *
     FPKAAREL0IF  E           K        DISK
      * RTV : Source                    Retrieval index
      *
     FPKA1CPL0IF  E           K        DISK
      * RTV : Tattoo Header             Retrieval index
      *
     FPKB1CPLAIF  E           K        DISK
      * RSQ : Carcass Detail            Co/Bol/Ttt/KlDte
      *
     FPKB1CPL0UF  E           K        DISK
      * UPD : Carcass Detail            Update index
      *
     FPKA1CPL1UF  E           K        DISK
      * UPD : Tattoo Header             Update index
      *
     I@B1CPRA
      * Carcass Detail            Co/Bol/Ttt/KlDte
      * Renamed input format fields
     I              B1HMNB                          WAHMNB
     I              B1BNNB                          WABNNB
     I              B1BONB                          WABONB
     I              B1CVNB                          WACVNB
     I              B1B0DT                          WAB0DT
     I              B1LGNB                          WALGNB
     I              B1EUNB                          WAEUNB
     I              B1LHNB                          WALHNB
     I              B1INST                          WAINST
     I              B1BEPR                          WABEPR
     I              B1ASPC                          WAASPC
     I              B1EWNB                          WAEWNB
     I              B1B4PR                          WAB4PR
     I              B1EYNB                          WAEYNB
     I              B1B1PR                          WAB1PR
     I              B1AVPR                          WAAVPR
     I              B1AUPC                          WAAUPC
     I              B1AWPR                          WAAWPR
     I              B1AXPR                          WAAXPR
     I              B1EZNB                          WAEZNB
     I              B1AYPR                          WAAYPR
     I              B1BBDT                          WABBDT
     I              B1AKTM                          WAAKTM
     I              B1IQST                          WAIQST
     I              B1EFST                          WAEFST
     I              B1H6NB                          WAH6NB
     I              B1BEPC                          WABEPC
     I              B1GCST                          WAGCST
     I              B1GDST                          WAGDST
     I              B1GEST                          WAGEST
     I              B1BHPC                          WABHPC
     I              B1IOST                          WAIOST
     I              B1IPST                          WAIPST
     I              B1LTNB                          WALTNB
     I              B1JNST                          WAJNST
     I              B1X4NB                          WAX4NB
     I              B1FNPC                          WAFNPC
     I              B1FOPC                          WAFOPC
     I              B1FPPC                          WAFPPC
     I              B1K2ST                          WAK2ST
     I              B1K3ST                          WAK3ST
     I              B1JWPR                          WAJWPR
     I              B1F5PC                          WAF5PC
     I              B1JXPR                          WAJXPR
     I              B1JYPR                          WAJYPR
     I              B1JZPR                          WAJZPR
     I              B1J0PR                          WAJ0PR
     I              B1J1PR                          WAJ1PR
     I              B1J2PR                          WAJ2PR
     I              B1J3PR                          WAJ3PR
     I              B1J4PR                          WAJ4PR
     I              B1UTST                          WAUTST
     I              B1HVCD                          WAHVCD
     I              B1DKJR                          WADKJR
     I              B1ITJF                          WAITJF
     I              B1IJGR                          WAIJGR
     I              B1ORJE                          WAORJE
     I              B1OTJR                          WAOTJR
     I              B1PEIR                          WAPEIR
     I              B1IEUF                          WAIEUF
     I              B1ORUE                          WAORUE
     I              B1IUTR                          WAIUTR
     I              B1IJRR                          WAIJRR
     I              B1VCST                          WAVCST
     I              B1VDST                          WAVDST
     I              B1VEST                          WAVEST
     I              B1VFST                          WAVFST
     I              B1VGST                          WAVGST
     I              B1ABCD                          WAABCD
     I              B1AACD                          WAAACD
     I              B1AAVN                          WAAAVN
     I              B1AADT                          WAAADT
     I              B1AMTM                          WAAMTM
     I              B1AJST                          WAAJST
     I              B1AHVN                          WAAHVN
     I              B1AGVN                          WAAGVN
     I              B1ABVN                          WAABVN
     I              B1ABDT                          WAABDT
     I              B1ABTM                          WAABTM
      *
     I@A1CPC5
      * Tattoo Header             Update index
      * Renamed input format fields
     I              A1HMNB                          WBHMNB
     I              A1BNNB                          WBBNNB
     I              A1BONB                          WBBONB
     I              A1CVNB                          WBCVNB
     I              A1B0DT                          WBB0DT
     I              A1AWDT                          WBAWDT
     I              A1BICD                          WBBICD
     I              A1CPST                          WBCPST
     I              A1ACPR                          WBACPR
     I              A1B9PR                          WBB9PR
     I              A1CAPR                          WBCAPR
     I              A1C4ST                          WBC4ST
     I              A1AIPR                          WBAIPR
     I              A1A6DT                          WBA6DT
     I              A1C2ST                          WBC2ST
     I              A1CXNB                          WBCXNB
     I              A1CWNB                          WBCWNB
     I              A1FCNB                          WBFCNB
     I              A1H9NB                          WBH9NB
     I              A1FDNB                          WBFDNB
     I              A1FENB                          WBFENB
     I              A1HENB                          WBHENB
     I              A1HFNB                          WBHFNB
     I              A1CYNB                          WBCYNB
     I              A1LRNB                          WBLRNB
     I              A1E0NB                          WBE0NB
     I              A1A5PC                          WBA5PC
     I              A1FBNB                          WBFBNB
     I              A1A4PC                          WBA4PC
     I              A1F7NB                          WBF7NB
     I              A1HDNB                          WBHDNB
     I              A1F5NB                          WBF5NB
     I              A1F4NB                          WBF4NB
     I              A1F3NB                          WBF3NB
     I              A1F2NB                          WBF2NB
     I              A1AVPC                          WBAVPC
     I              A1AWPC                          WBAWPC
     I              A1CWPC                          WBCWPC
     I              A1A8PC                          WBA8PC
     I              A1A7PC                          WBA7PC
     I              A1B8PR                          WBB8PR
     I              A1AMPR                          WBAMPR
     I              A1ANPR                          WBANPR
     I              A1AYVA                          WBAYVA
     I              A1AWVA                          WBAWVA
     I              A1AOPR                          WBAOPR
     I              A1AXVA                          WBAXVA
     I              A1APPR                          WBAPPR
     I              A1ASPR                          WBASPR
     I              A1A4VA                          WBA4VA
     I              A1ATPR                          WBATPR
     I              A1A5VA                          WBA5VA
     I              A1CBPR                          WBCBPR
     I              A1CCPR                          WBCCPR
     I              A1LPNB                          WBLPNB
     I              A1CDPR                          WBCDPR
     I              A1A7VA                          WBA7VA
     I              A1A2PR                          WBA2PR
     I              A1JWST                          WBJWST
     I              A1CWST                          WBCWST
     I              A1D7ST                          WBD7ST
     I              A1D8ST                          WBD8ST
     I              A1DWST                          WBDWST
     I              A1D6ST                          WBD6ST
     I              A1GHNB                          WBGHNB
     I              A1BYDT                          WBBYDT
     I              A1E0ST                          WBE0ST
     I              A1E1ST                          WBE1ST
     I              A1E2ST                          WBE2ST
     I              A1BSDT                          WBBSDT
     I              A1BTDT                          WBBTDT
     I              A1BUDT                          WBBUDT
     I              A1HGNB                          WBHGNB
     I              A1HHNB                          WBHHNB
     I              A1HINB                          WBHINB
     I              A1A3PR                          WBA3PR
     I              A1A4PR                          WBA4PR
     I              A1A6PR                          WBA6PR
     I              A1J9NB                          WBJ9NB
     I              A1D6PR                          WBD6PR
     I              A1D7PR                          WBD7PR
     I              A1D8PR                          WBD8PR
     I              A1D9PR                          WBD9PR
     I              A1EAPR                          WBEAPR
     I              A1EBPR                          WBEBPR
     I              A1ECPR                          WBECPR
     I              A1EDPR                          WBEDPR
     I              A1EEPR                          WBEEPR
     I              A1EFPR                          WBEFPR
     I              A1EGPR                          WBEGPR
     I              A1EHPR                          WBEHPR
     I              A1KAST                          WBKAST
     I              A1J7ST                          WBJ7ST
     I              A1J9ST                          WBJ9ST
     I              A1OXNB                          WBOXNB
     I              A1LKST                          WBLKST
     I              A1LLST                          WBLLST
     I              A1J8ST                          WBJ8ST
     I              A1LIST                          WBLIST
     I              A1LJST                          WBLJST
     I              A1NZTX                          WBNZTX
     I              A1HJCD                          WBHJCD
     I              A1R4ST                          WBR4ST
     I              A1R5ST                          WBR5ST
     I              A1R6ST                          WBR6ST
     I              A1R7ST                          WBR7ST
     I              A1THWT                          WBTHWT
     I              A1T2WT                          WBT2WT
     I              A1THHD                          WBTHHD
     I              A1T2HD                          WBT2HD
     I              A1OBPR                          WBOBPR
     I              A1KOER                          WBKOER
     I              A1OPIR                          WBOPIR
     I              A1OPEM                          WBOPEM
     I              A1IORP                          WBIORP
     I              A1OWEO                          WBOWEO
     I              A1OQET                          WBOQET
     I              A1URST                          WBURST
     I              A1USST                          WBUSST
     I              A1HHPC                          WBHHPC
     I              A1S9PR                          WBS9PR
     I              A1TAPR                          WBTAPR
     I              A1TBPR                          WBTBPR
     I              A1JFUR                          WBJFUR
     I              A1KRIF                          WBKRIF
     I              A1KORF                          WBKORF
     I              A1KAPR                          WBKAPR
     I              A1KROT                          WBKROT
     I              A1OTJG                          WBOTJG
     I              A1IRJG                          WBIRJG
     I              A1IMJF                          WBIMJF
     I              A1IRGF                          WBIRGF
     I              A1KRJF                          WBKRJF
     I              A1OJRF                          WBOJRF
     I              A1KFOR                          WBKFOR
     I              A1ORJK                          WBORJK
     I              A1OMVJ                          WBOMVJ
     I              A1MVNF                          WBMVNF
     I              A1MCNF                          WBMCNF
     I              A1NCNF                          WBNCNF
     I              A1NCHF                          WBNCHF
     I              A1IGIR                          WBIGIR
     I              A1KFJR                          WBKFJR
     I              A1EADT                          WBEADT
     I              A1EBDT                          WBEBDT
     I              A1ECDT                          WBECDT
     I              A1EDDT                          WBEDDT
     I              A1EEDT                          WBEEDT
     I              A1U4ST                          WBU4ST
     I              A1U5ST                          WBU5ST
     I              A1U6ST                          WBU6ST
     I              A1U7ST                          WBU7ST
     I              A1U8ST                          WBU8ST
     I              A1U9ST                          WBU9ST
     I              A1VAST                          WBVAST
     I              A1VBST                          WBVBST
     I              A1BDCD                          WBBDCD
     I              A1CSCD                          WBCSCD
     I              A1ABCD                          WBABCD
     I              A1AECD                          WBAECD
     I              A1ACCD                          WBACCD
     I              A1AGCD                          WBAGCD
     I              A1BECD                          WBBECD
     I              A1AAVN                          WBAAVN
     I              A1AADT                          WBAADT
     I              A1AMTM                          WBAMTM
     I              A1AJST                          WBAJST
     I              A1AHVN                          WBAHVN
     I              A1AGVN                          WBAGVN
     I              A1ABVN                          WBABVN
     I              A1ABDT                          WBABDT
     I              A1ABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSPKB1CPL0
      * UPD : Carcass Detail            Update index
      * Current/previous master file format fields for change control
      *
     IYARDCS      DS                            267
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
     IQPKA11    E DSPKA1CPL1
      * UPD : Tattoo Header             Update index
      * Renamed input format fields
     I              A1HMNB                          WBHMNB
     I              A1BNNB                          WBBNNB
     I              A1BONB                          WBBONB
     I              A1CVNB                          WBCVNB
     I              A1B0DT                          WBB0DT
     I              A1AWDT                          WBAWDT
     I              A1BICD                          WBBICD
     I              A1CPST                          WBCPST
     I              A1ACPR                          WBACPR
     I              A1B9PR                          WBB9PR
     I              A1CAPR                          WBCAPR
     I              A1C4ST                          WBC4ST
     I              A1AIPR                          WBAIPR
     I              A1A6DT                          WBA6DT
     I              A1C2ST                          WBC2ST
     I              A1CXNB                          WBCXNB
     I              A1CWNB                          WBCWNB
     I              A1FCNB                          WBFCNB
     I              A1H9NB                          WBH9NB
     I              A1FDNB                          WBFDNB
     I              A1FENB                          WBFENB
     I              A1HENB                          WBHENB
     I              A1HFNB                          WBHFNB
     I              A1CYNB                          WBCYNB
     I              A1LRNB                          WBLRNB
     I              A1E0NB                          WBE0NB
     I              A1A5PC                          WBA5PC
     I              A1FBNB                          WBFBNB
     I              A1A4PC                          WBA4PC
     I              A1F7NB                          WBF7NB
     I              A1HDNB                          WBHDNB
     I              A1F5NB                          WBF5NB
     I              A1F4NB                          WBF4NB
     I              A1F3NB                          WBF3NB
     I              A1F2NB                          WBF2NB
     I              A1AVPC                          WBAVPC
     I              A1AWPC                          WBAWPC
     I              A1CWPC                          WBCWPC
     I              A1A8PC                          WBA8PC
     I              A1A7PC                          WBA7PC
     I              A1B8PR                          WBB8PR
     I              A1AMPR                          WBAMPR
     I              A1ANPR                          WBANPR
     I              A1AYVA                          WBAYVA
     I              A1AWVA                          WBAWVA
     I              A1AOPR                          WBAOPR
     I              A1AXVA                          WBAXVA
     I              A1APPR                          WBAPPR
     I              A1ASPR                          WBASPR
     I              A1A4VA                          WBA4VA
     I              A1ATPR                          WBATPR
     I              A1A5VA                          WBA5VA
     I              A1CBPR                          WBCBPR
     I              A1CCPR                          WBCCPR
     I              A1LPNB                          WBLPNB
     I              A1CDPR                          WBCDPR
     I              A1A7VA                          WBA7VA
     I              A1A2PR                          WBA2PR
     I              A1JWST                          WBJWST
     I              A1CWST                          WBCWST
     I              A1D7ST                          WBD7ST
     I              A1D8ST                          WBD8ST
     I              A1DWST                          WBDWST
     I              A1D6ST                          WBD6ST
     I              A1GHNB                          WBGHNB
     I              A1BYDT                          WBBYDT
     I              A1E0ST                          WBE0ST
     I              A1E1ST                          WBE1ST
     I              A1E2ST                          WBE2ST
     I              A1BSDT                          WBBSDT
     I              A1BTDT                          WBBTDT
     I              A1BUDT                          WBBUDT
     I              A1HGNB                          WBHGNB
     I              A1HHNB                          WBHHNB
     I              A1HINB                          WBHINB
     I              A1A3PR                          WBA3PR
     I              A1A4PR                          WBA4PR
     I              A1A6PR                          WBA6PR
     I              A1J9NB                          WBJ9NB
     I              A1D6PR                          WBD6PR
     I              A1D7PR                          WBD7PR
     I              A1D8PR                          WBD8PR
     I              A1D9PR                          WBD9PR
     I              A1EAPR                          WBEAPR
     I              A1EBPR                          WBEBPR
     I              A1ECPR                          WBECPR
     I              A1EDPR                          WBEDPR
     I              A1EEPR                          WBEEPR
     I              A1EFPR                          WBEFPR
     I              A1EGPR                          WBEGPR
     I              A1EHPR                          WBEHPR
     I              A1KAST                          WBKAST
     I              A1J7ST                          WBJ7ST
     I              A1J9ST                          WBJ9ST
     I              A1OXNB                          WBOXNB
     I              A1LKST                          WBLKST
     I              A1LLST                          WBLLST
     I              A1J8ST                          WBJ8ST
     I              A1LIST                          WBLIST
     I              A1LJST                          WBLJST
     I              A1NZTX                          WBNZTX
     I              A1HJCD                          WBHJCD
     I              A1R4ST                          WBR4ST
     I              A1R5ST                          WBR5ST
     I              A1R6ST                          WBR6ST
     I              A1R7ST                          WBR7ST
     I              A1THWT                          WBTHWT
     I              A1T2WT                          WBT2WT
     I              A1THHD                          WBTHHD
     I              A1T2HD                          WBT2HD
     I              A1OBPR                          WBOBPR
     I              A1KOER                          WBKOER
     I              A1OPIR                          WBOPIR
     I              A1OPEM                          WBOPEM
     I              A1IORP                          WBIORP
     I              A1OWEO                          WBOWEO
     I              A1OQET                          WBOQET
     I              A1URST                          WBURST
     I              A1USST                          WBUSST
     I              A1HHPC                          WBHHPC
     I              A1S9PR                          WBS9PR
     I              A1TAPR                          WBTAPR
     I              A1TBPR                          WBTBPR
     I              A1JFUR                          WBJFUR
     I              A1KRIF                          WBKRIF
     I              A1KORF                          WBKORF
     I              A1KAPR                          WBKAPR
     I              A1KROT                          WBKROT
     I              A1OTJG                          WBOTJG
     I              A1IRJG                          WBIRJG
     I              A1IMJF                          WBIMJF
     I              A1IRGF                          WBIRGF
     I              A1KRJF                          WBKRJF
     I              A1OJRF                          WBOJRF
     I              A1KFOR                          WBKFOR
     I              A1ORJK                          WBORJK
     I              A1OMVJ                          WBOMVJ
     I              A1MVNF                          WBMVNF
     I              A1MCNF                          WBMCNF
     I              A1NCNF                          WBNCNF
     I              A1NCHF                          WBNCHF
     I              A1IGIR                          WBIGIR
     I              A1KFJR                          WBKFJR
     I              A1EADT                          WBEADT
     I              A1EBDT                          WBEBDT
     I              A1ECDT                          WBECDT
     I              A1EDDT                          WBEDDT
     I              A1EEDT                          WBEEDT
     I              A1U4ST                          WBU4ST
     I              A1U5ST                          WBU5ST
     I              A1U6ST                          WBU6ST
     I              A1U7ST                          WBU7ST
     I              A1U8ST                          WBU8ST
     I              A1U9ST                          WBU9ST
     I              A1VAST                          WBVAST
     I              A1VBST                          WBVBST
     I              A1BDCD                          WBBDCD
     I              A1CSCD                          WBCSCD
     I              A1ABCD                          WBABCD
     I              A1AECD                          WBAECD
     I              A1ACCD                          WBACCD
     I              A1AGCD                          WBAGCD
     I              A1BECD                          WBBECD
     I              A1AAVN                          WBAAVN
     I              A1AADT                          WBAADT
     I              A1AMTM                          WBAMTM
     I              A1AJST                          WBAJST
     I              A1AHVN                          WBAHVN
     I              A1AGVN                          WBAGVN
     I              A1ABVN                          WBABVN
     I              A1ABDT                          WBABDT
     I              A1ABTM                          WBABTM
      *
     IYBRDCS      DS                            583
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             26
      * KEY: Carcass Detail            Retrieval index
      * I : RST BOH Company Number
     I                                    P   1   20P1HMNB
      * I : RST BOH Buy Order Number
     I                                    P   3   60P1BNNB
      * I : RST BOL Load Number
     I                                    P   7   90P1BONB
      * I : RST TH Tattoo Number
     I                                    P  10  120P1CVNB
      * I : RST TH Kill Date
     I                                    P  13  160P1B0DT
     IP2PARM      DS
      * FLD: *Arrays
      * N : MAP Oms Warehouse Code
     I                                        1   3 P2J8NB
      * N : MAP CC Company Number
     I                                    P   4   50P2HONB
      * N : MAP Oms SalesPerson Code
     I                                        6   8 P2C8CD
      * N : MAP Oms Allow Multi-Company
     I                                        9   9 P2G8ST
      * N : MAP Oms Default Printer
     I                                       10  19 P2G9ST
      * N : MAP Oms Name
     I                                       20  49 P2EUTX
      * N : MAP Oms System Value Alpha
     I                                       50  89 P2EVTX
      * N : MAP Oms Access Denied (Y/N)
     I                                       90  90 P2HAST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Invalid Company Number'
      * CC Company Number
     I                                    P   1   20ZA0001
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Carcass De
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile header
      * First Time Processing
      * CASE: WRK.First Time Flag Usr EQ WRK.Blank USR
     C           WUHBST    IFEQ WUCRTX                     *IF
     C                     Z-ADDWUHMNB    #2HMNB           BOH Company Num
     C                     END                             *FI
      * Val Company Number    IF
      * Val Company Number    XF - STR Order Management Sys  * 
     C                     CALL 'PDGZXFR'              90  Val Company Num
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HMNB    WQ0001  30       CC Company Numb
     C           #CBSTX    PARM *BLANK    WQ0002 30        Oms Name
     C           WUG3ST    PARM *BLANK    WQ0003  1        Invalid Y/N USR
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGZXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Invalid Y/N USR is Yes
     C           WUG3ST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#2HMNB    ZA0001           CC Company Numb
      * Send message 'Invalid Company Number'
     C                     MOVEL'PRK0299' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     MOVELWUG3ST    WUG3ST           Invalid Y/N USR
     C                     END
      *................................................................
      * Position file
     C           KPOS      KLIST
     C                     KFLD           B1HMNB           BOH Company Num
     C                     KFLD           B1BNNB           BOH Buy Order N
     C                     KFLD           B1BONB           BOL Load Number
     C                     KFLD           B1CVNB           TH Tattoo Numbe
     C                     KFLD           B1B0DT           TH Kill Date
     C                     KFLD           B1LGNB           CD Scale Sequen
     C                     KFLD           B1EUNB           CD Carcass Numb
     C                     KFLD           B1LHNB           CD Carcass Numb
      * Setup key
     C                     Z-ADD#2HMNB    B1HMNB
     C                     Z-ADD#2BNNB    B1BNNB
     C                     Z-ADD#2BONB    B1BONB
     C                     Z-ADD#2CVNB    B1CVNB
     C                     Z-ADD#2B0DT    B1B0DT
     C                     Z-ADD#2LGNB    B1LGNB
     C                     Z-ADD#2EUNB    B1EUNB
     C                     Z-ADD#2LHNB    B1LHNB
      * 82=EOF
     C           KPOS      SETLL@B1CPG7              82    *
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           B1HMNB           BOH Company Num
     C                     KFLD           B1BNNB           BOH Buy Order N
     C                     KFLD           B1BONB           BOL Load Number
     C                     KFLD           B1CVNB           TH Tattoo Numbe
     C                     KFLD           B1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADD#2HMNB    B1HMNB
     C                     Z-ADD#2BNNB    B1BNNB
     C                     Z-ADD#2BONB    B1BONB
     C                     Z-ADD#2CVNB    B1CVNB
     C                     Z-ADD#2B0DT    B1B0DT
     C  N82      KRST      READE@B1CPG7                9182*
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@B1CPG7                  90*
     C  N82                READ @B1CPG7                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  1
     C                     MOVE *ALL'1'   WKIND1  1
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * Load SFL fields
     C                     EXSR MBFL#1
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
      * 82=EOF
     C           KRST      READE@B1CPG7                  82*
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
      * No errors
     C                     SETOF                     98
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate CD Record Add/Del Sts
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1INST    W0NSRQ  1        CD Record Add/D
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#1INST'  OREQ YPMTFD
     C           ##RR      ANDEQYPMRRN
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1218230   Y2LSNO  70
     C           #1INST    PARM #1INST    W0EXVL 25        CD Record Add/D
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Producer
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      * Check reference to Source
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                     EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
      * Force PUTOVR
     C                     SETON                     86
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C                     MOVEL'N'       W0RSF
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     98
      *
      * Process change request
     C                     EXSR EECHRQ
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Chg Carcass Detail    CH - Carcass Detail  * 
     C                     EXSR SACHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     Z-ADDP1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADD*ZERO     #1LGNB           CD Scale Sequen
     C                     Z-ADD*ZERO     #1EUNB           CD Carcass Numb
     C                     Z-ADD*ZERO     #1LHNB           CD Carcass Numb
     C                     Z-ADD*ZERO     #1BEPR           CD Sort Loss
     C                     Z-ADD*ZERO     #1ASPC           CD STD Yield
     C                     Z-ADD*ZERO     #1B4PR           CD Base Carcass
     C                     Z-ADD*ZERO     #1EYNB           CD Crc Value Pe
     C                     Z-ADD*ZERO     #1B1PR           CD Base Carc Va
     C                     Z-ADD*ZERO     #1AVPR           CD Crc Value $
     C                     Z-ADD*ZERO     #1AWPR           CD Lean Premium
     C                     Z-ADD*ZERO     #1AXPR           CD Lean Premium
     C                     Z-ADD*ZERO     #1EZNB           CD Gross Value
     C                     Z-ADD*ZERO     #1AYPR           CD Gross Value
     C                     Z-ADD*ZERO     #1BBDT           CD Kill Date
     C                     Z-ADD*ZERO     #1AKTM           CD Kill Time
     C                     MOVEL*BLANK    #1IQST           CD Shift
     C                     MOVEL*BLANK    #1EFST           CD Carcass Acti
     C                     MOVEL*BLANK    #1GDST           CD Trim Area
     C                     MOVEL*BLANK    #1GEST           CD Carcass Sex
     C                     Z-ADD*ZERO     #1BHPC           CD FFLI
     C                     MOVEL*BLANK    #1IOST           CD Record Creat
     C                     MOVEL*BLANK    #1IPST           CD Record Creat
     C                     Z-ADD*ZERO     #1LTNB           CD LOT
     C                     MOVEL*BLANK    #1JNST           CD User Error O
     C                     Z-ADD*ZERO     #1X4NB           CD Backfat Thic
     C                     Z-ADD*ZERO     #1FNPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     #1FOPC           CD Light Reflec
     C                     Z-ADD*ZERO     #1FPPC           CD Lean Percent
     C                     MOVEL*BLANK    #1K2ST           CD Source Type
     C                     MOVEL*BLANK    #1K3ST           CD Payment Type
     C                     Z-ADD*ZERO     #1JWPR           CD CA Sort Loss
     C                     Z-ADD*ZERO     #1F5PC           CD CA Std Yield
     C                     Z-ADD*ZERO     #1JXPR           CD CA Base Carc
     C                     Z-ADD*ZERO     #1JYPR           CD CA Crc Value
     C                     Z-ADD*ZERO     #1JZPR           CD CA Base Carc
     C                     Z-ADD*ZERO     #1J0PR           CD CA Crc Value
     C                     Z-ADD*ZERO     #1J1PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     #1J2PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     #1J3PR           CD CA Gross Val
     C                     Z-ADD*ZERO     #1J4PR           CD CA Gross Val
     C                     MOVEL*BLANK    #1UTST           CD Adjust/Add T
     C                     MOVEL*BLANK    #1HVCD           CD Producer Loc
     C                     Z-ADD*ZERO     #1DKJR           CD Loin Eye Inc
     C                     Z-ADD*ZERO     #1ITJF           CD Backfat Inch
     C                     Z-ADD*ZERO     #1IJGR           CD Meat Value F
     C                     Z-ADD*ZERO     #1ORJE           CD Lean Prem/Di
     C                     Z-ADD*ZERO     #1OTJR           CD Fixed Cost F
     C                     Z-ADD*ZERO     #1PEIR           CD MPR Sort Los
     C                     Z-ADD*ZERO     #1IEUF           CD Meat Value F
     C                     Z-ADD*ZERO     #1ORUE           CD Fixed Cost F
     C                     Z-ADD*ZERO     #1IUTR           CD Gross Before
     C                     Z-ADD*ZERO     #1IJRR           CD Gross Before
     C                     MOVEL*BLANK    #1VCST           CD Broken Back
     C                     MOVEL*BLANK    #1VDST           CD Adjust/Add S
     C                     MOVEL*BLANK    #1VEST           CD Unused Sts 3
     C                     MOVEL*BLANK    #1VFST           CD Unused Sts 4
     C                     MOVEL*BLANK    #1VGST           CD Unused Sts 5
     C                     MOVEL*BLANK    #1ABCD           PD Producer Cod
     C                     MOVEL*BLANK    #1AACD           SR Source Code
     C                     MOVEL*BLANK    #1AAVN           RS User Changed
     C                     Z-ADD*ZERO     #1AADT           RS Date Changed
     C                     Z-ADD*ZERO     #1AMTM           RS Time Changed
     C                     MOVEL*BLANK    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1AHVN           RS Job
     C                     MOVEL*BLANK    #1AGVN           RS Program
     C                     MOVEL*BLANK    #1ABVN           RS User Added
     C                     Z-ADD*ZERO     #1ABDT           RS Date Added
     C                     Z-ADD*ZERO     #1ABTM           RS Time Added
     C                     Z-ADDP1BNNB    #1BNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    #1BONB           BOL Load Number
     C                     Z-ADDP1CVNB    #1CVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    #1B0DT           TH Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V1B0DT
     C                     Z-ADD*ZERO     #1EWNB           CD Carcass/Hot
     C                     Z-ADD*ZERO     #1AUPC           CD Lean Percent
     C                     Z-ADD*ZERO     #1H6NB           CD Backfat Thic
     C                     Z-ADD*ZERO     #1BEPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     #1GCST           CD Light Reflec
     C                     MOVEL*BLANK    #1INST           CD Record Add/D
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @B1CPG7 fields to subfile
      *================================================================
     C                     Z-ADDB1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADDB1LGNB    #1LGNB           CD Scale Sequen
     C                     Z-ADDB1EUNB    #1EUNB           CD Carcass Numb
     C                     Z-ADDB1LHNB    #1LHNB           CD Carcass Numb
     C                     Z-ADDB1BEPR    #1BEPR           CD Sort Loss
     C                     Z-ADDB1ASPC    #1ASPC           CD STD Yield
     C                     Z-ADDB1B4PR    #1B4PR           CD Base Carcass
     C                     Z-ADDB1EYNB    #1EYNB           CD Crc Value Pe
     C                     Z-ADDB1B1PR    #1B1PR           CD Base Carc Va
     C                     Z-ADDB1AVPR    #1AVPR           CD Crc Value $
     C                     Z-ADDB1AWPR    #1AWPR           CD Lean Premium
     C                     Z-ADDB1AXPR    #1AXPR           CD Lean Premium
     C                     Z-ADDB1EZNB    #1EZNB           CD Gross Value
     C                     Z-ADDB1AYPR    #1AYPR           CD Gross Value
     C                     Z-ADDB1BBDT    #1BBDT           CD Kill Date
     C                     Z-ADDB1AKTM    #1AKTM           CD Kill Time
     C                     MOVELB1IQST    #1IQST           CD Shift
     C                     MOVELB1EFST    #1EFST           CD Carcass Acti
     C                     MOVELB1GDST    #1GDST           CD Trim Area
     C                     MOVELB1GEST    #1GEST           CD Carcass Sex
     C                     Z-ADDB1BHPC    #1BHPC           CD FFLI
     C                     MOVELB1IOST    #1IOST           CD Record Creat
     C                     MOVELB1IPST    #1IPST           CD Record Creat
     C                     Z-ADDB1LTNB    #1LTNB           CD LOT
     C                     MOVELB1JNST    #1JNST           CD User Error O
     C                     Z-ADDB1X4NB    #1X4NB           CD Backfat Thic
     C                     Z-ADDB1FNPC    #1FNPC           CD Loin-Eye Dep
     C                     Z-ADDB1FOPC    #1FOPC           CD Light Reflec
     C                     Z-ADDB1FPPC    #1FPPC           CD Lean Percent
     C                     MOVELB1K2ST    #1K2ST           CD Source Type
     C                     MOVELB1K3ST    #1K3ST           CD Payment Type
     C                     Z-ADDB1JWPR    #1JWPR           CD CA Sort Loss
     C                     Z-ADDB1F5PC    #1F5PC           CD CA Std Yield
     C                     Z-ADDB1JXPR    #1JXPR           CD CA Base Carc
     C                     Z-ADDB1JYPR    #1JYPR           CD CA Crc Value
     C                     Z-ADDB1JZPR    #1JZPR           CD CA Base Carc
     C                     Z-ADDB1J0PR    #1J0PR           CD CA Crc Value
     C                     Z-ADDB1J1PR    #1J1PR           CD CA Lean Prem
     C                     Z-ADDB1J2PR    #1J2PR           CD CA Lean Prem
     C                     Z-ADDB1J3PR    #1J3PR           CD CA Gross Val
     C                     Z-ADDB1J4PR    #1J4PR           CD CA Gross Val
     C                     MOVELB1UTST    #1UTST           CD Adjust/Add T
     C                     MOVELB1HVCD    #1HVCD           CD Producer Loc
     C                     Z-ADDB1DKJR    #1DKJR           CD Loin Eye Inc
     C                     Z-ADDB1ITJF    #1ITJF           CD Backfat Inch
     C                     Z-ADDB1IJGR    #1IJGR           CD Meat Value F
     C                     Z-ADDB1ORJE    #1ORJE           CD Lean Prem/Di
     C                     Z-ADDB1OTJR    #1OTJR           CD Fixed Cost F
     C                     Z-ADDB1PEIR    #1PEIR           CD MPR Sort Los
     C                     Z-ADDB1IEUF    #1IEUF           CD Meat Value F
     C                     Z-ADDB1ORUE    #1ORUE           CD Fixed Cost F
     C                     Z-ADDB1IUTR    #1IUTR           CD Gross Before
     C                     Z-ADDB1IJRR    #1IJRR           CD Gross Before
     C                     MOVELB1VCST    #1VCST           CD Broken Back
     C                     MOVELB1VDST    #1VDST           CD Adjust/Add S
     C                     MOVELB1VEST    #1VEST           CD Unused Sts 3
     C                     MOVELB1VFST    #1VFST           CD Unused Sts 4
     C                     MOVELB1VGST    #1VGST           CD Unused Sts 5
     C                     MOVELB1ABCD    #1ABCD           PD Producer Cod
     C                     MOVELB1AACD    #1AACD           SR Source Code
     C                     MOVELB1AAVN    #1AAVN           RS User Changed
     C                     Z-ADDB1AADT    #1AADT           RS Date Changed
     C                     Z-ADDB1AMTM    #1AMTM           RS Time Changed
     C                     MOVELB1AJST    #1AJST           RS Record Statu
     C                     MOVELB1AHVN    #1AHVN           RS Job
     C                     MOVELB1AGVN    #1AGVN           RS Program
     C                     MOVELB1ABVN    #1ABVN           RS User Added
     C                     Z-ADDB1ABDT    #1ABDT           RS Date Added
     C                     Z-ADDB1ABTM    #1ABTM           RS Time Added
     C                     Z-ADDB1BNNB    #1BNNB           BOH Buy Order N
     C                     Z-ADDB1BONB    #1BONB           BOL Load Number
     C                     Z-ADDB1CVNB    #1CVNB           TH Tattoo Numbe
     C                     Z-ADDB1B0DT    #1B0DT           TH Kill Date
     C                     Z-ADDB1EWNB    #1EWNB           CD Carcass/Hot
     C                     Z-ADDB1AUPC    #1AUPC           CD Lean Percent
     C                     Z-ADDB1H6NB    #1H6NB           CD Backfat Thic
     C                     Z-ADDB1BEPC    #1BEPC           CD Loin-Eye Dep
     C                     Z-ADDB1GCST    #1GCST           CD Light Reflec
     C                     MOVELB1INST    #1INST           CD Record Add/D
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADDP2HONB    #PHONB           CC Company Numb
     C                     MOVELP2C8CD    #PC8CD           Oms SalesPerson
     C                     MOVELP2G8ST    #PG8ST           Oms Allow Multi
     C                     MOVELP2G9ST    #PG9ST           Oms Default Pri
     C                     MOVELP2EVTX    #PEVTX           Oms System Valu
     C                     MOVELP2J8NB    #PJ8NB           Oms Warehouse C
     C                     MOVELP2HAST    #PHAST           Oms Access Deni
     C                     MOVELP2EUTX    #PEUTX           Oms Name
     C                     Z-ADD*ZERO     #2LGNB           CD Scale Sequen
     C                     Z-ADD*ZERO     #2EUNB           CD Carcass Numb
     C                     Z-ADD*ZERO     #2LHNB           CD Carcass Numb
     C                     Z-ADDP1HMNB    #2HMNB           BOH Company Num
     C                     MOVEL*BLANK    #CBSTX           Name USR
     C                     Z-ADDP1BNNB    #2BNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    #2BONB           BOL Load Number
     C                     Z-ADDP1CVNB    #2CVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    #2B0DT           TH Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V2B0DT
     C                     Z-ADD*ZERO     #CEWNB           CD Carcass/Hot
     C                     Z-ADD*ZERO     #CAUPC           CD Lean Percent
     C                     Z-ADD*ZERO     #CH6NB           CD Backfat Thic
     C                     Z-ADD*ZERO     #CBEPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     #CGCST           CD Light Reflec
     C                     MOVEL*BLANK    #CINST           CD Record Add/D
      * Check restriction within
     C                     EXSR VCCKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  #1B0DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1B0DT
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert TH Kill Date to display format
      * Convert date
     C           1000000   ADD  #2B0DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V2B0DT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Chg Carcass Detail    CH - Carcass Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  51       CD Carcass/Hot
     C                     Z-ADD*ZERO     WN0002  31       CD Lean Percent
     C                     Z-ADD*ZERO     WN0003  60       CD Kill Time
     C                     MOVEL*BLANK    WN0004  1        CD Carcass Acti
     C                     Z-ADD*ZERO     WN0005  31       CD Backfat Thic
     C                     Z-ADD*ZERO     WN0006  31       CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WN0007  31       CD Light Reflec
     C                     MOVEL*BLANK    WN0008  1        CD Trim Area
     C                     MOVEL*BLANK    WN0009  1        CD Carcass Sex
     C                     Z-ADD*ZERO     WN0010  31       CD Backfat Thic
     C                     Z-ADD*ZERO     WN0011  31       CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WN0012  31       CD Light Reflec
     C                     Z-ADD*ZERO     WN0013  31       CD Lean Percent
     C                     MOVEL*BLANK    WN0014  3        CD Adjust/Add T
     C                     MOVEL*BLANK    WN0015  6        CD Producer Loc
     C                     Z-ADD*ZERO     WN0016  52       CD Loin Eye Inc
     C                     Z-ADD*ZERO     WN0017  52       CD Backfat Inch
     C                     Z-ADD*ZERO     WN0018  52       CD Meat Value F
     C                     Z-ADD*ZERO     WN0019  52       CD Lean Prem/Di
     C                     Z-ADD*ZERO     WN0020  52       CD Fixed Cost F
     C                     Z-ADD*ZERO     WN0021  72       CD MPR Sort Los
     C                     Z-ADD*ZERO     WN0022  72       CD Meat Value F
     C                     Z-ADD*ZERO     WN0023  72       CD Fixed Cost F
     C                     Z-ADD*ZERO     WN0024  72       CD Gross Before
     C                     Z-ADD*ZERO     WN0025  72       CD Gross Before
     C                     MOVEL*BLANK    WN0026  1        CD Broken Back
     C                     MOVEL*BLANK    WN0027  2        CD Adjust/Add S
     C                     MOVEL*BLANK    WN0028  3        CD Unused Sts 3
     C                     MOVEL*BLANK    WN0029  3        CD Unused Sts 4
     C                     MOVEL*BLANK    WN0030  6        CD Unused Sts 5
     C                     MOVEL*BLANK    WN0031 10        RS User Changed
     C                     Z-ADD*ZERO     WN0032  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0033  60       RS Time Changed
     C                     MOVEL*BLANK    WN0034  1        RS Record Statu
     C                     MOVEL*BLANK    WN0035 10        RS Job
     C                     MOVEL*BLANK    WN0036 10        RS Program
     C                     MOVEL*BLANK    WN0037 10        RS User Added
     C                     Z-ADD*ZERO     WN0038  70       RS Date Added
     C                     Z-ADD*ZERO     WN0039  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @B1CPG6
     C                     Z-ADD#1HMNB    B1HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    B1BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    B1BONB           BOL Load Number
     C                     Z-ADD#1CVNB    B1CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    B1B0DT           TH Kill Date
     C                     Z-ADD#1LGNB    B1LGNB           CD Scale Sequen
     C                     Z-ADD#1EUNB    B1EUNB           CD Carcass Numb
     C                     Z-ADD#1LHNB    B1LHNB           CD Carcass Numb
      *
     C           KLCHSA    KLIST
     C                     KFLD           B1HMNB           BOH Company Num
     C                     KFLD           B1BNNB           BOH Buy Order N
     C                     KFLD           B1BONB           BOL Load Number
     C                     KFLD           B1CVNB           TH Tattoo Numbe
     C                     KFLD           B1B0DT           TH Kill Date
     C                     KFLD           B1LGNB           CD Scale Sequen
     C                     KFLD           B1EUNB           CD Carcass Numb
     C                     KFLD           B1LHNB           CD Carcass Numb
     C           KLCHSA    CHAIN@B1CPG6              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKB1CPL0'MDACP
     C                     MOVEL'@B1CPG6' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKPKB1CPL0               91  *
     C                     GOTO SAEXIT
     C                     ENDIF                           FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YARDCS
      * Move non-key fields to @B1CPG6
     C                     MOVEL#1INST    B1INST    P      CD Record Add/D
     C                     Z-ADD#1BEPR    B1BEPR           CD Sort Loss
     C                     Z-ADD#1ASPC    B1ASPC           CD STD Yield
     C                     Z-ADD#1B4PR    B1B4PR           CD Base Carcass
     C                     Z-ADD#1EYNB    B1EYNB           CD Crc Value Pe
     C                     Z-ADD#1B1PR    B1B1PR           CD Base Carc Va
     C                     Z-ADD#1AVPR    B1AVPR           CD Crc Value $
     C                     Z-ADD#1AWPR    B1AWPR           CD Lean Premium
     C                     Z-ADD#1AXPR    B1AXPR           CD Lean Premium
     C                     Z-ADD#1EZNB    B1EZNB           CD Gross Value
     C                     Z-ADD#1AYPR    B1AYPR           CD Gross Value
     C                     Z-ADD#1BBDT    B1BBDT           CD Kill Date
     C                     MOVEL#1IQST    B1IQST    P      CD Shift
     C                     Z-ADD#1BHPC    B1BHPC           CD FFLI
     C                     MOVEL#1IOST    B1IOST    P      CD Record Creat
     C                     MOVEL#1IPST    B1IPST    P      CD Record Creat
     C                     Z-ADD#1LTNB    B1LTNB           CD LOT
     C                     MOVEL#1JNST    B1JNST    P      CD User Error O
     C                     MOVEL#1K2ST    B1K2ST    P      CD Source Type
     C                     MOVEL#1K3ST    B1K3ST    P      CD Payment Type
     C                     Z-ADD#1JWPR    B1JWPR           CD CA Sort Loss
     C                     Z-ADD#1F5PC    B1F5PC           CD CA Std Yield
     C                     Z-ADD#1JXPR    B1JXPR           CD CA Base Carc
     C                     Z-ADD#1JYPR    B1JYPR           CD CA Crc Value
     C                     Z-ADD#1JZPR    B1JZPR           CD CA Base Carc
     C                     Z-ADD#1J0PR    B1J0PR           CD CA Crc Value
     C                     Z-ADD#1J1PR    B1J1PR           CD CA Lean Prem
     C                     Z-ADD#1J2PR    B1J2PR           CD CA Lean Prem
     C                     Z-ADD#1J3PR    B1J3PR           CD CA Gross Val
     C                     Z-ADD#1J4PR    B1J4PR           CD CA Gross Val
     C                     MOVEL#1ABCD    B1ABCD    P      PD Producer Cod
     C                     MOVEL#1AACD    B1AACD    P      SR Source Code
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     B1AAVN           RS User Changed
     C                     Z-ADD##JDT     B1AADT           RS Date Changed
     C                     Z-ADD##JTM     B1AMTM           RS Time Changed
     C                     MOVEL##JOB     B1AHVN           RS Job
     C                     MOVEL##PGM     B1AGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@B1CPG6                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKB1CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Cnt Carc Dtl Adds RT - Carcass Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUP0NB           Count USR
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSB01           BOH Company Num
     C           *LIKE     DEFN WABNNB    WQSB02           BOH Buy Order N
     C           *LIKE     DEFN WABONB    WQSB03           BOL Load Number
     C           *LIKE     DEFN WACVNB    WQSB04           TH Tattoo Numbe
     C           *LIKE     DEFN WAB0DT    WQSB05           TH Kill Date
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           BOH Company Num
     C                     KFLD           WQSB02           BOH Buy Order N
     C                     KFLD           WQSB03           BOL Load Number
     C                     KFLD           WQSB04           TH Tattoo Numbe
     C                     KFLD           WQSB05           TH Kill Date
      * Setup key
     C                     Z-ADDP1HMNB    WQSB01           BOH Company Num
     C                     Z-ADDP1BNNB    WQSB02           BOH Buy Order N
     C                     Z-ADDP1BONB    WQSB03           BOL Load Number
     C                     Z-ADDP1CVNB    WQSB04           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WQSB05           TH Kill Date
      * Establish starting position
     C           KRSSB     SETLL@B1CPRA                    *
     C           KRSSB     READE@B1CPRA                  90*
      * Data record not found
     C   90                MOVEL'PRK0138' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.CD Record Add/Del Sts is Add
     C           WAINST    IFEQ 'A'                        *IF
     C                     ADD  1         WUP0NB           Count USR
     C                     END                             *FI
     C           KRSSB     READE@B1CPRA                  90*
     C                     ENDDO
      * USER: Exit processing
      * Update TH Adds
      * Rtv/Chg Head Adds     RT - Tattoo Header  * 
     C                     EXSR SCRVGN
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv/Chg Head Adds     RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADDWAHMNB    A1HMNB           BOH Company Num
     C                     Z-ADDWABNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDWABONB    A1BONB           BOL Load Number
     C                     Z-ADDWACVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDWAB0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSC     CHAIN@A1CPC4              90    *
      * Data record not found
     C   90                MOVEL'PRK0061' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Head Adds         CH - Tattoo Header  * 
     C                     EXSR SDCHRC
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Chg Head Adds         CH - Tattoo Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0040  70       TH Purchase Dat
     C                     MOVEL*BLANK    WN0041 10        TH Group Refere
     C                     MOVEL*BLANK    WN0042  2        TH Live Purchas
     C                     Z-ADD*ZERO     WN0043  52       TH Live Purchas
     C                     Z-ADD*ZERO     WN0044  72       TH Live Gross A
     C                     Z-ADD*ZERO     WN0045  72       TH LIve Net Amt
     C                     MOVEL*BLANK    WN0046  2        TH Resale UOM
     C                     Z-ADD*ZERO     WN0047  52       TH Recalc Live
     C                     Z-ADD*ZERO     WN0048  70       TH Pricing Date
     C                     MOVEL*BLANK    WN0049  1        TH Resale Sprea
     C                     Z-ADD*ZERO     WN0050  50       TH Dead On Arri
     C                     Z-ADD*ZERO     WN0051  50       TH Head Receive
     C                     Z-ADD*ZERO     WN0052  50       TH Yard Deads
     C                     Z-ADD*ZERO     WN0053  50       TH Held Over
     C                     Z-ADD*ZERO     WN0054  50       TH Head Condemn
     C                     Z-ADD*ZERO     WN0055  50       TH Head Killed
     C                     Z-ADD*ZERO     WN0056  50       TH Head Accepte
     C                     Z-ADD*ZERO     WN0057  71       TH Live Wgt
     C                     Z-ADD*ZERO     WN0058  71       TH Adj Live Wgt
     C                     Z-ADD*ZERO     WN0059  71       TH Hot Wgt
     C                     Z-ADD*ZERO     WN0060  61       TH Tot Loin Eye
     C                     Z-ADD*ZERO     WN0061  61       TH Tot Backfat
     C                     Z-ADD*ZERO     WN0062  61       TH Tot Light Re
     C                     Z-ADD*ZERO     WN0063  51       TH Avg Live Wgt
     C                     Z-ADD*ZERO     WN0064  51       TH Avg Hot Wgt
     C                     Z-ADD*ZERO     WN0065  31       TH Avg Light Re
     C                     Z-ADD*ZERO     WN0066  31       TH Avg Lean Per
     C                     Z-ADD*ZERO     WN0067  31       TH Avg Loin Eye
     C                     Z-ADD*ZERO     WN0068  31       TH Avg Backfat
     C                     Z-ADD*ZERO     WN0069  52       TH Std Yield Pe
     C                     Z-ADD*ZERO     WN0070  52       TH Actual Yield
     C                     Z-ADD*ZERO     WN0071  52       TH Adj Actual Y
     C                     Z-ADD*ZERO     WN0072  52       TH Yield Differ
     C                     Z-ADD*ZERO     WN0073  31       TH Recalc Live
     C                     Z-ADD*ZERO     WN0074  52       TH CM Market Pr
     C                     Z-ADD*ZERO     WN0075  52       TH CM Base Mkt
     C                     Z-ADD*ZERO     WN0076  72       TH CM Base Mkt
     C                     Z-ADD*ZERO     WN0077  72       TH CM Sort Disc
     C                     Z-ADD*ZERO     WN0078  72       TH CM Yield Gai
     C                     Z-ADD*ZERO     WN0079  72       TH CM Base Carc
     C                     Z-ADD*ZERO     WN0080  72       TH CM LN AddOn/
     C                     Z-ADD*ZERO     WN0081  72       TH CM Carcass G
     C                     Z-ADD*ZERO     WN0082  72       TH Deduction Am
     C                     Z-ADD*ZERO     WN0083  72       TH Total Net WO
     C                     Z-ADD*ZERO     WN0084  72       TH Carcass Net
     C                     Z-ADD*ZERO     WN0085  72       TH Additions Am
     C                     Z-ADD*ZERO     WN0086  72       TH Payment Gros
     C                     Z-ADD*ZERO     WN0087  72       Th Payment Net
     C                     Z-ADD*ZERO     WN0088  80       TH AP Voucher/D
     C                     Z-ADD*ZERO     WN0089  72       TH Freight Amou
     C                     Z-ADD*ZERO     WN0090  72       TH Accrual Amou
     C                     Z-ADD*ZERO     WN0091  72       TH Fixed Cost A
     C                     MOVEL*BLANK    WN0092  1        TH Calc Net Sts
     C                     MOVEL*BLANK    WN0093  2        TH Payment Sts
     C                     MOVEL*BLANK    WN0094  1        TH Header Error
     C                     MOVEL*BLANK    WN0095  1        TH Detail Error
     C                     MOVEL*BLANK    WN0096  1        TH Kill Balanci
     C                     MOVEL*BLANK    WN0097  1        TH Bal to Kill
     C                     Z-ADD*ZERO     WN0098  80       TH Commission A
     C                     Z-ADD*ZERO     WN0099  70       TH Voucher Paym
     C                     MOVEL*BLANK    WN0100  1        TH User Error O
     C                     MOVEL*BLANK    WN0101  1        TH Held Over Re
     C                     MOVEL*BLANK    WN0102  1        TH Sex
     C                     Z-ADD*ZERO     WN0103  70       TH Held/Ovr Com
     C                     Z-ADD*ZERO     WN0104  70       TH Commission P
     C                     Z-ADD*ZERO     WN0105  70       TH Actual Check
     C                     Z-ADD*ZERO     WN0106  71       TH Shipped Weig
     C                     Z-ADD*ZERO     WN0107  71       TH Avg Hot Wgt
     C                     Z-ADD*ZERO     WN0108  31       TH FFLI
     C                     Z-ADD*ZERO     WN0109  72       TH Kill Product
     C                     Z-ADD*ZERO     WN0110  72       TH Cut Product
     C                     Z-ADD*ZERO     WN0111  72       TH Render Produ
     C                     Z-ADD*ZERO     WN0112  50       TH Head Exclude
     C                     Z-ADD*ZERO     WN0113  52       TH CM Bse Mkt L
     C                     Z-ADD*ZERO     WN0114  52       TH CM Bse Mkt C
     C                     Z-ADD*ZERO     WN0115  52       TH CM Srt Dsc L
     C                     Z-ADD*ZERO     WN0116  52       TH CM Srt Dsc C
     C                     Z-ADD*ZERO     WN0117  52       TH CM Yld G/L L
     C                     Z-ADD*ZERO     WN0118  52       TH CM Yld G/L C
     C                     Z-ADD*ZERO     WN0119  52       TH CM Crc Val L
     C                     Z-ADD*ZERO     WN0120  52       TH CM Crc Val C
     C                     Z-ADD*ZERO     WN0121  52       TH CM Lean Prem
     C                     Z-ADD*ZERO     WN0122  52       TH CM Lean Prem
     C                     Z-ADD*ZERO     WN0123  52       TH CM Gross Liv
     C                     Z-ADD*ZERO     WN0124  52       TH CM Gross Car
     C                     MOVEL*BLANK    WN0125  1        TH Source Type
     C                     MOVEL*BLANK    WN0126  1        TH Scale Ticket
     C                     MOVEL*BLANK    WN0127  1        TH Payment Type
     C                     Z-ADD*ZERO     WN0128  70       TH HPS Movement
     C                     MOVEL*BLANK    WN0129  3        TH Source Code
     C                     MOVEL*BLANK    WN0130  1        TH Hog Class Ty
     C                     MOVEL*BLANK    WN0131  1        TH Posted to HP
     C                     MOVEL*BLANK    WN0132  1        TH Schedule Kil
     C                     MOVEL*BLANK    WN0133  1        TH Shift Held O
     C                     MOVEL*BLANK    WN0134  3        TH State
     C                     MOVEL*BLANK    WN0135  3        TH Unused Code
     C                     MOVEL*BLANK    WN0136  2        TH Unused Sts 2
     C                     MOVEL*BLANK    WN0137  1        TH Commission S
     C                     MOVEL*BLANK    WN0138  1        TH Paid 2 Week
     C                     MOVEL*BLANK    WN0139  1        TH Unused Sts 1
     C                     Z-ADD*ZERO     WN0140  71       TH DOA Weight
     C                     Z-ADD*ZERO     WN0141  71       TH Avg Lean % E
     C                     Z-ADD*ZERO     WN0142  50       TH HPS Farm Sit
     C                     Z-ADD*ZERO     WN0143  50       TH Shift Held O
     C                     Z-ADD*ZERO     WN0144  72       TH Sorting Amou
     C                     Z-ADD*ZERO     WN0145  50       TH Head Identif
     C                     Z-ADD*ZERO     WN0146  52       TH Percent Iden
     C                     Z-ADD*ZERO     WN0147  52       TH Percent Acce
     C                     Z-ADD*ZERO     WN0148  50       TH Head Adjuste
     C                     Z-ADD*ZERO     WN0149  50       TH PHA Head Add
     C                     MOVEL*BLANK    WN0150  1        TH PHA Add Type
     C                     MOVEL*BLANK    WN0151  3        TH PHA Average
     C                     MOVEL*BLANK    WN0152  1        TH PHA Add Reas
     C                     Z-ADD*ZERO     WN0153  52       TH PHA Yield Pe
     C                     Z-ADD*ZERO     WN0154  52       TH PHA Lean Prm
     C                     Z-ADD*ZERO     WN0155  52       TH VC Gross Val
     C                     Z-ADD*ZERO     WN0156  72       TH Excluded Gro
     C                     Z-ADD*ZERO     WN0157  50       TH Avg Lean %
     C                     Z-ADD*ZERO     WN0158  50       TH Broken Back
     C                     Z-ADD*ZERO     WN0159  70       TH Hot Scl Uplo
     C                     Z-ADD*ZERO     WN0160  70       TH Unused Nbr 4
     C                     Z-ADD*ZERO     WN0161  72       TH Excluded Car
     C                     Z-ADD*ZERO     WN0162  72       TH Excluded Pre
     C                     Z-ADD*ZERO     WN0163  71       TH Unused Nbr 7
     C                     Z-ADD*ZERO     WN0164  71       TH Unused Nbr 8
     C                     Z-ADD*ZERO     WN0165 111       TH Unused Nbr 9
     C                     Z-ADD*ZERO     WN0166 111       TH Unused Nbr 1
     C                     Z-ADD*ZERO     WN0167 112       TH Break Even P
     C                     Z-ADD*ZERO     WN0168 112       TH Meat Value F
     C                     Z-ADD*ZERO     WN0169  52       TH Yld Parm Adj
     C                     Z-ADD*ZERO     WN0170  52       TH PHA Sort Dis
     C                     Z-ADD*ZERO     WN0171  52       TH Avg Loin Eye
     C                     Z-ADD*ZERO     WN0172  52       TH Avg Backfat
     C                     Z-ADD*ZERO     WN0173  92       TH HITCH Old Pa
     C                     Z-ADD*ZERO     WN0174  92       TH MPR Sort Los
     C                     Z-ADD*ZERO     WN0175  90       TH Unused Nbr 1
     C                     Z-ADD*ZERO     WN0176  90       TH Unused Nbr 2
     C                     Z-ADD*ZERO     WN0177  70       TH Cold Scl Upl
     C                     Z-ADD*ZERO     WN0178  70       TH Cold Scl Upl
     C                     Z-ADD*ZERO     WN0179  70       TH Head LFT
     C                     Z-ADD*ZERO     WN0180  70       TH Head EUT/KOA
     C                     Z-ADD*ZERO     WN0181  70       TH Unused Date
     C                     MOVEL*BLANK    WN0182  1        TH Unused Sts 1
     C                     MOVEL*BLANK    WN0183  1        TH Unused Sts 2
     C                     MOVEL*BLANK    WN0184  1        TH Unused Sts 3
     C                     MOVEL*BLANK    WN0185  2        TH Unused Sts 4
     C                     MOVEL*BLANK    WN0186  2        TH Unused Sts 5
     C                     MOVEL*BLANK    WN0187  3        TH Unused Sts 6
     C                     MOVEL*BLANK    WN0188  3        TH Unused Sts 7
     C                     MOVEL*BLANK    WN0189  1        TH Unused Sts 8
     C                     MOVEL*BLANK    WN0190  6        DF Defect Code
     C                     MOVEL*BLANK    WN0191  6        THP Process Cod
     C                     MOVEL*BLANK    WN0192  6        PD Producer Cod
     C                     MOVEL*BLANK    WN0193  6        PL Location Cod
     C                     MOVEL*BLANK    WN0194  3        HB Buyer Code
     C                     MOVEL*BLANK    WN0195  5        GN Genetic Code
     C                     MOVEL*BLANK    WN0196  3        HC Class Code
     C                     MOVEL*BLANK    WN0197 10        RS User Changed
     C                     Z-ADD*ZERO     WN0198  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0199  60       RS Time Changed
     C                     MOVEL*BLANK    WN0200  1        RS Record Statu
     C                     MOVEL*BLANK    WN0201 10        RS Job
     C                     MOVEL*BLANK    WN0202 10        RS Program
     C                     MOVEL*BLANK    WN0203 10        RS User Added
     C                     Z-ADD*ZERO     WN0204  70       RS Date Added
     C                     Z-ADD*ZERO     WN0205  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @A1CPC5
     C                     Z-ADDA1HMNB    WBHMNB           BOH Company Num
     C                     Z-ADDA1BNNB    WBBNNB           BOH Buy Order N
     C                     Z-ADDA1BONB    WBBONB           BOL Load Number
     C                     Z-ADDA1CVNB    WBCVNB           TH Tattoo Numbe
     C                     Z-ADDA1B0DT    WBB0DT           TH Kill Date
      *
     C           KLCHSD    KLIST
     C                     KFLD           WBHMNB           BOH Company Num
     C                     KFLD           WBBNNB           BOH Buy Order N
     C                     KFLD           WBBONB           BOL Load Number
     C                     KFLD           WBCVNB           TH Tattoo Numbe
     C                     KFLD           WBB0DT           TH Kill Date
     C           KLCHSD    CHAIN@A1CPC5              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA1CPL1'MDACP
     C                     MOVEL'@A1CPC5' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA11    YBRDCS
      * Move non-key fields to @A1CPC5
     C                     Z-ADDWUP0NB    WBHENB           TH Head Adds
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA11    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WBAAVN           RS User Changed
     C                     Z-ADD##JDT     WBAADT           RS Date Changed
     C                     Z-ADD##JTM     WBAMTM           RS Time Changed
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA11    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@A1CPC5                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA1CPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * H16853 ISE 11/02/20 - Increased the Buy Order Number field
      *                       length from 5 to 7.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Producer
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1ABCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        PD Producer Cod
     C           YPMTFD    OREQ '#1ABCD'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1ABCD' defaulted for 'PD Producer Code'.
     C                     CALL 'PKA1SRR'              90  Sel Producer
     C                     PARM *BLANK    W0RTN   7
     C           #1ABCD    PARM #1ABCD    WQ0004  6        PD Producer Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKA1SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      *
     C           #1ABCD    IFNE *BLANK                     PD Producer Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ABCD    IFEQ *BLANK                     PD Producer Cod
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAAC    KLIST
     C                     KFLD           ACABCD           PD Producer Cod
      * Setup key
     C                     MOVEL#1ABCD    ACABCD
     C           KLVAAC    CHAIN@ACREAI              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Producer               NF'
     C                     MOVEL'PRK0009' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0009' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Source
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1AACD    WK1X01  1
     C           WK1X01    IFEQ '?'                        SR Source Code
     C           YPMTFD    OREQ '#1AACD'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1AACD' defaulted for 'SR Source Code'.
     C                     CALL 'PKDRSRR'              90  Sel Source
     C                     PARM *BLANK    W0RTN   7
     C           #1AACD    PARM #1AACD    WQ0005  3        SR Source Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKDRSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      *
     C           #1AACD    IFNE *BLANK                     SR Source Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1AACD    IFEQ *BLANK                     SR Source Code
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBAA    KLIST
     C                     KFLD           AAAACD           SR Source Code
      * Setup key
     C                     MOVEL#1AACD    AAAACD
     C           KLVBAA    CHAIN@AAREAC              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Source                 NF'
     C                     MOVEL'PRK0005' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0005' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#2HMNB'
     C           YPMTFD    OREQ '#2BNNB'
     C           YPMTFD    OREQ '#2BONB'
     C           YPMTFD    OREQ '#2CVNB'
     C           YPMTFD    OREQ '#2B0DT'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2HMNB' defaulted for 'BOH Company Number'.
      * Field '(CTL) #2CVNB' defaulted for 'TH Tattoo Number'.
      * Field '(CTL) #2B0DT' defaulted for 'TH Kill Date'.
     C                     CALL 'PKB7SRR'              90  Sel Kill/Tattoo
     C                     PARM *BLANK    W0RTN   7
     C           #2HMNB    PARM #2HMNB    WQ0006  30       BOH Company Num
     C           #2CVNB    PARM #2CVNB    WQ0007  50       TH Tattoo Numbe
     C           #2B0DT    PARM #2B0DT    WQ0008  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKB7SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #2HMNB    IFNE *ZERO                      BOH Company Num
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2BONB    IFNE *ZERO                      BOL Load Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2CVNB    IFNE *ZERO                      TH Tattoo Numbe
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2B0DT    IFNE *ZERO                      TH Kill Date
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VC999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVCA1    KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADD#2HMNB    A1HMNB
     C                     Z-ADD#2BNNB    A1BNNB
     C                     Z-ADD#2BONB    A1BONB
     C                     Z-ADD#2CVNB    A1CVNB
     C                     Z-ADD#2B0DT    A1B0DT
     C           KLVCA1    CHAIN@A1CPC4              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
     C           VC999     TAG
      * Restrictor relation not satisfied
      * Send message 'Tattoo Header          NF'
     C                     MOVEL'PRK0061' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0061' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD9         ZHSTRW  40
     C                     Z-ADD20        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           ZHF4RW    IFEQ 009
     C           ZHCSCL    ANDEQ073
     C                     MOVEL'#1INST'  YPMTFD           CD Record Add/D
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * Count Head Adds and update TH
      * Rtv Cnt Carc Dtl Adds RT - Carcass Detail  * 
     C                     EXSR SBRVGN
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P2J8NB           Oms Warehouse C
     C                     Z-ADD*ZERO     P2HONB           CC Company Numb
     C                     MOVEL*BLANK    P2C8CD           Oms SalesPerson
     C                     MOVEL*BLANK    P2G8ST           Oms Allow Multi
     C                     MOVEL*BLANK    P2G9ST           Oms Default Pri
     C                     MOVEL*BLANK    P2EUTX           Oms Name
     C                     MOVEL*BLANK    P2EVTX           Oms System Valu
     C                     MOVEL*BLANK    P2HAST           Oms Access Deni
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field First Time Flag Usr
     C                     MOVEL*BLANK    WUHBST  1
      * Define work field Blank USR
     C                     MOVEL*BLANK    WUCRTX 80
      * Define work field BOH Company Number
     C                     Z-ADD*ZERO     WUHMNB  30
      * Define work field Invalid Y/N USR
     C                     MOVEL*BLANK    WUG3ST  1
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WALGNB           CD Scale Sequen
     C                     Z-ADD*ZERO     WAEUNB           CD Carcass Numb
     C                     Z-ADD*ZERO     WALHNB           CD Carcass Numb
     C                     Z-ADD*ZERO     WABEPR           CD Sort Loss
     C                     Z-ADD*ZERO     WAASPC           CD STD Yield
     C                     Z-ADD*ZERO     WAEWNB           CD Carcass/Hot
     C                     Z-ADD*ZERO     WAB4PR           CD Base Carcass
     C                     Z-ADD*ZERO     WAEYNB           CD Crc Value Pe
     C                     Z-ADD*ZERO     WAB1PR           CD Base Carc Va
     C                     Z-ADD*ZERO     WAAVPR           CD Crc Value $
     C                     Z-ADD*ZERO     WAAUPC           CD Lean Percent
     C                     Z-ADD*ZERO     WAAWPR           CD Lean Premium
     C                     Z-ADD*ZERO     WAAXPR           CD Lean Premium
     C                     Z-ADD*ZERO     WAEZNB           CD Gross Value
     C                     Z-ADD*ZERO     WAAYPR           CD Gross Value
     C                     Z-ADD*ZERO     WABBDT           CD Kill Date
     C                     Z-ADD*ZERO     WAAKTM           CD Kill Time
     C                     Z-ADD*ZERO     WAH6NB           CD Backfat Thic
     C                     Z-ADD*ZERO     WABEPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WAGCST           CD Light Reflec
     C                     Z-ADD*ZERO     WABHPC           CD FFLI
     C                     Z-ADD*ZERO     WALTNB           CD LOT
     C                     Z-ADD*ZERO     WAX4NB           CD Backfat Thic
     C                     Z-ADD*ZERO     WAFNPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WAFOPC           CD Light Reflec
     C                     Z-ADD*ZERO     WAFPPC           CD Lean Percent
     C                     Z-ADD*ZERO     WAJWPR           CD CA Sort Loss
     C                     Z-ADD*ZERO     WAF5PC           CD CA Std Yield
     C                     Z-ADD*ZERO     WAJXPR           CD CA Base Carc
     C                     Z-ADD*ZERO     WAJYPR           CD CA Crc Value
     C                     Z-ADD*ZERO     WAJZPR           CD CA Base Carc
     C                     Z-ADD*ZERO     WAJ0PR           CD CA Crc Value
     C                     Z-ADD*ZERO     WAJ1PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     WAJ2PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     WAJ3PR           CD CA Gross Val
     C                     Z-ADD*ZERO     WAJ4PR           CD CA Gross Val
     C                     Z-ADD*ZERO     WADKJR           CD Loin Eye Inc
     C                     Z-ADD*ZERO     WAITJF           CD Backfat Inch
     C                     Z-ADD*ZERO     WAIJGR           CD Meat Value F
     C                     Z-ADD*ZERO     WAORJE           CD Lean Prem/Di
     C                     Z-ADD*ZERO     WAOTJR           CD Fixed Cost F
     C                     Z-ADD*ZERO     WAPEIR           CD MPR Sort Los
     C                     Z-ADD*ZERO     WAIEUF           CD Meat Value F
     C                     Z-ADD*ZERO     WAORUE           CD Fixed Cost F
     C                     Z-ADD*ZERO     WAIUTR           CD Gross Before
     C                     Z-ADD*ZERO     WAIJRR           CD Gross Before
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field Count USR
     C                     Z-ADD*ZERO     WUP0NB  30
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WBBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WBBONB           BOL Load Number
     C                     Z-ADD*ZERO     WBCVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WBB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WBAWDT           TH Purchase Dat
     C                     Z-ADD*ZERO     WBACPR           TH Live Purchas
     C                     Z-ADD*ZERO     WBB9PR           TH Live Gross A
     C                     Z-ADD*ZERO     WBCAPR           TH LIve Net Amt
     C                     Z-ADD*ZERO     WBAIPR           TH Recalc Live
     C                     Z-ADD*ZERO     WBA6DT           TH Pricing Date
     C                     Z-ADD*ZERO     WBCXNB           TH Dead On Arri
     C                     Z-ADD*ZERO     WBCWNB           TH Head Receive
     C                     Z-ADD*ZERO     WBFCNB           TH Yard Deads
     C                     Z-ADD*ZERO     WBH9NB           TH Held Over
     C                     Z-ADD*ZERO     WBFDNB           TH Head Condemn
     C                     Z-ADD*ZERO     WBFENB           TH Head Killed
     C                     Z-ADD*ZERO     WBHENB           TH Head Adds
     C                     Z-ADD*ZERO     WBHFNB           TH Head Accepte
     C                     Z-ADD*ZERO     WBCYNB           TH Live Wgt
     C                     Z-ADD*ZERO     WBLRNB           TH Adj Live Wgt
     C                     Z-ADD*ZERO     WBE0NB           TH Hot Wgt
     C                     Z-ADD*ZERO     WBA5PC           TH Tot Loin Eye
     C                     Z-ADD*ZERO     WBFBNB           TH Tot Backfat
     C                     Z-ADD*ZERO     WBA4PC           TH Tot Light Re
     C                     Z-ADD*ZERO     WBF7NB           TH Avg Live Wgt
     C                     Z-ADD*ZERO     WBHDNB           TH Avg Hot Wgt
     C                     Z-ADD*ZERO     WBF5NB           TH Avg Light Re
     C                     Z-ADD*ZERO     WBF4NB           TH Avg Lean Per
     C                     Z-ADD*ZERO     WBF3NB           TH Avg Loin Eye
     C                     Z-ADD*ZERO     WBF2NB           TH Avg Backfat
     C                     Z-ADD*ZERO     WBAVPC           TH Std Yield Pe
     C                     Z-ADD*ZERO     WBAWPC           TH Actual Yield
     C                     Z-ADD*ZERO     WBCWPC           TH Adj Actual Y
     C                     Z-ADD*ZERO     WBA8PC           TH Yield Differ
     C                     Z-ADD*ZERO     WBA7PC           TH Recalc Live
     C                     Z-ADD*ZERO     WBB8PR           TH CM Market Pr
     C                     Z-ADD*ZERO     WBAMPR           TH CM Base Mkt
     C                     Z-ADD*ZERO     WBANPR           TH CM Base Mkt
     C                     Z-ADD*ZERO     WBAYVA           TH CM Sort Disc
     C                     Z-ADD*ZERO     WBAWVA           TH CM Yield Gai
     C                     Z-ADD*ZERO     WBAOPR           TH CM Base Carc
     C                     Z-ADD*ZERO     WBAXVA           TH CM LN AddOn/
     C                     Z-ADD*ZERO     WBAPPR           TH CM Carcass G
     C                     Z-ADD*ZERO     WBASPR           TH Deduction Am
     C                     Z-ADD*ZERO     WBA4VA           TH Total Net WO
     C                     Z-ADD*ZERO     WBATPR           TH Carcass Net
     C                     Z-ADD*ZERO     WBA5VA           TH Additions Am
     C                     Z-ADD*ZERO     WBCBPR           TH Payment Gros
     C                     Z-ADD*ZERO     WBCCPR           Th Payment Net
     C                     Z-ADD*ZERO     WBLPNB           TH AP Voucher/D
     C                     Z-ADD*ZERO     WBCDPR           TH Freight Amou
     C                     Z-ADD*ZERO     WBA7VA           TH Accrual Amou
     C                     Z-ADD*ZERO     WBA2PR           TH Fixed Cost A
     C                     Z-ADD*ZERO     WBGHNB           TH Commission A
     C                     Z-ADD*ZERO     WBBYDT           TH Voucher Paym
     C                     Z-ADD*ZERO     WBBSDT           TH Held/Ovr Com
     C                     Z-ADD*ZERO     WBBTDT           TH Commission P
     C                     Z-ADD*ZERO     WBBUDT           TH Actual Check
     C                     Z-ADD*ZERO     WBHGNB           TH Shipped Weig
     C                     Z-ADD*ZERO     WBHHNB           TH Avg Hot Wgt
     C                     Z-ADD*ZERO     WBHINB           TH FFLI
     C                     Z-ADD*ZERO     WBA3PR           TH Kill Product
     C                     Z-ADD*ZERO     WBA4PR           TH Cut Product
     C                     Z-ADD*ZERO     WBA6PR           TH Render Produ
     C                     Z-ADD*ZERO     WBJ9NB           TH Head Exclude
     C                     Z-ADD*ZERO     WBD6PR           TH CM Bse Mkt L
     C                     Z-ADD*ZERO     WBD7PR           TH CM Bse Mkt C
     C                     Z-ADD*ZERO     WBD8PR           TH CM Srt Dsc L
     C                     Z-ADD*ZERO     WBD9PR           TH CM Srt Dsc C
     C                     Z-ADD*ZERO     WBEAPR           TH CM Yld G/L L
     C                     Z-ADD*ZERO     WBEBPR           TH CM Yld G/L C
     C                     Z-ADD*ZERO     WBECPR           TH CM Crc Val L
     C                     Z-ADD*ZERO     WBEDPR           TH CM Crc Val C
     C                     Z-ADD*ZERO     WBEEPR           TH CM Lean Prem
     C                     Z-ADD*ZERO     WBEFPR           TH CM Lean Prem
     C                     Z-ADD*ZERO     WBEGPR           TH CM Gross Liv
     C                     Z-ADD*ZERO     WBEHPR           TH CM Gross Car
     C                     Z-ADD*ZERO     WBOXNB           TH HPS Movement
     C                     Z-ADD*ZERO     WBTHWT           TH DOA Weight
     C                     Z-ADD*ZERO     WBT2WT           TH Avg Lean % E
     C                     Z-ADD*ZERO     WBTHHD           TH HPS Farm Sit
     C                     Z-ADD*ZERO     WBT2HD           TH Shift Held O
     C                     Z-ADD*ZERO     WBOBPR           TH Sorting Amou
     C                     Z-ADD*ZERO     WBKOER           TH Head Identif
     C                     Z-ADD*ZERO     WBOPIR           TH Percent Iden
     C                     Z-ADD*ZERO     WBOPEM           TH Percent Acce
     C                     Z-ADD*ZERO     WBIORP           TH Head Adjuste
     C                     Z-ADD*ZERO     WBOWEO           TH PHA Head Add
     C                     Z-ADD*ZERO     WBHHPC           TH PHA Yield Pe
     C                     Z-ADD*ZERO     WBS9PR           TH PHA Lean Prm
     C                     Z-ADD*ZERO     WBTAPR           TH VC Gross Val
     C                     Z-ADD*ZERO     WBTBPR           TH Excluded Gro
     C                     Z-ADD*ZERO     WBJFUR           TH Avg Lean %
     C                     Z-ADD*ZERO     WBKRIF           TH Broken Back
     C                     Z-ADD*ZERO     WBKORF           TH Hot Scl Uplo
     C                     Z-ADD*ZERO     WBKAPR           TH Unused Nbr 4
     C                     Z-ADD*ZERO     WBKROT           TH Excluded Car
     C                     Z-ADD*ZERO     WBOTJG           TH Excluded Pre
     C                     Z-ADD*ZERO     WBIRJG           TH Unused Nbr 7
     C                     Z-ADD*ZERO     WBIMJF           TH Unused Nbr 8
     C                     Z-ADD*ZERO     WBIRGF           TH Unused Nbr 9
     C                     Z-ADD*ZERO     WBKRJF           TH Unused Nbr 1
     C                     Z-ADD*ZERO     WBOJRF           TH Break Even P
     C                     Z-ADD*ZERO     WBKFOR           TH Meat Value F
     C                     Z-ADD*ZERO     WBORJK           TH Yld Parm Adj
     C                     Z-ADD*ZERO     WBOMVJ           TH PHA Sort Dis
     C                     Z-ADD*ZERO     WBMVNF           TH Avg Loin Eye
     C                     Z-ADD*ZERO     WBMCNF           TH Avg Backfat
     C                     Z-ADD*ZERO     WBNCNF           TH HITCH Old Pa
     C                     Z-ADD*ZERO     WBNCHF           TH MPR Sort Los
     C                     Z-ADD*ZERO     WBIGIR           TH Unused Nbr 1
     C                     Z-ADD*ZERO     WBKFJR           TH Unused Nbr 2
     C                     Z-ADD*ZERO     WBEADT           TH Cold Scl Upl
     C                     Z-ADD*ZERO     WBEBDT           TH Cold Scl Upl
     C                     Z-ADD*ZERO     WBECDT           TH Head LFT
     C                     Z-ADD*ZERO     WBEDDT           TH Head EUT/KOA
     C                     Z-ADD*ZERO     WBEEDT           TH Unused Date
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      *
     C                     Z-ADD12        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * Val Application/User  IF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           P2J8NB    PARM *BLANK    WQ0009  3        Oms Warehouse C
     C           WUHMNB    PARM *ZERO     WQ0010  30       CC Company Numb
     C                     PARM 'HPE'     WQ0011  6        Oms Application
     C           P2C8CD    PARM *BLANK    WQ0012  3        Oms SalesPerson
     C           P2G8ST    PARM *BLANK    WQ0013  1        Oms Allow Multi
     C           P2G9ST    PARM *BLANK    WQ0014 10        Oms Default Pri
     C           P2EUTX    PARM *BLANK    WQ0015 30        Oms Name
     C           P2EVTX    PARM *BLANK    WQ0016 40        Oms System Valu
     C           P2HAST    PARM *BLANK    WQ0017  1        Oms Access Deni
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P2HAST    IFEQ 'Y'                        *IF
      * Send message 'Access Denied for User'
     C                     MOVEL'PRK0298' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP2EVTX    ##CMP
     C                     END                             *FI
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P2HAST    IFEQ 'Y'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL*BLANK    WUHBST           First Time Flag
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
