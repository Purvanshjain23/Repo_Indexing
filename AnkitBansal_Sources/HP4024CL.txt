/***************************************************************** */
/*  PROGRAM NUMBER:  HP4024CL                                      */
/*  PROGRAM NAME:    COPY NUR/FIN TARGETS                          */
/*  PROGRAMMER:      SHARON ZURN                                   */
/*  CREATE DATE:     01/10/07                                      */
/*                                                                 */
/*  FUNCTION:        THIS CL IS SUBMITTED WITH QCMDEXC FROM        */
/*                   HP4024-SPECIFY NUR/FIN TARGETS TO COPY.       */
/*                                                                 */
/*                   OPTIONS ARE PASSED THROUGH THE LDA.           */
/*                                                                 */
/*******************************************************************/
/*  MODIFIED:                                                      */
/*******************************************************************/

             PGM

             DCL        VAR(&QDATA) TYPE(*CHAR) LEN(60)

             DCL        VAR(&LDFCDYR) TYPE(*DEC) LEN(4)
             DCL        VAR(&LDFOBCELL) TYPE(*DEC) LEN(2)
             DCL        VAR(&LDFOBPOD) TYPE(*DEC) LEN(3)

             CHGVAR     VAR(&LDFCDYR) VALUE(%SST(*LDA 1 4))
             CHGVAR     VAR(&LDFOBCELL) VALUE(%SST(*LDA 5 2))
             CHGVAR     VAR(&LDFOBPOD) VALUE(%SST(*LDA 7  3))

/*-------------------------------------------------------------------*/
/* SET UP/RUN OPEN QUERY TO SELECT THE 'FROM' RECORDS TO COPY        */
/*-------------------------------------------------------------------*/

/*  ALWAYS SELECT RECORDS FOR THE SPECIFIED YEAR                 */

             CHGVAR     VAR(%SST(&QDATA 1 10)) VALUE('NYCDYR *EQ')
             CHGVAR     VAR(%SST(&QDATA 12 4)) VALUE(&LDFCDYR)

/* CELL                                                           */
             IF         COND(&LDFOBCELL *NE 0) THEN(DO)
             CHGVAR     VAR(%SST(&QDATA 17 17)) VALUE('*AND NYOBCELL +
                          *EQ')
             CHGVAR     VAR(%SST(&QDATA 35 2)) VALUE(&LDFOBCELL)
             ENDDO

/* POD                                                            */
             IF         COND(&LDFOBPOD *NE 0) THEN(DO)
             CHGVAR     VAR(%SST(&QDATA 38 16)) VALUE('*AND NYOBPOD +
                          *EQ')
             CHGVAR     VAR(%SST(&QDATA 55 3)) VALUE(&LDFOBPOD)
             ENDDO

             OVRDBF     FILE(HSP123) SHARE(*YES)
             OPNQRYF    FILE((HSP123)) QRYSLT(&QDATA) KEYFLD(*FILE) +
                          SEQONLY(*YES)

/*------------------------------------------------------------------*/
/*  CALL COPY PROGRAM                                                */
/*------------------------------------------------------------------*/

             CALL       PGM(HP3024)

             CLOF       OPNID(HSP123)
             DLTOVR     FILE(HSP123)

             ENDPGM
