     H/TITLE Exc TRG PDLYREP ProcessXF Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 12/14/20  Time  : 16:33:57
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPUB4CPL0  IF A E           K DISK
      * UPD : Trailer TRG               Update index
      *
      * Long constants
     D @CN#            S              6    DIM(02)CTDATA PERRCD(1)
     D @CN             S             25    DIM(02) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QPUB41        E DS                  EXTNAME(PUB4CPL0)
      * UPD : Trailer TRG               Update index
      * Renamed input format fields
     D  WABZNA       E                     EXTFLD(B4BZNA)
     D  WADXTX       E                     EXTFLD(B4DXTX)
     D  WABATS       E                     EXTFLD(B4BATS)
     D  WALDSC       E                     EXTFLD(B4LDSC)
     D  WALESC       E                     EXTFLD(B4LESC)
     D  WABRDX       E                     EXTFLD(B4BRDX)
      *
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              1
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  XDTSDL         S             26
     D  WL0001         S              3
     D  WL0002         S             20
     D  WL0003         S              1
     D  WL0004         S              2
     D  WL0005         S              8  0
     D  WN0001         S             26
     D  ##TMS          S             26
     D  ZADFMF         S             10
     D  YL0001         S             15  5
     D  YL0002         S             15  5
     D  WQ0001         S             15  5
     D  WQ0002         S             15  5
     D  W0CLPG         S             10
     D  WUZHNB         S             15  5
     D  WQ0003         S             15  5
     D  WQ0004         S             15  5
     D  WQ0005         S             15  5
     D  WQ0006         S             15  5
     D  WQ0007         S             15  5
     D  WQ0008         S             15  5
     D  WQ0009         S             15  5
     D  WQ0010         S             15  5
     D  WQ0011         S             15  5
     D  WQ0012         S             15  5
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS           129
      * RCD: Trailer                   Retrieval index
      * I :  Carrier Code
     D  P1BZNA                 1      3
      * I :  Trailer Id
     D  P1DXTX                 4     23
      * I :  Company Number
     D  P1AIC3                24     25P 0
      * I :  Load Type
     D  P1VDST                26     26
      * I :  Trailer Type
     D  P1X3ST                27     27
      * I :  Seaboard Owned Status
     D  P1XGST                28     28
      * I :  On Yard Status
     D  P1STOY                29     29
      * I :  On Yard Date
     D  P1KKDT                30     33P 0
      * I :  On Yard Time
     D  P1AVTM                34     37P 0
      * I :  Assigned Status
     D  P1STAS                38     38
      * I :  Available Status
     D  P1XRST                39     39
      * I :  Not Available Reason Code
     D  P1X7CD                40     42
      * I :  Comment Line
     D  P1GXTX                43     72
      * I :  Status Unused 1
     D  P1XTST                73     73
      * I :  Status Unused 2
     D  P1XVST                74     74
      * I :  Status Unused 3
     D  P1STU3                75     75
      * I :  Status Unused 4
     D  P1STU4                76     76
      * I :  Status Unused 5
     D  P1STU5                77     77
      * I :  Date Unused 1
     D  P1LCDT                78     81P 0
      * I :  Date Unused 2
     D  P1LDDT                82     85P 0
      * I :  Date Unused 3
     D  P1LEDT                86     89P 0
      * I :  Date Unused 4
     D  P1LFDT                90     93P 0
      * I :  Date Unused 5
     D  P1LGDT                94     97P 0
      * I :  EDI Status 1
     D  P1UVST                98     98
      * I :  EDI Status 2
     D  P1UWST                99     99
      * I :  EDI Status 3
     D  P1UXST               100    100
      * I :  Record Status
     D  P1VSST               101    101
      * I :  Job Time
     D  P1AATM               102    105P 0
      * I :  User Id
     D  P1AYNA               106    115
      * I :  Job Name
     D  P1A0NA               116    125
      * I :  Job Date
     D  P1AXDT               126    129P 0
     D P2PARM          DS           129
      * RCD: Trailer                   Retrieval index
      * I :  Carrier Code
     D  P2BZNA                 1      3
      * I :  Trailer Id
     D  P2DXTX                 4     23
      * I :  Company Number
     D  P2AIC3                24     25P 0
      * I :  Load Type
     D  P2VDST                26     26
      * I :  Trailer Type
     D  P2X3ST                27     27
      * I :  Seaboard Owned Status
     D  P2XGST                28     28
      * I :  On Yard Status
     D  P2STOY                29     29
      * I :  On Yard Date
     D  P2KKDT                30     33P 0
      * I :  On Yard Time
     D  P2AVTM                34     37P 0
      * I :  Assigned Status
     D  P2STAS                38     38
      * I :  Available Status
     D  P2XRST                39     39
      * I :  Not Available Reason Code
     D  P2X7CD                40     42
      * I :  Comment Line
     D  P2GXTX                43     72
      * I :  Status Unused 1
     D  P2XTST                73     73
      * I :  Status Unused 2
     D  P2XVST                74     74
      * I :  Status Unused 3
     D  P2STU3                75     75
      * I :  Status Unused 4
     D  P2STU4                76     76
      * I :  Status Unused 5
     D  P2STU5                77     77
      * I :  Date Unused 1
     D  P2LCDT                78     81P 0
      * I :  Date Unused 2
     D  P2LDDT                82     85P 0
      * I :  Date Unused 3
     D  P2LEDT                86     89P 0
      * I :  Date Unused 4
     D  P2LFDT                90     93P 0
      * I :  Date Unused 5
     D  P2LGDT                94     97P 0
      * I :  EDI Status 1
     D  P2UVST                98     98
      * I :  EDI Status 2
     D  P2UWST                99     99
      * I :  EDI Status 3
     D  P2UXST               100    100
      * I :  Record Status
     D  P2VSST               101    101
      * I :  Job Time
     D  P2AATM               102    105P 0
      * I :  User Id
     D  P2AYNA               106    115
      * I :  Job Name
     D  P2A0NA               116    125
      * I :  Job Date
     D  P2AXDT               126    129P 0
     D P3PARM          DS
      * I :  TRG Database Event
     D  P3D8SC                 1      1
     D                 DS
     D  ZAMSDA                 1    132
     I@B4CPHU
      * Trailer TRG               Update index
      * Renamed input format fields
     I              B4BZNA                      WABZNA
     I              B4DXTX                      WADXTX
     I              B4BATS                      WABATS
     I              B4LDSC                      WALDSC
     I              B4LESC                      WALESC
     I              B4BRDX                      WABRDX
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C                   PARM                    P1PARM                         RCD: Trailer
     C                   PARM                    P2PARM                         RCD: Trailer
     C     P3D8SC        PARM                    WP0001                         TRG Database Ev
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc TRG PDLYREP ProcessXF
      * *****************************************************************
      * ** PR1 Parms Represent Old Record Fields (Will be blank for Inser
      * ** PR2 Parms Represent New Record Fields (Will be blank for Delet
      * *****************************************************************
      * Trigger Processing for Insert Event.
      * CASE: PR3.TRG Database Event is Insert
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   IF        P3D8SC = '1'
     C                   MOVEL(P)  P2BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P2DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
      * If Record Already Exist.
      * CASE: PGM.*Return code is *Record already exists
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   IF        W0RTN = @CN(002)
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0001        PARM      *ZERO         WQ0001                         Current System
     C     YL0002        PARM      *ZERO         WQ0002                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   Z-ADD     YL0002        WUZHNB                         Current System
      * S17018 DN 12/14/20-Loop Until System Time Changes.
      * DO WHILE: LCL.Current System Time EQ WRK.Current System Time
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   DOW       YL0002 = WUZHNB
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0001        PARM      *ZERO         WQ0003                         Current System
     C     WUZHNB        PARM      *ZERO         WQ0004                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *ITR
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   MOVEL(P)  P2BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P2DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Trigger Processing for Update Event.
      * CASE: PR3.TRG Database Event is Update
      * Update If Any Non-Key Fields Have Changed.
      * CASE:
      *  - c1ORc2ORc3ORc4ORc5ORc6ORc7ORc8ORc9ORc10ORc11ORc12ORc13ORc14OR
      *  - c15ORc16ORc17ORc18OR c19ORc20ORc21ORc22ORc23ORc24ORc25
      *   |- c1    : PR1.Company Number NE PR2.Company Number
      *   |- c2    : PR1.Load Type NE PR2.Load Type
      *   |- c3    : PR1.Trailer Type NE PR2.Trailer Type
      *   |- c4    : PR1.Seaboard Owned Status NE PR2.Seaboard Owned Stat
      *   |- c5    : PR1.On Yard Status NE PR2.On Yard Status
      *   |- c6    : PR1.On Yard Date NE PR2.On Yard Date
      *   |- c7    : PR1.On Yard Time NE PR2.On Yard Time
      *   |- c8    : PR1.Assigned Status NE PR2.Assigned Status
      *   |- c9    : PR1.Available Status NE PR2.Available Status
      *   |- c10   : PR1.Not Available Reason Code NE PR2.Not Available R
      *   |- c11   : PR1.Comment Line NE PR2.Comment Line
      *   |- c12   : PR1.Status Unused 1 NE PR2.Status Unused 1
      *   |- c13   : PR1.Status Unused 2 NE PR2.Status Unused 2
      *   |- c14   : PR1.Status Unused 3 NE PR2.Status Unused 3
      *   |- c15   : PR1.Status Unused 4 NE PR2.Status Unused 4
      *   |- c16   : PR1.Status Unused 5 NE PR2.Status Unused 5
      *   |- c17   : PR1.Date Unused 1 NE PR2.Date Unused 1
      *   |- c18   : PR1.Date Unused 2 NE PR2.Date Unused 2
      *   |- c19   : PR1.Date Unused 3 NE PR2.Date Unused 3
      *   |- c20   : PR1.Date Unused 4 NE PR2.Date Unused 4
      *   |- c21   : PR1.Date Unused 5 NE PR2.Date Unused 5
      *   |- c22   : PR1.EDI Status 1 NE PR2.EDI Status 1
      *   |- c23   : PR1.EDI Status 2 NE PR2.EDI Status 2
      *   |- c24   : PR1.EDI Status 3 NE PR2.EDI Status 3
      *   |- c25   : PR1.Record Status NE PR2.Record Status
      *   '-
     C                   IF        P3D8SC = '3'
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   IF        P1AIC3 <> P2AIC3 OR
     C                             P1VDST <> P2VDST OR
     C                             P1X3ST <> P2X3ST OR
     C                             P1XGST <> P2XGST OR
     C                             P1STOY <> P2STOY OR
     C                             P1KKDT <> P2KKDT OR
     C                             P1AVTM <> P2AVTM OR
     C                             P1STAS <> P2STAS OR
     C                             P1XRST <> P2XRST OR
     C                             P1X7CD <> P2X7CD OR
     C                             P1GXTX <> P2GXTX OR
     C                             P1XTST <> P2XTST OR
     C                             P1XVST <> P2XVST OR
     C                             P1STU3 <> P2STU3 OR
     C                             P1STU4 <> P2STU4 OR
     C                             P1STU5 <> P2STU5 OR
     C                             P1LCDT <> P2LCDT OR
     C                             P1LDDT <> P2LDDT OR
     C                             P1LEDT <> P2LEDT OR
     C                             P1LFDT <> P2LFDT OR
     C                             P1LGDT <> P2LGDT OR
     C                             P1UVST <> P2UVST OR
     C                             P1UWST <> P2UWST OR
     C                             P1UXST <> P2UXST OR
     C                             P1VSST <> P2VSST
     C                   MOVEL(P)  P2BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P2DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
      * If Record Already Exist.
      * CASE: PGM.*Return code is *Record already exists
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   IF        W0RTN = @CN(002)
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0001        PARM      *ZERO         WQ0005                         Current System
     C     YL0002        PARM      *ZERO         WQ0006                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   Z-ADD     YL0002        WUZHNB                         Current System
      * S17018 DN 12/14/20-Loop Until System Time Changes.
      * DO WHILE: LCL.Current System Time EQ WRK.Current System Time
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   DOW       YL0002 = WUZHNB
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0001        PARM      *ZERO         WQ0007                         Current System
     C     WUZHNB        PARM      *ZERO         WQ0008                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *ITR
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   MOVEL(P)  P2BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P2DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Trigger Processing for Delete Event.
      * CASE: PR3.TRG Database Event is Delete
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   IF        P3D8SC = '2'
     C                   MOVEL(P)  P1BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P1DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
      * If Record Already Exist.
      * CASE: PGM.*Return code is *Record already exists
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   IF        W0RTN = @CN(002)
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0001        PARM      *ZERO         WQ0009                         Current System
     C     YL0002        PARM      *ZERO         WQ0010                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   Z-ADD     YL0002        WUZHNB                         Current System
      * S17018 DN 12/14/20-Loop Until System Time Changes.
      * DO WHILE: LCL.Current System Time EQ WRK.Current System Time
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   DOW       YL0002 = WUZHNB
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     YL0002        PARM      *ZERO         WQ0011                         Current System
     C     WUZHNB        PARM      *ZERO         WQ0012                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *ITR
      * Crt Trailer TRG       CR - Trailer TRG  * 
      * Move input parameters to subroutine local variables.
     C                   MOVEL(P)  P1BZNA        WL0001                         Carrier Code
     C                   MOVEL(P)  P1DXTX        WL0002                         Trailer Id
     C                   MOVEL(P)  P3D8SC        WL0003                         TT TRG Database
     C                   MOVEL(P)  '0'           WL0004                         TT Process Stat
     C                   Z-ADD     0             WL0005                         TT Process Date
     C                   EXSR      SACRRC
     C                   END                                                    *FI
     C                   END                                                    *FI
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SACRRC        BEGSR
      *================================================================
      * Crt Trailer TRG       CR - Trailer TRG  * 
      *================================================================
      *
     C                   MOVEL     XDTSDL        WN0001                         TT Timestamp
      *
     C                   EVAL      W0RTN = ' '
      * Move all fields to @B4CPHU
     C                   MOVEL     WL0001        WABZNA                         Carrier Code
     C                   MOVEL     WL0002        WADXTX                         Trailer Id
     C                   MOVEL     WL0003        WALDSC                         TT TRG Database
     C                   MOVEL     WL0004        WALESC                         TT Process Stat
     C                   Z-ADD     WL0005        WABRDX                         TT Process Date
      *
      * USER: Processing before Data update
      * Set Timestamp TS#     IF
      * PAR.@Timestamp TS# = JOB.*System timestamp
     C                   EXSR      XSTMS
     C                   MOVEL     ##TMS         WABATS                         @Timestamp TS#
     C     KLCRSA        KLIST
     C                   KFLD                    WABZNA                         Carrier Code
     C                   KFLD                    WADXTX                         Trailer Id
     C                   KFLD                    WABATS                         TT Timestamp
      * Check for duplicate primary key
     C     KLCRSA        SETLL     @B4CPHU                                90    *
     C                   IF        *IN90
     C                   MOVEL     'USR5195'     W0RTN
      * Send message 'Trailer TRG            EX'
     C                   MOVEL     'USR5195'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SAEXIT
     C                   ENDIF
      *
     C                   WRITE     @B4CPHU                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   XSTMS         BEGSR
      *================================================================
      * Refresh System timestamp
      *================================================================
     C                   CALL      'Y2RTTSK'
     C                   PARM                    ##TMS                          System timestam
      *================================================================
     CSR   XSTMSE        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   MOVE(P)   '0'           XDTSDL
     C                   MOVEL     @CN(001)      XDTSDL
     C                   MOVEL     XDTSDL        WABATS                         TT Timestamp
     C                   Z-ADD     *ZERO         WABRDX                         TT Process Date
      * Obtain default message file
     C     *DTAARA       DEFINE    CAMGFLA       ZADFMF
     C                   IN        ZADFMF
      * Define work field Current System Time
     C                   Z-ADD     *ZERO         WUZHNB
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      * Define local variables for subroutine SACRRC.
     C                   EVAL      WL0001 = ' '
     C                   EVAL      WL0002 = ' '
     C                   EVAL      WL0003 = ' '
     C                   EVAL      WL0004 = ' '
     C                   Z-ADD     *ZERO         WL0005
      * Define local work field Current System Date
     C                   Z-ADD     *ZERO         YL0001
      * Define local work field Current System Time
     C                   Z-ADD     *ZERO         YL0002
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 0001-01-01-00.00.00.00000
00002 Y2U0003
