/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CAPTURE INVENTORY TRANSACTIONS PER THE DATE/TIME     */
/*             AND ADD TO ISC WORKFILE TO BE DOWNLOADED  FOR PKG VAR ANALYSIS */
/****   COPIED FROM PME7UPC BUT CALL DIFFERENT SEQUEL VIEWS TO EMAIL ***   */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 03/19/09                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*          &COMPL      - COMPANY   -- DONT SEL ON COMPANY --        */
/*                        IN ORDER TO GET WHSES WITH DIFF SHP&ACCT COMPANY */
/*          &WHSE       - WAREHOUSE CODE                          */
/*          &FDATEL     - TRANSACTION DATE                        */
/*          &TDATEL     - TRANSACTION DATE                        */
/*          &FTIME      - TRANSACTION TIME =   JOB TIME           */
/*          &TTIME      - TRANSACTION TIME =   JOB TIME           */
/*          &WEEKN      - WEEK ENDING DATE FOR INV STOCK CLOS FIL */
/*          &CMB        - COMBINE WHSE TOTALS IF Y AND WHSE IS BLANK */
/*          &SELCMP     - CAN THE QRY SELECT ON COMPANY? Y OR N  */
/*          &PKGITM     - PKG ITEM SELECTED IN THE SEQUEL            */
/*          &PKGITM2    - 2ND PKG ITEM SELECTED IN THE SEQUEL            */
/********************************************************************/
/* RUN FOR ONE DATE AT A TIME                            */
/********************************************************************/
/* RMC 06/29/07 PASS IN FROM DATE AND TIME FROM CTL FILE  */
/* RMC 04/30/08 USE LF IN TRANS DATE(D) SEQ A LIEU OF OPNQRYF WHICH */
/*              RAN TOO LONG - REPLACE PME8PFR WITH PMULPFR    */
/********************************************************************/

 PMGIUPC:    PGM        PARM(&RTN &COMPL &WHSE &FTIME &TTIME &FDATE +
       &TDATE &PKGITM &PKGITM2  &WEEKN &CMB  &SELCMP &EMAIL &EMAIL2)
             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7) /*  RETURN +
                          CODE   */
        DCL    &COMP      *DEC    (3 0)        /*     COMPANY #      */
        DCL    &COMPL     *DEC                  /*    FOR PASSING    */
        DCL    &COMPA     *CHAR   (3)        /*     COMPANY #      */
        DCL    &FDATE     *DEC    (7 0)          /*  TRAN DATE      */
        DCL    &FDATEX    *CHAR   (7)          /*  TRAN DATE      */
        DCL    &TDATE     *DEC    (7 0)          /*  TRAN DATE      */
        DCL    &TDATEX    *CHAR   (7)          /*  TRAN DATE      */
        DCL    &WEEKN     *DEC    (8 0)        /*  ISC WEEK END DATE */
        DCL    &WHSE      *CHAR   (3)          /*  WAREHOUSE      */
        DCL    &CMB       *CHAR   (1)          /*  COMBINE WHSES = Y */
        DCL    &SELCMP    *CHAR   (1)          /*  CAN QRY SEL ON COMPANY */
        DCL    &PKGITM    *CHAR   (25)         /*  PCKGING ITEM      */
        DCL    &PKGITM2   *CHAR   (25)         /*  PCKGING ITEM      */
        DCL    &EMAIL     *CHAR   (50)         /*  EMAIL 1           */
        DCL    &EMAIL2    *CHAR   (50)         /*  EMAIL 2              */
             DCL        VAR(&FTIME) TYPE(*DEC) LEN(6 0)
              /*          VALUE(000000) /*  FROM TIME      */
             DCL        VAR(&TTIME) TYPE(*DEC) LEN(6 0)
             /*           VALUE(235900) /*  THRU TIME      */
             DCL        VAR(&FTIMEX) TYPE(*CHAR) LEN(6) /*  PROD +
                          TIME      */
             DCL        VAR(&TTIMEX) TYPE(*CHAR) LEN(6) /*  PROD +
                          TIME      */

/* SEND PROGRAM MESSAGE PARAMETERS  */

             /* Internal Fields */

             DCL        VAR(&SEL)  TYPE(*CHAR) LEN(500)

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to 3,0   */
             CHGVAR    VAR(&COMPA) VALUE(&COMP) /* Change to CHAR  */
             CHGVAR    VAR(&FDATEX) VALUE(&FDATE) /* Change to CHAR  */
             CHGVAR    VAR(&TDATEX) VALUE(&TDATE) /* Change to CHAR  */
             CHGVAR    VAR(&FTIMEX) VALUE(&FTIME) /* Change to CHAR  */
             CHGVAR    VAR(&TTIMEX) VALUE(&TTIME) /* Change to CHAR  */

/* --------------------------------------------------------------------- */
/* --------------------------------------------------------------------- */
/* --------------------------------------------------------------------- */
/* ------------------------ CREATE WORKFILES IN QTEMP  ----------------- */

AGAIN:       CRTDUPOBJL OBJ(PMAKCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF2130) EXEC(DO)
               DLTF FILE(QTEMP/PMAKC*)
               GOTO AGAIN
               ENDDO
             CRTDUPOBJL OBJ(PMAKCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CRTDUPOBJL OBJ(PMAKCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
 AGAIN2:     CRTDUPOBJL OBJ(PMALCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF2130) EXEC(DO)
               DLTF FILE(QTEMP/PMALC*)
               GOTO AGAIN2
               ENDDO
             CRTDUPOBJL OBJ(PMALCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJL OBJ(PMALCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
/* ------------------------------------------------------------------- */
/*           BUILD WORKFILES  PMALCPP,PKALCPP ----------------------- */
/* ------------------------------------------------------------------- */
/* ------------------------------------------------------------------- */
  /* NEW PGM THAT USES LF ACCESS OVER CAB7CPP --  RMC  4/30/08 */
/* ------------------------------------------------------------------- */
           CALL PMULPFR ('' &TDATE &FDATE &TDATE &WEEKN &COMP &WHSE &CMB +
                             &FTIME &TTIME)

             CALL PMFDPFR ('' &WEEKN &COMP &WHSE &CMB) /* CREATE SUMMARY WF */
             CALL PMGZXFR ('' &WEEKN &COMP &WHSE &CMB)  /* CREATE MISSING SUMM*/
/* ------------------------------------------------------------------- */
/* ------------------------------------------------------------------- */
EMAIL:
             IF         COND(&PKGITM *NE '           ') THEN(DO)
             EXECUTE    VIEW(*LIBL/PKGSUMMQTY) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('Item +
                          Transaction Totals for Pkg Analysis') +
                          SETVAR((&PKGITM &PKGITM))
                          ENDDO
             IF         COND(&PKGITM2 *NE '           ') THEN(DO)
             EXECUTE    VIEW(*LIBL/PKGSUMMQTY) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('Item +
                          Transaction Totals for Pkg Analysis') +
                          SETVAR((&PKGITM &PKGITM2))
                          ENDDO

             DLTSPLF    FILE(PMULPFR$)
             DLTSPLF    FILE(PMFDPFR$)
 END:        ENDPGM
