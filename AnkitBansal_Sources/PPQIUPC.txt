/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  CREATE INVENTORY STOCK CLOSING BAL - NEW WEEK ENDING */
/*                                                                  */
/*  SYSTEM    - INVENTORY MANAGEMENT SYSTEM                         */
/*  DATE      - 06/22/05                                            */
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     I    &RETURN     - RETURN CODE                               */
/*                                                                  */
/*     B    &WEEKA7     -  NEW WEEK DATE 7 ALPHA   CYYMMDD          */
/*     B    &WEEKA8     -  NEW WEEK DATE 8 ALPHA   YYYYMMDD        */
/*     B    &LSTWKA     -  LAST WEEK 8 ALPHA       YYYYMMDD         */
/*     B    &COMPL      -  COMPANY PASS                             */
/*     B    &COMPN      -  COMPANY 3,0                              */
/*     B    &WEEKN7     -  NEW WEEK DATE 7,0                       */
/*     B    &WEEKN8     -  NEW WEEK DATE 8,0                       */
/*     B    &LSTWKN     -  LAST WEEK 8,0                            */
/*                                                                  */
/********************************************************************/
/* MODIFICATION HISTORY                                             */
/********************************************************************/
/* DATE     INT PROJECT DESCRIPTION                                 */
/* -------- --- ------- --------------------------------------------*/
/* 02/17/17 DN  R9083   Added ISC Valuation Grouping as input parm. */
/********************************************************************/

 PPQIUPC:    PGM        PARM(&RETURN &COMPL  &WEEKA8 +
                           &WEEKA7 &LSTWKA &RERUN &IVG)
/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */
        DCL    &WEEKA8     *CHAR   (8)      /* NEW  WEEK ENDING CHAR          */
        DCL    &WEEKN8     *DEC    (8 0)    /* NEW  WEEK ENDING DEC           */
        DCL    &WEEKA7     *CHAR   (7)      /* NEW  WEEK ENDING CHAR          */
        DCL    &WEEKN7     *DEC    (7 0)    /* NEW  WEEK ENDING DEC           */
        DCL    &COMPL      *DEC    (15 5)        /* WAREHOUSE COMPANY        */
        DCL    &LSTWKA     *CHAR   (8)           /* LAST WEEK   CHAR          */
        DCL    &LSTWKN     *DEC    (8 0)         /* LAST WEEK   DEC           */
        DCL    &RERUN      *CHAR   (1)           /* RERUN = Y                */
        DCL    &IVG        *CHAR   (1)           /* INV VALUATION GROUP      */

/* INTERNAL FIELDS                                                            */
        DCL    &COMPN      *DEC    (3)        /* WAREHOUSE COMPANY        */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)
        DCL    &COMMAND    *CHAR   (512)

/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&COMPN) VALUE(&COMPL)
             CHGVAR     VAR(&WEEKN8) VALUE(&WEEKA8)
             CHGVAR     VAR(&WEEKN7) VALUE(&WEEKA7)
             CHGVAR     VAR(&LSTWKN) VALUE(&LSTWKA)
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))
/********************************************************************/
/*   USE SAVED ITEM BALANCE IF RERUN = "Y". WILL BE "N" FROM SCD JOB  */
/********************************************************************/
 SAVF:       IF         COND(&RERUN *EQ 'Y') THEN(DO)
             CRTDUPOBJ  OBJ(CAB0REPINV) FROMLIB(*LIBL) +
                          OBJTYPE(*FILE) TOLIB(QTEMP) +
                          NEWOBJ(CAB0REP) DATA(*YES)
             CRTDUPOBJ  OBJ(CAB0RELJ) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
                          ENDDO
/********************************************************************/
/*   DELETE THE WEEK'S RECORDS IF THEY EXIST                     */
/********************************************************************/
    /* R9083-ADDED INV VALUATION GROUPING AS PARM. */
          /* CALL PPR8XFR ( ''  &weekn8) */
             CALL PPR8XFR ( ''  &weekn8 &IVG)

/********************************************************************/
/*   CALL PGM  TO CREATE INV STOCK CLOSING                       */
/********************************************************************/
    /* R9083-ADDED INV VALUATION GROUPING AS PARM. */
          /* CALL       PGM(PPOTXFR) PARM(' ' &WEEKN8 &COMPN &WEEKN7 &LSTWKN) */
             CALL       PGM(PPOTXFR) PARM(' ' &WEEKN8 &COMPN &IVG +
                          &WEEKN7 &LSTWKN)

             GOTO       CMDLBL(END)
/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM

