/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  JOB CONTROL TO GET A USER'S DEFAULT COMPANY, THEN  */
/*              EXECUTE THE SQL PASSED IN THRU THE PARM.            */
/*              SALES BY STATE FOR DEFAULT COMPANY                 */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - GET USER DFT COMPANY AND PERFORM SQL SALES BY       */
/*              BY CIOMPANY (DFT) AND STATE                         */
/*  DATE      - 03/10/21                                            */
/*                                                                  */
/*********************************************************************/
/* Modifications:                                                   */
/*                                                                  */
/*   Date       Pgmr       Description                              */
/* --------    ---------- ----------------------------------------  */
/* 03/11/2021  S.BLAKEY   CREATED PROCESS ONLY ALLOW USER TO SELECT */
/*                        SEQUEL BY DEFAULT COMPANY                 */
/*                                                                  */

 PMD45PR:    PGM

/* PARMS                                                                      */
             DCL        VAR(&CO) TYPE(*CHAR) LEN(3) /* DFT Company  */
             DCL        VAR(&COMPA) TYPE(*CHAR) LEN(3) /* Company  */
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))
/********************************************************************/
/*   GET USER DFT COMPANY                                           */
/********************************************************************/

             CALL       PGM(PMD4XFR) PARM('' &CO)

             IF         COND(&CO *EQ '000') THEN(DO)
             SNDMSG     MSG('User Default Company not found.') +
                          TOUSR(*REQUESTER)
             GOTO END
             ENDDO
/********************************************************************/
/*   EXECUTE SQL                                                    */
/********************************************************************/
 SCROT:

             CHGVAR     VAR(&COMPA) VALUE(&CO)

             RUNSCRIPT  SCRIPT(*LIBL/SLSTOST.S) SETVAR((&COMP &COMPA))

             MONMSG     MSGID(CPF6801) EXEC(GOTO CMDLBL(END))
                          GOTO END
/********************************************************************/
MSGTRAP:
             SNDMSG     MSG('Request Failed. Please contact IT.') +
                          TOUSR(*REQUESTER)
 END:        ENDPGM
