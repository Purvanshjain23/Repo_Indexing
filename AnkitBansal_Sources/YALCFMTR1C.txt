PGM  (&FMTVNM &OBJATR &RPGPFX &SYSPFX &PHYVNM &LGLVNM &RETRY)
/*T: YALCVNM Allocate DBF format name. */
/*Z: CRTCLPGM LOG(*NO)  */
/*H: SYSTEM     : SYNON/2 ROUTINE                                      */
/*H: PROGRAMMER : P.WILSON                                             */
/*H: COPYRIGHT (C) 1986 SYNON.                                         */
/*H: SYNOPSIS: Allocates a CPF format name for a DBF.*/
/*W: DBF FORMAT NAMES MUST BE UNIQUE WITHIN A MODEL */

/*M: 06/04/88  PV Replace hardcoded prefix of @ by calling program */
/*M:              to retrieve the substitution allocation character*/

DCL &FMTVNM *CHAR 10 /*O: Allocated DBF format name. */
                     /*   Blank = give up auto allocate */
DCL &OBJATR *CHAR  3 /*I: Synon/2 object attribute. */
DCL &RPGPFX *CHAR  2 /*I: Synon/2 file RPG prefix. */
DCL &SYSPFX *CHAR  2 /*I: Synon/2 system prefix. */
DCL &PHYVNM *CHAR 10 /*I: Synon/2 PHY member name. */
DCL &LGLVNM *CHAR 10 /*I: Synon/2 Access path name. */
DCL &RETRY  *DEC   3 /*I: Retry count, 1-on first entry */
                     /*   incremented by 1 for each retry.*/
DCL &MNEMONIC *CHAR 2 /* Mnemonic code */
DCL &PFX    *CHAR 1  /* Allocation character prefix for DBF format */

/*H: 1. If not first try, give up.*/
            IF (&RETRY *GT 10) DO
               CHGVAR &FMTVNM ' '
               RETURN
            ENDDO

/*H: 2. Allocate a mnemonic from the format series */
            CALL YALCVNMR1R (FMT &MNEMONIC)

/*H: 3. Construct format name: prefix + file name + mnemonic .*/
            CALL YGENTYPR1I ('LGL' 'FMT' &PFX)
            CHGVAR &FMTVNM (&PFX |< %SST(&PHYVNM 3 4)|< +
               &MNEMONIC)
ENDPGM
