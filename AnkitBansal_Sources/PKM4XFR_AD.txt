// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKM4XFR
// ?Date: 14.08.2025 Time: 02:52:13
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Number
ENDDO;

EXECUTE FUNCTION(Upd Cnt Tto w/Scl Wgt RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1204889;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.Date_From_USR);
PARAMETER('I');
PARAMETER(PAR.Date_From_USR);
PARAMETER(PAR.Date_To_USR);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.TH Kill Date GT PAR.Date To   USR
 IF DB1.TH_Kill_Date > PAR.Date_To_USR;

 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.TH Hog Class Type is Resale
 IF DB1.TH_Hog_Class_Type = 'R';

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.TH Recalc Live Wgt is EQ Zero
 IF DB1.TH_Recalc_Live_Wgt = *ZERO;

 CASE;

 // IF DB1.TH Head Received is Not Zero
 IF DB1.TH_Head_Received <> *ZERO;

 EXECUTE FUNCTION(Rtv Tattoo Live Wgt   RT) TYPE(RTVOBJ) FILE(PKA2CPP)           AB1204892;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(PAR.TH_Live_Wgt);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.TH Live Wgt = PAR.TH Live Wgt + DB1.TD Live Wgt
  PAR.TH_Live_Wgt = PAR.TH_Live_Wgt + DB1.TD_Live_Wgt;

 }

 // PAR.TH Avg Live Wgt = PAR.TH Live Wgt / DB1.TH Head Received *Rounded
 PAR.TH_Avg_Live_Wgt = PAR.TH_Live_Wgt / DB1.TH_Head_Received 'H';

 // TH Adj Live Wgt
 PAR.TH_Adj_Live_Wgt = ( PAR.TH_Live_Wgt - ( DB1.TH_Yard_Deads * PAR.TH_Avg_Live_Wgt ) ) -
 ( DB1.TH_Head_Condemned * PAR.TH_Avg_Live_Wgt );

 // TH Actual Yield
 PAR.TH_Actual_Yield = ( PAR.TH_Live_Wgt / DB1.TH_Hot_Wgt 'H' ) * 100 'H';

 // TH Adj Actual Yield
 PAR.TH_Adj_Actual_Yield = ( PAR.TH_Adj_Live_Wgt / DB1.TH_Hot_Wgt 'H' ) * 100 'H';

 // PAR.TH Yield Difference = PAR.TH Actual Yield % - DB1.TH Std Yield Percent
 PAR.TH_Yield_Difference = PAR.TH_Actual_Yield - DB1.TH_Std_Yield_Percent;

 EXECUTE FUNCTION(Upd Cnt Tto w/Scl Wgt CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1204894;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(PAR.TH_Live_Wgt);
 PARAMETER(PAR.TH_Adj_Live_Wgt);
 PARAMETER(PAR.TH_Avg_Live_Wgt);
 PARAMETER(PAR.TH_Actual_Yield);
 PARAMETER(PAR.TH_Adj_Actual_Yield);
 PARAMETER(PAR.TH_Yield_Difference);
 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


