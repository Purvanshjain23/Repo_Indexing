// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPBNPVR
// ?Date: 14.08.2025 Time: 03:39:52
// ?------------------------------------------------------------------------------------------------

//?USER: Load screen

// DTL.USR From Date = PAR.Period Beginning Date
DTL.USR_From_Date = PAR.Period_Beginning_Date;

// DTL.USR Through Date = PAR.Period Ending Date
DTL.USR_Through_Date = PAR.Period_Ending_Date;

// DTL.Accrual Code = PAR.Accrual Code
DTL.Accrual_Code = PAR.Accrual_Code;

// DTL.Item Accrual Amt = PAR.Item Accrual Amt
DTL.Item_Accrual_Amt = PAR.Item_Accrual_Amt;

// DTL.USR Ship to Customer CD7 = PAR.Ship To Customer
DTL.USR_Ship_to_Customer_CD7 = PAR.Ship_To_Customer;

EXECUTE FUNCTION(RTV Accrual Descript   RT) TYPE(RTVOBJ) FILE(OMHLREP)          AC1285204;
PARAMETER(DTL.Accrual_Code);
PARAMETER(DTL.Accrual_Description);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: User defined action

CASE;

// IF DTL.Status - Y or N is yes
IF DTL.Status_Y_or_N = 'Y';

// PAR.PRT Night Queue Run Sts = CND.no
PAR.PRT_Night_Queue_Run_Sts = 'N';

// Call program PMT Prt Opt w/PSz SHR  PV.
CALL PROGRAM(PMT Prt Opt w/PSz SHR  PV) ('PDV8PVR');
PARAMETER('Broker Performance Report');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Number_of_Copies);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Application_Code);
PARAMETER(*MISSING);
PARAMETER(1);

//?Print prompt/print report/do update
CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

//?Print prompt/print report/do update
// IF *OTHERWISE
IF *OTHERWISE;

//?Submit job for Print
// PAR.From Date Pass        USR = DTL.USR From Date
PAR.From_Date_Pass_USR = DTL.USR_From_Date;

// PAR.Thru Date Pass        USR = DTL.USR Through Date
PAR.Thru_Date_Pass_USR = DTL.USR_Through_Date;

// PAR.Customer Number Pass  USR = DTL.USR Ship to Customer CD7
PAR.Customer_Number_Pass_USR = DTL.USR_Ship_to_Customer_CD7;

// PAR.System Value Numeric = PAR.PRT Number of Copies
PAR.System_Value_Numeric = PAR.PRT_Number_of_Copies;

// Call program PRT Broker Perf       UP.
SBMJOB;
CALL PROGRAM(PRT Broker Perf       UP) ('PPBFUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(DTL.Accrual_Code);
PARAMETER(*BLANK);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(DTL.USR_Ship_to_Customer_CD7);
PARAMETER(PAR.From_Date_Pass_USR);
PARAMETER(PAR.Thru_Date_Pass_USR);
PARAMETER(PAR.System_Value_Numeric);
PARAMETER(DTL.Status_Y_or_N);
PARAMETER('Y');
PARAMETER(LCL.Payee_Type);
PARAMETER(LCL.Company_Number);
SBMJOBOVR JOB(BROKERPERF);
SBMJOBOVR JOBD(*USRPRF);
SBMJOBEND;

// Send information message - 'Print has been submitted.'
MESSAGE(USR1832 *INFO);

ENDIF;

ENDIF;

//?USER: Exit program processing

CASE;

// IF DTL.*CMD key is *Exit
IF DTL.*CMD_key = '03';

PGM.*Return_code = 'Y2U9999';

RETURN;

ENDIF;

