// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUY4XFR
// ?Date: 14.08.2025 Time: 03:51:43
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?NOTE: JS 'INVRSTEDIW' calls this program.
// Execute function Get System Date       US.
EXECUTE FUNCTION(Get System Date       US) TYPE(EXCUSRSRC) ('PUGLUFR');
PARAMETER(LCL.System_Date_Nbr_USR);
{
 * Get System Date - CCYYMMDD
 c                   eval      #OC0NZ = *date
}


EXECUTE FUNCTION(Prt WIM 846 Raw Data  RT) TYPE(RTVOBJ) FILE(ECP780)            AC2214131;
PARAMETER(LCL.System_Date_Nbr_USR);
{
 //?USER: Initialize routine

 // LCL.Email Subject USR = CONCAT(CON.EDI 846 Error-Inv Reconci,CON.le:,CON.*ZERO)
 LCL.Email_Subject_USR = 'EDI 846 Error-Inv Reconci' + 'le:' (0);

 EXECUTE FUNCTION(RTV Data Libraries     RT) TYPE(RTVOBJ) FILE(CADPREP)          AC1165753;
 PARAMETER('DTALIB');
 PARAMETER(LCL.Library_List_Code);
 PARAMETER(NLL.@Library_List_Code);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.System Value Code is Data File Library
  IF DB1.System_Value_Code = 'DTALIB';

  // PAR.Library List Code = DB1.System Value Alpha
  PAR.Library_List_Code = DB1.System_Value_Alpha;

  // IF DB1.System Value Code is History File Library
  IF DB1.System_Value_Code = 'HISLIB';

  // PAR.@Library List Code = DB1.System Value Alpha
  PAR.@Library_List_Code = DB1.System_Value_Alpha;

  QUIT;

  ENDIF;

 }

 //?USER: Process Data record

 //?Send raw data as is even if it is 'Error'.
 EXECUTE FUNCTION(Rtv Warehouse Code    RT) TYPE(RTVOBJ) FILE(ECP782)            AC2215087;
 PARAMETER(DB1.EDI_SURROGATE_NUMBER);
 PARAMETER('WH');
 PARAMETER(LCL.Warehouse_Code);
 {
  //?USER: Initialize routine

  // PAR.Warehouse Code = CON.*BLANK
  PAR.Warehouse_Code = *BLANK;

  //?USER: Process Data record

  // PAR.Warehouse Code = DB1.N104-ID CODE
  PAR.Warehouse_Code = DB1.N104_ID_CODE;

 }

 EXECUTE FUNCTION(RTV Shipping Co        RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1695057;
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER(LCL.Shipping_Company);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
 PARAMETER(LCL.Shipping_Company);
 PARAMETER('EDI846CMP');
 PARAMETER(LCL.Email_Address);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 // LCL.Message Line 1 = CONCAT(CON.WIM EDI 846 Raw Data For,LCL.Warehouse Code,CON.1)
 LCL.Message_Line_1 = 'WIM EDI 846 Raw Data For' + LCL.Warehouse_Code (1);

 //?If Not PROD Then Append 'TEST' to Subject Line.
 CASE;

 // IF LCL.Library List Code is Not PRKFLIB
 IF LCL.Library_List_Code <> 'PRKFLIB';

 // LCL.Message Line 1 = CONCAT(LCL.Message Line 1,CON.- TEST,CON.1)
 LCL.Message_Line_1 = LCL.Message_Line_1 + '- TEST' (1);

 ENDIF;

 // Execute command - 'EXECUTE SQL VIEW'
 EXECUTE COMMAND(USR5315);
 PARAMETER(DB1.EDI_SURROGATE_NUMBER);
 PARAMETER(LCL.Email_Address);
 PARAMETER(LCL.Message_Line_1);

}


