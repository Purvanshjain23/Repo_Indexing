// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBCTXFR
// ?Date: 14.08.2025 Time: 03:47:27
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?* Use passed in delivery date/time, i.e. Port Cut Date/Time
//?* to calculate the Deadline Departure Date/Time for exports
EXECUTE FUNCTION(CLC DDD/T for Exports  IF) TYPE(EXCINTFUN)                     AC2039432;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Deadline_Depart_DT_HDR);
PARAMETER(PAR.Deadline_Depart_Time_HDR);
PARAMETER(PAR.Delivery_Date);
PARAMETER(PAR.USR_Time_4_0);
{
 //?Execute internal function

 EXECUTE FUNCTION(RTV 1st Stop Mileage   RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1456048;
 PARAMETER(PAR.Load_ID);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(WRK.Miles_to_next_stop);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

 }

 //?* If no miles to 1st stop, calculate them
 CASE;

 // IF WRK.Miles to next stop is Not Entered
 IF WRK.Miles_to_next_stop = *ZERO;

 // Call program CLC Total Load Miles   XF.
 CALL PROGRAM(CLC Total Load Miles   XF) ('PDW3XFR');
 PARAMETER(PAR.Load_ID);
 PARAMETER(WRK.Total_Load_Miles);
 PARAMETER(WRK.Override_Total_Load_Miles);

 ENDIF;

 //?* Error if still no miles to 1st stop, else calc DDD/T
 CASE;

 // IF WRK.Miles to next stop is Not Entered
 IF WRK.Miles_to_next_stop = *ZERO;

 // PAR.Deadline Depart DT    HDR = CND.not entered
 PAR.Deadline_Depart_DT_HDR = *ZERO;

 // PAR.Deadline Depart Time  HDR = CND.Not Entered
 PAR.Deadline_Depart_Time_HDR = *ZERO;

 //?* Error if still no miles to 1st stop, else calc DDD/T
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(CLC Depart Date/ExportsIF) TYPE(EXCINTFUN)                     AC2092826;
 PARAMETER(PAR.Load_ID);
 PARAMETER(PAR.Deadline_Depart_DT_HDR);
 PARAMETER(PAR.Deadline_Depart_Time_HDR);
 PARAMETER(PAR.Delivery_Date);
 PARAMETER(PAR.USR_Time_4_0);
 {
  //?Execute internal function

  EXECUTE FUNCTION(RTV 1st Stop Mileage   RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1456048;
  PARAMETER(PAR.Load_ID);
  PARAMETER(*ZERO);
  PARAMETER(*ZERO);
  PARAMETER(PAR.Miles_to_next_stop);
  {
   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

   QUIT;

  }

  //?* convert 4.0 time into 6.0 time
  // WRK.Scheduled Delivery Time = PAR.USR Time 4.0 * CON.100 *
  WRK.Scheduled_Delivery_Time = PAR.USR_Time_4_0 * 100;

  // PAR.Deadline Depart DT    HDR = PAR.Delivery Date
  PAR.Deadline_Depart_DT_HDR = PAR.Delivery_Date;

  //?* If no miles to 1st stop, calculate them
  CASE;

  // IF PAR.Miles to next stop is Not Entered
  IF PAR.Miles_to_next_stop = *ZERO;

  // Call program CLC Total Load Miles   XF.
  CALL PROGRAM(CLC Total Load Miles   XF) ('PDW3XFR');
  PARAMETER(PAR.Load_ID);
  PARAMETER(WRK.Total_Load_Miles);
  PARAMETER(WRK.Override_Total_Load_Miles);

  ENDIF;

  //?* Error if still no miles to 1st stop, else calc DDD/T
  CASE;

  // IF PAR.Miles to next stop is Not Entered
  IF PAR.Miles_to_next_stop = *ZERO;

  // PAR.Deadline Depart DT    HDR = PAR.Delivery Date
  PAR.Deadline_Depart_DT_HDR = PAR.Delivery_Date;

  // PAR.Deadline Depart Time  HDR = CND.Not Entered
  PAR.Deadline_Depart_Time_HDR = *ZERO;

  //?* Error if still no miles to 1st stop, else calc DDD/T
  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Hours Required = CON.*ZERO
  PAR.Hours_Required = *ZERO;

  EXECUTE FUNCTION(RTV Legal Run Miles DscRT) TYPE(RTVOBJ) FILE(PDLGCPP)          AC1456042;
  PARAMETER(PAR.Miles_to_next_stop);
  PARAMETER(PAR.Hours_Required);
  {
   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

   QUIT;

  }

  // Call program Rtv Addtnl Route Hrs  XF.
  CALL PROGRAM(Rtv Addtnl Route Hrs  XF) ('PMACXFR');
  PARAMETER(PAR.Load_ID);
  PARAMETER(LCL.Additional_Route_Hours);

  // PAR.Hours Required = PAR.Hours Required + LCL.Additional Route Hours
  PAR.Hours_Required = PAR.Hours_Required + LCL.Additional_Route_Hours;

  //?get number of whole days + remaining hours
  CASE;

  // IF PAR.Hours Required is Not Zero
  IF PAR.Hours_Required <> *ZERO;

  // PAR.@Days 5 = PAR.Hours Required / CON.24 *
  PAR.@Days_5 = PAR.Hours_Required / 24;

  // PAR.USR Hours 5.0 = PAR.@Days 5 * CON.24 *
  PAR.USR_Hours_5_0 = PAR.@Days_5 * 24;

  // PAR.USR Hours 5.0 = PAR.Hours Required - PAR.USR Hours 5.0
  PAR.USR_Hours_5_0 = PAR.Hours_Required - PAR.USR_Hours_5_0;

  // WRK.@Numeric 6,0 = PAR.USR Hours 5.0 * CON.10000 *
  WRK.@Numeric_60 = PAR.USR_Hours_5_0 * 10000;

  //?Subtract whole days
  CASE;

  // IF PAR.@Days 5 is greater than zero
  IF PAR.@Days_5 > *ZERO;

  // PAR.@Days 5 = PAR.@Days 5 * CON.-1 *
  PAR.@Days_5 = PAR.@Days_5 * -1;

  ENDIF;

  // PAR.Deadline Depart DT    HDR = PAR.Delivery Date + PAR.@Days 5 *DAYS
  PAR.Deadline_Depart_DT_HDR = DATEINCR(PAR.Delivery_Date PAR.@Days_5 'DY' 1111111 'NONE'
  'N' 1);

  //?Calculate # whole days + hours left
  CASE;

  // IF WRK.@Numeric 6,0 GE WRK.Scheduled Delivery Time
  IF WRK.@Numeric_60 >= WRK.Scheduled_Delivery_Time;

  // WRK.@Numeric 6,0 = WRK.@Numeric 6,0 - WRK.Scheduled Delivery Time
  WRK.@Numeric_60 = WRK.@Numeric_60 - WRK.Scheduled_Delivery_Time;

  // WRK.@Days 5 = CON.-1
  WRK.@Days_5 = -1;

  // WRK.Scheduled Delivery Date = WRK.Scheduled Delivery Date + WRK.@Days 5 *DAYS
  WRK.Scheduled_Delivery_Date = DATEINCR(WRK.Scheduled_Delivery_Date WRK.@Days_5 'DY'
  1111111 'NONE' 'N' 1);

  // PAR.Deadline Depart Time  HDR = CON.240000 - WRK.@Numeric 6,0
  PAR.Deadline_Depart_Time_HDR = 240000 - WRK.@Numeric_60;

  //?Calculate # whole days + hours left
  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Deadline Depart Time  HDR = WRK.Scheduled Delivery Time - WRK.@Numeric 6,0
  PAR.Deadline_Depart_Time_HDR = WRK.Scheduled_Delivery_Time - WRK.@Numeric_60;

  ENDIF;

  ENDIF;

  ENDIF;

 }

 ENDIF;

}


