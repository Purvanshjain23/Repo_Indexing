/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CL PROGRAM FOR PRINTING UNBOOKED ORDERS LISTING      */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  DATE      - 11/07/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*         &COMPNYN       -  PASSED COMPANY NUMBER                  */
/*         &CUSTN         -  CUSTOMER NO    (PASSED)                */
/*         &FRMDATN       -  PASSED SCHEDULED SHIP DATE             */
/*         &DLVDATN       -  PASSED DELIVERY DATE                   */
/*         &ORDERN        -  ORDER NUMBER   (PASSED)                */
/*         &ORDSTS        -  ORDER STATUS                           */
/*         &CRDHLD        -  CREDIT HOLD FLAG                       */
/*         &PRDHLD        -  PRODUCTION HOLD FLAG                   */
/*         &LTLFLG        -  LTL FLAG                               */
/*         &LOADTYP       -  PASSED LOAD TYPE                       */
/*         &LPFLAG        -  LOAD PLAN FLAG                         */
/*         &EVENT         -  EVENT CODE                             */
/*         &LOADSUM       -  U/M - LOAD SCHEDULING (PASSED)         */
/*         &OUTQ          -  OUTPUT QUEUE                           */
/*         &HOLD          -  HOLD STATUS                            */
/*         &SAVE          -  SAVE STATUS                            */
/*         &COPYN         -  PASSED NUMBER OF COPIES                */
/********************************************************************/
/* RMC 01/09/08 REARRANGE PARMS TO ACCOM CALL FROM JOB SCHED JOB    */
/* DN  08/21/19 S15343 - Added &LOADSUM to entry parm & pass it to  */
/*              PDCPPFR program.                                    */
/* PIO 06/10/25 REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPL1            */
/*              ADDED NEEDED OVRDBF AROUND THE COMMAND              */
/*              CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*              *GT TO > IN &F                                      */
/********************************************************************/

 /* NPCLP:   PGM        PARM(&COMPNYN &CUSTN &FRMDATN &ORDERN +
                          &ORDSTS &CRDHLD &PRDHLD &DLVDATN &LTLFLG +
                          &LOADTYP &LPFLAG &EVENT &OUTQ &HOLD &SAVE +
                          &COPYN &NIGHTQ)                              */
 PDCNPCLP:   PGM        PARM(&OUTQ &HOLD &SAVE &COMPNYN &CUSTN +
                          &FRMDATN &DLVDATN &ORDERN &COPYN &ORDSTS +
                          &CRDHLD &PRDHLD &LTLFLG &LOADTYP &LPFLAG +
                          &EVENT &LOADSUM)

        DCL    &COMPNYN     *DEC
        DCL    &CUSTN       *DEC
        DCL    &FRMDATN     *DEC
        DCL    &DLVDATN     *DEC
        DCL    &ORDERN      *DEC
        DCL    &ORDSTS      *CHAR  (1)
        DCL    &CRDHLD      *CHAR  (1)
        DCL    &PRDHLD      *CHAR  (1)
        DCL    &LTLFLG      *CHAR  (1)
        DCL    &LOADTYP     *CHAR  (1)
        DCL    &LPFLAG      *CHAR  (1)
        DCL    &EVENT       *CHAR  (2)
        DCL    &LOADSUM     *CHAR  (2)
        DCL    &OUTQ        *CHAR  (10)
        DCL    &HOLD        *CHAR  (04)
        DCL    &SAVE        *CHAR  (04)
        DCL    &COPYN       *DEC

        DCL    &COMPANY     *DEC   (3 0)
        DCL    &CUSTNO      *DEC   (7 0)
        DCL    &DATE        *DEC   (7 0)
        DCL    &DATED       *DEC   (7 0)
        DCL    &ORDER       *DEC   (7 0)
        DCL    &COPY        *DEC   (2 0)
        DCL    &B          *CHAR    30           /*  QRY-SEL CO.#  */
        DCL    &BB         *CHAR    30           /*  QRY-SEL CUSTOMER    */
        DCL    &BBB        *CHAR    30           /*  QRY-SEL ORDER       */
        DCL    &C          *CHAR    30           /*  QRY-SEL SHIP DATE  */
        DCL    &CC         *CHAR    30           /*  QRY-SEL LTL FLAG   */
        DCL    &CCC        *CHAR    30           /*  QRY-SEL ORDER STS  */
        DCL    &CCCC       *CHAR    30           /*  QRY-SEL DLV DT*/
        DCL    &D          *CHAR    30           /*  QRY-SEL EVENT CODE  */
        DCL    &DD         *CHAR    30           /*  QRY-SEL CREDIT HOLD */
        DCL    &DDD        *CHAR    30           /*  QRY-SEL PROD. HOLD  */
        DCL    &E          *CHAR    30           /*  QRY-SEL LOAD PLAN ORDER */
        DCL    &EE         *CHAR    30           /*  QRY-SEL LTL FLAG  */
        DCL    &EEE        *CHAR    30           /*  QRY-SEL LOAD TYPE */
        DCL    &F          *CHAR   390           /*  QRY COMPLETE SEL. */
        DCL    &COMMAND    *CHAR   (542)

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* COMPANY                   */
        DCL    &ORDERA     *CHAR    7            /* ORDER NUMBER              */
        DCL    &CUSTA      *CHAR    7            /* CUSTOMER NUMBER           */
        DCL    &DATEA      *CHAR    7            /* SCHD SHIP DATE            */
        DCL    &DATEDA     *CHAR    7            /* DELIVERY  DATE            */

/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/

             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&ORDER) VALUE(&ORDERN)
             CHGVAR     VAR(&ORDERA) VALUE(&ORDER)
             CHGVAR     VAR(&DATE) VALUE(&FRMDATN)
             CHGVAR     VAR(&DATED) VALUE(&DLVDATN)
             CHGVAR     VAR(&DATEA) VALUE(&DATE)
             CHGVAR     VAR(&DATEDA) VALUE(&DATED)
             CHGVAR     VAR(&CUSTNO) VALUE(&CUSTN)
             CHGVAR     VAR(&CUSTA) VALUE(&CUSTNO)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)

/* ELIMINATE DECIMAL DATA ERROR                    */
             IF         COND(&COMPA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&COMPANY) VALUE(0)
             CHGVAR     VAR(&COMPA) VALUE('000')
             ENDDO
             IF         COND(&ORDERA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&ORDER) VALUE(0)
             CHGVAR     VAR(&ORDERA) VALUE('0000000')
             ENDDO
             IF         COND(&DATEA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&DATE) VALUE(0)
             CHGVAR     VAR(&DATEA) VALUE('0000000')
             ENDDO
             IF         COND(&DATEDA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&DATED) VALUE(0)
             CHGVAR     VAR(&DATEDA) VALUE('0000000')
             ENDDO
             IF         COND(&CUSTA *EQ '   ') THEN(DO)
             CHGVAR     VAR(&CUSTNO) VALUE(0)
             CHGVAR     VAR(&CUSTA) VALUE('0000000')
             ENDDO
/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED                               */
/*********************************************************************/

/*  IF CO. NUMBER SELECTED  */
             IF         COND(&COMPA *NE '000') THEN(DO)
  /*PIO      CHGVAR     VAR(&B) VALUE('BEAIC3 *EQ ' *CAT &COMPA) */
  /*PIO*/    CHGVAR     VAR(&B) VALUE('BEAIC3  =  ' *CAT &COMPA)
             ENDDO

/*  IF CUSTOMER IS SELECTED                                    */
             IF         COND(&CUSTA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&BB) VALUE('*AND BEBKC7 *EQ ' *CAT &CUSTA) */
  /*PIO*/    CHGVAR     VAR(&BB) VALUE(' AND BEBKC7  =  ' *CAT &CUSTA)
             ENDDO

/*  IF ORDER NUMBER IS SELECTED                                    */
             IF         COND(&ORDERA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&BBB) VALUE('*AND BEC4NB *EQ ' *CAT &ORDERA) */
  /*PIO*/    CHGVAR     VAR(&BBB) VALUE(' AND BEC4NB  =  ' *CAT &ORDERA)
             ENDDO

/*  IF SCHED SHIP DATE IS SELECTED                                    */
             IF         COND(&DATEA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&C) VALUE('*AND BEAODT *EQ ' *CAT &DATEA) */
  /*PIO*/    CHGVAR     VAR(&C) VALUE(' AND BEAODT  =  ' *CAT &DATEA)
             ENDDO

/*  IF DELIVERY DATE IS SELECTED                                    */
             IF         COND(&DATEDA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&CCCC) VALUE('*AND BEEIDT *EQ ' *CAT + +
                          &DATEDA)                                */
  /*PIO*/    CHGVAR     VAR(&CCCC) VALUE(' AND BEEIDT =   ' *CAT +
                          &DATEDA)
             ENDDO

/*  IF LTL FLAG IS SELECTED                                    */
             IF         COND(&LTLFLG *NE '  ') THEN(DO)
  /*PIO      CHGVAR     VAR(&CC) VALUE('*AND BEPJST *EQ "' *CAT &LTLFLG + +
                        *CAT '"')                                        */
  /*PIO*/    CHGVAR     VAR(&CC) VALUE(' AND BEPJST  =  "' *CAT &LTLFLG +
                        *CAT '"')
             ENDDO

/*  IF HEADER STATUS IS SELECTED                                    */
             IF         COND(&ORDSTS *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&CCC) VALUE('*AND BEGWST *EQ "' *CAT &ORDSTS + +
                        *CAT '"')                                         */
 /*PIO*/     CHGVAR     VAR(&CCC) VALUE(' AND BEGWST  =  "' *CAT &ORDSTS +
                        *CAT '"')
             ENDDO

/*  IF EVENT CODE IS ENTERED */

             IF         COND(&EVENT *NE ' ') THEN(DO)
 /*PIO       CHGVAR     VAR(&D) VALUE('*AND BEJPCD *EQ "' *CAT &EVENT + +
                        *CAT '"')                                      */
 /*PIO*/     CHGVAR     VAR(&D) VALUE(' AND BEJPCD  =  "' *CAT &EVENT +
                        *CAT '"')
             ENDDO

/*  IF CREDIT HOLD IS SELECTED */

             IF         COND(&CRDHLD *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&DD) VALUE('*AND BEXIST *EQ "' *CAT &CRDHLD + +
                        *CAT '"')                                       */
  /*PIO*/    CHGVAR     VAR(&DD) VALUE(' AND BEXIST  =  "' *CAT &CRDHLD +
                        *CAT '"')
             ENDDO

/*  IF PRODUCTION HOLD IS SELECTED */

             IF         COND(&PRDHLD *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&DDD) VALUE('*AND BEXJST *EQ "' *CAT &PRDHLD + +
                        *CAT '"')                                        */
  /*PIO*/    CHGVAR     VAR(&DDD) VALUE(' AND BEXJST =   "' *CAT &PRDHLD +
                        *CAT '"')
             ENDDO

/*  IF LOAD PLAN ORDER IS SELECTED */

             IF         COND(&LPFLAG *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&E) VALUE('*AND BEU4ST *EQ "' *CAT &LPFLAG + +
                        *CAT '"')                                       */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(' AND BEU4ST =   "' *CAT &LPFLAG +
                        *CAT '"')
             ENDDO

/*  IF LTL FLAG IS SELECTED */

             IF         COND(&LTLFLG *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&EE) VALUE('*AND BEPJST *EQ "' *CAT &LTLFLG + +
                        *CAT '"')                                        */
  /*PIO*/    CHGVAR     VAR(&EE) VALUE(' AND BEPJST  =  "' *CAT &LTLFLG +
                        *CAT '"')
             ENDDO

/*  IF LOAD TYPE IS SELECTED */

             IF         COND(&LOADTYP *NE ' ') THEN(DO)
  /*PIO      CHGVAR     VAR(&EEE) VALUE('*AND BEVDST *EQ "' *CAT &LOADTYP + +
                        *CAT '"')                                          */
  /*PIO*/    CHGVAR     VAR(&EEE) VALUE(' AND BEVDST  =  "' *CAT &LOADTYP +
                        *CAT '"')
             ENDDO

/* BUILD QUERY STRING                                        */

             CHGVAR     VAR(&F) VALUE(&B *BCAT &BB *BCAT &BBB *BCAT +
                          &C *BCAT &CCCC *BCAT &CC *BCAT &CCC *BCAT +
                          &D *BCAT &DD *BCAT &DDD *BCAT &E *BCAT +
                          &EE *BCAT &EEE)

   /*PIO     OVRDBF     FILE(OPBFCPL1) SHARE(*YES)               +
             OPNQRYF    FILE((OPBFCPL1)) QRYSLT(&F) KEYFLD(*FILE) +
                          SEQONLY(*YES 1)                       */

  /*PIO*/    OVRDBF     FILE(OPBFCPP) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP Where  ' *BCAT &F +
                          *BCAT ' ORDER BY BEAIC3 ASC, BEC4NB ASC') +
                          OPNID(OPBFCPL1) OPTION(*ALL) SEQONLY(*NO) +
                          RCDFMT(@BECPFK) ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPL1) TOFILE(OPBFCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDCPPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

 /* S15343 - Added &LOADSUM to PARM */
 CALL:       CALL       PGM(PDCPPFR) PARM(' ' &COMPANY &ORDER +
                          &CUSTNO &ORDSTS &DATE &CRDHLD &PRDHLD +
                          &DATED &LTLFLG &LOADTYP &LPFLAG &EVENT +
                          &LOADSUM)

 ENDPGM:     ENDPGM
