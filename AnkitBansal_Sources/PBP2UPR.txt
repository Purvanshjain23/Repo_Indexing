/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  THIS PROGRAM WILL BE CALLED FROM A TRIGGER ON THE   */
/*              PFS INVENTORY REST TRG (PBBWCPP).                   */
/*                                                                  */
/*              WHEN A RECORD IS INSERTED INTO THE PFS INVENTORY    */
/*              REST TRG FILE, THE AUTOMATED INVENTORY RESTORATION  */
/*              PROCESS IS RAN FOR THE SPECIFIED COMPANY.           */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*                                                                  */
/********************************************************************/
/*  PARAMETERS RECEIVED:                                            */
/*                                                                  */
/*               &TRGBUF  - TRIGGER BUFFER                          */
/*               &TRGLEN  - TRIGGER LENGTH                          */
/********************************************************************/
/* MODIFIED BY:                                                     */
/* E3527 JJH 10/22/14 CREATE INITIAL PROGRAM                        */
/* S11147 RMC 07/11/17 SBMJOB TO UPDATE STS TO P                     */
/* INC1036479 AKB 06/02/25 Start Job Scheduler Job PFSINVREST       */
/********************************************************************/

 PBP2UPR:    PGM        PARM(&TRGBUF &TRGLEN)

/* PARMS */
         DCL     &TRGBUF     *CHAR    (1020)     /* TRIGGER BUFFER  */
         DCL     &TRGLEN     *DEC     (4 0)      /* BUFFER LENGTH   */

         DCL     &AIRCOM     *CHAR    3          /* COMPANY         */
         DCL     &AIRTDT     *CHAR    8          /* PFS TRANS DATE  */
         DCL     &AIRSTS     *CHAR    1          /* PFS INV RST STS */

             CHGVAR     VAR(&AIRCOM) VALUE(%SST(&TRGBUF 129 3))
             CHGVAR     VAR(&AIRTDT) VALUE(%SST(&TRGBUF 132 8))
             CHGVAR     VAR(&AIRSTS) VALUE(%SST(&TRGBUF 140 1))

/********************************************************************/
     /* AUTOMATED INVENTORY RESTORATION                                  */

     /*‚AB   CALL       PGM(PBNMXFR) PARM('' &AIRCOM)              */

     /* UPDATE PFS INVENTORY REST TRG STS TO P=PROCESSED                 */
     /*      CALL       PGM(PBP3XFR) PARM('' &AIRCOM &AIRTDT)           */
     /*‚AB   SBMJOB     CMD(CALL PGM(PBP3XFR) PARM('' &AIRCOM &AIRTDT)) */

             /*‚AB: Trigger Job Scheduler Job and return the control back*/
             SBMJOBJS   JOB(PFSINVREST) TIME(*IMMED) PARM((CMPID +
                          &AIRCOM) (PFSTRANSDT &AIRTDT))

             MONMSG     MSGID(CPF0000)
/*------------------------------------------------------------------*/

 END:        ENDPGM

