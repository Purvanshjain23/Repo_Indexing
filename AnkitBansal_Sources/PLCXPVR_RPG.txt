     H/TITLE Pmt Transfer Delivery PV  Prompt & validate record
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Prompts fields, allowing user changes
     H* - Validates fields
     H* - If valid, performs an action
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Prompt & validate record
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISJBADE
     H* Date          : 07/02/21  Time  : 16:25:10
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPLCXPVR#CF  E                    WORKSTN
     F                                              KINFDS INFDS#
      * DSP: Pmt Transfer Delivery PV  Prompt & validate record
      *
     FPKAWCPL1IF  E           K        DISK
      * RTV : Buy Order Header          Retrieval index
      *
     FPKAZREL1IF  E           K        DISK
      * RTV : Company Control HPE       Retrieval index
      *
     FPLAECPLBIF  E           K        DISK
      * RSQ : Delivery Sched Detail     Co/KDt/DDt/DTm/Sq-d
      *
     FPKAXCPLEIF  E           K        DISK
      * RSQ : Buy Order Load            Co/Prd/Lc/KlD
      *
     FPKAWCPLBIF  E           K        DISK
      * RSQ : Buy Order Header          Co/Pdrc/Loc/Kill Dte
      *
     FPKBAREL0IF  E           K        DISK
      * RTV : Trucker                   Retrieval index
      *
     FPKAFREL0IF  E           K        DISK
      * RTV : Producer Location         Retrieval index
      *
     FPKAZREL0UF  E           K        DISK
      * UPD : Company Control HPE       Update index
      *
     FPKAWCPL0IF  E           K        DISK                      A
      * UPD : Buy Order Header          Update index
      *
      * Days in month for date validation
     E                    @XD    12  12  2 0
     E                    YDOW        7  1               *Days of week
     I@AWCPBI
      * Buy Order Header          Retrieval index
      * Renamed input format fields
     I              AWHMNB                          WAHMNB
     I              AWBNNB                          WABNNB
     I              AWARDT                          WAARDT
     I              AWASDT                          WAASDT
     I              AWA4ST                          WAA4ST
     I              AWA5ST                          WAA5ST
     I              AWAAPR                          WAAAPR
     I              AWA6ST                          WAA6ST
     I              AWA7ST                          WAA7ST
     I              AWB3ST                          WAB3ST
     I              AWALPR                          WAALPR
     I              AWETCD                          WAETCD
     I              AWEUCD                          WAEUCD
     I              AWJ5TX                          WAJ5TX
     I              AWD5DT                          WAD5DT
     I              AWD6DT                          WAD6DT
     I              AWD7DT                          WAD7DT
     I              AWD8DT                          WAD8DT
     I              AWD9DT                          WAD9DT
     I              AWJOEJ                          WAJOEJ
     I              AWKOFF                          WAKOFF
     I              AWKWPE                          WAKWPE
     I              AWIMBF                          WAIMBF
     I              AWOPTR                          WAOPTR
     I              AWOEJD                          WAOEJD
     I              AWIRMF                          WAIRMF
     I              AWJIRM                          WAJIRM
     I              AWJRKF                          WAJRKF
     I              AWKFIR                          WAKFIR
     I              AWUZST                          WAUZST
     I              AWU0ST                          WAU0ST
     I              AWU1ST                          WAU1ST
     I              AWU2ST                          WAU2ST
     I              AWU3ST                          WAU3ST
     I              AWHXNB                          WAHXNB
     I              AWGANB                          WAGANB
     I              AWGBNB                          WAGBNB
     I              AWABCD                          WAABCD
     I              AWAECD                          WAAECD
     I              AWAKCD                          WAAKCD
     I              AWALCD                          WAALCD
     I              AWAGCD                          WAAGCD
     I              AWAICD                          WAAICD
     I              AWAMCD                          WAAMCD
     I              AWACCD                          WAACCD
     I              AWAAVN                          WAAAVN
     I              AWAADT                          WAAADT
     I              AWAMTM                          WAAMTM
     I              AWAJST                          WAAJST
     I              AWAHVN                          WAAHVN
     I              AWAGVN                          WAAGVN
     I              AWABVN                          WAABVN
     I              AWABDT                          WAABDT
     I              AWABTM                          WAABTM
      *
     I@AZCPCN
      * Company Control HPE       Retrieval index
      * Renamed input format fields
     I              AZHONB                          WBHONB
     I              AZBSNB                          WBBSNB
     I              AZB1DT                          WBB1DT
     I              AZB2DT                          WBB2DT
     I              AZH4NB                          WBH4NB
     I              AZK3NB                          WBK3NB
     I              AZCDDT                          WBCDDT
     I              AZCEDT                          WBCEDT
     I              AZAAVN                          WBAAVN
     I              AZAADT                          WBAADT
     I              AZAMTM                          WBAMTM
     I              AZAJST                          WBAJST
     I              AZAHVN                          WBAHVN
     I              AZAGVN                          WBAGVN
     I              AZABVN                          WBABVN
     I              AZABDT                          WBABDT
     I              AZABTM                          WBABTM
      *
     I@AZCPCM
      * Company Control HPE       Update index
      * Renamed input format fields
     I              AZHONB                          WCHONB
     I              AZBSNB                          WCBSNB
     I              AZB1DT                          WCB1DT
     I              AZB2DT                          WCB2DT
     I              AZH4NB                          WCH4NB
     I              AZK3NB                          WCK3NB
     I              AZCDDT                          WCCDDT
     I              AZCEDT                          WCCEDT
     I              AZAAVN                          WCAAVN
     I              AZAADT                          WCAADT
     I              AZAMTM                          WCAMTM
     I              AZAJST                          WCAJST
     I              AZAHVN                          WCAHVN
     I              AZAGVN                          WCAGVN
     I              AZABVN                          WCABVN
     I              AZABDT                          WCABDT
     I              AZABTM                          WCABTM
      *
     I@AWCPAZ
      * Buy Order Header          Update index
      * Renamed input format fields
     I              AWHMNB                          WDHMNB
     I              AWBNNB                          WDBNNB
     I              AWARDT                          WDARDT
     I              AWASDT                          WDASDT
     I              AWA4ST                          WDA4ST
     I              AWA5ST                          WDA5ST
     I              AWAAPR                          WDAAPR
     I              AWA6ST                          WDA6ST
     I              AWA7ST                          WDA7ST
     I              AWB3ST                          WDB3ST
     I              AWALPR                          WDALPR
     I              AWETCD                          WDETCD
     I              AWEUCD                          WDEUCD
     I              AWJ5TX                          WDJ5TX
     I              AWD5DT                          WDD5DT
     I              AWD6DT                          WDD6DT
     I              AWD7DT                          WDD7DT
     I              AWD8DT                          WDD8DT
     I              AWD9DT                          WDD9DT
     I              AWJOEJ                          WDJOEJ
     I              AWKOFF                          WDKOFF
     I              AWKWPE                          WDKWPE
     I              AWIMBF                          WDIMBF
     I              AWOPTR                          WDOPTR
     I              AWOEJD                          WDOEJD
     I              AWIRMF                          WDIRMF
     I              AWJIRM                          WDJIRM
     I              AWJRKF                          WDJRKF
     I              AWKFIR                          WDKFIR
     I              AWUZST                          WDUZST
     I              AWU0ST                          WDU0ST
     I              AWU1ST                          WDU1ST
     I              AWU2ST                          WDU2ST
     I              AWU3ST                          WDU3ST
     I              AWHXNB                          WDHXNB
     I              AWGANB                          WDGANB
     I              AWGBNB                          WDGBNB
     I              AWABCD                          WDABCD
     I              AWAECD                          WDAECD
     I              AWAKCD                          WDAKCD
     I              AWALCD                          WDALCD
     I              AWAGCD                          WDAGCD
     I              AWAICD                          WDAICD
     I              AWAMCD                          WDAMCD
     I              AWACCD                          WDACCD
     I              AWAAVN                          WDAAVN
     I              AWAADT                          WDAADT
     I              AWAMTM                          WDAMTM
     I              AWAJST                          WDAJST
     I              AWAHVN                          WDAHVN
     I              AWAGVN                          WDAGVN
     I              AWABVN                          WDABVN
     I              AWABDT                          WDABDT
     I              AWABTM                          WDABTM
      *
     I@AECPJT
      * Delivery Sched Detail     Co/KDt/DDt/DTm/Sq-d
      * Renamed input format fields
     I              AEHONB                          WEHONB
     I              AEE0DT                          WEE0DT
     I              AEE6DT                          WEE6DT
     I              AEAGTH                          WEAGTH
     I              AEHZA1                          WEHZA1
     I              AEH0A1                          WEH0A1
     I              AEH1A1                          WEH1A1
     I              AEJ4CD                          WEJ4CD
     I              AEJ5CD                          WEJ5CD
     I              AELBCD                          WELBCD
     I              AELCCD                          WELCCD
     I              AEIOA1                          WEIOA1
     I              AEH2A1                          WEH2A1
     I              AEIJA1                          WEIJA1
     I              AEK9CD                          WEK9CD
     I              AEK8CD                          WEK8CD
     I              AEJ6CD                          WEJ6CD
     I              AEJ7CD                          WEJ7CD
     I              AEMGCD                          WEMGCD
     I              AEW1ST                          WEW1ST
     I              AEW2ST                          WEW2ST
     I              AEH3A1                          WEH3A1
     I              AEMECD                          WEMECD
     I              AEMFCD                          WEMFCD
     I              AEW4ST                          WEW4ST
     I              AEXWST                          WEXWST
     I              AEFRDT                          WEFRDT
     I              AEBOTH                          WEBOTH
     I              AEE7DT                          WEE7DT
     I              AEAHTH                          WEAHTH
     I              AEE8DT                          WEE8DT
     I              AEAITH                          WEAITH
     I              AEXBST                          WEXBST
     I              AEXGST                          WEXGST
     I              AEXPST                          WEXPST
     I              AEXNST                          WEXNST
     I              AEXTST                          WEXTST
     I              AEXLST                          WEXLST
     I              AEW0ST                          WEW0ST
     I              AEYEST                          WEYEST
     I              AEFZDT                          WEFZDT
     I              AEB1TH                          WEB1TH
     I              AEAACD                          WEAACD
     I              AEABCD                          WEABCD
     I              AEAECD                          WEAECD
     I              AEHMNB                          WEHMNB
     I              AEBNNB                          WEBNNB
     I              AEBONB                          WEBONB
     I              AEY0A1                          WEY0A1
     I              AEY1A1                          WEY1A1
     I              AEDGT1                          WEDGT1
     I              AEDHT1                          WEDHT1
     I              AEIISS                          WEIISS
     I              AEAAVN                          WEAAVN
     I              AEAADT                          WEAADT
     I              AEAMTM                          WEAMTM
     I              AEAJST                          WEAJST
     I              AEAHVN                          WEAHVN
     I              AEAGVN                          WEAGVN
     I              AEABVN                          WEABVN
     I              AEABDT                          WEABDT
     I              AEABTM                          WEABTM
      *
     I@AXCPJ2
      * Buy Order Load            Co/Prd/Lc/KlD
      * Renamed input format fields
     I              AXHMNB                          WFHMNB
     I              AXBNNB                          WFBNNB
     I              AXBONB                          WFBONB
     I              AXCQDT                          WFCQDT
     I              AXABTH                          WFABTH
     I              AXACTH                          WFACTH
     I              AXBPNB                          WFBPNB
     I              AXCSNB                          WFCSNB
     I              AXAUDT                          WFAUDT
     I              AXCMST                          WFCMST
     I              AXAGPR                          WFAGPR
     I              AXATVA                          WFATVA
     I              AXI1ST                          WFI1ST
     I              AXDHNB                          WFDHNB
     I              AXDINB                          WFDINB
     I              AXCNST                          WFCNST
     I              AXGINB                          WFGINB
     I              AXBZDT                          WFBZDT
     I              AXLSNB                          WFLSNB
     I              AXF3TX                          WFF3TX
     I              AXO8ST                          WFO8ST
     I              AXO9ST                          WFO9ST
     I              AXPAST                          WFPAST
     I              AXLDSH                          WFLDSH
     I              AXPBST                          WFPBST
     I              AXPCST                          WFPCST
     I              AXPDST                          WFPDST
     I              AXUWST                          WFUWST
     I              AXUXST                          WFUXST
     I              AXUYST                          WFUYST
     I              AXJKRU                          WFJKRU
     I              AXKEOR                          WFKEOR
     I              AXIOEW                          WFIOEW
     I              AXKJIO                          WFKJIO
     I              AXIOJR                          WFIOJR
     I              AXEIRR                          WFEIRR
     I              AXITMF                          WFITMF
     I              AXODJE                          WFODJE
     I              AXRJIF                          WFRJIF
     I              AXOEJF                          WFOEJF
     I              AXD0DT                          WFD0DT
     I              AXD1DT                          WFD1DT
     I              AXD2DT                          WFD2DT
     I              AXD3DT                          WFD3DT
     I              AXD4DT                          WFD4DT
     I              AXBNCD                          WFBNCD
     I              AXABCD                          WFABCD
     I              AXAECD                          WFAECD
     I              AXAAVN                          WFAAVN
     I              AXAADT                          WFAADT
     I              AXAMTM                          WFAMTM
     I              AXAJST                          WFAJST
     I              AXAHVN                          WFAHVN
     I              AXAGVN                          WFAGVN
     I              AXABVN                          WFABVN
     I              AXABDT                          WFABDT
     I              AXABTM                          WFABTM
      *
     I@AWCPNB
      * Buy Order Header          Co/Pdrc/Loc/Kill Dte
      * Renamed input format fields
     I              AWHMNB                          WGHMNB
     I              AWBNNB                          WGBNNB
     I              AWARDT                          WGARDT
     I              AWASDT                          WGASDT
     I              AWA4ST                          WGA4ST
     I              AWA5ST                          WGA5ST
     I              AWAAPR                          WGAAPR
     I              AWA6ST                          WGA6ST
     I              AWA7ST                          WGA7ST
     I              AWB3ST                          WGB3ST
     I              AWALPR                          WGALPR
     I              AWETCD                          WGETCD
     I              AWEUCD                          WGEUCD
     I              AWJ5TX                          WGJ5TX
     I              AWD5DT                          WGD5DT
     I              AWD6DT                          WGD6DT
     I              AWD7DT                          WGD7DT
     I              AWD8DT                          WGD8DT
     I              AWD9DT                          WGD9DT
     I              AWJOEJ                          WGJOEJ
     I              AWKOFF                          WGKOFF
     I              AWKWPE                          WGKWPE
     I              AWIMBF                          WGIMBF
     I              AWOPTR                          WGOPTR
     I              AWOEJD                          WGOEJD
     I              AWIRMF                          WGIRMF
     I              AWJIRM                          WGJIRM
     I              AWJRKF                          WGJRKF
     I              AWKFIR                          WGKFIR
     I              AWUZST                          WGUZST
     I              AWU0ST                          WGU0ST
     I              AWU1ST                          WGU1ST
     I              AWU2ST                          WGU2ST
     I              AWU3ST                          WGU3ST
     I              AWHXNB                          WGHXNB
     I              AWGANB                          WGGANB
     I              AWGBNB                          WGGBNB
     I              AWABCD                          WGABCD
     I              AWAECD                          WGAECD
     I              AWAKCD                          WGAKCD
     I              AWALCD                          WGALCD
     I              AWAGCD                          WGAGCD
     I              AWAICD                          WGAICD
     I              AWAMCD                          WGAMCD
     I              AWACCD                          WGACCD
     I              AWAAVN                          WGAAVN
     I              AWAADT                          WGAADT
     I              AWAMTM                          WGAMTM
     I              AWAJST                          WGAJST
     I              AWAHVN                          WGAHVN
     I              AWAGVN                          WGAGVN
     I              AWABVN                          WGABVN
     I              AWABDT                          WGABDT
     I              AWABTM                          WGABTM
      *
     I@BAREDS
      * Trucker                   Retrieval index
      * Renamed input format fields
     I              BABNCD                          WHBNCD
     I              BABJTX                          WHBJTX
     I              BAB6ST                          WHB6ST
     I              BAGMNB                          WHGMNB
     I              BAC3TX                          WHC3TX
     I              BAAAVN                          WHAAVN
     I              BAAADT                          WHAADT
     I              BAAMTM                          WHAMTM
     I              BAAJST                          WHAJST
     I              BAAHVN                          WHAHVN
     I              BAAGVN                          WHAGVN
     I              BAABVN                          WHABVN
     I              BAABDT                          WHABDT
     I              BAABTM                          WHABTM
      *
     I@AFREAR
      * Producer Location         Retrieval index
      * Renamed input format fields
     I              AFABCD                          WIABCD
     I              AFAECD                          WIAECD
     I              AFA8TX                          WIA8TX
     I              AFGLNB                          WIGLNB
     I              AFATST                          WIATST
     I              AFASNB                          WIASNB
     I              AFAUST                          WIAUST
     I              AFQNST                          WIQNST
     I              AFQOST                          WIQOST
     I              AFQPST                          WIQPST
     I              AFQQST                          WIQQST
     I              AFQRST                          WIQRST
     I              AFN0TX                          WIN0TX
     I              AFQSST                          WIQSST
     I              AFQTST                          WIQTST
     I              AFQUST                          WIQUST
     I              AFQVST                          WIQVST
     I              AFR8ST                          WIR8ST
     I              AFR9ST                          WIR9ST
     I              AFSAST                          WISAST
     I              AFSBST                          WISBST
     I              AFSDST                          WISDST
     I              AFSEST                          WISEST
     I              AFSFST                          WISFST
     I              AFHWNB                          WIHWNB
     I              AFFUCD                          WIFUCD
     I              AFAAVN                          WIAAVN
     I              AFAADT                          WIAADT
     I              AFAMTM                          WIAMTM
     I              AFAJST                          WIAJST
     I              AFAHVN                          WIAHVN
     I              AFAGVN                          WIAGVN
     I              AFABVN                          WIABVN
     I              AFABDT                          WIABDT
     I              AFABTM                          WIABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IQPKAZ1    E DSPKAZREL0
      * UPD : Company Control HPE       Update index
      * Renamed input format fields
     I              AZHONB                          WCHONB
     I              AZBSNB                          WCBSNB
     I              AZB1DT                          WCB1DT
     I              AZB2DT                          WCB2DT
     I              AZH4NB                          WCH4NB
     I              AZK3NB                          WCK3NB
     I              AZCDDT                          WCCDDT
     I              AZCEDT                          WCCEDT
     I              AZAAVN                          WCAAVN
     I              AZAADT                          WCAADT
     I              AZAMTM                          WCAMTM
     I              AZAJST                          WCAJST
     I              AZAHVN                          WCAHVN
     I              AZAGVN                          WCAGVN
     I              AZABVN                          WCABVN
     I              AZABDT                          WCABDT
     I              AZABTM                          WCABTM
      *
     IYARDCS      DS                             84
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                             84
     IQPKAW1    E DSPKAWCPL0
      * UPD : Buy Order Header          Update index
      * Renamed input format fields
     I              AWHMNB                          WDHMNB
     I              AWBNNB                          WDBNNB
     I              AWARDT                          WDARDT
     I              AWASDT                          WDASDT
     I              AWA4ST                          WDA4ST
     I              AWA5ST                          WDA5ST
     I              AWAAPR                          WDAAPR
     I              AWA6ST                          WDA6ST
     I              AWA7ST                          WDA7ST
     I              AWB3ST                          WDB3ST
     I              AWALPR                          WDALPR
     I              AWETCD                          WDETCD
     I              AWEUCD                          WDEUCD
     I              AWJ5TX                          WDJ5TX
     I              AWD5DT                          WDD5DT
     I              AWD6DT                          WDD6DT
     I              AWD7DT                          WDD7DT
     I              AWD8DT                          WDD8DT
     I              AWD9DT                          WDD9DT
     I              AWJOEJ                          WDJOEJ
     I              AWKOFF                          WDKOFF
     I              AWKWPE                          WDKWPE
     I              AWIMBF                          WDIMBF
     I              AWOPTR                          WDOPTR
     I              AWOEJD                          WDOEJD
     I              AWIRMF                          WDIRMF
     I              AWJIRM                          WDJIRM
     I              AWJRKF                          WDJRKF
     I              AWKFIR                          WDKFIR
     I              AWUZST                          WDUZST
     I              AWU0ST                          WDU0ST
     I              AWU1ST                          WDU1ST
     I              AWU2ST                          WDU2ST
     I              AWU3ST                          WDU3ST
     I              AWHXNB                          WDHXNB
     I              AWGANB                          WDGANB
     I              AWGBNB                          WDGBNB
     I              AWABCD                          WDABCD
     I              AWAECD                          WDAECD
     I              AWAKCD                          WDAKCD
     I              AWALCD                          WDALCD
     I              AWAGCD                          WDAGCD
     I              AWAICD                          WDAICD
     I              AWAMCD                          WDAMCD
     I              AWACCD                          WDACCD
     I              AWAAVN                          WDAAVN
     I              AWAADT                          WDAADT
     I              AWAMTM                          WDAMTM
     I              AWAJST                          WDAJST
     I              AWAHVN                          WDAHVN
     I              AWAGVN                          WDAGVN
     I              AWABVN                          WDABVN
     I              AWABDT                          WDABDT
     I              AWABTM                          WDABTM
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXTCK        DS
      * Time: hours, minutes, seconds
     I                                        1   60XTTIM
     I                                        1   20XTHH
     I                                        3   40XTNN
     I                                        5   60XTSS
      /EJECT
     IXDOFF       DS
      * Cut-off year
     I                                        1   40XOFF
     I                                        3   40XOFFYY
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Buy Order Load
      * I : MAP BOH Company Number
     I                                    P   1   20P1HMNB
      * I : MAP BOH Buy Order Number
     I                                    P   3   60P1BNNB
      * I : MAP BOL Load Number
     I                                    P   7   90P1BONB
      * I : MAP BOL Kill Date
     I                                    P  10  130P1CQDT
      * I : MAP BOL Pln Delv Start Time
     I                                    P  14  160P1ABTH
      * I : MAP BOL Pln Delv Date
     I                                    P  17  200P1AUDT
      * I : MAP BOL HPS Movement Number
     I                                    P  21  240P1JKRU
      * I : MAP PD Producer Code
     I                                       25  30 P1ABCD
      * I : MAP PL Location Code
     I                                       31  36 P1AECD
     IP2PARM      DS
      * FLD: *Arrays
      * N :  Oms Warehouse Code
     I                                        1   3 P2J8NB
      * N :  CC Company Number
     I                                    P   4   50P2HONB
      * N :  Oms Application Code
     I                                        6  11 P2C7CD
      * N :  Oms SalesPerson Code
     I                                       12  14 P2C8CD
      * N :  Oms Allow Multi-Company
     I                                       15  15 P2G8ST
      * N :  Oms Default Printer
     I                                       16  25 P2G9ST
      * N :  Oms Name
     I                                       26  55 P2EUTX
      * N :  Oms System Value Alpha
     I                                       56  95 P2EVTX
      * N :  Oms Access Denied (Y/N)
     I                                       96  96 P2HAST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Date Required'
      * Date USR
     I                                    P   1   40ZA0001
      * Message data for 'Time is required'
      * Time USR
     I                                    P   1   30ZA0002
      * Message data for 'Buy Order/Load Created'
      * Buy Order New Usr
     I                                    P   1   40ZA0003
      * Buy Order Load New Usr
     I                                    P   5   70ZA0004
      * Kill Date Usr
     I                                    P   8  110ZA0005
      * Message data for 'Enter a kill within 2 dys'
      * Kill Date Usr
     I                                    P   1   40ZA0006
      * Message data for 'Enter a diff kill date'
      * Kill Date Usr
     I                                    P   1   40ZA0007
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HMNB    PARM           WP0001  30       BOH Company Num
     C           P1BNNB    PARM           WP0002  70       BOH Buy Order N
     C           P1BONB    PARM           WP0003  50       BOL Load Number
     C           P1CQDT    PARM           WP0004  70       BOL Kill Date
     C           P1ABTH    PARM           WP0005  40       BOL Pln Delv St
     C           P1AUDT    PARM           WP0006  70       BOL Pln Delv Da
     C           P1JKRU    PARM           WP0007  70       BOL HPS Movemen
     C           P1ABCD    PARM           WP0008  6        PD Producer Cod
     C           P1AECD    PARM           WP0009  6        PL Location Cod
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Conduct screen conversation
     C                     DO   *HIVAL
      * Start new transaction
     C                     MOVEL'Y'       W0TRN   1
      * Process current transaction
     C           W0TRN     DOWEQ'Y'
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Reset screen fields
     C   30                CAS            MALDSC
      * Process screen input
     C                     CAS            DAPRSC
     C                     END
      *
     C                     END
      *
     C                     END
      *****************************************************************
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Enable PUTOVR
     C                     SETON                     86
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDDTL1
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSC    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate screen input
     C                     EXSR DBVLSC
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Prompt for confirmation
     C                     EXSR DHPMCF
      * Quit if not confirmed
     C           *IN99     CABEQ'1'       DAEXIT
      * USER: User defined action
      * CASE: DTL.Buy Order New Usr is EQ Zero
     C           #DBONW    IFEQ *ZERO                      *IF
      * Rtv Crt Next BOH      RT - Buy Order Header  * 
     C                     EXSR SARVGN
     C                     END                             *FI
      * CASE:
      *  - c1ANDc2ANDc3
      *   |- c1    : DTL.Kill Date Usr is Entered
      *   |- c2    : DTL.Buy Order New Usr is NE Zero
      *   |- c3    : DTL.Buy Order Load New Usr is Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #DCGDT    IFNE 0                          *IF
     C           #DBONW    IFNE *ZERO                      *IF
     C           #DJ7NB    IFNE *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Rtv Next Seq Num      RT - Delivery Sched Detail  * 
     C                     EXSR SFRVGN
      * CASE: DTL.Date To   USR is Not Entered
     C           #DB4DT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Convert Date To   USR to display format
      * Convert date
     C           1000000   ADD  #DB4DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0001
      * Send message 'Date Required'
     C                     MOVEL'PRK0772' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     GOTO DAEXIT                     *QUIT
     C                     ELSE
      * CASE: DTL.Time USR is Not Entered
     C           #DADTH    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     Z-ADD#DADTH    ZA0002           Time USR
      * Send message 'Time is required'
     C                     MOVEL'PRK1230' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     GOTO DAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Exc Transfer Delivery XF - Buy Order Load  * 
     C                     CALL 'PLCWXFR'              90  Exc Transfer De
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HMNB    WQ0006  30       BOH Company Num
     C                     PARM #1BNNB    WQ0007  70       BOH Buy Order N
     C                     PARM #1BONB    WQ0008  50       BOL Load Number
     C                     PARM #1CQDT    WQ0009  70       BOL Kill Date
     C                     PARM #1JKRU    WQ0010  70       BOL HPS Movemen
     C                     PARM #1ABCD    WQ0011  6        PD Producer Cod
     C                     PARM #DCGDT    WQ0012  70       Kill Date Usr
     C                     PARM #DBONW    WQ0013  70       Buy Order New U
     C                     PARM #DJ7NB    WQ0014  50       Buy Order Load
     C                     PARM #DP4ST    WQ0015  1        Status 1
     C                     PARM #DADTH    WQ0016  40       Time USR
     C                     PARM #DB4DT    WQ0017  70       Date To   USR
     C                     PARM YL0004    WQ0018  30       New Delivery Ti
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLCWXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993134*
     C                     SETON                     3332  *
     C                     END
     C                     END                             *FI
      * Setup message data for message
     C                     Z-ADD#DBONW    ZA0003           Buy Order New U
     C                     Z-ADD#DJ7NB    ZA0004           Buy Order Load
      * Convert Kill Date Usr to display format
      * Convert date
     C           1000000   ADD  #DCGDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0005
      * Send message 'Buy Order/Load Created'
     C                     MOVEL'PRK1107' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
      * Request new transaction
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBVLSC    BEGSR
      *================================================================
      * Validate screen input
      *================================================================
      * Validate Kill Date Usr
      * External date
     C                     Z-ADDVDCGDT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
     C                     Z-ADDXDINDT    #DCGDT
      * Validate Date To   USR
      * External date
     C                     Z-ADDVDB4DT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDXDINDT    #DB4DT
      * Validate Time USR and convert to internal.
      * Validate Status 1
     C                     MOVEL*BLANK    W0RTN
      * Name search required?
     C           '#DP4ST'  IFEQ YPMTFD
      * Status 1
     C                     MOVEL#DP4ST    W0INVL 25
      * Set current value in drop down list.
     C                     MOVEL*ZEROS    ZHP4ST
     C                     SELEC
     C           W0INVL    WHEQ 'N'                        N
     C                     Z-ADD1         ZHP4ST
     C           W0INVL    WHEQ 'Y'                        Y
     C                     Z-ADD2         ZHP4ST
     C                     ENDSL
     C                     EXFMTZGP4ST
      * Set selected value from drop down list.
     C                     MOVEL*BLANKS   W0INVL
     C                     SELEC
     C           ZHP4ST    WHEQ 1
     C                     MOVEL'N'       W0INVL           N
     C           ZHP4ST    WHEQ 2
     C                     MOVEL'Y'       W0INVL           Y
     C                     ENDSL
     C                     SETOF                     90    *
     C                     MOVELW0INVL    #DP4ST
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate fields
      * new kill date must be within 2 days of original.
      * 02/20/2007 SLM - Exclude Sundays for all companies
      * Prior there were no excluding.
      * LCL.Days USR = DTL.Kill Date Usr - DTL.BOL Kill Date *DAYS
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111110' XDCDW   7
     C                     EXSR XDOWS
     C           #1CQDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C           #DCGDT    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
      * Negative duration, when date1<date2
     C           XDAY1     IFGE XDAY2
     C                     Z-ADDXDURR     YL0005
     C                     ELSE
     C           XDURR     MULT -1        YL0005
     C                     END
      * CASE:
      *  - c1ORc2
      *   |- c1    : LCL.Days USR is GT 2
      *   |- c2    : LCL.Days USR is LT -2
      *   '-
     C           YL0005    IFGT 2                          *IF
     C           YL0005    ORLT -2                         *OR
      * Setup message data for message
      * Convert Kill Date Usr to display format
      * Convert date
     C           1000000   ADD  #DCGDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0006
      * Send message 'Enter a kill within 2 dys'
     C                     MOVEL'PRK1087' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     END                             *FI
      * CASE: DTL.BOL Kill Date EQ DTL.Kill Date Usr
     C           #1CQDT    IFEQ #DCGDT                     *IF
      * Setup message data for message
      * Convert Kill Date Usr to display format
      * Convert date
     C           1000000   ADD  #DCGDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0007
      * Send message 'Enter a diff kill date'
     C                     MOVEL'PRK1086' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     END                             *FI
      * Get last BOL for producer kill date
     C                     Z-ADD*ZERO     #DBONW           Buy Order New U
     C                     Z-ADD*ZERO     #DJ7NB           Buy Order Load
      * Rtv Last BOL f/prd,kl RT - Buy Order Load  * 
     C                     EXSR SGRVGN
      * Maybe header exists without any loads yet.
      * CASE: DTL.Buy Order New Usr is EQ Zero
     C           #DBONW    IFEQ *ZERO                      *IF
      * Rtv BOH For Prdcr/Loc RT - Buy Order Header  * 
     C                     EXSR SHRVGN
     C                     END                             *FI
     C                     ADD  1         #DJ7NB           Buy Order Load
     C                     END
      * Bypass ref file checks if error already detected
     C   99                GOTO DBEXIT
      * Select existing record
     C                     EXSR VACKRL
      * Check reference to Buy Order Header
     C                     EXSR VBCKRL
      * Check reference to Trucker
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Producer Location
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Kill Date Usr required
     C           #DCGDT    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Date To   USR required
     C           #DB4DT    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Time USR required
     C           #DADTH    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9933  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Status 1 required
     C           #DP4ST    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9934  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DHPMCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Update screen time
     C                     TIME           ##TME
      * Enable PUTOVR
     C                     SETON                         86*
      * Refresh screen
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#RCDDTL1
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         MALDSC    BEGSR
      *================================================================
      * Load screen from passed parameters
      *================================================================
     C                     Z-ADD*ZERO     #1ACTH           BOL Pln Delv En
     C                     Z-ADD*ZERO     #1BPNB           BOL Pln Head De
     C                     Z-ADD*ZERO     #1CSNB           BOL Shipped Wgt
     C                     MOVEL*BLANK    #1CMST           BOL Freight UOM
     C                     Z-ADD*ZERO     #1AGPR           BOL Freight Uni
     C                     Z-ADD*ZERO     #1ATVA           BOL Freight Amt
     C                     MOVEL*BLANK    #1I1ST           BOL Freight All
     C                     Z-ADD*ZERO     #1DHNB           BOL Head Receiv
     C                     Z-ADD*ZERO     #1DINB           BOL Live Wgt Re
     C                     MOVEL*BLANK    #1CNST           BOL Trucker Pay
     C                     Z-ADD*ZERO     #1GINB           BOL Trucker Che
     C                     Z-ADD*ZERO     #1BZDT           BOL Trucker Che
     C                     Z-ADD*ZERO     #1LSNB           BOL AP Voucher
     C                     MOVEL*BLANK    #1F3TX           BOL Trailer
     C                     MOVEL*BLANK    #1O8ST           BOL Freight Exp
     C                     MOVEL*BLANK    #1O9ST           BOL Scheduled K
     C                     MOVEL*BLANK    #1PAST           BOL Truck Scale
     C                     Z-ADD*ZERO     #1LDSH           BOL Shipped Hea
     C                     MOVEL*BLANK    #1PBST           Reported to USD
     C                     MOVEL*BLANK    #1PCST           BOL MPR Prior D
     C                     MOVEL*BLANK    #1PDST           BOL Violated Au
     C                     MOVEL*BLANK    #1UWST           BOL Status 5
     C                     MOVEL*BLANK    #1UXST           BOL Status 6
     C                     MOVEL*BLANK    #1UYST           BOL Status 7
     C                     Z-ADD*ZERO     #DBONW           Buy Order New U
     C                     Z-ADD*ZERO     #DJ7NB           Buy Order Load
     C                     Z-ADD*ZERO     #1KEOR           BOL Head LFT
     C                     Z-ADD*ZERO     #1IOEW           BOL Head EUT/KO
     C                     Z-ADD*ZERO     #1KJIO           BOL Auth Gate E
     C                     Z-ADD*ZERO     #1IOJR           BOL Head Receiv
     C                     Z-ADD*ZERO     #1EIRR           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1ITMF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1ODJE           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1RJIF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1OEJF           BOL Unused Wgt
     C                     Z-ADD*ZERO     #1D0DT           BOL Auth Gate E
     C                     Z-ADD*ZERO     #1D1DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D2DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D3DT           BOL Unused Date
     C                     Z-ADD*ZERO     #1D4DT           BOL Unused Date
     C                     MOVEL*BLANK    #1BNCD           TRK Trucker Cod
     C                     MOVEL*BLANK    #1AAVN           RS User Changed
     C                     Z-ADD*ZERO     #1AADT           RS Date Changed
     C                     Z-ADD*ZERO     #1AMTM           RS Time Changed
     C                     MOVEL*BLANK    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1AHVN           RS Job
     C                     MOVEL*BLANK    #1AGVN           RS Program
     C                     MOVEL*BLANK    #1ABVN           RS User Added
     C                     Z-ADD*ZERO     #1ABDT           RS Date Added
     C                     Z-ADD*ZERO     #1ABTM           RS Time Added
     C                     Z-ADDP1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADDP1BNNB    #1BNNB           BOH Buy Order N
     C                     MOVELP1ABCD    #1ABCD           PD Producer Cod
     C                     Z-ADDP1BONB    #1BONB           BOL Load Number
     C                     MOVELP1AECD    #1AECD           PL Location Cod
     C                     Z-ADDP1CQDT    #1CQDT           BOL Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V1CQDT
     C                     Z-ADDP1AUDT    #1AUDT           BOL Pln Delv Da
      * Clear external version also
     C                     Z-ADD*ZERO     V1AUDT
     C                     Z-ADDP1ABTH    #1ABTH           BOL Pln Delv St
     C                     Z-ADDP1JKRU    #1JKRU           BOL HPS Movemen
     C                     Z-ADD*ZERO     #DCGDT           Kill Date Usr
      * Clear external version also
     C                     Z-ADD*ZERO     VDCGDT
     C                     Z-ADD*ZERO     #DB4DT           Date To   USR
      * Clear external version also
     C                     Z-ADD*ZERO     VDB4DT
     C                     Z-ADD*ZERO     #DADTH           Time USR
     C                     MOVEL*BLANK    #DP4ST           Status 1
      * USER: Load screen
     C                     Z-ADD#1ABTH    #DADTH           Time USR
     C                     Z-ADD#1AUDT    #DB4DT           Date To   USR
     C                     Z-ADD#1CQDT    #DCGDT           Kill Date Usr
     C                     MOVEL'Y'       #DP4ST           Status 1
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert fields into external form
      *================================================================
      * Convert BOL Kill Date to display format
      * Convert date
     C           1000000   ADD  #1CQDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1CQDT
      * Convert BOL Pln Delv Date to display format
      * Convert date
     C           1000000   ADD  #1AUDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1AUDT
      * Convert Kill Date Usr to display format
      * Convert date
     C           1000000   ADD  #DCGDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VDCGDT
      * Convert Date To   USR to display format
      * Convert date
     C           1000000   ADD  #DB4DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VDB4DT
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Crt Next BOH      RT - Buy Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAHMNB           BOH Company Num
     C                     KFLD           WABNNB           BOH Buy Order N
      * Setup key
     C                     Z-ADD#1HMNB    WAHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    WABNNB           BOH Buy Order N
      * Establish starting position
     C           KRSSA     CHAIN@AWCPBI              90    *
      * Data record not found
     C   90                MOVEL'PRK0049' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Rtv/Upd Next BO       RT - Company Control HPE  * 
     C                     EXSR SBRVGN
      * Crt Buy Order Header  CR - Buy Order Header  * 
     C                     EXSR SECRRC
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv/Upd Next BO       RT - Company Control HPE  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Modification history
     C                     EXSR UASUBR                     Modification hi
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBHONB           CC Company Numb
      * Setup key
     C                     Z-ADD#1HMNB    WBHONB           CC Company Numb
      * Establish starting position
     C           KRSSB     CHAIN@AZCPCN              90    *
      * Data record not found
     C   90                MOVEL'PRK0055' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDWBBSNB    #DBONW           BOH Buy Order N
      * CASE: DB1.Next Buy Order Number is EQ 9999999
     C           WBBSNB    IFEQ 9999999                    *IF
      * Chg Next BO           CH - Company Control HPE  * 
     C                     EXSR SCCHRC
     C                     ELSE
      * CASE: *OTHERWISE
     C           WBBSNB    ADD  1         WUBSNB           Next Buy Order
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WBK3NB' defaulted for 'Last Tattoo Nbr'.
      * Field '(DB1) WBCDDT' defaulted for 'Current Production Date'.
      * Field '(DB1) WBCEDT' defaulted for 'Next Production Date'.
      * Chg Next BO           CH - Company Control HPE  * 
     C                     EXSR SDCHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Next BO           CH - Company Control HPE  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Current Kill Da
     C                     Z-ADD*ZERO     WN0002  70       Next Kill Date
     C                     Z-ADD*ZERO     WN0003  30       Last Drive Card
     C                     MOVEL*BLANK    WN0004 10        RS User Changed
     C                     Z-ADD*ZERO     WN0005  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0006  60       RS Time Changed
     C                     MOVEL*BLANK    WN0007  1        RS Record Statu
     C                     MOVEL*BLANK    WN0008 10        RS Job
     C                     MOVEL*BLANK    WN0009 10        RS Program
     C                     MOVEL*BLANK    WN0010 10        RS User Added
     C                     Z-ADD*ZERO     WN0011  70       RS Date Added
     C                     Z-ADD*ZERO     WN0012  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @AZCPCM
     C                     Z-ADDWBHONB    WCHONB           CC Company Numb
      *
     C           KLCHSC    KLIST
     C                     KFLD           WCHONB           CC Company Numb
     C           KLCHSC    CHAIN@AZCPCM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAZREL0'MDACP
     C                     MOVEL'@AZCPCM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKAZ1    YARDCS
      * Move non-key fields to @AZCPCM
     C                     Z-ADD10000     WCBSNB           Next Buy Order
     C                     Z-ADDWBK3NB    WCK3NB           Last Tattoo Nbr
     C                     Z-ADDWBCDDT    WCCDDT           Current Product
     C                     Z-ADDWBCEDT    WCCEDT           Next Production
      *
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WCAAVN           RS User Changed
     C                     Z-ADD##JDT     WCAADT           RS Date Changed
     C                     Z-ADD##JTM     WCAMTM           RS Time Changed
     C                     MOVEL##JOB     WCAHVN           RS Job
     C                     MOVEL##PGM     WCAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AZCPCM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKAZREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Chg Next BO           CH - Company Control HPE  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0013  70       Current Kill Da
     C                     Z-ADD*ZERO     WN0014  70       Next Kill Date
     C                     Z-ADD*ZERO     WN0015  30       Last Drive Card
     C                     MOVEL*BLANK    WN0016 10        RS User Changed
     C                     Z-ADD*ZERO     WN0017  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0018  60       RS Time Changed
     C                     MOVEL*BLANK    WN0019  1        RS Record Statu
     C                     MOVEL*BLANK    WN0020 10        RS Job
     C                     MOVEL*BLANK    WN0021 10        RS Program
     C                     MOVEL*BLANK    WN0022 10        RS User Added
     C                     Z-ADD*ZERO     WN0023  70       RS Date Added
     C                     Z-ADD*ZERO     WN0024  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @AZCPCM
     C                     Z-ADDWBHONB    WCHONB           CC Company Numb
      *
     C           KLCHSD    KLIST
     C                     KFLD           WCHONB           CC Company Numb
     C           KLCHSD    CHAIN@AZCPCM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAZREL0'MDACP
     C                     MOVEL'@AZCPCM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKAZ1    YBRDCS
      * Move non-key fields to @AZCPCM
     C                     Z-ADDWUBSNB    WCBSNB           Next Buy Order
     C                     Z-ADDWBK3NB    WCK3NB           Last Tattoo Nbr
     C                     Z-ADDWBCDDT    WCCDDT           Current Product
     C                     Z-ADDWBCEDT    WCCEDT           Next Production
      *
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WCAAVN           RS User Changed
     C                     Z-ADD##JDT     WCAADT           RS Date Changed
     C                     Z-ADD##JTM     WCAMTM           RS Time Changed
     C                     MOVEL##JOB     WCAHVN           RS Job
     C                     MOVEL##PGM     WCAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AZCPCM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKAZREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt Buy Order Header  CR - Buy Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AWCPAZ
     C                     Z-ADDWAHMNB    WDHMNB           BOH Company Num
     C                     Z-ADD#DBONW    WDBNNB           BOH Buy Order N
     C                     Z-ADDWAARDT    WDARDT           BOH Buy Order D
     C                     Z-ADD#DCGDT    WDASDT           BOH Kill Date
     C                     MOVELWAA4ST    WDA4ST           BOH Payment Typ
     C                     MOVELWAA5ST    WDA5ST           BOH Buy Order T
     C                     Z-ADDWAAAPR    WDAAPR           BOH Market Add/
     C                     MOVELWAA6ST    WDA6ST           BOH Status
     C                     MOVELWAA7ST    WDA7ST           BOH Delv Plan P
     C                     MOVELWAB3ST    WDB3ST           BOH Quote Price
     C                     Z-ADDWAALPR    WDALPR           BOH Quoted Base
     C                     MOVELWAETCD    WDETCD           BOH Commodity M
     C                     MOVELWAEUCD    WDEUCD           BOH Commodity P
     C                     MOVELWAJ5TX    WDJ5TX           BOH Market Date
     C                     Z-ADDWAD5DT    WDD5DT           BOH MPR Reporti
     C                     Z-ADDWAD6DT    WDD6DT           BOH Hedge Date
     C                     Z-ADDWAD7DT    WDD7DT           BOH Unused Date
     C                     Z-ADDWAD8DT    WDD8DT           BOH Unused Date
     C                     Z-ADDWAD9DT    WDD9DT           BOH Unused Date
     C                     Z-ADDWAJOEJ    WDJOEJ           BOH Hedge Head
     C                     Z-ADDWAKOFF    WDKOFF           BOH Hedge Refer
     C                     Z-ADDWAKWPE    WDKWPE           BOH Hedge Time
     C                     Z-ADDWAIMBF    WDIMBF           BOH Unused Nbr
     C                     Z-ADDWAOPTR    WDOPTR           BOH Unused Nbr
     C                     Z-ADDWAOEJD    WDOEJD           BOH Unused Nbr
     C                     Z-ADDWAIRMF    WDIRMF           BOH Unused Nbr
     C                     Z-ADDWAJIRM    WDJIRM           BOH Unused Nbr
     C                     Z-ADDWAJRKF    WDJRKF           BOH Unused Nbr
     C                     Z-ADDWAKFIR    WDKFIR           BOH Unused Nbr
     C                     MOVELWAUZST    WDUZST           BOH MPR Reporti
     C                     MOVELWAU0ST    WDU0ST           BOH MPR EST RPT
     C                     MOVELWAU1ST    WDU1ST           BOH MPR Purchas
     C                     MOVELWAU2ST    WDU2ST           BOH Status 4
     C                     MOVELWAU3ST    WDU3ST           BOH Status 5
     C                     Z-ADDWAHXNB    WDHXNB           PPWS Company Nu
     C                     Z-ADDWAGANB    WDGANB           CW Year
     C                     Z-ADDWAGBNB    WDGBNB           CW Week Number
     C                     MOVELWAABCD    WDABCD           PD Producer Cod
     C                     MOVELWAAECD    WDAECD           PL Location Cod
     C                     MOVELWAAKCD    WDAKCD           PC Contract Cod
     C                     MOVELWAALCD    WDALCD           PSC Sub-Contrac
     C                     MOVELWAAGCD    WDAGCD           GN Genetic Code
     C                     MOVELWAAICD    WDAICD           PO Option Code
     C                     MOVELWAAMCD    WDAMCD           CMP Program Cod
     C                     MOVELWAACCD    WDACCD           HB Buyer Code
     C                     MOVELWAAAVN    WDAAVN           RS User Changed
     C                     Z-ADDWAAADT    WDAADT           RS Date Changed
     C                     Z-ADDWAAMTM    WDAMTM           RS Time Changed
     C                     MOVELWAAJST    WDAJST           RS Record Statu
     C                     MOVELWAAHVN    WDAHVN           RS Job
     C                     MOVELWAAGVN    WDAGVN           RS Program
     C                     MOVELWAABVN    WDABVN           RS User Added
     C                     Z-ADDWAABDT    WDABDT           RS Date Added
     C                     Z-ADDWAABTM    WDABTM           RS Time Added
      *
      * USER: Processing before Data update
      * RMC 6/19/19 whd 49122 Chg time to 1:45 per Jerry L at tf
      * RMC 9/23/16 R7307   Chg time as of 10/11/2016  per new MPR Rule:
      *             compile all functions that call this CRTOBJ
      *      9:55:59 changed to 9:30:59             9:56 changed to 9:31
      *      1:55:59 changed to 1:30:59
      * *****************************************************************
      * RMC  Chg time as of 01/10/07:
      *      9:30:59 changed to 9:55:59             9:31 changed to 9:56
      *      1:30:59 changed to 1:55:59
      * *****************************************************************
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WDAJST           RS Record Statu
     C                     MOVEL##USR     WDABVN           RS User Added
     C                     Z-ADD##JDT     WDABDT           RS Date Added
     C                     Z-ADD##JTM     WDABTM           RS Time Added
     C                     MOVEL##PGM     WDAGVN           RS Program
     C                     MOVEL##JOB     WDAHVN           RS Job
      * ** create record boh status as open
     C                     MOVEL'O'       WDA6ST           BOH Status
      * PK0254 -- MPR Reporting Time and Date       RMC 1/19/2001
      *   If Current Time < 9:30:59 am
      *     Reporting Date = Current Date
      *     Reporting Time = 1
      *   If 9:31 am < Current Time < 1:30:59 pm
      *     Reporting Date = Current Date
      *     Reporting Time = 2
      * *** replace with R7307 -- effective 10/11/2016
      *   * Otherwise         (These will not be reported at all.)
      *   * Reporting Date = 0
      *   * Reporting Time = 0
      * *** NEW     with R7307 -- effective 10/11/2016
      *     Reporting Date = Next kill date - skip sat/sun
      *     Reporting Time = 1
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           YL0001    PARM *ZERO     WQ0001  70       *DATE
     C           YL0002    PARM *ZERO     WQ0002  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * CASE: LCL.*TIME is LE 09:30:59
     C           YL0002    IFLE 093059                     *IF
     C                     Z-ADDYL0001    WDD5DT           BOH MPR Reporti
     C                     MOVEL'1'       WDUZST           BOH MPR Reporti
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: LCL.*TIME is LE 13:45:59
     C           YL0002    IFLE 134559                     *IF
      * 6/19/19 RMC time was LE 13:30:59
     C                     Z-ADDYL0001    WDD5DT           BOH MPR Reporti
     C                     MOVEL'2'       WDUZST           BOH MPR Reporti
     C                     ELSE
      * CASE: *OTHERWISE
      * R7307 -- GT 1:30 get reported at next day's 1st submission at 9:3
      * RTV Next WkDy,N=Holidy XF - STR Order Management Sys  * 
     C                     CALL 'PBYUXFR'              90  RTV Next WkDy,N
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WDHMNB    WQ0003  30       BOH Company Num
     C                     PARM YL0001    WQ0004  70       Date Beg USR
     C           YL0003    PARM *ZERO     WQ0005  70       Date To   USR
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBYUXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0003    WDD5DT           BOH MPR Reporti
     C                     MOVEL'1'       WDUZST           BOH MPR Reporti
     C                     END                             *FI
     C                     END                             *FI
     C           KLCRSE    KLIST
     C                     KFLD           WDHMNB           BOH Company Num
     C                     KFLD           WDBNNB           BOH Buy Order N
      * Check for duplicate primary key
     C           KLCRSE    SETLL@AWCPAZ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0050' W0RTN   7
      * Send message 'Buy Order Header       EX'
     C                     MOVEL'PRK0050' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@AWCPAZ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv Next Seq Num      RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEHONB    WQSF01           CC Company Numb
     C           *LIKE     DEFN WEE0DT    WQSF02           DSH Kill Date
     C           *LIKE     DEFN WEE6DT    WQSF03           DSD Delivery Da
     C           *LIKE     DEFN WEAGTH    WQSF04           DSD Delivery Ti
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           CC Company Numb
     C                     KFLD           WQSF02           DSH Kill Date
     C                     KFLD           WQSF03           DSD Delivery Da
     C                     KFLD           WQSF04           DSD Delivery Ti
      * Setup key
     C                     Z-ADD#1HMNB    WQSF01           CC Company Numb
     C                     Z-ADD#DCGDT    WQSF02           DSH Kill Date
     C                     Z-ADD#DB4DT    WQSF03           DSD Delivery Da
     C                     Z-ADD#DADTH    WQSF04           DSD Delivery Ti
      * Establish starting position
     C           KRSSF     SETLL@AECPJT                    *
     C           KRSSF     READE@AECPJT                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1028' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0004           DSD Delivery Ti
     C                     Z-ADD1         YL0004           DSD Delivery Ti
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWEHZA1    YL0004           DSD Delivery Ti
     C           WEHZA1    ADD  1         YL0004           DSD Delivery Ti
     C                     GOTO SFEXIT                     *QUIT
     C           KRSSF     READE@AECPJT                  90*
     C                     ENDDO
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Last BOL f/prd,kl RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WFHMNB    WQSG01           BOH Company Num
     C           *LIKE     DEFN WFABCD    WQSG02           PD Producer Cod
     C           *LIKE     DEFN WFAECD    WQSG03           PL Location Cod
     C           *LIKE     DEFN WFCQDT    WQSG04           BOL Kill Date
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           BOH Company Num
     C                     KFLD           WQSG02           PD Producer Cod
     C                     KFLD           WQSG03           PL Location Cod
     C                     KFLD           WQSG04           BOL Kill Date
      * Setup key
     C                     Z-ADD#1HMNB    WQSG01           BOH Company Num
     C                     MOVELP1ABCD    WQSG02           PD Producer Cod
     C                     MOVELP1AECD    WQSG03           PL Location Cod
     C                     Z-ADD#DCGDT    WQSG04           BOL Kill Date
      * Establish starting position
     C           KRSSG     SETLL@AXCPJ2                    *
     C           KRSSG     READE@AXCPJ2                  90*
      * Data record not found
     C   90                MOVEL'PRK0051' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     Z-ADDWFBNNB    #DBONW           BOH Buy Order N
     C                     Z-ADDWFBONB    #DJ7NB           BOL Load Number
     C           KRSSG     READE@AXCPJ2                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Rtv BOH For Prdcr/Loc RT - Buy Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     #DBONW           BOH Buy Order N
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGHMNB    WQSH01           BOH Company Num
     C           *LIKE     DEFN WGABCD    WQSH02           PD Producer Cod
     C           *LIKE     DEFN WGAECD    WQSH03           PL Location Cod
     C           *LIKE     DEFN WGASDT    WQSH04           BOH Kill Date
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           BOH Company Num
     C                     KFLD           WQSH02           PD Producer Cod
     C                     KFLD           WQSH03           PL Location Cod
     C                     KFLD           WQSH04           BOH Kill Date
      * Setup key
     C                     Z-ADD#1HMNB    WQSH01           BOH Company Num
     C                     MOVEL#1ABCD    WQSH02           PD Producer Cod
     C                     MOVEL#1AECD    WQSH03           PL Location Cod
     C                     Z-ADD#DCGDT    WQSH04           BOH Kill Date
      * Establish starting position
     C           KRSSH     SETLL@AWCPNB                    *
     C           KRSSH     READE@AWCPNB                  90*
      * Data record not found
     C   90                MOVEL'PRK0049' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWGBNNB    #DBONW           BOH Buy Order N
     C                     GOTO SHEXIT                     *QUIT
     C           KRSSH     READE@AWCPNB                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modification history
      *================================================================
      *  7/02/2021 JBB WHD80995 - Increase rollover from 99999 to 9999999
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Modification history
      *================================================================
      *  7/02/2021 JBB WHD80995 - Increase rollover values for BO#
      *                           Recompile only after changing the
      *                           RTVOBJ-Rtv Crt Next BOH      RT to
      *                           rollover when the BO# reaches 999999,
      *                           instead of 99999.
      * RMC 5/26/04 Create the BOH if not found instead of issuing an err
      * 11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Select existing record
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#1HMNB'
     C           YPMTFD    OREQ '#1BNNB'
     C           YPMTFD    OREQ '#1BONB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1HMNB' defaulted for 'BOH Company Number'.
      * Field '(DTL) #1BNNB' defaulted for 'BOH Buy Order Number'.
      * Field '(DTL) #1BONB' defaulted for 'BOL Load Number'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1ABCD' defaulted for 'PD Producer Code'.
      * Field '(DTL) #1AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PKQJSRR'              90  Sel Producer BO
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HMNB    WQ0019  30       BOH Company Num
     C           #1BNNB    PARM #1BNNB    WQ0020  70       BOH Buy Order N
     C           #1BONB    PARM #1BONB    WQ0021  50       BOL Load Number
     C                     PARM #1ABCD    WQ0022  6        PD Producer Cod
     C                     PARM #1AECD    WQ0023  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKQJSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1HMNB    IFNE *ZERO                      BOH Company Num
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BONB    IFNE *ZERO                      BOL Load Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Buy Order Header
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C           YPMTFD    IFEQ '#1HMNB'
     C           YPMTFD    OREQ '#1BNNB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1HMNB' defaulted for 'BOH Company Number'.
      * Field '(DTL) #1BNNB' defaulted for 'BOH Buy Order Number'.
     C                     CALL 'PKLTSRR'              90  Tst Select kill
     C                     PARM *BLANK    W0RTN   7
     C           #1HMNB    PARM #1HMNB    WQ0024  30       BOH Company Num
     C           #1BNNB    PARM #1BNNB    WQ0025  70       BOH Buy Order N
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKLTSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1HMNB    IFNE *ZERO                      BOH Company Num
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1HMNB    IFEQ *ZERO                      BOH Company Num
     C           #1BNNB    ANDEQ*ZERO                      BOH Buy Order N
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBWA    KLIST
     C                     KFLD           WAHMNB           BOH Company Num
     C                     KFLD           WABNNB           BOH Buy Order N
      * Setup key
     C                     Z-ADD#1HMNB    WAHMNB
     C                     Z-ADD#1BNNB    WABNNB
     C           KLVBWA    CHAIN@AWCPBI              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Trucker
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BNCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        TRK Trucker Cod
     C           YPMTFD    OREQ '#1BNCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1BNCD' defaulted for 'TRK Trucker Code'.
     C                     CALL 'PKDLSRR'              90  Sel Trucker
     C                     PARM *BLANK    W0RTN   7
     C           #1BNCD    PARM #1BNCD    WQ0026  3        TRK Trucker Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKDLSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1BNCD    IFNE *BLANK                     TRK Trucker Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BNCD    IFEQ *BLANK                     TRK Trucker Cod
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCWH    KLIST
     C                     KFLD           WHBNCD           TRK Trucker Cod
      * Setup key
     C                     MOVEL#1BNCD    WHBNCD
     C           KLVCWH    CHAIN@BAREDS              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Trucker                NF'
     C                     MOVEL'PRK0079' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0079' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Producer Location
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1ABCD    WK1X01  1
     C                     MOVEL#1AECD    WK1X02  1
     C           WK1X01    IFEQ '?'                        PD Producer Cod
     C           YPMTFD    OREQ '#1ABCD'
     C           WK1X02    OREQ '?'                        PL Location Cod
     C           YPMTFD    OREQ '#1AECD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1ABCD' defaulted for 'PD Producer Code'.
      * Field '(DTL) #1AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PWF5SRR'              90  Sel Prod Loc by
     C                     PARM *BLANK    W0RTN   7
     C           #1ABCD    PARM #1ABCD    WQ0027  6        PD Producer Cod
     C           #1AECD    PARM #1AECD    WQ0028  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWF5SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1ABCD    IFNE *BLANK                     PD Producer Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1AECD    IFNE *BLANK                     PL Location Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ABCD    IFEQ *BLANK                     PD Producer Cod
     C           #1AECD    ANDEQ*BLANK                     PL Location Cod
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDWI    KLIST
     C                     KFLD           WIABCD           PD Producer Cod
     C                     KFLD           WIAECD           PL Location Cod
      * Setup key
     C                     MOVEL#1ABCD    WIABCD
     C                     MOVEL#1AECD    WIAECD
     C           KLVDWI    CHAIN@AFREAR              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Producer Location      NF'
     C                     MOVEL'PRK0015' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0015' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDCK2     BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
     C                     Z-ADD*ZERO     XDINDT
      * If external date is zero, do not check
     C           XDEXDT    CABEQ*ZERO     XDCK2E
      *................................................................
      * Map external to internal according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDEX02    XDINDD           DD
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDEX02    XDINMM           MM
     C                     Z-ADDXDEX03    XDINDD           DD
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDEX02    XDINYY           YY
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINDD           DD
     C                     END
     C                     END
      * If YY prior to the 'cut-off' year treat as 20YY.
     C           XDINYY    IFLT XOFFYY
     C                     ADD  100       XDINYY
     C                     END
     C           YPMTFD    CABNE*BLANK    XDCK2E
      *................................................................
      * Check months in range 1 to 12
     C           XDINMM    CABLT1         XDCK2M
     C           XDINMM    CABGT12        XDCK2M
      *................................................................
      * Check days in range 1 to maximum for month
     C           XDINDD    CABLT1         XDCK2M
     C           XDINDD    CABGT@XD,XDINMMXDCK2M
      *................................................................
      * Special case: leap year
     C           XDINMM    IFEQ 2
     C           XDINYY    IFNE *ZERO
     C           XDINYY    ANDNE200
     C           XDINYY    DIV  4         XDWK1   80
     C                     MVR            XDWK1
     C                     ELSE
     C                     Z-ADD1         XDWK1
     C                     END
      * Year is not leap
     C           XDWK1     IFNE *ZERO
     C           XDINDD    CABGT28        XDCK2M
     C                     END
     C                     END
     C                     GOTO XDCK2E
      *................................................................
      * Send error message
     C           XDCK2M    TAG
      * Send message '*Invalid date'
     C                     MOVEL'Y2U0006' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0006' W0RTN
      * Disable time portion if timestamp is validated
     C                     Z-ADD*ZERO     XTTIM
      *================================================================
     CSR         XDCK2E    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C           ZHCSRW    IFEQ 018
     C           ZHCSCL    ANDEQ034
     C           @#DFMT    ANDEQ'#RCDDTL1'
     C                     MOVEL'#DP4ST'  YPMTFD           Status 1
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P2J8NB           Oms Warehouse C
     C                     Z-ADD*ZERO     P2HONB           CC Company Numb
     C                     MOVEL*BLANK    P2C7CD           Oms Application
     C                     MOVEL*BLANK    P2C8CD           Oms SalesPerson
     C                     MOVEL*BLANK    P2G8ST           Oms Allow Multi
     C                     MOVEL*BLANK    P2G9ST           Oms Default Pri
     C                     MOVEL*BLANK    P2EUTX           Oms Name
     C                     MOVEL*BLANK    P2EVTX           Oms System Valu
     C                     MOVEL*BLANK    P2HAST           Oms Access Deni
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WAARDT           BOH Buy Order D
     C                     Z-ADD*ZERO     WAASDT           BOH Kill Date
     C                     Z-ADD*ZERO     WAAAPR           BOH Market Add/
     C                     Z-ADD*ZERO     WAALPR           BOH Quoted Base
     C                     Z-ADD*ZERO     WAD5DT           BOH MPR Reporti
     C                     Z-ADD*ZERO     WAD6DT           BOH Hedge Date
     C                     Z-ADD*ZERO     WAD7DT           BOH Unused Date
     C                     Z-ADD*ZERO     WAD8DT           BOH Unused Date
     C                     Z-ADD*ZERO     WAD9DT           BOH Unused Date
     C                     Z-ADD*ZERO     WAJOEJ           BOH Hedge Head
     C                     Z-ADD*ZERO     WAKOFF           BOH Hedge Refer
     C                     Z-ADD*ZERO     WAKWPE           BOH Hedge Time
     C                     Z-ADD*ZERO     WAIMBF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAOPTR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAOEJD           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAIRMF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAJIRM           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAJRKF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAKFIR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WAHXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     WAGANB           CW Year
     C                     Z-ADD*ZERO     WAGBNB           CW Week Number
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHONB           CC Company Numb
     C                     Z-ADD*ZERO     WBBSNB           Next Buy Order
     C                     Z-ADD*ZERO     WBB1DT           Current Kill Da
     C                     Z-ADD*ZERO     WBB2DT           Next Kill Date
     C                     Z-ADD*ZERO     WBH4NB           Last Drive Card
     C                     Z-ADD*ZERO     WBK3NB           Last Tattoo Nbr
     C                     Z-ADD*ZERO     WBCDDT           Current Product
     C                     Z-ADD*ZERO     WBCEDT           Next Production
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Define work field Next Buy Order Number
     C                     Z-ADD*ZERO     WUBSNB  70
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEHONB           CC Company Numb
     C                     Z-ADD*ZERO     WEE0DT           DSH Kill Date
     C                     Z-ADD*ZERO     WEE6DT           DSD Delivery Da
     C                     Z-ADD*ZERO     WEAGTH           DSD Delivery Ti
     C                     Z-ADD*ZERO     WEHZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     WEH0A1           DSD Scheduled H
     C                     Z-ADD*ZERO     WEH1A1           DSD Farm Site C
     C                     Z-ADD*ZERO     WEIOA1           DSD Unused Head
     C                     Z-ADD*ZERO     WEH2A1           DSD Scheduled D
     C                     Z-ADD*ZERO     WEIJA1           DSD Scheduled K
     C                     Z-ADD*ZERO     WEH3A1           DSD Movement Nu
     C                     Z-ADD*ZERO     WEFRDT           DSD Sched Route
     C                     Z-ADD*ZERO     WEBOTH           DSD Sched Route
     C                     Z-ADD*ZERO     WEE7DT           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WEAHTH           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WEE8DT           DSD Sch Start L
     C                     Z-ADD*ZERO     WEAITH           DSD Sch Start L
     C                     Z-ADD*ZERO     WEFZDT           DSD Unused Date
     C                     Z-ADD*ZERO     WEB1TH           DSD Unused Time
     C                     Z-ADD*ZERO     WEHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WEBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WEBONB           BOL Load Number
     C                     Z-ADD*ZERO     WEY0A1           DSD PRD Srv Bat
     C                     Z-ADD*ZERO     WEY1A1           DSD PRD Srv Sch
     C                     Z-ADD*ZERO     WEAADT           RS Date Changed
     C                     Z-ADD*ZERO     WEAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WEABDT           RS Date Added
     C                     Z-ADD*ZERO     WEABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WFBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WFBONB           BOL Load Number
     C                     Z-ADD*ZERO     WFCQDT           BOL Kill Date
     C                     Z-ADD*ZERO     WFABTH           BOL Pln Delv St
     C                     Z-ADD*ZERO     WFACTH           BOL Pln Delv En
     C                     Z-ADD*ZERO     WFBPNB           BOL Pln Head De
     C                     Z-ADD*ZERO     WFCSNB           BOL Shipped Wgt
     C                     Z-ADD*ZERO     WFAUDT           BOL Pln Delv Da
     C                     Z-ADD*ZERO     WFAGPR           BOL Freight Uni
     C                     Z-ADD*ZERO     WFATVA           BOL Freight Amt
     C                     Z-ADD*ZERO     WFDHNB           BOL Head Receiv
     C                     Z-ADD*ZERO     WFDINB           BOL Live Wgt Re
     C                     Z-ADD*ZERO     WFGINB           BOL Trucker Che
     C                     Z-ADD*ZERO     WFBZDT           BOL Trucker Che
     C                     Z-ADD*ZERO     WFLSNB           BOL AP Voucher
     C                     Z-ADD*ZERO     WFLDSH           BOL Shipped Hea
     C                     Z-ADD*ZERO     WFJKRU           BOL HPS Movemen
     C                     Z-ADD*ZERO     WFKEOR           BOL Head LFT
     C                     Z-ADD*ZERO     WFIOEW           BOL Head EUT/KO
     C                     Z-ADD*ZERO     WFKJIO           BOL Auth Gate E
     C                     Z-ADD*ZERO     WFIOJR           BOL Head Receiv
     C                     Z-ADD*ZERO     WFEIRR           BOL Unused Wgt
     C                     Z-ADD*ZERO     WFITMF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WFODJE           BOL Unused Wgt
     C                     Z-ADD*ZERO     WFRJIF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WFOEJF           BOL Unused Wgt
     C                     Z-ADD*ZERO     WFD0DT           BOL Auth Gate E
     C                     Z-ADD*ZERO     WFD1DT           BOL Unused Date
     C                     Z-ADD*ZERO     WFD2DT           BOL Unused Date
     C                     Z-ADD*ZERO     WFD3DT           BOL Unused Date
     C                     Z-ADD*ZERO     WFD4DT           BOL Unused Date
     C                     Z-ADD*ZERO     WFAADT           RS Date Changed
     C                     Z-ADD*ZERO     WFAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WFABDT           RS Date Added
     C                     Z-ADD*ZERO     WFABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WHGMNB           TRK VND Address
     C                     Z-ADD*ZERO     WHAADT           RS Date Changed
     C                     Z-ADD*ZERO     WHAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WHABDT           RS Date Added
     C                     Z-ADD*ZERO     WHABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WIGLNB           Pl VND Address
     C                     Z-ADD*ZERO     WIASNB           PL Miles/Unused
     C                     Z-ADD*ZERO     WIHWNB           PL Primary Comp
     C                     Z-ADD*ZERO     WIAADT           RS Date Changed
     C                     Z-ADD*ZERO     WIAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WIABDT           RS Date Added
     C                     Z-ADD*ZERO     WIABTM           RS Time Added
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Define local work field *DATE
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field *TIME
     C                     Z-ADD*ZERO     YL0002  60
      * Define local work field MPR Reporting Date
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field New Delivery Time Seq USR
     C                     Z-ADD*ZERO     YL0004  30
      * Define local work field Days USR
     C                     Z-ADD*ZERO     YL0005  50
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0006  1
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * Retrieve the 'cut-off' year YY: 19YY-1999,2000-20(YY-1).
     C           *NAMVAR   DEFN Y2CTOFF   XOFF
     C                     IN   XOFF
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Modification history
     C                     EXSR UBSUBR                     Modification hi
      * Val Application/User  IF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           P2J8NB    PARM *BLANK    WQ0029  3        Oms Warehouse C
     C           P2HONB    PARM *ZERO     WQ0030  30       CC Company Numb
     C                     PARM 'HPE'     WQ0031  6        Oms Application
     C           P2C8CD    PARM *BLANK    WQ0032  3        Oms SalesPerson
     C           P2G8ST    PARM *BLANK    WQ0033  1        Oms Allow Multi
     C           P2G9ST    PARM *BLANK    WQ0034 10        Oms Default Pri
     C           P2EUTX    PARM *BLANK    WQ0035 30        Oms Name
     C           P2EVTX    PARM *BLANK    WQ0036 40        Oms System Valu
     C           P2HAST    PARM *BLANK    WQ0037  1        Oms Access Deni
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P2HAST    IFEQ 'Y'                        *IF
      * Send message 'Access Denied for User'
     C                     MOVEL'PRK0298' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP2EVTX    ##CMP
     C                     END                             *FI
      * Load screen
     C                     EXSR MALDSC
      *================================================================
     CSR         ZZEXIT    ENDSR
** @XD
312931303130313130313031
