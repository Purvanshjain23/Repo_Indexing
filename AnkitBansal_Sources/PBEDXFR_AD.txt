// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBEDXFR
// ?Date: 14.08.2025 Time: 03:47:37
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?E2878 RMC 11/8/13 added parm.report listing to get right email dist list
//?  depending on the time its run from the scheduler
//?7/17/12 Print/email late delivery report from job sched
// LCL.USR To Date = JOB.*Job date
LCL.USR_To_Date = JOB.*Job_date;

//?Get Saturday date -- then weekly date range
CASE;

// IF LCL.USR To Date is Entered
IF LCL.USR_To_Date <> *ZERO;

EXECUTE FUNCTION(RTV Day of Week No.   RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1658821;
PARAMETER(PAR.Company_Number);
PARAMETER(LCL.USR_To_Date);
PARAMETER(PAR.Day_of_Week);
{
 //?USER: Process Data record

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PAR.Day of Week is Saturday
IF PAR.Day_of_Week = '7';

// WRK.Saturday              USR = LCL.USR To Date
WRK.Saturday_USR = LCL.USR_To_Date;

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV Next Saturday      RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1674395;
PARAMETER(PAR.Company_Number);
PARAMETER(LCL.USR_To_Date);
PARAMETER(WRK.Saturday_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Day of Week is Saturday
 IF DB1.Day_of_Week = '7';

 // PAR.Scheduled Ship Date = DB1.Post to G/L Date
 PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


ENDIF;

// LCL.USR From Date = WRK.Saturday              USR + CON.-6 *DAYS
LCL.USR_From_Date = DATEINCR(WRK.Saturday_USR '-6' 'DY' 1111111 'NONE' 'N' 1);

// LCL.USR Date - ATR = WRK.Saturday              USR
LCL.USR_Date_ATR = WRK.Saturday_USR;

// PAR.From Date Pass        USR = LCL.USR From Date
PAR.From_Date_Pass_USR = LCL.USR_From_Date;

// PAR.Thru Date Pass        USR = LCL.USR Date - ATR
PAR.Thru_Date_Pass_USR = LCL.USR_Date_ATR;

ENDIF;

// LCL.Load Type = CND.Regular
LCL.Load_Type = 'R';

// PAR.Company Number Pass   USR = PAR.Company Number
PAR.Company_Number_Pass_USR = PAR.Company_Number;

// PAR.PRT Printer Device = CND.No print printer
PAR.PRT_Printer_Device = 'QPRINT2';

// PAR.PRT Hold Output Sts = CND.*YES
PAR.PRT_Hold_Output_Sts = *YES;

// PAR.PRT Save Output Sts = CND.*YES
PAR.PRT_Save_Output_Sts = *YES;

// PAR.PRT Night Queue Run Sts = CND.no
PAR.PRT_Night_Queue_Run_Sts = 'N';

// LCL.System Value Numeric = CON.1
LCL.System_Value_Numeric = 1;

//?** Call PBEEUPC which call PPY4UPC which calls PPY4PFR
// WRK.Program name USR = CON.PPY4UPC
WRK.Program_name_USR = 'PPY4UPC';

// LCL.Late Deliv Report Slt USR = CND.Requested Delivery Date
LCL.Late_Deliv_Report_Slt_USR = 2;

//?Original PRKLDELVGU - run at 10:30am
CASE;

// IF PAR.Report Listing        USR is Scheduling
IF PAR.Report_Listing_USR = '1';

// Call program Prt Late Deliv-f/Schd CL.
CALL PROGRAM(Prt Late Deliv-f/Schd CL) ('PBEEUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(WRK.Program_name_USR);
PARAMETER('OMS');
PARAMETER(*BLANK);
PARAMETER('Late Delivery Report');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Company_Number_Pass_USR);
PARAMETER(LCL.Date_1_PASS_USR);
PARAMETER(PAR.From_Date_Pass_USR);
PARAMETER(PAR.Thru_Date_Pass_USR);
PARAMETER(LCL.Order_Number_1_PASS_USR);
PARAMETER(LCL.System_Value_Numeric);
PARAMETER(*BLANK);
PARAMETER(*ZERO);
PARAMETER('N');
PARAMETER(*BLANK);
PARAMETER(LCL.Load_Type);
PARAMETER(*BLANK);
PARAMETER(LCL.Late_Deliv_Report_Slt_USR);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);

ENDIF;

//?New PRKLDELVJ2 - run at 2pm for jeff ruby
CASE;

// IF PAR.Report Listing        USR is QA
IF PAR.Report_Listing_USR = '2';

// Call program Zzz Late Deliv-f/Sch2 CL.
CALL PROGRAM(Zzz Late Deliv-f/Sch2 CL) ('PBKXUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(WRK.Program_name_USR);
PARAMETER('OMS');
PARAMETER(*BLANK);
PARAMETER('Late Delivery Report');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Company_Number_Pass_USR);
PARAMETER(LCL.Date_1_PASS_USR);
PARAMETER(PAR.From_Date_Pass_USR);
PARAMETER(PAR.Thru_Date_Pass_USR);
PARAMETER(LCL.Order_Number_1_PASS_USR);
PARAMETER(LCL.System_Value_Numeric);
PARAMETER(*BLANK);
PARAMETER(*ZERO);
PARAMETER('N');
PARAMETER(*BLANK);
PARAMETER(LCL.Load_Type);
PARAMETER(*BLANK);
PARAMETER(LCL.Late_Deliv_Report_Slt_USR);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);

ENDIF;

//?New PRKLDELVJ3 - run at 12midnight  for jeff ruby
CASE;

// IF PAR.Report Listing        USR is Sales
IF PAR.Report_Listing_USR = '3';

// Call program Zzz Late Deliv-f/Sch2 CL.
CALL PROGRAM(Zzz Late Deliv-f/Sch2 CL) ('PBKXUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(WRK.Program_name_USR);
PARAMETER('OMS');
PARAMETER(*BLANK);
PARAMETER('Late Delivery Report');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Company_Number_Pass_USR);
PARAMETER(LCL.Date_1_PASS_USR);
PARAMETER(PAR.From_Date_Pass_USR);
PARAMETER(PAR.Thru_Date_Pass_USR);
PARAMETER(LCL.Order_Number_1_PASS_USR);
PARAMETER(LCL.System_Value_Numeric);
PARAMETER(*BLANK);
PARAMETER(*ZERO);
PARAMETER('N');
PARAMETER(*BLANK);
PARAMETER(LCL.Load_Type);
PARAMETER(*BLANK);
PARAMETER(LCL.Late_Deliv_Report_Slt_USR);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);

ENDIF;

