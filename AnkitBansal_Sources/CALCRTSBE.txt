/******************************************************************  */
/*                                                                   */
/* YECALUPD - CREATE CALENDAR FOR NEW SBE COMPANIES 375/376 FOR 2022 */
/*                                                                   */
/* The CLP CREATES CAAFREP and CAATREP only                          */
/*********************************************************************/

             PGM        PARM(&NEWYR)

             DCL        VAR(&NEWYR) TYPE(*DEC) LEN(4 0)
             DCL        VAR(&NEWYRC) TYPE(*CHAR) LEN(4)
             DCL        VAR(&ERR)    TYPE(*CHAR) LEN(1) VALUE('N')

             ADDLIBLE   LIB(BLGFLIB)

/*  copy company 361 records that were created in HPBFLIB for the  */
/*  year passed in.                                                */

             CHGVAR     VAR(&NEWYRC) VALUE(&NEWYR)

             CPYF       FROMFILE(HPBFLIB/CAAFREP) +
                          TOFILE(BLGFLIB/CAAFREPSBE) +
                          MBROPT(*ADD) CRTFILE(*YES) +
                          INCREL((*IF AFAIC3 *EQ 361) (*AND AFESNB +
                          *EQ &NEWYRC))

             MONMSG     MSGID(CPF0000) EXEC(CHGVAR VAR(&ERR) +
                          VALUE('Y'))

             CPYF       FROMFILE(HPBFLIB/CAATREP) +
                          TOFILE(BLGFLIB/CAATREPSBE) MBROPT(*ADD) +
                          CRTFILE(*YES) INCREL((*IF ATAIC3 *EQ 361) +
                          (*AND ATESNB *EQ &NEWYRC))

             MONMSG     MSGID(CPF0000) EXEC(CHGVAR VAR(&ERR) +
                          VALUE('Y'))

             IF         COND(&ERR = 'N') THEN(DO)
/*-----------------------------------------------------------------*/
/*  update company from 361 to 375.  Then add the records that     */
/*  were create in the temp file into the permanent file.          */


             UPDATE     SET((AFAIC3 375)) SQL('from caafrepSBE')
             UPDATE     SET((ATAIC3 375)) SQL('from caatrepSBE')

             CPYF       FROMFILE(BLGFLIB/CAAFREPSBE) +
                          TOFILE(HPBFLIB/CAAFREP) MBROPT(*ADD) +
                          CRTFILE(*NO)

             CPYF       FROMFILE(BLGFLIB/CAATREPSBE) +
                          TOFILE(HPBFLIB/CAATREP) MBROPT(*ADD) +
                          CRTFILE(*NO)

/*-----------------------------------------------------------------*/
/*  update company to 376 in the temp file and then add them back  */
/*  to the permanent file.                                         */


             UPDATE     SET((AFAIC3 376)) SQL('from caafrepSBE')
             UPDATE     SET((ATAIC3 376)) SQL('from caatrepSBE')

             CPYF       FROMFILE(BLGFLIB/CAAFREPSBE) +
                          TOFILE(HPBFLIB/CAAFREP) MBROPT(*ADD) +
                          CRTFILE(*NO)

             CPYF       FROMFILE(BLGFLIB/CAATREPSBE) +
                          TOFILE(HPBFLIB/CAATREP) MBROPT(*ADD) +
                          CRTFILE(*NO)



             ENDDO

             IF         COND(&ERR = 'Y') THEN(SNDPGRMSG TOPGR(ISBGUTI) +
                          MSG('NEW SBE COMPANIES DID NOT GET CREATED.') +
                          CONFMSG(*NO))

             IF         COND(&ERR = 'N') THEN(SNDPGRMSG TOPGR(ISBGUTI) +
                          MSG('NEW SBE COMPANIES CREATED IN HPBFLIB.') +
                          CONFMSG(*NO))

             ENDPGM

