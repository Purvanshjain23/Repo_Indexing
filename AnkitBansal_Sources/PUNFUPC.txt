/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  COPY  ITEM BAL TO SAVE FILE BEFORE EDI 846 RUN     */
/*                                                                  */
/*  SYSTEM    - INVENTORY MANAGEMENT SYSTEM                         */
/*  DATE      - 08/07/19                                            */
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     I    &RETURN     - RETURN CODE                               */
/*                                                                  */
/**************************************************************************/
/* MODIFICATION HISTORY                                                   */
/**************************************************************************/
/* DATE     INT  PROJECT DESCRIPTION                                      */
/* -------- ---- ------- -------------------------------------------------*/
/* 04/13/20 RMC  S16437  Do not use Triggers when copy file to PRKFSAV.   */
/**************************************************************************/

 PUNFUPC:    PGM        PARM(&RETURN)
/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */

/* INTERNAL FIELDS                                                            */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)
        DCL    &COMMAND    *CHAR   (512)

/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

  /*         MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))   */
/********************************************************************/
/*   COPY ITEM BALANCE TO SAVE IN CASE OF ERROR                   */
/********************************************************************/
        /* CAB0REP - Item Balance */
             CHKOBJ     OBJ(PRKFSAV/CAB0REP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CRTDUPOBJ  OBJ(CAB0REP) FROMLIB(PRKFLIB) OBJTYPE(*FILE) +
                          TOLIB(PRKFSAV)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(PGMERR))
             ENDDO
             CPYF       FROMFILE(CAB0REP) TOFILE(PRKFSAV/CAB0REP) +
                          MBROPT(*REPLACE)
        /* CAB1REP - Item Balance DETAIL */
             CHKOBJ     OBJ(PRKFSAV/CAB1REP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CRTDUPOBJ  OBJ(CAB1REP) FROMLIB(PRKFLIB) OBJTYPE(*FILE) +
                          TOLIB(PRKFSAV) TRG(*NO)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(PGMERR))
             ENDDO
             CPYF       FROMFILE(CAB1REP) TOFILE(PRKFSAV/CAB1REP) +
                          MBROPT(*REPLACE)
        /* PDL5CPP - LOT LOC             */
             CHKOBJ     OBJ(PRKFSAV/PDL5CPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CRTDUPOBJ  OBJ(PDL5CPP) FROMLIB(PRKFLIB) OBJTYPE(*FILE) +
                          TOLIB(PRKFSAV) TRG(*NO)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(PGMERR))
             ENDDO
             CPYF       FROMFILE(PDL5CPP) TOFILE(PRKFSAV/PDL5CPP) +
                          MBROPT(*REPLACE)
          GOTO END
/*----------------------RECEIVE MESSAGES----------------------------*/

 PGMERR:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM

