// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKBSE01
// ?Date: 14.08.2025 Time: 02:50:57
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Deduction/addition tran
DO;

//?PRICE GROUP
// WRK.Company Value Code    USR = CONCAT(PAR.DED D/A Code,CON.PRC,CON.*ZERO)
WRK.Company_Value_Code_USR = PAR.DED_D_A_Code + 'PRC' (*ZERO);

// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(WRK.Company_Value_Code_USR);
PARAMETER(WRK.Commodity_Price_Group_USr);

//?MARKET CODE
// WRK.Company Value Code    USR = CONCAT(PAR.DED D/A Code,CON.MKT,CON.*ZERO)
WRK.Company_Value_Code_USR = PAR.DED_D_A_Code + 'MKT' (*ZERO);

// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(WRK.Company_Value_Code_USR);
PARAMETER(WRK.Commodity_Market_Code_USR);

//?RETRIVE MARKET PRICE
// Call program RTV Market Price      XF.
CALL PROGRAM(RTV Market Price      XF) ('PDMWXFR');
PARAMETER(PGM.*Return_code);
PARAMETER(WRK.Commodity_Market_Code_USR);
PARAMETER(WRK.Commodity_Price_Group_USr);
PARAMETER(PAR.TH_Purchase_Date);
PARAMETER(*ZERO);
PARAMETER(WRK.OMS_Market_Price_Amt_Usr);
PARAMETER(LCL.Pricing_Date_USR);
PARAMETER(PAR.BOH_Company_Number);
PARAMETER('CUR');
PARAMETER('H');
PARAMETER(WRK.OMS_Error_Return_Usr);

//?Retrieve the Pricing UOM.
// Call program Rtv Commod Group U/M  XF.
CALL PROGRAM(Rtv Commod Group U/M  XF) ('PDUVXFR');
PARAMETER(WRK.Commodity_Price_Group_USr);
PARAMETER(WRK.Pricing_UOM_USR);

//?Process special CUTOUT price group          RMC 4/19/01
CASE;

// IF WRK.Commodity Price Group USr is CUTOUT
IF WRK.Commodity_Price_Group_USr = 'CUTOUT';

// Call program Rtv Company Value Nbr XF.
CALL PROGRAM(Rtv Company Value Nbr XF) ('PDHGXFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER('CUTOUT');
PARAMETER(LCL.System_Value_Numeric_USR);

CASE;

// IF LCL.System Value Numeric  USR GT WRK.Zero USR
IF LCL.System_Value_Numeric_USR > WRK.Zero_USR;

// LCL.Percent Decimal       USR = LCL.System Value Numeric  USR / CON.100 *
LCL.Percent_Decimal_USR = LCL.System_Value_Numeric_USR / 100;

// WRK.OMS Market Price Amt Usr = LCL.Percent Decimal       USR * WRK.OMS Market Price Amt Usr *
WRK.OMS_Market_Price_Amt_Usr = LCL.Percent_Decimal_USR * WRK.OMS_Market_Price_Amt_Usr              +


ENDIF;

ENDIF;

CASE;

// IF WRK.Pricing UOM USR is Carcass Hundred Weight
IF WRK.Pricing_UOM_USR = 'CW';

// WRK.TH CM Base Mkt Price =       *
WRK.TH_CM_Base_Mkt_Price = WRK.OMS_Market_Price_Amt_Usr * .74 'H';

// IF *OTHERWISE
IF *OTHERWISE;

// WRK.TH CM Base Mkt Price = WRK.OMS Market Price Amt Usr * CON.1 *
WRK.TH_CM_Base_Mkt_Price = WRK.OMS_Market_Price_Amt_Usr * 1;

ENDIF;

//?Extended to market price amt
// TH CM Base Mkt Price Amt
PAR.Base_Mkt_Prc_Amt_Tot_USR = WRK.TH_CM_Base_Mkt_Price * ( PAR.TH_Live_Wgt / 100 'H' )            +
'H';

ENDDO;

