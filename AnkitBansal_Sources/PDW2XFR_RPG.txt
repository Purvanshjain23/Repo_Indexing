     H/TITLE UPD Auto Apply CM      XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISLBUSE
     H* Date          : 02/23/10  Time  : 14:57:57
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FARBDCPL3IF  E           K        DISK
      * RTV : A/R Header                Retrieval index       NV
      *
     FPDJ3CPL1IF  E           K        DISK
      * RTV : A/R Adjustment Type       Retrieval index
      *
     FARBECPL1IF  E           K        DISK
      * RTV : A/R Detail                Retrieval index       V
      *
     FOPBFCPM3IF  E           K        DISK
      * RSQ : Order Header TRG          Co, Invoice Number
      *
     FARBECPL0IF  E           K        DISK                      A
      * UPD : A/R Detail                Update index
      *
     I@BDCPF7
      * A/R Header                Retrieval index       NV
      * Renamed input format fields
     I              BDAIC3                          WAAIC3
     I              BDCONB                          WACONB
     I              BDCEST                          WACEST
     I              BDUHCD                          WAUHCD
     I              BDBSVA                          WABSVA
     I              BDAIVA                          WAAIVA
     I              BDAOVA                          WAAOVA
     I              BDBGVA                          WABGVA
     I              BDAJST                          WAAJST
     I              BDE3ST                          WAE3ST
     I              BDG4CD                          WAG4CD
     I              BDCKNB                          WACKNB
     I              BDCAC7                          WACAC7
     I              BDBKC7                          WABKC7
     I              BDBCCD                          WABCCD
     I              BDR4CD                          WAR4CD
     I              BDB4DT                          WAB4DT
     I              BDATDT                          WAATDT
     I              BDH0DT                          WAH0DT
     I              BDH3DT                          WAH3DT
     I              BDH4DT                          WAH4DT
     I              BDH5DT                          WAH5DT
     I              BDANC7                          WAANC7
     I              BDCPTX                          WACPTX
     I              BDBSDY                          WABSDY
     I              BDUVST                          WAUVST
     I              BDUWST                          WAUWST
     I              BDUXST                          WAUXST
     I              BDAATM                          WAAATM
     I              BDAYNA                          WAAYNA
     I              BDA0NA                          WAA0NA
     I              BDAXDT                          WAAXDT
      *
     I@J3CPCQ
      * A/R Adjustment Type       Retrieval index
      * Renamed input format fields
     I              J3AIC3                          WBAIC3
     I              J3UHCD                          WBUHCD
     I              J3NFNA                          WBNFNA
     I              J3EAZT                          WBEAZT
     I              J3IZTX                          WBIZTX
     I              J3UKVA                          WBUKVA
     I              J3A5ST                          WBA5ST
     I              J3GLTS                          WBGLTS
     I              J3SYSC                          WBSYSC
     I              J3UVST                          WBUVST
     I              J3UWST                          WBUWST
     I              J3UXST                          WBUXST
     I              J3VSST                          WBVSST
     I              J3AATM                          WBAATM
     I              J3AYNA                          WBAYNA
     I              J3A0NA                          WBA0NA
     I              J3AXDT                          WBAXDT
      *
     I@BFCPFO
      * A/R Detail                Retrieval index       V
      * Renamed input format fields
     I              BFAIC3                          WCAIC3
     I              BFCONB                          WCCONB
     I              BFCEST                          WCCEST
     I              BFDXNB                          WCDXNB
     I              BFUHCD                          WCUHCD
     I              BFBSVA                          WCBSVA
     I              BFCPTX                          WCCPTX
     I              BFNGNA                          WCNGNA
     I              BFB4DT                          WCB4DT
     I              BFDVDT                          WCDVDT
     I              BFYXNX                          WCYXNX
     I              BFHYDT                          WCHYDT
     I              BFG4CD                          WCG4CD
     I              BFCKNB                          WCCKNB
     I              BFA5ST                          WCA5ST
     I              BFAJST                          WCAJST
     I              BFB1VN                          WCB1VN
     I              BFEAZT                          WCEAZT
     I              BFC1NY                          WCC1NY
     I              BFIZTX                          WCIZTX
     I              BFETSX                          WCETSX
     I              BFW3SX                          WCW3SX
     I              BFW4SX                          WCW4SX
     I              BFW5SX                          WCW5SX
     I              BFW6SX                          WCW6SX
     I              BFW7SX                          WCW7SX
     I              BFW8SX                          WCW8SX
     I              BFQHDT                          WCQHDT
     I              BFQIDT                          WCQIDT
     I              BFQJDT                          WCQJDT
     I              BFQKDT                          WCQKDT
     I              BFQLDT                          WCQLDT
     I              BFGLVL                          WCGLVL
     I              BFGMVL                          WCGMVL
     I              BFGNVL                          WCGNVL
     I              BFGOVL                          WCGOVL
     I              BFGPVL                          WCGPVL
     I              BFUVST                          WCUVST
     I              BFUWST                          WCUWST
     I              BFUXST                          WCUXST
     I              BFAATM                          WCAATM
     I              BFAYNA                          WCAYNA
     I              BFA0NA                          WCA0NA
     I              BFAXDT                          WCAXDT
      *
     I@BFCPDX
      * Order Header TRG          Co, Invoice Number
      * Renamed input format fields
     I              BEAIC3                          WDAIC3
     I              BEC4NB                          WDC4NB
     I              BEJNCD                          WDJNCD
     I              BEANC7                          WDANC7
     I              BEBKC7                          WDBKC7
     I              BEBRTX                          WDBRTX
     I              BEHMNA                          WDHMNA
     I              BEHONA                          WDHONA
     I              BEHPNA                          WDHPNA
     I              BEHNNA                          WDHNNA
     I              BEDBCD                          WDDBCD
     I              BECKTX                          WDCKTX
     I              BEB0C7                          WDB0C7
     I              BEAETX                          WDAETX
     I              BEB1NA                          WDB1NA
     I              BEB3NA                          WDB3NA
     I              BEB4NA                          WDB4NA
     I              BEB2NA                          WDB2NA
     I              BEBHCD                          WDBHCD
     I              BEC8TX                          WDC8TX
     I              BEBCNA                          WDBCNA
     I              BEA0DT                          WDA0DT
     I              BEA5DT                          WDA5DT
     I              BEGNDT                          WDGNDT
     I              BEACDT                          WDACDT
     I              BEAQCD                          WDAQCD
     I              BEB6NA                          WDB6NA
     I              BEBYNA                          WDBYNA
     I              BEBZNA                          WDBZNA
     I              BEGTST                          WDGTST
     I              BEGVST                          WDGVST
     I              BEGUST                          WDGUST
     I              BEQFST                          WDQFST
     I              BECQCD                          WDCQCD
     I              BEGJST                          WDGJST
     I              BEGWST                          WDGWST
     I              BEGXST                          WDGXST
     I              BEGYST                          WDGYST
     I              BEAODT                          WDAODT
     I              BEAIVN                          WDAIVN
     I              BECXDT                          WDCXDT
     I              BEJZVA                          WDJZVA
     I              BEA1WG                          WDA1WG
     I              BEXIST                          WDXIST
     I              BEXJST                          WDXJST
     I              BEXKST                          WDXKST
     I              BEEIDT                          WDEIDT
     I              BEAFTM                          WDAFTM
     I              BEE8CD                          WDE8CD
     I              BEE9CD                          WDE9CD
     I              BERMNB                          WDRMNB
     I              BETBNB                          WDTBNB
     I              BER1NB                          WDR1NB
     I              BEPJST                          WDPJST
     I              BEU0ST                          WDU0ST
     I              BEU1ST                          WDU1ST
     I              BEQ2CD                          WDQ2CD
     I              BEU2ST                          WDU2ST
     I              BEVEST                          WDVEST
     I              BEVFST                          WDVFST
     I              BEVGST                          WDVGST
     I              BERPCD                          WDRPCD
     I              BERNNB                          WDRNNB
     I              BEVDST                          WDVDST
     I              BEATIN                          WDATIN
     I              BEU4ST                          WDU4ST
     I              BEU5ST                          WDU5ST
     I              BERSRN                          WDRSRN
     I              BEMHNA                          WDMHNA
     I              BEMINA                          WDMINA
     I              BEWBST                          WDWBST
     I              BER4CD                          WDR4CD
     I              BEBFCD                          WDBFCD
     I              BEQ4CD                          WDQ4CD
     I              BET3NB                          WDT3NB
     I              BESICD                          WDSICD
     I              BECONB                          WDCONB
     I              BECEST                          WDCEST
     I              BEAWDT                          WDAWDT
     I              BEJPCD                          WDJPCD
     I              BEXUST                          WDXUST
     I              BEZ1ST                          WDZ1ST
     I              BEVRVA                          WDVRVA
     I              BEOBST                          WDOBST
     I              BEBCST                          WDBCST
     I              BEBDST                          WDBDST
     I              BEB7VL                          WDB7VL
     I              BEGASX                          WDGASX
     I              BEGBSX                          WDGBSX
     I              BEGCSX                          WDGCSX
     I              BEGDSX                          WDGDSX
     I              BEFNSX                          WDFNSX
     I              BEFOSX                          WDFOSX
     I              BEFPSX                          WDFPSX
     I              BEFQSX                          WDFQSX
     I              BEFRSX                          WDFRSX
     I              BEFSSX                          WDFSSX
     I              BEFTSX                          WDFTSX
     I              BEFUSX                          WDFUSX
     I              BEFVSX                          WDFVSX
     I              BEFWSX                          WDFWSX
     I              BEFXSX                          WDFXSX
     I              BEFYSX                          WDFYSX
     I              BENODT                          WDNODT
     I              BENPDT                          WDNPDT
     I              BENQDT                          WDNQDT
     I              BENRDT                          WDNRDT
     I              BENSDT                          WDNSDT
     I              BEBPTM                          WDBPTM
     I              BEBQTM                          WDBQTM
     I              BEBRTM                          WDBRTM
     I              BEBSTM                          WDBSTM
     I              BEBTTM                          WDBTTM
     I              BEH0NX                          WDH0NX
     I              BEH1NX                          WDH1NX
     I              BEH2NX                          WDH2NX
     I              BEH3NX                          WDH3NX
     I              BEH4NX                          WDH4NX
     I              BEC0C7                          WDC0C7
     I              BEUVST                          WDUVST
     I              BEUWST                          WDUWST
     I              BEUXST                          WDUXST
     I              BEAATM                          WDAATM
     I              BEAYNA                          WDAYNA
     I              BEA0NA                          WDA0NA
     I              BEAXDT                          WDAXDT
      *
     I@BFCPFN
      * A/R Detail                Update index
      * Renamed input format fields
     I              BFAIC3                          WEAIC3
     I              BFCONB                          WECONB
     I              BFCEST                          WECEST
     I              BFDXNB                          WEDXNB
     I              BFUHCD                          WEUHCD
     I              BFBSVA                          WEBSVA
     I              BFCPTX                          WECPTX
     I              BFNGNA                          WENGNA
     I              BFB4DT                          WEB4DT
     I              BFDVDT                          WEDVDT
     I              BFYXNX                          WEYXNX
     I              BFHYDT                          WEHYDT
     I              BFG4CD                          WEG4CD
     I              BFCKNB                          WECKNB
     I              BFA5ST                          WEA5ST
     I              BFAJST                          WEAJST
     I              BFB1VN                          WEB1VN
     I              BFEAZT                          WEEAZT
     I              BFC1NY                          WEC1NY
     I              BFIZTX                          WEIZTX
     I              BFETSX                          WEETSX
     I              BFW3SX                          WEW3SX
     I              BFW4SX                          WEW4SX
     I              BFW5SX                          WEW5SX
     I              BFW6SX                          WEW6SX
     I              BFW7SX                          WEW7SX
     I              BFW8SX                          WEW8SX
     I              BFQHDT                          WEQHDT
     I              BFQIDT                          WEQIDT
     I              BFQJDT                          WEQJDT
     I              BFQKDT                          WEQKDT
     I              BFQLDT                          WEQLDT
     I              BFGLVL                          WEGLVL
     I              BFGMVL                          WEGMVL
     I              BFGNVL                          WEGNVL
     I              BFGOVL                          WEGOVL
     I              BFGPVL                          WEGPVL
     I              BFUVST                          WEUVST
     I              BFUWST                          WEUWST
     I              BFUXST                          WEUXST
     I              BFAATM                          WEAATM
     I              BFAYNA                          WEAYNA
     I              BFA0NA                          WEA0NA
     I              BFAXDT                          WEAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQARBE1    E DSARBECPL0
      * UPD : A/R Detail                Update index
      * Renamed input format fields
     I              BFAIC3                          WEAIC3
     I              BFCONB                          WECONB
     I              BFCEST                          WECEST
     I              BFDXNB                          WEDXNB
     I              BFUHCD                          WEUHCD
     I              BFBSVA                          WEBSVA
     I              BFCPTX                          WECPTX
     I              BFNGNA                          WENGNA
     I              BFB4DT                          WEB4DT
     I              BFDVDT                          WEDVDT
     I              BFYXNX                          WEYXNX
     I              BFHYDT                          WEHYDT
     I              BFG4CD                          WEG4CD
     I              BFCKNB                          WECKNB
     I              BFA5ST                          WEA5ST
     I              BFAJST                          WEAJST
     I              BFB1VN                          WEB1VN
     I              BFEAZT                          WEEAZT
     I              BFC1NY                          WEC1NY
     I              BFIZTX                          WEIZTX
     I              BFETSX                          WEETSX
     I              BFW3SX                          WEW3SX
     I              BFW4SX                          WEW4SX
     I              BFW5SX                          WEW5SX
     I              BFW6SX                          WEW6SX
     I              BFW7SX                          WEW7SX
     I              BFW8SX                          WEW8SX
     I              BFQHDT                          WEQHDT
     I              BFQIDT                          WEQIDT
     I              BFQJDT                          WEQJDT
     I              BFQKDT                          WEQKDT
     I              BFQLDT                          WEQLDT
     I              BFGLVL                          WEGLVL
     I              BFGMVL                          WEGMVL
     I              BFGNVL                          WEGNVL
     I              BFGOVL                          WEGOVL
     I              BFGPVL                          WEGPVL
     I              BFUVST                          WEUVST
     I              BFUWST                          WEUWST
     I              BFUXST                          WEUXST
     I              BFAATM                          WEAATM
     I              BFAYNA                          WEAYNA
     I              BFA0NA                          WEA0NA
     I              BFAXDT                          WEAXDT
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R Header
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Invoice Number
     I                                    P   3   60P1CONB
      * I :  Invoice Suffix
     I                                        7   8 P1CEST
      * I :  Transaction Amount
     I                                    P   9  142P1BSVA
     IP2PARM      DS
      * O :  Error Return text
     I                                        1   7 P2UNCD
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1CONB    PARM           WP0002  70       Invoice Number
     C           P1CEST    PARM           WP0003  2        Invoice Suffix
     C           P1BSVA    PARM           WP0004 112       Transaction Amo
     C           P2UNCD    PARM P2UNCD    WP0005  7        Error Return te
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * UPD Auto Apply CM      XF
      * RTV Auto Appl CM       RT - A/R Header  * 
     C                     EXSR SARVGN
      * Error Return field
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
     C                     MOVEL*BLANK    P2UNCD           Error Return te
     C                     MOVEL'ERR'     P2UNCD           Error Return te
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    P2UNCD           Error Return te
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Auto Appl CM       RT - A/R Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  30       Sequence Number
     C                     MOVEL*BLANK    WN0002 30        Adjustment Desc
     C                     MOVEL*BLANK    WN0003  1        Effect on Accou
     C                     MOVEL*BLANK    WN0004  8        G/L ID Code JDE
     C                     Z-ADD*ZERO     WN0005 112       Adjustment Limi
     C                     MOVEL*BLANK    WN0006  3        Cash/Adj
     C                     MOVEL*BLANK    WN0007  1        User Enter G/L
     C                     MOVEL*BLANK    WN0008  1        System Control
     C                     Z-ADD*ZERO     WN0009  30       G/L Posting Com
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * RMC 12/23/05 get g/l posting co
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WACONB           Invoice Number
     C                     KFLD           WACEST           Invoice Suffix
      * Setup key
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1CONB    WACONB           Invoice Number
     C                     MOVELP1CEST    WACEST           Invoice Suffix
      * Establish starting position
     C           KRSSA     CHAIN@BDCPF7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0174' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Add an ACM non-cash Payment adjustment and an ARC A/R Credit Adju
      *        Get Adjustment Record and next sequence number
      * RTV Adj Limits         RT - A/R Adjustment Type  * 
     C                     EXSR SBRVGN
      * RTV Next Seq. No.      RT - A/R Detail  * 
     C                     EXSR SCRVGN
      * RTV OH Tf Exempt Code RT - Order Header TRG  * 
     C                     EXSR SDRVGN
      * VAL Acct ID JDE-8 dgt  UP - STR Hog Prcr & Eval Sys  * nll parm a
     C                     CALL 'ARACTRET'             90  VAL Acct ID JDE
     C                     PARM WN0004    WQ0001  8        G/L ID Code Alp
     C                     PARM *BLANK    WQ0002 12        Cost Center. .
     C                     PARM *BLANK    WQ0003  6        Object Account
     C                     PARM *BLANK    WQ0004  8        Subsidiary . .
     C                     PARM *BLANK    WQ0005 30        Description
     C           WN0009    PARM *ZERO     WQ0006  30       G/L Posting Com
     C                     PARM *BLANK    WQ0007  1        JDE Posting Edi
     C                     PARM *BLANK    WQ0008  7        Error Return te
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ARACTRET'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * CRT A/R Detail Appl    CR - A/R Detail  * 
     C                     EXSR SECRRC
      * CASE: LCL.A/R TF Exempt Code is *ALL values
     C           YL0001    IFEQ 'NE'                       *IF
     C           YL0001    OREQ 'PC'
     C           YL0001    OREQ 'EC'
     C           YL0001    OREQ 'EP'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'NE'      YL0001           A/R TF Exempt C
     C                     END                             *FI
      * Credit Accounts Receivable with Customers G/L Account
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Adj Limits         RT - A/R Adjustment Type  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBUHCD           Adjustment Type
      * Setup key
     C                     Z-ADDP1AIC3    WBAIC3           Company Number
     C                     MOVEL'ACM'     WBUHCD           Adjustment Type
      * Establish starting position
     C           KRSSB     CHAIN@J3CPCQ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2041' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBNFNA    WN0002           Adjustment Desc
     C                     MOVELWBEAZT    WN0003           Effect on Accou
     C                     MOVELWBIZTX    WN0004           G/L ID Code JDE
     C                     Z-ADDWBUKVA    WN0005           Adjustment Limi
     C                     MOVELWBA5ST    WN0006           Cash/Adj
     C                     MOVELWBGLTS    WN0007           User Enter G/L
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Next Seq. No.      RT - A/R Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAIC3    WQSC01           Company Number
     C           *LIKE     DEFN WCCONB    WQSC02           Invoice Number
     C           *LIKE     DEFN WCCEST    WQSC03           Invoice Suffix
      * Define keylist
     C           KPSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Invoice Number
     C                     KFLD           WQSC03           Invoice Suffix
     C                     KFLD           WCDXNB           Sequence Number
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Invoice Number
     C                     KFLD           WQSC03           Invoice Suffix
      * Setup key
     C                     Z-ADDP1AIC3    WQSC01           Company Number
     C                     Z-ADDP1CONB    WQSC02           Invoice Number
     C                     MOVELP1CEST    WQSC03           Invoice Suffix
     C                     Z-ADDWN0001    WCDXNB           Sequence Number
      * Establish starting position
     C           KPSSC     SETLL@BFCPFO                    *
     C           KRSSC     READE@BFCPFO                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0178' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WN0001           Sequence Number
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     Z-ADDWCDXNB    WN0001           Sequence Number
     C           KRSSC     READE@BFCPFO                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     ADD  1         WN0001           Sequence Number
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV OH Tf Exempt Code RT - Order Header TRG  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDAIC3    WQSD01           Company Number
     C           *LIKE     DEFN WDCONB    WQSD02           Invoice Number
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Invoice Number
      * Setup key
     C                     Z-ADDWAAIC3    WQSD01           Company Number
     C                     Z-ADDWACONB    WQSD02           Invoice Number
      * Establish starting position
     C           KRSSD     SETLL@BFCPDX                    *
     C           KRSSD     READE@BFCPDX                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           OH TF Exempt Co
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWDFYSX    YL0001           OH TF Exempt Co
     C           KRSSD     READE@BFCPDX                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * CRT A/R Detail Appl    CR - A/R Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0010  60       Job Time
     C                     MOVEL*BLANK    WN0011 10        User Id
     C                     MOVEL*BLANK    WN0012 10        Job Name
     C                     Z-ADD*ZERO     WN0013  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BFCPFN
     C                     Z-ADDP1AIC3    WEAIC3           Company Number
     C                     Z-ADDP1CONB    WECONB           Invoice Number
     C                     MOVELP1CEST    WECEST           Invoice Suffix
     C                     Z-ADDWN0001    WEDXNB           Sequence Number
     C                     MOVEL'ACM'     WEUHCD           Adjustment Type
     C                     Z-ADDP1BSVA    WEBSVA           Transaction Amo
     C                     MOVEL*BLANK    WECPTX           A/R Check Numbe
     C                     MOVEL*BLANK    WENGNA           Explanation
     C                     Z-ADD##JDT     WEB4DT           Transaction Dat
     C                     Z-ADD##JDT     WEDVDT           Payment/Deposit
     C                     Z-ADD##JTM     WEYXNX           Deposit Time
     C                     Z-ADD*ZERO     WEHYDT           G/L Post Date
     C                     MOVEL*BLANK    WEG4CD           Bank Code
     C                     Z-ADD*ZERO     WECKNB           G/L Document Nu
     C                     MOVELWN0006    WEA5ST           Cash/Adj
     C                     MOVEL'E'       WEAJST           A/R Processing
     C                     MOVEL##PGM     WEB1VN           Originating Pro
     C                     MOVELWN0003    WEEAZT           Effect on Accou
     C                     Z-ADDWN0009    WEC1NY           G/L Posting Com
     C                     MOVELWN0004    WEIZTX           G/L ID Code JDE
     C                     MOVEL'Y'       WEETSX           Post Adjustment
     C                     MOVELYL0001    WEW3SX           A/R TF Exempt C
     C                     MOVEL*BLANK    WEW4SX           A/R Dtl UnUsed
     C                     MOVEL*BLANK    WEW5SX           A/R Dtl UnUsed
     C                     MOVEL*BLANK    WEW6SX           A/R Dtl UnUsed
     C                     MOVEL*BLANK    WEW7SX           A/R Dtl UnUsed
     C                     MOVEL*BLANK    WEW8SX           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEQHDT           TFS Adj Week-En
     C                     Z-ADD*ZERO     WEQIDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEQJDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEQKDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEQLDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEGLVL           G/L Sub-Ledger
     C                     Z-ADD*ZERO     WEGMVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEGNVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEGOVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WEGPVL           A/R Dtl UnUsed
     C                     MOVELWAUVST    WEUVST           EDI Status 1
     C                     MOVELWAUWST    WEUWST           EDI Status 2
     C                     MOVELWAUXST    WEUXST           EDI Status 3
      *
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WEAATM           Job Time
     C                     MOVEL##USR     WEAYNA           User Id
     C                     MOVEL##JOB     WEA0NA           Job Name
     C                     Z-ADD##JDT     WEAXDT           Job Date
     C           KLCRSE    KLIST
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WECONB           Invoice Number
     C                     KFLD           WECEST           Invoice Suffix
     C                     KFLD           WEDXNB           Sequence Number
      * Check for duplicate primary key
     C           KLCRSE    SETLL@BFCPFN                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR0179' W0RTN   7
      * Send message 'A/R Detail             EX'
     C                     MOVEL'USR0179' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@BFCPFN                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * Move @BFCPFN fields back
     C                     Z-ADDWEDXNB    WN0001           Sequence Number
      * USER: Processing after Data update
     C                     MOVEL'N'       WUWVST           Access Denied (
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WABSVA           Transaction Amo
     C                     Z-ADD*ZERO     WAAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WAAOVA           Amount Paid
     C                     Z-ADD*ZERO     WABGVA           Remaining Balan
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WACAC7           Order Number Re
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WAATDT           Due Date
     C                     Z-ADD*ZERO     WAH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WAH3DT           Unused Date Cod
     C                     Z-ADD*ZERO     WAH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WAH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABSDY           Days to Pay
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBUKVA           Adjustment Limi
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCCONB           Invoice Number
     C                     Z-ADD*ZERO     WCDXNB           Sequence Number
     C                     Z-ADD*ZERO     WCBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WCB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WCDVDT           Payment/Deposit
     C                     Z-ADD*ZERO     WCYXNX           Deposit Time
     C                     Z-ADD*ZERO     WCHYDT           G/L Post Date
     C                     Z-ADD*ZERO     WCCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WCC1NY           G/L Posting Com
     C                     Z-ADD*ZERO     WCQHDT           TFS Adj Week-En
     C                     Z-ADD*ZERO     WCQIDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQJDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQKDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQLDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGLVL           G/L Sub-Ledger
     C                     Z-ADD*ZERO     WCGMVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGNVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGOVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGPVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WDA0DT           Order Date
     C                     Z-ADD*ZERO     WDA5DT           Requested Ship
     C                     Z-ADD*ZERO     WDGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WDACDT           Cancel Date
     C                     Z-ADD*ZERO     WDAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WDCXDT           Date of Origina
     C                     Z-ADD*ZERO     WDJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WDA1WG           Order Weight To
     C                     Z-ADD*ZERO     WDEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WDAFTM           Requested Deliv
     C                     Z-ADD*ZERO     WDRMNB           Load ID
     C                     Z-ADD*ZERO     WDTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WDR1NB           Rated Freight
     C                     Z-ADD*ZERO     WDRNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WDATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WDRSRN           Resell Referenc
     C                     Z-ADD*ZERO     WDT3NB           Attach to Order
     C                     Z-ADD*ZERO     WDCONB           Invoice Number
     C                     Z-ADD*ZERO     WDAWDT           Invoice Date
     C                     Z-ADD*ZERO     WDVRVA           A/R order Value
     C                     Z-ADD*ZERO     WDB7VL           Invoice Order V
     C                     Z-ADD*ZERO     WDNODT           OH Unused Date
     C                     Z-ADD*ZERO     WDNPDT           OH Unused Date
     C                     Z-ADD*ZERO     WDNQDT           OH Unused Date
     C                     Z-ADD*ZERO     WDNRDT           OH Unused Date
     C                     Z-ADD*ZERO     WDNSDT           OH Unused Date
     C                     Z-ADD*ZERO     WDBPTM           Maximum Gross W
     C                     Z-ADD*ZERO     WDBQTM           Time of Origina
     C                     Z-ADD*ZERO     WDBRTM           OH Unused Time
     C                     Z-ADD*ZERO     WDBSTM           OH Unused Time
     C                     Z-ADD*ZERO     WDBTTM           OH Unused Time
     C                     Z-ADD*ZERO     WDH0NX           Act Frt Referen
     C                     Z-ADD*ZERO     WDH1NX           Act Non-Ref Frt
     C                     Z-ADD*ZERO     WDH2NX           OH Fuel Surchar
     C                     Z-ADD*ZERO     WDH3NX           OH Total Non-Re
     C                     Z-ADD*ZERO     WDH4NX           OH Total Ref Fr
     C                     Z-ADD*ZERO     WDC0C7           Claim Number
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Define work field Access Denied (Y/N)
     C                     MOVEL*BLANK    WUWVST  1
      * Clear all neither parameters
      * CRT A/R Detail Appl    CR - A/R Detail  * 
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      * Define local work field A/R TF Exempt Code
     C                     MOVEL*BLANK    YL0001  2
      * Define null work field Cost Center. . . . . . .
     C                     MOVEL*BLANK    YN0001 12
      * Define null work field Object Account . . . . .
     C                     MOVEL*BLANK    YN0002  6
      * Define null work field Subsidiary . . . . . . .
     C                     MOVEL*BLANK    YN0003  8
      * Define null work field Description
     C                     MOVEL*BLANK    YN0004 30
      * Define null work field JDE Posting Edit Code USR
     C                     MOVEL*BLANK    YN0005  1
      * Define null work field Error Return text
     C                     MOVEL*BLANK    YN0006  7
      *================================================================
     CSR         ZZEXIT    ENDSR
