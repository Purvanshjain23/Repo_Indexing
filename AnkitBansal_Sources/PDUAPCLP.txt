/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR LATE DELIVERY RPT. */
/*             COMPANY, DATES, LOAD, CARRIER                        */
/*                                                                  */
/*  SYSTEM    - TRAFFIC SYSTEM                                      */
/*  PROGRAM   - PRINT LATE DELIVERY REPORT                          */
/*  DATE      - 12/19/96                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FRMDATN    - FROM SHIP DATE                            */
/*          &THRDATN    - THROUGH SHIP DATE                         */
/*          &LOADN      - LOAD NUMBER                               */
/*          &CARRIER    - CARRIER CODE                              */
/*          &LOADT      - LOAD TYPE                                 */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/*          &SELRPT     - SELECTED REPORT TYPE                      */
/*          &UOM        - UNIT OF MEASURE - BX OR CB                */
/*          &OTRGROUP   - ON TIME REASON GROUP CODE                 */
/*          &EXPORTYN   - EXCLUDE EXPORTS Y OR N                    */
/********************************************************************/
/*  RMC 1/02/2001  ADD SALESPERSON AS INPUT PARM AND PASS TO PRTS   */
/*  RMC 6/27/2003  ADDED ON TIME REASON PARM                        */
/*  RMC 5/14/2004  REVERSED COMPANY/LOAD PARM ORDER, MAKE COMPANY   */
/*                 OPTIONAL ON QRYSLT                               */
/*  LJB 6/15/2006  ADDED PARM: EXCLUDE EXPORTS Y OR N, REMOVE THE   */
/*                 SBDOVRPRT COMMAND, REPLACE WITH OVRPRTF,         */
/*                 REMOVED CUSTOMER NUMBER, IT IS NOT USED AND      */
/*                 SYNON PARMS LIST WAS MAX'D OUT.                  */
/*                 COMMENTED OUT REFERENCES TO SELECTION 1 SINCE IT */
/*                 IS NOT BEING USED ANY MORE.                      */
/*  LJB 6/30/2006  THIS PROGRAM IS CANCELED - PPYQUPC IS CALLED     */
/*                 INSTEAD.                                         */
/********************************************************************/
/***PDUAPCLP:   PGM        PARM(&COMPNYN &FRMDATN &THRDATN &LOADN +
                          &SALESP &CARRIER &LOADT &OUTQ &HOLD &SAVE +
                          &COPYN &NIGHTQ &CUST &SELRPT &UOM &REASON)*/

 PDUAPCLP:   PGM        PARM(&COMPNYN &FRMDATN &THRDATN &LOADN +
                          &SALESP &CARRIER &LOADT &OUTQ &HOLD &SAVE +
                          &COPYN &NIGHTQ &SELRPT &UOM &OTRGROUP +
                          &EXPORTYN)

/* PARMS                                                            */
        DCL    &COMPNYN    *DEC           /* COMPANY NUMBER (PASSED)*/
        DCL    &FRMDATN    *DEC           /* FROM SHIP DATE (PASSED)*/
        DCL    &THRDATN    *DEC           /* THRU SHIP DATE (PASSED)*/
        DCL    &LOADN      *DEC           /* LOAD NUMBER    (PASSED)*/
        DCL    &SALESP     *CHAR   (3)    /* SALESPERSON            */
        DCL    &CARRIER    *CHAR   (3)    /* CARRIER CODE           */
        DCL    &LOADT      *CHAR   (1)    /* LOAD TYPE              */
        DCL    &COPYN      *DEC           /* NO. OF COPIES          */
        DCL    &OUTQ       *CHAR   (10)   /* OUTPUT QUEUE           */
        DCL    &HOLD       *CHAR   (4)    /* HOLD STATUS            */
        DCL    &SAVE       *CHAR   (4)    /* SAVE STATUS            */
        DCL    &NIGHTQ     *CHAR   (10)   /* NIGHT JOB QUEUE        */
        DCL    &SELRPT     *CHAR   (1)    /* REPORT SELECTION       */
        DCL    &OTRGROUP   *CHAR   (3)    /* ON TIME REASON GROUP   */
        DCL    &PRTFO      *CHAR   (8)    /* PRINTER FILE NAME      */
        DCL    &UOM        *CHAR   (2)    /* UNIT OF MEASURE        */
        DCL    &EXPORTYN   *CHAR   (2)    /* EXCLUDE EXPORTS Y/N    */

/* INTERNAL FIELDS                                                  */
        DCL    &COPY       *DEC    (2 0)  /* NUMBER OF COPIES       */
        DCL    &COMPANY    *DEC    (3 0)  /* COMPANY NUMBER         */
        DCL    &FRMDAT     *DEC    (7 0)  /* FROM DATE              */
        DCL    &THRDAT     *DEC    (7 0)  /* THRU DATE              */
        DCL    &LOAD       *DEC    (7 0)  /* LOAD NUMBER            */
        DCL    &USER       *CHAR   (10)  /* USER PROFILE            */
        DCL    &GRPPRF     *CHAR   (10)  /* GROUP PROFILE           */

/* OPENQRYF FIELDS                                                  */
        DCL    &COMPA      *CHAR    3     /* ACK COMPLETE           */
        DCL    &FRMDATA    *CHAR    7     /* FROM DATE (PASSED)     */
        DCL    &THRDATA    *CHAR    7     /* THRU DATE (PASSED)     */

        DCL     &A        *CHAR   40              /* QRY FROM DATE  */
        DCL     &B        *CHAR   50              /* QRY TO DATE    */
        DCL     &C        *CHAR   50              /* QRY COMPANY    */
        DCL     &D        *CHAR  120              /* QRY ALL        */
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             RTVJOBA    USER(&USER)
             RTVUSRPRF  USRPRF(&USER) GRPPRF(&GRPPRF)

             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&FRMDAT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FRMDAT)
             CHGVAR     VAR(&THRDAT) VALUE(&THRDATN)
             CHGVAR     VAR(&THRDATA) VALUE(&THRDAT)
             CHGVAR     VAR(&LOAD) VALUE(&LOADN)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)

             CRTDUPOBJ  OBJ(PPB6CPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PPB6CPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PPB6CPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PPB6CPL2) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR INVOICING REPORTS         */
/*********************************************************************/
             IF         COND(&COMPA *GT '000') THEN(DO)
             CHGVAR     VAR(&A) VALUE('FJAIC3 *EQ ' *CAT +
                         &COMPA *BCAT '*AND')
                         ENDDO

/********************************************************************/
/*           IF         COND(&SELRPT *EQ '1') THEN(DO)               */
/*           CHGVAR     VAR(&B) VALUE('(FJAODT *GE ' *CAT +          */
/*                       &FRMDATA *CAT ' *AND FJAODT *LE +           */
/*                       ' *CAT &THRDATA *CAT ')')                   */
/*                                                                   */
/*           CHGVAR     VAR(&C) VALUE('*OR (FJEIDT *GE ' *CAT  +     */
/*                       &FRMDATA *CAT ' *AND FJEIDT *LE '    +      */
/*                       *CAT &THRDATA *CAT ')')                     */
/*           ENDDO                                                   */
/********************************************************************/

             IF         COND(&SELRPT *EQ '2') THEN(DO)
             CHGVAR     VAR(&B) VALUE('(FJEIDT *GE ' *CAT +
                         &FRMDATA *CAT ' *AND FJEIDT *LE +
                         ' *CAT &THRDATA *CAT ')')
             ENDDO

             CHGVAR     VAR(&D) VALUE(&A *BCAT &B *BCAT &C)

/*  RUN QUERY TO READ LOAD HEADER BY DATE RANGE                      */
/********************************************************************/
/*           IF         COND(&SELRPT *EQ '1') THEN(DO)               */
/*           OVRDBF     FILE(OMFJCPL4) SHARE(*YES)                   */
/*           OPNQRYF    FILE((OMFJCPL4)) QRYSLT(&D) KEYFLD(*FILE)    */
/*           ENDDO                                                   */
/********************************************************************/

             IF         COND(&SELRPT *EQ '2') THEN(DO)
             OVRDBF     FILE(OMFJCPLQ) SHARE(*YES)
             OPNQRYF    FILE((OMFJCPLQ)) QRYSLT(&D) KEYFLD(*FILE)
             ENDDO

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
/***         IF         COND(&SELRPT *EQ '1') THEN(DO)              */
/*           CHGVAR     VAR(&PRTF) VALUE('PDUAPFR')                 */
/*           ENDDO                                                  */
/*           IF         COND(&SELRPT *EQ '2') THEN(DO)              */
/*           CHGVAR     VAR(&PRTF) VALUE('PDL0PFR')                 */
/*           ENDDO                                                  */
/*                                                                  */
/*           IF         COND(&SELRPT *EQ '1') THEN(DO)              */
/*           CHGVAR     VAR(&PRTFO) VALUE('PDUAPFR$')               */
/*           ENDDO                                                  */
/********************************************************************/
             IF (&SELRPT *EQ '2') THEN(DO)
/*           CHGVAR     VAR(&PRTFO) VALUE('PDL0PFR$')               */
             ENDDO
             OVRPRTF    FILE(PPY4PFR$) OUTQ(&OUTQ) COPIES(&COPY) +
                          HOLD(&HOLD) SAVE(&SAVE)

/***         CALL       PGM(QCMDEXC) PARM(&COMMAND 512)          *****/


/*********************************************************************/
/*   CALL PRINT PROGRAM -                                            */
/*********************************************************************/
/*          IF         COND(&SELRPT *EQ '1') THEN(DO)                */
/*          CALL       PGM(PDUAPFR) PARM(' ' &LOAD &COMPANY &THRDAT +*/
/*                     &CARRIER &LOADT &FRMDAT &SALESP &UOM &REASON) */
/*          CLOF       OPNID(OMFJCPL4)                               */
/*          DLTOVR     FILE(OMFJCPL4)                                */
/*          ENDDO                                                    */
/*********************************************************************/

             IF         COND(&SELRPT *EQ '2') THEN(DO)
             CALL       PGM(PPY4PFR) PARM(' ' &LOAD &COMPANY +
                          &CARRIER &LOADT &THRDAT &UOM &FRMDAT +
                          &SALESP &OTRGROUP &EXPORTYN)
             CLOF       OPNID(OMFJCPLQ)
             DLTOVR     FILE(OMFJCPLQ)
             ENDDO

/**** FOR TESTING ONLY - SAVE WORKFILE CONTENTS  ****/
             IF         COND(&GRPPRF *EQ 'SBDPGMR') THEN(DO)
             CPYF       FROMFILE(PPB6CPP) +
                          TOFILE(OMSDEVGEN/PPB6CPPSV) +
                          MBROPT(*REPLACE) CRTFILE(*YES)
             ENDDO

 END:        ENDPGM
