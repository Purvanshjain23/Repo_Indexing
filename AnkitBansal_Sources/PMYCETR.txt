// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMYCETR
// ?Date: 14.08.2025 Time: 03:44:30
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?PIO 11/26/24 We are recompiling the program as index is used in SQL Query
EXECUTE FUNCTION(VAL Set Inter. Access  IF) TYPE(EXCINTFUN)                     AC1144606;
PARAMETER('OMS');
PARAMETER(LCL.Company_Number);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Allow_Multi_Company);
PARAMETER(PAR.Default_Printer);
PARAMETER(PAR.Salesperson_Code);

//?USER: Initialize screen for new transaction

MOVE *ALL (To: CTL From: PAR);

// CTL.ARHN Note Date = JOB.*Job date
CTL.ARHN_Note_Date = JOB.*Job_date;

// CTL.ARHN Note Time = JOB.*Job time *HHMM
CTL.ARHN_Note_Time = TIMEDTLS(JOB.*Job_time 'HM');

// CTL.ARHN Note Created By = JOB.*USER
CTL.ARHN_Note_Created_By = JOB.*USER;

//?USER: Initialize screen for old transaction

MOVE *ALL (To: CTL From: PAR);

//?USER: Validate header non-key fields

CASE;

// IF CTL.ARHN Follow Up Date is Entered
IF CTL.ARHN_Follow_Up_Date <> *ZERO;

// CTL.ARHN Follow Up Status = CND.Open
CTL.ARHN_Follow_Up_Status = 'O';

// IF *OTHERWISE
IF *OTHERWISE;

// CTL.ARHN Follow Up Status = CND.None
CTL.ARHN_Follow_Up_Status = *BLANK;

ENDIF;

//?USER: Create header DBF record

EXECUTE FUNCTION(Crt Note Header       CR) TYPE(CRTOBJ) FILE(PMEDCPP)           AC1898526;
PARAMETER(CTL.Company_Number);
PARAMETER(CTL.Invoice_Number);
PARAMETER(CTL.Invoice_Suffix);
PARAMETER(CTL.ARHN_Note_Number);
PARAMETER(CTL.ARHN_Note_Date);
PARAMETER(CTL.ARHN_Note_Time);
PARAMETER(CTL.ARHN_Note_Created_By);
PARAMETER(CTL.ARHN_Follow_Up_Date);
PARAMETER(CTL.ARHN_Follow_Up_Status);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_Date);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_Time);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_By);
PARAMETER(CTL.AR_Customer_Number);
PARAMETER(CTL.Sales_Route_Code);
PARAMETER(CTL.Record_Status);
PARAMETER(CTL.Create_Date);
PARAMETER(CTL.Create_Time);
PARAMETER(CTL.Create_User);
PARAMETER(CTL.Create_Program);
PARAMETER(CTL.Change_Date);
PARAMETER(CTL.Change_Time);
PARAMETER(CTL.Change_User);
PARAMETER(CTL.Change_Program);

//?USER: Change header DBF record

EXECUTE FUNCTION(Chg Note Header       CH) TYPE(CHGOBJ) FILE(PMEDCPP)           AC1898527;
PARAMETER(CTL.Company_Number);
PARAMETER(CTL.Invoice_Number);
PARAMETER(CTL.Invoice_Suffix);
PARAMETER(CTL.ARHN_Note_Number);
PARAMETER(CTL.ARHN_Note_Date);
PARAMETER(CTL.ARHN_Note_Time);
PARAMETER(CTL.ARHN_Note_Created_By);
PARAMETER(CTL.ARHN_Follow_Up_Date);
PARAMETER(CTL.ARHN_Follow_Up_Status);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_Date);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_Time);
PARAMETER(CTL.ARHN_Follow_Up_Cmplt_By);
PARAMETER(CTL.AR_Customer_Number);
PARAMETER(CTL.Sales_Route_Code);
PARAMETER(CTL.Record_Status);
PARAMETER(CTL.Create_Date);
PARAMETER(CTL.Create_Time);
PARAMETER(CTL.Create_User);
PARAMETER(CTL.Create_Program);
PARAMETER(CTL.Change_Date);
PARAMETER(CTL.Change_Time);
PARAMETER(CTL.Change_User);
PARAMETER(CTL.Change_Program);

//?USER: Change detail DBF record

EXECUTE FUNCTION(Chg Note Detail       CH) TYPE(CHGOBJ) FILE(PMEFCPP)           AC1899451;
PARAMETER(RCD.Company_Number);
PARAMETER(RCD.Invoice_Number);
PARAMETER(RCD.Invoice_Suffix);
PARAMETER(RCD.ARHN_Note_Number);
PARAMETER(RCD.ARHN_Note_Line_Number);
PARAMETER(RCD.ARHN_Detail_Note_Line);
PARAMETER(RCD.Record_Status);
PARAMETER(RCD.Create_Date);
PARAMETER(RCD.Create_Time);
PARAMETER(RCD.Create_User);
PARAMETER(RCD.Create_Program);
PARAMETER(RCD.Change_Date);
PARAMETER(RCD.Change_Time);
PARAMETER(RCD.Change_User);
PARAMETER(RCD.Change_Program);

//?USER: Create detail DBF record

EXECUTE FUNCTION(Crt Note Detail       IF) TYPE(EXCINTFUN) FILE(PMEFCPP)        AC1899581;
PARAMETER(RCD.Company_Number);
PARAMETER(RCD.Invoice_Number);
PARAMETER(RCD.Invoice_Suffix);
PARAMETER(RCD.ARHN_Note_Number);
PARAMETER(RCD.ARHN_Note_Line_Number);
PARAMETER(RCD.ARHN_Detail_Note_Line);
PARAMETER(RCD.Record_Status);
PARAMETER(RCD.Create_Date);
PARAMETER(RCD.Create_Time);
PARAMETER(RCD.Create_User);
PARAMETER(RCD.Create_Program);
PARAMETER(RCD.Change_Date);
PARAMETER(RCD.Change_Time);
PARAMETER(RCD.Change_User);
PARAMETER(RCD.Change_Program);

