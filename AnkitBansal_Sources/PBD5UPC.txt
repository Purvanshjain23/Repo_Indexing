/***************************************************************** */
/*                                                                 */
/*                   Clone from  PDJSUPR                           */
/*  PROGRAM NUMBER:  PBD5UPC                                       */
/*  PROGRAM NAME:    Print Production Schedule/Plan                */
/*  PROGRAMMER:      Susan Mason                                   */
/*  CREATE DATE:     08/09/12                                      */
/*                                                                 */
/*  FUNCTION:        This CLP is submitted with an Execute Message */
/*                   from Display 1st Level Production.            */
/*                                                                 */
/*              E02098 GENERIC PROGRAM FOR PRIMAL SCHEDULES        */
/*              REPORT WILL HAVE BOXES AND COMBOS                  */
/*              No more Belly, trim                                */
/*              This is all controled at the Item Category         */
/*              The company item category 06 will now be controled */
/*              by the production team as which Items go on which  */
/*              report.                                            */
/*                                                                 */
/*                   USER OPTIONS ARE PASSED THROUGH THE PARMS.    */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*******************************************************************/
/*  S MASON     08/09/12 New Generic Prt Schedule for              */
/*              for Belly/Trim/Picnic                              */
/*                                                                 */
/*              Program PBD6XFR will now read the Item Category    */
/*              for Item Catefory 06 record and then veify each    */
/*              Primal Grp Rpt to see if this should be run        */
/*              and if so then the PBD5UPC will be executed        */
/*              in a user message USR4528                          */
/*                                                                 */
/*              Program PBD6XFR will be processed in the following */
/*                                                                 */
/*              Program PMB2UPC which runs in the INVNIGHT JOBS    */
/*                                                                 */
/*              Program PMBUPVR is the selection on demand         */
/*                                                                 */
/*              Job Schd  PPSBELLTRM  will kick this off           */
/*              in the afternoon.                                  */
/*                                                                 */
/*  S MASON     E02202 Pass in the production run number           */
/*              create data to a Summary and Detail file           */
/*              Summary data will be prepared for Carlisle         */
/*              in program PBD6XFR, and the 7 min job from         */
/*              job sch will take this data and place with         */
/*              guy or stjoe appended at the end.                  */
/*              Then Carlisle will take and download into their    */
/*              application                                        */
/*              Will no longer send any data used on spread sheet  */
/*              Curt is getting with user and this logic is being  */
/*              removed from this process.                         */
/*              Guymon and Triumph will be able  to access         */
/*              from Carlisle                                      */
/*  S MASON     E2745 PASS THE BASE LINE                           */
/*  S MASON     E2745 PASS SEQUEL SELECTION = NO                   */
/*  J HIGH      E3796 02/19/15 - Changed input parameter from      */
/*              "Prod Date Alpha USR" to "RqsShp Date Alpha USR".  */
/*              No logic changes.                                  */
/***************************************************************** */

             PGM        PARM(&RTN &XCOPIES &XCOMP &PDEV &HOLD &SAVE +
                          &APP &XDATE &CMTSTS &WHSE &EMAIL +
                          &HOLDOV &SUMBOX &ICATE &PSRUN &BASELNE)

/*-----------------------------------------------------------------*/
/*                      PARAMETER                                  */
/*-----------------------------------------------------------------*/
/* Print Options                                                   */
             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&XCOPIES) TYPE(*CHAR) LEN(02)
             DCL        VAR(&XCOMP) TYPE(*CHAR) LEN(03)
             DCL        VAR(&PDEV) TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL        VAR(&APP) TYPE(*CHAR) LEN(6)
/* Function Specific                                               */
             DCL        VAR(&XDATE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&CMTSTS) TYPE(*CHAR) LEN(1)
             DCL        VAR(&WHSE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(1)
             DCL        VAR(&HOLDOV) TYPE(*CHAR) LEN(1)
             DCL        VAR(&SUMBOX) TYPE(*CHAR) LEN(1)
             DCL        VAR(&PSRUN) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&BASELNE) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ICATE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&ICDESC) TYPE(*CHAR) LEN(30)
             DCL        VAR(&ICTDSC) TYPE(*CHAR) LEN(30)
/* Email distribution list.                                        */
/* Name of the distriubtion list that will be used                 */
             DCL        VAR(&DISTLST) TYPE(*CHAR) LEN(40)
             DCL        VAR(&DISTNME) TYPE(*CHAR) LEN(60)
/* Name of the distriubtion list for the Report type D             */
             DCL        VAR(&DIST) TYPE(*CHAR) LEN(10) /* DIST LIST*/
/* Setup to email the Production Schedule via Spread Sheet        */
             DCL        VAR(&TEXT) TYPE(*CHAR) LEN(50) /* +
                          DESCRIPTION        */
/* Misc varialables                                               */
             DCL        VAR(&MDATE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PGMPRTF) TYPE(*CHAR) LEN(10) +
                          VALUE('PBDKPFR$')
             DCL        VAR(&VALDISTPL) TYPE(*CHAR) LEN(10) +
                          VALUE(PRDSPSHEET) /*COMP VALU*/


             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10) /* DATA +
                          FILES      */
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10) /* HIST +
                          FILES      */

/*-----------------------------------------------------------------*/
/*                    PROGRAM VARIABLES                            */
/*-----------------------------------------------------------------*/
             DCL        VAR(&COPIES) TYPE(*DEC) LEN(2 0)

             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&COMPA) TYPE(*CHAR) LEN(3)
             DCL        VAR(&DATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&NDATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&NDATE2) TYPE(*DEC) LEN(7 0)

             DCL        VAR(&DESC) TYPE(*CHAR) LEN(50)

             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&USRCLS) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BLK30) TYPE(*CHAR) LEN(30)

/*                                                                   */
             RTVJOBA    USER(&USER)
             RTVUSRPRF  USRPRF(&USER) USRCLS(&USRCLS)
/*-----------------------------------------------------------------*/
/*                     INITIALIZATION                              */
/*-----------------------------------------------------------------*/
             CHGVAR     VAR(&COPIES) VALUE(&XCOPIES)
             CHGVAR     VAR(&COMP) VALUE(&XCOMP)
             CHGVAR     VAR(&COMPA) VALUE(&COMP)
             CHGVAR     VAR(&DATE) VALUE(&XDATE)
             CVTDAT     DATE(&XDATE) TOVAR(&MDATE) FROMFMT(*CYMD) +
                          TOFMT(*MDYY) TOSEP(/)

             chgvar     VAR(&ICDESC) value(&BLK30)
             chgvar     VAR(&ICTDSC) value(&BLK30)

/*-----------------------------------------------------------------*/
/*                           MAIN                                  */
/*-----------------------------------------------------------------*/

             OVRPRTF    FILE(PBDKPFR$) OUTQ(&PDEV) COPIES(&COPIES) +
                          HOLD(&HOLD) SAVE(&SAVE)

/*-----------------------------------------------------------------*/
/* Get the data name of the library where we will copy from        */
/*-----------------------------------------------------------------*/
             CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

/********************************************************************/
/* 11/20/2008 SUSAN MASON                                           */
/* ADDED ADDITION LOGIC DUE TO ERROR ON BB                          */
/********************************************************************/
/* COPY TO QTEMP, BUT IF ALREADY THERE THEN WILL GO TO CPYFEND      */
/* NIGHTLY RUN EXECUTE OF THIS JOB STREAM BACK TO BACK              */
/* THE DATA IS IN QTEMP, BUT QTEMP DOES NOT GO AWAY                 */
/* NO NEED TO DELETE THIS WORK FILE IN QTEMP                        */
/* BECAUSE PROGRAM THAT CREATES THE WORK FILE WILL REMOVE ALL       */
/* RECORDS BEFORE STARTING.                                         */
/* WHEN JOB IS SELECT ON DEMAND THEN THE FILES IN QTEMP WILL        */
/* BE GONE.                                                         */
/********************************************************************/
 CPYBEG:

             CRTDUPOBJ  OBJ(PMEUCPP) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             MONMSG     MSGID(CPF2130) EXEC(GOTO CMDLBL(CPYFEND))

             CRTDUPOBJ  OBJ(PMEUCPL0) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL1) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL2) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL3) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL4) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL5) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL6) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL7) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL8) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PMEUCPL9) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

 CPYFEND:

             CLRPFM     FILE(QTEMP/PMEUCPP)

/* Get the Item Category Report Description and the Email Distribution */
/* Get the Description for the Print Primal Grp Report */
/* Get the Email Distribution for the email portion    */

             CALL       PGM(PBERXFR) PARM(' ' &COMP &ICATE &ICDESC +
                          &ICTDSC)

/* create work file        */
/* PMEUCPP     *FILE       PF-DTA      WF OrderProd Schedule         */
/* Restrict by Company number, Warehouse Code, REQUESTED Ship Date,   */

             CALL       PGM(PMAPXFR) PARM(' ' &COMP &WHSE &DATE +
                          &HOLDOV &NDATE &NDATE2 &ICATE)


CPYFLST:

/* --------------------------------------------------------------- */
/* Print Primal Grp Reports                                        */
/* ICATE AND ICDESC will have the correct report code and desc     */
/* --------------------------------------------------------------- */
/* PMEUCPP     *FILE       PF-DTA      WF OrderProd Schedule       */
/*  is read to summary the totals for combo's                      */
/*  and to print the order detail information for the detail line  */
/*  and to create                                                  */
/*  records to the PBAHCPP PS Prod Item Sch Sum Rpt                */
/*  if the PSRUN is greater then zero                              */
/*  and to create                                                  */
/*  records to the PBANCPP PS Prod Item Sch Dtl Rpt                */
/*  if the PSRUN is greater then zero.                             */
/* --------------------------------------------------------------- */
/* PDI8CPP     *FILE       PF-DTA      PS Prod Item Schedule       */
/*  is read to summary the totals for boxes                        */
/*  and to create                                                  */
/*  records to the PBAHCPP PS Prod Item Sch Sum Rpt                */
/*  if the PSRUN is greater then zero.                             */
/* --------------------------------------------------------------- */
/* PSRUN  If greater the zero then the following files will        */
/*        be built when this report is run.                        */
/* PBAHCPP     *FILE       PF-DTA      PS Prod Item Sch Sum Rpt    */
/* PBANCPP     *FILE       PF-DTA      PS Prod Item Sch Dtl Rpt    */
/*                                                                  */
/* After this all reports are completed, then                      */
/* program PBD6XFR will read the PBAHCPP and create the records    */
/* to:                                                             */
/* PPA9CPP     *FILE       PF-DTA      PFS Production Schedulep     */
/* there is a 7min job that will take this data and move it to      */
/* the proper place that Carlisle will then pick up.                */
/* ---------------------------------------------------------------  */
/* FOR TESTING ONLY                           */
/*           CPYF       FROMFILE(PMEUCPP) +             */
/*                        TOFILE(PRKTESTF/PMEUCPPSAV) + */
/*                        MBROPT(*REPLACE)              */
/* FOR TESTING ONLY                           */

             CALL       PGM(PBDKPFR) PARM(' ' &WHSE &COMP &DATE +
                          &CMTSTS &HOLDOV &NDATE &NDATE2 &SUMBOX +
                          &ICATE &ICDESC &PSRUN &BASELNE)

/* ---------------------------------------------------------------  */
/* EMAIL  *** EMAIL ***                                             */
/* build the subject line                                           */
/* build the company value record to be retrieve                    */
/* Get the company value                                            */
/* Use &DISTLST as the distro list in the receipent of the esend    */
/* command                                                          */
/* ---------------------------------------------------------------  */
                IF        COND(&EMAIL *EQ 'E') THEN(DO)
/* ---------------------------------------------------------------  */
             CHGVAR     VAR(&DESC) VALUE('                      ')

             CHGVAR     VAR(&DESC) VALUE(&ICDESC *BCAT &COMPA +
                          *BCAT 'for' *BCAT &MDATE)

             CHGVAR     VAR(&DISTNME) VALUE('Distribution List: ' +
                          *BCAT &ICTDSC)

/* ---------------------------------------------------------------  */
/* Email of the Belly Report or of the Trim Report or Picnic        */
/* ---------------------------------------------------------------  */

             ESEND/ESNDMAIL RECIPIENT(&ICTDSC) SUBJECT(&DESC) +
                          MSG(&DISTNME) OVRUSROPT(PDSBURK) +
                          ATTLIST((* *PDF *N &PGMPRTF))
                ENDDO
/* ---------------------------------------------------------------  */
/* ----   No longer will be used  Curt is stopping this with -----  */
/* ----   the users.                                         -----  */
/* ---------------------------------------------------------------  */
/* ----   This all maybe removed on next enhancement.        -----  */
/* ---------------------------------------------------------------  */
/* build the subject line                                           */
/* build the company value record to be retrieve                    */
/* Get the company value                                            */
/* Use &DISTLST as the distro list in the receipent of the esend    */
/* command                                                          */
/* ---------------------------------------------------------------  */
/*           IF         COND(&PSRUN *NE 0000000) THEN(DO)           */
/* Now send the work file by email using distribution list          */
/********************************************************************/
/*   GET DIST LIST FROM INPUT COMPANY VALUE: PRDSPLSHEET            */
/********************************************************************/
/*           CALL       PGM(POMTXFR) PARM('' &COMP &VALDISTPL &DIST)*/
/*                                                                  */
/*           CHGVAR     VAR(&TEXT) VALUE('Production Schedule +     */
/*                        in .xls format')                          */
/*                                                                  */
/*           IF         COND(&COMP *EQ 360) THEN(DO)                */
/*           CHGVAR     VAR(&TEXT) VALUE('360 Production Schedule + */
/*                        in .xls format')                          */
/*                        ENDDO                                     */
/*                                                                  */
/*           IF         COND(&COMP *EQ 960) THEN(DO)                */
/*           CHGVAR     VAR(&TEXT) VALUE('960 Production Schedule + */
/*                        in .xls format')                          */
/*                        ENDDO                                     */
/*                                                                  */
/**                                                                 */
/******      EXECUTE    VIEW(*LIBL/PRDSPSHEET) PCFMT(*XLS) +        */
/**                       RECIPIENT(&DIST) EMLMSG(&TEXT)            */
/*                        ENDDO                                     */
/* ---------------------------------------------------------------  */
/* ----   This all maybe removed on next enhancement.        -----  */
/* ---------------------------------------------------------------  */


                          GOTO ENDPGM
MSGTRAP:
             SNDMSG     MSG('Request Failed. Please contact IT.') +
                          TOUSR(*REQUESTER)
/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 ENDPGM:
             DLTOVR     FILE(*ALL)
             ENDPGM
