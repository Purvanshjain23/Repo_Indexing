// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUKKPFR
// ?Date: 14.08.2025 Time: 12:06:58
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?RMC Get cert from Application
//?RMC Print Vietnam Letterhead:
//? L = overlay viet1 = Offal Pork Vietnam
//?USER: Print required level headings

CASE;

IF NEW Company_Number;
CASE;

// IF DB1.ED Document Date is Not entered
IF DB1.ED_Document_Date = *ZERO;

// LCL.Date                  USR = JOB.*Job date
LCL.Date_USR = JOB.*Job_date;

// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Date                  USR = DB1.ED Document Date
LCL.Date_USR = DB1.ED_Document_Date;

ENDIF;

// WRK.Date (Alpha) USR = CVTVAR(LCL.Date                  USR)
WRK.Date_Alpha_USR = CVTVAR(LCL.Date_USR);

// WRK.Month/Day Alpha MMDD = SUBSTRING(WRK.Date (Alpha) USR,CON.4,CON.4)
WRK.Month_Day_Alpha_MMDD = SUBSTRING(WRK.Date_Alpha_USR:4:4);

// WRK.Year  (Char) USR = SUBSTRING(WRK.Date (Alpha) USR,CON.2,CON.2)
WRK.Year_Char_USR = SUBSTRING(WRK.Date_Alpha_USR:2:2);

// WRK.Year Alpha (YYYY) USR = CONCAT(CON.20,WRK.Year  (Char) USR,CON.*ZERO)
WRK.Year_Alpha_YYYY_USR = '20' + WRK.Year_Char_USR (*ZERO);

// WRK.Date (Char-8) USR = CONCAT(WRK.Month/Day Alpha MMDD,WRK.Year Alpha (YYYY) USR,CON.*ZERO)
WRK.Date_Char_8_USR = WRK.Month_Day_Alpha_MMDD + WRK.Year_Alpha_YYYY_USR (*ZERO);

// CUR.Date 8.0 USR = CVTVAR(WRK.Date (Char-8) USR)
CUR.Date_8_0_USR = CVTVAR(WRK.Date_Char_8_USR);

// CUR.ED Export Certificate Nbr = DB1.ED Export Certificate Nbr
CUR.ED_Export_Certificate_Nbr = DB1.ED_Export_Certificate_Nbr;

CASE;

// IF DB1.ED Export Certificate Nbr is Not Entered
IF DB1.ED_Export_Certificate_Nbr = *ZERO;

EXECUTE FUNCTION(Rtv Certificate        RT) TYPE(RTVOBJ) FILE(PDMRREP)          AC2179457;
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Order_Number);
PARAMETER('A');
PARAMETER(CUR.ED_Export_Certificate_Nbr);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


ENDIF;

// CUR.Order Number = CON.*ZERO
CUR.Order_Number = *ZERO;

//?E00421 RMC 05/26/09 get form letters from company value - copy from JPN
// CUR.ED USDA Cert Nbr US = DB1.ED USDA Cert Nbr US
CUR.ED_USDA_Cert_Nbr_US = DB1.ED_USDA_Cert_Nbr_US;

CASE;

// IF CUR.ED USDA Cert Nbr US is not entered
IF CUR.ED_USDA_Cert_Nbr_US = *BLANK;

EXECUTE FUNCTION(RTV 1st Warehouse/Ctl  RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1360958;
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.Order_Number);
PARAMETER(0);
PARAMETER(0);
PARAMETER(LCL.Warehouse_Code);
PARAMETER(NLL.Trans_Contol_AS400_Plant);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Warehouse Control  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1304300;
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(PAR.Trans_Contol_AS400_Plant);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


EXECUTE FUNCTION(RTV Warehouse Type     RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1285482;
PARAMETER(LCL.Warehouse_Code);
PARAMETER(LCL.Warehouse_Type);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Get Fresh /frozen to get which form name to use    RMC 12/10/08
CASE;

// IF LCL.Warehouse Type is Fresh
IF LCL.Warehouse_Type = 'FR';

// WRK.Company Value Code = CON.MPGFRLTR
WRK.Company_Value_Code = 'MPGFRLTR';

//?Get Fresh /frozen to get which form name to use    RMC 12/10/08
// IF LCL.Warehouse Type is Frozen
IF LCL.Warehouse_Type = 'FZ';

// WRK.Company Value Code = CON.MPGFZLTR
WRK.Company_Value_Code = 'MPGFZLTR';

//?Get Fresh /frozen to get which form name to use    RMC 12/10/08
// IF *OTHERWISE
IF *OTHERWISE;

//?default to something
// WRK.Company Value Code = CON.MPGFRLTR
WRK.Company_Value_Code = 'MPGFRLTR';

ENDIF;

EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
PARAMETER(DB1.Company_Number);
PARAMETER(WRK.Company_Value_Code);
PARAMETER(WRK.USR_Old_New_prtf_designtn);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// CUR.ED USDA Cert Nbr US = WRK.USR Old/New prtf designtn
CUR.ED_USDA_Cert_Nbr_US = WRK.USR_Old_New_prtf_designtn;

ENDIF;

// Print Company Number header format
PRINT Company Number header format;

ENDIF;

// SUPPRESSED PRINT Order Number header format

// SUPPRESSED PRINT ED Export Document Type header format

//?USER: Print required level totals

// SUPPRESSED PRINT ED Export Document Type totals format

// SUPPRESSED PRINT Order Number totals format

CASE;

IF NEW Company_Number;
//?this is on the overlay
CASE;

// IF CUR.ED Export Document Type is Letterhead-Offal(Organs)
IF CUR.ED_Export_Document_Type = 'S';

CASE;

// IF CUR.ED Title of Official is dvm usda veterinaria
IF CUR.ED_Title_of_Official = 'DVM USDA Veterinaria';

// CUR.Text USR 23 = CON.DVM USDA Veterinarian
CUR.Text_USR_23 = 'DVM USDA Veterinarian';

// IF *OTHERWISE
IF *OTHERWISE;

// CUR.Text USR 23 = CUR.ED Title of Official
CUR.Text_USR_23 = CUR.ED_Title_of_Official;

ENDIF;

ENDIF;

// Print Company Number totals format
PRINT Company Number totals format;

ENDIF;

