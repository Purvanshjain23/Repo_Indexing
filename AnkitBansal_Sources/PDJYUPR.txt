     H/TITLE NATV UPD LOAD STOP DATA -- COPIED FROM XF
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : SYNON/2  Version:  1035
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 02/26/98  Time  : 14:01:22
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   : R CENTONZE   SET ON TIME FLAG TO Y IF THE EST
      *     ARRIVAL DATE/IIME IS EARLIER THAN THE REQ DELVRY DT/TIME.
      *     SCAN: RC072998
      *================================================================
     FPDLDSTOPIF  E                    DISK
      * PHY : ARRIVAL
      *
     FOMFLCPL2IF  E           K        DISK
      * RSQ : OM Load Detail            Co/Load/Stop
      *
     FOPBFCPL1IF  E           K        DISK
      * RTV : PD Order Header           Retrieval index       NV
      *
     FOMFLCPL0UF  E           K        DISK
      * UPD : OM Load Detail            Update index
      *
     I@SZCPR8
      * PD Load Stop Data UPL     FIFO
      * Renamed input format fields
     I              SZYACD                          WAYACD
     I              SZX8CD                          WAX8CD
     I              SZYDCD                          WAYDCD
     I              SZYBCD                          WAYBCD
     I              SZNOTX                          WANOTX
     I              SZNPTX                          WANPTX
     I              SZDXTX                          WADXTX
     I              SZYECD                          WAYECD
     I              SZBRTX                          WABRTX
     I              SZHNNA                          WAHNNA
     I              SZYCCD                          WAYCCD
     I              SZNQTX                          WANQTX
     I              SZNRTX                          WANRTX
     I              SZNSTX                          WANSTX
     I              SZNTTX                          WANTTX
     I              SZNUTX                          WANUTX
     I              SZNVTX                          WANVTX
     I              SZNWTX                          WANWTX
     I              SZW5CD                          WAW5CD
     I              SZNXTX                          WANXTX
      *
     I@FLCPEB
      * OM Load Detail            Co/Load/Stop
      * Renamed input format fields
     I              FLAIC3                          WBAIC3
     I              FLRMNB                          WBRMNB
     I              FLRUNB                          WBRUNB
     I              FLRVNB                          WBRVNB
     I              FLDQTX                          WBDQTX
     I              FLRWNB                          WBRWNB
     I              FLRXNB                          WBRXNB
     I              FLSQNB                          WBSQNB
     I              FLT0NB                          WBT0NB
     I              FLT1NB                          WBT1NB
     I              FLR1NB                          WBR1NB
     I              FLC4NB                          WBC4NB
     I              FLVCST                          WBVCST
     I              FLKEDT                          WBKEDT
     I              FLSXNB                          WBSXNB
     I              FLKFDT                          WBKFDT
     I              FLACTM                          WBACTM
     I              FLK5TX                          WBK5TX
     I              FLW5CD                          WBW5CD
     I              FLEJDT                          WBEJDT
     I              FLAGTM                          WBAGTM
     I              FLKJDT                          WBKJDT
     I              FLATTM                          WBATTM
     I              FLHDDT                          WBHDDT
     I              FLAUTM                          WBAUTM
     I              FLKKDT                          WBKKDT
     I              FLAVTM                          WBAVTM
     I              FLZ4NB                          WBZ4NB
     I              FLY7ST                          WBY7ST
     I              FLY2ST                          WBY2ST
     I              FLUVST                          WBUVST
     I              FLUWST                          WBUWST
     I              FLUXST                          WBUXST
     I              FLAATM                          WBAATM
     I              FLAYNA                          WBAYNA
     I              FLA0NA                          WBA0NA
     I              FLAXDT                          WBAXDT
      *
     I@BECPFK
      * PD Order Header           Retrieval index       NV
      * Renamed input format fields
     I              BEAIC3                          WCAIC3
     I              BEC4NB                          WCC4NB
     I              BEJNCD                          WCJNCD
     I              BEANC7                          WCANC7
     I              BEBKC7                          WCBKC7
     I              BEBRTX                          WCBRTX
     I              BEHMNA                          WCHMNA
     I              BEHONA                          WCHONA
     I              BEHPNA                          WCHPNA
     I              BEHNNA                          WCHNNA
     I              BEDBCD                          WCDBCD
     I              BECKTX                          WCCKTX
     I              BEB0C7                          WCB0C7
     I              BEAETX                          WCAETX
     I              BEB1NA                          WCB1NA
     I              BEB3NA                          WCB3NA
     I              BEB4NA                          WCB4NA
     I              BEB2NA                          WCB2NA
     I              BEBHCD                          WCBHCD
     I              BEC8TX                          WCC8TX
     I              BEBCNA                          WCBCNA
     I              BEA0DT                          WCA0DT
     I              BEA5DT                          WCA5DT
     I              BEGNDT                          WCGNDT
     I              BEACDT                          WCACDT
     I              BEAQCD                          WCAQCD
     I              BEB6NA                          WCB6NA
     I              BEBYNA                          WCBYNA
     I              BEBZNA                          WCBZNA
     I              BEGTST                          WCGTST
     I              BEGVST                          WCGVST
     I              BEGUST                          WCGUST
     I              BEQFST                          WCQFST
     I              BECQCD                          WCCQCD
     I              BEGJST                          WCGJST
     I              BEGWST                          WCGWST
     I              BEGXST                          WCGXST
     I              BEGYST                          WCGYST
     I              BEAODT                          WCAODT
     I              BEAIVN                          WCAIVN
     I              BECXDT                          WCCXDT
     I              BEJZVA                          WCJZVA
     I              BEA1WG                          WCA1WG
     I              BEXIST                          WCXIST
     I              BEXJST                          WCXJST
     I              BEXKST                          WCXKST
     I              BEEIDT                          WCEIDT
     I              BEAFTM                          WCAFTM
     I              BEE8CD                          WCE8CD
     I              BEE9CD                          WCE9CD
     I              BERMNB                          WCRMNB
     I              BETBNB                          WCTBNB
     I              BER1NB                          WCR1NB
     I              BEPJST                          WCPJST
     I              BEU0ST                          WCU0ST
     I              BEU1ST                          WCU1ST
     I              BEQ2CD                          WCQ2CD
     I              BEU2ST                          WCU2ST
     I              BEVEST                          WCVEST
     I              BEVFST                          WCVFST
     I              BEVGST                          WCVGST
     I              BERPCD                          WCRPCD
     I              BERNNB                          WCRNNB
     I              BEVDST                          WCVDST
     I              BEATIN                          WCATIN
     I              BEU4ST                          WCU4ST
     I              BEU5ST                          WCU5ST
     I              BERSRN                          WCRSRN
     I              BEMHNA                          WCMHNA
     I              BEMINA                          WCMINA
     I              BEWBST                          WCWBST
     I              BER4CD                          WCR4CD
     I              BEBFCD                          WCBFCD
     I              BEQ4CD                          WCQ4CD
     I              BET3NB                          WCT3NB
     I              BESICD                          WCSICD
     I              BECONB                          WCCONB
     I              BECEST                          WCCEST
     I              BEAWDT                          WCAWDT
     I              BEJPCD                          WCJPCD
     I              BEXUST                          WCXUST
     I              BEZ1ST                          WCZ1ST
     I              BEVRVA                          WCVRVA
     I              BEOBST                          WCOBST
     I              BEBCST                          WCBCST
     I              BEBDST                          WCBDST
     I              BEUVST                          WCUVST
     I              BEUWST                          WCUWST
     I              BEUXST                          WCUXST
     I              BEAATM                          WCAATM
     I              BEAYNA                          WCAYNA
     I              BEA0NA                          WCA0NA
     I              BEAXDT                          WCAXDT
      *
     I@FLCPBM
      * OM Load Detail            Update index
      * Renamed input format fields
     I              FLAIC3                          WDAIC3
     I              FLRMNB                          WDRMNB
     I              FLRUNB                          WDRUNB
     I              FLRVNB                          WDRVNB
     I              FLDQTX                          WDDQTX
     I              FLRWNB                          WDRWNB
     I              FLRXNB                          WDRXNB
     I              FLSQNB                          WDSQNB
     I              FLT0NB                          WDT0NB
     I              FLT1NB                          WDT1NB
     I              FLR1NB                          WDR1NB
     I              FLC4NB                          WDC4NB
     I              FLVCST                          WDVCST
     I              FLKEDT                          WDKEDT
     I              FLSXNB                          WDSXNB
     I              FLKFDT                          WDKFDT
     I              FLACTM                          WDACTM
     I              FLK5TX                          WDK5TX
     I              FLW5CD                          WDW5CD
     I              FLEJDT                          WDEJDT
     I              FLAGTM                          WDAGTM
     I              FLKJDT                          WDKJDT
     I              FLATTM                          WDATTM
     I              FLHDDT                          WDHDDT
     I              FLAUTM                          WDAUTM
     I              FLKKDT                          WDKKDT
     I              FLAVTM                          WDAVTM
     I              FLZ4NB                          WDZ4NB
     I              FLY7ST                          WDY7ST
     I              FLY2ST                          WDY2ST
     I              FLUVST                          WDUVST
     I              FLUWST                          WDUWST
     I              FLUXST                          WDUXST
     I              FLAATM                          WDAATM
     I              FLAYNA                          WDAYNA
     I              FLA0NA                          WDA0NA
     I              FLAXDT                          WDAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQOMFL1    E DSOMFLCPL0
      * UPD : OM Load Detail            Update index
      * Renamed input format fields
     I              FLAIC3                          WDAIC3
     I              FLRMNB                          WDRMNB
     I              FLRUNB                          WDRUNB
     I              FLRVNB                          WDRVNB
     I              FLDQTX                          WDDQTX
     I              FLRWNB                          WDRWNB
     I              FLRXNB                          WDRXNB
     I              FLSQNB                          WDSQNB
     I              FLT0NB                          WDT0NB
     I              FLT1NB                          WDT1NB
     I              FLR1NB                          WDR1NB
     I              FLC4NB                          WDC4NB
     I              FLVCST                          WDVCST
     I              FLKEDT                          WDKEDT
     I              FLSXNB                          WDSXNB
     I              FLKFDT                          WDKFDT
     I              FLACTM                          WDACTM
     I              FLK5TX                          WDK5TX
     I              FLW5CD                          WDW5CD
     I              FLEJDT                          WDEJDT
     I              FLAGTM                          WDAGTM
     I              FLKJDT                          WDKJDT
     I              FLATTM                          WDATTM
     I              FLHDDT                          WDHDDT
     I              FLAUTM                          WDAUTM
     I              FLKKDT                          WDKKDT
     I              FLAVTM                          WDAVTM
     I              FLZ4NB                          WDZ4NB
     I              FLY7ST                          WDY7ST
     I              FLY2ST                          WDY2ST
     I              FLUVST                          WDUVST
     I              FLUWST                          WDUWST
     I              FLUXST                          WDUXST
     I              FLAATM                          WDAATM
     I              FLAYNA                          WDAYNA
     I              FLA0NA                          WDA0NA
     I              FLAXDT                          WDAXDT
      *
     IYARDCS      DS                            199
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * B :  Last Load Stop RRN    USR
     I                                    P   1   30P1LSRN
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1LSRN    PARM P1LSRN    WP0001  50       Last Load Stop
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * exc
      * ZZv Upd Load Dtl fifo RT - PD Load Stop Data UPL  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * ZZv Upd Load Dtl fifo RT - PD Load Stop Data UPL  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       USR Date - ATR
     C                     Z-ADD*ZERO     WN0002  40       USR Time 4.0
     C                     MOVEL*BLANK    WN0003 16        USR Date & Time
     C                     Z-ADD*ZERO     WN0004  70       Estimated Arriv
     C                     Z-ADD*ZERO     WN0005  60       Estimated Arriv
     C                     Z-ADD*ZERO     WN0006  70       Actual Delivery
     C                     Z-ADD*ZERO     WN0007  60       Actual Delivery
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position - READ LAST RRN FROM DTAARA LASTRRN
      *
     C           P1LSRN    IFNE 0
     C           P1LSRN    CHAIN@SZCPR8              90    *
     C                     ENDIF
     C*
     C           *IN90     IFEQ '0'
      *
     C                     READ @SZCPR8                  90*
      * Data record not found
     C   90                MOVEL'USR2609' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  1         P1LSRN           Last Load Stop
     C                     MOVE WAYACD    WUAIC3           Company Number
     C                     MOVE WAYDCD    WURMNB           Load ID
     C                     MOVE WAYBCD    WURVNB           Stop/Drop
     C                     MOVE WAYECD    WUC4NB           Order Number
     C                     Z-ADD*ZERO     WN0004           Estimated Arriv
     C                     Z-ADD*ZERO     WN0005           Estimated Arriv
     C                     Z-ADD*ZERO     WN0006           Actual Delivery
     C                     Z-ADD*ZERO     WN0007           Actual Delivery
      * Format Estimated Arrival Date/time   'mm/dd/yyyy hh:mm'
      * CASE: DB1.Estimated Arrival Dt 10A NE WRK.BLANK 1               U
     C           WANQTX    IFNE WUJ1TX                     *IF
     C                     Z-ADD1         ZQ      50
     C           WANQTX    CAT  WANRTX:ZQ WN0003    P      USR Date & Time
      * Fmt Long Date to CYMD  IF - PD Load Stop Data  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0003    WL0001    P      USR Date & Time
     C                     EXSR SBINFN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0002    WN0001           USR Date - ATR
     C                     Z-ADDWL0003    WN0002           USR Time 4.0
     C                     Z-ADDWN0001    WN0004           Estimated Arriv
     C           WN0002    MULT 100       WN0005           Estimated Arriv
     C                     END                             *FI
      * Format Actual Delivery Date/time     'mm/dd/yyyy hh:mm'
      * CASE: DB1.Actual Delivery Date 10A NE WRK.BLANK 1               U
     C           WANSTX    IFNE WUJ1TX                     *IF
     C                     Z-ADD1         ZQ      50
     C           WANSTX    CAT  WANTTX:ZQ WN0003    P      USR Date & Time
      * Fmt Long Date to CYMD  IF - PD Load Stop Data  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0003    WL0001    P      USR Date & Time
     C                     EXSR SBINFN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0002    WN0001           USR Date - ATR
     C                     Z-ADDWL0003    WN0002           USR Time 4.0
     C                     Z-ADDWN0001    WN0006           Actual Delivery
     C           WN0002    MULT 100       WN0007           Actual Delivery
     C                     END                             *FI
      * CHG EstArv/ActDlry     RT - OM Load Detail  * 
     C                     EXSR SCRVGN
      * Exc Upd 1st Stop OnTimeXF - PD Load Stop Data UPL  * 
     C                     CALL 'PDJ9XFR'              92  Exc Upd 1st Sto
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WUAIC3    WQ0001  30       Company Number
     C                     PARM WURMNB    WQ0002  70       Load ID
     C                     PARM WURVNB    WQ0003  50       Stop/Drop
     C                     PARM WUC4NB    WQ0004  70       Order Number
      *
     C           *IN92     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDJ9XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     READ @SZCPR8                  90*
     C                     ENDDO
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBINFN    BEGSR
      *================================================================
      * Fmt Long Date to CYMD  IF - PD Load Stop Data  * 
      *================================================================
      * Fmt Long Date to CYMD  IF
      * Format MM/DD/YYYY HH:MM  to 2 fields:   CYYMMDD    and   HHMM
     C                     Z-ADD19        WUOZNB           Year Compare 2
     C                     Z-ADD2         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUMONT    P  90  Month USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD4         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUI5TX    P  90  Day USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD7         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUKATX    P  90  USR Century
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD9         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUNZTX    P  90  Year 2A USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     MOVE WUKATX    WUCTRY           Century. . . .
      * CASE: WRK.Century. . . . . . . . . EQ WRK.Year Compare 2        U
     C           WUCTRY    IFEQ WUOZNB                     *IF
     C                     Z-ADD*ZERO     ZQ      50
     C           '0'       CAT  WUNZTX:ZQ WUEZTX    P      USR Work Field
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     ZQ      50
     C           '1'       CAT  WUNZTX:ZQ WUEZTX    P      USR Work Field
     C                     END                             *FI
     C                     Z-ADD*ZERO     ZQ      50
     C           WUMONT    CAT  WUI5TX:ZQ WUOMTX    P      USR Work Field
     C                     Z-ADD*ZERO     ZQ      50
     C           WUEZTX    CAT  WUOMTX:ZQ WUVCCD    P      Date 7A
     C                     MOVE WUVCCD    WL0002           USR Date - ATR
     C                     Z-ADD2         YRSW00
     C                     Z-ADD12        ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUVDCD    P  90  Hours  2A
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD15        ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00016
     C           ZQ        ORGT 00016
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTWL0001:ZQ WUVECD    P  90  Minutes  2A
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD*ZERO     ZQ      50
     C           WUVDCD    CAT  WUVECD:ZQ WUVBCD    P      Time  4A
     C                     MOVE WUVBCD    WL0003           USR Time 4.0
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * CHG EstArv/ActDlry     RT - OM Load Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSC01           Company Number
     C           *LIKE     DEFN WBRMNB    WQSC02           Load ID
     C           *LIKE     DEFN WBRVNB    WQSC03           Stop/Drop
     C           *LIKE     DEFN WBC4NB    WQSC04           Order Number
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Load ID
     C                     KFLD           WQSC03           Stop/Drop
     C                     KFLD           WQSC04           Order Number
      * Setup key
     C                     Z-ADDWUAIC3    WQSC01           Company Number
     C                     Z-ADDWURMNB    WQSC02           Load ID
     C                     Z-ADDWURVNB    WQSC03           Stop/Drop
     C                     Z-ADDWUC4NB    WQSC04           Order Number
      * Establish starting position
     C           KRSSC     SETLL@FLCPEB                    *
     C           KRSSC     READE@FLCPEB                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1192' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT                     *QUIT
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * RTV Requested Dlvry dt RT - PD Order Header  * 
     C                     EXSR SDRVGN
     C           WUAFTM    MULT 100       WUWENB           USR Time
      * RC072998
      * Set the On Time Flag
      * CASE: PAR.ESTIMATED ARRIVAL Date is Entered
     C           WN0004    IFNE *ZERO                      *IF
      * CASE:
      *  - c1 OR (c2 AND c3)
      *   |- c1    : PAR.ESTIMATED ARRIV Date LT WRK.Requested Delivery D
      *   |- c2    : PAR.ESTIMATED ARRIV Date EQ WRK.Requested Delivery D
      *   |- c3    : PAR.ESTIMATED ARRIV time LE WRK.USR Time
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WN0004    IFLT WUEIDT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFNE '1'                        *IF
     C           WN0004    IFEQ WUEIDT                     *IF
     C           WN0005    IFLE WUWENB                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       WUY7ST           Load Dtl On Tim
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUY7ST           Load Dtl On Tim
     C                     END                             *FI
     C                     ELSE
      **CASE: *OTHERWISE
     C*                    MOVELWBY7ST    WUY7ST           Load Dtl On Tim
     C*                    END                             *FI
      * Set the On Time Flag
      * CASE: PAR.Actual Delivery Date is Entered
     C           WN0006    IFNE *ZERO                      *IF
      * CASE:
      *  - c1 OR (c2 AND c3)
      *   |- c1    : PAR.Actual Delivery Date LT WRK.Requested Delivery D
      *   |- c2    : PAR.Actual Delivery Date EQ WRK.Requested Delivery D
      *   |- c3    : PAR.Actual Delivery time LE WRK.USR Time
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WN0006    IFLT WUEIDT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFNE '1'                        *IF
     C           WN0006    IFEQ WUEIDT                     *IF
     C           WN0007    IFLE WUWENB                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       WUY7ST           Load Dtl On Tim
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUY7ST           Load Dtl On Tim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWBY7ST    WUY7ST           Load Dtl On Tim
     C                     END                             *FI
     C                     END                             *FI WN0004
      * CHG EstArv/ActDlry     CH - OM Load Detail  * 
     C                     EXSR SECHRC
     C           KRSSC     READE@FLCPEB                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Requested Dlvry dt RT - PD Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCC4NB           Order Number
      * Setup key
     C                     Z-ADDWBAIC3    WCAIC3           Company Number
     C                     Z-ADDWBC4NB    WCC4NB           Order Number
      * Establish starting position
     C           KRSSD     CHAIN@BECPFK              90    *
      * Data record not found
     C   90                MOVEL'USR0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWCEIDT    WUEIDT           Requested Deliv
     C                     Z-ADDWCAFTM    WUAFTM           Requested Deliv
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * CHG EstArv/ActDlry     CH - OM Load Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0008  50       Stop/Drop
     C                     MOVEL*BLANK    WN0009 30        Comments for Pi
     C                     Z-ADD*ZERO     WN0010  50       Miles to next s
     C                     Z-ADD*ZERO     WN0011  72       Freight Charge
     C                     Z-ADD*ZERO     WN0012  70       Actual Freight
     C                     Z-ADD*ZERO     WN0013 112       Freight Misc. C
     C                     Z-ADD*ZERO     WN0014  72       Freight Stop Ch
     C                     Z-ADD*ZERO     WN0015 112       Rated Freight
     C                     Z-ADD*ZERO     WN0016  70       Order Number
     C                     MOVEL*BLANK    WN0017  1        Ship Status
     C                     Z-ADD*ZERO     WN0018  70       Appointment Con
     C                     Z-ADD*ZERO     WN0019  60       Appointment Con
     C                     MOVEL*BLANK    WN0020 30        Confirmation Ma
     C                     MOVEL*BLANK    WN0021 10        Confirmation Nu
     C                     Z-ADD*ZERO     WN0022  70       Scheduled Deliv
     C                     Z-ADD*ZERO     WN0023  60       Scheduled Deliv
     C                     Z-ADD*ZERO     WN0024  70       Deadline Depart
     C                     Z-ADD*ZERO     WN0025  60       Deadline Depart
     C                     Z-ADD*ZERO     WN0026  70       On Yard Date
     C                     Z-ADD*ZERO     WN0027  60       On Yard Time
     C                     Z-ADD*ZERO     WN0028  70       MPC Number
     C                     MOVEL*BLANK    WN0029  1        On Time Additio
     C                     MOVEL*BLANK    WN0030  1        EDI Status 1
     C                     MOVEL*BLANK    WN0031  1        EDI Status 2
     C                     MOVEL*BLANK    WN0032  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0033  60       Job Time
     C                     MOVEL*BLANK    WN0034 10        User Id
     C                     MOVEL*BLANK    WN0035 10        Job Name
     C                     Z-ADD*ZERO     WN0036  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @FLCPBM
     C                     Z-ADDWBAIC3    WDAIC3           Company Number
     C                     Z-ADDWBRMNB    WDRMNB           Load ID
     C                     Z-ADDWBRUNB    WDRUNB           Stop/Drop Seque
      *
     C           KLCHSE    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDRMNB           Load ID
     C                     KFLD           WDRUNB           Stop/Drop Seque
     C           KLCHSE    CHAIN@FLCPBM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'OMFLCPL0'MDACP
     C                     MOVEL'@FLCPBM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOMFL1    YARDCS
      * Move non-key fields to @FLCPBM
     C                     Z-ADDWN0004    WDKEDT           Estimated Arriv
     C                     Z-ADDWN0005    WDSXNB           Estimated Arriv
     C                     Z-ADDWN0006    WDEJDT           Actual Delivery
     C                     Z-ADDWN0007    WDAGTM           Actual Delivery
     C                     MOVELWUY7ST    WDY7ST           Load Dtl On Tim
      *
      * Set PGM.*Record Data Changed flag
     C           QOMFL1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Record Stamp CHGOB IF
     C                     Z-ADD##JTM     WDAATM           Job Time
     C                     MOVEL##USR     WDAYNA           User Id
     C                     MOVEL##JOB     WDA0NA           Job Name
     C                     Z-ADD##JDT     WDAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QOMFL1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@FLCPBM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMFLCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field Load ID
     C                     Z-ADD*ZERO     WURMNB  70
      * Define work field Stop/Drop
     C                     Z-ADD*ZERO     WURVNB  50
      * Define work field Order Number
     C                     Z-ADD*ZERO     WUC4NB  70
      * Define work field BLANK 1               USR
     C                     MOVEL*BLANK    WUJ1TX 25
      * Define work field Year Compare 2        USR
     C                     Z-ADD*ZERO     WUOZNB  20
      * Define work field Month USR
     C                     MOVEL*BLANK    WUMONT  2
      * Define work field Day USR
     C                     MOVEL*BLANK    WUI5TX  2
      * Define work field USR Century
     C                     MOVEL*BLANK    WUKATX  2
      * Define work field Year 2A USR
     C                     MOVEL*BLANK    WUNZTX  2
      * Define work field Century. . . . . . . . .
     C                     Z-ADD*ZERO     WUCTRY  20
      * Define work field USR Work Field 3A
     C                     MOVEL*BLANK    WUEZTX  3
      * Define work field USR Work Field 4A     USR
     C                     MOVEL*BLANK    WUOMTX  4
      * Define work field Date 7A              USR
     C                     MOVEL*BLANK    WUVCCD  7
      * Define work field Hours  2A            USR
     C                     MOVEL*BLANK    WUVDCD  2
      * Define work field Minutes  2A          USR
     C                     MOVEL*BLANK    WUVECD  2
      * Define work field Time  4A             USR
     C                     MOVEL*BLANK    WUVBCD  4
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3  30       Company Number
     C                     Z-ADD*ZERO     WBRMNB  70       Load ID
     C                     Z-ADD*ZERO     WBRUNB  50       Stop/Drop Seque
     C                     Z-ADD*ZERO     WBRVNB  50       Stop/Drop
     C                     Z-ADD*ZERO     WBRWNB  50       Miles to next s
     C                     Z-ADD*ZERO     WBRXNB  72       Freight Charge
     C                     Z-ADD*ZERO     WBSQNB  70       Actual Freight
     C                     Z-ADD*ZERO     WBT0NB 112       Freight Misc. C
     C                     Z-ADD*ZERO     WBT1NB  72       Freight Stop Ch
     C                     Z-ADD*ZERO     WBR1NB 112       Rated Freight
     C                     Z-ADD*ZERO     WBC4NB  70       Order Number
     C                     Z-ADD*ZERO     WBKEDT  70       Estimated Arriv
     C                     Z-ADD*ZERO     WBSXNB  60       Estimated Arriv
     C                     Z-ADD*ZERO     WBKFDT  70       Appointment Con
     C                     Z-ADD*ZERO     WBACTM  60       Appointment Con
     C                     Z-ADD*ZERO     WBEJDT  70       Actual Delivery
     C                     Z-ADD*ZERO     WBAGTM  60       Actual Delivery
     C                     Z-ADD*ZERO     WBKJDT  70       Scheduled Deliv
     C                     Z-ADD*ZERO     WBATTM  60       Scheduled Deliv
     C                     Z-ADD*ZERO     WBHDDT  70       Deadline Depart
     C                     Z-ADD*ZERO     WBAUTM  60       Deadline Depart
     C                     Z-ADD*ZERO     WBKKDT  70       On Yard Date
     C                     Z-ADD*ZERO     WBAVTM  60       On Yard Time
     C                     Z-ADD*ZERO     WBZ4NB  70       MPC Number
     C                     Z-ADD*ZERO     WBAATM  60       Job Time
     C                     Z-ADD*ZERO     WBAXDT  70       Job Date
      * Define work field Requested Delivery Date
     C                     Z-ADD*ZERO     WUEIDT  70
      * Define work field Requested Delivery Time
     C                     Z-ADD*ZERO     WUAFTM  40
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3  30       Company Number
     C                     Z-ADD*ZERO     WCC4NB  70       Order Number
     C                     Z-ADD*ZERO     WCANC7  70       A/R Customer Nu
     C                     Z-ADD*ZERO     WCBKC7  70       Ship To Custome
     C                     Z-ADD*ZERO     WCB0C7  70       Bill to Custome
     C                     Z-ADD*ZERO     WCA0DT  70       Order Date
     C                     Z-ADD*ZERO     WCA5DT  70       Requested Ship
     C                     Z-ADD*ZERO     WCGNDT  70       Actual Shipped
     C                     Z-ADD*ZERO     WCACDT  70       Cancel Date
     C                     Z-ADD*ZERO     WCAODT  70       Scheduled Ship
     C                     Z-ADD*ZERO     WCCXDT  70       Date of Origina
     C                     Z-ADD*ZERO     WCJZVA 112       Order Value Tot
     C                     Z-ADD*ZERO     WCA1WG 112       Order Weight To
     C                     Z-ADD*ZERO     WCEIDT  70       Requested Deliv
     C                     Z-ADD*ZERO     WCAFTM  40       Requested Deliv
     C                     Z-ADD*ZERO     WCRMNB  70       Load ID
     C                     Z-ADD*ZERO     WCTBNB  52       Absorbed Freigh
     C                     Z-ADD*ZERO     WCR1NB 112       Rated Freight
     C                     Z-ADD*ZERO     WCRNNB  52       Reefer Temperat
     C                     Z-ADD*ZERO     WCATIN  70       Attach to Invoi
     C                     Z-ADD*ZERO     WCRSRN  70       Resell Referenc
     C                     Z-ADD*ZERO     WCT3NB  70       Attach to Order
     C                     Z-ADD*ZERO     WCCONB  70       Invoice Number
     C                     Z-ADD*ZERO     WCAWDT  70       Invoice Date
     C                     Z-ADD*ZERO     WCVRVA 112       A/R order Value
     C                     Z-ADD*ZERO     WCAATM  60       Job Time
     C                     Z-ADD*ZERO     WCAXDT  70       Job Date
      * Define work field USR Time
     C                     Z-ADD*ZERO     WUWENB  60
      * Define work field Load Dtl On Time Flag
     C                     MOVEL*BLANK    WUY7ST  1
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBINFN.
     C                     MOVEL*BLANK    WL0001 16
     C                     Z-ADD*ZERO     WL0002  70
     C                     Z-ADD*ZERO     WL0003  40
      *================================================================
     CSR         ZZEXIT    ENDSR
