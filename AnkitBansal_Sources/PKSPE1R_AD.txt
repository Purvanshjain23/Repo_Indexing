// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKSPE1R
// ?Date: 14.08.2025 Time: 02:50:23
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification history
DO;

//? 3/01/2019 JBB E14234 - Repayment Enhancements
//?                        Added new field Repayment Status to the
//?                        screen.  This required Y/N field is set
//?                        to "Y" when a tattoo is unpaid.  When
//?                        the Tattoo is repaid, the value is set
//?                        to "N".  This screen can be used to set
//?                        the value in case of a repayment error.
ENDDO;

//?11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
//?USER: Delete DBF record

//?11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
EXECUTE FUNCTION(Dlt Payment Processing DO) TYPE(DLTOBJ) FILE(PKC4REP)          AB1146792;
PARAMETER(DTL.CC_Company_Number);

//?CALC: Detail screen function fields

// DTL.Payment Err Desc = Condition name of DTL.PP Payment Error
DTL.Payment_Err_Desc = RTVCND(DTL.PP_Payment_Error);

//?USER: Validate detail screen relations

CASE;

// IF DTL.*CMD key is CF05
IF DTL.*CMD_key = '05';

//?Display prices
// Call program Dsp Market PricesWCB/HOGC.
CALL PROGRAM(Dsp Market PricesWCB/HOGC) ('PPV6DFR');
PARAMETER(WRK.Return_Code_USR);
PARAMETER(DTL.Pmt_Current_Payment_Date);

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

QUIT;

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(Crt Payment Processing CO) TYPE(CRTOBJ) FILE(PKC4REP)          AB1146790;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Pmt_Current_Payment_Date);
PARAMETER(DTL.Pmt_Current_Payment_Step);
PARAMETER(DTL.PP_Commission_Paym_Error);
PARAMETER(DTL.PP_Payment_Error);
PARAMETER(DTL.PP_Unused_Nbr_1);
PARAMETER(DTL.PP_Repayment_Status);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

//?USER: Change DBF record

EXECUTE FUNCTION(Chg Payment Processing CH) TYPE(CHGOBJ) FILE(PKC4REP)          AB1146791;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.Pmt_Current_Payment_Date);
PARAMETER(DTL.Pmt_Current_Payment_Step);
PARAMETER(DTL.PP_Commission_Paym_Error);
PARAMETER(DTL.PP_Payment_Error);
PARAMETER(DTL.PP_Unused_Nbr_1);
PARAMETER(DTL.PP_Repayment_Status);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

