// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PNTYXFR
// ?Date: 14.08.2025 Time: 03:46:31
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** This validates the SSD,RDD and Item Age Dates against the
//?** production dates
//?only validate if Seaboard
CASE;

// IF PAR.Company Organization is Seaboard
IF PAR.Company_Organization = 'S';

EXECUTE FUNCTION(Val ShpDtReqD By Ord   RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC2002171;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Scheduled_Ship_Date);
PARAMETER(PAR.Requested_Delivery_Date);
PARAMETER(PAR.Program_name_USR);
PARAMETER(PAR.Error_Status_3);
PARAMETER(PAR.Company_Organization);
{
 //?USER: Process Data record

 //?If Req Deliv dt is zeros, use from Order Header, else use par
 CASE;

 // IF PAR.Requested Delivery Date is not entered
 IF PAR.Requested_Delivery_Date = *ZERO;

 // LCL.Requested Delivery Date = DB1.Requested Delivery Date
 LCL.Requested_Delivery_Date = DB1.Requested_Delivery_Date;

 //?If Req Deliv dt is zeros, use from Order Header, else use par
 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Requested Delivery Date = PAR.Requested Delivery Date
 LCL.Requested_Delivery_Date = PAR.Requested_Delivery_Date;

 ENDIF;

 EXECUTE FUNCTION(Val Chgd ShpDt/ItmAge  Rt) TYPE(RTVOBJ) FILE(OPBGWKP)          AC2037981;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(PAR.Scheduled_Ship_Date);
 PARAMETER(LCL.Requested_Delivery_Date);
 PARAMETER(PAR.Error_Status_3);
 PARAMETER(PAR.Company_Organization);
 {
  //?USER: Process Data record

  //?Validate Item Age Date based on changed SSD and RDD   E001895
  EXECUTE FUNCTION(Val Age Information   IF) TYPE(EXCINTFUN)                      AC1984951;
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(DB1.Company_Number);
  PARAMETER(PAR.Scheduled_Ship_Date);
  PARAMETER(PAR.Requested_Delivery_Date);
  PARAMETER(DB1.Item_Age_Days);
  PARAMETER(DB1.Production_Ovr_AgeDte_Fr);
  PARAMETER(DB1.Production_Ovr_AgeDte_To);
  PARAMETER(LCL.Production_AgeDte_Fr);
  PARAMETER(LCL.Production_AgeDte_To);
  PARAMETER(PAR.Error_Status_3);
  PARAMETER(PAR.Company_Organization);
  PARAMETER('V');
  {
   //?Execute internal function

   // WRK.Error Flag            USR = CND.Blank
   WRK.Error_Flag_USR = *BLANK;

   // PAR.Error Status = CND.blank
   PAR.Error_Status = *BLANK;

   // WRK.Error Reason Descript 1 = CON.*BLANK
   WRK.Error_Reason_Descript_1 = *BLANK;

   // WRK.Error Reason Descript 2 = CON.*BLANK
   WRK.Error_Reason_Descript_2 = *BLANK;

   // WRK.Error Reason Descript 3 = CON.*BLANK
   WRK.Error_Reason_Descript_3 = *BLANK;

   // WRK.Error Reason Descript 4 = CON.*BLANK
   WRK.Error_Reason_Descript_4 = *BLANK;

   // WRK.Error Reason Descript 5 = CON.*BLANK
   WRK.Error_Reason_Descript_5 = *BLANK;

   CASE;

   // IF PAR.Company Organization is Seaboard
   IF PAR.Company_Organization = 'S';

   CASE;

   // IF PAR.Requested Delivery Date is not entered
   IF PAR.Requested_Delivery_Date = *ZERO;

   // Send error message - 'Requested Delv Date is required'
   ERROR(USR4329);
   MSGPARM(PAR.Requested_Delivery_Date);

   // IF PAR.Scheduled Ship Date is not entered
   IF PAR.Scheduled_Ship_Date = *ZERO;

   // Send error message - 'Scheduled Ship Date is required when orders are assigned to load.'
   ERROR(USR2230);
   MSGPARM(PAR.Scheduled_Ship_Date);

   // IF *OTHERWISE
   IF *OTHERWISE;

   // Call program Val Age information   XF.
   CALL PROGRAM(Val Age information   XF) ('PNQNXFR');
   PARAMETER(PAR.Item_Code);
   PARAMETER(PAR.Warehouse_Code);
   PARAMETER(WRK.Error_Flag_USR);
   PARAMETER(WRK.Error_Reason_Descript_1);
   PARAMETER(WRK.Error_Reason_Descript_2);
   PARAMETER(WRK.Error_Reason_Descript_3);
   PARAMETER(WRK.Error_Reason_Descript_4);
   PARAMETER(WRK.Error_Reason_Descript_5);
   PARAMETER(PAR.Company_Number);
   PARAMETER(PAR.Scheduled_Ship_Date);
   PARAMETER(PAR.Requested_Delivery_Date);
   PARAMETER(PAR.Item_Age_Days);
   PARAMETER(PAR.Production_Ovr_AgeDte_Fr);
   PARAMETER(PAR.Production_Ovr_AgeDte_To);
   PARAMETER(PAR.Production_AgeDte_Fr);
   PARAMETER(PAR.Production_AgeDte_To);

   //?Verify if message should be sent if validation is required
   CASE;

   // IF WRK.Error Flag            USR is Yes
   IF WRK.Error_Flag_USR = 'Y';

   // AND PAR.Production Dates Sts Usr is Validation routine
   AND PAR.Production_Dates_Sts_Usr = 'V';

   //?message 1 Product is shipped before product is made
   CASE;

   // IF WRK.Error Reason Descript 1 NE WRK.Blank for 30          USR
   IF WRK.Error_Reason_Descript_1 <> WRK.Blank_for_30_USR;

   // Send error message - 'Prd Date is invalid for requested delivery date'
   ERROR(USR4307);
   MSGPARM(PAR.Production_AgeDte_Fr);

   ENDIF;

   //?message 2 Either Days or override date but not both
   CASE;

   // IF WRK.Error Reason Descript 2 NE WRK.Blank for 30          USR
   IF WRK.Error_Reason_Descript_2 <> WRK.Blank_for_30_USR;

   // Send error message - 'Enter Age Days or Dates'
   ERROR(USR4304);
   MSGPARM(PAR.Item_Age_Days);
   MSGPARM(PAR.Production_Ovr_AgeDte_Fr);
   MSGPARM(PAR.Production_Ovr_AgeDte_To);

   ENDIF;

   //?message 3 With Chill Days Either Days or Override Dates required
   CASE;

   // IF WRK.Error Reason Descript 3 NE WRK.Blank for 30          USR
   IF WRK.Error_Reason_Descript_3 <> WRK.Blank_for_30_USR;

   // Send error message - 'Override Dates is after shipped date'
   ERROR(USR4305);
   MSGPARM(PAR.Item_Age_Days);
   MSGPARM(PAR.Production_Ovr_AgeDte_Fr);
   MSGPARM(PAR.Production_Ovr_AgeDte_To);

   ENDIF;

   //?message 4 From date is > then SHIP DATE
   CASE;

   // IF WRK.Error Reason Descript 4 NE WRK.Blank for 30          USR
   IF WRK.Error_Reason_Descript_4 <> WRK.Blank_for_30_USR;

   // Send error message - 'Override Dates is after shipped date'
   ERROR(USR4305);
   MSGPARM(PAR.Item_Age_Days);
   MSGPARM(PAR.Production_Ovr_AgeDte_Fr);
   MSGPARM(PAR.Production_Ovr_AgeDte_To);

   ENDIF;

   //?message 5 To date is > then SHIP DATE
   CASE;

   // IF WRK.Error Reason Descript 5 NE WRK.Blank for 30          USR
   IF WRK.Error_Reason_Descript_5 <> WRK.Blank_for_30_USR;

   // Send error message - 'Override Dates is after shipped date'
   ERROR(USR4305);
   MSGPARM(PAR.Item_Age_Days);
   MSGPARM(PAR.Production_Ovr_AgeDte_Fr);
   MSGPARM(PAR.Production_Ovr_AgeDte_To);

   ENDIF;

   CASE;

   // IF PAR.Production Ovr AgeDte Fr is not entered
   IF PAR.Production_Ovr_AgeDte_Fr = *ZERO;

   // Send error message - 'Invalid Item Age Days'
   ERROR(USR4309);
   MSGPARM(PAR.Item_Age_Days);

   // IF *OTHERWISE
   IF *OTHERWISE;

   // Send error message - 'Invalid Production Override Age Frm/To Dates'
   ERROR(USR4310);
   MSGPARM(PAR.Production_AgeDte_Fr);
   MSGPARM(PAR.Production_AgeDte_To);

   ENDIF;

   // PAR.Error Status = CND.yes
   PAR.Error_Status = 'Y';

   ENDIF;

   ENDIF;

   ENDIF;

  }

  CASE;

  // IF PAR.Error Status  3 is Yes
  IF PAR.Error_Status_3 = 'Y';

  QUIT;

  ENDIF;

 }

}


ENDIF;

