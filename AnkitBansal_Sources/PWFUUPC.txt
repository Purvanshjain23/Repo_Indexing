/*                                                                 */
/*  PROGRAM NUMBER:  PWA8UPR                                       */
/*  PROGRAM NAME:    Email Delivery Schedule Report                */
/*  PROGRAMMER:      Julius High                                   */
/*  CREATE DATE:     01/09/2018                                    */
/*                                                                 */
/*  FUNCTION:        This CLP function is used to Email a PDF      */
/*                   copy of the Delivery Schedule Report.         */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*-----------------------------------------------------------------*/
/*  03/04/2019 JJH E14585 - Use Email Subject-50 USR               */
/*  08/23/2018 DN  T13559 - Append 'TEST' to Subject Line if in    */
/*                          TEST env. Changed Email Subject Line to*/
/*                          40 in length to support Producer       */
/*                          Location value.                        */
/*  01/09/2018 JJH E12120 - Copy of Prt2Delivery Schedule CL       */
/*                          (PWA8UPR).  This version prints the    */
/*                          PWFSPFR report for Producers in 440    */
/*                          with HPS Automation Flag = Y.          */
/*  11/21/2017 JBB E12103 - Remove report PWAGPFR from body of the */
/*                          email message, and realign column      */
/*                          headings on the attached PWAGPFR       */
/*                          report. Change ESEND/ESNDMAIL to       */
/*                          ESEND/ESNDFILE.                        */
/*  03/26/2021 RMC SDN 475- FOR TEST, CHG &OVRUSROPT TO &USER      */
/*                                                                 */
/*******************************************************************/
             PGM        PARM(&RECIPIENT &EMLSUBJ &PRTF &OVRUSROPT)
/*                                                                 */
/*-----------------------------------------------------------------*/
/*                      PARAMETER                                  */
/*-----------------------------------------------------------------*/
/* Function Specific                                               */
             DCL        VAR(&RECIPIENT) TYPE(*CHAR) LEN(75)
/* T13559    DCL        VAR(&DESC) TYPE(*CHAR) LEN(25)   */
             DCL        VAR(&EMLSUBJ) TYPE(*CHAR) LEN(50) /* E15485 */
             DCL        VAR(&PRTF) TYPE(*CHAR) LEN(10)
             DCL        VAR(&OVRUSROPT) TYPE(*CHAR) LEN(10)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)

             DCL        VAR(&RTNLIB) TYPE(*CHAR) LEN(10)  /* T13559 */

/*-----------------------------------------------------------------*/
/* Override User Print Options                                     */
             OVRPRTF    FILE(PWFSPFR$) OUTQ(QPRINT2) HOLD(*YES)
/*                                                                 */
/*-----------------------------------------------------------------*/
/* T13559 DN 08/23/18-Append 'TEST' to Subject Line if in TEST env. */
             RTVOBJD    OBJ(PKAXCPP) OBJTYPE(*FILE) RTNLIB(&RTNLIB)
             MONMSG     MSGID(CPF9801)  /* Object Not Found */

             IF         COND(&RTNLIB *NE 'PRKFGUP' *AND &RTNLIB *NE +
                          'PRKFSTP' *AND &RTNLIB *NE 'PRKFTFP') +
                          THEN(DO)
             CHGVAR     VAR(&EMLSUBJ) VALUE(&EMLSUBJ *BCAT '- TEST')
             RTVJOBA    USER(&USER)
             CHGVAR     VAR(&OVRUSROPT) VALUE(&USER)
             ENDDO

/*-----------------------------------------------------------------*/
/* Send Email to Producer                                          */
/*           ESEND/ESNDMAIL RECIPIENT(&RECIPIENT) SUBJECT(&DESC) +
                          MSG(*NONE) MSGTYPE(*TEXT) +
                          OVRUSROPT(&OVRUSROPT) ATTLIST((* *MSG *N +
                          (PWFSPFR$)  (* *PDF *N &PRTF))  */
/*                                                                 */
/* 11/21/2017 JBB E12103  Fix report attached to email             */
             ESEND/ESNDFILE RECIPIENT(&RECIPIENT) SUBJECT(&EMLSUBJ) +
                          MSG('Open attached PWFSPFR$ to view +
                          report.') TYPE(*SPL) SPLF(PWFSPFR$) +
                          OVRUSROPT(&OVRUSROPT)
/*-----------------------------------------------------------------*/
/* Delete Spool Files                                              */
             DLTSPLF    FILE(&PRTF) SELECT(*ALL)
             MONMSG     MSGID(CPF3309)
             DLTSPLF    FILE(PWFSPFR$) SELECT(*ALL)
             MONMSG     MSGID(CPF3309)

/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
  ENDPGM:
             DLTOVR     FILE(*ALL)
             ENDPGM
