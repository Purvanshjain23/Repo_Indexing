     H/TITLE UPD Comdty Mkt Prc IntfXF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 09/30/22  Time  : 11:35:19
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAAFREL6IF  E           K        DISK
      * RSQ : Calendar                  RSQ Co/Date Descending
      *
     FPUBZCPL3IF  E           K        DISK
      * RSQ : Commodity Mrkt Price Intf MktC/MktG/MktD SEL Unpro
      *
     FCADPREL1IF  E           K        DISK
      * RTV : System Values             Retrieval index       NV
      *
     FOMF0CPL1IF  E           K        DISK
      * RTV : Commodity Mrkt Price      Retrieval index
      *
     FOMFYREL0IF  E           K        DISK
      * RTV : Commodity Markets         Retrieval index
      *
     FOMFZREL0IF  E           K        DISK
      * RTV : Commodity Group           Retrieval index
      *
     FPUBZCPL0UF  E           K        DISK
      * UPD : Commodity Mrkt Price Intf Update index
      *
     FOMF0CPL0UF  E           K        DISK                      A
      * UPD : Commodity Mrkt Price      Update index
      *
      * Long constants
     E                    @CN#    1  09  6   @CN    25
     I@AFREPU
      * Calendar                  RSQ Co/Date Descending
      * Renamed input format fields
     I              AFAIC3                          WAAIC3
     I              AFBCDT                          WABCDT
     I              AFCQNB                          WACQNB
     I              AFESNB                          WAESNB
     I              AFETNB                          WAETNB
     I              AFBZNB                          WABZNB
     I              AFA9ST                          WAA9ST
     I              AFEINB                          WAEINB
     I              AFC5ST                          WAC5ST
     I              AFAQNB                          WAAQNB
     I              AFCMST                          WACMST
     I              AFV9ST                          WAV9ST
     I              AFWAST                          WAWAST
     I              AFX2ST                          WAX2ST
     I              AFOJDT                          WAOJDT
     I              AFNQNX                          WANQNX
     I              AFNRNX                          WANRNX
     I              AFI9SX                          WAI9SX
     I              AFJASX                          WAJASX
     I              AFOKDT                          WAOKDT
     I              AFOLDT                          WAOLDT
     I              AFUVST                          WAUVST
     I              AFUWST                          WAUWST
     I              AFUXST                          WAUXST
     I              AFAATM                          WAAATM
     I              AFAYNA                          WAAYNA
     I              AFA0NA                          WAA0NA
     I              AFAXDT                          WAAXDT
      *
     I@BZCPHD
      * Commodity Mrkt Price Intf MktC/MktG/MktD SEL Unpro
      * Renamed input format fields
     I              BZLQCD                          WBLQCD
     I              BZLRCD                          WBLRCD
     I              BZEQDT                          WBEQDT
     I              BZA5PR                          WBA5PR
     I              BZB8PR                          WBB8PR
     I              BZKZSC                          WBKZSC
     I              BZE8NZ                          WBE8NZ
     I              BZK0SC                          WBK0SC
     I              BZBED8                          WBBED8
     I              BZBETS                          WBBETS
     I              BZBFD8                          WBBFD8
     I              BZBFTS                          WBBFTS
      *
     I@DPRETD
      * System Values             Retrieval index       NV
      * Renamed input format fields
     I              DPDOCD                          WCDOCD
     I              DPAUNA                          WCAUNA
     I              DPI5ST                          WCI5ST
     I              DPBXTX                          WCBXTX
     I              DPM8NB                          WCM8NB
     I              DPUVST                          WCUVST
     I              DPUWST                          WCUWST
     I              DPUXST                          WCUXST
     I              DPVSST                          WCVSST
     I              DPAATM                          WCAATM
     I              DPAYNA                          WCAYNA
     I              DPA0NA                          WCA0NA
     I              DPAXDT                          WCAXDT
      *
     I@BZCPHA
      * Commodity Mrkt Price Intf Update index
      * Renamed input format fields
     I              BZLQCD                          WDLQCD
     I              BZLRCD                          WDLRCD
     I              BZEQDT                          WDEQDT
     I              BZA5PR                          WDA5PR
     I              BZB8PR                          WDB8PR
     I              BZKZSC                          WDKZSC
     I              BZE8NZ                          WDE8NZ
     I              BZK0SC                          WDK0SC
     I              BZBED8                          WDBED8
     I              BZBETS                          WDBETS
     I              BZBFD8                          WDBFD8
     I              BZBFTS                          WDBFTS
      *
     I@F0CPDQ
      * Commodity Mrkt Price      Retrieval index
      * Renamed input format fields
     I              F0LQCD                          WELQCD
     I              F0LRCD                          WELRCD
     I              F0EQDT                          WEEQDT
     I              F0A5PR                          WEA5PR
     I              F0B8PR                          WEB8PR
     I              F0UVST                          WEUVST
     I              F0UWST                          WEUWST
     I              F0UXST                          WEUXST
     I              F0VSST                          WEVSST
     I              F0AATM                          WEAATM
     I              F0AYNA                          WEAYNA
     I              F0A0NA                          WEA0NA
     I              F0AXDT                          WEAXDT
      *
     I@FYREDK
      * Commodity Markets         Retrieval index
      * Renamed input format fields
     I              FYLQCD                          WFLQCD
     I              FYJ3NA                          WFJ3NA
     I              FYUVST                          WFUVST
     I              FYUWST                          WFUWST
     I              FYUXST                          WFUXST
     I              FYVSST                          WFVSST
     I              FYAATM                          WFAATM
     I              FYAYNA                          WFAYNA
     I              FYA0NA                          WFA0NA
     I              FYAXDT                          WFAXDT
      *
     I@FZREDN
      * Commodity Group           Retrieval index
      * Renamed input format fields
     I              FZLRCD                          WGLRCD
     I              FZJ4NA                          WGJ4NA
     I              FZAICD                          WGAICD
     I              FZUVST                          WGUVST
     I              FZUWST                          WGUWST
     I              FZUXST                          WGUXST
     I              FZVSST                          WGVSST
     I              FZAATM                          WGAATM
     I              FZAYNA                          WGAYNA
     I              FZA0NA                          WGA0NA
     I              FZAXDT                          WGAXDT
      *
     I@F0CPDJ
      * Commodity Mrkt Price      Update index
      * Renamed input format fields
     I              F0LQCD                          WHLQCD
     I              F0LRCD                          WHLRCD
     I              F0EQDT                          WHEQDT
     I              F0A5PR                          WHA5PR
     I              F0B8PR                          WHB8PR
     I              F0UVST                          WHUVST
     I              F0UWST                          WHUWST
     I              F0UXST                          WHUXST
     I              F0VSST                          WHVSST
     I              F0AATM                          WHAATM
     I              F0AYNA                          WHAYNA
     I              F0A0NA                          WHA0NA
     I              F0AXDT                          WHAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPUBZ1    E DSPUBZCPL0
      * UPD : Commodity Mrkt Price Intf Update index
      * Renamed input format fields
     I              BZLQCD                          WDLQCD
     I              BZLRCD                          WDLRCD
     I              BZEQDT                          WDEQDT
     I              BZA5PR                          WDA5PR
     I              BZB8PR                          WDB8PR
     I              BZKZSC                          WDKZSC
     I              BZE8NZ                          WDE8NZ
     I              BZK0SC                          WDK0SC
     I              BZBED8                          WDBED8
     I              BZBETS                          WDBETS
     I              BZBFD8                          WDBFD8
     I              BZBFTS                          WDBFTS
      *
     IYARDCS      DS                             62
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQOMF01    E DSOMF0CPL0
      * UPD : Commodity Mrkt Price      Update index
      * Renamed input format fields
     I              F0LQCD                          WHLQCD
     I              F0LRCD                          WHLRCD
     I              F0EQDT                          WHEQDT
     I              F0A5PR                          WHA5PR
     I              F0B8PR                          WHB8PR
     I              F0UVST                          WHUVST
     I              F0UWST                          WHUWST
     I              F0UXST                          WHUXST
     I              F0VSST                          WHVSST
     I              F0AATM                          WHAATM
     I              F0AYNA                          WHAYNA
     I              F0A0NA                          WHA0NA
     I              F0AXDT                          WHAXDT
      *
     IYBRDCS      DS                             58
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * UPD Comdty Mkt Prc IntfXF
      * Bypass Sat/Sun & Holidays. Does NOT Check Production Day Sts.
      * Rtv Prev Business Day2 XF - Calendar  * 
     C                     CALL 'PUP4XFR'              90  Rtv Prev Busine
     C                     PARM *BLANK    W0RTN   7
     C           YL0001    PARM YL0001    WQ0001  70       Production Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUP4XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * RTV System Value Num   XF - System Values  * 
     C                     CALL 'PBE0XFR'              90  RTV System Valu
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,001   WQ0002 10        System Value Co
     C           YL0002    PARM *ZERO     WQ0003 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBE0XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: LCL.Number of Days is EQ 2
     C           YL0002    IFEQ 2                          *IF
     C                     Z-ADD360       YL0003           Company Number
      * Rtv Prev Business Day  RT - Calendar  * 
     C                     EXSR SARVGN
     C                     END                             *FI
      * Access Path Selects Unprocessed Records Only.
      * UPD Comdty Mkt Prc IntfRT - Commodity Mrkt Price Intf  * 
     C                     EXSR SBRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Prev Business Day  RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAIC3    WQSA01           Company Number
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WQSA01           Company Number
     C                     KFLD           WABCDT           Post to G/L Dat
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Company Number
      * Setup key
     C                     Z-ADDYL0003    WQSA01           Company Number
     C                     Z-ADDYL0001    WABCDT           Post to G/L Dat
      * Establish starting position
     C           KPSSA     SETLL@AFREPU                    *
     C           KRSSA     READE@AFREPU                  90*
      * Data record not found
     C   90                MOVEL'USR0018' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Post to G/L Date EQ PAR.Post to G/L Date
     C           WABCDT    IFEQ YL0001                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DB1.Production Day Status is yes
     C           WAWAST    IFEQ 'Y'                        *IF
      * CASE: DB1.Day of Week is Sat/Sun
     C           WAA9ST    IFEQ '7'                        *IF
     C           WAA9ST    OREQ '1'
      * skip sat/sun
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWABCDT    YL0001           Production Date
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSA     READE@AFREPU                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * UPD Comdty Mkt Prc IntfRT - Commodity Mrkt Price Intf  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  1        Record Processe
     C                     MOVEL*BLANK    WN0002  1        Send Email USR
     C                     MOVEL*BLANK    WN0003  3        Commodity Marke
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'N'       WN0002           Send Email USR
     C                     MOVEL'Y'       YL0004           First Time Thro
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                     CALL 'PDGFUPC'              90  RTV System Date
     C           YL0005    PARM *ZERO     WQ0004 155       Current System
     C                     PARM *ZERO     WQ0005 155       Current System
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGFUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * LCL.System Date USR = LCL.System Date Nbr USR
     C                     Z-ADDYL0005    YL0006           System Date USR
     C                     MOVEL*BLANK    WN0003           Commodity Marke
      * RTV System Value Alpha RT - System Values  * 
     C                     EXSR SCRVGN
      * Establish starting position
     C           *LOVAL    SETLL@BZCPHD                    *
     C                     READ @BZCPHD                  90*
      * Data record not found
     C   90                MOVEL'USR5177' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * First Time Thru, Save Commodity Market Code.
      * CASE: LCL.First Time Through USR is Yes
     C           YL0004    IFEQ 'Y'                        *IF
     C                     MOVEL'N'       YL0004           First Time Thro
     C                     MOVELWBLQCD    YL0008           Commodity Marke
     C                     MOVELWBLQCD    WN0003           Commodity Marke
     C                     END                             *FI
      * Break on Commodity Market - send email
      * CASE: DB1.Commodity Market Code NE PAR.Commodity Market Save USR
     C           WBLQCD    IFNE WN0003                     *IF
      * CASE: PAR.Send Email USR is Yes
     C           WN0002    IFEQ 'Y'                        *IF
      * Format Email Subject & Message.
      * CASE: *OTHERWISE
      * Commodity Mrkt Cde=Blank Means None Processed but has Error.
      * CASE: LCL.Commodity Market Code is Not Entered
     C           YL0008    IFEQ *BLANK                     *IF
      * Use Last Commodity Market Code in Error.
     C                     MOVELYL0009    YL0008           Commodity Marke
     C                     END                             *FI
     C                     Z-ADD*ZERO     ZQ      50
     C           @CN,003   CAT  @CN,004:ZQYL0010    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           @CN,005   CAT  @CN,006:ZQYL0011    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  'Code:':ZQYL0011    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  WN0003:ZQ YL0011    P      Email Message U
      * RTV Data Libraries     XF - System Values  * Check if TEST/PROD E
     C                     CALL 'CAQXXFR'              90  RTV Data Librar
     C                     PARM *BLANK    W0RTN   7
     C           YL0012    PARM YL0012    WQ0006 10        Library List Co
     C           YL0013    PARM YL0013    WQ0007 10        @Library List C
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'CAQXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If Not PROD Library Append 'TEST' to Email Subject.
      * CASE: LCL.Library List Code is Not PRKFLIB
     C           YL0012    IFNE @CN,007                    *IF
     C                     Z-ADD2         ZQ      50
     C           YL0011    CAT  @CN,008:ZQYL0011    P      Email Message U
     C                     END                             *FI
      * RTV System Value Alpha XF - System Values  * Get DL
     C                     CALL 'PPJXXFR'              90  RTV System Valu
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,009   WQ0008 10        System Value Co
     C           YL0014    PARM *BLANK    WQ0009 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PPJXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Exc ESNDMAIL Generic  CL - /UT User Programs  * 
     C                     CALL 'PUE8UPC'              90  Exc ESNDMAIL Ge
     C                     PARM YL0014    WQ0010 50        Email Address
     C                     PARM YL0010    WQ0011 50        Email Subject U
     C                     PARM YL0011    WQ0012256        Email Message U
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUE8UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     MOVEL'N'       WN0002           Send Email USR
     C                     MOVELWBLQCD    WN0003           Commodity Marke
     C                     END                             *FI
      * Mark as Error If Market Dte>Current Dte or Market Dte<Prev Bus Da
      * CASE:
      *  - (c1 OR c2) AND c3
      *   |- c1    : DB1.Market Price Date GT LCL.System Date USR
      *   |- c2    : DB1.Market Price Date LT PAR.Production Date Prev US
      *   |- c3    : LCL.Bypass Market Date Chk U is No
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C                     MOVEL'0'       Y0CX02  1
     C           WBEQDT    IFGT YL0006                     *IF
     C           WBEQDT    ORLT YL0001                     *OR
     C                     MOVEL'1'       Y0CX02
     C                     END                             *FI
     C           Y0CX02    IFEQ '1'                        *IF
     C           YL0007    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Chg Comdty Mkt Prc IntfCH - Commodity Mrkt Price Intf  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWBLQCD    WL0001    P      Commodity Marke
     C                     MOVELWBLRCD    WL0002    P      Commodity Price
     C                     Z-ADDWBEQDT    WL0003           Market Price Da
     C                     Z-ADDWBA5PR    WL0004           Commodity Marke
     C                     Z-ADDWBB8PR    WL0005           Projected Marke
     C                     MOVELWBKZSC    WL0006    P      ETL Record Stat
     C                     Z-ADD2         WL0007           ETL Process Sta
     C                     MOVEL'CMDDTE'  WL0008    P      ETL Error Reaso
     C                     EXSR SDCHRC
     C                     MOVELWBLQCD    YL0009           Commodity Marke
     C                     MOVEL'Y'       WN0002           Send Email USR
     C                     END                             *FI
      * Select Market Date=Current Date or Prev Business Work Date.
      * CASE:
      *  - (c1 OR c2) OR c3
      *   |- c1    : DB1.Market Price Date EQ PAR.Production Date Prev US
      *   |- c2    : DB1.Market Price Date EQ LCL.System Date USR
      *   |- c3    : LCL.Bypass Market Date Chk U is Yes
      *   '-
     C           WBEQDT    IFEQ YL0001                     *IF
     C           WBEQDT    OREQ YL0006                     *OR
     C           YL0007    OREQ 'Y'                        *OR
      * UPD Comdty Mkt Prc IntfRT - Commodity Mrkt Price  * 
     C                     EXSR SERVGN
      * PROCESS: Call PDP3XFR for Price Audit & Update Interface as Proce
      * CASE: *OTHERWISE
      * Call PDP3XFR for Price Audit & Update Interface as Processed.
      * CASE: PAR.Record Processed Usr is Yes
     C           WN0001    IFEQ 'Y'                        *IF
      * UPD Prc Ad Mkt Prc ADD XF - Order Detail  * 
     C                     CALL 'PDP3XFR'              90  UPD Prc Ad Mkt
     C                     PARM *BLANK    W0RTN   7
     C                     PARM 'OMF0CPP' WQ0015 10        File Name
     C                     PARM *ZERO     WQ0016  30       Company Number
     C                     PARM *ZERO     WQ0017  70       Ship To Custome
     C                     PARM *ZERO     WQ0018  70       Item Code
     C                     PARM WBLQCD    WQ0019  3        Commodity Marke
     C                     PARM WBLRCD    WQ0020  7        Commodity Price
     C                     PARM WBEQDT    WQ0021  70       Market Price Da
     C                     PARM 'N'       WQ0022  1        USR Formula Met
     C                     PARM 'Y'       WQ0023  1        USR Market Meth
     C                     PARM 'N'       WQ0024  1        USR Manual Meth
     C                     PARM 'N'       WQ0025  1        USR Extend Meth
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDP3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Chg Comdty Mkt Prc IntfCH - Commodity Mrkt Price Intf  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWBLQCD    WL0001    P      Commodity Marke
     C                     MOVELWBLRCD    WL0002    P      Commodity Price
     C                     Z-ADDWBEQDT    WL0003           Market Price Da
     C                     Z-ADDWBA5PR    WL0004           Commodity Marke
     C                     Z-ADDWBB8PR    WL0005           Projected Marke
     C                     MOVELWBKZSC    WL0006    P      ETL Record Stat
     C                     Z-ADD1         WL0007           ETL Process Sta
     C                     MOVEL*BLANK    WL0008           ETL Error Reaso
     C                     EXSR SDCHRC
     C                     MOVEL'Y'       WN0002           Send Email USR
     C                     END                             *FI
      * Update Interface Process Status if Same Price.
      * CASE: LCL.Same Price-Update Sts USR is Yes
     C           YL0020    IFEQ 'Y'                        *IF
      * Chg Comdty Mkt Prc IntfCH - Commodity Mrkt Price Intf  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWBLQCD    WL0001    P      Commodity Marke
     C                     MOVELWBLRCD    WL0002    P      Commodity Price
     C                     Z-ADDWBEQDT    WL0003           Market Price Da
     C                     Z-ADDWBA5PR    WL0004           Commodity Marke
     C                     Z-ADDWBB8PR    WL0005           Projected Marke
     C                     MOVELWBKZSC    WL0006    P      ETL Record Stat
     C                     Z-ADD1         WL0007           ETL Process Sta
     C                     MOVEL*BLANK    WL0008           ETL Error Reaso
     C                     EXSR SDCHRC
     C                     END                             *FI
      * ERROR: Update Interface Record.
      * CASE:
      *  - NOTc1
      *   |- c1    : LCL.ETL Error Reason is No Error
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0019    IFEQ *BLANK                     *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Chg Comdty Mkt Prc IntfCH - Commodity Mrkt Price Intf  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWBLQCD    WL0001    P      Commodity Marke
     C                     MOVELWBLRCD    WL0002    P      Commodity Price
     C                     Z-ADDWBEQDT    WL0003           Market Price Da
     C                     Z-ADDWBA5PR    WL0004           Commodity Marke
     C                     Z-ADDWBB8PR    WL0005           Projected Marke
     C                     MOVELWBKZSC    WL0006    P      ETL Record Stat
     C                     Z-ADDYL0018    WL0007           ETL Process Sta
     C                     MOVELYL0019    WL0008    P      ETL Error Reaso
     C                     EXSR SDCHRC
     C                     MOVELWBLQCD    YL0009           Commodity Marke
     C                     MOVEL'Y'       WN0002           Send Email USR
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @BZCPHD                  90*
     C                     ENDDO
      * USER: Exit processing
      * Last Comm Market --> Send Email to Notify of Update.
      * CASE: PAR.Send Email USR is Yes
     C           WN0002    IFEQ 'Y'                        *IF
      * Format Email Subject & Message.
      * CASE: *OTHERWISE
      * Commodity Mrkt Cde=Blank Means None Processed but has Error.
      * CASE: LCL.Commodity Market Code is Not Entered
     C           YL0008    IFEQ *BLANK                     *IF
      * Use Last Commodity Market Code in Error.
     C                     MOVELYL0009    YL0008           Commodity Marke
     C                     END                             *FI
     C                     Z-ADD*ZERO     ZQ      50
     C           @CN,003   CAT  @CN,004:ZQYL0010    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           @CN,005   CAT  @CN,006:ZQYL0011    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  'Code:':ZQYL0011    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  WN0003:ZQ YL0011    P      Email Message U
      * RTV Data Libraries     XF - System Values  * Check if TEST/PROD E
     C                     CALL 'CAQXXFR'              90  RTV Data Librar
     C                     PARM *BLANK    W0RTN   7
     C           YL0012    PARM YL0012    WQ0026 10        Library List Co
     C           YL0013    PARM YL0013    WQ0027 10        @Library List C
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'CAQXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * If Not PROD Library Append 'TEST' to Email Subject.
      * CASE: LCL.Library List Code is Not PRKFLIB
     C           YL0012    IFNE @CN,007                    *IF
     C                     Z-ADD2         ZQ      50
     C           YL0011    CAT  @CN,008:ZQYL0011    P      Email Message U
     C                     END                             *FI
      * RTV System Value Alpha XF - System Values  * Get DL
     C                     CALL 'PPJXXFR'              90  RTV System Valu
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,009   WQ0028 10        System Value Co
     C           YL0014    PARM *BLANK    WQ0029 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PPJXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Exc ESNDMAIL Generic  CL - /UT User Programs  * 
     C                     CALL 'PUE8UPC'              90  Exc ESNDMAIL Ge
     C                     PARM YL0014    WQ0030 50        Email Address
     C                     PARM YL0010    WQ0031 50        Email Subject U
     C                     PARM YL0011    WQ0032256        Email Message U
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUE8UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV System Value Alpha RT - System Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCDOCD           System Value Co
      * Setup key
     C                     MOVEL@CN,002   WCDOCD           System Value Co
      * Establish starting position
     C           KRSSC     CHAIN@DPRETD              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0759' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0007           System Value Al
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCBXTX    YL0007           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Chg Comdty Mkt Prc IntfCH - Commodity Mrkt Price Intf  * 
      *================================================================
      * This is a shared subroutine
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0004  80       ETL Create Date
     C                     Z-ADD*ZERO     WN0005  60       ETL Create Time
     C                     Z-ADD*ZERO     WN0006  80       ETL Change Date
     C                     Z-ADD*ZERO     WN0007  60       ETL Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BZCPHA
     C                     MOVELWL0001    WDLQCD    P      Commodity Marke
     C                     MOVELWL0002    WDLRCD    P      Commodity Price
     C                     Z-ADDWL0003    WDEQDT           Market Price Da
      *
     C           KLCHSD    KLIST
     C                     KFLD           WDLQCD           Commodity Marke
     C                     KFLD           WDLRCD           Commodity Price
     C                     KFLD           WDEQDT           Market Price Da
     C           KLCHSD    CHAIN@BZCPHA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PUBZCPL0'MDACP
     C                     MOVEL'@BZCPHA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPUBZ1    YARDCS
      * Move non-key fields to @BZCPHA
     C                     Z-ADDWL0004    WDA5PR           Commodity Marke
     C                     Z-ADDWL0005    WDB8PR           Projected Marke
     C                     MOVELWL0006    WDKZSC    P      ETL Record Stat
     C                     Z-ADDWL0007    WDE8NZ           ETL Process Sta
     C                     MOVELWL0008    WDK0SC    P      ETL Error Reaso
      *
      * Set PGM.*Record Data Changed flag
     C           QPUBZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Change Stamp      IF
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                     CALL 'PDGFUPC'              90  RTV System Date
     C           YL0015    PARM *ZERO     WQ0013 155       Current System
     C           YL0016    PARM *ZERO     WQ0014 155       Current System
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGFUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * LCL.USR Internal D8# YYYYMMDD = LCL.System Date Nbr USR
     C                     Z-ADDYL0015    YL0017           USR Internal D8
     C                     Z-ADDYL0017    WDBFD8           ETL Change Date
     C                     Z-ADDYL0016    WDBFTS           ETL Change time
      * Set PGM.*Record Data Changed flag
     C           QPUBZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BZCPHA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPUBZCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * UPD Comdty Mkt Prc IntfRT - Commodity Mrkt Price  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'N'       YL0021           Update Record U
     C                     Z-ADD*ZERO     YL0018           ETL Process Sta
     C                     MOVEL*BLANK    YL0019           ETL Error Reaso
     C                     MOVEL'N'       WN0001           Record Processe
     C                     MOVEL'N'       YL0020           Same Price-Upda
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WELQCD           Commodity Marke
     C                     KFLD           WELRCD           Commodity Price
     C                     KFLD           WEEQDT           Market Price Da
      * Setup key
     C                     MOVELWBLQCD    WELQCD           Commodity Marke
     C                     MOVELWBLRCD    WELRCD           Commodity Price
     C                     Z-ADDWBEQDT    WEEQDT           Market Price Da
      * Establish starting position
     C           KRSSE     CHAIN@F0CPDQ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1222' W0RTN   7
      * USER: Processing if Data record not found
      * Create Commodity Mrkt Price (OMF0CPP) Record If Pass Validations.
      * CASE: *OTHERWISE
      * Val for Existence      RT - Commodity Markets  * 
     C                     EXSR SFRVGN
      * Record Exist?
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Val for Existence      RT - Commodity Group  * 
     C                     EXSR SGRVGN
      * Record Exist?
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'Y'       WN0001           Record Processe
      * CRT Commodity Mrkt Prc CR - Commodity Mrkt Price  * 
     C                     EXSR SHCRRC
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD2         YL0018           ETL Process Sta
     C                     MOVEL'CMDGRP'  YL0019           ETL Error Reaso
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD2         YL0018           ETL Process Sta
     C                     MOVEL'CMDMKT'  YL0019           ETL Error Reaso
     C                     END                             *FI
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Save Original Prices.
      * CASE: *OTHERWISE
     C                     Z-ADDWEA5PR    YL0025           Commodity Marke
     C                     Z-ADDWEB8PR    YL0026           Projected Marke
      * Compare Prices for Update.
      * CASE: *OTHERWISE
      * CASE: DB1.Commodity Market Price NE PAR.Commodity Market Price
     C           WEA5PR    IFNE WBA5PR                     *IF
     C                     Z-ADDWBA5PR    YL0025           Commodity Marke
     C                     MOVEL'Y'       YL0021           Update Record U
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       YL0020           Same Price-Upda
     C                     END                             *FI
      * CASE: DB1.Projected Market Price NE PAR.Projected Market Price
     C           WEB8PR    IFNE WBB8PR                     *IF
     C                     Z-ADDWBB8PR    YL0026           Projected Marke
     C                     MOVEL'Y'       YL0021           Update Record U
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       YL0020           Same Price-Upda
     C                     END                             *FI
      * Prices are Different, Reset Same Price-Update Sts=N.
      * CASE: LCL.Update Record USR is Yes
     C           YL0021    IFEQ 'Y'                        *IF
     C                     MOVEL'N'       YL0020           Same Price-Upda
     C                     END                             *FI
      * Update Price.
      * CASE: LCL.Update Record USR is Yes
     C           YL0021    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WN0001           Record Processe
      * CHG Commodity Mrkt Prc CH - Commodity Mrkt Price  * 
     C                     EXSR SICHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Val for Existence      RT - Commodity Markets  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WFLQCD           Commodity Marke
      * Setup key
     C                     MOVELWBLQCD    WFLQCD           Commodity Marke
      * Establish starting position
     C           KRSSF     CHAIN@FYREDK              90    *
      * Data record not found
     C   90                MOVEL'USR1218' W0RTN   7
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Val for Existence      RT - Commodity Group  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WGLRCD           Commodity Price
      * Setup key
     C                     MOVELWBLRCD    WGLRCD           Commodity Price
      * Establish starting position
     C           KRSSG     CHAIN@FZREDN              90    *
      * Data record not found
     C   90                MOVEL'USR1220' W0RTN   7
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCRRC    BEGSR
      *================================================================
      * CRT Commodity Mrkt Prc CR - Commodity Mrkt Price  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0008  60       Job Time
     C                     MOVEL*BLANK    WN0009 10        User Id
     C                     MOVEL*BLANK    WN0010 10        Job Name
     C                     Z-ADD*ZERO     WN0011  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @F0CPDJ
     C                     MOVELWBLQCD    WHLQCD           Commodity Marke
     C                     MOVELWBLRCD    WHLRCD           Commodity Price
     C                     Z-ADDWBEQDT    WHEQDT           Market Price Da
     C                     Z-ADDWBA5PR    WHA5PR           Commodity Marke
     C                     Z-ADDWBB8PR    WHB8PR           Projected Marke
     C                     MOVEL*BLANK    WHUVST           EDI Status 1
     C                     MOVEL*BLANK    WHUWST           EDI Status 2
     C                     MOVEL*BLANK    WHUXST           EDI Status 3
     C                     MOVEL'A'       WHVSST           Record Status
      *
      * USER: Processing before Data update
      * Set Date/Time StampETL IF
      * Get System Date/Time  US - /UT User Source  * 
      * Get System Date & Time
     C                     MOVE *DATE     YL0022           CCYYMMDD
     C                     TIME           YL0023           HHMMSS
      * LCL.USR Internal D8# YYYYMMDD = LCL.System Date Nbr USR
     C                     Z-ADDYL0022    YL0024           USR Internal D8
      * PAR.Job Date = LCL.USR Internal D8# YYYYMMDD
     C           YL0024    IFEQ *ZERO
     C                     Z-ADD*ZERO     WHAXDT
     C                     ELSE
     C           YL0024    SUB  19000000  WHAXDT           Job Date
     C                     END
     C                     Z-ADDYL0023    WHAATM           Job Time
     C                     MOVEL##USR     WHAYNA           User Id
     C                     MOVEL##PGM     WHA0NA           Job Name
     C           KLCRSH    KLIST
     C                     KFLD           WHLQCD           Commodity Marke
     C                     KFLD           WHLRCD           Commodity Price
     C                     KFLD           WHEQDT           Market Price Da
      * Check for duplicate primary key
     C           KLCRSH    SETLL@F0CPDJ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1223' W0RTN   7
      * Send message 'Commodity Mrkt Price   EX'
     C                     MOVEL'USR1223' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C                     WRITE@F0CPDJ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICHRC    BEGSR
      *================================================================
      * CHG Commodity Mrkt Prc CH - Commodity Mrkt Price  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0012  60       Job Time
     C                     MOVEL*BLANK    WN0013 10        User Id
     C                     MOVEL*BLANK    WN0014 10        Job Name
     C                     Z-ADD*ZERO     WN0015  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @F0CPDJ
     C                     MOVELWELQCD    WHLQCD    P      Commodity Marke
     C                     MOVELWELRCD    WHLRCD    P      Commodity Price
     C                     Z-ADDWEEQDT    WHEQDT           Market Price Da
      *
     C           KLCHSI    KLIST
     C                     KFLD           WHLQCD           Commodity Marke
     C                     KFLD           WHLRCD           Commodity Price
     C                     KFLD           WHEQDT           Market Price Da
     C           KLCHSI    CHAIN@F0CPDJ              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'OMF0CPL0'MDACP
     C                     MOVEL'@F0CPDJ' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOMF01    YBRDCS
      * Move non-key fields to @F0CPDJ
     C                     Z-ADDYL0025    WHA5PR           Commodity Marke
     C                     Z-ADDYL0026    WHB8PR           Projected Marke
     C                     MOVELWEUVST    WHUVST    P      EDI Status 1
     C                     MOVELWEUWST    WHUWST    P      EDI Status 2
     C                     MOVELWEUXST    WHUXST    P      EDI Status 3
     C                     MOVELWEVSST    WHVSST    P      Record Status
      *
      * Set PGM.*Record Data Changed flag
     C           QOMF01    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time StampETL IF
      * Get System Date/Time  US - /UT User Source  * 
     C                     MOVE *DATE     YL0022           CCYYMMDD
     C                     TIME           YL0023           HHMMSS
      * LCL.USR Internal D8# YYYYMMDD = LCL.System Date Nbr USR
     C                     Z-ADDYL0022    YL0024           USR Internal D8
      * PAR.Job Date = LCL.USR Internal D8# YYYYMMDD
     C           YL0024    IFEQ *ZERO
     C                     Z-ADD*ZERO     WHAXDT
     C                     ELSE
     C           YL0024    SUB  19000000  WHAXDT           Job Date
     C                     END
     C                     Z-ADDYL0023    WHAATM           Job Time
     C                     MOVEL##USR     WHAYNA           User Id
     C                     MOVEL##PGM     WHA0NA           Job Name
      * Set PGM.*Record Data Changed flag
     C           QOMF01    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@F0CPDJ                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMF0CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WABCDT           Post to G/L Dat
     C                     Z-ADD*ZERO     WACQNB           Julian Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEINB           Week Number
     C                     Z-ADD*ZERO     WAAQNB           Billing Cycle
     C                     Z-ADD*ZERO     WAOJDT           HPS PIC Date
     C                     Z-ADD*ZERO     WANQNX           HPS Calendar Ye
     C                     Z-ADD*ZERO     WANRNX           HPS Calendar We
     C                     Z-ADD*ZERO     WAOKDT           Calendar Unused
     C                     Z-ADD*ZERO     WAOLDT           Calendar Unused
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBEQDT           Market Price Da
     C                     Z-ADD*ZERO     WBA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WBB8PR           Projected Marke
     C                     Z-ADD*ZERO     WBE8NZ           ETL Process Sta
     C                     Z-ADD*ZERO     WBBED8           ETL Create Date
     C                     Z-ADD*ZERO     WBBETS           ETL Create Time
     C                     Z-ADD*ZERO     WBBFD8           ETL Change Date
     C                     Z-ADD*ZERO     WBBFTS           ETL Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCM8NB           System Value Nu
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEEQDT           Market Price Da
     C                     Z-ADD*ZERO     WEA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WEB8PR           Projected Marke
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFAATM           Job Time
     C                     Z-ADD*ZERO     WFAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGAATM           Job Time
     C                     Z-ADD*ZERO     WGAXDT           Job Date
      * Clear all neither parameters
      * CRT Commodity Mrkt Prc CR - Commodity Mrkt Price  * 
     C                     Z-ADD*ZERO     WHAATM           Job Time
     C                     Z-ADD*ZERO     WHAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SDCHRC.
     C                     MOVEL*BLANK    WL0001  3
     C                     MOVEL*BLANK    WL0002  7
     C                     Z-ADD*ZERO     WL0003  70
     C                     Z-ADD*ZERO     WL0004 114
     C                     Z-ADD*ZERO     WL0005 114
     C                     MOVEL*BLANK    WL0006  1
     C                     Z-ADD*ZERO     WL0007  10
     C                     MOVEL*BLANK    WL0008  6
      * Define local work field Production Date Prev USR
     C                     Z-ADD*ZERO     YL0001  70
      * Define local work field Number of Days
     C                     Z-ADD*ZERO     YL0002  50
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0003  30
      * Define local work field First Time Through USR
     C                     MOVEL*BLANK    YL0004  1
      * Define local work field System Date Nbr USR
     C                     Z-ADD*ZERO     YL0005  80
      * Define null work field Current System Time
     C                     Z-ADD*ZERO     YN0001 155
      * Define local work field System Date USR
     C                     Z-ADD*ZERO     YL0006  70
      * Define local work field Bypass Market Date Chk U
     C                     MOVEL*BLANK    YL0007  1
      * Define local work field Commodity Market Code
     C                     MOVEL*BLANK    YL0008  3
      * Define local work field Commodity Market Code USR
     C                     MOVEL*BLANK    YL0009  3
      * Define local work field Email Subject USR
     C                     MOVEL*BLANK    YL0010 50
      * Define local work field Email Message USR
     C                     MOVEL*BLANK    YL0011256
      * Define local work field Library List Code
     C                     MOVEL*BLANK    YL0012 10
      * Define local work field @Library List Code
     C                     MOVEL*BLANK    YL0013 10
      * Define local work field ESEND Distribution List U
     C                     MOVEL*BLANK    YL0014 30
      * Define local work field System Date Nbr USR
     C                     Z-ADD*ZERO     YL0015  80
      * Define local work field System Time USR
     C                     Z-ADD*ZERO     YL0016  60
      * Define local work field USR Internal D8# YYYYMMDD
     C                     Z-ADD*ZERO     YL0017  80
      * Define local work field ETL Process Status
     C                     Z-ADD*ZERO     YL0018  10
      * Define local work field ETL Error Reason
     C                     MOVEL*BLANK    YL0019  6
      * Define local work field Same Price-Update Sts USR
     C                     MOVEL*BLANK    YL0020  1
      * Define local work field Update Record USR
     C                     MOVEL*BLANK    YL0021  1
      * Define local work field System Date Nbr USR
     C                     Z-ADD*ZERO     YL0022  80
      * Define local work field System Time USR
     C                     Z-ADD*ZERO     YL0023  60
      * Define local work field USR Internal D8# YYYYMMDD
     C                     Z-ADD*ZERO     YL0024  80
      * Define local work field Commodity Market Price
     C                     Z-ADD*ZERO     YL0025 114
      * Define local work field Projected Market Price
     C                     Z-ADD*ZERO     YL0026 114
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 CMDMKTDAY
00002 CMDMKTDTE
00003 OMS Commodity Market Pric
00004 es Updated
00005 OMS Commodity Market
00006 Prices Updated For Market
00007 PRKFLIB
00008 - TEST
00009 CMDMKTPRC
