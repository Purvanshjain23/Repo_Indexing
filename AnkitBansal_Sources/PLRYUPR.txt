/***************************************************************** */
/*  PROGRAM NUMBER:  PLRYUPR                                       */
/*  PROGRAM NAME:    Send the Audit Information via email          */
/*                   From and to Date and Email address            */
/*                   This is going to Brad Knadler at              */
/*                   Triumph Foods                                 */
/*                                                                 */
/*  PROGRAMMER:      Susan Mason                                   */
/*  CREATE DATE:     09/28/12                                      */
/*                                                                 */
/*  FUNCTION:        this cl was developed to send the Audit       */
/*                   information to 1 person only at Triumph       */
/*                   every day and will be executed on the         */
/*                   job scheduler                                 */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*                                                                 */
/*  11/05/2014 SLM   Remove PRKDEVQRY make sure sequel is in       */
/*                   PRKPLIB                                       */
/*******************************************************************/
             PGM        PARM(&EMAIL &FDTE &TDTE &CMPCDE)
/*           PGM        PARM(&CMPCDE &FDTE &TDTE &EMAIL)           */

             DCL        VAR(&CMPCDE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(25)
             DCL        VAR(&FDTE) TYPE(*CHAR) LEN(7) /* CYYMMDD*/
             DCL        VAR(&TDTE) TYPE(*CHAR) LEN(7) /* CYYMMDD */
             DCL        VAR(&FDATE) TYPE(*CHAR) LEN(8) /* CYYMMDD*/
             DCL        VAR(&TDATE) TYPE(*CHAR) LEN(8) /* CYYMMDD*/
             DCL        VAR(&CHKF) TYPE(*CHAR) LEN(7)
/* NUMERIC VALUES                                                  */
             DCL        VAR(&FNUM) TYPE(*DEC) LEN(7 0) /* CYYMMDD */
             DCL        VAR(&TNUM) TYPE(*DEC) LEN(7 0) /* CYYMMDD */

             DCL        VAR(&CMPNUM) TYPE(*DEC) LEN(3 0) VALUE(000)

             DCL        VAR(&TEXT) TYPE(*CHAR) LEN(50) +
                          VALUE('Audit Information for Job Date(1)  +
                          and Job Date')

             CHGVAR VAR(&CMPNUM) VALUE(&CMPCDE)
             CHGVAR VAR(&CHKF) VALUE(&FDTE)
             IF COND(&CHKF *EQ '0000000') THEN(DO)

/* ******************************   */
/* Calculate from and to date       */
/* based on job date calculate the  */
/* TO date:                         */
/* job date                         */
/* From date                        */
/* job date get 1 previous kill dte */
/* ******************************   */

             CALL       PGM(PLRWXFR) PARM(' ' &CMPNUM &FDTE &TDTE)

             ENDDO

/*****************************************************************/

             CVTDAT     DATE(&FDTE) TOVAR(&FDATE) FROMFMT(*CYMD) +
                          TOFMT(*MDY) TOSEP('/')
             CVTDAT     DATE(&TDTE) TOVAR(&TDATE) FROMFMT(*CYMD) +
                          TOFMT(*MDY) TOSEP('/')

             EXECUTE    VIEW(*LIBL/AUDITLOG) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL) +
                          EMLMSG(&TEXT) SETVAR((&FDATE &FDATE) +
                          (&TDATE &TDATE))
ENDPGM
