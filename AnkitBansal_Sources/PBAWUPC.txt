/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PBAWUPC                                       */
/*  PROGRAM NAME:    DELETE EXPORT DETAIL WORK FILE RECORDS        */
/*                                                                 */
/*  PROGRAMMER:      LARA BUSER                                    */
/*  CREATE DATE:     11/22/2011                                    */
/*  FUNCTION:        THIS CL WILL USE SQL TO DELETE RECORDS        */
/*                   THAT MATCH THE PASSED IN CUSTOMER AND         */
/*                   CUSTOMER PO NUMBER                            */
/*  PARAMETERS:                                                    */
/*    &CUSTOMERN 15.5  CUSTOMER NUMBER                             */
/*    &CUSTPO    15    CUSTOMER PO NUMBER                          */
/*    &RTNCODE    7    RETURN CODE                                 */
/*******************************************************************/
/*  Modification History                                           */
/*  10/10/2013 LJB E002823 NO CHANGES WERE MADE. I JUST SET THIS   */
/*             UP TO RUN TESTS, SEE COMMENTS IN THE CODE           */
/* RMC 07/18/16   E004201 GET READY FOR PROMOTE TO PROD          */
/*******************************************************************/
             PGM        PARM(&CUSTOMERN &CUSTPO &RTNCODE)

             DCL        VAR(&RTNCODE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&CUSTOMERN) TYPE(*DEC)
             DCL        VAR(&CUSTOMER) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&CUSTOMERA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&CUSTPO) TYPE(*CHAR) LEN(15)

/* MAINLINE                                                        */
             DCLF       FILE(PNHHCPL1)

/***** FOR TEST ONLY                         +
       ADDLIBLE PRKDEVQRY *LAST                      */

             MONMSG     MSGID(CPF0000)

/* READ THE EXPORT DETAIL WORK FILE RECORDS                         */
 NEXTREC:    RCVF
             MONMSG     MSGID(CPF0864) EXEC(GOTO CMDLBL(END)) /* EOF */

             CHGVAR     VAR(&CUSTOMER) VALUE(&CUSTOMERN)
             CHGVAR     VAR(&CUSTOMERA) VALUE(&CUSTOMER)

/* IF CUSTOMER AND PO NUMBER DON'T MATCH THEN LOOP TO NEXT RECORD    */
             IF         COND((&HHBKC7 *NE &CUSTOMER) *AND (&HHBCNA +
                          *NE &CUSTPO)) THEN(GOTO CMDLBL(NEXTREC))

/* Delete CUSTOMER PO RECORDS FROM DETAIL WORK FILE                */
             DELETE     VIEW(PNHHCPPV1) SETVAR((&CUSTPO &CUSTPO) +
                          (&CUSTOMER &CUSTOMERA)) OPTIMIZE(*MINWAIT)

/* SET FLAG IF ERROR AND RETURN IT TO CALLING PROGRAM               */
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGVAR     VAR(&RTNCODE) VALUE('SQLDERR')
             CHGJOB     LOG(4 00 *SECLVL)
             ENDDO

 END:     ENDPGM
