// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKOJE1R
// ?Date: 14.08.2025 Time: 02:52:19
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification history
DO;

//?H16853 - ISE - 02/03/21 - Increased Buy Order length from 5 to 7.
//?                          Recompilation only.
//?09/23/2016 Brad Baden  E7214 - MMP Floor and Ceiling Pricing
//?  Show minus sign for negative values on the Ceiling Pricing
ENDDO;

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Initialize key screen

// KEY.Market Code Usr = PAR.FPC Commodity Market Code
KEY.Market_Code_Usr = PAR.FPC_Commodity_Market_Code;

// KEY.@Commodity Price Group = PAR.FPC Commodity Price Group
KEY.@Commodity_Price_Group = PAR.FPC_Commodity_Price_Group;

//?USER: Validate key screen

//?Prompt on Market Code
CASE;

// IF KEY.*CMD key is *Prompt
IF KEY.*CMD_key = '04';

// AND PGM.*Cursor field <IS> KEY.Market Code Usr
AND PGM.*Cursor_field = KEY.Market_Code_Usr;

// Call program Sel Commodity Market  XF.
CALL PROGRAM(Sel Commodity Market  XF) ('PDEDSRR');
PARAMETER(KEY.Market_Code_Usr);

ENDIF;

//?Prompt on Price Group
CASE;

// IF KEY.*CMD key is *Prompt
IF KEY.*CMD_key = '04';

// AND PGM.*Cursor field <IS> KEY.@Commodity Price Group
AND PGM.*Cursor_field = KEY.@Commodity_Price_Group;

// Call program Sel Commodity Group   XF.
CALL PROGRAM(Sel Commodity Group   XF) ('PDECSRR');
PARAMETER(KEY.@Commodity_Price_Group);

ENDIF;

// KEY.FPC Commodity Market Code = KEY.Market Code Usr
KEY.FPC_Commodity_Market_Code = KEY.Market_Code_Usr;

// KEY.FPC Commodity Price Group = KEY.@Commodity Price Group
KEY.FPC_Commodity_Price_Group = KEY.@Commodity_Price_Group;

// Call program Val Commodity Market  XF.
CALL PROGRAM(Val Commodity Market  XF) ('PDG1XFR');
PARAMETER(KEY.FPC_Commodity_Market_Code);
PARAMETER(KEY.Market_Code_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?Validate market code
CASE;

// IF WRK.Invalid Y/N USR is Yes
IF WRK.Invalid_Y_N_USR = 'Y';

// Send error message - 'Market Code not found.'
ERROR(PRK0152);

ENDIF;

// Call program Val Commodity Group   XF.
CALL PROGRAM(Val Commodity Group   XF) ('PDG2XFR');
PARAMETER(KEY.FPC_Commodity_Price_Group);
PARAMETER(KEY.Market_Group_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?Validate price group
CASE;

// IF WRK.Invalid Y/N USR is Yes
IF WRK.Invalid_Y_N_USR = 'Y';

// Send error message - 'Commodity Group not found.'
ERROR(PRK0158);

ENDIF;

//?USER: Initialize detail screen (new record)

// DTL.Market Code Desc USR = KEY.Market Code Desc USR
DTL.Market_Code_Desc_USR = KEY.Market_Code_Desc_USR;

// DTL.Market Group Desc USR = KEY.Market Group Desc USR
DTL.Market_Group_Desc_USR = KEY.Market_Group_Desc_USR;

//?USER: Initialize detail screen (existing record)

// Call program Val Commodity Market  XF.
CALL PROGRAM(Val Commodity Market  XF) ('PDG1XFR');
PARAMETER(DTL.FPC_Commodity_Market_Code);
PARAMETER(DTL.Market_Code_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

// Call program Val Commodity Group   XF.
CALL PROGRAM(Val Commodity Group   XF) ('PDG2XFR');
PARAMETER(DTL.FPC_Commodity_Price_Group);
PARAMETER(DTL.Market_Group_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?USER: Validate detail screen fields

//?Prompt on Company #
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.FPC Company Number
AND PGM.*Cursor_field = DTL.FPC_Company_Number;

// Call program Sel Company Control   SR.
CALL PROGRAM(Sel Company Control   SR) ('PKLFSRR');
PARAMETER(DTL.FPC_Company_Number);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?Prompt on Date Method
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.FPC Market Date Method
AND PGM.*Cursor_field = DTL.FPC_Market_Date_Method;

// Call program Sel Market Date Method UP.
CALL PROGRAM(Sel Market Date Method UP) ('PDZWXFR');
PARAMETER(PGM.*Return_code);
PARAMETER(DTL.FPC_Company_Number);
PARAMETER(DTL.FPC_Market_Date_Method);
PARAMETER(DTL.Market_Date_Method_Desc);
PARAMETER('H');

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(CRT Producer SC FP ComCR) TYPE(CRTOBJ) FILE(PKEBREP)           AB1208316;

//?USER: Change DBF record

EXECUTE FUNCTION(CHG Producer SC FP ComCH) TYPE(CHGOBJ) FILE(PKEBREP)           AB1208317;

