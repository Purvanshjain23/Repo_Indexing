// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUCLPVR
// ?Date: 14.08.2025 Time: 03:49:56
// ?------------------------------------------------------------------------------------------------

//?USER: Validate fields

EXECUTE FUNCTION(Rtv Prd Beg/End Dt    RT) TYPE(RTVOBJ) FILE(CAATREP)           AC1831864;
PARAMETER(360);
PARAMETER(DTL.To_Date_USR);
PARAMETER('W');
PARAMETER(DTL.Period_Beginning_Date);
PARAMETER(DTL.Period_Ending_Date);
{
 //?USER: Initialize routine

 // LCL.First Time Flag = CND.Yes
 LCL.First_Time_Flag = 'Y';

 //?USER: Process Data record

 //?WEEK (Prior Week)
 CASE;

 // IF PAR.Period Type USR is Week
 IF PAR.Period_Type_USR = 'W';

 // PAR.Period Beginning Date = DB1.Period Beginning Date
 PAR.Period_Beginning_Date = DB1.Period_Beginning_Date;

 // PAR.Period Ending Date = DB1.Period Ending Date
 PAR.Period_Ending_Date = DB1.Period_Ending_Date;

 QUIT;

 ENDIF;

 //?MONTH (Month To Date)
 CASE;

 // IF PAR.Period Type USR is Month
 IF PAR.Period_Type_USR = 'M';

 //?FIRST TIME
 CASE;

 // IF LCL.First Time Flag is Yes
 IF LCL.First_Time_Flag = 'Y';

 // PAR.Accounting Period Code = DB1.Accounting Period Code
 PAR.Accounting_Period_Code = DB1.Accounting_Period_Code;

 // PAR.Period Ending Date = DB1.Period Ending Date
 PAR.Period_Ending_Date = DB1.Period_Ending_Date;

 // LCL.First Time Flag = CND.NO
 LCL.First_Time_Flag = 'N';

 ENDIF;

 CASE;

 // IF DB1.Accounting Period Code NE PAR.Accounting Period Code
 IF DB1.Accounting_Period_Code <> PAR.Accounting_Period_Code;

 QUIT;

 ENDIF;

 // PAR.Period Beginning Date = DB1.Period Beginning Date
 PAR.Period_Beginning_Date = DB1.Period_Beginning_Date;

 ENDIF;

 //?QUARTER (Quarter to Date)
 CASE;

 // IF PAR.Period Type USR is Quarter
 IF PAR.Period_Type_USR = 'Q';

 //?FIRST TIME
 CASE;

 // IF LCL.First Time Flag is Yes
 IF LCL.First_Time_Flag = 'Y';

 // PAR.Accounting Period Code = DB1.Accounting Period Code
 PAR.Accounting_Period_Code = DB1.Accounting_Period_Code;

 // PAR.Period Ending Date = DB1.Period Ending Date
 PAR.Period_Ending_Date = DB1.Period_Ending_Date;

 // PAR.Count USR = CON.1
 PAR.Count_USR = 1;

 // LCL.First Time Flag = CND.NO
 LCL.First_Time_Flag = 'N';

 ENDIF;

 //?CHG: Accounting Period
 CASE;

 // IF DB1.Accounting Period Code NE PAR.Accounting Period Code
 IF DB1.Accounting_Period_Code <> PAR.Accounting_Period_Code;

 // PAR.Count USR = PAR.Count USR + CON.1
 PAR.Count_USR = PAR.Count_USR + 1;

 // PAR.Accounting Period Code = DB1.Accounting Period Code
 PAR.Accounting_Period_Code = DB1.Accounting_Period_Code;

 ENDIF;

 CASE;

 // IF PAR.Count USR is GT 3
 IF PAR.Count_USR > 3;

 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Period Beginning Date = DB1.Period Beginning Date
 PAR.Period_Beginning_Date = DB1.Period_Beginning_Date;

 ENDIF;

 ENDIF;

 //?YEAR (Year To Date)
 CASE;

 // IF PAR.Period Type USR is Year
 IF PAR.Period_Type_USR = 'Y';

 // PAR.Period Ending Date = DB1.Period Ending Date
 PAR.Period_Ending_Date = DB1.Period_Ending_Date;

 EXECUTE FUNCTION(RTV First Dte of PeriodRT) TYPE(RTVOBJ) FILE(CAATREP)          AC1470512;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Accounting_Year_Code);
 PARAMETER(1);
 PARAMETER(PAR.Period_Beginning_Date);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

 }

 QUIT;

 ENDIF;

}


//?USER: User defined action

//?Inter-Company
// Call program Prt Inter-Co Price/UpdPF.
CALL PROGRAM(Prt Inter-Co Price/UpdPF) ('PPUCPFR');
PARAMETER(DTL.Period_Ending_Date);
PARAMETER(DTL.Period_Beginning_Date);
PARAMETER(DTL.Period_Ending_Date);
PARAMETER(LCL.Error_Report_2_Status_Usr);
PARAMETER('P');
PARAMETER('G');

// Call program Prt Inter-Co Price/UpdPF.
CALL PROGRAM(Prt Inter-Co Price/UpdPF) ('PPUCPFR');
PARAMETER(DTL.Period_Ending_Date);
PARAMETER(DTL.Period_Beginning_Date);
PARAMETER(DTL.Period_Ending_Date);
PARAMETER(LCL.Error_Report_2_Status_Usr);
PARAMETER('P');
PARAMETER('S');

//?Affiliated
// Call program Prt IC Sales Adj/Upd  PF.
CALL PROGRAM(Prt IC Sales Adj/Upd  PF) ('PNKLPFR');
PARAMETER('IS');
PARAMETER(DTL.Period_Ending_Date);

