     H/TITLE Bld WF Fax/Email Dtl  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/23/10  Time  : 09:03:07
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMEQCPL1IF  E           K        DISK
      * RTV : WF Fax/Email Header       Retrieval index
      *
     FOMHSTPL1IF  E           K        DISK
      * RTV : Sales History             Retrieval index
      *
     FOPEXREL2IF  E           K        DISK
      * RTV : Order Types               Active order Types
      *
     FPDICCPLAIF  E           K        DISK
      * RSQ : History Dtl Accrual       Co/Or/Sq/S2/BCde
      *
     FPPASCPL0IF  E           K        DISK                      A
      * UPD : WF Fax/Email Detail       Update index
      *
     I@EQCPW4
      * WF Fax/Email Header       Retrieval index
      * Renamed input format fields
     I              EQC4NB                          WAC4NB
     I              EQAIC3                          WAAIC3
     I              EQFRAA                          WAFRAA
      *
     I@FHSTD3
      * Sales History             Retrieval index
      * Renamed input format fields
     I              F4AIC3                          WBAIC3
     I              F4C4NB                          WBC4NB
     I              F4DPNB                          WBDPNB
     I              F4UENB                          WBUENB
     I              F4MONA                          WBMONA
     I              F4RJCD                          WBRJCD
     I              F4RKCD                          WBRKCD
     I              F4GPTX                          WBGPTX
     I              F4ABTX                          WBABTX
     I              F4KXCD                          WBKXCD
     I              F4BOCD                          WBBOCD
     I              F4BTC7                          WBBTC7
     I              F4ANC7                          WBANC7
     I              F4AQTX                          WBAQTX
     I              F4BKC7                          WBBKC7
     I              F4BRTX                          WBBRTX
     I              F4HNNA                          WBHNNA
     I              F4DBCD                          WBDBCD
     I              F4CKTX                          WBCKTX
     I              F4BCNA                          WBBCNA
     I              F4A0DT                          WBA0DT
     I              F4ACDT                          WBACDT
     I              F4R4CD                          WBR4CD
     I              F4R5CD                          WBR5CD
     I              F4BFCD                          WBBFCD
     I              F4Q4CD                          WBQ4CD
     I              F4AQCD                          WBAQCD
     I              F4TBNB                          WBTBNB
     I              F4BZNA                          WBBZNA
     I              F4RLCD                          WBRLCD
     I              F4JNCD                          WBJNCD
     I              F4Q2CD                          WBQ2CD
     I              F4U2ST                          WBU2ST
     I              F4ATIN                          WBATIN
     I              F4T3NB                          WBT3NB
     I              F4RSRN                          WBRSRN
     I              F4ORIT                          WBORIT
     I              F4AJCD                          WBAJCD
     I              F4AVQT                          WBAVQT
     I              F4D0WG                          WBD0WG
     I              F4CCQT                          WBCCQT
     I              F4AUWG                          WBAUWG
     I              F4AGCD                          WBAGCD
     I              F4AKPR                          WBAKPR
     I              F4AUPR                          WBAUPR
     I              F4CRCD                          WBCRCD
     I              F4A5DT                          WBA5DT
     I              F4AWDT                          WBAWDT
     I              F4HDDT                          WBHDDT
     I              F4AGCS                          WBAGCS
     I              F4AQCS                          WBAQCS
     I              F4AVWG                          WBAVWG
     I              F4AYVA                          WBAYVA
     I              F4AMST                          WBAMST
     I              F4ANST                          WBANST
     I              F4VAST                          WBVAST
     I              F4L6NB                          WBL6NB
     I              F4UMCD                          WBUMCD
     I              F4HCDT                          WBHCDT
     I              F4ESNB                          WBESNB
     I              F4ETNB                          WBETNB
     I              F4BZNB                          WBBZNB
     I              F4EXQT                          WBEXQT
     I              F4BYWG                          WBBYWG
     I              F4S5NB                          WBS5NB
     I              F4MAVA                          WBMAVA
     I              F4KDVA                          WBKDVA
     I              F4USVA                          WBUSVA
     I              F4UTVA                          WBUTVA
     I              F4A4WG                          WBA4WG
     I              F4CKNB                          WBCKNB
     I              F4BMST                          WBBMST
     I              F4R8NB                          WBR8NB
     I              F4RMCD                          WBRMCD
     I              F4BZPR                          WBBZPR
     I              F4RDCD                          WBRDCD
     I              F4Q7CD                          WBQ7CD
     I              F4EXDT                          WBEXDT
     I              F4LQCD                          WBLQCD
     I              F4HICD                          WBHICD
     I              F4RBCD                          WBRBCD
     I              F4RGNB                          WBRGNB
     I              F4RHNB                          WBRHNB
     I              F4RINB                          WBRINB
     I              F4R1NB                          WBR1NB
     I              F4CONB                          WBCONB
     I              F4CEST                          WBCEST
     I              F4GNDT                          WBGNDT
     I              F4RMNB                          WBRMNB
     I              F4AODT                          WBAODT
     I              F4LLCD                          WBLLCD
     I              F4LMCD                          WBLMCD
     I              F4SKNB                          WBSKNB
     I              F4SLNB                          WBSLNB
     I              F4SMNB                          WBSMNB
     I              F4G7NA                          WBG7NA
     I              F4ONVA                          WBONVA
     I              F4N0CD                          WBN0CD
     I              F4B4NB                          WBB4NB
     I              F4B5NB                          WBB5NB
     I              F4N1CD                          WBN1CD
     I              F4GIDT                          WBGIDT
     I              F4Z1ST                          WBZ1ST
     I              F4ULVA                          WBULVA
     I              F4UNVA                          WBUNVA
     I              F4UOVA                          WBUOVA
     I              F4UPVA                          WBUPVA
     I              F4UQVA                          WBUQVA
     I              F4SDCD                          WBSDCD
     I              F4QZCD                          WBQZCD
     I              F4XWST                          WBXWST
     I              F4T9CD                          WBT9CD
     I              F4UBCD                          WBUBCD
     I              F4CFC7                          WBCFC7
     I              F4X1CD                          WBX1CD
     I              F4GASX                          WBGASX
     I              F4DUPR                          WBDUPR
     I              F4B6VL                          WBB6VL
     I              F4IANX                          WBIANX
     I              F4IBNX                          WBIBNX
     I              F4RPCD                          WBRPCD
     I              F4NYDT                          WBNYDT
     I              F4BZTM                          WBBZTM
     I              F4Z4NB                          WBZ4NB
     I              F4XACD                          WBXACD
     I              F4OANA                          WBOANA
     I              F4OKTX                          WBOKTX
     I              F4K4TX                          WBK4TX
     I              F4NBBO                          WBNBBO
     I              F4OCFR                          WBOCFR
     I              F4C0C7                          WBC0C7
     I              F4A1AA                          WBA1AA
     I              F4VEST                          WBVEST
     I              F4A5PR                          WBA5PR
     I              F4CDPR                          WBCDPR
     I              F4D0PR                          WBD0PR
     I              F4D0VL                          WBD0VL
     I              F4IRSX                          WBIRSX
     I              F4CEVL                          WBCEVL
     I              F4ISSX                          WBISSX
     I              F4ITSX                          WBITSX
     I              F4IUSX                          WBIUSX
     I              F4OHDT                          WBOHDT
     I              F4D9PR                          WBD9PR
     I              F4CFVL                          WBCFVL
     I              F4UVST                          WBUVST
     I              F4UWST                          WBUWST
     I              F4UXST                          WBUXST
     I              F4AATM                          WBAATM
     I              F4AYNA                          WBAYNA
     I              F4A0NA                          WBA0NA
     I              F4AXDT                          WBAXDT
      *
     I@EXRETY
      * Order Types               Active order Types
      * Renamed input format fields
     I              EXJNCD                          WCJNCD
     I              EXJVNA                          WCJVNA
     I              EXOAST                          WCOAST
     I              EXOBST                          WCOBST
     I              EXOEST                          WCOEST
     I              EXOFST                          WCOFST
     I              EXVBST                          WCVBST
     I              EXPYST                          WCPYST
     I              EXX8ST                          WCX8ST
     I              EXISTX                          WCISTX
     I              EXUVST                          WCUVST
     I              EXUWST                          WCUWST
     I              EXUXST                          WCUXST
     I              EXVSST                          WCVSST
     I              EXAATM                          WCAATM
     I              EXAYNA                          WCAYNA
     I              EXA0NA                          WCA0NA
     I              EXAXDT                          WCAXDT
      *
     I@ICCPW5
      * History Dtl Accrual       Co/Or/Sq/S2/BCde
      * Renamed input format fields
     I              ICAIC3                          WDAIC3
     I              ICC4NB                          WDC4NB
     I              ICDPNB                          WDDPNB
     I              ICUENB                          WDUENB
     I              ICDXNB                          WDDXNB
     I              ICBKPR                          WDBKPR
     I              ICAYVA                          WDAYVA
     I              ICEDVL                          WDEDVL
     I              ICHGCD                          WDHGCD
     I              ICBKC7                          WDBKC7
     I              ICPTDT                          WDPTDT
     I              ICBYWG                          WDBYWG
     I              ICBVST                          WDBVST
     I              ICP7SX                          WDP7SX
     I              ICOKCD                          WDOKCD
     I              ICQQSX                          WDQQSX
     I              ICQRSX                          WDQRSX
     I              ICFLTX                          WDFLTX
     I              ICQSSX                          WDQSSX
     I              ICPRDT                          WDPRDT
     I              ICPSDT                          WDPSDT
     I              ICEGVL                          WDEGVL
     I              ICEHVL                          WDEHVL
     I              ICAVNB                          WDAVNB
     I              ICDSCD                          WDDSCD
     I              ICFMTX                          WDFMTX
     I              ICFNTX                          WDFNTX
     I              ICQ9DT                          WDQ9DT
     I              ICFOTX                          WDFOTX
     I              ICH1NY                          WDH1NY
     I              ICKRT1                          WDKRT1
     I              ICKST1                          WDKST1
     I              ICHJAA                          WDHJAA
     I              ICHKAA                          WDHKAA
     I              ICHHAA                          WDHHAA
     I              ICOJCD                          WDOJCD
     I              ICAATM                          WDAATM
     I              ICAYNA                          WDAYNA
     I              ICA0NA                          WDA0NA
     I              ICAXDT                          WDAXDT
      *
     I@ASCPWU
      * WF Fax/Email Detail       Update index
      * Renamed input format fields
     I              ASTBSX                          WETBSX
     I              ASFRAA                          WEFRAA
     I              ASAIC3                          WEAIC3
     I              ASC4NB                          WEC4NB
     I              ASDPNB                          WEDPNB
     I              ASUENB                          WEUENB
     I              ASA0DT                          WEA0DT
     I              ASAWDT                          WEAWDT
     I              ASEHC7                          WEEHC7
     I              ASEGC7                          WEEGC7
     I              ASGNDT                          WEGNDT
     I              ASCONB                          WECONB
     I              ASBCNA                          WEBCNA
     I              ASBRTX                          WEBRTX
     I              ASHNNA                          WEHNNA
     I              ASDBCD                          WEDBCD
     I              ASCKTX                          WECKTX
     I              ASHGCD                          WEHGCD
     I              ASGENA                          WEGENA
     I              ASAVQT                          WEAVQT
     I              ASEXQT                          WEEXQT
     I              ASBYWG                          WEBYWG
     I              ASAKPR                          WEAKPR
     I              ASCRCD                          WECRCD
     I              ASA1VA                          WEA1VA
     I              ASBKPR                          WEBKPR
     I              ASAYVA                          WEAYVA
     I              ASE4T1                          WEE4T1
     I              ASFWAA                          WEFWAA
     I              ASTCSX                          WETCSX
     I              ASTDSX                          WETDSX
     I              ASTESX                          WETESX
     I              ASK5ST                          WEK5ST
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPPAS1    E DSPPASCPL0
      * UPD : WF Fax/Email Detail       Update index
      * Renamed input format fields
     I              ASTBSX                          WETBSX
     I              ASFRAA                          WEFRAA
     I              ASAIC3                          WEAIC3
     I              ASC4NB                          WEC4NB
     I              ASDPNB                          WEDPNB
     I              ASUENB                          WEUENB
     I              ASA0DT                          WEA0DT
     I              ASAWDT                          WEAWDT
     I              ASEHC7                          WEEHC7
     I              ASEGC7                          WEEGC7
     I              ASGNDT                          WEGNDT
     I              ASCONB                          WECONB
     I              ASBCNA                          WEBCNA
     I              ASBRTX                          WEBRTX
     I              ASHNNA                          WEHNNA
     I              ASDBCD                          WEDBCD
     I              ASCKTX                          WECKTX
     I              ASHGCD                          WEHGCD
     I              ASGENA                          WEGENA
     I              ASAVQT                          WEAVQT
     I              ASEXQT                          WEEXQT
     I              ASBYWG                          WEBYWG
     I              ASAKPR                          WEAKPR
     I              ASCRCD                          WECRCD
     I              ASA1VA                          WEA1VA
     I              ASBKPR                          WEBKPR
     I              ASAYVA                          WEAYVA
     I              ASE4T1                          WEE4T1
     I              ASFWAA                          WEFWAA
     I              ASTCSX                          WETCSX
     I              ASTDSX                          WETDSX
     I              ASTESX                          WETESX
     I              ASK5ST                          WEK5ST
      *
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Bld WF Fax/Email Dtl  XF
      * BLD WF Fax/Email Dtl  RT - WF Fax/Email Header  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * BLD WF Fax/Email Dtl  RT - WF Fax/Email Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@EQCPW4                    *
     C                     READ @EQCPW4                  90*
      * Data record not found
     C   90                MOVEL'USR4047' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Bld WF Fax/Email Dtl  RT - Sales History  * 
     C                     EXSR SBRVGN
     C                     READ @EQCPW4                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Bld WF Fax/Email Dtl  RT - Sales History  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  1        Brk/Rgn Code Ty
     C                     Z-ADD*ZERO     WN0002  96       Accrual Rate
     C                     Z-ADD*ZERO     WN0003 112       Extended Amount
     C                     MOVEL*BLANK    WN0004 25        Billing Activit
     C                     MOVEL*BLANK    WN0005  6        Snd Broker Code
     C                     MOVEL*BLANK    WN0006  1        FAX DTL Status
     C                     MOVEL*BLANK    WN0007  1        FAX DTL Status
     C                     MOVEL*BLANK    WN0008  1        FAX DTL Status
     C                     MOVEL*BLANK    WN0009  1        FAX DTL Status
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBC4NB    WQSB02           Order Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWAC4NB    WQSB02           Order Number
      * Establish starting position
     C           KRSSB     SETLL@FHSTD3                    *
     C           KRSSB     READE@FHSTD3                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'B'       WN0001           Brk/Rgn Code Ty
      * RTV Billing Type       RT - Order Types  * 
     C                     EXSR SCRVGN
      * PAR.Billing Activity Desc = Condition name of LCL.Billing Activit
     C                     CALL 'CARVC2R'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1167313   Y2LSNO  70       List number
     C                     PARM YL0001    W0INVL 25        Billing Activit
     C                     PARM ' '       W0VLMP  1        Value mapped
     C           WN0004    PARM           W0CNNM 25        Billing Activit
      *
     C                     MOVELWAFRAA    WN0005           Snd Broker Code
      * Rtv Rate & Amount     RT - History Dtl Accrual  * 
     C                     EXSR SDRVGN
      * Crt WF Fax/Email Dtl  CR - WF Fax/Email Detail  * 
     C                     EXSR SECRRC
     C           KRSSB     READE@FHSTD3                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Billing Type       RT - Order Types  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCJNCD           Order Type - Sa
      * Setup key
     C                     MOVELWBJNCD    WCJNCD           Order Type - Sa
      * Establish starting position
     C           KRSSC     CHAIN@EXRETY              90    *
      * Data record not found
     C   90                MOVEL'USR1063' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCOBST    YL0001           Billing Activit
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Rate & Amount     RT - History Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     WN0002           Accrual Rate
     C                     Z-ADD*ZERO     WN0003           Extended Amount
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDAIC3    WQSD01           Company Number
     C           *LIKE     DEFN WDC4NB    WQSD02           Order Number
     C           *LIKE     DEFN WDDPNB    WQSD03           Order Sequence
     C           *LIKE     DEFN WDUENB    WQSD04           Order Secondary
     C           *LIKE     DEFN WDHHAA    WQSD05           Broker Code
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Order Number
     C                     KFLD           WQSD03           Order Sequence
     C                     KFLD           WQSD04           Order Secondary
     C                     KFLD           WQSD05           Broker Code
      * Setup key
     C                     Z-ADDWBAIC3    WQSD01           Company Number
     C                     Z-ADDWBC4NB    WQSD02           Order Number
     C                     Z-ADDWBDPNB    WQSD03           Order Sequence
     C                     Z-ADDWBUENB    WQSD04           Order Secondary
     C                     MOVELWAFRAA    WQSD05           Broker Code
      * Establish starting position
     C           KRSSD     SETLL@ICCPW5                    *
     C           KRSSD     READE@ICCPW5                  90*
      * Data record not found
     C   90                MOVEL'USR1655' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWDBKPR    WN0002           Accrual Rate
     C                     Z-ADDWDAYVA    WN0003           Extended Amount
     C           KRSSD     READE@ICCPW5                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt WF Fax/Email Dtl  CR - WF Fax/Email Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @ASCPWU
     C                     MOVELWN0001    WETBSX           Brk/Rgn Code Ty
     C                     MOVELWAFRAA    WEFRAA           Brk/Rgn Code
     C                     Z-ADDWBAIC3    WEAIC3           Company Number
     C                     Z-ADDWBC4NB    WEC4NB           Order Number
     C                     Z-ADDWBDPNB    WEDPNB           Order Sequence
     C                     Z-ADDWBUENB    WEUENB           Order Secondary
     C                     Z-ADDWBA0DT    WEA0DT           Order Date
     C                     Z-ADDWBAWDT    WEAWDT           Invoice Date
     C                     Z-ADDWBANC7    WEEHC7           F/E A/R Custome
     C                     Z-ADDWBBKC7    WEEGC7           F/E Ship To Num
     C                     Z-ADDWBGNDT    WEGNDT           Actual Shipped
     C                     Z-ADDWBCONB    WECONB           Invoice Number
     C                     MOVELWBBCNA    WEBCNA           Customer Purcha
     C                     MOVELWBBRTX    WEBRTX           Ship To Name
     C                     MOVELWBHNNA    WEHNNA           Ship To City
     C                     MOVELWBDBCD    WEDBCD           Ship To State C
     C                     MOVELWBCKTX    WECKTX           Ship To Zip/Pos
     C                     Z-ADDWBS5NB    WEHGCD           Item Code
     C                     MOVELWBG7NA    WEGENA           Item Descriptio
     C                     Z-ADDWBAVQT    WEAVQT           Quantity Ordere
     C                     Z-ADDWBEXQT    WEEXQT           Quantity Billed
     C                     Z-ADDWBBYWG    WEBYWG           Weight Billed
     C                     Z-ADDWBAKPR    WEAKPR           Unit Price
     C                     MOVELWBCRCD    WECRCD           U/M - Base Pric
     C                     Z-ADDWBAYVA    WEA1VA           Invoice Amount
     C                     Z-ADDWN0002    WEBKPR           Accrual Rate
     C                     Z-ADDWN0003    WEAYVA           Extended Amount
     C                     MOVELWN0004    WEE4T1           Billing Activit
     C                     MOVELWN0005    WEFWAA           Snd Broker Code
     C                     MOVELWN0006    WETCSX           FAX DTL Status
     C                     MOVELWN0007    WETDSX           FAX DTL Status
     C                     MOVELWN0008    WETESX           FAX DTL Status
     C                     MOVELWN0009    WEK5ST           FAX DTL Status
      *
     C           KLCRSE    KLIST
     C                     KFLD           WETBSX           Brk/Rgn Code Ty
     C                     KFLD           WEFRAA           Brk/Rgn Code
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WEC4NB           Order Number
     C                     KFLD           WEDPNB           Order Sequence
     C                     KFLD           WEUENB           Order Secondary
      * Check for duplicate primary key
     C           KLCRSE    SETLL@ASCPWU                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3420' W0RTN   7
      * Send message 'WF Fax/Email Detail    EX'
     C                     MOVEL'USR3420' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@ASCPWU                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WAAIC3           Company Number
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBDPNB           Order Sequence
     C                     Z-ADD*ZERO     WBUENB           Order Secondary
     C                     Z-ADD*ZERO     WBBTC7           Parent Customer
     C                     Z-ADD*ZERO     WBANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBA0DT           Order Date
     C                     Z-ADD*ZERO     WBACDT           Cancel Date
     C                     Z-ADD*ZERO     WBTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WBATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WBT3NB           Attach to Order
     C                     Z-ADD*ZERO     WBRSRN           Resell Referenc
     C                     Z-ADD*ZERO     WBORIT           Original Item
     C                     Z-ADD*ZERO     WBAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WBD0WG           Weight Ordered
     C                     Z-ADD*ZERO     WBCCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WBAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WBAKPR           Unit Price
     C                     Z-ADD*ZERO     WBAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WBA5DT           Requested Ship
     C                     Z-ADD*ZERO     WBAWDT           Invoice Date
     C                     Z-ADD*ZERO     WBHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WBAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WBAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WBAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WBAYVA           Extended Amount
     C                     Z-ADD*ZERO     WBL6NB           Contract Number
     C                     Z-ADD*ZERO     WBHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WBESNB           Accounting Year
     C                     Z-ADD*ZERO     WBETNB           Accounting Peri
     C                     Z-ADD*ZERO     WBBZNB           OM Week
     C                     Z-ADD*ZERO     WBEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WBBYWG           Weight Billed
     C                     Z-ADD*ZERO     WBS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WBMAVA           Billing Detail
     C                     Z-ADD*ZERO     WBKDVA           Billing Detail
     C                     Z-ADD*ZERO     WBUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WBUTVA           Standard Overag
     C                     Z-ADD*ZERO     WBA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WBCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WBR8NB           Shipping Compan
     C                     Z-ADD*ZERO     WBBZPR           Price Overage O
     C                     Z-ADD*ZERO     WBEXDT           Market Pricing
     C                     Z-ADD*ZERO     WBRGNB           Item Structure
     C                     Z-ADD*ZERO     WBRHNB           Item Structure
     C                     Z-ADD*ZERO     WBRINB           Item Structure
     C                     Z-ADD*ZERO     WBR1NB           Rated Freight
     C                     Z-ADD*ZERO     WBCONB           Invoice Number
     C                     Z-ADD*ZERO     WBGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WBRMNB           Load ID
     C                     Z-ADD*ZERO     WBAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WBSKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WBSLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WBSMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WBONVA           Actual Freight
     C                     Z-ADD*ZERO     WBB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WBB5NB           PM Line Number
     C                     Z-ADD*ZERO     WBGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WBULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WBUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WBUOVA           Commission Amou
     C                     Z-ADD*ZERO     WBUPVA           Financials Amou
     C                     Z-ADD*ZERO     WBUQVA           Financials Amou
     C                     Z-ADD*ZERO     WBCFC7           Order Group Cod
     C                     Z-ADD*ZERO     WBDUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WBB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WBIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WBIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WBNYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WBBZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WBZ4NB           MPC Number
     C                     Z-ADD*ZERO     WBOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WBC0C7           Claim Number
     C                     Z-ADD*ZERO     WBA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WBA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WBCDPR           Market Value
     C                     Z-ADD*ZERO     WBD0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WBD0VL           Raw Material Co
     C                     Z-ADD*ZERO     WBCEVL           Sales Expense T
     C                     Z-ADD*ZERO     WBOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WBD9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WBCFVL           HST Item Target
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDDXNB           Sequence Number
     C                     Z-ADD*ZERO     WDBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WDAYVA           Extended Amount
     C                     Z-ADD*ZERO     WDEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WDHGCD           Item Code
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDPTDT           HDA Actual Ship
     C                     Z-ADD*ZERO     WDBYWG           Weight Billed
     C                     Z-ADD*ZERO     WDPRDT           HDA SA Week End
     C                     Z-ADD*ZERO     WDPSDT           HDA Unused Date
     C                     Z-ADD*ZERO     WDEGVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WDEHVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WDQ9DT           HDA Invoice Dat
     C                     Z-ADD*ZERO     WDH1NY           HDA G/L Sub Led
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEAIC3           Company Number
     C                     Z-ADD*ZERO     WEC4NB           Order Number
     C                     Z-ADD*ZERO     WEDPNB           Order Sequence
     C                     Z-ADD*ZERO     WEUENB           Order Secondary
     C                     Z-ADD*ZERO     WEA0DT           Order Date
     C                     Z-ADD*ZERO     WEAWDT           Invoice Date
     C                     Z-ADD*ZERO     WEEHC7           F/E A/R Custome
     C                     Z-ADD*ZERO     WEEGC7           F/E Ship To Num
     C                     Z-ADD*ZERO     WEGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WECONB           Invoice Number
     C                     Z-ADD*ZERO     WEHGCD           Item Code
     C                     Z-ADD*ZERO     WEAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WEEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WEBYWG           Weight Billed
     C                     Z-ADD*ZERO     WEAKPR           Unit Price
     C                     Z-ADD*ZERO     WEA1VA           Invoice Amount
     C                     Z-ADD*ZERO     WEBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WEAYVA           Extended Amount
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Billing Activity Type
     C                     MOVEL*BLANK    YL0001  1
      *================================================================
     CSR         ZZEXIT    ENDSR
