// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDBSPVR
// ?Date: 14.08.2025 Time: 03:27:47
// ?------------------------------------------------------------------------------------------------

//?USER: Load screen

EXECUTE FUNCTION(RTV Company Name       RT) TYPE(RTVOBJ) FILE(CAABREP)          AC1255767;
PARAMETER(PAR.Company_Number);
PARAMETER(DTL.Name);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Cutout Matrix Desc RT) TYPE(RTVOBJ) FILE(PDI0REP)          AC1256965;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.USR_Description);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Validate fields

//?Select Company
CASE;

// IF PGM.*Cursor field <IS> DTL.USR Company Number
IF PGM.*Cursor_field = DTL.USR_Company_Number;

// AND DTL.*CMD key is *Prompt
AND DTL.*CMD_key = '04';

// Call program SEL Company by Number  SR.
CALL PROGRAM(SEL Company by Number  SR) ('CAAJSRR');
PARAMETER(DTL.USR_Company_Number);

ENDIF;

//?*Check for existance of the TO: Matrix & Effective Mo/Day
EXECUTE FUNCTION(Val Mtx Existance     RT) TYPE(RTVOBJ) FILE(PDI0REP)           AC1255728;
PARAMETER(DTL.USR_Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code_USR);
PARAMETER(DTL.Effective_Month_Day_USR);
PARAMETER(PAR.Record_Found_PS_CM_USR);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found -PCM USR = CND.Record Not Found
 PAR.Record_Found_PS_CM_USR = 'N';

 //?USER: Process Data record

 // PAR.Record Found -PCM USR = CND.Record Found
 PAR.Record_Found_PS_CM_USR = 'Y';

}


//?Validate Matrix Existance
CASE;

// IF PAR.Record Found -PS CM USR is Record Found
IF PAR.Record_Found_PS_CM_USR = 'Y';

// Send error message - 'Cutout Matrix Already Exist.'
ERROR(USR1733);
MSGPARM(DTL.Cutout_Matrix_Code_USR);
MSGPARM(DTL.Effective_Month_Day_USR);

ENDIF;

EXECUTE FUNCTION(Val Company Number    RT) TYPE(RTVOBJ) FILE(CAABREP)           AC1343408;
PARAMETER(DTL.USR_Company_Number);
PARAMETER(WRK.Record_Found_USR);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

}


//?Validate Company
CASE;

// IF WRK.Record Found USR is Record Not Found
IF WRK.Record_Found_USR = 'N';

// Send error message - 'Company Number not found'
ERROR(USR0163);

ENDIF;

EXECUTE FUNCTION(Val Effective Mo/Day  IF) TYPE(EXCINTFUN)                      AC1353296;
PARAMETER(DTL.Effective_Month_Day_USR);
{
 //?Execute internal function

 // WRK.Effective Mo/Dy TXT USR = CVTVAR(PAR.Effective Month/Day)
 WRK.Effective_Mo_Dy_TXT_USR = CVTVAR(PAR.Effective_Month_Day);

 // WRK.Month USR = SUBSTRING(WRK.Effective Mo/Dy TXT USR,CON.1,CON.2)
 WRK.Month_USR = SUBSTRING(WRK.Effective_Mo_Dy_TXT_USR:1:2);

 // WRK.Day USR = SUBSTRING(WRK.Effective Mo/Dy TXT USR,CON.3,CON.2)
 WRK.Day_USR = SUBSTRING(WRK.Effective_Mo_Dy_TXT_USR:3:2);

 //?Validate Month
 CASE;

 // IF WRK.Month USR is GT 12
 IF WRK.Month_USR > '12';

 // Send error message - 'Effective Month Invalid'
 ERROR(USR2127);
 MSGPARM(PAR.Effective_Month_Day);

 ENDIF;

 //?Validate Day
 CASE;

 // IF WRK.Day USR is GT 31
 IF WRK.Day_USR > '31';

 // Send error message - 'Effective Day Invalid'
 ERROR(USR2128);
 MSGPARM(PAR.Effective_Month_Day);

 ENDIF;

}


//?USER: User defined action

EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(PDI0REP)           AC1255741;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.Cutout_Matrix_Desc);
PARAMETER(DTL.Cutout_Matrix_Type);
PARAMETER(DTL.Cutout_Matrix_Default);
PARAMETER(DTL.Cutout_Matrix_Code_USR);
PARAMETER(DTL.Effective_Month_Day_USR);
PARAMETER(DTL.USR_Company_Number);
{
 //?USER: Process Data record

 //?*Create Cutout Matrix
 EXECUTE FUNCTION(Crt Cutout Matrix     CR) TYPE(CRTOBJ) FILE(PDI0REP)           AC1254442;
 PARAMETER(PAR.USR_Company_Number);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.Cutout_Matrix_Desc);
 PARAMETER(PAR.Cutout_Matrix_Type);
 PARAMETER('N');
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Record_Status);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Record Status = CND.Active
   PAR.Record_Status = 'A';

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 //?*Create Weight Ranges
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(PDI1REP)           AC1255758;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Weight Range      CR) TYPE(CRTOBJ) FILE(PDI1REP)           AC1254504;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Min_Carcass_Weight);
  PARAMETER(DB1.Max_Carcass_Weight);
  PARAMETER(DB1.Min_Live_Weight);
  PARAMETER(DB1.Max_Live_Weight);
  PARAMETER(DB1.Cooler_Shrink_Percent);
  PARAMETER(DB1.Std_Dressing_Yield_Pct);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 //?*Create Distribution
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1255779;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Distribution      CR) TYPE(CRTOBJ) FILE(PDIZREP)           AC1254596;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Min_Carcass_Weight);
  PARAMETER(DB1.Max_Carcass_Weight);
  PARAMETER(DB1.Lean_Percent);
  PARAMETER(DB1.Average_Cold_Wgt);
  PARAMETER(DB1.Population_Percent);
  PARAMETER(DB1.Average_Lean_Percent);
  PARAMETER(DB1.Average_Backfat_Inches);
  PARAMETER(DB1.Average_Loin_Eye_Depth);
  PARAMETER(DB1.Population_Head);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 //?*Create Distribution
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(PDJ0REP)           AC1935107;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Dist Backfat      CR) TYPE(CRTOBJ) FILE(PDJ0REP)           AC1333073;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Min_Carcass_Weight);
  PARAMETER(DB1.Max_Carcass_Weight);
  PARAMETER(DB1.Backfat_Inches);
  PARAMETER(DB1.Average_Cold_Wgt);
  PARAMETER(DB1.Population_Percent);
  PARAMETER(DB1.Average_Lean_Percent);
  PARAMETER(DB1.Average_Backfat_Inches);
  PARAMETER(DB1.Average_Loin_Eye_Depth);
  PARAMETER(DB1.Population_Head);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 //?*Create Items
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(PDI4REP)           AC1255843;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Cutout Item       CR) TYPE(CRTOBJ) FILE(PDI4REP)           AC1255832;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Min_Carcass_Weight);
  PARAMETER(DB1.Max_Carcass_Weight);
  PARAMETER(DB1.Lean_Percent);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Percent_of_Carcass);
  PARAMETER(DB1.Primal_Group_Code);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 //?*Create Yields
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(POB7REP)           AC1651453;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Cutout Yield      CR) TYPE(CRTOBJ) FILE(POB7REP)           AC1650683;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Primal_Group_Code);
  PARAMETER(DB1.Calculation_Sequence);
  PARAMETER(DB1.Yield_Type);
  PARAMETER(DB1.Primal_Yield);
  PARAMETER(DB1.Primal_Intercept);
  PARAMETER(DB1.Primal_C1_HCWT);
  PARAMETER(DB1.Primal_C3_HCWT_Seq);
  PARAMETER(DB1.Primal_C2_Ln_Pct_or_BkFt);
  PARAMETER(DB1.Primal_C4_Ln_Pct_or_Bkft);
  PARAMETER(DB1.Pieces_Per_Head);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

 //?*Create Blend
 EXECUTE FUNCTION(Cpy Cutout Matrix     RT) TYPE(RTVOBJ) FILE(POB8REP)           AC1651457;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(PAR.Cutout_Matrix_Code_USR);
 PARAMETER(PAR.Effective_Month_Day_USR);
 PARAMETER(PAR.USR_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Crt Cutout Blend      CR) TYPE(CRTOBJ) FILE(POB8REP)           AC1651030;
  PARAMETER(PAR.USR_Company_Number);
  PARAMETER(PAR.Cutout_Matrix_Code_USR);
  PARAMETER(PAR.Effective_Month_Day_USR);
  PARAMETER(DB1.Blend_Matrix_Code);
  PARAMETER(DB1.Blend_Matrix_Eff_MonthDay);
  PARAMETER(DB1.Blend_Percent);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
   PARAMETER(DB1.Record_Status);
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Record Status = CND.Active
    PAR.Record_Status = 'A';

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

 }

}


