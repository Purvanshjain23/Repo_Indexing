// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBXYPFR
// ?Date: 14.08.2025 Time: 12:03:33
// ?------------------------------------------------------------------------------------------------

//?USER: Record selection processing

//?Only process CB's
CASE;

// IF NOT DB1.Invoice Suffix is Charge Backs
IF ! DB1.Invoice_Suffix = 'CB';

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

//?Only process CB's
// IF DB1.Original Inv for CB is Equal to zero
IF DB1.Original_Inv_for_CB = *ZERO;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

//?Only process CB's
// IF DB1.Remaining Balance Due is equal to zero
IF DB1.Remaining_Balance_Due = *ZERO;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

//?Only process CB's
// IF DB1.Company Number NE LCL.Save Company Number
IF DB1.Company_Number <> LCL.Save_Company_Number;

// OR DB1.Original Inv for CB NE LCL.Save Original Invoice Nbr
OR DB1.Original_Inv_for_CB <> LCL.Save_Original_Invoice_Nbr;

// OR DB1.Transaction Amount NE LCL.Save Transaction Amount
OR DB1.Transaction_Amount <> LCL.Save_Transaction_Amount;

// LCL.Save Company Number = DB1.Company Number
LCL.Save_Company_Number = DB1.Company_Number;

// LCL.Save Original Invoice Nbr = DB1.Original Inv for CB
LCL.Save_Original_Invoice_Nbr = DB1.Original_Inv_for_CB;

// LCL.Save Transaction Amount = DB1.Transaction Amount
LCL.Save_Transaction_Amount = DB1.Transaction_Amount;

// Call program Zzz Count CB's for Amt XF.
CALL PROGRAM(Zzz Count CB's for Amt XF) ('PBXZXFR');
PARAMETER(DB1.Company_Number);
PARAMETER(DB1.AR_Customer_Number);
PARAMETER(DB1.Original_Inv_for_CB);
PARAMETER(DB1.Invoice_Suffix);
PARAMETER(DB1.Adjustment_Type_Code);
PARAMETER(DB1.Transaction_Amount);
PARAMETER(LCL.Counter);

//?If counter >= 2, process record
CASE;

// IF LCL.Counter is GE 2
IF LCL.Counter >= 2;

// LCL.Counter = CON.1
LCL.Counter = 1;

// LCL.Sequence Number = CON.*ZERO
LCL.Sequence_Number = *ZERO;

//?If counter >= 2, process record
// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Only process CB's
// IF LCL.Counter is GE 2
IF LCL.Counter >= 2;

//?Process this record
// LCL.Counter = LCL.Counter + CON.1
LCL.Counter = LCL.Counter + 1;

ENDIF;

//?USER: Print required level headings

// SUPPRESSED PRINT Company Number header format

// SUPPRESSED PRINT A/R Customer Number header format

// SUPPRESSED PRINT Original Inv for CB header format

// SUPPRESSED PRINT Invoice Suffix header format

// SUPPRESSED PRINT Adjustment Type Code header format

// SUPPRESSED PRINT Transaction Amount header format

//?USER: On print of detail format

EXECUTE FUNCTION(RTV Next CB Explanation) TYPE(RTVOBJ) FILE(ARBECPP)            AC2124884;
PARAMETER(CUR.Company_Number);
PARAMETER(CUR.Original_Inv_for_CB);
PARAMETER('IN');
PARAMETER(LCL.Sequence_Number);
PARAMETER(CUR.Transaction_Amount);
PARAMETER(CUR.Explanation);
{
 //?USER: Initialize routine

 // PAR.Sequence Number = PAR.Sequence Number + CON.1
 PAR.Sequence_Number = PAR.Sequence_Number + 1;

 //?USER: Process Data record

 //?Get next Sequence Number and Explanation
 CASE;

 // IF DB1.Adjustment Type Code is Chargeback
 IF DB1.Adjustment_Type_Code = 'CB';

 // AND DB1.Transaction Amount EQ PAR.Transaction Amount
 AND DB1.Transaction_Amount = PAR.Transaction_Amount;

 // PAR.Sequence Number = DB1.Sequence Number
 PAR.Sequence_Number = DB1.Sequence_Number;

 // PAR.Explanation = DB1.Explanation
 PAR.Explanation = DB1.Explanation;

 QUIT;

 ENDIF;

}


// CUR.Sequence Number = LCL.Sequence Number
CUR.Sequence_Number = LCL.Sequence_Number;

//?USER: Print required level totals

// SUPPRESSED PRINT Transaction Amount totals format

// SUPPRESSED PRINT Adjustment Type Code totals format

// SUPPRESSED PRINT Invoice Suffix totals format

CASE;

IF NEW Original_Inv_for_CB;
// Print Original Inv for CB totals format
PRINT Original Inv for CB totals format;

ENDIF;

// SUPPRESSED PRINT A/R Customer Number totals format

// SUPPRESSED PRINT Company Number totals format

