// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POQHXFR
// ?Date: 14.08.2025 Time: 03:38:30
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV default Company    IF) TYPE(EXCINTFUN)                     AC1592222;
PARAMETER(LCL.Company_Number);
{
 //?Execute internal function

 EXECUTE FUNCTION(Rtv Profile Model     RT) TYPE(RTVOBJ) FILE(CADRREP)           AC1445577;
 PARAMETER(JOB.*USER);
 PARAMETER(PAR.User_Code_Model);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF PAR.User Code Model is equal to blank
 IF PAR.User_Code_Model = *BLANK;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(JOB.*USER);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Appl. Default Co   RT) TYPE(RTVOBJ) FILE(CADTREP)          AC1143068;
 PARAMETER(PAR.User_Code_Model);
 PARAMETER('P/S');
 PARAMETER(PAR.Company_Number);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

}


EXECUTE FUNCTION(Cnv Offset Date/Time  RT) TYPE(RTVOBJ) FILE(POB2CPP)           AC1648031;
PARAMETER(LCL.Company_Number);
{
 //?USER: Process Data record

 //?Calculate Offset Production Date and time
 DO;

 //?10/27/03 Get Offset from new file
 // LCL.PT Offset Prod Date = DB1.PT Prod Date YYYYMMDD
 LCL.PT_Offset_Prod_Date = DB1.PT_Prod_Date_YYYYMMDD;

 // LCL.AS Serial Number = DB1.PT Serial Number
 LCL.AS_Serial_Number = DB1.PT_Serial_Number;

 // LCL.Scale ID = SUBSTRING(LCL.AS Serial Number,CON.1,CON.2)
 LCL.Scale_ID = SUBSTRING(LCL.AS_Serial_Number:1:2);

 // LCL.PT Label Date YYYYMMDD = CVTVAR(DB1.PT Label Date YYYYMMDD)
 LCL.PT_Label_Date_YYYYMMDD = CVTVAR(DB1.PT_Label_Date_YYYYMMDD);

 // WRK.Label Date = LCL.PT Label Date YYYYMMDD
 WRK.Label_Date = LCL.PT_Label_Date_YYYYMMDD;

 //?Set Century.
 CASE;

 // IF WRK.Label Date is < 410101
 IF WRK.Label_Date < 410101;

 // WRK.Label Date = WRK.Label Date + CON.1000000
 WRK.Label_Date = WRK.Label_Date + 1000000;

 ENDIF;

 EXECUTE FUNCTION(Rtv Line/ID/Ofst p/Dt RT) TYPE(RTVOBJ) FILE(PPAAREP)           AC1678379;
 PARAMETER(PAR.Company_Number);
 PARAMETER(LCL.Scale_ID);
 PARAMETER(WRK.Label_Date);
 PARAMETER(LCL.CS_Scale_Offset_Minutes);
 PARAMETER(LCL.CS_Include_in_PrdTr_Match);
 {
  //?USER: Processing if Data record not found

  // PAR.CS Scale Offset Minutes = CON.*ZERO
  PAR.CS_Scale_Offset_Minutes = *ZERO;

  // PAR.CS Exclude from ProdTrace = CND.no
  PAR.CS_Include_in_PrdTr_Match = 'N';

  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv Prod Trace Offset RT) TYPE(RTVOBJ) FILE(PPABREP)           AC1678376;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Line_Code);
  PARAMETER(PAR.CS_Scale_Offset_Minutes);
  PARAMETER(PAR.CS_Include_in_PrdTr_Match);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  QUIT;

 }

 // LCL.CS Scale Offset Minutes = LCL.CS Scale Offset Minutes * CON.-1 *
 LCL.CS_Scale_Offset_Minutes = LCL.CS_Scale_Offset_Minutes * -1;

 // LCL.PT Offset Prod Time = DB1.PT Production Time + LCL.CS Scale Offset Minutes *MINUTES
 LCL.PT_Offset_Prod_Time = TIMEINCR(DB1.PT_Production_Time LCL.CS_Scale_Offset_Minutes
 'MN');

 CASE;

 // IF LCL.PT Offset Prod Time GT DB1.PT Production Time
 IF LCL.PT_Offset_Prod_Time > DB1.PT_Production_Time;

 // LCL.PT Offset Prod Date = LCL.PT Offset Prod Date + CON.-1 *DAYS
 LCL.PT_Offset_Prod_Date = DATEINCR(LCL.PT_Offset_Prod_Date '-1' 'DY' 1111110 'NONE' 'N'
 1);

 ENDIF;

 EXECUTE FUNCTION(Chg Product Trc Offst CH) TYPE(CHGOBJ) FILE(POB2CPP)           AC1648032;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.PT_Serial_Number);
 PARAMETER(DB1.PT_Prod_Date_YYYYMMDD);
 PARAMETER(DB1.PT_Production_Time);
 PARAMETER(LCL.PT_Offset_Prod_Date);
 PARAMETER(LCL.PT_Offset_Prod_Time);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*JOB
   PAR.Job_Name = JOB.*JOB;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDDO;

}


