     H/TITLE WW Pen Availability   DF  Display file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Display file
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 00:32:37
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPKGGDFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: WW Pen Availability   DF  Display file
      *
     FPKA3REL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Pen                       Retrieval index
      *
     FPKA2CPL6IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pn/Driven
      *
     FPKA1CPL0IF  E           K        DISK
      * RTV : Tattoo Header             Retrieval index
      *
     FPKAXCPL0IF  E           K        DISK
      * RTV : Buy Order Load            Retrieval index
      *
     FPKA2CPL8IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pen
      *
     FPKB3CPL5IF  E           K        DISK
      * RSQ : Tattoo Scale Ticket       Co/Pen/BO/LD/Ttt all
      *
     FPKAZREL1IF  E           K        DISK
      * RTV : Company Control HPE       Retrieval index
      *
     FPKCTCPL1IF  E           K        DISK
      * RTV : Drive Card Work           Retrieval index
      *
     FPKA2CPL7IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pn/Open process code
      *
     FPKAIREL0IF  E           K        DISK
      * RTV : Genetic                   Retrieval index
      *
     FPKAZREL0UF  E           K        DISK
      * UPD : Company Control HPE       Update index
      *
     FPKCTCPL0UF  E           K        DISK                      A
      * UPD : Drive Card Work           Update index
      *
     FPKA2CPL0UF  E           K        DISK
      * UPD : Tattoo Detail             Update index
      *
     FPKA3REL0UF  E           K        DISK
      * UPD : Pen                       Update index
      *
      * Long constants
     E                    @CN#    1  05  6   @CN    25
     I@A2CPKE
      * Tattoo Detail             Co/Pen
      * Renamed input format fields
     I              A2HMNB                          WAHMNB
     I              A2BNNB                          WABNNB
     I              A2BONB                          WABONB
     I              A2CVNB                          WACVNB
     I              A2B0DT                          WAB0DT
     I              A2C2NB                          WAC2NB
     I              A2CZNB                          WACZNB
     I              A2C0NB                          WAC0NB
     I              A2D8NB                          WAD8NB
     I              A2H7NB                          WAH7NB
     I              A2GGST                          WAGGST
     I              A2AJTM                          WAAJTM
     I              A2JEA1                          WAJEA1
     I              A2B7CD                          WAB7CD
     I              A2D7NB                          WAD7NB
     I              A2D9ST                          WAD9ST
     I              A2E3ST                          WAE3ST
     I              A2E4ST                          WAE4ST
     I              A2E5ST                          WAE5ST
     I              A2BVDT                          WABVDT
     I              A2BWDT                          WABWDT
     I              A2BXDT                          WABXDT
     I              A2HVNB                          WAHVNB
     I              A2CMCD                          WACMCD
     I              A2B9CD                          WAB9CD
     I              A2H8NB                          WAH8NB
     I              A2CYCD                          WACYCD
     I              A2AAVN                          WAAAVN
     I              A2AADT                          WAAADT
     I              A2AMTM                          WAAMTM
     I              A2AJST                          WAAJST
     I              A2AHVN                          WAAHVN
     I              A2AGVN                          WAAGVN
     I              A2ABVN                          WAABVN
     I              A2ABDT                          WAABDT
     I              A2ABTM                          WAABTM
      *
     I@AZCPCM
      * Company Control HPE       Update index
      * Renamed input format fields
     I              AZHONB                          WBHONB
     I              AZBSNB                          WBBSNB
     I              AZB1DT                          WBB1DT
     I              AZB2DT                          WBB2DT
     I              AZH4NB                          WBH4NB
     I              AZK3NB                          WBK3NB
     I              AZCDDT                          WBCDDT
     I              AZCEDT                          WBCEDT
     I              AZAAVN                          WBAAVN
     I              AZAADT                          WBAADT
     I              AZAMTM                          WBAMTM
     I              AZAJST                          WBAJST
     I              AZAHVN                          WBAHVN
     I              AZAGVN                          WBAGVN
     I              AZABVN                          WBABVN
     I              AZABDT                          WBABDT
     I              AZABTM                          WBABTM
      *
     I@CTCPM8
      * Drive Card Work           Update index
      * Renamed input format fields
     I              CTHVNB                          WCHVNB
     I              CTCMCD                          WCCMCD
     I              CTKYNB                          WCKYNB
     I              CTCCDT                          WCCCDT
     I              CTKZNB                          WCKZNB
     I              CTK0NB                          WCK0NB
     I              CTK1NB                          WCK1NB
     I              CTDODT                          WCDODT
      *
     I@A2CPKD
      * Tattoo Detail             Co/Pn/Open process code
      * Renamed input format fields
     I              A2HMNB                          WDHMNB
     I              A2BNNB                          WDBNNB
     I              A2BONB                          WDBONB
     I              A2CVNB                          WDCVNB
     I              A2B0DT                          WDB0DT
     I              A2C2NB                          WDC2NB
     I              A2CZNB                          WDCZNB
     I              A2C0NB                          WDC0NB
     I              A2D8NB                          WDD8NB
     I              A2H7NB                          WDH7NB
     I              A2GGST                          WDGGST
     I              A2AJTM                          WDAJTM
     I              A2JEA1                          WDJEA1
     I              A2B7CD                          WDB7CD
     I              A2D7NB                          WDD7NB
     I              A2D9ST                          WDD9ST
     I              A2E3ST                          WDE3ST
     I              A2E4ST                          WDE4ST
     I              A2E5ST                          WDE5ST
     I              A2BVDT                          WDBVDT
     I              A2BWDT                          WDBWDT
     I              A2BXDT                          WDBXDT
     I              A2HVNB                          WDHVNB
     I              A2CMCD                          WDCMCD
     I              A2B9CD                          WDB9CD
     I              A2H8NB                          WDH8NB
     I              A2CYCD                          WDCYCD
     I              A2AAVN                          WDAAVN
     I              A2AADT                          WDAADT
     I              A2AMTM                          WDAMTM
     I              A2AJST                          WDAJST
     I              A2AHVN                          WDAHVN
     I              A2AGVN                          WDAGVN
     I              A2ABVN                          WDABVN
     I              A2ABDT                          WDABDT
     I              A2ABTM                          WDABTM
      *
     I@A2CPDF
      * Tattoo Detail             Update index
      * Renamed input format fields
     I              A2HMNB                          WEHMNB
     I              A2BNNB                          WEBNNB
     I              A2BONB                          WEBONB
     I              A2CVNB                          WECVNB
     I              A2B0DT                          WEB0DT
     I              A2C2NB                          WEC2NB
     I              A2CZNB                          WECZNB
     I              A2C0NB                          WEC0NB
     I              A2D8NB                          WED8NB
     I              A2H7NB                          WEH7NB
     I              A2GGST                          WEGGST
     I              A2AJTM                          WEAJTM
     I              A2JEA1                          WEJEA1
     I              A2B7CD                          WEB7CD
     I              A2D7NB                          WED7NB
     I              A2D9ST                          WED9ST
     I              A2E3ST                          WEE3ST
     I              A2E4ST                          WEE4ST
     I              A2E5ST                          WEE5ST
     I              A2BVDT                          WEBVDT
     I              A2BWDT                          WEBWDT
     I              A2BXDT                          WEBXDT
     I              A2HVNB                          WEHVNB
     I              A2CMCD                          WECMCD
     I              A2B9CD                          WEB9CD
     I              A2H8NB                          WEH8NB
     I              A2CYCD                          WECYCD
     I              A2AAVN                          WEAAVN
     I              A2AADT                          WEAADT
     I              A2AMTM                          WEAMTM
     I              A2AJST                          WEAJST
     I              A2AHVN                          WEAHVN
     I              A2AGVN                          WEAGVN
     I              A2ABVN                          WEABVN
     I              A2ABDT                          WEABDT
     I              A2ABTM                          WEABTM
      *
     I@A3REDC
      * Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     IQPKAZ1    E DSPKAZREL0
      * UPD : Company Control HPE       Update index
      * Renamed input format fields
     I              AZHONB                          WBHONB
     I              AZBSNB                          WBBSNB
     I              AZB1DT                          WBB1DT
     I              AZB2DT                          WBB2DT
     I              AZH4NB                          WBH4NB
     I              AZK3NB                          WBK3NB
     I              AZCDDT                          WBCDDT
     I              AZCEDT                          WBCEDT
     I              AZAAVN                          WBAAVN
     I              AZAADT                          WBAADT
     I              AZAMTM                          WBAMTM
     I              AZAJST                          WBAJST
     I              AZAHVN                          WBAHVN
     I              AZAGVN                          WBAGVN
     I              AZABVN                          WBABVN
     I              AZABDT                          WBABDT
     I              AZABTM                          WBABTM
      *
     IYARDCS      DS                             84
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPKCT1    E DSPKCTCPL0
      * UPD : Drive Card Work           Update index
      * Renamed input format fields
     I              CTHVNB                          WCHVNB
     I              CTCMCD                          WCCMCD
     I              CTKYNB                          WCKYNB
     I              CTCCDT                          WCCCDT
     I              CTKZNB                          WCKZNB
     I              CTK0NB                          WCK0NB
     I              CTK1NB                          WCK1NB
     I              CTDODT                          WCDODT
      *
     IQPKA21    E DSPKA2CPL0
      * UPD : Tattoo Detail             Update index
      * Renamed input format fields
     I              A2HMNB                          WEHMNB
     I              A2BNNB                          WEBNNB
     I              A2BONB                          WEBONB
     I              A2CVNB                          WECVNB
     I              A2B0DT                          WEB0DT
     I              A2C2NB                          WEC2NB
     I              A2CZNB                          WECZNB
     I              A2C0NB                          WEC0NB
     I              A2D8NB                          WED8NB
     I              A2H7NB                          WEH7NB
     I              A2GGST                          WEGGST
     I              A2AJTM                          WEAJTM
     I              A2JEA1                          WEJEA1
     I              A2B7CD                          WEB7CD
     I              A2D7NB                          WED7NB
     I              A2D9ST                          WED9ST
     I              A2E3ST                          WEE3ST
     I              A2E4ST                          WEE4ST
     I              A2E5ST                          WEE5ST
     I              A2BVDT                          WEBVDT
     I              A2BWDT                          WEBWDT
     I              A2BXDT                          WEBXDT
     I              A2HVNB                          WEHVNB
     I              A2CMCD                          WECMCD
     I              A2B9CD                          WEB9CD
     I              A2H8NB                          WEH8NB
     I              A2CYCD                          WECYCD
     I              A2AAVN                          WEAAVN
     I              A2AADT                          WEAADT
     I              A2AMTM                          WEAMTM
     I              A2AJST                          WEAJST
     I              A2AHVN                          WEAHVN
     I              A2AGVN                          WEAGVN
     I              A2ABVN                          WEABVN
     I              A2ABDT                          WEABDT
     I              A2ABTM                          WEABTM
      *
     IYBRDCS      DS                            133
     IQPKA31    E DSPKA3REL0
      * UPD : Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
     IYCRDCS      DS                            107
     IYDRDCS      DS                            107
     IYERDCS      DS                            133
     IYFRDCS      DS                            133
     IYGRDCS      DS                            107
     IYHRDCS      DS                            107
     IYIRDCS      DS                            107
     IYJRDCS      DS                            107
     IYKRDCS      DS                            107
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Pen
      * N : MAP Pen Company Number
     I                                    P   1   20P1HVNB
      * N : MAP Pen Number
     I                                        3   5 P1CMCD
      * N : MAP Pen Description
     I                                        6  30 P1BBTX
      * N : MAP Pen Maximun Capacity
     I                                    P  31  330P1CTNB
      * N : MAP Pen Current Head
     I                                    P  34  360P1D6NB
      * N : MAP Pen Current Drive Card No
     I                                    P  37  380P1B6CD
      * N : MAP Pen Sts
     I                                       39  39 P1DGST
      * N : MAP Pen Drive Sequence
     I                                    P  40  410P1EBNB
      * N : MAP GN Genetic Code
     I                                       42  46 P1AGCD
     IP2PARM      DS
      * FLD: *Arrays
      * N : MAP PRT Description
     I                                        1  25 P2ETTX
      * N : MAP PRT Printer Device
     I                                       26  35 P2ACVN
      * N : MAP PRT Hold Output Sts
     I                                       36  39 P2AKST
      * N : MAP PRT Save Output Sts
     I                                       40  43 P2AMST
      * N : MAP PRT Copies
     I                                       44  450P2AKNB
      * N : MAP PRT Night Queue Run Sts
     I                                       46  46 P2ALST
      * N : MAP PRT Night Queue
     I                                       47  56 P2AIVN
      * N : MAP Oms Application Code
     I                                       57  62 P2C7CD
     IP3PARM      DS
      * FLD: *Arrays
      * N : MAP Oms Warehouse Code
     I                                        1   3 P3J8NB
      * N : MAP CC Company Number
     I                                    P   4   50P3HONB
      * N : MAP Oms SalesPerson Code
     I                                        6   8 P3C8CD
      * N : MAP Oms Allow Multi-Company
     I                                        9   9 P3G8ST
      * N : MAP Oms Default Printer
     I                                       10  19 P3G9ST
      * N : MAP Oms Name
     I                                       20  49 P3EUTX
      * N : MAP Oms System Value Alpha
     I                                       50  89 P3EVTX
      * N : MAP Oms Access Denied (Y/N)
     I                                       90  90 P3HAST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Invalid Company Number'
      * CC Company Number
     I                                    P   1   20ZA0001
      * Message data for 'Tattoos in a pen'
      * Tattoo 1              USR
     I                                        1   4 ZA0002
      * Tattoo 2              USR
     I                                        5   8 ZA0003
      * Tattoo 3              USR
     I                                        9  12 ZA0004
      * Tattoo 4              USR
     I                                       13  16 ZA0005
      * tattoo 5              USR
     I                                       17  20 ZA0006
      * @Status +/-
     I                                       21  21 ZA0007
      * Message data for 'Tattoos in a pen'
      * Tattoo 1              USR
     I                                        1   4 ZA0008
      * Tattoo 2              USR
     I                                        5   8 ZA0009
      * Tattoo 3              USR
     I                                        9  12 ZA0010
      * Tattoo 4              USR
     I                                       13  16 ZA0011
      * tattoo 5              USR
     I                                       17  20 ZA0012
      * @Status +/-
     I                                       21  21 ZA0013
      * Message data for 'SBM Prt Pen Avail. List'
      * PRT Printer Device
     I                                        1  10 ZA0014
      * PRT Hold Output Sts
     I                                       11  14 ZA0015
      * PRT Save Output Sts
     I                                       15  18 ZA0016
      * PRT Copies
     I                                    P  19  200ZA0017
      * PRT Night Queue
     I                                       21  30 ZA0018
      * RS Record Status
     I                                       31  31 ZA0019
      * Pen Type
     I                                       32  32 ZA0020
      * Pen Company Number
     I                                    P  33  340ZA0021
      * Name USR
     I                                       35  74 ZA0022
      * Oms System Value Alpha
     I                                       75 114 ZA0023
      * Message data for 'SBM Prt Pen Avail Lst Dt'
      * PRT Printer Device
     I                                        1  10 ZA0024
      * PRT Hold Output Sts
     I                                       11  14 ZA0025
      * PRT Save Output Sts
     I                                       15  18 ZA0026
      * PRT Copies
     I                                    P  19  200ZA0027
      * PRT Night Queue
     I                                       21  30 ZA0028
      * RS Record Status
     I                                       31  31 ZA0029
      * Pen Type
     I                                       32  32 ZA0030
      * Pen Company Number
     I                                    P  33  340ZA0031
      * Name USR
     I                                       35  74 ZA0032
      * Oms System Value Alpha
     I                                       75 114 ZA0033
      * Message data for 'Opt not allowed for resal'
      * Pen Number
     I                                        1   3 ZA0034
      * Message data for 'Pen &1 must be closed.'
      * Pen Number
     I                                        1   3 ZA0035
      * Message data for 'Opt not allowed for resal'
      * Pen Number
     I                                        1   3 ZA0036
      * Message data for 'Scale Rec Not Printed/Pen'
      * Pen Number
     I                                        1   3 ZA0037
      * Message data for 'OVRPRTF Printer'
      * Program Name $ USR
     I                                        1  10 ZA0038
      * PRT Printer Device
     I                                       11  20 ZA0039
      * Message data for 'Pen &1 must be opn f/prnt'
      * Pen Number
     I                                        1   3 ZA0040
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile control
      * CASE: WRK.First Time Flag Usr EQ WRK.Blank USR
     C           WUHBST    IFEQ WUCRTX                     *IF
     C                     Z-ADDWUHVNB    #2HVNB           Pen Company Num
     C                     MOVEL'Y'       WUHJST           Display Print P
     C                     MOVEL'Y'       WUHBST           First Time Flag
     C                     MOVEL'A'       #2AJST           RS Record Statu
     C                     MOVEL'N'       P2ALST           PRT Night Queue
     C                     END                             *FI
      * Val Company Number    IF
      * Val Company Number    XF - STR Order Management Sys  * 
     C                     CALL 'PDGZXFR'              90  Val Company Num
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2HVNB    WQ0001  30       CC Company Numb
     C           #CBSTX    PARM *BLANK    WQ0002 30        Oms Name
     C           WUG3ST    PARM *BLANK    WQ0003  1        Invalid Y/N USR
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGZXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * CASE: WRK.Invalid Y/N USR is Yes
     C           WUG3ST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#2HVNB    ZA0001           CC Company Numb
      * Send message 'Invalid Company Number'
     C                     MOVEL'PRK0299' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     MOVELWUG3ST    WUG3ST           Invalid Y/N USR
     C                     Z-ADD*ZERO     #2D6NB           Pen Current Hea
      * Rtv Accum Pen Totals  RT - Pen  * 
     C                     EXSR SARVGN
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADD#2HVNB    A3HVNB
     C                     MOVEL#2CMCD    A3CMCD
     C           KPOS      SETLL@A3REDD
     C                     READ @A3REDD                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2HVNB    WZHVNB
     C                     MOVEL#2HVNB    WZHVNB           Pen Company Num
     C           *LIKE     DEFN #2CMCD    WZCMCD
     C                     MOVEL#2CMCD    WZCMCD           Pen Number
     C           *LIKE     DEFN #2D6NB    WZD6NB
     C                     MOVEL#2D6NB    WZD6NB           Pen Current Hea
     C           *LIKE     DEFN #2CTNB    WZCTNB
     C                     MOVEL#2CTNB    WZCTNB           Pen Maximun Cap
     C           *LIKE     DEFN #2EBNB    WZEBNB
     C                     MOVEL#2EBNB    WZEBNB           Pen Drive Seque
     C           *LIKE     DEFN #2HBNB    WZHBNB
     C                     MOVEL#2HBNB    WZHBNB           Pen Adjustment
     C           *LIKE     DEFN #2FWST    WZFWST
     C                     MOVEL#2FWST    WZFWST           Pen Type
     C           *LIKE     DEFN #2BBTX    WZBBTX
     C                     MOVEL#2BBTX    WZBBTX           Pen Description
     C           *LIKE     DEFN #2AJST    WZAJST
     C                     MOVEL#2AJST    WZAJST           RS Record Statu
      * Translate search mask for text field
     C                     MOVEL'QSYST'   WQB10X 10
     C                     MOVE 'RNTBL'   WQB10X
     C           *LIKE     DEFN #2BBTX    WQBBTX           Pen Description
     C                     CALL 'QDCXLATE'
      * Length
     C                     PARM 25        WQA5N   50
     C                     PARM #2BBTX    WQBBTX           Pen Description
     C                     PARM           WQB10X           QSYSTRNTBL
     C                     PARM 'QSYS'    WQC10X 10
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@A3REDD                  90*
     C  N82                READ @A3REDD                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVEL*ALL'0'   WKIND0  1
     C                     MOVEAWKIND0    *IN,35
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  90
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFLN
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2HVNB    IFEQ *ZERO                      Pen Company Num
     C           #2CMCD    IFNE *BLANK                     Pen Number
     C           A3CMCD    CABNE#2CMCD    BB020            Pen Number
     C                     END
     C                     END
     C           #2EBNB    IFNE *ZERO                      Pen Drive Seque
     C           A3EBNB    CABNE#2EBNB    BB020            Pen Drive Seque
     C                     END
     C           #2HBNB    IFNE *ZERO                      Pen Adjustment
     C           A3HBNB    CABNE#2HBNB    BB020            Pen Adjustment
     C                     END
     C           #2FWST    IFNE *BLANK                     Pen Type
     C           A3FWST    CABNE#2FWST    BB020            Pen Type
     C                     END
     C           #2BBTX    IFNE *BLANK                     Pen Description
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           A3BBTX           Pen Description
      * Length
     C                     PARM 25        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           WQBBTX
      * Length
     C                     PARM 25        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2AJST    IFNE *BLANK                     RS Record Statu
     C           A3AJST    CABNE#2AJST    BB020            RS Record Statu
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * Allow for possible *Set Cursor processing
     C                     ADD  1         ##RR
      * USER: Initialize subfile record from DBF record
      * CASE: RCD.Pen Sts is Closed
     C           #1DGST    IFEQ 'C'                        *IF
      * Rtv Tattoos in a pen  RT - Tattoo Detail  * 
     C                     EXSR SBRVGN
      * Setup message data for message
     C                     MOVELWUTT1U    ZA0002           Tattoo 1
     C                     MOVELWUTT2U    ZA0003           Tattoo 2
     C                     MOVELWUTT3U    ZA0004           Tattoo 3
     C                     MOVELWUTT4U    ZA0005           Tattoo 4
     C                     MOVELWUNJNB    ZA0006           tattoo 5
     C                     MOVELWUI8ST    ZA0007           @Status +/-
      * Retrieve message Tattoos in a pen
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0743' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           #1BBTX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     ELSE
      * CASE: *OTHERWISE
      * Rtv Tattoos in Pen    RT - Tattoo Detail  * 
     C                     EXSR SFRVGN
      * Setup message data for message
     C                     MOVELWUTT1U    ZA0008           Tattoo 1
     C                     MOVELWUTT2U    ZA0009           Tattoo 2
     C                     MOVELWUTT3U    ZA0010           Tattoo 3
     C                     MOVELWUTT4U    ZA0011           Tattoo 4
     C                     MOVELWUNJNB    ZA0012           tattoo 5
     C                     MOVELWUI8ST    ZA0013           @Status +/-
      * Retrieve message Tattoos in a pen
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0743' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           #1BBTX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     END                             *FI
      * E4154 JJH 07/22/15 - Calculate and Display Pending Head
      * Clc Pen Max Capacity  XF - Pen  * 
     C                     CALL 'PLXNXFR'              90  Clc Pen Max Cap
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0004  30       Pen Company Num
     C                     PARM #1CMCD    WQ0005  3        Pen Number
     C                     PARM *ZERO     WQ0006  50       Pen Additional
     C           #RXEA1    PARM *ZERO     WQ0007  50       Pen Tto Scl Tkt
     C                     PARM *BLANK    WQ0008  1        Pen Exceeds Max
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLXNXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * E4154 JJH 07/22/15 - Display 3-Character Desc for Pen Status
      * CASE: RCD.Pen Sts is Closed
     C           #1DGST    IFEQ 'C'                        *IF
     C                     MOVEL*BLANK    #RB4TX           Pen Status Desc
     C                     MOVEL'Cls'     #RB4TX           Pen Status Desc
     C                     ELSE
      * CASE: RCD.Pen Sts is Open
     C           #1DGST    IFEQ 'O'                        *IF
     C                     MOVEL*BLANK    #RB4TX           Pen Status Desc
     C                     MOVEL'Opn'     #RB4TX           Pen Status Desc
     C                     END                             *FI
     C                     END                             *FI
     C                     SUB  1         ##RR
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Output to subfile
     C                     ADD  1         ##RR
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C                     READ @A3REDD                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
     C           BB900     TAG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN81     IFNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate Pen Type
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#2FWST    W0NSRQ  1        Pen Type
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#2FWST'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1115866   Y2LSNO  70
     C           #2FWST    PARM #2FWST    W0EXVL 25        Pen Type
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate RS Record Status
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#2AJST    W0NSRQ  1        RS Record Statu
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#2AJST'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1100087   Y2LSNO  70
     C           #2AJST    PARM #2AJST    W0EXVL 25        RS Record Statu
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFNE *BLANKS
     C           YPMRRN    ANDEQ*ZERO
     C                     GOTO DAEXIT
     C                     END
     C           YPMTFD    CABNE*BLANKS   DATAG1
      * Change of position specified
     C           WZHVNB    CASNE#2HVNB    FBRQRL
     C           WZCMCD    CASNE#2CMCD    FBRQRL
     C           WZFWST    CASNE#2FWST    FBRQRL
     C           WZAJST    CASNE#2AJST    FBRQRL
     C                     END
     C           DATAG1    TAG
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process subfile control (Pre-confirm)
     C                     MOVEL'Y'       W0DCF            *Defer confirm
      * F21=Print List
      * CASE: CTL.*CMD key is Print List
     C           *IN21     IFEQ '1'                        *IF
      * Pmt Print Options     XF - STR Order Management Sys  * 
     C                     CALL 'PDG0PVR'              90  Pmt Print Optio
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,001   WQ0009 25        PRT Description
     C           P2ACVN    PARM P2ACVN    WQ0010 10        PRT Printer Dev
     C           P2AKST    PARM P2AKST    WQ0011  4        PRT Hold Output
     C           P2AMST    PARM P2AMST    WQ0012  4        PRT Save Output
     C           P2AKNB    PARM P2AKNB    WQ0013  20       PRT Copies
     C           P2ALST    PARM P2ALST    WQ0014  1        PRT Night Queue
     C           P2AIVN    PARM P2AIVN    WQ0015 10        PRT Night Queue
     C                     PARM 'P/S'     WQ0016  6        Oms Application
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG0PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVELP2ACVN    ZA0014           PRT Printer Dev
     C                     MOVELP2AKST    ZA0015           PRT Hold Output
     C                     MOVELP2AMST    ZA0016           PRT Save Output
     C                     Z-ADDP2AKNB    ZA0017           PRT Copies
     C                     MOVELP2AIVN    ZA0018           PRT Night Queue
     C                     MOVEL#2AJST    ZA0019           RS Record Statu
     C                     MOVEL#2FWST    ZA0020           Pen Type
     C                     Z-ADD#2HVNB    ZA0021           Pen Company Num
     C                     MOVEL#CBSTX    ZA0022           Name USR
     C                     MOVELP3EVTX    ZA0023           Oms System Valu
      *
      * Execute message
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2EXMCC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0339' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN   7
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      * Error detected during execution
     C                     SETON                     993433*
     C                     SETON                     31    *
     C                     END
      *
     C                     END                             *FI
     C                     MOVEL'Y'       WUHJST           Display Print P
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END                             *FI
      * F22=Print List
      * CASE: CTL.*CMD key is CF22
     C           *IN22     IFEQ '1'                        *IF
      * Pmt Print Options     XF - STR Order Management Sys  * 
     C                     CALL 'PDG0PVR'              90  Pmt Print Optio
     C                     PARM *BLANK    W0RTN   7
     C                     PARM @CN,001   WQ0017 25        PRT Description
     C           P2ACVN    PARM P2ACVN    WQ0018 10        PRT Printer Dev
     C           P2AKST    PARM P2AKST    WQ0019  4        PRT Hold Output
     C           P2AMST    PARM P2AMST    WQ0020  4        PRT Save Output
     C           P2AKNB    PARM P2AKNB    WQ0021  20       PRT Copies
     C           P2ALST    PARM P2ALST    WQ0022  1        PRT Night Queue
     C           P2AIVN    PARM P2AIVN    WQ0023 10        PRT Night Queue
     C                     PARM 'P/S'     WQ0024  6        Oms Application
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG0PVR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVELP2ACVN    ZA0024           PRT Printer Dev
     C                     MOVELP2AKST    ZA0025           PRT Hold Output
     C                     MOVELP2AMST    ZA0026           PRT Save Output
     C                     Z-ADDP2AKNB    ZA0027           PRT Copies
     C                     MOVELP2AIVN    ZA0028           PRT Night Queue
     C                     MOVEL#2AJST    ZA0029           RS Record Statu
     C                     MOVEL#2FWST    ZA0030           Pen Type
     C                     Z-ADD#2HVNB    ZA0031           Pen Company Num
     C                     MOVEL#CBSTX    ZA0032           Name USR
     C                     MOVELP3EVTX    ZA0033           Oms System Valu
      *
      * Execute message
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2EXMCC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0681' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN   7
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      * Error detected during execution
     C                     SETON                     993433*
     C                     SETON                     31    *
     C                     END
      *
     C                     END                             *FI
     C                     MOVEL'Y'       WUHJST           Display Print P
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END                             *FI
      * F5 Refresh
      * CASE: CTL.*CMD key is Refresh
     C           *IN05     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C                     END
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * USER: Final processing (Pre-confirm)
     C                     MOVEL'Y'       WUHJST           Display Print P
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Process subfile (pass 2)
     C                     EXSR EAPRSF
      * If error during 2nd pass exit:
     C           *IN99     CABEQ'1'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98    *
     C           YPMTFD    CABNE*BLANKS   DCEXIT
      * SFLNXTCHG
     C                     SETON                     84
      * USER: Process subfile record (Pre-confirm)
      * Select option
      * CASE: RCD.*SFLSEL is Display Pen Detail
     C           #1SEL     IFEQ '5'                        *IF
     C           #1SEL     OREQ ' 5'
      * E4154 JJH 07/27/15 - New Parm for Pen Tto Scl Tkt Head USR
      * Dsp Pen Detail        DF - Tattoo Detail  * 
     C                     CALL 'PKCLDFR'              90  Dsp Pen Detail
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0025  30       BOH Company Num
     C                     PARM #1CMCD    WQ0026  3        Pen Number
     C                     PARM #1D6NB    WQ0027  50       Pen Current Hea
     C                     PARM #1B6CD    WQ0028  30       Pen Current Dri
     C                     PARM #1EBNB    WQ0029  30       Pen Drive Seque
     C                     PARM #RXEA1    WQ0030  50       Pen Tto Scl Tkt
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKCLDFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Revise request
     C           #1SEL     IFEQ '2'                        *IF
     C           #1SEL     OREQ ' 2'
      * Edt Pen               E1 - Pen  * 
     C                     CALL 'PKGLE1R'              90  Edt Pen
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0031  30       Pen Company Num
     C                     PARM #1CMCD    WQ0032  3        Pen Number
     C                     PARM #1BBTX    WQ0033 25        Pen Description
     C                     PARM #1DGST    WQ0034  1        Pen Sts
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKGLE1R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: RCD.*SFLSEL is Void Drive Card
     C           #1SEL     IFEQ '4'                        *IF
      * CASE: RCD.Pen Type is Resale
     C           #1FWST    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0034           Pen Number
      * Send message 'Opt not allowed for resal'
     C                     MOVEL'PRK0502' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Pen Sts is Closed
     C           #1DGST    IFEQ 'C'                        *IF
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0035           Pen Number
      * Send message 'Pen &1 must be closed.'
     C                     MOVEL'PRK0223' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.*SFLSEL is Print Drive Card
     C           #1SEL     IFEQ '6'                        *IF
      * CASE: RCD.Pen Type is Resale
     C           #1FWST    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0036           Pen Number
      * Send message 'Opt not allowed for resal'
     C                     MOVEL'PRK0502' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Pen Sts is Open
     C           #1DGST    IFEQ 'O'                        *IF
     C                     MOVELWUCRTX    WUBRSS           Record Status U
      * CASE: RCD.Pen Company Number is SBD Farms of Guymon, Ok
     C           #1HVNB    IFEQ 360                        *IF
      * Vry Tattoo SclTickAct  RT - Tattoo Scale Ticket  * 
     C                     EXSR SHRVGN
     C                     END                             *FI
      * CASE:
      *  - c1 AND c2
      *   |- c1    : WRK.Return Code USR is Scale Ticket Not Process
      *   |- c2    : RCD.Pen Company Number is SBD Farms of Guymon, Ok
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WULMST    IFEQ @CN,002                    *IF
     C           #1HVNB    IFEQ 360                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0037           Pen Number
      * Send message 'Scale Rec Not Printed/Pen'
     C                     MOVEL'PRK1267' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
      * Exc Print Drive Card  IF
      * Get Next Drive Card Nbr
      * Rtv/Upd Last Drv Crd  RT - Company Control HPE  * 
     C                     EXSR SIRVGN
      * Clear Drive Card Work file
      * Rtv/Dlt Drv Crd Wrk   RT - Drive Card Work  * 
     C                     EXSR SKRVGN
      * Retrieve/Change the Pen's Tattoo Dtls: Drive card nbr ,process co
      *  and Create Drive Card Work records for print routine
      * Rtv/Chg TttDtl Drvcrd RT - Tattoo Detail  * 
     C                     EXSR SMRVGN
      * Rtv Cmp Val Num & Incr XF - STR Order Management Sys  * 
     C                     CALL 'PMVCXFR'              90  Rtv Cmp Val Num
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0035  30       BOH Company Num
     C                     PARM @CN,003   WQ0036 10        Company Value C
     C           YL0001    PARM *ZERO     WQ0037 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMVCXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADDYL0001    WUEBNB           Pen Drive Seque
      * Rtv/Chg the Pen: Drive card nbr, drive seq, and status 'C'losed
      * Rtv/Chg Pen DrvCrdPrt RT - Pen  * 
     C                     EXSR SQRVGN
      * **********************************
      *   Print Drive Card
      * **********************************
      * Prt Drive Card        IF
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0038  30       BOH Company Num
     C                     PARM @CN,004   WQ0039 10        Company Value C
     C           YL0002    PARM *BLANK    WQ0040 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVELYL0002    YL0003           PRT Printer Dev
      * Setup message data for message
     C                     MOVEL@CN,005   ZA0038           Program Name $
     C                     MOVELYL0003    ZA0039           PRT Printer Dev
      *
      * Execute message
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2EXMCC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK0941' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN   7
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      * Error detected during execution
     C                     SETON                     98    *
     C                     END
      *
      * Prt Drive Card        PF - Drive Card Work  * 
     C                     CALL 'PKOZPFR'              90  Prt Drive Card
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HVNB    WQ0041  30       Pen Company Num
     C                     PARM #1CMCD    WQ0042  3        Pen Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKOZPFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CMCD    ZA0040           Pen Number
      * Send message 'Pen &1 must be opn f/prnt'
     C                     MOVEL'PRK0224' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Option 7 request
     C           #1SEL     IFEQ '7'                        *IF
     C           #1SEL     OREQ ' 7'
      * CASE: RCD.Pen Type is Resale
     C           #1FWST    IFEQ 'R'                        *IF
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Option only allowed f/rsl'
     C                     MOVEL'PRK0503' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
      * Force PUTOVR
     C                     SETON                     86
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
     C           *IN81     IFEQ '1'
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END                             WOD *92
     C                     END                             FI *81
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,35
     C                     SETOF                     98
      * USER: Process subfile record (Post-confirm)
      * CASE:
      *  - c1 AND c2
      *   |- c1    : RCD.*SFLSEL is Void Drive Card
      *   |- c2    : RCD.Pen Sts is Closed
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1SEL     IFEQ '4'                        *IF
     C           #1DGST    IFEQ 'C'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Exc Void Drive Card   IF
      * Rtv/Chg Pen: 'O'pen status, Set drive card, drive seq to 0
      * Rtv/Chg Pen Void Drv  RT - Pen  * 
     C                     EXSR SSRVGN
      * Rtv/Chg Tattoo Dtls: 'O'pen process code, Set drive card to 0
      * Rtv/Chg Ttt Dtl Drv   RT - Tattoo Detail  * 
     C                     EXSR SURVGN
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * CASE:
      *  - c1 AND c2
      *   |- c1    : RCD.*SFLSEL is *Option 7 request
      *   |- c2    : RCD.Pen Type is Resale
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1SEL     IFEQ '7'                        *IF
     C           #1SEL     OREQ ' 7'
     C           #1FWST    IFEQ 'R'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      *
     C                     Z-ADD*ZERO     WN0018  30       BOH Company Num
     C                     Z-ADD*ZERO     WN0019  70       BOH Buy Order N
     C                     Z-ADD*ZERO     WN0020  50       BOL Load Number
     C                     Z-ADD*ZERO     WN0021  50       TH Tattoo Numbe
     C                     Z-ADD*ZERO     WN0022  70       TH Kill Date
     C                     Z-ADD*ZERO     WN0023  50       TD Sequence Num
     C                     Z-ADD*ZERO     WN0024  71       TD Live Wgt
     C                     Z-ADD*ZERO     WN0025  50       TD Pen Head
     C                     Z-ADD*ZERO     WN0026  50       TD Yard Dead
     C                     Z-ADD*ZERO     WN0027  50       TD Held Over
     C                     MOVEL*BLANK    WN0028  1        TD Held Over St
     C                     Z-ADD*ZERO     WN0029  60       TD Drive Time
     C                     Z-ADD*ZERO     WN0030  30       TD Drive Card N
     C                     Z-ADD*ZERO     WN0031  51       TD Avg Live Wgt
     C                     MOVEL*BLANK    WN0032  1        TD Gen Bal To K
     C                     MOVEL*BLANK    WN0033  1        TD Recs Created
     C                     MOVEL*BLANK    WN0034  1        TD User Status
     C                     MOVEL*BLANK    WN0035  1        TD User Status
     C                     Z-ADD*ZERO     WN0036  70       TD User Date 1
     C                     Z-ADD*ZERO     WN0037  70       TD User Date 2
     C                     Z-ADD*ZERO     WN0038  70       TD Drive Date
     C                     MOVEL*BLANK    WN0039  6        TDP Process Cod
     C                     Z-ADD*ZERO     WN0040  30       Held Over Pen C
     C                     MOVEL*BLANK    WN0041  3        Held Over Pen N
     C                     MOVEL*BLANK    WN0042 10        RS User Changed
     C                     Z-ADD*ZERO     WN0043  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0044  60       RS Time Changed
     C                     MOVEL*BLANK    WN0045  1        RS Record Statu
     C                     MOVEL*BLANK    WN0046 10        RS Job
     C                     MOVEL*BLANK    WN0047 10        RS Program
     C                     MOVEL*BLANK    WN0048 10        RS User Added
     C                     Z-ADD*ZERO     WN0049  70       RS Date Added
     C                     Z-ADD*ZERO     WN0050  60       RS Time Added
      *
      * Exc Ttt Empty Rsl Pen IF
      * Retreive/Change the Pen's Tattoo Dtls: Process code     AND
      *  Held Over Processing for any Tattoo Dtls with Held Over Status =
      * Rtv/Chg TttDtl Rsl    RT - Tattoo Detail  * 
     C                     EXSR SWRVGN
      * Rtv/Chg the Pen: Drive card nbr & seq, hd adj., and status 'O'pen
      * and Recount Pen Head
      * Rtv/Chg Pen To Open   RT - Pen  * 
     C                     EXSR SYRVGN
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C                     SETON                     84    SFLNXTCHG
     C  N99                Z-ADD##RR      ##SFRC     99    *
     C                     GOTO EBEXIT
     C                     ELSE
      * SFLRCD valid
     C                     SETOF                     84    SFLNXTCHG
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     MOVEL'0'       *IN79
     C           P3G8ST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @A3REDD fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     Z-ADDA3HVNB    #1HVNB           Pen Company Num
     C                     Z-ADDA3B6CD    #1B6CD           Pen Current Dri
     C                     MOVELA3DGST    #1DGST           Pen Sts
     C                     MOVELA3AGCD    #1AGCD           GN Genetic Code
     C                     MOVELA3AAVN    #1AAVN           RS User Changed
     C                     Z-ADDA3AADT    #1AADT           RS Date Changed
     C                     Z-ADDA3AMTM    #1AMTM           RS Time Changed
     C                     MOVELA3AHVN    #1AHVN           RS Job
     C                     MOVELA3AGVN    #1AGVN           RS Program
     C                     MOVELA3ABVN    #1ABVN           RS User Added
     C                     Z-ADDA3ABDT    #1ABDT           RS Date Added
     C                     Z-ADDA3ABTM    #1ABTM           RS Time Added
     C                     MOVELA3CMCD    #1CMCD           Pen Number
     C                     Z-ADDA3D6NB    #1D6NB           Pen Current Hea
     C                     Z-ADDA3CTNB    #1CTNB           Pen Maximun Cap
     C                     Z-ADDA3EBNB    #1EBNB           Pen Drive Seque
     C                     Z-ADDA3HBNB    #1HBNB           Pen Adjustment
     C                     MOVELA3FWST    #1FWST           Pen Type
     C                     MOVELA3BBTX    #1BBTX           Pen Description
     C                     MOVELA3AJST    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     Z-ADD*ZERO     #RXEA1           Pen Tto Scl Tkt
     C                     MOVEL*BLANK    #RB4TX           Pen Status Desc
     C                     MOVEL*BLANK    #RLIST           TH Schedule Kil
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP2ETTX    #PETTX           PRT Description
     C                     MOVELP2ACVN    #PACVN           PRT Printer Dev
     C                     MOVELP2AKST    #PAKST           PRT Hold Output
     C                     MOVELP2AMST    #PAMST           PRT Save Output
     C                     Z-ADDP2AKNB    #PAKNB           PRT Copies
     C                     MOVELP2ALST    #PALST           PRT Night Queue
     C                     MOVELP2AIVN    #PAIVN           PRT Night Queue
     C                     MOVELP2C7CD    #PC7CD           Oms Application
     C                     MOVELP3J8NB    #PJ8NB           Oms Warehouse C
     C                     Z-ADDP3HONB    #PHONB           CC Company Numb
     C                     MOVELP3C8CD    #PC8CD           Oms SalesPerson
     C                     MOVELP3G8ST    #PG8ST           Oms Allow Multi
     C                     MOVELP3G9ST    #PG9ST           Oms Default Pri
     C                     MOVELP3EUTX    #PEUTX           Oms Name
     C                     MOVELP3EVTX    #PEVTX           Oms System Valu
     C                     MOVELP3HAST    #PHAST           Oms Access Deni
     C                     Z-ADDP1HVNB    #2HVNB           Pen Company Num
     C                     MOVEL*BLANK    #CBSTX           Name USR
     C                     MOVELP1CMCD    #2CMCD           Pen Number
     C                     Z-ADDP1D6NB    #2D6NB           Pen Current Hea
     C                     Z-ADD*ZERO     #CXEA1           Pen Tto Scl Tkt
     C                     Z-ADDP1CTNB    #2CTNB           Pen Maximun Cap
     C                     Z-ADDP1EBNB    #2EBNB           Pen Drive Seque
     C                     Z-ADD*ZERO     #2HBNB           Pen Adjustment
     C                     MOVEL*BLANK    #CB4TX           Pen Status Desc
     C                     MOVEL*BLANK    #2FWST           Pen Type
     C                     MOVEL*BLANK    #CLIST           TH Schedule Kil
     C                     MOVELP1BBTX    #2BBTX           Pen Description
     C                     MOVEL*BLANK    #2AJST           RS Record Statu
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Accum Pen Totals  RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A3HVNB    WQSA01           Pen Company Num
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Pen Company Num
      * Setup key
     C                     Z-ADD#2HVNB    WQSA01           Pen Company Num
      * Establish starting position
     C           KRSSA     SETLL@A3REDD                    *
     C           KRSSA     READE@A3REDD                  90*
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Exclude Resale pens from totals.
      * CASE: DB1.Pen Type is Resale
     C           A3FWST    IFEQ 'R'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ADD  A3D6NB    #2D6NB           Pen Current Hea
     C                     END                             *FI
     C           KRSSA     READE@A3REDD                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Tattoos in a pen  RT - Tattoo Detail  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  1        First Time Flag
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUP0NB           Count USR
     C                     MOVELWUCRTX    WUI8ST           @Status +/-
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
     C                     MOVEL'Y'       WN0001           First Time Flag
      * Declare restrictor key work fields
     C           *LIKE     DEFN A2HMNB    WQSB01           BOH Company Num
     C           *LIKE     DEFN A2CMCD    WQSB02           Pen Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           BOH Company Num
     C                     KFLD           WQSB02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSB01           BOH Company Num
     C                     MOVEL#1CMCD    WQSB02           Pen Number
      * Establish starting position
     C           KRSSB     SETLL@A2CPKC                    *
     C           KRSSB     READE@A2CPKC                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  1         WUP0NB           Count USR
     C                     Z-ADDA2CVNB    WUMLNB           Tattoo Nbr 4
      * Set up Tattoo's
      * CASE: WRK.Count USR is One
     C           WUP0NB    IFEQ 1                          *IF
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVELWUMLNB    WUTT1U           Tattoo 1
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
     C                     EXSR SCRVGN
     C                     ELSE
      * CASE: WRK.Count USR is Two
     C           WUP0NB    IFEQ 2                          *IF
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVELWUMLNB    WUTT2U           Tattoo 2
     C                     ELSE
      * CASE: WRK.Count USR is Three
     C           WUP0NB    IFEQ 3                          *IF
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVELWUMLNB    WUTT3U           Tattoo 3
     C                     ELSE
      * CASE: WRK.Count USR is Four
     C           WUP0NB    IFEQ 4                          *IF
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVELWUMLNB    WUTT4U           Tattoo 4
     C                     ELSE
      * CASE: WRK.Count USR is Five
     C           WUP0NB    IFEQ 5                          *IF
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
     C                     MOVELWUMLNB    WUNJNB           tattoo 5
     C                     ELSE
      * CASE: WRK.Count USR is Six
     C           WUP0NB    IFEQ 6                          *IF
     C                     MOVEL'+'       WUI8ST           @Status +/-
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Truck Weight Status
      * CASE: PAR.First Time Flag Usr is Yes
     C           WN0001    IFEQ 'Y'                        *IF
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
     C                     EXSR SDRVGN
     C                     MOVEL'N'       WN0001           First Time Flag
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.BOL Truck Scale Weigh Sts is Spread
     C           WUPAST    IFEQ 'S'                        *IF
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
     C                     EXSR SERVGN
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSB     READE@A2CPKC                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADDA2HMNB    A1HMNB           BOH Company Num
     C                     Z-ADDA2BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    A1BONB           BOL Load Number
     C                     Z-ADDA2CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDA2B0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSC     CHAIN@A1CPC4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RLIST           TH Schedule Kil
     C                     MOVEL*BLANK    WULJST           TH Shift Held O
     C                     Z-ADD*ZERO     WUT2HD           TH Shift Held O
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELA1LIST    #RLIST           TH Schedule Kil
     C                     MOVELA1LJST    WULJST           TH Shift Held O
     C                     Z-ADDA1T2HD    WUT2HD           TH Shift Held O
     C                     GOTO SCEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
      * Setup key
     C                     Z-ADDA2HMNB    AXHMNB           BOH Company Num
     C                     Z-ADDA2BNNB    AXBNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    AXBONB           BOL Load Number
      * Establish starting position
     C           KRSSD     CHAIN@AXCPBX              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0051' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUH5NB           BOL Head Receiv
     C                     MOVEL*BLANK    WUPAST           BOL Truck Scale
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAXDHNB    WUH5NB           BOL Head Receiv
     C                     MOVELAXPAST    WUPAST           BOL Truck Scale
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv BOL Truck Wgh Sts RT - Buy Order Load  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
      * Setup key
     C                     Z-ADDA2HMNB    AXHMNB           BOH Company Num
     C                     Z-ADDA2BNNB    AXBNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    AXBONB           BOL Load Number
      * Establish starting position
     C           KRSSE     CHAIN@AXCPBX              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0051' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUH5NB           BOL Head Receiv
     C                     MOVEL*BLANK    WUPAST           BOL Truck Scale
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDAXDHNB    WUH5NB           BOL Head Receiv
     C                     MOVELAXPAST    WUPAST           BOL Truck Scale
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv Tattoos in Pen    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUP0NB           Count USR
     C                     MOVELWUCRTX    WUI8ST           @Status +/-
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSF01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQSF02           Pen Number
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           BOH Company Num
     C                     KFLD           WQSF02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSF01           BOH Company Num
     C                     MOVEL#1CMCD    WQSF02           Pen Number
      * Establish starting position
     C           KRSSF     SETLL@A2CPKE                    *
     C           KRSSF     READE@A2CPKE                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  1         WUP0NB           Count USR
     C                     Z-ADDWACVNB    WUMLNB           Tattoo Nbr 4
      * CASE: WRK.Count USR is One
     C           WUP0NB    IFEQ 1                          *IF
     C                     MOVEL*BLANK    WUTT1U           Tattoo 1
     C                     MOVELWUMLNB    WUTT1U           Tattoo 1
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
     C                     EXSR SGRVGN
     C                     ELSE
      * CASE: WRK.Count USR is Two
     C           WUP0NB    IFEQ 2                          *IF
     C                     MOVEL*BLANK    WUTT2U           Tattoo 2
     C                     MOVELWUMLNB    WUTT2U           Tattoo 2
     C                     ELSE
      * CASE: WRK.Count USR is Three
     C           WUP0NB    IFEQ 3                          *IF
     C                     MOVEL*BLANK    WUTT3U           Tattoo 3
     C                     MOVELWUMLNB    WUTT3U           Tattoo 3
     C                     ELSE
      * CASE: WRK.Count USR is Four
     C           WUP0NB    IFEQ 4                          *IF
     C                     MOVEL*BLANK    WUTT4U           Tattoo 4
     C                     MOVELWUMLNB    WUTT4U           Tattoo 4
     C                     ELSE
      * CASE: WRK.Count USR is Five
     C           WUP0NB    IFEQ 5                          *IF
     C                     MOVEL*BLANK    WUNJNB           tattoo 5
     C                     MOVELWUMLNB    WUNJNB           tattoo 5
     C                     ELSE
      * CASE: WRK.Count USR is Six
     C           WUP0NB    IFEQ 6                          *IF
     C                     MOVEL'+'       WUI8ST           @Status +/-
     C                     GOTO SFEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSF     READE@A2CPKE                  90*
     C                     ENDDO
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Shift,HldOvrShft  RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADDWAHMNB    A1HMNB           BOH Company Num
     C                     Z-ADDWABNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDWABONB    A1BONB           BOL Load Number
     C                     Z-ADDWACVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDWAB0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSG     CHAIN@A1CPC4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #RLIST           TH Schedule Kil
     C                     MOVEL*BLANK    WULJST           TH Shift Held O
     C                     Z-ADD*ZERO     WUT2HD           TH Shift Held O
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELA1LIST    #RLIST           TH Schedule Kil
     C                     MOVELA1LJST    WULJST           TH Shift Held O
     C                     Z-ADDA1T2HD    WUT2HD           TH Shift Held O
     C                     GOTO SGEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Vry Tattoo SclTickAct  RT - Tattoo Scale Ticket  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN B3HMNB    WQSH01           BOH Company Num
     C           *LIKE     DEFN B3CMCD    WQSH02           Pen Number
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           BOH Company Num
     C                     KFLD           WQSH02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSH01           BOH Company Num
     C                     MOVEL#1CMCD    WQSH02           Pen Number
      * Establish starting position
     C           KRSSH     SETLL@B3CPU6                    *
     C           KRSSH     READE@B3CPU6                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0144' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WULMST           Return Code USR
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.RS Record Status is Flag for Purge
     C           B3AJST    IFEQ 'D'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'STKNOTP' WULMST           Return Code USR
     C                     END                             *FI
     C           KRSSH     READE@B3CPU6                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Rtv/Upd Last Drv Crd  RT - Company Control HPE  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           AZHONB           CC Company Numb
      * Setup key
     C                     Z-ADD#1HVNB    AZHONB           CC Company Numb
      * Establish starting position
     C           KRSSI     CHAIN@AZCPCN              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0055' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         P1B6CD           Last Drive Card
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           AZH4NB    ADD  1         P1B6CD           Last Drive Card
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) AZK3NB' defaulted for 'Last Tattoo Nbr'.
      * Chg Last Drv Crd      CH - Company Control HPE  * 
     C                     EXSR SJCHRC
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Chg Last Drv Crd      CH - Company Control HPE  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0002  70       Next Buy Order
     C                     Z-ADD*ZERO     WN0003  70       Current Kill Da
     C                     Z-ADD*ZERO     WN0004  70       Next Kill Date
     C                     Z-ADD*ZERO     WN0005  70       Current Product
     C                     Z-ADD*ZERO     WN0006  70       Next Production
     C                     MOVEL*BLANK    WN0007 10        RS User Changed
     C                     Z-ADD*ZERO     WN0008  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0009  60       RS Time Changed
     C                     MOVEL*BLANK    WN0010  1        RS Record Statu
     C                     MOVEL*BLANK    WN0011 10        RS Job
     C                     MOVEL*BLANK    WN0012 10        RS Program
     C                     MOVEL*BLANK    WN0013 10        RS User Added
     C                     Z-ADD*ZERO     WN0014  70       RS Date Added
     C                     Z-ADD*ZERO     WN0015  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @AZCPCM
     C                     Z-ADDAZHONB    WBHONB           CC Company Numb
      *
     C           KLCHSJ    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C           KLCHSJ    CHAIN@AZCPCM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAZREL0'MDACP
     C                     MOVEL'@AZCPCM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKAZ1    YARDCS
      * Move non-key fields to @AZCPCM
     C                     Z-ADDP1B6CD    WBH4NB           Last Drive Card
     C                     Z-ADDAZK3NB    WBK3NB           Last Tattoo Nbr
      *
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WBAAVN           RS User Changed
     C                     Z-ADD##JDT     WBAADT           RS Date Changed
     C                     Z-ADD##JTM     WBAMTM           RS Time Changed
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKAZ1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AZCPCM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKAZREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Rtv/Dlt Drv Crd Wrk   RT - Drive Card Work  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN CTHVNB    WQSK01           Pen Company Num
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Pen Company Num
      * Setup key
     C                     Z-ADD#1HVNB    WQSK01           Pen Company Num
      * Establish starting position
     C           KRSSK     SETLL@CTCPM9                    *
     C           KRSSK     READE@CTCPM9                  90*
      * Data record not found
     C   90                MOVEL'PRK0352' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Delete Drive Card Work - Drive Card Work  * 
     C                     EXSR SLDLRC
     C           KRSSK     READE@CTCPM9                  90*
     C                     ENDDO
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLDLRC    BEGSR
      *================================================================
      * Delete Drive Card Work - Drive Card Work  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @CTCPM8
     C                     Z-ADDCTHVNB    WCHVNB           Pen Company Num
     C                     MOVELCTCMCD    WCCMCD           Pen Number
     C                     Z-ADDCTKYNB    WCKYNB           DCW Sequence Nu
      *
     C           KLDLSL    KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
     C                     KFLD           WCKYNB           DCW Sequence Nu
     C           KLDLSL    CHAIN@CTCPM8              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKCTCPL0'MDACP
     C                     MOVEL'@CTCPM8' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SLEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@CTCPM8                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Rtv/Chg TttDtl Drvcrd RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUKYNB           DCW Sequence Nu
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDHMNB    WQSM01           BOH Company Num
     C           *LIKE     DEFN WDCMCD    WQSM02           Pen Number
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           WQSM01           BOH Company Num
     C                     KFLD           WQSM02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSM01           BOH Company Num
     C                     MOVEL#1CMCD    WQSM02           Pen Number
      * Establish starting position
     C           KRSSM     SETLL@A2CPKD                    *
     C           KRSSM     READE@A2CPKD                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    P1DGST           TDP Process Cod
     C                     MOVEL'D'       P1DGST           TDP Process Cod
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
     C                     EXSR SNCHRC
      * Build and Create Drive Card Work file record for print
      * Rtv Ttt Hdr Purch Dt  RT - Tattoo Header  * 
     C                     EXSR SORVGN
     C                     ADD  1         WUKYNB           DCW Sequence Nu
     C           WDC0NB    SUB  WDD8NB    WUK0NB           DCW Pen Head
      * Create Drive Card Work - Drive Card Work  * 
     C                     EXSR SPCRRC
     C           KRSSM     READE@A2CPKD                  90*
     C                     ENDDO
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNCHRC    BEGSR
      *================================================================
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @A2CPDF
     C                     Z-ADDWDHMNB    WEHMNB           BOH Company Num
     C                     Z-ADDWDBNNB    WEBNNB           BOH Buy Order N
     C                     Z-ADDWDBONB    WEBONB           BOL Load Number
     C                     Z-ADDWDCVNB    WECVNB           TH Tattoo Numbe
     C                     Z-ADDWDB0DT    WEB0DT           TH Kill Date
     C                     Z-ADDWDC2NB    WEC2NB           TD Sequence Num
      *
     C           KLCHSN    KLIST
     C                     KFLD           WEHMNB           BOH Company Num
     C                     KFLD           WEBNNB           BOH Buy Order N
     C                     KFLD           WEBONB           BOL Load Number
     C                     KFLD           WECVNB           TH Tattoo Numbe
     C                     KFLD           WEB0DT           TH Kill Date
     C                     KFLD           WEC2NB           TD Sequence Num
     C           KLCHSN    CHAIN@A2CPDF              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA2CPL0'MDACP
     C                     MOVEL'@A2CPDF' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SNEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SNEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA21    YBRDCS
      * Move non-key fields to @A2CPDF
     C                     Z-ADDWDCZNB    WECZNB           TD Live Wgt
     C                     Z-ADDWDC0NB    WEC0NB           TD Pen Head
     C                     Z-ADDWDD8NB    WED8NB           TD Yard Dead
     C                     Z-ADDWDH7NB    WEH7NB           TD Held Over
     C                     MOVELWDGGST    WEGGST    P      TD Held Over St
     C                     Z-ADDWDAJTM    WEAJTM           TD Drive Time
     C                     Z-ADDWDJEA1    WEJEA1           TD Drive Hour
     C                     Z-ADDP1B6CD    WEB7CD           TD Drive Card N
     C                     Z-ADDWDD7NB    WED7NB           TD Avg Live Wgt
     C                     MOVELWDD9ST    WED9ST    P      TD Gen Bal To K
     C                     MOVELWDE3ST    WEE3ST    P      TD Recs Created
     C                     MOVELWDE4ST    WEE4ST    P      TD User Status
     C                     MOVELWDE5ST    WEE5ST    P      TD User Status
     C                     Z-ADDWDBVDT    WEBVDT           TD User Date 1
     C                     Z-ADDWDBWDT    WEBWDT           TD User Date 2
     C                     Z-ADDWDBXDT    WEBXDT           TD Drive Date
     C                     Z-ADDWDHVNB    WEHVNB           Pen Company Num
     C                     MOVELWDCMCD    WECMCD    P      Pen Number
     C                     MOVELP1DGST    WEB9CD    P      TDP Process Cod
     C                     Z-ADDWDH8NB    WEH8NB           Held Over Pen C
     C                     MOVELWDCYCD    WECYCD    P      Held Over Pen N
     C                     MOVELWDAAVN    WEAAVN    P      RS User Changed
     C                     Z-ADDWDAADT    WEAADT           RS Date Changed
     C                     Z-ADDWDAMTM    WEAMTM           RS Time Changed
     C                     MOVELWDAJST    WEAJST    P      RS Record Statu
     C                     MOVELWDAHVN    WEAHVN    P      RS Job
     C                     MOVELWDAGVN    WEAGVN    P      RS Program
     C                     MOVELWDABVN    WEABVN    P      RS User Added
     C                     Z-ADDWDABDT    WEABDT           RS Date Added
     C                     Z-ADDWDABTM    WEABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WEAAVN           RS User Changed
     C                     Z-ADD##JDT     WEAADT           RS Date Changed
     C                     Z-ADD##JTM     WEAMTM           RS Time Changed
     C                     MOVEL##JOB     WEAHVN           RS Job
     C                     MOVEL##PGM     WEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@A2CPDF                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * Rtv Ttt Hdr Purch Dt  RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADDWDHMNB    A1HMNB           BOH Company Num
     C                     Z-ADDWDBNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDWDBONB    A1BONB           BOL Load Number
     C                     Z-ADDWDCVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDWDB0DT    A1B0DT           TH Kill Date
      * Establish starting position
     C           KRSSO     CHAIN@A1CPC4              90    *
      * Data record not found
     C   90                MOVEL'PRK0061' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDA1AWDT    WUAWDT           TH Purchase Dat
     C                     ENDIF
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPCRRC    BEGSR
      *================================================================
      * Create Drive Card Work - Drive Card Work  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @CTCPM8
     C                     Z-ADDWDHVNB    WCHVNB           Pen Company Num
     C                     MOVELWDCMCD    WCCMCD           Pen Number
     C                     Z-ADDWUKYNB    WCKYNB           DCW Sequence Nu
     C                     Z-ADDWUAWDT    WCCCDT           DCW Purchase Da
     C                     Z-ADDWDCVNB    WCKZNB           DCW Tattoo Numb
     C                     Z-ADDWUK0NB    WCK0NB           DCW Pen Head
     C                     Z-ADDP1B6CD    WCK1NB           DCW Drive Card
     C                     Z-ADDWDB0DT    WCDODT           DCW Kill Date
      *
     C           KLCRSP    KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
     C                     KFLD           WCKYNB           DCW Sequence Nu
      * Check for duplicate primary key
     C           KLCRSP    SETLL@CTCPM8                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0353' W0RTN   7
      * Send message 'Drive Card Work        EX'
     C                     MOVEL'PRK0353' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C                     WRITE@CTCPM8                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Rtv/Chg Pen DrvCrdPrt RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    A3HVNB           Pen Company Num
     C                     MOVEL#1CMCD    A3CMCD           Pen Number
      * Establish starting position
     C           KRSSQ     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'C'       #1DGST           Pen Sts
      * Chg Pen               CH - Pen  * 
     C                     EXSR SRCHRC
     C                     ENDIF
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDA3HVNB    WFHVNB           Pen Company Num
     C                     MOVELA3CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHSR    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSR    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SREXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SREXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YCRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELA3BBTX    WFBBTX    P      Pen Description
     C                     Z-ADDA3CTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDA3D6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDP1B6CD    WFB6CD           Pen Current Dri
     C                     MOVEL#1DGST    WFDGST    P      Pen Sts
     C                     Z-ADDWUEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELA3FWST    WFFWST    P      Pen Type
     C                     Z-ADD*ZERO     WFHBNB           Pen Adjustment
     C                     MOVELA3AGCD    WFAGCD    P      GN Genetic Code
     C                     MOVELA3AAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDA3AADT    WFAADT           RS Date Changed
     C                     Z-ADDA3AMTM    WFAMTM           RS Time Changed
     C                     MOVELA3AJST    WFAJST    P      RS Record Statu
     C                     MOVELA3AHVN    WFAHVN    P      RS Job
     C                     MOVELA3AGVN    WFAGVN    P      RS Program
     C                     MOVELA3ABVN    WFABVN    P      RS User Added
     C                     Z-ADDA3ABDT    WFABDT           RS Date Added
     C                     Z-ADDA3ABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * Rtv/Chg Pen Void Drv  RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    A3HVNB           Pen Company Num
     C                     MOVEL#1CMCD    A3CMCD           Pen Number
      * Establish starting position
     C           KRSSS     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDWUE9NB    #1B6CD           Pen Current Dri
     C                     Z-ADDWUE9NB    #1EBNB           Pen Drive Seque
     C                     MOVEL'O'       #1DGST           Pen Sts
      * Change Pen - Pen  * 
     C                     EXSR STCHRC
     C                     ENDIF
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STCHRC    BEGSR
      *================================================================
      * Change Pen - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDA3HVNB    WFHVNB           Pen Company Num
     C                     MOVELA3CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHST    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHST    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL005.
     C                     MOVEL'LBL005'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO STEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO STEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YDRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELA3BBTX    WFBBTX    P      Pen Description
     C                     Z-ADDA3CTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDA3D6NB    WFD6NB           Pen Current Hea
     C                     Z-ADD#1B6CD    WFB6CD           Pen Current Dri
     C                     MOVEL#1DGST    WFDGST    P      Pen Sts
     C                     Z-ADD#1EBNB    WFEBNB           Pen Drive Seque
     C                     MOVELA3FWST    WFFWST    P      Pen Type
     C                     Z-ADDA3HBNB    WFHBNB           Pen Adjustment
     C                     MOVELA3AGCD    WFAGCD    P      GN Genetic Code
     C                     MOVELA3AAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDA3AADT    WFAADT           RS Date Changed
     C                     Z-ADDA3AMTM    WFAMTM           RS Time Changed
     C                     MOVELA3AJST    WFAJST    P      RS Record Statu
     C                     MOVELA3AHVN    WFAHVN    P      RS Job
     C                     MOVELA3AGVN    WFAGVN    P      RS Program
     C                     MOVELA3ABVN    WFABVN    P      RS User Added
     C                     Z-ADDA3ABDT    WFABDT           RS Date Added
     C                     Z-ADDA3ABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SURVGN    BEGSR
      *================================================================
      * Rtv/Chg Ttt Dtl Drv   RT - Tattoo Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0016  30       TD Drive Card N
     C                     MOVEL*BLANK    WN0017  6        TDP Process Cod
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A2HMNB    WQSU01           BOH Company Num
     C           *LIKE     DEFN A2CMCD    WQSU02           Pen Number
      * Define keylist
     C           KRSSU     KLIST
     C                     KFLD           WQSU01           BOH Company Num
     C                     KFLD           WQSU02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSU01           BOH Company Num
     C                     MOVEL#1CMCD    WQSU02           Pen Number
      * Establish starting position
     C           KRSSU     SETLL@A2CPKC                    *
     C           KRSSU     READE@A2CPKC                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * For Void Drive Card:  Set Drive Card Nbr to 0 and Process Code to
     C                     Z-ADD*ZERO     WN0016           TD Drive Card N
     C                     MOVEL*BLANK    WN0017           TDP Process Cod
     C                     MOVEL'O'       WN0017           TDP Process Cod
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
     C                     EXSR SVCHRC
     C           KRSSU     READE@A2CPKC                  90*
     C                     ENDDO
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVCHRC    BEGSR
      *================================================================
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YERDC   1
      *
      * Move key fields to @A2CPDF
     C                     Z-ADDA2HMNB    WEHMNB           BOH Company Num
     C                     Z-ADDA2BNNB    WEBNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    WEBONB           BOL Load Number
     C                     Z-ADDA2CVNB    WECVNB           TH Tattoo Numbe
     C                     Z-ADDA2B0DT    WEB0DT           TH Kill Date
     C                     Z-ADDA2C2NB    WEC2NB           TD Sequence Num
      *
     C           KLCHSV    KLIST
     C                     KFLD           WEHMNB           BOH Company Num
     C                     KFLD           WEBNNB           BOH Buy Order N
     C                     KFLD           WEBONB           BOL Load Number
     C                     KFLD           WECVNB           TH Tattoo Numbe
     C                     KFLD           WEB0DT           TH Kill Date
     C                     KFLD           WEC2NB           TD Sequence Num
     C           KLCHSV    CHAIN@A2CPDF              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA2CPL0'MDACP
     C                     MOVEL'@A2CPDF' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL006.
     C                     MOVEL'LBL006'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SVEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SVEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA21    YERDCS
      * Move non-key fields to @A2CPDF
     C                     Z-ADDA2CZNB    WECZNB           TD Live Wgt
     C                     Z-ADDA2C0NB    WEC0NB           TD Pen Head
     C                     Z-ADDA2D8NB    WED8NB           TD Yard Dead
     C                     Z-ADDA2H7NB    WEH7NB           TD Held Over
     C                     MOVELA2GGST    WEGGST    P      TD Held Over St
     C                     Z-ADDA2AJTM    WEAJTM           TD Drive Time
     C                     Z-ADDA2JEA1    WEJEA1           TD Drive Hour
     C                     Z-ADDWN0016    WEB7CD           TD Drive Card N
     C                     Z-ADDA2D7NB    WED7NB           TD Avg Live Wgt
     C                     MOVELA2D9ST    WED9ST    P      TD Gen Bal To K
     C                     MOVELA2E3ST    WEE3ST    P      TD Recs Created
     C                     MOVELA2E4ST    WEE4ST    P      TD User Status
     C                     MOVELA2E5ST    WEE5ST    P      TD User Status
     C                     Z-ADDA2BVDT    WEBVDT           TD User Date 1
     C                     Z-ADDA2BWDT    WEBWDT           TD User Date 2
     C                     Z-ADDA2BXDT    WEBXDT           TD Drive Date
     C                     Z-ADDA2HVNB    WEHVNB           Pen Company Num
     C                     MOVELA2CMCD    WECMCD    P      Pen Number
     C                     MOVELWN0017    WEB9CD    P      TDP Process Cod
     C                     Z-ADDA2H8NB    WEH8NB           Held Over Pen C
     C                     MOVELA2CYCD    WECYCD    P      Held Over Pen N
     C                     MOVELA2AAVN    WEAAVN    P      RS User Changed
     C                     Z-ADDA2AADT    WEAADT           RS Date Changed
     C                     Z-ADDA2AMTM    WEAMTM           RS Time Changed
     C                     MOVELA2AJST    WEAJST    P      RS Record Statu
     C                     MOVELA2AHVN    WEAHVN    P      RS Job
     C                     MOVELA2AGVN    WEAGVN    P      RS Program
     C                     MOVELA2ABVN    WEABVN    P      RS User Added
     C                     Z-ADDA2ABDT    WEABDT           RS Date Added
     C                     Z-ADDA2ABTM    WEABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YERDCS
     C           YERDC     ANDNE'N'
     C                     MOVE 'Y'       YERDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WEAAVN           RS User Changed
     C                     Z-ADD##JDT     WEAADT           RS Date Changed
     C                     Z-ADD##JTM     WEAMTM           RS Time Changed
     C                     MOVEL##JOB     WEAHVN           RS Job
     C                     MOVEL##PGM     WEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YERDCS
     C           YERDC     ANDNE'N'
     C                     MOVE 'Y'       YERDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@A2CPDF                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         SWRVGN    BEGSR
      *================================================================
      * Rtv/Chg TttDtl Rsl    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSW01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQSW02           Pen Number
      * Define keylist
     C           KRSSW     KLIST
     C                     KFLD           WQSW01           BOH Company Num
     C                     KFLD           WQSW02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQSW01           BOH Company Num
     C                     MOVEL#1CMCD    WQSW02           Pen Number
      * Establish starting position
     C           KRSSW     SETLL@A2CPKE                    *
     C           KRSSW     READE@A2CPKE                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    WUB9CD           TDP Process Cod
     C                     MOVEL'K'       WUB9CD           TDP Process Cod
     C           WUC0NB    MULT WAD7NB    WUCZNB           TD Live Wgt
     C                     Z-ADD##JHH     YL0004           TD Drive Hour
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
     C                     EXSR SXCHRC
     C           KRSSW     READE@A2CPKE                  90*
     C                     ENDDO
      *================================================================
     CSR         SWEXIT    ENDSR
      /EJECT
     CSR         SXCHRC    BEGSR
      *================================================================
      * Chg Tattoo Detail     CH - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YFRDC   1
      *
      * Move key fields to @A2CPDF
     C                     Z-ADDWAHMNB    WEHMNB           BOH Company Num
     C                     Z-ADDWABNNB    WEBNNB           BOH Buy Order N
     C                     Z-ADDWABONB    WEBONB           BOL Load Number
     C                     Z-ADDWACVNB    WECVNB           TH Tattoo Numbe
     C                     Z-ADDWAB0DT    WEB0DT           TH Kill Date
     C                     Z-ADDWAC2NB    WEC2NB           TD Sequence Num
      *
     C           KLCHSX    KLIST
     C                     KFLD           WEHMNB           BOH Company Num
     C                     KFLD           WEBNNB           BOH Buy Order N
     C                     KFLD           WEBONB           BOL Load Number
     C                     KFLD           WECVNB           TH Tattoo Numbe
     C                     KFLD           WEB0DT           TH Kill Date
     C                     KFLD           WEC2NB           TD Sequence Num
     C           KLCHSX    CHAIN@A2CPDF              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA2CPL0'MDACP
     C                     MOVEL'@A2CPDF' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL007.
     C                     MOVEL'LBL007'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SXEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SXEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA21    YFRDCS
      * Move non-key fields to @A2CPDF
     C                     Z-ADDWUCZNB    WECZNB           TD Live Wgt
     C                     Z-ADDWUC0NB    WEC0NB           TD Pen Head
     C                     Z-ADDWAD8NB    WED8NB           TD Yard Dead
     C                     Z-ADDWAH7NB    WEH7NB           TD Held Over
     C                     MOVELWUGGST    WEGGST    P      TD Held Over St
     C                     Z-ADD##JTM     WEAJTM           TD Drive Time
     C                     Z-ADDYL0004    WEJEA1           TD Drive Hour
     C                     Z-ADDWAB7CD    WEB7CD           TD Drive Card N
     C                     Z-ADDWAD7NB    WED7NB           TD Avg Live Wgt
     C                     MOVELWAD9ST    WED9ST    P      TD Gen Bal To K
     C                     MOVELWAE3ST    WEE3ST    P      TD Recs Created
     C                     MOVELWAE4ST    WEE4ST    P      TD User Status
     C                     MOVELWAE5ST    WEE5ST    P      TD User Status
     C                     Z-ADDWABVDT    WEBVDT           TD User Date 1
     C                     Z-ADDWABWDT    WEBWDT           TD User Date 2
     C                     Z-ADD##JDT     WEBXDT           TD Drive Date
     C                     Z-ADDWAHVNB    WEHVNB           Pen Company Num
     C                     MOVELWACMCD    WECMCD    P      Pen Number
     C                     MOVELWUB9CD    WEB9CD    P      TDP Process Cod
     C                     Z-ADDWAH8NB    WEH8NB           Held Over Pen C
     C                     MOVELWACYCD    WECYCD    P      Held Over Pen N
     C                     MOVELWAAAVN    WEAAVN    P      RS User Changed
     C                     Z-ADDWAAADT    WEAADT           RS Date Changed
     C                     Z-ADDWAAMTM    WEAMTM           RS Time Changed
     C                     MOVELWAAJST    WEAJST    P      RS Record Statu
     C                     MOVELWAAHVN    WEAHVN    P      RS Job
     C                     MOVELWAAGVN    WEAGVN    P      RS Program
     C                     MOVELWAABVN    WEABVN    P      RS User Added
     C                     Z-ADDWAABDT    WEABDT           RS Date Added
     C                     Z-ADDWAABTM    WEABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YFRDCS
     C           YFRDC     ANDNE'N'
     C                     MOVE 'Y'       YFRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WEAAVN           RS User Changed
     C                     Z-ADD##JDT     WEAADT           RS Date Changed
     C                     Z-ADD##JTM     WEAMTM           RS Time Changed
     C                     MOVEL##JOB     WEAHVN           RS Job
     C                     MOVEL##PGM     WEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA21    IFNE YFRDCS
     C           YFRDC     ANDNE'N'
     C                     MOVE 'Y'       YFRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@A2CPDF                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SXEXIT    ENDSR
      /EJECT
     CSR         SYRVGN    BEGSR
      *================================================================
      * Rtv/Chg Pen To Open   RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSY     KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    A3HVNB           Pen Company Num
     C                     MOVEL#1CMCD    A3CMCD           Pen Number
      * Establish starting position
     C           KRSSY     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDWUE9NB    WUB6CD           Pen Current Dri
     C                     Z-ADDWUE9NB    WUEBNB           Pen Drive Seque
     C                     MOVEL'O'       WUDGST           Pen Sts
     C                     Z-ADDWUE9NB    WUHBNB           Pen Adjustment
      * Chg Pen               CH - Pen  * 
     C                     EXSR SZCHRC
      * Recount Pen Head Count and Chg the Pen
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
     C                     EXSR TARVGN
     C                     ENDIF
      *================================================================
     CSR         SYEXIT    ENDSR
      /EJECT
     CSR         SZCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YGRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDA3HVNB    WFHVNB           Pen Company Num
     C                     MOVELA3CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHSZ    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSZ    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL008.
     C                     MOVEL'LBL008'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SZEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SZEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YGRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELA3BBTX    WFBBTX    P      Pen Description
     C                     Z-ADDA3CTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDA3D6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDWUB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWUDGST    WFDGST    P      Pen Sts
     C                     Z-ADDWUEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELA3FWST    WFFWST    P      Pen Type
     C                     Z-ADDWUHBNB    WFHBNB           Pen Adjustment
     C                     MOVELA3AGCD    WFAGCD    P      GN Genetic Code
     C                     MOVELA3AAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDA3AADT    WFAADT           RS Date Changed
     C                     Z-ADDA3AMTM    WFAMTM           RS Time Changed
     C                     MOVELA3AJST    WFAJST    P      RS Record Statu
     C                     MOVELA3AHVN    WFAHVN    P      RS Job
     C                     MOVELA3AGVN    WFAGVN    P      RS Program
     C                     MOVELA3ABVN    WFABVN    P      RS User Added
     C                     Z-ADDA3ABDT    WFABDT           RS Date Added
     C                     Z-ADDA3ABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YGRDCS
     C           YGRDC     ANDNE'N'
     C                     MOVE 'Y'       YGRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YGRDCS
     C           YGRDC     ANDNE'N'
     C                     MOVE 'Y'       YGRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YGRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SZEXIT    ENDSR
      /EJECT
     CSR         TARVGN    BEGSR
      *================================================================
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Set Pen Totals to Zeros - Pen  * 
     C                     EXSR TBRVGN
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQTA01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQTA02           Pen Number
      * Define keylist
     C           KRSTA     KLIST
     C                     KFLD           WQTA01           BOH Company Num
     C                     KFLD           WQTA02           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WQTA01           BOH Company Num
     C                     MOVEL#1CMCD    WQTA02           Pen Number
      * Establish starting position
     C           KRSTA     SETLL@A2CPKE                    *
     C           KRSTA     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR TDCHRC
     C                     GOTO TAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Rtv/Chg Pen Totals    RT - Pen  * 
     C                     EXSR TERVGN
     C           KRSTA     READE@A2CPKE                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
     C                     EXSR TGRVGN
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR TJCHRC
      *================================================================
     CSR         TAEXIT    ENDSR
      /EJECT
     CSR         TBRVGN    BEGSR
      *================================================================
      * Set Pen Totals to Zeros - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTB     KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    A3HVNB           Pen Company Num
     C                     MOVEL#1CMCD    A3CMCD           Pen Number
      * Establish starting position
     C           KRSTB     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Pen               CH - Pen  * 
     C                     EXSR TCCHRC
     C                     ENDIF
      *================================================================
     CSR         TBEXIT    ENDSR
      /EJECT
     CSR         TCCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YHRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDA3HVNB    WFHVNB           Pen Company Num
     C                     MOVELA3CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTC    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTC    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL009.
     C                     MOVEL'LBL009'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YHRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUCRTX    WFBBTX    P      Pen Description
     C                     Z-ADDA3CTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WFD6NB           Pen Current Hea
     C                     Z-ADDA3B6CD    WFB6CD           Pen Current Dri
     C                     MOVELA3DGST    WFDGST    P      Pen Sts
     C                     Z-ADDA3EBNB    WFEBNB           Pen Drive Seque
     C                     MOVELA3FWST    WFFWST    P      Pen Type
     C                     Z-ADDA3HBNB    WFHBNB           Pen Adjustment
     C                     MOVELWUCRTX    WFAGCD    P      GN Genetic Code
     C                     MOVELA3AAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDA3AADT    WFAADT           RS Date Changed
     C                     Z-ADDA3AMTM    WFAMTM           RS Time Changed
     C                     MOVELA3AJST    WFAJST    P      RS Record Statu
     C                     MOVELA3AHVN    WFAHVN    P      RS Job
     C                     MOVELA3AGVN    WFAGVN    P      RS Program
     C                     MOVELA3ABVN    WFABVN    P      RS User Added
     C                     Z-ADDA3ABDT    WFABDT           RS Date Added
     C                     Z-ADDA3ABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YHRDCS
     C           YHRDC     ANDNE'N'
     C                     MOVE 'Y'       YHRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YHRDCS
     C           YHRDC     ANDNE'N'
     C                     MOVE 'Y'       YHRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YHRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TCEXIT    ENDSR
      /EJECT
     CSR         TDCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0051  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0052  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0053  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0054  1        Pen Sts
     C                     Z-ADD*ZERO     WN0055  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0056  1        Pen Type
     C                     Z-ADD*ZERO     WN0057  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0058 10        RS User Changed
     C                     Z-ADD*ZERO     WN0059  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0060  60       RS Time Changed
     C                     MOVEL*BLANK    WN0061  1        RS Record Statu
     C                     MOVEL*BLANK    WN0062 10        RS Job
     C                     MOVEL*BLANK    WN0063 10        RS Program
     C                     MOVEL*BLANK    WN0064 10        RS User Added
     C                     Z-ADD*ZERO     WN0065  70       RS Date Added
     C                     Z-ADD*ZERO     WN0066  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YIRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HVNB    WFHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTD    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTD    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL010.
     C                     MOVEL'LBL010'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YIRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX    P      Pen Description
     C                     MOVELWUAGCD    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YIRDCS
     C           YIRDC     ANDNE'N'
     C                     MOVE 'Y'       YIRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YIRDCS
     C           YIRDC     ANDNE'N'
     C                     MOVE 'Y'       YIRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YIRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TDEXIT    ENDSR
      /EJECT
     CSR         TERVGN    BEGSR
      *================================================================
      * Rtv/Chg Pen Totals    RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTE     KLIST
     C                     KFLD           A3HVNB           Pen Company Num
     C                     KFLD           A3CMCD           Pen Number
      * Setup key
     C                     Z-ADDWAHMNB    A3HVNB           Pen Company Num
     C                     MOVELWACMCD    A3CMCD           Pen Number
      * Establish starting position
     C           KRSTE     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           WAC0NB    ADD  A3D6NB    WUD6NB           Pen Current Hea
     C                     SUB  WAD8NB    WUD6NB           Pen Current Hea
      * Chg Pen               CH - Pen  * 
     C                     EXSR TFCHRC
     C                     ENDIF
      *================================================================
     CSR         TEEXIT    ENDSR
      /EJECT
     CSR         TFCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YJRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDA3HVNB    WFHVNB           Pen Company Num
     C                     MOVELA3CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTF    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTF    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL011.
     C                     MOVEL'LBL011'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YJRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELA3BBTX    WFBBTX    P      Pen Description
     C                     Z-ADDA3CTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDWUD6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDA3B6CD    WFB6CD           Pen Current Dri
     C                     MOVELA3DGST    WFDGST    P      Pen Sts
     C                     Z-ADDA3EBNB    WFEBNB           Pen Drive Seque
     C                     MOVELA3FWST    WFFWST    P      Pen Type
     C                     Z-ADDA3HBNB    WFHBNB           Pen Adjustment
     C                     MOVELA3AGCD    WFAGCD    P      GN Genetic Code
     C                     MOVELA3AAVN    WFAAVN    P      RS User Changed
     C                     Z-ADDA3AADT    WFAADT           RS Date Changed
     C                     Z-ADDA3AMTM    WFAMTM           RS Time Changed
     C                     MOVELA3AJST    WFAJST    P      RS Record Statu
     C                     MOVELA3AHVN    WFAHVN    P      RS Job
     C                     MOVELA3AGVN    WFAGVN    P      RS Program
     C                     MOVELA3ABVN    WFABVN    P      RS User Added
     C                     Z-ADDA3ABDT    WFABDT           RS Date Added
     C                     Z-ADDA3ABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YJRDCS
     C           YJRDC     ANDNE'N'
     C                     MOVE 'Y'       YJRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YJRDCS
     C           YJRDC     ANDNE'N'
     C                     MOVE 'Y'       YJRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YJRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TFEXIT    ENDSR
      /EJECT
     CSR         TGRVGN    BEGSR
      *================================================================
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQTG01           BOH Company Num
     C           *LIKE     DEFN WACMCD    WQTG02           Pen Number
      * Define keylist
     C           KRSTG     KLIST
     C                     KFLD           WQTG01           BOH Company Num
     C                     KFLD           WQTG02           Pen Number
      * Setup key
     C                     Z-ADDWAHMNB    WQTG01           BOH Company Num
     C                     MOVELWACMCD    WQTG02           Pen Number
      * Establish starting position
     C           KRSTG     SETLL@A2CPKE                    *
     C           KRSTG     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     GOTO TGEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.TDP Process Code is Drive Card Printed
      *   |- c2    : DB1.TDP Process Code is Open
      *   '-
     C           WAB9CD    IFEQ 'D'                        *IF
     C           WAB9CD    OREQ 'O'                        *OR
      * Rtv Tattoo GENETICS - Tattoo Header  * 
     C                     EXSR THRVGN
      * CASE: PAR.GN Genetic Code is BLANKS
     C           WUAGCD    IFEQ *BLANK                     *IF
     C                     MOVELWUA1CD    WUAGCD           GN Genetic Code
     C                     MOVELWUJTTX    WUBBTX           Pen Description
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Genetic Code USR NE PAR.GN Genetic Code
     C           WUA1CD    IFNE WUAGCD                     *IF
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL'MIXED'   WUBBTX           Pen Description
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSTG     READE@A2CPKE                  90*
     C                     ENDDO
      *================================================================
     CSR         TGEXIT    ENDSR
      /EJECT
     CSR         THRVGN    BEGSR
      *================================================================
      * Rtv Tattoo GENETICS - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A1HMNB    WQTH01           BOH Company Num
     C           *LIKE     DEFN A1BNNB    WQTH02           BOH Buy Order N
     C           *LIKE     DEFN A1BONB    WQTH03           BOL Load Number
     C           *LIKE     DEFN A1CVNB    WQTH04           TH Tattoo Numbe
      * Define keylist
     C           KRSTH     KLIST
     C                     KFLD           WQTH01           BOH Company Num
     C                     KFLD           WQTH02           BOH Buy Order N
     C                     KFLD           WQTH03           BOL Load Number
     C                     KFLD           WQTH04           TH Tattoo Numbe
      * Setup key
     C                     Z-ADDWAHMNB    WQTH01           BOH Company Num
     C                     Z-ADDWABNNB    WQTH02           BOH Buy Order N
     C                     Z-ADDWABONB    WQTH03           BOL Load Number
     C                     Z-ADDWACVNB    WQTH04           TH Tattoo Numbe
      * Establish starting position
     C           KRSTH     SETLL@A1CPC4                    *
     C           KRSTH     READE@A1CPC4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUA1CD           GN Genetic Code
     C                     MOVEL*BLANK    WUJTTX           Pen Description
     C                     GOTO THEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA1AGCD    WUA1CD           GN Genetic Code
      * Rtv Genetic Record    RT - Genetic  * 
     C                     EXSR TIRVGN
     C           KRSTH     READE@A1CPC4                  90*
     C                     ENDDO
      *================================================================
     CSR         THEXIT    ENDSR
      /EJECT
     CSR         TIRVGN    BEGSR
      *================================================================
      * Rtv Genetic Record    RT - Genetic  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTI     KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Setup key
     C                     MOVELA1AGCD    AIAGCD           GN Genetic Code
      * Establish starting position
     C           KRSTI     CHAIN@AIREA9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0021' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUJTTX           GN Description
     C                     GOTO TIEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAIAWTX    WUJTTX           GN Description
     C                     ENDIF
      *================================================================
     CSR         TIEXIT    ENDSR
      /EJECT
     CSR         TJCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0067  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0068  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0069  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0070  1        Pen Sts
     C                     Z-ADD*ZERO     WN0071  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0072  1        Pen Type
     C                     Z-ADD*ZERO     WN0073  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0074 10        RS User Changed
     C                     Z-ADD*ZERO     WN0075  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0076  60       RS Time Changed
     C                     MOVEL*BLANK    WN0077  1        RS Record Statu
     C                     MOVEL*BLANK    WN0078 10        RS Job
     C                     MOVEL*BLANK    WN0079 10        RS Program
     C                     MOVEL*BLANK    WN0080 10        RS User Added
     C                     Z-ADD*ZERO     WN0081  70       RS Date Added
     C                     Z-ADD*ZERO     WN0082  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YKRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HVNB    WFHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WFCMCD    P      Pen Number
      *
     C           KLCHTJ    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTJ    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKA3REL0'MDACP
     C                     MOVEL'@A3REDC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL012.
     C                     MOVEL'LBL012'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO TJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TJEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YKRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX    P      Pen Description
     C                     MOVELWUAGCD    WFAGCD    P      GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YKRDCS
     C           YKRDC     ANDNE'N'
     C                     MOVE 'Y'       YKRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YKRDCS
     C           YKRDC     ANDNE'N'
     C                     MOVE 'Y'       YKRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YKRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         TJEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * S00275 RMC 6/04/08 Get next drive card seq from Company Value:HPE
      * E4154 JJH 07/22/15 - Pen Revisions
      * - Display Pending Head which is the sum of un-printed Scale Ticke
      * - Change the Descriptions of Open and Closed to Opn and Cls
      * - Move Pen Max Capacity to the right side of Pending Head
      * H16853 ISE 11/02/20 - Increased the Buy Order Number field
      *   from 5 to 7.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD13        ZHSTRW  40
     C                     Z-ADD20        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
     C                     END
      *
     C           ZHCSRW    IFEQ 012
     C           ZHCSCL    ANDEQ046
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#2FWST'  YPMTFD           Pen Type
     C                     END
      *
     C           ZHCSRW    IFEQ 012
     C           ZHCSCL    ANDEQ079
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#2AJST'  YPMTFD           RS Record Statu
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM 'PKGGDFRH'W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Reclaim resources of called programs
     C                     CALL 'Y2RCRSC'
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P1HVNB           Pen Company Num
     C                     MOVEL*BLANK    P1CMCD           Pen Number
     C                     MOVEL*BLANK    P1BBTX           Pen Description
     C                     Z-ADD*ZERO     P1CTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     P1D6NB           Pen Current Hea
     C                     Z-ADD*ZERO     P1B6CD           Pen Current Dri
     C                     MOVEL*BLANK    P1DGST           Pen Sts
     C                     Z-ADD*ZERO     P1EBNB           Pen Drive Seque
     C                     MOVEL*BLANK    P1AGCD           GN Genetic Code
     C                     MOVEL*BLANK    P2ETTX           PRT Description
     C                     MOVEL*BLANK    P2ACVN           PRT Printer Dev
     C                     MOVEL*BLANK    P2AKST           PRT Hold Output
     C                     MOVEL*BLANK    P2AMST           PRT Save Output
     C                     Z-ADD*ZERO     P2AKNB           PRT Copies
     C                     MOVEL*BLANK    P2ALST           PRT Night Queue
     C                     MOVEL*BLANK    P2AIVN           PRT Night Queue
     C                     MOVEL*BLANK    P2C7CD           Oms Application
     C                     MOVEL*BLANK    P3J8NB           Oms Warehouse C
     C                     Z-ADD*ZERO     P3HONB           CC Company Numb
     C                     MOVEL*BLANK    P3C8CD           Oms SalesPerson
     C                     MOVEL*BLANK    P3G8ST           Oms Allow Multi
     C                     MOVEL*BLANK    P3G9ST           Oms Default Pri
     C                     MOVEL*BLANK    P3EUTX           Oms Name
     C                     MOVEL*BLANK    P3EVTX           Oms System Valu
     C                     MOVEL*BLANK    P3HAST           Oms Access Deni
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field First Time Flag Usr
     C                     MOVEL*BLANK    WUHBST  1
      * Define work field Blank USR
     C                     MOVEL*BLANK    WUCRTX 80
      * Define work field Pen Company Number
     C                     Z-ADD*ZERO     WUHVNB  30
      * Define work field Display Print Prompt  Usr
     C                     MOVEL*BLANK    WUHJST  1
      * Define work field Invalid Y/N USR
     C                     MOVEL*BLANK    WUG3ST  1
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Tattoo 1              USR
     C                     MOVEL*BLANK    WUTT1U  4
      * Define work field Tattoo 2              USR
     C                     MOVEL*BLANK    WUTT2U  4
      * Define work field Tattoo 3              USR
     C                     MOVEL*BLANK    WUTT3U  4
      * Define work field Tattoo 4              USR
     C                     MOVEL*BLANK    WUTT4U  4
      * Define work field tattoo 5              USR
     C                     MOVEL*BLANK    WUNJNB  4
      * Define work field @Status +/-
     C                     MOVEL*BLANK    WUI8ST  1
      * Define work field BOL Truck Scale Weigh Sts
     C                     MOVEL*BLANK    WUPAST  1
      * Define work field Count USR
     C                     Z-ADD*ZERO     WUP0NB  30
      * Define work field Tattoo Nbr 4          USR
     C                     Z-ADD*ZERO     WUMLNB  40
      * Define work field TH Shift Held Over
     C                     MOVEL*BLANK    WULJST  1
      * Define work field TH Shift Held Over Head
     C                     Z-ADD*ZERO     WUT2HD  50
      * Define work field #Num USR
     C                     Z-ADD*ZERO     WUH5NB  10
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WAC2NB           TD Sequence Num
     C                     Z-ADD*ZERO     WACZNB           TD Live Wgt
     C                     Z-ADD*ZERO     WAC0NB           TD Pen Head
     C                     Z-ADD*ZERO     WAD8NB           TD Yard Dead
     C                     Z-ADD*ZERO     WAH7NB           TD Held Over
     C                     Z-ADD*ZERO     WAAJTM           TD Drive Time
     C                     Z-ADD*ZERO     WAJEA1           TD Drive Hour
     C                     Z-ADD*ZERO     WAB7CD           TD Drive Card N
     C                     Z-ADD*ZERO     WAD7NB           TD Avg Live Wgt
     C                     Z-ADD*ZERO     WABVDT           TD User Date 1
     C                     Z-ADD*ZERO     WABWDT           TD User Date 2
     C                     Z-ADD*ZERO     WABXDT           TD Drive Date
     C                     Z-ADD*ZERO     WAHVNB           Pen Company Num
     C                     Z-ADD*ZERO     WAH8NB           Held Over Pen C
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field Record Status Usr
     C                     MOVEL*BLANK    WUBRSS  1
      * Define work field Return Code USR
     C                     MOVEL*BLANK    WULMST  7
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHONB           CC Company Numb
     C                     Z-ADD*ZERO     WBBSNB           Next Buy Order
     C                     Z-ADD*ZERO     WBB1DT           Current Kill Da
     C                     Z-ADD*ZERO     WBB2DT           Next Kill Date
     C                     Z-ADD*ZERO     WBH4NB           Last Drive Card
     C                     Z-ADD*ZERO     WBK3NB           Last Tattoo Nbr
     C                     Z-ADD*ZERO     WBCDDT           Current Product
     C                     Z-ADD*ZERO     WBCEDT           Next Production
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHVNB           Pen Company Num
     C                     Z-ADD*ZERO     WCKYNB           DCW Sequence Nu
     C                     Z-ADD*ZERO     WCCCDT           DCW Purchase Da
     C                     Z-ADD*ZERO     WCKZNB           DCW Tattoo Numb
     C                     Z-ADD*ZERO     WCK0NB           DCW Pen Head
     C                     Z-ADD*ZERO     WCK1NB           DCW Drive Card
     C                     Z-ADD*ZERO     WCDODT           DCW Kill Date
      * Define work field DCW Sequence Number
     C                     Z-ADD*ZERO     WUKYNB  50
      * Define work field TH Purchase Date
     C                     Z-ADD*ZERO     WUAWDT  70
      * Define work field DCW Pen Head
     C                     Z-ADD*ZERO     WUK0NB  50
      * Define work field Pen Drive Sequence
     C                     Z-ADD*ZERO     WUEBNB  30
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFHVNB           Pen Company Num
     C                     Z-ADD*ZERO     WFCTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WFD6NB           Pen Current Hea
     C                     Z-ADD*ZERO     WFB6CD           Pen Current Dri
     C                     Z-ADD*ZERO     WFEBNB           Pen Drive Seque
     C                     Z-ADD*ZERO     WFHBNB           Pen Adjustment
     C                     Z-ADD*ZERO     WFAADT           RS Date Changed
     C                     Z-ADD*ZERO     WFAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WFABDT           RS Date Added
     C                     Z-ADD*ZERO     WFABTM           RS Time Added
      * Define work field Zero USR
     C                     Z-ADD*ZERO     WUE9NB  10
      * Define work field TDP Process Code
     C                     MOVEL*BLANK    WUB9CD  6
      * Define work field TD Live Wgt
     C                     Z-ADD*ZERO     WUCZNB  71
      * Define work field TD Pen Head
     C                     Z-ADD*ZERO     WUC0NB  50
      * Define work field TD Held Over Status
     C                     MOVEL*BLANK    WUGGST  1
      * Define work field Pen Current Drive Card No
     C                     Z-ADD*ZERO     WUB6CD  30
      * Define work field Pen Sts
     C                     MOVEL*BLANK    WUDGST  1
      * Define work field Pen Adjustment
     C                     Z-ADD*ZERO     WUHBNB  50
      * Define work field Pen Description
     C                     MOVEL*BLANK    WUBBTX 25
      * Define work field GN Genetic Code
     C                     MOVEL*BLANK    WUAGCD  5
      * Define work field Pen Current Head
     C                     Z-ADD*ZERO     WUD6NB  50
      * Define work field Genetic Code USR
     C                     MOVEL*BLANK    WUA1CD  5
      * Define work field Pen Desc              USR
     C                     MOVEL*BLANK    WUJTTX 25
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define null work field Pen Exceeds Max Cap USR
     C                     MOVEL*BLANK    YN0001  1
      * Define local work field System Value Numeric  USR
     C                     Z-ADD*ZERO     YL0001 155
      * Define local work field System Value Alpha    USR
     C                     MOVEL*BLANK    YL0002 40
      * Define local work field PRT Printer Device
     C                     MOVEL*BLANK    YL0003 10
      * Define local work field TD Drive Hour
     C                     Z-ADD*ZERO     YL0004  20
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
     C                     Z-ADD08        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * Val Application/User  IF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           P3J8NB    PARM *BLANK    WQ0043  3        Oms Warehouse C
     C           WUHVNB    PARM *ZERO     WQ0044  30       CC Company Numb
     C                     PARM 'HPE'     WQ0045  6        Oms Application
     C           P3C8CD    PARM *BLANK    WQ0046  3        Oms SalesPerson
     C           P3G8ST    PARM *BLANK    WQ0047  1        Oms Allow Multi
     C           P3G9ST    PARM *BLANK    WQ0048 10        Oms Default Pri
     C           P3EUTX    PARM *BLANK    WQ0049 30        Oms Name
     C           P3EVTX    PARM *BLANK    WQ0050 40        Oms System Valu
     C           P3HAST    PARM *BLANK    WQ0051  1        Oms Access Deni
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P3HAST    IFEQ 'Y'                        *IF
      * Send message 'Access Denied for User'
     C                     MOVEL'PRK0298' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP3EVTX    ##CMP
     C                     END                             *FI
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P3HAST    IFEQ 'Y'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Print Pen Avail. List
00002 STKNOTP
00003 HPEDRVSEQ
00004 HPEDRVCRD
00005 PKOZPFR$
