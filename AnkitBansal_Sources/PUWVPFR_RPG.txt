     H/TITLE PRT COA HUG one Batch  PF Print file
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H* - Print report of file contents
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Print file
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 09/05/22  Time  : 09:03:19
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMCDCPL3  IF   E           K DISK
      * RSQ : COA Batch Detail          Co/ULSD/Btc/Seq/Test/Pro
      *
     FPMCCCPL1  IF   E           K DISK
      * RTV : COA Batch Header          Retrieval index
      *
     FPMCAREL1  IF   E           K DISK
      * RTV : COA Property Define Hdr   Retrieval index
      *
     FCAADREL3  IF   E           K DISK
      * RTV : Warehouse Codes           Active records only
      *
     FPNGHCPL1  IF   E           K DISK
      * RTV : COA Batch Header Ext      Retrieval index
      *
     FPUWVPFR$  O    E             PRINTER OFLIND(*IN97)
     F                                     INFDS(INFDS$)
      * PRT: PRT COA HUG one Batch  PF Print file
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D INFDS$        E DS                  EXTNAME(Y2I$DSP)
      * Printer file information data structure
      *
      /EJECT
     D XDINT           DS
      * Internal date
     D  XDINDT                 1      7  0
     D  XDINYY                 1      3  0
     D  XDINMM                 4      5  0
     D  XDINDD                 6      7  0
      /EJECT
     D XDEX            DS
      * External date
     D  XDEXDT                 1      8  0
     D  XDEY01                 1      4  0
     D  XDEX01                 1      2  0
     D  XDEX02                 3      4  0
     D  XDEY02                 5      8  0
     D  XDEX03                 5      6  0
     D  XDEX04                 7      8  0
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              3  0
     D  WP0002         S              4
     D  WP0003         S              5  0
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  W0PFM          S              1
     D  @$WRK          S              4  0
     D  @$HDL          S              4  0
     D  W0PGL          S              4  0
     D  W0OFL          S              4  0
     D  W0NEWP         S              1
     D  YL0001         S              1
     D  W0FSUM         S                   LIKE(@$CLN)
     D  W0DTLN         S                   LIKE(@$CLN)
     D  W0COLN         S                   LIKE(@$CLN)
     D  WQKA01         S                   LIKE(CDAIC3)
     D  WQKA02         S                   LIKE(CDL6T1)
     D  WQKA03         S                   LIKE(CDI3NY)
     D  W0AL1P         S              1
     D  W0AL00         S              1
     D  W0AL01         S              1
     D  W0AL02         S              1
     D  W0AL03         S              1
     D  W0AL04         S              1
     D  W0AL05         S              1
     D  W0AP1P         S              1
     D  W0AP00         S              1
     D  W0AP01         S              1
     D  W0AP02         S              1
     D  YL0002         S              6
     D  YL0003         S             25
     D  XDDTFM         S              3
     D  W0AP03         S              1
     D  W0AP04         S              1
     D  W0AP05         S              1
     D  YL0004         S              5  0
     D  W0APDT         S              1
     D  W0ACDT         S              1
     D  ZQ             S              5  0
     D  WZA001         S                   LIKE(CDAIC3)
     D  WZA002         S                   LIKE(CDL6T1)
     D  WZA003         S                   LIKE(CDI3NY)
     D  WZA004         S                   LIKE(CDI2NY)
     D  WZA005         S                   LIKE(CDRRU1)
     D  WZA006         S                   LIKE(CDMDT1)
     D  W0EOFA         S              1
     D  ZZFFL          S             10
     D  ZZFLB          S             10
     D  ZZFMB          S             10
     D  @1FFL          S             10
     D  @1FLB          S             10
     D  @1FMB          S             10
     D  ZZFQL          S             21
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * FLD: COA Batch Detail
      * I : RST Company Number
     D  P1AIC3                 1      2P 0
      * I : RST COA ULSD Company #
     D  P1L6T1                 3      6
      * I : RST COA Batch Number
     D  P1I3NY                 7      9P 0
     D P2PARM          DS
      * N :  FAX DTL Status 1
     D  P2TCSX                 1      1
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1AIC3        PARM                    WP0001                         Company Number
     C     P1L6T1        PARM                    WP0002                         COA ULSD Compan
     C     P1I3NY        PARM                    WP0003                         COA Batch Numbe
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * PRT COA HUG one Batch  PF: Mainline
     C                   EXSR      A0MAIN
      * Print headers then End of report format
     C                   EXSR      Q0PRNT
     C                   WRITE     $FENDRPT
      * Exit program
     C                   EXSR      ZXEXPG
      * ------------------------------------------------------
      /EJECT
     CSR   A0MAIN        BEGSR
      *================================================================
      * PRT COA HUG one Batch  PF: Mainline
      *================================================================
      * Declare restrictor key work fields
      * Define keylist
     C     KRSA          KLIST
     C                   KFLD                    WQKA01                         Company Number
     C                   KFLD                    WQKA02                         COA ULSD Compan
     C                   KFLD                    WQKA03                         COA Batch Numbe
      * Setup key
     C                   Z-ADD     P1AIC3        WQKA01                         Company Number
     C                   MOVEL     P1L6T1        WQKA02                         COA ULSD Compan
     C                   Z-ADD     P1I3NY        WQKA03                         COA Batch Numbe
      * Establish starting position
     C     KRSA          SETLL     @CDCPJ2                                      *
      * Read first record with user selection
     C                   EXSR      A3READ
     C                   IF        W0EOFA <> '0'
     C                   ELSE
      * Request all headings
     C                   MOVEL     'Y'           W0AL1P                         First page
     C                   MOVEL     'Y'           W0AL00                         Company Number
     C                   MOVEL     'Y'           W0AL01                         COA ULSD Compan
     C                   MOVEL     'Y'           W0AL02                         COA Batch Numbe
     C                   MOVEL     'Y'           W0AL03                         COA Print Seque
     C                   MOVEL     'Y'           W0AL04                         COA Test
     C                   MOVEL     'Y'           W0AL05                         COA Property
      * Set column headings flag
     C                   MOVE      'Y'           W0ACDT
      * Print report body
      * Prepare heading formats for printing
     C                   DOW       W0EOFA = '0'
     C                   EXSR      A1PHDR
      * Print report detail line
     C                   EXSR      A2PDTL
      * Read next record with user selection
     C                   EXSR      A3READ
      * Print totals
     C                   EXSR      A4PTOT
     C                   END                                                    WOD
     C                   END                                                    FI
      *================================================================
     CSR   A0EXIT        ENDSR
      /EJECT
     CSR   A1PHDR        BEGSR
      *================================================================
      * Prepare heading formats for printing
      *================================================================
      * Load related totals format
     C                   IF        W0AL1P = 'Y'
     C                   EVAL      $EWYT1 = ' '                                 COA Reviewed By
     C                   EVAL      $EWXT1 = ' '                                 COA Reviewed By
     C                   EVAL      $ESHTX = ' '                                 Text USR 40
      * Signal that format is now ready to print
     C                   MOVE      'Y'           W0AP1P
     C                   END
      *
      * Signal that format is now ready to print
     C                   IF        W0AL00 = 'Y'
     C                   MOVE      'Y'           W0AP00
     C                   END
      *
      * Signal that format is now ready to print
     C                   IF        W0AL01 = 'Y'
     C                   MOVE      'Y'           W0AP01
     C                   END
      *
      * Load key header format
     C                   IF        W0AL02 = 'Y'
     C                   EVAL      $BXMTX = ' '                                 Text USR 12
     C                   Z-ADD     *ZERO         $BTUDT                         COA Sample Date
     C                   Z-ADD     *ZERO         $BDSTM                         COA Sample Time
     C                   Z-ADD     CDAIC3        $BAIC3                         Company Number
     C                   EVAL      $BYPTX = ' '                                 Generic Heading
     C                   EVAL      $BWZT1 = ' '                                 COA LIMS ID
     C                   EVAL      $BR2NA = ' '                                 COA Bio-dsl Fue
     C                   EVAL      $BIKAA = ' '                                 COA Active Whse
     C                   EVAL      $BF8NA = ' '                                 Warehouse Descr
     C                   EVAL      $BMIT1 = ' '                                 COA Specificati
     C                   Z-ADD     CDI3NY        $BI3NY                         COA Batch Numbe
     C                   Z-ADD     *ZERO         $BBQDT                         USR Date - ATR
     C                   EVAL      $BNITX = ' '                                 @Blank for 7
     C                   EVAL      $BKGTX = ' '                                 @Blank for 5
     C                   EVAL      $BADTX = ' '                                 Name
     C                   EVAL      $BO7TX = ' '                                 @Text 8
     C                   EVAL      $BGNNA = ' '                                 USR Compressed
     C                   EVAL      $BGONA = ' '                                 USR Compressed
     C                   EVAL      $BHLTX = ' '                                 Condition Desc.
     C                   EVAL      $BL2T1 = ' '                                 COA Producer Re
     C                   EVAL      $BNLTX = ' '                                 USR 15 Text
     C                   EVAL      $BL3T1 = ' '                                 COA Employer ID
     C                   EVAL      $BD3T1 = ' '                                 Text 35 USR
     C                   EVAL      $BEET1 = ' '                                 Description 21A
     C                   MOVEL     CDL6T1        $BL6T1                         COA ULSD Compan
     C                   EVAL      $BL7T1 = ' '                                 COA ULSD Facili
     C                   EVAL      $BKNTX = ' '                                 @Blank for 6
     C                   EVAL      $BGPNA = ' '                                 USR Compressed
     C                   EVAL      $BMJT1 = ' '                                 COA RFS Program
     C                   Z-ADD     CDI2NY        $BI2NY                         COA Print Seque
      * Load related totals format
     C                   Z-ADD     CDAIC3        $DAIC3                         Company Number
     C                   Z-ADD     CDI3NY        $DI3NY                         COA Batch Numbe
      * Signal that format is now ready to print
     C                   MOVE      'Y'           W0AP02
     C                   END
      *
      * USER: Process before print of COA Print Sequence format
      * Signal that format is now ready to print
     C                   IF        W0AL03 = 'Y'
     C                   MOVE      'Y'           W0AP03
     C                   END
      *
      * Signal that format is now ready to print
     C                   IF        W0AL04 = 'Y'
     C                   MOVE      'Y'           W0AP04
     C                   END
      *
      * Signal that format is now ready to print
     C                   IF        W0AL05 = 'Y'
     C                   MOVE      'Y'           W0AP05
     C                   END
      *
      *================================================================
     CSR   A1EXIT        ENDSR
      /EJECT
     CSR   A2PDTL        BEGSR
      *================================================================
      * Process detail record
      *================================================================
      * Load details format
     C                   Z-ADD     CDAIC3        $CAIC3                         Company Number
     C                   MOVEL     CDL6T1        $CL6T1                         COA ULSD Compan
     C                   Z-ADD     CDI3NY        $CI3NY                         COA Batch Numbe
     C                   MOVEL     CDRRU1        $CRRU1                         COA Test
     C                   EVAL      $CRTU1 = ' '                                 COA Test & Prop
     C                   MOVEL     CDMDT1        $CMDT1                         COA Property
     C                   MOVEL     CDMET1        $CMET1                         COA Test Method
     C                   MOVEL     CDMGT1        $CMGT1                         COA Limit
     C                   MOVEL     CDRSU1        $CRSU1                         COA Limit Max
     C                   Z-ADD     CDH5VL        $CH5VL                         COA Property Va
     C                   MOVEL     CDMCT1        $CMCT1                         COA Fuel Desc2/
     C                   MOVEL     CDMFT1        $CMFT1                         COA Unit of Mea
     C                   Z-ADD     CDI2NY        $CI2NY                         COA Print Seque
     C                   MOVEL     CDIBAA        $CIBAA                         COA OMS Item Co
     C                   Z-ADD     CDI1NY        $CI1NY                         Sold To Custome
     C                   MOVEL     CDHCTU        $CHCTU                         COA Footnote In
     C                   MOVEL     CDVSST        $CVSST                         Record Status
     C                   Z-ADD     CDMJDT        $CMJDT                         Create Date
     C                   Z-ADD     CDBETM        $CBETM                         Create Time
     C                   MOVEL     CDCCVN        $CCCVN                         Create User
     C                   MOVEL     CDCDVN        $CCDVN                         Create Program
     C                   Z-ADD     CDMKDT        $CMKDT                         Change Date
     C                   Z-ADD     CDBFTM        $CBFTM                         Change Time
     C                   MOVEL     CDCEVN        $CCEVN                         Change User
     C                   MOVEL     CDCFVN        $CCFVN                         Change Program
      * USER: Process before print of detail format
      * New for print seq not being page - OF after 45 props printed
      * CASE: LCL.Count USR is GT 44
      * CASE: LCL.First Time Flag is Yes
     C                   IF        YL0004 > 44
     C                   IF        YL0001 = 'Y'
     C                   MOVEL     'Y'           W0NEWP                         *new page flag
     C                   MOVEL     'N'           YL0001                         First Time Flag
     C                   ELSE
      * CASE: *OTHERWISE
     C                   EVAL      W0NEWP = ' '                                 *new page flag
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Signal that format is now ready to print
     C                   MOVE      'Y'           W0APDT
      * Call print routine
     C                   EXSR      Q0PRNT
      *
      *================================================================
     CSR   A2EXIT        ENDSR
      /EJECT
     CSR   A3READ        BEGSR
      *================================================================
      * Read next record
      *================================================================
      * Hold current values
     C                   Z-ADD     CDAIC3        WZA001
     C                   MOVEL     CDL6T1        WZA002
     C                   Z-ADD     CDI3NY        WZA003
     C                   Z-ADD     CDI2NY        WZA004
     C                   MOVEL     CDRRU1        WZA005
     C                   MOVEL     CDMDT1        WZA006
      * Read next record
     C                   DOU       W0RSL = 'Y' OR
     C                             W0EOFA = '1'
     C     KRSA          READE     @CDCPJ2                                90    *
      * Transfer error indicator to EOF flag
     C                   MOVEL     *IN90         W0EOFA
      * Quit if no record read
      * Select record unless user action states otherwise
     C                   IF        W0EOFA <> '1'
     C                   MOVEL     'Y'           W0RSL
      * USER: Record selection processing
      * CASE: DB1.Record Status is Active
     C                   IF        CDVSST = 'A'
     C                   ELSE
      * CASE: *OTHERWISE
     C                   MOVEL     'N'           W0RSL                          *Record selecte
     C                   END                                                    *FI
     C                   END                                                    FI
     C                   END                                                    UOD
      *
      * Reset key level breaks
     C                   EVAL      W0AL00 = ' '                                 Company Number
     C                   EVAL      W0AL01 = ' '                                 COA ULSD Compan
     C                   EVAL      W0AL02 = ' '                                 COA Batch Numbe
     C                   EVAL      W0AL03 = ' '                                 COA Print Seque
     C                   EVAL      W0AL04 = ' '                                 COA Test
     C                   EVAL      W0AL05 = ' '                                 COA Property
      * End of file - Signal all level breaks
     C                   IF        W0EOFA = '1'
     C                   MOVEL     'Y'           W0AL00                         Company Number
     C                   MOVEL     'Y'           W0AL01                         COA ULSD Compan
     C                   MOVEL     'Y'           W0AL02                         COA Batch Numbe
     C                   MOVEL     'Y'           W0AL03                         COA Print Seque
     C                   MOVEL     'Y'           W0AL04                         COA Test
     C                   MOVEL     'Y'           W0AL05                         COA Property
     C                   ELSE
      * Next record - Detect level breaks
      * Set on level break indicator
     C                   IF        CDAIC3 <> WZA001
     C                   MOVEL     'Y'           W0AL00
     C                   END
      * Set on level break indicator
     C                   IF        CDL6T1 <> WZA002 OR
     C                             W0AL00 = 'Y'
     C                   MOVEL     'Y'           W0AL01
     C                   END
      * Set on level break indicator
     C                   IF        CDI3NY <> WZA003 OR
     C                             W0AL01 = 'Y'
     C                   MOVEL     'Y'           W0AL02
     C                   END
      * Set on level break indicator
     C                   IF        CDI2NY <> WZA004 OR
     C                             W0AL02 = 'Y'
     C                   MOVEL     'Y'           W0AL03
     C                   END
      * Set on level break indicator
     C                   IF        CDRRU1 <> WZA005 OR
     C                             W0AL03 = 'Y'
     C                   MOVEL     'Y'           W0AL04
     C                   END
      * Set on level break indicator
     C                   IF        CDMDT1 <> WZA006 OR
     C                             W0AL04 = 'Y'
     C                   MOVEL     'Y'           W0AL05
     C                   END
     C                   END
      *================================================================
     CSR   A3EXIT        ENDSR
      /EJECT
     CSR   A4PTOT        BEGSR
      *================================================================
      * Print report Totals
      *================================================================
      * Print level break totals as required
      * Signal header format is no longer ready
     C                   IF        W0AL05 = 'Y'
     C                   EVAL      W0AP05 = ' '
     C                   END
      *
      * Signal header format is no longer ready
     C                   IF        W0AL04 = 'Y'
     C                   EVAL      W0AP04 = ' '
     C                   END
      *
      * Signal header format is no longer ready
     C                   IF        W0AL03 = 'Y'
     C                   EVAL      W0AP03 = ' '
     C                   END
      *
      * If there is not enough space on the
      * physical page for this format:
     C                   IF        W0AL02 = 'Y'
     C     @$PGL         SUB       @$CLN         @$WRK
      * Signal new page required
     C                   IF        @$WRK <= 1
     C                   MOVE      'Y'           W0NEWP
      * Start new page
     C                   EXSR      Q0PRNT
     C                   END
      * Print format
     C                   WRITE     $DKEYTTL
      * Signal header format is no longer ready
     C                   EVAL      W0AP02 = ' '
     C                   END
      *
      * Signal header format is no longer ready
     C                   IF        W0AL01 = 'Y'
     C                   EVAL      W0AP01 = ' '
     C                   END
      *
      * Signal header format is no longer ready
     C                   IF        W0AL00 = 'Y'
     C                   EVAL      W0AP00 = ' '
     C                   END
      *
     C                   IF        W0EOFA = '1'
     C                   MOVEL     'Y'           W0PFM
      * USER: On print of final totals format
     C                   MOVEL     YL0003        $EWYT1                         COA Reviewed By
      * Rtv Reviewed By Title RT - COA Batch Header Ext  * 
     C                   EXSR      SDRVGN
      * If we are already passed the nominated
      * Start line for this format
     C                   IF        W0PFM = 'Y'
      * Signal new page required
     C                   IF        @$CLN >= 82
     C                   MOVE      'Y'           W0NEWP
      * Start new page
     C                   EXSR      Q0PRNT
     C                   END
      * Print format
     C                   WRITE     $EFINTTL
     C                   END
     C                   END
      *
      *================================================================
     CSR   A4EXIT        ENDSR
      /EJECT
     CSR   Q0PRNT        BEGSR
      *================================================================
      * Print report formats
      *================================================================
      * Select formats to print
     C                   EXSR      Q1FSEL
      * Calculate length of formats selected for printing
     C                   EXSR      Q2PLEN
      * Add column heading length to print length
     C                   ADD       W0COLN        W0FSUM
      * Signal overflow if requested headings would cause
      * detail format to start past the overflow line
     C                   IF        W0NEWP <> 'Y'
     C                   IF        W0FSUM > W0OFL
     C                   MOVE      'Y'           W0NEWP
     C                   ELSE
      * Signal overflow if requested headings would cause
      * Detail format to be printed past end of page
     C                   ADD       W0DTLN        W0FSUM
     C                   IF        W0FSUM > W0PGL
     C                   MOVE      'Y'           W0NEWP
     C                   END
     C                   END
     C                   END
      * Print Standard report header of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
     C                   IF        W0NEWP = 'Y'
     C                   EXSR      Q3PTNP
     C                   END                                                    FI
      *
      * Print First Page Format of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP1P = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP1P = 'P'
     C                   EVALR     W0AP1P = ' '
      * Clear first page flag.
     C                   EVALR     W0AL1P = ' '
     C                   END                                                    FI
      * Print Company Number of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP00 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP00 = 'P'
     C                   EVALR     W0AP00 = ' '
     C                   END                                                    FI
      * Print COA ULSD Company # of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP01 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP01 = 'P'
     C                   EVALR     W0AP01 = ' '
     C                   END                                                    FI
      * Print COA Batch Number of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C                   IF        W0AP02 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP02 = 'P'
     C                   MOVEL     'Y'           W0PFM
      * USER: On print of COA Batch Number format
      * Rtv COA HUG Info      RT - COA Batch Header  * 
     C                   EXSR      SARVGN
      * RTV Description        RT - COA Property Define Hdr  * 
     C                   EXSR      SBRVGN
      * RTV Whse Descrip       RT - Warehouse Codes  * 
     C                   EXSR      SCRVGN
      * Convert fields to external form
      * Convert COA Sample Date to display format
      * Convert date
     C                   IF        W0PFM = 'Y'
     C     1000000       ADD       $BTUDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VBTUDT
      * If we are already passed the nominated
      * Start line for this format
     C                   IF        @$CLN >= 10
     C                   EXSR      Q3PTNP
     C                   END
      * Print format
     C                   WRITE     $BKEYHDR
      * Set column headings flag
     C                   MOVE      'Y'           W0ACDT
     C                   END                                                    FI
      *
      * Reset format print flag
     C                   MOVE      'P'           W0AP02
     C                   END                                                    FI
      * Print COA Print Sequence of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP03 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP03 = 'P'
     C                   EVALR     W0AP03 = ' '
     C                   END                                                    FI
      * Print COA Test of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP04 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP04 = 'P'
     C                   EVALR     W0AP04 = ' '
     C                   END                                                    FI
      * Print COA Property of PRT COA HUG one Batch  PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
      * Reset format print flag
     C                   IF        W0AP05 = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0AP05 = 'P'
     C                   EVALR     W0AP05 = ' '
     C                   END                                                    FI
      * Print Detail line. of PRT COA HUG one Batch  PF
      * If new page then set column headings active
     C                   IF        W0NEWP = 'Y'
     C                   MOVE      'Y'           W0ACDT
     C                   END
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C                   IF        W0APDT = 'Y' OR
     C                             W0NEWP = 'Y' AND
     C                             W0APDT = 'P'
     C                   MOVEL     'Y'           W0PFM
      * USER: On print of detail format
     C                   Z-ADD     2             ZQ
     C     $CRRU1        CAT(P)    $CMDT1:ZQ     $CRTU1                         COA Test & Prop
     C                   ADD       1             YL0004                         Count USR
      * Print column headings if required
     C                   IF        W0PFM = 'Y'
     C                   IF        W0ACDT = 'Y'
     C                   WRITE     $CCOLHDG
      * Clear column headings control flag
     C                   EVALR     W0ACDT = ' '
     C                   END                                                    FI
      * Print format
     C                   WRITE     $CDTLRCD
     C                   END                                                    FI
      *
      * Reset format print flag
     C                   EVALR     W0APDT = ' '
     C                   END                                                    FI
      * Clear new page flag
     C                   EVALR     W0NEWP = ' '
      *================================================================
     CSR   Q0EXIT        ENDSR
      /EJECT
     CSR   Q1FSEL        BEGSR
      *================================================================
      * Format select
      *================================================================
      *================================================================
     CSR   Q1EXIT        ENDSR
      /EJECT
     CSR   Q2PLEN        BEGSR
      *================================================================
      * Evaluate print length
      *================================================================
     C                   Z-ADD     @$CLN         W0FSUM
     C                   Z-ADD     *ZERO         W0DTLN
     C                   Z-ADD     *ZERO         W0COLN
      * * First Page Format of PRT COA HUG one Batch  PF
     C                   IF        W0AP1P = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * Company Number of PRT COA HUG one Batch  PF
     C                   IF        W0AP00 = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * COA ULSD Company # of PRT COA HUG one Batch  PF
     C                   IF        W0AP01 = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * COA Batch Number of PRT COA HUG one Batch  PF
     C                   IF        W0AP02 = 'Y'
      * Signal new page required
     C                   IF        W0FSUM > 10
     C                   MOVE      'Y'           W0NEWP
     C                   GOTO      Q2EXIT
     C                   ELSE
     C                   Z-ADD     25            W0FSUM
     C                   END                                                    FI
     C                   END                                                    FI
      *
      * * COA Print Sequence of PRT COA HUG one Batch  PF
     C                   IF        W0AP03 = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * COA Test of PRT COA HUG one Batch  PF
     C                   IF        W0AP04 = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * COA Property of PRT COA HUG one Batch  PF
     C                   IF        W0AP05 = 'Y'
     C                   ADD       0             W0FSUM
     C                   END                                                    FI
      *
      * * Detail line. of PRT COA HUG one Batch  PF
     C                   IF        W0APDT = 'Y'
     C                   Z-ADD     1             W0DTLN
     C                   IF        W0ACDT = 'Y'
     C                   Z-ADD     0             W0COLN
     C                   END                                                    FI
     C                   END                                                    FI
      *
      *================================================================
     CSR   Q2EXIT        ENDSR
      /EJECT
     CSR   Q3PTNP        BEGSR
      *================================================================
      * Format select
      *================================================================
     C                   WRITE     $APAGHDR
      * Clear page overflow indicator
     C                   SETOFF                                       97        *
      *================================================================
     CSR   Q3EXIT        ENDSR
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv COA HUG Info      RT - COA Batch Header  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
      * PAR = CON By name
     C                   EVAL      $BIKAA = ' '                                 COA Active Whse
     C                   EVAL      YL0002 = ' '                                 COA Bio-diesel
     C                   EVAL      $BMIT1 = ' '                                 COA Specificati
     C                   EVAL      $BMJT1 = ' '                                 COA RFS Program
     C                   EVAL      YL0003 = ' '                                 COA Reviewed By
     C                   Z-ADD     *ZERO         $BTUDT                         COA Sample Date
     C                   Z-ADD     *ZERO         $BDSTM                         COA Sample Time
     C                   EVAL      $BWZT1 = ' '                                 COA LIMS ID
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    CCAIC3                         Company Number
     C                   KFLD                    CCL6T1                         COA ULSD Compan
     C                   KFLD                    CCI3NY                         COA Batch Numbe
      * Setup key
     C                   Z-ADD     $BAIC3        CCAIC3                         Company Number
     C                   MOVEL     $BL6T1        CCL6T1                         COA ULSD Compan
     C                   Z-ADD     $BI3NY        CCI3NY                         COA Batch Numbe
      * Establish starting position
     C     KRSSA         CHAIN     @CCCPOH                            90        *
      * Data record not found
     C   90              MOVEL     'USR3803'     W0RTN
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     CCIKAA        $BIKAA                         COA Active Whse
     C                   MOVEL     CCIDAA        YL0002                         COA Bio-diesel
     C                   MOVEL     CCMIT1        $BMIT1                         COA Specificati
     C                   MOVEL     CCMJT1        $BMJT1                         COA RFS Program
     C                   MOVEL     CCWYT1        YL0003                         COA Reviewed By
     C                   Z-ADD     CCTUDT        $BTUDT                         COA Sample Date
     C                   Z-ADD     CCDSTM        $BDSTM                         COA Sample Time
     C                   MOVEL     CCWZT1        $BWZT1                         COA LIMS ID
     C                   ENDIF
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * RTV Description        RT - COA Property Define Hdr  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    CAAIC3                         Company Number
     C                   KFLD                    CAIDAA                         COA Bio-diesel
      * Setup key
     C                   Z-ADD     $BAIC3        CAAIC3                         Company Number
     C                   MOVEL     YL0002        CAIDAA                         COA Bio-diesel
      * Establish starting position
     C     KRSSB         CHAIN     @CAREOB                            90        *
      * Data record not found
     C   90              MOVEL     'USR3799'     W0RTN
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     CAR2NA        $BR2NA                         COA Bio-dsl Fue
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * RTV Whse Descrip       RT - Warehouse Codes  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    ADAJCD                         Warehouse Code
      * Setup key
     C                   MOVEL     $BIKAA        ADAJCD                         Warehouse Code
      * Establish starting position
     C     KRSSC         CHAIN     @ADRET1                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR0007'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
      * PAR = CON By name
     C                   EVAL      $BF8NA = ' '                                 Warehouse Descr
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   IF        NOT *IN90
     C                   MOVEL     ADF8NA        $BF8NA                         Warehouse Descr
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * Rtv Reviewed By Title RT - COA Batch Header Ext  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
      * PAR = CON By name
     C                   EVAL      $EWXT1 = ' '                                 COA Reviewed By
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    GHAIC3                         Company Number
     C                   KFLD                    GHL6T1                         COA ULSD Compan
     C                   KFLD                    GHI3NY                         COA Batch Numbe
     C                   KFLD                    GHR1NY                         COA BH Feedstoc
      * Setup key
     C                   Z-ADD     P1AIC3        GHAIC3                         Company Number
     C                   MOVEL     P1L6T1        GHL6T1                         COA ULSD Compan
     C                   Z-ADD     P1I3NY        GHI3NY                         COA Batch Numbe
     C                   Z-ADD     1             GHR1NY                         COA BH Feedstoc
      * Establish starting position
     C     KRSSD         CHAIN     @GHCPG7                            90        *
      * Data record not found
     C   90              MOVEL     'USR4326'     W0RTN
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     GHWXT1        $EWXT1                         COA Reviewed By
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   XDVC2T        BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                   Z-ADD     0             XDEX01                         CC
     C                   IF        XDDTFM = 'DMY'
     C                   Z-ADD     XDINDD        XDEX02                         DD
     C                   Z-ADD     XDINMM        XDEX03                         MM
     C                   Z-ADD     XDINYY        XDEX04                         YY
     C                   ELSE
     C                   IF        XDDTFM = 'MDY'
     C                   Z-ADD     XDINMM        XDEX02                         MM
     C                   Z-ADD     XDINDD        XDEX03                         DD
     C                   Z-ADD     XDINYY        XDEX04                         YY
     C                   ELSE
      * YMD format
     C                   Z-ADD     XDINYY        XDEX02                         YY
     C                   Z-ADD     XDINMM        XDEX03                         MM
     C                   Z-ADD     XDINDD        XDEX04                         DD
     C                   END
     C                   END
      *================================================================
     CSR   XDVC2E        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program
      *================================================================
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Clear all neither parameters
     C                   EVAL      P2TCSX = ' '                                 FAX DTL Status
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize KEY fields.
     C                   MOVEL     *LOVAL        CDAIC3                         Company Number
     C                   MOVEL     *LOVAL        CDL6T1                         COA ULSD Compan
     C                   MOVEL     *LOVAL        CDI3NY                         COA Batch Numbe
     C                   MOVEL     *LOVAL        CDI2NY                         COA Print Seque
     C                   MOVEL     *LOVAL        CDRRU1                         COA Test
     C                   MOVEL     *LOVAL        CDMDT1                         COA Property
      * Move main file information to JOB context
     C                   MOVE      @1FFL         ZZFFL                          Main file name
     C                   MOVE      @1FLB         ZZFLB                          Main file lib
     C                   MOVE      @1FMB         ZZFMB                          Main file mbr
     C                   MOVE      ZZFFL         @1FFL
     C                   MOVE      ZZFLB         @1FLB
     C                   MOVE      ZZFMB         @1FMB
     C                   CALL      'Y2QLVNR'
     C                   PARM                    ZZFFL
     C                   PARM                    ZZFLB
     C                   PARM                    ZZFQL                          LIBRARY/FILE
     C                   MOVEL     'N'           W0PMT
      * Define local work field First Time Flag
     C                   EVAL      YL0001 = ' '
      * Define local work field COA Bio-diesel Fuel Code
     C                   EVAL      YL0002 = ' '
      * Define local work field COA Reviewed By
     C                   EVAL      YL0003 = ' '
      * Define local work field Count USR
     C                   Z-ADD     *ZERO         YL0004
     C                   EVAL      W0PFM = ' '
     C                   Z-ADD     *ZERO         @$WRK
     C                   Z-ADD     *ZERO         @$HDL
     C                   Z-ADD     *ZERO         @$CLN
     C                   Z-ADD     *ZERO         @$PGN
      * Adjust page length and overflow as necessary
     C     @$PGL         SUB       2             W0PGL
     C                   IF        @$OFL >= W0PGL
     C     W0PGL         SUB       2             W0OFL
     C                   ELSE
     C                   Z-ADD     @$OFL         W0OFL
     C                   END
      * Clear overflow indicator
     C                   SETOFF                                       97
      * Request new page
     C                   MOVEL     'Y'           W0NEWP
      * USER: Initialize program
      * NOTE: Any changes here should consider changing PUWXPFR.
     C                   MOVEL     'Y'           YL0001                         First Time Flag
      * 3/19/12 E2011 RMC dont print addendum
     C                   MOVEL     'N'           P2TCSX                         FAX DTL Status
      * Obtain system date format
     C     *DTAARA       DEFINE    Y2DTFMA       XDDTFM
     C                   IN        XDDTFM
      *================================================================
     CSR   ZZEXIT        ENDSR
