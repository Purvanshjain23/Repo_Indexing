     H/TITLE Payment ProducePostWOEdfx Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1135
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL                     n
     H* System        : HPEDEVMDL
     H* User name     : ISSMASO
     H* Date          : 08/11/06  Time  : 15:10:14
     H* Copyright     : HPEDEVMDL                     n
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKC4REL1IF  E           K        DISK
      * RTV : Payment Processing Parms  Retrieval index
      *
     FPKC4REL0UF  E           K        DISK
      * UPD : Payment Processing Parms  Update index
      *
     I@C4REO7
      * Payment Processing Parms  Retrieval index
      * Renamed input format fields
     I              C4HONB                          WAHONB
     I              C4CKDT                          WACKDT
     I              C4M1NB                          WAM1NB
     I              C4KHST                          WAKHST
     I              C4KJST                          WAKJST
     I              C4PINB                          WAPINB
     I              C4KKST                          WAKKST
     I              C4AAVN                          WAAAVN
     I              C4AADT                          WAAADT
     I              C4AMTM                          WAAMTM
     I              C4AJST                          WAAJST
     I              C4AHVN                          WAAHVN
     I              C4AGVN                          WAAGVN
     I              C4ABVN                          WAABVN
     I              C4ABDT                          WAABDT
     I              C4ABTM                          WAABTM
      *
     I@C4REO6
      * Payment Processing Parms  Update index
      * Renamed input format fields
     I              C4HONB                          WBHONB
     I              C4CKDT                          WBCKDT
     I              C4M1NB                          WBM1NB
     I              C4KHST                          WBKHST
     I              C4KJST                          WBKJST
     I              C4PINB                          WBPINB
     I              C4KKST                          WBKKST
     I              C4AAVN                          WBAAVN
     I              C4AADT                          WBAADT
     I              C4AMTM                          WBAMTM
     I              C4AJST                          WBAJST
     I              C4AHVN                          WBAHVN
     I              C4AGVN                          WBAGVN
     I              C4ABVN                          WBABVN
     I              C4ABDT                          WBABDT
     I              C4ABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKC41    E DSPKC4REL0
      * UPD : Payment Processing Parms  Update index
      * Renamed input format fields
     I              C4HONB                          WBHONB
     I              C4CKDT                          WBCKDT
     I              C4M1NB                          WBM1NB
     I              C4KHST                          WBKHST
     I              C4KJST                          WBKJST
     I              C4PINB                          WBPINB
     I              C4KKST                          WBKKST
     I              C4AAVN                          WBAAVN
     I              C4AADT                          WBAADT
     I              C4AMTM                          WBAMTM
     I              C4AJST                          WBAJST
     I              C4AHVN                          WBAHVN
     I              C4AGVN                          WBAGVN
     I              C4ABVN                          WBABVN
     I              C4ABDT                          WBABDT
     I              C4ABTM                          WBABTM
      *
     IYARDCS      DS                             72
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      * Outward parameters
     IPARC        DS                             21
      * KEY : Tattoo Header             Co/Prd/Loc/KlDte/Tto/Unp
      * I : RST BOH Company Number
     I                                    P   1   20PAHMNB
      * I : MAP TH Kill Date
     I                                    P  15  180PAB0DT
      *
      * Outward parameters
     IPBRC        DS                             21
      * KEY : Tattoo Header             Co/Prd/Bol/Tto, Unpd Com
      * I : RST BOH Company Number
     I                                    P   1   20PBHMNB
      * I : MAP TH Kill Date
     I                                    P  15  180PBB0DT
      *
      * Outward parameters
     IPCRC        DS                             11
      * KEY : Tattoo Header             Co/kD/SRT/Pt/Tto *all*
      * I : RST BOH Company Number
     I                                    P   1   20PCHMNB
      * I : RST TH Kill Date
     I                                    P   3   60PCB0DT
      *
      * Outward parameters
     IPDRC        DS                             11
      * KEY : Tattoo Header             Co/kD/SRT/Pt/Tto *all*
      * I : RST BOH Company Number
     I                                    P   1   20PDHMNB
      * I : RST TH Kill Date
     I                                    P   3   60PDB0DT
      *
     IYBRDCS      DS                             72
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Payment Processing Parms
      * I :  CC Company Number
     I                                    P   1   20P1HONB
      * I :  Pmt Current Payment Date
     I                                    P   3   60P1CKDT
     IP2PARM      DS
      * I : MAP Oms System Value Alpha
     I                                        1  40 P2EVTX
     IP3PARM      DS
      * FLD: *Arrays
      * I :  PRT Printer Device
     I                                        1  10 P3ACVN
      * I :  PRT Hold Output Sts
     I                                       11  14 P3AKST
      * I :  PRT Save Output Sts
     I                                       15  18 P3AMST
      * I :  PRT Copies
     I                                       19  200P3AKNB
     IP4PARM      DS
      * N :  Current Time
     I                                        1   60P4A1TM
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HONB    PARM           WP0001  30       CC Company Numb
     C           P1CKDT    PARM           WP0002  70       Pmt Current Pay
     C           P2EVTX    PARM           WP0003 40        Oms System Valu
     C           P3ACVN    PARM           WP0004 10        PRT Printer Dev
     C           P3AKST    PARM           WP0005  4        PRT Hold Output
     C           P3AMST    PARM           WP0006  4        PRT Save Output
     C           P3AKNB    PARM           WP0007  20       PRT Copies
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Payment ProducePostWOEdfx
      * RMC 11/23/05 added co to mplus msgs
      * Rtv Payment Processing RT - Payment Processing Parms  * 
     C                     EXSR SARVGN
     C                     MOVEL*BLANK    YL0001           Office Dist Lis
     C                     MOVEL'PRKHPPST'YL0001           Office Dist Lis
      * Step 6, 7, & Roll Kill Date
      * CASE:
      *  - c1 AND c2
      *   |- c1    : WRK.PP Payment Error is No Errors
      *   |- c2    : WRK.PP Commission Paym Error is No Errors
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUKJST    IFEQ 'N'                        *IF
     C           WUKHST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Step 6: Payment Post
     C                     EXSR UASUBR                     Step 6: Payment
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Payment Processing RT - Payment Processing Parms  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAHONB           CC Company Numb
      * Setup key
     C                     Z-ADDP1HONB    WAHONB           CC Company Numb
      * Establish starting position
     C           KRSSA     CHAIN@C4REO7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0434' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WUM1NB           Pmt Current Pay
     C                     MOVEL*BLANK    WUKHST           PP Commission P
     C                     MOVEL*BLANK    WUKJST           PP Payment Erro
     C                     Z-ADD*ZERO     WUPINB           PP Unused Nbr 1
     C                     MOVEL*BLANK    WUKKST           PP Unused Sts 2
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAM1NB    WUM1NB           Pmt Current Pay
     C                     MOVELWAKHST    WUKHST           PP Commission P
     C                     MOVELWAKJST    WUKJST           PP Payment Erro
     C                     Z-ADDWAPINB    WUPINB           PP Unused Nbr 1
     C                     MOVELWAKKST    WUKKST           PP Unused Sts 2
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCHRC    BEGSR
      *================================================================
      * Upd Paymnt Prc         CH - Payment Processing Parms  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Pmt Current Pay
     C                     MOVEL*BLANK    WN0002 10        RS User Changed
     C                     Z-ADD*ZERO     WN0003  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0004  60       RS Time Changed
     C                     MOVEL*BLANK    WN0005  1        RS Record Statu
     C                     MOVEL*BLANK    WN0006 10        RS Job
     C                     MOVEL*BLANK    WN0007 10        RS Program
     C                     MOVEL*BLANK    WN0008 10        RS User Added
     C                     Z-ADD*ZERO     WN0009  70       RS Date Added
     C                     Z-ADD*ZERO     WN0010  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data read
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WN0002           RS User Changed
     C                     Z-ADD##JDT     WN0003           RS Date Changed
     C                     Z-ADD##JTM     WN0004           RS Time Changed
     C                     MOVEL##JOB     WN0006           RS Job
     C                     MOVEL##PGM     WN0007           RS Program
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @C4REO6
     C                     Z-ADDP1HONB    WBHONB           CC Company Numb
      *
     C           KLCHSB    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C           KLCHSB    CHAIN@C4REO6              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKC4REL0'MDACP
     C                     MOVEL'@C4REO6' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKC41    YARDCS
      * Move non-key fields to @C4REO6
     C                     Z-ADDWUM1NB    WBM1NB           Pmt Current Pay
     C                     MOVELWUKHST    WBKHST    P      PP Commission P
     C                     MOVELWUKJST    WBKJST    P      PP Payment Erro
     C                     Z-ADDWUPINB    WBPINB           PP Unused Nbr 1
     C                     MOVELWUKKST    WBKKST    P      PP Unused Sts 2
      *
      * Set PGM.*Record Data Changed flag
     C           QPKC41    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@C4REO6                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKC4REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * Move @C4REO6 fields back
     C                     Z-ADDWBM1NB    WUM1NB           Pmt Current Pay
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Upd Paymnt Prc         CH - Payment Processing Parms  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0011  70       Pmt Current Pay
     C                     MOVEL*BLANK    WN0012 10        RS User Changed
     C                     Z-ADD*ZERO     WN0013  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0014  60       RS Time Changed
     C                     MOVEL*BLANK    WN0015  1        RS Record Statu
     C                     MOVEL*BLANK    WN0016 10        RS Job
     C                     MOVEL*BLANK    WN0017 10        RS Program
     C                     MOVEL*BLANK    WN0018 10        RS User Added
     C                     Z-ADD*ZERO     WN0019  70       RS Date Added
     C                     Z-ADD*ZERO     WN0020  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data read
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WN0012           RS User Changed
     C                     Z-ADD##JDT     WN0013           RS Date Changed
     C                     Z-ADD##JTM     WN0014           RS Time Changed
     C                     MOVEL##JOB     WN0016           RS Job
     C                     MOVEL##PGM     WN0017           RS Program
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @C4REO6
     C                     Z-ADDP1HONB    WBHONB           CC Company Numb
      *
     C           KLCHSC    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C           KLCHSC    CHAIN@C4REO6              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKC4REL0'MDACP
     C                     MOVEL'@C4REO6' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKC41    YBRDCS
      * Move non-key fields to @C4REO6
     C                     Z-ADDWUM1NB    WBM1NB           Pmt Current Pay
     C                     MOVELWUKHST    WBKHST    P      PP Commission P
     C                     MOVELWUKJST    WBKJST    P      PP Payment Erro
     C                     Z-ADDWUPINB    WBPINB           PP Unused Nbr 1
     C                     MOVELWUKKST    WBKKST    P      PP Unused Sts 2
      *
      * Set PGM.*Record Data Changed flag
     C           QPKC41    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@C4REO6                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKC4REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * Move @C4REO6 fields back
     C                     Z-ADDWBM1NB    WUM1NB           Pmt Current Pay
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Step 6: Payment Post
      *================================================================
      * Step 6:  Producer Posting
      * CASE: WRK.Pmt Current Payment Step is Less or Equal to Step 6
     C           WUM1NB    IFLE 00006                      *IF
      * Step 6  Payment posting and producer Post/Create Producer Voucher
      * CASE: WRK.Pmt Current Payment Step is Greater then or Equal 5
     C           WUM1NB    IFGE 00005                      *IF
     C                     Z-ADD00006     WUM1NB           Pmt Current Pay
      * Upd Paymnt Prc         CH - Payment Processing Parms  * 
     C                     EXSR SBCHRC
      * Prt Pay Chk Post Rep  PF - Tattoo Header  * 
     C                     CALL 'PKT1PFR'              90  Prt Pay Chk Pos
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HONB    WQ0001  30       BOH Company Num
     C                     PARM WUCKDT    WQ0002  70       TH Kill Date
     C                     PARM 'P'       WQ0003  1        @Status Edit/Po
     C                     PARM P2EVTX    WQ0004 40        Oms System Valu
     C                     PARM 'U'       WQ0005  1        @Status Unpaid/
     C           WUKIST    PARM WUKIST    WQ0006  1        Pmt Payment Err
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKT1PFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * This report will print a report by producer, and create checks
      * Prt Payment Edit/Post PF - Tattoo Header  * 
     C                     CLEARPARC
     C                     Z-ADDP1HONB    PAHMNB           BOH Company Num
     C                     Z-ADDWUCKDT    PAB0DT           TH Kill Date
      *
     C                     CALL 'PKS2PFR'              90  Prt Payment Edi
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Tattoo Hea
     C                     PARM 'P'       WQ0007  1        @Status Edit/Po
     C                     PARM P2EVTX    WQ0008 40        Oms System Valu
     C                     PARM 'U'       WQ0009  1        @Status Unpaid/
     C           WUKIST    PARM WUKIST    WQ0010  1        Pmt Payment Err
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKS2PFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * This report will print comm paid by TH producer, and create check
      * Prt Payment Comm E/P  PF - Tattoo Header  * 
     C                     CLEARPBRC
     C                     Z-ADDP1HONB    PBHMNB           BOH Company Num
     C                     Z-ADDWUCKDT    PBB0DT           TH Kill Date
      *
     C                     CALL 'PKPMPFR'              90  Prt Payment Com
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PBRC             KEY: Tattoo Hea
     C                     PARM 'P'       WQ0011  1        @Status Edit/Po
     C           WUKIST    PARM WUKIST    WQ0012  1        PP Commission P
     C                     PARM P2EVTX    WQ0013 40        Oms System Valu
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKPMPFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * PK0166- Update TH Ext with Excluded Carcass Data
      * Rtv Excep Deleted Sum XF - Eval Trans  * 
     C                     CALL 'PKT5XFR'              90  Rtv Excep Delet
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HONB    WQ0014  30       ET Company Numb
     C                     PARM WUCKDT    WQ0015  70       ET Kill Date
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKT5XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Prt Pur-Jrn Prm/Final PF - Tattoo Header  * 
     C                     CLEARPCRC
     C                     Z-ADDP1HONB    PCHMNB           BOH Company Num
     C                     Z-ADDWUCKDT    PCB0DT           TH Kill Date
      *
     C                     CALL 'PKTTPFR'              90  Prt Pur-Jrn Prm
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PCRC             KEY: Tattoo Hea
     C                     PARM 'P'       WQ0016  1        @Status Edit/Po
     C                     PARM P2EVTX    WQ0017 40        Oms System Valu
     C                     PARM 'U'       WQ0018  1        @Status Unpaid/
     C           WUEKST    PARM WUEKST    WQ0019  1        Pmt Payment Err
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKTTPFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Prt Pur-Jrn Rsl       PF - Tattoo Header  * 
     C                     CLEARPDRC
     C                     Z-ADDP1HONB    PDHMNB           BOH Company Num
     C                     Z-ADDWUCKDT    PDB0DT           TH Kill Date
      *
     C                     CALL 'PKTZPFR'              90  Prt Pur-Jrn Rsl
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PDRC             KEY: Tattoo Hea
     C                     PARM 'P'       WQ0020  1        @Status Edit/Po
     C                     PARM P2EVTX    WQ0021 40        Oms System Valu
     C                     PARM 'U'       WQ0022  1        @Status Unpaid/
     C           WUEKST    PARM WUEKST    WQ0023  1        Pmt Payment Err
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKTZPFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADD00007     WUM1NB           Pmt Current Pay
      * Upd Paymnt Prc         CH - Payment Processing Parms  * 
     C                     EXSR SCCHRC
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P4A1TM           Current Time
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Pmt Current Payment Step
     C                     Z-ADD*ZERO     WUM1NB  50
      * Define work field PP Commission Paym Error
     C                     MOVEL*BLANK    WUKHST  1
      * Define work field PP Payment Error
     C                     MOVEL*BLANK    WUKJST  1
      * Define work field PP Unused Nbr 1
     C                     Z-ADD*ZERO     WUPINB  50
      * Define work field PP Unused Sts 2
     C                     MOVEL*BLANK    WUKKST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WACKDT           Pmt Current Pay
     C                     Z-ADD*ZERO     WAM1NB           Pmt Current Pay
     C                     Z-ADD*ZERO     WAPINB           PP Unused Nbr 1
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Define work field Pmt Current Payment Date
     C                     Z-ADD*ZERO     WUCKDT  70
      * Define work field @Payment Error
     C                     MOVEL*BLANK    WUKIST  1
      * Define work field @Payment Sts
     C                     MOVEL*BLANK    WUEKST  2
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Define null work field Pmt Current Payment Date
     C                     Z-ADD*ZERO     YN0001  70
      * Define local work field Office Dist List USR
     C                     MOVEL*BLANK    YL0001 10
      *================================================================
     CSR         ZZEXIT    ENDSR
