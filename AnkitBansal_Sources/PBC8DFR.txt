// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBC8DFR
// ?Date: 14.08.2025 Time: 03:47:29
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

EXECUTE FUNCTION(VAL Set Inter. Access  IF) TYPE(EXCINTFUN)                     AC1144606;
PARAMETER('OMS');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Allow_Multi_Company);
PARAMETER(PAR.Default_Printer);
PARAMETER(PAR.Salesperson_Code);

// PAR.User Profile Name = JOB.*USER
PAR.User_Profile_Name = JOB.*USER;

// WRK.First Time Flag = CND.Yes
WRK.First_Time_Flag = 'Y';

// WRK.Record Found USR = CND.Record Not Found
WRK.Record_Found_USR = 'N';

// WRK.DELETE = CND.No
WRK.DELETE = 'N';

// CTL.Record Status = CND.Active
CTL.Record_Status = 'A';

//?USER: Initialize subfile control

CASE;

// IF WRK.First Time Flag is Yes
IF WRK.First_Time_Flag = 'Y';

// CTL.Entered by User = PAR.User Profile Name
CTL.Entered_by_User = PAR.User_Profile_Name;

// CTL.Record Status = CND.Active
CTL.Record_Status = 'A';

// WRK.First Time Flag = CND.NO
WRK.First_Time_Flag = 'N';

ENDIF;

//?USER: Initialize subfile record from DBF record

// RCD.Reverse Image Flag USR = CND.No
RCD.Reverse_Image_Flag_USR = 'N';

//?Select by customer if entered
CASE;

// IF CTL.Ship To Customer is not equal to zero
IF CTL.Ship_To_Customer <> *ZERO;

// AND DB1.Ship To Customer NE CTL.Ship To Customer
AND DB1.Ship_To_Customer <> CTL.Ship_To_Customer;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Select by price code if entered
CASE;

// IF CTL.Price Code is Entered
IF CTL.Price_Code > *ZERO;

// AND DB1.Price Code NE CTL.Price Code
AND DB1.Price_Code <> CTL.Price_Code;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Select by Start Date if entered
CASE;

// IF CTL.Price Start Date is Entered
IF CTL.Price_Start_Date > *ZERO;

// AND DB1.Price Start Date NE CTL.Price Start Date
AND DB1.Price_Start_Date <> CTL.Price_Start_Date;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Select by End Date if entered
CASE;

// IF CTL.Price End Date is Entered
IF CTL.Price_End_Date > *ZERO;

// AND DB1.Price End Date NE CTL.Price End Date
AND DB1.Price_End_Date <> CTL.Price_End_Date;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Select by user if entered
CASE;

// IF CTL.Entered by User NE WRK.USR Blank 10
IF CTL.Entered_by_User <> WRK.USR_Blank_10;

// AND DB1.Entered by User NE CTL.Entered by User
AND DB1.Entered_by_User <> CTL.Entered_by_User;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?Select by record status if entered
CASE;

// IF CTL.Record Status is Valid Entries
IF CTL.Record_Status = 'A'/'D'/'I';

// AND DB1.Record Status NE CTL.Record Status
AND DB1.Record_Status <> CTL.Record_Status;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

EXECUTE FUNCTION(VAL Cust/Price Code    RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1677004;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(WRK.Record_Found_USR);

//?Highlight field if price code is used on a detail record
CASE;

// IF WRK.Record Found USR is Record Found
IF WRK.Record_Found_USR = 'Y';

// RCD.Reverse Image Flag USR = CND.Yes
RCD.Reverse_Image_Flag_USR = 'Y';

ENDIF;

//?USER: Process subfile record (Pre-confirm)

CASE;

// IF RCD.*SFLSEL is *Edit
IF RCD.*SFLSEL = '2'/'2';

// Call program EDT Price Codes        ER.
CALL PROGRAM(EDT Price Codes        ER) ('PBC9E1R');
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(RCD.Price_Start_Date);
PARAMETER(RCD.Price_End_Date);
PARAMETER(RCD.Entered_by_User);
PARAMETER(RCD.Date_Entered);
PARAMETER(RCD.Time_Entered);
PARAMETER(RCD.Record_Status);

// RCD.*SFLSEL = CND.*Reset to blank
RCD.*SFLSEL = *BLANK;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

