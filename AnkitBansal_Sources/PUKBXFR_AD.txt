// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUKBXFR
// ?Date: 14.08.2025 Time: 03:50:35
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Auto Inv EDI846 CmRT) TYPE(RTVOBJ) FILE(PDJYREP)           AC2160743;
{
 //?USER: Process Data record

 //?If record is active, process it
 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?Determine if Auto Inventory Restoration set up for company
 //?  and if it ran today - send email if not
 EXECUTE FUNCTION(RTV WHS Auto EDI846   RT) TYPE(RTVOBJ) FILE(CAADREP)           AC2160744;
 PARAMETER(DB1.Company_Number);
 {
  //?USER: Initialize routine

  // LCL.WHS Auto Inv Rest Cnt USR = CND.Eq Zero
  LCL.WHS_Auto_Inv_Rest_Cnt_USR = *ZERO;

  // LCL.Physical Start Date = JOB.*Job date
  LCL.Physical_Start_Date = JOB.*Job_date;

  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv Whs 846 Active    RT) TYPE(RTVOBJ) FILE(PNG0REP)           AC2160742;
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER('WHSRST');
  PARAMETER(LCL.Record_Status);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF LCL.Record Status is Active
  IF LCL.Record_Status = 'A';

  EXECUTE FUNCTION(Rtv Auto Inv Rest Cmp  RT) TYPE(RTVOBJ) FILE(OMHCCPP)          AC2094281;
  PARAMETER(DB1.Shipping_Company);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Physical_Start_Date);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   //?USER: Process Data record

   // PGM.*Return code = CND.*Record already exists
   PGM.*Return_code = 'Y2U0003';

  }

  CASE;

  // IF PGM.*Return code is *Record already exists
  IF PGM.*Return_code = 'Y2U0003';

  // IF *OTHERWISE
  IF *OTHERWISE;

  //?Send Email Message
  // Call program Rtv Alpha Value       XF.
  CALL PROGRAM(Rtv Alpha Value       XF) ('POMTXFR');
  PARAMETER(DB1.Shipping_Company);
  PARAMETER('EDI846CMP');
  PARAMETER(LCL.Email_Address);

  //?If Email address is found, send email
  CASE;

  // IF LCL.Email Address is Entered
  IF LCL.Email_Address <> *BLANK;

  //?R14364 DN 03/21/19-Send Email Based on EDI Frequency.
  CASE;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // LCL.Send Email USR = CND.No
  LCL.Send_Email_USR = 'N';

  EXECUTE FUNCTION(Rtv Frequency         RT) TYPE(RTVOBJ) FILE(PNG0REP)           AC2168826;
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER('WHSRST');
  PARAMETER(LCL.EDI_Frequency);
  {
   //?USER: Initialize routine

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  //?Check Frequency.
  CASE;

  // IF NOT LCL.EDI Frequency is Not Entered
  IF ! LCL.EDI_Frequency = *BLANK;

  //?Send Email If ALL.
  CASE;

  // IF LCL.EDI Frequency is All
  IF LCL.EDI_Frequency = 'ALL';

  // LCL.Send Email USR = CND.Yes
  LCL.Send_Email_USR = 'Y';

  ENDIF;

  //?Set DOW Value from EDI Frequency.
  CASE;

  // IF LCL.EDI Frequency is Monday
  IF LCL.EDI_Frequency = 'MON';

  // PAR.Day of the Week # USR = CND.Monday
  PAR.Day_of_the_Week_#_USR = 1;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Tuesday
  IF LCL.EDI_Frequency = 'TUE';

  // PAR.Day of the Week # USR = CND.Tuesday
  PAR.Day_of_the_Week_#_USR = 2;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Wednesday
  IF LCL.EDI_Frequency = 'WED';

  // PAR.Day of the Week # USR = CND.Wednesday
  PAR.Day_of_the_Week_#_USR = 3;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Thurdsday
  IF LCL.EDI_Frequency = 'THU';

  // PAR.Day of the Week # USR = CND.Thursday
  PAR.Day_of_the_Week_#_USR = 4;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Friday
  IF LCL.EDI_Frequency = 'FRI';

  // PAR.Day of the Week # USR = CND.Friday
  PAR.Day_of_the_Week_#_USR = 5;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Saturday
  IF LCL.EDI_Frequency = 'SAT';

  // PAR.Day of the Week # USR = CND.Saturday
  PAR.Day_of_the_Week_#_USR = 6;

  //?Set DOW Value from EDI Frequency.
  // IF LCL.EDI Frequency is Sunday
  IF LCL.EDI_Frequency = 'SUN';

  // PAR.Day of the Week # USR = CND.Sunday
  PAR.Day_of_the_Week_#_USR = 7;

  ENDIF;

  // LCL.Day of the Week # USR = JOB.*Job date *DAY OF WEEK
  LCL.Day_of_the_Week_#_USR = DATEDTLS(JOB.*Job_date 'DW' 1111111 'NONE' 'N' 1);

  //?If DOW from Job Date & from EDI Frequency Match Then Send It.
  CASE;

  // IF LCL.Day of the Week # USR EQ PAR.Day of the Week # USR
  IF LCL.Day_of_the_Week_#_USR = PAR.Day_of_the_Week_#_USR;

  // LCL.Send Email USR = CND.Yes
  LCL.Send_Email_USR = 'Y';

  ENDIF;

  ENDIF;

  //?Send Email?
  CASE;

  // IF LCL.Send Email USR is Yes
  IF LCL.Send_Email_USR = 'Y';

  EXECUTE FUNCTION(Chk WHS rcvd in 846   RT) TYPE(RTVOBJ) FILE(ECP082)            AC2243686;
  PARAMETER('WH');
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Physical_Start_Date);
  PARAMETER(LCL.Warehouse_Found);
  {
   //?USER: Initialize routine

   // PAR.Warehouse Found = CND.Warehouse Not Found
   PAR.Warehouse_Found = 'N';

   //?USER: Process Data record

   EXECUTE FUNCTION(Chk whs for 846 latest RT) TYPE(RTVOBJ) FILE(ECP080)           AC2243732;
   PARAMETER(DB1.EDI_SURROGATE_NUMBER);
   PARAMETER(PAR.Physical_Start_Date);
   PARAMETER(PAR.Warehouse_Found);
   {
    //?USER: Initialize routine

    // PAR.Warehouse Found = CND.Warehouse Not Found
    PAR.Warehouse_Found = 'N';

    // LCL.BAI04 Adjustment Date = PAR.Physical Start Date + CON.19000000
    LCL.BAI04_Adjustment_Date = PAR.Physical_Start_Date + 19000000;

    //?USER: Process Data record

    CASE;

    // IF DB1.BAI04 Adjustment Date EQ LCL.BAI04 Adjustment Date
    IF DB1.BAI04_Adjustment_Date = LCL.BAI04_Adjustment_Date;

    // PAR.Warehouse Found = CND.Warehouse Found
    PAR.Warehouse_Found = 'Y';

    ENDIF;

    QUIT;

   }

   QUIT;

  }

  //?S028761 - If warehouse code is not found, set email subject
  CASE;

  // IF LCL.Warehouse Found is Warehouse Not Found
  IF LCL.Warehouse_Found = 'N';

  // Retrieve message - '*** AUTO EDI 846 Zero Inventory Received for Warehouse &1'
  LCL.Subject_Line_USR = RTVMSG(USR5550);
  PARAMETER(DB1.Warehouse_Code);

  //?S028761 - If warehouse code is not found, set email subject
  // IF *OTHERWISE
  IF *OTHERWISE;

  // Retrieve message - '*** AUTO EDI 846 Not Received by 3:30am for Warehouse &1'
  LCL.Subject_Line_USR = RTVMSG(USR5092);
  PARAMETER(DB1.Warehouse_Code);

  ENDIF;

  // Execute command - 'ESNDMAIL - Email Address, Subject Line, and Message'
  EXECUTE COMMAND(USR4974);
  PARAMETER(LCL.Email_Address);
  PARAMETER(*BLANK);
  PARAMETER(LCL.Subject_Line_USR);

  ENDIF;

  ENDIF;

  ENDIF;

  ENDIF;

  ENDIF;

 }

 ENDIF;

}


