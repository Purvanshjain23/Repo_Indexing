// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMSPXFR
// ?Date: 14.08.2025 Time: 03:44:00
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?*NOTE:  This must be compiled with Reclaim Resources = Yes
//?6/22/12 RMC Print bol for transload sts if MK cust only. dont print it
//?  for 3rd party sales                   E2079
//?1. Read workfile to print BOLs to email or fax
DO;

EXECUTE FUNCTION(RTV for BOL Email/Fax RT) TYPE(RTVOBJ) FILE(PDJ4CPP)           AC1870346;
PARAMETER(PAR.Job_Name_CDE);
PARAMETER(*BLANK);
PARAMETER(LCL.Use_Credit_Contact_Info);
{
 //?USER: Initialize routine

 EXECUTE FUNCTION(Rtv Plant Co/Org      RT) TYPE(RTVOBJ) FILE(PDJYREP)           AC1826265;
 PARAMETER(361);
 PARAMETER(NLL.Plant_Company_Sts);
 PARAMETER(LCL.Company_Organization);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Job Name CDE EQ PAR.Job Name CDE
 IF DB1.Job_Name_CDE = PAR.Job_Name_CDE;

 //?FT1110 - If Company Org is "H"igh Plains, get BOL type from whse
 CASE;

 // IF LCL.Company Organization is High Plains Biodiesel
 IF LCL.Company_Organization = 'H';

 EXECUTE FUNCTION(RTV Whse/Non Cancelled RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1428700;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(LCL.Warehouse_Code);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  //?C2748:  Changed RTV Warehouse Code RT to exclude Cancelled lines.
  CASE;

  // IF DB1.Detail Line Status is Cancelled
  IF DB1.Detail_Line_Status = 'X';

  // IF *OTHERWISE
  IF *OTHERWISE;

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

  ENDIF;

 }

 //?invoice number has load id
 EXECUTE FUNCTION(RTV HPB Transload Stn RT) TYPE(RTVOBJ) FILE(OMFLCPP)           AC1870349;
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.HPB_Transload_Station);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(Rtv HPB fields        RT) TYPE(RTVOBJ) FILE(CAADREP)           AC1855470;
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER(LCL.Production_Warehouse_Code);
 PARAMETER(LCL.Warehouse_Location);
 PARAMETER(LCL.WHS_Req_Meter_Reading_Shp);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.WHS Req Meter Reading Shp is Yes
 IF LCL.WHS_Req_Meter_Reading_Shp = 'Y';

 // LCL.CDD Type = CND.Bill of Lading
 LCL.CDD_Type = 'BL';

 // Call program PRT Bill of Ld-HPB fax PF.
 CALL PROGRAM(PRT Bill of Ld-HPB fax PF) ('PMUCPFR');
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Company_Number);
 PARAMETER('N');

 EXECUTE FUNCTION(RTV HPB Override typeRT) TYPE(RTVOBJ) FILE(PMAMREP)            AC2046780;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Type_Code);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?If blank , get from customer
 CASE;

 // IF LCL.Type Code is Entered
 IF LCL.Type_Code <> *BLANK;

 //?If blank , get from customer
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Type Code by Cust  RT) TYPE(RTVOBJ) FILE(CAEOREP)          AC1625687;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(LCL.Type_Code);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

 //?PRINT 2ND BOL FOR MARKETING CUSTS ONLY -- IE.SALES FROM 361 TO 369
 CASE;

 // IF LCL.Type Code is Marketing
 IF LCL.Type_Code = 'MK';

 //?HPB - Print 2nd bol for transloading station
 CASE;

 // IF LCL.HPB Transload Station GT WRK.Blank for 4           USR
 IF LCL.HPB_Transload_Station > WRK.Blank_for_4_USR;

 //?Move "Y" to export sts and pass to BOL print to print the
 //?HPB Transloading BOL
 // Call program PRT Bill of Ld-HPB fax PF.
 CALL PROGRAM(PRT Bill of Ld-HPB fax PF) ('PMUCPFR');
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Company_Number);
 PARAMETER('Y');

 ENDIF;

 ENDIF;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.CDD Type = CND.BOL for By Products
 LCL.CDD_Type = 'BY';

 // Call program PRT Bill of Lading-HPBYPF.
 CALL PROGRAM(PRT Bill of Lading-HPBYPF) ('PMQBPFR');
 PARAMETER(DB1.Invoice_Number);
 PARAMETER(DB1.Company_Number);
 PARAMETER('N');

 ENDIF;

 ENDIF;

 ENDIF;

}


ENDDO;

//?2. Del  workfile for par.job name cde
DO;

// Call program DLT PD Invoice For Job XF.
CALL PROGRAM(DLT PD Invoice For Job XF) ('PPUPXFR');
PARAMETER(PAR.Job_Name_CDE);

ENDDO;

