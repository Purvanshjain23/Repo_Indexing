// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POSDXFR
// ?Date: 14.08.2025 Time: 03:38:52
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?1/18/02
//?Fix Commodity mkt price.  its used by Cognos so it needs to be uptodate
//?    Start at Actual shipped date = 01/01/2002
EXECUTE FUNCTION(FIX Comm Mkt Price    RT) TYPE(RTVOBJ) FILE(OMHSTPP)           AC1654455;
PARAMETER(360);
PARAMETER(1020101);
{
 //?USER: Process Data record

 //?Get Market Price    (copied from Cpy to Sales History function.)
 DO;

 // Call program RTV Copy to History    XF.
 CALL PROGRAM(RTV Copy to History    XF) ('PDRFXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(LCL.Item_Type_Code);
 PARAMETER(LCL.Commodity_Price_Group);
 PARAMETER(LCL.Base_Conv_Loss_Item);
 PARAMETER(LCL.Variety_Rendered_Cut);
 PARAMETER(LCL.Group_for_Packaging);
 PARAMETER(LCL.Packaging_Code);
 PARAMETER(LCL.Item_Market_Code);
 PARAMETER(LCL.Agrimetrics_group);
 PARAMETER(LCL.Agrimetrics_pack);
 PARAMETER(LCL.Agrimetrics_grade);
 PARAMETER(LCL.SH_Unused_was_broker);
 PARAMETER(LCL.PM_Raw_Material_Type_Code);
 PARAMETER(LCL.PM_Line_Number);

 EXECUTE FUNCTION(RTV Print Realization  RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1387825;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(LCL.Commodity_Market_Code);
 PARAMETER(WRK.Print_on_Realization_Rpt);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?subtract 1 from actual shipped date for starting point
 // WRK.Actual Shipped Date = DB1.Actual Shipped Date + CON.-1 *DAYS
 WRK.Actual_Shipped_Date = DATEINCR(DB1.Actual_Shipped_Date '-1' 'DY' 1111111 'NONE' 'N'
 1);

 EXECUTE FUNCTION(RTV Market Price       RT) TYPE(RTVOBJ) FILE(OMF0CPP)          AC1199313;
 PARAMETER(LCL.Commodity_Market_Code);
 PARAMETER(LCL.Commodity_Price_Group);
 PARAMETER(WRK.Actual_Shipped_Date);
 PARAMETER(LCL.Commodity_Market_Price);
 PARAMETER(WRK.USR_Date_Priced);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Commodity Market Price = DB1.Commodity Market Price
  PAR.Commodity_Market_Price = DB1.Commodity_Market_Price;

  // PAR.USR Date Priced = DB1.Market Price Date
  PAR.USR_Date_Priced = DB1.Market_Price_Date;

  QUIT;

 }

 CASE;

 // IF LCL.Commodity Market Price is Entered
 IF LCL.Commodity_Market_Price > *ZERO;

 EXECUTE FUNCTION(CHG Comm Mkt Price    CH) TYPE(CHGOBJ) FILE(OMHSTPP)           AC1654457;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Commodity_Market_Price);
 {
  //?USER: Processing after Data read

  // DB1.Data Mart Process Sts = CND.no
  DB1.Data_Mart_Process_Sts = 'N';

  // DB1.Process Sts for 3C = CND.No
  DB1.Process_Sts_for_3C = 'N';

 }

 ENDIF;

 ENDDO;

}


