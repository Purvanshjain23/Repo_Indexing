     H/TITLE Prg Purchase Plan      XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1181
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL                     n
     H* System        : HPEDEVMDL
     H* User name     : ISLBUSE
     H* Date          : 11/30/07  Time  : 13:57:43
     H* Copyright     : HPEDEVMDL                     n
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKAUCPL3IF  E           K        DISK
      * RSQ : Purchase Plan Weekly Sum  Year(D)/Week(D)
      *
     FPKAVCPL4IF  E           K        DISK
      * RSQ : Producer Purchase Plan    Year(D)/Week(D)
      *
     FPKAVCPL5IF  E           K        DISK                      A
      * UPD : Producer Purchase Plan    Update index for Purge
      *
     FPKAVCPL0UF  E           K        DISK
      * UPD : Producer Purchase Plan    Update index
      *
     FPKAUCPL4IF  E           K        DISK                      A
      * UPD : Purchase Plan Weekly Sum  Update index for Purge
      *
     FPKAUCPL1UF  E           K        DISK
      * UPD : Purchase Plan Weekly Sum  Update index
      *
     I@AUCPS2
      * Purchase Plan Weekly Sum  Year(D)/Week(D)
      * Renamed input format fields
     I              AUHXNB                          WAHXNB
     I              AUGANB                          WAGANB
     I              AUGBNB                          WAGBNB
     I              AUA6NB                          WAA6NB
     I              AUA7NB                          WAA7NB
     I              AUA3ST                          WAA3ST
     I              AUAAVN                          WAAAVN
     I              AUAADT                          WAAADT
     I              AUAMTM                          WAAMTM
     I              AUAJST                          WAAJST
     I              AUAHVN                          WAAHVN
     I              AUAGVN                          WAAGVN
     I              AUABVN                          WAABVN
     I              AUABDT                          WAABDT
     I              AUABTM                          WAABTM
      *
     I@AVCPS4
      * Producer Purchase Plan    Year(D)/Week(D)
      * Renamed input format fields
     I              AVHXNB                          WBHXNB
     I              AVGANB                          WBGANB
     I              AVGBNB                          WBGBNB
     I              AVABCD                          WBABCD
     I              AVAECD                          WBAECD
     I              AVBMNB                          WBBMNB
     I              AVA8NB                          WBA8NB
     I              AVA9NB                          WBA9NB
     I              AVBANB                          WBBANB
     I              AVBBNB                          WBBBNB
     I              AVBCNB                          WBBCNB
     I              AVBDNB                          WBBDNB
     I              AVBENB                          WBBENB
     I              AVBFNB                          WBBFNB
     I              AVBGNB                          WBBGNB
     I              AVBHNB                          WBBHNB
     I              AVBINB                          WBBINB
     I              AVBJNB                          WBBJNB
     I              AVBKNB                          WBBKNB
     I              AVBLNB                          WBBLNB
     I              AVAAVN                          WBAAVN
     I              AVAADT                          WBAADT
     I              AVAMTM                          WBAMTM
     I              AVAJST                          WBAJST
     I              AVAHVN                          WBAHVN
     I              AVAGVN                          WBAGVN
     I              AVABVN                          WBABVN
     I              AVABDT                          WBABDT
     I              AVABTM                          WBABTM
      *
     I@AVCPNH
      * Producer Purchase Plan    Update index for Purge
      * Renamed input format fields
     I              AVHXNB                          WCHXNB
     I              AVGANB                          WCGANB
     I              AVGBNB                          WCGBNB
     I              AVABCD                          WCABCD
     I              AVAECD                          WCAECD
     I              AVBMNB                          WCBMNB
     I              AVA8NB                          WCA8NB
     I              AVA9NB                          WCA9NB
     I              AVBANB                          WCBANB
     I              AVBBNB                          WCBBNB
     I              AVBCNB                          WCBCNB
     I              AVBDNB                          WCBDNB
     I              AVBENB                          WCBENB
     I              AVBFNB                          WCBFNB
     I              AVBGNB                          WCBGNB
     I              AVBHNB                          WCBHNB
     I              AVBINB                          WCBINB
     I              AVBJNB                          WCBJNB
     I              AVBKNB                          WCBKNB
     I              AVBLNB                          WCBLNB
     I              AVAAVN                          WCAAVN
     I              AVAADT                          WCAADT
     I              AVAMTM                          WCAMTM
     I              AVAJST                          WCAJST
     I              AVAHVN                          WCAHVN
     I              AVAGVN                          WCAGVN
     I              AVABVN                          WCABVN
     I              AVABDT                          WCABDT
     I              AVABTM                          WCABTM
      *
     I@AVCPAQ
      * Producer Purchase Plan    Update index
      * Renamed input format fields
     I              AVHXNB                          WDHXNB
     I              AVGANB                          WDGANB
     I              AVGBNB                          WDGBNB
     I              AVABCD                          WDABCD
     I              AVAECD                          WDAECD
     I              AVBMNB                          WDBMNB
     I              AVA8NB                          WDA8NB
     I              AVA9NB                          WDA9NB
     I              AVBANB                          WDBANB
     I              AVBBNB                          WDBBNB
     I              AVBCNB                          WDBCNB
     I              AVBDNB                          WDBDNB
     I              AVBENB                          WDBENB
     I              AVBFNB                          WDBFNB
     I              AVBGNB                          WDBGNB
     I              AVBHNB                          WDBHNB
     I              AVBINB                          WDBINB
     I              AVBJNB                          WDBJNB
     I              AVBKNB                          WDBKNB
     I              AVBLNB                          WDBLNB
     I              AVAAVN                          WDAAVN
     I              AVAADT                          WDAADT
     I              AVAMTM                          WDAMTM
     I              AVAJST                          WDAJST
     I              AVAHVN                          WDAHVN
     I              AVAGVN                          WDAGVN
     I              AVABVN                          WDABVN
     I              AVABDT                          WDABDT
     I              AVABTM                          WDABTM
      *
     I@AUCPNI
      * Purchase Plan Weekly Sum  Update index for Purge
      * Renamed input format fields
     I              AUHXNB                          WEHXNB
     I              AUGANB                          WEGANB
     I              AUGBNB                          WEGBNB
     I              AUA6NB                          WEA6NB
     I              AUA7NB                          WEA7NB
     I              AUA3ST                          WEA3ST
     I              AUAAVN                          WEAAVN
     I              AUAADT                          WEAADT
     I              AUAMTM                          WEAMTM
     I              AUAJST                          WEAJST
     I              AUAHVN                          WEAHVN
     I              AUAGVN                          WEAGVN
     I              AUABVN                          WEABVN
     I              AUABDT                          WEABDT
     I              AUABTM                          WEABTM
      *
     I@AUCPAV
      * Purchase Plan Weekly Sum  Update index
      * Renamed input format fields
     I              AUHXNB                          WFHXNB
     I              AUGANB                          WFGANB
     I              AUGBNB                          WFGBNB
     I              AUA6NB                          WFA6NB
     I              AUA7NB                          WFA7NB
     I              AUA3ST                          WFA3ST
     I              AUAAVN                          WFAAVN
     I              AUAADT                          WFAADT
     I              AUAMTM                          WFAMTM
     I              AUAJST                          WFAJST
     I              AUAHVN                          WFAHVN
     I              AUAGVN                          WFAGVN
     I              AUABVN                          WFABVN
     I              AUABDT                          WFABDT
     I              AUABTM                          WFABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKAV1    E DSPKAVCPL5
      * UPD : Producer Purchase Plan    Update index for Purge
      * Renamed input format fields
     I              AVHXNB                          WCHXNB
     I              AVGANB                          WCGANB
     I              AVGBNB                          WCGBNB
     I              AVABCD                          WCABCD
     I              AVAECD                          WCAECD
     I              AVBMNB                          WCBMNB
     I              AVA8NB                          WCA8NB
     I              AVA9NB                          WCA9NB
     I              AVBANB                          WCBANB
     I              AVBBNB                          WCBBNB
     I              AVBCNB                          WCBCNB
     I              AVBDNB                          WCBDNB
     I              AVBENB                          WCBENB
     I              AVBFNB                          WCBFNB
     I              AVBGNB                          WCBGNB
     I              AVBHNB                          WCBHNB
     I              AVBINB                          WCBINB
     I              AVBJNB                          WCBJNB
     I              AVBKNB                          WCBKNB
     I              AVBLNB                          WCBLNB
     I              AVAAVN                          WCAAVN
     I              AVAADT                          WCAADT
     I              AVAMTM                          WCAMTM
     I              AVAJST                          WCAJST
     I              AVAHVN                          WCAHVN
     I              AVAGVN                          WCAGVN
     I              AVABVN                          WCABVN
     I              AVABDT                          WCABDT
     I              AVABTM                          WCABTM
      *
     IQPKAV2    E DSPKAVCPL0
      * UPD : Producer Purchase Plan    Update index
      * Renamed input format fields
     I              AVHXNB                          WDHXNB
     I              AVGANB                          WDGANB
     I              AVGBNB                          WDGBNB
     I              AVABCD                          WDABCD
     I              AVAECD                          WDAECD
     I              AVBMNB                          WDBMNB
     I              AVA8NB                          WDA8NB
     I              AVA9NB                          WDA9NB
     I              AVBANB                          WDBANB
     I              AVBBNB                          WDBBNB
     I              AVBCNB                          WDBCNB
     I              AVBDNB                          WDBDNB
     I              AVBENB                          WDBENB
     I              AVBFNB                          WDBFNB
     I              AVBGNB                          WDBGNB
     I              AVBHNB                          WDBHNB
     I              AVBINB                          WDBINB
     I              AVBJNB                          WDBJNB
     I              AVBKNB                          WDBKNB
     I              AVBLNB                          WDBLNB
     I              AVAAVN                          WDAAVN
     I              AVAADT                          WDAADT
     I              AVAMTM                          WDAMTM
     I              AVAJST                          WDAJST
     I              AVAHVN                          WDAHVN
     I              AVAGVN                          WDAGVN
     I              AVABVN                          WDABVN
     I              AVABDT                          WDABDT
     I              AVABTM                          WDABTM
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPKAU1    E DSPKAUCPL4
      * UPD : Purchase Plan Weekly Sum  Update index for Purge
      * Renamed input format fields
     I              AUHXNB                          WEHXNB
     I              AUGANB                          WEGANB
     I              AUGBNB                          WEGBNB
     I              AUA6NB                          WEA6NB
     I              AUA7NB                          WEA7NB
     I              AUA3ST                          WEA3ST
     I              AUAAVN                          WEAAVN
     I              AUAADT                          WEAADT
     I              AUAMTM                          WEAMTM
     I              AUAJST                          WEAJST
     I              AUAHVN                          WEAHVN
     I              AUAGVN                          WEAGVN
     I              AUABVN                          WEABVN
     I              AUABDT                          WEABDT
     I              AUABTM                          WEABTM
      *
     IQPKAU2    E DSPKAUCPL1
      * UPD : Purchase Plan Weekly Sum  Update index
      * Renamed input format fields
     I              AUHXNB                          WFHXNB
     I              AUGANB                          WFGANB
     I              AUGBNB                          WFGBNB
     I              AUA6NB                          WFA6NB
     I              AUA7NB                          WFA7NB
     I              AUA3ST                          WFA3ST
     I              AUAAVN                          WFAAVN
     I              AUAADT                          WFAADT
     I              AUAMTM                          WFAMTM
     I              AUAJST                          WFAJST
     I              AUAHVN                          WFAHVN
     I              AUAGVN                          WFAGVN
     I              AUABVN                          WFABVN
     I              AUABDT                          WFABDT
     I              AUABTM                          WFABTM
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  CW Year
     I                                    P   1   30P1GANB
     IP2PARM      DS
      * I :  CW Week Number
     I                                    P   1   20P2GBNB
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1GANB    PARM           WP0001  40       CW Year
     C           P2GBNB    PARM           WP0002  20       CW Week Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Prg Purchase Plan      XF
      * Prg Purchase Plan     RT - Purchase Plan Weekly Sum  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Prg Purchase Plan     RT - Purchase Plan Weekly Sum  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * ***** Change log and comments
     C                     EXSR UASUBR                     ***** Change lo
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAGANB           CW Year
     C                     KFLD           WAGBNB           CW Week Number
      * Setup key
     C                     Z-ADDP1GANB    WAGANB           CW Year
     C                     Z-ADDP2GBNB    WAGBNB           CW Week Number
      * Establish starting position
     C           KPSSA     SETLL@AUCPS2                    *
     C                     READ @AUCPS2                  90*
      * Data record not found
     C   90                MOVEL'PRK0045' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.CW Year LT PAR.CW Year
      *   |- c2    : DB1.CW Week Number LT PAR.CW Week Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAGANB    IFLT P1GANB                     *IF
     C           WAGBNB    IFLT P2GBNB                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Prg Prod Purch Plan   RT - Producer Purchase Plan  * 
     C                     EXSR SBRVGN
      * CRT Purch Plan Wk Purge - Purchase Plan Weekly Sum  * 
     C                     EXSR SECRRC
      * Dlt Purchase Plan Wk  DL - Purchase Plan Weekly Sum  * 
     C                     EXSR SFDLRC
     C                     END                             *FI
     C                     READ @AUCPS2                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Prg Prod Purch Plan   RT - Producer Purchase Plan  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * ***** Change log and comments
     C                     EXSR UBSUBR                     ***** Change lo
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBGANB    WQSB01           CW Year
     C           *LIKE     DEFN WBGBNB    WQSB02           CW Week Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           CW Year
     C                     KFLD           WQSB02           CW Week Number
      * Setup key
     C                     Z-ADDP1GANB    WQSB01           CW Year
     C                     Z-ADDP2GBNB    WQSB02           CW Week Number
      * Establish starting position
     C           KRSSB     SETLL@AVCPS4                    *
     C           KRSSB     READE@AVCPS4                  90*
      * Data record not found
     C   90                MOVEL'PRK0047' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.CW Year LT PAR.CW Year
      *   |- c2    : DB1.CW Week Number LT PAR.CW Week Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WBGANB    IFLT P1GANB                     *IF
     C           WBGBNB    IFLT P2GBNB                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CRT Prdcr Prch Pln Purge - Producer Purchase Plan  * 
     C                     EXSR SCCRRC
      * Dlt Prdcr Purch Plan  DL - Producer Purchase Plan  * 
     C                     EXSR SDDLRC
     C                     END                             *FI
     C           KRSSB     READE@AVCPS4                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * CRT Prdcr Prch Pln Purge - Producer Purchase Plan  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AVCPNH
     C                     Z-ADDWBHXNB    WCHXNB           PPWS Company Nu
     C                     Z-ADDWBGANB    WCGANB           CW Year
     C                     Z-ADDWBGBNB    WCGBNB           CW Week Number
     C                     MOVELWBABCD    WCABCD           PD Producer Cod
     C                     MOVELWBAECD    WCAECD           PL Location Cod
     C                     Z-ADDWBBMNB    WCBMNB           PPP Week Head E
     C                     Z-ADDWBA8NB    WCA8NB           PPP Mon Head Es
     C                     Z-ADDWBA9NB    WCA9NB           PPP Mon Plan He
     C                     Z-ADDWBBANB    WCBANB           PPP Tue Head Es
     C                     Z-ADDWBBBNB    WCBBNB           PPP Tue Plan He
     C                     Z-ADDWBBCNB    WCBCNB           PPP Wed Head Es
     C                     Z-ADDWBBDNB    WCBDNB           PPP Wed Plan He
     C                     Z-ADDWBBENB    WCBENB           PPP Thu Head Es
     C                     Z-ADDWBBFNB    WCBFNB           PPP Thu Plan He
     C                     Z-ADDWBBGNB    WCBGNB           PPP Fri Head Es
     C                     Z-ADDWBBHNB    WCBHNB           PPP Fri Plan He
     C                     Z-ADDWBBINB    WCBINB           PPP Sat Head Es
     C                     Z-ADDWBBJNB    WCBJNB           PPP Sat Plan He
     C                     Z-ADDWBBKNB    WCBKNB           PPP Sun Head Es
     C                     Z-ADDWBBLNB    WCBLNB           PPP Sun Plan He
     C                     MOVELWBAAVN    WCAAVN           RS User Changed
     C                     Z-ADDWBAADT    WCAADT           RS Date Changed
     C                     Z-ADDWBAMTM    WCAMTM           RS Time Changed
     C                     MOVELWBAJST    WCAJST           RS Record Statu
     C                     MOVELWBAHVN    WCAHVN           RS Job
     C                     MOVELWBAGVN    WCAGVN           RS Program
     C                     MOVELWBABVN    WCABVN           RS User Added
     C                     Z-ADDWBABDT    WCABDT           RS Date Added
     C                     Z-ADDWBABTM    WCABTM           RS Time Added
      *
     C           KLCRSC    KLIST
     C                     KFLD           WCHXNB           PPWS Company Nu
     C                     KFLD           WCGANB           CW Year
     C                     KFLD           WCGBNB           CW Week Number
     C                     KFLD           WCABCD           PD Producer Cod
     C                     KFLD           WCAECD           PL Location Cod
      * Check for duplicate primary key
     C           KLCRSC    SETLL@AVCPNH                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0048' W0RTN   7
      * Send message 'Producer Purchase Plan EX'
     C                     MOVEL'PRK0048' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@AVCPNH                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * Dlt Prdcr Purch Plan  DL - Producer Purchase Plan  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AVCPAQ
     C                     Z-ADDWBHXNB    WDHXNB           PPWS Company Nu
     C                     Z-ADDWBGANB    WDGANB           CW Year
     C                     Z-ADDWBGBNB    WDGBNB           CW Week Number
     C                     MOVELWBABCD    WDABCD           PD Producer Cod
     C                     MOVELWBAECD    WDAECD           PL Location Cod
      *
     C           KLDLSD    KLIST
     C                     KFLD           WDHXNB           PPWS Company Nu
     C                     KFLD           WDGANB           CW Year
     C                     KFLD           WDGBNB           CW Week Number
     C                     KFLD           WDABCD           PD Producer Cod
     C                     KFLD           WDAECD           PL Location Cod
     C           KLDLSD    CHAIN@AVCPAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAVCPL0'MDACP
     C                     MOVEL'@AVCPAQ' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@AVCPAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * CRT Purch Plan Wk Purge - Purchase Plan Weekly Sum  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AUCPNI
     C                     Z-ADDWAHXNB    WEHXNB           PPWS Company Nu
     C                     Z-ADDWAGANB    WEGANB           CW Year
     C                     Z-ADDWAGBNB    WEGBNB           CW Week Number
     C                     Z-ADDWAA6NB    WEA6NB           PPWS Head Est
     C                     Z-ADDWAA7NB    WEA7NB           PPWS Plan Head
     C                     MOVELWAA3ST    WEA3ST           PPWS Sts
     C                     MOVELWAAAVN    WEAAVN           RS User Changed
     C                     Z-ADDWAAADT    WEAADT           RS Date Changed
     C                     Z-ADDWAAMTM    WEAMTM           RS Time Changed
     C                     MOVELWAAJST    WEAJST           RS Record Statu
     C                     MOVELWAAHVN    WEAHVN           RS Job
     C                     MOVELWAAGVN    WEAGVN           RS Program
     C                     MOVELWAABVN    WEABVN           RS User Added
     C                     Z-ADDWAABDT    WEABDT           RS Date Added
     C                     Z-ADDWAABTM    WEABTM           RS Time Added
      *
     C           KLCRSE    KLIST
     C                     KFLD           WEHXNB           PPWS Company Nu
     C                     KFLD           WEGANB           CW Year
     C                     KFLD           WEGBNB           CW Week Number
      * Check for duplicate primary key
     C           KLCRSE    SETLL@AUCPNI                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0046' W0RTN   7
      * Send message 'Purchase Plan Weekly S EX'
     C                     MOVEL'PRK0046' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@AUCPNI                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * Dlt Purchase Plan Wk  DL - Purchase Plan Weekly Sum  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AUCPAV
     C                     Z-ADDWAHXNB    WFHXNB           PPWS Company Nu
     C                     Z-ADDWAGANB    WFGANB           CW Year
     C                     Z-ADDWAGBNB    WFGBNB           CW Week Number
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFHXNB           PPWS Company Nu
     C                     KFLD           WFGANB           CW Year
     C                     KFLD           WFGBNB           CW Week Number
     C           KLDLSF    CHAIN@AUCPAV              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKAUCPL1'MDACP
     C                     MOVEL'@AUCPAV' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@AUCPAV                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * ***** Change log and comments
      *================================================================
      * ** 08/16/2007 LJB FP1009
      * ** Changed RSQ lgl to put Kill Date first, removed company number
      * ** from input parms, Add CRT to write the records to QTEMP file
      * ** before deleting from production
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * ***** Change log and comments
      *================================================================
      * ** 08/16/2007 LJB FP1009
      * ** Changed RSQ lgl to put Kill Date first, removed company number
      * ** from input parms, Add CRT to write the records to QTEMP file
      * ** before deleting from production
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     WAGANB           CW Year
     C                     Z-ADD*ZERO     WAGBNB           CW Week Number
     C                     Z-ADD*ZERO     WAA6NB           PPWS Head Est
     C                     Z-ADD*ZERO     WAA7NB           PPWS Plan Head
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     WBGANB           CW Year
     C                     Z-ADD*ZERO     WBGBNB           CW Week Number
     C                     Z-ADD*ZERO     WBBMNB           PPP Week Head E
     C                     Z-ADD*ZERO     WBA8NB           PPP Mon Head Es
     C                     Z-ADD*ZERO     WBA9NB           PPP Mon Plan He
     C                     Z-ADD*ZERO     WBBANB           PPP Tue Head Es
     C                     Z-ADD*ZERO     WBBBNB           PPP Tue Plan He
     C                     Z-ADD*ZERO     WBBCNB           PPP Wed Head Es
     C                     Z-ADD*ZERO     WBBDNB           PPP Wed Plan He
     C                     Z-ADD*ZERO     WBBENB           PPP Thu Head Es
     C                     Z-ADD*ZERO     WBBFNB           PPP Thu Plan He
     C                     Z-ADD*ZERO     WBBGNB           PPP Fri Head Es
     C                     Z-ADD*ZERO     WBBHNB           PPP Fri Plan He
     C                     Z-ADD*ZERO     WBBINB           PPP Sat Head Es
     C                     Z-ADD*ZERO     WBBJNB           PPP Sat Plan He
     C                     Z-ADD*ZERO     WBBKNB           PPP Sun Head Es
     C                     Z-ADD*ZERO     WBBLNB           PPP Sun Plan He
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
