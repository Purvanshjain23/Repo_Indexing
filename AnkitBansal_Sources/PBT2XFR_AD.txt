// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBT2XFR
// ?Date: 14.08.2025 Time: 03:49:23
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?**************************************************************************
//?CLM002 AB 05/03/2024 Added new audit fields in Sales Channel file
//?As timestamp field is also added, re-compilation was required as the objct
//?was compiled with CVTOPT(*DATETIME) so it was passing blank to timestamp
//?and that's why 'Data Mapping Error' appeared, hence re-compilation was rqd
//?So, we went ahead and added the new fields in CRTOBJ/CHGOBJ as well
//?**************************************************************************
//?E3882SS JJH 11/06/15 - Sales Structure
//?- The purpose of this program is to Purge (Set Record Status to I)
//?  if not in use.
//?**************************************************************************
ENDDO;

CASE;

// IF PAR.Record Status is Active
IF PAR.Record_Status = 'A';

EXECUTE FUNCTION(Rtv Sales Chnl Terr=A RT) TYPE(RTVOBJ) FILE(PBB9REP)           AC2113858;
PARAMETER(PAR.Sales_Channel_Code);
PARAMETER(LCL.Record_Status);
{
 //?USER: Initialize routine

 // PAR.Record Status = CND.Inactive
 PAR.Record_Status = 'I';

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 // PAR.Record Status = CND.Active
 PAR.Record_Status = 'A';

 QUIT;

 ENDIF;

}


CASE;

// IF LCL.Record Status is Active
IF LCL.Record_Status = 'A';

// Send completion message - 'Sales Channel "&1" in use. - Purge NOT allowed.'
MESSAGE(USR4862 *COMPLETION);
MSGPARM(PAR.Sales_Channel_Code);

// IF LCL.Record Status is Inactive
IF LCL.Record_Status = 'I';

EXECUTE FUNCTION(Rtv Sales Chnl Mkt=A  RT) TYPE(RTVOBJ) FILE(PBCAREP)           AC2114127;
PARAMETER(PAR.Sales_Channel_Code);
PARAMETER(LCL.Record_Status);
{
 //?USER: Initialize routine

 // PAR.Record Status = CND.Inactive
 PAR.Record_Status = 'I';

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 // PAR.Record Status = CND.Active
 PAR.Record_Status = 'A';

 QUIT;

 ENDIF;

}


CASE;

// IF LCL.Record Status is Active
IF LCL.Record_Status = 'A';

// Send completion message - 'Sales Channel "&1" in use. - Purge NOT allowed.'
MESSAGE(USR4862 *COMPLETION);
MSGPARM(PAR.Sales_Channel_Code);

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(Chg Sales Chnl RcdSts CH) TYPE(CHGOBJ) FILE(PBB4REP)           AC2113859;
PARAMETER(PAR.Sales_Channel_Code);
PARAMETER('I');
PARAMETER(JOB.*USER);
PARAMETER(JOB.*PROGRAM);
PARAMETER(JOB.*USER);
PARAMETER(JOB.*PROGRAM);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Set Chg Date/Time      IF) TYPE(EXCINTFUN)                     AC1523476;
 PARAMETER(DB1.Change_Date);
 PARAMETER(DB1.Change_Time);
 PARAMETER(DB1.Change_User);
 PARAMETER(DB1.Change_Program);
 {
  //?Execute internal function

  // PAR.Change Date = JOB.*Job date
  PAR.Change_Date = JOB.*Job_date;

  // PAR.Change Time = JOB.*Job time
  PAR.Change_Time = JOB.*Job_time;

  // PAR.Change User = JOB.*USER
  PAR.Change_User = JOB.*USER;

  // PAR.Change Program = JOB.*PROGRAM
  PAR.Change_Program = JOB.*PROGRAM;

 }

}


// Send completion message - 'Sales Channel "&1" Inactive.'
MESSAGE(USR4861 *COMPLETION);
MSGPARM(PAR.Sales_Channel_Code);

ENDIF;

ENDIF;

ENDIF;

