// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMJGXFR
// ?Date: 14.08.2025 Time: 03:43:17
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Broker Exhibits    RT) TYPE(RTVOBJ) FILE(POC5REP)          AC1833204;
PARAMETER(PAR.Broker_Code);
PARAMETER(PAR.Payee_Type);
PARAMETER(PAR.Salesperson_Code);
PARAMETER(PAR.Record_Status);
PARAMETER(PAR.Accrual_Code);
PARAMETER(PAR.Email_Address);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.System_Value_Numeric);
PARAMETER(PAR.USR_Detail_or_Summary);
PARAMETER(PAR.Status_Y_or_N);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 // PGM.*Record selected = CND.*YES
 PGM.*Record_selected = 'Y';

 //?** Select Broker Code if passed in
 CASE;

 // IF PAR.Broker Code is Entered
 IF PAR.Broker_Code <> *BLANK;

 // AND DB1.Broker Code NE PAR.Broker Code
 AND DB1.Broker_Code <> PAR.Broker_Code;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?** Select Salesperson if passed in
 CASE;

 // IF PAR.Salesperson Code is entered
 IF PAR.Salesperson_Code <> *BLANK;

 // AND DB1.Salesperson Code NE PAR.Salesperson Code
 AND DB1.Salesperson_Code <> PAR.Salesperson_Code;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?** Select Active only unless otherwise requested
 CASE;

 // IF PAR.Record Status is Valid Entries
 IF PAR.Record_Status = 'A'/'D'/'I';

 // AND DB1.Record Status NE PAR.Record Status
 AND DB1.Record_Status <> PAR.Record_Status;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 //?** Select Accrual code if entered
 CASE;

 // IF PAR.Accrual Code is Entered
 IF PAR.Accrual_Code <> *BLANK;

 //?Does Broker have an accrual with this code?
 EXECUTE FUNCTION(Val Accrual for brokr RT) TYPE(RTVOBJ) FILE(OMHOREP)           AC1840057;
 PARAMETER(PAR.Accrual_Code);
 PARAMETER(WRK.Record_Found_USR);
 PARAMETER(DB1.Broker_Code);
 {
  //?USER: Initialize routine

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.Broker Code EQ PAR.Broker Code
  IF DB1.Broker_Code = PAR.Broker_Code;

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

  QUIT;

  ENDIF;

 }

 CASE;

 // IF WRK.Record Found USR is Record Found
 IF WRK.Record_Found_USR = 'Y';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PGM.*Record selected = CND.*NO
 PGM.*Record_selected = 'N';

 ENDIF;

 ENDIF;

 CASE;

 // IF PGM.*Record selected is *YES
 IF PGM.*Record_selected = 'Y';

 // WRK.Blank 6 USR = CVTVAR(JOB.*Job number)
 WRK.Blank_6_USR = CVTVAR(JOB.*Job_number);

 // WRK.@Text 4 = SUBSTRING(WRK.Blank 6 USR,CON.3,CON.4)
 WRK.@Text_4 = SUBSTRING(WRK.Blank_6_USR:3:4);

 // WRK.Condition Name 10 USR = CONCAT(DB1.Broker Code,WRK.@Text 4,CON.*ZERO)
 WRK.Condition_Name_10_USR = DB1.Broker_Code + WRK.@Text_4 (*ZERO);

 // Call program PRT Broker Exhibits    CL.
 SBMJOB;
 CALL PROGRAM(PRT Broker Exhibits    CL) ('PMJIUPC');
 PARAMETER('OMS');
 PARAMETER(PAR.PRT_Printer_Device);
 PARAMETER(PAR.PRT_Hold_Output_Sts);
 PARAMETER(PAR.PRT_Save_Output_Sts);
 PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
 PARAMETER(PAR.PRT_Night_Queue);
 PARAMETER(PAR.System_Value_Numeric);
 PARAMETER(PAR.USR_Detail_or_Summary);
 PARAMETER(PAR.Status_Y_or_N);
 PARAMETER(PAR.Broker_Code);
 PARAMETER(PAR.Payee_Type);
 PARAMETER(PAR.Salesperson_Code);
 PARAMETER(PAR.Record_Status);
 PARAMETER(PAR.Email_Address);
 PARAMETER(PAR.Accrual_Code);
 SBMJOBOVR JOB(BRKREXHBTS);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?** This is in here for testing purposes
 ENDIF;

}


