// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKAQDFR
// ?Date: 14.08.2025 Time: 02:48:50
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize subfile record from DBF record

EXECUTE FUNCTION(Rtv Week Start & End  RT) TYPE(RTVOBJ) FILE(PKCFREP)           AB1106497;
PARAMETER(DB1.CW_Year);
PARAMETER(DB1.CW_Week_Number);
PARAMETER(WRK.CW_Week_Start_Date);
PARAMETER(WRK.CW_Week_End_Date);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Planned Kill      RT) TYPE(RTVOBJ) FILE(PKAOCPP)           AB1101354;
PARAMETER(PAR.PPWS_Company_Number);
PARAMETER(WRK.CW_Week_Start_Date);
PARAMETER(RCD.Planned_Kill_USR);
PARAMETER(WRK.CW_Week_End_Date);
{
 //?USER: Initialize routine

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.KP_Planned_Kill = *ZERO;

 //?USER: Process Data record

 CASE;

 // IF DB1.KP Kill Date LE PAR.CW Week End Date
 IF DB1.KP_Kill_Cut_Date <= PAR.CW_Week_End_Date;

 // AND DB1.KP Kill Date GE PAR.KP Kill Date
 AND DB1.KP_Kill_Cut_Date >= PAR.KP_Kill_Cut_Date;

 // PAR.KP Plan Head = PAR.KP Plan Head + DB1.KP Plan Head
 PAR.KP_Planned_Kill = PAR.KP_Planned_Kill + DB1.KP_Planned_Kill;

 // IF *OTHERWISE
 IF *OTHERWISE;

 QUIT;

 ENDIF;

}


EXECUTE FUNCTION(Surplus/Shortage DRV) TYPE(DRVFLD)                             AB1100490;
PARAMETER(RCD.Surplus_Shortage_DRV);
PARAMETER(RCD.PPWS_Plan_Head);
PARAMETER(RCD.Planned_Kill_USR);
{
 //?Calculate derived field

 // PAR.Surplus/Shortage DRV = PAR.Purch Pln Head Owned - PAR.Planned Kill USR
 PAR.Surplus_Shortage_DRV = PAR.PPWS_Plan_Head - PAR.Planned_Kill_USR;

}


//?CALC: Subfile control function fields

EXECUTE FUNCTION(Surplus/Shortage DRV) TYPE(DRVFLD)                             AB1100490;
PARAMETER(CTL.Surplus_Shortage_DRV);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
{
 //?Calculate derived field

 // PAR.Surplus/Shortage DRV = PAR.Purch Pln Head Owned - PAR.Planned Kill USR
 PAR.Surplus_Shortage_DRV = PAR.PPWS_Plan_Head - PAR.Planned_Kill_USR;

}


