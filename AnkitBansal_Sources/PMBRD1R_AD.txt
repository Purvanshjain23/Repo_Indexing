// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMBRD1R
// ?Date: 14.08.2025 Time: 03:44:40
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

EXECUTE FUNCTION(Rtv Profile Model     RT) TYPE(RTVOBJ) FILE(CADRREP)           AC1445577;
PARAMETER(JOB.*USER);
PARAMETER(WRK.User_Code_Model);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?** If Company Number is blank, default to security parms value
CASE;

// IF PAR.Company Number is Equal to zero
IF PAR.Company_Number = *ZERO;

// PAR.Company Number = WRK.Company Number
PAR.Company_Number = WRK.Company_Number;

ENDIF;

// WRK.First Time Flag = CND.Yes
WRK.First_Time_Flag = 'Y';

// PAR.USR Exit Program = CND.no
PAR.USR_Exit_Program = 'N';

// Call program RTV System Date/Time   UP.
CALL PROGRAM(RTV System Date/Time   UP) ('PDGFUPC');
PARAMETER(PAR.Current_System_Date);
PARAMETER(WRK.Numeric_Field_Not_Needed);

//?USER: Load detail screen from DBF record

MOVE *ALL (To: DTL From: DB1);

EXECUTE FUNCTION(RTV Company Name       RT) TYPE(RTVOBJ) FILE(CAABREP)          AC1255767;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Company_Name);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// DTL.Load ID = PAR.Load ID
DTL.Load_ID = PAR.Load_ID;

// DTL.Load ID USR = PAR.Load ID
DTL.Load_ID_USR = PAR.Load_ID;

// DTL.Trailer ID USR = DTL.Trailer Id
DTL.Trailer_ID_USR = DTL.Trailer_Id;

EXECUTE FUNCTION(RTV Carrier Name       RT) TYPE(RTVOBJ) FILE(OMFFREP)          AC1382687;
PARAMETER(DTL.Carrier_Code);
PARAMETER(DTL.Name);
PARAMETER(WRK.Record_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

}


// DTL.Delivery Date = DB1.Requested Delivery Date
DTL.Delivery_Date = DB1.Requested_Delivery_Date;

// DTL.Load Door 1 USR = DTL.Load Door 1
DTL.Load_Door_1_USR = DTL.Load_Door_1;

// DTL.Load Door 2 USR = DTL.Load Door 2
DTL.Load_Door_2_USR = DTL.Load_Door_2;

//?Default:  Partial Load
CASE;

// IF DB1.Partial Load is Not Entered
IF DB1.Partial_Load = *BLANK;

// DTL.Partial Load = CND.No
DTL.Partial_Load = 'N';

ENDIF;

// DTL.Description 14A      USR = Condition name of DB1.LH Unused Sts
DTL.Description_14A_USR = RTVCND(DB1.LH_Unused_Sts);

// DTL.Usr Confirmation Time = DB1.Load Confirmation Time
DTL.Usr_Confirmation_Time = DB1.Load_Confirmation_Time;

// DTL.USR Product complete tm = DB1.Product Complete Time
DTL.USR_Product_complete_tm = DB1.Product_Complete_Time;

//?USER: Validate detail screen

CASE;

// IF DTL.*CMD key is CF20
IF DTL.*CMD_key = '20';

// Call program DSP PD Traffic Comment DF.
CALL PROGRAM(DSP PD Traffic Comment DF) ('PDSKDFR');
PARAMETER(DTL.Load_ID);

ENDIF;

//?USER: Process command keys

// PAR.Load ID = DTL.Load ID USR
PAR.Load_ID = DTL.Load_ID_USR;

// PAR.Company Number = DTL.Company Number
PAR.Company_Number = DTL.Company_Number;

//?USER: Exit program processing

CASE;

// IF KEY.*CMD key is *Exit
IF KEY.*CMD_key = '03';

// PAR.USR Exit Program = CND.yes
PAR.USR_Exit_Program = 'Y';

ENDIF;

