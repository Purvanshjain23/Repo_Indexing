     H/TITLE Crt Ttt Com UnpEvalTranXF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     W* Warning: This program does not set on the LR indicator
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 01:24:32
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKA4CPL2IF  E           K        DISK
      * RSQ : Tattoo Header Comment     THC Comment, Line (D)
      *
     FPKA4CPL0IF  E           K        DISK                      A
      * UPD : Tattoo Header Comment     Update index
      *
     I@A4CPL3
      * Tattoo Header Comment     THC Comment, Line (D)
      * Renamed input format fields
     I              A4HMNB                          WAHMNB
     I              A4BNNB                          WABNNB
     I              A4BONB                          WABONB
     I              A4CVNB                          WACVNB
     I              A4B0DT                          WAB0DT
     I              A4BETX                          WABETX
     I              A4BFTX                          WABFTX
     I              A4ETST                          WAETST
     I              A4AAVN                          WAAAVN
     I              A4AADT                          WAAADT
     I              A4AMTM                          WAAMTM
     I              A4AJST                          WAAJST
     I              A4AHVN                          WAAHVN
     I              A4AGVN                          WAAGVN
     I              A4ABVN                          WAABVN
     I              A4ABDT                          WAABDT
     I              A4ABTM                          WAABTM
      *
     I@A4CPC3
      * Tattoo Header Comment     Update index
      * Renamed input format fields
     I              A4HMNB                          WBHMNB
     I              A4BNNB                          WBBNNB
     I              A4BONB                          WBBONB
     I              A4CVNB                          WBCVNB
     I              A4B0DT                          WBB0DT
     I              A4BETX                          WBBETX
     I              A4BFTX                          WBBFTX
     I              A4ETST                          WBETST
     I              A4AAVN                          WBAAVN
     I              A4AADT                          WBAADT
     I              A4AMTM                          WBAMTM
     I              A4AJST                          WBAJST
     I              A4AHVN                          WBAHVN
     I              A4AGVN                          WBAGVN
     I              A4ABVN                          WBABVN
     I              A4ABDT                          WBABDT
     I              A4ABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKA41    E DSPKA4CPL0
      * UPD : Tattoo Header Comment     Update index
      * Renamed input format fields
     I              A4HMNB                          WBHMNB
     I              A4BNNB                          WBBNNB
     I              A4BONB                          WBBONB
     I              A4CVNB                          WBCVNB
     I              A4B0DT                          WBB0DT
     I              A4BETX                          WBBETX
     I              A4BFTX                          WBBFTX
     I              A4ETST                          WBETST
     I              A4AAVN                          WBAAVN
     I              A4AADT                          WBAADT
     I              A4AMTM                          WBAMTM
     I              A4AJST                          WBAJST
     I              A4AHVN                          WBAHVN
     I              A4AGVN                          WBAGVN
     I              A4ABVN                          WBABVN
     I              A4ABDT                          WBABDT
     I              A4ABTM                          WBABTM
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Tattoo Header
      * I : MAP BOH Company Number
     I                                    P   1   20P1HMNB
      * I : MAP BOH Buy Order Number
     I                                    P   3   60P1BNNB
      * I : MAP BOL Load Number
     I                                    P   7   90P1BONB
      * I : MAP TH Tattoo Number
     I                                    P  10  120P1CVNB
      * I : MAP TH Kill Date
     I                                    P  13  160P1B0DT
     IP2PARM      DS
      * I : MAP Tattoo Action Usr
     I                                        1   2 P2L3ST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'UnP EvlTrnUpl Msg cmmnt'
      * BOH Buy Order Number
     I                                    P   1   40ZA0001
      * BOL Load Number
     I                                    P   5   70ZA0002
      * TH Tattoo Number
     I                                    P   8  100ZA0003
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HMNB    PARM           WP0001  30       BOH Company Num
     C           P1BNNB    PARM           WP0002  70       BOH Buy Order N
     C           P1BONB    PARM           WP0003  50       BOL Load Number
     C           P1CVNB    PARM           WP0004  50       TH Tattoo Numbe
     C           P1B0DT    PARM           WP0005  70       TH Kill Date
     C           P2L3ST    PARM           WP0006  2        Tattoo Action U
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Crt Ttt Com UnpEvalTranXF
      * MODIFICATIONS
      * 11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM
      * UnProcess the EvalTranUpl to allow user to run Balance to Kill
      * CASE: PAR.Tattoo Action Usr is Tattoo RePrc EvalTrnUpl
     C           P2L3ST    IFEQ 'ER'                       *IF
     C                     MOVELWUCRTX    WUBFTX           THC Comment
      * Setup message data for message
     C                     Z-ADDP1BNNB    ZA0001           BOH Buy Order N
     C                     Z-ADDP1BONB    ZA0002           BOL Load Number
     C                     Z-ADDP1CVNB    ZA0003           TH Tattoo Numbe
      * Retrieve message UnP EvlTrnUpl Msg cmmnt
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'PRK1165' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C           WUBFTX    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * -- YYMMDD to MMDDYY --
     C                     MOVEL*BLANK    WUCZCD           Date Alpha USR
     C                     MOVEL##JDT     WUCZCD           Date Alpha USR
     C                     MOVEL*BLANK    WUOITX           Date From Conve
     C                     MOVELWUCZCD    WUOITX           Date From Conve
      * Cvt Date              UP - STR Miscellaneous  * 
     C                     CALL 'PKPOUPR'              90  Cvt Date
     C                     PARM WUOITX    WQ0001 10        Date From Conve
     C           WUOJTX    PARM *BLANK    WQ0002 11        Date To Convert
     C                     PARM '*CYMD'   WQ0003  8        Date From Forma
     C                     PARM '*MDY'    WQ0004  8        Date To Format
     C                     PARM '*NONE'   WQ0005  7        Date Separator
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKPOUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVELWUOJTX    WUFLCD           Code USR
     C                     MOVE WUFLCD    WUTANB           Date Num 6 Usr
      * ---------------------
     C                     MOVEL*BLANK    WUDKCD           Date Alpha Usr
     C                     MOVELWUTANB    WUDKCD           Date Alpha Usr
     C                     Z-ADD1         ZQ      50
     C           WUBFTX    CAT  'Dt:':ZQ  WUBFTX    P      THC Comment
     C                     Z-ADD1         ZQ      50
     C           WUBFTX    CAT  WUDKCD:ZQ WUBFTX    P      THC Comment
     C                     MOVEL*BLANK    WUDICD           Time  Alpha Usr
     C                     MOVEL##JTM     WUDICD           Time  Alpha Usr
     C                     Z-ADD1         ZQ      50
     C           WUBFTX    CAT  'Tm:':ZQ  WUBFTX    P      THC Comment
     C                     Z-ADD1         ZQ      50
     C           WUBFTX    CAT  WUDICD:ZQ WUBFTX    P      THC Comment
      * Rtv Next Line Nbr     RT - Tattoo Header Comment  * 
     C                     EXSR SARVGN
      * Crt Tattoo Hdr Cmnt   CR - Tattoo Header Comment  * 
     C                     EXSR SBCRRC
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Next Line Nbr     RT - Tattoo Header Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSA01           BOH Company Num
     C           *LIKE     DEFN WABNNB    WQSA02           BOH Buy Order N
     C           *LIKE     DEFN WABONB    WQSA03           BOL Load Number
     C           *LIKE     DEFN WACVNB    WQSA04           TH Tattoo Numbe
     C           *LIKE     DEFN WAB0DT    WQSA05           TH Kill Date
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           BOH Company Num
     C                     KFLD           WQSA02           BOH Buy Order N
     C                     KFLD           WQSA03           BOL Load Number
     C                     KFLD           WQSA04           TH Tattoo Numbe
     C                     KFLD           WQSA05           TH Kill Date
      * Setup key
     C                     Z-ADDP1HMNB    WQSA01           BOH Company Num
     C                     Z-ADDP1BNNB    WQSA02           BOH Buy Order N
     C                     Z-ADDP1BONB    WQSA03           BOL Load Number
     C                     Z-ADDP1CVNB    WQSA04           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WQSA05           TH Kill Date
      * Establish starting position
     C           KRSSA     SETLL@A4CPL3                    *
     C           KRSSA     READE@A4CPL3                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0067' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WUBETX           THC Comment Lin
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WABETX    ADD  1         WUBETX           THC Comment Lin
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@A4CPL3                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Crt Tattoo Hdr Cmnt   CR - Tattoo Header Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @A4CPC3
     C                     Z-ADDP1HMNB    WBHMNB           BOH Company Num
     C                     Z-ADDP1BNNB    WBBNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    WBBONB           BOL Load Number
     C                     Z-ADDP1CVNB    WBCVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WBB0DT           TH Kill Date
     C                     Z-ADDWUBETX    WBBETX           THC Comment Lin
     C                     MOVELWUBFTX    WBBFTX           THC Comment
     C                     MOVEL'S'       WBETST           THC Comment Typ
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSB    KLIST
     C                     KFLD           WBHMNB           BOH Company Num
     C                     KFLD           WBBNNB           BOH Buy Order N
     C                     KFLD           WBBONB           BOL Load Number
     C                     KFLD           WBCVNB           TH Tattoo Numbe
     C                     KFLD           WBB0DT           TH Kill Date
     C                     KFLD           WBBETX           THC Comment Lin
      * Check for duplicate primary key
     C           KLCRSB    SETLL@A4CPC3                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0068' W0RTN   7
      * Send message 'Tattoo Header Comment  EX'
     C                     MOVEL'PRK0068' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@A4CPC3                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field THC Comment
     C                     MOVEL*BLANK    WUBFTX 60
      * Define work field Blank USR
     C                     MOVEL*BLANK    WUCRTX 80
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Date Alpha USR
     C                     MOVEL*BLANK    WUCZCD  7
      * Define work field Date From Convert USR
     C                     MOVEL*BLANK    WUOITX 10
      * Define work field Date To Convert USR
     C                     MOVEL*BLANK    WUOJTX 11
      * Define work field Code USR
     C                     MOVEL*BLANK    WUFLCD  6
      * Define work field Date Num 6 Usr
     C                     Z-ADD*ZERO     WUTANB  60
      * Define work field Date Alpha Usr 3
     C                     MOVEL*BLANK    WUDKCD  7
      * Define work field Time  Alpha Usr
     C                     MOVEL*BLANK    WUDICD  6
      * Define work field THC Comment Line
     C                     Z-ADD*ZERO     WUBETX  30
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WABETX           THC Comment Lin
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
