/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PMRKUPR                                       */
/*  PROGRAM NAME:    EMAIL RIN TRANSACTIONS                        */
/*  PROGRAMMER:      ROSE CENTONZE                                 */
/*  CREATE DATE:     04/25/12                                      */
/*                                                                 */
/*  FUNCTION:        THIS CLP IS SUBMITTED FROM A WW               */
/*                                                                 */
/*                   USER OPTIONS ARE PASSED THROUGH THE PARMS.    */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*  RMC  11/30/09 PASS BATCH SEQ PARM TO CL AND PRTF               */
/*  RMC  07/15/10 PASS TR DATE/WHSE/SOLD STS              */
/*  RMC  01/31/12 PASS QUANTITY TO SELL                   */
/*                                                                 */
/*******************************************************************/
      PGM        PARM(&RTN &COMP &ULSD &BATCHN &BSEQN  +
                &TDATEN &QTYN &WHSE &SOLD &TTYPE &EMAIL)
                                                                       /**/
/*-----------------------------------------------------------------*/
/*                      PARAMETER                                  */
/*-----------------------------------------------------------------*/
             DCL        VAR(&COMPN) TYPE(*DEC)
             DCL        VAR(&BATCHN) TYPE(*DEC)
             DCL        VAR(&TDATEN) TYPE(*DEC)
             DCL        VAR(&BSEQN) TYPE(*DEC)
             DCL        VAR(&QTYN) TYPE(*DEC)
/* EMAIL Options                                                   */
             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(50)

/* Function Specific                                               */
               DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)
               DCL        VAR(&BATCH) TYPE(*DEC) LEN(5 0)
               DCL        VAR(&BSEQ) TYPE(*DEC) LEN(5 0)
             DCL        VAR(&ULSD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&QTY) TYPE(*DEC) LEN(7 0)  /* QTY TO SELL */
               DCL        VAR(&TDATE) TYPE(*DEC) LEN(7 0)
               DCL        VAR(&TDATEA) TYPE(*CHAR) LEN(7)
               DCL        VAR(&WHSE) TYPE(*CHAR) LEN(3)
               DCL        VAR(&SOLD) TYPE(*CHAR) LEN(1)
               DCL        VAR(&TTYPE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&QTYA) TYPE(*CHAR) LEN(7)   /* QTY TO SELL */

        DCL     &A        *CHAR   100             /* QRY VIEW       */
        DCL     &AA       *CHAR   100             /* QRY RECIPIENT */
        DCL     &B        *CHAR   25              /* QRY DATE       */
        DCL     &C        *CHAR   25              /* QRY TYPE       */
        DCL     &D        *CHAR   25              /* QRY WHSE       */
        DCL     &E        *CHAR   25              /* QRY SOLD        */
        DCL     &F        *CHAR   25              /* QRY QTY         */
        DCL     &COMMAND  *CHAR   600

/*-----------------------------------------------------------------*/
/*                    PROGRAM VARIABLES                            */
/*-----------------------------------------------------------------*/
             CHGVAR     VAR(&COMP) VALUE(&COMPN)
             CHGVAR     VAR(&BATCH) VALUE(&BATCHN)
             CHGVAR     VAR(&BSEQ) VALUE(&BSEQN)
             CHGVAR     VAR(&TDATE) VALUE(&TDATEN)
             CHGVAR     VAR(&TDATEA) VALUE(&TDATE)
             CHGVAR     VAR(&QTY) VALUE(&QTYN)
             CHGVAR     VAR(&QTYA) VALUE(&QTY)

/*-----------------------------------------------------------------*/
/*                           MAIN                                  */
/*-----------------------------------------------------------------*/
       /*    EXECUTE    VIEW(HPBRINTRAN) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('HPB RIN +
                          TRANSACTIONS') SETVAR((&TDATE &TDATEA) +
                          (&TTYPE &TTYPE) (&WHSE &WHSE) +
                          (&SOLD &SOLD))                      */
/*-----------------------------------------------------------------*/
/*   CPYF PF TO PMDACPPX SO IT CAN BE JOINED TO ITSELF TO GET THE "BUY" */
/*   TRANS CORRESPONDING 361 ORDER AND LOAD                       */
/*-----------------------------------------------------------------*/
             CPYF       FROMFILE(PMDACPP) TOFILE(QTEMP/PMDACPPX) +
                          CRTFILE(*YES)
/*-----------------------------------------------------------------*/
  IF COND(&QTY=0) +
  THEN(CHGVAR VAR(&A)  VALUE('EXECUTE VIEW(HPBRINTRAN) PCFMT(*XLS)'))
  ELSE CHGVAR VAR(&A)  VALUE('EXECUTE VIEW(HPBRINTRAS) PCFMT(*XLS)')
  CHGVAR VAR(&AA) VALUE('RECIPIENT(''' *CAT &EMAIL *CAT ''')')
    /*   EMLMSG('HPB RIN TRANSACTIONS')          */
IF COND(&TDATEN > 0) THEN(CHGVAR VAR(&B) VALUE('SETVAR((&TDATE' *BCAT &TDATEA +
   *CAT ')'))
  ELSE CHGVAR (&B) VALUE('SETVAR((&TDATE *ALL)')

   IF COND(&TTYPE *NE ' ') THEN(CHGVAR VAR(&C) VALUE('(&TTYPE' *BCAT &TTYPE +
   *CAT ')'))
  ELSE CHGVAR (&C) VALUE('(&TTYPE *ALL)')

   IF COND(&WHSE *NE ' ') THEN(CHGVAR VAR(&D) VALUE('(&WHSE' *BCAT  &WHSE +
   *CAT ')'))
  ELSE CHGVAR (&D) VALUE('(&WHSE *ALL)')

   IF COND(&SOLD *NE ' ') THEN(CHGVAR VAR(&E) VALUE('(&SOLD' *BCAT &SOLD +
   *CAT ')'))
  ELSE CHGVAR (&E) VALUE('(&SOLD *ALL)')

    CHGVAR VAR(&F) VALUE('(&QTY ' *BCAT &QTYA +
   *CAT '))')


     CHGVAR     VAR(&COMMAND) VALUE(&A *BCAT &AA *Bcat &B *Bcat &C *Bcat +
                          &D *BCAT &E *BCAT &F)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 600)
/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 ENDPGM:
             DLTOVR     FILE(*ALL)

             ENDPGM
