     H/TITLE Ext Deallocated Combo XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 11/20/19  Time  : 16:13:42
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPBB2CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index
      *
     FPBB2CPL4IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Hdr  Retrieval index (2)
      *
     FPBB2CPL3IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Hdr  SntDt(D)/SntTm(D)
      *
     FPBC3CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Cgn  Retrieval index
      *
     FPBB1CPL4IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Dtl  Co/BcDt/Bc/Tm/Usr/Itm/Or
      *
     FPBB3CPL1IF  E           K        DISK
      * RTV : PFS Prod Sched Batch Sel  Retrieval index
      *
     FPBB1CPL5IF  E           K        DISK
      * RSQ : PFS Prod Sched Batch Dtl  Co/BcDt/BcTm/Usr/Itm/Ord
      *
     FPBB1CPL0IF  E           K        DISK                      A
      * UPD : PFS Prod Sched Batch Dtl  Update index
      *
      * Long constants
     E                    @CN#    1  02  6   @CN    25
     I@B2CPUQ
      * PFS Prod Sched Batch Hdr  Retrieval index
      * Renamed input format fields
     I              B2Y1NX                          WAY1NX
     I              B2ASD8                          WAASD8
     I              B2AOTS                          WAAOTS
     I              B2TVAA                          WATVAA
     I              B2B0SC                          WAB0SC
     I              B2ATD8                          WAATD8
     I              B2APTS                          WAAPTS
     I              B2UWSX                          WAUWSX
     I              B2UXSX                          WAUXSX
     I              B2V3SX                          WAV3SX
     I              B2AHNY                          WAAHNY
     I              B2AINY                          WAAINY
     I              B2AJNY                          WAAJNY
     I              B2AKNY                          WAAKNY
      *
     I@B2CPZE
      * PFS Prod Sched Batch Hdr  Retrieval index (2)
      * Renamed input format fields
     I              B2Y1NX                          WBY1NX
     I              B2ASD8                          WBASD8
     I              B2AOTS                          WBAOTS
     I              B2TVAA                          WBTVAA
     I              B2B0SC                          WBB0SC
     I              B2ATD8                          WBATD8
     I              B2APTS                          WBAPTS
     I              B2UWSX                          WBUWSX
     I              B2UXSX                          WBUXSX
     I              B2V3SX                          WBV3SX
     I              B2AHNY                          WBAHNY
     I              B2AINY                          WBAINY
     I              B2AJNY                          WBAJNY
     I              B2AKNY                          WBAKNY
      *
     I@B2CPW9
      * PFS Prod Sched Batch Hdr  SntDt(D)/SntTm(D)
      * Renamed input format fields
     I              B2Y1NX                          WCY1NX
     I              B2ASD8                          WCASD8
     I              B2AOTS                          WCAOTS
     I              B2TVAA                          WCTVAA
     I              B2B0SC                          WCB0SC
     I              B2ATD8                          WCATD8
     I              B2APTS                          WCAPTS
     I              B2UWSX                          WCUWSX
     I              B2UXSX                          WCUXSX
     I              B2V3SX                          WCV3SX
     I              B2AHNY                          WCAHNY
     I              B2AINY                          WCAINY
     I              B2AJNY                          WCAJNY
     I              B2AKNY                          WCAKNY
      *
     I@C3CPY1
      * PFS Prod Sched Batch Cgn  Retrieval index
      * Renamed input format fields
     I              C3Y1NX                          WDY1NX
     I              C3ASD8                          WDASD8
     I              C3AOTS                          WDAOTS
     I              C3TVAA                          WDTVAA
     I              C3BTSQ                          WDBTSQ
     I              C3P7DT                          WDP7DT
     I              C3Y2NX                          WDY2NX
     I              C3U2SX                          WDU2SX
     I              C3ZPNX                          WDZPNX
     I              C3ZXNX                          WDZXNX
     I              C3CSSC                          WDCSSC
     I              C3ODQY                          WDODQY
     I              C3INAL                          WDINAL
     I              C3C6NB                          WDC6NB
     I              C3C8NB                          WDC8NB
     I              C3FLQ1                          WDFLQ1
     I              C3FLQ2                          WDFLQ2
     I              C3ZGNX                          WDZGNX
     I              C3ZWNX                          WDZWNX
     I              C3ZSNX                          WDZSNX
     I              C3ZJNX                          WDZJNX
     I              C3ZKNX                          WDZKNX
     I              C3DNNB                          WDDNNB
     I              C3DONB                          WDDONB
     I              C3DRNB                          WDDRNB
     I              C3U0SX                          WDU0SX
     I              C3BZSC                          WDBZSC
     I              C3B3SC                          WDB3SC
     I              C3B0SC                          WDB0SC
     I              C3VISX                          WDVISX
     I              C3ZLSX                          WDZLSX
     I              C3VGSX                          WDVGSX
     I              C3OJU1                          WDOJU1
     I              C3UWSX                          WDUWSX
     I              C3UXSX                          WDUXSX
     I              C3V3SX                          WDV3SX
     I              C3AHNY                          WDAHNY
     I              C3AINY                          WDAINY
     I              C3AJNY                          WDAJNY
     I              C3AKNY                          WDAKNY
      *
     I@B1CPXA
      * PFS Prod Sched Batch Dtl  Co/BcDt/Bc/Tm/Usr/Itm/Or
      * Renamed input format fields
     I              B1Y1NX                          WEY1NX
     I              B1ASD8                          WEASD8
     I              B1AOTS                          WEAOTS
     I              B1TVAA                          WETVAA
     I              B1BTSQ                          WEBTSQ
     I              B1P7DT                          WEP7DT
     I              B1Y2NX                          WEY2NX
     I              B1U2SX                          WEU2SX
     I              B1ZPNX                          WEZPNX
     I              B1ZXNX                          WEZXNX
     I              B1CSSC                          WECSSC
     I              B1ODQY                          WEODQY
     I              B1INAL                          WEINAL
     I              B1C6NB                          WEC6NB
     I              B1C8NB                          WEC8NB
     I              B1FLQ1                          WEFLQ1
     I              B1FLQ2                          WEFLQ2
     I              B1ZGNX                          WEZGNX
     I              B1ZWNX                          WEZWNX
     I              B1ZSNX                          WEZSNX
     I              B1ZJNX                          WEZJNX
     I              B1ZKNX                          WEZKNX
     I              B1DNNB                          WEDNNB
     I              B1DONB                          WEDONB
     I              B1DRNB                          WEDRNB
     I              B1U0SX                          WEU0SX
     I              B1BZSC                          WEBZSC
     I              B1B3SC                          WEB3SC
     I              B1B0SC                          WEB0SC
     I              B1VISX                          WEVISX
     I              B1ZLSX                          WEZLSX
     I              B1VGSX                          WEVGSX
     I              B1OJU1                          WEOJU1
     I              B1UWSX                          WEUWSX
     I              B1UXSX                          WEUXSX
     I              B1V3SX                          WEV3SX
     I              B1AHNY                          WEAHNY
     I              B1AINY                          WEAINY
     I              B1AJNY                          WEAJNY
     I              B1AKNY                          WEAKNY
      *
     I@B3CPUW
      * PFS Prod Sched Batch Sel  Retrieval index
      * Renamed input format fields
     I              B3Y1NX                          WFY1NX
     I              B3ASD8                          WFASD8
     I              B3AOTS                          WFAOTS
     I              B3TVAA                          WFTVAA
     I              B3DNNB                          WFDNNB
     I              B3DONB                          WFDONB
     I              B3UWSX                          WFUWSX
     I              B3UXSX                          WFUXSX
     I              B3V3SX                          WFV3SX
     I              B3AHNY                          WFAHNY
     I              B3AINY                          WFAINY
     I              B3AJNY                          WFAJNY
     I              B3AKNY                          WFAKNY
      *
     I@B1CPZJ
      * PFS Prod Sched Batch Dtl  Co/BcDt/BcTm/Usr/Itm/Ord
      * Renamed input format fields
     I              B1Y1NX                          WGY1NX
     I              B1ASD8                          WGASD8
     I              B1AOTS                          WGAOTS
     I              B1TVAA                          WGTVAA
     I              B1BTSQ                          WGBTSQ
     I              B1P7DT                          WGP7DT
     I              B1Y2NX                          WGY2NX
     I              B1U2SX                          WGU2SX
     I              B1ZPNX                          WGZPNX
     I              B1ZXNX                          WGZXNX
     I              B1CSSC                          WGCSSC
     I              B1ODQY                          WGODQY
     I              B1INAL                          WGINAL
     I              B1C6NB                          WGC6NB
     I              B1C8NB                          WGC8NB
     I              B1FLQ1                          WGFLQ1
     I              B1FLQ2                          WGFLQ2
     I              B1ZGNX                          WGZGNX
     I              B1ZWNX                          WGZWNX
     I              B1ZSNX                          WGZSNX
     I              B1ZJNX                          WGZJNX
     I              B1ZKNX                          WGZKNX
     I              B1DNNB                          WGDNNB
     I              B1DONB                          WGDONB
     I              B1DRNB                          WGDRNB
     I              B1U0SX                          WGU0SX
     I              B1BZSC                          WGBZSC
     I              B1B3SC                          WGB3SC
     I              B1B0SC                          WGB0SC
     I              B1VISX                          WGVISX
     I              B1ZLSX                          WGZLSX
     I              B1VGSX                          WGVGSX
     I              B1OJU1                          WGOJU1
     I              B1UWSX                          WGUWSX
     I              B1UXSX                          WGUXSX
     I              B1V3SX                          WGV3SX
     I              B1AHNY                          WGAHNY
     I              B1AINY                          WGAINY
     I              B1AJNY                          WGAJNY
     I              B1AKNY                          WGAKNY
      *
     I@B1CPUS
      * PFS Prod Sched Batch Dtl  Update index
      * Renamed input format fields
     I              B1Y1NX                          WHY1NX
     I              B1ASD8                          WHASD8
     I              B1AOTS                          WHAOTS
     I              B1TVAA                          WHTVAA
     I              B1BTSQ                          WHBTSQ
     I              B1P7DT                          WHP7DT
     I              B1Y2NX                          WHY2NX
     I              B1U2SX                          WHU2SX
     I              B1ZPNX                          WHZPNX
     I              B1ZXNX                          WHZXNX
     I              B1CSSC                          WHCSSC
     I              B1ODQY                          WHODQY
     I              B1INAL                          WHINAL
     I              B1C6NB                          WHC6NB
     I              B1C8NB                          WHC8NB
     I              B1FLQ1                          WHFLQ1
     I              B1FLQ2                          WHFLQ2
     I              B1ZGNX                          WHZGNX
     I              B1ZWNX                          WHZWNX
     I              B1ZSNX                          WHZSNX
     I              B1ZJNX                          WHZJNX
     I              B1ZKNX                          WHZKNX
     I              B1DNNB                          WHDNNB
     I              B1DONB                          WHDONB
     I              B1DRNB                          WHDRNB
     I              B1U0SX                          WHU0SX
     I              B1BZSC                          WHBZSC
     I              B1B3SC                          WHB3SC
     I              B1B0SC                          WHB0SC
     I              B1VISX                          WHVISX
     I              B1ZLSX                          WHZLSX
     I              B1VGSX                          WHVGSX
     I              B1OJU1                          WHOJU1
     I              B1UWSX                          WHUWSX
     I              B1UXSX                          WHUXSX
     I              B1V3SX                          WHV3SX
     I              B1AHNY                          WHAHNY
     I              B1AINY                          WHAINY
     I              B1AJNY                          WHAJNY
     I              B1AKNY                          WHAKNY
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPBB11    E DSPBB1CPL0
      * UPD : PFS Prod Sched Batch Dtl  Update index
      * Renamed input format fields
     I              B1Y1NX                          WHY1NX
     I              B1ASD8                          WHASD8
     I              B1AOTS                          WHAOTS
     I              B1TVAA                          WHTVAA
     I              B1BTSQ                          WHBTSQ
     I              B1P7DT                          WHP7DT
     I              B1Y2NX                          WHY2NX
     I              B1U2SX                          WHU2SX
     I              B1ZPNX                          WHZPNX
     I              B1ZXNX                          WHZXNX
     I              B1CSSC                          WHCSSC
     I              B1ODQY                          WHODQY
     I              B1INAL                          WHINAL
     I              B1C6NB                          WHC6NB
     I              B1C8NB                          WHC8NB
     I              B1FLQ1                          WHFLQ1
     I              B1FLQ2                          WHFLQ2
     I              B1ZGNX                          WHZGNX
     I              B1ZWNX                          WHZWNX
     I              B1ZSNX                          WHZSNX
     I              B1ZJNX                          WHZJNX
     I              B1ZKNX                          WHZKNX
     I              B1DNNB                          WHDNNB
     I              B1DONB                          WHDONB
     I              B1DRNB                          WHDRNB
     I              B1U0SX                          WHU0SX
     I              B1BZSC                          WHBZSC
     I              B1B3SC                          WHB3SC
     I              B1B0SC                          WHB0SC
     I              B1VISX                          WHVISX
     I              B1ZLSX                          WHZLSX
     I              B1VGSX                          WHVGSX
     I              B1OJU1                          WHOJU1
     I              B1UWSX                          WHUWSX
     I              B1UXSX                          WHUXSX
     I              B1V3SX                          WHV3SX
     I              B1AHNY                          WHAHNY
     I              B1AINY                          WHAINY
     I              B1AJNY                          WHAJNY
     I              B1AKNY                          WHAKNY
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: PFS Prod Sched Batch Hdr
      * I :  PFS Company Number
     I                                        1   30P1Y1NX
      * I :  PFS Batch Date
     I                                        4  110P1ASD8
      * I :  PFS Batch Time
     I                                       12  170P1AOTS
      * I :  PFS User ID
     I                                       18  27 P1TVAA
     IP2PARM      DS
      * FLD: PFS Prod Sched Batch Dtl
      * I :  PFS Batch Seq
     I                                    P   1   40P2BTSQ
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1Y1NX    PARM           WP0001  30       PFS Company Num
     C           P1ASD8    PARM           WP0002  80       PFS Batch Date
     C           P1AOTS    PARM           WP0003  60       PFS Batch Time
     C           P1TVAA    PARM           WP0004 10        PFS User ID
     C           P2BTSQ    PARM           WP0005  70       PFS Batch Seq
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Ext Deallocated Combo XF
      * Determine if Current PFS Prod Sched Batch Hdr is B=Baseline
      * Rtv PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SARVGN
      * R9281 JJH 02/16/17 - Determine if intial Baseline for Com/Prd Dat
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SBRVGN
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.PFS Baseline Schedule is Baseline
      *   |- c2    : LCL.PFS Baseline Schedule Cnt is Equal (1)
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0001    IFEQ 'B'                        *IF
     C           YL0006    IFEQ 1                          *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Determine the Previous PFS Prod Sched Batch Hdr
      * E12065 JJH 11/14/17 - Correct logic to get Previous Batch
      * E14163 JJH 12/13/18 - Rtv Previous Batch with PFS Create Date/Tim
      * Rtv Prev ProdSchBtHdr RT - PFS Prod Sched Batch Hdr  * 
     C                     EXSR SCRVGN
      * Compare Previous with Current PFS Prod Sched Batch Dtl, and creat
      * Zero Qty to Fill Transaction if Deallocated Combo
      * E7453 JJH 10/10/16 - Missing items on New Production Schedule
      * R9035 JJH 01/31/17 - Compare to PFS Prod Sched Batch Cgn
      * R9372 JJH 02/23/17 - Changes between Current Prd Day and Work Ahe
      * E12065 JJH 11/13/17 - Correct Duplicate PFS Sequence Number
      * Rtv Deallocated Combo RT - PFS Prod Sched Batch Cgn  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDYL0008    WL0001           PFS Company Num
     C                     Z-ADDYL0009    WL0002           PFS Batch Date
     C                     Z-ADDYL0010    WL0003           PFS Batch Time
     C                     MOVELYL0011    WL0004    P      PFS User ID
     C                     Z-ADDP2BTSQ    WL0005           PFS Batch Seq
     C                     Z-ADDP1Y1NX    WL0006           PFS Company Num
     C                     Z-ADDP1ASD8    WL0007           PFS Batch Date
     C                     Z-ADDP1AOTS    WL0008           PFS Batch Time
     C                     MOVELP1TVAA    WL0009    P      PFS User ID Ori
     C                     EXSR SDRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv PFS Prd Sch Bt Hd RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAASD8           PFS Batch Date
     C                     KFLD           WAAOTS           PFS Batch Time
     C                     KFLD           WATVAA           PFS User ID
      * Setup key
     C                     Z-ADDP1Y1NX    WAY1NX           PFS Company Num
     C                     Z-ADDP1ASD8    WAASD8           PFS Batch Date
     C                     Z-ADDP1AOTS    WAAOTS           PFS Batch Time
     C                     MOVELP1TVAA    WATVAA           PFS User ID
      * Establish starting position
     C           KRSSA     CHAIN@B2CPUQ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4806' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           PFS Baseline Sc
     C                     Z-ADD*ZERO     YL0002           PFS Batch Sent
     C                     Z-ADD*ZERO     YL0003           PFS Batch Sent
     C                     Z-ADD*ZERO     YL0004           PFS Create Date
     C                     Z-ADD*ZERO     YL0005           PFS Create Time
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAB0SC    YL0001           PFS Baseline Sc
     C                     Z-ADDWAATD8    YL0002           PFS Batch Sent
     C                     Z-ADDWAAPTS    YL0003           PFS Batch Sent
     C                     Z-ADDWAAHNY    YL0004           PFS Create Date
     C                     Z-ADDWAAINY    YL0005           PFS Create Time
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Baseline Co/PrdDt RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0007           PFS Baseline Sc
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBY1NX    WQSB01           PFS Company Num
     C           *LIKE     DEFN WBASD8    WQSB02           PFS Batch Date
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           PFS Company Num
     C                     KFLD           WQSB02           PFS Batch Date
      * Setup key
     C                     Z-ADDP1Y1NX    WQSB01           PFS Company Num
     C                     Z-ADDP1ASD8    WQSB02           PFS Batch Date
      * Establish starting position
     C           KRSSB     SETLL@B2CPZE                    *
     C           KRSSB     READE@B2CPZE                  90*
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Baseline Schedule is Baseline
     C           WBB0SC    IFEQ 'B'                        *IF
     C                     ADD  1         YL0007           PFS Baseline Sc
     C                     END                             *FI
     C           KRSSB     READE@B2CPZE                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     Z-ADDYL0007    YL0006           PFS Baseline Sc
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Prev ProdSchBtHdr RT - PFS Prod Sched Batch Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0012           Count USR
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCY1NX    WQSC01           PFS Company Num
     C           *LIKE     DEFN WCATD8    WQSC02           PFS Batch Sent
      * Define keylist
     C           KPSSC     KLIST
     C                     KFLD           WQSC01           PFS Company Num
     C                     KFLD           WQSC02           PFS Batch Sent
     C                     KFLD           WCAPTS           PFS Batch Sent
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           PFS Company Num
     C                     KFLD           WQSC02           PFS Batch Sent
      * Setup key
     C                     Z-ADDP1Y1NX    WQSC01           PFS Company Num
     C                     Z-ADDYL0004    WQSC02           PFS Batch Sent
     C                     Z-ADDYL0005    WCAPTS           PFS Batch Sent
      * Establish starting position
     C           KPSSC     SETLL@B2CPW9                    *
     C           KRSSC     READE@B2CPW9                  90*
      * Data record not found
     C   90                MOVEL'USR4806' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Process Status is Sent
     C           WCUXSX    IFEQ 9                          *IF
     C                     ADD  1         YL0012           Count USR
      * CASE: LCL.Count USR is EQ 2
     C           YL0012    IFEQ 2                          *IF
      * PAR = DB1 By name
     C                     Z-ADDWCY1NX    YL0008           PFS Company Num
     C                     Z-ADDWCASD8    YL0009           PFS Batch Date
     C                     Z-ADDWCAOTS    YL0010           PFS Batch Time
     C                     MOVELWCTVAA    YL0011           PFS User ID
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSC     READE@B2CPW9                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Deallocated Combo RT - PFS Prod Sched Batch Cgn  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * E14252 JJH 12/17/18 - Add I/RST Order Detail Line comparison
      * - Vfy PFS Prd Sch Bt Dt RT - PFS Prod Sched Batch Dtl
      * E12852 JJH 03/28/18 - PFS Batch Seq for PFS Prod Sched Batch Cgn
      * - Obtain the next PFS Batch Seq by retrieving the Last used PFS B
      *   Seq by reading the PFS Prod Sched Batch Cgn file in Descending
      *   order by PFS Batch Seq.
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDY1NX    WQSD01           PFS Company Num
     C           *LIKE     DEFN WDASD8    WQSD02           PFS Batch Date
     C           *LIKE     DEFN WDAOTS    WQSD03           PFS Batch Time
     C           *LIKE     DEFN WDTVAA    WQSD04           PFS User ID
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           PFS Company Num
     C                     KFLD           WQSD02           PFS Batch Date
     C                     KFLD           WQSD03           PFS Batch Time
     C                     KFLD           WQSD04           PFS User ID
      * Setup key
     C                     Z-ADDWL0001    WQSD01           PFS Company Num
     C                     Z-ADDWL0002    WQSD02           PFS Batch Date
     C                     Z-ADDWL0003    WQSD03           PFS Batch Time
     C                     MOVELWL0004    WQSD04           PFS User ID
      * Establish starting position
     C           KRSSD     SETLL@C3CPY1                    *
     C           KRSSD     READE@C3CPY1                  90*
      * Data record not found
     C   90                MOVEL'USR4965' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND NOT c2
      *   |- c1    : DB1.PFS Primary UOM is Combo
      *   |- c2    : DB1.PFS Order Line Sts is Cancelled
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WDU0SX    IFEQ 'CB'                       *IF
     C           WDCSSC    IFEQ 'X'                        *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * RTV PFS PrdSchBtDt Ex RT - PFS Prod Sched Batch Dtl  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWL0006    WL0010           PFS Company Num
     C                     Z-ADDWL0007    WL0011           PFS Batch Date
     C                     Z-ADDWL0008    WL0012           PFS Batch Time
     C                     MOVELWL0009    WL0013    P      PFS User ID
     C                     Z-ADDWDY2NX    WL0014           PFS Item Code
     C                     Z-ADDWDZPNX    WL0015           PFS Order Numbe
     C                     MOVELWDB0SC    WL0016    P      PFS Baseline Sc
     C                     EXSR SERVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,001                    *IF
      * Verify that the item to be compared is in the Selection Criteria
      * Rtv PFS Prd Sch Bt Dt Rt - PFS Prod Sched Batch Sel  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWL0006    WL0017           PFS Company Num
     C                     Z-ADDWL0007    WL0018           PFS Batch Date
     C                     Z-ADDWL0008    WL0019           PFS Batch Time
     C                     MOVELWL0009    WL0020    P      PFS User ID
     C                     Z-ADDWDDNNB    WL0021           PFS Item Struct
     C                     Z-ADDWDDONB    WL0022           PFS Item Struct
     C                     EXSR SFRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ @CN,002                    *IF
     C                     Z-ADDWL0006    YL0013           PFS Company Num
     C                     Z-ADDWL0007    YL0014           PFS Batch Date
     C                     Z-ADDWL0008    YL0015           PFS Batch Time
     C                     MOVELWL0009    YL0016           PFS User ID
     C                     Z-ADD0         YL0017           PFS Fill Qty Pr
     C                     Z-ADD0         YL0018           PFS Fill Qty Sh
     C                     Z-ADD0         YL0019           PFS Fill Qty Sh
     C                     Z-ADD0         YL0020           PFS Fill Qty Sh
     C                     MOVEL'X'       YL0021           PFS Order Line
      * R9035 JJH 01/31/17 - Do not send as B=Baseline
      * CASE: DB1.PFS Baseline Schedule is Baseline
     C           WDB0SC    IFEQ 'B'                        *IF
     C                     MOVEL*BLANK    YL0022           PFS Baseline Sc
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWDB0SC    YL0022           PFS Baseline Sc
     C                     END                             *FI
      * E9441 JJH 03/03/17 - Verify record does not exist
      * E14252 JJH 12/17/18 - Add I/RST Order Detail Line comparison
      * Vfy PFS Prd Sch Bt Dt RT - PFS Prod Sched Batch Dtl  * 
     C                     EXSR SGRVGN
      * CASE: LCL.Record Found USR is Record Not Found
     C           YL0023    IFEQ 'N'                        *IF
      * E12852 JJH 03/28/18 - Obtain next PFS Batch Seq
      * Rtv Last PFS Batch SeqXF - PFS Prod Sched Batch Dtl  * 
     C                     CALL 'PUGUXFR'              90  Rtv Last PFS Ba
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WL0006    WQ0001  30       PFS Company Num
     C                     PARM WL0007    WQ0002  80       PFS Batch Date
     C                     PARM WL0008    WQ0003  60       PFS Batch Time
     C                     PARM WL0009    WQ0004 10        PFS User ID
     C           YL0024    PARM *ZERO     WQ0005  70       PFS Batch Seq
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUGUXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * R15794 DN 11/20/19-Set New Fields.
      * Crt PFS Prd Sch Bt Dt CR - PFS Prod Sched Batch Dtl  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDYL0013    WL0023           PFS Company Num
     C                     Z-ADDYL0014    WL0024           PFS Batch Date
     C                     Z-ADDYL0015    WL0025           PFS Batch Time
     C                     MOVELYL0016    WL0026    P      PFS User ID
     C                     Z-ADDYL0024    WL0027           PFS Batch Seq
     C                     Z-ADDWDP7DT    WL0028           PFS Production
     C                     Z-ADDWDY2NX    WL0029           PFS Item Code
     C                     MOVELWDU2SX    WL0030    P      PFS Label Type
     C                     Z-ADDWDZPNX    WL0031           PFS Order Numbe
     C                     Z-ADDWDZXNX    WL0032           PFS Order Line
     C                     MOVELYL0021    WL0033    P      PFS Order Line
     C                     Z-ADDWDODQY    WL0034           PFS Ordered Qty
     C                     Z-ADDWDINAL    WL0035           PFS Inventory A
     C                     Z-ADDYL0017    WL0036           PFS Fill Qty Pr
     C                     Z-ADDYL0018    WL0037           PFS Fill Qty Sh
     C                     Z-ADDYL0019    WL0038           PFS Fill Qty Sh
     C                     Z-ADDYL0020    WL0039           PFS Fill Qty Sh
     C                     Z-ADDWDZGNX    WL0040           PFS Load ID
     C                     Z-ADDWDZWNX    WL0041           PFS Loading Seq
     C                     Z-ADDWDZSNX    WL0042           PFS Scheduled S
     C                     Z-ADDWDZJNX    WL0043           PFS Load Deadli
     C                     Z-ADDWDZKNX    WL0044           PFS Load Deadli
     C                     Z-ADDWDDNNB    WL0045           PFS Item Struct
     C                     Z-ADDWDDONB    WL0046           PFS Item Struct
     C                     Z-ADDWDDRNB    WL0047           PFS Item Struct
     C                     MOVELWDU0SX    WL0048    P      PFS Primary UOM
     C                     MOVELWDBZSC    WL0049    P      PFS Fresh/Froze
     C                     MOVELWDB3SC    WL0050    P      PFS Base/Conver
     C                     MOVELYL0022    WL0051    P      PFS Baseline Sc
     C                     MOVELWDVISX    WL0052    P      PFS Palletize
     C                     MOVELWDZLSX    WL0053    P      PFS Pallet Type
     C                     MOVELWDVGSX    WL0054    P      PFS Slip Sheet
     C                     MOVELWDOJU1    WL0055    P      PFS Customer Na
     C                     MOVELWDUWSX    WL0056    P      PFS Record Stat
     C                     Z-ADDWDUXSX    WL0057           PFS Process Sta
     C                     MOVELWDV3SX    WL0058    P      PFS Error Reaso
     C                     Z-ADDWDAHNY    WL0059           PFS Create Date
     C                     Z-ADDWDAINY    WL0060           PFS Create Time
     C                     Z-ADDWDAJNY    WL0061           PFS Change Date
     C                     Z-ADDWDAKNY    WL0062           PFS Change time
     C                     EXSR SHCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSD     READE@C3CPY1                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV PFS PrdSchBtDt Ex RT - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEY1NX    WQSE01           PFS Company Num
     C           *LIKE     DEFN WEASD8    WQSE02           PFS Batch Date
     C           *LIKE     DEFN WEAOTS    WQSE03           PFS Batch Time
     C           *LIKE     DEFN WETVAA    WQSE04           PFS User ID
     C           *LIKE     DEFN WEY2NX    WQSE05           PFS Item Code
     C           *LIKE     DEFN WEZPNX    WQSE06           PFS Order Numbe
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           PFS Company Num
     C                     KFLD           WQSE02           PFS Batch Date
     C                     KFLD           WQSE03           PFS Batch Time
     C                     KFLD           WQSE04           PFS User ID
     C                     KFLD           WQSE05           PFS Item Code
     C                     KFLD           WQSE06           PFS Order Numbe
      * Setup key
     C                     Z-ADDWL0010    WQSE01           PFS Company Num
     C                     Z-ADDWL0011    WQSE02           PFS Batch Date
     C                     Z-ADDWL0012    WQSE03           PFS Batch Time
     C                     MOVELWL0013    WQSE04           PFS User ID
     C                     Z-ADDWL0014    WQSE05           PFS Item Code
     C                     Z-ADDWL0015    WQSE06           PFS Order Numbe
      * Establish starting position
     C           KRSSE     SETLL@B1CPXA                    *
     C           KRSSE     READE@B1CPXA                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4804' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * R9372 JJH 02/23/17 - Changes between Current Prd Day and Work Ahe
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.PFS Baseline Schedule is Not Baseline
      *   |- c2    : PAR.PFS Baseline Schedule is Baseline
      *   '-
     C           WL0016    IFEQ *BLANK                     *IF
     C           WL0016    OREQ 'B'                        *OR
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.PFS Baseline Schedule is Baseline
      *   |- c2    : DB1.PFS Baseline Schedule is Not Baseline
      *   '-
     C           WEB0SC    IFEQ 'B'                        *IF
     C           WEB0SC    OREQ *BLANK                     *OR
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     GOTO SEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.PFS Baseline Schedule is Work Ahead
     C           WL0016    IFEQ 'W'                        *IF
      * CASE: DB1.PFS Baseline Schedule is Work Ahead
     C           WEB0SC    IFEQ 'W'                        *IF
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     GOTO SEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSE     READE@B1CPXA                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv PFS Prd Sch Bt Dt Rt - PFS Prod Sched Batch Sel  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WFY1NX           PFS Company Num
     C                     KFLD           WFASD8           PFS Batch Date
     C                     KFLD           WFAOTS           PFS Batch Time
     C                     KFLD           WFTVAA           PFS User ID
     C                     KFLD           WFDNNB           PFS Item Struct
     C                     KFLD           WFDONB           PFS Item Struct
      * Setup key
     C                     Z-ADDWL0017    WFY1NX           PFS Company Num
     C                     Z-ADDWL0018    WFASD8           PFS Batch Date
     C                     Z-ADDWL0019    WFAOTS           PFS Batch Time
     C                     MOVELWL0020    WFTVAA           PFS User ID
     C                     Z-ADDWL0021    WFDNNB           PFS Item Struct
     C                     Z-ADDWL0022    WFDONB           PFS Item Struct
      * Establish starting position
     C           KRSSF     CHAIN@B3CPUW              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4808' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Vfy PFS Prd Sch Bt Dt RT - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGY1NX    WQSG01           PFS Company Num
     C           *LIKE     DEFN WGASD8    WQSG02           PFS Batch Date
     C           *LIKE     DEFN WGAOTS    WQSG03           PFS Batch Time
     C           *LIKE     DEFN WGTVAA    WQSG04           PFS User ID
     C           *LIKE     DEFN WGY2NX    WQSG05           PFS Item Code
     C           *LIKE     DEFN WGZPNX    WQSG06           PFS Order Numbe
     C           *LIKE     DEFN WGZXNX    WQSG07           PFS Order Line
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           PFS Company Num
     C                     KFLD           WQSG02           PFS Batch Date
     C                     KFLD           WQSG03           PFS Batch Time
     C                     KFLD           WQSG04           PFS User ID
     C                     KFLD           WQSG05           PFS Item Code
     C                     KFLD           WQSG06           PFS Order Numbe
     C                     KFLD           WQSG07           PFS Order Line
      * Setup key
     C                     Z-ADDYL0013    WQSG01           PFS Company Num
     C                     Z-ADDYL0014    WQSG02           PFS Batch Date
     C                     Z-ADDYL0015    WQSG03           PFS Batch Time
     C                     MOVELYL0016    WQSG04           PFS User ID
     C                     Z-ADDWDY2NX    WQSG05           PFS Item Code
     C                     Z-ADDWDZPNX    WQSG06           PFS Order Numbe
     C                     Z-ADDWDZXNX    WQSG07           PFS Order Line
      * Establish starting position
     C           KRSSG     SETLL@B1CPZJ                    *
     C           KRSSG     READE@B1CPZJ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4804' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       YL0023           Record Found US
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.PFS Baseline Schedule is Baseline
      *   |- c2    : PAR.PFS Baseline Schedule is Not Baseline
      *   '-
     C           YL0022    IFEQ 'B'                        *IF
     C           YL0022    OREQ *BLANK                     *OR
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.PFS Baseline Schedule is Baseline
      *   |- c2    : DB1.PFS Baseline Schedule is Not Baseline
      *   '-
     C           WGB0SC    IFEQ 'B'                        *IF
     C           WGB0SC    OREQ *BLANK                     *OR
     C                     MOVEL'Y'       YL0023           Record Found US
     C                     GOTO SGEXIT                     *QUIT
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.PFS Baseline Schedule is Work Ahead
     C           YL0022    IFEQ 'W'                        *IF
      * CASE: DB1.PFS Baseline Schedule is Work Ahead
     C           WGB0SC    IFEQ 'W'                        *IF
     C                     MOVEL'Y'       YL0023           Record Found US
     C                     GOTO SGEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSG     READE@B1CPZJ                  90*
     C                     ENDDO
      * USER: Exit processing
     C                     MOVEL'N'       YL0023           Record Found US
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCRRC    BEGSR
      *================================================================
      * Crt PFS Prd Sch Bt Dt CR - PFS Prod Sched Batch Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @B1CPUS
     C                     Z-ADDWL0023    WHY1NX           PFS Company Num
     C                     Z-ADDWL0024    WHASD8           PFS Batch Date
     C                     Z-ADDWL0025    WHAOTS           PFS Batch Time
     C                     MOVELWL0026    WHTVAA           PFS User ID
     C                     Z-ADDWL0027    WHBTSQ           PFS Batch Seq
     C                     Z-ADDWL0028    WHP7DT           PFS Production
     C                     Z-ADDWL0029    WHY2NX           PFS Item Code
     C                     MOVELWL0030    WHU2SX           PFS Label Type
     C                     Z-ADDWL0031    WHZPNX           PFS Order Numbe
     C                     Z-ADDWL0032    WHZXNX           PFS Order Line
     C                     MOVELWL0033    WHCSSC           PFS Order Line
     C                     Z-ADDWL0034    WHODQY           PFS Ordered Qty
     C                     Z-ADDWL0035    WHINAL           PFS Inventory A
     C                     Z-ADDWL0036    WHC6NB           PFS Fill Qty Pr
     C                     Z-ADDWL0037    WHC8NB           PFS Fill Qty Sh
     C                     Z-ADDWL0038    WHFLQ1           PFS Fill Qty Sh
     C                     Z-ADDWL0039    WHFLQ2           PFS Fill Qty Sh
     C                     Z-ADDWL0040    WHZGNX           PFS Load ID
     C                     Z-ADDWL0041    WHZWNX           PFS Loading Seq
     C                     Z-ADDWL0042    WHZSNX           PFS Scheduled S
     C                     Z-ADDWL0043    WHZJNX           PFS Load Deadli
     C                     Z-ADDWL0044    WHZKNX           PFS Load Deadli
     C                     Z-ADDWL0045    WHDNNB           PFS Item Struct
     C                     Z-ADDWL0046    WHDONB           PFS Item Struct
     C                     Z-ADDWL0047    WHDRNB           PFS Item Struct
     C                     MOVELWL0048    WHU0SX           PFS Primary UOM
     C                     MOVELWL0049    WHBZSC           PFS Fresh/Froze
     C                     MOVELWL0050    WHB3SC           PFS Base/Conver
     C                     MOVELWL0051    WHB0SC           PFS Baseline Sc
     C                     MOVELWL0052    WHVISX           PFS Palletize
     C                     MOVELWL0053    WHZLSX           PFS Pallet Type
     C                     MOVELWL0054    WHVGSX           PFS Slip Sheet
     C                     MOVELWL0055    WHOJU1           PFS Customer Na
     C                     MOVELWL0056    WHUWSX           PFS Record Stat
     C                     Z-ADDWL0057    WHUXSX           PFS Process Sta
     C                     MOVELWL0058    WHV3SX           PFS Error Reaso
     C                     Z-ADDWL0059    WHAHNY           PFS Create Date
     C                     Z-ADDWL0060    WHAINY           PFS Create Time
     C                     Z-ADDWL0061    WHAJNY           PFS Change Date
     C                     Z-ADDWL0062    WHAKNY           PFS Change time
      *
     C           KLCRSH    KLIST
     C                     KFLD           WHY1NX           PFS Company Num
     C                     KFLD           WHASD8           PFS Batch Date
     C                     KFLD           WHAOTS           PFS Batch Time
     C                     KFLD           WHTVAA           PFS User ID
     C                     KFLD           WHBTSQ           PFS Batch Seq
      * Check for duplicate primary key
     C           KLCRSH    SETLL@B1CPUS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR4805' W0RTN   7
      * Send message 'PFS Prod Sched Batch D EX'
     C                     MOVEL'USR4805' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C                     WRITE@B1CPUS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WAAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WAATD8           PFS Batch Sent
     C                     Z-ADD*ZERO     WAAPTS           PFS Batch Sent
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WDASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WDAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WDBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WDP7DT           PFS Production
     C                     Z-ADD*ZERO     WDY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WDZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WDZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WDODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WDINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WDC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WDC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WDZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WDZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WDZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WDZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WDZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WDDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WDDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WDDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WDUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WDAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WDAINY           PFS Create Time
     C                     Z-ADD*ZERO     WDAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WDAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WEASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WEAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WEBTSQ           PFS Batch Seq
     C                     Z-ADD*ZERO     WEP7DT           PFS Production
     C                     Z-ADD*ZERO     WEY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WEZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WEZXNX           PFS Order Line
     C                     Z-ADD*ZERO     WEODQY           PFS Ordered Qty
     C                     Z-ADD*ZERO     WEINAL           PFS Inventory A
     C                     Z-ADD*ZERO     WEC6NB           PFS Fill Qty Pr
     C                     Z-ADD*ZERO     WEC8NB           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WEFLQ1           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WEFLQ2           PFS Fill Qty Sh
     C                     Z-ADD*ZERO     WEZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WEZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WEZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WEZJNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WEZKNX           PFS Load Deadli
     C                     Z-ADD*ZERO     WEDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WEDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WEDRNB           PFS Item Struct
     C                     Z-ADD*ZERO     WEUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WEAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WEAINY           PFS Create Time
     C                     Z-ADD*ZERO     WEAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WEAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WFASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WFAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WFDNNB           PFS Item Struct
     C                     Z-ADD*ZERO     WFDONB           PFS Item Struct
     C                     Z-ADD*ZERO     WFUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WFAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WFAINY           PFS Create Time
     C                     Z-ADD*ZERO     WFAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WFAKNY           PFS Change time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SDRVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  80
     C                     Z-ADD*ZERO     WL0003  60
     C                     MOVEL*BLANK    WL0004 10
     C                     Z-ADD*ZERO     WL0005  70
     C                     Z-ADD*ZERO     WL0006  30
     C                     Z-ADD*ZERO     WL0007  80
     C                     Z-ADD*ZERO     WL0008  60
     C                     MOVEL*BLANK    WL0009 10
      * Define local variables for subroutine SERVGN.
     C                     Z-ADD*ZERO     WL0010  30
     C                     Z-ADD*ZERO     WL0011  80
     C                     Z-ADD*ZERO     WL0012  60
     C                     MOVEL*BLANK    WL0013 10
     C                     Z-ADD*ZERO     WL0014  70
     C                     Z-ADD*ZERO     WL0015  70
     C                     MOVEL*BLANK    WL0016  1
      * Define local variables for subroutine SFRVGN.
     C                     Z-ADD*ZERO     WL0017  30
     C                     Z-ADD*ZERO     WL0018  80
     C                     Z-ADD*ZERO     WL0019  60
     C                     MOVEL*BLANK    WL0020 10
     C                     Z-ADD*ZERO     WL0021  30
     C                     Z-ADD*ZERO     WL0022  30
      * Define local variables for subroutine SHCRRC.
     C                     Z-ADD*ZERO     WL0023  30
     C                     Z-ADD*ZERO     WL0024  80
     C                     Z-ADD*ZERO     WL0025  60
     C                     MOVEL*BLANK    WL0026 10
     C                     Z-ADD*ZERO     WL0027  70
     C                     Z-ADD*ZERO     WL0028  80
     C                     Z-ADD*ZERO     WL0029  70
     C                     MOVEL*BLANK    WL0030  2
     C                     Z-ADD*ZERO     WL0031  70
     C                     Z-ADD*ZERO     WL0032  30
     C                     MOVEL*BLANK    WL0033  1
     C                     Z-ADD*ZERO     WL0034  70
     C                     Z-ADD*ZERO     WL0035  70
     C                     Z-ADD*ZERO     WL0036  70
     C                     Z-ADD*ZERO     WL0037  70
     C                     Z-ADD*ZERO     WL0038  70
     C                     Z-ADD*ZERO     WL0039  70
     C                     Z-ADD*ZERO     WL0040  70
     C                     Z-ADD*ZERO     WL0041  20
     C                     Z-ADD*ZERO     WL0042  80
     C                     Z-ADD*ZERO     WL0043  80
     C                     Z-ADD*ZERO     WL0044  60
     C                     Z-ADD*ZERO     WL0045  30
     C                     Z-ADD*ZERO     WL0046  30
     C                     Z-ADD*ZERO     WL0047  30
     C                     MOVEL*BLANK    WL0048  2
     C                     MOVEL*BLANK    WL0049  2
     C                     MOVEL*BLANK    WL0050  1
     C                     MOVEL*BLANK    WL0051  1
     C                     MOVEL*BLANK    WL0052  1
     C                     MOVEL*BLANK    WL0053  2
     C                     MOVEL*BLANK    WL0054  1
     C                     MOVEL*BLANK    WL0055 30
     C                     MOVEL*BLANK    WL0056  1
     C                     Z-ADD*ZERO     WL0057  10
     C                     MOVEL*BLANK    WL0058  6
     C                     Z-ADD*ZERO     WL0059  80
     C                     Z-ADD*ZERO     WL0060  60
     C                     Z-ADD*ZERO     WL0061  80
     C                     Z-ADD*ZERO     WL0062  60
      * Define local work field PFS Baseline Schedule
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field PFS Batch Sent Date
     C                     Z-ADD*ZERO     YL0002  80
      * Define local work field PFS Batch Sent Time
     C                     Z-ADD*ZERO     YL0003  60
      * Define null work field PFS Record Status
     C                     MOVEL*BLANK    YN0001  1
      * Define null work field PFS Process Status
     C                     Z-ADD*ZERO     YN0002  10
      * Define null work field PFS Error Reason
     C                     MOVEL*BLANK    YN0003  6
      * Define local work field PFS Create Date
     C                     Z-ADD*ZERO     YL0004  80
      * Define local work field PFS Create Time
     C                     Z-ADD*ZERO     YL0005  60
      * Define null work field PFS Change Date
     C                     Z-ADD*ZERO     YN0004  80
      * Define null work field PFS Change time
     C                     Z-ADD*ZERO     YN0005  60
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0006  20
      * Define local work field PFS Baseline Schedule Cnt
     C                     Z-ADD*ZERO     YL0007  20
      * Define local work field PFS Company Number
     C                     Z-ADD*ZERO     YL0008  30
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0009  80
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0010  60
      * Define local work field PFS User ID
     C                     MOVEL*BLANK    YL0011 10
      * Define local work field Count USR
     C                     Z-ADD*ZERO     YL0012  50
      * Define local work field PFS Company Number
     C                     Z-ADD*ZERO     YL0013  30
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0014  80
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0015  60
      * Define local work field PFS User ID
     C                     MOVEL*BLANK    YL0016 10
      * Define local work field PFS Fill Qty Prod
     C                     Z-ADD*ZERO     YL0017  70
      * Define local work field PFS Fill Qty Ship Day 0
     C                     Z-ADD*ZERO     YL0018  70
      * Define local work field PFS Fill Qty Ship Day 1
     C                     Z-ADD*ZERO     YL0019  70
      * Define local work field PFS Fill Qty Ship Day 2
     C                     Z-ADD*ZERO     YL0020  70
      * Define local work field PFS Order Line Sts
     C                     MOVEL*BLANK    YL0021  1
      * Define local work field PFS Baseline Schedule
     C                     MOVEL*BLANK    YL0022  1
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0023  1
      * Define local work field PFS Batch Seq
     C                     Z-ADD*ZERO     YL0024  70
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Y2U0005
00002 Y2U0003
