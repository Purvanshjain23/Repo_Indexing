/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CAPTURE ORDER DTL SHIPMNT INFO FOR INV STOCK CLOSING */
/*             REPLACE THE BLD ORDER DTL DOWNLOD FOR TOM DYE        */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 05/24/05                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &FDATEL     - FROM ACTUAL SHIPPED DATE                */
/*          &TDATEL     - THROUGH    DATE                         */
/*          &WEEKN    - WEEK ENDING DATE FOR INV STOCK CLOS FIL  */
/***********************************************************************/
/* THIS IS RUN FOR SUNDAY THRU THE WEEKEND ENDING SATURDAY             */
/***********************************************************************/
/* DN  05/09/17  R9083  - Pass in ISC Valuation Grouping parm to hard  */
/*                        code company for record selection with       */
/*                        OPNQRYF logic.                               */
/* RMC 08/05/20  W67377 - Change company in opnqry to select >0,<999 */
/*                        then Read  all rcds and proc if acctng co  */
/*                        ivg group = par.isc grouping in the printfile */
/* PIO 07/17/23 - REPLACE OPNQRYF WITH OPNSQLF IN OPBGWKP FILE          */
/*                ADDED NEEDED OVRDBF AROUND THE COMMAND.               */
/*                CHANGE *AND TO AND, *EQ TO =, *, *GE TO >=, *LE TO <=,*/
/*                *GT TO > IN &SEL                                      */
/***********************************************************************/

 PPOZUPR:   PGM        PARM(&RTN &FDATE  &TDATE &WEEKN &IVG)

             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7) /*  RETURN +
                          CODE   */
             DCL        VAR(&FDATE) TYPE(*DEC) LEN(7 0) /*  FROM +
                          DATE      */
             DCL        VAR(&FDATEX) TYPE(*CHAR) LEN(7) /*  FROM +
                          DATE      */
             DCL        VAR(&TDATE) TYPE(*DEC) LEN(7 0) /*  TO  +
                          DATE      */
             DCL        VAR(&TDATEX) TYPE(*CHAR) LEN(7) /*  TO +
                          DATE      */
             DCL        VAR(&WEEKN) TYPE(*DEC) LEN(8 0)
             DCL        VAR(&IVG) TYPE(*CHAR) LEN(1) /* Inv Valuation Grp */

/* SEND PROGRAM MESSAGE PARAMETERS  */

             DCL        VAR(&A)  TYPE(*CHAR) LEN(30)
             DCL        VAR(&B)  TYPE(*CHAR) LEN(30)
             DCL        VAR(&C)  TYPE(*CHAR) LEN(35) /* Company SEL */
  /*PIO*/    DCL        VAR(&D)  TYPE(*CHAR) LEN(35)
  /*PIO      DCL        VAR(&SEL)  TYPE(*CHAR) LEN(200)  */
  /*PIO*/    DCL        VAR(&SEL)  TYPE(*CHAR) LEN(350)

             CHGVAR    VAR(&FDATEX) VALUE(&FDATE) /* Change to CHAR  */
             CHGVAR    VAR(&TDATEX) VALUE(&TDATE) /* Change to CHAR  */

      BLDQRY:
  /*PIO      CHGVAR     VAR(&A) VALUE('(OMGNDT *GE ' *CAT &FDATEX + +
                          *CAT ')')                                */
  /*PIO*/    CHGVAR     VAR(&A) VALUE('(OMGNDT >=  ' *CAT &FDATEX +
                          *CAT ')')
  /*PIO      CHGVAR     VAR(&B) VALUE('*AND (OMGNDT *LE ' *CAT +  +
                          &TDATEX *CAT ')')                     */
  /*PIO*/    CHGVAR     VAR(&B) VALUE(' AND (OMGNDT <=  ' *CAT +
                          &TDATEX *CAT ')')

    /* R9083 - Default Company Based on ISC Valuation Grouping. */
   /*        IF         COND(&IVG *EQ 'G') THEN(DO)                 +
             CHGVAR     VAR(&C) VALUE('*AND (OMAIC3=360 *OR +
                          OMAIC3=960)')                            +
             ENDDO                                                +
             IF         COND(&IVG *EQ 'S') THEN(DO)              +
             CHGVAR     VAR(&C) VALUE('*AND (OMAIC3=440)')     +
             ENDDO                                            */

 /*PIO   W67377:      CHGVAR     VAR(&C) VALUE('*AND (OMAIC3>000 *AND +  +
                          OMAIC3<999)')                                */
 /*PIO*/ W67377:      CHGVAR     VAR(&C) VALUE(' AND (OMAIC3>000  AND +
                          OMAIC3<999)')

 /*PIO*/    CHGVAR     VAR(&D) VALUE(' AND OMGMST IN ("C" , "R")')


 RUNIT:
    /* R9083 - Added &C Value to Select by Company */
   /*PIO     CHGVAR     VAR(&SEL) VALUE(&A *CAT &B *CAT &C) */
  /*PIO*/    CHGVAR     VAR(&SEL) VALUE(&A *CAT &B *CAT &C *CAT &D)

  /*PIO      OVRDBF     FILE(OPBGWKMG) SHARE(*YES)          +
             OPNQRYF    FILE((*LIBL/OPBGWKMG)) QRYSLT(&SEL) + +
                          KEYFLD(*FILE)                     */

  /*PIO*/    OVRDBF     FILE(OPBGWKP) TOFILE(OPBGWKP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBGWKP Where  ' *BCAT +
                          &SEL *BCAT ' ORDER BY OMHGCD ASC, OMAJCD +
                          ASC') OPNID(OPBGWKMG) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@BGWKBE) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBGWKMG) TOFILE(OPBGWKP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


    /* R9083 - Added &IVG to Parm */
             CALL       PGM(PPOYPFR) PARM('' &WEEKN &IVG)

             CLOF       OPNID(OPBGWKMG)
    /*PIO    DLTOVR     FILE(OPBGWKMG)      */
             DLTOVR     FILE(OPBGWKMG) LVL(*JOB) /*PIO*/
       /*    DLTSPLF    FILE(PPOYPFR)            */

 END:        ENDPGM
