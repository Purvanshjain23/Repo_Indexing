     H/TITLE Exc Auto EDI 846 CmpWIMXF Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 04/26/23  Time  : 08:21:55
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDJYREL3  IF   E           K DISK
      * RTV : Company Defaults Internal Plant Companies Only CO
      *
     FCAADREL9  IF   E           K DISK
      * RSQ : Warehouse Codes           ShipCo/Warehouse
      *
     FPDKMREL1  IF   E           K DISK
      * RTV : Company Values            Retrieval index
      *
     FCADPREL1  IF   E           K DISK
      * RTV : System Values             Retrieval index       NV
      *
     FPNG0REL1  IF   E           K DISK
      * RTV : EDI WHS Interchange       Retrieval index
      *
     FOMHCCPL1  IF   E           K DISK
      * RTV : Physical Count Control    Retrieval index
      *
     FECP780L2  IF   E           K DISK
      * RSQ : WIM EDI Whs InvInqAdv HDR Adj Dte/TP/Sggte
      *
     FECP782L2  IF   E           K DISK
      * RSQ : WIM EDI Whs InvInqAdv NAM Sggte#/NameType/IDCode
      *
      * Long constants
     D @CN#            S              6    DIM(12)CTDATA PERRCD(1)
     D @CN             S             25    DIM(12) ALT(@CN#)
     D YDOW            S              1     DIM(7)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D YL0009          DS           500
      /EJECT
     D XDINT           DS
      * Internal date
     D  XDINDT                 1      7  0
     D  XDINYY                 1      3  0
     D  XDINMM                 4      5  0
     D  XDINDD                 6      7  0
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  WN0001         S              6  0
     D  YL0001         S              3  0
     D  YL0002         S              3
     D  YL0003         S              1
     D  YL0004         S              7  0
     D  YL0005         S              8  0
     D  YL0006         S              8  0
     D  YL0007         S             50
     D  YL0008         S              1
     D  YL0010         S            100
     D  ZQ             S              5  0
     D  YL0011         S             10
     D  YN0001         S             10
     D  YL0012         S            100
     D  YL0013         S            100
     D  YL0014         S            100
     D  YL0015         S            100
     D  WQSB01         S                   LIKE(WBBWC3)
     D  YL0016         S              6
     D  YL0017         S              3
     D  YL0018         S              1
     D  Y0CX01         S              1
     D  YL0019         S              6  0
     D  XDWK1          S              8  0
     D  XDAY1          S              6  0
     D  XDAY2          S              6  0
     D  XDSEL          S              1
     D  XDCDW          S              7
     D  XDWSL          S              1  0
     D  WUDLN          S             10
     D  XABEG          S              6  0
     D  XAEND          S              6  0
     D  XDURR          S              8  0
     D  XDLSW          S              1  0
     D  YY             S              6  0
     D  WQSF01         S                   LIKE(WFAIC3)
     D  WQSF02         S                   LIKE(WFAJCD)
     D  WQSF03         S                   LIKE(WFDHDT)
     D  YL0020         S              1
     D  YL0021         S              1
     D  WQSG01         S                   LIKE(WGHHSC)
     D  WQSG02         S                   LIKE(WGHPAA)
     D  WQSH01         S                   LIKE(WHH9NY)
     D  WQSH02         S                   LIKE(WHTYPC)
     D  WQSH03         S                   LIKE(WHDCDE)
     D  YL0022         S              1
     D  WQ0001         S             50
     D  WQ0002         S             80
     D  WQ0003         S            500
     D  W0CLPG         S             10
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
     I@JYREEY
      * Company Defaults Internal Plant Companies Only CO
      * Renamed input format fields
     I              JYAIC3                      WAAIC3
     I              JYZ9ST                      WAZ9ST
     I              JYCSST                      WACSST
     I              JYZ8ST                      WAZ8ST
     I              JYCXST                      WACXST
     I              JYSWST                      WASWST
     I              JYXXTM                      WAXXTM
     I              JYUECD                      WAUECD
     I              JYHSST                      WAHSST
     I              JYAMEO                      WAAMEO
     I              JYSSDF                      WASSDF
     I              JYPDFT                      WAPDFT
     I              JYYISX                      WAYISX
     I              JYYJSX                      WAYJSX
     I              JYYKSX                      WAYKSX
     I              JYYLSX                      WAYLSX
     I              JYYMSX                      WAYMSX
     I              JYYNSX                      WAYNSX
     I              JYUVST                      WAUVST
     I              JYUWST                      WAUWST
     I              JYUXST                      WAUXST
     I              JYVSST                      WAVSST
     I              JYAATM                      WAAATM
     I              JYAYNA                      WAAYNA
     I              JYA0NA                      WAA0NA
     I              JYAXDT                      WAAXDT
      *
     I@ADREWA
      * Warehouse Codes           ShipCo/Warehouse
      * Renamed input format fields
     I              ADAJCD                      WBAJCD
     I              ADF8NA                      WBF8NA
     I              ADACNA                      WBACNA
     I              ADADNA                      WBADNA
     I              ADAENA                      WBAENA
     I              ADAJNA                      WBAJNA
     I              ADBTTX                      WBBTTX
     I              ADAOCD                      WBAOCD
     I              ADBGCD                      WBBGCD
     I              ADVHST                      WBVHST
     I              ADMPNA                      WBMPNA
     I              ADWPST                      WBWPST
     I              ADXUST                      WBXUST
     I              ADT0ST                      WBT0ST
     I              ADT1ST                      WBT1ST
     I              ADDBNB                      WBDBNB
     I              ADT2ST                      WBT2ST
     I              ADT3ST                      WBT3ST
     I              ADT4ST                      WBT4ST
     I              ADT6ST                      WBT6ST
     I              ADBWC3                      WBBWC3
     I              ADBTC3                      WBBTC3
     I              ADBUC3                      WBBUC3
     I              ADBVC3                      WBBVC3
     I              ADFCAA                      WBFCAA
     I              ADRQSX                      WBRQSX
     I              ADRRSX                      WBRRSX
     I              ADRSSX                      WBRSSX
     I              ADRTSX                      WBRTSX
     I              ADT7ST                      WBT7ST
     I              ADT8ST                      WBT8ST
     I              ADRNSX                      WBRNSX
     I              ADROSX                      WBROSX
     I              ADRPSX                      WBRPSX
     I              ADUVST                      WBUVST
     I              ADUWST                      WBUWST
     I              ADUXST                      WBUXST
     I              ADVSST                      WBVSST
     I              ADAATM                      WBAATM
     I              ADAYNA                      WBAYNA
     I              ADA0NA                      WBA0NA
     I              ADAXDT                      WBAXDT
      *
     I@KMREHC
      * Company Values            Retrieval index
      * Renamed input format fields
     I              KMAIC3                      WCAIC3
     I              KMV8CD                      WCV8CD
     I              KMAUNA                      WCAUNA
     I              KMI5ST                      WCI5ST
     I              KMBXTX                      WCBXTX
     I              KMM8NB                      WCM8NB
     I              KMUVST                      WCUVST
     I              KMUWST                      WCUWST
     I              KMUXST                      WCUXST
     I              KMVSST                      WCVSST
     I              KMAATM                      WCAATM
     I              KMAYNA                      WCAYNA
     I              KMA0NA                      WCA0NA
     I              KMAXDT                      WCAXDT
      *
     I@DPRETD
      * System Values             Retrieval index       NV
      * Renamed input format fields
     I              DPDOCD                      WDDOCD
     I              DPAUNA                      WDAUNA
     I              DPI5ST                      WDI5ST
     I              DPBXTX                      WDBXTX
     I              DPM8NB                      WDM8NB
     I              DPUVST                      WDUVST
     I              DPUWST                      WDUWST
     I              DPUXST                      WDUXST
     I              DPVSST                      WDVSST
     I              DPAATM                      WDAATM
     I              DPAYNA                      WDAYNA
     I              DPA0NA                      WDA0NA
     I              DPAXDT                      WDAXDT
      *
     I@G0REJZ
      * EDI WHS Interchange       Retrieval index
      * Renamed input format fields
     I              G0AJCD                      WEAJCD
     I              G0M4AA                      WEM4AA
     I              G0M7AA                      WEM7AA
     I              G0J5NX                      WEJ5NX
     I              G0X2T1                      WEX2T1
     I              G0JBSC                      WEJBSC
     I              G0JCSC                      WEJCSC
     I              G0JDSC                      WEJDSC
     I              G0JESC                      WEJESC
     I              G0QGU1                      WEQGU1
     I              G0F5NZ                      WEF5NZ
     I              G0LSSC                      WELSSC
     I              G0LTSC                      WELTSC
     I              G0AHAB                      WEAHAB
     I              G0F6NZ                      WEF6NZ
     I              G0VSST                      WEVSST
     I              G0MJDT                      WEMJDT
     I              G0BETM                      WEBETM
     I              G0CCVN                      WECCVN
     I              G0CDVN                      WECDVN
     I              G0MKDT                      WEMKDT
     I              G0BFTM                      WEBFTM
     I              G0CEVN                      WECEVN
     I              G0CFVN                      WECFVN
      *
     I@HCCPJ0
      * Physical Count Control    Retrieval index
      * Renamed input format fields
     I              HCAIC3                      WFAIC3
     I              HCAJCD                      WFAJCD
     I              HCDHDT                      WFDHDT
     I              HCOFCD                      WFOFCD
     I              HCTGST                      WFTGST
     I              HCUVST                      WFUVST
     I              HCUWST                      WFUWST
     I              HCUXST                      WFUXST
     I              HCAATM                      WFAATM
     I              HCAYNA                      WFAYNA
     I              HCA0NA                      WFA0NA
     I              HCAXDT                      WFAXDT
      *
     I@P780MO
      * WIM EDI Whs InvInqAdv HDR Adj Dte/TP/Sggte
      * Renamed input format fields
     I              CVH9NY                      WGH9NY
     I              CVHPAA                      WGHPAA
     I              CVA0ST                      WGA0ST
     I              CVXVAA                      WGXVAA
     I              CVXWAA                      WGXWAA
     I              CVIYU1                      WGIYU1
     I              CVHHSC                      WGHHSC
     I              CVHISC                      WGHISC
     I              CVARTH                      WGARTH
      *
     I@P782MZ
      * WIM EDI Whs InvInqAdv NAM Sggte#/NameType/IDCode
      * Renamed input format fields
     I              CXH9NY                      WHH9NY
     I              CXTYPC                      WHTYPC
     I              CXAMEX                      WHAMEX
     I              CXDCDQ                      WHDCDQ
     I              CXDCDE                      WHDCDE
     I              CXDD1X                      WHDD1X
     I              CXDD2X                      WHDD2X
     I              CXITYX                      WHITYX
     I              CXTATE                      WHTATE
     I              CXIPXX                      WHIPXX
     I              CXWFAA                      WHWFAA
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc Auto EDI 846 CmpWIMXF
      * Rtv Auto EDI 846 CmpWIMRT - Company Defaults Internal  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Auto EDI 846 CmpWIMRT - Company Defaults Internal  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Establish starting position
     C     *LOVAL        SETLL     @JYREEY                                      *
     C                   READ      @JYREEY                                90    *
      * Data record not found
     C   90              MOVEL     'USR2025'     W0RTN
      * USER: Process Data record
      * If record is active, process it
      * CASE: DB1.Record Status is Active
     C                   DOW       NOT *IN90
      * Determine if Auto Inventory Restoration set up for company
      *   and if it ran today - send email if not
      * RTV WHS Auto EDI846 WIMRT - Warehouse Codes  * 
     C                   IF        WAVSST = 'A'
     C                   EXSR      SBRVGN
     C                   END                                                    *FI
     C                   READ      @JYREEY                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * RTV WHS Auto EDI846 WIMRT - Warehouse Codes  * 
      *================================================================
      *
     C                   Z-ADD     *ZERO         WN0001                         Day of the Week
      *
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   Z-ADD     *ZERO         YL0001                         WHS Auto Inv Re
     C                   EVAL      YL0002 = ' '                                 Company Number
     C                   MOVEL     WAAIC3        YL0002                         Company Number
     C                   MOVEL     'Y'           YL0003                         First Time Thro
     C                   Z-ADD     ##JDT         YL0004                         Physical Start
      * LCL.Current Date D8# = LCL.Physical Start Date
     C                   IF        YL0004 = *ZERO
     C                   Z-ADD     *ZERO         YL0005
     C                   ELSE
     C     YL0004        ADD       19000000      YL0005                         Current Date D8
     C                   END
      * LCL.BAI04 Adjustment Date = LCL.Current Date D8#
     C                   Z-ADD     YL0005        YL0006                         BAI04 Adjustmen
      * Initialize for Email Messaging.
      * CASE: *OTHERWISE
      * RTV Alpha Value        RT - Company Values  * EDI846CMP for Email
     C                   EXSR      SCRVGN
     C                   MOVEL     'N'           YL0008                         Send Email USR
     C                   EVAL      YL0009 = ' '                                 Email Message 2
     C                   Z-ADD     0             ZQ
     C     @CN(002)      CAT(P)    @CN(003):ZQ   YL0010                         Subject Line US
     C                   Z-ADD     1             ZQ
     C     YL0010        CAT(P)    YL0002:ZQ     YL0010                         Subject Line US
      * RTV Data Libraries     RT - System Values  * In TEST or PROD
     C                   EXSR      SDRVGN
      * If Not PROD Then Append 'TEST' to Subject Line.
      * CASE: LCL.Library List Code is Not PRKFLIB
     C                   IF        YL0011 <> @CN(006)
     C                   Z-ADD     1             ZQ
     C     YL0010        CAT(P)    @CN(007):ZQ   YL0010                         Subject Line US
     C                   END                                                    *FI
     C                   EVAL      YL0012 = ' '                                 Email Msg Line-
     C                   MOVEL     @CN(008)      YL0012                         Email Msg Line-
     C                   EVAL      YL0013 = ' '                                 Email Msg Line-
     C                   MOVEL     @CN(009)      YL0013                         Email Msg Line-
     C                   EVAL      YL0014 = ' '                                 Email Msg Line-
     C                   MOVEL     @CN(010)      YL0014                         Email Msg Line-
     C                   EVAL      YL0015 = ' '                                 Email Msg Line-
     C                   MOVEL     @CN(011)      YL0015                         Email Msg Line-
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WQSB01                         Shipping Compan
      * Setup key
     C                   Z-ADD     WAAIC3        WQSB01                         Shipping Compan
      * Establish starting position
     C     KRSSB         SETLL     @ADREWA                                      *
     C     KRSSB         READE     @ADREWA                                90    *
      * Data record not found
     C   90              MOVEL     'USR0007'     W0RTN
      * USER: Process Data record
      * Rtv WIM EDI 846 Info  RT - EDI WHS Interchange  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SERVGN
      * Warehouse Must Be Active for 'WHSRST' EDI 846.
      * CASE: LCL.Record Status is Active
      * First Time Thru Processing to See if Email Should Be Sent or Not.
      * CASE: LCL.First Time Through USR is Yes
     C                   IF        YL0018 = 'A'
      * Check EDI Frequency.
      * CASE:
      *  - NOTc1
      *   |- c1    : LCL.EDI Frequency is Not Entered
      *   '-
     C                   IF        YL0003 = 'Y'
     C                   MOVEL     '0'           Y0CX01
     C                   IF        YL0017 = ' '
     C                   ELSE
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
      * Send Email If ALL Else Check Day of Week.
      * CASE: LCL.EDI Frequency is All
     C                   IF        Y0CX01 = '1'
     C                   IF        YL0017 = 'ALL'
     C                   MOVEL     'Y'           YL0008                         Send Email USR
     C                   MOVEL     'N'           YL0003                         First Time Thro
     C                   ELSE
      * CASE: *OTHERWISE
      * Set DOW Value from EDI Frequency.
      * CASE: LCL.EDI Frequency is Monday
     C                   IF        YL0017 = 'MON'
     C                   Z-ADD     1             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Tuesday
     C                   IF        YL0017 = 'TUE'
     C                   Z-ADD     2             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Wednesday
     C                   IF        YL0017 = 'WED'
     C                   Z-ADD     3             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Thurdsday
     C                   IF        YL0017 = 'THU'
     C                   Z-ADD     4             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Friday
     C                   IF        YL0017 = 'FRI'
     C                   Z-ADD     5             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Saturday
     C                   IF        YL0017 = 'SAT'
     C                   Z-ADD     6             WN0001                         Day of the Week
     C                   ELSE
      * CASE: LCL.EDI Frequency is Sunday
     C                   IF        YL0017 = 'SUN'
     C                   Z-ADD     7             WN0001                         Day of the Week
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * LCL.Day of the Week # USR = JOB.*Job date *DAY OF WEEK
     C     ##JDT         ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C     XDAY1         ADD       3             XDWK1
     C                   DIV       7             XDWK1
     C                   MVR                     XDWK1
     C                   IF        XDWK1 = 0
     C                   Z-ADD     7             XDWK1
     C                   END
     C     XDAY1         SUB       XDWK1         XDAY2
     C                   MOVEL     '1'           XDSEL
     C                   MOVEL     '1111111'     XDCDW
     C                   EXSR      XDOWS
     C                   MOVEL     'NONE'        WUDLN
     C                   EXSR      XDUDY
     C                   MOVE      XDURR         YL0019
      * If DOW from Job Date & from EDI Frequency Match Then Send Email.
      * CASE: LCL.Day of the Week # USR EQ PAR.Day of the Week # USR
     C                   IF        YL0019 = WN0001
     C                   MOVEL     'Y'           YL0008                         Send Email USR
     C                   MOVEL     'N'           YL0003                         First Time Thro
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Rtv Auto Inv Rest Cmp  RT - Physical Count Control  * 
     C                   EXSR      SFRVGN
      * Physical Count Control Exist?
      * CASE: PGM.*Return code is *Record already exists
      * Check Warehouse Code was Posted to the correct transaction set.
     C                   IF        W0RTN = @CN(012)
     C                   MOVEL     'N'           YL0020                         Warehouse Match
      * Val WHS Auto EDI846 WIMRT - WIM EDI Whs InvInqAdv HDR  * 
     C                   EXSR      SGRVGN
      * Warehouse Code Matched?
      * CASE: LCL.Warehouse Match USR is Yes
      * Append Warehouse to Email Message Group.
      * CASE: LCL.EDI-Record Processed is Processed
     C                   IF        YL0020 = 'Y'
      * Add to 'Posted' Email Message Line.
     C                   IF        YL0021 = 'Y'
     C                   Z-ADD     1             ZQ
     C     YL0012        CAT(P)    WBAJCD:ZQ     YL0012                         Email Msg Line-
     C                   ELSE
      * CASE: LCL.EDI-Record Processed is Error
      * Add to 'In Error' Email Message Line.
     C                   IF        YL0021 = 'E'
     C                   Z-ADD     1             ZQ
     C     YL0013        CAT(P)    WBAJCD:ZQ     YL0013                         Email Msg Line-
     C                   ELSE
      * CASE: *OTHERWISE
      * Add to 'Late/Not Posted' Email Message Line.
     C                   Z-ADD     1             ZQ
     C     YL0015        CAT(P)    WBAJCD:ZQ     YL0015                         Email Msg Line-
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   ELSE
      * CASE: *OTHERWISE
      * Warehouse Code Not Matched, Add to 'In Error' Email Message Line.
     C                   Z-ADD     1             ZQ
     C     YL0013        CAT(P)    WBAJCD:ZQ     YL0013                         Email Msg Line-
     C                   END                                                    *FI
     C                   ELSE
      * CASE: *OTHERWISE
      * Not Exist, Add to 'Not Received' Email Msg Line.
     C                   Z-ADD     1             ZQ
     C     YL0014        CAT(P)    WBAJCD:ZQ     YL0014                         Email Msg Line-
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     KRSSB         READE     @ADREWA                                90    *
     C                   ENDDO
      * USER: Exit processing
      * Send Email?
      * CASE: LCL.Send Email USR is Yes
      * Format Email Message Body.
      * CASE: *OTHERWISE
     C                   IF        YL0008 = 'Y'
     C                   MOVEL     'N'           YL0022                         Force New Line
      * Posted Transactions Exist?
      * CASE: LCL.Email Msg Line-Posted U is            Posted:
      * No Warehouse recorded.
     C                   IF        YL0012 = @CN(008)
     C                   ELSE
      * CASE: *OTHERWISE
     C                   EVAL      YL0009 = ' '                                 Email Message 2
     C                   MOVEL     YL0012        YL0009                         Email Message 2
     C                   MOVEL     'Y'           YL0022                         Force New Line
     C                   END                                                    *FI
      * In Error Transactions Exist?
      * CASE: LCL.Email Msg Line-In Error U is           In Error:
      * No Warehouse recorded.
     C                   IF        YL0013 = @CN(009)
     C                   ELSE
      * CASE: *OTHERWISE
      * Force New Line?
      * CASE: LCL.Force New Line USR is Yes
     C                   IF        YL0022 = 'Y'
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    '&N':ZQ       YL0009                         Email Message 2
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    YL0013:ZQ     YL0009                         Email Message 2
     C                   ELSE
      * CASE: *OTHERWISE
     C                   EVAL      YL0009 = ' '                                 Email Message 2
     C                   MOVEL     YL0013        YL0009                         Email Message 2
     C                   END                                                    *FI
     C                   MOVEL     'Y'           YL0022                         Force New Line
     C                   END                                                    *FI
      * Not Received Transactions Exist?
      * CASE: LCL.Email Msg Line-Not Rcvd U is Not Received:
      * No Warehouse recorded.
     C                   IF        YL0014 = @CN(010)
     C                   ELSE
      * CASE: *OTHERWISE
      * Force New Line?
      * CASE: LCL.Force New Line USR is Yes
     C                   IF        YL0022 = 'Y'
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    '&N':ZQ       YL0009                         Email Message 2
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    YL0014:ZQ     YL0009                         Email Message 2
     C                   ELSE
      * CASE: *OTHERWISE
     C                   EVAL      YL0009 = ' '                                 Email Message 2
     C                   MOVEL     YL0014        YL0009                         Email Message 2
     C                   END                                                    *FI
     C                   MOVEL     'Y'           YL0022                         Force New Line
     C                   END                                                    *FI
      * Late Transactions Exist?
      * CASE: LCL.Email Msg Line-Late/NotPU is                 Late:
      * No Warehouse recorded.
     C                   IF        YL0015 = @CN(011)
     C                   ELSE
      * CASE: *OTHERWISE
      * Force New Line?
      * CASE: LCL.Force New Line USR is Yes
     C                   IF        YL0022 = 'Y'
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    '&N':ZQ       YL0009                         Email Message 2
     C                   Z-ADD     1             ZQ
     C     YL0009        CAT(P)    YL0015:ZQ     YL0009                         Email Message 2
     C                   ELSE
      * CASE: *OTHERWISE
     C                   EVAL      YL0009 = ' '                                 Email Message 2
     C                   MOVEL     YL0015        YL0009                         Email Message 2
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Exc ESNDMAIL Generic2 CL - /UT User Programs  * 
     C                   CALL      'PUX2UPC'                            90      Exc ESNDMAIL Ge
     C                   PARM      YL0007        WQ0001                         Email Address
     C                   PARM      YL0010        WQ0002                         Email Subject 2
     C                   PARM      YL0009        WQ0003                         Email Message 2
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PUX2UPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *FI
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * RTV Alpha Value        RT - Company Values  * EDI846CMP for Emai
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WCAIC3                         Company Number
     C                   KFLD                    WCV8CD                         Company Value C
      * Setup key
     C                   Z-ADD     WAAIC3        WCAIC3                         Company Number
     C                   MOVEL     @CN(001)      WCV8CD                         Company Value C
      * Establish starting position
     C     KRSSC         CHAIN     @KMREHC                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR2221'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     WCBXTX        YL0007                         System Value Al
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * RTV Data Libraries     RT - System Values  * In TEST or PROD
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KPSSD         KLIST
     C                   KFLD                    WDDOCD                         System Value Co
      * Setup key
     C                   EVALR     WDDOCD = ' '                                 System Value Co
     C                   MOVEL     'DTALIB'      WDDOCD                         System Value Co
      * Establish starting position
     C     KPSSD         SETLL     @DPRETD                                      *
     C                   READ      @DPRETD                                90    *
      * Data record not found
     C   90              MOVEL     'USR0759'     W0RTN
      * USER: Process Data record
      * CASE: DB1.System Value Code is Data File Library
     C                   DOW       NOT *IN90
     C                   IF        WDDOCD = @CN(004)
     C                   MOVEL     WDBXTX        YL0011                         Library List Co
     C                   ELSE
      * CASE: DB1.System Value Code is History File Library
     C                   IF        WDDOCD = @CN(005)
     C                   MOVEL     WDBXTX        YN0001                         @Library List C
     C                   GOTO      SDEXIT                                       *QUIT
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   READ      @DPRETD                                90    *
     C                   ENDDO
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SERVGN        BEGSR
      *================================================================
      * Rtv WIM EDI 846 Info  RT - EDI WHS Interchange  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
      * PAR = CON By name
     C                   EVAL      YL0016 = ' '                                 EDI Trading Par
     C                   EVAL      YL0017 = ' '                                 EDI Frequency
     C                   EVAL      YL0018 = ' '                                 Record Status
      * Define keylist
     C     KRSSE         KLIST
     C                   KFLD                    WEAJCD                         Warehouse Code
     C                   KFLD                    WEM4AA                         Interchange Cod
      * Setup key
     C                   MOVEL     WBAJCD        WEAJCD                         Warehouse Code
     C                   MOVEL     'WHSRST'      WEM4AA                         Interchange Cod
      * Establish starting position
     C     KRSSE         CHAIN     @G0REJZ                            90        *
      * Data record not found
     C   90              MOVEL     'USR4409'     W0RTN
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     WEJ5NX        YL0016                         EDI Trading Par
     C                   MOVEL     WEJBSC        YL0017                         EDI Frequency
     C                   MOVEL     WEVSST        YL0018                         Record Status
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFRVGN        BEGSR
      *================================================================
      * Rtv Auto Inv Rest Cmp  RT - Physical Count Control  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSF         KLIST
     C                   KFLD                    WQSF01                         Company Number
     C                   KFLD                    WQSF02                         Warehouse Code
     C                   KFLD                    WQSF03                         Physical Start
      * Setup key
     C                   Z-ADD     WBBWC3        WQSF01                         Company Number
     C                   MOVEL     WBAJCD        WQSF02                         Warehouse Code
     C                   Z-ADD     YL0004        WQSF03                         Physical Start
      * Establish starting position
     C     KRSSF         SETLL     @HCCPJ0                                      *
     C     KRSSF         READE     @HCCPJ0                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR1487'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   MOVEL     'Y2U0003'     W0RTN                          *Return code
     C     KRSSF         READE     @HCCPJ0                                90    *
     C                   ENDDO
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   SGRVGN        BEGSR
      *================================================================
      * Val WHS Auto EDI846 WIMRT - WIM EDI Whs InvInqAdv HDR  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   EVAL      YL0021 = ' '                                 EDI-Record Proc
     C                   MOVEL     'N'           YL0020                         Warehouse Match
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSG         KLIST
     C                   KFLD                    WQSG01                         BAI04 Adjustmen
     C                   KFLD                    WQSG02                         TRADE PARTNER C
      * Setup key
     C                   Z-ADD     YL0006        WQSG01                         BAI04 Adjustmen
     C                   MOVEL     YL0016        WQSG02                         TRADE PARTNER C
      * Establish starting position
     C     KRSSG         SETLL     @P780MO                                      *
     C     KRSSG         READE     @P780MO                                90    *
      * Data record not found
     C   90              MOVEL     'USR5281'     W0RTN
      * USER: Process Data record
      * Val WHS Auto EDI846 WIMRT - WIM EDI Whs InvInqAdv NAM  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SHRVGN
      * CASE: PAR.Warehouse Match USR is Yes
     C                   IF        YL0020 = 'Y'
     C                   MOVEL     WGA0ST        YL0021                         EDI-Record Proc
     C                   GOTO      SGEXIT                                       *QUIT
     C                   END                                                    *FI
     C     KRSSG         READE     @P780MO                                90    *
     C                   ENDDO
      *================================================================
     CSR   SGEXIT        ENDSR
      /EJECT
     CSR   SHRVGN        BEGSR
      *================================================================
      * Val WHS Auto EDI846 WIMRT - WIM EDI Whs InvInqAdv NAM  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   MOVEL     'N'           YL0020                         Warehouse Match
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSH         KLIST
     C                   KFLD                    WQSH01                         EDI SURROGATE N
     C                   KFLD                    WQSH02                         N101-NAME TYPE
     C                   KFLD                    WQSH03                         N104-ID CODE
      * Setup key
     C                   Z-ADD     WGH9NY        WQSH01                         EDI SURROGATE N
     C                   EVALR     WQSH02 = ' '                                 N101-NAME TYPE
     C                   MOVEL     'WH'          WQSH02                         N101-NAME TYPE
     C                   MOVEL     WBAJCD        WQSH03                         N104-ID CODE
      * Establish starting position
     C     KRSSH         SETLL     @P782MZ                                      *
     C     KRSSH         READE     @P782MZ                                90    *
      * Data record not found
     C   90              MOVEL     'USR5285'     W0RTN
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   MOVEL     'Y'           YL0020                         Warehouse Match
     C     KRSSH         READE     @P782MZ                                90    *
     C                   ENDDO
      *================================================================
     CSR   SHEXIT        ENDSR
      /EJECT
     CSR   XCVTA         BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C     XDINYY        SUB       1             XDWK1
     C     XDWK1         MULT      365.25        XDAY1
     C                   IF        XDWK1 >= 300
     C                   SUB       2             XDAY1
     C                   ELSE
     C                   IF        XDWK1 >= 100
     C                   SUB       1             XDAY1
     C                   END
     C                   END
      * (from the beginning of the year to the beginning of the month:)
     C     XDINMM        SUB       1             XDWK1
      *     ...+31*(MM-1) (for January-February) ...
     C                   IF        XDINMM < 3
     C                   MULT      31            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                   MULT      30            XDWK1
     C                   ADD       XDWK1         XDAY1
      *         ...-2 (for preceding February) ...
     C                   SUB       2             XDAY1
      *         ...+1 (for preceding February, if leap year) ...
     C                   IF        XDINYY <> 100 AND
     C                             XDINYY <> 300
     C     XDINYY        DIV       4             XDWK1
     C                   MVR                     XDWK1
     C                   IF        XDWK1 = 0
     C                   ADD       1             XDAY1
     C                   END
     C                   END
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C                   IF        XDINMM < 8
     C     XDINMM        MULT      .5            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C     XDINMM        ADD       1             XDWK1
     C                   MULT      .5            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   END
     C                   END
      * ...+DD (days in the month up to the ending date)
     C                   ADD       XDINDD        XDAY1
      *================================================================
     CSR   XCVTAE        ENDSR
      /EJECT
     CSR   XDOWS         BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                   MOVEA     XDCDW         YDOW
     C                   Z-ADD     0             XDWSL
     C                   Z-ADD     1             YY
     C                   DOW       YY <= 7
     C                   IF        YDOW(YY) = XDSEL
     C                   ADD       1             XDWSL
     C                   END
     C                   ADD       1             YY
     C                   END
      *================================================================
     CSR   XDOWSE        ENDSR
      /EJECT
     CSR   XDUDY         BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C                   IF        XDAY1 < 1 OR
     C                             XDAY2 < 1
     C                   Z-ADD     0             XDURR
     C                   MOVEL     'Y2U0006'     W0RTN
     C                   GOTO      XDUDYE
     C                   END
      * From date2 to date1
     C                   IF        XDAY1 >= XDAY2
     C                   Z-ADD     XDAY2         XABEG
     C                   Z-ADD     XDAY1         XAEND
     C                   ELSE
      * From date1 to date2
     C                   Z-ADD     XDAY1         XABEG
     C                   Z-ADD     XDAY2         XAEND
     C                   END
      * None days of week selected
     C                   IF        XDWSL = 0
     C                   Z-ADD     0             XDURR
     C                   GOTO      XDUDYC
     C                   END
     C     XAEND         SUB       XABEG         XDURR
      * All days of week selected
     C                   IF        XDWSL = 7
     C                   GOTO      XDUDYC
     C                   END
      * Some days of week selected
     C                   DIV       7             XDURR
     C                   MVR                     XDLSW
     C                   MULT      XDWSL         XDURR
      * Determine day of week of the beginning date
     C                   IF        XDLSW <> 0
     C     XABEG         ADD       3             YY
     C                   DIV       7             YY
     C                   MVR                     YY
      * Loop: Increment the date by the last week
      * Increment the day of week
     C                   DOW       XDLSW > 0
     C                   ADD       1             YY
     C                   SUB       1             XDLSW
      * Put day of week into the range 1-7
     C                   IF        YY = 8
     C                   Z-ADD     1             YY
     C                   END
      * Selected day of the last week has been processed
      * Increment duration
     C                   IF        YDOW(YY) = XDSEL
     C                   ADD       1             XDURR
     C                   END
      * End of loop
     C                   END
     C                   END
     C     XDUDYC        TAG
      * Return Code: Unable to calculate duration
     C                   IF        XDURR = 0
     C                   MOVEL     'Y2U0060'     W0RTN
     C                   ELSE
     C                   EVAL      W0RTN = ' '
     C                   END
      *================================================================
     CSR   XDUDYE        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WAXXTM                         Departure Time
     C                   Z-ADD     *ZERO         WAAATM                         Job Time
     C                   Z-ADD     *ZERO         WAAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBDBNB                         Warehouse Chill
     C                   Z-ADD     *ZERO         WBBWC3                         Shipping Compan
     C                   Z-ADD     *ZERO         WBBTC3                         Accounting Comp
     C                   Z-ADD     *ZERO         WBBUC3                         WHS Sched Prod
     C                   Z-ADD     *ZERO         WBBVC3                         WHS Inventory C
     C                   Z-ADD     *ZERO         WBAATM                         Job Time
     C                   Z-ADD     *ZERO         WBAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCAIC3                         Company Number
     C                   Z-ADD     *ZERO         WCM8NB                         System Value Nu
     C                   Z-ADD     *ZERO         WCAATM                         Job Time
     C                   Z-ADD     *ZERO         WCAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WDM8NB                         System Value Nu
     C                   Z-ADD     *ZERO         WDAATM                         Job Time
     C                   Z-ADD     *ZERO         WDAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WEF5NZ                         EDI Company # 9
     C                   Z-ADD     *ZERO         WEF6NZ                         Hold til ship w
     C                   Z-ADD     *ZERO         WEMJDT                         Create Date
     C                   Z-ADD     *ZERO         WEBETM                         Create Time
     C                   Z-ADD     *ZERO         WEMKDT                         Change Date
     C                   Z-ADD     *ZERO         WEBFTM                         Change Time
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WFAIC3                         Company Number
     C                   Z-ADD     *ZERO         WFDHDT                         Physical Start
     C                   Z-ADD     *ZERO         WFAATM                         Job Time
     C                   Z-ADD     *ZERO         WFAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WGH9NY                         EDI SURROGATE N
     C                   Z-ADD     *ZERO         WGHHSC                         BAI04 Adjustmen
     C                   Z-ADD     *ZERO         WGARTH                         BAI05 Adjustmen
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WHH9NY                         EDI SURROGATE N
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      * Define local work field WHS Auto Inv Rest Cnt USR
     C                   Z-ADD     *ZERO         YL0001
      * Define local work field Company Number Alpha
     C                   EVAL      YL0002 = ' '
      * Define local work field First Time Through USR
     C                   EVAL      YL0003 = ' '
      * Define local work field Physical Start Date
     C                   Z-ADD     *ZERO         YL0004
      * Define local work field Current Date D8#
     C                   Z-ADD     *ZERO         YL0005
      * Define local work field BAI04 Adjustment Date
     C                   Z-ADD     *ZERO         YL0006
      * Define local work field Email Address
     C                   EVAL      YL0007 = ' '
      * Define local work field Send Email USR
     C                   EVAL      YL0008 = ' '
      * Define local work field Email Message 2 USR
     C                   EVAL      YL0009 = ' '
      * Define local work field Subject Line USR
     C                   EVAL      YL0010 = ' '
      * Define local work field Library List Code
     C                   EVAL      YL0011 = ' '
      * Define null work field @Library List Code
     C                   EVAL      YN0001 = ' '
      * Define local work field Email Msg Line-Posted U
     C                   EVAL      YL0012 = ' '
      * Define local work field Email Msg Line-In Error U
     C                   EVAL      YL0013 = ' '
      * Define local work field Email Msg Line-Not Rcvd U
     C                   EVAL      YL0014 = ' '
      * Define local work field Email Msg Line-Late/NotPU
     C                   EVAL      YL0015 = ' '
      * Define local work field EDI Trading Partner No.
     C                   EVAL      YL0016 = ' '
      * Define local work field EDI Frequency
     C                   EVAL      YL0017 = ' '
      * Define local work field Record Status
     C                   EVAL      YL0018 = ' '
      * Define local work field Day of the Week # USR
     C                   Z-ADD     *ZERO         YL0019
      * Define local work field Warehouse Match USR
     C                   EVAL      YL0020 = ' '
      * Define local work field EDI-Record Processed
     C                   EVAL      YL0021 = ' '
      * Define local work field Force New Line USR
     C                   EVAL      YL0022 = ' '
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 EDI846CMP
00002 EDI 846 INVENTORY RESTORA
00003 TION FOR COMPANY
00004 DTALIB
00005 HISLIB
00006 PRKFLIB
00007 - TEST
00008            Posted:
00009           In Error:
00010 Not Received:
00011                 Late:
00012 Y2U0003
