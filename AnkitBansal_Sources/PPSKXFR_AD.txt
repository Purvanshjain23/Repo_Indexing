// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPSKXFR
// ?Date: 14.08.2025 Time: 03:41:44
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Chg TFExp-OrdDtl-Cust RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1749314;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Customer_TF_Exempt_Code);
{
 //?USER: Process Data record

 //?DOCO
 DO;

 //?Customer going to EC
 //?          any order detail TF = NE change to EC
 //?          any order detail TF = EP WILL STAY AS EP
 //?Customer going to NE
 //?          any order detail change = EC change to NE
 //?          any order detail change = EP WILL STAY AS EP
 //?ONLY ONE TF TYPE ALLOW ON NE CUSTOMERS.
 //?IF THE ORDER DETAIL HAS ONE EP, THEN ALL OF THE ITEMS FOR THAT
 //?ORDER MUST ALSO HAVE THE TF = EP.
 ENDDO;

 EXECUTE FUNCTION(RTV Bill Type, Event   RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1366339;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Event_Code);
 PARAMETER(LCL.Billing_Activity_Type);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Billing Activity Type is Not Credit Memo
 IF LCL.Billing_Activity_Type = '3'/'1'/'5'/'4';

 CASE;

 // IF PAR.Customer TF Exempt Code is Exempt Customer
 IF PAR.Customer_TF_Exempt_Code = 'EC';

 // AND DB1.Ord TF Exempt Code is Customer Chg
 AND DB1.Ord_TF_Exempt_Code = 'NE'/'EC';

 // LCL.Ord TF Exempt Code = PAR.Customer TF Exempt Code
 LCL.Ord_TF_Exempt_Code = PAR.Customer_TF_Exempt_Code;

 EXECUTE FUNCTION(CHG TF-Exempt-Cust    CH) TYPE(CHGOBJ) FILE(OPBGWKP)           AC1749316;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Ord_TF_Exempt_Code);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 //?This is not a error, could be EP on this order and EP will stay as is
 //?when updated from the Customer
 ENDIF;

 ENDIF;

}


