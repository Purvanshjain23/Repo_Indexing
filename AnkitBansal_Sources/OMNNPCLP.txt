/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT CUSTOMER RANKING REPORTS OVER HISTORY FILE.    */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - SHEILA SCHERTZ                                      */
/*  DATE      - 08/24/95                                            */
/*                                                                  */
/*  PROGRAM   - PRT CUST RANKING RPT   UP - SALES HISTORY *         */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &OUTQ       - OUTPUT QUEUE                             */
/*          &COPEIS     - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/*          &HOLD       - HOLD PRINT FLAG                           */
/*          &SAVE       - SAVE PRINT FLAG                           */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - TO DATE                                   */
/*          &DOLLARN    - DOLLARS        (PASSED)                   */
/*          &POUNDSN    - POUNDS         (PASSED)                   */
/*          &MEMOFLG    - CM/DM FLAG     (PASSED)                   */
/*          &RPT1       - REPORT SEL 1   (PASSED)                   */
/*          &RPT2       - REPORT SEL 2   (PASSED)                   */
/*          &RPT3       - REPORT SEL 3   (PASSED)                   */
/*          &CSTSEQ     - CUSTOMER SEQ   (PASSED)                   */
/********************************************************************/
/* 12/02/2005  LARA BUSER - ADDED SELECTION FOR COMPANY NUMBER      */
/*      BEING PASSED AS ZEROS. IF ZEROS THEN BUILD THE SELECT       */
/*      WITHOUT THE CO# SO ALL WILL BE IN THE QUERY DATA.           */
/*                                                                  */
/* 02/07/2007  LJB L70117A - REMOVED COMPANY NUMBER FROM THE        */
/*      QUERY SELECT STATEMENT - ALL RECORDS NEED TO BE INCLUDED.   */
/*      CO# IS NEEDED FOR OTHER COMPANIES SO THE HISTORICAL DATA    */
/*      CAN BE RETRIEVED FOR THE REPORT. PASS THE CO# TO THE PGM.   */
/* 07/03/2007  JRB DLY029  - ADDED TYPE GROUP & CLASS               */
/* 05/26/2023  PIO - REPLACE OPNQRYF WITH OPNSQLF FOR OMHSTPP FILE  */
/*                   ADDED NEEDED OVRDBF AROUND THE COMMAND.        */
/*                   CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO*/
/*                   <=, *GT TO > IN &D                             */
/********************************************************************/
 OMNNPCLP:   PGM        PARM(&RETURN &PGM &COMPL &FDATEL &TDATEL +
                          &DOLLARN &POUNDSN &MEMOFLG &RPT1 &RPT2 +
                          &RPT3 &CSTSEQ &OUTQ &HOLD &SAVE &COPIESL +
                          &NIGHTQ &TYPEN &GROUPN &CLASSN)
/*PIO                     &NIGHTQ)                                  */

        DCL    &RETURN    *CHAR   7               /*  RETURN CODE   */
        DCL    &PGM       *CHAR   10              /*  PGM NAME      */
        DCL    &COMPL     *DEC                    /*  FOR PASSING   */
        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #     */
        DCL    &FDATEL    *DEC                    /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)           /*  FROM DATE     */
        DCL    &TDATEL    *DEC                    /*  FOR PASSING   */
        DCL    &TDATE     *DEC    (7 0)           /*  THROUGH DATE  */
        DCL    &DOLLARN   *DEC                    /*  FOR PASSING   */
        DCL    &DOLLAR    *DEC    (7 0)           /*  FROM DATE     */
        DCL    &POUNDSN   *DEC                    /*  FOR PASSING   */
        DCL    &POUNDS    *DEC    (7 0)           /*  THROUGH DATE  */
        DCL    &MEMOFLG    *CHAR   (1)           /* CM/DM FLAGE               */
        DCL    &RPT1       *CHAR   (1)            /* REPORT 1       */
        DCL    &RPT2       *CHAR   (1)            /* REPORT 2       */
        DCL    &RPT3       *CHAR   (1)            /* REPORT 3       */
        DCL    &CSTSEQ     *CHAR   (1)           /* CUSTOMER SEQUENCE         */
        DCL    &OUTQ      *CHAR   10              /*  OUTPUT QUEUE  */
        DCL    &HOLD       *CHAR   (4)            /* Hold Status    */
        DCL    &SAVE       *CHAR   (4)            /* Save Status    */
        DCL    &COPIES    *DEC    (3 0)           /*  # OF COPIES   */
        DCL    &COPIESL   *DEC                    /*  FOR PASSING   */
        DCL    &NIGHTQ    *CHAR   10              /*  NIGHT JOB QUE.*/
        DCL    &COMPA     *CHAR   3               /*  COMPANY ALPHA */
        DCL    &TDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &FDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &COMMAND    *CHAR   (512)

/* SEND PROGRAM MESSAGE PARAMETERS  */

        DCL    VAR(&PGMO) TYPE(*CHAR) LEN(10) /* REPORT PRINT FILE  */
        DCL     &A        *CHAR   20              /* QRY YTD DATE   */
        DCL     &B        *CHAR   25              /* QRY TO DATE    */
        DCL     &C        *CHAR   25              /* QRY COMPANY    */
        DCL     &D        *CHAR   70              /* QRY ALL        */
        DCL     &DATA     *CHAR   10              /* DATA FILES     */
        DCL     &DATAH    *CHAR   10              /* HIST FILES     */

/*PIO Changes Begin*/
        DCL        VAR(&TYPEN) TYPE(*DEC)
        DCL        VAR(&TYPE) TYPE(*DEC) LEN(3 0) /* Item STRUCTURE TYPE */
        DCL        VAR(&GROUPN) TYPE(*DEC)
        DCL        VAR(&GROUP) TYPE(*DEC) LEN(3 0) /* ITEM STRUCTURE GROUP*/
        DCL        VAR(&CLASSN) TYPE(*DEC)
        DCL        VAR(&CLASS) TYPE(*DEC) LEN(3 0) /* ITEM STRUCTURE CLASS*/
/*PIO Changes End*/

             CHGVAR     VAR(&COMP) VALUE(&COMPL) /* Change parm +
                          company number to 3.0 numeric */
             CHGVAR     VAR(&COMPA) VALUE(&COMP) /* Change numeric +
                          company number to alpha */
             CHGVAR     VAR(&FDATE) VALUE(&FDATEL) /* Change parm +
                          from date to 7.0 numeric date */
             CHGVAR     VAR(&FDATEA) VALUE(&FDATE) /* Change numeric +
                          date to alpha */
             CHGVAR     VAR(&TDATE) VALUE(&TDATEL) /* Change parm to +
                          date to 7.0 numeric date */
             CHGVAR     VAR(&TDATEA) VALUE(&TDATE) /* Change numeric +
                          to date to alpha */
             CHGVAR     VAR(&DOLLAR) VALUE(&DOLLARN) /* Change parm +
                          dollar to 7.0 numeric */
             CHGVAR     VAR(&POUNDS) VALUE(&POUNDSN) /* Change parm +
                          pounds to 7.0 numeric */
             CHGVAR     VAR(&COPIES) VALUE(&COPIESL) /* Change parm +
                          number of copies to 3.0 numeric */

/*PIO Changes Begin*/
             CHGVAR     VAR(&TYPE) VALUE(&TYPEN)
             CHGVAR     VAR(&GROUP) VALUE(&GROUPN)
             CHGVAR     VAR(&CLASS) VALUE(&CLASSN)
/*PIO Changes End*/

/********************************************************************/
/* Retrieve Data Library name and Data History library name         */
/********************************************************************/
             CALL       PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

/*********************************************************************/
/*   CREATE WORK FILES IN QTEMP                                      */
/*********************************************************************/
             RMVLIBLE   LIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             ADDLIBLE   LIB(QTEMP)
             MONMSG     MSGID(CPF0000)

             CLRPFM     FILE(OMH4REP)
             CRTDUPOBJ  OBJ(OMH4REP) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             CRTDUPOBJ  OBJ(OMH4REL0) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             CRTDUPOBJ  OBJ(OMH4REL1) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             CRTDUPOBJ  OBJ(OMH4REL2) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             CRTDUPOBJ  OBJ(OMH4REL3) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)
             CRTDUPOBJ  OBJ(OMH4REL4) FROMLIB(&DATA) +
                          OBJTYPE(*FILE) TOLIB(QTEMP)
             MONMSG     MSGID(CPF0000)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORT                    */
/*   INCLUDE ALL COMPANIES IN THE QUERY      LJB 02/07/2007          */
/*********************************************************************/
             GOTO       CMDLBL(NOCOMPANY)

/* SKIP BUILD OF STATEMENT THAT INCLUDES COMPANY NUMBER              */
             IF         COND(&COMPL *EQ 0) THEN(GOTO +
                          CMDLBL(NOCOMPANY))

   /*PIO     CHGVAR     VAR(&A) VALUE('F4GNDT *GE ' *CAT + +
                         &FDATEA)                        */
   /*PIO*/   CHGVAR     VAR(&A) VALUE('F4GNDT  >= ' *CAT +
                         &FDATEA)

   /*PIO     CHGVAR     VAR(&B) VALUE('*AND F4GNDT *LE ' *CAT + +
                         &TDATEA)                              */
   /*PIO*/   CHGVAR     VAR(&B) VALUE(' AND F4GNDT <=  ' *CAT +
                         &TDATEA)

   /*PIO     CHGVAR     VAR(&C) VALUE('*AND F4AIC3 *EQ ' *CAT + +
                         &COMPA)                               */
   /*PIO*/   CHGVAR     VAR(&C) VALUE(' AND F4AIC3  =  ' *CAT +
                         &COMPA)

             CHGVAR     VAR(&D) VALUE(&A *BCAT &B *BCAT &C)

/*********************************************************************/
/*   BUILD SELECT STATEMENT TO INCLUDE ALL COMPANIES                 */
/*********************************************************************/
/**>>>>>     IF         COND(&COMPL *GT 0) THEN(GOTO +
                          CMDLBL(ENDQRYSTMT))           >>>>>>>>  ****/

NOCOMPANY:
   /*PIO     CHGVAR     VAR(&A) VALUE('F4GNDT *GE ' *CAT + +
                         &FDATEA)                         */
   /*PIO*/   CHGVAR     VAR(&A) VALUE('F4GNDT >=  ' *CAT +
                         &FDATEA)

   /*PIO     CHGVAR     VAR(&B) VALUE('*AND F4GNDT *LE ' *CAT + +
                         &TDATEA)                              */
   /*PIO*/   CHGVAR     VAR(&B) VALUE(' AND F4GNDT  <= ' *CAT +
                         &TDATEA)

             CHGVAR     VAR(&D) VALUE(&A *BCAT &B)

/*********************************************************************/
/*   SELECT QUERY BY REPORT BEING RUN                                */
/*********************************************************************/
 /*PIO    ENDQRYSTMT: OVRDBF     FILE(OMHSTPL1) SHARE(*YES) +
             OPNQRYF    FILE(OMHSTPL1) +                    +
                        QRYSLT(&D) +                        +
                        KEYFLD(*FILE)                      */

 /*PIO*/     OVRDBF     FILE(OMHSTPP) TOFILE(OMHSTPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMHSTPP Where  ' *BCAT &D +
                          *BCAT ' ORDER BY F4AIC3 ASC, F4C4NB ASC, +
                          F4DPNB ASC, F4UENB ASC') OPNID(OMHSTPL1) +
                          OPTION(*ALL) SEQONLY(*NO) RCDFMT(@FHSTD3) +
                          ALWCPY(*IFRQD) /*PIO*/
 /*PIO*/     OVRDBF     FILE(OMHSTPL1) TOFILE(OMHSTPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


/* BUILD CUSTOMER RANKING WORK FILE                                 */

             CALL       PGM(OMWLXFR) PARM('' &MEMOFLG &RPT1 &RPT3 +
                          &CSTSEQ &COMP)

             CLOF       OPNID(OMHSTPL1)
   /*PIO     DLTOVR     FILE(OMHSTPL1)     */
             DLTOVR     FILE(OMHSTPL1) LVL(*JOB) /*PIO*/

/*********************************************************************/
/*   CALL LISTING PROGRAM                                            */
/*********************************************************************/
  /* CUSTOMER RANKING BY CUSTOMER SALES GROUP      */

             CHGVAR     VAR(&PGMO) VALUE(PDXFPFR$)

/*****       SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) +
                          SAVE(&SAVE)                           +
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512) *************/

             OVRPRTF    FILE(&PGMO) OUTQ(&OUTQ) COPIES(&COPIES) +
                          HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(PDXFPFR) PARM('' &FDATE &TDATE &MEMOFLG +
                          &RPT1 &RPT2 &RPT3 &CSTSEQ &DOLLAR +
/*PIO*/                   &POUNDS &COMP &TYPE &GROUP &CLASS)
/*PIO                     &POUNDS &COMP)                                     */

/*   DELETE WORK FILES IN QTEMP.  */
             DLTF       FILE(QTEMP/OMH4REL0)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/OMH4REL1)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/OMH4REL2)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/OMH4REL3)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/OMH4REL4)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/OMH4REP)
             MONMSG     MSGID(CPF0000)

 END:        ENDPGM
