// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKBFXFR
// ?Date: 14.08.2025 Time: 02:51:07
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?H16853 ISE 11/02/20 - Increased the Buy Order Number field
//? length from 5 to 7.
//?Flag all unpaid tattoos as paid
//?new 10/15/04      mark th as paid, then delete the work record.
EXECUTE FUNCTION(Dlt TH Jbsl/Pay TH    Rt) TYPE(RTVOBJ) FILE(PKDOREP)           AB1262178;
PARAMETER('REPAY');
PARAMETER(PAR.CC_Company_Number);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Rtv/Chg Th PayInfo/Rep Rt) TYPE(RTVOBJ) FILE(PKA1CPP)          AB1180837;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 {
  //?USER: Process Data record

  // WRK.TH Payment Sts = DB1.TH Payment Sts
  WRK.TH_Payment_Sts = DB1.TH_Payment_Sts;

  //?Set payment sts to PAID - live, carcass, intrnl live, or intrnl carc
  CASE;

  // IF DB1.TH Payment Sts is Mark Live Payment
  IF DB1.TH_Payment_Sts = 'ML';

  // OR DB1.TH Payment Sts is Select Live
  OR DB1.TH_Payment_Sts = 'SL';

  // WRK.TH Payment Sts = CND.Paid Live
  WRK.TH_Payment_Sts = 'PL';

  //?Set payment sts to PAID - live, carcass, intrnl live, or intrnl carc
  // IF DB1.TH Payment Sts is Sl Carcass Merit
  IF DB1.TH_Payment_Sts = 'SC';

  // WRK.TH Payment Sts = CND.PD Carcass Merit
  WRK.TH_Payment_Sts = 'PC';

  //?Set payment sts to PAID - live, carcass, intrnl live, or intrnl carc
  // IF DB1.TH Payment Sts is Sl Int Carc
  IF DB1.TH_Payment_Sts = 'IC';

  // WRK.TH Payment Sts = CND.Post Int Carc
  WRK.TH_Payment_Sts = 'NC';

  //?Set payment sts to PAID - live, carcass, intrnl live, or intrnl carc
  // IF DB1.TH Payment Sts is Sl Int Live
  IF DB1.TH_Payment_Sts = 'IL';

  // WRK.TH Payment Sts = CND.Post Int Live
  WRK.TH_Payment_Sts = 'NL';

  ENDIF;

  //?** OLD:  Chg Tattoo Header   CH * Tattoo Header  **  (PKP)
  EXECUTE FUNCTION(Chg Pay Sts           CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1156796;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(WRK.TH_Payment_Sts);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
   PARAMETER(DB1.RS_User_Changed);
   PARAMETER(DB1.RS_Date_Changed);
   PARAMETER(DB1.RS_Time_Changed);
   PARAMETER(DB1.RS_Job);
   PARAMETER(DB1.RS_Program);
   {
    //?Execute internal function

    // PAR.RS User Changed = JOB.*USER
    PAR.RS_User_Changed = JOB.*USER;

    // PAR.RS Date Changed = JOB.*Job date
    PAR.RS_Date_Changed = JOB.*Job_date;

    // PAR.RS Time Changed = JOB.*Job time
    PAR.RS_Time_Changed = JOB.*Job_time;

    // PAR.RS Job = JOB.*JOB
    PAR.RS_Job = JOB.*JOB;

    // PAR.RS Program = JOB.*PROGRAM
    PAR.RS_Program = JOB.*PROGRAM;

   }

   EXECUTE FUNCTION(Chg/Crt Tatto/Spc Flds IF) TYPE(EXCINTFUN)                     AB1189848;
   PARAMETER(DB1.TH_Payment_Sts);
   PARAMETER(DB1.TH_Payment_Type);
   {
    //?Execute internal function

    EXECUTE FUNCTION(HPE056 Payment Type) TYPE(EXCINTFUN)                           AB1189849;
    {
     //?Execute internal function

     //?1/10/96  HPE056   Allow payment type to be update based on
     //?                  what the payment status is at the time this
     //?                  tattoo is being updated
    }

    //?Function Description:  If there are any fields that need to be
    //?Changed/Created during the Change functions or Create function
    //?Presently: Payment Type
    //?Add this routine to all of the change objects and create object
    //?that update the Payment Type
    CASE;

    // IF PAR.TH Payment Sts is Live anything
    IF PAR.TH_Payment_Sts = 'ML'/'PL'/'NL'/'SL'/'IL';

    // PAR.TH Payment Type = CND.Live
    PAR.TH_Payment_Type = 'L';

    // IF *OTHERWISE
    IF *OTHERWISE;

    // PAR.TH Payment Type = CND.Carcass Merit
    PAR.TH_Payment_Type = 'C';

    ENDIF;

   }

  }

  EXECUTE FUNCTION(Rtv/Chg Ttt/Kl D/A Sts RT) TYPE(RTVOBJ) FILE(PKCDCPP)          AB1186963;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(WRK.TH_Payment_Sts);
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Change Tattoo Deduction) TYPE(CHGOBJ) FILE(PKCDCPP)            AB1107818;
   PARAMETER(DB1.BOH_Company_Number);
   PARAMETER(DB1.BOH_Buy_Order_Number);
   PARAMETER(DB1.BOL_Load_Number);
   PARAMETER(DB1.TH_Tattoo_Number);
   PARAMETER(DB1.TH_Kill_Date);
   PARAMETER(DB1.DED_D_A_Code);
   PARAMETER(DB1.THD_Ded_Add_Amount);
   PARAMETER(DB1.THD_Ded_Add_Amount);
   PARAMETER(DB1.THD_Unit_Amt_Sign);
   PARAMETER(DB1.THD_UOM);
   PARAMETER(DB1.THD_Transaction_Created);
   PARAMETER(DB1.THD_GL_Code);
   PARAMETER(DB1.THD_Contra_Gl_Code);
   PARAMETER(DB1.THD_Re_imbursement_Head);
   PARAMETER(PAR.THD_Payment_Sts);
   PARAMETER(DB1.THD_Expense_Paid_by);
   PARAMETER(DB1.THD_Expense_Type);
   PARAMETER(DB1.THD_Reserve_Account_Upd);
   PARAMETER(DB1.THD_Commission_Deduction);
   PARAMETER(DB1.THD_Deferred_Payment);
   PARAMETER(DB1.THD_Status_4);
   PARAMETER(DB1.THD_Status_5);
   PARAMETER(DB1.RS_User_Changed);
   PARAMETER(DB1.RS_Date_Changed);
   PARAMETER(DB1.RS_Time_Changed);
   PARAMETER(DB1.RS_Record_Status);
   PARAMETER(DB1.RS_Job);
   PARAMETER(DB1.RS_Program);
   PARAMETER(DB1.RS_User_Added);
   PARAMETER(DB1.RS_Date_Added);
   PARAMETER(DB1.RS_Time_Added);
   {
    //?USER: Processing before Data update

    EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
    PARAMETER(DB1.RS_User_Changed);
    PARAMETER(DB1.RS_Date_Changed);
    PARAMETER(DB1.RS_Time_Changed);
    PARAMETER(DB1.RS_Job);
    PARAMETER(DB1.RS_Program);
    {
     //?Execute internal function

     // PAR.RS User Changed = JOB.*USER
     PAR.RS_User_Changed = JOB.*USER;

     // PAR.RS Date Changed = JOB.*Job date
     PAR.RS_Date_Changed = JOB.*Job_date;

     // PAR.RS Time Changed = JOB.*Job time
     PAR.RS_Time_Changed = JOB.*Job_time;

     // PAR.RS Job = JOB.*JOB
     PAR.RS_Job = JOB.*JOB;

     // PAR.RS Program = JOB.*PROGRAM
     PAR.RS_Program = JOB.*PROGRAM;

    }

   }

  }

  // Call program Crt Tattoo Action Comm XF.
  CALL PROGRAM(Crt Tattoo Action Comm XF) ('PKV4XFR');
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(*ZERO);
  PARAMETER(*ZERO);
  PARAMETER(DB1.TH_AP_Voucher_Document#);
  PARAMETER(DB1.TH_Voucher_Payment_Date);
  PARAMETER('RP');
  PARAMETER(*BLANK);

 }

 EXECUTE FUNCTION(Dlt Tattoo Header Job DO) TYPE(DLTOBJ) FILE(PKDOREP)           AB1177569;
 PARAMETER(DB1.Tattoo_Job_Sel_Name);
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
}


