PGM  (&PGMVNM &OBJATR &FUNCDE &SYSPFX &PHYVNM &RETRY &PRFMNC)
/*T: YALCVNM Allocate Function name. */
/*Z: CRTCLPGM LOG(*NO) */
/*H: SYSTEM     : SYNON/2 ROUTINE                                      */
/*H: PROGRAMMER : P.WILSON                                             */
/*H: COPYRIGHT (C) 1986 SYNON.                                         */
/*H: SYNOPIS: Allocates a program name for a Synon/2 function.         */
/*W: PROGRAM NAMES SHOULD BE UNIQUE WITHIN A MODEL.                    */

/*M: 06/04/88  PV Add preferred mnemonic parameter and processing  */
/*M:              Replace hardcoded suffix of R by calling program */
/*M:              to retrieve the substitution allocation character*/
/*M:                                     &MNEMONIC -> &AUTMNC      */
/*                                       Automatically allocated   */
/*W: Preferred mnemonic only passed if YALCVNM is *MNC and */
/*W: a mnemonic exists for the object */


DCL &PGMVNM *CHAR 10 /*O: Allocated program name. */
                     /*   Blank = give up auto allocate */
DCL &OBJATR *CHAR  3 /*I: Synon/2 HLL program type */
DCL &FUNCDE *CHAR  2 /*I: Synon/2 function code */
DCL &SYSPFX *CHAR  2 /*I: Synon/2 system prefix. */
DCL &PHYVNM *CHAR 10 /*I: Synon/2 PHY member name. */
DCL &RETRY  *DEC   3 /*I: Retry count, 1-on first entry */
                     /*   incremented by 1 for each retry.*/
DCL &AUTMNC *CHAR 2  /* Automatically allocated mnemonic */
DCL &PRFMNC *CHAR 6 /* Preferred mnemonic 1 + 2 + 3 char mnemonics */
DCL &SFX    *CHAR 1  /* Allocation character suffix for source type */
DCL &SEUTYP *CHAR 8  /* HLL program SEU type */

/*H: 1. If preferred mnemonic try only once */
/*      Otherwise allow 5 tries             */
            IF (   (      (&RETRY *GT 10) +
                     *AND (&PRFMNC *NE ' ') ) +
               *OR (      (&RETRY *GT 10) +
                     *AND (&PRFMNC *EQ ' ') ) ) DO
               CHGVAR &PGMVNM ' '
               RETURN
            ENDDO

/*H: 2. If preferred mnemonic specified use it */
/*      Otherwise call program to allocate mnemonic */
            IF (&PRFMNC *EQ ' ') DO
               CALL YALCVNMR1R (MSG &AUTMNC)
               CALL YALCVNMR1R (MSG &FUNCDE)
            ENDDO

/*H: 3. Construct program name: System prefix + */
/*                              Function mnemonic + */
/*                              Function type + */
/*                              Allocation character for source type */
            CHGVAR &SEUTYP &OBJATR
            CALL YGENTYPR1I (&SEUTYP '' &SFX)
            IF (&PRFMNC *EQ ' ') CHGVAR &PGMVNM (&SYSPFX |< +
                                                 &AUTMNC |< +
                                                 &FUNCDE |< +
                                                 &SFX)
            ELSE                 CHGVAR &PGMVNM (&SYSPFX |< +
                                                 %SST(&PRFMNC 2 2) |< +
                                                 &FUNCDE |< +
                                                 &SFX)
ENDPGM
