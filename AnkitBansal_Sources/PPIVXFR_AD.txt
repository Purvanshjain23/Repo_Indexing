// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPIVXFR
// ?Date: 14.08.2025 Time: 03:40:46
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// LCL.Broker Records Found Usr = CND.no
LCL.Broker_Records_Found_Usr = 'N';

// LCL.Record Found SlsMrk  Usr = CND.Blanks
LCL.Record_Found_SlsMrk_Usr = *BLANK;

//?Sale Market file review for records.
EXECUTE FUNCTION(Vry Broker            rt) TYPE(RTVOBJ) FILE(PMDDREP)           AC1940211;
PARAMETER(PAR.Broker_Code);
PARAMETER(LCL.Record_Found_SlsMrk_Usr);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found SlsMrk  Usr = CND.Record Not Found
 PAR.Record_Found_SlsMrk_Usr = 'N';

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

 // PAR.Record Found SlsMrk  Usr = CND.Record Found
 PAR.Record_Found_SlsMrk_Usr = 'Y';

 QUIT;

}


CASE;

// IF PGM.*Return code is *Record already exists
IF PGM.*Return_code = 'Y2U0003';

// LCL.Broker Records Found Usr = CND.yes
LCL.Broker_Records_Found_Usr = 'Y';

ENDIF;

//?Customer Accrual - if active rcds exist, broker must stay Active
EXECUTE FUNCTION(Val Accr for Broker   RT) TYPE(RTVOBJ) FILE(OMHOREP)           AC1849391;
PARAMETER(PAR.Broker_Code);
PARAMETER(LCL.Rec_Inact_Del_Cust_Usr);
{
 //?USER: Process Data record

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

 CASE;

 // IF JOB.*Job date LE DB1.Period Ending Date
 IF JOB.*Job_date <= DB1.Period_Ending_Date;

 // PAR.Rec Inact/Del Cust Usr = CND.no
 PAR.Rec_Inact_Del_Cust_Usr = 'N';

 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Rec Inact/Del Cust Usr = CND.yes
 PAR.Rec_Inact_Del_Cust_Usr = 'Y';

 QUIT;

 ENDIF;

}


CASE;

// IF PGM.*Return code is *Record already exists
IF PGM.*Return_code = 'Y2U0003';

// LCL.Broker Records Found Usr = CND.yes
LCL.Broker_Records_Found_Usr = 'Y';

ENDIF;

//?*********
//?Val Shipping dtl Accrual - if broker fouund it can go inactive
CASE;

// IF LCL.Broker Records Found Usr is no
IF LCL.Broker_Records_Found_Usr = 'N';

EXECUTE FUNCTION(Val Broker Exists     RT) TYPE(RTVOBJ) FILE(OMHRCPP)           AC1849393;
PARAMETER(PAR.Broker_Code);
PARAMETER(LCL.Rec_Inact_Del_ShHs_Usr);
{
 //?USER: Process Data record

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

 // PAR.Rec Inact/Del ShHs Usr = CND.yes
 PAR.Rec_Inact_Del_ShHs_Usr = 'Y';

 QUIT;

}


CASE;

// IF PGM.*Return code is *Record already exists
IF PGM.*Return_code = 'Y2U0003';

// LCL.Broker Records Found Usr = CND.yes
LCL.Broker_Records_Found_Usr = 'Y';

ENDIF;

ENDIF;

//?*********
//?Set record status based on findings
CASE;

// IF LCL.Broker Records Found Usr is yes
IF LCL.Broker_Records_Found_Usr = 'Y';

CASE;

// IF LCL.Record Found SlsMrk  Usr is Record Found
IF LCL.Record_Found_SlsMrk_Usr = 'Y';

// PAR.Record Status = CND.Active
PAR.Record_Status = 'A';

// IF LCL.Rec Inact/Del Cust Usr is no
IF LCL.Rec_Inact_Del_Cust_Usr = 'N';

// PAR.Record Status = CND.Active
PAR.Record_Status = 'A';

// IF LCL.Rec Inact/Del ShHs Usr is no
IF LCL.Rec_Inact_Del_ShHs_Usr = 'N';

// PAR.Record Status = CND.Inactive
PAR.Record_Status = 'I';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Record Status = CND.Inactive
PAR.Record_Status = 'I';

ENDIF;

//?Set record status based on findings
// IF LCL.Broker Records Found Usr is no
IF LCL.Broker_Records_Found_Usr = 'N';

//?leave the records status
//?what it was coming in. could be "D" or "I"
//?Set record status based on findings
ENDIF;

