// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMW6XFR
// ?Date: 14.08.2025 Time: 03:44:24
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// LCL.Number Value - 7 = CON.*ZERO
LCL.Number_Value_7 = *ZERO;

EXECUTE FUNCTION(BLD WF MBC             IF) TYPE(EXCINTFUN)                     AC1893865;
PARAMETER(LCL.Number_Value_7);
{
 //?Execute internal function

 EXECUTE FUNCTION(RTV Loads w/Multi StopsRT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1893877;
 PARAMETER(*ZERO);
 PARAMETER(PAR.Number_Value_7);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Total Stops is GT One Stop
  IF DB1.Total_Stops > 1;

  // AND DB1.Load ID is NE Blank
  AND DB1.Load_ID <> *ZERO;

  EXECUTE FUNCTION(RTV Ord City for Stops RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1893885;
  PARAMETER(DB1.Load_ID);
  PARAMETER(PAR.Number_Value_7);
  {
   //?USER: Initialize routine

   // LCL.Count USR = CON.1
   LCL.Count_USR = 1;

   // LCL.Ship To City = CON.*BLANK
   LCL.Ship_To_City = *BLANK;

   // LCL.Ship To State Code = CON.*BLANK
   LCL.Ship_To_State_Code = *BLANK;

   // WRK.Ship To City = CON.*BLANK
   WRK.Ship_To_City = *BLANK;

   // WRK.Ship To State Code = CON.*BLANK
   WRK.Ship_To_State_Code = *BLANK;

   //?USER: Process Data record

   //?** Save current order city/state, convert to all caps
   EXECUTE FUNCTION(RTV Ship To City/State RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1454149;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Order_Number);
   PARAMETER(WRK.Ship_To_City);
   PARAMETER(WRK.Ship_To_State_Code);
   {
    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   // Call program Zzz Str to Upper Alpha XF.
   CALL PROGRAM(Zzz Str to Upper Alpha XF) ('PMNAXFR');
   PARAMETER(WRK.Ship_To_City);
   PARAMETER(WRK.Ship_To_City);

   CASE;

   // IF WRK.Ship To City is NE Blanks
   IF WRK.Ship_To_City <> *BLANK;

   CASE;

   // IF LCL.Count USR is One
   IF LCL.Count_USR = 1;

   EXECUTE FUNCTION(RTV Whse/Non Cancelled RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1428700;
   PARAMETER(DB1.Company_Number);
   PARAMETER(DB1.Order_Number);
   PARAMETER(1);
   PARAMETER(1);
   PARAMETER(WRK.Warehouse_Code);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    //?USER: Process Data record

    //?C2748:  Changed RTV Warehouse Code RT to exclude Cancelled lines.
    CASE;

    // IF DB1.Detail Line Status is Cancelled
    IF DB1.Detail_Line_Status = 'X';

    // IF *OTHERWISE
    IF *OTHERWISE;

    MOVE *ALL (To: PAR From: DB1);

    QUIT;

    ENDIF;

   }

   //?** Retrieve whs city/state into PAR, convert to all caps
   EXECUTE FUNCTION(RTV Warehouse Address  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1211418;
   PARAMETER(WRK.Warehouse_Code);
   PARAMETER(NLL.Warehouse_Description);
   PARAMETER(NLL.Address_Line_1);
   PARAMETER(NLL.Address_Line_2);
   PARAMETER(NLL.Address_Line_3);
   PARAMETER(PAR.From_City);
   PARAMETER(NLL.Zip_Postal_Code);
   PARAMETER(PAR.From_State);
   {
    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   // Call program Zzz Str to Upper Alpha XF.
   CALL PROGRAM(Zzz Str to Upper Alpha XF) ('PMNAXFR');
   PARAMETER(PAR.From_City);
   PARAMETER(PAR.From_City);

   //?** Put city/state from Order Header into "To" fields
   // PAR.To City = WRK.Ship To City
   PAR.To_City = WRK.Ship_To_City;

   // PAR.To State State Code = WRK.Ship To State Code
   PAR.To_State_State_Code = WRK.Ship_To_State_Code;

   //?** Save current order city/state for next order "From" fields
   // LCL.Ship To City = WRK.Ship To City
   LCL.Ship_To_City = WRK.Ship_To_City;

   // LCL.Ship To State Code = WRK.Ship To State Code
   LCL.Ship_To_State_Code = WRK.Ship_To_State_Code;

   // IF *OTHERWISE
   IF *OTHERWISE;

   //?** Put prior order city/state into "From" fields
   // PAR.From City = LCL.Ship To City
   PAR.From_City = LCL.Ship_To_City;

   // PAR.From State = LCL.Ship To State Code
   PAR.From_State = LCL.Ship_To_State_Code;

   //?** Put current order city/state in the "To" fields
   // PAR.To City = WRK.Ship To City
   PAR.To_City = WRK.Ship_To_City;

   // PAR.To State State Code = WRK.Ship To State Code
   PAR.To_State_State_Code = WRK.Ship_To_State_Code;

   //?** Save current order city/state for next order "From" fields
   // LCL.Ship To City = WRK.Ship To City
   LCL.Ship_To_City = WRK.Ship_To_City;

   // LCL.Ship To State Code = WRK.Ship To State Code
   LCL.Ship_To_State_Code = WRK.Ship_To_State_Code;

   ENDIF;

   // PAR.Number Value - 7 = PAR.Number Value - 7 + CON.1
   PAR.Number_Value_7 = PAR.Number_Value_7 + 1;

   // PAR.Sequence Number 7,0 = PAR.Number Value - 7
   PAR.Sequence_Number_7_0 = PAR.Number_Value_7;

   EXECUTE FUNCTION(CRT WF MBC             CR) TYPE(CRTOBJ) FILE(PMD5CPP)          AC1893862;
   PARAMETER(PAR.From_City);
   PARAMETER(PAR.From_State);
   PARAMETER(PAR.To_City);
   PARAMETER(PAR.To_State_State_Code);
   PARAMETER(PAR.Sequence_Number_7_0);
   PARAMETER(DB1.Miles_to_next_stop);
   PARAMETER(0);
   // LCL.Count USR = LCL.Count USR + CON.1
   LCL.Count_USR = LCL.Count_USR + 1;

   ENDIF;

  }

  ENDIF;

 }

}


