// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLHUXFR
// ?Date: 14.08.2025 Time: 02:54:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?R7522 JJH 02/17/17 - Inactivate Producer Site Mileage
//?Initialize trace seq starting with 9000000.
//?This goes in the Product Trace as the Producer/Farm Code.
//?E3814 JJH 10/05/15 - Recompile to add new field, PS Premises ID
ENDDO;

EXECUTE FUNCTION(Cnv Trace Seq#        RT) TYPE(RTVOBJ) FILE(PLATREP)           AB1273415;
{
 //?USER: Initialize routine

 // WRK.PS Trace Sequence # = CON.900000
 WRK.PS_Trace_Sequence_# = 900000;

 //?USER: Process Data record

 // WRK.PS Trace Sequence # = WRK.PS Trace Sequence # + CON.1
 WRK.PS_Trace_Sequence_# = WRK.PS_Trace_Sequence_# + 1;

 //?E3814 JJH 10/05/15 - Add PS Premises ID
 //?R7522 JJH 02/17/17 - Inactivate Producer Site Mileage
 EXECUTE FUNCTION(Chg Producer Site     CH) TYPE(CHGOBJ) FILE(PLATREP)           AB1267656;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PS_Site_ID);
 PARAMETER(DB1.PS_Site_Name);
 PARAMETER(DB1.PS_Manager);
 PARAMETER(DB1.PS_Address);
 PARAMETER(DB1.PS_City);
 PARAMETER(DB1.PS_State);
 PARAMETER(DB1.PS_Zip_Code);
 PARAMETER(DB1.PS_Latitude);
 PARAMETER(DB1.PS_Longitude);
 PARAMETER(DB1.PS_User_Mileage_1);
 PARAMETER(DB1.PS_User_Mileage_2);
 PARAMETER(DB1.PS_Facility_Type_County);
 PARAMETER(DB1.PS_Status_1);
 PARAMETER(DB1.PS_Status_2);
 PARAMETER(DB1.PS_Status_3);
 PARAMETER(WRK.PS_Trace_Sequence_#);
 PARAMETER(DB1.PS_Veterinarian);
 PARAMETER(DB1.PS_Nutritionist);
 PARAMETER(DB1.PS_Premises_ID);
 PARAMETER(DB1.RS_Record_Status);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp-SysDtIF) TYPE(EXCINTFUN)                      AB1237006;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // Call program Rtv System Date & Tim UP.
   CALL PROGRAM(Rtv System Date & Tim UP) ('PKWDUPC');
   PARAMETER(PAR.RS_Date_Changed);
   PARAMETER(PAR.RS_Time_Changed);

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

  //?USER: Processing after Data update

  //?R7522A JJH 02/17/17 - Set the Producer Site Mileage - RS Record
  //?  Status to the same RS Record Status as the Producer Site.
  EXECUTE FUNCTION(Rtv Upd Record Status RT) TYPE(RTVOBJ) FILE(PLASREP)           AB1331615;
  PARAMETER(DB1.PD_Producer_Code);
  PARAMETER(DB1.PS_Site_ID);
  PARAMETER(DB1.RS_Record_Status);
  {
   //?USER: Process Data record

   CASE;

   // IF DB1.RS Record Status NE PAR.RS Record Status
   IF DB1.RS_Record_Status <> PAR.RS_Record_Status;

   EXECUTE FUNCTION(Chg RS Record Status  CO) TYPE(CHGOBJ) FILE(PLASREP)           AB1331616;
   PARAMETER(DB1.PD_Producer_Code);
   PARAMETER(DB1.PS_Site_ID);
   PARAMETER(DB1.PSM_Company_Number);
   PARAMETER(PAR.RS_Record_Status);
   {
    //?USER: Processing before Data update

    EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
    PARAMETER(DB1.RS_User_Changed);
    PARAMETER(DB1.RS_Date_Changed);
    PARAMETER(DB1.RS_Time_Changed);
    PARAMETER(DB1.RS_Job);
    PARAMETER(DB1.RS_Program);
    {
     //?Execute internal function

     // PAR.RS User Changed = JOB.*USER
     PAR.RS_User_Changed = JOB.*USER;

     // PAR.RS Date Changed = JOB.*Job date
     PAR.RS_Date_Changed = JOB.*Job_date;

     // PAR.RS Time Changed = JOB.*Job time
     PAR.RS_Time_Changed = JOB.*Job_time;

     // PAR.RS Job = JOB.*JOB
     PAR.RS_Job = JOB.*JOB;

     // PAR.RS Program = JOB.*PROGRAM
     PAR.RS_Program = JOB.*PROGRAM;

    }

   }

   ENDIF;

  }

 }

}


