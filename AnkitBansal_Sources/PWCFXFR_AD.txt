// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWCFXFR
// ?Date: 14.08.2025 Time: 02:55:56
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//? 3/31/2017 JBB E9815 - Add Company Number to Producer Files
//?                       Function created.  Part of this project
//?                       is to add a company number field to the
//?                       Producer Loc Std D/A file.  This program
//?                       uses the library suffix to determine the
//?                       number to populate into the field.
ENDDO;

//?If incoming library is entered, continue processing
CASE;

// IF PAR.Library is Entered
IF PAR.Library <> *BLANK;

// LCL.Count USR = CND.One
LCL.Count_USR = 1;

//?Determine library suffix
// DOW LCL.Count USR is LE 10
DOW LCL.Count_USR <= 10;

// LCL.Text 1                USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.1)
LCL.Text_1_USR = SUBSTRING(PAR.Library:LCL.Count_USR:1);

//?If character is blank, get last library suffix
CASE;

// IF LCL.Text 1                USR is Blank
IF LCL.Text_1_USR = *BLANK;

// LCL.Count USR = LCL.Count USR - CON.3
LCL.Count_USR = LCL.Count_USR - 3;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

//?If character is blank, get last library suffix
// IF LCL.Count USR is Ten
IF LCL.Count_USR = 10;

// LCL.Count USR = LCL.Count USR - CON.2
LCL.Count_USR = LCL.Count_USR - 2;

// LCL.Text 3 USR = SUBSTRING(PAR.Library,LCL.Count USR,CON.3)
LCL.Text_3_USR = SUBSTRING(PAR.Library:LCL.Count_USR:3);

//?Set counter high to exit REPEAT WHILE
// LCL.Count USR = CON.11
LCL.Count_USR = 11;

ENDIF;

// LCL.Count USR = LCL.Count USR + CON.1
LCL.Count_USR = LCL.Count_USR + 1;

ENDDO;

//?Load company number based upon library suffix
CASE;

// IF LCL.Text 3 USR is Guymon
IF LCL.Text_3_USR = 'GUP';

// LCL.PSDL Company Number = CND.SBD Farms of Guymon, Ok
LCL.PSDL_Company_Number = 360;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods
IF LCL.Text_3_USR = 'TFP';

// LCL.PSDL Company Number = CND.Triumph Foods Market
LCL.PSDL_Company_Number = 960;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Seaboard Triumph Foods
IF LCL.Text_3_USR = 'STP';

// LCL.PSDL Company Number = CND.Sioux City
LCL.PSDL_Company_Number = 440;

//?Load company number based upon library suffix
// IF LCL.Text 3 USR is Triumph Foods-2
IF LCL.Text_3_USR = 'T2P';

// LCL.PSDL Company Number = CND.Triumph Foods-2
LCL.PSDL_Company_Number = 961;

//?Load company number based upon library suffix
// IF *OTHERWISE
IF *OTHERWISE;

PGM.*Return_code = 'ERROR';

RETURN;

ENDIF;

//?Read all Producer History WKLY records and update Company Number
EXECUTE FUNCTION(Fix Add Co# to PL D/A RT) TYPE(RTVOBJ) FILE(PLAPREP)           AB1335127;
PARAMETER(LCL.PSDL_Company_Number);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.PSDL Company Number is *ZERO
 IF DB1.PSDL_Company_Number = *ZERO;

 //?First, create a new record with the Company Number
 EXECUTE FUNCTION(Fix Add Co# to PL D/A CR) TYPE(CRTOBJ) FILE(PLAPREP)           AB1335126;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(PAR.PSDL_Company_Number);
 PARAMETER(DB1.DED_D_A_Code);
 PARAMETER(DB1.PSD_Variable_UOM);
 PARAMETER(DB1.PSD_Variable_Amount);
 PARAMETER(DB1.PSD_Varialbe_Amount_Sign);
 PARAMETER(DB1.PSD_Accept_Date);
 PARAMETER(DB1.PSD_Decline_Date);
 PARAMETER(DB1.PSD_Expense_Paid_By);
 PARAMETER(DB1.PSD_Status_Unused_2);
 PARAMETER(DB1.PSD_Status_Unused_3);
 PARAMETER(DB1.PSD_Status_Unused_4);
 PARAMETER(DB1.PSD_Status_Unused_5);
 PARAMETER(DB1.PSD_Status_Unused_6);
 PARAMETER(DB1.PSD_Status_Unused_7);
 PARAMETER(DB1.PSD_Status_Unused_8);
 PARAMETER(DB1.PSD_Status_Unused_9);
 PARAMETER(DB1.PSD_Status_Unused_10);
 //?Then delete existing record that does not have a Company Number
 EXECUTE FUNCTION(Dlt Prod/Loc Std D/A  DO) TYPE(DLTOBJ) FILE(PLAPREP)           AB1258182;
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.PSDL_Company_Number);
 PARAMETER(DB1.DED_D_A_Code);
 ENDIF;

}


ENDIF;

