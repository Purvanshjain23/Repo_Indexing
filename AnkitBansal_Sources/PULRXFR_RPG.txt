     H/TITLE Crt Bal Fallout Hdr/DtlXF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 04/02/19  Time  : 10:48:30
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPUBBCPL1IF  E           K        DISK
      * RTV : PFS Balance Fallout Code  Retrieval index
      *
     FCADPREL1IF  E           K        DISK
      * RTV : System Values             Retrieval index       NV
      *
     FPDKMREL1IF  E           K        DISK
      * RTV : Company Values            Retrieval index
      *
     FPUBCCPL1IF  E           K        DISK
      * RTV : PFS Balance Fallout Hdr   Retrieval index
      *
     FPUBDCPL1IF  E           K        DISK
      * RTV : PFS Balance Fallout Dtl   Retrieval index
      *
     FPUBDCPL0UF  E           K        DISK                      A
      * UPD : PFS Balance Fallout Dtl   Update index
      *
     FPUBCCPL0UF  E           K        DISK                      A
      * UPD : PFS Balance Fallout Hdr   Update index
      *
      * Long constants
     E                    @CN#    1  11  6   @CN    25
     E                    YDOW        7  1               *Days of week
     I@BBCPEK
      * PFS Balance Fallout Code  Retrieval index
      * Renamed input format fields
     I              BBY1NX                          WAY1NX
     I              BBP7DT                          WAP7DT
     I              BBY2NX                          WAY2NX
     I              BBI2SC                          WAI2SC
     I              BBI3SC                          WAI3SC
     I              BBVJNA                          WAVJNA
     I              BBUWSX                          WAUWSX
     I              BBUXSX                          WAUXSX
     I              BBV3SX                          WAV3SX
     I              BBAHNY                          WAAHNY
     I              BBAINY                          WAAINY
     I              BBAJNY                          WAAJNY
     I              BBAKNY                          WAAKNY
      *
     I@DPRETD
      * System Values             Retrieval index       NV
      * Renamed input format fields
     I              DPDOCD                          WBDOCD
     I              DPAUNA                          WBAUNA
     I              DPI5ST                          WBI5ST
     I              DPBXTX                          WBBXTX
     I              DPM8NB                          WBM8NB
     I              DPUVST                          WBUVST
     I              DPUWST                          WBUWST
     I              DPUXST                          WBUXST
     I              DPVSST                          WBVSST
     I              DPAATM                          WBAATM
     I              DPAYNA                          WBAYNA
     I              DPA0NA                          WBA0NA
     I              DPAXDT                          WBAXDT
      *
     I@KMREHC
      * Company Values            Retrieval index
      * Renamed input format fields
     I              KMAIC3                          WCAIC3
     I              KMV8CD                          WCV8CD
     I              KMAUNA                          WCAUNA
     I              KMI5ST                          WCI5ST
     I              KMBXTX                          WCBXTX
     I              KMM8NB                          WCM8NB
     I              KMUVST                          WCUVST
     I              KMUWST                          WCUWST
     I              KMUXST                          WCUXST
     I              KMVSST                          WCVSST
     I              KMAATM                          WCAATM
     I              KMAYNA                          WCAYNA
     I              KMA0NA                          WCA0NA
     I              KMAXDT                          WCAXDT
      *
     I@BDCPEP
      * PFS Balance Fallout Dtl   Update index
      * Renamed input format fields
     I              BDY1NX                          WDY1NX
     I              BDASD8                          WDASD8
     I              BDAOTS                          WDAOTS
     I              BDP7DT                          WDP7DT
     I              BDY2NX                          WDY2NX
     I              BDTVAA                          WDTVAA
     I              BDI2SC                          WDI2SC
     I              BDI3SC                          WDI3SC
     I              BDVJNA                          WDVJNA
     I              BDUWSX                          WDUWSX
     I              BDUXSX                          WDUXSX
     I              BDV3SX                          WDV3SX
     I              BDAHNY                          WDAHNY
     I              BDAINY                          WDAINY
     I              BDAJNY                          WDAJNY
     I              BDAKNY                          WDAKNY
      *
     I@BCCPEM
      * PFS Balance Fallout Hdr   Update index
      * Renamed input format fields
     I              BCY1NX                          WEY1NX
     I              BCASD8                          WEASD8
     I              BCAOTS                          WEAOTS
     I              BCP7DT                          WEP7DT
     I              BCTVAA                          WETVAA
     I              BCATD8                          WEATD8
     I              BCAPTS                          WEAPTS
     I              BCUWSX                          WEUWSX
     I              BCUXSX                          WEUXSX
     I              BCV3SX                          WEV3SX
     I              BCAHNY                          WEAHNY
     I              BCAINY                          WEAINY
     I              BCAJNY                          WEAJNY
     I              BCAKNY                          WEAKNY
      *
     I@BCCPEN
      * PFS Balance Fallout Hdr   Retrieval index
      * Renamed input format fields
     I              BCY1NX                          WFY1NX
     I              BCASD8                          WFASD8
     I              BCAOTS                          WFAOTS
     I              BCP7DT                          WFP7DT
     I              BCTVAA                          WFTVAA
     I              BCATD8                          WFATD8
     I              BCAPTS                          WFAPTS
     I              BCUWSX                          WFUWSX
     I              BCUXSX                          WFUXSX
     I              BCV3SX                          WFV3SX
     I              BCAHNY                          WFAHNY
     I              BCAINY                          WFAINY
     I              BCAJNY                          WFAJNY
     I              BCAKNY                          WFAKNY
      *
     I@BDCPEQ
      * PFS Balance Fallout Dtl   Retrieval index
      * Renamed input format fields
     I              BDY1NX                          WGY1NX
     I              BDASD8                          WGASD8
     I              BDAOTS                          WGAOTS
     I              BDP7DT                          WGP7DT
     I              BDY2NX                          WGY2NX
     I              BDTVAA                          WGTVAA
     I              BDI2SC                          WGI2SC
     I              BDI3SC                          WGI3SC
     I              BDVJNA                          WGVJNA
     I              BDUWSX                          WGUWSX
     I              BDUXSX                          WGUXSX
     I              BDV3SX                          WGV3SX
     I              BDAHNY                          WGAHNY
     I              BDAINY                          WGAINY
     I              BDAJNY                          WGAJNY
     I              BDAKNY                          WGAKNY
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPUBD1    E DSPUBDCPL0
      * UPD : PFS Balance Fallout Dtl   Update index
      * Renamed input format fields
     I              BDY1NX                          WDY1NX
     I              BDASD8                          WDASD8
     I              BDAOTS                          WDAOTS
     I              BDP7DT                          WDP7DT
     I              BDY2NX                          WDY2NX
     I              BDTVAA                          WDTVAA
     I              BDI2SC                          WDI2SC
     I              BDI3SC                          WDI3SC
     I              BDVJNA                          WDVJNA
     I              BDUWSX                          WDUWSX
     I              BDUXSX                          WDUXSX
     I              BDV3SX                          WDV3SX
     I              BDAHNY                          WDAHNY
     I              BDAINY                          WDAINY
     I              BDAJNY                          WDAJNY
     I              BDAKNY                          WDAKNY
      *
     IQPUBC1    E DSPUBCCPL0
      * UPD : PFS Balance Fallout Hdr   Update index
      * Renamed input format fields
     I              BCY1NX                          WEY1NX
     I              BCASD8                          WEASD8
     I              BCAOTS                          WEAOTS
     I              BCP7DT                          WEP7DT
     I              BCTVAA                          WETVAA
     I              BCATD8                          WEATD8
     I              BCAPTS                          WEAPTS
     I              BCUWSX                          WEUWSX
     I              BCUXSX                          WEUXSX
     I              BCV3SX                          WEV3SX
     I              BCAHNY                          WEAHNY
     I              BCAINY                          WEAINY
     I              BCAJNY                          WEAJNY
     I              BCAKNY                          WEAKNY
      *
     IYARDCS      DS                             85
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                            130
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  PFS Company Number
     I                                        1   30P1Y1NX
     IP2PARM      DS
      * I :  Called from Job Schedule
     I                                        1   1 P2I6SC
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1Y1NX    PARM           WP0001  30       PFS Company Num
     C           P2I6SC    PARM           WP0002  1        Called from Job
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Crt Bal Fallout Hdr/DtlXF
      * Format Data.
      * CASE: *OTHERWISE
      * Get System Date 2     US - /UT User Source  * 
      * Get System Date - CCYYMMDD
     C                     MOVE *DATE     YL0001
      * LCL.Production Date USR D8# = LCL.System Date Nbr USR
     C                     Z-ADDYL0001    YL0002           Production Date
      * LCL.@Date - ATR = LCL.Production Date USR D8#
     C           YL0002    IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0003
     C                     ELSE
     C           YL0002    SUB  19000000  YL0003           @Date - ATR
     C                     END
      *
     C                     Z-ADD*ZERO     WN0001  40       YYYY numeric US
     C                     Z-ADD*ZERO     WN0002  20       MM   numeric US
     C                     Z-ADD*ZERO     WN0003  20       DD   numeric US
     C                     MOVEL*BLANK    WN0004  4        YYYY alpha   US
     C                     MOVEL*BLANK    WN0005  2        MM   alpha   US
     C                     MOVEL*BLANK    WN0006  2        DD   alpha   US
      *
      * Convert DTE to mm/dd/yyyy
      * Break apart date.
      * PAR.YYYY numeric USR = PAR.@Date - ATR *YEAR
     C           YL0003    ADD  1000000   XDINDT
     C           1800      ADD  XDINYY    WN0001
      * PAR.MM   numeric USR = PAR.@Date - ATR *MONTH
     C           YL0003    ADD  1000000   XDINDT
     C                     Z-ADDXDINMM    WN0002
      * PAR.DD   numeric USR = PAR.@Date - ATR *DAY OF MONTH
     C           YL0003    ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD0         XDINDD
     C                     EXSR XCVTA
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     MOVEL'NONE'    WUDLN  10
     C                     EXSR XDUDY
     C                     MOVE XDURR     WN0003
      * Convert to alpha.
     C                     MOVEL*BLANK    WN0004           YYYY alpha   US
     C                     MOVELWN0001    WN0004           YYYY alpha   US
     C                     MOVELWN0002    WN0005           MM   alpha   US
     C                     MOVELWN0003    WN0006           DD   alpha   US
      * Put back together.
     C                     Z-ADD0         ZQ      50
     C           WN0005    CAT  '/':ZQ    YL0004    P      Date mm/dd/yyyy
     C                     Z-ADD0         ZQ      50
     C           YL0004    CAT  WN0006:ZQ YL0004    P      Date mm/dd/yyyy
     C                     Z-ADD0         ZQ      50
     C           YL0004    CAT  '/':ZQ    YL0004    P      Date mm/dd/yyyy
     C                     Z-ADD0         ZQ      50
     C           YL0004    CAT  WN0004:ZQ YL0004    P      Date mm/dd/yyyy
     C                     MOVELP1Y1NX    YL0005           PFS Company Num
      * From Baseline: Are There Any Records with Fallout Flag=Y?
      * CASE: PAR.Called from Job Schedule is Yes
     C           P2I6SC    IFEQ 'Y'                        *IF
      * Rtv Any Balance Flag=Y RT - PFS Balance Fallout Code  * 
     C                     EXSR SARVGN
      * CASE: LCL.Record Found USR is Record Not Found
     C           YL0006    IFEQ 'N'                        *IF
      * Format Email Subject/Message & Send Email to Notify Error.
      * CASE: *OTHERWISE
     C                     Z-ADD1         ZQ      50
     C           'Co'      CAT  YL0005:ZQ YL0007    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           YL0007    CAT  @CN,001:ZQYL0007    P      Email Subject U
      * RTV System Value Alpha RT - System Values  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL'DTALIB'  WL0001    P      System Value Co
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0002    YL0008    P      System Value Al
      * Concatenate 'TEST' to Email Subject Line if Not Prod Data.
      * CASE:
      *  - NOTc1
      *   |- c1    : LCL.System Value Alpha is PRKFLIB
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0008    IFEQ @CN,002                    *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD1         ZQ      50
     C           YL0007    CAT  @CN,003:ZQYL0007    P      Email Subject U
     C                     END                             *FI
     C                     Z-ADD*ZERO     ZQ      50
     C           @CN,004   CAT  @CN,005:ZQYL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  YL0005:ZQ YL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  @CN,006:ZQYL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  YL0004:ZQ YL0009    P      Email Message U
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0009    CAT  '.':ZQ    YL0009    P      Email Message U
      * Exc ESNDMAIL Generic  IF
      * Excecute ESNDMAIL to Send Email Message.
      * RTV Alpha Value 2     RT - Company Values  * Get Email Address
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1Y1NX    WL0003           Company Number
     C                     MOVEL@CN,007   WL0004    P      Company Value C
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0005    YL0010    P      System Value Al
      * CASE: LCL.Email Address is Entered
     C           YL0010    IFNE *BLANK                     *IF
      * Exc ESNDMAIL Generic  CL - /UT User Programs  * Send Email
     C                     CALL 'PUE8UPC'              90  Exc ESNDMAIL Ge
     C                     PARM YL0010    WQ0001 50        Email Address
     C                     PARM YL0007    WQ0002 50        Email Subject U
     C                     PARM YL0009    WQ0003256        Email Message U
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUE8UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Build/Send Balance Fallout Hdr/Dtl to Staging File for Carlisle.
      * CASE:
      *  - c1 OR c2
      *   |- c1    : LCL.Record Found USR is Record Found
      *   |- c2    : PAR.Called from Job Schedule is No
      *   '-
     C           YL0006    IFEQ 'Y'                        *IF
     C           P2I6SC    OREQ 'N'                        *OR
     C                     Z-ADD##JTM     YL0011           PFS Batch Time
      * Note: Only the DTL file will be picked up by Carlisle.
      * Crt Bal Fallout Hdr/DtlRT - PFS Balance Fallout Code  * 
     C                     EXSR SDRVGN
      * Copy DTL File to Staging File & Update Process Sts=9 (Sent).
      * CASE: *OTHERWISE
      * Format Data.
      * CASE: *OTHERWISE
     C                     Z-ADDYL0001    YL0012           PFS Batch Date
     C                     MOVELYL0012    YL0013           PFS Batch Date
     C                     MOVELYL0011    YL0014           PFS Batch Time
     C                     MOVELYL0013    YL0015           PFS Production
      * Exc Cpy Dtl 4/Carlisle CL - PFS Balance Fallout Dtl  * 
     C                     CALL 'PULTUPC'              90  Exc Cpy Dtl 4/C
     C                     PARM YL0005    WQ0004  3        PFS Company Num
     C                     PARM YL0013    WQ0005  8        PFS Batch Date
     C                     PARM YL0014    WQ0006  6        PFS Batch Time
     C                     PARM YL0015    WQ0007  8        PFS Production
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PULTUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
      * Upd Process Status     RT - PFS Balance Fallout Hdr  * 
     C                     EXSR SGRVGN
      * From Baseline: Send Completed Email Message.
      * CASE: PAR.Called from Job Schedule is Yes
     C           P2I6SC    IFEQ 'Y'                        *IF
     C                     Z-ADD1         ZQ      50
     C           'Co'      CAT  YL0005:ZQ YL0007    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           YL0007    CAT  @CN,001:ZQYL0007    P      Email Subject U
     C                     Z-ADD1         ZQ      50
     C           YL0007    CAT  @CN,008:ZQYL0007    P      Email Subject U
     C                     Z-ADD0         ZQ      50
     C           @CN,009   CAT  @CN,010:ZQYL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  @CN,011:ZQYL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  YL0005:ZQ YL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  @CN,006:ZQYL0009    P      Email Message U
     C                     Z-ADD1         ZQ      50
     C           YL0009    CAT  YL0004:ZQ YL0009    P      Email Message U
     C                     Z-ADD*ZERO     ZQ      50
     C           YL0009    CAT  '.':ZQ    YL0009    P      Email Message U
      * RTV System Value Alpha RT - System Values  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL'DTALIB'  WL0001    P      System Value Co
     C                     EXSR SBRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0002    YL0008    P      System Value Al
      * Concatenate 'TEST' to Email Subject Line if Not Prod Data.
      * CASE:
      *  - NOTc1
      *   |- c1    : LCL.System Value Alpha is PRKFLIB
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0008    IFEQ @CN,002                    *IF
     C                     ELSE
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD1         ZQ      50
     C           YL0007    CAT  @CN,003:ZQYL0007    P      Email Subject U
     C                     END                             *FI
      * Exc ESNDMAIL Generic  IF
      * Excecute ESNDMAIL to Send Email Message.
      * RTV Alpha Value 2     RT - Company Values  * Get Email Address
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1Y1NX    WL0003           Company Number
     C                     MOVEL@CN,007   WL0004    P      Company Value C
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0005    YL0010    P      System Value Al
      * CASE: LCL.Email Address is Entered
     C           YL0010    IFNE *BLANK                     *IF
      * Exc ESNDMAIL Generic  CL - /UT User Programs  * Send Email
     C                     CALL 'PUE8UPC'              90  Exc ESNDMAIL Ge
     C                     PARM YL0010    WQ0008 50        Email Address
     C                     PARM YL0007    WQ0009 50        Email Subject U
     C                     PARM YL0009    WQ0010256        Email Message U
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PUE8UPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Any Balance Flag=Y RT - PFS Balance Fallout Code  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'N'       YL0006           Record Found US
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAY1NX    WQSA01           PFS Company Num
     C           *LIKE     DEFN WAP7DT    WQSA02           PFS Production
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
     C                     KFLD           WQSA02           PFS Production
      * Setup key
     C                     Z-ADDP1Y1NX    WQSA01           PFS Company Num
     C                     Z-ADDYL0001    WQSA02           PFS Production
      * Establish starting position
     C           KRSSA     SETLL@BBCPEK                    *
     C           KRSSA     READE@BBCPEK                  90*
      * Data record not found
     C   90                MOVEL'USR5110' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.PFS Balance Flag is Yes
     C           WAI2SC    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       YL0006           Record Found US
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSA     READE@BBCPEK                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV System Value Alpha RT - System Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBDOCD           System Value Co
      * Setup key
     C                     MOVELWL0001    WBDOCD           System Value Co
      * Establish starting position
     C           KRSSB     CHAIN@DPRETD              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0759' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0002           System Value Al
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBBXTX    WL0002           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Alpha Value 2     RT - Company Values  * Get Email Address
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0005           System Value Al
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCV8CD           Company Value C
      * Setup key
     C                     Z-ADDWL0003    WCAIC3           Company Number
     C                     MOVELWL0004    WCV8CD           Company Value C
      * Establish starting position
     C           KRSSC     CHAIN@KMREHC              90    *
      * Data record not found
     C   90                MOVEL'USR2221' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCBXTX    WL0005           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Crt Bal Fallout Hdr/DtlRT - PFS Balance Fallout Code  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAY1NX    WQSD01           PFS Company Num
     C           *LIKE     DEFN WAP7DT    WQSD02           PFS Production
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           PFS Company Num
     C                     KFLD           WQSD02           PFS Production
      * Setup key
     C                     Z-ADDP1Y1NX    WQSD01           PFS Company Num
     C                     Z-ADDYL0001    WQSD02           PFS Production
      * Establish starting position
     C           KRSSD     SETLL@BBCPEK                    *
     C           KRSSD     READE@BBCPEK                  90*
      * Data record not found
     C   90                MOVEL'USR5110' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Crt PFS Bal Fallout DtlCR - PFS Balance Fallout Dtl  * 
     C                     EXSR SECRRC
     C           KRSSD     READE@BBCPEK                  90*
     C                     ENDDO
      * USER: Exit processing
      * Crt PFS Bal Fallout HdrCR - PFS Balance Fallout Hdr  * 
     C                     EXSR SFCRRC
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt PFS Bal Fallout DtlCR - PFS Balance Fallout Dtl  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0007  80       PFS Change Date
     C                     Z-ADD*ZERO     WN0008  60       PFS Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BDCPEP
     C                     Z-ADDP1Y1NX    WDY1NX           PFS Company Num
     C                     Z-ADDYL0001    WDASD8           PFS Batch Date
     C                     Z-ADDYL0011    WDAOTS           PFS Batch Time
     C                     Z-ADDYL0001    WDP7DT           PFS Production
     C                     Z-ADDWAY2NX    WDY2NX           PFS Item Code
     C                     MOVEL##USR     WDTVAA           PFS User ID
     C                     MOVELWAI2SC    WDI2SC           PFS Balance Fla
     C                     MOVELWAI3SC    WDI3SC           PFS Fallout Fla
     C                     MOVELWAVJNA    WDVJNA           PFS Notes
     C                     MOVEL'A'       WDUWSX           PFS Record Stat
     C                     Z-ADD0         WDUXSX           PFS Process Sta
     C                     MOVELWAV3SX    WDV3SX           PFS Error Reaso
     C                     Z-ADDYL0001    WDAHNY           PFS Create Date
     C                     Z-ADDYL0011    WDAINY           PFS Create Time
      *
     C           KLCRSE    KLIST
     C                     KFLD           WDY1NX           PFS Company Num
     C                     KFLD           WDASD8           PFS Batch Date
     C                     KFLD           WDAOTS           PFS Batch Time
     C                     KFLD           WDP7DT           PFS Production
     C                     KFLD           WDY2NX           PFS Item Code
      * Check for duplicate primary key
     C           KLCRSE    SETLL@BDCPEP                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5115' W0RTN   7
      * Send message 'PFS Balance Fallout Dt EX'
     C                     MOVEL'USR5115' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@BDCPEP                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * Crt PFS Bal Fallout HdrCR - PFS Balance Fallout Hdr  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0009  80       PFS Change Date
     C                     Z-ADD*ZERO     WN0010  60       PFS Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BCCPEM
     C                     Z-ADDP1Y1NX    WEY1NX           PFS Company Num
     C                     Z-ADDYL0001    WEASD8           PFS Batch Date
     C                     Z-ADDYL0011    WEAOTS           PFS Batch Time
     C                     Z-ADDYL0001    WEP7DT           PFS Production
     C                     MOVEL##USR     WETVAA           PFS User ID
     C                     Z-ADD0         WEATD8           PFS Batch Sent
     C                     Z-ADD0         WEAPTS           PFS Batch Sent
     C                     MOVEL'A'       WEUWSX           PFS Record Stat
     C                     Z-ADD0         WEUXSX           PFS Process Sta
     C                     MOVELWAV3SX    WEV3SX           PFS Error Reaso
     C                     Z-ADDYL0001    WEAHNY           PFS Create Date
     C                     Z-ADDYL0011    WEAINY           PFS Create Time
      *
     C           KLCRSF    KLIST
     C                     KFLD           WEY1NX           PFS Company Num
     C                     KFLD           WEASD8           PFS Batch Date
     C                     KFLD           WEAOTS           PFS Batch Time
     C                     KFLD           WEP7DT           PFS Production
      * Check for duplicate primary key
     C           KLCRSF    SETLL@BCCPEM                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5113' W0RTN   7
      * Send message 'PFS Balance Fallout Hd EX'
     C                     MOVEL'USR5113' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@BCCPEM                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Upd Process Status     RT - PFS Balance Fallout Hdr  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WFY1NX           PFS Company Num
     C                     KFLD           WFASD8           PFS Batch Date
     C                     KFLD           WFAOTS           PFS Batch Time
     C                     KFLD           WFP7DT           PFS Production
      * Setup key
     C                     Z-ADDP1Y1NX    WFY1NX           PFS Company Num
     C                     Z-ADDYL0001    WFASD8           PFS Batch Date
     C                     Z-ADDYL0011    WFAOTS           PFS Batch Time
     C                     Z-ADDYL0001    WFP7DT           PFS Production
      * Establish starting position
     C           KRSSG     CHAIN@BCCPEN              90    *
      * Data record not found
     C   90                MOVEL'USR5112' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg PFS Bal Fallout HdrCH - PFS Balance Fallout Hdr  * 
     C                     EXSR SHCHRC
      * Upd Process Status     RT - PFS Balance Fallout Dtl  * 
     C                     EXSR SIRVGN
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Chg PFS Bal Fallout HdrCH - PFS Balance Fallout Hdr  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0011  80       PFS Create Date
     C                     Z-ADD*ZERO     WN0012  60       PFS Create Time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BCCPEM
     C                     Z-ADDWFY1NX    WEY1NX           PFS Company Num
     C                     Z-ADDWFASD8    WEASD8           PFS Batch Date
     C                     Z-ADDWFAOTS    WEAOTS           PFS Batch Time
     C                     Z-ADDWFP7DT    WEP7DT           PFS Production
      *
     C           KLCHSH    KLIST
     C                     KFLD           WEY1NX           PFS Company Num
     C                     KFLD           WEASD8           PFS Batch Date
     C                     KFLD           WEAOTS           PFS Batch Time
     C                     KFLD           WEP7DT           PFS Production
     C           KLCHSH    CHAIN@BCCPEM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PUBCCPL0'MDACP
     C                     MOVEL'@BCCPEM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPUBC1    YARDCS
      * Move non-key fields to @BCCPEM
     C                     MOVELWFTVAA    WETVAA    P      PFS User ID
     C                     Z-ADDYL0001    WEATD8           PFS Batch Sent
     C                     Z-ADD##JTM     WEAPTS           PFS Batch Sent
     C                     MOVEL'C'       WEUWSX    P      PFS Record Stat
     C                     Z-ADD9         WEUXSX           PFS Process Sta
     C                     MOVELWFV3SX    WEV3SX    P      PFS Error Reaso
     C                     Z-ADDYL0001    WEAJNY           PFS Change Date
     C                     Z-ADD##JTM     WEAKNY           PFS Change time
      *
      * Set PGM.*Record Data Changed flag
     C           QPUBC1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BCCPEM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPUBCCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Upd Process Status     RT - PFS Balance Fallout Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGY1NX    WQSI01           PFS Company Num
     C           *LIKE     DEFN WGASD8    WQSI02           PFS Batch Date
     C           *LIKE     DEFN WGAOTS    WQSI03           PFS Batch Time
     C           *LIKE     DEFN WGP7DT    WQSI04           PFS Production
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           PFS Company Num
     C                     KFLD           WQSI02           PFS Batch Date
     C                     KFLD           WQSI03           PFS Batch Time
     C                     KFLD           WQSI04           PFS Production
      * Setup key
     C                     Z-ADDWFY1NX    WQSI01           PFS Company Num
     C                     Z-ADDWFASD8    WQSI02           PFS Batch Date
     C                     Z-ADDWFAOTS    WQSI03           PFS Batch Time
     C                     Z-ADDWFP7DT    WQSI04           PFS Production
      * Establish starting position
     C           KRSSI     SETLL@BDCPEQ                    *
     C           KRSSI     READE@BDCPEQ                  90*
      * Data record not found
     C   90                MOVEL'USR5114' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Chg PFS Bal Fallout DtlCH - PFS Balance Fallout Dtl  * 
     C                     EXSR SJCHRC
     C           KRSSI     READE@BDCPEQ                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Chg PFS Bal Fallout DtlCH - PFS Balance Fallout Dtl  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0013  80       PFS Create Date
     C                     Z-ADD*ZERO     WN0014  60       PFS Create Time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @BDCPEP
     C                     Z-ADDWGY1NX    WDY1NX           PFS Company Num
     C                     Z-ADDWGASD8    WDASD8           PFS Batch Date
     C                     Z-ADDWGAOTS    WDAOTS           PFS Batch Time
     C                     Z-ADDWGP7DT    WDP7DT           PFS Production
     C                     Z-ADDWGY2NX    WDY2NX           PFS Item Code
      *
     C           KLCHSJ    KLIST
     C                     KFLD           WDY1NX           PFS Company Num
     C                     KFLD           WDASD8           PFS Batch Date
     C                     KFLD           WDAOTS           PFS Batch Time
     C                     KFLD           WDP7DT           PFS Production
     C                     KFLD           WDY2NX           PFS Item Code
     C           KLCHSJ    CHAIN@BDCPEP              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PUBDCPL0'MDACP
     C                     MOVEL'@BDCPEP' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPUBD1    YBRDCS
      * Move non-key fields to @BDCPEP
     C                     MOVEL##USR     WDTVAA    P      PFS User ID
     C                     MOVELWGI2SC    WDI2SC    P      PFS Balance Fla
     C                     MOVELWGI3SC    WDI3SC    P      PFS Fallout Fla
     C                     MOVELWGVJNA    WDVJNA    P      PFS Notes
     C                     MOVEL'C'       WDUWSX    P      PFS Record Stat
     C                     Z-ADD9         WDUXSX           PFS Process Sta
     C                     MOVELWGV3SX    WDV3SX    P      PFS Error Reaso
     C                     Z-ADDWFASD8    WDAJNY           PFS Change Date
     C                     Z-ADD##JTM     WDAKNY           PFS Change time
      *
      * Set PGM.*Record Data Changed flag
     C           QPUBD1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@BDCPEP                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPUBDCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDUDY     BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C           XDAY1     IFLT 1
     C           XDAY2     ORLT 1
     C                     Z-ADD0         XDURR
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     GOTO XDUDYE
     C                     END
     C           XDAY1     IFGE XDAY2
      * From date2 to date1
     C                     Z-ADDXDAY2     XABEG   60
     C                     Z-ADDXDAY1     XAEND   60
     C                     ELSE
      * From date1 to date2
     C                     Z-ADDXDAY1     XABEG   60
     C                     Z-ADDXDAY2     XAEND   60
     C                     END
     C           XDWSL     IFEQ 0
      * None days of week selected
     C                     Z-ADD0         XDURR
     C                     GOTO XDUDYC
     C                     END
     C           XAEND     SUB  XABEG     XDURR   80
     C           XDWSL     IFEQ 7
      * All days of week selected
     C                     GOTO XDUDYC
     C                     END
      * Some days of week selected
     C                     DIV  7         XDURR
     C                     MVR            XDLSW   10
     C                     MULT XDWSL     XDURR
     C           XDLSW     IFNE 0
      * Determine day of week of the beginning date
     C           XABEG     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
      * Loop: Increment the date by the last week
     C           XDLSW     DOWGT0
      * Increment the day of week
     C                     ADD  1         YY
     C                     SUB  1         XDLSW
      * Put day of week into the range 1-7
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     END
      * Selected day of the last week has been processed
     C           YDOW,YY   IFEQ XDSEL
      * Increment duration
     C                     ADD  1         XDURR
     C                     END
      * End of loop
     C                     END
     C                     END
     C           XDUDYC    TAG
     C           XDURR     IFEQ 0
      * Return Code: Unable to calculate duration
     C                     MOVEL'Y2U0060' W0RTN   7
     C                     ELSE
     C                     MOVEL*BLANK    W0RTN   7
     C                     END
      *================================================================
     CSR         XDUDYE    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAP7DT           PFS Production
     C                     Z-ADD*ZERO     WAY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBM8NB           System Value Nu
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCM8NB           System Value Nu
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WDASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WDAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WDP7DT           PFS Production
     C                     Z-ADD*ZERO     WDY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WDUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WDAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WDAINY           PFS Create Time
     C                     Z-ADD*ZERO     WDAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WDAKNY           PFS Change time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WEASD8           PFS Batch Date
     C                     Z-ADD*ZERO     WEAOTS           PFS Batch Time
     C                     Z-ADD*ZERO     WEP7DT           PFS Production
     C                     Z-ADD*ZERO     WEATD8           PFS Batch Sent
     C                     Z-ADD*ZERO     WEAPTS           PFS Batch Sent
     C                     Z-ADD*ZERO     WEUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WEAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WEAINY           PFS Create Time
     C                     Z-ADD*ZERO     WEAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WEAKNY           PFS Change time
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBRVGN.
     C                     MOVEL*BLANK    WL0001 10
     C                     MOVEL*BLANK    WL0002 40
      * Define local variables for subroutine SCRVGN.
     C                     Z-ADD*ZERO     WL0003  30
     C                     MOVEL*BLANK    WL0004 10
     C                     MOVEL*BLANK    WL0005 40
      * Define local work field System Date Nbr USR
     C                     Z-ADD*ZERO     YL0001  80
      * Define local work field Production Date USR D8#
     C                     Z-ADD*ZERO     YL0002  80
      * Define local work field @Date - ATR
     C                     Z-ADD*ZERO     YL0003  70
      * Define local work field Date mm/dd/yyyy USR
     C                     MOVEL*BLANK    YL0004 10
      * Define local work field PFS Company Number Alpha
     C                     MOVEL*BLANK    YL0005  3
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0006  1
      * Define local work field Email Subject USR
     C                     MOVEL*BLANK    YL0007 50
      * Define local work field System Value Alpha
     C                     MOVEL*BLANK    YL0008 40
      * Define local work field Email Message USR
     C                     MOVEL*BLANK    YL0009256
      * Define local work field Email Address
     C                     MOVEL*BLANK    YL0010 50
      * Define local work field PFS Batch Time
     C                     Z-ADD*ZERO     YL0011  60
      * Define local work field PFS Batch Date
     C                     Z-ADD*ZERO     YL0012  80
      * Define local work field PFS Batch Date Alpha
     C                     MOVEL*BLANK    YL0013  8
      * Define local work field PFS Batch Time Alpha
     C                     MOVEL*BLANK    YL0014  6
      * Define local work field PFS Production Date Alpha
     C                     MOVEL*BLANK    YL0015  8
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Balance & Fallout Codes
00002 PRKFLIB
00003 - TEST
00004 BASELINE: PFS Balance Cod
00005 es missing for Plant
00006 for Production Date
00007 PFSBALFALL
00008 Created
00009 BASELINE: Balance & Fallo
00010 out Codes sent to
00011 Carlisle - Co
