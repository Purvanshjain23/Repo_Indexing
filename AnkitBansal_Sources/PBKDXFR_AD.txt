// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBKDXFR
// ?Date: 14.08.2025 Time: 03:48:17
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?If it exists, get the 1st rcds numbers and quit
// WRK.LPT Load Plan Date = PAR.LPT Load Plan Date
WRK.LPT_Load_Plan_Date = PAR.LPT_Load_Plan_Date;

EXECUTE FUNCTION(Rtv Load Prod Cmplt dy RT) TYPE(RTVOBJ) FILE(PBBDCPP)          AC2075286;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(WRK.LPT_Load_Plan_Date);
PARAMETER(LCL.Number_CB_Per_Hour);
PARAMETER(LCL.Number_CB_Per_Load);
PARAMETER(LCL.On_Hand_Inventory);
PARAMETER(LCL.Record_Found_USR);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

 QUIT;

}


CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// AND PAR.Number CB Per Hour is Not entered
AND ( PAR.Number_CB_Per_Hour = 0;

// OR PAR.Number CB Per Load is EQ Zero
OR PAR.Number_CB_Per_Load = *ZERO );

QUIT;

ENDIF;

//?move from last occurance of item's data if item code changed
CASE;

// IF PAR.Item Code Break Flag is Yes
IF PAR.Item_Code_Break_Flag = 'Y';

CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Number CB Per Hour = LCL.Number CB Per Hour
PAR.Number_CB_Per_Hour = LCL.Number_CB_Per_Hour;

// PAR.Number CB Per Load = LCL.Number CB Per Load
PAR.Number_CB_Per_Load = LCL.Number_CB_Per_Load;

ENDIF;

ENDIF;

// LCL.LPT Product Complete Tm = PAR.LPT Product Complete Tm
LCL.LPT_Product_Complete_Tm = PAR.LPT_Product_Complete_Tm;

// LCL.LPT Load Plan Start Tm = LCL.LPT Product Complete Tm * CON.100 *
LCL.LPT_Load_Plan_Start_Tm = LCL.LPT_Product_Complete_Tm * 100;

CASE;

// IF PAR.LPT Load Plan Date GE JOB.*Job date
IF PAR.LPT_Load_Plan_Date >= JOB.*Job_date;

EXECUTE FUNCTION(RTV On Hand Qty       RT) TYPE(RTVOBJ) FILE(CAB0REP)           AC1517668;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.On_Hand_Inventory);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 // PAR.On Hand U/M1 Summary = PAR.On Hand U/M1 Summary + DB1.On Hand U/M1 Summary
 PAR.On_Hand_UOM1_Summary = PAR.On_Hand_UOM1_Summary + DB1.On_Hand_UOM1_Summary;

}


// IF *OTHERWISE
IF *OTHERWISE;

// PAR.On Hand Inventory = LCL.On Hand Inventory
PAR.On_Hand_Inventory = LCL.On_Hand_Inventory;

ENDIF;

// LCL.Number of CB Complete = PAR.On Hand Inventory
LCL.Number_of_CB_Complete = PAR.On_Hand_Inventory;

CASE;

// IF PAR.Number CB Per Load is NE Zero
IF PAR.Number_CB_Per_Load <> 0;

// LCL.Number of Loads Complete = LCL.Number of CB Complete / PAR.Number CB Per Load *
LCL.Number_of_Loads_Complete = LCL.Number_of_CB_Complete / PAR.Number_CB_Per_Load;

ENDIF;

// DOW LCL.LPT Product Complete Tm is LE 2200
DOW LCL.LPT_Product_Complete_Tm <= 2200;

EXECUTE FUNCTION(Crt Load Product Compl CR) TYPE(CRTOBJ) FILE(PBBDCPP)          AC2075136;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.LPT_Load_Plan_Date);
PARAMETER(LCL.LPT_Product_Complete_Tm);
PARAMETER(PAR.Number_CB_Per_Hour);
PARAMETER(PAR.Number_CB_Per_Load);
PARAMETER(LCL.Number_of_CB_Complete);
PARAMETER(LCL.Number_of_Loads_Complete);
PARAMETER(PAR.On_Hand_Inventory);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
{
 //?USER: Processing if Data record already exists

 EXECUTE FUNCTION(Change Load Product Compl) TYPE(CHGOBJ) FILE(PBBDCPP)          AC2075137;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.LPT_Load_Plan_Date);
 PARAMETER(DB1.LPT_Product_Complete_Tm);
 PARAMETER(PAR.Number_CB_Per_Hour);
 PARAMETER(PAR.Number_CB_Per_Load);
 PARAMETER(PAR.Number_of_CB_Complete);
 PARAMETER(PAR.Number_of_Loads_Complete);
 PARAMETER(PAR.On_Hand_Inventory);
 PARAMETER(DB1.Number_1_unused);
 PARAMETER(DB1.Number_2_unused);
}


// LCL.LPT Load Plan Start Tm = LCL.LPT Load Plan Start Tm + CON.1 *HOURS
LCL.LPT_Load_Plan_Start_Tm = TIMEINCR(LCL.LPT_Load_Plan_Start_Tm 1 'HR');

// LCL.LPT Product Complete Tm = LCL.LPT Load Plan Start Tm / CON.100 *
LCL.LPT_Product_Complete_Tm = LCL.LPT_Load_Plan_Start_Tm / 100;

// LCL.Number of CB Complete = LCL.Number of CB Complete + PAR.Number CB Per Hour
LCL.Number_of_CB_Complete = LCL.Number_of_CB_Complete + PAR.Number_CB_Per_Hour;

CASE;

// IF PAR.Number CB Per Load is NE Zero
IF PAR.Number_CB_Per_Load <> 0;

// LCL.Number of Loads Complete = LCL.Number of CB Complete / PAR.Number CB Per Load *
LCL.Number_of_Loads_Complete = LCL.Number_of_CB_Complete / PAR.Number_CB_Per_Load;

ENDIF;

ENDDO;

