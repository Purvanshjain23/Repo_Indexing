// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMRJPFR
// ?Date: 14.08.2025 Time: 12:05:42
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?R6965 RMC 8/16/16 new hpb plant -- IR company
EXECUTE FUNCTION(VAL Rtv & Ctr Prt Hdg  IF) TYPE(EXCINTFUN)                     AC1258755;
PARAMETER('OMS');
{
 //?Execute internal function

 EXECUTE FUNCTION(SET Setup Prt Headings IF) TYPE(EXCINTFUN)                     AC1258771;
 PARAMETER(PAR.Application_Code);
 {
  //?Execute internal function

  EXECUTE FUNCTION(RTV Applic. Group Desc RT) TYPE(RTVOBJ) FILE(CADNREP)          AC1274118;
  PARAMETER(PAR.Application_Code);
  PARAMETER(WRK.Description);
  {
   //?USER: Process Data record

   CASE;

   // IF DB1.Application Group is Blank
   IF DB1.Application_Group = *BLANK;

   MOVE *ALL (To: PAR From: DB1);

   // IF *OTHERWISE
   IF *OTHERWISE;

   EXECUTE FUNCTION(RTV Application Desc   RT) TYPE(RTVOBJ) FILE(CADNREP)          AC1249881;
   PARAMETER(DB1.Application_Group);
   PARAMETER(PAR.Description);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    // PGM.*Return code = CND.*Record does not exist
    PGM.*Return_code = 'Y2U0005';

    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   ENDIF;

  }

  // WRK.USR Description 40 = WRK.Description
  WRK.USR_Description_40 = WRK.Description;

  // Execute function CLC Center Txt Str 40  US.
  EXECUTE FUNCTION(CLC Center Txt Str 40  US) TYPE(EXCUSRSRC) ('PDYJUFR');
  PARAMETER(WRK.USR_Description_40);
  PARAMETER(WRK.USR_Description_40_2);
  {
   E                    UCT        40  1               CENTER TABLE
   C                     MOVEA#IDSC4    UCT              LOAD ARRAY
   C                     Z-ADD40        UX      20       SET COUNTER
   C           UX        DOWGT0
   C           UCT,UX    IFEQ ' '
   C                     SUB  1         UX
   C                     ELSE
   C                     Z-ADDUX        UXH     20
   C                     Z-ADD0         UX
   C                     END
   C                     END
   C           40        SUB  UXH       UX
   C           UX        DIV  2         UX
   C           UX        IFGT 0
   C                     MOVE *BLANKS   UCT
   C                     MOVEA#IDSC4    UCT,UX
   C                     END
   C                     MOVEAUCT       #ODE40           LOAD OUTPUT
  }

  // Execute function MOV Appl Desc to PrtCo US.
  EXECUTE FUNCTION(MOV Appl Desc to PrtCo US) TYPE(EXCUSRSRC) ('PD2KUFR');
  PARAMETER(WRK.USR_Description_40_2);
  {
   C                     MOVE #IDE40    $ACMP
  }

 }

}


EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
PARAMETER(PAR.Company_Number);
PARAMETER('HPBPLT');
PARAMETER(LCL.Company_Number_041405);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Record selection processing

CASE;

// IF PAR.COA RIN SoldFull/Splt Sts is Asterisk
IF PAR.COA_RIN_SoldFull_Splt_Sts = *;

CASE;

// IF DB1.COA RIN SoldFull/Splt Sts is Blank
IF DB1.COA_RIN_SoldFull_Splt_Sts = *BLANK;

// OR DB1.COA RIN SoldFull/Splt Sts is Split
OR DB1.COA_RIN_SoldFull_Splt_Sts = 'S';

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

CASE;

// IF PAR.COA RIN SoldFull/Splt Sts NE WRK.Blank for 3          USR
IF PAR.COA_RIN_SoldFull_Splt_Sts <> WRK.Blank_for_3_USR;

// AND DB1.COA RIN SoldFull/Splt Sts NE PAR.COA RIN SoldFull/Splt Sts
AND DB1.COA_RIN_SoldFull_Splt_Sts <> PAR.COA_RIN_SoldFull_Splt_Sts;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

CASE;

// IF PAR.COA RIN Transaction Date is GT Zero
IF PAR.COA_RIN_Transaction_Date > *ZERO;

// AND PAR.COA RIN Transaction Date NE DB1.COA RIN Transaction Date
AND PAR.COA_RIN_Transaction_Date <> DB1.COA_RIN_Transaction_Date;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

CASE;

// IF PAR.COA Ship To Warehouse is Not Blanks
IF PAR.COA_Ship_To_Warehouse <> *BLANK;

// AND PAR.COA Ship To Warehouse NE DB1.COA Ship To Warehouse
AND PAR.COA_Ship_To_Warehouse <> DB1.COA_Ship_To_Warehouse;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

CASE;

// IF PAR.COA Batch Number is Greater than zero
IF PAR.COA_Batch_Number > *ZERO;

// AND PAR.COA Batch Number NE DB1.COA Batch Number
AND PAR.COA_Batch_Number <> DB1.COA_Batch_Number;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

CASE;

// IF PAR.COA Batch Header RIN Seq is GT 0
IF PAR.COA_Batch_Header_RIN_Seq > *ZERO;

// AND PAR.COA Batch Header RIN Seq NE DB1.COA Batch Header RIN Seq
AND PAR.COA_Batch_Header_RIN_Seq <> DB1.COA_Batch_Header_RIN_Seq;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

CASE;

// IF PAR.RFS Transaction Type is *ALL values
IF PAR.RFS_Transaction_Type = 'SEL'/'RET'/'BUY'/'SEP'/'TRB';

// AND PAR.RFS Transaction Type NE DB1.RFS Transaction Type
AND PAR.RFS_Transaction_Type <> DB1.RFS_Transaction_Type;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

CASE;

// IF PAR.COA RIN SoldFull/Splt Sts is Asterisk
IF PAR.COA_RIN_SoldFull_Splt_Sts = *;

CASE;

// IF PAR.COA BHR RINs to Sell Sep is GT 0
IF PAR.COA_BHR_RINs_to_Sell_Sep > *ZERO;

// AND DB1.COA BHR Net Galls to Sell LT PAR.COA BHR RINs to Sell Sep
AND DB1.COA_BHR_Net_Galls_to_Sell < PAR.COA_BHR_RINs_to_Sell_Sep;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

CASE;

// IF PAR.COA RIN SoldFull/Splt Sts is Blank
IF PAR.COA_RIN_SoldFull_Splt_Sts = *BLANK;

CASE;

// IF PAR.COA BHR RINs to Sell Sep is GT 0
IF PAR.COA_BHR_RINs_to_Sell_Sep > *ZERO;

// AND DB1.COA BHR RINs to Sell Sep LT PAR.COA BHR RINs to Sell Sep
AND DB1.COA_BHR_RINs_to_Sell_Sep < PAR.COA_BHR_RINs_to_Sell_Sep;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: On print of first page format

MOVE *ALL (To: 1PG From: PAR);

EXECUTE FUNCTION(Company Name DRV) TYPE(DRVFLD)                                 AC1532476;
PARAMETER(X1PG_Company_Name_DRV);
PARAMETER(X1PG_Company_Number);
{
 //?Calculate derived field

 EXECUTE FUNCTION(RTV Company Name       RT) TYPE(RTVOBJ) FILE(CAABREP)          AC1255767;
 PARAMETER(PAR.Company_Number);
 PARAMETER(PAR.Company_Name_DRV);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


CASE;

// IF 1PG.COA Batch Number is Greater than zero
IF X1PG_COA_Batch_Number > *ZERO;

// IF *OTHERWISE
IF *OTHERWISE;

// 1PG.Text USR 4 = CON.*All
X1PG_Text_USR_4 = *All;

ENDIF;

CASE;

// IF 1PG.COA Batch Header RIN Seq is GT 0
IF X1PG_COA_Batch_Header_RIN_Seq > *ZERO;

// IF *OTHERWISE
IF *OTHERWISE;

// 1PG.Text USR = CON.*All
X1PG_Text_USR = *All;

ENDIF;

//?USER: Print required level headings

// SUPPRESSED PRINT Company Number header format

CASE;

IF NEW COA_ULSD_Company_#;
// Print COA ULSD Company # header format
PRINT COA ULSD Company # header format;

ENDIF;

// SUPPRESSED PRINT COA RIN Transaction Date header format

// SUPPRESSED PRINT COA RIN Transaction Time header format

// SUPPRESSED PRINT COA Batch Number header format

// SUPPRESSED PRINT COA Batch Header RIN Seq header format

// SUPPRESSED PRINT COA Batch Hdr RIN Seq Sec header format

//?USER: On print of detail format

CASE;

// IF CUR.RFS Transaction Type is Buy
IF CUR.RFS_Transaction_Type = 'BUY';

//?was hardcoded to 361   8.16.16
EXECUTE FUNCTION(Rtv Order for BUY     RT) TYPE(RTVOBJ) FILE(PMDACPP)           AC2000023;
PARAMETER(LCL.Company_Number_041405);
PARAMETER(CUR.COA_ULSD_Company_#);
PARAMETER(CUR.COA_Batch_Number);
PARAMETER(CUR.COA_Batch_Header_RIN_Seq);
PARAMETER(CUR.Order_Number);
PARAMETER(NLL.Order_Sequence_Number);
PARAMETER(NLL.Order_Secondary_Line_Seq);
PARAMETER(NLL.Case_Sequence_Number);
PARAMETER(CUR.Load_ID);
PARAMETER(NLL.COA_RIN_Gallons_Sold);
PARAMETER(CUR.COA_RIN_Customer_PO#);
PARAMETER(NLL.COA_Shipping_Company);
{
 //?USER: Processing if Data record not found

 // PAR.Order Number = CON.*ZERO
 PAR.Order_Number = *ZERO;

 //?USER: Process Data record

 //?Get 1st ord ... s/only be 1 order for this ulsd/batch/seq
 CASE;

 // IF DB1.Order Number is Greater then zero
 IF DB1.Order_Number > *ZERO;

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

 ENDIF;

}


ENDIF;

//?USER: Print required level totals

// SUPPRESSED PRINT COA Batch Hdr RIN Seq Sec totals format

// SUPPRESSED PRINT COA Batch Header RIN Seq totals format

// SUPPRESSED PRINT COA Batch Number totals format

// SUPPRESSED PRINT COA RIN Transaction Time totals format

// SUPPRESSED PRINT COA RIN Transaction Date totals format

// SUPPRESSED PRINT COA ULSD Company # totals format

// SUPPRESSED PRINT Company Number totals format

