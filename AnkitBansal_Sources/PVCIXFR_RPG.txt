     H/TITLE Snd Upd/Del Processed XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 06/27/24  Time  : 10:54:38
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPPBRCPL4  IF   E           K DISK
      * RSQ : PFS Manifest Header       Co/ManifID SEL Processed
      *
     FPPBNCPL4  IF   E           K DISK
      * RSQ : PFS Manifest Detail       ManifID/DtlID SEL Proces
      *
     FPPBNCPL0  UF   E           K DISK
      * UPD : PFS Manifest Detail       Update index
      *
     FPPBRCPL0  UF   E           K DISK
      * UPD : PFS Manifest Header       Update index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QPPBN1        E DS                  EXTNAME(PPBNCPL0)
      * UPD : PFS Manifest Detail       Update index
      * Renamed input format fields
     D  WCKENZ       E                     EXTFLD(BNKENZ)
     D  WCKFNZ       E                     EXTFLD(BNKFNZ)
     D  WCZPNX       E                     EXTFLD(BNZPNX)
     D  WCZXNX       E                     EXTFLD(BNZXNX)
     D  WCZYNX       E                     EXTFLD(BNZYNX)
     D  WCWGU1       E                     EXTFLD(BNWGU1)
     D  WCBZSC       E                     EXTFLD(BNBZSC)
     D  WCU4SX       E                     EXTFLD(BNU4SX)
     D  WCE6AB       E                     EXTFLD(BNE6AB)
     D  WCP7DT       E                     EXTFLD(BNP7DT)
     D  WCXOU1       E                     EXTFLD(BNXOU1)
     D  WCY2NX       E                     EXTFLD(BNY2NX)
     D  WCZ4NX       E                     EXTFLD(BNZ4NX)
     D  WCZ8NX       E                     EXTFLD(BNZ8NX)
     D  WCKWNZ       E                     EXTFLD(BNKWNZ)
     D  WCKXNZ       E                     EXTFLD(BNKXNZ)
     D  WCAANY       E                     EXTFLD(BNAANY)
     D  WCUWSX       E                     EXTFLD(BNUWSX)
     D  WCUXSX       E                     EXTFLD(BNUXSX)
     D  WCAHNY       E                     EXTFLD(BNAHNY)
     D  WCAINY       E                     EXTFLD(BNAINY)
     D  WCAJNY       E                     EXTFLD(BNAJNY)
     D  WCAKNY       E                     EXTFLD(BNAKNY)
      *
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
     D YARDCS          DS           166
     D QPPBR1        E DS                  EXTNAME(PPBRCPL0)
      * UPD : PFS Manifest Header       Update index
      * Renamed input format fields
     D  WDKENZ       E                     EXTFLD(BRKENZ)
     D  WDY1NX       E                     EXTFLD(BRY1NX)
     D  WDZPNX       E                     EXTFLD(BRZPNX)
     D  WDX4DT       E                     EXTFLD(BRX4DT)
     D  WDF8AA       E                     EXTFLD(BRF8AA)
     D  WDF9AA       E                     EXTFLD(BRF9AA)
     D  WDVESX       E                     EXTFLD(BRVESX)
     D  WDUWSX       E                     EXTFLD(BRUWSX)
     D  WDUXSX       E                     EXTFLD(BRUXSX)
     D  WDAHNY       E                     EXTFLD(BRAHNY)
     D  WDAINY       E                     EXTFLD(BRAINY)
     D  WDAJNY       E                     EXTFLD(BRAJNY)
     D  WDAKNY       E                     EXTFLD(BRAKNY)
      *
     D YBRDCS          DS            75
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              3
     D  WP0002         S              1
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  YL0001         S              3  0
     D  WQSA01         S                   LIKE(WAY1NX)
     D  WQSB01         S                   LIKE(WBKENZ)
     D  WN0001         S              7  0
     D  WN0002         S              3  0
     D  WN0003         S              3  0
     D  WN0004         S             17  0
     D  WN0005         S              2
     D  WN0006         S              3
     D  WN0007         S              6
     D  WN0008         S              8  0
     D  WN0009         S             10
     D  WN0010         S              7  0
     D  WN0011         S              8  0
     D  WN0012         S              8  2
     D  WN0013         S              2  0
     D  WN0014         S              4  0
     D  WN0015         S              8  2
     D  WN0016         S              1
     D  WN0017         S              8  0
     D  WN0018         S              6  0
     D  WN0019         S              8  0
     D  WN0020         S              6  0
     D  YARDC          S              1
     D  WQ0001         S             15  5
     D  WQ0002         S             15  5
     D  W0CLPG         S             10
     D  WN0021         S              3  0
     D  WN0022         S              7  0
     D  WN0023         S              8  0
     D  WN0024         S              3
     D  WN0025         S              3
     D  WN0026         S              1
     D  WN0027         S              1
     D  WN0028         S              8  0
     D  WN0029         S              6  0
     D  WN0030         S              8  0
     D  WN0031         S              6  0
     D  YBRDC          S              1
     D  WQ0003         S             15  5
     D  WQ0004         S             15  5
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * I :  PFS Company Number Alpha
     D  P1EWU1                 1      3
     D P2PARM          DS
      * I :  Upd/Del Sts USR
     D  P2WYSX                 1      1
     D                 DS
     D  ZAMSDA                 1    132
     I@BRCPQO
      * PFS Manifest Header       Co/ManifID SEL Processed
      * Renamed input format fields
     I              BRKENZ                      WAKENZ
     I              BRY1NX                      WAY1NX
     I              BRZPNX                      WAZPNX
     I              BRX4DT                      WAX4DT
     I              BRF8AA                      WAF8AA
     I              BRF9AA                      WAF9AA
     I              BRVESX                      WAVESX
     I              BRUWSX                      WAUWSX
     I              BRUXSX                      WAUXSX
     I              BRAHNY                      WAAHNY
     I              BRAINY                      WAAINY
     I              BRAJNY                      WAAJNY
     I              BRAKNY                      WAAKNY
      *
     I@BNCPQR
      * PFS Manifest Detail       ManifID/DtlID SEL Proces
      * Renamed input format fields
     I              BNKENZ                      WBKENZ
     I              BNKFNZ                      WBKFNZ
     I              BNZPNX                      WBZPNX
     I              BNZXNX                      WBZXNX
     I              BNZYNX                      WBZYNX
     I              BNWGU1                      WBWGU1
     I              BNBZSC                      WBBZSC
     I              BNU4SX                      WBU4SX
     I              BNE6AB                      WBE6AB
     I              BNP7DT                      WBP7DT
     I              BNXOU1                      WBXOU1
     I              BNY2NX                      WBY2NX
     I              BNZ4NX                      WBZ4NX
     I              BNZ8NX                      WBZ8NX
     I              BNKWNZ                      WBKWNZ
     I              BNKXNZ                      WBKXNZ
     I              BNAANY                      WBAANY
     I              BNUWSX                      WBUWSX
     I              BNUXSX                      WBUXSX
     I              BNAHNY                      WBAHNY
     I              BNAINY                      WBAINY
     I              BNAJNY                      WBAJNY
     I              BNAKNY                      WBAKNY
      *
     I@BNCPZL
      * PFS Manifest Detail       Update index
      * Renamed input format fields
     I              BNKENZ                      WCKENZ
     I              BNKFNZ                      WCKFNZ
     I              BNZPNX                      WCZPNX
     I              BNZXNX                      WCZXNX
     I              BNZYNX                      WCZYNX
     I              BNWGU1                      WCWGU1
     I              BNBZSC                      WCBZSC
     I              BNU4SX                      WCU4SX
     I              BNE6AB                      WCE6AB
     I              BNP7DT                      WCP7DT
     I              BNXOU1                      WCXOU1
     I              BNY2NX                      WCY2NX
     I              BNZ4NX                      WCZ4NX
     I              BNZ8NX                      WCZ8NX
     I              BNKWNZ                      WCKWNZ
     I              BNKXNZ                      WCKXNZ
     I              BNAANY                      WCAANY
     I              BNUWSX                      WCUWSX
     I              BNUXSX                      WCUXSX
     I              BNAHNY                      WCAHNY
     I              BNAINY                      WCAINY
     I              BNAJNY                      WCAJNY
     I              BNAKNY                      WCAKNY
      *
     I@BRCPPD
      * PFS Manifest Header       Update index
      * Renamed input format fields
     I              BRKENZ                      WDKENZ
     I              BRY1NX                      WDY1NX
     I              BRZPNX                      WDZPNX
     I              BRX4DT                      WDX4DT
     I              BRF8AA                      WDF8AA
     I              BRF9AA                      WDF9AA
     I              BRVESX                      WDVESX
     I              BRUWSX                      WDUWSX
     I              BRUXSX                      WDUXSX
     I              BRAHNY                      WDAHNY
     I              BRAINY                      WDAINY
     I              BRAJNY                      WDAJNY
     I              BRAKNY                      WDAKNY
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1EWU1        PARM                    WP0001                         PFS Company Num
     C     P2WYSX        PARM                    WP0002                         Upd/Del Sts USR
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Snd Upd/Del Processed XF
     C                   MOVE      P1EWU1        YL0001                         PFS Company Num
      * Snd Upd/Del Processed RT - PFS Manifest Header  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Snd Upd/Del Processed RT - PFS Manifest Header  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WQSA01                         PFS Company Num
      * Setup key
     C                   Z-ADD     YL0001        WQSA01                         PFS Company Num
      * Establish starting position
     C     KRSSA         SETLL     @BRCPQO                                      *
     C     KRSSA         READE     @BRCPQO                                90    *
      * Data record not found
     C   90              MOVEL     'USR5405'     W0RTN
      * USER: Process Data record
      * Update PFS Manifest Detail Table.
      * Snd Upd/Del Processed RT - PFS Manifest Detail  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SBRVGN
      * CASE: PAR.Upd/Del Sts USR is Delete
      * Del PFS Manifest Hdr  DL - PFS Manifest Header  * 
     C                   IF        P2WYSX = 'D'
     C                   EXSR      SEDLRC
     C                   ELSE
      * CASE: PAR.Upd/Del Sts USR is Update
      * Update back to 'Not Processed' since download suffix file still
      * have data from previous transmission & have not been picked up
      * by Carlisle.
      * Chg PFS Process Status CH - PFS Manifest Header  * 
     C                   IF        P2WYSX = 'U'
     C                   EXSR      SFCHRC
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     KRSSA         READE     @BRCPQO                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Snd Upd/Del Processed RT - PFS Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WQSB01                         PFS Manifest ID
      * Setup key
     C                   Z-ADD     WAKENZ        WQSB01                         PFS Manifest ID
      * Establish starting position
     C     KRSSB         SETLL     @BNCPQR                                      *
     C     KRSSB         READE     @BNCPQR                                90    *
      * Data record not found
     C   90              MOVEL     'USR3510'     W0RTN
      * USER: Process Data record
      * CASE: PAR.Upd/Del Sts USR is Delete
     C                   DOW       NOT *IN90
      * Del PFS Manifest Dtl  DL - PFS Manifest Detail  * 
     C                   IF        P2WYSX = 'D'
     C                   EXSR      SCDLRC
     C                   ELSE
      * CASE: PAR.Upd/Del Sts USR is Update
      * Chg PFS Process Status CH - PFS Manifest Detail  * 
     C                   IF        P2WYSX = 'U'
     C                   EXSR      SDCHRC
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     KRSSB         READE     @BNCPQR                                90    *
     C                   ENDDO
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCDLRC        BEGSR
      *================================================================
      * Del PFS Manifest Dtl  DL - PFS Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to @BNCPZL
     C                   Z-ADD     WBKENZ        WCKENZ                         PFS Manifest ID
     C                   Z-ADD     WBKFNZ        WCKFNZ                         PFS Manifest De
      *
     C     KLDLSC        KLIST
     C                   KFLD                    WCKENZ                         PFS Manifest ID
     C                   KFLD                    WCKFNZ                         PFS Manifest De
     C     KLDLSC        CHAIN     @BNCPZL                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBNCPL0'    MDACP
     C                   MOVEL     '@BNCPZL'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    @BNCPZL                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDCHRC        BEGSR
      *================================================================
      * Chg PFS Process Status CH - PFS Manifest Detail  * 
      *================================================================
      *
     C                   Z-ADD     *ZERO         WN0001                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WN0002                         PFS Order Line
     C                   Z-ADD     *ZERO         WN0003                         PFS Substitutio
     C                   Z-ADD     *ZERO         WN0004                         PFS Pallet ID
     C                   EVAL      WN0005 = ' '                                 PFS Fresh_Froze
     C                   EVAL      WN0006 = ' '                                 PFS From Wareho
     C                   EVAL      WN0007 = ' '                                 PFS Manifest Lo
     C                   Z-ADD     *ZERO         WN0008                         PFS Production
     C                   EVAL      WN0009 = ' '                                 PFS Serial Numb
     C                   Z-ADD     *ZERO         WN0010                         PFS Item Code
     C                   Z-ADD     *ZERO         WN0011                         PFS Label Date
     C                   Z-ADD     *ZERO         WN0012                         PFS Net Weight
     C                   Z-ADD     *ZERO         WN0013                         PFS Date AI
     C                   Z-ADD     *ZERO         WN0014                         PFS Weight AI
     C                   Z-ADD     *ZERO         WN0015                         PFS Gross Weigh
     C                   EVAL      WN0016 = ' '                                 PFS Record Stat
     C                   Z-ADD     *ZERO         WN0017                         PFS Create Date
     C                   Z-ADD     *ZERO         WN0018                         PFS Create Time
     C                   Z-ADD     *ZERO         WN0019                         PFS Change Date
     C                   Z-ADD     *ZERO         WN0020                         PFS Change Time
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to @BNCPZL
     C                   Z-ADD     WBKENZ        WCKENZ                         PFS Manifest ID
     C                   Z-ADD     WBKFNZ        WCKFNZ                         PFS Manifest De
      *
     C     KLCHSD        KLIST
     C                   KFLD                    WCKENZ                         PFS Manifest ID
     C                   KFLD                    WCKFNZ                         PFS Manifest De
     C     KLCHSD        CHAIN     @BNCPZL                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBNCPL0'    MDACP
     C                   MOVEL     '@BNCPZL'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL002.
     C                   MOVEL     'LBL002'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QPPBN1        YARDCS
      * Move non-key fields to @BNCPZL
     C                   Z-ADD     *ZERO         WCUXSX                         PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBN1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * USER: Processing before Data update
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     WCAJNY        PARM      *ZERO         WQ0001                         Current System
     C     WCAKNY        PARM      *ZERO         WQ0002                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBN1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    @BNCPZL                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    PPBNCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SEDLRC        BEGSR
      *================================================================
      * Del PFS Manifest Hdr  DL - PFS Manifest Header  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to @BRCPPD
     C                   Z-ADD     WAKENZ        WDKENZ                         PFS Manifest ID
      *
     C     KLDLSE        KLIST
     C                   KFLD                    WDKENZ                         PFS Manifest ID
     C     KLDLSE        CHAIN     @BRCPPD                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBRCPL0'    MDACP
     C                   MOVEL     '@BRCPPD'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL003.
     C                   MOVEL     'LBL003'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    @BRCPPD                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCHRC        BEGSR
      *================================================================
      * Chg PFS Process Status CH - PFS Manifest Header  * 
      *================================================================
      *
     C                   Z-ADD     *ZERO         WN0021                         PFS Company Num
     C                   Z-ADD     *ZERO         WN0022                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WN0023                         PFS Ship Date
     C                   EVAL      WN0024 = ' '                                 PFS Ship From W
     C                   EVAL      WN0025 = ' '                                 PFS Ship To War
     C                   EVAL      WN0026 = ' '                                 PFS Order Statu
     C                   EVAL      WN0027 = ' '                                 PFS Record Stat
     C                   Z-ADD     *ZERO         WN0028                         PFS Create Date
     C                   Z-ADD     *ZERO         WN0029                         PFS Create Time
     C                   Z-ADD     *ZERO         WN0030                         PFS Change Date
     C                   Z-ADD     *ZERO         WN0031                         PFS Change Time
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YBRDC = ' '
      *
      * Move key fields to @BRCPPD
     C                   Z-ADD     WAKENZ        WDKENZ                         PFS Manifest ID
      *
     C     KLCHSF        KLIST
     C                   KFLD                    WDKENZ                         PFS Manifest ID
     C     KLCHSF        CHAIN     @BRCPPD                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBRCPL0'    MDACP
     C                   MOVEL     '@BRCPPD'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL004.
     C                   MOVEL     'LBL004'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QPPBR1        YBRDCS
      * Move non-key fields to @BRCPPD
     C                   Z-ADD     *ZERO         WDUXSX                         PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBR1 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * USER: Processing before Data update
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     WDAJNY        PARM      *ZERO         WQ0003                         Current System
     C     WDAKNY        PARM      *ZERO         WQ0004                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBR1 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YBRDC = 'Y'
     C                   UPDATE    @BRCPPD                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    PPBRCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      *
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAKENZ                         PFS Manifest ID
     C                   Z-ADD     *ZERO         WAY1NX                         PFS Company Num
     C                   Z-ADD     *ZERO         WAZPNX                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WAX4DT                         PFS Ship Date
     C                   Z-ADD     *ZERO         WAUXSX                         PFS Process Sta
     C                   Z-ADD     *ZERO         WAAHNY                         PFS Create Date
     C                   Z-ADD     *ZERO         WAAINY                         PFS Create Time
     C                   Z-ADD     *ZERO         WAAJNY                         PFS Change Date
     C                   Z-ADD     *ZERO         WAAKNY                         PFS Change Time
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBKENZ                         PFS Manifest ID
     C                   Z-ADD     *ZERO         WBKFNZ                         PFS Manifest De
     C                   Z-ADD     *ZERO         WBZPNX                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WBZXNX                         PFS Order Line
     C                   Z-ADD     *ZERO         WBZYNX                         PFS Substitutio
     C                   Z-ADD     *ZERO         WBWGU1                         PFS Pallet ID
     C                   Z-ADD     *ZERO         WBP7DT                         PFS Production
     C                   Z-ADD     *ZERO         WBY2NX                         PFS Item Code
     C                   Z-ADD     *ZERO         WBZ4NX                         PFS Label Date
     C                   Z-ADD     *ZERO         WBZ8NX                         PFS Net Weight
     C                   Z-ADD     *ZERO         WBKWNZ                         PFS Date AI
     C                   Z-ADD     *ZERO         WBKXNZ                         PFS Weight AI
     C                   Z-ADD     *ZERO         WBAANY                         PFS Gross Weigh
     C                   Z-ADD     *ZERO         WBUXSX                         PFS Process Sta
     C                   Z-ADD     *ZERO         WBAHNY                         PFS Create Date
     C                   Z-ADD     *ZERO         WBAINY                         PFS Create Time
     C                   Z-ADD     *ZERO         WBAJNY                         PFS Change Date
     C                   Z-ADD     *ZERO         WBAKNY                         PFS Change Time
     C                   MOVEL     'N'           W0PMT
      * Define local work field PFS Company Number
     C                   Z-ADD     *ZERO         YL0001
      *================================================================
     CSR   ZZEXIT        ENDSR
