/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR LOADS NOT ON YARD. */
/*             COMPANY, DATES                                       */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT LOADS NOT ON YARD REPORT                      */
/*  DATE      - 01/29/98                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FRMDATN    - FROM SHIP DATE                            */
/*          &THRDATN    - TO   SHIP DATE                            */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/********************************************************************/
/* 04/24/2015 LJB E004076  EMAIL ADDRESS AS AN OPTIONAL FIELD       */
/* 03/05/2015 LJB E003914  ADD CARRIER CODE TO RESTRICT REPORT      */
/* RMC 5/14/04  PKTR01 MAKE CO OPTIONAL ON QRYSLT                   */
/* RMC 10/11/17 MONMSG  S11838                                     */
/* PIO 05/17/23 REPLACE OPNQRYF WITH OPNSQLF FOR OMFJCPP FILE      */
/*              ADDED NEEDED OVRDBF AROUND THE COMMAND             */
/*              CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=,*/
/*              *GT TO > IN &D                                     */
/* DN  08/28/24 WI 568.13 - SR 3019098 - COMMENTED OUT OVRDBF OF    */
/*       OMFJCPLN. COMMENTED OUT OF OVRDBF OF OMFJCPP & OPNSQL.     */
/*       OMFJCPLN. COMMENTED OUT OF OPNSQLF.                        */
/*       CHANGE PDHLPFR PROGRAM TO ONLY SELECT RECORDS WITHIN THE   */
/*       SCHEDULE SHIP DATE RANGE (FROM & THRU DATES).              */
/********************************************************************/
 PDHKUCLP:   PGM        PARM(&COMPNYN &FRMDATN &THRDATN &OUTQ &HOLD +
                          &SAVE &COPYN &CARRIER &EMAIL1 &EMAIL2)

/* PARMS                                                                      */
        DCL    &COMPNYN    *DEC                  /* Company Number (Passed)   */
        DCL    &FRMDATN    *DEC                  /* FROM SHIP DATE (Passed)   */
        DCL    &THRDATN    *DEC                  /* TO   SHIP DATE (Passed)   */
        DCL    &DESC       *CHAR   (25)          /* DESCRIPTION               */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &COMMAND    *CHAR   (512)
        DCL    &CARRIER    *CHAR    3            /* CARRIER CODE              */
        DCL    &SENDYN     *CHAR    1            /* EMAIL OR NOT              */
        DCL    &EMAIL      *CHAR    50           /* EMAIL ADDRESS             */
        DCL    &EMAIL1     *CHAR    25           /* EMAIL ADDRESS             */
        DCL    &EMAIL2     *CHAR    25           /* EMAIL ADDRESS             */
        DCL    &SUBJECT    *CHAR   (100)

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMPANY    *DEC    (3 0)         /* Company Number            */
        DCL    &FRMDAT     *DEC    (7 0)         /* FROM SHIP DATE            */
        DCL    &THRDAT     *DEC    (7 0)         /* TO   SHIP DATE            */

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* ACK COMPLETE              */
        DCL    &FRMDATA    *CHAR    7            /* SCHD SHIP DATE (Passed)   */
        DCL    &THRDATA    *CHAR    7            /* SCHD SHIP DATE (Passed)   */

        DCL     &A        *CHAR   40              /* QRY FROM DATE  */
        DCL     &B        *CHAR   50              /* QRY TO DATE    */
        DCL     &C        *CHAR   50              /* QRY COMPANY    */
        DCL     &D        *CHAR  120              /* QRY ALL        */
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&FRMDAT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FRMDAT)
             CHGVAR     VAR(&THRDAT) VALUE(&THRDATN)
             CHGVAR     VAR(&THRDATA) VALUE(&THRDAT)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)
             CHGVAR     VAR(&SENDYN) VALUE('N')

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORT                    */
/*********************************************************************/
             IF         COND(&COMPA *GT '000') THEN(DO)
  /*PIO      CHGVAR     VAR(&A) VALUE('FJAIC3 *EQ ' *CAT &COMPA *BCAT '*AND')*/
  /*PIO*/    CHGVAR     VAR(&A) VALUE('FJAIC3 =   ' *CAT &COMPA *BCAT ' AND')
             ENDDO

  /*PIO      CHGVAR     VAR(&B) VALUE('(FJAODT *GE ' *CAT +   +
                          &FRMDATA *CAT ' *AND FJAODT *LE ' *CAT + +
                          &THRDATA *CAT ')')                 */
  /*PIO*/    CHGVAR     VAR(&B) VALUE('(FJAODT >=  ' *CAT +
                          &FRMDATA *CAT '  AND FJAODT <=  ' *CAT +
                          &THRDATA *CAT ')')

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDHLPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             CHGVAR     VAR(&D) VALUE(&A *BCAT &B)

/*  RUN QUERY TO READ LOAD HEADER BY DATE RANGE  */
    /*PIO    OVRDBF     FILE(OMFJCPLN) SHARE(*YES)    +
             OPNQRYF    FILE((OMFJCPLN)) QRYSLT(&D) KEYFLD(*FILE) */

   /* DN SR3019098 - COMMENTED OUT OVRDBF & OPNSLF LOGIC. NOT REQUIRED */
   /*PIO*/ /*OVRDBF     FILE(OMFJCPP) TOFILE(OMFJCPP) LVLCHK(*NO)      */
           /*OPNSQLF    SQL('Select * from OMFJCPP where ' *BCAT &D +
                          *BCAT ' ORDER BY FJAODT ASC, FJVPCD ASC, +
                          FJVDST ASC, FJRMNB ASC') OPNID(OMFJCPLN) +
                          OPTION(*ALL) SEQONLY(*NO) RCDFMT(@FJCPSF) +
                          ALWCPY(*IFRQD) */  /*PIO*/
   /* DN SR3019098 - COMMENTED OUT OVRDBF LOGIC. NOT REQUIRED */
   /*PIO*/ /*OVRDBF     FILE(OMFJCPLN) TOFILE(OMFJCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)    */

/*********************************************************************/
/* CALL PRINT PROGRAM FOR PRINT LOADS NOT ON YARD REPORT             */
/*      (3914-ADD CARRIER CODE)                                      */
/*      (4076-ADD SENDYN IF CALLED FROM JOB SCHEDULER)               */
/*      (     ADD EMAIL ADDRESS IF EMAILED FROM PROMPT SCREEN)       */
/*********************************************************************/
             CALL       PGM(PDHLPFR) PARM(' ' &COMPANY &FRMDAT +
                          &THRDAT &CARRIER &SENDYN)

/* ONLY EMAIL IF AN EMAIL ADDRESS WAS PROVIDED AND IF THERE WAS      */
/* AT LEAST ONE RECORD ON THE REPORT         E004076                 */
             IF         COND(&EMAIL1 *NE '               ') THEN(DO)
             IF         COND(&SENDYN *EQ 'Y') THEN(DO)
             IF         COND(&CARRIER *NE 'BUY') THEN(DO)
             CHGVAR     VAR(&EMAIL) VALUE(&EMAIL1 *TCAT &EMAIL2)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&SUBJECT) VALUE('Loads Not On Yard +
                          Report' *BCAT 'FOR' *BCAT &CARRIER *CAT +
                          '/' *CAT &COMPA)
             ESEND/ESNDMAIL RECIPIENT(&EMAIL) SUBJECT(&SUBJECT) +
                          MSG(&SUBJECT) ATTLIST((* *DFT *N PDHLPFR$))
             MONMSG     MSGID(EML0004 EML0023)
             ENDDO
             ENDDO
             ENDDO

   /* DN SR3019098 - COMMENTED OUT. NOT REQUIRED */
          /* CLOF       OPNID(OMFJCPLN) */

 END:        ENDPGM
