     H/TITLE RTV Purge & Delete     XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1181
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISTJOHN
     H* Date          : 07/17/07  Time  : 12:18:11
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDMACPL1IF  E           K        DISK
      * RTV : A/R Lockbox Deposit       Retrieval index
      *
     FPDMDCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Invoice       Retrieval index
      *
     FPDMCCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Check         Retrieval index
      *
     FPDMBCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Batch         Retrieval index
      *
     FPDMDCPL4IF  E           K        DISK                      A
      * UPD : A/R Lockbox Invoice       Update index to Purge
      *
     FPDMDCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Invoice       Update index
      *
     FPDMCCPL2IF  E           K        DISK                      A
      * UPD : A/R Lockbox Check         Update index to Purge
      *
     FPDMCCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Check         Update index
      *
     FPDMBCPL2IF  E           K        DISK                      A
      * UPD : A/R Lockbox Batch         Update Index for Purge
      *
     FPDMBCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Batch         Update index
      *
     FPDMACPL0UF  E           K        DISK
      * UPD : A/R Lockbox Deposit       Update index
      *
     E                    YDOW        7  1               *Days of week
     I@MACPTS
      * A/R Lockbox Deposit       Retrieval index
      * Renamed input format fields
     I              MABEC3                          WABEC3
     I              MALWDT                          WALWDT
     I              MAYWNX                          WAYWNX
     I              MANMC1                          WANMC1
     I              MANMC2                          WANMC2
     I              MAZXVA                          WAZXVA
     I              MAAWSX                          WAAWSX
      *
     I@MDCPT1
      * A/R Lockbox Invoice       Retrieval index
      * Renamed input format fields
     I              MDBEC3                          WBBEC3
     I              MDLWDT                          WBLWDT
     I              MDYWNX                          WBYWNX
     I              MDBFC3                          WBBFC3
     I              MDBGC3                          WBBGC3
     I              MDNMC5                          WBNMC5
     I              MDNMC4                          WBNMC4
     I              MDNMC3                          WBNMC3
     I              MDZ0VA                          WBZ0VA
     I              MDAIC3                          WBAIC3
     I              MDUHCD                          WBUHCD
     I              MDAFSX                          WBAFSX
     I              MDNGNA                          WBNGNA
      *
     I@MDCPDW
      * A/R Lockbox Invoice       Update index to Purge
      * Renamed input format fields
     I              MDBEC3                          WCBEC3
     I              MDLWDT                          WCLWDT
     I              MDYWNX                          WCYWNX
     I              MDBFC3                          WCBFC3
     I              MDBGC3                          WCBGC3
     I              MDNMC5                          WCNMC5
     I              MDNMC4                          WCNMC4
     I              MDNMC3                          WCNMC3
     I              MDZ0VA                          WCZ0VA
     I              MDAIC3                          WCAIC3
     I              MDUHCD                          WCUHCD
     I              MDAFSX                          WCAFSX
     I              MDNGNA                          WCNGNA
      *
     I@MDCPT0
      * A/R Lockbox Invoice       Update index
      * Renamed input format fields
     I              MDBEC3                          WDBEC3
     I              MDLWDT                          WDLWDT
     I              MDYWNX                          WDYWNX
     I              MDBFC3                          WDBFC3
     I              MDBGC3                          WDBGC3
     I              MDNMC5                          WDNMC5
     I              MDNMC4                          WDNMC4
     I              MDNMC3                          WDNMC3
     I              MDZ0VA                          WDZ0VA
     I              MDAIC3                          WDAIC3
     I              MDUHCD                          WDUHCD
     I              MDAFSX                          WDAFSX
     I              MDNGNA                          WDNGNA
      *
     I@MCCPTY
      * A/R Lockbox Check         Retrieval index
      * Renamed input format fields
     I              MCBEC3                          WEBEC3
     I              MCLWDT                          WELWDT
     I              MCYWNX                          WEYWNX
     I              MCBFC3                          WEBFC3
     I              MCBGC3                          WEBGC3
     I              MCO1TX                          WEO1TX
     I              MCLXDT                          WELXDT
     I              MCZZVA                          WEZZVA
     I              MCCWC7                          WECWC7
     I              MCO2TX                          WEO2TX
     I              MCABSX                          WEABSX
     I              MCADSX                          WEADSX
      *
     I@MCCPDV
      * A/R Lockbox Check         Update index to Purge
      * Renamed input format fields
     I              MCBEC3                          WFBEC3
     I              MCLWDT                          WFLWDT
     I              MCYWNX                          WFYWNX
     I              MCBFC3                          WFBFC3
     I              MCBGC3                          WFBGC3
     I              MCO1TX                          WFO1TX
     I              MCLXDT                          WFLXDT
     I              MCZZVA                          WFZZVA
     I              MCCWC7                          WFCWC7
     I              MCO2TX                          WFO2TX
     I              MCABSX                          WFABSX
     I              MCADSX                          WFADSX
      *
     I@MCCPTX
      * A/R Lockbox Check         Update index
      * Renamed input format fields
     I              MCBEC3                          WGBEC3
     I              MCLWDT                          WGLWDT
     I              MCYWNX                          WGYWNX
     I              MCBFC3                          WGBFC3
     I              MCBGC3                          WGBGC3
     I              MCO1TX                          WGO1TX
     I              MCLXDT                          WGLXDT
     I              MCZZVA                          WGZZVA
     I              MCCWC7                          WGCWC7
     I              MCO2TX                          WGO2TX
     I              MCABSX                          WGABSX
     I              MCADSX                          WGADSX
      *
     I@MBCPTV
      * A/R Lockbox Batch         Retrieval index
      * Renamed input format fields
     I              MBBEC3                          WHBEC3
     I              MBLWDT                          WHLWDT
     I              MBYWNX                          WHYWNX
     I              MBBFC3                          WHBFC3
     I              MBNMC0                          WHNMC0
     I              MBZYVA                          WHZYVA
     I              MBYWCD                          WHYWCD
      *
     I@MBCPDU
      * A/R Lockbox Batch         Update Index for Purge
      * Renamed input format fields
     I              MBBEC3                          WIBEC3
     I              MBLWDT                          WILWDT
     I              MBYWNX                          WIYWNX
     I              MBBFC3                          WIBFC3
     I              MBNMC0                          WINMC0
     I              MBZYVA                          WIZYVA
     I              MBYWCD                          WIYWCD
      *
     I@MBCPTU
      * A/R Lockbox Batch         Update index
      * Renamed input format fields
     I              MBBEC3                          WJBEC3
     I              MBLWDT                          WJLWDT
     I              MBYWNX                          WJYWNX
     I              MBBFC3                          WJBFC3
     I              MBNMC0                          WJNMC0
     I              MBZYVA                          WJZYVA
     I              MBYWCD                          WJYWCD
      *
     I@MACPTR
      * A/R Lockbox Deposit       Update index
      * Renamed input format fields
     I              MABEC3                          WKBEC3
     I              MALWDT                          WKLWDT
     I              MAYWNX                          WKYWNX
     I              MANMC1                          WKNMC1
     I              MANMC2                          WKNMC2
     I              MAZXVA                          WKZXVA
     I              MAAWSX                          WKAWSX
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
     IQPDMD1    E DSPDMDCPL4
      * UPD : A/R Lockbox Invoice       Update index to Purge
      * Renamed input format fields
     I              MDBEC3                          WCBEC3
     I              MDLWDT                          WCLWDT
     I              MDYWNX                          WCYWNX
     I              MDBFC3                          WCBFC3
     I              MDBGC3                          WCBGC3
     I              MDNMC5                          WCNMC5
     I              MDNMC4                          WCNMC4
     I              MDNMC3                          WCNMC3
     I              MDZ0VA                          WCZ0VA
     I              MDAIC3                          WCAIC3
     I              MDUHCD                          WCUHCD
     I              MDAFSX                          WCAFSX
     I              MDNGNA                          WCNGNA
      *
     IQPDMD2    E DSPDMDCPL0
      * UPD : A/R Lockbox Invoice       Update index
      * Renamed input format fields
     I              MDBEC3                          WDBEC3
     I              MDLWDT                          WDLWDT
     I              MDYWNX                          WDYWNX
     I              MDBFC3                          WDBFC3
     I              MDBGC3                          WDBGC3
     I              MDNMC5                          WDNMC5
     I              MDNMC4                          WDNMC4
     I              MDNMC3                          WDNMC3
     I              MDZ0VA                          WDZ0VA
     I              MDAIC3                          WDAIC3
     I              MDUHCD                          WDUHCD
     I              MDAFSX                          WDAFSX
     I              MDNGNA                          WDNGNA
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPDMC1    E DSPDMCCPL2
      * UPD : A/R Lockbox Check         Update index to Purge
      * Renamed input format fields
     I              MCBEC3                          WFBEC3
     I              MCLWDT                          WFLWDT
     I              MCYWNX                          WFYWNX
     I              MCBFC3                          WFBFC3
     I              MCBGC3                          WFBGC3
     I              MCO1TX                          WFO1TX
     I              MCLXDT                          WFLXDT
     I              MCZZVA                          WFZZVA
     I              MCCWC7                          WFCWC7
     I              MCO2TX                          WFO2TX
     I              MCABSX                          WFABSX
     I              MCADSX                          WFADSX
      *
     IQPDMC2    E DSPDMCCPL0
      * UPD : A/R Lockbox Check         Update index
      * Renamed input format fields
     I              MCBEC3                          WGBEC3
     I              MCLWDT                          WGLWDT
     I              MCYWNX                          WGYWNX
     I              MCBFC3                          WGBFC3
     I              MCBGC3                          WGBGC3
     I              MCO1TX                          WGO1TX
     I              MCLXDT                          WGLXDT
     I              MCZZVA                          WGZZVA
     I              MCCWC7                          WGCWC7
     I              MCO2TX                          WGO2TX
     I              MCABSX                          WGABSX
     I              MCADSX                          WGADSX
      *
     IQPDMB1    E DSPDMBCPL2
      * UPD : A/R Lockbox Batch         Update Index for Purge
      * Renamed input format fields
     I              MBBEC3                          WIBEC3
     I              MBLWDT                          WILWDT
     I              MBYWNX                          WIYWNX
     I              MBBFC3                          WIBFC3
     I              MBNMC0                          WINMC0
     I              MBZYVA                          WIZYVA
     I              MBYWCD                          WIYWCD
      *
     IQPDMB2    E DSPDMBCPL0
      * UPD : A/R Lockbox Batch         Update index
      * Renamed input format fields
     I              MBBEC3                          WJBEC3
     I              MBLWDT                          WJLWDT
     I              MBYWNX                          WJYWNX
     I              MBBFC3                          WJBFC3
     I              MBNMC0                          WJNMC0
     I              MBZYVA                          WJZYVA
     I              MBYWCD                          WJYWCD
      *
     IQPDMA1    E DSPDMACPL0
      * UPD : A/R Lockbox Deposit       Update index
      * Renamed input format fields
     I              MABEC3                          WKBEC3
     I              MALWDT                          WKLWDT
     I              MAYWNX                          WKYWNX
     I              MANMC1                          WKNMC1
     I              MANMC2                          WKNMC2
     I              MAZXVA                          WKZXVA
     I              MAAWSX                          WKAWSX
      *
     IYARDCS      DS                             24
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * RTV Purge & Delete     XF
      * RTV Purge & Delete     RT - A/R Lockbox Deposit  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Purge & Delete     RT - A/R Lockbox Deposit  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Today minus 30
     C                     Z-ADD*ZERO     WN0002  70       Today minus 14
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@MACPTS                    *
     C                     READ @MACPTS                  90*
      * Data record not found
     C   90                MOVEL'USR2646' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR.Today minus 30        USR = JOB.*Job date + CON.-30 *DAYS
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD-30       XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     WN0001
     C                     ELSE
     C           XDINDT    SUB  1000000   WN0001
     C                     END
      * PAR.Today minus 14        USR = JOB.*Job date + CON.-14 *DAYS
     C           ##JDT     ADD  1000000   XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD-14       XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     WN0002
     C                     ELSE
     C           XDINDT    SUB  1000000   WN0002
     C                     END
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.LckBx Deposit Date LT PAR.Today minus 30
      *   |- c2    : DB1.LckBx Deposit Status is Purged
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WALWDT    IFLT WN0001                     *IF
     C           WAAWSX    IFEQ 'X'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Delete Lockbox Deposit.
     C                     EXSR UASUBR                     Delete Lockbox
     C                     ELSE
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.LckBx Deposit Date LT PAR.Today minus 14
      *   |- c2    : DB1.LckBx Deposit Status is Open or Posted
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WALWDT    IFLT WN0002                     *IF
     C           WAAWSX    IFEQ 'O'                        *IF
     C           WAAWSX    OREQ 'P'
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Purge Lockbox Deposit.
     C                     EXSR UBSUBR                     Purge Lockbox D
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @MACPTS                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbx Invoic RT - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBBEC3    WQSB01           LckBx Number
     C           *LIKE     DEFN WBLWDT    WQSB02           LckBx Deposit D
     C           *LIKE     DEFN WBYWNX    WQSB03           LckBx Deposit T
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           LckBx Number
     C                     KFLD           WQSB02           LckBx Deposit D
     C                     KFLD           WQSB03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWABEC3    WQSB01           LckBx Number
     C                     Z-ADDWALWDT    WQSB02           LckBx Deposit D
     C                     Z-ADDWAYWNX    WQSB03           LckBx Deposit T
      * Establish starting position
     C           KRSSB     SETLL@MDCPT1                    *
     C           KRSSB     READE@MDCPT1                  90*
      * Data record not found
     C   90                MOVEL'USR2652' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbox InvPRG CR - A/R Lockbox Invoice  * 
     C                     EXSR SCCRRC
      * DLT A/R Lockbox Invoic DL - A/R Lockbox Invoice  * 
     C                     EXSR SDDLRC
     C           KRSSB     READE@MDCPT1                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * CRT A/R Lockbox InvPRG CR - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MDCPDW
     C                     Z-ADDWBBEC3    WCBEC3           LckBx Number
     C                     Z-ADDWBLWDT    WCLWDT           LckBx Deposit D
     C                     Z-ADDWBYWNX    WCYWNX           LckBx Deposit T
     C                     Z-ADDWBBFC3    WCBFC3           LckBx Batch Num
     C                     Z-ADDWBBGC3    WCBGC3           LckBx Item Numb
     C                     Z-ADDWBNMC5    WCNMC5           LckBx Seq Numbe
     C                     Z-ADDWBNMC4    WCNMC4           LckBx Seq Count
     C                     Z-ADDWBNMC3    WCNMC3           LckBx Invoice N
     C                     Z-ADDWBZ0VA    WCZ0VA           LckBx Invoice A
     C                     Z-ADDWBAIC3    WCAIC3           Company Number
     C                     MOVELWBUHCD    WCUHCD           Adjustment Type
     C                     MOVELWBAFSX    WCAFSX           LckBx Trans Sou
     C                     MOVELWBNGNA    WCNGNA           Explanation
      *
     C           KLCRSC    KLIST
     C                     KFLD           WCBEC3           LckBx Number
     C                     KFLD           WCLWDT           LckBx Deposit D
     C                     KFLD           WCYWNX           LckBx Deposit T
     C                     KFLD           WCBFC3           LckBx Batch Num
     C                     KFLD           WCBGC3           LckBx Item Numb
     C                     KFLD           WCNMC5           LckBx Seq Numbe
     C                     KFLD           WCNMC4           LckBx Seq Count
      * Check for duplicate primary key
     C           KLCRSC    SETLL@MDCPDW                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2653' W0RTN   7
      * Send message 'A/R Lockbox Invoice    EX'
     C                     MOVEL'USR2653' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@MDCPDW                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Invoic DL - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MDCPT0
     C                     Z-ADDWBBEC3    WDBEC3           LckBx Number
     C                     Z-ADDWBLWDT    WDLWDT           LckBx Deposit D
     C                     Z-ADDWBYWNX    WDYWNX           LckBx Deposit T
     C                     Z-ADDWBBFC3    WDBFC3           LckBx Batch Num
     C                     Z-ADDWBBGC3    WDBGC3           LckBx Item Numb
     C                     Z-ADDWBNMC5    WDNMC5           LckBx Seq Numbe
     C                     Z-ADDWBNMC4    WDNMC4           LckBx Seq Count
      *
     C           KLDLSD    KLIST
     C                     KFLD           WDBEC3           LckBx Number
     C                     KFLD           WDLWDT           LckBx Deposit D
     C                     KFLD           WDYWNX           LckBx Deposit T
     C                     KFLD           WDBFC3           LckBx Batch Num
     C                     KFLD           WDBGC3           LckBx Item Numb
     C                     KFLD           WDNMC5           LckBx Seq Numbe
     C                     KFLD           WDNMC4           LckBx Seq Count
     C           KLDLSD    CHAIN@MDCPT0              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMDCPL0'MDACP
     C                     MOVEL'@MDCPT0' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MDCPT0                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbox Check RT - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEBEC3    WQSE01           LckBx Number
     C           *LIKE     DEFN WELWDT    WQSE02           LckBx Deposit D
     C           *LIKE     DEFN WEYWNX    WQSE03           LckBx Deposit T
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           LckBx Number
     C                     KFLD           WQSE02           LckBx Deposit D
     C                     KFLD           WQSE03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWABEC3    WQSE01           LckBx Number
     C                     Z-ADDWALWDT    WQSE02           LckBx Deposit D
     C                     Z-ADDWAYWNX    WQSE03           LckBx Deposit T
      * Establish starting position
     C           KRSSE     SETLL@MCCPTY                    *
     C           KRSSE     READE@MCCPTY                  90*
      * Data record not found
     C   90                MOVEL'USR2650' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbox ChcPRG CR - A/R Lockbox Check  * 
     C                     EXSR SFCRRC
      * DLT A/R Lockbox Check  DL - A/R Lockbox Check  * 
     C                     EXSR SGDLRC
     C           KRSSE     READE@MCCPTY                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * CRT A/R Lockbox ChcPRG CR - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MCCPDV
     C                     Z-ADDWEBEC3    WFBEC3           LckBx Number
     C                     Z-ADDWELWDT    WFLWDT           LckBx Deposit D
     C                     Z-ADDWEYWNX    WFYWNX           LckBx Deposit T
     C                     Z-ADDWEBFC3    WFBFC3           LckBx Batch Num
     C                     Z-ADDWEBGC3    WFBGC3           LckBx Item Numb
     C                     MOVELWEO1TX    WFO1TX           LckBx Check Num
     C                     Z-ADDWELXDT    WFLXDT           LckBx Check Dat
     C                     Z-ADDWEZZVA    WFZZVA           LckBx Check Amo
     C                     Z-ADDWECWC7    WFCWC7           LckBx Customer
     C                     MOVELWEO2TX    WFO2TX           LckBx Customer
     C                     MOVELWEABSX    WFABSX           LckBx Invoice F
     C                     MOVELWEADSX    WFADSX           LckBx Hold Flag
      *
     C           KLCRSF    KLIST
     C                     KFLD           WFBEC3           LckBx Number
     C                     KFLD           WFLWDT           LckBx Deposit D
     C                     KFLD           WFYWNX           LckBx Deposit T
     C                     KFLD           WFBFC3           LckBx Batch Num
     C                     KFLD           WFBGC3           LckBx Item Numb
      * Check for duplicate primary key
     C           KLCRSF    SETLL@MCCPDV                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2651' W0RTN   7
      * Send message 'A/R Lockbox Check      EX'
     C                     MOVEL'USR2651' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@MCCPDV                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Check  DL - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MCCPTX
     C                     Z-ADDWEBEC3    WGBEC3           LckBx Number
     C                     Z-ADDWELWDT    WGLWDT           LckBx Deposit D
     C                     Z-ADDWEYWNX    WGYWNX           LckBx Deposit T
     C                     Z-ADDWEBFC3    WGBFC3           LckBx Batch Num
     C                     Z-ADDWEBGC3    WGBGC3           LckBx Item Numb
      *
     C           KLDLSG    KLIST
     C                     KFLD           WGBEC3           LckBx Number
     C                     KFLD           WGLWDT           LckBx Deposit D
     C                     KFLD           WGYWNX           LckBx Deposit T
     C                     KFLD           WGBFC3           LckBx Batch Num
     C                     KFLD           WGBGC3           LckBx Item Numb
     C           KLDLSG    CHAIN@MCCPTX              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMCCPL0'MDACP
     C                     MOVEL'@MCCPTX' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MCCPTX                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbx Batch  RT - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WHBEC3    WQSH01           LckBx Number
     C           *LIKE     DEFN WHLWDT    WQSH02           LckBx Deposit D
     C           *LIKE     DEFN WHYWNX    WQSH03           LckBx Deposit T
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           LckBx Number
     C                     KFLD           WQSH02           LckBx Deposit D
     C                     KFLD           WQSH03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWABEC3    WQSH01           LckBx Number
     C                     Z-ADDWALWDT    WQSH02           LckBx Deposit D
     C                     Z-ADDWAYWNX    WQSH03           LckBx Deposit T
      * Establish starting position
     C           KRSSH     SETLL@MBCPTV                    *
     C           KRSSH     READE@MBCPTV                  90*
      * Data record not found
     C   90                MOVEL'USR2648' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbx BtchPRG CR - A/R Lockbox Batch  * 
     C                     EXSR SICRRC
      * DLT A/R Lockbox Batch  DL - A/R Lockbox Batch  * 
     C                     EXSR SJDLRC
     C           KRSSH     READE@MBCPTV                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICRRC    BEGSR
      *================================================================
      * CRT A/R Lockbx BtchPRG CR - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MBCPDU
     C                     Z-ADDWHBEC3    WIBEC3           LckBx Number
     C                     Z-ADDWHLWDT    WILWDT           LckBx Deposit D
     C                     Z-ADDWHYWNX    WIYWNX           LckBx Deposit T
     C                     Z-ADDWHBFC3    WIBFC3           LckBx Batch Num
     C                     Z-ADDWHNMC0    WINMC0           LckBx Batch Nbr
     C                     Z-ADDWHZYVA    WIZYVA           LckBx Batch Amo
     C                     MOVELWHYWCD    WIYWCD           LckBx Location
      *
     C           KLCRSI    KLIST
     C                     KFLD           WIBEC3           LckBx Number
     C                     KFLD           WILWDT           LckBx Deposit D
     C                     KFLD           WIYWNX           LckBx Deposit T
     C                     KFLD           WIBFC3           LckBx Batch Num
      * Check for duplicate primary key
     C           KLCRSI    SETLL@MBCPDU                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2649' W0RTN   7
      * Send message 'A/R Lockbox Batch      EX'
     C                     MOVEL'USR2649' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C                     WRITE@MBCPDU                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Batch  DL - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MBCPTU
     C                     Z-ADDWHBEC3    WJBEC3           LckBx Number
     C                     Z-ADDWHLWDT    WJLWDT           LckBx Deposit D
     C                     Z-ADDWHYWNX    WJYWNX           LckBx Deposit T
     C                     Z-ADDWHBFC3    WJBFC3           LckBx Batch Num
      *
     C           KLDLSJ    KLIST
     C                     KFLD           WJBEC3           LckBx Number
     C                     KFLD           WJLWDT           LckBx Deposit D
     C                     KFLD           WJYWNX           LckBx Deposit T
     C                     KFLD           WJBFC3           LckBx Batch Num
     C           KLDLSJ    CHAIN@MBCPTU              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMBCPL0'MDACP
     C                     MOVEL'@MBCPTU' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MBCPTU                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Dpst   DL - A/R Lockbox Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MACPTR
     C                     Z-ADDWABEC3    WKBEC3           LckBx Number
     C                     Z-ADDWALWDT    WKLWDT           LckBx Deposit D
     C                     Z-ADDWAYWNX    WKYWNX           LckBx Deposit T
      *
     C           KLDLSK    KLIST
     C                     KFLD           WKBEC3           LckBx Number
     C                     KFLD           WKLWDT           LckBx Deposit D
     C                     KFLD           WKYWNX           LckBx Deposit T
     C           KLDLSK    CHAIN@MACPTR              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMACPL0'MDACP
     C                     MOVEL'@MACPTR' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MACPTR                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLCHRC    BEGSR
      *================================================================
      * CHG Lockbox Status     CH - A/R Lockbox Deposit  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0003  40       LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WN0004  40       LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WN0005 112       LckBx Deposit A
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @MACPTR
     C                     Z-ADDWABEC3    WKBEC3           LckBx Number
     C                     Z-ADDWALWDT    WKLWDT           LckBx Deposit D
     C                     Z-ADDWAYWNX    WKYWNX           LckBx Deposit T
      *
     C           KLCHSL    KLIST
     C                     KFLD           WKBEC3           LckBx Number
     C                     KFLD           WKLWDT           LckBx Deposit D
     C                     KFLD           WKYWNX           LckBx Deposit T
     C           KLCHSL    CHAIN@MACPTR              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMACPL0'MDACP
     C                     MOVEL'@MACPTR' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL005.
     C                     MOVEL'LBL005'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SLEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPDMA1    YARDCS
      * Move non-key fields to @MACPTR
     C                     MOVEL'X'       WKAWSX    P      LckBx Deposit S
      *
      * Set PGM.*Record Data Changed flag
     C           QPDMA1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@MACPTR                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDMACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Delete Lockbox Deposit.
      *================================================================
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAYWNX' defaulted for 'LckBx Deposit Time'.
      * RTV & DLT Lckbx Invoic RT - A/R Lockbox Invoice  * 
     C                     EXSR SBRVGN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAYWNX' defaulted for 'LckBx Deposit Time'.
      * RTV & DLT Lckbox Check RT - A/R Lockbox Check  * 
     C                     EXSR SERVGN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAYWNX' defaulted for 'LckBx Deposit Time'.
      * RTV & DLT Lckbx Batch  RT - A/R Lockbox Batch  * 
     C                     EXSR SHRVGN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAYWNX' defaulted for 'LckBx Deposit Time'.
      * DLT A/R Lockbox Dpst   DL - A/R Lockbox Deposit  * 
     C                     EXSR SKDLRC
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Purge Lockbox Deposit.
      *================================================================
      * CHG Lockbox Status     CH - A/R Lockbox Deposit  * 
     C                     EXSR SLCHRC
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         XCVFA     BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C           XDAY1     IFGT 109267
     C                     ADD  2         XDAY1
     C                     ELSE
     C           XDAY1     IFGT 36218
     C                     ADD  1         XDAY1
     C                     END
     C                     END
      * Full years (up to the date)
     C           XDAY1     DIV  365.25    XDWK1   80
     C                     MVR            XDWK3   71
     C                     Z-ADDXDWK1     XDINYY
     C           XDWK3     IFEQ 0
      * The date is the end of a year
     C                     Z-ADD12        XDINMM
     C                     Z-ADD31        XDINDD
     C                     ELSE
      * Year days up to the date
     C           XDWK1     MULT 365.25    XDWK2   60
     C                     SUB  XDWK2     XDAY1
     C                     ADD  1         XDINYY
      * Leap year ?
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
      * March 1 (relative day of the year)
     C           XDWK1     IFEQ 0
     C                     Z-ADD60        XDWK1
     C                     ELSE
     C                     Z-ADD59        XDWK1
     C                     END
      * Define date base month and offset day -
     C           XDAY1     IFLE XDWK1
      *  - January (thru February)
     C                     Z-ADD1         XDINMM
     C                     ELSE
     C                     SUB  XDWK1     XDAY1
     C           XDAY1     IFLE 153
      *  - March (thru July)
     C                     Z-ADD3         XDINMM
     C                     ELSE
      *  - August (thru December)
     C                     Z-ADD8         XDINMM
     C                     SUB  153       XDAY1
     C                     END
      * Calculate 2 month base and offset day
     C           XDAY1     SUB  1         XDWK1
     C                     DIV  61        XDWK1
     C                     MVR            XDAY1
     C                     ADD  1         XDAY1
     C                     MULT 2         XDWK1
     C                     ADD  XDWK1     XDINMM
     C                     END
      * Calculate date increment,
     C           XDAY1     IFGT 31
     C                     ADD  1         XDINMM
     C                     SUB  31        XDAY1
     C                     END
     C                     Z-ADDXDAY1     XDINDD
     C                     END
      *================================================================
     CSR         XCVFAE    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDADY     BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C           XDURR     IFEQ 0
     C           XDWSL     OREQ 0
      * None days of week selected
     C                     Z-ADDXDAY2     XDAY1
     C           XDURR     IFNE *ZERO
      * Return Code: Unable to increment date.
     C                     MOVEL'Y2U0059' W0RTN   7
     C                     ENDIF
     C                     GOTO XDADYE
     C                     ENDIF
     C           XDWSL     IFEQ 7
      * All days of week selected
     C           XDAY2     ADD  XDURR     XDAY1
     C                     GOTO XDADYM
     C                     ENDIF
      * Some days of week selected
     C           XDURR     IFGE 0
     C                     Z-ADD1         XDSTP   10
     C                     ELSE
     C                     Z-ADD-1        XDSTP
     C                     ENDIF
      * Get number of full weeks in the duration
     C           XDURR     DIV  XDWSL     XDWNB   60
      * Isolate the last week
     C                     MVR            XDLSW   10
     C           XDLSW     IFEQ 0
     C           XDWSL     MULT XDSTP     XDLSW
     C                     SUB  XDSTP     XDWNB
     C                     ENDIF
      * Increment the date by the full weeks
     C           XDWNB     MULT 7         XDWK1   80
     C           XDAY2     ADD  XDWK1     XDAY1   60
      * Determine day of week of the beginning date
     C           XDAY2     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ENDIF
      * Loop: Increment the date by the last week
     C           XDLSW     DOWNE0
      * Increment the date
     C                     ADD  XDSTP     XDAY1
      * Increment the day of week
     C                     ADD  XDSTP     YY
      * Put day of week into the range 1-7
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ELSE
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     ELSE
     C           YY        IFEQ -1
     C                     Z-ADD6         YY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           YDOW,YY   IFEQ XDSEL
      * Selected day of the last week has been processed
     C                     SUB  XDSTP     XDLSW
     C                     ENDIF
      * End of loop
     C                     ENDDO
     C           XDADYM    TAG
     C           XDINDD    IFLT 1
     C                     Z-ADD1         XDINDD
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         XDADYE    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABEC3           LckBx Number
     C                     Z-ADD*ZERO     WALWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WAYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WANMC1           LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WANMC2           LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WAZXVA           LckBx Deposit A
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBBEC3           LckBx Number
     C                     Z-ADD*ZERO     WBLWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WBYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WBBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WBBGC3           LckBx Item Numb
     C                     Z-ADD*ZERO     WBNMC5           LckBx Seq Numbe
     C                     Z-ADD*ZERO     WBNMC4           LckBx Seq Count
     C                     Z-ADD*ZERO     WBNMC3           LckBx Invoice N
     C                     Z-ADD*ZERO     WBZ0VA           LckBx Invoice A
     C                     Z-ADD*ZERO     WBAIC3           Company Number
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEBEC3           LckBx Number
     C                     Z-ADD*ZERO     WELWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WEYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WEBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WEBGC3           LckBx Item Numb
     C                     Z-ADD*ZERO     WELXDT           LckBx Check Dat
     C                     Z-ADD*ZERO     WEZZVA           LckBx Check Amo
     C                     Z-ADD*ZERO     WECWC7           LckBx Customer
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WHBEC3           LckBx Number
     C                     Z-ADD*ZERO     WHLWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WHYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WHBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WHNMC0           LckBx Batch Nbr
     C                     Z-ADD*ZERO     WHZYVA           LckBx Batch Amo
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
