// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDVLXFR
// ?Date: 14.08.2025 Time: 03:36:16
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(UPD Ld w/ Ship Sts/STC RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1564114;
PARAMETER(PAR.Load_ID);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Rtv Sum Ld Abs.Frt/Wgt RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1294689;
 PARAMETER(DB1.Load_ID);
 PARAMETER(WRK.Total_Freight);
 PARAMETER(PAR.Total_Load_Order_Weight);
 {
  //?USER: Initialize routine

  //?05/14/04 SLM PKTR01 Multi-Company - Funct chg remove Company RST or Pos
  // PAR.Total Freight = CON.*ZERO
  PAR.Total_Freight = *ZERO;

  // PAR.Weight Scheduled = CON.*ZERO
  PAR.Weight_Scheduled = *ZERO;

  //?USER: Process Data record

  // PAR.USR Percent Work, 7.4   1 = DB1.Freight Rate / CON.100 *Rounded
  PAR.USR_Percent_Work_7_4_1 = DB1.Absorbed_Freight_Rate_CWT / 100 'H';

  // PAR.Freight Amount = DB1.Order Weight Total * PAR.USR Percent Work, 7.4   1 *Rou
  PAR.Freight_Amount = DB1.Order_Weight_Total * PAR.USR_Percent_Work_7_4_1 'H';

  // PAR.Total Freight = PAR.Total Freight + PAR.Freight Amount
  PAR.Total_Freight = PAR.Total_Freight + PAR.Freight_Amount;

  // PAR.Weight Scheduled = PAR.Weight Scheduled + DB1.Order Weight Total
  PAR.Weight_Scheduled = PAR.Weight_Scheduled + DB1.Order_Weight_Total;

 }

 EXECUTE FUNCTION(RTV All Ords Shipped?  RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1366564;
 PARAMETER(DB1.Load_ID);
 PARAMETER(PAR.Status_Y_or_N);
 {
  //?USER: Initialize routine

  // PAR.Status - Y or N = CND.yes
  PAR.Status_Y_or_N = 'Y';

  //?USER: Process Data record

  //?Assume all orders are shipped, unless find one that isn't
  EXECUTE FUNCTION(RTV Order Status       RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1131568;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(PAR.Header_Status);
  PARAMETER(WRK.TXT_field_not_needed);
  {
   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF PAR.Header Status is Conf/Comp/Canc
  IF PAR.Header_Status = 'X'/'C'/'R';

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Status - Y or N = CND.no
  PAR.Status_Y_or_N = 'N';

  QUIT;

  ENDIF;

 }

 CASE;

 // IF PAR.Status - Y or N is yes
 IF PAR.Status_Y_or_N = 'Y';

 CASE;

 // IF DB1.Shipping Method is Prepaid
 IF DB1.Shipping_Method = 'PR'/'PT';

 // Call program UPD Rated Frt Post Shp XF.
 CALL PROGRAM(UPD Rated Frt Post Shp XF) ('PDJVXFR');
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Company_Number);

 ENDIF;

 EXECUTE FUNCTION(Chg Sts/Weights        CH) TYPE(CHGOBJ) FILE(OMFJCPP)          AC1564115;
 PARAMETER(DB1.Load_ID);
 PARAMETER('S');
 PARAMETER(PAR.Total_Load_Order_Weight);
 PARAMETER(PAR.Total_Load_Order_Weight);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 EXECUTE FUNCTION(Chg Sts/Weights        CH) TYPE(CHGOBJ) FILE(OMFJCPP)          AC1564115;
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Load_Status);
 PARAMETER(PAR.Total_Load_Order_Weight);
 PARAMETER(PAR.Total_Load_Order_Weight);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


