// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLSFXFR
// ?Date: 14.08.2025 Time: 02:55:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//?Program recompiled.  There was a parameter mismatch when calling
//?program PLSGXFR.
//?11/04/2020 ISE H16853 - Recompiled due to change in Buy Order Number
ENDDO;

// WRK.DSU Company Number = PAR.CC Company Number
WRK.DSU_Company_Number = PAR.CC_Company_Number;

//?Information on Parms
DO;

//?10/27/2017 Adjustment to move this thru the OTC Project
//?3/21/2014 Special note here with the MTech Live there will
//?be no delivery sched split transastion placed in the Dlv Sched Upl
//?Validate Only No Update = Y will flag the UPL with error
//?and the process flag  will be change to 2 for Error record
//?all other good records will not be processed so these
//?records will stay with the process = 0 due to no update occurred
//?the good records will not be allowed to perform Update to DSD
//?or to the DSS (splits)
//?Validate Only No Update = blanks or N will validate the upl
//?with any errors and process flag will be marked as 2 for error
//?if there are no errors the delivery schedule and
//?the dss (splits) will be updated
//?Read the Delivery Schedule Detail Upl by Company
ENDDO;

EXECUTE FUNCTION(Rtv PRD Serv Rcds     RT) TYPE(RTVOBJ) FILE(PLBJCPP)           AB1311400;
PARAMETER(WRK.DSU_Company_Number);
PARAMETER(PAR.Validate_Only_No_Update);
PARAMETER(PAR.Process_Upload_Inf);
{
 //?USER: Initialize routine

 //?This process will not need the MTech flag.
 //?USER: Process Data record

 // WRK.DSU Process Status = DB1.DSU Process Status
 WRK.DSU_Process_Status = DB1.DSU_Process_Status;

 // WRK.DSU Error Reason = WRK.Blank USR
 WRK.DSU_Error_Reason = WRK.Blank_USR;

 // Call program Zzz DspUpl PrdSer     XP.
 CALL PROGRAM(Zzz DspUpl PrdSer     XP) ('PLSGXFR');
 PARAMETER(DB1.DSU_Company_Number);
 PARAMETER(DB1.DSU_Transaction_Date);
 PARAMETER(DB1.DSU_Transaction_Time);
 PARAMETER(DB1.DSU_Transaction_Seq);
 PARAMETER(DB1.DSU_Kill_Date);
 PARAMETER(DB1.DSU_Delivery_Date);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.DSU_Record_Status);
 PARAMETER(WRK.DSU_Process_Status);
 PARAMETER(WRK.DSU_Error_Reason);
 PARAMETER('Y');
 PARAMETER('Y');
 PARAMETER('Y');
 PARAMETER(PAR.Process_Upload_Inf);

 CASE;

 // IF PAR.Process Upload Inf is Delv Sch Batch
 IF PAR.Process_Upload_Inf = 'B';

 //?Update process
 EXECUTE FUNCTION(Chg Process/Err-No PS CH) TYPE(CHGOBJ) FILE(PLBJCPP)           AB1345215;
 PARAMETER(DB1.DSU_Company_Number);
 PARAMETER(DB1.DSU_Transaction_Date);
 PARAMETER(DB1.DSU_Transaction_Time);
 PARAMETER(DB1.DSU_Transaction_Seq);
 PARAMETER(DB1.DSU_Split_Sequence);
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.DSU_PRD_Srv_Batch_ID);
 PARAMETER(DB1.DSU_PRD_Srv_Sched_ID);
 PARAMETER(DB1.DSU_Ref_1);
 PARAMETER(DB1.DSU_Ref_2);
 PARAMETER(DB1.DSU_Ref_Status);
 PARAMETER(WRK.DSU_Process_Status);
 PARAMETER(WRK.DSU_Error_Reason);
 {
  //?USER: Processing before Data update

  // DB1.DSU Change Date = JOB.*Job date
  DB1.DSU_Change_Date = JOB.*Job_date;

  // DB1.DSU Change Time = JOB.*Job time
  DB1.DSU_Change_Time = JOB.*Job_time;

 }

 ENDIF;

}


//?Now read all that is ready for the Buy Order Loads to be created
//?by date and break.  A day should have the same buy order
//?but with different load numbers
//?remove build the data for the email
//?make sure that the buy order load is appearing on the input
CASE;

// IF PAR.Process Upload Inf is Delv Sch Batch
IF PAR.Process_Upload_Inf = 'B';

//?Only created the Buy Order duing the Batch process
// Call program Zzz PRD Serv RcdsCrtBOXF.
CALL PROGRAM(Zzz PRD Serv RcdsCrtBOXF) ('PLXBXFR');
PARAMETER(WRK.DSU_Company_Number);

ENDIF;

