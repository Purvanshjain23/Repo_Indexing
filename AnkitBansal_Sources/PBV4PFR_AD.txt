// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBV4PFR
// ?Date: 14.08.2025 Time: 12:03:33
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?W113879 DN 11/14/22-Get Live with PHIS Flag.
EXECUTE FUNCTION(Rtv Live with PHIS    RT) TYPE(RTVOBJ) FILE(PDMMREP)           AC2160999;
PARAMETER(PAR.Company_Number);
PARAMETER('A');
PARAMETER(PAR.Country_Code);
PARAMETER(LCL.ED_Live_with_PHIS);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Print required level headings

CASE;

IF NEW Company_Number;
CASE;

// IF DB1.ED Document Date is Not entered
IF DB1.ED_Document_Date = *ZERO;

// LCL.Date                  USR = JOB.*Job date
LCL.Date_USR = JOB.*Job_date;

// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Date                  USR = DB1.ED Document Date
LCL.Date_USR = DB1.ED_Document_Date;

ENDIF;

// WRK.Date (Alpha) USR = CVTVAR(LCL.Date                  USR)
WRK.Date_Alpha_USR = CVTVAR(LCL.Date_USR);

// WRK.Month/Day Alpha MMDD = SUBSTRING(WRK.Date (Alpha) USR,CON.4,CON.4)
WRK.Month_Day_Alpha_MMDD = SUBSTRING(WRK.Date_Alpha_USR:4:4);

// WRK.Year  (Char) USR = SUBSTRING(WRK.Date (Alpha) USR,CON.2,CON.2)
WRK.Year_Char_USR = SUBSTRING(WRK.Date_Alpha_USR:2:2);

// WRK.Year Alpha (YYYY) USR = CONCAT(CON.20,WRK.Year  (Char) USR,CON.*ZERO)
WRK.Year_Alpha_YYYY_USR = '20' + WRK.Year_Char_USR (*ZERO);

// WRK.Date (Char-8) USR = CONCAT(WRK.Month/Day Alpha MMDD,WRK.Year Alpha (YYYY) USR,CON.*ZERO)
WRK.Date_Char_8_USR = WRK.Month_Day_Alpha_MMDD + WRK.Year_Alpha_YYYY_USR (*ZERO);

// CUR.Date 8.0 USR = CVTVAR(WRK.Date (Char-8) USR)
CUR.Date_8_0_USR = CVTVAR(WRK.Date_Char_8_USR);

//?W113879 DN 11/14/22-Display Leading Zeros for Certificate #.
// CUR.ED Export Certif Nbr Txt = CVTVAR(DB1.ED Export Certificate Nbr)
CUR.ED_Export_Certif_Nbr_Txt = CVTVAR(DB1.ED_Export_Certificate_Nbr);

//?I015218 DN 03/08/24-Suppress Leading Zero for Certificate #.
// Call program Exc TrimL Certificate# XF.
CALL PROGRAM(Exc TrimL Certificate# XF) ('PVD4XFR');
PARAMETER(CUR.ED_Export_Certif_Nbr_Txt);

// CUR.Order Number = CON.*ZERO
CUR.Order_Number = *ZERO;

//?E00421 RMC 05/26/09 get form letters from company value - copy from JPN
//?W114608 DN 12/23/22-Commented Out & Move Below.
//?I015218 DN 03/08/24-Override 'ED USDA Cert Nbr US' using DB1 Context.
//?- Commented out existing logic below.
// CUR.ED USDA Cert Nbr US = DB1.ED USDA Cert Nbr US
CUR.ED_USDA_Cert_Nbr_US = DB1.ED_USDA_Cert_Nbr_US;

// Print Company Number header format
PRINT Company Number header format;

ENDIF;

// SUPPRESSED PRINT Order Number header format

// SUPPRESSED PRINT ED Export Document Type header format

//?USER: Print required level totals

// SUPPRESSED PRINT ED Export Document Type totals format

// SUPPRESSED PRINT Order Number totals format

CASE;

IF NEW Company_Number;
//?I011635 DN 01/25/24-Commented Out & Moved Below to Print Title of Official
//?I011635 DN 01/25/24-Print Title of Official if DocType=L.
CASE;

// IF CUR.ED Export Document Type is Letterhead-Pork to Export
IF CUR.ED_Export_Document_Type = 'L';

// CUR.Text USR 23 = CUR.ED Title of Official
CUR.Text_USR_23 = CUR.ED_Title_of_Official;

// CUR.Text USR 9 = CUR.ED Area Office
CUR.Text_USR_9 = CUR.ED_Area_Office;

// CUR.ED Title of Official = CON.*BLANK
CUR.ED_Title_of_Official = *BLANK;

// CUR.ED Area Office = CON.*BLANK
CUR.ED_Area_Office = *BLANK;

ENDIF;

// Print Company Number totals format
PRINT Company Number totals format;

ENDIF;

