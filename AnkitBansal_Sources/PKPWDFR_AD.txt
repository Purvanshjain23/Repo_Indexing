// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKPWDFR
// ?Date: 14.08.2025 Time: 02:52:26
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


// WRK.Confirmed Intr Msg Usr 1 = CONCAT(CON.This load has been weighe,CON.d on the livescale.,CON.*
WRK.Confirmed_Intr_Msg_Usr_1 = 'This load has been weighe' + 'd on the livescale.' (0);

// WRK.Confirmed Intr Msg Usr 2 = CONCAT(CON.Do you want to spread the,CON.truck weights?,CON.1)
WRK.Confirmed_Intr_Msg_Usr_2 = 'Do you want to spread the' + 'truck weights?' (1);

// WRK.Confirmed Intr Msg Usr 3 = CON.*BLANK
WRK.Confirmed_Intr_Msg_Usr_3 = *BLANK;

//?E2423 Mtech Live or Not Live *** Interfaces to HPS ***
//?Get the MTech Live Yes or No
DO;

//?Mtech Live Yes or no
// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER('MTECHLIVE');
PARAMETER(WRK.System_Value_Alpha_USR);

// LCL.MTech Live Yes or No = WRK.System Value Alpha    USR
LCL.MTech_Live_Yes_or_No = WRK.System_Value_Alpha_USR;

ENDDO;

//?H16853 ISE 01/23/21 - Increased the length from 5 to 7 and corrected the
//?                      alignment of Buy Order Number field.
//?USER: Initialize subfile control

EXECUTE FUNCTION(Val Company Number    IF) TYPE(EXCINTFUN)                      AB1129077;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.Name_USR);
PARAMETER(WRK.Invalid_Y_N_USR);
{
 //?Execute internal function

 // Call program Val Company Number    XF.
 CALL PROGRAM(Val Company Number    XF) ('PDGZXFR');
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(PAR.Oms_Name);
 PARAMETER(WRK.Invalid_Y_N_USR);

 CASE;

 // IF WRK.Invalid Y/N USR is Yes
 IF WRK.Invalid_Y_N_USR = 'Y';

 // Send error message - 'Invalid Company Number'
 ERROR(PRK0299);
 MSGPARM(PAR.CC_Company_Number);

 ENDIF;

 // PAR.Invalid Y/N USR = WRK.Invalid Y/N USR
 PAR.Invalid_Y_N_USR = WRK.Invalid_Y_N_USR;

}


EXECUTE FUNCTION(Name Producer DRV) TYPE(DRVFLD)                                AB1110026;
PARAMETER(CTL.Name_Producer_DRV);
PARAMETER(CTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Name_Producer_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


EXECUTE FUNCTION(Name Producer Loc DRV) TYPE(DRVFLD)                            AB1110027;
PARAMETER(CTL.Name_Producer_Loc_DRV);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PL_Location_Code);
 PARAMETER(PAR.Name_Producer_Loc_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


// CTL.BOH Buy Order Number = PAR.BOH Buy Order Number
CTL.BOH_Buy_Order_Number = PAR.BOH_Buy_Order_Number;

// CTL.BOL Load Number = PAR.BOL Load Number
CTL.BOL_Load_Number = PAR.BOL_Load_Number;

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.#Num_USR);
PARAMETER(CTL.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// CTL.Condition Name USR = Condition name of CTL.BOL Truck Scale Weigh Sts
CTL.Condition_Name_USR = RTVCND(CTL.BOL_Truck_Scale_Weigh_Sts);

//?Get kill date
EXECUTE FUNCTION(Rtv TH Ref & Reclc Wt RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1257131;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(LCL.TH_Kill_Date);
PARAMETER(WRK.TH_Group_Reference);
PARAMETER(WRK.TH_HPS_Movement_Ref_#);
PARAMETER(WRK.State);
PARAMETER(CTL.Text_5_USR);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 // LCL.First Time Flag Usr = CND.Yes
 LCL.First_Time_Flag_Usr = 'Y';

 // LCL.Count USR = CON.*ZERO
 LCL.Count_USR = *ZERO;

 // LCL.Count USR 2 = CON.*ZERO
 LCL.Count_USR_2 = *ZERO;

 //?USER: Process Data record

 CASE;

 // IF LCL.First Time Flag Usr is Yes
 IF LCL.First_Time_Flag_Usr = 'Y';

 MOVE *ALL (To: PAR From: DB1);

 // LCL.First Time Flag Usr = CND.No
 LCL.First_Time_Flag_Usr = 'N';

 ENDIF;

 CASE;

 // IF DB1.TH Hog Class Type is Market
 IF DB1.TH_Hog_Class_Type = 'M';

 CASE;

 // IF DB1.TH Recalc Live Wgt is EQ 1
 IF DB1.TH_Recalc_Live_Wgt = 1;

 // LCL.Count USR = LCL.Count USR + CON.1
 LCL.Count_USR = LCL.Count_USR + 1;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Count USR 2 = LCL.Count USR 2 + CON.1
 LCL.Count_USR_2 = LCL.Count_USR_2 + 1;

 ENDIF;

 ENDIF;

 //?USER: Exit processing

 CASE;

 // IF LCL.Count USR is GT Zero
 IF LCL.Count_USR > *ZERO;

 // AND LCL.Count USR 2 is Entered
 AND LCL.Count_USR_2 <> *ZERO;

 // PAR.Text 5                USR = CON.MIXED
 PAR.Text_5_USR = 'MIXED';

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF LCL.Count USR is GT Zero
 IF LCL.Count_USR > *ZERO;

 // PAR.Text 5                USR = CON.YES
 PAR.Text_5_USR = 'YES';

 // IF LCL.Count USR 2 is Entered
 IF LCL.Count_USR_2 <> *ZERO;

 // PAR.Text 5                USR = CON.NO
 PAR.Text_5_USR = 'NO';

 ENDIF;

 ENDIF;

}


//?* 01/27/03 PKD PK0495 Replaced HP255 with HP249.
CASE;

// IF LCL.MTech Live Yes or No is No MTech not Live
IF LCL.MTech_Live_Yes_or_No = 'N';

// Call program Z1v HPS Farm Info     UP.
CALL PROGRAM(Z1v HPS Farm Info     UP) ('HP249');
PARAMETER(PGM.*Return_code);
PARAMETER(WRK.TH_HPS_Movement_Ref_#);
PARAMETER(WRK.Farm_site_Name_f_HPS_USR);
PARAMETER(WRK.Farm_Site_USR);
PARAMETER(WRK.HPS_FS_Comp_Relation_USR);
PARAMETER(WRK.State);

// IF LCL.MTech Live Yes or No is Yes MTech is Live
IF LCL.MTech_Live_Yes_or_No = 'Y';

//?Get the Farm Site
EXECUTE FUNCTION(Rtv Farm Site Only    RT) TYPE(RTVOBJ) FILE(PLAFCPP)           AB1313312;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(LCL.TH_Kill_Date);
PARAMETER(WRK.Farm_Site_USR);

//?Get the Farm Site Information
// Call program Rtv HPS Farm Inf-Mtech UP.
CALL PROGRAM(Rtv HPS Farm Inf-Mtech UP) ('HP293');
PARAMETER(PGM.*Return_code);
PARAMETER(WRK.Farm_site_Name_f_HPS_USR);
PARAMETER(WRK.Farm_Site_USR);
PARAMETER(WRK.HPS_FS_Comp_Relation_USR);
PARAMETER(WRK.State);
PARAMETER(WRK.HPS_Farm_County);
PARAMETER(WRK.HPS_Cell_Manager_Code_USR);
PARAMETER(WRK.HPS_Cell_Manager_Nm_USR);
PARAMETER(NLL.MTech_Farm_Site_Ref);
PARAMETER(NLL.MTech_Cell_Manager_Ref);

ENDIF;

CASE;

// IF WRK.HPS FS Comp Relation USR is Contract
IF WRK.HPS_FS_Comp_Relation_USR = 'CON';

// CTL.Text 25 1 USR = CON.Contract Grower
CTL.Text_25_1_USR = 'Contract Grower';

// IF *OTHERWISE
IF *OTHERWISE;

// CTL.Text 25 1 USR = CON.*BLANK
CTL.Text_25_1_USR = *BLANK;

ENDIF;

//?Change Movement to Output if entered previously.
CASE;

// IF CTL.BOLW Movement Number EQ WRK.Zero USR
IF CTL.BOLW_Movement_Number = WRK.Zero_USR;

// WRK.@Status (*YES/*NO ) = CND.*No
WRK.@Status_YES_NO = *NO;

//?Change Movement to Output if entered previously.
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.@Status (*YES/*NO ) = CND.*Yes
WRK.@Status_YES_NO = *YES;

ENDIF;

// WRK.BOL IN  record found  USR = CND.No
WRK.BOL_IN_record_found_USR = 'N';

// WRK.BOL OUT record found  USR = CND.No
WRK.BOL_OUT_record_found_USR = 'N';

// PAR.Weight 7.1 1 USR = CON.*ZERO
PAR.Weight_7_1_1_USR = *ZERO;

// PAR.Weight 7.1 2 USR = CON.*ZERO
PAR.Weight_7_1_2_USR = *ZERO;

//?USER: Initialize subfile record from DBF record

// RCD.Text 10 2 USR = Condition name of RCD.BOLW Weight Type
RCD.Text_10_2_USR = RTVCND(RCD.BOLW_Weight_Type);

// RCD.Text 10 1 USR = Condition name of RCD.BOLW Spread Status
RCD.Text_10_1_USR = RTVCND(RCD.BOLW_Spread_Status);

//?IN
CASE;

// IF RCD.BOLW Weight Type is *In
IF RCD.BOLW_Weight_Type = 'I';

// WRK.BOL IN  record found  USR = CND.Yes
WRK.BOL_IN_record_found_USR = 'Y';

// PAR.Weight 7.1 1 USR = RCD.BOLW Scale Weight
PAR.Weight_7_1_1_USR = RCD.BOLW_Scale_Weight;

ENDIF;

//?OUT
CASE;

// IF RCD.BOLW Weight Type is *Out
IF RCD.BOLW_Weight_Type = 'O';

// WRK.BOL OUT record found  USR = CND.Yes
WRK.BOL_OUT_record_found_USR = 'Y';

// PAR.Weight 7.1 2 USR = RCD.BOLW Scale Weight
PAR.Weight_7_1_2_USR = RCD.BOLW_Scale_Weight;

ENDIF;

CASE;

// IF PAR.Weight 7.1 2 USR GE PAR.Weight 7.1 1 USR
IF PAR.Weight_7_1_2_USR >= PAR.Weight_7_1_1_USR;

// CTL.Condition Name 1 USR = CON.Out Weight > In Weight
CTL.Condition_Name_1_USR = 'Out Weight > In Weight';

// IF *OTHERWISE
IF *OTHERWISE;

// CTL.Condition Name 1 USR = CON.*BLANK
CTL.Condition_Name_1_USR = *BLANK;

ENDIF;

//?USER: Process subfile control (Pre-confirm)

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?F5=Refresh
CASE;

// IF CTL.*CMD key is CF05
IF CTL.*CMD_key = '05';

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F6=Create
CASE;

// IF CTL.*CMD key is CF06
IF CTL.*CMD_key = '06';

CASE;

// IF WRK.BOL IN  record found  USR is Yes
IF WRK.BOL_IN_record_found_USR = 'Y';

// AND WRK.BOL OUT record found  USR is Yes
AND WRK.BOL_OUT_record_found_USR = 'Y';

// Send error message - 'Create invalid. In and Out records exist.'
ERROR(PRK0849);

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Head_Received);
PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF CTL.BOLW Movement Number EQ WRK.Zero USR
IF CTL.BOLW_Movement_Number = WRK.Zero_USR;

// Send error message - 'Movement # is required for creating records.'
ERROR(PRK0850);
MSGPARM(CTL.BOLW_Movement_Number);

// IF *OTHERWISE
IF *OTHERWISE;

//?Set In/Out Weight Type
CASE;

// IF WRK.BOL IN  record found  USR is No
IF WRK.BOL_IN_record_found_USR = 'N';

// WRK.BOLW Weight Type = CND.*In
WRK.BOLW_Weight_Type = 'I';

//?Set In/Out Weight Type
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.BOLW Weight Type = CND.*Out
WRK.BOLW_Weight_Type = 'O';

ENDIF;

//?Validate Movement Number
CASE;

// IF WRK.BOLW Weight Type is *In
IF WRK.BOLW_Weight_Type = 'I';

//?Validate Movement on Not Live ,NO Valdation with Live with Mtech ???
CASE;

// IF CTL.PD Producer Code is SEABOA
IF CTL.PD_Producer_Code = 'SEABOA';

// AND LCL.MTech Live Yes or No is No MTech not Live
AND LCL.MTech_Live_Yes_or_No = 'N';

// Call program Z1l HPS Movement Rfrn UP.
CALL PROGRAM(Z1l HPS Movement Rfrn UP) ('HP251');
PARAMETER(WRK.Return_Code_USR);
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(WRK.Scheduled_Kill_Dt_8_0_USR);
PARAMETER(LCL.Scheduled_Head_USR);

//?Movement not found in the HPS System.
CASE;

// IF WRK.Return Code USR is HPS Movement Rfrnc Err 1
IF WRK.Return_Code_USR = 'HPSM1';

// WRK.Weight Type Desc USR = Condition name of WRK.BOLW Weight Type
WRK.Weight_Type_Desc_USR = RTVCND(WRK.BOLW_Weight_Type);

// Send error message - '100 This Movement # is not valid.  Este movimiento # es inválido.'
ERROR(PRK0845);
MSGPARM(CTL.BOLW_Movement_Number);
MSGPARM(WRK.Weight_Type_Desc_USR);

QUIT;

ENDIF;

//?------------------
//?Validate Movement on Not Live ,NO Valdation with Live with Mtech ???
// IF CTL.PD Producer Code is SEABOA
IF CTL.PD_Producer_Code = 'SEABOA';

// AND LCL.MTech Live Yes or No is Yes MTech is Live
AND LCL.MTech_Live_Yes_or_No = 'Y';

//?*** No validation will be done on Movement number
ENDIF;

ENDIF;

// Call program Edt Buy Order Load Wt ER.
CALL PROGRAM(Edt Buy Order Load Wt ER) ('PKPXE1R');
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(WRK.BOLW_Weight_Type);
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

ENDIF;

ENDIF;

//?F8=Recalc Live Weight
CASE;

// IF CTL.*CMD key is CF08
IF CTL.*CMD_key = '08';

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Head_Received);
PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PAR.BOL Truck Scale Weigh Sts is Spread
IF PAR.BOL_Truck_Scale_Weigh_Sts = 'S';

// WRK.Text 10 3 USR = Condition name of PAR.BOL Truck Scale Weigh Sts
WRK.Text_10_3_USR = RTVCND(PAR.BOL_Truck_Scale_Weigh_Sts);

// Send error message - 'F8 not valid. Buy Order Weigh Status is &1'
ERROR(PRK0846);
MSGPARM(WRK.Text_10_3_USR);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Dsp Int Recalc Live   DF.
CALL PROGRAM(Dsp Int Recalc Live   DF) ('PKPTDFR');
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);

ENDIF;

ENDIF;

//?F10=No Spread
CASE;

// IF CTL.*CMD key is CF10
IF CTL.*CMD_key = '10';

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Head_Received);
PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PAR.BOL Truck Scale Weigh Sts is No Spread
IF PAR.BOL_Truck_Scale_Weigh_Sts = 'N';

// OR PAR.BOL Truck Scale Weigh Sts is Spread
OR PAR.BOL_Truck_Scale_Weigh_Sts = 'S';

// WRK.Text 10 3 USR = Condition name of PAR.BOL Truck Scale Weigh Sts
WRK.Text_10_3_USR = RTVCND(PAR.BOL_Truck_Scale_Weigh_Sts);

// Send error message - 'F10 not valid. Buy Order Weigh Status is &1.'
ERROR(PRK0854);
MSGPARM(WRK.Text_10_3_USR);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Pmt Set Sts No Spread PV.
CALL PROGRAM(Pmt Set Sts No Spread PV) ('PKPVPVR');
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_IN_record_found_USR);
PARAMETER(WRK.BOL_OUT_record_found_USR);
PARAMETER(WRK.HPS_FS_Comp_Relation_USR);

//?12/12/02 PK0495 Call Edit tracking here.
//?New parm do not need the arrival process to occur here at all
// Call program Edt Delivery Tracking XF.
CALL PROGRAM(Edt Delivery Tracking XF) ('PLA0XFR');
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER('Y');
PARAMETER(*BLANK);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

ENDIF;

//?F18=Spread Weight
CASE;

// IF CTL.*CMD key is CF18
IF CTL.*CMD_key = '18';

CASE;

// IF PAR.Weight 7.1 2 USR GE PAR.Weight 7.1 1 USR
IF PAR.Weight_7_1_2_USR >= PAR.Weight_7_1_1_USR;

// Send error message - 'Spread Invalid.  The OUT Weight is more than the IN Weight.'
ERROR(PRK0873);

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(Vry Tattoo SclTickBol) TYPE(RTVOBJ) FILE(PKB3CPP)              AB1308411;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
{
 //?USER: Initialize routine

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 QUIT;

 //?USER: Process Data record

 EXECUTE FUNCTION(Rtv PayTyp/Src Hc     Rt) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1177466;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(WRK.TH_Source_Type);
 PARAMETER(WRK.TH_Payment_Type);
 PARAMETER(WRK.TH_Hog_Class_Type);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF WRK.TH Hog Class Type is Market
 IF WRK.TH_Hog_Class_Type = 'M';

 CASE;

 // IF DB1.TST Record Created Status is PC Uploaded Record
 IF DB1.TST_Record_Created_Status = 'P';

 //?A pc upload weightment found show confirm
 //?screen on spread of bolw
 //?only to allow the user to confirm to spread or not to spread
 // PGM.*Return code = CND.Record Found
 PGM.*Return_code = 999;

 ENDIF;

 ENDIF;

}


CASE;

// IF PGM.*Return code is Record Found
IF PGM.*Return_code = '999';

//?If a Market hog with PC UPLOAD records issue confirm screen
//?Send another confirm before user does auto update
DO;

//?Send a confirmed screen for the user to select this
//?process even if the user selected f18
// WRK.Confirmed Intr Usr = CND.Do not confirm
WRK.Confirmed_Intr_Usr = 'N';

// Call program Pmt Confirm Prompt    XF.
CALL PROGRAM(Pmt Confirm Prompt    XF) ('PMS6PVR');
PARAMETER(WRK.Confirmed_Intr_Usr);
PARAMETER(WRK.Confirmed_Intr_Msg_Usr_1);
PARAMETER(WRK.Confirmed_Intr_Msg_Usr_2);
PARAMETER(WRK.Confirmed_Intr_Msg_Usr_3);

ENDDO;

CASE;

// IF WRK.Confirmed Intr Usr is Confirm
IF WRK.Confirmed_Intr_Usr = 'Y';

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Head_Received);
PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Spread
CASE;

// IF PAR.BOL Truck Scale Weigh Sts is Spread
IF PAR.BOL_Truck_Scale_Weigh_Sts = 'S';

// OR PAR.BOL Truck Scale Weigh Sts is Respread
OR PAR.BOL_Truck_Scale_Weigh_Sts = 'R';

// OR PAR.BOL Truck Scale Weigh Sts is Out
OR PAR.BOL_Truck_Scale_Weigh_Sts = 'O';

CASE;

// IF WRK.BOL Head Received is Equals 0
IF WRK.BOL_Head_Received = *ZERO;

// Send error message - 'Weight cannot be spread. Buy Order Head is 0.'
ERROR(PRK0857);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Exc Spread BOL Wt     XF.
CALL PROGRAM(Exc Spread BOL Wt     XF) ('PKPZXFR');
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOLW_Movement_Number);

//?12/12/02 PK0495 Call Edit tracking here.
//?slm 8/3/2011
//?do not have the arrival process be performed here
// Call program Edt Delivery Tracking XF.
CALL PROGRAM(Edt Delivery Tracking XF) ('PLA0XFR');
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER('Y');
PARAMETER(*BLANK);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// Send information message - 'Buy Order Load Weight has been spread.'
MESSAGE(PRK0856 *INFO);

ENDIF;

//?Spread
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Text 10 3 USR = Condition name of PAR.BOL Truck Scale Weigh Sts
WRK.Text_10_3_USR = RTVCND(PAR.BOL_Truck_Scale_Weigh_Sts);

// Send error message - 'F18 not valid. Buy Order Weigh Status is &1'
ERROR(PRK0847);
MSGPARM(WRK.Text_10_3_USR);

ENDIF;

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(Rtv BOL Truck Wgh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214496;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Head_Received);
PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Spread
CASE;

// IF PAR.BOL Truck Scale Weigh Sts is Spread
IF PAR.BOL_Truck_Scale_Weigh_Sts = 'S';

// OR PAR.BOL Truck Scale Weigh Sts is Respread
OR PAR.BOL_Truck_Scale_Weigh_Sts = 'R';

// OR PAR.BOL Truck Scale Weigh Sts is Out
OR PAR.BOL_Truck_Scale_Weigh_Sts = 'O';

CASE;

// IF WRK.BOL Head Received is Equals 0
IF WRK.BOL_Head_Received = *ZERO;

// Send error message - 'Weight cannot be spread. Buy Order Head is 0.'
ERROR(PRK0857);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Exc Spread BOL Wt     XF.
CALL PROGRAM(Exc Spread BOL Wt     XF) ('PKPZXFR');
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOLW_Movement_Number);

//?12/12/02 PK0495 Call Edit tracking here.
//?slm 8/3/2011
//?do not have the arrival process be performed here
// Call program Edt Delivery Tracking XF.
CALL PROGRAM(Edt Delivery Tracking XF) ('PLA0XFR');
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER('Y');
PARAMETER(*BLANK);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// Send information message - 'Buy Order Load Weight has been spread.'
MESSAGE(PRK0856 *INFO);

ENDIF;

//?Spread
// IF *OTHERWISE
IF *OTHERWISE;

// WRK.Text 10 3 USR = Condition name of PAR.BOL Truck Scale Weigh Sts
WRK.Text_10_3_USR = RTVCND(PAR.BOL_Truck_Scale_Weigh_Sts);

// Send error message - 'F18 not valid. Buy Order Weigh Status is &1'
ERROR(PRK0847);
MSGPARM(WRK.Text_10_3_USR);

ENDIF;

ENDIF;

ENDIF;

ENDIF;

//?F19=Undo NO Spread
CASE;

// IF CTL.*CMD key is CF19
IF CTL.*CMD_key = '19';

// WRK.BOL Truck Scale Weigh Sts = CND.None
WRK.BOL_Truck_Scale_Weigh_Sts = *BLANK;

//?IN
CASE;

// IF WRK.BOL IN  record found  USR is Yes
IF WRK.BOL_IN_record_found_USR = 'Y';

// WRK.BOL Truck Scale Weigh Sts = CND.In
WRK.BOL_Truck_Scale_Weigh_Sts = 'I';

ENDIF;

//?OUT
CASE;

// IF WRK.BOL OUT record found  USR is Yes
IF WRK.BOL_OUT_record_found_USR = 'Y';

// WRK.BOL Truck Scale Weigh Sts = CND.Out
WRK.BOL_Truck_Scale_Weigh_Sts = 'O';

ENDIF;

EXECUTE FUNCTION(Upd Trk Scl Weigh Sts RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214077;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(WRK.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Process Data record

 CASE;

 // IF PAR.BOL Truck Scale Weigh Sts is Respread
 IF PAR.BOL_Truck_Scale_Weigh_Sts = 'R';

 // AND DB1.BOL Truck Scale Weigh Sts is Not Spread
 AND DB1.BOL_Truck_Scale_Weigh_Sts = 'I'/'N'/*BLANK/'O'/'R'/'A'/'C';

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(Chg Trk Scl Weigh Sts CH) TYPE(CHGOBJ) FILE(PKAXCPP)           AB1214078;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
 PARAMETER(DB1.BOL_Shipped_Head);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

 ENDIF;

 CASE;

 // IF PAR.BOL Truck Scale Weigh Sts is Respread
 IF PAR.BOL_Truck_Scale_Weigh_Sts = 'R';

 EXECUTE FUNCTION(Upd Hdr/Bal Status    RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1230832;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER('E');
 PARAMETER('E');
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.TH Hog Class Type is Not Resale
  IF DB1.TH_Hog_Class_Type = 'M'/'S';

  EXECUTE FUNCTION(Chg Hdr/Bal Status    CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1230833;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(PAR.TH_Header_Error_Sts);
  PARAMETER(PAR.TH_Kill_Balancing_Sts);
  ENDIF;

 }

 ENDIF;

}


EXECUTE FUNCTION(Upd Spread Status     RT) TYPE(RTVOBJ) FILE(PKEJCPP)           AB1215841;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.BOLW_Movement_Number);
PARAMETER(*BLANK);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Status            CH) TYPE(CHGOBJ) FILE(PKEJCPP)           AB1215770;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.BOLW_Movement_Number);
 PARAMETER(DB1.BOLW_Weight_Type);
 PARAMETER(PAR.BOLW_Spread_Status);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


EXECUTE FUNCTION(Upd Recalc Live Wgt   RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1215804;
PARAMETER(CTL.CC_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(*ZERO);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.TH Tattoo Number is Internal Pre-tattooed
 IF DB1.TH_Tattoo_Number >= 9100;
 AND DB1.TH_Tattoo_Number <= 9499;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.TH Hog Class Type is Not Resale
 IF DB1.TH_Hog_Class_Type = 'M'/'S';

 EXECUTE FUNCTION(Chg Recalc Live Wgt   CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1215805;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(PAR.TH_Recalc_Live_Wgt);
 ENDIF;

 ENDIF;

}


// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

QUIT;

ENDIF;

//?USER: Process subfile record (Pre-confirm)

//?2=Edit
CASE;

// IF RCD.*SFLSEL is *Revise request
IF RCD.*SFLSEL = '2'/'2';

// Call program Edt Buy Order Load Wt ER.
CALL PROGRAM(Edt Buy Order Load Wt ER) ('PKPXE1R');
PARAMETER(RCD.CC_Company_Number);
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(RCD.BOLW_Movement_Number);
PARAMETER(RCD.BOLW_Weight_Type);
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?4=Delete
CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

//?Cant delete if weight has been spread.
CASE;

// IF RCD.BOLW Spread Status is Spread
IF RCD.BOLW_Spread_Status = 'S';

// Send error message - 'Delete not allowed because weight has been spread.'
ERROR(PRK0848);

ENDIF;

//?Cant delete IN record if OUT record exists
CASE;

// IF WRK.BOL OUT record found  USR is Yes
IF WRK.BOL_OUT_record_found_USR = 'Y';

// AND RCD.BOLW Weight Type is In
AND RCD.BOLW_Weight_Type = 'I';

// Send error message - 'Delete not allowed because OUT scale weight exists.'
ERROR(PRK0853);

ENDIF;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: Process subfile record (Post-confirm)

CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Dlt Buy Order Load Wt DO) TYPE(DLTOBJ) FILE(PKEJCPP)           AB1213884;
PARAMETER(RCD.CC_Company_Number);
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(RCD.BOLW_Movement_Number);
PARAMETER(RCD.BOLW_Weight_Type);

CASE;

// IF RCD.BOLW Weight Type is Out
IF RCD.BOLW_Weight_Type = 'O';

// WRK.BOL Truck Scale Weigh Sts = CND.In
WRK.BOL_Truck_Scale_Weigh_Sts = 'I';

// IF RCD.BOLW Weight Type is In
IF RCD.BOLW_Weight_Type = 'I';

// WRK.BOL Truck Scale Weigh Sts = CND.None
WRK.BOL_Truck_Scale_Weigh_Sts = *BLANK;

ENDIF;

EXECUTE FUNCTION(Rtv/Chg Bol TrkSclWgh RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1214000;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(WRK.BOL_Truck_Scale_Weigh_Sts);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Buy Order Detail  CH) TYPE(CHGOBJ) FILE(PKAXCPP)           AB1100531;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.BOL_Kill_Date);
 PARAMETER(DB1.BOL_Pln_Delv_Start_Time);
 PARAMETER(DB1.BOL_Pln_Delv_End_Time);
 PARAMETER(DB1.BOL_Pln_Head_Delv);
 PARAMETER(DB1.BOL_Shipped_Wgt);
 PARAMETER(DB1.BOL_Pln_Delv_Date);
 PARAMETER(DB1.BOL_Freight_UOM);
 PARAMETER(DB1.BOL_Freight_Unit_Amt);
 PARAMETER(DB1.BOL_Freight_Amt);
 PARAMETER(DB1.BOL_Freight_Allocation);
 PARAMETER(DB1.BOL_Head_Received);
 PARAMETER(DB1.BOL_Live_Wgt_Received);
 PARAMETER(DB1.BOL_Trucker_Payment_Sts);
 PARAMETER(DB1.BOL_Trucker_Check_Number);
 PARAMETER(DB1.BOL_Trucker_Check_Date);
 PARAMETER(DB1.BOL_AP_Voucher);
 PARAMETER(DB1.BOL_Trailer);
 PARAMETER(DB1.BOL_Freight_Exp_Paid_By);
 PARAMETER(DB1.BOL_Scheduled_Kill_Shift);
 PARAMETER(PAR.BOL_Truck_Scale_Weigh_Sts);
 PARAMETER(DB1.BOL_Violated_Auth_Tme_Sts);
 PARAMETER(DB1.TRK_Trucker_Code);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.PL_Location_Code);
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER(DB1.RS_Record_Status);
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 PARAMETER(DB1.RS_User_Added);
 PARAMETER(DB1.RS_Date_Added);
 PARAMETER(DB1.RS_Time_Added);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

