// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKWUXFR
// ?Date: 14.08.2025 Time: 02:50:42
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Some files are kept 4 weeks, the fifth week is purged.
//?So Calculate Date 29 days ago. Read the files in descending date
//?order positioning on the date 29 days ago. Delete the records found.
// WRK.Date USR = JOB.*Job date + CON.-29 *DAYS
WRK.Date_USR = DATEINCR(JOB.*Job_date '-29' 'DY' 1111111 'NONE' 'N' 1);

// Call program Zzz rcds dlt in prge  zz.
CALL PROGRAM(Zzz rcds dlt in prge  zz) ('PKWTPFR');
PARAMETER(WRK.Date_USR);

//?Get the week number of the date 29 days ago. Read in descending yr/week
//?order positioning on the yr/wk 4 weeks ago.Delete the records found.
EXECUTE FUNCTION(Rtv Week Nbr f/ a Dte RT) TYPE(RTVOBJ) FILE(PKCFREP)           AB1127384;
PARAMETER(WRK.CW_Year);
PARAMETER(WRK.CW_Week_Number);
PARAMETER(WRK.Date_USR);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


CASE;

// IF WRK.CW Year NE WRK.Zero USR
IF WRK.CW_Year <> WRK.Zero_USR;

// Call program zzt rcds f/wkly purge RT.
CALL PROGRAM(zzt rcds f/wkly purge RT) ('PKWVPFR');
PARAMETER(WRK.CW_Year);
PARAMETER(WRK.CW_Week_Number);

ENDIF;

//?Sbmjob to reorganize the files purged to remove deleted records.
// Execute command - 'SBM Rgzpfm files weekly'
EXECUTE COMMAND(PRK0557);

