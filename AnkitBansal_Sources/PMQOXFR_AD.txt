// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMQOXFR
// ?Date: 14.08.2025 Time: 03:43:48
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?** Process all application areas
//?** All members will be removed, not just the "Z" members
//?** All files, logicals, tape physicals will be removed, not cleared
EXECUTE FUNCTION(RTV Rmv 'Z' Mbrs       RT) TYPE(RTVOBJ) FILE(PDLPREP)          AC1858779;
PARAMETER(PAR.PCG_Code);
PARAMETER(PAR.PCG_From_Library);
PARAMETER(PAR.Purge_Run_Frequency);
PARAMETER(PAR.To_Library_USR);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?** LJB 05/19/2009 E00383   Remove files from purge lib instead of
 //?** clearing in case file format changes
 //?** LJB 04/25/2008 FP1009 Post install changes
 //?** Remove All members of purge tape file, not just "Z" members
 //?** LJB 01/30/2008 FP1009 Post install changes
 //?** Pass "Purge To Library" from the Purge Control Group file
 ENDDO;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 CASE;

 // IF DB1.Purge Run Frequency EQ PAR.Purge Run Frequency
 IF DB1.Purge_Run_Frequency = PAR.Purge_Run_Frequency;

 //?** Process all active application areas
 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?** Only process Purge Method of "Tape"
 CASE;

 // IF DB1.PCA Purge Method is Tape
 IF DB1.PCA_Purge_Method = 'T';

 EXECUTE FUNCTION(RTV & Rmv 'Z' Members  RT) TYPE(RTVOBJ) FILE(PDLQREP)          AC1851901;
 PARAMETER(PAR.PCG_Code);
 PARAMETER(PAR.PCG_From_Library);
 PARAMETER(DB1.Purge_Application_Code);
 PARAMETER(PAR.To_Library_USR);
 {
  //?USER: Initialize routine

  //?***** Change Log and Comments
  DO;

  //?** LJB 05/19/2009 E00383   Remove File, Logical, and Tape Physical
  //?** file from Purge Library instead of just clearing them. This
  //?** will eliminate the need to remember to replace them if a file
  //?** changes in the future
  //?** LJB 01/30/2008 FP1009 Post install changes
  //?** Pass "Purge To Library" from the Purge Control Group file
  ENDDO;

  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  //?USER: Process Data record

  // Call program EXC Rmv members        CL.
  CALL PROGRAM(EXC Rmv members        CL) ('PMOSUPC');
  PARAMETER(PAR.PCG_Code);
  PARAMETER(DB1.File_Name);
  PARAMETER(DB1.Purge_Logical);
  PARAMETER(DB1.Purge_Tape_Physical);
  PARAMETER(PAR.To_Library_USR);

 }

 ENDIF;

 ENDIF;

 ENDIF;

}


