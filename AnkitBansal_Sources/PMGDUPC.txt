/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - THIS PROGRAM IS SUBMITTED FROM PNXRUPC WHICH IS      */
/*             CALLED FROM A PROMPT SCREEN                          */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - SUBMITTED BACKHAUL REPORT DOWNLOAD                  */
/*  DATE      - 05/11/2011                                          */
/*                                                                  */
/*  PARAMETERS RECEIVED:                                            */
/*     &COMPNYN - COMPANY NUMBER - BLANK FOR ALL - 15.5             */
/*     &FRMDATN - FROM SHIP DATE - 15.5                             */
/*     &THRDATN - THROUGH SHIP DATE - 15.5                          */
/*     &RPTTYPE - REPORT TYPE                                       */
/*     &SHIPLINE- SHIPPING LINE                                     */
/*     &CARRIER - CARRIER CODE                                      */
/*     &EMAIL   - EMAIL ADDRESS                                     */
/********************************************************************/
/*  E003057 LJB 04/07/2014  CHANGE TO DROP PRINTER PARMS, THIS WILL */
/*    CREATE AND EMAIL ONE OF SEVERAL SQL'S                         */
/********************************************************************/
 PMGDUPC:    PGM        PARM(&COMPNYN &FRMDATN &THRDATN &RPTTYPE +
                          &CARRIER &SELECT &EMAIL)
/* PARMS                                                             */
        DCL    &COMPNYN    *DEC
        DCL    &COMPANY    *DEC   (3 0)
        DCL    &COMPANYA   *CHAR  (3)
        DCL    &FRMDATN    *DEC
        DCL    &FRMDAT     *DEC   (7 0)
        DCL    &FRMDATA    *CHAR  (7)
        DCL    &FROMDT10   *CHAR  (10)
        DCL    &THRDATN    *DEC
        DCL    &THRDAT     *DEC   (7 0)
        DCL    &THRDATA    *CHAR  (7)
        DCL    &TODTA10    *CHAR  (10)
        DCL    &RPTTYPE    *CHAR  (1)
        DCL    &CARRIER    *CHAR  (3)
        DCL    &SELECT     *CHAR  (1)
        DCL    &EMAIL      *CHAR  (50)
        DCL    &SUBJECT    *CHAR  (65)
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             CHGVAR     VAR(&FRMDAT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FRMDAT)
             CHGVAR     VAR(&THRDAT) VALUE(&THRDATN)
             CHGVAR     VAR(&THRDATA) VALUE(&THRDAT)
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPANYA) VALUE(&COMPANY)

/* CONVERT FROM DATE TO MM/DD/YYYY CHAR FORMAT                       */
             CVTDAT     DATE(&FRMDATA) TOVAR(&FROMDT10) +
                          FROMFMT(*CYMD) TOFMT(*MDYY) TOSEP(/)
/* CONVERT TO DATE TO MM/DD/YYYY CHAR FORMAT                         */
             CVTDAT     DATE(&THRDATA) TOVAR(&TODTA10) FROMFMT(*CYMD) +
                          TOFMT(*MDYY) TOSEP(/)

/* ATTACHMENT - FORMAT THE SUBJECT LINE                              */
             CHGVAR     VAR(&SUBJECT) VALUE('Backhaul Report +
                          Download: ' *CAT &FROMDT10 *CAT ' - ' +
                          *CAT &TODTA10)
     GOTO REPORTS   /*** SKIP ADDING/RMVING PRKDEVQRY  ***/
RMVLIBLE PRKDEVQRY
 MONMSG     MSGID(CPF0000 CPF2104)
ADDLIBLE PRKDEVQRY *LAST
 MONMSG     MSGID(CPF0000)

REPORTS:
/*-------------------------------------------------------------------*/
/* SELECT 1 = RUN SEQUELS BY ETA AT PLANT DATE                       */
/*-------------------------------------------------------------------*/
SELECT1:
             IF         COND(&SELECT *EQ '1') THEN(DO)
/*-------------------------------------------------------------------*/
/* REPORT TYPE = 5: 1 COMPANY, 1 CARRIER                             */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '5') THEN(DO)
             EXECUTE    VIEW(PMAMRELFV5) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&CO# &COMPANYA) (&BHCARRIER +
                          &CARRIER) (&FROMDATE &FRMDATA) (&THRUDATE +
                          &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 6: ALL COMPANIES, ALL CARRIERS                      */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '6') THEN(DO)
             EXECUTE    VIEW(PMAMRELFV6) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&FROMDATE &FRMDATA) (&THRUDATE +
                          &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 7: ALL COMPANIES, 1 CARRIER                         */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '7') THEN(DO)
             EXECUTE    VIEW(PMAMRELFV7) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&BHCARRIER &CARRIER) (&FROMDATE +
                          &FRMDATA) (&THRUDATE &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 8: 1 COMPANY, ALL CARRIERS                          */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '8') THEN(DO)
             EXECUTE    VIEW(PMAMRELFV8) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&CO# &COMPANYA) (&FROMDATE +
                          &FRMDATA) (&THRUDATE &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             ENDDO      /* End Select = 1: Report by ETA at Plant */

/*-------------------------------------------------------------------*/
/* SELECT 2 = RUN SEQUELS BY SCHEDULED SHIP DATE                     */
/*-------------------------------------------------------------------*/
SELECT2:
             IF         COND(&SELECT *EQ '2') THEN(DO)
/*-------------------------------------------------------------------*/
/* REPORT TYPE = 5: 1 COMPANY, 1 CARRIER                             */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '5') THEN(DO)
             EXECUTE    VIEW(PMAMRELFV9) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&CO# &COMPANYA) (&BHCARRIER +
                          &CARRIER) (&FROMDATE &FRMDATA) (&THRUDATE +
                          &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 6: ALL COMPANIES, ALL CARRIERS                      */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '6') THEN(DO)
             EXECUTE    VIEW(PMAMRELFVA) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&FROMDATE &FRMDATA) (&THRUDATE +
                          &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 7: ALL COMPANIES, 1 CARRIER                         */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '7') THEN(DO)
             EXECUTE    VIEW(PMAMRELFVB) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&BHCARRIER &CARRIER) (&FROMDATE +
                          &FRMDATA) (&THRUDATE &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/*-------------------------------------------------------------------*/
/* REPORT TYPE = 8: 1 COMPANY, ALL CARRIERS                          */
/*-------------------------------------------------------------------*/
             IF         COND(&RPTTYPE *EQ '8') THEN(DO)
             EXECUTE    VIEW(PMAMRELFVC) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG(&SUBJECT) +
                          SETVAR((&CO# &COMPANYA) (&FROMDATE +
                          &FRMDATA) (&THRUDATE &THRDATA))
             MONMSG     MSGID(CPF6801)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             ENDDO      /* End Select = 2: Report by SSD */

 ENDPGM:     ENDPGM
