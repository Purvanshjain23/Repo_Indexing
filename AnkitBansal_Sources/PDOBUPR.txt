             PGM        PARM(&ERROR &EVENT &COMPIN &ORDIN &SEQ1IN &SEQ2IN  +
                             &CUSTIN &CUSTNM)
             DCL        VAR(&ERROR)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&EVENT)  TYPE(*CHAR) LEN(2)
             DCL        VAR(&COMPIN) TYPE(*DEC)
             DCL        VAR(&ORDIN)  TYPE(*DEC)
             DCL        VAR(&SEQ1IN) TYPE(*DEC)
             DCL        VAR(&SEQ2IN) TYPE(*DEC)
             DCL        VAR(&CUSTIN) TYPE(*DEC)
             DCL        VAR(&CUSTNM) TYPE(*CHAR) LEN(30)

             DCL        VAR(&COMP)   TYPE(*DEC)  LEN(3)
             DCL        VAR(&ORDR)   TYPE(*DEC)  LEN(7)
             DCL        VAR(&SEQ1)   TYPE(*DEC)  LEN(3)
             DCL        VAR(&SEQ2)   TYPE(*DEC)  LEN(3)
             DCL        VAR(&CUST)   TYPE(*DEC)  LEN(7)
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&FLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&HLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PDIM) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&PDIQ) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&PDJJ) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&PDJK) TYPE(*CHAR) LEN(1) VALUE('N')
             DCL        VAR(&TEMP) TYPE(*CHAR) LEN(15)
             DCL        VAR(&THOU) TYPE(*DEC)  LEN(7) VALUE(1000)
/*                                                                  */
/* EXIT IF EVENT ISN'T PRE-UPDATE                                   */
/*                                                                  */
             IF         COND(&EVENT *EQ '**') THEN(GOTO CMDLBL(MOVE))
             GOTO CMDLBL(END)

MOVE:        CHGVAR     VAR(&TEMP) VALUE(&COMPIN)
             CHGVAR     VAR(&COMP) VALUE(&TEMP)
/*           CHGVAR     VAR(&COMP) VALUE(&COMPIN) */
             CHGVAR     VAR(&COMP) VALUE(&TEMP)
             CHGVAR     VAR(&ORDR) VALUE(&ORDIN)
             CHGVAR     VAR(&SEQ1) VALUE(&SEQ1IN)
             CHGVAR     VAR(&SEQ2) VALUE(&SEQ2IN)
             CHGVAR     VAR(&CUST) VALUE(&CUSTIN)
/*                                                              */
/* RETRIEVE DATA FILE LIBRARY FROM SYSTEM                       */
/*                                                              */
             CALL       PGM(CAQXXFR) PARM(&RETURN &FLIB &HLIB)
             IF COND(&FLIB *EQ '          ') THEN(DO)
             CHGVAR VAR(&ERROR) VALUE('Y')
             GOTO       CMDLBL(END)
             ENDDO
/*                                                              */
/* MAKE CERTAIN THAT LIBRARY QTEMP IS FIRST ON LIBRARY LIST     */
/*                                                              */
             RMVLIBLE   LIB(QTEMP)
             MONMSG     MSGID(CPF0000)

             ADDLIBLE   LIB(QTEMP) POSITION(*FIRST)
             MONMSG     MSGID(CPF0000)

/*   SHIPPING FILES         */
INV:
             CHKOBJ     OBJ(QTEMP/PDIMCPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(CHGVAR VAR(&PDIM) +
                          VALUE('Y'))
             CHKOBJ     OBJ(QTEMP/PDJKCPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(CHGVAR VAR(&PDJK) +
                          VALUE('Y'))

             IF         COND(&PDIM *EQ 'N') THEN(DO)
              DLTF       FILE(QTEMP/PDIMCPW0)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPW1)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPW2)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPP)
              MONMSG     MSGID(CPF2105)
             ENDDO
             IF         COND(&PDJK *EQ 'N') THEN(DO)
              DLTF       FILE(QTEMP/PDJKCPW0)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDJKCPW1)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDJKCPP)
              MONMSG     MSGID(CPF2105)
             ENDDO
             CRTDUPOBJ  OBJ(PDIMCPP) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO)
             CRTDUPOBJ  OBJ(PDIMCPW0) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PDIMCPW1) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PDIMCPW2) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CRTDUPOBJ  OBJ(PDJKCPP) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO)
             CRTDUPOBJ  OBJ(PDJKCPW0) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PDJKCPW1) FROMLIB(&FLIB) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

/** ** ** ** ** ** ** CALL PRICE SIMULATOR ** ** ** ** ** ** **/
             CALL       PGM(PDOEEFR) PARM(' ' &COMP &ORDR &SEQ1 +
                          &SEQ2 &CUST &CUSTNM)

             CHGVAR     VAR(&PDIM) VALUE('N')
             CHGVAR     VAR(&PDJK) VALUE('N')
             CHKOBJ     OBJ(QTEMP/PDIMCPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(CHGVAR VAR(&PDIM) +
                          VALUE('Y'))
             CHKOBJ     OBJ(QTEMP/PDJKCPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(CHGVAR VAR(&PDJK) +
                          VALUE('Y'))

             IF         COND(&PDIM *EQ 'N') THEN(DO)
              DLTF       FILE(QTEMP/PDIMCPW0)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPW1)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPW2)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDIMCPP)
              MONMSG     MSGID(CPF2105)
             ENDDO

             IF         COND(&PDJK *EQ 'N') THEN(DO)
              DLTF       FILE(QTEMP/PDJKCPW0)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDJKCPW1)
              MONMSG     MSGID(CPF2105)
              DLTF       FILE(QTEMP/PDJKCPP)
              MONMSG     MSGID(CPF2105)
             ENDDO

 END:        ENDPGM
