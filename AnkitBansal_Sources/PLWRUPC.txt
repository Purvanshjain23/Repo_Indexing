/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PLWJUPR                                       */
/*  PROGRAM NAME:    Clp Hot Scale DailySm UP                      */
/*  PROGRAMMER:      Julius High                                   */
/*  CREATE DATE:     01/03/2015                                    */
/*                                                                 */
/*  FUNCTION:        This CLP  calls the SEQUEL Viewpoint          */
/*                   HOTWGTSM - Hog Scale Daily Summary and send   */
/*                   XLS to user for specified Kill Date Range.    */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*           E3773 JJH 01/03/15 - Create CLP                       */
/*                                                                 */
/***************************************************************** */
             PGM        PARM(&COMA &KILLDTFMA &KILLDTTOA &EMAILADR +
                          &KILLDTRNG)

/*-----------------------------------------------------------------*/
/*                      PARAMETER                                  */
/*-----------------------------------------------------------------*/
/* Function Specific                                               */
             DCL        VAR(&COMA)      TYPE(*CHAR) LEN(3)
             DCL        VAR(&KILLDTFMA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&KILLDTTOA) TYPE(*CHAR) LEN(7)
             DCL        VAR(&EMAILADR)  TYPE(*CHAR) LEN(50)
             DCL        VAR(&KILLDTRNG) TYPE(*CHAR) LEN(25)

/*-----------------------------------------------------------------*/
/* Program Variables                                               */
             DCL        VAR(&TEXT)      TYPE(*CHAR) LEN(50)
             DCL        VAR(&COMN)      TYPE(*DEC) LEN(3)
             DCL        VAR(&KILLDTFMN) TYPE(*DEC) LEN(7)
             DCL        VAR(&KILLDTTON) TYPE(*DEC) LEN(7)

             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10) /* DATA +
                          FILES      */
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10) /* HIST +
                          FILES      */

/*-----------------------------------------------------------------*/
/* Initialization                                                  */
/*-----------------------------------------------------------------*/
/*                           MAIN                                  */
/*-----------------------------------------------------------------*/
/* RETRIEVE DATA LIBRARIES FROM SYSTEM VALUES                      */

             CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

/* Create Eval Trans UPL ERP Smmry (Work File) in QTEMP            */

             CHKOBJ     OBJ(QTEMP/PLB7CPP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
/*                            object not found                     */
             CRTDUPOBJ  OBJ(PLB7CPP) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PLB7CPL0) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PLB7CPL1) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CLRPFM     FILE(QTEMP/PLB7CPP)
                          ENDDO

/*******************************************************************/
/* PLWPXFR - Bld Evl Trn UPL ERP SmXF creates PLB7CPP - Eval Trans */
/* UPL ERP Smmry workfile in QTEMP which is used to generate       */
/* Excel Spreadsheet with SEQUEL Viewpoint.                        */
/*                                                                 */
             CHGVAR     VAR(&COMN)      VALUE(&COMA)
             CHGVAR     VAR(&KILLDTFMN) VALUE(&KILLDTFMA)
             CHGVAR     VAR(&KILLDTTON) VALUE(&KILLDTTOA)

             CALL       PGM(PLWPXFR) PARM(' ' &COMN &KILLDTFMN +
                          &KILLDTTON)

/*******************************************************************/
/* Create Excel Spreadsheet with SEQUEL Viewpoint and email to     */
/* receipient(s).                                                  */

/* OVRDBF is required to allow EXECUTE VIEW to read file in QTEMP  */
/*                                                                 */
             OVRDBF     FILE(PLB7CPP) TOFILE(QTEMP/PLB7CPP)

/* Setup email to send Hot Scale Daily Summary - Excel Spread Sheet*/
             CHGVAR     VAR(&TEXT) VALUE('Hot Scale Daily Summary ' +
                          *CAT &KILLDTRNG)

/* Create Excel Spreadsheet with SEQUEL Viewpoint.                 */

             EXECUTE    VIEW(HOTWGTSM) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADR) EMLMSG(&TEXT) +
                          TEXT(&TEXT)

             MONMSG     MSGID(CPF0000)

/* Clear workfile in QTEMP                                         */
             CLRPFM     FILE(QTEMP/PLB7CPP)

/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 ENDPGM:
             DLTOVR     FILE(*ALL)
             ENDPGM
