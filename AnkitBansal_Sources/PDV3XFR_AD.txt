// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDV3XFR
// ?Date: 14.08.2025 Time: 03:33:18
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(CNV 12 mo. A/R Bal     RT) TYPE(RTVOBJ) FILE(ARBCREP)          AC1450173;
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 //?** 09/11/2006 LJB L60906C
 //?** Add new Days To Pay field to the CRTOBJ.
 //?*****
 //?USER: Process Data record

 //?Initialize Starting Date.
 // PAR.A/R Balance Year = JOB.*Job date *YEAR
 PAR.A_R_Balance_Year = DATEDTLS(JOB.*Job_date 'YR' 1111111 'NONE' 'N' 1);

 // PAR.A/R Balance Year = PAR.A/R Balance Year - CON.1
 PAR.A_R_Balance_Year = PAR.A_R_Balance_Year - 1;

 // PAR.A/R Balance Month = JOB.*Job month
 PAR.A_R_Balance_Month = JOB.*Job_month;

 //?Save Job Year.
 // PAR.USR Accounting Year = PAR.A/R Balance Year
 PAR.USR_Accounting_Year = PAR.A_R_Balance_Year;

 // DOW PAR.A/R Balance Year LT PAR.USR Accounting Year
 DOW PAR.A_R_Balance_Year < PAR.USR_Accounting_Year;

 // OR PAR.A/R Balance Month LT JOB.*Job month
 OR ( PAR.A_R_Balance_Month < JOB.*Job_month;

 // AND PAR.A/R Balance Year EQ PAR.USR Accounting Year
 AND PAR.A_R_Balance_Year = PAR.USR_Accounting_Year );

 //?Create A/R Balance File records.
 DO;

 EXECUTE FUNCTION(CRT A/R Balance File   CR) TYPE(CRTOBJ) FILE(PDLDCPP)          AC1450075;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(PAR.A_R_Balance_Year);
 PARAMETER(PAR.A_R_Balance_Month);
 PARAMETER(DB1.Amount_of_Highest_A_R_Bal);
 PARAMETER(DB1.Date_of_Highest_A_R_Bal);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(WRK.SSI_Download_Flag);
 PARAMETER(WRK.unused_status_2);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER('A');
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp.PgmIF) TYPE(EXCINTFUN)                     AC1425284;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 CASE;

 // IF PAR.A/R Balance Month is December
 IF PAR.A_R_Balance_Month = 12;

 // PAR.A/R Balance Year = PAR.A/R Balance Year + CON.1
 PAR.A_R_Balance_Year = PAR.A_R_Balance_Year + 1;

 // PAR.A/R Balance Month = CON.1
 PAR.A_R_Balance_Month = 1;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.A/R Balance Month = PAR.A/R Balance Month + CON.1
 PAR.A_R_Balance_Month = PAR.A_R_Balance_Month + 1;

 ENDIF;

 ENDDO;

 ENDDO;

}


