     H/TITLE EDT On Account Cash    E1 Edit record(1 screen)
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain DBF file records, one at a time
     H* - Existing records may be updated or deleted
     H* - New records may be added
     H* - Key changes are not allowed
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Edit record(1 screen)
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 04/18/22  Time  : 16:22:28
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPDTME1R#CF  E                    WORKSTN
     F                                              KINFDS INFDS#
      * DSP: EDT On Account Cash    E1 Edit record(1 screen)
      *
     FARBDCPLPIF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : A/R Header                Co/Cust/Inv On Acct Cash
      *
     FCAASREL2IF  E           K        DISK
      * RTV : Company Control           Retrieval index       NV
      *
     FARBDCPMAIF  E           K        DISK
      * RSQ : A/R Header                Inv/InvSfx/Co
      *
     FCAABREL3IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       NV
      *
     FCAEBREL3IF  E           K        DISK
      * RTV : Bank Master               Retrieval Active Only
      *
     FCABBREL1IF  E           K        DISK
      * RTV : Customer                  Retrieval index       NV
      *
     FPDJ2CPL3IF  E           K        DISK
      * RSQ : A/R Bank Deposit          bank/dep active only
      *
     FCAABREL1IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       V
      *
     FPDJYREL2IF  E           K        DISK
      * RTV : Company Defaults Internal Active Records
      *
     FCABBRELBIF  E           K        DISK
      * RSQ : Customer                  RSQ Bill to (A/R) Active
      *
     FARBDCPL3IF  E           K        DISK
      * RTV : A/R Header                Retrieval index       NV
      *
     FPDJ3CPL1IF  E           K        DISK
      * RTV : A/R Adjustment Type       Retrieval index
      *
     FCAEBREL1IF  E           K        DISK
      * RTV : Bank Master               Retrieval index       NV
      *
     FCAAPREL2IF  E           K        DISK
      * RTV : Salesperson               Retrieval index       V
      *
     FPDJEREL1IF  E           K        DISK
      * RTV : Sales Route               Retrieval index
      *
     FCADPREL1IF  E           K        DISK
      * RTV : System Values             Retrieval index       NV
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FCAASREL0UF  E           K        DISK
      * UPD : Company Control           Update index
      *
     FARBDCPL0UF  E           K        DISK                      A
      * UPD : A/R Header                Update index
      *
     FPPA4CPL0IF  E           K        DISK                      A
      * UPD : A/R Header OA             Update index
      *
     FPDJ2CPL0UF  E           K        DISK
      * UPD : A/R Bank Deposit          Update index
      *
     E                    #L3         3  1
     E                    #L7         7  1
     E                    J7          7  1
     E                    K7          7  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    UCT        40  1               CENTER TABLE
      * KEY Screen: Field position and name array
     E                    W0BEG   2 002  5 0A
     E                    W0END   2 002  5 0A
     E                    W0NAM   2 002 10
      * DETAIL Screen: Field position and name array
     E                    W1BEG   7 017  5 0A
     E                    W1END   7 017  5 0A
     E                    W1NAM   7 017 10
      * Long constants
     E                    @CN#    1  05  6   @CN    25
     I@BDCPP3
      * A/R Header                Inv/InvSfx/Co
      * Renamed input format fields
     I              BDAIC3                          WAAIC3
     I              BDCONB                          WACONB
     I              BDCEST                          WACEST
     I              BDUHCD                          WAUHCD
     I              BDBSVA                          WABSVA
     I              BDAIVA                          WAAIVA
     I              BDAOVA                          WAAOVA
     I              BDBGVA                          WABGVA
     I              BDAJST                          WAAJST
     I              BDE3ST                          WAE3ST
     I              BDG4CD                          WAG4CD
     I              BDCKNB                          WACKNB
     I              BDCAC7                          WACAC7
     I              BDBKC7                          WABKC7
     I              BDBCCD                          WABCCD
     I              BDR4CD                          WAR4CD
     I              BDB4DT                          WAB4DT
     I              BDATDT                          WAATDT
     I              BDH0DT                          WAH0DT
     I              BDH3DT                          WAH3DT
     I              BDH4DT                          WAH4DT
     I              BDH5DT                          WAH5DT
     I              BDANC7                          WAANC7
     I              BDCPTX                          WACPTX
     I              BDBSDY                          WABSDY
     I              BDUVST                          WAUVST
     I              BDUWST                          WAUWST
     I              BDUXST                          WAUXST
     I              BDAATM                          WAAATM
     I              BDAYNA                          WAAYNA
     I              BDA0NA                          WAA0NA
     I              BDAXDT                          WAAXDT
      *
     I@ASRECB
      * Company Control           Update index
      * Renamed input format fields
     I              ASAIC3                          WBAIC3
     I              ASAXNB                          WBAXNB
     I              ASNGNB                          WBNGNB
     I              ASBZNB                          WBBZNB
     I              ASC5NB                          WBC5NB
     I              ASC3NB                          WBC3NB
     I              ASCYNB                          WBCYNB
     I              ASIONB                          WBIONB
     I              ASI6NB                          WBI6NB
     I              ASDCNB                          WBDCNB
     I              ASC7NB                          WBC7NB
     I              ASC2NB                          WBC2NB
     I              ASC1NB                          WBC1NB
     I              ASL8NB                          WBL8NB
     I              ASBANB                          WBBANB
     I              ASCHST                          WBCHST
     I              ASCKST                          WBCKST
     I              ASCIST                          WBCIST
     I              ASCGST                          WBCGST
     I              ASAIPC                          WBAIPC
     I              ASASPC                          WBASPC
     I              ASA2VA                          WBA2VA
     I              ASC2ST                          WBC2ST
     I              ASD8ST                          WBD8ST
     I              ASD7ST                          WBD7ST
     I              ASA8NA                          WBA8NA
     I              ASA9NA                          WBA9NA
     I              ASBANA                          WBBANA
     I              ASBBNA                          WBBBNA
     I              ASEUST                          WBEUST
     I              ASAADY                          WBAADY
     I              ASABDY                          WBABDY
     I              ASACDY                          WBACDY
     I              ASADDY                          WBADDY
     I              ASAEDY                          WBAEDY
     I              ASAFDY                          WBAFDY
     I              ASAGDY                          WBAGDY
     I              ASAHDY                          WBAHDY
     I              ASAENB                          WBAENB
     I              ASALNB                          WBALNB
     I              ASEVNB                          WBEVNB
     I              ASRPOP                          WBRPOP
     I              ASDWNB                          WBDWNB
     I              ASR3NB                          WBR3NB
     I              ASPNST                          WBPNST
     I              ASR4NB                          WBR4NB
     I              ASPOST                          WBPOST
     I              ASSCNB                          WBSCNB
     I              ASVIST                          WBVIST
     I              ASVJST                          WBVJST
     I              ASBVVN                          WBBVVN
     I              ASUVST                          WBUVST
     I              ASUWST                          WBUWST
     I              ASUXST                          WBUXST
     I              ASVSST                          WBVSST
     I              ASAATM                          WBAATM
     I              ASAYNA                          WBAYNA
     I              ASA0NA                          WBA0NA
     I              ASAXDT                          WBAXDT
      *
     I@ABREAK
      * Company Name and Address  Retrieval index       V
      * Renamed input format fields
     I              ABAIC3                          WCAIC3
     I              ABADTX                          WCADTX
     I              ABACNA                          WCACNA
     I              ABADNA                          WCADNA
     I              ABAENA                          WCAENA
     I              ABAJNA                          WCAJNA
     I              ABBTTX                          WCBTTX
     I              ABBVTX                          WCBVTX
     I              ABBWTX                          WCBWTX
     I              ABA2NA                          WCA2NA
     I              ABABTX                          WCABTX
     I              ABBGCD                          WCBGCD
     I              ABKXCD                          WCKXCD
     I              ABUVST                          WCUVST
     I              ABUWST                          WCUWST
     I              ABUXST                          WCUXST
     I              ABVSST                          WCVSST
     I              ABAATM                          WCAATM
     I              ABAYNA                          WCAYNA
     I              ABA0NA                          WCA0NA
     I              ABAXDT                          WCAXDT
      *
     I@BBREXJ
      * Customer                  RSQ Bill to (A/R) Active
      * Renamed input format fields
     I              BBBKC7                          WDBKC7
     I              BBAYTX                          WDAYTX
     I              BBACNA                          WDACNA
     I              BBADNA                          WDADNA
     I              BBAENA                          WDAENA
     I              BBAJNA                          WDAJNA
     I              BBBGCD                          WDBGCD
     I              BBG5CD                          WDG5CD
     I              BBBTTX                          WDBTTX
     I              BBBVTX                          WDBVTX
     I              BBBWTX                          WDBWTX
     I              BBABTX                          WDABTX
     I              BBA2NA                          WDA2NA
     I              BBCBST                          WDCBST
     I              BBB0NA                          WDB0NA
     I              BBP3NB                          WDP3NB
     I              BBAXNA                          WDAXNA
     I              BBI6DT                          WDI6DT
     I              BBAYDT                          WDAYDT
     I              BBANC7                          WDANC7
     I              BBBTC7                          WDBTC7
     I              BBK6ST                          WDK6ST
     I              BBUZST                          WDUZST
     I              BBKXCD                          WDKXCD
     I              BBLTCD                          WDLTCD
     I              BBQNST                          WDQNST
     I              BBS2NB                          WDS2NB
     I              BBVHVA                          WDVHVA
     I              BBI7DT                          WDI7DT
     I              BBRJST                          WDRJST
     I              BBRKST                          WDRKST
     I              BBQWST                          WDQWST
     I              BBQXST                          WDQXST
     I              BBQYST                          WDQYST
     I              BBUNCS                          WDUNCS
     I              BBUVST                          WDUVST
     I              BBUWST                          WDUWST
     I              BBUXST                          WDUXST
     I              BBVSST                          WDVSST
     I              BBAATM                          WDAATM
     I              BBAYNA                          WDAYNA
     I              BBA0NA                          WDA0NA
     I              BBAXDT                          WDAXDT
      *
     I@BDCPF7
      * A/R Header                Retrieval index       NV
      * Renamed input format fields
     I              BDAIC3                          WEAIC3
     I              BDCONB                          WECONB
     I              BDCEST                          WECEST
     I              BDUHCD                          WEUHCD
     I              BDBSVA                          WEBSVA
     I              BDAIVA                          WEAIVA
     I              BDAOVA                          WEAOVA
     I              BDBGVA                          WEBGVA
     I              BDAJST                          WEAJST
     I              BDE3ST                          WEE3ST
     I              BDG4CD                          WEG4CD
     I              BDCKNB                          WECKNB
     I              BDCAC7                          WECAC7
     I              BDBKC7                          WEBKC7
     I              BDBCCD                          WEBCCD
     I              BDR4CD                          WER4CD
     I              BDB4DT                          WEB4DT
     I              BDATDT                          WEATDT
     I              BDH0DT                          WEH0DT
     I              BDH3DT                          WEH3DT
     I              BDH4DT                          WEH4DT
     I              BDH5DT                          WEH5DT
     I              BDANC7                          WEANC7
     I              BDCPTX                          WECPTX
     I              BDBSDY                          WEBSDY
     I              BDUVST                          WEUVST
     I              BDUWST                          WEUWST
     I              BDUXST                          WEUXST
     I              BDAATM                          WEAATM
     I              BDAYNA                          WEAYNA
     I              BDA0NA                          WEA0NA
     I              BDAXDT                          WEAXDT
      *
     I@EBREVP
      * Bank Master               Retrieval index       NV
      * Renamed input format fields
     I              EBG4CD                          WFG4CD
     I              EBAUNA                          WFAUNA
     I              EBIVTX                          WFIVTX
     I              EBD4C7                          WFD4C7
     I              EBD5C7                          WFD5C7
     I              EBJOSX                          WFJOSX
     I              EBUVST                          WFUVST
     I              EBUWST                          WFUWST
     I              EBUXST                          WFUXST
     I              EBVSST                          WFVSST
     I              EBAATM                          WFAATM
     I              EBAYNA                          WFAYNA
     I              EBA0NA                          WFA0NA
     I              EBAXDT                          WFAXDT
      *
     I@J2CPCM
      * A/R Bank Deposit          Update index
      * Renamed input format fields
     I              J2G4CD                          WGG4CD
     I              J2HXDT                          WGHXDT
     I              J2YXNX                          WGYXNX
     I              J2UIVA                          WGUIVA
     I              J2UJVA                          WGUJVA
     I              J2AJST                          WGAJST
     I              J2CKNB                          WGCKNB
     I              J2BHNB                          WGBHNB
     I              J2BINB                          WGBINB
     I              J2E2VL                          WGE2VL
     I              J2E3VL                          WGE3VL
     I              J2E4VL                          WGE4VL
     I              J2E5VL                          WGE5VL
     I              J2E6VL                          WGE6VL
     I              J2E7VL                          WGE7VL
     I              J2E8VL                          WGE8VL
     I              J2E9VL                          WGE9VL
     I              J2FAVL                          WGFAVL
     I              J2FBVL                          WGFBVL
     I              J2FCVL                          WGFCVL
     I              J2FDVL                          WGFDVL
     I              J2HYDT                          WGHYDT
     I              J2UVST                          WGUVST
     I              J2UWST                          WGUWST
     I              J2UXST                          WGUXST
     I              J2VSST                          WGVSST
     I              J2AATM                          WGAATM
     I              J2AYNA                          WGAYNA
     I              J2A0NA                          WGA0NA
     I              J2AXDT                          WGAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSARBDCPL0
      * UPD : A/R Header                Update index
      * Current/previous master file format fields for change control
      *
     I#1DBRC      DS                            134
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     IQCAAS1    E DSCAASREL0
      * UPD : Company Control           Update index
      * Renamed input format fields
     I              ASAIC3                          WBAIC3
     I              ASAXNB                          WBAXNB
     I              ASNGNB                          WBNGNB
     I              ASBZNB                          WBBZNB
     I              ASC5NB                          WBC5NB
     I              ASC3NB                          WBC3NB
     I              ASCYNB                          WBCYNB
     I              ASIONB                          WBIONB
     I              ASI6NB                          WBI6NB
     I              ASDCNB                          WBDCNB
     I              ASC7NB                          WBC7NB
     I              ASC2NB                          WBC2NB
     I              ASC1NB                          WBC1NB
     I              ASL8NB                          WBL8NB
     I              ASBANB                          WBBANB
     I              ASCHST                          WBCHST
     I              ASCKST                          WBCKST
     I              ASCIST                          WBCIST
     I              ASCGST                          WBCGST
     I              ASAIPC                          WBAIPC
     I              ASASPC                          WBASPC
     I              ASA2VA                          WBA2VA
     I              ASC2ST                          WBC2ST
     I              ASD8ST                          WBD8ST
     I              ASD7ST                          WBD7ST
     I              ASA8NA                          WBA8NA
     I              ASA9NA                          WBA9NA
     I              ASBANA                          WBBANA
     I              ASBBNA                          WBBBNA
     I              ASEUST                          WBEUST
     I              ASAADY                          WBAADY
     I              ASABDY                          WBABDY
     I              ASACDY                          WBACDY
     I              ASADDY                          WBADDY
     I              ASAEDY                          WBAEDY
     I              ASAFDY                          WBAFDY
     I              ASAGDY                          WBAGDY
     I              ASAHDY                          WBAHDY
     I              ASAENB                          WBAENB
     I              ASALNB                          WBALNB
     I              ASEVNB                          WBEVNB
     I              ASRPOP                          WBRPOP
     I              ASDWNB                          WBDWNB
     I              ASR3NB                          WBR3NB
     I              ASPNST                          WBPNST
     I              ASR4NB                          WBR4NB
     I              ASPOST                          WBPOST
     I              ASSCNB                          WBSCNB
     I              ASVIST                          WBVIST
     I              ASVJST                          WBVJST
     I              ASBVVN                          WBBVVN
     I              ASUVST                          WBUVST
     I              ASUWST                          WBUWST
     I              ASUXST                          WBUXST
     I              ASVSST                          WBVSST
     I              ASAATM                          WBAATM
     I              ASAYNA                          WBAYNA
     I              ASA0NA                          WBA0NA
     I              ASAXDT                          WBAXDT
      *
     IYARDCS      DS                            278
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPPA41    E DSPPA4CPL0
      * UPD : A/R Header OA             Update index
      *
     IYBRDCS      DS                            134
     IYCRDCS      DS                            278
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
     IQPDJ21    E DSPDJ2CPL0
      * UPD : A/R Bank Deposit          Update index
      * Renamed input format fields
     I              J2G4CD                          WGG4CD
     I              J2HXDT                          WGHXDT
     I              J2YXNX                          WGYXNX
     I              J2UIVA                          WGUIVA
     I              J2UJVA                          WGUJVA
     I              J2AJST                          WGAJST
     I              J2CKNB                          WGCKNB
     I              J2BHNB                          WGBHNB
     I              J2BINB                          WGBINB
     I              J2E2VL                          WGE2VL
     I              J2E3VL                          WGE3VL
     I              J2E4VL                          WGE4VL
     I              J2E5VL                          WGE5VL
     I              J2E6VL                          WGE6VL
     I              J2E7VL                          WGE7VL
     I              J2E8VL                          WGE8VL
     I              J2E9VL                          WGE9VL
     I              J2FAVL                          WGFAVL
     I              J2FBVL                          WGFBVL
     I              J2FCVL                          WGFCVL
     I              J2FDVL                          WGFDVL
     I              J2HYDT                          WGHYDT
     I              J2UVST                          WGUVST
     I              J2UWST                          WGUWST
     I              J2UXST                          WGUXST
     I              J2VSST                          WGVSST
     I              J2AATM                          WGAATM
     I              J2AYNA                          WGAYNA
     I              J2A0NA                          WGA0NA
     I              J2AXDT                          WGAXDT
      *
     IYDRDCS      DS                            143
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R Header
      * I : RST Company Number
     I                                    P   1   20P1AIC3
      * I : RST Invoice Number
     I                                    P   3   60P1CONB
      * I :  Transaction Amount
     I                                    P   7  122P1BSVA
      * I : MAP A/R Customer Number
     I                                    P  13  160P1ANC7
     IP2PARM      DS
      * FLD: A/R Bank Deposit
      * I :  Bank Code
     I                                        1   6 P2G4CD
      * I :  Deposit Date
     I                                    P   7  100P2HXDT
      * I :  Deposit Time
     I                                    P  11  130P2YXNX
      * N :  Deposit Amount
     I                                    P  14  192P2UIVA
      * N :  Total Cash Applied
     I                                    P  20  252P2UJVA
      * N :  Number of Deposit Checks
     I                                    P  26  280P2BHNB
      * N :  Number of Applied Checks
     I                                    P  29  310P2BINB
     IP3PARM      DS
      * FLD: *Arrays
      * N :  Warehouse Code
     I                                        1   3 P3AJCD
      * N :  Application Code
     I                                        4   9 P3DNCD
      * N :  Salesperson Code
     I                                       10  12 P3BCCD
      * N :  System Date Format
     I                                       13  15 P3B8NA
      * N :  User Profile Name
     I                                       16  25 P3AJVN
      * N :  Allow Multi-Company
     I                                       26  26 P3I6ST
      * N :  Default Printer
     I                                       27  36 P3MPNA
      * N :  Access Denied (Y/N)
     I                                       37  37 P3WVST
     IP4PARM      DS
      * N :  Next On Acct Cash Number
     I                                    P   1   40P4I6NB
     IP5PARM      DS
      * N :  USR Invoice Suffix
     I                                        1   2 P5ESST
     IP6PARM      DS
      * B :  USR Cash Appl Amt Total
     I                                    P   1   62P6PTVA
     IP7PARM      DS
      * N :  USR Cash Appl Amount
     I                                    P   1   62P7PSVA
     IP8PARM      DS
      * FLD: *Arrays
      * B :  USR Cust Apply
     I                                    P   1   62P8UWVA
      * N :  USR Amount Applied
     I                                    P   7  122P8U6VA
     IP9PARM      DS
      * N : MAP USR Customer Number
     I                                    P   1   40P9IMNB
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Company not found or Inva'
      * Company Number
     I                                        1   3 ZA0001
      * Message data for 'A/R Customer invalid'
      * A/R Customer Number
     I                                        1   7 ZA0002
      * Message data for 'CD7 Non numeric data'
      * Message data for 'Trans Amount > check rem'
      * Transaction Amount
     I                                    P   1   62ZA0003
      * Message data for 'Trans Amount Must be +'
      * Transaction Amount
     I                                    P   1   62ZA0004
      * Message data for 'Trans. Amt. can't be chan'
      * Transaction Amount
     I                                    P   1   62ZA0005
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0006
      * Application Code
     I                                       11  16 ZA0007
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0008
      * Application Code
     I                                       11  16 ZA0009
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1CONB    PARM           WP0002  70       Invoice Number
     C           P1BSVA    PARM           WP0003 112       Transaction Amo
     C           P1ANC7    PARM           WP0004  70       A/R Customer Nu
     C           P2G4CD    PARM           WP0005  6        Bank Code
     C           P2HXDT    PARM           WP0006  70       Deposit Date
     C           P2YXNX    PARM           WP0007  40       Deposit Time
     C           P6PTVA    PARM P6PTVA    WP0008 112       USR Cash Appl A
     C           P8UWVA    PARM P8UWVA    WP0009 112       USR Cust Apply
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Display and process key screen
     C                     EXSR BADSKY
      * Terminate program
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      * Bypass first display of key screen is possible
     C                     MOVEL'Y'       W0BYP   1
      * Initialize key screen
     C                     EXSR MDIZ#K
      * Signal start of transaction
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      * Ensure transaction continues (if reset)
     C                     MOVEL'Y'       W0TRN   1
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'
      * Convert internal to external form
     C  N09                EXSR MNCV#K
      * Is bypass key screen still viable?
     C           W0BYP     IFEQ 'Y'
     C           #1ANC7    IFEQ *ZERO                      A/R Customer Nu
     C           #1CONB    OREQ *ZERO                      Invoice Number
     C           #1AIC3    OREQ *ZERO                      Company Number
      * One or more key fields is blank
     C           *IN30     OREQ '1'
      * HOME: Reset screen fields
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      * Bypass key screen
     C           W0BYP     IFEQ 'N'
      * Display key screen
     C                     EXSR BBEXFM
     C                     END
      * Cancel key screen bypass
     C                     MOVEL'N'       W0BYP
      * Process response to key screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Switch between *ADD/*CHANGE modes
     C   09                CAS            BCCHMD
      * HOME: Reset screen fields
     C   30                CAS            BDHMKY
      * Process key screen input
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSAK
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         BCCHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'CHG'     W0PMD   3
     C                     ELSE
     C                     MOVEL'ADD'     W0PMD
     C                     END
      *================================================================
     CSR         BCEXIT    ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         BDEXIT    ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      * Initialise detail screen
     C                     EXSR MAIZ#1
      * Validate key fields
     C                     EXSR BFVLKY
     C           *IN99     CABEQ'1'       BEEXIT
     C           YPMTFD    CABNE*BLANKS   BEEXIT
      * Check for existing record
     C           KRTV      KLIST
     C                     KFLD           BDAIC3           Company Number
     C                     KFLD           BDANC7           A/R Customer Nu
     C                     KFLD           BDCONB           Invoice Number
      * Setup key
     C                     Z-ADD#1AIC3    BDAIC3
     C                     Z-ADD#1ANC7    BDANC7
     C                     Z-ADD#1CONB    BDCONB
     C           KRTV      CHAIN@BDCPCW              9091  *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     SETON                     99    *
     C                     GOTO BEEXIT
     C                     END                             FI 91
      *
      * If record does not exist, flip to add mode
     C           *IN90     IFEQ '1'
     C                     MOVEL'ADD'     W0PMD
      * USER: Initialize detail screen (new record)
      * New code to get next OA Invoice Number   6/04/2018 JBB E13125
      * CASE: *OTHERWISE
      * RMC 4/18/22 USES SAME NUMBER SERIES AS CB/RB
      * RTV Next CB Number     RT - Company Control  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD*ZERO     WL0001           Company Number
     C                     EXSR SARVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0002    P4I6NB           Next Charge Bac
     C                     ADD  1         P4I6NB           Next On Acct Ca
      * RTV Check invc exists  RT - A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP4I6NB    WL0003           Invoice Number
     C                     EXSR SBRVGN
      * DO WHILE: PGM.*Return code is *Record already exists
     C           W0RTN     DOWEQ@CN,001                    *DOW
     C                     ADD  1         P4I6NB           Next On Acct Ca
      * RTV Check invc exists  RT - A/R Header  * Next On Acct#
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP4I6NB    WL0003           Invoice Number
     C                     EXSR SBRVGN
     C                     END                             *ITR
      * RMC this update was commented  on 6/5/18 -- i uncommentd it on 4/
      * RMC 4/18/22 USES SAME NUMBER SERIES AS CB/RB
      * RTV Next Charge Back# CH - Company Control  * 
     C                     EXSR SCCHRC
     C                     Z-ADDP4I6NB    #1CONB           Invoice Number
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     Z-ADDP4I6NB    #1CONB           Invoice Number
     C                     MOVEL'OA'      #1CEST           Invoice Suffix
     C                     MOVEL'E'       #1AJST           A/R Processing
     C                     MOVEL'O'       #1E3ST           Purge Status
      * RTV Company Name       RT - Company Name and Address  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1AIC3    WL0004           Company Number
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0005    #DAPTX    P      Name
      * RTV Bank Description   RT - Bank Master  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELP2G4CD    WL0006    P      Bank Code
     C                     EXSR SERVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0007    #DAUNA    P      Description
      * RTV Customer Name      RT - Customer  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1ANC7    WL0008           Ship To Custome
     C                     EXSR SFRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0009    #DAYTX    P      Customer Name
      * RTV Deposit Amounts    RT - A/R Bank Deposit  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELP2G4CD    WL0010    P      Bank Code
     C                     Z-ADDP2HXDT    WL0011           Deposit Date
     C                     Z-ADDP2YXNX    WL0012           Deposit Time
     C                     EXSR SGRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0013    P2UIVA           Deposit Amount
     C                     Z-ADDWL0014    P2UJVA           Total Cash Appl
     C                     Z-ADDWL0015    P2BHNB           Number of Depos
     C                     Z-ADDWL0016    P2BINB           Number of Appli
     C                     MOVELP2G4CD    #1G4CD           Bank Code
     C                     Z-ADDP2UIVA    #DUIVA           Deposit Amount
     C                     Z-ADDP2UJVA    #DUJVA           Total Cash Appl
     C                     Z-ADDP2HXDT    #DHXDT           Deposit Date
     C                     Z-ADDP2YXNX    #DYXNX           Deposit Time
     C           #DUIVA    SUB  #DUJVA    #DURVA           Remaining to Ap
     C                     Z-ADD*ZERO     P7PSVA           USR Cash Appl A
     C                     Z-ADDP1BSVA    #1BSVA           Transaction Amo
     C                     Z-ADDP1BSVA    #DFFVL           Check $ Remaini
     C                     Z-ADD*ZERO     WUK4VA           USR Transaction
     C                     MOVEL'Y'       P3WVST           Access Denied (
     C                     ELSE
      * If record does exist, flip to change mode
     C                     MOVEL'CHG'     W0PMD
      * Load screen fields from DBF
     C                     EXSR MBFL#1
      * USER: Initialize detail screen (existing record)
      * RTV Company Name       RT - Company Name and Address  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1AIC3    WL0004           Company Number
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0005    #DAPTX    P      Name
      * RTV Bank Description   RT - Bank Master  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELP2G4CD    WL0006    P      Bank Code
     C                     EXSR SERVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0007    #DAUNA    P      Description
      * RTV Customer Name      RT - Customer  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1ANC7    WL0008           Ship To Custome
     C                     EXSR SFRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0009    #DAYTX    P      Customer Name
      * RTV Deposit Amounts    RT - A/R Bank Deposit  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELP2G4CD    WL0010    P      Bank Code
     C                     Z-ADDP2HXDT    WL0011           Deposit Date
     C                     Z-ADDP2YXNX    WL0012           Deposit Time
     C                     EXSR SGRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0013    P2UIVA           Deposit Amount
     C                     Z-ADDWL0014    P2UJVA           Total Cash Appl
     C                     Z-ADDWL0015    P2BHNB           Number of Depos
     C                     Z-ADDWL0016    P2BINB           Number of Appli
     C                     Z-ADDP2UIVA    #DUIVA           Deposit Amount
     C                     MOVELP2G4CD    #1G4CD           Bank Code
     C                     Z-ADDP2UJVA    #DUJVA           Total Cash Appl
     C                     Z-ADDP2HXDT    #DHXDT           Deposit Date
     C                     Z-ADDP2YXNX    #DYXNX           Deposit Time
     C           #DUIVA    SUB  #DUJVA    #DURVA           Remaining to Ap
     C                     Z-ADDBDBSVA    P7PSVA           USR Cash Appl A
     C                     Z-ADDBDBSVA    WUBSVA           Transaction Amo
     C                     Z-ADDBDBSVA    WUK4VA           USR Transaction
     C                     MOVEL'Y'       P3WVST           Access Denied (
     C                     Z-ADDP1BSVA    #DFFVL           Check $ Remaini
     C                     END
      *..................................................
     C   99                GOTO BEEXIT
      *
     C           YPMTFD    IFEQ *BLANK
      * No error: Display and process details
     C                     EXSR CADSDA
     C                     END
      *
      *================================================================
     CSR         BEEXIT    ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C           YPMTFD    ORNE *BLANK
      * Select existing record
     C                     EXSR VACKRL
     C                     END
      * Check relations
      * Check restriction within
     C                     EXSR VBCKRL
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate key screen
      * Prompt company
      * CASE:
      *  - c1ANDc2
      *   |- c1    : KEY.*CMD key is CF04
      *   |- c2    : PGM.*Cursor field <IS> KEY.Company Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ 'V1AIC3'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL Company - plants   SR - Company Name and Address  * 
     C                     CALL 'PPF2SRR'              90  SEL Company - p
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0005  30       Company Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PPF2SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Prompt customer
      * CASE:
      *  - c1ANDc2
      *   |- c1    : KEY.*CMD key is CF04
      *   |- c2    : PGM.*Cursor field <IS> KEY.USR Customer Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ '#PIMNB'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL A/R Customer       SR - Customer  * 
     C                     CALL 'PDXESRR'              90  SEL A/R Custome
     C                     PARM *BLANK    W0RTN   7
     C           #PIMNB    PARM #PIMNB    WQ0006  70       Ship To Custome
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDXESRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
     C                     END                             *FI
      * Rtv Plant Co Status   RT - Company Defaults Internal  * 
     C                     EXSR SHRVGN
      * 05/11/07 JRB Removed hard coded companies
      * Check for plant company
      * CASE: LCL.Plant Company Sts is Plant Company
     C           YL0002    IFEQ 'P'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #1AIC3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    ZA0001           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0001           CD3 Ext Numeric
     C                     END                             *FI
      * Send message 'Company not found or Inva'
     C                     MOVEL'USR2270' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     Z-ADD#PIMNB    #1ANC7           A/R Customer Nu
      * Validate A/R customer
      * VAL A/R Customer       RT - Customer  * 
     C                     EXSR SIRVGN
      * Invalid A/R number
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,002                    *IF
      * Setup message data for message
      * Convert A/R Customer Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1ANC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1ANC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    ZA0002           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0002           CD7 Ext Numeric
     C                     END                             *FI
      * Send message 'A/R Customer invalid'
     C                     MOVEL'USR2110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         BFEXIT    ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
     C           W0TRN     DOWEQ'Y'
      * Convert internal to external form
     C                     EXSR MOCV#D
      * Display detail screen
     C                     EXSR CBEXFM
      * Process response to detail screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Redisplay previous screen
     C   12                CAS            CCDSPV
      * HOME: Reset screen fields
     C   30                CAS            CCDSPV
      * Process detail screen input
     C                     CAS            CFPRSC
     C                     END
     C           W0TRN     IFEQ 'R'
     C           W0PMD     IFEQ 'ADD'
     C                     EXSR MAIZ#1
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y1SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
     C                     EXFMT#RCDDTL1
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CBEXIT    ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
     C   30                MOVEL'R'       W0TRN
     C   12                MOVEL'K'       W0TRN
      *================================================================
     CSR         CCEXIT    ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate details
     C                     EXSR DCVLDL
      * QUIT if error:
     C   99                GOTO CFEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       CFEXIT
      * Prompt for confirmation
     C                     EXSR EAPMCF
      * Quit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO CFEXIT
     C                     END
      * No error: update record
     C                     EXSR EBPR##
      *================================================================
     CSR         CFEXIT    ENDSR
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      * Validate Order Number Ref and convert to internal.
      * CD7 Ext/Int
     C                     MOVELV1CAC7    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELV1CAC7    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ @CN,003                    *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #1CAC7           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #1CAC7           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate detail screen fields
      * *Set Cursor: DTL.Transaction Amount  (*Override=*YES)
     C                     Z-ADD015       W0ROW1
     C                     Z-ADD027       W0COL1
     C                     MOVEL'1'       W0OVR1           *YES
     C                     MOVEL'OA'      P5ESST           USR Invoice Suf
      * CASE: DTL.Transaction Amount GT DTL.Check $ Remaining
     C           #1BSVA    IFGT #DFFVL                     *IF
      * Setup message data for message
     C                     Z-ADD#1BSVA    ZA0003           Transaction Amo
      * Send message 'Trans Amount > check rem'
     C                     MOVEL'USR3468' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      * 12/28/07 PKD Do not allow negative On-Account.
      * CASE: DTL.Transaction Amount is less than zero
     C           #1BSVA    IFLT *ZERO                      *IF
      * Setup message data for message
     C                     Z-ADD#1BSVA    ZA0004           Transaction Amo
      * Send message 'Trans Amount Must be +'
     C                     MOVEL'USR3870' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      * Amounts have been applied to this record and trans can't be chang
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DTL.Adjustment Amount is not equal to zeros
      *   |- c2    : DTL.Amount Paid is not equal to zeros
      *   '-
     C           #1AIVA    IFNE *ZERO                      *IF
     C           #1AOVA    ORNE *ZERO                      *OR
      * CASE: DTL.Transaction Amount NE WRK.Transaction Amount
     C           #1BSVA    IFNE WUBSVA                     *IF
      * Setup message data for message
     C                     Z-ADD#1BSVA    ZA0005           Transaction Amo
      * Send message 'Trans. Amt. can't be chan'
     C                     MOVEL'USR2080' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Create -- check for A/R Header existance
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * VAL Invoice            RT - A/R Header  * 
     C                     EXSR SJRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ @CN,001                    *IF
      * Send message 'A/R Header             EX'
     C                     MOVEL'USR0175' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * Check relations
      * Check reference to A/R Adjustment Type
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Bank Master
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Customer
     C                     EXSR VECKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Salesperson
     C                     EXSR VFCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Sales Route
     C                     EXSR VGCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Customer
     C                     EXSR VHCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate detail screen relations
      * 11/23/01 Perform if Transaction amount was changed
      * CASE: DTL.Transaction Amount NE WRK.USR Transaction amount
     C           #1BSVA    IFNE WUK4VA                     *IF
      * CASE: PAR.USR Cash Appl Amount is Entered
     C           P7PSVA    IFGT *ZERO                      *IF
     C           #1BSVA    SUB  P7PSVA    P6PTVA           USR Cash Appl A
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#1BSVA    P6PTVA           USR Cash Appl A
     C                     END                             *FI
     C           #1AIVA    ADD  #1AOVA    P8U6VA           USR Amount Appl
     C           #1BSVA    SUB  P8U6VA    #1BGVA           Remaining Balan
      * RMC dont know why its doing this ->its getting updated to 0  sinc
     C                     Z-ADD#1BSVA    WUBSVA           Transaction Amo
     C                     END                             *FI
     C                     END
      * Transaction Amount required
     C           #1BSVA    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * A/R Check Number required
     C           #1CPTX    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EAPMCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert internal to external form
     C                     EXSR MOCV#D
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
      * Refresh screen
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
     C                     WRITE#RCDDTL1
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO EAEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      * Process add request
     C           W0PMD     CASEQ'ADD'     ECADRQ
      * Process update request
     C           W0PMD     CASNE'ADD'     EECHRQ
     C                     END
     C           W0RTN     IFEQ *BLANK
      * Restart program for next record
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * CRT A/R Header OA      CR - A/R Header  * 
     C                     EXSR SKCRRC
     C           W0RTN     IFEQ *BLANK
      * Send message '*Record added'
     C                     MOVEL'Y2U0011' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * CHG A/R Header for OA  CH - A/R Header  * 
     C                     EXSR SMCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Reset screen fields if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
     C           YBRDC     IFEQ 'Y'
      * Send message '*Record changed'
     C                     MOVEL'Y2U0012' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
     C                     SETON                     88    *
      * Disable key screen
     C                     SETOF                     87    *
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields and "neither" paramete
      *================================================================
     C                     MOVEL*BLANK    #1UHCD           Adjustment Type
     C                     Z-ADD*ZERO     #1AIVA           Adjustment Amou
     C                     Z-ADD*ZERO     #1AOVA           Amount Paid
     C                     Z-ADD*ZERO     #1BGVA           Remaining Balan
     C                     MOVEL*BLANK    #1AJST           A/R Processing
     C                     MOVEL*BLANK    #1E3ST           Purge Status
     C                     Z-ADD*ZERO     #1CKNB           G/L Document Nu
     C                     Z-ADD*ZERO     #1BKC7           Ship To Custome
     C                     MOVEL*BLANK    #1BCCD           Salesperson Cod
     C                     MOVEL*BLANK    #1R4CD           Sales Route Cod
     C                     Z-ADD*ZERO     #1B4DT           Transaction Dat
     C                     Z-ADD*ZERO     #1ATDT           Due Date
     C                     Z-ADD*ZERO     #1H0DT           Last Payment Da
     C                     Z-ADD*ZERO     #1H3DT           Original Inv fo
     C                     Z-ADD*ZERO     #1H4DT           Paid in Full Da
     C                     Z-ADD*ZERO     #1H5DT           Last G/L Post D
     C                     Z-ADD*ZERO     #1BSDY           Days to Pay
     C                     MOVEL*BLANK    #1UVST           EDI Status 1
     C                     MOVEL*BLANK    #1UWST           EDI Status 2
     C                     MOVEL*BLANK    #1UXST           EDI Status 3
     C                     Z-ADD*ZERO     #1AATM           Job Time
     C                     MOVEL*BLANK    #1AYNA           User Id
     C                     MOVEL*BLANK    #1A0NA           Job Name
     C                     Z-ADD*ZERO     #1AXDT           Job Date
     C                     MOVEL*BLANK    #1G4CD           Bank Code
     C                     MOVEL*BLANK    #DAUNA           Description
     C                     Z-ADD*ZERO     #DHXDT           Deposit Date
      * Clear external version also
     C                     Z-ADD*ZERO     VDHXDT
     C                     Z-ADD*ZERO     #DYXNX           Deposit Time
     C                     Z-ADD*ZERO     #DUIVA           Deposit Amount
     C                     Z-ADD*ZERO     #DUJVA           Total Cash Appl
     C                     Z-ADD*ZERO     #DURVA           Remaining to Ap
     C                     Z-ADD*ZERO     #DFFVL           Check $ Remaini
     C                     MOVEL*BLANK    #DAYTX           Customer Name
     C                     MOVEL*BLANK    #DAPTX           Company Name
     C                     MOVEL*BLANK    #1CEST           Invoice Suffix
     C                     Z-ADD*ZERO     #1BSVA           Transaction Amo
     C                     MOVEL*BLANK    #1CPTX           A/R Check Numbe
     C                     Z-ADD*ZERO     #1CAC7           Order Number Re
      * Clear external version also
     C                     MOVEL*BLANK    V1CAC7
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BDCPCW fields to screen
      *================================================================
     C                     MOVELBDUHCD    #1UHCD           Adjustment Type
     C                     Z-ADDBDAIVA    #1AIVA           Adjustment Amou
     C                     Z-ADDBDAOVA    #1AOVA           Amount Paid
     C                     Z-ADDBDBGVA    #1BGVA           Remaining Balan
     C                     MOVELBDAJST    #1AJST           A/R Processing
     C                     MOVELBDE3ST    #1E3ST           Purge Status
     C                     Z-ADDBDCKNB    #1CKNB           G/L Document Nu
     C                     Z-ADDBDBKC7    #1BKC7           Ship To Custome
     C                     MOVELBDBCCD    #1BCCD           Salesperson Cod
     C                     MOVELBDR4CD    #1R4CD           Sales Route Cod
     C                     Z-ADDBDB4DT    #1B4DT           Transaction Dat
     C                     Z-ADDBDATDT    #1ATDT           Due Date
     C                     Z-ADDBDH0DT    #1H0DT           Last Payment Da
     C                     Z-ADDBDH3DT    #1H3DT           Original Inv fo
     C                     Z-ADDBDH4DT    #1H4DT           Paid in Full Da
     C                     Z-ADDBDH5DT    #1H5DT           Last G/L Post D
     C                     Z-ADDBDBSDY    #1BSDY           Days to Pay
     C                     MOVELBDUVST    #1UVST           EDI Status 1
     C                     MOVELBDUWST    #1UWST           EDI Status 2
     C                     MOVELBDUXST    #1UXST           EDI Status 3
     C                     Z-ADDBDAATM    #1AATM           Job Time
     C                     MOVELBDAYNA    #1AYNA           User Id
     C                     MOVELBDA0NA    #1A0NA           Job Name
     C                     Z-ADDBDAXDT    #1AXDT           Job Date
     C                     MOVELBDG4CD    #1G4CD           Bank Code
     C                     Z-ADDBDANC7    #1ANC7           A/R Customer Nu
     C                     Z-ADDBDAIC3    #1AIC3           Company Number
     C                     Z-ADDBDCONB    #1CONB           Invoice Number
     C                     MOVELBDCEST    #1CEST           Invoice Suffix
     C                     Z-ADDBDBSVA    #1BSVA           Transaction Amo
     C                     MOVELBDCPTX    #1CPTX           A/R Check Numbe
     C                     Z-ADDBDCAC7    #1CAC7           Order Number Re
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialize key screen
      *================================================================
     C                     Z-ADDP1ANC7    #1ANC7           A/R Customer Nu
     C                     Z-ADDP1CONB    #1CONB           Invoice Number
     C                     Z-ADDP1AIC3    #1AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V1AIC3
     C                     Z-ADDP9IMNB    #PIMNB           USR Customer Nu
      * Check restriction within
     C                     EXSR VICKRL
      * USER: Initialize key screen
      * CASE: PAR.Company Number is Equal to zero
     C           P1AIC3    IFEQ *ZERO                      *IF
     C                     Z-ADDWUAIC3    #1AIC3           Company Number
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDP1AIC3    #1AIC3           Company Number
     C                     END                             *FI
      * E6933 DN  04/09/17-Default Company Based on A/R OA As of Date.
      * CASE: *OTHERWISE
      * RTV Numeric Value      RT - System Values  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL@CN,004   WL0017    P      System Value Co
     C                     EXSR SNRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0018    YL0004           System Value Nu
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.As of Date is not equal zero
      *   |- c2    : JOB.*Job date GE LCL.As of Date
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           YL0004    IFNE *ZERO                      *IF
     C           ##JDT     IFGE YL0004                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * RTV Numeric Value      RT - System Values  * 
      * Move input parameters to subroutine local variables.
     C                     MOVEL@CN,005   WL0017    P      System Value Co
     C                     EXSR SNRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0018    #1AIC3           System Value Nu
     C                     END                             *FI
     C                     Z-ADDP1ANC7    #1ANC7           A/R Customer Nu
     C                     Z-ADDP1ANC7    #PIMNB           USR Customer Nu
     C                     Z-ADDP1CONB    #1CONB           Invoice Number
      * New code to get next OA Invoice Number   6/04/2018 JBB E13125
      * CASE: PAR.Invoice Number is Equal to zero
     C           P1CONB    IFEQ *ZERO                      *IF
      * RMC 4/18/22 USES SAME NUMBER SERIES AS CB/RB
      * RTV Next CB Number     RT - Company Control  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD*ZERO     WL0001           Company Number
     C                     EXSR SARVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0002    P4I6NB           Next Charge Bac
     C                     ADD  1         P4I6NB           Next On Acct Ca
      * RTV Check invc exists  RT - A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP4I6NB    WL0003           Invoice Number
     C                     EXSR SBRVGN
      * DO WHILE: PGM.*Return code is *Record already exists
     C           W0RTN     DOWEQ@CN,001                    *DOW
     C                     ADD  1         P4I6NB           Next On Acct Ca
      * RTV Check invc exists  RT - A/R Header  * Next On Acct#
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP4I6NB    WL0003           Invoice Number
     C                     EXSR SBRVGN
     C                     END                             *ITR
      * RMC this update was commented  on 6/6/18 -- i uncommentd it on 4/
      * RMC 4/18/22 USES SAME NUMBER SERIES AS CB/RB
      * RTV Next Charge Back# CH - Company Control  * 
     C                     EXSR SOCHRC
     C                     Z-ADDP4I6NB    #1CONB           Invoice Number
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     END                             *FI
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         MNCV#K    BEGSR
      *================================================================
      * Convert fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #1AIC3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V1AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1AIC3           CD3 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#D    BEGSR
      *================================================================
      * Convert fields into external form
      *================================================================
      * Convert Deposit Date to display format
      * Convert date
     C           1000000   ADD  #DHXDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VDHXDT
      * Convert A/R Customer Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1ANC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1ANC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V1ANC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1ANC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #1AIC3    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#1AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V1AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1AIC3           CD3 Ext Numeric
     C                     END                             *FI
      * Convert Order Number Ref to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #1CAC7    IFNE 0                          *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#1CAC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V1CAC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V1CAC7           CD7 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Next CB Number     RT - Company Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           ASAIC3           Company Number
      * Setup key
     C                     Z-ADDWL0001    ASAIC3           Company Number
      * Establish starting position
     C           KRSSA     CHAIN@ASREGT              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0049' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     WL0002           Next Charge Bac
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDASIONB    WL0002           Next Charge Bac
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Check invc exists  RT - A/R Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WACONB    WQSB01           Invoice Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Invoice Number
      * Setup key
     C                     Z-ADDWL0003    WQSB01           Invoice Number
      * Establish starting position
     C           KRSSB     SETLL@BDCPP3                    *
     C           KRSSB     READE@BDCPP3                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0174' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C           KRSSB     READE@BDCPP3                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * RTV Next Charge Back# CH - Company Control  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  40       Current Account
     C                     Z-ADD*ZERO     WN0002  20       Current Account
     C                     Z-ADD*ZERO     WN0003  30       OM Week
     C                     Z-ADD*ZERO     WN0004  70       Next Order Numb
     C                     Z-ADD*ZERO     WN0005  70       Next Invoice Nu
     C                     Z-ADD*ZERO     WN0006  70       Next Credit Mem
     C                     Z-ADD*ZERO     WN0007  70       Next On Acct Ca
     C                     Z-ADD*ZERO     WN0008  70       Next Voucher Nu
     C                     Z-ADD*ZERO     WN0009  70       Next Customer #
     C                     Z-ADD*ZERO     WN0010  70       Next Inventory
     C                     Z-ADD*ZERO     WN0011  80       Next PFS Batch
     C                     Z-ADD*ZERO     WN0012  70       Next Contract/P
     C                     Z-ADD*ZERO     WN0013  60       Next HPB Batch
     C                     MOVEL*BLANK    WN0014  1        Auto Order Numb
     C                     MOVEL*BLANK    WN0015  1        Auto Voucher Nu
     C                     MOVEL*BLANK    WN0016  1        Auto Customers
     C                     MOVEL*BLANK    WN0017  1        Auto Inv. Ref.
     C                     Z-ADD*ZERO     WN0018  52       Manual Price Ac
     C                     Z-ADD*ZERO     WN0019  52       CoPk/FdSrv ManP
     C                     Z-ADD*ZERO     WN0020 112       Late Charge Min
     C                     MOVEL*BLANK    WN0021  1        Print Co Addr o
     C                     MOVEL*BLANK    WN0022  1        Credit Hold Sta
     C                     MOVEL*BLANK    WN0023  1        Allocate Credit
     C                     MOVEL*BLANK    WN0024 30        Message Line 1
     C                     MOVEL*BLANK    WN0025 30        Message Line 2
     C                     MOVEL*BLANK    WN0026 30        Message Line 3
     C                     MOVEL*BLANK    WN0027 30        Message Line 4
     C                     MOVEL*BLANK    WN0028  1        Age by Trans or
     C                     Z-ADD*ZERO     WN0029  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0030  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0031  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0032  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0033  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0034  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0035  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0036  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0037  30       Retention Perio
     C                     Z-ADD*ZERO     WN0038  30       Retention Perio
     C                     Z-ADD*ZERO     WN0039  30       Retention Perio
     C                     Z-ADD*ZERO     WN0040  30       Retention Perio
     C                     Z-ADD*ZERO     WN0041  30       Retention Perio
     C                     Z-ADD*ZERO     WN0042  70       Next Load ID
     C                     MOVEL*BLANK    WN0043  1        Auto Load Numbe
     C                     Z-ADD*ZERO     WN0044  70       Next Item Numbe
     C                     MOVEL*BLANK    WN0045  1        G/L Posted Code
     C                     Z-ADD*ZERO     WN0046  30       Production Numb
     C                     MOVEL*BLANK    WN0047  1        Freight by Poun
     C                     MOVEL*BLANK    WN0048  1        Price Audit Act
     C                     MOVEL*BLANK    WN0049 10        PRT Night Queue
     C                     MOVEL*BLANK    WN0050  1        EDI Status 1
     C                     MOVEL*BLANK    WN0051  1        EDI Status 2
     C                     MOVEL*BLANK    WN0052  1        EDI Status 3
     C                     MOVEL*BLANK    WN0053  1        Record Status
     C                     Z-ADD*ZERO     WN0054  60       Job Time
     C                     MOVEL*BLANK    WN0055 10        User Id
     C                     MOVEL*BLANK    WN0056 10        Job Name
     C                     Z-ADD*ZERO     WN0057  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @ASRECB
     C                     Z-ADD*ZERO     WBAIC3           Company Number
      *
     C           KLCHSC    KLIST
     C                     KFLD           WBAIC3           Company Number
     C           KLCHSC    CHAIN@ASRECB              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'CAASREL0'MDACP
     C                     MOVEL'@ASRECB' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QCAAS1    YARDCS
      * Move non-key fields to @ASRECB
     C                     Z-ADDP4I6NB    WBIONB           Next Charge Bac
      *
      * Set PGM.*Record Data Changed flag
     C           QCAAS1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WBAATM' defaulted for 'Job Time'.
      * Field '(DB1) WBAYNA' defaulted for 'User Id'.
      * Field '(DB1) WBA0NA' defaulted for 'Job Name'.
      * Field '(DB1) WBAXDT' defaulted for 'Job Date'.
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QCAAS1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@ASRECB                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKCAASREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Company Name       RT - Company Name and Address  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           ABAIC3           Company Number
      * Setup key
     C                     Z-ADDWL0004    ABAIC3           Company Number
      * Establish starting position
     C           KRSSD     CHAIN@ABREG3              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0003' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0005           Name
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELABADTX    WL0005           Name
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV Bank Description   RT - Bank Master  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           EBG4CD           Bank Code
      * Setup key
     C                     MOVELWL0006    EBG4CD           Bank Code
      * Establish starting position
     C           KRSSE     CHAIN@EBREVK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0850' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELEBAUNA    WL0007           Description
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV Customer Name      RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           BBBKC7           Ship To Custome
      * Setup key
     C                     Z-ADDWL0008    BBBKC7           Ship To Custome
      * Establish starting position
     C           KRSSF     CHAIN@BBREE9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0170' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0009           Customer Name
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBBAYTX    WL0009           Customer Name
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Deposit Amounts    RT - A/R Bank Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN J2G4CD    WQSG02           Bank Code
     C           *LIKE     DEFN J2HXDT    WQSG03           Deposit Date
     C           *LIKE     DEFN J2YXNX    WQSG04           Deposit Time
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG02           Bank Code
     C                     KFLD           WQSG03           Deposit Date
     C                     KFLD           WQSG04           Deposit Time
      * Setup key
     C                     MOVELWL0010    WQSG02           Bank Code
     C                     Z-ADDWL0011    WQSG03           Deposit Date
     C                     Z-ADDWL0012    WQSG04           Deposit Time
      * Establish starting position
     C           KRSSG     SETLL@J2CPCU                    *
     C           KRSSG     READE@J2CPCU                  90*
      * Data record not found
     C   90                MOVEL'USR2039' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDJ2UIVA    WL0013           Deposit Amount
     C                     Z-ADDJ2UJVA    WL0014           Total Cash Appl
     C                     Z-ADDJ2BHNB    WL0015           Number of Depos
     C                     Z-ADDJ2BINB    WL0016           Number of Appli
     C           KRSSG     READE@J2CPCU                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Rtv Plant Co Status   RT - Company Defaults Internal  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           JYAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    JYAIC3           Company Number
      * Establish starting position
     C           KRSSH     CHAIN@JYRECE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2025' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0002           Plant Company S
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELJYYISX    YL0002           Plant Company S
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * VAL A/R Customer       RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDANC7    WQSI01           A/R Customer Nu
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           A/R Customer Nu
      * Setup key
     C                     Z-ADD#1ANC7    WQSI01           A/R Customer Nu
      * Establish starting position
     C           KRSSI     SETLL@BBREXJ                    *
     C           KRSSI     READE@BBREXJ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0170' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     GOTO SIEXIT                     *QUIT
     C           KRSSI     READE@BBREXJ                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * VAL Invoice            RT - A/R Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WECONB           Invoice Number
     C                     KFLD           WECEST           Invoice Suffix
      * Setup key
     C                     Z-ADD#1AIC3    WEAIC3           Company Number
     C                     Z-ADD#1CONB    WECONB           Invoice Number
     C                     MOVEL#1CEST    WECEST           Invoice Suffix
      * Establish starting position
     C           KRSSJ     CHAIN@BDCPF7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0174' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     GOTO SJEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCRRC    BEGSR
      *================================================================
      * CRT A/R Header OA      CR - A/R Header  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0058  1        EDI Status 1
     C                     MOVEL*BLANK    WN0059  1        EDI Status 2
     C                     MOVEL*BLANK    WN0060  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0061  60       Job Time
     C                     MOVEL*BLANK    WN0062 10        User Id
     C                     MOVEL*BLANK    WN0063 10        Job Name
     C                     Z-ADD*ZERO     WN0064  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BDCPFG
     C                     Z-ADD#1AIC3    BDAIC3           Company Number
     C                     Z-ADD#1CONB    BDCONB           Invoice Number
     C                     MOVEL#1CEST    BDCEST           Invoice Suffix
     C                     MOVE *BLANK    BDUHCD           Adjustment Type
     C                     MOVEL'OA'      BDUHCD           Adjustment Type
     C                     Z-ADD#1BSVA    BDBSVA           Transaction Amo
     C                     Z-ADD#1AIVA    BDAIVA           Adjustment Amou
     C                     Z-ADD#1AOVA    BDAOVA           Amount Paid
     C                     Z-ADD#1BGVA    BDBGVA           Remaining Balan
     C                     MOVEL'E'       BDAJST           A/R Processing
     C                     MOVEL'O'       BDE3ST           Purge Status
     C                     MOVELP2G4CD    BDG4CD           Bank Code
     C                     Z-ADD#1CKNB    BDCKNB           G/L Document Nu
     C                     Z-ADD#1CAC7    BDCAC7           Order Number Re
     C                     Z-ADD#1BKC7    BDBKC7           Ship To Custome
     C                     MOVEL#1BCCD    BDBCCD           Salesperson Cod
     C                     MOVEL#1R4CD    BDR4CD           Sales Route Cod
     C                     Z-ADD##JDT     BDB4DT           Transaction Dat
     C                     Z-ADDP2HXDT    BDATDT           Due Date
     C                     Z-ADDP2HXDT    BDH0DT           Last Payment Da
     C                     Z-ADD#1H3DT    BDH3DT           Original Inv fo
     C                     Z-ADD#1H4DT    BDH4DT           Paid in Full Da
     C                     Z-ADD#1H5DT    BDH5DT           Last G/L Post D
     C                     Z-ADD#1ANC7    BDANC7           A/R Customer Nu
     C                     MOVEL#1CPTX    BDCPTX           A/R Check Numbe
     C                     Z-ADD#1BSDY    BDBSDY           Days to Pay
      *
      * USER: Processing before Data update
      * Set trans. type to Invoice
      * CASE: DB1.Invoice Suffix is Invoices
     C           BDCEST    IFEQ 'IN'                       *IF
     C                     MOVEL'INV'     BDUHCD           Adjustment Type
     C                     END                             *FI
      * Set trans. type to Credit Memo
      * CASE: DB1.Invoice Suffix is Credit Memos
     C           BDCEST    IFEQ 'CM'                       *IF
     C                     MOVEL'CRM'     BDUHCD           Adjustment Type
     C                     END                             *FI
      * Set trans. type to Debit Memo
      * CASE: DB1.Invoice Suffix is Debit Memos
     C           BDCEST    IFEQ 'DM'                       *IF
     C                     MOVEL'DBM'     BDUHCD           Adjustment Type
     C                     END                             *FI
      * Set trans. type to On Account Cash   -- Crt A/R Header OA 3/30/05
      * CASE: DB1.Invoice Suffix is On Account Cash
     C           BDCEST    IFEQ 'OA'                       *IF
     C                     MOVEL*BLANK    BDUHCD           Adjustment Type
     C                     MOVEL'OA'      BDUHCD           Adjustment Type
      * Crt A/R Header OA     CR - A/R Header OA  * 
     C                     EXSR SLCRRC
     C                     END                             *FI
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     BDAATM           Job Time
     C                     MOVEL##USR     BDAYNA           User Id
     C                     MOVEL##JOB     BDA0NA           Job Name
     C                     Z-ADD##JDT     BDAXDT           Job Date
     C                     MOVEL##PGM     BDA0NA           Job Name
     C                     MOVEL'N'       P3WVST           Access Denied (
     C           KLCRSK    KLIST
     C                     KFLD           BDAIC3           Company Number
     C                     KFLD           BDCONB           Invoice Number
     C                     KFLD           BDCEST           Invoice Suffix
      * Check for duplicate primary key
     C           KLCRSK    SETLL@BDCPFG                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR0175' W0RTN   7
      * Send message 'A/R Header             EX'
     C                     MOVEL'USR0175' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C                     WRITE@BDCPFG                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * E6933 DN  08/12/16 - Create A/R Header Ext record.
      * Crt A/R Header Ext    XF - A/R Header Ext  * 
     C                     CALL 'PBX3XFR'              90  Crt A/R Header
     C                     PARM *BLANK    W0RTN   7
     C                     PARM BDAIC3    WQ0016  30       Company Number
     C                     PARM BDCONB    WQ0017  70       Invoice Number
     C                     PARM BDCEST    WQ0018  2        Invoice Suffix
     C                     PARM BDBGVA    WQ0019 112       Remaining Balan
     C                     PARM BDCAC7    WQ0020  70       Order Number Re
     C                     PARM BDH3DT    WQ0021  70       Original Inv fo
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PBX3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLCRRC    BEGSR
      *================================================================
      * Crt A/R Header OA     CR - A/R Header OA  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @A4CPX6
     C                     Z-ADDBDAIC3    A4AIC3           Company Number
     C                     Z-ADDBDCONB    A4CONB           Invoice Number
     C                     MOVELBDCEST    A4CEST           Invoice Suffix
     C                     MOVELBDG4CD    A4G4CD           Bank Code
     C                     Z-ADD#DHXDT    A4HXDT           Deposit Date
     C                     Z-ADD#DYXNX    A4YXNX           Deposit Time
     C                     MOVEL*BLANK    A4UTSX           OA Unused Sts
      *
     C           KLCRSL    KLIST
     C                     KFLD           A4AIC3           Company Number
     C                     KFLD           A4CONB           Invoice Number
     C                     KFLD           A4CEST           Invoice Suffix
      * Check for duplicate primary key
     C           KLCRSL    SETLL@A4CPX6                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3461' W0RTN   7
      * Send message 'A/R Header OA          EX'
     C                     MOVEL'USR3461' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C                     WRITE@A4CPX6                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMCHRC    BEGSR
      *================================================================
      * CHG A/R Header for OA  CH - A/R Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0065  60       Job Time
     C                     MOVEL*BLANK    WN0066 10        User Id
     C                     MOVEL*BLANK    WN0067 10        Job Name
     C                     Z-ADD*ZERO     WN0068  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @BDCPFG
     C                     Z-ADD#1AIC3    BDAIC3           Company Number
     C                     Z-ADD#1CONB    BDCONB           Invoice Number
     C                     MOVEL#1CEST    BDCEST    P      Invoice Suffix
      *
     C           KLCHSM    KLIST
     C                     KFLD           BDAIC3           Company Number
     C                     KFLD           BDCONB           Invoice Number
     C                     KFLD           BDCEST           Invoice Suffix
     C           KLCHSM    CHAIN@BDCPFG              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'ARBDCPL0'MDACP
     C                     MOVEL'@BDCPFG' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SMEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SMEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKARBDCPL0               91  *
     C                     GOTO SMEXIT
     C                     ENDIF                           FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YBRDCS
      * Move non-key fields to @BDCPFG
     C                     MOVEL#1UHCD    BDUHCD    P      Adjustment Type
     C                     Z-ADD#1BSVA    BDBSVA           Transaction Amo
     C                     Z-ADD#1AIVA    BDAIVA           Adjustment Amou
     C                     Z-ADD#1AOVA    BDAOVA           Amount Paid
     C                     Z-ADD#1BGVA    BDBGVA           Remaining Balan
     C                     MOVEL#1AJST    BDAJST    P      A/R Processing
     C                     MOVEL#1E3ST    BDE3ST    P      Purge Status
     C                     MOVEL#1G4CD    BDG4CD    P      Bank Code
     C                     Z-ADD#1CKNB    BDCKNB           G/L Document Nu
     C                     Z-ADD#1CAC7    BDCAC7           Order Number Re
     C                     Z-ADD#1BKC7    BDBKC7           Ship To Custome
     C                     MOVEL#1BCCD    BDBCCD    P      Salesperson Cod
     C                     MOVEL#1R4CD    BDR4CD    P      Sales Route Cod
     C                     Z-ADD#1B4DT    BDB4DT           Transaction Dat
     C                     Z-ADD#1ATDT    BDATDT           Due Date
     C                     Z-ADD#1H0DT    BDH0DT           Last Payment Da
     C                     Z-ADD#1H3DT    BDH3DT           Original Inv fo
     C                     Z-ADD#1H4DT    BDH4DT           Paid in Full Da
     C                     Z-ADD#1H5DT    BDH5DT           Last G/L Post D
     C                     Z-ADD#1ANC7    BDANC7           A/R Customer Nu
     C                     MOVEL#1CPTX    BDCPTX    P      A/R Check Numbe
     C                     Z-ADD#1BSDY    BDBSDY           Days to Pay
     C                     MOVEL#1UVST    BDUVST    P      EDI Status 1
     C                     MOVEL#1UWST    BDUWST    P      EDI Status 2
     C                     MOVEL#1UXST    BDUXST    P      EDI Status 3
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) BDAATM' defaulted for 'Job Time'.
      * Field '(DB1) BDAYNA' defaulted for 'User Id'.
      * Field '(DB1) BDA0NA' defaulted for 'Job Name'.
      * Field '(DB1) BDAXDT' defaulted for 'Job Date'.
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     BDAATM           Job Time
     C                     MOVEL##USR     BDAYNA           User Id
     C                     MOVEL##JOB     BDA0NA           Job Name
     C                     Z-ADD##JDT     BDAXDT           Job Date
     C                     MOVEL'N'       P3WVST           Access Denied (
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@BDCPFG                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKARBDCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * RTV Numeric Value      RT - System Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           DPDOCD           System Value Co
      * Setup key
     C                     MOVELWL0017    DPDOCD           System Value Co
      * Establish starting position
     C           KRSSN     CHAIN@DPRETD              90    *
      * Data record not found
     C   90                MOVEL'USR0759' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDDPM8NB    WL0018           System Value Nu
     C                     GOTO SNEXIT                     *QUIT
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SOCHRC    BEGSR
      *================================================================
      * RTV Next Charge Back# CH - Company Control  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0069  40       Current Account
     C                     Z-ADD*ZERO     WN0070  20       Current Account
     C                     Z-ADD*ZERO     WN0071  30       OM Week
     C                     Z-ADD*ZERO     WN0072  70       Next Order Numb
     C                     Z-ADD*ZERO     WN0073  70       Next Invoice Nu
     C                     Z-ADD*ZERO     WN0074  70       Next Credit Mem
     C                     Z-ADD*ZERO     WN0075  70       Next On Acct Ca
     C                     Z-ADD*ZERO     WN0076  70       Next Voucher Nu
     C                     Z-ADD*ZERO     WN0077  70       Next Customer #
     C                     Z-ADD*ZERO     WN0078  70       Next Inventory
     C                     Z-ADD*ZERO     WN0079  80       Next PFS Batch
     C                     Z-ADD*ZERO     WN0080  70       Next Contract/P
     C                     Z-ADD*ZERO     WN0081  60       Next HPB Batch
     C                     MOVEL*BLANK    WN0082  1        Auto Order Numb
     C                     MOVEL*BLANK    WN0083  1        Auto Voucher Nu
     C                     MOVEL*BLANK    WN0084  1        Auto Customers
     C                     MOVEL*BLANK    WN0085  1        Auto Inv. Ref.
     C                     Z-ADD*ZERO     WN0086  52       Manual Price Ac
     C                     Z-ADD*ZERO     WN0087  52       CoPk/FdSrv ManP
     C                     Z-ADD*ZERO     WN0088 112       Late Charge Min
     C                     MOVEL*BLANK    WN0089  1        Print Co Addr o
     C                     MOVEL*BLANK    WN0090  1        Credit Hold Sta
     C                     MOVEL*BLANK    WN0091  1        Allocate Credit
     C                     MOVEL*BLANK    WN0092 30        Message Line 1
     C                     MOVEL*BLANK    WN0093 30        Message Line 2
     C                     MOVEL*BLANK    WN0094 30        Message Line 3
     C                     MOVEL*BLANK    WN0095 30        Message Line 4
     C                     MOVEL*BLANK    WN0096  1        Age by Trans or
     C                     Z-ADD*ZERO     WN0097  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0098  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0099  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0100  30       A/P Aging Days
     C                     Z-ADD*ZERO     WN0101  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0102  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0103  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0104  30       A/R Aging Days
     C                     Z-ADD*ZERO     WN0105  30       Retention Perio
     C                     Z-ADD*ZERO     WN0106  30       Retention Perio
     C                     Z-ADD*ZERO     WN0107  30       Retention Perio
     C                     Z-ADD*ZERO     WN0108  30       Retention Perio
     C                     Z-ADD*ZERO     WN0109  30       Retention Perio
     C                     Z-ADD*ZERO     WN0110  70       Next Load ID
     C                     MOVEL*BLANK    WN0111  1        Auto Load Numbe
     C                     Z-ADD*ZERO     WN0112  70       Next Item Numbe
     C                     MOVEL*BLANK    WN0113  1        G/L Posted Code
     C                     Z-ADD*ZERO     WN0114  30       Production Numb
     C                     MOVEL*BLANK    WN0115  1        Freight by Poun
     C                     MOVEL*BLANK    WN0116  1        Price Audit Act
     C                     MOVEL*BLANK    WN0117 10        PRT Night Queue
     C                     MOVEL*BLANK    WN0118  1        EDI Status 1
     C                     MOVEL*BLANK    WN0119  1        EDI Status 2
     C                     MOVEL*BLANK    WN0120  1        EDI Status 3
     C                     MOVEL*BLANK    WN0121  1        Record Status
     C                     Z-ADD*ZERO     WN0122  60       Job Time
     C                     MOVEL*BLANK    WN0123 10        User Id
     C                     MOVEL*BLANK    WN0124 10        Job Name
     C                     Z-ADD*ZERO     WN0125  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @ASRECB
     C                     Z-ADD*ZERO     WBAIC3           Company Number
      *
     C           KLCHSO    KLIST
     C                     KFLD           WBAIC3           Company Number
     C           KLCHSO    CHAIN@ASRECB              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'CAASREL0'MDACP
     C                     MOVEL'@ASRECB' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SOEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SOEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QCAAS1    YCRDCS
      * Move non-key fields to @ASRECB
     C                     Z-ADDP4I6NB    WBIONB           Next Charge Bac
      *
      * Set PGM.*Record Data Changed flag
     C           QCAAS1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WBAATM' defaulted for 'Job Time'.
      * Field '(DB1) WBAYNA' defaulted for 'User Id'.
      * Field '(DB1) WBA0NA' defaulted for 'Job Name'.
      * Field '(DB1) WBAXDT' defaulted for 'Job Date'.
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QCAAS1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@ASRECB                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKCAASREL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * CHG Cash Applied       RT - A/R Bank Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN J2G4CD    WQSP02           Bank Code
     C           *LIKE     DEFN J2HXDT    WQSP03           Deposit Date
     C           *LIKE     DEFN J2YXNX    WQSP04           Deposit Time
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP02           Bank Code
     C                     KFLD           WQSP03           Deposit Date
     C                     KFLD           WQSP04           Deposit Time
      * Setup key
     C                     MOVELP2G4CD    WQSP02           Bank Code
     C                     Z-ADDP2HXDT    WQSP03           Deposit Date
     C                     Z-ADDP2YXNX    WQSP04           Deposit Time
      * Establish starting position
     C           KRSSP     SETLL@J2CPCU                    *
     C           KRSSP     READE@J2CPCU                  90*
      * Data record not found
     C   90                MOVEL'USR2039' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WUTYVA    ADD  J2UJVA    WUUJVA           Total Cash Appl
      * CHG Cash Applied Field CH - A/R Bank Deposit  * 
     C                     EXSR SQCHRC
     C           KRSSP     READE@J2CPCU                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQCHRC    BEGSR
      *================================================================
      * CHG Cash Applied Field CH - A/R Bank Deposit  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0126 112       Deposit Amount
     C                     Z-ADD*ZERO     WN0127  80       G/L Document Nu
     C                     Z-ADD*ZERO     WN0128  50       Number of Depos
     C                     Z-ADD*ZERO     WN0129  50       Number of Appli
     C                     Z-ADD*ZERO     WN0130  70       G/L Post Date
     C                     MOVEL*BLANK    WN0131  1        EDI Status 1
     C                     MOVEL*BLANK    WN0132  1        EDI Status 2
     C                     MOVEL*BLANK    WN0133  1        EDI Status 3
     C                     MOVEL*BLANK    WN0134  1        Record Status
     C                     Z-ADD*ZERO     WN0135  60       Job Time
     C                     MOVEL*BLANK    WN0136 10        User Id
     C                     MOVEL*BLANK    WN0137 10        Job Name
     C                     Z-ADD*ZERO     WN0138  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @J2CPCM
     C                     MOVELJ2G4CD    WGG4CD    P      Bank Code
     C                     Z-ADDJ2HXDT    WGHXDT           Deposit Date
     C                     Z-ADDJ2YXNX    WGYXNX           Deposit Time
      *
     C           KLCHSQ    KLIST
     C                     KFLD           WGG4CD           Bank Code
     C                     KFLD           WGHXDT           Deposit Date
     C                     KFLD           WGYXNX           Deposit Time
     C           KLCHSQ    CHAIN@J2CPCM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDJ2CPL0'MDACP
     C                     MOVEL'@J2CPCM' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SQEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPDJ21    YDRDCS
      * Move non-key fields to @J2CPCM
     C                     Z-ADDWUUJVA    WGUJVA           Total Cash Appl
     C                     MOVEL'E'       WGAJST    P      A/R Processing
     C                     Z-ADDJ2E2VL    WGE2VL           CD TF Internal
     C                     Z-ADDJ2E3VL    WGE3VL           CD TF Immediate
     C                     Z-ADDJ2E4VL    WGE4VL           CD TF 1 Day Fun
     C                     Z-ADDJ2E5VL    WGE5VL           CD TF 2 Day Fun
     C                     Z-ADDJ2E6VL    WGE6VL           CD SB Exempt Im
     C                     Z-ADDJ2E7VL    WGE7VL           CD SB 1 Day Exe
     C                     Z-ADDJ2E8VL    WGE8VL           CD SB 2 Day Exe
     C                     Z-ADDJ2E9VL    WGE9VL           SBD Exempt Tota
     C                     Z-ADDJ2FAVL    WGFAVL           ARBD Unused Amt
     C                     Z-ADDJ2FBVL    WGFBVL           ARBD Unused Amt
     C                     Z-ADDJ2FCVL    WGFCVL           ARBD Unused Amt
     C                     Z-ADDJ2FDVL    WGFDVL           ARBD Unused Amt
      *
      * Set PGM.*Record Data Changed flag
     C           QPDJ21    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@J2CPCM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDJ2CPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0139    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSR     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SREXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    P3I6ST           Allow Multi-Com
     C                     MOVELDRMPNA    P3MPNA           Default Printer
     C                     MOVELDRBCCD    P3BCCD           Salesperson Cod
     C                     Z-ADDDRAIC3    YL0005           Company Number
     C                     MOVELDRBUVN    WN0140           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - User Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWL0019    DTAJVN           User Profile Na
     C                     MOVELWL0020    DTDNCD           Application Cod
      * Establish starting position
     C           KRSSS     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WL0021           Company Number
     C                     MOVELDTAJCD    WL0022           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQST01           Application Cod
      * Define keylist
     C           KRSST     KLIST
     C                     KFLD           WQST01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQST01           Application Cod
     C                     MOVEL'A/R'     WQST01           Application Cod
      * Establish starting position
     C           KRSST     SETLL@DNRESF                    *
     C           KRSST     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SURVGN
     C                     END                             *FI
     C           KRSST     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SURVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSU01           Application Cod
      * Define keylist
     C           KRSSU     KLIST
     C                     KFLD           WQSU01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSU01           Application Cod
      * Establish starting position
     C           KRSSU     SETLL@DNRESF                    *
     C           KRSSU     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SUEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSU     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Select existing record
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#1ANC7'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(KEY) #1AIC3' defaulted for 'Company Number'.
      * Field '(KEY) #1CONB' defaulted for 'Invoice Number'.
     W* Y2W0052 - One or more arguments defaulted to WRK/CON context.
      * Field '(LCL) YL0001' defaulted for 'Invoice Suffix'.
     C                     CALL 'PDPGSRR'              90  SEL A/R Header
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1AIC3    WQ0001  30       Company Number
     C           #1CONB    PARM #1CONB    WQ0002  70       Invoice Number
     C           YL0001    PARM YL0001    WQ0003  2        Invoice Suffix
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPGSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1ANC7    IFNE *ZERO                      A/R Customer Nu
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVELV1AIC3    WK1X01  1
     C           WK1X01    IFEQ '?'                        Company Number
     C           YPMTFD    OREQ '#1AIC3'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(KEY) #1AIC3' defaulted for 'Company Number'.
     C                     CALL 'PDL7SRR'              90  SEL Co - Rtn 0
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0004  30       Company Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL7SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VB999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVBWC    KLIST
     C                     KFLD           WCAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    WCAIC3
     C           KLVBWC    CHAIN@ABREAK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
     C           VB999     TAG
      * Restrictor relation not satisfied
      * Send message 'Company Name and Addre NF'
     C                     MOVEL'USR0003' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'USR0003' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to A/R Adjustment Type
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1UHCD    WK1X02  1
     C           WK1X02    IFEQ '?'                        Adjustment Type
     C           YPMTFD    OREQ '#1UHCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1AIC3' defaulted for 'Company Number'.
      * Field '(DTL) #1UHCD' defaulted for 'Adjustment Type Code'.
     C                     CALL 'PDJKSRR'              90  SEL Lckbx Type
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1AIC3    WQ0007  30       Company Number
     C           #1UHCD    PARM #1UHCD    WQ0008  3        Adjustment Type
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDJKSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1UHCD    IFNE *BLANK                     Adjustment Type
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1UHCD    IFEQ *BLANK                     Adjustment Type
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCJ3    KLIST
     C                     KFLD           J3AIC3           Company Number
     C                     KFLD           J3UHCD           Adjustment Type
      * Setup key
     C                     Z-ADD#1AIC3    J3AIC3
     C                     MOVEL#1UHCD    J3UHCD
     C           KLVCJ3    CHAIN@J3CPCQ              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'A/R Adjustment Type    NF'
     C                     MOVEL'USR2041' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR2041' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Bank Master
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1G4CD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Bank Code
     C           YPMTFD    OREQ '#1G4CD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1G4CD' defaulted for 'Bank Code'.
     C                     CALL 'PDD8SRR'              90  SEL Bank Master
     C                     PARM *BLANK    W0RTN   7
     C           #1G4CD    PARM #1G4CD    WQ0009  6        Bank Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDD8SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1G4CD    IFNE *BLANK                     Bank Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1G4CD    IFEQ *BLANK                     Bank Code
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDWF    KLIST
     C                     KFLD           WFG4CD           Bank Code
      * Setup key
     C                     MOVEL#1G4CD    WFG4CD
     C           KLVDWF    CHAIN@EBREVP              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Bank Master            NF'
     C                     MOVEL'USR0850' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0850' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         VECKRL    BEGSR
      *================================================================
      * Check reference to Customer
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C           YPMTFD    IFEQ '#1BKC7'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1ANC7' defaulted for 'A/R Customer Number'.
     W* Y2W0052 - One or more arguments defaulted to WRK/CON context.
      * Field '(LCL) YL0003' defaulted for 'G/L Vendor Number USR'.
     C                     CALL 'PMFRSRR'              90  SEL A/R Cust W/
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1ANC7    WQ0010  70       A/R Customer Nu
     C           YL0003    PARM *ZERO     WQ0011  80       G/L Vendor Numb
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMFRSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1BKC7    IFNE *ZERO                      Ship To Custome
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VEEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BKC7    IFEQ *ZERO                      Ship To Custome
     C                     GOTO VEEXIT
     C                     END
      *
     C           KLVEBB    KLIST
     C                     KFLD           BBBKC7           Ship To Custome
      * Setup key
     C                     Z-ADD#1BKC7    BBBKC7
     C           KLVEBB    CHAIN@BBREE9              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VEEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VEEXIT
     C                     END
      * Send message 'Customer               NF'
     C                     MOVEL'USR0170' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0170' W0RTN
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         VFCKRL    BEGSR
      *================================================================
      * Check reference to Salesperson
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BCCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Salesperson Cod
     C           YPMTFD    OREQ '#1BCCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1BCCD' defaulted for 'Salesperson Code'.
     C                     CALL 'CABYSRR'              90  SEL Active Sale
     C                     PARM *BLANK    W0RTN   7
     C           #1BCCD    PARM #1BCCD    WQ0012  3        Salesperson Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'CABYSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1BCCD    IFNE *BLANK                     Salesperson Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VFEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BCCD    IFEQ *BLANK                     Salesperson Cod
     C                     GOTO VFEXIT
     C                     END
      *
     C           KLVFAP    KLIST
     C                     KFLD           APBCCD           Salesperson Cod
      * Setup key
     C                     MOVEL#1BCCD    APBCCD
     C           KLVFAP    CHAIN@APREBU              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VFEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VFEXIT
     C                     END
      * Send message 'Salesperson            NF'
     C                     MOVEL'USR0039' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0039' W0RTN
      *================================================================
     CSR         VFEXIT    ENDSR
      /EJECT
     CSR         VGCKRL    BEGSR
      *================================================================
      * Check reference to Sales Route
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1R4CD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Sales Route Cod
     C           YPMTFD    OREQ '#1R4CD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1R4CD' defaulted for 'Sales Route Code'.
     C                     CALL 'PDFWSRR'              90  SEL PD Sales Ro
     C                     PARM *BLANK    W0RTN   7
     C           #1R4CD    PARM #1R4CD    WQ0013  3        Sales Route Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDFWSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1R4CD    IFNE *BLANK                     Sales Route Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VGEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1R4CD    IFEQ *BLANK                     Sales Route Cod
     C                     GOTO VGEXIT
     C                     END
      *
     C           KLVGJE    KLIST
     C                     KFLD           JER4CD           Sales Route Cod
      * Setup key
     C                     MOVEL#1R4CD    JER4CD
     C           KLVGJE    CHAIN@JEREWF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VGEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VGEXIT
     C                     END
      * Send message 'Sales Route            NF'
     C                     MOVEL'USR1800' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1800' W0RTN
      *================================================================
     CSR         VGEXIT    ENDSR
      /EJECT
     CSR         VHCKRL    BEGSR
      *================================================================
      * Check reference to Customer
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVELV1ANC7    WK1X01  1
     C           WK1X01    IFEQ '?'                        Ship To Custome
     C           YPMTFD    OREQ '#1ANC7'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1ANC7' defaulted for 'A/R Customer Number'.
     W* Y2W0052 - One or more arguments defaulted to WRK/CON context.
      * Field '(LCL) YL0003' defaulted for 'G/L Vendor Number USR'.
     C                     CALL 'PMFRSRR'              90  SEL A/R Cust W/
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1ANC7    WQ0014  70       A/R Customer Nu
     C           YL0003    PARM *ZERO     WQ0015  80       G/L Vendor Numb
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMFRSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1ANC7    IFNE *ZERO                      Ship To Custome
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VHEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ANC7    IFEQ *ZERO                      Ship To Custome
     C                     GOTO VHEXIT
     C                     END
      *
     C           KLVHBB    KLIST
     C                     KFLD           BBBKC7           Ship To Custome
      * Setup key
     C                     Z-ADD#1ANC7    BBBKC7
     C           KLVHBB    CHAIN@BBREE9              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VHEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VHEXIT
     C                     END
      * Send message 'Customer               NF'
     C                     MOVEL'USR0170' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0170' W0RTN
      *================================================================
     CSR         VHEXIT    ENDSR
      /EJECT
     CSR         VICKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVELV1AIC3    WK1X01  1
     C           WK1X01    IFEQ '?'                        Company Number
     C           YPMTFD    OREQ '#1AIC3'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(KEY) #1AIC3' defaulted for 'Company Number'.
     C                     CALL 'PDL7SRR'              90  SEL Co - Rtn 0
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0022  30       Company Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL7SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VI999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVIWC    KLIST
     C                     KFLD           WCAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    WCAIC3
     C           KLVIWC    CHAIN@ABREAK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VIEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VIEXIT
     C                     END
     C           VI999     TAG
      * Restrictor relation not satisfied
      * Send message 'Company Name and Addre NF'
     C                     MOVEL'USR0003' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'USR0003' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VIEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y1SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
     C           *IN25     IFEQ '0'
      * Bypass when help done
     C                     SETOF                     94    *
     C           W0OVR1    IFEQ '1'
     C           W0OVR1    OREQ '0'
     C           *IN99     ANDEQ'0'
      * If override or no error
     C                     SETON                     94    *
     C                     Z-ADDW0ROW1    ZZCSRW
     C                     Z-ADDW0COL1    ZZCSCL
     C                     END
     C                     END
      *================================================================
     CSR         Y1EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C           @#DFMT    IFEQ '#RCDKEY'
      * KEY Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     ENDIF
     C                     ENDIF
     C           @#DFMT    IFEQ '#RCDDTL1'
      * DETAIL Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW1END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW1BEG,F
     C                     MOVELW1NAM,F   W0CFL
     C                     ENDIF
     C                     ENDIF
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
     C                     SETOF                     94    *
     C                     Z-ADD0         W0ROW1  30
     C                     Z-ADD0         W0COL1  30
     C                     MOVE '2'       W0OVR1  1
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * New 12/17/01
      * CASE: DTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y'       P3WVST           Access Denied (
     C                     END                             *FI
      * CASE: PAR.Access Denied (Y/N) is no
     C           P3WVST    IFEQ 'N'                        *IF
      * CASE: WRK.USR Transaction amount NE WRK.Transaction Amount
     C           WUK4VA    IFNE WUBSVA                     *IF
     C                     ADD  WUBSVA    P8UWVA           USR Cust Apply
      * RMC 5/23/06 adj deposit by the diff in the trans amt
     C           WUBSVA    SUB  WUK4VA    WUTYVA           USR Differentia
      * CHG Cash Applied       RT - A/R Bank Deposit  * 
     C                     EXSR SPRVGN
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2UIVA           Deposit Amount
     C                     Z-ADD*ZERO     P2UJVA           Total Cash Appl
     C                     Z-ADD*ZERO     P2BHNB           Number of Depos
     C                     Z-ADD*ZERO     P2BINB           Number of Appli
     C                     MOVEL*BLANK    P3AJCD           Warehouse Code
     C                     MOVEL*BLANK    P3DNCD           Application Cod
     C                     MOVEL*BLANK    P3BCCD           Salesperson Cod
     C                     MOVEL*BLANK    P3B8NA           System Date For
     C                     MOVEL*BLANK    P3AJVN           User Profile Na
     C                     MOVEL*BLANK    P3I6ST           Allow Multi-Com
     C                     MOVEL*BLANK    P3MPNA           Default Printer
     C                     MOVEL*BLANK    P3WVST           Access Denied (
     C                     Z-ADD*ZERO     P4I6NB           Next On Acct Ca
     C                     MOVEL*BLANK    P5ESST           USR Invoice Suf
     C                     Z-ADD*ZERO     P7PSVA           USR Cash Appl A
     C                     Z-ADD*ZERO     P8U6VA           USR Amount Appl
     C                     Z-ADD*ZERO     P9IMNB           USR Customer Nu
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WABSVA           Transaction Amo
     C                     Z-ADD*ZERO     WAAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WAAOVA           Amount Paid
     C                     Z-ADD*ZERO     WABGVA           Remaining Balan
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WACAC7           Order Number Re
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WAATDT           Due Date
     C                     Z-ADD*ZERO     WAH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WAH3DT           Original Inv fo
     C                     Z-ADD*ZERO     WAH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WAH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABSDY           Days to Pay
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBAXNB           Current Account
     C                     Z-ADD*ZERO     WBNGNB           Current Account
     C                     Z-ADD*ZERO     WBBZNB           OM Week
     C                     Z-ADD*ZERO     WBC5NB           Next Order Numb
     C                     Z-ADD*ZERO     WBC3NB           Next Invoice Nu
     C                     Z-ADD*ZERO     WBCYNB           Next Credit Mem
     C                     Z-ADD*ZERO     WBIONB           Next Charge Bac
     C                     Z-ADD*ZERO     WBI6NB           Next On Acct Ca
     C                     Z-ADD*ZERO     WBDCNB           Next Voucher Nu
     C                     Z-ADD*ZERO     WBC7NB           Next Customer #
     C                     Z-ADD*ZERO     WBC2NB           Next Inventory
     C                     Z-ADD*ZERO     WBC1NB           Next PFS Batch
     C                     Z-ADD*ZERO     WBL8NB           Next Contract/P
     C                     Z-ADD*ZERO     WBBANB           Next HPB Batch
     C                     Z-ADD*ZERO     WBAIPC           Manual Price Ac
     C                     Z-ADD*ZERO     WBASPC           CoPk/FdSrv ManP
     C                     Z-ADD*ZERO     WBA2VA           Late Charge Min
     C                     Z-ADD*ZERO     WBAADY           A/P Aging Days
     C                     Z-ADD*ZERO     WBABDY           A/P Aging Days
     C                     Z-ADD*ZERO     WBACDY           A/P Aging Days
     C                     Z-ADD*ZERO     WBADDY           A/P Aging Days
     C                     Z-ADD*ZERO     WBAEDY           A/R Aging Days
     C                     Z-ADD*ZERO     WBAFDY           A/R Aging Days
     C                     Z-ADD*ZERO     WBAGDY           A/R Aging Days
     C                     Z-ADD*ZERO     WBAHDY           A/R Aging Days
     C                     Z-ADD*ZERO     WBAENB           Retention Perio
     C                     Z-ADD*ZERO     WBALNB           Retention Perio
     C                     Z-ADD*ZERO     WBEVNB           Retention Perio
     C                     Z-ADD*ZERO     WBRPOP           Retention Perio
     C                     Z-ADD*ZERO     WBDWNB           Retention Perio
     C                     Z-ADD*ZERO     WBR3NB           Next Load ID
     C                     Z-ADD*ZERO     WBR4NB           Next Item Numbe
     C                     Z-ADD*ZERO     WBSCNB           Production Numb
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Define work field USR Transaction amount
     C                     Z-ADD*ZERO     WUK4VA 112
      * Define work field Transaction Amount
     C                     Z-ADD*ZERO     WUBSVA 112
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDP3NB           D & B Number
     C                     Z-ADD*ZERO     WDI6DT           Date of D & B R
     C                     Z-ADD*ZERO     WDAYDT           Credit Line Exp
     C                     Z-ADD*ZERO     WDANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WDBTC7           Parent Customer
     C                     Z-ADD*ZERO     WDS2NB           Parent Credit L
     C                     Z-ADD*ZERO     WDVHVA           A/R Credit Limi
     C                     Z-ADD*ZERO     WDI7DT           Order Entry Hol
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFD4C7           Bank LckBx Numb
     C                     Z-ADD*ZERO     WFD5C7           Bank Default Co
     C                     Z-ADD*ZERO     WFAATM           Job Time
     C                     Z-ADD*ZERO     WFAXDT           Job Date
      * Clear all neither parameters
      * CRT A/R Header OA      CR - A/R Header  * 
     C                     Z-ADD*ZERO     BDAATM           Job Time
     C                     Z-ADD*ZERO     BDAXDT           Job Date
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field USR Differential
     C                     Z-ADD*ZERO     WUTYVA 112
      * Define work field Total Cash Applied
     C                     Z-ADD*ZERO     WUUJVA 112
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGHXDT           Deposit Date
     C                     Z-ADD*ZERO     WGYXNX           Deposit Time
     C                     Z-ADD*ZERO     WGUIVA           Deposit Amount
     C                     Z-ADD*ZERO     WGUJVA           Total Cash Appl
     C                     Z-ADD*ZERO     WGCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WGBHNB           Number of Depos
     C                     Z-ADD*ZERO     WGBINB           Number of Appli
     C                     Z-ADD*ZERO     WGE2VL           CD TF Internal
     C                     Z-ADD*ZERO     WGE3VL           CD TF Immediate
     C                     Z-ADD*ZERO     WGE4VL           CD TF 1 Day Fun
     C                     Z-ADD*ZERO     WGE5VL           CD TF 2 Day Fun
     C                     Z-ADD*ZERO     WGE6VL           CD SB Exempt Im
     C                     Z-ADD*ZERO     WGE7VL           CD SB 1 Day Exe
     C                     Z-ADD*ZERO     WGE8VL           CD SB 2 Day Exe
     C                     Z-ADD*ZERO     WGE9VL           SBD Exempt Tota
     C                     Z-ADD*ZERO     WGFAVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WGFBVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WGFCVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WGFDVL           ARBD Unused Amt
     C                     Z-ADD*ZERO     WGHYDT           G/L Post Date
     C                     Z-ADD*ZERO     WGAATM           Job Time
     C                     Z-ADD*ZERO     WGAXDT           Job Date
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Initialize *SET CURSOR data
     C                     MOVE 'Y'       YSETCS  1
     C                     EXSR Y9CLR
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'Y'       W0PMT   1
      * Define local variables for subroutine SARVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  70
      * Define local variables for subroutine SBRVGN.
     C                     Z-ADD*ZERO     WL0003  70
      * Define local variables for subroutine SDRVGN.
     C                     Z-ADD*ZERO     WL0004  30
     C                     MOVEL*BLANK    WL0005 30
      * Define local variables for subroutine SERVGN.
     C                     MOVEL*BLANK    WL0006  6
     C                     MOVEL*BLANK    WL0007 30
      * Define local variables for subroutine SFRVGN.
     C                     Z-ADD*ZERO     WL0008  70
     C                     MOVEL*BLANK    WL0009 30
      * Define local variables for subroutine SGRVGN.
     C                     MOVEL*BLANK    WL0010  6
     C                     Z-ADD*ZERO     WL0011  70
     C                     Z-ADD*ZERO     WL0012  40
     C                     Z-ADD*ZERO     WL0013 112
     C                     Z-ADD*ZERO     WL0014 112
     C                     Z-ADD*ZERO     WL0015  50
     C                     Z-ADD*ZERO     WL0016  50
      * Define local variables for subroutine SNRVGN.
     C                     MOVEL*BLANK    WL0017 10
     C                     Z-ADD*ZERO     WL0018 155
      * Define local variables for subroutine SSRVGN.
     C                     MOVEL*BLANK    WL0019 10
     C                     MOVEL*BLANK    WL0020  6
     C                     Z-ADD*ZERO     WL0021  30
     C                     MOVEL*BLANK    WL0022  3
      * Define local work field Invoice Suffix
     C                     MOVEL*BLANK    YL0001  2
      * Define local work field Plant Company Sts
     C                     MOVEL*BLANK    YL0002  1
      * Define local work field G/L Vendor Number USR
     C                     Z-ADD*ZERO     YL0003  80
      * Define local work field As of Date
     C                     Z-ADD*ZERO     YL0004  70
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0005  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0006  3
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      * Select initial mode
     C           @1NROP    IFEQ *ZERO
      * Add mode
     C                     MOVEL'ADD'     W0PMD   3
     C                     ELSE
      * Change mode
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      *
     C                     MOVEL*BLANK    WN0139 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0139           User Profile Na
      *
     C                     MOVEL*BLANK    WN0140 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SRRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,002                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0139    ZA0006           User Profile Na
     C                     MOVEL'A/R'     ZA0007           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0140    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0139    WL0019    P      User Profile Na
     C                     MOVEL'A/R'     WL0020    P      Application Cod
     C                     EXSR SSRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0021    WUAIC3           Company Number
     C                     MOVELWL0022    YL0006    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0140    WL0019    P      User Profile Na
     C                     MOVEL'A/R'     WL0020    P      Application Cod
     C                     EXSR SSRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0021    WUAIC3           Company Number
     C                     MOVELWL0022    YL0006    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0006    P3AJCD           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0139    ZA0008           User Profile Na
     C                     MOVEL'A/R'     ZA0009           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0005    IFNE 0                          *IF
     C                     Z-ADDYL0005    WUAIC3           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0006    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C           P3AJCD    PARM *BLANK    WQ0023  3        Warehouse Code
     C                     PARM YL0005    WQ0024  30       Shipping Compan
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR STRVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
      * CASE: PAR.Company Number is Equal to zero
     C           P1AIC3    IFEQ *ZERO                      *IF
     C                     Z-ADDWUAIC3    #1AIC3           Company Number
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDP1AIC3    #1AIC3           Company Number
     C                     END                             *FI
     C                     Z-ADDP1ANC7    #1ANC7           A/R Customer Nu
     C                     Z-ADDP1ANC7    #PIMNB           USR Customer Nu
     C                     Z-ADDP1CONB    #1CONB           Invoice Number
     C                     MOVEL'Y'       P3WVST           Access Denied (
      *================================================================
     CSR         ZZEXIT    ENDSR
** KEY Screen: Field position and name array
0105001306
** W0END
0105201312
** W0NAM
V1AIC3    #PIMNB
** W1BEG
01045010550130101311013450155701601
01857023310234102587025970284303355
038670412304635
** W1END
01050010840130801315013570156901613
01869023370237002589026260284903356
038790413204641
** W1NAM
#1G4CD    #DAUNA    VDHXDT    #DYXNX    #DUIVA    #DUJVA    #DURVA
#DFFVL    V1ANC7    #DAYTX    V1AIC3    #DAPTX    #1CONB    #1CEST
#1BSVA    #1CPTX    V1CAC7
** @CN
00001 Y2U0003
00002 Y2U0005
00003 USR0752
00004 ARDFTOADT
00005 ARDFTOACO
