     H/TITLE WW Substitutions Array XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     W* Warning: This program does not set on the LR indicator
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 03/17/10  Time  : 16:38:11
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     E                    YK01      100 18  A            Substituting It
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IYD01        DS
     I                                        1   30YI0101
     I                                        4   6 YI0102
     I                                        7  130YI0103
     I                                       14  180YI01
      *
     IYM01        DS                        100
     I                                        1   3 WAAJCD
     I                                        4   60WAAIC3
     I                                        7  130WAHGCD
     I                                       14  160WARGNB
     I                                       17  190WARHNB
     I                                       20  220WARINB
     I                                       23  24 WAADCD
     I                                       25  26 WAAICD
     I                                       27  27 WAAVST
     I                                       28  57 WAAVNA
     I                                       58  87 WAAWNA
     I                                       88  982WAAIWG
     I                                       99  99 WAFZST
     I                                      100 102 WALNCD
     I                                      103 109 WALRCD
     I                                      110 112 WAN0CD
     I                                      113 1172WACHTM
     I                                      118 120 WAQ8CD
     I                                      121 122 WARBCD
     I                                      123 123 WAXWST
     I                                      124 1342WAF5WG
     I                                      135 1410WAIRQT
      *
     IYW01        DS
     I                                        1   3 XAAJCD
     I                                        4   60XAAIC3
     I                                        7  130XAHGCD
     I                                       14  160XARGNB
     I                                       17  190XARHNB
     I                                       20  220XARINB
     I                                       23  24 XAADCD
     I                                       25  26 XAAICD
     I                                       27  27 XAAVST
     I                                       28  57 XAAVNA
     I                                       58  87 XAAWNA
     I                                       88  982XAAIWG
     I                                       99  99 XAFZST
     I                                      100 102 XALNCD
     I                                      103 109 XALRCD
     I                                      110 112 XAN0CD
     I                                      113 1172XACHTM
     I                                      118 120 XAQ8CD
     I                                      121 122 XARBCD
     I                                      123 123 XAXWST
     I                                      124 1342XAF5WG
     I                                      135 1410XAIRQT
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Array Processing Control
     I                                        1   2 P1APRO
     IP2PARM      DS
      * FLD: *Arrays
      * I :  Warehouse Code
     I                                        1   3 P2AJCD
      * I :  Company Number
     I                                    P   4   50P2AIC3
      * I :  Item Code
     I                                    P   6   90P2HGCD
      * N :  Item Structure Type Code
     I                                    P  10  110P2RGNB
      * N :  Item Structure Group Code
     I                                    P  12  130P2RHNB
      * N :  Item Structure Class Code
     I                                    P  14  150P2RINB
      * N :  U/M - Primary
     I                                       16  17 P2ADCD
      * N :  U/M - Pricing
     I                                       18  19 P2AICD
      * N :  Catch Weight Status
     I                                       20  20 P2AVST
      * N :  Description Line One
     I                                       21  50 P2AVNA
      * N :  Description Line Two
     I                                       51  80 P2AWNA
      * N :  Unit Weight
     I                                    P  81  862P2AIWG
      * N :  Production Date Control
     I                                       87  87 P2FZST
      * N :  Default Commod Mark basis
     I                                       88  90 P2LNCD
      * N :  Commodity Price Group
     I                                       91  97 P2LRCD
      * N :  Item Type Code
     I                                       98 100 P2N0CD
      * N :  Fresh Chilling Time
     I                                    P 101 1032P2CHTM
      * N :  Price Method Default
     I                                      104 106 P2Q8CD
      * N :  Item Level
     I                                      107 108 P2RBCD
      * N :  Variety/Rendered/Cut
     I                                      109 109 P2XWST
      * I :  Quantity Ordered 1 USR
     I                                    P 110 1130P2IRQT
     IP3PARM      DS
      * FLD: Order Detail
      * I : MAP Order Number
     I                                    P   1   40P3C4NB
      * I : MAP Order Sequence Number
     I                                    P   5   60P3DPNB
      * I : MAP Order Secondary Line Seq
     I                                    P   7   80P3UENB
      * I :  Age Code
     I                                        9   9 P3RPCD
      * N :  OD Item Target Price
     I                                    P  10  152P3H7NX
     IP4PARM      DS
      * I :  USR Quantity to Confirm
     I                                    P   1   62P4C6QT
     IP5PARM      DS
      * B :  Chilling Time USR
     I                                    P   1   32P5CHMT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1APRO    PARM           WP0001  2        Array Processin
     C           P2AJCD    PARM           WP0002  3        Warehouse Code
     C           P2AIC3    PARM           WP0003  30       Company Number
     C           P2HGCD    PARM           WP0004  70       Item Code
     C           P2IRQT    PARM           WP0005  70       Quantity Ordere
     C           P3C4NB    PARM           WP0006  70       Order Number
     C           P3DPNB    PARM           WP0007  30       Order Sequence
     C           P3UENB    PARM           WP0008  30       Order Secondary
     C           P3RPCD    PARM           WP0009  1        Age Code
     C           P4C6QT    PARM           WP0010 112       USR Quantity to
     C           P5CHMT    PARM P5CHMT    WP0011  52       Chilling Time U
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * WW Substitutions Array XF
      * CASE: PAR.Array Processing Control is Process Create
     C           P1APRO    IFEQ 'CR'                       *IF
      * RTV for Ord.Detail     XF - /UT Inv. Interface Funcs  * 
     C                     CALL 'PDC3XFR'              90  RTV for Ord.Det
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2AIC3    WQ0001  30       Company Number
     C                     PARM P2HGCD    WQ0002  70       Item Code
     C           P2AVNA    PARM *BLANK    WQ0003 30        Description Lin
     C           P2AWNA    PARM *BLANK    WQ0004 30        Description Lin
     C           P2ADCD    PARM *BLANK    WQ0005  2        U/M - Primary
     C           P2AICD    PARM *BLANK    WQ0006  2        U/M - Pricing
     C           P2AIWG    PARM *ZERO     WQ0007 112       Unit Weight
     C           P2RBCD    PARM *BLANK    WQ0008  2        Item Level
     C           P2FZST    PARM *BLANK    WQ0009  1        Production Date
     C           P2AVST    PARM *BLANK    WQ0010  1        Catch Weight St
     C           P2RINB    PARM *ZERO     WQ0011  30       Item Structure
     C           P2RHNB    PARM *ZERO     WQ0012  30       Item Structure
     C           P2RGNB    PARM *ZERO     WQ0013  30       Item Structure
     C           P2LNCD    PARM *BLANK    WQ0014  3        Default Commod
     C           WUTFNB    PARM *ZERO     WQ0015  30       Transportation
     C           P2N0CD    PARM *BLANK    WQ0016  3        Item Type Code
     C           P2LRCD    PARM *BLANK    WQ0017  7        Commodity Price
     C           WUQ1CD    PARM *BLANK    WQ0018  3        Default Warehou
     C           P2Q8CD    PARM *BLANK    WQ0019  3        Price Method De
     C           P2CHTM    PARM *ZERO     WQ0020  52       Fresh Chilling
     C           P2XWST    PARM *BLANK    WQ0021  1        Variety/Rendere
     C           P3H7NX    PARM *ZERO     WQ0022 112       Item Target Pri
     C           WUECST    PARM *BLANK    WQ0023  1        Error Status
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDC3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CRT Substitution List  CR - *Arrays  * 
     C                     EXSR SACRRC
      * assume chill time usr starts at 0
      * pass back highest chill time
      * CASE: PAR.Chilling Time GT PAR.Chilling Time USR
     C           P2CHTM    IFGT P5CHMT                     *IF
     C                     Z-ADDP2CHTM    P5CHMT           Chilling Time U
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.Array Processing Control is Process Delete All
     C           P1APRO    IFEQ 'DA'                       *IF
      * DLT All Substitutions  DL - *Arrays  * 
     C                     EXSR SBDLRC
     C                     ELSE
      * CASE: PAR.Array Processing Control is Process Delete One Entry
     C           P1APRO    IFEQ 'D1'                       *IF
      * DLT A Substitution     DL - *Arrays  * 
     C                     EXSR SCDLRC
     C                     ELSE
      * CASE: PAR.Array Processing Control is Process Update
     C           P1APRO    IFEQ 'UP'                       *IF
      * UPD Substituting Order RT - *Arrays  * 
     C                     EXSR SDRVGN
     C                     ELSE
      * CASE: PAR.Array Processing Control is Process Retrieve
     C           P1APRO    IFEQ 'RT'                       *IF
     C                     ELSE
      * CASE: PAR.Array Processing Control is Closedown Program
     C           P1APRO    IFEQ 'CP'                       *IF
      * SET Closedown Program  US - /UT User Source  * 
      *  RECLAIM RESOURCES
     C                     CALL 'Y2RCRSC'
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACRRC    BEGSR
      *================================================================
      * CRT Substitution List  CR - *Arrays  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Array full, cannot add any more elements
     C           YL01      IFEQ 100
     C                     MOVEL'Y2U0036' W0RTN   7
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C                     MOVEL*BLANK    XAAJCD           Warehouse Code
     C                     Z-ADD*ZERO     XAAIC3           Company Number
     C                     Z-ADD*ZERO     XAHGCD           Item Code
     C                     Z-ADD*ZERO     XARGNB           Item Structure
     C                     Z-ADD*ZERO     XARHNB           Item Structure
     C                     Z-ADD*ZERO     XARINB           Item Structure
     C                     MOVEL*BLANK    XAADCD           U/M - Primary
     C                     MOVEL*BLANK    XAAICD           U/M - Pricing
     C                     MOVEL*BLANK    XAAVST           Catch Weight St
     C                     MOVEL*BLANK    XAAVNA           Description Lin
     C                     MOVEL*BLANK    XAAWNA           Description Lin
     C                     Z-ADD*ZERO     XAAIWG           Unit Weight
     C                     MOVEL*BLANK    XAFZST           Production Date
     C                     MOVEL*BLANK    XALNCD           Default Commod
     C                     MOVEL*BLANK    XALRCD           Commodity Price
     C                     MOVEL*BLANK    XAN0CD           Item Type Code
     C                     Z-ADD*ZERO     XACHTM           Fresh Chilling
     C                     MOVEL*BLANK    XAQ8CD           Price Method De
     C                     MOVEL*BLANK    XARBCD           Item Level
     C                     MOVEL*BLANK    XAXWST           Variety/Rendere
     C                     Z-ADD*ZERO     XAF5WG           Item Target Pri
     C                     Z-ADD*ZERO     XAIRQT           Quantity Ordere
      * Move all fields to Substituting Items
     C                     MOVELP2AJCD    XAAJCD           Warehouse Code
     C                     Z-ADDP2AIC3    XAAIC3           Company Number
     C                     Z-ADDP2HGCD    XAHGCD           Item Code
     C                     Z-ADDP2RGNB    XARGNB           Item Structure
     C                     Z-ADDP2RHNB    XARHNB           Item Structure
     C                     Z-ADDP2RINB    XARINB           Item Structure
     C                     MOVELP2ADCD    XAADCD           U/M - Primary
     C                     MOVELP2AICD    XAAICD           U/M - Pricing
     C                     MOVELP2AVST    XAAVST           Catch Weight St
     C                     MOVELP2AVNA    XAAVNA           Description Lin
     C                     MOVELP2AWNA    XAAWNA           Description Lin
     C                     Z-ADDP2AIWG    XAAIWG           Unit Weight
     C                     MOVELP2FZST    XAFZST           Production Date
     C                     MOVELP2LNCD    XALNCD           Default Commod
     C                     MOVELP2LRCD    XALRCD           Commodity Price
     C                     MOVELP2N0CD    XAN0CD           Item Type Code
     C                     Z-ADDP2CHTM    XACHTM           Fresh Chilling
     C                     MOVELP2Q8CD    XAQ8CD           Price Method De
     C                     MOVELP2RBCD    XARBCD           Item Level
     C                     MOVELP2XWST    XAXWST           Variety/Rendere
     C                     Z-ADDP3H7NX    XAF5WG           Item Target Pri
     C                     Z-ADDP2IRQT    XAIRQT           Quantity Ordere
      *
      * Move key fields to Substituting Items
     C                     MOVELXAAJCD    YI0102           Warehouse Code
     C                     Z-ADDXAAIC3    YI0101           Company Number
     C                     Z-ADDXAHGCD    YI0103           Item Code
      *
      * Check for duplicate primary key
      * Initialize internal index
     C                     Z-ADD*ZERO     YI01
      * Only search if key is not beyond range of current elements
     C           YL01      IFGT 0
     C           YK01,YL01 ANDGTYD01
      * Set search index to first element of array
     C                     Z-ADD1         Y       50
     C           YD01      LOKUPYK01,Y               90    Look for >
     C                     ELSE
     C                     SETOF                     90    *
     C                     ENDIF
     C           *IN90     IFEQ '1'
      * Move to data structure for comparison
     C                     MOVELYK01,Y    YD01
      * Compare
     C           YI0102    IFEQ XAAJCD
     C           YI0101    ANDEQXAAIC3
     C           YI0103    ANDEQXAHGCD
      * Array element already exists
     C                     MOVEL'Y2U0003' W0RTN   7
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C                     ENDIF
      *
      * Insert after last used element
     C           YL01      ADD  1         Y       50
      * Check if element was a previously deleted element
     C           YK01,Y    IFNE *HIVAL
      * If so, reuse MODS index
     C                     MOVELYK01,Y    YD01
     C                     ELSE
      * If not, use element number as MODS index
     C                     Z-ADDY         YI01
     C                     ENDIF
      *
      * Create(insert) new element
      * Move key fields to Substituting Items
     C                     MOVELXAAJCD    YI0102           Warehouse Code
     C                     Z-ADDXAAIC3    YI0101           Company Number
     C                     Z-ADDXAHGCD    YI0103           Item Code
      *
     C                     MOVELYD01      YK01,Y
     C           YI01      OCUR YM01
      * Update MODS fields
     C                     MOVELXAAJCD    WAAJCD           Warehouse Code
     C                     Z-ADDXAAIC3    WAAIC3           Company Number
     C                     Z-ADDXAHGCD    WAHGCD           Item Code
     C                     Z-ADDXARGNB    WARGNB           Item Structure
     C                     Z-ADDXARHNB    WARHNB           Item Structure
     C                     Z-ADDXARINB    WARINB           Item Structure
     C                     MOVELXAADCD    WAADCD           U/M - Primary
     C                     MOVELXAAICD    WAAICD           U/M - Pricing
     C                     MOVELXAAVST    WAAVST           Catch Weight St
     C                     MOVELXAAVNA    WAAVNA           Description Lin
     C                     MOVELXAAWNA    WAAWNA           Description Lin
     C                     Z-ADDXAAIWG    WAAIWG           Unit Weight
     C                     MOVELXAFZST    WAFZST           Production Date
     C                     MOVELXALNCD    WALNCD           Default Commod
     C                     MOVELXALRCD    WALRCD           Commodity Price
     C                     MOVELXAN0CD    WAN0CD           Item Type Code
     C                     Z-ADDXACHTM    WACHTM           Fresh Chilling
     C                     MOVELXAQ8CD    WAQ8CD           Price Method De
     C                     MOVELXARBCD    WARBCD           Item Level
     C                     MOVELXAXWST    WAXWST           Variety/Rendere
     C                     Z-ADDXAF5WG    WAF5WG           Item Target Pri
     C                     Z-ADDXAIRQT    WAIRQT           Quantity Ordere
      * Only sort if element is out of position
     C           YL01      IFGT 0
     C           YK01,YL01 ANDGTYD01
      * Adjust RTVOBJ index to reflect position of added/removed element
     C           YR01      IFGT 0
     C           YR01      ANDLE100
     C           YK01,YR01 ANDGTYD01
     C                     ADD  1         YR01    50
     C                     ENDIF
      * Sort array to place element in correct position
     C                     SORTAYK01
     C                     ENDIF
      * Adjust number of elements currently in array
     C                     ADD  1         YL01
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * DLT All Substitutions  DL - *Arrays  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Initialize array variables
     C                     MOVEA*HIVAL    YK01
      * Initialize last used element number
     C                     Z-ADD0         YL01
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * DLT A Substitution     DL - *Arrays  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to Substituting Items
     C                     Z-ADDP2AIC3    YI0101           Company Number
     C                     MOVELP2AJCD    YI0102           Warehouse Code
     C                     Z-ADDP2HGCD    YI0103           Item Code
      *
      * Reset global index if not within range of current elements
     C           Y         IFGT YL01
     C                     Z-ADD1         Y
     C                     ENDIF
      * Only search if not already pointing to correct element
     C           Y         IFGT 0
     C           YD01      ANDNEYK01,Y
      * Initialize internal index
     C                     Z-ADD*ZERO     YI01
      * Only search if key is not beyond range of current elements
     C           YL01      IFGT 0
     C           YK01,YL01 ANDGTYD01
      * Set search index to first element of array
     C                     Z-ADD1         Y       50
     C           YD01      LOKUPYK01,Y               90    Look for >
     C                     ELSE
     C                     SETOF                     90    *
     C                     ENDIF
     C           *IN90     IFEQ '1'
      * Move to data structure for comparison
     C                     MOVELYK01,Y    YD01
      * Compare
     C           YI0101    IFNE P2AIC3
     C           YI0102    ORNE P2AJCD
     C           YI0103    ORNE P2HGCD
      *
     C                     SETOF                     90    *
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * Element not found in array
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     GOTO SCEXIT
     C                     ENDIF
     C                     ENDIF
      *
      * Adjust RTVOBJ index to reflect position of added/removed element
     C           YR01      IFGT 0
     C           YR01      ANDLE100
     C           YK01,YR01 ANDGEYD01
     C                     SUB  1         YR01    50
     C                     ENDIF
      *
      * Initialize keys in array but retain index to MODS for later reuse
     C                     Z-ADDYI01      YISAV   50
     C                     MOVEL*HIVAL    YD01
     C                     Z-ADDYISAV     YI01
     C                     MOVELYD01      YK01,Y
      * Sort array to compress out deleted element
     C                     SORTAYK01
      * Adjust number of elements currently in array
     C                     SUB  1         YL01
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * UPD Substituting Order RT - *Arrays  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0002  70       Order Group Cod
     C                     MOVEL*BLANK    WN0003  1        Comment Print A
     C                     MOVEL*BLANK    WN0004  1        Comment Print I
     C                     MOVEL*BLANK    WN0005  1        Comment Print P
     C                     MOVEL*BLANK    WN0006  1        Comment Print S
     C                     MOVEL*BLANK    WN0007  1        Palletize
     C                     MOVEL*BLANK    WN0008  1        Slip Sheet
     C                     Z-ADD*ZERO     WN0009 112       Quantity Ordere
     C                     Z-ADD*ZERO     WN0010 112       Weight Ordered
     C                     Z-ADD*ZERO     WN0011 112       Quantity Schedu
     C                     Z-ADD*ZERO     WN0012 112       Weight Schedule
     C                     Z-ADD*ZERO     WN0013 114       Unit Price - Cr
     C                     Z-ADD*ZERO     WN0014  70       Requested Ship
     C                     Z-ADD*ZERO     WN0015  70       Scheduled Ship
     C                     Z-ADD*ZERO     WN0016  70       Actual Shipped
     C                     MOVEL*BLANK    WN0017  1        Affect Inventor
     C                     MOVEL*BLANK    WN0018  1        Affect Sales Do
     C                     MOVEL*BLANK    WN0019  1        Affect Sales Pn
     C                     MOVEL*BLANK    WN0020  6        Country Code
     C                     MOVEL*BLANK    WN0021  2        Event Code
     C                     MOVEL*BLANK    WN0022  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0023  1        Affect Trade Fu
     C                     MOVEL*BLANK    WN0024  1        Affect Commissi
     C                     MOVEL*BLANK    WN0025  1        Affect Pricing
     C                     Z-ADD*ZERO     WN0026  30       USR Order Secon
     C                     Z-ADD*ZERO     WN0027 112       USR Quantity
     C                     Z-ADD*ZERO     WN0028 112       USR Weight
     C                     MOVEL*BLANK    WN0029  1        Billing Activit
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * RTV for Substitution   XF - Order Detail  * 
     C                     CALL 'PDSYXFR'              90  RTV for Substit
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2AIC3    WQ0024  30       Company Number
     C                     PARM P3C4NB    WQ0025  70       Order Number
     C                     PARM P3DPNB    WQ0026  30       Order Sequence
     C                     PARM P3UENB    WQ0027  30       Order Secondary
     C           WN0001    PARM *ZERO     WQ0028  70       Ship To Custome
     C           WN0002    PARM *ZERO     WQ0029  70       Order Group Cod
     C           WN0003    PARM *BLANK    WQ0030  1        Comment Print A
     C           WN0004    PARM *BLANK    WQ0031  1        Comment Print I
     C           WN0005    PARM *BLANK    WQ0032  1        Comment Print P
     C           WN0006    PARM *BLANK    WQ0033  1        Comment Print S
     C           WN0007    PARM *BLANK    WQ0034  1        Palletize
     C           WN0008    PARM *BLANK    WQ0035  1        Slip Sheet
     C           WN0009    PARM *ZERO     WQ0036 112       Quantity Ordere
     C           WN0010    PARM *ZERO     WQ0037 112       Weight Ordered
     C           WN0014    PARM *ZERO     WQ0038  70       Requested Ship
     C           WN0015    PARM *ZERO     WQ0039  70       Scheduled Ship
     C           WN0016    PARM *ZERO     WQ0040  70       Actual Shipped
     C           WN0017    PARM *BLANK    WQ0041  1        Affect Inventor
     C           WN0018    PARM *BLANK    WQ0042  1        Affect Sales Do
     C           WN0019    PARM *BLANK    WQ0043  1        Affect Sales Pn
     C           WN0020    PARM *BLANK    WQ0044  6        Country Code
     C           WN0021    PARM *BLANK    WQ0045  2        Event Code
     C           WN0022    PARM *BLANK    WQ0046  3        Sales Route Cod
     C           WN0023    PARM *BLANK    WQ0047  1        Affect Trade Fu
     C           WN0024    PARM *BLANK    WQ0048  1        Affect Commissi
     C           WN0025    PARM *BLANK    WQ0049  1        Affect Pricing
     C           WN0029    PARM *BLANK    WQ0050  1        Billing Activit
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDSYXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C           YL01      IFGT 0
      * Set search index to first element of array
     C                     Z-ADD1         Y       50
     C                     MOVELYK01,Y    YD01
     C           YI01      OCUR YM01
      * Initialize internal index
     C                     MOVEL*LOVAL    YD01
      * Move key fields to Substituting Items
     C                     MOVELP2AJCD    YI0102           Warehouse Code
     C                     Z-ADDP2AIC3    YI0101           Company Number
     C                     Z-ADDP2HGCD    YI0103           Item Code
      *
      *
      *
      *
      *
      *
      *
      * Only search if key is not beyond range of current elements
     C           YK01,YL01 IFGT YD01
     C           YD01      LOKUPYK01,Y               90    Look for >
     C                     ELSE
     C                     SETOF                     90    *
     C                     ENDIF
     C                     ELSE
     C                     SETOF                     90    *
     C                     ENDIF
     C           *IN90     IFEQ '1'
      * Move to data structure for comparison
     C                     MOVELYK01,Y    YD01
      * Compare
     C           YI0102    IFNE P2AJCD
     C           YI0101    ORNE P2AIC3
      *
      *
      *
      *
      *
      *
      *
     C                     SETOF                     90    *
     C                     ENDIF
     C                     ENDIF
     C           *IN90     IFEQ '0'
      * Array element not found
     C                     MOVEL'Y2U0005' W0RTN   7
     C                     ENDIF
      *
     C           *IN90     IFEQ '1'
      * Sequence through qualified elements:
     C                     Z-ADDY         YR01    50
     C           YR01      DOWLEYL01
     C           YI0102    ANDEQP2AJCD
     C           YI0101    ANDEQP2AIC3
      *
      *
      *
      *
      *
      *
      *
     C           YI01      OCUR YM01
      * USER: Process Data record
     C           P4C6QT    MULT WAIRQT    WN0027           USR Quantity
     C           WN0027    MULT WAAIWG    WN0028           USR Weight
      * UPD Crt Substitution   XF - Order Detail  * 
     C                     CALL 'PDSXXFR'              90  UPD Crt Substit
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P2AIC3    WQ0051  30       Company Number
     C                     PARM P3C4NB    WQ0052  70       Order Number
     C                     PARM P3DPNB    WQ0053  30       Order Sequence
     C                     PARM WAHGCD    WQ0054  70       Item Code
     C                     PARM WAAJCD    WQ0055  3        Warehouse Code
     C                     PARM WN0001    WQ0056  70       Ship To Custome
     C                     PARM WN0002    WQ0057  70       Order Group Cod
     C                     PARM WN0027    WQ0058 112       Quantity to Sub
     C                     PARM WN0003    WQ0059  1        Comment Print A
     C                     PARM WN0004    WQ0060  1        Comment Print I
     C                     PARM WN0005    WQ0061  1        Comment Print P
     C                     PARM WN0006    WQ0062  1        Comment Print S
     C                     PARM WALNCD    WQ0063  3        Commodity Marke
     C                     PARM WAQ8CD    WQ0064  3        Price Method Co
     C                     PARM WAAICD    WQ0065  2        U/M - Base Pric
     C                     PARM WAADCD    WQ0066  2        U/M - Ordered
     C                     PARM WAAVNA    WQ0067 30        Order Desc. Lin
     C                     PARM P3RPCD    WQ0068  1        Age Code
     C                     PARM WN0007    WQ0069  1        Palletize
     C                     PARM WN0008    WQ0070  1        Slip Sheet
     C                     PARM WAAVST    WQ0071  1        Catch Weight St
     C                     PARM WAFZST    WQ0072  1        Production Date
     C                     PARM *ZERO     WQ0073 112       Quantity Ordere
     C                     PARM *ZERO     WQ0074 112       Weight Ordered
     C           WN0011    PARM WN0011    WQ0075 112       Quantity Schedu
     C           WN0012    PARM WN0012    WQ0076 112       Weight Schedule
     C                     PARM WN0014    WQ0077  70       Requested Ship
     C                     PARM WN0015    WQ0078  70       Scheduled Ship
     C                     PARM WN0016    WQ0079  70       Actual Shipped
     C                     PARM WN0017    WQ0080  1        Affect Inventor
     C                     PARM WN0018    WQ0081  1        Affect Sales Do
     C                     PARM WN0019    WQ0082  1        Affect Sales Pn
     C                     PARM WARGNB    WQ0083  30       Item Structure
     C                     PARM WARHNB    WQ0084  30       Item Structure
     C                     PARM WARINB    WQ0085  30       Item Structure
     C                     PARM WARBCD    WQ0086  2        Item Level
     C                     PARM WN0020    WQ0087  6        Country Code
     C                     PARM WN0021    WQ0088  2        Event Code
     C                     PARM WN0022    WQ0089  3        Sales Route Cod
     C                     PARM WN0023    WQ0090  1        Affect Trade Fu
     C                     PARM WN0024    WQ0091  1        Affect Commissi
     C                     PARM WN0025    WQ0092  1        Affect Pricing
     C                     PARM P3H7NX    WQ0093 112       OD Item Target
     C                     PARM WN0028    WQ0094 112       USR Weight
     C                     PARM WN0029    WQ0095  1        Billing Activit
     C                     PARM WALRCD    WQ0096  7        Commodity Price
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDSXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     ADD  1         YR01
     C           YR01      IFLE 100
     C                     Z-ADDYR01      Y
     C                     MOVELYK01,Y    YD01
     C                     ENDIF
     C                     ENDDO
     C                     ENDIF
      * USER: Exit processing
      * CHG Substitution Flag  XF - Order Detail  * 
     C                     CALL 'PDSZXFR'              90  CHG Substitutio
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WAAIC3    WQ0097  30       Company Number
     C                     PARM P3C4NB    WQ0098  70       Order Number
     C                     PARM P3DPNB    WQ0099  30       Order Sequence
     C                     PARM P3UENB    WQ0100  30       Order Secondary
     C                     PARM 'Y'       WQ0101  1        Substituted Fla
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDSZXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2RGNB           Item Structure
     C                     Z-ADD*ZERO     P2RHNB           Item Structure
     C                     Z-ADD*ZERO     P2RINB           Item Structure
     C                     MOVEL*BLANK    P2ADCD           U/M - Primary
     C                     MOVEL*BLANK    P2AICD           U/M - Pricing
     C                     MOVEL*BLANK    P2AVST           Catch Weight St
     C                     MOVEL*BLANK    P2AVNA           Description Lin
     C                     MOVEL*BLANK    P2AWNA           Description Lin
     C                     Z-ADD*ZERO     P2AIWG           Unit Weight
     C                     MOVEL*BLANK    P2FZST           Production Date
     C                     MOVEL*BLANK    P2LNCD           Default Commod
     C                     MOVEL*BLANK    P2LRCD           Commodity Price
     C                     MOVEL*BLANK    P2N0CD           Item Type Code
     C                     Z-ADD*ZERO     P2CHTM           Fresh Chilling
     C                     MOVEL*BLANK    P2Q8CD           Price Method De
     C                     MOVEL*BLANK    P2RBCD           Item Level
     C                     MOVEL*BLANK    P2XWST           Variety/Rendere
     C                     Z-ADD*ZERO     P3H7NX           OD Item Target
      *
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Transportation Temp
     C                     Z-ADD*ZERO     WUTFNB  30
      * Define work field Default Warehouse
     C                     MOVEL*BLANK    WUQ1CD  3
      * Define work field Error Status
     C                     MOVEL*BLANK    WUECST  1
      *
     C           W0ICL     IFEQ 'Y'
      * Initialize array variables
     C                     MOVEA*HIVAL    YK01
      * Initialize last used element number
     C                     Z-ADD0         YL01    50
     C                     Z-ADD1         Y       50
     C                     ENDIF
      *
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
