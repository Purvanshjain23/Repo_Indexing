// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PME1XFR
// ?Date: 14.08.2025 Time: 03:42:53
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// PAR.Date Sat USR = PAR.Week End Date
PAR.Date_Sat_USR = PAR.Week_End_Date;

//?1. Crt new week's Inv Stock Closing bals
//?Rtv Sunday that starts the new week
EXECUTE FUNCTION(Rtv Prior Sunday      RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1410775;
PARAMETER(PAR.ISC_Warehouse_Company);
PARAMETER(PAR.Week_End_Date);
PARAMETER(PAR.Date_Sun_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Day of Week is Sunday
 IF DB1.Day_of_Week = '1';

 // PAR.Date Sun USR = DB1.Post to G/L Date
 PAR.Date_Sun_USR = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


//?  a. Roll forward ending week's to beginning new week's balances
//?RMC 11/30/05 remove ISC company from input rst parm; do both
//?  b. Rtv End Inv from IC Item Bal -- Ending Inventory Download
//?    POFPPVR AND POFQUPC - read the item bal the same way & upd ISC
//?  c. Rtv Partials (PT) & Rejects (RJ) from the Yield system
//?  ---> Manually entered
//?  d. Floor Production from Item Trans --> Production Download- POFHPVR
//?     Prior Monday 6am til Monday 5:59         * calls ppovpfr *
//?******
//?******
EXECUTE FUNCTION(Rtv Date/Time         RT) TYPE(RTVOBJ) FILE(PMA5REP)           AC1831861;
PARAMETER(PAR.ISC_Warehouse_Company);
PARAMETER('RR');
PARAMETER(LCL.ISC_From_Time);
PARAMETER(LCL.ISC_To_Time);
PARAMETER(PAR.Date_Sat_USR);
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.Thru_Date_USR);
{
 //?USER: Process Data record

 // PAR.ISC From Time = DB1.ISC From Time
 PAR.ISC_From_Time = DB1.ISC_From_Time;

 // PAR.ISC To Time = DB1.ISC To Time
 PAR.ISC_To_Time = DB1.ISC_To_Time;

 EXECUTE FUNCTION(Rtv Prior Day per par RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831878;
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Date_USR);
 PARAMETER(DB1.ISC_From_Day_of_week);
 PARAMETER(PAR.From_Date_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week EQ PAR.Day of Week
  IF DB1.Day_of_Week = PAR.Day_of_Week;

  // PAR.Date Mon USR = DB1.Post to G/L Date
  PAR.Date_Mon_USR = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

 EXECUTE FUNCTION(RTV Next Day per par  RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831883;
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Date_USR);
 PARAMETER(DB1.ISC_To_Day_of_Week);
 PARAMETER(PAR.Thru_Date_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week EQ PAR.Day of Week
  IF DB1.Day_of_Week = PAR.Day_of_Week;

  // PAR.Scheduled Ship Date = DB1.Post to G/L Date
  PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

}


// Call program Prt Prdctn Dwnl-ISC   UP.
CALL PROGRAM(Prt Prdctn Dwnl-ISC   UP) ('PPOWUPR');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.Thru_Date_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);
PARAMETER(LCL.ISC_From_Time);
PARAMETER(LCL.ISC_To_Time);

//?  e. Inventory Shipments from Item Transaction  "IO" rcds
//?     Sunday ---> Saturday                     * calls ppo5pfr *
// Call program Prt Inventory Shp-ISC UP.
CALL PROGRAM(Prt Inventory Shp-ISC UP) ('PPO4UPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(PAR.Date_Sun_USR);
PARAMETER(PAR.Date_Sat_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);

//?  f. Upd Order Dtl Shipment Initial --> Order Dtl Download- pof8pvr
//?     Sunday ---> Saturday                     * calls ppoypfr *
// Call program Prt Ord Dtl Shpmt-ISC UP.
CALL PROGRAM(Prt Ord Dtl Shpmt-ISC UP) ('PPOZUPR');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(PAR.Date_Sun_USR);
PARAMETER(PAR.Date_Sat_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);

//?  g. Upd Sun Shpmnt Inv Adj --> orders shipped Sun after week ending dt
//?                                               * calls ppo3pfr *
EXECUTE FUNCTION(RTV Next Sunday        RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1672814;
PARAMETER(PAR.ISC_Warehouse_Company);
PARAMETER(PAR.Date_Sat_USR);
PARAMETER(WRK.Date_Sun_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Day of Week is Sunday
 IF DB1.Day_of_Week = '1';

 // PAR.Scheduled Ship Date = DB1.Post to G/L Date
 PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

}


// Call program Prt Ord Dtl SunSh-ISC UP.
CALL PROGRAM(Prt Ord Dtl SunSh-ISC UP) ('PPO2UPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(WRK.Date_Sun_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);

//?  h. Inventory Transfers from Item Transaction  "T""TW" rcds
//?     Other Inventory Adj from Item Transaction  "R""RC""RP""S"
//?******
//?******
EXECUTE FUNCTION(Rtv Date/Time         RT) TYPE(RTVOBJ) FILE(PMA5REP)           AC1831861;
PARAMETER(PAR.ISC_Warehouse_Company);
PARAMETER('TW');
PARAMETER(LCL.ISC_From_Time);
PARAMETER(LCL.ISC_To_Time);
PARAMETER(PAR.Date_Sat_USR);
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.Thru_Date_USR);
{
 //?USER: Process Data record

 // PAR.ISC From Time = DB1.ISC From Time
 PAR.ISC_From_Time = DB1.ISC_From_Time;

 // PAR.ISC To Time = DB1.ISC To Time
 PAR.ISC_To_Time = DB1.ISC_To_Time;

 EXECUTE FUNCTION(Rtv Prior Day per par RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831878;
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Date_USR);
 PARAMETER(DB1.ISC_From_Day_of_week);
 PARAMETER(PAR.From_Date_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week EQ PAR.Day of Week
  IF DB1.Day_of_Week = PAR.Day_of_Week;

  // PAR.Date Mon USR = DB1.Post to G/L Date
  PAR.Date_Mon_USR = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

 EXECUTE FUNCTION(RTV Next Day per par  RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831883;
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Date_USR);
 PARAMETER(DB1.ISC_To_Day_of_Week);
 PARAMETER(PAR.Thru_Date_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week EQ PAR.Day of Week
  IF DB1.Day_of_Week = PAR.Day_of_Week;

  // PAR.Scheduled Ship Date = DB1.Post to G/L Date
  PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

}


// Call program Prt Inv Txf/MscAd ISC UP.
CALL PROGRAM(Prt Inv Txf/MscAd ISC UP) ('PPSHUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.Thru_Date_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);
PARAMETER(LCL.ISC_From_Time);
PARAMETER(LCL.ISC_To_Time);

