     H/TITLE CRT Bld Cust Pnd & Dol XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.5 (1351)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISPPATE
     H* Date          : 06/16/10  Time  : 16:49:53
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOMHSTPL1IF  E           K        DISK
      * RTV : Sales History             Retrieval index
      *
     FOPEXREL2IF  E           K        DISK
      * RTV : Order Types               Active order Types
      *
     FCAEOREL2IF  E           K        DISK
      * RTV : Company Customer          Active Records         N
      *
     FOMH4REL1IF  E           K        DISK
      * RTV : Cust Pound & Dollar WK    Retrieval index
      *
     FOMH4REL0UF  E           K        DISK                      A
      * UPD : Cust Pound & Dollar WK    Update index
      *
     I@FHSTD3
      * Sales History             Retrieval index
      * Renamed input format fields
     I              F4AIC3                          WAAIC3
     I              F4C4NB                          WAC4NB
     I              F4DPNB                          WADPNB
     I              F4UENB                          WAUENB
     I              F4MONA                          WAMONA
     I              F4RJCD                          WARJCD
     I              F4RKCD                          WARKCD
     I              F4GPTX                          WAGPTX
     I              F4ABTX                          WAABTX
     I              F4KXCD                          WAKXCD
     I              F4BOCD                          WABOCD
     I              F4BTC7                          WABTC7
     I              F4ANC7                          WAANC7
     I              F4AQTX                          WAAQTX
     I              F4BKC7                          WABKC7
     I              F4BRTX                          WABRTX
     I              F4HNNA                          WAHNNA
     I              F4DBCD                          WADBCD
     I              F4CKTX                          WACKTX
     I              F4BCNA                          WABCNA
     I              F4A0DT                          WAA0DT
     I              F4ACDT                          WAACDT
     I              F4R4CD                          WAR4CD
     I              F4R5CD                          WAR5CD
     I              F4BFCD                          WABFCD
     I              F4Q4CD                          WAQ4CD
     I              F4AQCD                          WAAQCD
     I              F4TBNB                          WATBNB
     I              F4BZNA                          WABZNA
     I              F4RLCD                          WARLCD
     I              F4JNCD                          WAJNCD
     I              F4Q2CD                          WAQ2CD
     I              F4U2ST                          WAU2ST
     I              F4ATIN                          WAATIN
     I              F4T3NB                          WAT3NB
     I              F4RSRN                          WARSRN
     I              F4ORIT                          WAORIT
     I              F4AJCD                          WAAJCD
     I              F4AVQT                          WAAVQT
     I              F4D0WG                          WAD0WG
     I              F4CCQT                          WACCQT
     I              F4AUWG                          WAAUWG
     I              F4AGCD                          WAAGCD
     I              F4AKPR                          WAAKPR
     I              F4AUPR                          WAAUPR
     I              F4CRCD                          WACRCD
     I              F4A5DT                          WAA5DT
     I              F4AWDT                          WAAWDT
     I              F4HDDT                          WAHDDT
     I              F4AGCS                          WAAGCS
     I              F4AQCS                          WAAQCS
     I              F4AVWG                          WAAVWG
     I              F4AYVA                          WAAYVA
     I              F4AMST                          WAAMST
     I              F4ANST                          WAANST
     I              F4VAST                          WAVAST
     I              F4L6NB                          WAL6NB
     I              F4UMCD                          WAUMCD
     I              F4HCDT                          WAHCDT
     I              F4ESNB                          WAESNB
     I              F4ETNB                          WAETNB
     I              F4BZNB                          WABZNB
     I              F4EXQT                          WAEXQT
     I              F4BYWG                          WABYWG
     I              F4S5NB                          WAS5NB
     I              F4MAVA                          WAMAVA
     I              F4KDVA                          WAKDVA
     I              F4USVA                          WAUSVA
     I              F4UTVA                          WAUTVA
     I              F4A4WG                          WAA4WG
     I              F4CKNB                          WACKNB
     I              F4BMST                          WABMST
     I              F4R8NB                          WAR8NB
     I              F4RMCD                          WARMCD
     I              F4BZPR                          WABZPR
     I              F4RDCD                          WARDCD
     I              F4Q7CD                          WAQ7CD
     I              F4EXDT                          WAEXDT
     I              F4LQCD                          WALQCD
     I              F4HICD                          WAHICD
     I              F4RBCD                          WARBCD
     I              F4RGNB                          WARGNB
     I              F4RHNB                          WARHNB
     I              F4RINB                          WARINB
     I              F4R1NB                          WAR1NB
     I              F4CONB                          WACONB
     I              F4CEST                          WACEST
     I              F4GNDT                          WAGNDT
     I              F4RMNB                          WARMNB
     I              F4AODT                          WAAODT
     I              F4LLCD                          WALLCD
     I              F4LMCD                          WALMCD
     I              F4SKNB                          WASKNB
     I              F4SLNB                          WASLNB
     I              F4SMNB                          WASMNB
     I              F4G7NA                          WAG7NA
     I              F4ONVA                          WAONVA
     I              F4N0CD                          WAN0CD
     I              F4B4NB                          WAB4NB
     I              F4B5NB                          WAB5NB
     I              F4N1CD                          WAN1CD
     I              F4GIDT                          WAGIDT
     I              F4Z1ST                          WAZ1ST
     I              F4ULVA                          WAULVA
     I              F4UNVA                          WAUNVA
     I              F4UOVA                          WAUOVA
     I              F4UPVA                          WAUPVA
     I              F4UQVA                          WAUQVA
     I              F4SDCD                          WASDCD
     I              F4QZCD                          WAQZCD
     I              F4XWST                          WAXWST
     I              F4T9CD                          WAT9CD
     I              F4UBCD                          WAUBCD
     I              F4CFC7                          WACFC7
     I              F4X1CD                          WAX1CD
     I              F4GASX                          WAGASX
     I              F4DUPR                          WADUPR
     I              F4B6VL                          WAB6VL
     I              F4IANX                          WAIANX
     I              F4IBNX                          WAIBNX
     I              F4RPCD                          WARPCD
     I              F4NYDT                          WANYDT
     I              F4BZTM                          WABZTM
     I              F4Z4NB                          WAZ4NB
     I              F4XACD                          WAXACD
     I              F4OANA                          WAOANA
     I              F4OKTX                          WAOKTX
     I              F4K4TX                          WAK4TX
     I              F4NBBO                          WANBBO
     I              F4OCFR                          WAOCFR
     I              F4C0C7                          WAC0C7
     I              F4A1AA                          WAA1AA
     I              F4VEST                          WAVEST
     I              F4A5PR                          WAA5PR
     I              F4CDPR                          WACDPR
     I              F4D0PR                          WAD0PR
     I              F4D0VL                          WAD0VL
     I              F4IRSX                          WAIRSX
     I              F4CEVL                          WACEVL
     I              F4ISSX                          WAISSX
     I              F4ITSX                          WAITSX
     I              F4IUSX                          WAIUSX
     I              F4OHDT                          WAOHDT
     I              F4D9PR                          WAD9PR
     I              F4CFVL                          WACFVL
     I              F4UVST                          WAUVST
     I              F4UWST                          WAUWST
     I              F4UXST                          WAUXST
     I              F4AATM                          WAAATM
     I              F4AYNA                          WAAYNA
     I              F4A0NA                          WAA0NA
     I              F4AXDT                          WAAXDT
      *
     I@EXRETY
      * Order Types               Active order Types
      * Renamed input format fields
     I              EXJNCD                          WBJNCD
     I              EXJVNA                          WBJVNA
     I              EXOAST                          WBOAST
     I              EXOBST                          WBOBST
     I              EXOEST                          WBOEST
     I              EXOFST                          WBOFST
     I              EXVBST                          WBVBST
     I              EXPYST                          WBPYST
     I              EXX8ST                          WBX8ST
     I              EXISTX                          WBISTX
     I              EXUVST                          WBUVST
     I              EXUWST                          WBUWST
     I              EXUXST                          WBUXST
     I              EXVSST                          WBVSST
     I              EXAATM                          WBAATM
     I              EXAYNA                          WBAYNA
     I              EXA0NA                          WBA0NA
     I              EXAXDT                          WBAXDT
      *
     I@EOREUB
      * Company Customer          Active Records         N
      * Renamed input format fields
     I              EOAIC3                          WCAIC3
     I              EOBKC7                          WCBKC7
     I              EOAQCD                          WCAQCD
     I              EOR4CD                          WCR4CD
     I              EOBYNA                          WCBYNA
     I              EOB6NA                          WCB6NA
     I              EOBZNA                          WCBZNA
     I              EOLLST                          WCLLST
     I              EOPPST                          WCPPST
     I              EOR5NB                          WCR5NB
     I              EOR6NB                          WCR6NB
     I              EOQGST                          WCQGST
     I              EOBOCD                          WCBOCD
     I              EOTBNB                          WCTBNB
     I              EOMTCU                          WCMTCU
     I              EOW2NB                          WCW2NB
     I              EORPCD                          WCRPCD
     I              EOAJCD                          WCAJCD
     I              EOX9ST                          WCX9ST
     I              EOT9CD                          WCT9CD
     I              EOUBCD                          WCUBCD
     I              EOISTX                          WCISTX
     I              EOLQCD                          WCLQCD
     I              EONJNA                          WCNJNA
     I              EOI0TX                          WCI0TX
     I              EONKNA                          WCNKNA
     I              EOI1TX                          WCI1TX
     I              EOVLST                          WCVLST
     I              EORLST                          WCRLST
     I              EOMMTX                          WCMMTX
     I              EOOHNA                          WCOHNA
     I              EOQ6ST                          WCQ6ST
     I              EOQ8ST                          WCQ8ST
     I              EORBST                          WCRBST
     I              EOREST                          WCREST
     I              EOUVST                          WCUVST
     I              EOUWST                          WCUWST
     I              EOUXST                          WCUXST
     I              EOVSST                          WCVSST
     I              EOAATM                          WCAATM
     I              EOAYNA                          WCAYNA
     I              EOA0NA                          WCA0NA
     I              EOAXDT                          WCAXDT
      *
     I@H4REQC
      * Cust Pound & Dollar WK    Retrieval index
      * Renamed input format fields
     I              H4BTC7                          WDBTC7
     I              H4ANC7                          WDANC7
     I              H4AIC3                          WDAIC3
     I              H4BKC7                          WDBKC7
     I              H4T9CD                          WDT9CD
     I              H4YEVA                          WDYEVA
     I              H4ATWG                          WDATWG
     I              H4MBVA                          WDMBVA
      *
     I@H4REQB
      * Cust Pound & Dollar WK    Update index
      * Renamed input format fields
     I              H4BTC7                          WEBTC7
     I              H4ANC7                          WEANC7
     I              H4AIC3                          WEAIC3
     I              H4BKC7                          WEBKC7
     I              H4T9CD                          WET9CD
     I              H4YEVA                          WEYEVA
     I              H4ATWG                          WEATWG
     I              H4MBVA                          WEMBVA
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQOMH41    E DSOMH4REL0
      * UPD : Cust Pound & Dollar WK    Update index
      * Renamed input format fields
     I              H4BTC7                          WEBTC7
     I              H4ANC7                          WEANC7
     I              H4AIC3                          WEAIC3
     I              H4BKC7                          WEBKC7
     I              H4T9CD                          WET9CD
     I              H4YEVA                          WEYEVA
     I              H4ATWG                          WEATWG
     I              H4MBVA                          WEMBVA
      *
     IYARDCS      DS                             35
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: *Arrays
      * I :  USR Sales Realiz. Flag
     I                                        1   1 P1JHST
      * I :  USR Active Flag
     I                                        2   2 P1W2ST
      * I :  USR Input 2
     I                                        3   3 P1SHST
      * I :  USR Customer Type
     I                                        4   4 P1CTYP
     IP2PARM      DS
      * FLD: Sales History
      * I : MAP Company Number
     I                                    P   1   20P2AIC3
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1JHST    PARM           WP0001  1        USR Sales Reali
     C           P1W2ST    PARM           WP0002  1        USR Active Flag
     C           P1SHST    PARM           WP0003  1        USR Input 2
     C           P1CTYP    PARM           WP0004  1        USR Customer Ty
     C           P2AIC3    PARM           WP0005  30       Company Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CRT Bld Cust Pnd & Dol XF
      * RTV Bld Cust Pnd & Dol RT - Sales History  * 
     C                     EXSR SARVGN
      * ***** Change Log and Comments
     C                     EXSR UBSUBR                     ***** Change Lo
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Bld Cust Pnd & Dol RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * ***** Change Log and Comments
     C                     EXSR UASUBR                     ***** Change Lo
      * Establish starting position
     C           *LOVAL    SETLL@FHSTD3                    *
     C                     READ @FHSTD3                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * ** 02/07/2007 LJB L70117a
      * ** Don't skip the record if a Company is passed in. The record
      * ** needs to be written so history can be retrieved when the repor
      * ** is printed. Just zero out the amount if the company is passed
      * RTV Billing Type       RT - Order Types  * 
     C                     EXSR SBRVGN
      * FOB Gross Amount and Weight Billed
      * CASE: WRK.Billing Activity Type is Invoice
     C           WUOBST    IFEQ '1'                        *IF
      * CASE: DB1.Affect Sales Doll Status is no
     C           WAANST    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWAUSVA    WUUSVA           FOB Gross Amoun
     C                     END                             *FI
      * CASE: DB1.Affect Sales Pnds Status is no
     C           WAVAST    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWABYWG    WUBYWG           Weight Billed
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Credit or Debit memo
      * CASE: PAR.USR Sales Realiz. Flag is Process by Flags
     C           P1JHST    IFEQ 'P'                        *IF
      * CASE: DB1.Affect Sales Doll Status is no
     C           WAANST    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWAUSVA    WUUSVA           FOB Gross Amoun
     C                     END                             *FI
      * CASE: DB1.Affect Sales Pnds Status is no
     C           WAVAST    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWABYWG    WUBYWG           Weight Billed
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.USR Sales Realiz. Flag is All
     C           P1JHST    IFEQ 'A'                        *IF
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.Affect Sales Doll Status is no
      *   |- c2    : DB1.Affect Sales Pnds Status is yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAANST    IFEQ 'N'                        *IF
     C           WAVAST    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWAUSVA    WUUSVA           FOB Gross Amoun
     C                     END                             *FI
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.Affect Sales Pnds Status is no
      *   |- c2    : DB1.Affect Sales Doll Status is yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAVAST    IFEQ 'N'                        *IF
     C           WAANST    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWABYWG    WUBYWG           Weight Billed
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.USR Sales Realiz. Flag is None
     C           P1JHST    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * If Credit Memo weight is greater than zero, reverse the sign
      * CASE:
      *  - c1ANDc2
      *   |- c1    : WRK.Weight Billed is Greater than zero
      *   |- c2    : WRK.Billing Activity Type is Credit Memo
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUBYWG    IFGT *ZERO                      *IF
     C           WUOBST    IFEQ '2'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C           *ZERO     SUB  WUBYWG    WUBYWG           Weight Billed
     C                     END                             *FI
     C                     END                             *FI
      * Determine primary customer on report
      * CASE: PAR.USR Customer Type is Parent
     C           P1CTYP    IFEQ '1'                        *IF
     C                     Z-ADDWABTC7    WUAJNB           Customer Number
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.USR Customer Type is A/R
     C           P1CTYP    IFEQ '2'                        *IF
     C                     Z-ADDWAANC7    WUAJNB           Customer Number
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWABKC7    WUAJNB           Customer Number
     C                     END                             *FI
     C                     END                             *FI
      * Retrieve Group Code only if report is by Group Code
      * CASE: PAR.USR Active Flag is Record Found
     C           P1W2ST    IFEQ 'Y'                        *IF
      * RTV Cust Ordering Dflt2RT - Company Customer  * slm 03/26/2009
     C                     EXSR SCRVGN
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUT9CD           Customer Group
     C                     END                             *FI
      * Use only one customer field for now.
      * RTV Check Existance    RT - Cust Pound & Dollar WK  * 
     C                     EXSR SDRVGN
      * Update existing record or create a new one
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * ** If Co# was passed in and db1 co doesn't match, zero amount & w
      * **                                             LJB L70117a
      * CASE: PAR.Company Number is not equal to zero
     C           P2AIC3    IFNE *ZERO                      *IF
      * CASE: DB1.Company Number NE PAR.Company Number
     C           WAAIC3    IFNE P2AIC3                     *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     END                             *FI
     C                     END                             *FI
     C                     ADD  WUBYWG    WUATWG           Weight Shipped
     C                     ADD  WUUSVA    WUMBVA           Billing Amount
      * Determine if ranking sort field is pounds or dollars
      * CASE: PAR.USR Input 2 is Yes
     C           P1SHST    IFEQ 'Y'                        *IF
     C                     Z-ADDWUMBVA    WUYEVA           Ranking Sort Fi
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWUATWG    WUYEVA           Ranking Sort Fi
     C                     END                             *FI
      * CHG OM Cust Pound & Do CH - Cust Pound & Dollar WK  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWUW0NB    WL0001           Parent Customer
     C                     Z-ADDWUW0NB    WL0002           A/R Customer Nu
     C                     Z-ADDP2AIC3    WL0003           Company Number
     C                     Z-ADDWUAJNB    WL0004           Ship To Custome
     C                     MOVELWUT9CD    WL0005    P      Customer Group
     C                     Z-ADDWUYEVA    WL0006           Ranking Sort Fi
     C                     Z-ADDWUATWG    WL0007           Weight Shipped
     C                     Z-ADDWUMBVA    WL0008           Billing Amount
     C                     EXSR SECHRC
     C                     ELSE
      * CASE: *OTHERWISE
      * ** If Co# was passed in and db1 co doesn't match, zero amount & w
      * **                                             LJB L70117a
      * CASE: PAR.Company Number is not equal to zero
     C           P2AIC3    IFNE *ZERO                      *IF
      * CASE: DB1.Company Number NE PAR.Company Number
     C           WAAIC3    IFNE P2AIC3                     *IF
     C                     Z-ADD*ZERO     WUUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WUBYWG           Weight Billed
     C                     END                             *FI
     C                     END                             *FI
      * Determine if ranking sort field is pounds or dollars
      * CASE: PAR.USR Input 2 is Yes
     C           P1SHST    IFEQ 'Y'                        *IF
     C                     Z-ADDWUUSVA    WUYEVA           Ranking Sort Fi
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWUBYWG    WUYEVA           Ranking Sort Fi
     C                     END                             *FI
      * CRT OM Cust Pnd & Dlr  CR - Cust Pound & Dollar WK  * 
     C                     EXSR SFCRRC
     C                     END                             *FI
     C                     READ @FHSTD3                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Billing Type       RT - Order Types  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WBJNCD           Order Type - Sa
      * Setup key
     C                     MOVELWAJNCD    WBJNCD           Order Type - Sa
      * Establish starting position
     C           KRSSB     CHAIN@EXRETY              90    *
      * Data record not found
     C   90                MOVEL'USR1063' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBOBST    WUOBST           Billing Activit
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Cust Ordering Dflt2RT - Company Customer  * slm 03/26/2009
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCBKC7           Ship To Custome
      * Setup key
     C                     Z-ADDWAAIC3    WCAIC3           Company Number
     C                     Z-ADDWUAJNB    WCBKC7           Ship To Custome
      * Establish starting position
     C           KRSSC     CHAIN@EOREUB              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1007' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAQCD           Terms Code
     C                     MOVEL*BLANK    WUR4CD           Sales Route Cod
     C                     MOVEL*BLANK    WUBYNA           Special Instruc
     C                     MOVEL*BLANK    WUB6NA           Special Instruc
     C                     MOVEL*BLANK    WUPPST           P.O. Required F
     C                     Z-ADD*ZERO     WUR5NB           Deliver after t
     C                     MOVEL*BLANK    WUBOCD           Type Code
     C                     Z-ADD*ZERO     WUTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WUMTCU           Mileage To Cust
     C                     MOVEL*BLANK    WUAJCD           Warehouse Code
     C                     MOVEL*BLANK    WUX9ST           Outside Warehou
     C                     MOVEL*BLANK    WUT9CD           Customer Group
     C                     MOVEL*BLANK    WUUBCD           Customer Group
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCAQCD    WUAQCD           Terms Code
     C                     MOVELWCR4CD    WUR4CD           Sales Route Cod
     C                     MOVELWCBYNA    WUBYNA           Special Instruc
     C                     MOVELWCB6NA    WUB6NA           Special Instruc
     C                     MOVELWCPPST    WUPPST           P.O. Required F
     C                     Z-ADDWCR5NB    WUR5NB           Deliver after t
     C                     MOVELWCBOCD    WUBOCD           Type Code
     C                     Z-ADDWCTBNB    WUTBNB           Absorbed Freigh
     C                     Z-ADDWCMTCU    WUMTCU           Mileage To Cust
     C                     MOVELWCAJCD    WUAJCD           Warehouse Code
     C                     MOVELWCX9ST    WUX9ST           Outside Warehou
     C                     MOVELWCT9CD    WUT9CD           Customer Group
     C                     MOVELWCUBCD    WUUBCD           Customer Group
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Check Existance    RT - Cust Pound & Dollar WK  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WDBTC7           Parent Customer
     C                     KFLD           WDANC7           A/R Customer Nu
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDBKC7           Ship To Custome
      * Setup key
     C                     Z-ADDWUW0NB    WDBTC7           Parent Customer
     C                     Z-ADDWUW0NB    WDANC7           A/R Customer Nu
     C                     Z-ADDP2AIC3    WDAIC3           Company Number
     C                     Z-ADDWUAJNB    WDBKC7           Ship To Custome
      * Establish starting position
     C           KRSSD     CHAIN@H4REQC              90    *
      * Data record not found
     C   90                MOVEL'USR1623' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDWDYEVA    WUYEVA           Ranking Sort Fi
     C                     Z-ADDWDATWG    WUATWG           Weight Shipped
     C                     Z-ADDWDMBVA    WUMBVA           Billing Amount
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * CHG OM Cust Pound & Do CH - Cust Pound & Dollar WK  * 
      *================================================================
      * This is a shared subroutine
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @H4REQB
     C                     Z-ADDWL0001    WEBTC7           Parent Customer
     C                     Z-ADDWL0002    WEANC7           A/R Customer Nu
     C                     Z-ADDWL0003    WEAIC3           Company Number
     C                     Z-ADDWL0004    WEBKC7           Ship To Custome
      *
     C           KLCHSE    KLIST
     C                     KFLD           WEBTC7           Parent Customer
     C                     KFLD           WEANC7           A/R Customer Nu
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WEBKC7           Ship To Custome
     C           KLCHSE    CHAIN@H4REQB              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'OMH4REL0'MDACP
     C                     MOVEL'@H4REQB' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOMH41    YARDCS
      * Move non-key fields to @H4REQB
     C                     MOVELWL0005    WET9CD    P      Customer Group
     C                     Z-ADDWL0006    WEYEVA           Ranking Sort Fi
     C                     Z-ADDWL0007    WEATWG           Weight Shipped
     C                     Z-ADDWL0008    WEMBVA           Billing Amount
      *
      * Set PGM.*Record Data Changed flag
     C           QOMH41    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@H4REQB                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMH4REL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * CRT OM Cust Pnd & Dlr  CR - Cust Pound & Dollar WK  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @H4REQB
     C                     Z-ADDWUW0NB    WEBTC7           Parent Customer
     C                     Z-ADDWUW0NB    WEANC7           A/R Customer Nu
     C                     Z-ADDP2AIC3    WEAIC3           Company Number
     C                     Z-ADDWUAJNB    WEBKC7           Ship To Custome
     C                     MOVELWUT9CD    WET9CD           Customer Group
     C                     Z-ADDWUYEVA    WEYEVA           Ranking Sort Fi
     C                     Z-ADDWUBYWG    WEATWG           Weight Shipped
     C                     Z-ADDWUUSVA    WEMBVA           Billing Amount
      *
     C           KLCRSF    KLIST
     C                     KFLD           WEBTC7           Parent Customer
     C                     KFLD           WEANC7           A/R Customer Nu
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WEBKC7           Ship To Custome
      * Check for duplicate primary key
     C           KLCRSF    SETLL@H4REQB                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1624' W0RTN   7
      * Send message 'Cust Pound & Dollar WK EX'
     C                     MOVEL'USR1624' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@H4REQB                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * ***** Change Log and Comments
      *================================================================
      * FP1309 Inventory Age  IF
      * FP1309 Inventory Age Code Description
      * ** 02/07/2007 LJB L70117a
      * ** Write a record to the work file even if Co# is passed in and
      * ** there is Zeros for the amount or weight. The record needs to
      * ** be there in order to retrieve the history for this customer
      * ** since there may be history with no records for the
      * ** requested date range.
      * ** Just zero out the amount when the company is passed in.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * ***** Change Log and Comments
      *================================================================
      * ** 02/07/2007 LJB L70117a
      * ** Write a record to the file even if the company number is
      * ** passed in and it doesn't match. The company/customer fields
      * ** are needed to retrieve the history amount & weight
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WABTC7           Parent Customer
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAORIT           Original Item
     C                     Z-ADD*ZERO     WAAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WAD0WG           Weight Ordered
     C                     Z-ADD*ZERO     WACCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WAAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WAAKPR           Unit Price
     C                     Z-ADD*ZERO     WAAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WAAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WAAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WAAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WAAYVA           Extended Amount
     C                     Z-ADD*ZERO     WAL6NB           Contract Number
     C                     Z-ADD*ZERO     WAHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WABYWG           Weight Billed
     C                     Z-ADD*ZERO     WAS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WAMAVA           Billing Detail
     C                     Z-ADD*ZERO     WAKDVA           Billing Detail
     C                     Z-ADD*ZERO     WAUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WAUTVA           Standard Overag
     C                     Z-ADD*ZERO     WAA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WAR8NB           Shipping Compan
     C                     Z-ADD*ZERO     WABZPR           Price Overage O
     C                     Z-ADD*ZERO     WAEXDT           Market Pricing
     C                     Z-ADD*ZERO     WARGNB           Item Structure
     C                     Z-ADD*ZERO     WARHNB           Item Structure
     C                     Z-ADD*ZERO     WARINB           Item Structure
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WASKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WASLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WASMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WAONVA           Actual Freight
     C                     Z-ADD*ZERO     WAB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WAB5NB           PM Line Number
     C                     Z-ADD*ZERO     WAGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WAULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WAUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WAUOVA           Commission Amou
     C                     Z-ADD*ZERO     WAUPVA           Financials Amou
     C                     Z-ADD*ZERO     WAUQVA           Financials Amou
     C                     Z-ADD*ZERO     WACFC7           Order Group Cod
     C                     Z-ADD*ZERO     WADUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WAB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WAIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WAIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WANYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WABZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WAZ4NB           MPC Number
     C                     Z-ADD*ZERO     WAOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WAA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WACDPR           Market Value
     C                     Z-ADD*ZERO     WAD0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WAD0VL           Raw Material Co
     C                     Z-ADD*ZERO     WACEVL           Sales Expense T
     C                     Z-ADD*ZERO     WAOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WAD9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WACFVL           HST Item Target
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field Billing Activity Type
     C                     MOVEL*BLANK    WUOBST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Define work field FOB Gross Amount
     C                     Z-ADD*ZERO     WUUSVA 112
      * Define work field Weight Billed
     C                     Z-ADD*ZERO     WUBYWG 112
      * Define work field Customer Number       NBR
     C                     Z-ADD*ZERO     WUAJNB  70
      * Define work field Terms Code
     C                     MOVEL*BLANK    WUAQCD  2
      * Define work field Sales Route Code
     C                     MOVEL*BLANK    WUR4CD  3
      * Define work field Special Instructions 2
     C                     MOVEL*BLANK    WUBYNA 40
      * Define work field Special Instructions
     C                     MOVEL*BLANK    WUB6NA 40
      * Define work field P.O. Required Flag
     C                     MOVEL*BLANK    WUPPST  1
      * Define work field Deliver after time
     C                     Z-ADD*ZERO     WUR5NB  40
      * Define work field Type Code
     C                     MOVEL*BLANK    WUBOCD  2
      * Define work field Absorbed Freight Rate CWT
     C                     Z-ADD*ZERO     WUTBNB  52
      * Define work field Mileage To Customer
     C                     Z-ADD*ZERO     WUMTCU  92
      * Define work field Warehouse Code
     C                     MOVEL*BLANK    WUAJCD  3
      * Define work field Outside Warehouse Flag
     C                     MOVEL*BLANK    WUX9ST  1
      * Define work field Customer Group Code
     C                     MOVEL*BLANK    WUT9CD  3
      * Define work field Customer Group Code 2
     C                     MOVEL*BLANK    WUUBCD  3
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCR5NB           Deliver after t
     C                     Z-ADD*ZERO     WCR6NB           Deliver before
     C                     Z-ADD*ZERO     WCTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WCMTCU           Mileage To Cust
     C                     Z-ADD*ZERO     WCW2NB           Co/Cust Overage
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
      * Define work field Ranking Sort Field
     C                     Z-ADD*ZERO     WUYEVA 112
      * Define work field Weight Shipped Total
     C                     Z-ADD*ZERO     WUATWG 112
      * Define work field Billing Amount
     C                     Z-ADD*ZERO     WUMBVA 112
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDBTC7           Parent Customer
     C                     Z-ADD*ZERO     WDANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDYEVA           Ranking Sort Fi
     C                     Z-ADD*ZERO     WDATWG           Weight Shipped
     C                     Z-ADD*ZERO     WDMBVA           Billing Amount
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SECHRC.
     C                     Z-ADD*ZERO     WL0001  70
     C                     Z-ADD*ZERO     WL0002  70
     C                     Z-ADD*ZERO     WL0003  30
     C                     Z-ADD*ZERO     WL0004  70
     C                     MOVEL*BLANK    WL0005  3
     C                     Z-ADD*ZERO     WL0006 112
     C                     Z-ADD*ZERO     WL0007 112
     C                     Z-ADD*ZERO     WL0008 112
      * Define null work field Carrier Code
     C                     MOVEL*BLANK    YN0001  3
      * Define null work field Ord Ent Default Sls Rte
     C                     MOVEL*BLANK    YN0002  1
      *================================================================
     CSR         ZZEXIT    ENDSR
