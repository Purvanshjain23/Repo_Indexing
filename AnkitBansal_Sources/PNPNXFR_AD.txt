// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PNPNXFR
// ?Date: 14.08.2025 Time: 03:44:36
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// Call program Rtv & Incr 9.0 number  XF.
CALL PROGRAM(Rtv & Incr 9.0 number  XF) ('PMPMXFR');
PARAMETER(360);
PARAMETER('SSISEQID');
PARAMETER(WRK.System_Value_Numeric);

// WRK.WFSH Sequence Number = WRK.System Value Numeric
WRK.WFSH_Sequence_Number = WRK.System_Value_Numeric;

// WRK.Text USR 9 = CVTVAR(WRK.WFSH Sequence Number)
WRK.Text_USR_9 = CVTVAR(WRK.WFSH_Sequence_Number);

// PAR.SSI SOR Sequence ID = WRK.Text USR 9
PAR.SSI_SOR_Sequence_ID = WRK.Text_USR_9;

EXECUTE FUNCTION(RTV SSI Control Info   RT) TYPE(RTVOBJ) FILE(PMERREP)          AC1903641;
PARAMETER(PAR.SSI_SOR_Sequence_ID);
PARAMETER(PAR.SSI_SOR_Identifier);
PARAMETER(PAR.SSI_EOT_Identifier);
PARAMETER(PAR.SSI_Sequence_Number_70);
PARAMETER(PAR.SSI_SOR_SCAC);
PARAMETER(PAR.SSI_Trading_Partner_Name);
PARAMETER(PAR.SSI_SOR_Date_80_alpha);
PARAMETER(PAR.SSI_SOR_Time_40_alpha);
PARAMETER(PAR.SSI_EOT_Record_Count);
PARAMETER(PAR.SSI_Transmission_Status);
PARAMETER(PAR.Carrier_Code);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?** A record with the new control record should not be found.
 //?** All calcs are done in Data record not found section
 ENDDO;

 //?USER: Processing if Data record not found

 // PAR.SSI SOR Identifier = CND.SSI Control Identifier
 PAR.SSI_SOR_Identifier = '#SSI204';

 EXECUTE FUNCTION(RTV Company Name Only  RT) TYPE(RTVOBJ) FILE(CAABREP)          AC1100959;
 PARAMETER(360);
 PARAMETER(PAR.SSI_Trading_Partner_Name);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(RTV Name, Status       RT) TYPE(RTVOBJ) FILE(OMFFREP)          AC1260598;
 PARAMETER(PAR.Carrier_Code);
 PARAMETER(WRK.SCAC_Code);
 PARAMETER(NLL.Record_Status);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 // PAR.SSI SOR SCAC = WRK.SCAC Code
 PAR.SSI_SOR_SCAC = WRK.SCAC_Code;

 // WRK.Job Date = JOB.*Job date
 WRK.Job_Date = JOB.*Job_date;

 EXECUTE FUNCTION(CNV cyymmdd to yyyymmdd) TYPE(EXCINTFUN)                       AC1732965;
 PARAMETER(WRK.Job_Date);
 PARAMETER(WRK.Date_8_0_USR);
 {
  //?Execute internal function

  // LCL.Year Code = PAR.Date In  (7,0) USR *YEAR
  LCL.Year_Code = DATEDTLS(PAR.Date_In_70_USR 'YR' 1111111 'NONE' 'N' 1);

  // LCL.Month NBR USR = PAR.Date In  (7,0) USR *MONTH
  LCL.Month_NBR_USR = DATEDTLS(PAR.Date_In_70_USR 'MO' 1111111 'NONE' 'N' 1);

  // LCL.Day of Month USR = PAR.Date In  (7,0) USR *DAY OF MONTH
  LCL.Day_of_Month_USR = DATEDTLS(PAR.Date_In_70_USR 'DM' 1111111 'NONE' 'N' 1);

  // PAR.Year Alpha (YYYY) USR = CVTVAR(LCL.Year Code)
  PAR.Year_Alpha_YYYY_USR = CVTVAR(LCL.Year_Code);

  // PAR.Month (Char) USR = CVTVAR(LCL.Month NBR USR)
  PAR.Month_Char_USR = CVTVAR(LCL.Month_NBR_USR);

  // PAR.Day   (Char) USR = CVTVAR(LCL.Day of Month USR)
  PAR.Day_Char_USR = CVTVAR(LCL.Day_of_Month_USR);

  // PAR.Date (Char-8) USR = CONCAT(PAR.Year Alpha (YYYY) USR,PAR.Month (Char) USR,CON.*ZERO)
  PAR.Date_Char_8_USR = PAR.Year_Alpha_YYYY_USR + PAR.Month_Char_USR (*ZERO);

  // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,PAR.Day   (Char) USR,CON.*ZERO)
  PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + PAR.Day_Char_USR (*ZERO);

  // PAR.Date Out (8,0) USR = CVTVAR(PAR.Date (Char-8) USR)
  PAR.Date_Out_80_USR = CVTVAR(PAR.Date_Char_8_USR);

 }

 // PAR.SSI SOR Date 8,0 alpha = CVTVAR(WRK.Date 8.0 USR)
 PAR.SSI_SOR_Date_80_alpha = CVTVAR(WRK.Date_8_0_USR);

 // WRK.Time = JOB.*Job time
 WRK.Time = JOB.*Job_time;

 // PAR.SSI SOR Time 4,0 alpha = CVTVAR(WRK.Time)
 PAR.SSI_SOR_Time_40_alpha = CVTVAR(WRK.Time);

 // PAR.SSI Sequence Number 7,0 = CON.1
 PAR.SSI_Sequence_Number_70 = 1;

 //?USER: Process Data record

 // PAR.SSI Sequence Number 7,0 = DB1.SSI Sequence Number 7,0 + CON.1
 PAR.SSI_Sequence_Number_70 = DB1.SSI_Sequence_Number_70 + 1;

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

}


EXECUTE FUNCTION(CRT SSI Control        CR) TYPE(CRTOBJ) FILE(PMERREP)          AC1903148;
PARAMETER(PAR.SSI_SOR_Sequence_ID);
PARAMETER(PAR.SSI_SOR_Identifier);
PARAMETER(PAR.SSI_EOT_Identifier);
PARAMETER(PAR.SSI_Sequence_Number_70);
PARAMETER(PAR.SSI_SOR_SCAC);
PARAMETER(PAR.SSI_Trading_Partner_Name);
PARAMETER(PAR.SSI_SOR_Date_80_alpha);
PARAMETER(PAR.SSI_SOR_Time_40_alpha);
PARAMETER(PAR.SSI_EOT_Record_Count);
PARAMETER(PAR.SSI_Transmission_Status);

// WRK.Count USR = CON.*ZERO
WRK.Count_USR = *ZERO;

//?** Create all the SSI records for this load ID
//?** (this is the function that does all the work)
// Call program RTV CRT SSI Load HeaderXF.
CALL PROGRAM(RTV CRT SSI Load HeaderXF) ('PPGHXFR');
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Carrier_Code);
PARAMETER(PAR.SSI_SOR_Sequence_ID);
PARAMETER(PAR.SSI_SOR_Identifier);
PARAMETER(PAR.SSI_Sequence_Number_70);
PARAMETER(PAR.SSI_SOR_SCAC);
PARAMETER(PAR.SSI_Trading_Partner_Name);
PARAMETER(PAR.SSI_SOR_Date_80_alpha);
PARAMETER(PAR.SSI_SOR_Time_40_alpha);
PARAMETER(WRK.Count_USR);
PARAMETER(PAR.SSI_Add_Chg_Delete_flag);

// WRK.Text USR 5 = CVTVAR(WRK.Count USR)
WRK.Text_USR_5 = CVTVAR(WRK.Count_USR);

// PAR.SSI EOT Record Count = WRK.Text USR 5
PAR.SSI_EOT_Record_Count = WRK.Text_USR_5;

// PAR.SSI Sequence Number 7,0 = PAR.SSI Sequence Number 7,0 + CON.1
PAR.SSI_Sequence_Number_70 = PAR.SSI_Sequence_Number_70 + 1;

EXECUTE FUNCTION(CRT SSI Control EOT recCR) TYPE(CRTOBJ) FILE(PMERREP)          AC1903812;
PARAMETER(PAR.SSI_SOR_Sequence_ID);
PARAMETER(PAR.SSI_SOR_Identifier);
PARAMETER('#EOT');
PARAMETER(PAR.SSI_Sequence_Number_70);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(PAR.SSI_SOR_Date_80_alpha);
PARAMETER(PAR.SSI_SOR_Time_40_alpha);
PARAMETER(PAR.SSI_EOT_Record_Count);
PARAMETER('N');

