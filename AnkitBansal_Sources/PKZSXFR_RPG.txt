     H/TITLE Dlt Tattoo - all files XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 11/03/20  Time  : 07:09:47
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKDHREL0IF  E           K        DISK                      A
      * UPD : Tattoo Header History     Update index
      *
     I@DHRETZ
      * Tattoo Header History     Update index
      * Renamed input format fields
     I              DHW2NB                          WAW2NB
     I              DHW3NB                          WAW3NB
     I              DHW4NB                          WAW4NB
     I              DHW5NB                          WAW5NB
     I              DHCXDT                          WACXDT
     I              DHCYDT                          WACYDT
     I              DHFFCD                          WAFFCD
     I              DHMPST                          WAMPST
     I              DHINPR                          WAINPR
     I              DHW6NB                          WAW6NB
     I              DHW7NB                          WAW7NB
     I              DHW8NB                          WAW8NB
     I              DHMQST                          WAMQST
     I              DHMRST                          WAMRST
     I              DHMSST                          WAMSST
     I              DHW9NB                          WAW9NB
     I              DHFGCD                          WAFGCD
     I              DHMTST                          WAMTST
     I              DHACCD                          WAACCD
     I              DHABCD                          WAABCD
     I              DHAECD                          WAAECD
     I              DHAGCD                          WAAGCD
     I              DHBDCD                          WABDCD
     I              DHBECD                          WABECD
     I              DHCSCD                          WACSCD
     I              DHAAVN                          WAAAVN
     I              DHAADT                          WAAADT
     I              DHAMTM                          WAAMTM
     I              DHAJST                          WAAJST
     I              DHAHVN                          WAAHVN
     I              DHAGVN                          WAAGVN
     I              DHABVN                          WAABVN
     I              DHABDT                          WAABDT
     I              DHABTM                          WAABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKDH1    E DSPKDHREL0
      * UPD : Tattoo Header History     Update index
      * Renamed input format fields
     I              DHW2NB                          WAW2NB
     I              DHW3NB                          WAW3NB
     I              DHW4NB                          WAW4NB
     I              DHW5NB                          WAW5NB
     I              DHCXDT                          WACXDT
     I              DHCYDT                          WACYDT
     I              DHFFCD                          WAFFCD
     I              DHMPST                          WAMPST
     I              DHINPR                          WAINPR
     I              DHW6NB                          WAW6NB
     I              DHW7NB                          WAW7NB
     I              DHW8NB                          WAW8NB
     I              DHMQST                          WAMQST
     I              DHMRST                          WAMRST
     I              DHMSST                          WAMSST
     I              DHW9NB                          WAW9NB
     I              DHFGCD                          WAFGCD
     I              DHMTST                          WAMTST
     I              DHACCD                          WAACCD
     I              DHABCD                          WAABCD
     I              DHAECD                          WAAECD
     I              DHAGCD                          WAAGCD
     I              DHBDCD                          WABDCD
     I              DHBECD                          WABECD
     I              DHCSCD                          WACSCD
     I              DHAAVN                          WAAAVN
     I              DHAADT                          WAAADT
     I              DHAMTM                          WAAMTM
     I              DHAJST                          WAAJST
     I              DHAHVN                          WAAHVN
     I              DHAGVN                          WAAGVN
     I              DHABVN                          WAABVN
     I              DHABDT                          WAABDT
     I              DHABTM                          WAABTM
      *
      * Outward parameters
     IPARC        DS                             18
      * KEY : Tattoo Header History Com Retrieval index
      * I : RST THH company number
     I                                    P   1   20PAW2NB
      * I : RST THH Buy Order Number
     I                                    P   3   60PAW3NB
      * I : RST THH Load Number
     I                                    P   7   90PAW4NB
      * I : RST THH Tattoo Number
     I                                    P  10  120PAW5NB
      * I : RST THH Kill Date
     I                                    P  13  160PACXDT
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Tattoo Header
      * I :  BOH Company Number
     I                                    P   1   20P1HMNB
      * I :  BOH Buy Order Number
     I                                    P   3   60P1BNNB
      * I :  BOL Load Number
     I                                    P   7   90P1BONB
      * I :  TH Tattoo Number
     I                                    P  10  120P1CVNB
      * I :  TH Kill Date
     I                                    P  13  160P1B0DT
      * I :  TH Purchase Date
     I                                    P  17  200P1AWDT
      * I :  TH Group Reference
     I                                       21  30 P1BICD
      * I :  TH Live Purchase UOM
     I                                       31  32 P1CPST
      * I :  TH Live Purchase Price
     I                                    P  33  352P1ACPR
      * I :  TH Dead On Arrival
     I                                    P  36  380P1CXNB
      * I :  TH Head Received
     I                                    P  39  410P1CWNB
      * I :  TH Live Wgt
     I                                    P  42  451P1CYNB
      * I :  TH Sex
     I                                       46  46 P1E2ST
      * I :  TH Source Type
     I                                       47  47 P1KAST
      * I :  TH Scale Ticket Sts
     I                                       48  48 P1J7ST
      * I :  TH Payment Type
     I                                       49  49 P1J9ST
      * I :  TH HPS Movement Ref #
     I                                    P  50  530P1OXNB
      * I :  TH Source Code
     I                                       54  56 P1LKST
      * I :  TH Hog Class Type
     I                                       57  57 P1LLST
      * I :  DF Defect Code
     I                                       58  63 P1BDCD
      * I :  THP Process Code
     I                                       64  69 P1CSCD
      * I :  PD Producer Code
     I                                       70  75 P1ABCD
      * I :  PL Location Code
     I                                       76  81 P1AECD
      * I :  HB Buyer Code
     I                                       82  84 P1ACCD
      * I :  GN Genetic Code
     I                                       85  89 P1AGCD
      * I :  HC Class Code
     I                                       90  92 P1BECD
      * I :  RS Job
     I                                       93 102 P1AHVN
      * I :  RS Program
     I                                      103 112 P1AGVN
      * I :  RS User Added
     I                                      113 122 P1ABVN
      * I :  RS Date Added
     I                                    P 123 1260P1ABDT
      * I :  RS Time Added
     I                                    P 127 1300P1ABTM
     IP2PARM      DS
      * I :  Oms System Value Alpha
     I                                        1  40 P2EVTX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HMNB    PARM           WP0001  30       BOH Company Num
     C           P1BNNB    PARM           WP0002  70       BOH Buy Order N
     C           P1BONB    PARM           WP0003  50       BOL Load Number
     C           P1CVNB    PARM           WP0004  50       TH Tattoo Numbe
     C           P1B0DT    PARM           WP0005  70       TH Kill Date
     C           P1AWDT    PARM           WP0006  70       TH Purchase Dat
     C           P1BICD    PARM           WP0007 10        TH Group Refere
     C           P1CPST    PARM           WP0008  2        TH Live Purchas
     C           P1ACPR    PARM           WP0009  52       TH Live Purchas
     C           P1CXNB    PARM           WP0010  50       TH Dead On Arri
     C           P1CWNB    PARM           WP0011  50       TH Head Receive
     C           P1CYNB    PARM           WP0012  71       TH Live Wgt
     C           P1E2ST    PARM           WP0013  1        TH Sex
     C           P1KAST    PARM           WP0014  1        TH Source Type
     C           P1J7ST    PARM           WP0015  1        TH Scale Ticket
     C           P1J9ST    PARM           WP0016  1        TH Payment Type
     C           P1OXNB    PARM           WP0017  70       TH HPS Movement
     C           P1LKST    PARM           WP0018  3        TH Source Code
     C           P1LLST    PARM           WP0019  1        TH Hog Class Ty
     C           P1BDCD    PARM           WP0020  6        DF Defect Code
     C           P1CSCD    PARM           WP0021  6        THP Process Cod
     C           P1ABCD    PARM           WP0022  6        PD Producer Cod
     C           P1AECD    PARM           WP0023  6        PL Location Cod
     C           P1ACCD    PARM           WP0024  3        HB Buyer Code
     C           P1AGCD    PARM           WP0025  5        GN Genetic Code
     C           P1BECD    PARM           WP0026  3        HC Class Code
     C           P1AHVN    PARM           WP0027 10        RS Job
     C           P1AGVN    PARM           WP0028 10        RS Program
     C           P1ABVN    PARM           WP0029 10        RS User Added
     C           P1ABDT    PARM           WP0030  70       RS Date Added
     C           P1ABTM    PARM           WP0031  60       RS Time Added
     C           P2EVTX    PARM           WP0032 40        Oms System Valu
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Dlt Tattoo - all files XF
      * Modifications and comments
     C                     EXSR UASUBR                     Modifications a
      * Crt TH History        CR - Tattoo Header History  * 
     C                     EXSR SACRRC
      * Delete all files in the Prompt called in this function.
      * Edt TH History Comm   EF - Tattoo Header History Com  * 
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(PAR) P1CWNB' defaulted for 'TH Head Received'.
      * Field '(PAR) P1CYNB' defaulted for 'TH Live Wgt'.
     C                     CLEARPARC
     C                     Z-ADDP1HMNB    PAW2NB           THH company num
     C                     Z-ADDP1BNNB    PAW3NB           THH Buy Order N
     C                     Z-ADDP1BONB    PAW4NB           THH Load Number
     C                     Z-ADDP1CVNB    PAW5NB           THH Tattoo Numb
     C                     Z-ADDP1B0DT    PACXDT           THH Kill Date
      *
     C                     CALL 'PKZPEFR'              90  Edt TH History
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Tattoo Hea
     C                     PARM P2EVTX    WQ0001 40        Oms System Valu
     C                     PARM P1CWNB    WQ0002  50       TH Head Receive
     C                     PARM P1CYNB    WQ0003  71       TH Live Wgt
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKZPEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACRRC    BEGSR
      *================================================================
      * Crt TH History        CR - Tattoo Header History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DHRETZ
     C                     Z-ADDP1HMNB    WAW2NB           THH company num
     C                     Z-ADDP1BNNB    WAW3NB           THH Buy Order N
     C                     Z-ADDP1BONB    WAW4NB           THH Load Number
     C                     Z-ADDP1CVNB    WAW5NB           THH Tattoo Numb
     C                     Z-ADDP1B0DT    WACXDT           THH Kill Date
     C                     Z-ADDP1AWDT    WACYDT           THH Purchase Da
     C                     MOVELP1BICD    WAFFCD           THH Tattoo Refe
     C                     MOVELP1CPST    WAMPST           THH Live Purcha
     C                     Z-ADDP1ACPR    WAINPR           THH Live Purcha
     C                     Z-ADDP1CXNB    WAW6NB           THH Dead on Arr
     C                     Z-ADDP1CWNB    WAW7NB           THH Head Receiv
     C                     Z-ADDP1CYNB    WAW8NB           THH Live Wgt
     C                     MOVELP1E2ST    WAMQST           THH Sex
     C                     MOVELP1KAST    WAMRST           THH Source Type
     C                     MOVELP1J7ST    WAMSST           THH Scale Ticke
     C                     Z-ADDP1OXNB    WAW9NB           THH Movement Re
     C                     MOVELP1LKST    WAFGCD           THH Source Code
     C                     MOVELP1LLST    WAMTST           THH Hog Class T
     C                     MOVELP1ACCD    WAACCD           HB Buyer Code
     C                     MOVELP1ABCD    WAABCD           PD Producer Cod
     C                     MOVELP1AECD    WAAECD           PL Location Cod
     C                     MOVELP1AGCD    WAAGCD           GN Genetic Code
     C                     MOVELP1BDCD    WABDCD           DF Defect Code
     C                     MOVELP1BECD    WABECD           HC Class Code
     C                     MOVELP1CSCD    WACSCD           THP Process Cod
     C                     MOVEL*BLANK    WAAAVN           RS User Changed
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     MOVEL'A'       WAAJST           RS Record Statu
     C                     MOVEL*BLANK    WAAHVN           RS Job
     C                     MOVEL*BLANK    WAAGVN           RS Program
     C                     MOVEL*BLANK    WAABVN           RS User Added
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WAAJST           RS Record Statu
     C                     MOVEL##USR     WAABVN           RS User Added
     C                     Z-ADD##JDT     WAABDT           RS Date Added
     C                     Z-ADD##JTM     WAABTM           RS Time Added
     C                     MOVEL##PGM     WAAGVN           RS Program
     C                     MOVEL##JOB     WAAHVN           RS Job
     C           KLCRSA    KLIST
     C                     KFLD           WAW2NB           THH company num
     C                     KFLD           WAW3NB           THH Buy Order N
     C                     KFLD           WAW4NB           THH Load Number
     C                     KFLD           WAW5NB           THH Tattoo Numb
     C                     KFLD           WACXDT           THH Kill Date
      * Check for duplicate primary key
     C           KLCRSA    SETLL@DHRETZ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0611' W0RTN   7
      * Send message 'Tattoo Header History  EX'
     C                     MOVEL'PRK0611' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C                     WRITE@DHRETZ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and comments
      *================================================================
      * H16853 ISE 11/03/20 - Increased the Buy Order Number field length
      *                       from 5 to 7.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAW2NB           THH company num
     C                     Z-ADD*ZERO     WAW3NB           THH Buy Order N
     C                     Z-ADD*ZERO     WAW4NB           THH Load Number
     C                     Z-ADD*ZERO     WAW5NB           THH Tattoo Numb
     C                     Z-ADD*ZERO     WACXDT           THH Kill Date
     C                     Z-ADD*ZERO     WACYDT           THH Purchase Da
     C                     Z-ADD*ZERO     WAINPR           THH Live Purcha
     C                     Z-ADD*ZERO     WAW6NB           THH Dead on Arr
     C                     Z-ADD*ZERO     WAW7NB           THH Head Receiv
     C                     Z-ADD*ZERO     WAW8NB           THH Live Wgt
     C                     Z-ADD*ZERO     WAW9NB           THH Movement Re
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
