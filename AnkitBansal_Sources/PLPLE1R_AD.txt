// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLPLE1R
// ?Date: 14.08.2025 Time: 02:55:47
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification history
DO;

//?09/09/2016 Brad Baden  E7214 - Lean Hog Futures Pricing
//?      Function copied from Edt Producer SC FP ComE1 - Producer SC
//?      FC Commodity.  This will allow the users to maintain values
//?      for calculating the Ceiling Price for pricing calculations.
//?H16853 - ISE - 02/03/21 - Increased Buy Order length from 5 to 7.
//?                          Recompilation only.
ENDDO;

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Initialize key screen

// KEY.Market Code Usr = PAR.CPC Commodity Market Code
KEY.Market_Code_Usr = PAR.CPC_Commodity_Market_Code;

// KEY.@Commodity Price Group = PAR.CPC Commodity Price Group
KEY.@Commodity_Price_Group = PAR.CPC_Commodity_Price_Group;

//?USER: Validate key screen

//?Prompt on Market Code
CASE;

// IF KEY.*CMD key is *Prompt
IF KEY.*CMD_key = '04';

// AND PGM.*Cursor field <IS> KEY.Market Code Usr
AND PGM.*Cursor_field = KEY.Market_Code_Usr;

// Call program Sel Commodity Market  XF.
CALL PROGRAM(Sel Commodity Market  XF) ('PDEDSRR');
PARAMETER(KEY.Market_Code_Usr);

ENDIF;

//?Prompt on Price Group
CASE;

// IF KEY.*CMD key is *Prompt
IF KEY.*CMD_key = '04';

// AND PGM.*Cursor field <IS> KEY.@Commodity Price Group
AND PGM.*Cursor_field = KEY.@Commodity_Price_Group;

// Call program Sel Commodity Group   XF.
CALL PROGRAM(Sel Commodity Group   XF) ('PDECSRR');
PARAMETER(KEY.@Commodity_Price_Group);

ENDIF;

// KEY.CPC Commodity Market Code = KEY.Market Code Usr
KEY.CPC_Commodity_Market_Code = KEY.Market_Code_Usr;

// KEY.CPC Commodity Price Group = KEY.@Commodity Price Group
KEY.CPC_Commodity_Price_Group = KEY.@Commodity_Price_Group;

// Call program Val Commodity Market  XF.
CALL PROGRAM(Val Commodity Market  XF) ('PDG1XFR');
PARAMETER(KEY.CPC_Commodity_Market_Code);
PARAMETER(KEY.Market_Code_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?Validate market code
CASE;

// IF WRK.Invalid Y/N USR is Yes
IF WRK.Invalid_Y_N_USR = 'Y';

// Send error message - 'Market Code not found.'
ERROR(PRK0152);

ENDIF;

// Call program Val Commodity Group   XF.
CALL PROGRAM(Val Commodity Group   XF) ('PDG2XFR');
PARAMETER(KEY.CPC_Commodity_Price_Group);
PARAMETER(KEY.Market_Group_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?Validate price group
CASE;

// IF WRK.Invalid Y/N USR is Yes
IF WRK.Invalid_Y_N_USR = 'Y';

// Send error message - 'Commodity Group not found.'
ERROR(PRK0158);

ENDIF;

//?USER: Initialize detail screen (new record)

// DTL.Market Code Desc USR = KEY.Market Code Desc USR
DTL.Market_Code_Desc_USR = KEY.Market_Code_Desc_USR;

// DTL.Market Group Desc USR = KEY.Market Group Desc USR
DTL.Market_Group_Desc_USR = KEY.Market_Group_Desc_USR;

//?USER: Initialize detail screen (existing record)

// Call program Val Commodity Market  XF.
CALL PROGRAM(Val Commodity Market  XF) ('PDG1XFR');
PARAMETER(DTL.CPC_Commodity_Market_Code);
PARAMETER(DTL.Market_Code_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

// Call program Val Commodity Group   XF.
CALL PROGRAM(Val Commodity Group   XF) ('PDG2XFR');
PARAMETER(DTL.CPC_Commodity_Price_Group);
PARAMETER(DTL.Market_Group_Desc_USR);
PARAMETER(WRK.Invalid_Y_N_USR);

//?USER: Validate detail screen fields

//?Prompt on Company #
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.CPC Company Number
AND PGM.*Cursor_field = DTL.CPC_Company_Number;

// Call program Sel Company Control   SR.
CALL PROGRAM(Sel Company Control   SR) ('PKLFSRR');
PARAMETER(DTL.CPC_Company_Number);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);
PARAMETER(WRK.Num_Field_Not_Needed);

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?Prompt on Date Method
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.CPC Market Date Method
AND PGM.*Cursor_field = DTL.CPC_Market_Date_Method;

// Call program Sel Market Date Method UP.
CALL PROGRAM(Sel Market Date Method UP) ('PDZWXFR');
PARAMETER(PGM.*Return_code);
PARAMETER(DTL.CPC_Company_Number);
PARAMETER(DTL.CPC_Market_Date_Method);
PARAMETER(DTL.Market_Date_Method_Desc);
PARAMETER('H');

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?USER: Create DBF record

EXECUTE FUNCTION(CRT Producer SC CP ComCR) TYPE(CRTOBJ) FILE(PLCOREP)           AB1328250;
PARAMETER(DTL.PC_Contract_Code);
PARAMETER(DTL.PSC_Sub_Contract_Code);
PARAMETER(DTL.CPC_Commodity_Market_Code);
PARAMETER(DTL.CPC_Commodity_Price_Group);
PARAMETER(DTL.CPC_Commodity_Description);
PARAMETER(DTL.CPC_Company_Number);
PARAMETER(DTL.CPC_Market_Date_Method);
PARAMETER(DTL.CPC_Constant_1);
PARAMETER(DTL.CPC_Constant_1_Desc);
PARAMETER(DTL.CPC_Constant_2);
PARAMETER(DTL.CPC_Constant_2_Desc);
PARAMETER(DTL.CPC_Unused_Constant_3);
PARAMETER(DTL.CPC_Unused_Const_3_Desc);
PARAMETER(DTL.CPC_Unused_Constant_4);
PARAMETER(DTL.CPC_Unused_Const_4_Desc);
PARAMETER(DTL.CPC_Unused_Constant_5);
PARAMETER(DTL.CPC_Unused_Const_5_Desc);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

//?USER: Change DBF record

EXECUTE FUNCTION(CHG Producer SC CP ComCH) TYPE(CHGOBJ) FILE(PLCOREP)           AB1328251;
PARAMETER(DTL.PC_Contract_Code);
PARAMETER(DTL.PSC_Sub_Contract_Code);
PARAMETER(DTL.CPC_Commodity_Market_Code);
PARAMETER(DTL.CPC_Commodity_Price_Group);
PARAMETER(DTL.CPC_Commodity_Description);
PARAMETER(DTL.CPC_Company_Number);
PARAMETER(DTL.CPC_Market_Date_Method);
PARAMETER(DTL.CPC_Constant_1);
PARAMETER(DTL.CPC_Constant_1_Desc);
PARAMETER(DTL.CPC_Constant_2);
PARAMETER(DTL.CPC_Constant_2_Desc);
PARAMETER(DTL.CPC_Unused_Constant_3);
PARAMETER(DTL.CPC_Unused_Const_3_Desc);
PARAMETER(DTL.CPC_Unused_Constant_4);
PARAMETER(DTL.CPC_Unused_Const_4_Desc);
PARAMETER(DTL.CPC_Unused_Constant_5);
PARAMETER(DTL.CPC_Unused_Const_5_Desc);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

