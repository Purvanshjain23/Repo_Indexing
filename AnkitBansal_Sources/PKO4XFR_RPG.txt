     H/TITLE UPD Eval Trans Rec    XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 11/09/20  Time  : 01:21:50
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKBVCPL1IF  E           K        DISK
      * RTV : Eval Trans                Retrieval index
      *
     FPKBVCPL0UF  E           K        DISK
      * UPD : Eval Trans                Update index
      *
     I@BVCPF0
      * Eval Trans                Update index
      * Renamed input format fields
     I              BVHSNB                          WAHSNB
     I              BVA9DT                          WAA9DT
     I              BVFJNB                          WAFJNB
     I              BVHCNB                          WAHCNB
     I              BVGDNB                          WAGDNB
     I              BVFINB                          WAFINB
     I              BVLKNB                          WALKNB
     I              BVEAST                          WAEAST
     I              BVAMPC                          WAAMPC
     I              BVAIPC                          WAAIPC
     I              BVAJPC                          WAAJPC
     I              BVAKPC                          WAAKPC
     I              BVX8NB                          WAX8NB
     I              BVFVPC                          WAFVPC
     I              BVFWPC                          WAFWPC
     I              BVFXPC                          WAFXPC
     I              BVALPC                          WAALPC
     I              BVDIST                          WADIST
     I              BVFYST                          WAFYST
     I              BVD2ST                          WAD2ST
     I              BVEHST                          WAEHST
     I              BVG1ST                          WAG1ST
     I              BVH4ST                          WAH4ST
     I              BVJLST                          WAJLST
     I              BVUUST                          WAUUST
     I              BVVHST                          WAVHST
     I              BVVIST                          WAVIST
     I              BVVJST                          WAVJST
     I              BVVKST                          WAVKST
     I              BVVLST                          WAVLST
     I              BVHMNB                          WAHMNB
     I              BVBNNB                          WABNNB
     I              BVBONB                          WABONB
     I              BVCVNB                          WACVNB
     I              BVB0DT                          WAB0DT
     I              BVAAVN                          WAAAVN
     I              BVAADT                          WAAADT
     I              BVAMTM                          WAAMTM
     I              BVAJST                          WAAJST
     I              BVAHVN                          WAAHVN
     I              BVAGVN                          WAAGVN
     I              BVABVN                          WAABVN
     I              BVABDT                          WAABDT
     I              BVABTM                          WAABTM
     I              BVB8DT                          WAB8DT
     I              BVAOTM                          WAAOTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKBV1    E DSPKBVCPL0
      * UPD : Eval Trans                Update index
      * Renamed input format fields
     I              BVHSNB                          WAHSNB
     I              BVA9DT                          WAA9DT
     I              BVFJNB                          WAFJNB
     I              BVHCNB                          WAHCNB
     I              BVGDNB                          WAGDNB
     I              BVFINB                          WAFINB
     I              BVLKNB                          WALKNB
     I              BVEAST                          WAEAST
     I              BVAMPC                          WAAMPC
     I              BVAIPC                          WAAIPC
     I              BVAJPC                          WAAJPC
     I              BVAKPC                          WAAKPC
     I              BVX8NB                          WAX8NB
     I              BVFVPC                          WAFVPC
     I              BVFWPC                          WAFWPC
     I              BVFXPC                          WAFXPC
     I              BVALPC                          WAALPC
     I              BVDIST                          WADIST
     I              BVFYST                          WAFYST
     I              BVD2ST                          WAD2ST
     I              BVEHST                          WAEHST
     I              BVG1ST                          WAG1ST
     I              BVH4ST                          WAH4ST
     I              BVJLST                          WAJLST
     I              BVUUST                          WAUUST
     I              BVVHST                          WAVHST
     I              BVVIST                          WAVIST
     I              BVVJST                          WAVJST
     I              BVVKST                          WAVKST
     I              BVVLST                          WAVLST
     I              BVHMNB                          WAHMNB
     I              BVBNNB                          WABNNB
     I              BVBONB                          WABONB
     I              BVCVNB                          WACVNB
     I              BVB0DT                          WAB0DT
     I              BVAAVN                          WAAAVN
     I              BVAADT                          WAAADT
     I              BVAMTM                          WAAMTM
     I              BVAJST                          WAAJST
     I              BVAHVN                          WAAHVN
     I              BVAGVN                          WAAGVN
     I              BVABVN                          WAABVN
     I              BVABDT                          WAABDT
     I              BVABTM                          WAABTM
     I              BVB8DT                          WAB8DT
     I              BVAOTM                          WAAOTM
      *
     IYARDCS      DS                            144
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             18
      * KEY: Eval Trans                Retrieval index
      * I : MAP ET Company Number
     I                                    P   1   20P1HSNB
      * I : MAP ET Kill Date
     I                                    P   3   60P1A9DT
      * I : MAP ET Scale Sequence Number
     I                                    P   7  100P1FJNB
      * I : MAP ET Carcass Number
     I                                    P  11  140P1HCNB
      * I : MAP ET Carcass Number Insert
     I                                    P  15  180P1GDNB
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Eval Trans
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * UPD Eval Trans Rec    XF
      * Modifications and Comments
     C                     EXSR UASUBR                     Modifications a
      * UPD Eval Trans Rec    RT - Eval Trans  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * UPD Eval Trans Rec    RT - Eval Trans  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           BVHSNB           ET Company Numb
     C                     KFLD           BVA9DT           ET Kill Date
     C                     KFLD           BVFJNB           ET Scale Sequen
     C                     KFLD           BVHCNB           ET Carcass Numb
     C                     KFLD           BVGDNB           ET Carcass Numb
      * Setup key
     C                     Z-ADDP1HSNB    BVHSNB           ET Company Numb
     C                     Z-ADDP1A9DT    BVA9DT           ET Kill Date
     C                     Z-ADDP1FJNB    BVFJNB           ET Scale Sequen
     C                     Z-ADDP1HCNB    BVHCNB           ET Carcass Numb
     C                     Z-ADDP1GDNB    BVGDNB           ET Carcass Numb
      * Establish starting position
     C           KRSSA     CHAIN@BVCPF1              90    *
      * Data record not found
     C   90                MOVEL'PRK0121' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'D'       WUAJST           RS Record Statu
     C                     MOVEL'O'       WUEHST           ET Record Add/D
      * Chg Evaluation Trans   CO - Eval Trans  * 
     C                     EXSR SBCHRC
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCHRC    BEGSR
      *================================================================
      * Chg Evaluation Trans   CO - Eval Trans  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  3        ET Adjust/Add T
     C                     MOVEL*BLANK    WN0002  1        ET Broken Back
     C                     MOVEL*BLANK    WN0003  1        ET Unused Sts 2
     C                     MOVEL*BLANK    WN0004  2        ET Adjust/Add S
     C                     MOVEL*BLANK    WN0005  2        ET Unused Sts 4
     C                     MOVEL*BLANK    WN0006  3        ET Unused Sts 5
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BVCPF0
     C                     Z-ADDBVHSNB    WAHSNB           ET Company Numb
     C                     Z-ADDBVA9DT    WAA9DT           ET Kill Date
     C                     Z-ADDBVFJNB    WAFJNB           ET Scale Sequen
     C                     Z-ADDBVHCNB    WAHCNB           ET Carcass Numb
     C                     Z-ADDBVGDNB    WAGDNB           ET Carcass Numb
      *
     C           KLCHSB    KLIST
     C                     KFLD           WAHSNB           ET Company Numb
     C                     KFLD           WAA9DT           ET Kill Date
     C                     KFLD           WAFJNB           ET Scale Sequen
     C                     KFLD           WAHCNB           ET Carcass Numb
     C                     KFLD           WAGDNB           ET Carcass Numb
     C           KLCHSB    CHAIN@BVCPF0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKBVCPL0'MDACP
     C                     MOVEL'@BVCPF0' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKBV1    YARDCS
      * Move non-key fields to @BVCPF0
     C                     Z-ADDBVFINB    WAFINB           ET Tattoo Numbe
     C                     Z-ADDBVLKNB    WALKNB           ET Lot
     C                     MOVELBVEAST    WAEAST    P      ET Shift
     C                     Z-ADDBVAMPC    WAAMPC           ET Hot Wgt
     C                     Z-ADDBVAIPC    WAAIPC           ET Backfat Thic
     C                     Z-ADDBVAJPC    WAAJPC           ET Loin-Eye Dep
     C                     Z-ADDBVAKPC    WAAKPC           ET Lean Percent
     C                     Z-ADDBVX8NB    WAX8NB           ET Backfat Thic
     C                     Z-ADDBVFVPC    WAFVPC           ET Loineye Dept
     C                     Z-ADDBVFWPC    WAFWPC           ET Light Reflec
     C                     Z-ADDBVFXPC    WAFXPC           ET Lean Percent
     C                     Z-ADDBVALPC    WAALPC           ET Light Reflec
     C                     MOVELBVDIST    WADIST    P      ET Trim Area
     C                     MOVELBVFYST    WAFYST    P      ET Carcass Sex
     C                     MOVELBVD2ST    WAD2ST    P      ET Error Sts
     C                     MOVELWUEHST    WAEHST    P      ET Record Add/D
     C                     MOVELBVG1ST    WAG1ST    P      ET Record Creat
     C                     MOVELBVH4ST    WAH4ST    P      ET Record Creat
     C                     MOVELBVJLST    WAJLST    P      ET User Error O
     C                     Z-ADDBVHMNB    WAHMNB           BOH Company Num
     C                     Z-ADDBVBNNB    WABNNB           BOH Buy Order N
     C                     Z-ADDBVBONB    WABONB           BOL Load Number
     C                     Z-ADDBVCVNB    WACVNB           TH Tattoo Numbe
     C                     Z-ADDBVB0DT    WAB0DT           TH Kill Date
     C                     MOVELBVAAVN    WAAAVN    P      RS User Changed
     C                     Z-ADDBVAADT    WAAADT           RS Date Changed
     C                     Z-ADDBVAMTM    WAAMTM           RS Time Changed
     C                     MOVELWUAJST    WAAJST    P      RS Record Statu
     C                     MOVELBVAHVN    WAAHVN    P      RS Job
     C                     MOVELBVAGVN    WAAGVN    P      RS Program
     C                     MOVELBVABVN    WAABVN    P      RS User Added
     C                     Z-ADDBVABDT    WAABDT           RS Date Added
     C                     Z-ADDBVABTM    WAABTM           RS Time Added
     C                     Z-ADDBVB8DT    WAB8DT           RU Date
     C                     Z-ADDBVAOTM    WAAOTM           RU Time
      *
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WAAAVN           RS User Changed
     C                     Z-ADD##JDT     WAAADT           RS Date Changed
     C                     Z-ADD##JTM     WAAMTM           RS Time Changed
     C                     MOVEL##JOB     WAAHVN           RS Job
     C                     MOVEL##PGM     WAAGVN           RS Program
      * Record is changed
     C                     MOVEL'Y'       WUABST           @Status (Yes/No
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BVCPF0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKBVCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modifications and Comments
      *================================================================
      * H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Num
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field RS Record Status
     C                     MOVEL*BLANK    WUAJST  1
      * Define work field ET Record Add/Del Sts
     C                     MOVEL*BLANK    WUEHST  1
      * Define work field @Status (Yes/No)
     C                     MOVEL*BLANK    WUABST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHSNB           ET Company Numb
     C                     Z-ADD*ZERO     WAA9DT           ET Kill Date
     C                     Z-ADD*ZERO     WAFJNB           ET Scale Sequen
     C                     Z-ADD*ZERO     WAHCNB           ET Carcass Numb
     C                     Z-ADD*ZERO     WAGDNB           ET Carcass Numb
     C                     Z-ADD*ZERO     WAFINB           ET Tattoo Numbe
     C                     Z-ADD*ZERO     WALKNB           ET Lot
     C                     Z-ADD*ZERO     WAAMPC           ET Hot Wgt
     C                     Z-ADD*ZERO     WAAIPC           ET Backfat Thic
     C                     Z-ADD*ZERO     WAAJPC           ET Loin-Eye Dep
     C                     Z-ADD*ZERO     WAAKPC           ET Lean Percent
     C                     Z-ADD*ZERO     WAX8NB           ET Backfat Thic
     C                     Z-ADD*ZERO     WAFVPC           ET Loineye Dept
     C                     Z-ADD*ZERO     WAFWPC           ET Light Reflec
     C                     Z-ADD*ZERO     WAFXPC           ET Lean Percent
     C                     Z-ADD*ZERO     WAALPC           ET Light Reflec
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
     C                     Z-ADD*ZERO     WAB8DT           RU Date
     C                     Z-ADD*ZERO     WAAOTM           RU Time
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
