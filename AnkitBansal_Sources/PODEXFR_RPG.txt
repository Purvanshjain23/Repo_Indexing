     H/TITLE Read all rcds for Prg XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1181
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISLBUSE
     H* Date          : 08/13/07  Time  : 11:13:44
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDMACPL4IF  E           K        DISK
      * RSQ : A/R Lockbox Deposit       Read rcds to Purge
      *
     FPDMBCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Batch         Retrieval index
      *
     FPDMCCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Check         Retrieval index
      *
     FPDMDCPL1IF  E           K        DISK
      * RTV : A/R Lockbox Invoice       Retrieval index
      *
     FPDMACPL3IF  E           K        DISK                      A
      * UPD : A/R Lockbox Deposit       Update Index for Purge
      *
     FPDMACPL0UF  E           K        DISK
      * UPD : A/R Lockbox Deposit       Update index
      *
     FPDMBCPL2IF  E           K        DISK                      A
      * UPD : A/R Lockbox Batch         Update Index for Purge
      *
     FPDMBCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Batch         Update index
      *
     FPDMCCPL2IF  E           K        DISK                      A
      * UPD : A/R Lockbox Check         Update index to Purge
      *
     FPDMCCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Check         Update index
      *
     FPDMDCPL4IF  E           K        DISK                      A
      * UPD : A/R Lockbox Invoice       Update index to Purge
      *
     FPDMDCPL0UF  E           K        DISK
      * UPD : A/R Lockbox Invoice       Update index
      *
     I@MACPDQ
      * A/R Lockbox Deposit       Read rcds to Purge
      * Renamed input format fields
     I              MABEC3                          WABEC3
     I              MALWDT                          WALWDT
     I              MAYWNX                          WAYWNX
     I              MANMC1                          WANMC1
     I              MANMC2                          WANMC2
     I              MAZXVA                          WAZXVA
     I              MAAWSX                          WAAWSX
      *
     I@MACPDS
      * A/R Lockbox Deposit       Update Index for Purge
      * Renamed input format fields
     I              MABEC3                          WBBEC3
     I              MALWDT                          WBLWDT
     I              MAYWNX                          WBYWNX
     I              MANMC1                          WBNMC1
     I              MANMC2                          WBNMC2
     I              MAZXVA                          WBZXVA
     I              MAAWSX                          WBAWSX
      *
     I@MACPTR
      * A/R Lockbox Deposit       Update index
      * Renamed input format fields
     I              MABEC3                          WCBEC3
     I              MALWDT                          WCLWDT
     I              MAYWNX                          WCYWNX
     I              MANMC1                          WCNMC1
     I              MANMC2                          WCNMC2
     I              MAZXVA                          WCZXVA
     I              MAAWSX                          WCAWSX
      *
     I@MBCPTV
      * A/R Lockbox Batch         Retrieval index
      * Renamed input format fields
     I              MBBEC3                          WDBEC3
     I              MBLWDT                          WDLWDT
     I              MBYWNX                          WDYWNX
     I              MBBFC3                          WDBFC3
     I              MBNMC0                          WDNMC0
     I              MBZYVA                          WDZYVA
     I              MBYWCD                          WDYWCD
      *
     I@MBCPDU
      * A/R Lockbox Batch         Update Index for Purge
      * Renamed input format fields
     I              MBBEC3                          WEBEC3
     I              MBLWDT                          WELWDT
     I              MBYWNX                          WEYWNX
     I              MBBFC3                          WEBFC3
     I              MBNMC0                          WENMC0
     I              MBZYVA                          WEZYVA
     I              MBYWCD                          WEYWCD
      *
     I@MBCPTU
      * A/R Lockbox Batch         Update index
      * Renamed input format fields
     I              MBBEC3                          WFBEC3
     I              MBLWDT                          WFLWDT
     I              MBYWNX                          WFYWNX
     I              MBBFC3                          WFBFC3
     I              MBNMC0                          WFNMC0
     I              MBZYVA                          WFZYVA
     I              MBYWCD                          WFYWCD
      *
     I@MCCPTY
      * A/R Lockbox Check         Retrieval index
      * Renamed input format fields
     I              MCBEC3                          WGBEC3
     I              MCLWDT                          WGLWDT
     I              MCYWNX                          WGYWNX
     I              MCBFC3                          WGBFC3
     I              MCBGC3                          WGBGC3
     I              MCO1TX                          WGO1TX
     I              MCLXDT                          WGLXDT
     I              MCZZVA                          WGZZVA
     I              MCCWC7                          WGCWC7
     I              MCO2TX                          WGO2TX
     I              MCABSX                          WGABSX
     I              MCADSX                          WGADSX
      *
     I@MCCPDV
      * A/R Lockbox Check         Update index to Purge
      * Renamed input format fields
     I              MCBEC3                          WHBEC3
     I              MCLWDT                          WHLWDT
     I              MCYWNX                          WHYWNX
     I              MCBFC3                          WHBFC3
     I              MCBGC3                          WHBGC3
     I              MCO1TX                          WHO1TX
     I              MCLXDT                          WHLXDT
     I              MCZZVA                          WHZZVA
     I              MCCWC7                          WHCWC7
     I              MCO2TX                          WHO2TX
     I              MCABSX                          WHABSX
     I              MCADSX                          WHADSX
      *
     I@MCCPTX
      * A/R Lockbox Check         Update index
      * Renamed input format fields
     I              MCBEC3                          WIBEC3
     I              MCLWDT                          WILWDT
     I              MCYWNX                          WIYWNX
     I              MCBFC3                          WIBFC3
     I              MCBGC3                          WIBGC3
     I              MCO1TX                          WIO1TX
     I              MCLXDT                          WILXDT
     I              MCZZVA                          WIZZVA
     I              MCCWC7                          WICWC7
     I              MCO2TX                          WIO2TX
     I              MCABSX                          WIABSX
     I              MCADSX                          WIADSX
      *
     I@MDCPT1
      * A/R Lockbox Invoice       Retrieval index
      * Renamed input format fields
     I              MDBEC3                          WJBEC3
     I              MDLWDT                          WJLWDT
     I              MDYWNX                          WJYWNX
     I              MDBFC3                          WJBFC3
     I              MDBGC3                          WJBGC3
     I              MDNMC5                          WJNMC5
     I              MDNMC4                          WJNMC4
     I              MDNMC3                          WJNMC3
     I              MDZ0VA                          WJZ0VA
     I              MDAIC3                          WJAIC3
     I              MDUHCD                          WJUHCD
     I              MDAFSX                          WJAFSX
     I              MDNGNA                          WJNGNA
      *
     I@MDCPDW
      * A/R Lockbox Invoice       Update index to Purge
      * Renamed input format fields
     I              MDBEC3                          WKBEC3
     I              MDLWDT                          WKLWDT
     I              MDYWNX                          WKYWNX
     I              MDBFC3                          WKBFC3
     I              MDBGC3                          WKBGC3
     I              MDNMC5                          WKNMC5
     I              MDNMC4                          WKNMC4
     I              MDNMC3                          WKNMC3
     I              MDZ0VA                          WKZ0VA
     I              MDAIC3                          WKAIC3
     I              MDUHCD                          WKUHCD
     I              MDAFSX                          WKAFSX
     I              MDNGNA                          WKNGNA
      *
     I@MDCPT0
      * A/R Lockbox Invoice       Update index
      * Renamed input format fields
     I              MDBEC3                          WLBEC3
     I              MDLWDT                          WLLWDT
     I              MDYWNX                          WLYWNX
     I              MDBFC3                          WLBFC3
     I              MDBGC3                          WLBGC3
     I              MDNMC5                          WLNMC5
     I              MDNMC4                          WLNMC4
     I              MDNMC3                          WLNMC3
     I              MDZ0VA                          WLZ0VA
     I              MDAIC3                          WLAIC3
     I              MDUHCD                          WLUHCD
     I              MDAFSX                          WLAFSX
     I              MDNGNA                          WLNGNA
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDMA1    E DSPDMACPL3
      * UPD : A/R Lockbox Deposit       Update Index for Purge
      * Renamed input format fields
     I              MABEC3                          WBBEC3
     I              MALWDT                          WBLWDT
     I              MAYWNX                          WBYWNX
     I              MANMC1                          WBNMC1
     I              MANMC2                          WBNMC2
     I              MAZXVA                          WBZXVA
     I              MAAWSX                          WBAWSX
      *
     IQPDMA2    E DSPDMACPL0
      * UPD : A/R Lockbox Deposit       Update index
      * Renamed input format fields
     I              MABEC3                          WCBEC3
     I              MALWDT                          WCLWDT
     I              MAYWNX                          WCYWNX
     I              MANMC1                          WCNMC1
     I              MANMC2                          WCNMC2
     I              MAZXVA                          WCZXVA
     I              MAAWSX                          WCAWSX
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPDMB1    E DSPDMBCPL2
      * UPD : A/R Lockbox Batch         Update Index for Purge
      * Renamed input format fields
     I              MBBEC3                          WEBEC3
     I              MBLWDT                          WELWDT
     I              MBYWNX                          WEYWNX
     I              MBBFC3                          WEBFC3
     I              MBNMC0                          WENMC0
     I              MBZYVA                          WEZYVA
     I              MBYWCD                          WEYWCD
      *
     IQPDMB2    E DSPDMBCPL0
      * UPD : A/R Lockbox Batch         Update index
      * Renamed input format fields
     I              MBBEC3                          WFBEC3
     I              MBLWDT                          WFLWDT
     I              MBYWNX                          WFYWNX
     I              MBBFC3                          WFBFC3
     I              MBNMC0                          WFNMC0
     I              MBZYVA                          WFZYVA
     I              MBYWCD                          WFYWCD
      *
     IQPDMC1    E DSPDMCCPL2
      * UPD : A/R Lockbox Check         Update index to Purge
      * Renamed input format fields
     I              MCBEC3                          WHBEC3
     I              MCLWDT                          WHLWDT
     I              MCYWNX                          WHYWNX
     I              MCBFC3                          WHBFC3
     I              MCBGC3                          WHBGC3
     I              MCO1TX                          WHO1TX
     I              MCLXDT                          WHLXDT
     I              MCZZVA                          WHZZVA
     I              MCCWC7                          WHCWC7
     I              MCO2TX                          WHO2TX
     I              MCABSX                          WHABSX
     I              MCADSX                          WHADSX
      *
     IQPDMC2    E DSPDMCCPL0
      * UPD : A/R Lockbox Check         Update index
      * Renamed input format fields
     I              MCBEC3                          WIBEC3
     I              MCLWDT                          WILWDT
     I              MCYWNX                          WIYWNX
     I              MCBFC3                          WIBFC3
     I              MCBGC3                          WIBGC3
     I              MCO1TX                          WIO1TX
     I              MCLXDT                          WILXDT
     I              MCZZVA                          WIZZVA
     I              MCCWC7                          WICWC7
     I              MCO2TX                          WIO2TX
     I              MCABSX                          WIABSX
     I              MCADSX                          WIADSX
      *
     IQPDMD1    E DSPDMDCPL4
      * UPD : A/R Lockbox Invoice       Update index to Purge
      * Renamed input format fields
     I              MDBEC3                          WKBEC3
     I              MDLWDT                          WKLWDT
     I              MDYWNX                          WKYWNX
     I              MDBFC3                          WKBFC3
     I              MDBGC3                          WKBGC3
     I              MDNMC5                          WKNMC5
     I              MDNMC4                          WKNMC4
     I              MDNMC3                          WKNMC3
     I              MDZ0VA                          WKZ0VA
     I              MDAIC3                          WKAIC3
     I              MDUHCD                          WKUHCD
     I              MDAFSX                          WKAFSX
     I              MDNGNA                          WKNGNA
      *
     IQPDMD2    E DSPDMDCPL0
      * UPD : A/R Lockbox Invoice       Update index
      * Renamed input format fields
     I              MDBEC3                          WLBEC3
     I              MDLWDT                          WLLWDT
     I              MDYWNX                          WLYWNX
     I              MDBFC3                          WLBFC3
     I              MDBGC3                          WLBGC3
     I              MDNMC5                          WLNMC5
     I              MDNMC4                          WLNMC4
     I              MDNMC3                          WLNMC3
     I              MDZ0VA                          WLZ0VA
     I              MDAIC3                          WLAIC3
     I              MDUHCD                          WLUHCD
     I              MDAFSX                          WLAFSX
     I              MDNGNA                          WLNGNA
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R Lockbox Deposit
      * I :  LckBx Deposit Date
     I                                    P   1   40P1LWDT
     IP2PARM      DS
      * B :  Date From             USR
     I                                    P   1   40P2JEDT
     IP3PARM      DS
      * B :  Date In
     I                                    P   1   40P3KCDT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1LWDT    PARM           WP0001  70       LckBx Deposit D
     C           P2JEDT    PARM P2JEDT    WP0002  70       Date From
     C           P3KCDT    PARM P3KCDT    WP0003  70       Date In
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Read all rcds for Prg XF
      * Read all rcds to purge - A/R Lockbox Deposit  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Read all rcds to purge - A/R Lockbox Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'Y'       WUTAST           First Time Flag
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WALWDT           LckBx Deposit D
      * Setup key
     C                     Z-ADDP1LWDT    WALWDT           LckBx Deposit D
      * Establish starting position
     C           KPSSA     SETLL@MACPDQ                    *
     C                     READ @MACPDQ                  90*
      * Data record not found
     C   90                MOVEL'USR2646' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * First Time processing Only
      * CASE: WRK.First Time Flag is Yes
     C           WUTAST    IFEQ 'Y'                        *IF
     C                     Z-ADDWALWDT    P2JEDT           Date From
     C                     MOVEL'N'       WUTAST           First Time Flag
     C                     END                             *FI
      * CRT A/R Lockbox Dp PRG CR - A/R Lockbox Deposit  * 
     C                     EXSR SBCRRC
      * DLT A/R Lockbox DpsPRG DL - A/R Lockbox Deposit  * 
     C                     EXSR SCDLRC
     C                     Z-ADDWALWDT    P3KCDT           Date In
     C                     READ @MACPDQ                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * CRT A/R Lockbox Dp PRG CR - A/R Lockbox Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MACPDS
     C                     Z-ADDWABEC3    WBBEC3           LckBx Number
     C                     Z-ADDWALWDT    WBLWDT           LckBx Deposit D
     C                     Z-ADDWAYWNX    WBYWNX           LckBx Deposit T
     C                     Z-ADDWANMC1    WBNMC1           LckBx Dpst Nbr
     C                     Z-ADDWANMC2    WBNMC2           LckBx Dpst Nbr
     C                     Z-ADDWAZXVA    WBZXVA           LckBx Deposit A
     C                     MOVELWAAWSX    WBAWSX           LckBx Deposit S
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBBEC3           LckBx Number
     C                     KFLD           WBLWDT           LckBx Deposit D
     C                     KFLD           WBYWNX           LckBx Deposit T
      * Check for duplicate primary key
     C           KLCRSB    SETLL@MACPDS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2647' W0RTN   7
      * Send message 'A/R Lockbox Deposit    EX'
     C                     MOVEL'USR2647' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@MACPDS                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox DpsPRG DL - A/R Lockbox Deposit  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MACPTR
     C                     Z-ADDWABEC3    WCBEC3           LckBx Number
     C                     Z-ADDWALWDT    WCLWDT           LckBx Deposit D
     C                     Z-ADDWAYWNX    WCYWNX           LckBx Deposit T
      *
     C           KLDLSC    KLIST
     C                     KFLD           WCBEC3           LckBx Number
     C                     KFLD           WCLWDT           LckBx Deposit D
     C                     KFLD           WCYWNX           LckBx Deposit T
     C           KLDLSC    CHAIN@MACPTR              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMACPL0'MDACP
     C                     MOVEL'@MACPTR' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MACPTR                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * RTV & DLT Lckbx Batch  RT - A/R Lockbox Batch  * 
     C                     EXSR SDRVGN
      * RTV & DLT Lckbox Check RT - A/R Lockbox Check  * 
     C                     EXSR SGRVGN
      * RTV & DLT Lckbx Invoic RT - A/R Lockbox Invoice  * 
     C                     EXSR SJRVGN
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbx Batch  RT - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDBEC3    WQSD01           LckBx Number
     C           *LIKE     DEFN WDLWDT    WQSD02           LckBx Deposit D
     C           *LIKE     DEFN WDYWNX    WQSD03           LckBx Deposit T
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           LckBx Number
     C                     KFLD           WQSD02           LckBx Deposit D
     C                     KFLD           WQSD03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWCBEC3    WQSD01           LckBx Number
     C                     Z-ADDWCLWDT    WQSD02           LckBx Deposit D
     C                     Z-ADDWCYWNX    WQSD03           LckBx Deposit T
      * Establish starting position
     C           KRSSD     SETLL@MBCPTV                    *
     C           KRSSD     READE@MBCPTV                  90*
      * Data record not found
     C   90                MOVEL'USR2648' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbx BtchPRG CR - A/R Lockbox Batch  * 
     C                     EXSR SECRRC
      * DLT A/R Lockbox Batch  DL - A/R Lockbox Batch  * 
     C                     EXSR SFDLRC
     C           KRSSD     READE@MBCPTV                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * CRT A/R Lockbx BtchPRG CR - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MBCPDU
     C                     Z-ADDWDBEC3    WEBEC3           LckBx Number
     C                     Z-ADDWDLWDT    WELWDT           LckBx Deposit D
     C                     Z-ADDWDYWNX    WEYWNX           LckBx Deposit T
     C                     Z-ADDWDBFC3    WEBFC3           LckBx Batch Num
     C                     Z-ADDWDNMC0    WENMC0           LckBx Batch Nbr
     C                     Z-ADDWDZYVA    WEZYVA           LckBx Batch Amo
     C                     MOVELWDYWCD    WEYWCD           LckBx Location
      *
     C           KLCRSE    KLIST
     C                     KFLD           WEBEC3           LckBx Number
     C                     KFLD           WELWDT           LckBx Deposit D
     C                     KFLD           WEYWNX           LckBx Deposit T
     C                     KFLD           WEBFC3           LckBx Batch Num
      * Check for duplicate primary key
     C           KLCRSE    SETLL@MBCPDU                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2649' W0RTN   7
      * Send message 'A/R Lockbox Batch      EX'
     C                     MOVEL'USR2649' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@MBCPDU                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Batch  DL - A/R Lockbox Batch  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MBCPTU
     C                     Z-ADDWDBEC3    WFBEC3           LckBx Number
     C                     Z-ADDWDLWDT    WFLWDT           LckBx Deposit D
     C                     Z-ADDWDYWNX    WFYWNX           LckBx Deposit T
     C                     Z-ADDWDBFC3    WFBFC3           LckBx Batch Num
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFBEC3           LckBx Number
     C                     KFLD           WFLWDT           LckBx Deposit D
     C                     KFLD           WFYWNX           LckBx Deposit T
     C                     KFLD           WFBFC3           LckBx Batch Num
     C           KLDLSF    CHAIN@MBCPTU              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMBCPL0'MDACP
     C                     MOVEL'@MBCPTU' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MBCPTU                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbox Check RT - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGBEC3    WQSG01           LckBx Number
     C           *LIKE     DEFN WGLWDT    WQSG02           LckBx Deposit D
     C           *LIKE     DEFN WGYWNX    WQSG03           LckBx Deposit T
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           LckBx Number
     C                     KFLD           WQSG02           LckBx Deposit D
     C                     KFLD           WQSG03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWCBEC3    WQSG01           LckBx Number
     C                     Z-ADDWCLWDT    WQSG02           LckBx Deposit D
     C                     Z-ADDWCYWNX    WQSG03           LckBx Deposit T
      * Establish starting position
     C           KRSSG     SETLL@MCCPTY                    *
     C           KRSSG     READE@MCCPTY                  90*
      * Data record not found
     C   90                MOVEL'USR2650' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbox ChcPRG CR - A/R Lockbox Check  * 
     C                     EXSR SHCRRC
      * DLT A/R Lockbox Check  DL - A/R Lockbox Check  * 
     C                     EXSR SIDLRC
     C           KRSSG     READE@MCCPTY                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCRRC    BEGSR
      *================================================================
      * CRT A/R Lockbox ChcPRG CR - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MCCPDV
     C                     Z-ADDWGBEC3    WHBEC3           LckBx Number
     C                     Z-ADDWGLWDT    WHLWDT           LckBx Deposit D
     C                     Z-ADDWGYWNX    WHYWNX           LckBx Deposit T
     C                     Z-ADDWGBFC3    WHBFC3           LckBx Batch Num
     C                     Z-ADDWGBGC3    WHBGC3           LckBx Item Numb
     C                     MOVELWGO1TX    WHO1TX           LckBx Check Num
     C                     Z-ADDWGLXDT    WHLXDT           LckBx Check Dat
     C                     Z-ADDWGZZVA    WHZZVA           LckBx Check Amo
     C                     Z-ADDWGCWC7    WHCWC7           LckBx Customer
     C                     MOVELWGO2TX    WHO2TX           LckBx Customer
     C                     MOVELWGABSX    WHABSX           LckBx Invoice F
     C                     MOVELWGADSX    WHADSX           LckBx Hold Flag
      *
     C           KLCRSH    KLIST
     C                     KFLD           WHBEC3           LckBx Number
     C                     KFLD           WHLWDT           LckBx Deposit D
     C                     KFLD           WHYWNX           LckBx Deposit T
     C                     KFLD           WHBFC3           LckBx Batch Num
     C                     KFLD           WHBGC3           LckBx Item Numb
      * Check for duplicate primary key
     C           KLCRSH    SETLL@MCCPDV                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2651' W0RTN   7
      * Send message 'A/R Lockbox Check      EX'
     C                     MOVEL'USR2651' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C                     WRITE@MCCPDV                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Check  DL - A/R Lockbox Check  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MCCPTX
     C                     Z-ADDWGBEC3    WIBEC3           LckBx Number
     C                     Z-ADDWGLWDT    WILWDT           LckBx Deposit D
     C                     Z-ADDWGYWNX    WIYWNX           LckBx Deposit T
     C                     Z-ADDWGBFC3    WIBFC3           LckBx Batch Num
     C                     Z-ADDWGBGC3    WIBGC3           LckBx Item Numb
      *
     C           KLDLSI    KLIST
     C                     KFLD           WIBEC3           LckBx Number
     C                     KFLD           WILWDT           LckBx Deposit D
     C                     KFLD           WIYWNX           LckBx Deposit T
     C                     KFLD           WIBFC3           LckBx Batch Num
     C                     KFLD           WIBGC3           LckBx Item Numb
     C           KLDLSI    CHAIN@MCCPTX              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMCCPL0'MDACP
     C                     MOVEL'@MCCPTX' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MCCPTX                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * RTV & DLT Lckbx Invoic RT - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WJBEC3    WQSJ01           LckBx Number
     C           *LIKE     DEFN WJLWDT    WQSJ02           LckBx Deposit D
     C           *LIKE     DEFN WJYWNX    WQSJ03           LckBx Deposit T
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           LckBx Number
     C                     KFLD           WQSJ02           LckBx Deposit D
     C                     KFLD           WQSJ03           LckBx Deposit T
      * Setup key
     C                     Z-ADDWCBEC3    WQSJ01           LckBx Number
     C                     Z-ADDWCLWDT    WQSJ02           LckBx Deposit D
     C                     Z-ADDWCYWNX    WQSJ03           LckBx Deposit T
      * Establish starting position
     C           KRSSJ     SETLL@MDCPT1                    *
     C           KRSSJ     READE@MDCPT1                  90*
      * Data record not found
     C   90                MOVEL'USR2652' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CRT A/R Lockbox InvPRG CR - A/R Lockbox Invoice  * 
     C                     EXSR SKCRRC
      * DLT A/R Lockbox Invoic DL - A/R Lockbox Invoice  * 
     C                     EXSR SLDLRC
     C           KRSSJ     READE@MDCPT1                  90*
     C                     ENDDO
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCRRC    BEGSR
      *================================================================
      * CRT A/R Lockbox InvPRG CR - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @MDCPDW
     C                     Z-ADDWJBEC3    WKBEC3           LckBx Number
     C                     Z-ADDWJLWDT    WKLWDT           LckBx Deposit D
     C                     Z-ADDWJYWNX    WKYWNX           LckBx Deposit T
     C                     Z-ADDWJBFC3    WKBFC3           LckBx Batch Num
     C                     Z-ADDWJBGC3    WKBGC3           LckBx Item Numb
     C                     Z-ADDWJNMC5    WKNMC5           LckBx Seq Numbe
     C                     Z-ADDWJNMC4    WKNMC4           LckBx Seq Count
     C                     Z-ADDWJNMC3    WKNMC3           LckBx Invoice N
     C                     Z-ADDWJZ0VA    WKZ0VA           LckBx Invoice A
     C                     Z-ADDWJAIC3    WKAIC3           Company Number
     C                     MOVELWJUHCD    WKUHCD           Adjustment Type
     C                     MOVELWJAFSX    WKAFSX           LckBx Trans Sou
     C                     MOVELWJNGNA    WKNGNA           Explanation
      *
     C           KLCRSK    KLIST
     C                     KFLD           WKBEC3           LckBx Number
     C                     KFLD           WKLWDT           LckBx Deposit D
     C                     KFLD           WKYWNX           LckBx Deposit T
     C                     KFLD           WKBFC3           LckBx Batch Num
     C                     KFLD           WKBGC3           LckBx Item Numb
     C                     KFLD           WKNMC5           LckBx Seq Numbe
     C                     KFLD           WKNMC4           LckBx Seq Count
      * Check for duplicate primary key
     C           KLCRSK    SETLL@MDCPDW                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2653' W0RTN   7
      * Send message 'A/R Lockbox Invoice    EX'
     C                     MOVEL'USR2653' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C                     WRITE@MDCPDW                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLDLRC    BEGSR
      *================================================================
      * DLT A/R Lockbox Invoic DL - A/R Lockbox Invoice  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @MDCPT0
     C                     Z-ADDWJBEC3    WLBEC3           LckBx Number
     C                     Z-ADDWJLWDT    WLLWDT           LckBx Deposit D
     C                     Z-ADDWJYWNX    WLYWNX           LckBx Deposit T
     C                     Z-ADDWJBFC3    WLBFC3           LckBx Batch Num
     C                     Z-ADDWJBGC3    WLBGC3           LckBx Item Numb
     C                     Z-ADDWJNMC5    WLNMC5           LckBx Seq Numbe
     C                     Z-ADDWJNMC4    WLNMC4           LckBx Seq Count
      *
     C           KLDLSL    KLIST
     C                     KFLD           WLBEC3           LckBx Number
     C                     KFLD           WLLWDT           LckBx Deposit D
     C                     KFLD           WLYWNX           LckBx Deposit T
     C                     KFLD           WLBFC3           LckBx Batch Num
     C                     KFLD           WLBGC3           LckBx Item Numb
     C                     KFLD           WLNMC5           LckBx Seq Numbe
     C                     KFLD           WLNMC4           LckBx Seq Count
     C           KLDLSL    CHAIN@MDCPT0              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDMDCPL0'MDACP
     C                     MOVEL'@MDCPT0' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SLEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@MDCPT0                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABEC3           LckBx Number
     C                     Z-ADD*ZERO     WALWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WAYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WANMC1           LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WANMC2           LckBx Dpst Nbr
     C                     Z-ADD*ZERO     WAZXVA           LckBx Deposit A
      * Define work field First Time Flag
     C                     MOVEL*BLANK    WUTAST  1
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDBEC3           LckBx Number
     C                     Z-ADD*ZERO     WDLWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WDYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WDBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WDNMC0           LckBx Batch Nbr
     C                     Z-ADD*ZERO     WDZYVA           LckBx Batch Amo
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGBEC3           LckBx Number
     C                     Z-ADD*ZERO     WGLWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WGYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WGBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WGBGC3           LckBx Item Numb
     C                     Z-ADD*ZERO     WGLXDT           LckBx Check Dat
     C                     Z-ADD*ZERO     WGZZVA           LckBx Check Amo
     C                     Z-ADD*ZERO     WGCWC7           LckBx Customer
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WJBEC3           LckBx Number
     C                     Z-ADD*ZERO     WJLWDT           LckBx Deposit D
     C                     Z-ADD*ZERO     WJYWNX           LckBx Deposit T
     C                     Z-ADD*ZERO     WJBFC3           LckBx Batch Num
     C                     Z-ADD*ZERO     WJBGC3           LckBx Item Numb
     C                     Z-ADD*ZERO     WJNMC5           LckBx Seq Numbe
     C                     Z-ADD*ZERO     WJNMC4           LckBx Seq Count
     C                     Z-ADD*ZERO     WJNMC3           LckBx Invoice N
     C                     Z-ADD*ZERO     WJZ0VA           LckBx Invoice A
     C                     Z-ADD*ZERO     WJAIC3           Company Number
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
