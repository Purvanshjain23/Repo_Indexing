// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVHCXFR
// ?Date: 14.08.2025 Time: 03:52:14
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Per Lucas H., we should target 1 rolling year, Year to date.
//?E.g. All of 2023 and YTD for 2024.
//?Selecting Actual Ship Date all of 2023 and up to 2024 YTD.
//?Set Cutoff Date USR to what Lucas decide.?????
// LCL.Cutoff Date USR = CON.1230101
LCL.Cutoff_Date_USR = 1230101;

//?Selecting Completed & Cancelled Orders Only. (OH = MD Population)
EXECUTE FUNCTION(Cnv Mov MnfDt 2/PRKFHSTRT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC2234043;
PARAMETER(LCL.Cutoff_Date_USR);
{
 //?USER: Process Data record

 // Execute function Get System Date/Time 2 US.
 EXECUTE FUNCTION(Get System Date/Time 2 US) TYPE(EXCUSRSRC) ('PUX1UFR');
 PARAMETER(NLL.System_Date_USA_USR);
 PARAMETER(LCL.System_Time_HMS_USR);
 {
  * Get System Date/Time 2 US
  d SysDateUSA      S               D   datfmt(*USA)
  d SysTimeHMS      S              8a
  *
  /free
  SysDateUSA = %date();
  #OTZU1 = %char(SysDateUSA);

  SysTimeHMS = %char(%time():*HMS);
  #OT0U1 = SysTimeHMS;
  /end-free
 }

 //?Quit Job if Still Running @9PM.
 CASE;

 // IF LCL.System Time *HMS USR is GE 21:00:00
 IF LCL.System_Time_HMS_USR >= '21:00:00';

 // AND LCL.System Time *HMS USR is LE 21:03:00
 AND LCL.System_Time_HMS_USR <= '21:03:00';

 QUIT;

 ENDIF;

 //?Do NOT select Cancelled Orders.
 //?A/P Selects 'Completed' (C) or 'Shipped' (R) Orders.
 //?Processing for Completed Orders Only.
 CASE;

 // IF DB1.Header Status is Complete
 IF DB1.Header_Status = 'C';

 //?Check Actual Shipped Date.
 CASE;

 // IF DB1.Actual Shipped Date is entered
 IF DB1.Actual_Shipped_Date <> *ZERO;

 //?Actual Shipped Date Must be Less Than Cutoff Date.
 CASE;

 // IF DB1.Actual Shipped Date LT PAR.Cutoff Date USR
 IF DB1.Actual_Shipped_Date < PAR.Cutoff_Date_USR;

 //?***Move Record to PRKHST.
 EXECUTE FUNCTION(Cnv Mov MnfDt 2/PRKFHSTRT) TYPE(RTVOBJ) FILE(OMFNCPP)          AC2234454;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 {
  //?USER: Process Data record

  //?Copy Record to PRKFHST First.
  // Call program Cnv Mov MnfDt 2/PRKFHSTUP.
  CALL PROGRAM(Cnv Mov MnfDt 2/PRKFHSTUP) ('PVHGUPR');
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Case_Sequence_Number);
  PARAMETER(DB1.Case_Quantity);
  PARAMETER(DB1.Case_Weight);
  PARAMETER(DB1.Inventory_Updated_Flag);
  PARAMETER(DB1.Label_Date);
  PARAMETER(DB1.PT_Serial_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(DB1.Production_Date);
  PARAMETER(DB1.Manifest_Gross_Weight);
  PARAMETER(DB1.Manifest_Lot_ID);
  PARAMETER(DB1.Manifest_Total_Tare);
  PARAMETER(DB1.Manifest_Co_Park_Lot_Nbr);
  PARAMETER(DB1.Manifest_Pallet_Number);
  PARAMETER(DB1.Manifest_Shift);
  PARAMETER(DB1.HPB_Meter_Net_Gallon);
  PARAMETER(DB1.Manifest_Net_Weight_Kg);
  PARAMETER(DB1.Manifest_Unused_Status_1A);
  PARAMETER(DB1.Manifest_Unused_Status_2A);
  PARAMETER(DB1.Manifest_Unused_Date);
  PARAMETER(DB1.HPB_COA_Batch_Number);
  PARAMETER(DB1.HPB_Meter_Start_Gallon);
  PARAMETER(DB1.HPB_Meter_Ending_Gallon);
  PARAMETER(DB1.HPB_Meter_Total_Gallon);
  PARAMETER(DB1.HPB_Meter_Net_Weight);
  PARAMETER(DB1.HPB_Density_Ref_Gravity);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);

  //?Delete Record.
  EXECUTE FUNCTION(DLT OM Manifest Detail DL) TYPE(DLTOBJ) FILE(OMFNCPP)          AC1183251;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Case_Sequence_Number);
 }

 ENDIF;

 //?Check Actual Shipped Date.
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Check Date of Original Entry.
 CASE;

 // IF DB1.Date of Original Entry is Entered
 IF DB1.Date_of_Original_Entry <> *ZERO;

 //?Orig Entry Date Must be Less Than Cutoff Date.
 CASE;

 // IF DB1.Date of Original Entry LT PAR.Cutoff Date USR
 IF DB1.Date_of_Original_Entry < PAR.Cutoff_Date_USR;

 //?***Move Record to PRKHST.
 EXECUTE FUNCTION(Cnv Mov MnfDt 2/PRKFHSTRT) TYPE(RTVOBJ) FILE(OMFNCPP)          AC2234454;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 {
  //?USER: Process Data record

  //?Copy Record to PRKFHST First.
  // Call program Cnv Mov MnfDt 2/PRKFHSTUP.
  CALL PROGRAM(Cnv Mov MnfDt 2/PRKFHSTUP) ('PVHGUPR');
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Case_Sequence_Number);
  PARAMETER(DB1.Case_Quantity);
  PARAMETER(DB1.Case_Weight);
  PARAMETER(DB1.Inventory_Updated_Flag);
  PARAMETER(DB1.Label_Date);
  PARAMETER(DB1.PT_Serial_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(DB1.Production_Date);
  PARAMETER(DB1.Manifest_Gross_Weight);
  PARAMETER(DB1.Manifest_Lot_ID);
  PARAMETER(DB1.Manifest_Total_Tare);
  PARAMETER(DB1.Manifest_Co_Park_Lot_Nbr);
  PARAMETER(DB1.Manifest_Pallet_Number);
  PARAMETER(DB1.Manifest_Shift);
  PARAMETER(DB1.HPB_Meter_Net_Gallon);
  PARAMETER(DB1.Manifest_Net_Weight_Kg);
  PARAMETER(DB1.Manifest_Unused_Status_1A);
  PARAMETER(DB1.Manifest_Unused_Status_2A);
  PARAMETER(DB1.Manifest_Unused_Date);
  PARAMETER(DB1.HPB_COA_Batch_Number);
  PARAMETER(DB1.HPB_Meter_Start_Gallon);
  PARAMETER(DB1.HPB_Meter_Ending_Gallon);
  PARAMETER(DB1.HPB_Meter_Total_Gallon);
  PARAMETER(DB1.HPB_Meter_Net_Weight);
  PARAMETER(DB1.HPB_Density_Ref_Gravity);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);

  //?Delete Record.
  EXECUTE FUNCTION(DLT OM Manifest Detail DL) TYPE(DLTOBJ) FILE(OMFNCPP)          AC1183251;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Case_Sequence_Number);
 }

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


