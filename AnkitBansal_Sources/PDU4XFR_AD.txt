// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDU4XFR
// ?Date: 14.08.2025 Time: 03:30:08
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(CHG A/R Summary        RT) TYPE(RTVOBJ) FILE(ARBCREP)          AC1340590;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.AR_Customer_Number);
PARAMETER(PAR.Order_Date);
PARAMETER(PAR.Actual_Shipped_Date);
PARAMETER(PAR.Order_Value_Total);
PARAMETER(PAR.Order_Weight_Total);
PARAMETER(PAR.A_R_order_Value_Total);
PARAMETER(PAR.Billing_Activity_Type);
PARAMETER(PAR.Affect_Sales_Doll_Status);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 //?** 09/25/2006 LJB L060906C (Z06PTW_H04_T220)
 //?** Change test from BAT=Invoice to BAT=Invoice or Debit Memos
 //?** to match the DSO A/R Summary Report
 //?*****
 //?USER: Process Data record

 //?6/3/96:  removed update to value open orders per call C01265.
 //?Calculate Date of First Shipment
 CASE;

 // IF PAR.Billing Activity Type is Credit or Debit Memo
 IF PAR.Billing_Activity_Type = '2'/'3';

 // PAR.Date of First Shipment = DB1.Date of First Shipment
 PAR.Date_of_First_Shipment = DB1.Date_of_First_Shipment;

 //?Calculate Date of First Shipment
 // IF DB1.Date of First Shipment is not entered
 IF DB1.Date_of_First_Shipment = *ZERO;

 // PAR.Date of First Shipment = PAR.Actual Shipped Date
 PAR.Date_of_First_Shipment = PAR.Actual_Shipped_Date;

 //?Calculate Date of First Shipment
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Date of First Shipment = DB1.Date of First Shipment
 PAR.Date_of_First_Shipment = DB1.Date_of_First_Shipment;

 ENDIF;

 //?Calculate Date & Amount of Last Shipment
 CASE;

 // IF PAR.Billing Activity Type is Credit or Debit Memo
 IF PAR.Billing_Activity_Type = '2'/'3';

 // PAR.Date of Last Shipment = DB1.Date of Last Shipment
 PAR.Date_of_Last_Shipment = DB1.Date_of_Last_Shipment;

 // PAR.Amount of Last Shipment = DB1.Amount of Last Shipment
 PAR.Amount_of_Last_Shipment = DB1.Amount_of_Last_Shipment;

 //?Calculate Date & Amount of Last Shipment
 // IF PAR.Actual Shipped Date GT DB1.Date of Last Shipment
 IF PAR.Actual_Shipped_Date > DB1.Date_of_Last_Shipment;

 // PAR.Date of Last Shipment = PAR.Actual Shipped Date
 PAR.Date_of_Last_Shipment = PAR.Actual_Shipped_Date;

 // PAR.Amount of Last Shipment = PAR.Order Value Total
 PAR.Amount_of_Last_Shipment = PAR.Order_Value_Total;

 //?Calculate Date & Amount of Last Shipment
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Date of Last Shipment = DB1.Date of Last Shipment
 PAR.Date_of_Last_Shipment = DB1.Date_of_Last_Shipment;

 // PAR.Amount of Last Shipment = DB1.Amount of Last Shipment
 PAR.Amount_of_Last_Shipment = DB1.Amount_of_Last_Shipment;

 ENDIF;

 //?** 09/25/2006 LJB L060906C (Z06PTW_H04_T220)
 //?** Change test from BAT=Invoice to BAT=Invoice or Debit Memos
 //?** to match the DSO A/R Summary Report
 //?Accumulate Number of Invoices
 CASE;

 // IF PAR.Billing Activity Type is Invoice or Debit Memo
 IF PAR.Billing_Activity_Type = '3'/'1';

 //?Add to # invoices YTD if affect sales dollars
 CASE;

 // IF PAR.Affect Sales Doll Status is yes
 IF PAR.Affect_Sales_Doll_Status = 'Y';

 // PAR.Number of Invoices YTD = DB1.Number of Invoices YTD + CON.1
 PAR.Number_of_Invoices_YTD = DB1.Number_of_Invoices_YTD + 1;

 //?Add to # invoices YTD if affect sales dollars
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Number of Invoices YTD = DB1.Number of Invoices YTD
 PAR.Number_of_Invoices_YTD = DB1.Number_of_Invoices_YTD;

 ENDIF;

 //?Accumulate Number of Invoices
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Number of Invoices YTD = DB1.Number of Invoices YTD
 PAR.Number_of_Invoices_YTD = DB1.Number_of_Invoices_YTD;

 ENDIF;

 //?Calculate New YTD Invoice $ / # credits
 CASE;

 // IF PAR.Billing Activity Type is Invoice
 IF PAR.Billing_Activity_Type = '1';

 // PAR.Number of Credits YTD = DB1.Number of Credits YTD
 PAR.Number_of_Credits_YTD = DB1.Number_of_Credits_YTD;

 //?YTD Sales invoiced
 CASE;

 // IF PAR.Affect Sales Doll Status is yes
 IF PAR.Affect_Sales_Doll_Status = 'Y';

 // PAR.YTD Sales Invoiced = DB1.YTD Sales Invoiced + PAR.Order Value Total
 PAR.YTD_Sales_Invoiced = DB1.YTD_Sales_Invoiced + PAR.Order_Value_Total;

 //?YTD Sales invoiced
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.YTD Sales Invoiced = DB1.YTD Sales Invoiced
 PAR.YTD_Sales_Invoiced = DB1.YTD_Sales_Invoiced;

 ENDIF;

 //?Calculate New YTD Invoice $ / # credits
 // IF PAR.Billing Activity Type is Credit Memo
 IF PAR.Billing_Activity_Type = '2';

 // PAR.Number of Credits YTD = DB1.Number of Credits YTD + CON.1
 PAR.Number_of_Credits_YTD = DB1.Number_of_Credits_YTD + 1;

 // PAR.YTD Sales Invoiced = DB1.YTD Sales Invoiced
 PAR.YTD_Sales_Invoiced = DB1.YTD_Sales_Invoiced;

 //?Calculate New YTD Invoice $ / # credits
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?note that debit memos & transfers are ignored here
 // PAR.YTD Sales Invoiced = DB1.YTD Sales Invoiced
 PAR.YTD_Sales_Invoiced = DB1.YTD_Sales_Invoiced;

 // PAR.Number of Credits YTD = DB1.Number of Credits YTD
 PAR.Number_of_Credits_YTD = DB1.Number_of_Credits_YTD;

 ENDIF;

 EXECUTE FUNCTION(CHG A/R Sum Inv Post   CH) TYPE(CHGOBJ) FILE(ARBCREP)          AC1357010;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(DB1.Value_of_Open_Orders);
 PARAMETER(PAR.Date_of_First_Shipment);
 PARAMETER(PAR.Date_of_Last_Shipment);
 PARAMETER(PAR.Amount_of_Last_Shipment);
 PARAMETER(PAR.Number_of_Invoices_YTD);
 PARAMETER(PAR.Number_of_Credits_YTD);
 PARAMETER(PAR.YTD_Sales_Invoiced);
}


