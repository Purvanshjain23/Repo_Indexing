// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKHDXFR
// ?Date: 14.08.2025 Time: 02:51:41
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?H16853 ISE 11/02/20 - Increased the Buy Order Number field
//?  length from 5 to 7.
ENDDO;

//?Mark the Scale Ticket as Unprinted.
EXECUTE FUNCTION(Rtv/Chg for Reprint   RT) TYPE(RTVOBJ) FILE(PKB3CPP)           AB1156432;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Tattoo Scale Tkt  CH) TYPE(CHGOBJ) FILE(PKB3CPP)           AB1113770;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(DB1.TST_Sequence_Number);
 PARAMETER(DB1.TST_Head);
 PARAMETER(DB1.TST_Wgt);
 PARAMETER(DB1.TST_Wgt_Date);
 PARAMETER(DB1.TST_Wgt_Time);
 PARAMETER(DB1.TST_Wgt_Hour);
 PARAMETER(DB1.TST_Last_Zero_Date);
 PARAMETER(DB1.TST_Last_Zero_Time);
 PARAMETER(DB1.TST_Record_Created_Status);
 PARAMETER(DB1.Pen_Company_Number);
 PARAMETER(DB1.Pen_Number);
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER('A');
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 PARAMETER(DB1.RS_User_Added);
 PARAMETER(DB1.RS_Date_Added);
 PARAMETER(DB1.RS_Time_Added);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


//?AND Print the scale ticket
CASE;

// IF PAR.Print Scale Tkt       USR is Yes
IF PAR.Print_Scale_Tkt_USR = 'Y';

EXECUTE FUNCTION(Prt Scale Tkt         IF) TYPE(EXCINTFUN)                      AB1231827;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
{
 //?Execute internal function

 // Call program Rtv Company Values    XF.
 CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER('HPESCLPRT');
 PARAMETER(LCL.System_Value_Alpha_USR);

 // LCL.PRT Printer Device = LCL.System Value Alpha    USR
 LCL.PRT_Printer_Device = LCL.System_Value_Alpha_USR;

 // Execute command - 'OVRPRTF Printer'
 EXECUTE COMMAND(PRK0941);
 PARAMETER('PKO8PFR$');
 PARAMETER(LCL.PRT_Printer_Device);

 // Call program Prt Scale Tkt         PF.
 CALL PROGRAM(Prt Scale Tkt         PF) ('PKO8PFR');
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER(PAR.BOH_Buy_Order_Number);
 PARAMETER(PAR.BOL_Load_Number);
 PARAMETER(PAR.TH_Tattoo_Number);
 PARAMETER(PAR.TH_Kill_Date);

}


ENDIF;

//?   ***    Crt/Upd Update Tattoo Header buy order *** out 012797
//?   ***    Flag Tattoo Header as printed
EXECUTE FUNCTION(Rtv/Chg f/SclTk Reprnt RT) TYPE(RTVOBJ) FILE(PKA1CPP)          AB1156408;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Ttto's SclTckPrt  CH) TYPE(CHGOBJ) FILE(PKA1CPP)           AB1190813;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER('P');
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


//?   ***    Flag Scale ticket as printed
EXECUTE FUNCTION(Rtv/Chg for Printed   RT) TYPE(RTVOBJ) FILE(PKB3CPP)           AB1191092;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
{
 //?USER: Process Data record

 //?Change record status to D = Flag for Purge
 EXECUTE FUNCTION(Chg Tattoo Scale Tkt  CH) TYPE(CHGOBJ) FILE(PKB3CPP)           AB1113770;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(DB1.TST_Sequence_Number);
 PARAMETER(DB1.TST_Head);
 PARAMETER(DB1.TST_Wgt);
 PARAMETER(DB1.TST_Wgt_Date);
 PARAMETER(DB1.TST_Wgt_Time);
 PARAMETER(*MISSING);
 PARAMETER(DB1.TST_Last_Zero_Date);
 PARAMETER(DB1.TST_Last_Zero_Time);
 PARAMETER(DB1.TST_Record_Created_Status);
 PARAMETER(DB1.Pen_Company_Number);
 PARAMETER(DB1.Pen_Number);
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER('D');
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 PARAMETER(DB1.RS_User_Added);
 PARAMETER(DB1.RS_Date_Added);
 PARAMETER(DB1.RS_Time_Added);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // PAR.RS Date Changed = JOB.*Job date
   PAR.RS_Date_Changed = JOB.*Job_date;

   // PAR.RS Time Changed = JOB.*Job time
   PAR.RS_Time_Changed = JOB.*Job_time;

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


CASE;

// IF WRK.TH Scale Ticket Sts is Not Printed
IF WRK.TH_Scale_Ticket_Sts = 'N';

EXECUTE FUNCTION(Rtv Tattoo Hdr Act Comm) TYPE(RTVOBJ) FILE(PKA1CPP)            AB1161771;
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(WRK.TH_Head_Received);
PARAMETER(WRK.TH_Held_Over);
PARAMETER(WRK.TH_AP_Voucher_Document#);
PARAMETER(WRK.TH_Voucher_Payment_Date);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// Call program Crt Tattoo Action Comm XF.
CALL PROGRAM(Crt Tattoo Action Comm XF) ('PKV4XFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER(PAR.BOH_Buy_Order_Number);
PARAMETER(PAR.BOL_Load_Number);
PARAMETER(PAR.TH_Tattoo_Number);
PARAMETER(PAR.TH_Kill_Date);
PARAMETER(WRK.Head_Received_SUM);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER('SC');
PARAMETER(*ZERO);

ENDIF;

CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

CASE;

// IF PAR.Print Scale Tkt       USR is Yes
IF PAR.Print_Scale_Tkt_USR = 'Y';

// Send information message - 'Scale Ticket for Tattoo &1 has been processed and printed.'
MESSAGE(PRK0370 *INFO);
MSGPARM(PAR.TH_Tattoo_Number);

ENDIF;

RETURN;

ENDIF;

