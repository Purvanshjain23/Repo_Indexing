     H/TITLE Exc Val RIN bef/unshp XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 08/06/19  Time  : 10:17:04
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPMAMREL1IF  E           K        DISK
      * RTV : Order Header Extension    Retrieval index
      *
     FPMDACPLAIF  E           K        DISK
      * RSQ : COA Batch Header RIN      ShCo/Order
      *
     I@AMREJF
      * Order Header Extension    Retrieval index
      * Renamed input format fields
     I              AMAIC3                          WAAIC3
     I              AMC4NB                          WAC4NB
     I              AMRMNB                          WARMNB
     I              AMRUNB                          WARUNB
     I              AMXACD                          WAXACD
     I              AMOANA                          WAOANA
     I              AMHBAA                          WAHBAA
     I              AMJ0T1                          WAJ0T1
     I              AMGENY                          WAGENY
     I              AMJ1T1                          WAJ1T1
     I              AMHCAA                          WAHCAA
     I              AMQWDT                          WAQWDT
     I              AMQXDT                          WAQXDT
     I              AMQYDT                          WAQYDT
     I              AMHDAA                          WAHDAA
     I              AMCCTX                          WACCTX
     I              AMJ2T1                          WAJ2T1
     I              AMRLNA                          WARLNA
     I              AMRMNA                          WARMNA
     I              AMGINY                          WAGINY
     I              AMGFNY                          WAGFNY
     I              AMGGNY                          WAGGNY
     I              AMGHNY                          WAGHNY
     I              AMHEVL                          WAHEVL
     I              AMHFVL                          WAHFVL
     I              AMHGVL                          WAHGVL
     I              AMQZDT                          WAQZDT
     I              AMQ0DT                          WAQ0DT
     I              AMQ1DT                          WAQ1DT
     I              AMQ2DT                          WAQ2DT
     I              AMC2TX                          WAC2TX
     I              AMC3TX                          WAC3TX
     I              AMC6TX                          WAC6TX
     I              AMCHTX                          WACHTX
     I              AMCITX                          WACITX
     I              AMCLTX                          WACLTX
     I              AMB4TX                          WAB4TX
     I              AMCUTX                          WACUTX
     I              AMCVTX                          WACVTX
     I              AMB9TX                          WAB9TX
     I              AMJWSC                          WAJWSC
     I              AMITNY                          WAITNY
     I              AMLMT1                          WALMT1
     I              AMLWAA                          WALWAA
     I              AMFVST                          WAFVST
     I              AMF0ST                          WAF0ST
     I              AMF2ST                          WAF2ST
     I              AMF3ST                          WAF3ST
     I              AMJUSC                          WAJUSC
     I              AMJVSC                          WAJVSC
     I              AMV3T1                          WAV3T1
     I              AMV4T1                          WAV4T1
     I              AMV5T1                          WAV5T1
     I              AMV6T1                          WAV6T1
     I              AMV7T1                          WAV7T1
     I              AMV8T1                          WAV8T1
     I              AMV9T1                          WAV9T1
     I              AMWAT1                          WAWAT1
     I              AMWBT1                          WAWBT1
     I              AMWCT1                          WAWCT1
     I              AMWDT1                          WAWDT1
     I              AMQJNY                          WAQJNY
     I              AMQKNY                          WAQKNY
     I              AMQLNY                          WAQLNY
     I              AMP8NY                          WAP8NY
     I              AMP9NY                          WAP9NY
     I              AMQANY                          WAQANY
     I              AMQCNY                          WAQCNY
     I              AMQDNY                          WAQDNY
     I              AMQENY                          WAQENY
     I              AMQFNY                          WAQFNY
     I              AMQGNY                          WAQGNY
     I              AMQHNY                          WAQHNY
     I              AMQINY                          WAQINY
     I              AMQMNY                          WAQMNY
     I              AMMYU1                          WAMYU1
     I              AMJXSC                          WAJXSC
     I              AMJYSC                          WAJYSC
     I              AMJZSC                          WAJZSC
     I              AMJ0SC                          WAJ0SC
     I              AMMZU1                          WAMZU1
     I              AMM0U1                          WAM0U1
     I              AMM1U1                          WAM1U1
     I              AMM2U1                          WAM2U1
     I              AMM3U1                          WAM3U1
     I              AMW5DT                          WAW5DT
     I              AMW6DT                          WAW6DT
     I              AMUVST                          WAUVST
     I              AMUWST                          WAUWST
     I              AMUXST                          WAUXST
     I              AMVSST                          WAVSST
     I              AMAATM                          WAAATM
     I              AMAYNA                          WAAYNA
     I              AMA0NA                          WAA0NA
     I              AMAXDT                          WAAXDT
      *
     I@DACPDL
      * COA Batch Header RIN      ShCo/Order
      * Renamed input format fields
     I              DAAIC3                          WBAIC3
     I              DAL6T1                          WBL6T1
     I              DAI3NY                          WBI3NY
     I              DAJYNY                          WBJYNY
     I              DAQ1NY                          WBQ1NY
     I              DAMUT1                          WBMUT1
     I              DAJZNY                          WBJZNY
     I              DAJ0NY                          WBJ0NY
     I              DAJ2NY                          WBJ2NY
     I              DARIDT                          WBRIDT
     I              DAC5TM                          WBC5TM
     I              DAMVT1                          WBMVT1
     I              DAMWT1                          WBMWT1
     I              DARINT                          WBRINT
     I              DARJDT                          WBRJDT
     I              DAC6TM                          WBC6TM
     I              DAC4NB                          WBC4NB
     I              DADPNB                          WBDPNB
     I              DAUENB                          WBUENB
     I              DARZNB                          WBRZNB
     I              DANGT1                          WBNGT1
     I              DARMNB                          WBRMNB
     I              DARKDT                          WBRKDT
     I              DAC7TM                          WBC7TM
     I              DARINS                          WBRINS
     I              DAMXT1                          WBMXT1
     I              DAG3ST                          WBG3ST
     I              DAQWNY                          WBQWNY
     I              DAL0AA                          WBL0AA
     I              DAMAT1                          WBMAT1
     I              DATDNA                          WBTDNA
     I              DACWC3                          WBCWC3
     I              DAQXNY                          WBQXNY
     I              DAQZNY                          WBQZNY
     I              DAQ0NY                          WBQ0NY
     I              DALVTX                          WBLVTX
     I              DANYT1                          WBNYT1
     I              DAG5ST                          WBG5ST
     I              DAG7ST                          WBG7ST
     I              DATFDT                          WBTFDT
     I              DATGDT                          WBTGDT
     I              DAWIT1                          WBWIT1
     I              DAQYNY                          WBQYNY
     I              DAL7T1                          WBL7T1
     I              DAR8NY                          WBR8NY
     I              DAR0NY                          WBR0NY
     I              DAI7AA                          WBI7AA
     I              DAMXAA                          WBMXAA
     I              DAMSAA                          WBMSAA
     I              DAR7NY                          WBR7NY
     I              DAHEPR                          WBHEPR
     I              DAHFPR                          WBHFPR
     I              DAWVT1                          WBWVT1
     I              DAW0T1                          WBW0T1
     I              DAR5NY                          WBR5NY
     I              DAW1T1                          WBW1T1
     I              DAR6NY                          WBR6NY
     I              DAJ1ST                          WBJ1ST
     I              DAKHST                          WBKHST
     I              DATWDT                          WBTWDT
     I              DADUTM                          WBDUTM
     I              DAKGST                          WBKGST
     I              DATVDT                          WBTVDT
     I              DADTTM                          WBDTTM
     I              DAR9NY                          WBR9NY
     I              DASQNY                          WBSQNY
     I              DABHR3                          WBBHR3
     I              DASRNY                          WBSRNY
     I              DAW7T1                          WBW7T1
     I              DAW8T1                          WBW8T1
     I              DAT2DT                          WBT2DT
     I              DASXNY                          WBSXNY
     I              DASYNY                          WBSYNY
     I              DASZNY                          WBSZNY
     I              DAVSST                          WBVSST
     I              DAMJDT                          WBMJDT
     I              DABETM                          WBBETM
     I              DACCVN                          WBCCVN
     I              DACDVN                          WBCDVN
     I              DAMKDT                          WBMKDT
     I              DABFTM                          WBBFTM
     I              DACEVN                          WBCEVN
     I              DACFVN                          WBCFVN
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: COA Batch Header RIN
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * O :  COA Batch Header RIN
     I                                        3  40 P1MUT1
      * I :  Order Number
     I                                    P  41  440P1C4NB
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1MUT1    PARM P1MUT1    WP0002 38        COA Batch Heade
     C           P1C4NB    PARM           WP0003  70       Order Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Val RIN bef/unshp XF
      * FP1110- This will see if RIN exists for a batch/order
     C                     MOVEL*BLANK    P1MUT1           COA Batch Heade
      * RTV HPB fields         RT - Order Header Extension  * 
     C                     EXSR SARVGN
      * CASE: LCL.HPB COA Batch Number is Entered
     C           YL0001    IFGT *ZERO                      *IF
      * Rtv Val RIN bef/unshp RT - COA Batch Header RIN  * 
     C                     EXSR SBRVGN
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV HPB fields         RT - Order Header Extension  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
      * Setup key
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1C4NB    WAC4NB           Order Number
      * Establish starting position
     C           KRSSA     CHAIN@AMREJF              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR3697' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0001           HPB COA Batch N
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWAITNY    YL0001           HPB COA Batch N
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Val RIN bef/unshp RT - COA Batch Header RIN  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBCWC3    WQSB01           COA Shipping Co
     C           *LIKE     DEFN WBC4NB    WQSB03           Order Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           COA Shipping Co
     C                     KFLD           WQSB03           Order Number
      * Setup key
     C                     Z-ADDP1AIC3    WQSB01           COA Shipping Co
     C                     Z-ADDP1C4NB    WQSB03           Order Number
      * Establish starting position
     C           KRSSB     SETLL@DACPDL                    *
     C           KRSSB     READE@DACPDL                  90*
      * Data record not found
     C   90                MOVEL'USR3855' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELWBMUT1    P1MUT1           COA Batch Heade
     C           KRSSB     READE@DACPDL                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WARUNB           Stop/Drop Seque
     C                     Z-ADD*ZERO     WAQWDT           OHE Sail/Flight
     C                     Z-ADD*ZERO     WAQXDT           OHE Port Cut Da
     C                     Z-ADD*ZERO     WAQYDT           OHE Arrival Dat
     C                     Z-ADD*ZERO     WAGINY           OHE Unused Numb
     C                     Z-ADD*ZERO     WAGFNY           OHE Unused Numb
     C                     Z-ADD*ZERO     WAGGNY           OHE Unused Numb
     C                     Z-ADD*ZERO     WAGHNY           OHE Unused Numb
     C                     Z-ADD*ZERO     WAHEVL           OHE HPB RIN Equ
     C                     Z-ADD*ZERO     WAHFVL           OHE HPB RIN Pri
     C                     Z-ADD*ZERO     WAHGVL           Transload Termi
     C                     Z-ADD*ZERO     WAQZDT           OHE Est Arrv at
     C                     Z-ADD*ZERO     WAQ0DT           OHE Backhaul ET
     C                     Z-ADD*ZERO     WAQ1DT           OHE Port/Pier P
     C                     Z-ADD*ZERO     WAQ2DT           OHE Actual Ship
     C                     Z-ADD*ZERO     WAITNY           HPB COA Batch N
     C                     Z-ADD*ZERO     WAQJNY           OHE Backhaul Re
     C                     Z-ADD*ZERO     WAQKNY           LD Stop/Drop
     C                     Z-ADD*ZERO     WAQLNY           OHE Unused Numb
     C                     Z-ADD*ZERO     WAP8NY           OHE Pier Pass F
     C                     Z-ADD*ZERO     WAP9NY           OHE Port Check
     C                     Z-ADD*ZERO     WAQANY           OHE Port Cut Ti
     C                     Z-ADD*ZERO     WAQCNY           OHE Backhaul Tr
     C                     Z-ADD*ZERO     WAQDNY           OHE Load Sched
     C                     Z-ADD*ZERO     WAQENY           Original Appoin
     C                     Z-ADD*ZERO     WAQFNY           Original Appoin
     C                     Z-ADD*ZERO     WAQGNY           OHE PowerPro Lo
     C                     Z-ADD*ZERO     WAQHNY           OHE PowerPro Lo
     C                     Z-ADD*ZERO     WAQINY           OHE Unused Nume
     C                     Z-ADD*ZERO     WAQMNY           OHE Orig ABS Fr
     C                     Z-ADD*ZERO     WAW5DT           OHE Unused Date
     C                     Z-ADD*ZERO     WAW6DT           OHE Unused Date
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBI3NY           COA Batch Numbe
     C                     Z-ADD*ZERO     WBJYNY           COA Batch Heade
     C                     Z-ADD*ZERO     WBQ1NY           COA Batch Hdr R
     C                     Z-ADD*ZERO     WBJZNY           COA RIN SSSSSSS
     C                     Z-ADD*ZERO     WBJ0NY           COA RIN EEEEEEE
     C                     Z-ADD*ZERO     WBJ2NY           COA RIN Volume
     C                     Z-ADD*ZERO     WBRIDT           COA RIN Transac
     C                     Z-ADD*ZERO     WBC5TM           COA RIN Transac
     C                     Z-ADD*ZERO     WBRJDT           COA Retired RIN
     C                     Z-ADD*ZERO     WBC6TM           COA Retired RIN
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBDPNB           Order Sequence
     C                     Z-ADD*ZERO     WBUENB           Order Secondary
     C                     Z-ADD*ZERO     WBRZNB           Case Sequence N
     C                     Z-ADD*ZERO     WBRMNB           Load ID
     C                     Z-ADD*ZERO     WBRKDT           COA Date of 1st
     C                     Z-ADD*ZERO     WBC7TM           COA RIN Unused
     C                     Z-ADD*ZERO     WBQWNY           COA RIN Gallons
     C                     Z-ADD*ZERO     WBCWC3           COA Shipping Co
     C                     Z-ADD*ZERO     WBQXNY           COA Ref Load Id
     C                     Z-ADD*ZERO     WBQZNY           COA Reference B
     C                     Z-ADD*ZERO     WBQ0NY           COA Reference B
     C                     Z-ADD*ZERO     WBTFDT           COA BHR Net Gal
     C                     Z-ADD*ZERO     WBTGDT           COA BHR Unused
     C                     Z-ADD*ZERO     WBQYNY           COA BHR Loadout
     C                     Z-ADD*ZERO     WBR8NY           COA Batch RIN V
     C                     Z-ADD*ZERO     WBR0NY           COA RIN Quantit
     C                     Z-ADD*ZERO     WBR7NY           COA BHR RIN Gen
     C                     Z-ADD*ZERO     WBHEPR           COA BHR RIN Pri
     C                     Z-ADD*ZERO     WBHFPR           COA BHR Gallon
     C                     Z-ADD*ZERO     WBR5NY           COA RIN Support
     C                     Z-ADD*ZERO     WBR6NY           COA RIN Support
     C                     Z-ADD*ZERO     WBTWDT           COA GEN EMTS Da
     C                     Z-ADD*ZERO     WBDUTM           COA GEN EMTS Ti
     C                     Z-ADD*ZERO     WBTVDT           COA RIN EMTS Da
     C                     Z-ADD*ZERO     WBDTTM           COA RIN EMTS Ti
     C                     Z-ADD*ZERO     WBR9NY           COA EMTS PTD Nb
     C                     Z-ADD*ZERO     WBSQNY           COA EMTS Batch
     C                     Z-ADD*ZERO     WBSRNY           COA BHR Unused
     C                     Z-ADD*ZERO     WBT2DT           COA BHR Unused
     C                     Z-ADD*ZERO     WBSXNY           COA BHR Equiv V
     C                     Z-ADD*ZERO     WBSYNY           COA BHR RINs to
     C                     Z-ADD*ZERO     WBSZNY           COA Unassgnd Tx
     C                     Z-ADD*ZERO     WBMJDT           Create Date
     C                     Z-ADD*ZERO     WBBETM           Create Time
     C                     Z-ADD*ZERO     WBMKDT           Change Date
     C                     Z-ADD*ZERO     WBBFTM           Change Time
     C                     MOVEL'N'       W0PMT   1
      * Define local work field HPB COA Batch Number
     C                     Z-ADD*ZERO     YL0001  50
      *================================================================
     CSR         ZZEXIT    ENDSR
