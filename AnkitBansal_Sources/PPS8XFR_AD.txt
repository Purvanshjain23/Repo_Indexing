// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPS8XFR
// ?Date: 14.08.2025 Time: 03:41:51
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Fix Manifest Prd=Lbl  RT) TYPE(RTVOBJ) FILE(OMFNCPP)           AC1752235;
PARAMETER(360);
{
 //?USER: Process Data record

 //?Break in Ord/Itm :Update Item Bal, dtl, and Item Trans Dtl, manifest dtl
 CASE;

 // IF DB1.Order Number NE LCL.Order Number
 IF DB1.Order_Number <> LCL.Order_Number;

 // OR DB1.Item Code NE LCL.Item Code
 OR DB1.Item_Code <> LCL.Item_Code;

 // OR DB1.Label Date NE LCL.Label Date
 OR DB1.Label_Date <> LCL.Label_Date;

 CASE;

 // IF WRK.Case Weight is NE *ZERO
 IF WRK.Case_Weight <> *ZERO;

 EXECUTE FUNCTION(Rtv Prod Date w/Label RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1752192;
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.Label_Date);
 PARAMETER(WRK.Production_Date_Prev_USR);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Plant Date of Last Order EQ PAR.Plant Date of Last Order
  IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

  // IF *OTHERWISE
  IF *OTHERWISE;

  CASE;

  // IF DB1.Production Day Status is yes
  IF DB1.Production_Day_Status = 'Y';

  // PAR.Production Date Prev USR = DB1.Plant Date of Last Order
  PAR.Production_Date_Prev_USR = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

  ENDIF;

 }

 // WRK.Case Weight = CON.*ZERO - WRK.Case Weight
 WRK.Case_Weight = *ZERO - WRK.Case_Weight;

 // WRK.Case Quantity = CON.*ZERO - WRK.Case Quantity
 WRK.Case_Quantity = *ZERO - WRK.Case_Quantity;

 // Call program Upd Balances Issue/Adj XF.
 CALL PROGRAM(Upd Balances Issue/Adj XF) ('PDQRXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.Item_Code);
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER('I');
 PARAMETER('IO');
 PARAMETER(JOB.*Job_date);
 PARAMETER(WRK.Production_Date_Prev_USR);
 PARAMETER('IC');
 PARAMETER('Manifest Prod Date Corrx');
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(LCL.Order_Number);
 PARAMETER('1');
 PARAMETER(LCL.Label_Date);
 PARAMETER(WRK.Case_Weight);
 PARAMETER(WRK.Case_Quantity);
 PARAMETER('N');

 // WRK.Case Weight = CON.*ZERO - WRK.Case Weight
 WRK.Case_Weight = *ZERO - WRK.Case_Weight;

 // WRK.Case Quantity = CON.*ZERO - WRK.Case Quantity
 WRK.Case_Quantity = *ZERO - WRK.Case_Quantity;

 // Call program Upd Balances Issue/Adj XF.
 CALL PROGRAM(Upd Balances Issue/Adj XF) ('PDQRXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.Item_Code);
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER('I');
 PARAMETER('IO');
 PARAMETER(JOB.*Job_date);
 PARAMETER(LCL.Production_Date);
 PARAMETER('IC');
 PARAMETER('Manifest Prod Date Corrx');
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(LCL.Order_Number);
 PARAMETER('1');
 PARAMETER(LCL.Label_Date);
 PARAMETER(WRK.Case_Weight);
 PARAMETER(WRK.Case_Quantity);
 PARAMETER('Y');

 ENDIF;

 // LCL.Order Number = DB1.Order Number
 LCL.Order_Number = DB1.Order_Number;

 // LCL.Item Code = DB1.Item Code
 LCL.Item_Code = DB1.Item_Code;

 // LCL.Label Date = DB1.Label Date
 LCL.Label_Date = DB1.Label_Date;

 // LCL.Warehouse Code = DB1.Warehouse Code
 LCL.Warehouse_Code = DB1.Warehouse_Code;

 // WRK.Case Weight = CON.*ZERO
 WRK.Case_Weight = *ZERO;

 // WRK.Case Quantity = CON.*ZERO
 WRK.Case_Quantity = *ZERO;

 ENDIF;

 CASE;

 // IF DB1.Production Date is ge 1050906
 IF DB1.Production_Date >= 1050906;

 CASE;

 // IF DB1.Label Date EQ DB1.Production Date
 IF DB1.Label_Date = DB1.Production_Date;

 // AND DB1.Warehouse Code is Guymon Fresh
 AND DB1.Warehouse_Code = 'GP1';

 EXECUTE FUNCTION(Rtv Chill Time        RT) TYPE(RTVOBJ) FILE(CABZREP)           AC1304403;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(WRK.Fresh_Chilling_Time);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF WRK.Fresh Chilling Time is GT Zero
 IF WRK.Fresh_Chilling_Time > *ZERO;

 // WRK.Case Quantity = WRK.Case Quantity + DB1.Case Quantity
 WRK.Case_Quantity = WRK.Case_Quantity + DB1.Case_Quantity;

 // WRK.Case Weight = WRK.Case Weight + DB1.Case Weight
 WRK.Case_Weight = WRK.Case_Weight + DB1.Case_Weight;

 // LCL.Production Date = DB1.Production Date
 LCL.Production_Date = DB1.Production_Date;

 //?Change Prod Date on Manifest Dtl to previous prod date
 CASE;

 // IF DB1.Case Weight is NE *ZERO
 IF DB1.Case_Weight <> *ZERO;

 EXECUTE FUNCTION(Rtv Prod Date w/Label RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1752192;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Label_Date);
 PARAMETER(WRK.Production_Date_Prev_USR);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Plant Date of Last Order EQ PAR.Plant Date of Last Order
  IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

  // IF *OTHERWISE
  IF *OTHERWISE;

  CASE;

  // IF DB1.Production Day Status is yes
  IF DB1.Production_Day_Status = 'Y';

  // PAR.Production Date Prev USR = DB1.Plant Date of Last Order
  PAR.Production_Date_Prev_USR = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

  ENDIF;

 }

 EXECUTE FUNCTION(RTV Chg Prod Date     RT) TYPE(RTVOBJ) FILE(OMFNCPP)           AC1752345;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Case_Sequence_Number);
 PARAMETER(WRK.Production_Date_Prev_USR);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(CHG OM Manifest Detail CH) TYPE(CHGOBJ) FILE(OMFNCPP)          AC1402363;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(DB1.Order_Sequence_Number);
  PARAMETER(DB1.Order_Secondary_Line_Seq);
  PARAMETER(DB1.Case_Sequence_Number);
  PARAMETER(DB1.Case_Quantity);
  PARAMETER(DB1.Case_Weight);
  PARAMETER(DB1.Inventory_Updated_Flag);
  PARAMETER(DB1.Label_Date);
  PARAMETER(DB1.PT_Serial_Number);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(PAR.Production_Date_Prev_USR);
  PARAMETER(DB1.Manifest_Gross_Weight);
  PARAMETER(DB1.Manifest_Lot_ID);
  PARAMETER(DB1.Manifest_Total_Tare);
  PARAMETER(DB1.Manifest_Co_Park_Lot_Nbr);
  PARAMETER(DB1.Manifest_Pallet_Number);
  PARAMETER(DB1.Manifest_Shift);
  PARAMETER(DB1.HPB_Meter_Net_Gallon);
  PARAMETER(DB1.Manifest_Net_Weight_Kg);
  PARAMETER(DB1.Manifest_Unused_Status_1A);
  PARAMETER(DB1.Manifest_Unused_Status_2A);
  PARAMETER(DB1.Manifest_Unused_Date);
  PARAMETER(DB1.HPB_COA_Batch_Number);
  PARAMETER(DB1.HPB_Meter_Start_Gallon);
  PARAMETER(DB1.HPB_Meter_Ending_Gallon);
  PARAMETER(DB1.HPB_Meter_Total_Gallon);
  PARAMETER(DB1.HPB_Meter_Net_Weight);
  PARAMETER(DB1.HPB_Density_Ref_Gravity);
  PARAMETER(DB1.EDI_Status_1);
  PARAMETER(DB1.EDI_Status_2);
  PARAMETER(DB1.EDI_Status_3);
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  PARAMETER(*MISSING);
  PARAMETER(WRK.USR_Update_Flag);
  PARAMETER(LCL.COA_RIN_Modified_Sts);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
   {
    //?Execute internal function

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*JOB
    PAR.Job_Name = JOB.*JOB;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

   //?USER: Processing after Data update

   // PAR.USR Update Flag = CND.Yes
   PAR.USR_Update_Flag = 'Y';

   // PAR.COA RIN Modified Sts = CND.yes
   PAR.COA_RIN_Modified_Sts = 'Y';

  }

 }

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


//?***** Change Log and Comments
DO;

//?03/05/2009 LJB FP1127
//?** Recompile - change to update balances function, in case used again
ENDDO;

