// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKW9XFR
// ?Date: 14.08.2025 Time: 02:53:14
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?RMC 10/21/21 WHD 86412 Validate for Eval Trans UPL not shift specific.
//?ISE 11/05/20 H16853-Recompiled due to change in Buy Order Number
//?Send pager messages if data not found. Run this at 3am, 2 hours
//?  before MPR starts at 5am.
// LCL.MPR Job               USR = CND.Yes
LCL.MPR_Job_USR = 'Y';

//?RMC 11/16/05 get co for user
// Call program Rtv Co for User       XF.
CALL PROGRAM(Rtv Co for User       XF) ('PLF8XFR');
PARAMETER(LCL.CC_Company_Number);
PARAMETER('HPE');

EXECUTE FUNCTION(RTV Payment Prc        RT) TYPE(RTVOBJ) FILE(PKC4REP)          AB1146809;
PARAMETER(LCL.CC_Company_Number);
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(LCL.Pmt_Current_Payment_Step);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.MPR Reporting Date = JOB.*Job date
LCL.MPR_Reporting_Date = JOB.*Job_date;

// Call program VAL Kill Day    2 OMS XF.
CALL PROGRAM(VAL Kill Day    2 OMS XF) ('PDWBXFR');
PARAMETER(LCL.CC_Company_Number);
PARAMETER(LCL.MPR_Reporting_Date);
PARAMETER(LCL.Invalid_Y_N_USR);

// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(LCL.CC_Company_Number);
PARAMETER('HOTSCLBAL');
PARAMETER(LCL.System_Value_Alpha_USR);

// LCL.Office Dist List USR = LCL.System Value Alpha    USR
LCL.Office_Dist_List_USR = LCL.System_Value_Alpha_USR;

//?   - If Invalid Y/N USR = Y, then Kill Day Sts = N.
//?   - If Invalid Y/N USR = N, then Kill Day Sts = Y.
//?Validate data/send pagers if current date is a kill day
CASE;

// IF LCL.Invalid Y/N USR is No
IF LCL.Invalid_Y_N_USR = 'N';

//?Validate Hot Scale Upload
DO;

//?Validate for any hot scale record -> not shift specific  10/21/21
//?     Change shift to POS instead of RST                     RMC
EXECUTE FUNCTION(Val Evl Trn b/Sft     RT) TYPE(RTVOBJ) FILE(PKCPCPP)           AB1227414;
PARAMETER(LCL.CC_Company_Number);
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(1);
PARAMETER(LCL.Record_Found_USR);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

 QUIT;

}


// LCL.Record Found Shift 1 USR = LCL.Record Found USR
LCL.Record_Found_Shift_1_USR = LCL.Record_Found_USR;

CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// Retrieve message - 'HPEBAL:  Upload for &3 Shift &1 for &2 not available.  Job Ended Abnormally.'
LCL.Office_Dist_Message_USR = RTVMSG(PRK0914);
PARAMETER(*BLANK);
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(LCL.CC_Company_Number);

// Call program Snd Pager Msg (MPLUS) UP.
CALL PROGRAM(Snd Pager Msg (MPLUS) UP) ('POMSUPC');
PARAMETER(LCL.Office_Dist_List_USR);
PARAMETER(LCL.Office_Dist_Message_USR);

EXECUTE FUNCTION(Snd Pager Message     IF) TYPE(EXCINTFUN)                      AB1230228;
PARAMETER(LCL.CC_Company_Number);
PARAMETER('BALERRPGR');
PARAMETER(400-100-002);
{
 //?Execute internal function

 // Call program Rtv Company Values    XF.
 CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
 PARAMETER(PAR.Company_Number_USR);
 PARAMETER(PAR.Company_Value_Code_USR);
 PARAMETER(PAR.System_Value_Alpha_USR);

 // PAR.Pager Name USR = PAR.System Value Alpha    USR
 PAR.Pager_Name_USR = PAR.System_Value_Alpha_USR;

 // Execute command - 'SND Pager Message'
 EXECUTE COMMAND(PRK0920);
 PARAMETER(PAR.Pager_Msg_USR);
 PARAMETER(PAR.Pager_Name_USR);

}


ENDIF;

ENDDO;

//?Validate Condemns Entry
DO;

//?Shift 1
EXECUTE FUNCTION(Rtv Company Event     RT) TYPE(RTVOBJ) FILE(PKEXCPP)           AB1230733;
PARAMETER(LCL.CC_Company_Number);
PARAMETER('CONDMN');
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(1);
PARAMETER(LCL.CE_Data_Exist);
PARAMETER(LCL.CE_User_Initials);
PARAMETER(LCL.Record_Found_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

}


CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// Retrieve message - 'Condemns have not been entered for &3 &1 Shift &2.'
LCL.Pager_Msg_USR = RTVMSG(PRK0930);
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(1);
PARAMETER(LCL.CC_Company_Number);

EXECUTE FUNCTION(Snd Pager Message     IF) TYPE(EXCINTFUN)                      AB1230228;
PARAMETER(LCL.CC_Company_Number);
PARAMETER('CNDENTPGR');
PARAMETER(LCL.Pager_Msg_USR);
{
 //?Execute internal function

 // Call program Rtv Company Values    XF.
 CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
 PARAMETER(PAR.Company_Number_USR);
 PARAMETER(PAR.Company_Value_Code_USR);
 PARAMETER(PAR.System_Value_Alpha_USR);

 // PAR.Pager Name USR = PAR.System Value Alpha    USR
 PAR.Pager_Name_USR = PAR.System_Value_Alpha_USR;

 // Execute command - 'SND Pager Message'
 EXECUTE COMMAND(PRK0920);
 PARAMETER(PAR.Pager_Msg_USR);
 PARAMETER(PAR.Pager_Name_USR);

}


ENDIF;

//?Shift 2
EXECUTE FUNCTION(Rtv Company Event     RT) TYPE(RTVOBJ) FILE(PKEXCPP)           AB1230733;
PARAMETER(LCL.CC_Company_Number);
PARAMETER('CONDMN');
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(2);
PARAMETER(LCL.CE_Data_Exist);
PARAMETER(LCL.CE_User_Initials);
PARAMETER(LCL.Record_Found_USR);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

}


CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// Retrieve message - 'Condemns have not been entered for &3 &1 Shift &2.'
LCL.Pager_Msg_USR = RTVMSG(PRK0930);
PARAMETER(LCL.Current_Kill_Date);
PARAMETER(2);
PARAMETER(LCL.CC_Company_Number);

EXECUTE FUNCTION(Snd Pager Message     IF) TYPE(EXCINTFUN)                      AB1230228;
PARAMETER(LCL.CC_Company_Number);
PARAMETER('CNDENTPGR');
PARAMETER(LCL.Pager_Msg_USR);
{
 //?Execute internal function

 // Call program Rtv Company Values    XF.
 CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
 PARAMETER(PAR.Company_Number_USR);
 PARAMETER(PAR.Company_Value_Code_USR);
 PARAMETER(PAR.System_Value_Alpha_USR);

 // PAR.Pager Name USR = PAR.System Value Alpha    USR
 PAR.Pager_Name_USR = PAR.System_Value_Alpha_USR;

 // Execute command - 'SND Pager Message'
 EXECUTE COMMAND(PRK0920);
 PARAMETER(PAR.Pager_Msg_USR);
 PARAMETER(PAR.Pager_Name_USR);

}


ENDIF;

ENDDO;

ENDIF;

