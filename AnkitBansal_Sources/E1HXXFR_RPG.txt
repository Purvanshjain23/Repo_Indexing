     H/TITLE Exc Prc From F0116    XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : E1IDEVMDL
     H* System        : E1IDEVMDL
     H* User name     : ISRCENT
     H* Date          : 08/27/20  Time  : 14:08:06
     H* Copyright     : E1IDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FEZ0116L2  IF   E           K DISK
      * RSQ : Address by Date    F0116Z Sel Unprocessed
      *
     FE10116L1  IF   E           K DISK
      * RTV : Address by Date    F0116  Retrieval index
      *
     FE10101LA  IF   E           K DISK
      * RSQ : Address Book       F0101  Address Number
      *
     FE10116L0  UF A E           K DISK
      * UPD : Address by Date    F0116  Update index
      *
     FEZ0116L0  UF   E           K DISK
      * UPD : Address by Date    F0116Z Update index
      *
      * Long constants
     D @CN#            S              6    DIM(01)CTDATA PERRCD(1)
     D @CN             S             25    DIM(01) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QE1011        E DS                  EXTNAME(E10116L0)
      * UPD : Address by Date    F0116  Update index
      * Renamed input format fields
     D  WBAN8        E                     EXTFLD(ALAN8)
     D  WBEFTB       E                     EXTFLD(ALEFTB)
     D  WBEFTF       E                     EXTFLD(ALEFTF)
     D  WBADD1       E                     EXTFLD(ALADD1)
     D  WBADD2       E                     EXTFLD(ALADD2)
     D  WBADD3       E                     EXTFLD(ALADD3)
     D  WBADD4       E                     EXTFLD(ALADD4)
     D  WBADDZ       E                     EXTFLD(ALADDZ)
     D  WBCTY1       E                     EXTFLD(ALCTY1)
     D  WBCOUN       E                     EXTFLD(ALCOUN)
     D  WBADDS       E                     EXTFLD(ALADDS)
     D  WBCRTE       E                     EXTFLD(ALCRTE)
     D  WBBKML       E                     EXTFLD(ALBKML)
     D  WBCTR        E                     EXTFLD(ALCTR)
     D  WBUSER       E                     EXTFLD(ALUSER)
     D  WBPID        E                     EXTFLD(ALPID)
     D  WBUPMJ       E                     EXTFLD(ALUPMJ)
     D  WBJOBN       E                     EXTFLD(ALJOBN)
     D  WBUPMT       E                     EXTFLD(ALUPMT)
     D  WBSYNC       E                     EXTFLD(ALSYNC)
     D  WBCAAD       E                     EXTFLD(ALCAAD)
      *
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
     D YARDCS          DS           295
     D QEZ011        E DS                  EXTNAME(EZ0116L0)
      * UPD : Address by Date    F0116Z Update index
      * Renamed input format fields
     D  WEAN8        E                     EXTFLD(A8AN8)
     D  WEEFTB       E                     EXTFLD(A8EFTB)
     D  WEACTS       E                     EXTFLD(A8ACTS)
     D  WETNAC       E                     EXTFLD(A8TNAC)
     D  WEEFTF       E                     EXTFLD(A8EFTF)
     D  WEADD1       E                     EXTFLD(A8ADD1)
     D  WEADD2       E                     EXTFLD(A8ADD2)
     D  WEADD3       E                     EXTFLD(A8ADD3)
     D  WEADD4       E                     EXTFLD(A8ADD4)
     D  WEADDZ       E                     EXTFLD(A8ADDZ)
     D  WECTY1       E                     EXTFLD(A8CTY1)
     D  WECOUN       E                     EXTFLD(A8COUN)
     D  WEADDS       E                     EXTFLD(A8ADDS)
     D  WECRTE       E                     EXTFLD(A8CRTE)
     D  WEBKML       E                     EXTFLD(A8BKML)
     D  WECTR        E                     EXTFLD(A8CTR)
     D  WEUSER       E                     EXTFLD(A8USER)
     D  WEPID        E                     EXTFLD(A8PID)
     D  WEUPMJ       E                     EXTFLD(A8UPMJ)
     D  WEJOBN       E                     EXTFLD(A8JOBN)
     D  WEUPMT       E                     EXTFLD(A8UPMT)
     D  WESYNC       E                     EXTFLD(A8SYNC)
     D  WECAAD       E                     EXTFLD(A8CAAD)
     D  WEIEST       E                     EXTFLD(A8IEST)
     D  WEADDT       E                     EXTFLD(A8ADDT)
     D  WEADTM       E                     EXTFLD(A8ADTM)
      *
     D YBRDCS          DS           332
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  XDTSDL         S             26
     D  WQSD01         S                   LIKE(WDAN8)
     D  ZADFMF         S             10
     D  YARDC          S              1
     D  YBRDC          S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
     I@0116E9
      * Address by Date    F0116Z Sel Unprocessed
      * Renamed input format fields
     I              A8AN8                       WAAN8
     I              A8EFTB                      WAEFTB
     I              A8ACTS                      WAACTS
     I              A8TNAC                      WATNAC
     I              A8EFTF                      WAEFTF
     I              A8ADD1                      WAADD1
     I              A8ADD2                      WAADD2
     I              A8ADD3                      WAADD3
     I              A8ADD4                      WAADD4
     I              A8ADDZ                      WAADDZ
     I              A8CTY1                      WACTY1
     I              A8COUN                      WACOUN
     I              A8ADDS                      WAADDS
     I              A8CRTE                      WACRTE
     I              A8BKML                      WABKML
     I              A8CTR                       WACTR
     I              A8USER                      WAUSER
     I              A8PID                       WAPID
     I              A8UPMJ                      WAUPMJ
     I              A8JOBN                      WAJOBN
     I              A8UPMT                      WAUPMT
     I              A8SYNC                      WASYNC
     I              A8CAAD                      WACAAD
     I              A8IEST                      WAIEST
     I              A8ADDT                      WAADDT
     I              A8ADTM                      WAADTM
      *
     II0116L0
      * Address by Date    F0116  Update index
      * Renamed input format fields
     I              ALAN8                       WBAN8
     I              ALEFTB                      WBEFTB
     I              ALEFTF                      WBEFTF
     I              ALADD1                      WBADD1
     I              ALADD2                      WBADD2
     I              ALADD3                      WBADD3
     I              ALADD4                      WBADD4
     I              ALADDZ                      WBADDZ
     I              ALCTY1                      WBCTY1
     I              ALCOUN                      WBCOUN
     I              ALADDS                      WBADDS
     I              ALCRTE                      WBCRTE
     I              ALBKML                      WBBKML
     I              ALCTR                       WBCTR
     I              ALUSER                      WBUSER
     I              ALPID                       WBPID
     I              ALUPMJ                      WBUPMJ
     I              ALJOBN                      WBJOBN
     I              ALUPMT                      WBUPMT
     I              ALSYNC                      WBSYNC
     I              ALCAAD                      WBCAAD
      *
     II0116L1
      * Address by Date    F0116  Retrieval index
      * Renamed input format fields
     I              ALAN8                       WCAN8
     I              ALEFTB                      WCEFTB
     I              ALEFTF                      WCEFTF
     I              ALADD1                      WCADD1
     I              ALADD2                      WCADD2
     I              ALADD3                      WCADD3
     I              ALADD4                      WCADD4
     I              ALADDZ                      WCADDZ
     I              ALCTY1                      WCCTY1
     I              ALCOUN                      WCCOUN
     I              ALADDS                      WCADDS
     I              ALCRTE                      WCCRTE
     I              ALBKML                      WCBKML
     I              ALCTR                       WCCTR
     I              ALUSER                      WCUSER
     I              ALPID                       WCPID
     I              ALUPMJ                      WCUPMJ
     I              ALJOBN                      WCJOBN
     I              ALUPMT                      WCUPMT
     I              ALSYNC                      WCSYNC
     I              ALCAAD                      WCCAAD
      *
     II0101LA
      * Address Book       F0101  Address Number
      * Renamed input format fields
     I              ABAN8                       WDAN8
     I              ABALKY                      WDALKY
     I              ABTAX                       WDTAX
     I              ABALPH                      WDALPH
     I              ABDC                        WDDC
     I              ABMCU                       WDMCU
     I              ABSIC                       WDSIC
     I              ABLNGP                      WDLNGP
     I              ABAT1                       WDAT1
     I              ABCM                        WDCM
     I              ABTAXC                      WDTAXC
     I              ABAT2                       WDAT2
     I              ABAT3                       WDAT3
     I              ABAT4                       WDAT4
     I              ABAT5                       WDAT5
     I              ABATP                       WDATP
     I              ABATR1                      WDATR1
     I              ABATPR                      WDATPR
     I              ABAB3                       WDAB3
     I              ABATE                       WDATE
     I              ABSBLI                      WDSBLI
     I              ABEFTB                      WDEFTB
     I              ABAN81                      WDAN81
     I              ABAN82                      WDAN82
     I              ABAN83                      WDAN83
     I              ABAN84                      WDAN84
     I              ABAN86                      WDAN86
     I              ABAN85                      WDAN85
     I              ABAC01                      WDAC01
     I              ABAC02                      WDAC02
     I              ABAC03                      WDAC03
     I              ABAC04                      WDAC04
     I              ABAC05                      WDAC05
     I              ABAC06                      WDAC06
     I              ABAC07                      WDAC07
     I              ABAC08                      WDAC08
     I              ABAC09                      WDAC09
     I              ABAC10                      WDAC10
     I              ABAC11                      WDAC11
     I              ABAC12                      WDAC12
     I              ABAC13                      WDAC13
     I              ABAC14                      WDAC14
     I              ABAC15                      WDAC15
     I              ABAC16                      WDAC16
     I              ABAC17                      WDAC17
     I              ABAC18                      WDAC18
     I              ABAC19                      WDAC19
     I              ABAC20                      WDAC20
     I              ABAC21                      WDAC21
     I              ABAC22                      WDAC22
     I              ABAC23                      WDAC23
     I              ABAC24                      WDAC24
     I              ABAC25                      WDAC25
     I              ABAC26                      WDAC26
     I              ABAC27                      WDAC27
     I              ABAC28                      WDAC28
     I              ABAC29                      WDAC29
     I              ABAC30                      WDAC30
     I              ABGLBA                      WDGLBA
     I              ABPTI                       WDPTI
     I              ABPDI                       WDPDI
     I              ABMSGA                      WDMSGA
     I              ABRMK                       WDRMK
     I              ABTXCT                      WDTXCT
     I              ABTX2                       WDTX2
     I              ABALP1                      WDALP1
     I              ABURCD                      WDURCD
     I              ABURDT                      WDURDT
     I              ABURAT                      WDURAT
     I              ABURAB                      WDURAB
     I              ABURRF                      WDURRF
     I              ABUSER                      WDUSER
     I              ABPID                       WDPID
     I              ABUPMJ                      WDUPMJ
     I              ABJOBN                      WDJOBN
     I              ABUPMT                      WDUPMT
     I              ABPRGF                      WDPRGF
     I              ABSCCT                      WDSCCT
     I              ABTICK                      WDTICK
     I              ABEXCG                      WDEXCG
     I              ABDUNS                      WDDUNS
     I              ABCLS1                      WDCLS1
     I              ABCLS2                      WDCLS2
     I              ABCLS3                      WDCLS3
     I              ABCLS4                      WDCLS4
     I              ABCLS5                      WDCLS5
     I              ABNOE                       WDNOE
     I              ABGROW                      WDGROW
     I              ABYRST                      WDYRST
     I              ABEMPG                      WDEMPG
     I              ABACTI                      WDACTI
     I              ABREVR                      WDREVR
     I              ABSYNC                      WDSYNC
     I              ABPERR                      WDPERR
     I              ABCAAD                      WDCAAD
      *
     I@A8CPEN
      * Address by Date    F0116Z Update index
      * Renamed input format fields
     I              A8AN8                       WEAN8
     I              A8EFTB                      WEEFTB
     I              A8ACTS                      WEACTS
     I              A8TNAC                      WETNAC
     I              A8EFTF                      WEEFTF
     I              A8ADD1                      WEADD1
     I              A8ADD2                      WEADD2
     I              A8ADD3                      WEADD3
     I              A8ADD4                      WEADD4
     I              A8ADDZ                      WEADDZ
     I              A8CTY1                      WECTY1
     I              A8COUN                      WECOUN
     I              A8ADDS                      WEADDS
     I              A8CRTE                      WECRTE
     I              A8BKML                      WEBKML
     I              A8CTR                       WECTR
     I              A8USER                      WEUSER
     I              A8PID                       WEPID
     I              A8UPMJ                      WEUPMJ
     I              A8JOBN                      WEJOBN
     I              A8UPMT                      WEUPMT
     I              A8SYNC                      WESYNC
     I              A8CAAD                      WECAAD
     I              A8IEST                      WEIEST
     I              A8ADDT                      WEADDT
     I              A8ADTM                      WEADTM
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc Prc From F0116    XF
      * SDN 465 JDE to E1 RMC 4/24/2020
      *   Read staged table from E1 for the address book and update E1IDE
      *    table E10116- process ADDS and CHANGES
      * Rtv Prc From F0116    RT - Address by Date    F0116Z  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Prc From F0116    RT - Address by Date    F0116Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KPSSA         KLIST
     C                   KFLD                    WAAN8                          Address Number
     C                   KFLD                    WAEFTB                         Date-Beginning
     C                   KFLD                    WAACTS                         Date Time Stamp
      * Initialize key list
     C                   MOVEL     *LOVAL        WAAN8                          Address Number
     C                   MOVEL     *LOVAL        WAEFTB                         Date-Beginning
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
      * Setup key
      * Establish starting position
     C     KPSSA         SETLL     @0116E9                                      *
     C                   READ      @0116E9                                90    *
      * Data record not found
     C   90              MOVEL     'E1I0145'     W0RTN
      * USER: Process Data record
      * CASE: DB1.Transaction Action Z is Delete
     C                   DOW       NOT *IN90
      * Delete Address by Date - Address by Date    F0116  * 
     C                   IF        WATNAC = 'D'
     C                   EXSR      SBDLRC
     C                   ELSE
      * CASE: *OTHERWISE
      * Rtv CrtChg from Stg   RT - Address by Date    F0116  * 
     C                   EXSR      SCRVGN
     C                   END                                                    *FI
      * Chg E10016 to Prcd    CH - Address by Date    F0116Z  * 
     C                   EXSR      SGCHRC
     C                   READ      @0116E9                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBDLRC        BEGSR
      *================================================================
      * Delete Address by Date - Address by Date    F0116  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to I0116L0
     C                   Z-ADD     WAAN8         WBAN8                          Address Number
     C                   Z-ADD     WAEFTB        WBEFTB                         Date-Beginning
      *
     C     KLDLSB        KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBEFTB                         Date-Beginning
     C     KLDLSB        CHAIN     I0116L0                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'E10116L0'    MDACP
     C                   MOVEL     'I0116L0'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    I0116L0                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Rtv CrtChg from Stg   RT - Address by Date    F0116  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WCAN8                          Address Number
     C                   KFLD                    WCEFTB                         Date-Beginning
      * Setup key
     C                   Z-ADD     WAAN8         WCAN8                          Address Number
     C                   Z-ADD     WAEFTB        WCEFTB                         Date-Beginning
      * Establish starting position
     C     KRSSC         CHAIN     I0116L1                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0084'     W0RTN
      * USER: Processing if Data record not found
      * dont create rcd if Address Master doesnt exist
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
     C                   EXSR      SDRVGN
      * CASE: PGM.*Return code is *Normal
      * Crt E10116 from Stg   CR - Address by Date    F0116  * 
     C                   IF        W0RTN = ' '
     C                   EXSR      SECRRC
     C                   END                                                    *FI
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * Chg E10116 from Stg   CH - Address by Date    F0116  * 
     C                   IF        NOT *IN90
     C                   EXSR      SFCHRC
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    WQSD01                         Address Number
      * Setup key
     C                   Z-ADD     WAAN8         WQSD01                         Address Number
      * Establish starting position
     C     KRSSD         SETLL     I0101LA                                      *
     C     KRSSD         READE     I0101LA                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0078'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   EVAL      W0RTN = ' '                                  *Return code
     C     KRSSD         READE     I0101LA                                90    *
     C                   ENDDO
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SECRRC        BEGSR
      *================================================================
      * Crt E10116 from Stg   CR - Address by Date    F0116  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to I0116L0
     C                   Z-ADD     WAAN8         WBAN8                          Address Number
     C                   Z-ADD     WAEFTB        WBEFTB                         Date-Beginning
     C                   MOVEL     WAEFTF        WBEFTF                         Effective Date
     C                   MOVEL     WAADD1        WBADD1                         Address Line 1
     C                   MOVEL     WAADD2        WBADD2                         Address Line 2
     C                   MOVEL     WAADD3        WBADD3                         Address Line 3
     C                   MOVEL     WAADD4        WBADD4                         Address Line 4
     C                   MOVEL     WAADDZ        WBADDZ                         Postal Code
     C                   MOVEL     WACTY1        WBCTY1                         City
     C                   MOVEL     WACOUN        WBCOUN                         County Name
     C                   MOVEL     WAADDS        WBADDS                         State
     C                   MOVEL     WACRTE        WBCRTE                         Carrier Route
     C                   MOVEL     WABKML        WBBKML                         Bulk Mailing Ce
     C                   MOVEL     WACTR         WBCTR                          Country
     C                   MOVEL     WAUSER        WBUSER                         User ID
     C                   MOVEL     WAPID         WBPID                          Program ID
     C                   Z-ADD     WAUPMJ        WBUPMJ                         Date - Updated
     C                   MOVEL     WAJOBN        WBJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WBUPMT                         Time - Last Upd
     C                   Z-ADD     WASYNC        WBSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WBCAAD                         Server Status
      *
     C     KLCRSE        KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBEFTB                         Date-Beginning
      * Check for duplicate primary key
     C     KLCRSE        SETLL     I0116L0                                90    *
     C                   IF        *IN90
     C                   MOVEL     'E1I0085'     W0RTN
      * Send message 'Address by Date    F01 EX'
     C                   MOVEL     'E1I0085'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
     C                   WRITE     I0116L0                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCHRC        BEGSR
      *================================================================
      * Chg E10116 from Stg   CH - Address by Date    F0116  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to I0116L0
     C                   Z-ADD     WCAN8         WBAN8                          Address Number
     C                   Z-ADD     WCEFTB        WBEFTB                         Date-Beginning
      *
     C     KLCHSF        KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBEFTB                         Date-Beginning
     C     KLCHSF        CHAIN     I0116L0                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'E10116L0'    MDACP
     C                   MOVEL     'I0116L0'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL002.
     C                   MOVEL     'LBL002'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QE1011        YARDCS
      * Move non-key fields to I0116L0
     C                   MOVEL(P)  WAEFTF        WBEFTF                         Effective Date
     C                   MOVEL(P)  WAADD1        WBADD1                         Address Line 1
     C                   MOVEL(P)  WAADD2        WBADD2                         Address Line 2
     C                   MOVEL(P)  WAADD3        WBADD3                         Address Line 3
     C                   MOVEL(P)  WAADD4        WBADD4                         Address Line 4
     C                   MOVEL(P)  WAADDZ        WBADDZ                         Postal Code
     C                   MOVEL(P)  WACTY1        WBCTY1                         City
     C                   MOVEL(P)  WACOUN        WBCOUN                         County Name
     C                   MOVEL(P)  WAADDS        WBADDS                         State
     C                   MOVEL(P)  WACRTE        WBCRTE                         Carrier Route
     C                   MOVEL(P)  WABKML        WBBKML                         Bulk Mailing Ce
     C                   MOVEL(P)  WACTR         WBCTR                          Country
     C                   MOVEL(P)  WAUSER        WBUSER                         User ID
     C                   MOVEL(P)  WAPID         WBPID                          Program ID
     C                   Z-ADD     WAUPMJ        WBUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WBJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WBUPMT                         Time - Last Upd
     C                   Z-ADD     WASYNC        WBSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WBCAAD                         Server Status
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QE1011 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    I0116L0                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    E10116L0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   SGCHRC        BEGSR
      *================================================================
      * Chg E10016 to Prcd    CH - Address by Date    F0116Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YBRDC = ' '
      *
      * Move key fields to @A8CPEN
     C                   Z-ADD     WAAN8         WEAN8                          Address Number
     C                   Z-ADD     WAEFTB        WEEFTB                         Date-Beginning
     C                   MOVEL(P)  WAACTS        WEACTS                         Date Time Stamp
      *
     C     KLCHSG        KLIST
     C                   KFLD                    WEAN8                          Address Number
     C                   KFLD                    WEEFTB                         Date-Beginning
     C                   KFLD                    WEACTS                         Date Time Stamp
     C     KLCHSG        CHAIN     @A8CPEN                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'EZ0116L0'    MDACP
     C                   MOVEL     '@A8CPEN'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL003.
     C                   MOVEL     'LBL003'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SGEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SGEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QEZ011        YBRDCS
      * Move non-key fields to @A8CPEN
     C                   MOVEL(P)  WATNAC        WETNAC                         Transaction Act
     C                   MOVEL(P)  WAEFTF        WEEFTF                         Effective Date
     C                   MOVEL(P)  WAADD1        WEADD1                         Address Line 1
     C                   MOVEL(P)  WAADD2        WEADD2                         Address Line 2
     C                   MOVEL(P)  WAADD3        WEADD3                         Address Line 3
     C                   MOVEL(P)  WAADD4        WEADD4                         Address Line 4
     C                   MOVEL(P)  WAADDZ        WEADDZ                         Postal Code
     C                   MOVEL(P)  WACTY1        WECTY1                         City
     C                   MOVEL(P)  WACOUN        WECOUN                         County Name
     C                   MOVEL(P)  WAADDS        WEADDS                         State
     C                   MOVEL(P)  WACRTE        WECRTE                         Carrier Route
     C                   MOVEL(P)  WABKML        WEBKML                         Bulk Mailing Ce
     C                   MOVEL(P)  WACTR         WECTR                          Country
     C                   MOVEL(P)  WAUSER        WEUSER                         User ID
     C                   MOVEL(P)  WAPID         WEPID                          Program ID
     C                   Z-ADD     WAUPMJ        WEUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WEJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WEUPMT                         Time - Last Upd
     C                   Z-ADD     WASYNC        WESYNC                         Synchronization
     C                   Z-ADD     WACAAD        WECAAD                         Server Status
     C                   MOVEL(P)  '1'           WEIEST                         OMS ERP Process
     C                   Z-ADD     ##JDT         WEADDT                         OMS ERP Process
     C                   Z-ADD     ##JTM         WEADTM                         OMS ERP Process
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QEZ011 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YBRDC = 'Y'
     C                   UPDATE    @A8CPEN                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    EZ0116L0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SGEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAN8                          Address Number
     C                   Z-ADD     *ZERO         WAEFTB                         Date-Beginning
     C                   MOVE(P)   '0'           XDTSDL
     C                   MOVEL     @CN(001)      XDTSDL
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
     C                   Z-ADD     *ZERO         WAUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WAUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WASYNC                         Synchronization
     C                   Z-ADD     *ZERO         WACAAD                         Server Status
     C                   Z-ADD     *ZERO         WAADDT                         OMS ERP Process
     C                   Z-ADD     *ZERO         WAADTM                         OMS ERP Process
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAN8                          Address Number
     C                   Z-ADD     *ZERO         WBEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WBUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WBUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WBSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WBCAAD                         Server Status
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WDAN8                          Address Number
     C                   Z-ADD     *ZERO         WDEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WDAN81                         Address Number
     C                   Z-ADD     *ZERO         WDAN82                         Address Number
     C                   Z-ADD     *ZERO         WDAN83                         Address Number
     C                   Z-ADD     *ZERO         WDAN84                         Address Number
     C                   Z-ADD     *ZERO         WDAN86                         Address Number
     C                   Z-ADD     *ZERO         WDAN85                         Factor/Special
     C                   Z-ADD     *ZERO         WDPTI                          Time - Schedule
     C                   Z-ADD     *ZERO         WDPDI                          Date - Schedule
     C                   Z-ADD     *ZERO         WDURDT                         User Reserved D
     C                   Z-ADD     *ZERO         WDURAT                         User Reserved A
     C                   Z-ADD     *ZERO         WDURAB                         User Reserved N
     C                   Z-ADD     *ZERO         WDUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WDUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WDNOE                          Number of Emplo
     C                   Z-ADD     *ZERO         WDGROW                         Growth Rate
     C                   Z-ADD     *ZERO         WDSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WDPERR                         Previous Error
     C                   Z-ADD     *ZERO         WDCAAD                         Server Status
      * Obtain default message file
     C     *DTAARA       DEFINE    E1MGFLA       ZADFMF
     C                   IN        ZADFMF
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 0001-01-01-00.00.00.00000
