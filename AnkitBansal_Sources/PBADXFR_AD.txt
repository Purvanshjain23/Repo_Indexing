// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBADXFR
// ?Date: 14.08.2025 Time: 03:47:12
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV CRT EDI WSO Orders RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC2027921;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Load_Status);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(RTV 1st Whse Not CancelRT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC2130424;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(LCL.Warehouse_Code);
 {
  //?USER: Initialize routine

  // PAR.Warehouse Code = CON.*BLANK
  PAR.Warehouse_Code = *BLANK;

  //?USER: Process Data record

  // PAR.Warehouse Code = DB1.Warehouse Code
  PAR.Warehouse_Code = DB1.Warehouse_Code;

  QUIT;

 }

 //?R15305 DN 07/07/21-Get 'Hold til ship within #day' Value for EDI 940.
 EXECUTE FUNCTION(RTV Warehouse Duns    RT) TYPE(RTVOBJ) FILE(PNG0REP)           AC2023518;
 PARAMETER(LCL.Warehouse_Code);
 PARAMETER('WSO');
 PARAMETER(LCL.EDI_Trading_Partner_No);
 PARAMETER(LCL.EDI_Whs_Duns_Number);
 PARAMETER(LCL.EDI_Company_#_940_846_947);
 PARAMETER(LCL.Hold_til_ship_within_#day);
 PARAMETER(LCL.Record_Status_1_Usr);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?R15305 DN 07/07/21-Added 'Hold til ship within #day' Logic.
 //?New.                    R15305 DN 7/7/21-Hold Until Ship Logic.
 CASE;

 // IF LCL.Record Status 1 Usr is Active
 IF LCL.Record_Status_1_Usr = 'A';

 CASE;

 // IF LCL.Hold til ship within #day is Zero
 IF LCL.Hold_til_ship_within_#day = *ZERO;

 //?Create EDI 940 Transaction.
 // Call program Exc EDI Whs Shp Order XF.
 CALL PROGRAM(Exc EDI Whs Shp Order XF) ('PNYHXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(PAR.Load_Status);

 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Curr Date + Days To Hold = JOB.*Job date + LCL.Hold til ship within #day *DAYS
 LCL.Curr_Date_+_Days_To_Hold = DATEINCR(JOB.*Job_date LCL.Hold_til_ship_within_#day 'DY'
 1111111 'NONE' 'N' 1);

 EXECUTE FUNCTION(Rtv Scheduled Ship DateRT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC2197811;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Scheduled_Ship_Date);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?If SSD <= (Current Date + Days To Hold) Then Create EDI 940.
 CASE;

 // IF LCL.Scheduled Ship Date LE LCL.Curr Date + Days To Hold
 IF LCL.Scheduled_Ship_Date <= LCL.Curr_Date_+_Days_To_Hold;

 //?Create EDI 940 Transaction.
 // Call program Exc EDI Whs Shp Order XF.
 CALL PROGRAM(Exc EDI Whs Shp Order XF) ('PNYHXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(PAR.Load_Status);

 //?If SSD <= (Current Date + Days To Hold) Then Create EDI 940.
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(CHG OHE EDI 940 Action CH) TYPE(CHGOBJ) FILE(PMAMREP)          AC2141606;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER('H');
 {
  //?USER: Processing before Data update

  // DB1.Job Time = JOB.*Job time
  DB1.Job_Time = JOB.*Job_time;

  // DB1.Job Date = JOB.*Job date
  DB1.Job_Date = JOB.*Job_date;

  // DB1.Job Name = JOB.*PROGRAM
  DB1.Job_Name = JOB.*PROGRAM;

  // DB1.User Id = JOB.*USER
  DB1.User_Id = JOB.*USER;

 }

 ENDIF;

 ENDIF;

 ENDIF;

}


