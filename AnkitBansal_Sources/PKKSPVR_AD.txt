// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKKSPVR
// ?Date: 14.08.2025 Time: 02:51:59
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?H16853 - ISE - 02/03/21 - Increased Buy Order length from 5 to 7.
//?                          Recompilation only.
// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Load screen

MOVE *ALL (To: DTL From: PAR);

// DTL.TST Sequence Number = CON.1
DTL.TST_Sequence_Number = 1;

//?USER: Process command keys

//?If not F3 or F22 then set fields to zero
CASE;

// IF DTL.*CMD key is CF03
IF DTL.*CMD_key = '03';

// OR DTL.*CMD key is CF22
OR DTL.*CMD_key = '22';

//?If not F3 or F22 then set fields to zero
// IF *OTHERWISE
IF *OTHERWISE;

// DTL.TST Wgt = CON.*ZERO
DTL.TST_Wgt = *ZERO;

// DTL.TST Wgt Date = CON.*ZERO
DTL.TST_Wgt_Date = *ZERO;

// DTL.TST Wgt Time = CON.*ZERO
DTL.TST_Wgt_Time = *ZERO;

// DTL.TST Last Zero Date = CON.*ZERO
DTL.TST_Last_Zero_Date = *ZERO;

// DTL.TST Last Zero Time = CON.*ZERO
DTL.TST_Last_Zero_Time = *ZERO;

ENDIF;

//?USER: User defined action

CASE;

// IF DTL.*CMD key is CF03
IF DTL.*CMD_key = '03';

// OR DTL.*CMD key is CF22
OR DTL.*CMD_key = '22';

// PAR.TST Wgt = DTL.TST Wgt
PAR.TST_Wgt = DTL.TST_Wgt;

// PAR.TST Wgt Date = DTL.TST Wgt Date
PAR.TST_Wgt_Date = DTL.TST_Wgt_Date;

// PAR.TST Wgt Time = DTL.TST Wgt Time
PAR.TST_Wgt_Time = DTL.TST_Wgt_Time;

// PAR.TST Last Zero Date = DTL.TST Last Zero Date
PAR.TST_Last_Zero_Date = DTL.TST_Last_Zero_Date;

// PAR.TST Last Zero Time = DTL.TST Last Zero Time
PAR.TST_Last_Zero_Time = DTL.TST_Last_Zero_Time;

CASE;

// IF DTL.*CMD key is CF03
IF DTL.*CMD_key = '03';

// PAR.Return Code USR = CND.*Normal
PAR.Return_Code_USR = *BLANK;

// IF DTL.*CMD key is CF22
IF DTL.*CMD_key = '22';

// Call program ZzzRsl Spread Wgt     DF.
CALL PROGRAM(ZzzRsl Spread Wgt     DF) ('PKLZDFR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(DTL.TST_Wgt);
PARAMETER(DTL.TST_Wgt_Date);
PARAMETER(DTL.TST_Wgt_Time);
PARAMETER(DTL.TST_Last_Zero_Date);
PARAMETER(DTL.TST_Last_Zero_Time);
PARAMETER(DTL.Pen_Number);
PARAMETER(PAR.Return_Code_USR);
PARAMETER(DTL.TST_Head);
PARAMETER(PAR.Oms_System_Value_Alpha);

CASE;

// IF PAR.Return Code USR is Re-Weigh
IF PAR.Return_Code_USR = 'REWEIGH';

// PGM.*Return code = CND.*Normal
PGM.*Return_code = *BLANK;

// PGM.*Continue transaction = CND.*YES
PGM.*Continue_transaction = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

PGM.*Return_code = *BLANK;

RETURN;

ENDIF;

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.TST Wgt = CON.*ZERO
DTL.TST_Wgt = *ZERO;

// DTL.TST Wgt Date = CON.*ZERO
DTL.TST_Wgt_Date = *ZERO;

// DTL.TST Wgt Time = CON.*ZERO
DTL.TST_Wgt_Time = *ZERO;

// DTL.TST Last Zero Date = CON.*ZERO
DTL.TST_Last_Zero_Date = *ZERO;

// DTL.TST Last Zero Time = CON.*ZERO
DTL.TST_Last_Zero_Time = *ZERO;

ENDIF;

