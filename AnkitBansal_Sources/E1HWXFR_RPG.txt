     H/TITLE Exc Prc From F0115    XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : E1IDEVMDL
     H* System        : E1IDEVMDL
     H* User name     : ISRCENT
     H* Date          : 08/14/20  Time  : 16:03:28
     H* Copyright     : E1IDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FEZ0115L2  IF   E           K DISK
      * RSQ : Address Book-Phone F0115Z Sel Unprocessed
      *
     FE10115L1  IF   E           K DISK
      * RTV : Address Book-Phone F0115  Retrieval index
      *
     FE10101LA  IF   E           K DISK
      * RSQ : Address Book       F0101  Address Number
      *
     FE10115L0  UF A E           K DISK
      * UPD : Address Book-Phone F0115  Update index
      *
     FEZ0115L0  UF   E           K DISK
      * UPD : Address Book-Phone F0115Z Update index
      *
      * Long constants
     D @CN#            S              6    DIM(01)CTDATA PERRCD(1)
     D @CN             S             25    DIM(01) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QE1011        E DS                  EXTNAME(E10115L0)
      * UPD : Address Book-Phone F0115  Update index
      * Renamed input format fields
     D  WDAN8        E                     EXTFLD(EPAN8)
     D  WDIDLN       E                     EXTFLD(EPIDLN)
     D  WDRCK7       E                     EXTFLD(EPRCK7)
     D  WDCNLN       E                     EXTFLD(EPCNLN)
     D  WDPHTP       E                     EXTFLD(EPPHTP)
     D  WDAR1        E                     EXTFLD(EPAR1)
     D  WDPH1        E                     EXTFLD(EPPH1)
     D  WDUSER       E                     EXTFLD(EPUSER)
     D  WDPID        E                     EXTFLD(EPPID)
     D  WDUPMJ       E                     EXTFLD(EPUPMJ)
     D  WDJOBN       E                     EXTFLD(EPJOBN)
     D  WDUPMT       E                     EXTFLD(EPUPMT)
     D  WDCFNO       E                     EXTFLD(EPCFNO)
     D  WDGEN1       E                     EXTFLD(EPGEN1)
     D  WDFALG       E                     EXTFLD(EPFALG)
     D  WDSYNC       E                     EXTFLD(EPSYNC)
     D  WDCAAD       E                     EXTFLD(EPCAAD)
      *
     D YARDCS          DS           113
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
     D QEZ011        E DS                  EXTNAME(EZ0115L0)
      * UPD : Address Book-Phone F0115Z Update index
      * Renamed input format fields
     D  WEAN8        E                     EXTFLD(A5AN8)
     D  WEIDLN       E                     EXTFLD(A5IDLN)
     D  WERCK7       E                     EXTFLD(A5RCK7)
     D  WEACTS       E                     EXTFLD(A5ACTS)
     D  WECNLN       E                     EXTFLD(A5CNLN)
     D  WEPHTP       E                     EXTFLD(A5PHTP)
     D  WEAR1        E                     EXTFLD(A5AR1)
     D  WEPH1        E                     EXTFLD(A5PH1)
     D  WEUSER       E                     EXTFLD(A5USER)
     D  WEPID        E                     EXTFLD(A5PID)
     D  WEUPMJ       E                     EXTFLD(A5UPMJ)
     D  WEJOBN       E                     EXTFLD(A5JOBN)
     D  WEUPMT       E                     EXTFLD(A5UPMT)
     D  WECFNO       E                     EXTFLD(A5CFNO)
     D  WEGEN1       E                     EXTFLD(A5GEN1)
     D  WEFALG       E                     EXTFLD(A5FALG)
     D  WESYNC       E                     EXTFLD(A5SYNC)
     D  WECAAD       E                     EXTFLD(A5CAAD)
     D  WEIEST       E                     EXTFLD(A5IEST)
     D  WEADDT       E                     EXTFLD(A5ADDT)
     D  WEADTM       E                     EXTFLD(A5ADTM)
      *
     D YBRDCS          DS           148
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  XDTSDL         S             26
     D  WQSC01         S                   LIKE(WCAN8)
     D  ZADFMF         S             10
     D  YARDC          S              1
     D  YBRDC          S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
     I@0115E8
      * Address Book-Phone F0115Z Sel Unprocessed
      * Renamed input format fields
     I              A5AN8                       WAAN8
     I              A5IDLN                      WAIDLN
     I              A5RCK7                      WARCK7
     I              A5ACTS                      WAACTS
     I              A5CNLN                      WACNLN
     I              A5PHTP                      WAPHTP
     I              A5AR1                       WAAR1
     I              A5PH1                       WAPH1
     I              A5USER                      WAUSER
     I              A5PID                       WAPID
     I              A5UPMJ                      WAUPMJ
     I              A5JOBN                      WAJOBN
     I              A5UPMT                      WAUPMT
     I              A5CFNO                      WACFNO
     I              A5GEN1                      WAGEN1
     I              A5FALG                      WAFALG
     I              A5SYNC                      WASYNC
     I              A5CAAD                      WACAAD
     I              A5IEST                      WAIEST
     I              A5ADDT                      WAADDT
     I              A5ADTM                      WAADTM
      *
     II0115L1
      * Address Book-Phone F0115  Retrieval index
      * Renamed input format fields
     I              EPAN8                       WBAN8
     I              EPIDLN                      WBIDLN
     I              EPRCK7                      WBRCK7
     I              EPCNLN                      WBCNLN
     I              EPPHTP                      WBPHTP
     I              EPAR1                       WBAR1
     I              EPPH1                       WBPH1
     I              EPUSER                      WBUSER
     I              EPPID                       WBPID
     I              EPUPMJ                      WBUPMJ
     I              EPJOBN                      WBJOBN
     I              EPUPMT                      WBUPMT
     I              EPCFNO                      WBCFNO
     I              EPGEN1                      WBGEN1
     I              EPFALG                      WBFALG
     I              EPSYNC                      WBSYNC
     I              EPCAAD                      WBCAAD
      *
     II0101LA
      * Address Book       F0101  Address Number
      * Renamed input format fields
     I              ABAN8                       WCAN8
     I              ABALKY                      WCALKY
     I              ABTAX                       WCTAX
     I              ABALPH                      WCALPH
     I              ABDC                        WCDC
     I              ABMCU                       WCMCU
     I              ABSIC                       WCSIC
     I              ABLNGP                      WCLNGP
     I              ABAT1                       WCAT1
     I              ABCM                        WCCM
     I              ABTAXC                      WCTAXC
     I              ABAT2                       WCAT2
     I              ABAT3                       WCAT3
     I              ABAT4                       WCAT4
     I              ABAT5                       WCAT5
     I              ABATP                       WCATP
     I              ABATR1                      WCATR1
     I              ABATPR                      WCATPR
     I              ABAB3                       WCAB3
     I              ABATE                       WCATE
     I              ABSBLI                      WCSBLI
     I              ABEFTB                      WCEFTB
     I              ABAN81                      WCAN81
     I              ABAN82                      WCAN82
     I              ABAN83                      WCAN83
     I              ABAN84                      WCAN84
     I              ABAN86                      WCAN86
     I              ABAN85                      WCAN85
     I              ABAC01                      WCAC01
     I              ABAC02                      WCAC02
     I              ABAC03                      WCAC03
     I              ABAC04                      WCAC04
     I              ABAC05                      WCAC05
     I              ABAC06                      WCAC06
     I              ABAC07                      WCAC07
     I              ABAC08                      WCAC08
     I              ABAC09                      WCAC09
     I              ABAC10                      WCAC10
     I              ABAC11                      WCAC11
     I              ABAC12                      WCAC12
     I              ABAC13                      WCAC13
     I              ABAC14                      WCAC14
     I              ABAC15                      WCAC15
     I              ABAC16                      WCAC16
     I              ABAC17                      WCAC17
     I              ABAC18                      WCAC18
     I              ABAC19                      WCAC19
     I              ABAC20                      WCAC20
     I              ABAC21                      WCAC21
     I              ABAC22                      WCAC22
     I              ABAC23                      WCAC23
     I              ABAC24                      WCAC24
     I              ABAC25                      WCAC25
     I              ABAC26                      WCAC26
     I              ABAC27                      WCAC27
     I              ABAC28                      WCAC28
     I              ABAC29                      WCAC29
     I              ABAC30                      WCAC30
     I              ABGLBA                      WCGLBA
     I              ABPTI                       WCPTI
     I              ABPDI                       WCPDI
     I              ABMSGA                      WCMSGA
     I              ABRMK                       WCRMK
     I              ABTXCT                      WCTXCT
     I              ABTX2                       WCTX2
     I              ABALP1                      WCALP1
     I              ABURCD                      WCURCD
     I              ABURDT                      WCURDT
     I              ABURAT                      WCURAT
     I              ABURAB                      WCURAB
     I              ABURRF                      WCURRF
     I              ABUSER                      WCUSER
     I              ABPID                       WCPID
     I              ABUPMJ                      WCUPMJ
     I              ABJOBN                      WCJOBN
     I              ABUPMT                      WCUPMT
     I              ABPRGF                      WCPRGF
     I              ABSCCT                      WCSCCT
     I              ABTICK                      WCTICK
     I              ABEXCG                      WCEXCG
     I              ABDUNS                      WCDUNS
     I              ABCLS1                      WCCLS1
     I              ABCLS2                      WCCLS2
     I              ABCLS3                      WCCLS3
     I              ABCLS4                      WCCLS4
     I              ABCLS5                      WCCLS5
     I              ABNOE                       WCNOE
     I              ABGROW                      WCGROW
     I              ABYRST                      WCYRST
     I              ABEMPG                      WCEMPG
     I              ABACTI                      WCACTI
     I              ABREVR                      WCREVR
     I              ABSYNC                      WCSYNC
     I              ABPERR                      WCPERR
     I              ABCAAD                      WCCAAD
      *
     II0115L0
      * Address Book-Phone F0115  Update index
      * Renamed input format fields
     I              EPAN8                       WDAN8
     I              EPIDLN                      WDIDLN
     I              EPRCK7                      WDRCK7
     I              EPCNLN                      WDCNLN
     I              EPPHTP                      WDPHTP
     I              EPAR1                       WDAR1
     I              EPPH1                       WDPH1
     I              EPUSER                      WDUSER
     I              EPPID                       WDPID
     I              EPUPMJ                      WDUPMJ
     I              EPJOBN                      WDJOBN
     I              EPUPMT                      WDUPMT
     I              EPCFNO                      WDCFNO
     I              EPGEN1                      WDGEN1
     I              EPFALG                      WDFALG
     I              EPSYNC                      WDSYNC
     I              EPCAAD                      WDCAAD
      *
     I@A5CPEH
      * Address Book-Phone F0115Z Update index
      * Renamed input format fields
     I              A5AN8                       WEAN8
     I              A5IDLN                      WEIDLN
     I              A5RCK7                      WERCK7
     I              A5ACTS                      WEACTS
     I              A5CNLN                      WECNLN
     I              A5PHTP                      WEPHTP
     I              A5AR1                       WEAR1
     I              A5PH1                       WEPH1
     I              A5USER                      WEUSER
     I              A5PID                       WEPID
     I              A5UPMJ                      WEUPMJ
     I              A5JOBN                      WEJOBN
     I              A5UPMT                      WEUPMT
     I              A5CFNO                      WECFNO
     I              A5GEN1                      WEGEN1
     I              A5FALG                      WEFALG
     I              A5SYNC                      WESYNC
     I              A5CAAD                      WECAAD
     I              A5IEST                      WEIEST
     I              A5ADDT                      WEADDT
     I              A5ADTM                      WEADTM
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc Prc From F0115    XF
      * SDN 465 JDE to E1 RMC 4/24/2020
      *   Read staged table from E1 for the address book and update E1IDE
      *    table E10115- process ADDS and CHANGES
      * Rtv Prc From F0115    RT - Address Book-Phone F0115Z  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Prc From F0115    RT - Address Book-Phone F0115Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KPSSA         KLIST
     C                   KFLD                    WAAN8                          Address Number
     C                   KFLD                    WAIDLN                         Who's Who Line
     C                   KFLD                    WARCK7                         Line Number ID
     C                   KFLD                    WAACTS                         Date Time Stamp
      * Initialize key list
     C                   MOVEL     *LOVAL        WAAN8                          Address Number
     C                   MOVEL     *LOVAL        WAIDLN                         Who's Who Line
     C                   MOVEL     *LOVAL        WARCK7                         Line Number ID
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
      * Setup key
      * Establish starting position
     C     KPSSA         SETLL     @0115E8                                      *
     C                   READ      @0115E8                                90    *
      * Data record not found
     C   90              MOVEL     'E1I0141'     W0RTN
      * USER: Process Data record
      * Rtv CrtChg from Stage RT - Address Book-Phone F0115  * 
     C                   DOW       NOT *IN90
     C                   EXSR      SBRVGN
      * Chg EZ0115 to Prcd    CH - Address Book-Phone F0115Z  * 
     C                   EXSR      SFCHRC
     C                   READ      @0115E8                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Rtv CrtChg from Stage RT - Address Book-Phone F0115  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBIDLN                         Who's Who Line
     C                   KFLD                    WBRCK7                         Line Number ID
      * Setup key
     C                   Z-ADD     WAAN8         WBAN8                          Address Number
     C                   Z-ADD     WAIDLN        WBIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WBRCK7                         Line Number ID
      * Establish starting position
     C     KRSSB         CHAIN     I0115L1                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0082'     W0RTN
      * USER: Processing if Data record not found
      * dont create rcd if Address Master doesnt exist
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
     C                   EXSR      SCRVGN
      * CASE: PGM.*Return code is *Normal
      * Crt E10115 from Stg   CR - Address Book-Phone F0115  * 
     C                   IF        W0RTN = ' '
     C                   EXSR      SDCRRC
     C                   END                                                    *FI
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * Chg E10115 from Stg  CH - Address Book-Phone F0115  * 
     C                   IF        NOT *IN90
     C                   EXSR      SECHRC
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WQSC01                         Address Number
      * Setup key
     C                   Z-ADD     WAAN8         WQSC01                         Address Number
      * Establish starting position
     C     KRSSC         SETLL     I0101LA                                      *
     C     KRSSC         READE     I0101LA                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0078'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   EVAL      W0RTN = ' '                                  *Return code
     C     KRSSC         READE     I0101LA                                90    *
     C                   ENDDO
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDCRRC        BEGSR
      *================================================================
      * Crt E10115 from Stg   CR - Address Book-Phone F0115  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to I0115L0
     C                   Z-ADD     WAAN8         WDAN8                          Address Number
     C                   Z-ADD     WAIDLN        WDIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WDRCK7                         Line Number ID
     C                   Z-ADD     WACNLN        WDCNLN                         Related Person
     C                   MOVEL     WAPHTP        WDPHTP                         Phone Number Ty
     C                   MOVEL     WAAR1         WDAR1                          Phone Prefix
     C                   MOVEL     WAPH1         WDPH1                          Phone Number
     C                   MOVEL     WAUSER        WDUSER                         User ID
     C                   MOVEL     WAPID         WDPID                          Program ID
     C                   Z-ADD     WAUPMJ        WDUPMJ                         Date - Updated
     C                   MOVEL     WAJOBN        WDJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WDUPMT                         Time - Last Upd
     C                   Z-ADD     WACFNO        WDCFNO                         Generic Number
     C                   MOVEL     WAGEN1        WDGEN1                         Generic Informa
     C                   MOVEL     WAFALG        WDFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WDSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WDCAAD                         Server Status
      *
     C     KLCRSD        KLIST
     C                   KFLD                    WDAN8                          Address Number
     C                   KFLD                    WDIDLN                         Who's Who Line
     C                   KFLD                    WDRCK7                         Line Number ID
      * Check for duplicate primary key
     C     KLCRSD        SETLL     I0115L0                                90    *
     C                   IF        *IN90
     C                   MOVEL     'E1I0083'     W0RTN
      * Send message 'Address Book-Phone F01 EX'
     C                   MOVEL     'E1I0083'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
     C                   WRITE     I0115L0                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SECHRC        BEGSR
      *================================================================
      * Chg E10115 from Stg  CH - Address Book-Phone F0115  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to I0115L0
     C                   Z-ADD     WBAN8         WDAN8                          Address Number
     C                   Z-ADD     WBIDLN        WDIDLN                         Who's Who Line
     C                   Z-ADD     WBRCK7        WDRCK7                         Line Number ID
      *
     C     KLCHSE        KLIST
     C                   KFLD                    WDAN8                          Address Number
     C                   KFLD                    WDIDLN                         Who's Who Line
     C                   KFLD                    WDRCK7                         Line Number ID
     C     KLCHSE        CHAIN     I0115L0                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'E10115L0'    MDACP
     C                   MOVEL     'I0115L0'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QE1011        YARDCS
      * Move non-key fields to I0115L0
     C                   Z-ADD     WACNLN        WDCNLN                         Related Person
     C                   MOVEL(P)  WAPHTP        WDPHTP                         Phone Number Ty
     C                   MOVEL(P)  WAAR1         WDAR1                          Phone Prefix
     C                   MOVEL(P)  WAPH1         WDPH1                          Phone Number
     C                   MOVEL(P)  WAUSER        WDUSER                         User ID
     C                   MOVEL(P)  WAPID         WDPID                          Program ID
     C                   Z-ADD     WAUPMJ        WDUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WDJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WDUPMT                         Time - Last Upd
     C                   Z-ADD     WACFNO        WDCFNO                         Generic Number
     C                   MOVEL(P)  WAGEN1        WDGEN1                         Generic Informa
     C                   MOVEL(P)  WAFALG        WDFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WDSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WDCAAD                         Server Status
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QE1011 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    I0115L0                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    E10115L0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCHRC        BEGSR
      *================================================================
      * Chg EZ0115 to Prcd    CH - Address Book-Phone F0115Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YBRDC = ' '
      *
      * Move key fields to @A5CPEH
     C                   Z-ADD     WAAN8         WEAN8                          Address Number
     C                   Z-ADD     WAIDLN        WEIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WERCK7                         Line Number ID
     C                   MOVEL(P)  WAACTS        WEACTS                         Date Time Stamp
      *
     C     KLCHSF        KLIST
     C                   KFLD                    WEAN8                          Address Number
     C                   KFLD                    WEIDLN                         Who's Who Line
     C                   KFLD                    WERCK7                         Line Number ID
     C                   KFLD                    WEACTS                         Date Time Stamp
     C     KLCHSF        CHAIN     @A5CPEH                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'EZ0115L0'    MDACP
     C                   MOVEL     '@A5CPEH'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL002.
     C                   MOVEL     'LBL002'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QEZ011        YBRDCS
      * Move non-key fields to @A5CPEH
     C                   Z-ADD     WACNLN        WECNLN                         Related Person
     C                   MOVEL(P)  WAPHTP        WEPHTP                         Phone Number Ty
     C                   MOVEL(P)  WAAR1         WEAR1                          Phone Prefix
     C                   MOVEL(P)  WAPH1         WEPH1                          Phone Number
     C                   MOVEL(P)  WAUSER        WEUSER                         User ID
     C                   MOVEL(P)  WAPID         WEPID                          Program ID
     C                   Z-ADD     WAUPMJ        WEUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WEJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WEUPMT                         Time - Last Upd
     C                   Z-ADD     WACFNO        WECFNO                         Generic Number
     C                   MOVEL(P)  WAGEN1        WEGEN1                         Generic Informa
     C                   MOVEL(P)  WAFALG        WEFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WESYNC                         Synchronization
     C                   Z-ADD     WACAAD        WECAAD                         Server Status
     C                   MOVEL(P)  '1'           WEIEST                         OMS ERP Process
     C                   Z-ADD     ##JDT         WEADDT                         OMS ERP Process
     C                   Z-ADD     ##JTM         WEADTM                         OMS ERP Process
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QEZ011 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YBRDC = 'Y'
     C                   UPDATE    @A5CPEH                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    EZ0115L0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAN8                          Address Number
     C                   Z-ADD     *ZERO         WAIDLN                         Who's Who Line
     C                   Z-ADD     *ZERO         WARCK7                         Line Number ID
     C                   MOVE(P)   '0'           XDTSDL
     C                   MOVEL     @CN(001)      XDTSDL
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
     C                   Z-ADD     *ZERO         WACNLN                         Related Person
     C                   Z-ADD     *ZERO         WAUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WAUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WACFNO                         Generic Number
     C                   Z-ADD     *ZERO         WASYNC                         Synchronization
     C                   Z-ADD     *ZERO         WACAAD                         Server Status
     C                   Z-ADD     *ZERO         WAADDT                         OMS ERP Process
     C                   Z-ADD     *ZERO         WAADTM                         OMS ERP Process
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAN8                          Address Number
     C                   Z-ADD     *ZERO         WBIDLN                         Who's Who Line
     C                   Z-ADD     *ZERO         WBRCK7                         Line Number ID
     C                   Z-ADD     *ZERO         WBCNLN                         Related Person
     C                   Z-ADD     *ZERO         WBUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WBUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WBCFNO                         Generic Number
     C                   Z-ADD     *ZERO         WBSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WBCAAD                         Server Status
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCAN8                          Address Number
     C                   Z-ADD     *ZERO         WCEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WCAN81                         Address Number
     C                   Z-ADD     *ZERO         WCAN82                         Address Number
     C                   Z-ADD     *ZERO         WCAN83                         Address Number
     C                   Z-ADD     *ZERO         WCAN84                         Address Number
     C                   Z-ADD     *ZERO         WCAN86                         Address Number
     C                   Z-ADD     *ZERO         WCAN85                         Factor/Special
     C                   Z-ADD     *ZERO         WCPTI                          Time - Schedule
     C                   Z-ADD     *ZERO         WCPDI                          Date - Schedule
     C                   Z-ADD     *ZERO         WCURDT                         User Reserved D
     C                   Z-ADD     *ZERO         WCURAT                         User Reserved A
     C                   Z-ADD     *ZERO         WCURAB                         User Reserved N
     C                   Z-ADD     *ZERO         WCUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WCUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WCNOE                          Number of Emplo
     C                   Z-ADD     *ZERO         WCGROW                         Growth Rate
     C                   Z-ADD     *ZERO         WCSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WCPERR                         Previous Error
     C                   Z-ADD     *ZERO         WCCAAD                         Server Status
      * Obtain default message file
     C     *DTAARA       DEFINE    E1MGFLA       ZADFMF
     C                   IN        ZADFMF
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 0001-01-01-00.00.00.00000
