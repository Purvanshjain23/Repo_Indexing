     H/TITLE EDT Price Simulator WK EF Edit file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated
     H* - Key changes are not allowed
     H* - New records cannot be added
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Edit file
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISPPATE
     H* Date          : 05/05/10  Time  : 16:03:32
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDOEEFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: EDT Price Simulator WK EF Edit file
      *
     FPDIMCPW2IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : Order Detail Pricing      Ord/Dtl/Prc Seq Work
      *
     FCAABREL3IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       NV
      *
     FOPBGWKL1IF  E           K        DISK
      * RTV : Order Detail              Retrieval index
      *
     FOPBFCPL1IF  E           K        DISK
      * RTV : Order Header TRG          Retrieval index       NV
      *
     FPDIKREL2IF  E           K        DISK
      * RSQ : Price Method Detail       K=Co,Meth,Component;Actv
      *
     FPDIJREL1IF  E           K        DISK
      * RTV : Price Method Componant    Retrieval index
      *
     FCABBREL1IF  E           K        DISK
      * RTV : Customer                  Retrieval index       NV
      *
     FCABZREL1IF  E           K        DISK
      * RTV : Company Item              Retrieval index       NV
      *
     FPDIHREL3IF  E           K        DISK
      * RSQ : Price Method Header       System/Co/Price Method
      *
     FCABBREL9IF  E           K        DISK
      * RSQ : Customer                  Rsq Ship #, Active
      *
     FOPCIREL7IF  E           K        DISK
      * RSQ : OPP Item Contract         RSQ Cont#/Co/Cust/Item
      *
     FOPCIREL8IF  E           K        DISK
      * RTV : OPP Item Contract         Active only
      *
     FPDIPREL2IF  E           K        DISK
      * RSQ : Market Date Method        System/Co/Date Method
      *
     FPDIHREL0IF  E           K        DISK
      * RTV : Price Method Header       Retrieval index
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPDIMCPW0UF  E           K        DISK
      * UPD : Order Detail Pricing      Upd Index for Work File
      *
     E                    J7          7  1
     E                    K7          7  1
      * RIGHT JUSTIFY INPUT FIELD
      * Days in month for date validation
     E                    @XD    12  12  2 0
     E                    #L7         7  1
     E                    #L3         3  1
     E                    UCT        40  1               CENTER TABLE
      * Screen: Field position and name array
     E                    W0BEG   7 028  5 0A
     E                    W0END   7 028  5 0A
     E                    W0NAM   7 028 10
     I@BBREU3
      * Customer                  Rsq Ship #, Active
      * Renamed input format fields
     I              BBBKC7                          WABKC7
     I              BBAYTX                          WAAYTX
     I              BBACNA                          WAACNA
     I              BBADNA                          WAADNA
     I              BBAENA                          WAAENA
     I              BBAJNA                          WAAJNA
     I              BBBGCD                          WABGCD
     I              BBG5CD                          WAG5CD
     I              BBBTTX                          WABTTX
     I              BBBVTX                          WABVTX
     I              BBBWTX                          WABWTX
     I              BBABTX                          WAABTX
     I              BBA2NA                          WAA2NA
     I              BBCBST                          WACBST
     I              BBB0NA                          WAB0NA
     I              BBP3NB                          WAP3NB
     I              BBAXNA                          WAAXNA
     I              BBI6DT                          WAI6DT
     I              BBAYDT                          WAAYDT
     I              BBANC7                          WAANC7
     I              BBBTC7                          WABTC7
     I              BBK6ST                          WAK6ST
     I              BBUZST                          WAUZST
     I              BBKXCD                          WAKXCD
     I              BBLTCD                          WALTCD
     I              BBQNST                          WAQNST
     I              BBS2NB                          WAS2NB
     I              BBVHVA                          WAVHVA
     I              BBI7DT                          WAI7DT
     I              BBRJST                          WARJST
     I              BBRKST                          WARKST
     I              BBQWST                          WAQWST
     I              BBQXST                          WAQXST
     I              BBQYST                          WAQYST
     I              BBUNCS                          WAUNCS
     I              BBUVST                          WAUVST
     I              BBUWST                          WAUWST
     I              BBUXST                          WAUXST
     I              BBVSST                          WAVSST
     I              BBAATM                          WAAATM
     I              BBAYNA                          WAAYNA
     I              BBA0NA                          WAA0NA
     I              BBAXDT                          WAAXDT
      *
     I@CIREWP
      * OPP Item Contract         Active only
      * Renamed input format fields
     I              CIAIC3                          WBAIC3
     I              CIBKC7                          WBBKC7
     I              CIHGCD                          WBHGCD
     I              CIAUDT                          WBAUDT
     I              CICWDT                          WBCWDT
     I              CIAUST                          WBAUST
     I              CIANDT                          WBANDT
     I              CIAUNA                          WBAUNA
     I              CIDQQT                          WBDQQT
     I              CIHFQT                          WBHFQT
     I              CIL6NB                          WBL6NB
     I              CIFSQT                          WBFSQT
     I              CIB0PR                          WBB0PR
     I              CIGBDT                          WBGBDT
     I              CIGCDT                          WBGCDT
     I              CIGDDT                          WBGDDT
     I              CIRDCD                          WBRDCD
     I              CIQ7CD                          WBQ7CD
     I              CIRQCD                          WBRQCD
     I              CIR4CD                          WBR4CD
     I              CIUVST                          WBUVST
     I              CIUWST                          WBUWST
     I              CIUXST                          WBUXST
     I              CIVSST                          WBVSST
     I              CIAATM                          WBAATM
     I              CIAYNA                          WBAYNA
     I              CIA0NA                          WBA0NA
     I              CIAXDT                          WBAXDT
      *
     I@IHRERN
      * Price Method Header       Retrieval index
      * Renamed input format fields
     I              IHAIC3                          WCAIC3
     I              IHQ7CD                          WCQ7CD
     I              IHMLNA                          WCMLNA
     I              IHU0ST                          WCU0ST
     I              IHV8ST                          WCV8ST
     I              IHBYST                          WCBYST
     I              IHRMNY                          WCRMNY
     I              IHH3ST                          WCH3ST
     I              IHH5ST                          WCH5ST
     I              IHH6ST                          WCH6ST
     I              IHH7ST                          WCH7ST
     I              IHUVST                          WCUVST
     I              IHUWST                          WCUWST
     I              IHUXST                          WCUXST
     I              IHAATM                          WCAATM
     I              IHAYNA                          WCAYNA
     I              IHA0NA                          WCA0NA
     I              IHAXDT                          WCAXDT
      *
     I@IMCPZ4
      * Order Detail Pricing      Upd Index for Work File
      * Renamed input format fields
     I              IMAIC3                          WDAIC3
     I              IMC4NB                          WDC4NB
     I              IMDPNB                          WDDPNB
     I              IMUENB                          WDUENB
     I              IMQ9CD                          WDQ9CD
     I              IMPDSQ                          WDPDSQ
     I              IMBNPR                          WDBNPR
     I              IMU6ST                          WDU6ST
     I              IMUVST                          WDUVST
     I              IMUWST                          WDUWST
     I              IMUXST                          WDUXST
     I              IMAATM                          WDAATM
     I              IMAYNA                          WDAYNA
     I              IMA0NA                          WDA0NA
     I              IMAXDT                          WDAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSPDIMCPL0
      * UPD : Order Detail Pricing      Update index
      * Current/previous master file format fields for change control
      *
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXTCK        DS
      * Time: hours, minutes, seconds
     I                                        1   60XTTIM
     I                                        1   20XTHH
     I                                        3   40XTNN
     I                                        5   60XTSS
      /EJECT
     IXDOFF       DS
      * Cut-off year
     I                                        1   40XOFF
     I                                        3   40XOFFYY
     IQPDIM1    E DSPDIMCPW0
      * UPD : Order Detail Pricing      Upd Index for Work File
      * Renamed input format fields
     I              IMAIC3                          WDAIC3
     I              IMC4NB                          WDC4NB
     I              IMDPNB                          WDDPNB
     I              IMUENB                          WDUENB
     I              IMQ9CD                          WDQ9CD
     I              IMPDSQ                          WDPDSQ
     I              IMBNPR                          WDBNPR
     I              IMU6ST                          WDU6ST
     I              IMUVST                          WDUVST
     I              IMUWST                          WDUWST
     I              IMUXST                          WDUXST
     I              IMAATM                          WDAATM
     I              IMAYNA                          WDAYNA
     I              IMA0NA                          WDA0NA
     I              IMAXDT                          WDAXDT
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Detail Pricing
      * I : RST Company Number
     I                                    P   1   20P1AIC3
      * I : RST Order Number
     I                                    P   3   60P1C4NB
      * I : RST Order Sequence Number
     I                                    P   7   80P1DPNB
      * I : RST Order Secondary Line Seq
     I                                    P   9  100P1UENB
     IP2PARM      DS
      * FLD: Order Header TRG
      * I :  Ship To Customer
     I                                    P   1   40P2BKC7
      * I :  Ship To Name
     I                                        5  34 P2BRTX
     IP3PARM      DS
      * FLD: Order Detail
      * N :  Item Code
     I                                    P   1   40P3HGCD
      * N :  Market Pricing Date
     I                                    P   5   80P3EXDT
      * N :  Commodity Market Code
     I                                        9  11 P3LQCD
      * N :  Date Method Code
     I                                       12  14 P3RDCD
      * N :  Price Method Code
     I                                       15  17 P3Q7CD
      * N :  Price Overage Override
     I                                    P  18  234P3BZPR
      * N :  Contract Number
     I                                    P  24  270P3L6NB
      * N :  Quantity Scheduled
     I                                    P  28  332P3CCQT
      * N :  Requested Ship Date
     I                                    P  34  370P3A5DT
     IP4PARM      DS
      * FLD: *Arrays
      * N :  First Time Flag
     I                                        1   1 P4TAST
     IP5PARM      DS
      * FLD: *Arrays
      * N :  USR Total Consumed Items
     I                                    P   1   62P5TSVA
      * N :  USR Muscle Yield Amt
     I                                    P   7  122P5TZVA
      * N :  Total Credit Dollars
     I                                    P  13  182P5Y0NB
      * N :  USR Formula Overages
     I                                    P  19  242P5T1VA
      * N :  USR Differential
     I                                    P  25  302P5TYVA
      * N :  USR Ship To Customer
     I                                    P  31  340P5BLC7
      * N :  Error Status
     I                                       35  35 P5ECST
      * N :  Error Return
     I                                       36  40 P5WZST
      * N :  Starting Product Price
     I                                    P  41  464P5CGPR
      * N :  Credit Value
     I                                    P  47  524P5CEPR
      * N :  Muscle Yield Price
     I                                    P  53  584P5CHPR
      * N :  Standard Overage/Underage
     I                                    P  59  644P5BMPR
      * N :  USR Cust/Item Differentl
     I                                    P  65  704P5COPR
     IP6PARM      DS
      * FLD: *Arrays
      * N :  Cntrt Enter no QT Price
     I                                        1   1 P6WDST
      * N :  Cntrt.# does not Exit
     I                                        2   2 P6WEST
      * N :  Qty ordered > Contract
     I                                        3   3 P6WFST
      * N :  Contract Expired
     I                                        4   4 P6WGST
      * N :  Price Override Required
     I                                        5   5 P6WHST
      * N :  Price Method QT & Cntrt 0
     I                                        6   6 P6WIST
      * N :  Prc Code FRM or MKT
     I                                        7   7 P6WJST
      * N :  Mkt Pricing Date not 0
     I                                        8   8 P6WKST
      * N :  Mkt Meth. and Date both
     I                                        9   9 P6WLST
      * N :  Price Override Req. EXT
     I                                       10  10 P6WMST
      * N :  Contract Exists for Item
     I                                       11  11 P6XSST
      * N :  Price Override not Allowd
     I                                       12  12 P6YXST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'CD7 Non numeric data'
      * Message data for 'CD7 Non numeric data'
      * Message data for 'Customer               NF'
      * Ship To Customer
     I                                        1   7 ZA0001
      * Message data for 'Company Item           NF'
      * Company Number CDE
     I                                    P   1   20ZA0002
      * Item Code Number 7.0  USR
     I                                    P   3   60ZA0003
      * Message data for 'Ship Date Must Be entered'
      * Requested Ship Date
     I                                    P   1   40ZA0004
      * Message data for 'Quantity must be entered'
      * Message data for 'Price Method invalid'
      * Price Method Code
     I                                        1   3 ZA0005
      * Message data for 'This item has a Contract'
      * Item Code
     I                                        1   7 ZA0006
      * Contract Number
     I                                    P   8  110ZA0007
      * Message data for 'OPP Contract Error'
      * Contract Number
     I                                    P   1   40ZA0008
      * Message data for 'Quantity Ordered > Contra'
      * Quantity Ordered
     I                                    P   1   62ZA0009
      * Contract Number
     I                                    P   7  100ZA0010
      * Message data for 'Contract Effective date'
      * Contract Number
     I                                    P   1   40ZA0011
      * Message data for 'Market Date Method Inval.'
      * Date Method Code
     I                                        1   3 ZA0012
      * Message data for 'Price Override Req. W/Man'
      * Price Method Code
     I                                        1   3 ZA0013
      * Price Overage Override
     I                                    P   4   94ZA0014
      * Message data for 'Price Override Req. w/EXT'
      * Price Method Code
     I                                        1   3 ZA0015
      * Price Overage Override
     I                                    P   4   94ZA0016
      * Message data for 'Price Override not allow'
      * Contract Price Override
     I                                    P   1   64ZA0017
      * Message data for 'Market Code must be enter'
      * Commodity Market Code
     I                                        1   3 ZA0018
      * Message data for 'Date Meth & Prc Dat N/A'
      * Market Pricing Date
     I                                    P   1   40ZA0019
      * Date Method Code
     I                                        5   7 ZA0020
      * Message data for 'Price Date Required'
      * Market Pricing Date
     I                                    P   1   40ZA0021
      * Message data for 'Error in Pricing Routine'
      * Market Pricing Date
     I                                    P   1   40ZA0022
      * Date Method Code
     I                                        5   7 ZA0023
      * Price Method Code
     I                                        8  10 ZA0024
      * Commodity Market Code
     I                                       11  13 ZA0025
      * Error Return
     I                                       14  18 ZA0026
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P1DPNB    PARM           WP0003  30       Order Sequence
     C           P1UENB    PARM           WP0004  30       Order Secondary
     C           P2BKC7    PARM           WP0005  70       Ship To Custome
     C           P2BRTX    PARM           WP0006 30        Ship To Name
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile header
      * RTV Company Name       RT - Company Name and Address  * 
     C                     EXSR SARVGN
      * First time processing
      * CASE: PAR.First Time Flag is Yes
     C           P4TAST    IFEQ 'Y'                        *IF
      * Populate Screen user fields/parms
     C                     EXSR UASUBR                     Populate Screen
     C                     MOVEL'N'       P4TAST           First Time Flag
     C                     END                             *FI
     C                     END
      *................................................................
      * Position file
     C           KPOS      KLIST
     C                     KFLD           IMAIC3           Company Number
     C                     KFLD           IMC4NB           Order Number
     C                     KFLD           IMDPNB           Order Sequence
     C                     KFLD           IMUENB           Order Secondary
     C                     KFLD           IMPDSQ           Price Detail Se
      * Setup key
     C                     Z-ADD#2AIC3    IMAIC3
     C                     Z-ADD#2C4NB    IMC4NB
     C                     Z-ADD#2DPNB    IMDPNB
     C                     Z-ADD#2UENB    IMUENB
     C                     Z-ADD#2PDSQ    IMPDSQ
      * 82=EOF
     C           KPOS      SETLL@IMPCZW0             82    *
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           IMAIC3           Company Number
     C                     KFLD           IMC4NB           Order Number
     C                     KFLD           IMDPNB           Order Sequence
     C                     KFLD           IMUENB           Order Secondary
      * Setup key
     C                     Z-ADD#2AIC3    IMAIC3
     C                     Z-ADD#2C4NB    IMC4NB
     C                     Z-ADD#2DPNB    IMDPNB
     C                     Z-ADD#2UENB    IMUENB
     C  N82      KRST      READE@IMPCZW0               9182*
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@IMPCZW0                 90*
     C  N82                READ @IMPCZW0                 90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  1
     C                     MOVE *ALL'1'   WKIND1  1
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,41
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * Load SFL fields
     C                     EXSR MBFL#1
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
      * Skip TCRDVY
      * CASE: DB1.Price Method Componant is TCRDVY
     C           IMQ9CD    IFEQ 'TCRDVY'                   *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * Skip components not part of Formula Pricing
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * VAL Check Existence    RT - PD Price Method Detail  * 
     C                     EXSR SDRVGN
      * Don't select components which are not part of Formula processing
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * Fill Description/field controlling whether Input or Output
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * RTV Description - PD Price Method Componant  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDIMAIC3    WL0001           Company Number
     C                     MOVELIMQ9CD    WL0002    P      Price Method Co
     C                     EXSR SERVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    #RMMNA    P      Price Componant
      * CASE: Component affected by formula details
      *  - c1 OR c2 OR c3 OR c4 OR c5
      *   |- c1    : DB1.Price Method Componant is STRITM
      *   |- c2    : DB1.Price Method Componant is SUBCRD
      *   |- c3    : DB1.Price Method Componant is MSCYLD
      *   |- c4    : DB1.Price Method Componant is TLCRDV
      *   |- c5    : DB1.Price Method Componant is TLCRDY
      *   '-
     C           IMQ9CD    IFEQ 'STRITM'                   *IF
     C           IMQ9CD    OREQ 'SUBCRD'                   *OR
     C           IMQ9CD    OREQ 'MSCYLD'                   *OR
     C           IMQ9CD    OREQ 'TLCRDV'                   *OR
     C           IMQ9CD    OREQ 'TLCRDY'                   *OR
     C                     MOVEL*BLANK    #RR4ST           USR Update Flag
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       #RR4ST           USR Update Flag
     C                     END                             *FI
     C                     END                             *FI
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * 82=EOF
     C           KRST      READE@IMPCZW0                 82*
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Convert fields to external form
     C  N30N27             EXSR MOCV#2
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Validate Ship To Customer and convert to internal.
      * CD7 Ext/Int
     C                     MOVELVCBKC7    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELVCBKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ 'USR0752'                  *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #CBKC7           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #CBKC7           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Requested Ship Date
      * External date
     C                     Z-ADDVCA5DT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDXDINDT    #CA5DT
      * Validate Item Code and convert to internal.
      * CD7 Ext/Int
     C                     MOVELVCHGCD    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELVCHGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ 'USR0752'                  *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #CHGCD           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #CHGCD           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      * Validate Market Pricing Date
      * External date
     C                     Z-ADDVCEXDT    XDEXDT
      * Check date
     C                     EXSR XDCK2
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9939  *
     C                     END
     C                     Z-ADDXDINDT    #CEXDT
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      *................................................................
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile control
      * Select Customer
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Ship To Customer
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ 'VCBKC7'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * 4/1/04 slm Add Shipped to Customer with selection on Customer nam
      * SEL Cust/ShpTo Flag 'Y'SR - Customer  * 
     C                     CALL 'PDYSSRR'              90  SEL Cust/ShpTo
     C                     PARM *BLANK    W0RTN   7
     C           #CBKC7    PARM #CBKC7    WQ0028  70       Ship To Custome
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDYSSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
     C                     END                             *FI
      * Select Item Code
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Item Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ 'VCHGCD'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL Actv Finished Good SR - Item  * 
     C                     CALL 'PDNHSRR'              90  SEL Actv Finish
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0029  30       Company Number
     C           #CHGCD    PARM #CHGCD    WQ0030  70       Item Code
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDNHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
     C                     END                             *FI
      * Select Price Method Code
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Price Method Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ '#CQ7CD'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL OMS System Only    SR - Price Method Header  * 
     C                     CALL 'PDZSSRR'              90  SEL OMS System
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0031  30       Company Number
     C           #CQ7CD    PARM #CQ7CD    WQ0032  3        Price Method Co
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDZSSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9936  *
     C                     END
     C                     END                             *FI
      * Select Date Method
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Date Method Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ '#CRDCD'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Sel Market Date Method SR - PD Market Date Method  * 
     C                     CALL 'PDKISRR'              90  Sel Market Date
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0033  30       Company Number
     C           #CRDCD    PARM *BLANK    WQ0034  3        Date Method Cod
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDKISRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9937  *
     C                     END
     C                     END                             *FI
      * Select Contract Number
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Contract Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ '#CL6NB'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL Item Contract Nbr  SR - OPP Item Contract  * 
     C                     CALL 'PDOFSRR'              90  SEL Item Contra
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0035  30       Company Number
     C           #CBKC7    PARM #CBKC7    WQ0036  70       Ship To Custome
     C           #CHGCD    PARM #CHGCD    WQ0037  70       Item Code
     C           #CEXDT    PARM #CEXDT    WQ0038  70       Effective Date
     C           #CL6NB    PARM *ZERO     WQ0039  70       Contract Number
     C           #CBZPR    PARM *ZERO     WQ0040 114       Contract Price
     C           #CEXDT    PARM *ZERO     WQ0041  70       Contract Mkt Pr
     C           #CRDCD    PARM *BLANK    WQ0042  3        Date Method Cod
     C           #CQ7CD    PARM *BLANK    WQ0043  3        Price Method Co
     C           #CLQCD    PARM *BLANK    WQ0044  3        Dft Commodity M
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDOFSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993133*
     C                     SETON                     393835*
     C                     SETON                     393736*
     C                     SETON                     40    *
     C                     END
     C                     END                             *FI
      * Select Commodity Market Code
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CTL.*CMD key is *Prompt
      *   |- c2    : PGM.*Cursor field <IS> CTL.Commodity Market Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           *IN04     IFEQ '1'                        *IF
     C           W0CFL     IFEQ '#CLQCD'                   *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * SEL Commod. Mkts Actve SR - OM Commodity Markets  * 
     C                     CALL 'PDEDSRR'              90  SEL Commod. Mkt
     C                     PARM *BLANK    W0RTN   7
     C           #CLQCD    PARM #CLQCD    WQ0045  3        Commodity Marke
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDEDSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9940  *
     C                     END
     C                     END                             *FI
     C                     MOVEL'N'       P5ECST           Error Status
      * CASE: Any Pricing field has changed
      *  - c1 OR c2 OR c3 OR c4 OR c5 OR c6 OR c7 OR c8
      *   |- c1    : PAR.Price Overage Override NE CTL.Price Overage Over
      *   |- c2    : PAR.Price Method Code NE CTL.Price Method Code
      *   |- c3    : PAR.Date Method Code NE CTL.Date Method Code
      *   |- c4    : PAR.Market Pricing Date NE CTL.Market Pricing Date
      *   |- c5    : PAR.Commodity Market Code NE CTL.Commodity Market Co
      *   |- c6    : PAR.Contract Number NE CTL.Contract Number
      *   |- c7    : PAR.Item Code NE CTL.Item Code
      *   |- c8    : PAR.USR Ship To Customer NE CTL.Ship To Customer
      *   '-
     C           P3BZPR    IFNE #CBZPR                     *IF
     C           P3Q7CD    ORNE #CQ7CD                     *OR
     C           P3RDCD    ORNE #CRDCD                     *OR
     C           P3EXDT    ORNE #CEXDT                     *OR
     C           P3LQCD    ORNE #CLQCD                     *OR
     C           P3L6NB    ORNE #CL6NB                     *OR
     C           P3HGCD    ORNE #CHGCD                     *OR
     C           P5BLC7    ORNE #CBKC7                     *OR
      * Get Customer name
      * CASE: PAR.Ship To Customer NE CTL.Ship To Customer
     C           P2BKC7    IFNE #CBKC7                     *IF
      * RTV Customer Name      RT - Customer  * 
     C                     EXSR SFRVGN
      * Error on return
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
      * Convert Ship To Customer to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CBKC7    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CBKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    ZA0001           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0001           CD7 Ext Numeric
     C                     END                             *FI
      * Send message 'Customer               NF'
     C                     MOVEL'USR0170' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     MOVEL*BLANK    P5WZST           Error Return
     C                     MOVEL'Y'       P5WZST           Error Return
     C                     END                             *FI
     C                     END                             *FI
      * Item Processing
      * CASE: PAR.Item Code NE CTL.Item Code
     C           P3HGCD    IFNE #CHGCD                     *IF
      * Rtv Descriptions      RT - Item  * 
     C                     EXSR SGRVGN
      * RTV for Ord.Detail     XF - /UT Inv. Interface Funcs  * 
     C                     CALL 'PDC3XFR'              90  RTV for Ord.Det
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0046  30       Company Number
     C                     PARM #CHGCD    WQ0047  70       Item Code
     C           WUG7NA    PARM *BLANK    WQ0048 30        Description Lin
     C           WUG8NA    PARM *BLANK    WQ0049 30        Description Lin
     C           #CAGCD    PARM *BLANK    WQ0050  2        U/M - Primary
     C           #CCRCD    PARM *BLANK    WQ0051  2        U/M - Pricing
     C           #CAVWG    PARM *ZERO     WQ0052 112       Unit Weight
     C           WUG0TX    PARM *BLANK    WQ0053  2        Item Level
     C           WUYTST    PARM *BLANK    WQ0054  1        Production Date
     C           WUG0TX    PARM *BLANK    WQ0055  1        Catch Weight St
     C           WUNFNN    PARM *ZERO     WQ0056  30       Item Structure
     C           WUNFNN    PARM *ZERO     WQ0057  30       Item Structure
     C           WUNFNN    PARM *ZERO     WQ0058  30       Item Structure
     C           WULNCD    PARM *BLANK    WQ0059  3        Default Commod
     C           WUNFNN    PARM *ZERO     WQ0060  30       Transportation
     C           WUN0CD    PARM *BLANK    WQ0061  3        Item Type Code
     C           WULRCD    PARM *BLANK    WQ0062  7        Commodity Price
     C           WUG0TX    PARM *BLANK    WQ0063  3        Default Warehou
     C           WUQ7CD    PARM *BLANK    WQ0064  3        Price Method De
     C           WUNFNN    PARM *ZERO     WQ0065  52       Fresh Chilling
     C           WUG0TX    PARM *BLANK    WQ0066  1        Variety/Rendere
     C           WUF5WG    PARM *ZERO     WQ0067 112       Item Target Pri
     C           WUECST    PARM *BLANK    WQ0068  1        Error Status
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDC3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
      * Not found error
      * CASE: WRK.Error Status is yes
     C           WUECST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADDWUATNB    ZA0002           Company Number
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CHGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CHGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    ZA0003           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0003           CD7 Ext Numeric
     C                     END                             *FI
      * Send message 'Company Item           NF'
     C                     MOVEL'USR0326' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Check that Item is Finished good.
      * CASE: WRK.Item Type Code is Not Finished Good
     C           WUN0CD    IFNE 'FG'                       *IF
      * Send message 'Item is not Finished Good'
     C                     MOVEL'USR1956' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     END                             *FI
      * Ship Date
      * CASE: CTL.Requested Ship Date is not entered
     C           #CA5DT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Convert Requested Ship Date to display format
      * Convert date
     C           1000000   ADD  #CA5DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0004
      * Send message 'Ship Date Must Be entered'
     C                     MOVEL'USR1435' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Quantity required
      * CASE: CTL.Quantity Allocated is Equal to zero
     C           #CCCQT    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Send message 'Quantity must be entered'
     C                     MOVEL'USR0578' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Price Method code
      * CASE: CTL.Price Method Code is Blank
     C           #CQ7CD    IFEQ *BLANK                     *IF
     C                     MOVELWUQ7CD    #CQ7CD           Price Method Co
     C                     END                             *FI
      * RTV Prc Mth Typ by Sys RT - Price Method Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#2AIC3    WL0004           Company Number
     C                     MOVEL#CQ7CD    WL0005    P      Price Method Co
     C                     MOVEL'O'       WL0007    P      System Using Pr
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    WUV8ST    P      Price Method Ty
      * Check return
      * CASE:
      *  - c1ORc2
      *   |- c1    : PGM.*Return code is *Normal
      *   |- c2    : CTL.Price Method Code is Deviated
      *   '-
     C           W0RTN     IFEQ *BLANK                     *IF
     C           #CQ7CD    OREQ 'DEV'                      *OR
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#CQ7CD    ZA0005           Price Method Co
      * Send message 'Price Method invalid'
     C                     MOVEL'USR1957' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * RTV Comod. Markt. Code RT - Customer  * 
     C                     EXSR SIRVGN
      * Check return
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Commodity Market Code
      * CASE:
      *  - c1 AND c3
      *   |- c1    : WRK.Price Method Type is Market or Formula
      *   |- c3    : CTL.Commodity Market Code is Not Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUV8ST    IFEQ 'F'                        *IF
     C           WUV8ST    OREQ 'K'
     C           #CLQCD    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVELWULQCD    #CLQCD           Commodity Marke
     C                     END                             *FI
      * Retrieve Contract Defaults
      * CASE: CTL.Contract Number is Entered
     C           #CL6NB    IFGT *ZERO                      *IF
      * RTV Contract Defaults  RT - OPP Item Contract  * 
     C                     EXSR SJRVGN
      * Check return
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADD#CL6NB    WUL6NB           Contract Number
      *
     C                     Z-ADD*ZERO     WN0001  70       Effective Date
     C                     Z-ADD*ZERO     WN0002  70       End Date Effect
     C                     Z-ADD*ZERO     WN0003 112       Maximum Quantit
     C                     Z-ADD*ZERO     WN0004 112       Quantity Sold
      *
      * EDT Order Detail Edits IF
     C                     MOVEL*BLANK    P6XSST           Contract Exists
     C                     MOVEL*BLANK    P6WDST           Cntrt Enter no
     C                     MOVEL*BLANK    P6WEST           Cntrt.# does no
     C                     MOVEL*BLANK    P6WFST           Qty ordered > C
     C                     MOVEL*BLANK    P6WGST           Contract Expire
     C                     MOVEL*BLANK    P6WHST           Price Override
     C                     MOVEL*BLANK    P6WIST           Price Method QT
     C                     MOVEL*BLANK    P6WJST           Prc Code FRM or
     C                     MOVEL*BLANK    P6WKST           Mkt Pricing Dat
     C                     MOVEL*BLANK    P6WLST           Mkt Meth. and D
     C                     MOVEL*BLANK    P6WMST           Price Override
     C                     MOVEL*BLANK    P6YXST           Price Override
      * Get Price Method Type
      * RTV Prc Mth Typ by Sys RT - Price Method Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#2AIC3    WL0004           Company Number
     C                     MOVEL#CQ7CD    WL0005    P      Price Method Co
     C                     MOVEL'O'       WL0007    P      System Using Pr
     C                     EXSR SHRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    WUV8ST    P      Price Method Ty
      * Check if Contract exists for Item
      * A Contract Exists for this customer and item.
      * CASE: PAR.Contract Number is Zero
     C           WUL6NB    IFEQ *ZERO                      *IF
      * RTV Edt for Existing   RT - OPP Item Contract  * 
     C                     EXSR SKRVGN
     C                     Z-ADDWUL6NB    WUL6NB           Contract Number
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       P6XSST           Contract Exists
     C                     END                             *FI
     C                     END                             *FI
      * Edit Contract Number
      * CASE: PAR.Contract Number is Entered
     C           WUL6NB    IFGT *ZERO                      *IF
      * RTV Val. Contract #    RT - OPP Item Contract  * 
     C                     EXSR SLRVGN
      * Set Contract Error Parms
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
     C                     MOVEL'Y'       P6WEST           Cntrt.# does no
     C                     ELSE
      * CASE: *OTHERWISE
     C           WN0004    ADD  #CCCQT    WUCAQT           Total Quantity
      * CASE: WRK.Total Quantity Ordered GT PAR.Maximum Quantity
     C           WUCAQT    IFGT WN0003                     *IF
     C                     MOVEL'Y'       P6WFST           Qty ordered > C
     C                     END                             *FI
      * CASE: PAR.End Date Effective LE PAR.Order Date
     C           WN0002    IFLE #CA5DT                     *IF
     C                     MOVEL'Y'       P6WGST           Contract Expire
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validity Checking
      * Price Override and Manual Price Method
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Price Method Type is Manual Pricing
      *   |- c2    : PAR.Price Overage Override is Equal zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUV8ST    IFEQ 'M'                        *IF
     C           #CBZPR    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       P6WHST           Price Override
     C                     END                             *FI
      * Price override and EXT price method
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Price Method Type is Extended Pricing
      *   |- c2    : PAR.Price Overage Override is Equal zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUV8ST    IFEQ 'X'                        *IF
     C           #CBZPR    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       P6WMST           Price Override
     C                     END                             *FI
      * FRM / MKT Checks
      * CASE: PAR.Price Method Type is Market or Formula
     C           WUV8ST    IFEQ 'F'                        *IF
     C           WUV8ST    OREQ 'K'
      * Market Code Must be entered
      * CASE: PAR.Commodity Market Code is Not Entered
     C           #CLQCD    IFEQ *BLANK                     *IF
     C                     MOVEL'Y'       P6WJST           Prc Code FRM or
     C                     END                             *FI
      * Market Price Date field not zero
      * CASE: PAR.Market Pricing Date is NE Zero
     C           #CEXDT    IFNE *ZERO                      *IF
     C                     MOVEL'Y'       P6WKST           Mkt Pricing Dat
     C                     END                             *FI
      * CASE: PAR.Price Overage Override is Not Zeros
     C           #CBZPR    IFNE *ZERO                      *IF
     C                     MOVEL'Y'       P6YXST           Price Override
     C                     END                             *FI
     C                     END                             *FI
      * MKT date Method entered and Mkt Price Date both entered.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Date Method Code is Entered
      *   |- c2    : PAR.Market Pricing Date is NE Zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #CRDCD    IFNE *BLANK                     *IF
     C           #CEXDT    IFNE *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       P6WLST           Mkt Meth. and D
     C                     END                             *FI
      * Contract exists for this item
      * CASE: PAR.Contract Exists for Item is yes
     C           P6XSST    IFEQ 'Y'                        *IF
      * Setup message data for message
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CHGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CHGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    ZA0006           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    ZA0006           CD7 Ext Numeric
     C                     END                             *FI
     C                     Z-ADDWUL6NB    ZA0007           Contract Number
      * Send message 'This item has a Contract'
     C                     MOVEL'USR1851' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      * Contract not found
      * CASE: PAR.Cntrt.# does not Exit is yes
     C           P6WEST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#CL6NB    ZA0008           Contract Number
      * Send message 'OPP Contract Error'
     C                     MOVEL'USR1803' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Quantity ordered exceeds contact quantity available
      * CASE: PAR.Qty ordered > Contract is yes
     C           P6WFST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#CCCQT    ZA0009           Quantity Schedu
     C                     Z-ADDWUL6NB    ZA0010           Contract Number
      * Send message 'Quantity Ordered > Contra'
     C                     MOVEL'USR1806' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      * Contract has passed expiration date
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Contract Expired is yes
      *   |- c2    : CTL.Contract Number is Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P6WGST    IFEQ 'Y'                        *IF
     C           #CL6NB    IFGT *ZERO                      *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Setup message data for message
     C                     Z-ADD#CL6NB    ZA0011           Contract Number
      * Send message 'Contract Effective date'
     C                     MOVEL'USR1810' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      * Date Method Code
      * CASE: CTL.Date Method Code NE WRK.BLANK
     C           #CRDCD    IFNE WUGSTX                     *IF
      * VAL Date Method Exists RT - PD Market Date Method  * 
     C                     EXSR SMRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#CRDCD    ZA0012           Date Method Cod
      * Send message 'Market Date Method Inval.'
     C                     MOVEL'USR2161' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Price Override required for MAN Price Code
      * CASE: PAR.Price Override Required is yes
     C           P6WHST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#CQ7CD    ZA0013           Price Method Co
     C                     Z-ADD#CBZPR    ZA0014           Price Overage O
      * Send message 'Price Override Req. W/Man'
     C                     MOVEL'USR1772' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993635*
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Price Override required when Price Method is EXT
      * CASE: PAR.Price Override Req. EXT is yes
     C           P6WMST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#CQ7CD    ZA0015           Price Method Co
     C                     Z-ADD#CBZPR    ZA0016           Price Overage O
      * Send message 'Price Override Req. w/EXT'
     C                     MOVEL'USR1774' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993635*
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Price Override not allowed for FRM or MKT
      * CASE: PAR.Price Override not Allowd is yes
     C           P6YXST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     Z-ADD#CBZPR    ZA0017           Price Overage O
      * Send message 'Price Override not allow'
     C                     MOVEL'USR1807' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     END                             *FI
      * Market code/prc date must be entered with FRM or MKT price code
      * CASE: PAR.Prc Code FRM or MKT is yes
     C           P6WJST    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#CLQCD    ZA0018           Commodity Marke
      * Send message 'Market Code must be enter'
     C                     MOVEL'USR1750' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     MOVEL'Y'       P5ECST           Error Status
     C                     END                             *FI
      * Date method/Pricing Date
      * CASE: PAR.Mkt Meth. and Date both is yes
     C           P6WLST    IFEQ 'Y'                        *IF
      * CASE: CTL.Date Method Code is Day Prior Ship
     C           #CRDCD    IFEQ 'DPS'                      *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
      * Convert Market Pricing Date to display format
      * Convert date
     C           1000000   ADD  #CEXDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0019
     C                     MOVEL#CRDCD    ZA0020           Date Method Cod
      * Send message 'Date Meth & Prc Dat N/A'
     C                     MOVEL'USR2097' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993937*
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: CTL.Date Method Code NE WRK.BLANK
     C           #CRDCD    IFNE WUGSTX                     *IF
     C                     ELSE
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Mkt Pricing Date not 0 is blank
      *   |- c2    : WRK.Price Method Type is Market or Formula
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P6WKST    IFEQ *BLANK                     *IF
     C           WUV8ST    IFEQ 'F'                        *IF
     C           WUV8ST    OREQ 'K'
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Setup message data for message
      * Convert Market Pricing Date to display format
      * Convert date
     C           1000000   ADD  #CEXDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0021
      * Send message 'Price Date Required'
     C                     MOVEL'USR1749' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Reset other price fields when price code is a Manual or Extended
      * CASE:
      *  - c1 OR c2
      *   |- c1    : WRK.Price Method Type is Manual Pricing
      *   |- c2    : WRK.Price Method Type is Extended Pricing
      *   '-
     C           WUV8ST    IFEQ 'M'                        *IF
     C           WUV8ST    OREQ 'X'                        *OR
     C                     MOVEL*BLANK    #CRDCD           Date Method Cod
     C                     Z-ADD*ZERO     #CEXDT           Market Pricing
     C                     END                             *FI
      * Process if no errors
      * CASE: PAR.Error Status is yes
     C           P5ECST    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CLC Price Item         XF - Price Method Header  * 
     C                     CALL 'PDG9XFR'              90  CLC Price Item
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1AIC3    WQ0069  30       Company Number
     C                     PARM #CQ7CD    WQ0070  3        Price Method Co
     C                     PARM #CBKC7    WQ0071  70       Ship To Custome
     C                     PARM *ZERO     WQ0072  70       Actual Shipped
     C                     PARM #CAGCD    WQ0073  2        U/M - Ordered
     C                     PARM #CCCQT    WQ0074 112       Quantity Ordere
     C                     PARM #CA5DT    WQ0075  70       Requested Ship
     C           #CAKPR    PARM #CAKPR    WQ0076 114       Unit Price
     C           #CAUPR    PARM #CAUPR    WQ0077 114       Unit Price Orde
     C                     PARM #CHGCD    WQ0078  70       Item Code
     C                     PARM #CA5DT    WQ0079  70       Date of Orig. E
     C                     PARM #CLQCD    WQ0080  3        Commodity Marke
     C                     PARM #CEXDT    WQ0081  70       Market Pricing
     C           #CU1ST    PARM #CU1ST    WQ0082  1        Price Status
     C                     PARM #CRDCD    WQ0083  3        Date Method Cod
     C                     PARM #CBZPR    WQ0084 114       Price Overage O
     C           WUGIDT    PARM WUGIDT    WQ0085  70       Pricing Date Us
     C                     PARM '**'      WQ0086  2        Event Called Fr
     C                     PARM #CDWPR    WQ0087 114       OD Ceiling Pric
     C                     PARM #CTKDT    WQ0088  70       OD Market Begin
     C                     PARM #CTLDT    WQ0089  70       OD Market Endin
     C                     PARM #2C4NB    WQ0090  70       Order Number
     C                     PARM #CEIDT    WQ0091  70       Requested Deliv
     C                     PARM #2DPNB    WQ0092  30       Order Sequence
     C                     PARM #2UENB    WQ0093  30       Order Secondary
     C           P5WZST    PARM P5WZST    WQ0094  5        Error Return
     C                     PARM 'S'       WQ0095  1        Price Type Stat
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG9XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993631*
     C                     SETON                     343233*
     C                     SETON                     324039*
     C                     SETON                     3735  *
     C                     END
      * CASE: PAR.Error Return is All Entered Values
     C           P5WZST    IFEQ 'CFR'                      *IF
     C           P5WZST    OREQ 'CID'
     C           P5WZST    OREQ 'CIF'
     C           P5WZST    OREQ 'CIO'
     C           P5WZST    OREQ 'QPE'
     C           P5WZST    OREQ 'EXT'
     C           P5WZST    OREQ 'XPE'
     C           P5WZST    OREQ 'FPE'
     C           P5WZST    OREQ 'IOM'
     C           P5WZST    OREQ 'IOV'
     C           P5WZST    OREQ 'MPE'
     C           P5WZST    OREQ 'KPE'
     C           P5WZST    OREQ 'MKT'
     C           P5WZST    OREQ 'MSC'
     C           P5WZST    OREQ 'OVR'
     C           P5WZST    OREQ 'STR'
     C           P5WZST    OREQ 'SUB'
     C           P5WZST    OREQ 'TRC'
     C           P5WZST    OREQ 'WPA'
     C           P5WZST    OREQ 'RWB'
     C           P5WZST    OREQ 'ITERR'
     C           P5WZST    OREQ 'CRD'
     C           P5WZST    OREQ 'MSL'
      * Setup message data for message
      * Convert Market Pricing Date to display format
      * Convert date
     C           1000000   ADD  #CEXDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    ZA0022
     C                     MOVEL#CRDCD    ZA0023           Date Method Cod
     C                     MOVEL#CQ7CD    ZA0024           Price Method Co
     C                     MOVEL#CLQCD    ZA0025           Commodity Marke
     C                     MOVELP5WZST    ZA0026           Error Return
      * Send message 'Error in Pricing Routine'
     C                     MOVEL'USR1850' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993937*
     C                     SETON                     3640  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C           #CAUPR    MULT #CCCQT    #CAYVA    H      Extended Amount
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      * Reset Parms
     C                     EXSR UBSUBR                     Reset Parms
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: CTL.Quantity Allocated NE PAR.Quantity Allocated
     C           #CCCQT    IFNE P3CCQT                     *IF
     C           #CAUPR    MULT #CCCQT    #CAYVA    H      Extended Amount
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     Z-ADD#CCCQT    P3CCQT           Quantity Schedu
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * USER: Process command keys
      * Formula Details
      * CASE: CTL.*CMD key is *Formula Details
     C           *IN22     IFEQ '1'                        *IF
      * RTV Price Meth Type    RT - PD Price Method Header  * 
     C                     EXSR SNRVGN
      * CASE: WRK.Price Method Type is Formula Pricing
     C           WUV8ST    IFEQ 'F'                        *IF
      * RTV Ship Pricing Totl  XF - PD Ship Detail Pricing  * 
     C                     CALL 'PDOMXFR'              90  RTV Ship Pricin
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0096  30       Company Number
     C                     PARM #2C4NB    WQ0097  70       Order Number
     C                     PARM #2DPNB    WQ0098  30       Order Sequence
     C                     PARM #2UENB    WQ0099  30       Order Secondary
     C           P5TSVA    PARM P5TSVA    WQ0100 112       USR Total Consu
     C           P5TZVA    PARM P5TZVA    WQ0101 112       USR Muscle Yiel
     C           P5Y0NB    PARM P5Y0NB    WQ0102 112       Total Credit Do
     C           P5T1VA    PARM P5T1VA    WQ0103 112       USR Formula Ove
     C           P5TYVA    PARM P5TYVA    WQ0104 112       USR Differentia
     C           P5CGPR    PARM P5CGPR    WQ0105 114       Starting Produc
     C           P5CEPR    PARM P5CEPR    WQ0106 114       Credit Value
     C           P5CHPR    PARM P5CHPR    WQ0107 114       Muscle Yield Pr
     C           P5BMPR    PARM P5BMPR    WQ0108 114       Standard Overag
     C           P5COPR    PARM P5COPR    WQ0109 114       USR Cust/Item D
     C                     PARM '**'      WQ0110  2        Event Called Fr
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDOMXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * EDT Price Simul Dtl WK EF - PD Ship Dtl Formula Dtl  * 
     C                     CALL 'PDOLEFR'              90  EDT Price Simul
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0111  30       Company Number
     C                     PARM #2C4NB    WQ0112  70       Order Number
     C                     PARM #2DPNB    WQ0113  30       Order Sequence
     C                     PARM #2UENB    WQ0114  30       Order Secondary
     C                     PARM #CHGCD    WQ0115  70       Item Code
     C                     PARM #CEXDT    WQ0116  70       Market Pricing
     C                     PARM #CRDCD    WQ0117  3        Date Method Cod
     C                     PARM #CQ7CD    WQ0118  3        Price Method Co
     C                     PARM #CAGCD    WQ0119  2        U/M - Ordered
     C                     PARM #CCCQT    WQ0120 112       Quantity Schedu
     C           #CAKPR    PARM #CAKPR    WQ0121 114       Unit Price
     C           WUALPR    PARM WUALPR    WQ0122 114       Unit Price - Cr
     C           #CAUPR    PARM #CAUPR    WQ0123 114       Unit Price Orde
     C                     PARM #CBKC7    WQ0124  70       Ship To Custome
     C                     PARM #CA5DT    WQ0125  70       Requested Ship
     C                     PARM #CAPTX    WQ0126 30        Company Name
     C           P5TSVA    PARM P5TSVA    WQ0127 112       USR Total Consu
     C           P5TZVA    PARM P5TZVA    WQ0128 112       USR Muscle Yiel
     C           P5Y0NB    PARM P5Y0NB    WQ0129 112       Total Credit Do
     C           P5T1VA    PARM P5T1VA    WQ0130 112       USR Formula Ove
     C           P5TYVA    PARM P5TYVA    WQ0131 112       USR Differentia
     C           P5CGPR    PARM P5CGPR    WQ0132 114       Starting Produc
     C           P5CEPR    PARM P5CEPR    WQ0133 114       Credit Value
     C           P5CHPR    PARM P5CHPR    WQ0134 114       Muscle Yield Pr
     C           P5BMPR    PARM P5BMPR    WQ0135 114       Standard Overag
     C           P5COPR    PARM P5COPR    WQ0136 114       USR Cust/Item D
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDOLEFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993339*
     C                     SETON                     373634*
     C                     SETON                     3132  *
     C                     END
      * CLC Pricing using File XF - PD Ship Detail Pricing  * 
     C                     CALL 'PDOJXFR'              90  CLC Pricing usi
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0137  30       Company Number
     C                     PARM #2C4NB    WQ0138  70       Order Number
     C                     PARM #2DPNB    WQ0139  30       Order Sequence
     C                     PARM #2UENB    WQ0140  30       Order Secondary
     C                     PARM #2PDSQ    WQ0141  30       Price Detail Se
     C                     PARM #CHGCD    WQ0142  70       Item Code
     C                     PARM #CQ7CD    WQ0143  3        Price Method Co
     C                     PARM #CAGCD    WQ0144  2        U/M - Ordered
     C           #CAKPR    PARM #CAKPR    WQ0145 114       Unit Price
     C           WUALPR    PARM WUALPR    WQ0146 114       Unit Price - Cr
     C           #CAUPR    PARM #CAUPR    WQ0147 114       Unit Price Orde
     C                     PARM '**'      WQ0148  2        Event Called Fr
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDOJXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993336*
     C                     END
     C           #CAUPR    MULT #CCCQT    #CAYVA    H      Extended Amount
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     ELSE
      * CASE: *OTHERWISE
      * Cmd key not allowed except for Formula pricing
      * Send message 'Function not available'
     C                     MOVEL'USR1942' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,41
      * No errors
     C                     SETOF                     98
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record fields
      * RTV Description - PD Price Method Componant  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#1AIC3    WL0001           Company Number
     C                     MOVEL#1Q9CD    WL0002    P      Price Method Co
     C                     EXSR SERVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    #RMMNA    P      Price Componant
     C                     END
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Price Method Componant
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C                     MOVEL'N'       W0RSF
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,41
     C                     SETOF                     98
      *
      * Process change request
     C                     EXSR EECHRQ
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     ELSE
      * USER: Extra processing after DBF update
      * CLC Pricing using File XF - PD Ship Detail Pricing  * 
     C                     CALL 'PDOJXFR'              90  CLC Pricing usi
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0151  30       Company Number
     C                     PARM #2C4NB    WQ0152  70       Order Number
     C                     PARM #2DPNB    WQ0153  30       Order Sequence
     C                     PARM #2UENB    WQ0154  30       Order Secondary
     C                     PARM #2PDSQ    WQ0155  30       Price Detail Se
     C                     PARM #CHGCD    WQ0156  70       Item Code
     C                     PARM #CQ7CD    WQ0157  3        Price Method Co
     C                     PARM #CAGCD    WQ0158  2        U/M - Ordered
     C           #CAKPR    PARM #CAKPR    WQ0159 114       Unit Price
     C           WUALPR    PARM WUALPR    WQ0160 114       Unit Price - Cr
     C           #CAUPR    PARM #CAUPR    WQ0161 114       Unit Price Orde
     C                     PARM '**'      WQ0162  2        Event Called Fr
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDOJXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983336*
     C                     END
     C           #CAUPR    MULT #CCCQT    #CAYVA    H      Extended Amount
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * CHG PD Shp Dtl Prc Wrk CH - Order Detail Pricing  * 
     C                     EXSR SOCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,41
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           #RR4ST    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     Z-ADDP1AIC3    #1AIC3           Company Number
     C                     Z-ADDP1C4NB    #1C4NB           Order Number
     C                     Z-ADDP1DPNB    #1DPNB           Order Sequence
     C                     Z-ADDP1UENB    #1UENB           Order Secondary
     C                     MOVEL*BLANK    #1Q9CD           Price Method Co
     C                     Z-ADD*ZERO     #1PDSQ           Price Detail Se
     C                     MOVEL*BLANK    #RR4ST           USR Update Flag
     C                     Z-ADD*ZERO     #RBFPR           Price
     C                     MOVEL*BLANK    #1U6ST           PD Status
     C                     MOVEL*BLANK    #1UVST           EDI Status 1
     C                     MOVEL*BLANK    #1UWST           EDI Status 2
     C                     MOVEL*BLANK    #1UXST           EDI Status 3
     C                     Z-ADD*ZERO     #1AATM           Job Time
     C                     MOVEL*BLANK    #1AYNA           User Id
     C                     MOVEL*BLANK    #1A0NA           Job Name
     C                     Z-ADD*ZERO     #1AXDT           Job Date
     C                     MOVEL*BLANK    #RMMNA           Price Componant
     C                     Z-ADD*ZERO     #1BNPR           Componant Price
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @IMPCZW0 fields to subfile
      *================================================================
     C                     Z-ADDIMAIC3    #1AIC3           Company Number
     C                     Z-ADDIMC4NB    #1C4NB           Order Number
     C                     Z-ADDIMDPNB    #1DPNB           Order Sequence
     C                     Z-ADDIMUENB    #1UENB           Order Secondary
     C                     MOVELIMQ9CD    #1Q9CD           Price Method Co
     C                     Z-ADDIMPDSQ    #1PDSQ           Price Detail Se
     C                     MOVELIMU6ST    #1U6ST           PD Status
     C                     MOVELIMUVST    #1UVST           EDI Status 1
     C                     MOVELIMUWST    #1UWST           EDI Status 2
     C                     MOVELIMUXST    #1UXST           EDI Status 3
     C                     Z-ADDIMAATM    #1AATM           Job Time
     C                     MOVELIMAYNA    #1AYNA           User Id
     C                     MOVELIMA0NA    #1A0NA           Job Name
     C                     Z-ADDIMAXDT    #1AXDT           Job Date
     C                     Z-ADDIMBNPR    #1BNPR           Componant Price
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADD*ZERO     #CDWPR           OD Ceiling Pric
     C                     Z-ADD*ZERO     #CTKDT           OD Market Begin
     C                     Z-ADD*ZERO     #CTLDT           OD Market Endin
     C                     Z-ADD*ZERO     #2PDSQ           Price Detail Se
     C                     Z-ADDP1AIC3    #2AIC3           Company Number
      * Clear external version also
     C                     MOVEL*BLANK    V2AIC3
     C                     MOVEL*BLANK    #CAPTX           Company Name
     C                     MOVEL*BLANK    #CU1ST           Price Status
     C                     Z-ADD*ZERO     #CBKC7           Ship To Custome
      * Clear external version also
     C                     MOVEL*BLANK    VCBKC7
     C                     MOVEL*BLANK    #CBRTX           Ship To Name
     C                     Z-ADD*ZERO     #CEIDT           Requested Deliv
      * Clear external version also
     C                     Z-ADD*ZERO     VCEIDT
     C                     Z-ADDP1C4NB    #2C4NB           Order Number
      * Clear external version also
     C                     MOVEL*BLANK    V2C4NB
     C                     Z-ADDP1DPNB    #2DPNB           Order Sequence
     C                     Z-ADDP1UENB    #2UENB           Order Secondary
     C                     Z-ADD*ZERO     #CA5DT           Requested Ship
      * Clear external version also
     C                     Z-ADD*ZERO     VCA5DT
     C                     Z-ADD*ZERO     #CHGCD           Item Code
      * Clear external version also
     C                     MOVEL*BLANK    VCHGCD
     C                     Z-ADD*ZERO     #CCCQT           Quantity Schedu
     C                     Z-ADD*ZERO     #CAKPR           Unit Price
     C                     MOVEL*BLANK    #CCRCD           U/M - Base Pric
     C                     MOVEL*BLANK    #CAVNA           Description Lin
     C                     Z-ADD*ZERO     #CAUPR           Unit Price Orde
     C                     MOVEL*BLANK    #CAGCD           U/M - Ordered
     C                     Z-ADD*ZERO     #CAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     #CAYVA           Extended Amount
     C                     Z-ADD*ZERO     #CBZPR           Price Overage O
     C                     MOVEL*BLANK    #CQ7CD           Price Method Co
     C                     Z-ADD*ZERO     #CBVTM           Price Code
     C                     MOVEL*BLANK    #CRDCD           Date Method Cod
     C                     Z-ADD*ZERO     #CL6NB           Contract Number
     C                     Z-ADD*ZERO     #CEXDT           Market Pricing
      * Clear external version also
     C                     Z-ADD*ZERO     VCEXDT
     C                     MOVEL*BLANK    #CLQCD           Commodity Marke
      * Check restriction within
     C                     EXSR VBCKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MOCV#2    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           #2AIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL#2AIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    V2AIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2AIC3           CD3 Ext Numeric
     C                     END                             *FI
      * Convert Ship To Customer to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CBKC7    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CBKC7    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VCBKC7           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VCBKC7           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Requested Delivery Date to display format
      * Convert date
     C           1000000   ADD  #CEIDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCEIDT
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #2C4NB    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#2C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V2C4NB           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2C4NB           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Requested Ship Date to display format
      * Convert date
     C           1000000   ADD  #CA5DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCA5DT
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CHGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CHGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VCHGCD           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VCHGCD           CD7 Ext Numeric
     C                     END                             *FI
      * Convert Market Pricing Date to display format
      * Convert date
     C           1000000   ADD  #CEXDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VCEXDT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Company Name       RT - Company Name and Address  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           ABAIC3           Company Number
      * Setup key
     C                     Z-ADDP1AIC3    ABAIC3           Company Number
      * Establish starting position
     C           KRSSA     CHAIN@ABREG3              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0003' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #CAPTX           Name
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELABADTX    #CAPTX           Name
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Pricing Info       RT - Order Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           OMAIC3           Company Number
     C                     KFLD           OMC4NB           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
      * Setup key
     C                     Z-ADDP1AIC3    OMAIC3           Company Number
     C                     Z-ADDP1C4NB    OMC4NB           Order Number
     C                     Z-ADDP1DPNB    OMDPNB           Order Sequence
     C                     Z-ADDP1UENB    OMUENB           Order Secondary
      * Establish starting position
     C           KRSSB     CHAIN@BGWKL1              90    *
      * Data record not found
     C   90                MOVEL'USR1309' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDOMHGCD    #CHGCD           Item Code
     C                     Z-ADDOMAYVA    #CAYVA           Extended Amount
     C                     Z-ADDOMEXDT    #CEXDT           Market Pricing
     C                     MOVELOMLQCD    #CLQCD           Commodity Marke
     C                     MOVELOMRDCD    #CRDCD           Date Method Cod
     C                     MOVELOMQ7CD    #CQ7CD           Price Method Co
     C                     Z-ADDOMBZPR    #CBZPR           Price Overage O
     C                     Z-ADDOML6NB    #CL6NB           Contract Number
     C                     MOVELOMCRCD    #CCRCD           U/M - Base Pric
     C                     MOVELOMAGCD    #CAGCD           U/M - Ordered
     C                     MOVELOMG7NA    #CAVNA           Order Desc. Lin
     C                     Z-ADDOMCCQT    #CCCQT           Quantity Schedu
     C                     Z-ADDOMAKPR    #CAKPR           Unit Price
     C                     Z-ADDOMAUPR    #CAUPR           Unit Price Orde
     C                     Z-ADDOMAVWG    #CAVWG           Unit Weight Ord
     C                     Z-ADDOMA5DT    #CA5DT           Requested Ship
     C                     Z-ADDOMBVTM    #CBVTM           Price Code
     C                     Z-ADDOMTKDT    #CTKDT           OD Market Begin
     C                     Z-ADDOMTLDT    #CTLDT           OD Market Endin
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Req Delv/Hdr Sts  RT - Order Header TRG  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEC4NB           Order Number
      * Setup key
     C                     Z-ADD#2AIC3    BEAIC3           Company Number
     C                     Z-ADD#2C4NB    BEC4NB           Order Number
      * Establish starting position
     C           KRSSC     CHAIN@BECPFK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBEGWST    WUGWST           Header Status
     C                     Z-ADDBEEIDT    #CEIDT           Requested Deliv
     C                     Z-ADDBEAFTM    WUAFTM           Requested Deliv
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * VAL Check Existence    RT - PD Price Method Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN IKAIC3    WQSD01           Company Number
     C           *LIKE     DEFN IKQ7CD    WQSD02           Price Method Co
     C           *LIKE     DEFN IKQ9CD    WQSD04           Price Method Co
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Price Method Co
     C                     KFLD           WQSD04           Price Method Co
      * Setup key
     C                     Z-ADD#2AIC3    WQSD01           Company Number
     C                     MOVEL#CQ7CD    WQSD02           Price Method Co
     C                     MOVELIMQ9CD    WQSD04           Price Method Co
      * Establish starting position
     C           KRSSD     SETLL@IKREL2                    *
     C           KRSSD     READE@IKREL2                  90*
      * Data record not found
     C   90                MOVEL'USR1671' W0RTN   7
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV Description - PD Price Method Componant  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           IJAIC3           Company Number
     C                     KFLD           IJQ9CD           Price Method Co
      * Setup key
     C                     Z-ADDWL0001    IJAIC3           Company Number
     C                     MOVELWL0002    IJQ9CD           Price Method Co
      * Establish starting position
     C           KRSSE     CHAIN@IJRER7              90    *
      * Data record not found
     C   90                MOVEL'USR1669' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELIJMMNA    WL0003           Price Componant
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV Customer Name      RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           BBBKC7           Ship To Custome
      * Setup key
     C                     Z-ADD#CBKC7    BBBKC7           Ship To Custome
      * Establish starting position
     C           KRSSF     CHAIN@BBREE9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0170' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #CBRTX           Customer Name
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBBAYTX    #CBRTX           Customer Name
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Descriptions      RT - Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           BZAIC3           Company Number
     C                     KFLD           BZHGCD           Item Code
      * Setup key
     C                     Z-ADD#2AIC3    BZAIC3           Company Number
     C                     Z-ADD#CHGCD    BZHGCD           Item Code
      * Establish starting position
     C           KRSSG     CHAIN@BZREJU              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0326' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBZAVNA    #CAVNA           Description Lin
     C                     MOVELBZAWNA    WUG0TX           Description Lin
     C                     MOVELBZADCD    WUG0TX           U/M - Primary
     C                     MOVELBZAECD    WUG0TX           U/M - Second
     C                     MOVELBZAFCD    WUG0TX           U/M - Third
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV Prc Mth Typ by Sys RT - Price Method Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN IHBYST    WQSH01           System Using Pr
     C           *LIKE     DEFN IHAIC3    WQSH02           Company Number
     C           *LIKE     DEFN IHQ7CD    WQSH03           Price Method Co
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           System Using Pr
     C                     KFLD           WQSH02           Company Number
     C                     KFLD           WQSH03           Price Method Co
      * Setup key
     C                     MOVELWL0007    WQSH01           System Using Pr
     C                     Z-ADDWL0004    WQSH02           Company Number
     C                     MOVELWL0005    WQSH03           Price Method Co
      * Establish starting position
     C           KRSSH     SETLL@IHREFI                    *
     C           KRSSH     READE@IHREFI                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1665' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0006           Price Method Ty
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELIHV8ST    WL0006           Price Method Ty
     C           KRSSH     READE@IHREFI                  90*
     C                     ENDDO
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * RTV Comod. Markt. Code RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WABKC7    WQSI01           Ship To Custome
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           Ship To Custome
      * Setup key
     C                     Z-ADD#CBKC7    WQSI01           Ship To Custome
      * Establish starting position
     C           KRSSI     SETLL@BBREU3                    *
     C           KRSSI     READE@BBREU3                  90*
      * Data record not found
     C   90                MOVEL'USR0170' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAAYTX    WUG0TX           Customer Name
     C                     MOVELWAKXCD    WUKXCD           Country Code
     C           KRSSI     READE@BBREU3                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * RTV Contract Defaults  RT - OPP Item Contract  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN CIL6NB    WQSJ01           Contract Number
     C           *LIKE     DEFN CIAIC3    WQSJ02           Company Number
     C           *LIKE     DEFN CIBKC7    WQSJ03           Ship To Custome
     C           *LIKE     DEFN CIHGCD    WQSJ04           Item Code
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           Contract Number
     C                     KFLD           WQSJ02           Company Number
     C                     KFLD           WQSJ03           Ship To Custome
     C                     KFLD           WQSJ04           Item Code
      * Setup key
     C                     Z-ADD#CL6NB    WQSJ01           Contract Number
     C                     Z-ADD#2AIC3    WQSJ02           Company Number
     C                     Z-ADD#CBKC7    WQSJ03           Ship To Custome
     C                     Z-ADD#CHGCD    WQSJ04           Item Code
      * Establish starting position
     C           KRSSJ     SETLL@CIREWO                    *
     C           KRSSJ     READE@CIREWO                  90*
      * Data record not found
     C   90                MOVEL'USR0463' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELCIAUNA    WUG0TX           Description
     C                     Z-ADDCIB0PR    #CBZPR           Contract Price
     C                     Z-ADDCIGBDT    #CEXDT           Contract Mkt Pr
     C                     MOVELCIRDCD    #CRDCD           Date Method Cod
     C                     MOVELCIQ7CD    #CQ7CD           Price Method Co
     C                     MOVELCIRQCD    #CLQCD           Dft Commodity M
     C           KRSSJ     READE@CIREWO                  90*
     C                     ENDDO
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * RTV Edt for Existing   RT - OPP Item Contract  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSK01           Company Number
     C           *LIKE     DEFN WBBKC7    WQSK02           Ship To Custome
     C           *LIKE     DEFN WBHGCD    WQSK03           Item Code
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Company Number
     C                     KFLD           WQSK02           Ship To Custome
     C                     KFLD           WQSK03           Item Code
      * Setup key
     C                     Z-ADD#2AIC3    WQSK01           Company Number
     C                     Z-ADD#CBKC7    WQSK02           Ship To Custome
     C                     Z-ADD#CHGCD    WQSK03           Item Code
      * Establish starting position
     C           KRSSK     SETLL@CIREWP                    *
     C           KRSSK     READE@CIREWP                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0463' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Effective Date GE DB1.Effective Date
      *   |- c2    : PAR.Effective Date LE DB1.End Date Effective
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #CA5DT    IFGE WBAUDT                     *IF
     C           #CA5DT    IFLE WBCWDT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     END                             *FI
     C                     Z-ADDWBL6NB    WUL6NB           Contract Number
     C           KRSSK     READE@CIREWP                  90*
     C                     ENDDO
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * RTV Val. Contract #    RT - OPP Item Contract  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN CIL6NB    WQSL01           Contract Number
     C           *LIKE     DEFN CIAIC3    WQSL02           Company Number
     C           *LIKE     DEFN CIBKC7    WQSL03           Ship To Custome
     C           *LIKE     DEFN CIHGCD    WQSL04           Item Code
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           WQSL01           Contract Number
     C                     KFLD           WQSL02           Company Number
     C                     KFLD           WQSL03           Ship To Custome
     C                     KFLD           WQSL04           Item Code
      * Setup key
     C                     Z-ADDWUL6NB    WQSL01           Contract Number
     C                     Z-ADD#2AIC3    WQSL02           Company Number
     C                     Z-ADD#CBKC7    WQSL03           Ship To Custome
     C                     Z-ADD#CHGCD    WQSL04           Item Code
      * Establish starting position
     C           KRSSL     SETLL@CIREWO                    *
     C           KRSSL     READE@CIREWO                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0463' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDCIAUDT    WN0001           Effective Date
     C                     Z-ADDCICWDT    WN0002           End Date Effect
     C                     Z-ADDCIDQQT    WN0003           Maximum Quantit
     C                     Z-ADDCIHFQT    WN0004           Quantity Sold
     C           KRSSL     READE@CIREWO                  90*
     C                     ENDDO
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * VAL Date Method Exists RT - PD Market Date Method  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN IPBXST    WQSM01           System using Da
     C           *LIKE     DEFN IPAIC3    WQSM02           Company Number
     C           *LIKE     DEFN IPRDCD    WQSM03           Date Method Cod
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           WQSM01           System using Da
     C                     KFLD           WQSM02           Company Number
     C                     KFLD           WQSM03           Date Method Cod
      * Setup key
     C                     MOVEL'O'       WQSM01           System using Da
     C                     Z-ADD#2AIC3    WQSM02           Company Number
     C                     MOVEL#CRDCD    WQSM03           Date Method Cod
      * Establish starting position
     C           KRSSM     SETLL@IPREFJ                    *
     C           KRSSM     READE@IPREFJ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1681' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUG0TX           Date Method Des
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SMEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELIPMNNA    WUG0TX           Date Method Des
     C           KRSSM     READE@IPREFJ                  90*
     C                     ENDDO
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * RTV Price Meth Type    RT - PD Price Method Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCQ7CD           Price Method Co
      * Setup key
     C                     Z-ADD#2AIC3    WCAIC3           Company Number
     C                     MOVEL#CQ7CD    WCQ7CD           Price Method Co
      * Establish starting position
     C           KRSSN     CHAIN@IHRERN              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1665' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUV8ST           Price Method Ty
     C                     GOTO SNEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCV8ST    WUV8ST           Price Method Ty
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SOCHRC    BEGSR
      *================================================================
      * CHG PD Shp Dtl Prc Wrk CH - Order Detail Pricing  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0005  60       Job Time
     C                     MOVEL*BLANK    WN0006 10        User Id
     C                     MOVEL*BLANK    WN0007 10        Job Name
     C                     Z-ADD*ZERO     WN0008  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @IMCPZ4
     C                     Z-ADD#1AIC3    WDAIC3           Company Number
     C                     Z-ADD#1C4NB    WDC4NB           Order Number
     C                     Z-ADD#1DPNB    WDDPNB           Order Sequence
     C                     Z-ADD#1UENB    WDUENB           Order Secondary
     C                     MOVEL#1Q9CD    WDQ9CD    P      Price Method Co
      *
     C           KLCHSO    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDC4NB           Order Number
     C                     KFLD           WDDPNB           Order Sequence
     C                     KFLD           WDUENB           Order Secondary
     C                     KFLD           WDQ9CD           Price Method Co
     C           KLCHSO    CHAIN@IMCPZ4              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDIMCPW0'MDACP
     C                     MOVEL'@IMCPZ4' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SOEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SOEXIT
     C                     ENDIF
      *
      * Move non-key fields to @IMCPZ4
     C                     Z-ADD#1PDSQ    WDPDSQ           Price Detail Se
     C                     Z-ADD#1BNPR    WDBNPR           Componant Price
     C                     MOVEL#1U6ST    WDU6ST    P      PD Status
     C                     MOVEL#1UVST    WDUVST    P      EDI Status 1
     C                     MOVEL#1UWST    WDUWST    P      EDI Status 2
     C                     MOVEL#1UXST    WDUXST    P      EDI Status 3
      *
     C                     UPDAT@IMCPZ4                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSP01           Application Cod
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSP01           Application Cod
     C                     MOVEL'OMS'     WQSP01           Application Cod
      * Establish starting position
     C           KRSSP     SETLL@DNRESF                    *
     C           KRSSP     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SQRVGN
     C                     END                             *FI
     C           KRSSP     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSQ01           Application Cod
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WQSQ01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSQ01           Application Cod
      * Establish starting position
     C           KRSSQ     SETLL@DNRESF                    *
     C           KRSSQ     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SQEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSQ     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Populate Screen user fields/parms
      *================================================================
     C                     Z-ADDP2BKC7    #CBKC7           Ship To Custome
     C                     MOVELP2BRTX    #CBRTX           Ship To Name
      * RTV Pricing Info       RT - Order Detail  * 
     C                     EXSR SBRVGN
      * CLC Price Item         XF - Price Method Header  * 
     C                     CALL 'PDG9XFR'              90  CLC Price Item
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #2AIC3    WQ0001  30       Company Number
     C                     PARM #CQ7CD    WQ0002  3        Price Method Co
     C                     PARM #CBKC7    WQ0003  70       Ship To Custome
     C                     PARM *ZERO     WQ0004  70       Actual Shipped
     C                     PARM #CAGCD    WQ0005  2        U/M - Ordered
     C                     PARM #CCCQT    WQ0006 112       Quantity Ordere
     C                     PARM #CA5DT    WQ0007  70       Requested Ship
     C           #CAKPR    PARM #CAKPR    WQ0008 114       Unit Price
     C           #CAUPR    PARM #CAUPR    WQ0009 114       Unit Price Orde
     C                     PARM #CHGCD    WQ0010  70       Item Code
     C                     PARM #CA5DT    WQ0011  70       Date of Orig. E
     C                     PARM #CLQCD    WQ0012  3        Commodity Marke
     C                     PARM #CEXDT    WQ0013  70       Market Pricing
     C           #CU1ST    PARM #CU1ST    WQ0014  1        Price Status
     C                     PARM #CRDCD    WQ0015  3        Date Method Cod
     C                     PARM #CBZPR    WQ0016 114       Price Overage O
     C           WUGIDT    PARM WUGIDT    WQ0017  70       Pricing Date Us
     C                     PARM '**'      WQ0018  2        Event Called Fr
     C                     PARM #CDWPR    WQ0019 114       OD Ceiling Pric
     C                     PARM #CTKDT    WQ0020  70       OD Market Begin
     C                     PARM #CTLDT    WQ0021  70       OD Market Endin
     C                     PARM #2C4NB    WQ0022  70       Order Number
     C                     PARM #CEIDT    WQ0023  70       Requested Deliv
     C                     PARM P1DPNB    WQ0024  30       Order Sequence
     C                     PARM P1UENB    WQ0025  30       Order Secondary
     C           WUWZST    PARM WUWZST    WQ0026  5        Error Return
     C                     PARM 'S'       WQ0027  1        Price Type Stat
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDG9XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     993631*
     C                     SETON                     343233*
     C                     SETON                     324039*
     C                     SETON                     3735  *
     C                     END
      * RTV Req Delv/Hdr Sts  RT - Order Header TRG  * 
     C                     EXSR SCRVGN
     C                     Z-ADD#CBKC7    P5BLC7           USR Ship To Cus
     C                     Z-ADD#CHGCD    P3HGCD           Item Code
     C                     Z-ADD#CA5DT    P3A5DT           Requested Ship
     C                     Z-ADD#CCCQT    P3CCQT           Quantity Schedu
     C                     Z-ADD#CBZPR    P3BZPR           Price Overage O
     C                     MOVEL#CQ7CD    P3Q7CD           Price Method Co
     C                     MOVEL#CRDCD    P3RDCD           Date Method Cod
     C                     Z-ADD#CL6NB    P3L6NB           Contract Number
     C                     Z-ADD#CEXDT    P3EXDT           Market Pricing
     C                     MOVEL#CLQCD    P3LQCD           Commodity Marke
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Reset Parms
      *================================================================
     C                     Z-ADD#CBKC7    P5BLC7           USR Ship To Cus
     C                     Z-ADD#CHGCD    P3HGCD           Item Code
     C                     Z-ADD#CA5DT    P3A5DT           Requested Ship
     C                     Z-ADD#CCCQT    P3CCQT           Quantity Schedu
     C                     Z-ADD#CBZPR    P3BZPR           Price Overage O
     C                     MOVEL#CQ7CD    P3Q7CD           Price Method Co
     C                     MOVEL#CRDCD    P3RDCD           Date Method Cod
     C                     Z-ADD#CL6NB    P3L6NB           Contract Number
     C                     Z-ADD#CEXDT    P3EXDT           Market Pricing
     C                     MOVEL#CLQCD    P3LQCD           Commodity Marke
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Price Method Componant
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1Q9CD    WK1X02  1
     C           WK1X02    IFEQ '?'                        Price Method Co
     C           YPMTFD    OREQ '#1Q9CD'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1AIC3' defaulted for 'Company Number'.
      * Field '(RCD) #1Q9CD' defaulted for 'Price Method Componant'.
     C                     CALL 'PDZHSRR'              90  SEL PD Price Me
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0149  30       Company Number
     C           #1Q9CD    PARM #1Q9CD    WQ0150  6        Price Method Co
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDZHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      *
     C           #1Q9CD    IFNE *BLANK                     Price Method Co
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1Q9CD    IFEQ *BLANK                     Price Method Co
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAIJ    KLIST
     C                     KFLD           IJAIC3           Company Number
     C                     KFLD           IJQ9CD           Price Method Co
      * Setup key
     C                     Z-ADD#1AIC3    IJAIC3
     C                     MOVEL#1Q9CD    IJQ9CD
     C           KLVAIJ    CHAIN@IJRER7              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Price Method Componant NF'
     C                     MOVEL'USR1669' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1669' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVELV2AIC3    WK1X01  1
     C                     MOVELV2C4NB    WK1X02  1
     C           WK1X01    IFEQ '?'                        Company Number
     C           YPMTFD    OREQ '#2AIC3'
     C           WK1X02    OREQ '?'                        Order Number
     C           YPMTFD    OREQ '#2C4NB'
     C           YPMTFD    OREQ '#2DPNB'
     C           YPMTFD    OREQ '#2UENB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #2AIC3' defaulted for 'Company Number'.
      * Field '(CTL) #2C4NB' defaulted for 'Order Number'.
      * Field '(CTL) #2DPNB' defaulted for 'Order Sequence Number'.
      * Field '(CTL) #2UENB' defaulted for 'Order Secondary Line Seq'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #CHGCD' defaulted for 'Item Code'.
      * Field '(CTL) #CBZPR' defaulted for 'Price Overage Override'.
     W* Y2W0052 - One or more arguments defaulted to WRK/CON context.
      * Field '(LCL) YL0001' defaulted for 'Record Selected       USR'.
     C                     CALL 'POKJSRR'              90  Sel Item f/Pric
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0163  30       Company Number
     C           #2C4NB    PARM #2C4NB    WQ0164  70       Order Number
     C           #2DPNB    PARM *ZERO     WQ0165  30       Order Sequence
     C           #2UENB    PARM *ZERO     WQ0166  30       Order Secondary
     C           #CHGCD    PARM #CHGCD    WQ0167  70       Item Code
     C           #CBZPR    PARM *ZERO     WQ0168 114       Price Overage O
     C           YL0001    PARM YL0001    WQ0169  1        Record Selected
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'POKJSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     993335*
     C                     END
      *
     C           #2AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2C4NB    IFNE *ZERO                      Order Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2DPNB    IFNE *ZERO                      Order Sequence
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #2UENB    IFNE *ZERO                      Order Secondary
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VB999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVBOM    KLIST
     C                     KFLD           OMAIC3           Company Number
     C                     KFLD           OMC4NB           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
      * Setup key
     C                     Z-ADD#2AIC3    OMAIC3
     C                     Z-ADD#2C4NB    OMC4NB
     C                     Z-ADD#2DPNB    OMDPNB
     C                     Z-ADD#2UENB    OMUENB
     C           KLVBOM    CHAIN@BGWKL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
     C           VB999     TAG
      * Restrictor relation not satisfied
      * Send message 'Order Detail           NF'
     C                     MOVEL'USR1309' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'USR1309' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         XDCK2     BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
     C                     Z-ADD*ZERO     XDINDT
      * If external date is zero, do not check
     C           XDEXDT    CABEQ*ZERO     XDCK2E
      *................................................................
      * Map external to internal according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDEX02    XDINDD           DD
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDEX02    XDINMM           MM
     C                     Z-ADDXDEX03    XDINDD           DD
     C                     Z-ADDXDEX04    XDINYY           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDEX02    XDINYY           YY
     C                     Z-ADDXDEX03    XDINMM           MM
     C                     Z-ADDXDEX04    XDINDD           DD
     C                     END
     C                     END
      * If YY prior to the 'cut-off' year treat as 20YY.
     C           XDINYY    IFLT XOFFYY
     C                     ADD  100       XDINYY
     C                     END
     C           YPMTFD    CABNE*BLANK    XDCK2E
      *................................................................
      * Check months in range 1 to 12
     C           XDINMM    CABLT1         XDCK2M
     C           XDINMM    CABGT12        XDCK2M
      *................................................................
      * Check days in range 1 to maximum for month
     C           XDINDD    CABLT1         XDCK2M
     C           XDINDD    CABGT@XD,XDINMMXDCK2M
      *................................................................
      * Special case: leap year
     C           XDINMM    IFEQ 2
     C           XDINYY    IFNE *ZERO
     C           XDINYY    ANDNE200
     C           XDINYY    DIV  4         XDWK1   80
     C                     MVR            XDWK1
     C                     ELSE
     C                     Z-ADD1         XDWK1
     C                     END
      * Year is not leap
     C           XDWK1     IFNE *ZERO
     C           XDINDD    CABGT28        XDCK2M
     C                     END
     C                     END
     C                     GOTO XDCK2E
      *................................................................
      * Send error message
     C           XDCK2M    TAG
      * Send message '*Invalid date'
     C                     MOVEL'Y2U0006' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0006' W0RTN
      * Disable time portion if timestamp is validated
     C                     Z-ADD*ZERO     XTTIM
      *================================================================
     CSR         XDCK2E    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C           ZINPOS    IFGE 03584
     C           ZINPOS    ANDLE05632
      * Cursor in the subfile record area
      * Reset cursor position to the basic (first) record for lookup
     C           W0CRW     SUB  14        W0CSRR  50
     C           03584     ADD  W0CCL     ZINPOS
      * Calculate rrn of the cursor position
     C                     ADD  ##SFRC    W0CSRR
     C                     ENDIF
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     ENDIF
     C           W0CFL     IFEQ *BLANK
     C                     Z-ADD0         W0CSRR
     C                     ENDIF
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD14        ZHSTRW  40
     C                     Z-ADD21        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P3HGCD           Item Code
     C                     Z-ADD*ZERO     P3EXDT           Market Pricing
     C                     MOVEL*BLANK    P3LQCD           Commodity Marke
     C                     MOVEL*BLANK    P3RDCD           Date Method Cod
     C                     MOVEL*BLANK    P3Q7CD           Price Method Co
     C                     Z-ADD*ZERO     P3BZPR           Price Overage O
     C                     Z-ADD*ZERO     P3L6NB           Contract Number
     C                     Z-ADD*ZERO     P3CCQT           Quantity Schedu
     C                     Z-ADD*ZERO     P3A5DT           Requested Ship
     C                     MOVEL*BLANK    P4TAST           First Time Flag
     C                     Z-ADD*ZERO     P5TSVA           USR Total Consu
     C                     Z-ADD*ZERO     P5TZVA           USR Muscle Yiel
     C                     Z-ADD*ZERO     P5Y0NB           Total Credit Do
     C                     Z-ADD*ZERO     P5T1VA           USR Formula Ove
     C                     Z-ADD*ZERO     P5TYVA           USR Differentia
     C                     Z-ADD*ZERO     P5BLC7           USR Ship To Cus
     C                     MOVEL*BLANK    P5ECST           Error Status
     C                     MOVEL*BLANK    P5WZST           Error Return
     C                     Z-ADD*ZERO     P5CGPR           Starting Produc
     C                     Z-ADD*ZERO     P5CEPR           Credit Value
     C                     Z-ADD*ZERO     P5CHPR           Muscle Yield Pr
     C                     Z-ADD*ZERO     P5BMPR           Standard Overag
     C                     Z-ADD*ZERO     P5COPR           USR Cust/Item D
     C                     MOVEL*BLANK    P6WDST           Cntrt Enter no
     C                     MOVEL*BLANK    P6WEST           Cntrt.# does no
     C                     MOVEL*BLANK    P6WFST           Qty ordered > C
     C                     MOVEL*BLANK    P6WGST           Contract Expire
     C                     MOVEL*BLANK    P6WHST           Price Override
     C                     MOVEL*BLANK    P6WIST           Price Method QT
     C                     MOVEL*BLANK    P6WJST           Prc Code FRM or
     C                     MOVEL*BLANK    P6WKST           Mkt Pricing Dat
     C                     MOVEL*BLANK    P6WLST           Mkt Meth. and D
     C                     MOVEL*BLANK    P6WMST           Price Override
     C                     MOVEL*BLANK    P6XSST           Contract Exists
     C                     MOVEL*BLANK    P6YXST           Price Override
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Pricing Date Used
     C                     Z-ADD*ZERO     WUGIDT  70
      * Define work field Error Return
     C                     MOVEL*BLANK    WUWZST  5
      * Define work field Header Status
     C                     MOVEL*BLANK    WUGWST  1
      * Define work field Requested Delivery Time
     C                     Z-ADD*ZERO     WUAFTM  40
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field TXT field not needed
     C                     MOVEL*BLANK    WUG0TX 20
      * Define work field Order Desc. Line One
     C                     MOVEL*BLANK    WUG7NA 30
      * Define work field Order Desc. Line Two
     C                     MOVEL*BLANK    WUG8NA 30
      * Define work field STS field not needed
     C                     MOVEL*BLANK    WUYTST  4
      * Define work field Numeric Field Not Needed
     C                     Z-ADD*ZERO     WUNFNN  70
      * Define work field Default Commod Mark basis
     C                     MOVEL*BLANK    WULNCD  3
      * Define work field Item Type Code
     C                     MOVEL*BLANK    WUN0CD  3
      * Define work field Commodity Price Group
     C                     MOVEL*BLANK    WULRCD  7
      * Define work field Price Method Code
     C                     MOVEL*BLANK    WUQ7CD  3
      * Define work field Item Target Price
     C                     Z-ADD*ZERO     WUF5WG 112
      * Define work field Error Status
     C                     MOVEL*BLANK    WUECST  1
      * Define work field Company Number CDE
     C                     Z-ADD*ZERO     WUATNB  30
      * Define work field Price Method Type
     C                     MOVEL*BLANK    WUV8ST  1
      * Define work field Country Code
     C                     MOVEL*BLANK    WUKXCD  6
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAP3NB           D & B Number
     C                     Z-ADD*ZERO     WAI6DT           Date of D & B R
     C                     Z-ADD*ZERO     WAAYDT           Credit Line Exp
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABTC7           Parent Customer
     C                     Z-ADD*ZERO     WAS2NB           Parent Credit L
     C                     Z-ADD*ZERO     WAVHVA           A/R Credit Limi
     C                     Z-ADD*ZERO     WAI7DT           Order Entry Hol
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field Commodity Market Code
     C                     MOVEL*BLANK    WULQCD  3
      * Define work field Contract Number
     C                     Z-ADD*ZERO     WUL6NB  70
      * Define work field Warehouse Code
     C                     MOVEL*BLANK    WUAJCD  3
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBHGCD           Item Code
     C                     Z-ADD*ZERO     WBAUDT           Effective Date
     C                     Z-ADD*ZERO     WBCWDT           End Date Effect
     C                     Z-ADD*ZERO     WBANDT           Date of Last Sh
     C                     Z-ADD*ZERO     WBDQQT           Maximum Quantit
     C                     Z-ADD*ZERO     WBHFQT           Quantity Sold
     C                     Z-ADD*ZERO     WBL6NB           Contract Number
     C                     Z-ADD*ZERO     WBFSQT           Open Commitment
     C                     Z-ADD*ZERO     WBB0PR           Contract Price
     C                     Z-ADD*ZERO     WBGBDT           Contract Mkt Pr
     C                     Z-ADD*ZERO     WBGCDT           Entered Date
     C                     Z-ADD*ZERO     WBGDDT           Date Sold
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Define work field Total Quantity Ordered
     C                     Z-ADD*ZERO     WUCAQT 112
      * Define work field BLANK
     C                     MOVEL*BLANK    WUGSTX256
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCRMNY           Decimal Places
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Define work field Unit Price - Credit
     C                     Z-ADD*ZERO     WUALPR 114
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDPDSQ           Price Detail Se
     C                     Z-ADD*ZERO     WDBNPR           Componant Price
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'Y'       W0PMT   1
      * Define local variables for subroutine SERVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     MOVEL*BLANK    WL0002  6
     C                     MOVEL*BLANK    WL0003 30
      * Define local variables for subroutine SHRVGN.
     C                     Z-ADD*ZERO     WL0004  30
     C                     MOVEL*BLANK    WL0005  3
     C                     MOVEL*BLANK    WL0006  1
     C                     MOVEL*BLANK    WL0007  1
      * Define local work field Record Selected       USR
     C                     MOVEL*BLANK    YL0001  1
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * Retrieve the 'cut-off' year YY: 19YY-1999,2000-20(YY-1).
     C           *NAMVAR   DEFN Y2CTOFF   XOFF
     C                     IN   XOFF
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      *
     C                     Z-ADD08        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD000000500 W0SLM   90
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * VAL Rtv and Center Hdg IF
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SPRVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
     C                     MOVEL'Y'       P4TAST           First Time Flag
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
** @XD
312931303130313130313031
** W0BEG
01043010530109801299013090135201555
01574015880160801811018250185201869
02050021080212502319023640257702600
02617026320283502866028910359003622
** W0END
01045010820109801305013380135901561
01576015900161501817018370186301870
02079021190212602331023760258802602
02622026340284102871028930361903634
** W0NAM
V2AIC3    #CAPTX    #CU1ST    VCBKC7    #CBRTX    VCEIDT    V2C4NB
#2DPNB    #2UENB    VCA5DT    VCHGCD    #CCCQT    #CAKPR    #CCRCD
#CAVNA    #CAUPR    #CAGCD    #CAVWG    #CAYVA    #CBZPR    #CQ7CD
#CBVTM    #CRDCD    #CL6NB    VCEXDT    #CLQCD    #RMMNA    #1BNPR
