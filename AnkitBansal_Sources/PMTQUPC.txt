/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  HPB - RFS REPORT DRIVER TO CREATE THE SELECTED      */
/*              RFS REPORT AND EMAIL THE DATA TO THE USER           */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - CLP RFS REPORT DRIVER UP       (CL)      PMTQUPC    */
/*  DATE      - 04/01/08                                            */
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     O    &RETURN     - RETURN CODE                               */
/*     I    &COMPYN     -  COMPANY                              */
/*     I    &RPTTYP     -  O=ORIGINAL, R=RESUBMISSION               */
/*     I    &RPTYR      -  COMPLIANCE YEAR - 4A                     */
/*     I    &RPTPER     -  COMPLIANCE PERIOD - Q1,Q2,Q3,Q4,         */
/*     I    &EMAIL      -  EMAIL ADDR FOR SQL STMT RECIPIENT       */
/********************************************************************/
/* RMC  5/20/10  C0774- Q1 REPORTS -FIX SEQUEL STMT FOR RFS0400     */
/* RMC  8/11/10  E0921- RFS2 NEW REPORTS   RFS0700, RFS0900         */
/* RMC  9/28/10  E0921- RFS2 NEW FIELDS FOR RFS0101                 */
/* RMC  4/26/11  E01510- RFS2 NEW FIELDS FOR RFS0101-> NOW RFSA101     */
/*                       RFS2 NEW FIELDS FOR RFS0700-> NOW RFS0701     */
/* RMC  11/9/11  C01805- RFS2 NEW FIELDS FOR RFSA101-> NOW RFS0102     */
/*                        FIELDS ARE CREATED IN THE SEQUEL WITH "NA"   */
/* RMC  3/23/12  E02013- RFS2 NEW FIELDS FOR RFS0102-> NOW RFS0103     */
/* RMC  8/08/12  E02218- RFS2 NEW FIELDS FOR RFS0104-> REPLACED RFS0103*/
/********************************************************************/
 PMTQUPC:    PGM        PARM(&RETURN &RPTTYP &RPTYR &COMPID &RPTPER &RPTSEL +
                  &RFSPCT &COMPYN &EMAIL)
/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */
        DCL    &RPTSEL     *CHAR   (1)          /*  SELECTED REPORT           */
        DCL    &RFSPCT     *DEC    (5 2)        /*  RFS PERCENT               */
        DCL    &COMPYN     *DEC                  /* COMPANY                   */
        DCL    &RPTTYP     *CHAR   (1)          /*  ORIGINAL OR RESUBMISSION */
        DCL    &RPTYR      *CHAR   (4)          /*  COMPLIANCE YEAR-4 POS.  */
        DCL    &RPTPER     *CHAR   (2)          /*  COMPLIANCE PERIOD         */
        DCL    &COMPID     *CHAR   (4)          /*  ULSD COMPANY ID   */
        DCL    &EMAIL      *CHAR   (50)          /* EMAIL                     */

        DCL    &COMP       *DEC  (3 0)          /* COMPANY DEC             */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)

             CHGJOB     LOG(4 99 *SECLVL)

             CHGVAR     VAR(&COMP) VALUE(&COMPYN)
/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

/********************************************************************/
/*   CALL THE SYNON PGM TO CREATE THE FILE SELECTED AND EMAIL IT    */
/********************************************************************/

/*---------- RFS0101   RFS ACTIVITY REPORT ( QUARTERLY )  -------- */

RFSA101:     IF         COND(&RPTSEL *EQ '1') THEN(DO)
             CALL       PGM(PMTJXFR) PARM(&RETURN &COMP &RPTTYP &RPTYR +
                 &COMPID  &RPTPER)
 /*          EXECUTE    VIEW(RFSA101) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFSA101 RIN Activity Report') +     */
/*           EXECUTE    VIEW(RFS0103) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0103 RIN Activity Report') +
                 SETVAR((&YEAR &RPTYR) (&PERIOD &RPTPER) (&COMPID &COMPID))  */
             EXECUTE    VIEW(RFS0104) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0104 RIN Activity Report') +
                 SETVAR((&YEAR &RPTYR) (&PERIOD &RPTPER) (&COMPID &COMPID))
             ENDDO

/*---------- RFS0201   RFS RIN TRANSACTION RPT ( QUARTERLY )  -------- */

RFS0201:     IF         COND(&RPTSEL *EQ '2') THEN(DO)
             CALL       PGM(PMTHXFR) PARM(&RETURN &COMP &RPTTYP +
                          &RPTYR &COMPID &RPTPER)
             EXECUTE    VIEW(RFS0201) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0201 RIN Transaction Report') +
         SETVAR((&YEAR &RPTYR) (&PERIOD &RPTPER) (&COMPID &COMPID))
             ENDDO

/*---------- RFS0300   RFS ANNUAL COMPLIANCE RPT ( ANNUALLY )  -------- */

RFS0300:     IF         COND(&RPTSEL *EQ '3') THEN(DO)
             CALL       PGM(PMTRXFR) PARM(&RETURN &COMP &RPTTYP &RPTYR +
                  &RFSPCT)
             EXECUTE    VIEW(RFS0300) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0300 Annual Compliance +
                          Report') SETVAR((&YEAR &RPTYR))
             ENDDO

/*---------- RFS0400   RFS RIN GENERATION RPT ( QUARTERLY )  -------- */

RFS0400:     IF         COND(&RPTSEL *EQ '4') THEN(DO)
             CALL       PGM(PMTGXFR) PARM(&RETURN &COMP &RPTTYP +
                          &RPTYR &COMPID &RPTPER)
             EXECUTE    VIEW(RFS0400) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0400 RIN Generation Report') +
             SETVAR((&YEAR &RPTYR) (&PERIOD &RPTPER) (&COMPID &COMPID))
             ENDDO

/*---------- RFS0700   RFS2 CO PRODUCT REPORT (QUARTERLY )  ----------- */
     /* RFSA101 MUST EXIST ALREADY FOR THIS TO WORK  */
RFS0701:     IF         COND(&RPTSEL *EQ '5') THEN(DO)
             EXECUTE    VIEW(RFS0701) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0701 Co-Product Report') +
                          SETVAR((&YEAR &RPTYR) (&PERIOD &RPTPER) +
                          (&COMPID &COMPID))
             ENDDO


/*---------- RFS0900   RFS2 ANNUAL PRODUCTION OUTLOOK REPORT ---------- */
     /* RFSA101 MUST EXIST ALREADY FOR THIS TO WORK  */
   /* READ 2 RCDS FROM PMDRCPP: MAKE THE 4846 RCD A 4846 VOL INFO RCD  */
   /*  AND MAKE THE 3384 RCD A 4846 RIN INFO RCD  */
RFS0900:     IF         COND(&RPTSEL *EQ '6') THEN(DO)
             EXECUTE    VIEW(RFS0900) PCFMT(*XLS) RECIPIENT(&EMAIL) +
                          EMLMSG('RFS0900 Production Outlook +
                          Report') SETVAR((&YEAR &RPTYR) (&PERIOD +
                          &RPTPER))
             ENDDO

             GOTO       CMDLBL(END)

/*-------------------------USER QUIT--------------------------------*/
 USERQUIT:   CHGVAR     VAR(&RETURN) VALUE('Y2U0005')
             GOTO       CMDLBL(END)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM

