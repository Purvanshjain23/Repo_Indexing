     H/TITLE FIX Missing Item Value XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : COOL:2E  Version: 62050
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 03/15/00  Time  : 11:54:15
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAB0REL1IF  E           K        DISK
      * RTV : Item Balance              Retrieval index       NV
      *
     FPDKZCPL1IF  E           K        DISK
      * RTV : Item Values               Retrieval index
      *
     FPDKZCPL0IF  E           K        DISK                      A
      * UPD : Item Values               Update index
      *
     I@B0REJX
      * Item Balance              Retrieval index       NV
      * Renamed input format fields
     I              B0AIC3                          WAAIC3
     I              B0HGCD                          WAHGCD
     I              B0AJCD                          WAAJCD
     I              B0AGCS                          WAAGCS
     I              B0AECS                          WAAECS
     I              B0BACS                          WABACS
     I              B0BBCS                          WABBCS
     I              B0CBPR                          WACBPR
     I              B0GUDT                          WAGUDT
     I              B0XYST                          WAXYST
     I              B0CTPR                          WACTPR
     I              B0G4DT                          WAG4DT
     I              B0BOWG                          WABOWG
     I              B0DDQT                          WADDQT
     I              B0DEQT                          WADEQT
     I              B0DFQT                          WADFQT
     I              B0HDQT                          WAHDQT
     I              B0HEQT                          WAHEQT
     I              B0AJQT                          WAAJQT
     I              B0AQQT                          WAAQQT
     I              B0AUQT                          WAAUQT
     I              B0EMQT                          WAEMQT
     I              B0DOQT                          WADOQT
     I              B0ATNA                          WAATNA
     I              B0AKDT                          WAAKDT
     I              B0ANDT                          WAANDT
     I              B0IDVA                          WAIDVA
     I              B0JVST                          WAJVST
     I              B0BZPC                          WABZPC
     I              B0DGQT                          WADGQT
     I              B0DIDT                          WADIDT
     I              B0ALCD                          WAALCD
     I              B0BFDY                          WABFDY
     I              B0DJDT                          WADJDT
     I              B0BGDY                          WABGDY
     I              B0DKDT                          WADKDT
     I              B0J2ST                          WAJ2ST
     I              B0DJQT                          WADJQT
     I              B0BNWG                          WABNWG
     I              B0DLDT                          WADLDT
     I              B0DPQT                          WADPQT
     I              B0DQQT                          WADQQT
     I              B0DMDT                          WADMDT
     I              B0M0ST                          WAM0ST
     I              B0J9ST                          WAJ9ST
     I              B0KBST                          WAKBST
     I              B0AKC8                          WAAKC8
     I              B0RINB                          WARINB
     I              B0RHNB                          WARHNB
     I              B0RGNB                          WARGNB
     I              B0UVST                          WAUVST
     I              B0UWST                          WAUWST
     I              B0UXST                          WAUXST
     I              B0VSST                          WAVSST
     I              B0AATM                          WAAATM
     I              B0AYNA                          WAAYNA
     I              B0A0NA                          WAA0NA
     I              B0AXDT                          WAAXDT
      *
     I@KZCPJJ
      * Item Values               Retrieval index
      * Renamed input format fields
     I              KZAIC3                          WBAIC3
     I              KZHGCD                          WBHGCD
     I              KZAJCD                          WBAJCD
     I              KZGUDT                          WBGUDT
     I              KZAQTM                          WBAQTM
     I              KZAGCS                          WBAGCS
     I              KZGIDT                          WBGIDT
     I              KZXYST                          WBXYST
     I              KZJ0DT                          WBJ0DT
     I              KZUVST                          WBUVST
     I              KZUWST                          WBUWST
     I              KZUXST                          WBUXST
     I              KZVSST                          WBVSST
     I              KZAATM                          WBAATM
     I              KZAYNA                          WBAYNA
     I              KZA0NA                          WBA0NA
     I              KZAXDT                          WBAXDT
      *
     I@KZCPJI
      * Item Values               Update index
      * Renamed input format fields
     I              KZAIC3                          WCAIC3
     I              KZHGCD                          WCHGCD
     I              KZAJCD                          WCAJCD
     I              KZGUDT                          WCGUDT
     I              KZAQTM                          WCAQTM
     I              KZAGCS                          WCAGCS
     I              KZGIDT                          WCGIDT
     I              KZXYST                          WCXYST
     I              KZJ0DT                          WCJ0DT
     I              KZUVST                          WCUVST
     I              KZUWST                          WCUWST
     I              KZUXST                          WCUXST
     I              KZVSST                          WCVSST
     I              KZAATM                          WCAATM
     I              KZAYNA                          WCAYNA
     I              KZA0NA                          WCA0NA
     I              KZAXDT                          WCAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDKZ1    E DSPDKZCPL0
      * UPD : Item Values               Update index
      * Renamed input format fields
     I              KZAIC3                          WCAIC3
     I              KZHGCD                          WCHGCD
     I              KZAJCD                          WCAJCD
     I              KZGUDT                          WCGUDT
     I              KZAQTM                          WCAQTM
     I              KZAGCS                          WCAGCS
     I              KZGIDT                          WCGIDT
     I              KZXYST                          WCXYST
     I              KZJ0DT                          WCJ0DT
     I              KZUVST                          WCUVST
     I              KZUWST                          WCUWST
     I              KZUXST                          WCUXST
     I              KZVSST                          WCVSST
     I              KZAATM                          WCAATM
     I              KZAYNA                          WCAYNA
     I              KZA0NA                          WCA0NA
     I              KZAXDT                          WCAXDT
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * FIX Missing Item Value XF
      * FIX Missing Item Value RT - IC Item Balance  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * FIX Missing Item Value RT - IC Item Balance  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@B0REJX                    *
     C                     READ @B0REJX                  90*
      * Data record not found
     C   90                MOVEL'USR0328' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Val Any Exist-Itm Bal  RT - PD Item Values  * 
     C                     EXSR SBRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * CASE: DB1.Unit Cost Per Pound NE WRK.ZERO
     C           WAAGCS    IFNE WUW0NB                     *IF
      * CRT PD Item Values     CR - PD Item Values  * 
     C                     EXSR SCCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @B0REJX                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Val Any Exist-Itm Bal  RT - PD Item Values  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBHGCD    WQSB02           Item Code
     C           *LIKE     DEFN WBAJCD    WQSB03           Warehouse Code
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Item Code
     C                     KFLD           WQSB03           Warehouse Code
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWAHGCD    WQSB02           Item Code
     C                     MOVELWAAJCD    WQSB03           Warehouse Code
      * Establish starting position
     C           KRSSB     SETLL@KZCPJJ                    *
     C           KRSSB     READE@KZCPJJ                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2347' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * CRT PD Item Values     CR - PD Item Values  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  60       Job Time
     C                     MOVEL*BLANK    WN0002 10        User Id
     C                     MOVEL*BLANK    WN0003 10        Job Name
     C                     Z-ADD*ZERO     WN0004  70       Job Date
     C                     MOVEL*BLANK    WN0005  7        *Return code
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @KZCPJI
     C                     Z-ADDWAAIC3    WCAIC3           Company Number
     C                     Z-ADDWAHGCD    WCHGCD           Item Code
     C                     MOVELWAAJCD    WCAJCD           Warehouse Code
     C                     Z-ADD##JDT     WCGUDT           Revaluation Eff
     C                     Z-ADD##JTM     WCAQTM           Revaluation Eff
     C                     Z-ADDWAAGCS    WCAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WCGIDT           Pricing Date Us
     C                     MOVEL'O'       WCXYST           Revaluation Cos
     C                     Z-ADD##JDT     WCJ0DT           Revaluation Dat
     C                     MOVEL*BLANK    WCUVST           EDI Status 1
     C                     MOVEL*BLANK    WCUWST           EDI Status 2
     C                     MOVEL*BLANK    WCUXST           EDI Status 3
     C                     MOVEL'A'       WCVSST           Record Status
      *
      * USER: Processing before Data update
      * VAL Exists             XF - PD Item Values  * 
     C                     CALL 'PDNHXFR'              90  VAL Exists
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WCAIC3    WQ0001  30       Company Number
     C                     PARM WCHGCD    WQ0002  70       Item Code
     C                     PARM WCAJCD    WQ0003  3        Warehouse Code
     C                     PARM WCGUDT    WQ0004  70       Revaluation Eff
     C                     PARM WCAQTM    WQ0005  60       Revaluation Eff
     C           WN0005    PARM *BLANK    WQ0006  7        *Return code
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDNHXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * DO WHILE: PAR.*Return code is *Record already exists
     C           WN0005    DOWEQ'Y2U0003'                  *DOW
     C                     ADD  1         WCAQTM           Revaluation Eff
      * VAL Exists             XF - PD Item Values  * 
     C                     CALL 'PDNHXFR'              90  VAL Exists
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WCAIC3    WQ0007  30       Company Number
     C                     PARM WCHGCD    WQ0008  70       Item Code
     C                     PARM WCAJCD    WQ0009  3        Warehouse Code
     C                     PARM WCGUDT    WQ0010  70       Revaluation Eff
     C                     PARM WCAQTM    WQ0011  60       Revaluation Eff
     C           WN0005    PARM *BLANK    WQ0012  7        *Return code
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDNHXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *ITR
      * SET Off Indicator 98   US - /UT User Source  * 
     C                     SETOF                     98    SETOFF INDIC
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WCAATM           Job Time
     C                     MOVEL##USR     WCAYNA           User Id
     C                     MOVEL##JOB     WCA0NA           Job Name
     C                     Z-ADD##JDT     WCAXDT           Job Date
     C                     MOVEL##PGM     WCA0NA           Job Name
     C           KLCRSC    KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCHGCD           Item Code
     C                     KFLD           WCAJCD           Warehouse Code
     C                     KFLD           WCGUDT           Revaluation Eff
     C                     KFLD           WCAQTM           Revaluation Eff
      * Check for duplicate primary key
     C           KLCRSC    SETLL@KZCPJI                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2348' W0RTN   7
      * Send message 'Item Values            EX'
     C                     MOVEL'USR2348' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@KZCPJI                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAHGCD           Item Code
     C                     Z-ADD*ZERO     WAAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WAAECS           Last Cost
     C                     Z-ADD*ZERO     WABACS           Cost per Primar
     C                     Z-ADD*ZERO     WABBCS           Cost per Pricin
     C                     Z-ADD*ZERO     WACBPR           Revaluation Cos
     C                     Z-ADD*ZERO     WAGUDT           Revaluation Eff
     C                     Z-ADD*ZERO     WACTPR           Last Revaluatio
     C                     Z-ADD*ZERO     WAG4DT           Last Revaluatio
     C                     Z-ADD*ZERO     WABOWG           On Hand Weight
     C                     Z-ADD*ZERO     WADDQT           On Hand U/M1 Su
     C                     Z-ADD*ZERO     WADEQT           On Hand U/M2 Su
     C                     Z-ADD*ZERO     WADFQT           On Hand U/M3 Su
     C                     Z-ADD*ZERO     WAHDQT           Quantity In Chi
     C                     Z-ADD*ZERO     WAHEQT           Weight In Chill
     C                     Z-ADD*ZERO     WAAJQT           Quantity Schedu
     C                     Z-ADD*ZERO     WAAQQT           Quantity on Sal
     C                     Z-ADD*ZERO     WAAUQT           Quantity on Pur
     C                     Z-ADD*ZERO     WAEMQT           Quantity on Tra
     C                     Z-ADD*ZERO     WADOQT           Quantity Avail.
     C                     Z-ADD*ZERO     WAAKDT           Date of Last Or
     C                     Z-ADD*ZERO     WAANDT           Date of Last Sh
     C                     Z-ADD*ZERO     WAIDVA           Value of On Han
     C                     Z-ADD*ZERO     WABZPC           Safety Allowanc
     C                     Z-ADD*ZERO     WADGQT           Safety Allowanc
     C                     Z-ADD*ZERO     WADIDT           Stock Out Date
     C                     Z-ADD*ZERO     WABFDY           Lead Time - Las
     C                     Z-ADD*ZERO     WADJDT           Lead Time - Dat
     C                     Z-ADD*ZERO     WABGDY           Lead Time - Nex
     C                     Z-ADD*ZERO     WADKDT           Lead Time - Dat
     C                     Z-ADD*ZERO     WADJQT           Usage Qty per C
     C                     Z-ADD*ZERO     WABNWG           Usage Weight pe
     C                     Z-ADD*ZERO     WADLDT           Inventory Manag
     C                     Z-ADD*ZERO     WADPQT           Minimum Quantit
     C                     Z-ADD*ZERO     WADQQT           Maximum Quantit
     C                     Z-ADD*ZERO     WADMDT           Last Physical C
     C                     Z-ADD*ZERO     WAAKC8           Vendor - Item/W
     C                     Z-ADD*ZERO     WARINB           Item Structure
     C                     Z-ADD*ZERO     WARHNB           Item Structure
     C                     Z-ADD*ZERO     WARGNB           Item Structure
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBHGCD           Item Code
     C                     Z-ADD*ZERO     WBGUDT           Revaluation Eff
     C                     Z-ADD*ZERO     WBAQTM           Revaluation Eff
     C                     Z-ADD*ZERO     WBAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WBGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WBJ0DT           Revaluation Dat
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
      * Clear all neither parameters
      * CRT PD Item Values     CR - PD Item Values  * 
     C                     Z-ADD*ZERO     WCAATM  60       Job Time
     C                     Z-ADD*ZERO     WCAXDT  70       Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
