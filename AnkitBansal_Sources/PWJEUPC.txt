/*******************************************************************/
/*                                                                 */
/*  PROGRAM NUMBER:  PWJEUPC                                       */
/*  PROGRAM NAME:    Purge Tattoo Header Job Sel                   */
/*  PROGRAMMER:      Brad Baden                                    */
/*  CREATE DATE:      6/10/2019                                    */
/*  TFS NUMBER:      15087                                         */
/*                                                                 */
/*  FUNCTION:        This CL is called from the job scheduler      */
/*                   1. Save Tattoo Header Job Sel for company     */
/*                   2. Purge records based on number of days      */
/*                      prior to the current date.                 */
/*                   3. RGZPFM Tattoo Header Job Sel (PKDOREP)     */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*******************************************************************/
             PGM        PARM(&COMPA &DAYSA)

             DCL        VAR(&COMPA) TYPE(*CHAR) LEN(3)
             DCL        VAR(&DAYSA) TYPE(*CHAR) LEN(5)

             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&DAYS) TYPE(*DEC) LEN(5 0)

             DCL        VAR(&CURRDATEA) TYPE(*CHAR) LEN(6)
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMPVALU) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PRODLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BUFILE) TYPE(*CHAR) LEN(10)

             /* Convert alpha parms to numeric values */
             CHGVAR     VAR(&COMP) VALUE(&COMPA)
             CHGVAR     VAR(&DAYS) VALUE(&DAYSA)

             /* Determine Production Library */
             CHGVAR     VAR(&COMPVALU) VALUE('HPELIB    ')
             CALL       PGM(PDGKXFR) PARM(&RETURN &COMP &COMPVALU +
                          &PRODLIB)
             CHGCURLIB  CURLIB(&PRODLIB)

             /* Backup current file to PRKFSAV */
             RTVSYSVAL  SYSVAL(QDATE) RTNVAR(&CURRDATEA)
             CVTDAT     DATE(&CURRDATEA) TOVAR(&CURRDATEA) +
                          FROMFMT(*MDY) TOFMT(*YMD) TOSEP(*NONE)
             CHGVAR     VAR(&BUFILE) VALUE('PKDOREP' *CAT *COMPA)
             CPYF       FROMFILE(&PRODLIB/PKDOREP) +
                          TOFILE(PRKFSAV/&BUFILE) MBROPT(*ADD) +
                          CRTFILE(*YES)

/*******************************************************************/
/** Calculate the purge date, then delete the records.            **/
/*******************************************************************/

             CALL       PGM(PWJDXFR) PARM(' ' &COMP  &DAYS)

/*******************************************************************/
/** RGZPFM  Tattoo pending PKFJCPP                                **/
/*******************************************************************/
             RGZPFM     FILE(&PRODLIB/PKDOREP)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     ENDPGM
