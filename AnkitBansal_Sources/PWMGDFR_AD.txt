// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWMGDFR
// ?Date: 14.08.2025 Time: 02:56:55
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifiecation history
DO;

//? 6/09/2021 JBB SDD619 - Repayment by Business User
//?               P17058   Function created.  Displays Tattoo
//?                        Repayment comments with subfile Fold and
//?                        subfile drop.
ENDDO;

// LCL.TRC Comment Type = CND.All
LCL.TRC_Comment_Type = 'A';

//?Initially show records as Truncated
// PGM.*Subfile mode = CND.Truncated
PGM.*Subfile_mode = 1;

//?USER: Initialize subfile control

MOVE *ALL (To: CTL From: PAR);

// CTL.BOH Company Number = PAR.CC Company Number
CTL.BOH_Company_Number = PAR.CC_Company_Number;

//?Determine Comment Type text
CASE;

// IF LCL.TRC Comment Type is System Generated
IF LCL.TRC_Comment_Type = 'S';

// CTL.Text 6 USR = CON.System
CTL.Text_6_USR = 'System';

//?Determine Comment Type text
// IF LCL.TRC Comment Type is User Generated
IF LCL.TRC_Comment_Type = 'U';

// CTL.Text 6 USR = CON.User
CTL.Text_6_USR = 'User';

//?Determine Comment Type text
// IF *OTHERWISE
IF *OTHERWISE;

// CTL.Text 6 USR = CON.All
CTL.Text_6_USR = 'All';

ENDIF;

//?USER: Initialize subfile record from DBF record

//?Only display comments for current Comment Type
CASE;

// IF LCL.TRC Comment Type is All
IF LCL.TRC_Comment_Type = 'A';

//?Select all records
//?Only display comments for current Comment Type
// IF LCL.TRC Comment Type NE RCD.TRC Comment Type
IF LCL.TRC_Comment_Type <> RCD.TRC_Comment_Type;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

//?If Tattoo Number passed in, only show records for that tattoo
CASE;

// IF PAR.TH Tattoo Number is NE Zero
IF PAR.TH_Tattoo_Number <> *ZERO;

//?If RCD value <> PAR value, do not display record
CASE;

// IF RCD.BOH Buy Order Number NE PAR.BOH Buy Order Number
IF RCD.BOH_Buy_Order_Number <> PAR.BOH_Buy_Order_Number;

// OR RCD.BOL Load Number NE PAR.BOL Load Number
OR RCD.BOL_Load_Number <> PAR.BOL_Load_Number;

// OR RCD.TH Tattoo Number NE PAR.TH Tattoo Number
OR RCD.TH_Tattoo_Number <> PAR.TH_Tattoo_Number;

// OR RCD.TH Kill Date NE PAR.TH Kill Date
OR RCD.TH_Kill_Date <> PAR.TH_Kill_Date;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?Determine Comment Type text
CASE;

// IF RCD.TRC Comment Type is System Generated
IF RCD.TRC_Comment_Type = 'S';

// RCD.Text 6 USR = CON.System
RCD.Text_6_USR = 'System';

//?Determine Comment Type text
// IF *OTHERWISE
IF *OTHERWISE;

// RCD.Text 6 USR = CON.User
RCD.Text_6_USR = 'User';

ENDIF;

//?USER: Process subfile control (Pre-confirm)

//?F10=Toggle
CASE;

// IF CTL.*CMD key is Toggle
IF CTL.*CMD_key = '10';

//?Toggle Comment Type value
CASE;

// IF LCL.TRC Comment Type is User Generated
IF LCL.TRC_Comment_Type = 'U';

// LCL.TRC Comment Type = CND.System Generated
LCL.TRC_Comment_Type = 'S';

//?Toggle Comment Type value
// IF LCL.TRC Comment Type is System Generated
IF LCL.TRC_Comment_Type = 'S';

// LCL.TRC Comment Type = CND.All
LCL.TRC_Comment_Type = 'A';

//?Toggle Comment Type value
// IF LCL.TRC Comment Type is All
IF LCL.TRC_Comment_Type = 'A';

// LCL.TRC Comment Type = CND.User Generated
LCL.TRC_Comment_Type = 'U';

ENDIF;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

