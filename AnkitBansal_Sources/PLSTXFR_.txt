     H/TITLE ZBld Split from Mtech  XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISSMASO
     H* Date          : 12/13/17  Time  : 13:49:25
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPLBJCPL4IF  E           K        DISK
      * RSQ : Delivery Sched Detail UPL Rtv UnProcess Splts/Mvmn
      *
     FPLAGCPL0IF  E           K        DISK                      A
      * UPD : Delivery Sched Split      Update index
      *
     I@BJCPRX
      * Delivery Sched Detail UPL Rtv UnProcess Splts/Mvmn
      * Renamed input format fields
     I              BJTFA1                          WATFA1
     I              BJAADX                          WAAADX
     I              BJTGA1                          WATGA1
     I              BJTHA1                          WATHA1
     I              BJTPA1                          WATPA1
     I              BJGXDT                          WAGXDT
     I              BJGTDT                          WAGTDT
     I              BJB8TH                          WAB8TH
     I              BJTKA1                          WATKA1
     I              BJPJCD                          WAPJCD
     I              BJPKCD                          WAPKCD
     I              BJPLCD                          WAPLCD
     I              BJPMCD                          WAPMCD
     I              BJTMA1                          WATMA1
     I              BJPQCD                          WAPQCD
     I              BJPPCD                          WAPPCD
     I              BJPNCD                          WAPNCD
     I              BJPOCD                          WAPOCD
     I              BJPRCD                          WAPRCD
     I              BJPSCD                          WAPSCD
     I              BJE4SS                          WAE4SS
     I              BJTOA1                          WATOA1
     I              BJPTCD                          WAPTCD
     I              BJPUCD                          WAPUCD
     I              BJE6SS                          WAE6SS
     I              BJGWDT                          WAGWDT
     I              BJCATH                          WACATH
     I              BJGUDT                          WAGUDT
     I              BJB9TH                          WAB9TH
     I              BJGVDT                          WAGVDT
     I              BJCBTH                          WACBTH
     I              BJABCD                          WAABCD
     I              BJAECD                          WAAECD
     I              BJHMNB                          WAHMNB
     I              BJBNNB                          WABNNB
     I              BJBONB                          WABONB
     I              BJYYA1                          WAYYA1
     I              BJYZA1                          WAYZA1
     I              BJDET1                          WADET1
     I              BJDFT1                          WADFT1
     I              BJIHSS                          WAIHSS
     I              BJFFSS                          WAFFSS
     I              BJFGSS                          WAFGSS
     I              BJFHSS                          WAFHSS
     I              BJPVCD                          WAPVCD
     I              BJPWCD                          WAPWCD
      *
     I@AGCPIL
      * Delivery Sched Split      Update index
      * Renamed input format fields
     I              AGHONB                          WBHONB
     I              AGE0DT                          WBE0DT
     I              AGE6DT                          WBE6DT
     I              AGAGTH                          WBAGTH
     I              AGHZA1                          WBHZA1
     I              AGH5A1                          WBH5A1
     I              AGKNCD                          WBKNCD
     I              AGKOCD                          WBKOCD
     I              AGLDCD                          WBLDCD
     I              AGLECD                          WBLECD
     I              AGH6A1                          WBH6A1
     I              AGAAVN                          WBAAVN
     I              AGAADT                          WBAADT
     I              AGAMTM                          WBAMTM
     I              AGAJST                          WBAJST
     I              AGAHVN                          WBAHVN
     I              AGAGVN                          WBAGVN
     I              AGABVN                          WBABVN
     I              AGABDT                          WBABDT
     I              AGABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPLAG1    E DSPLAGCPL0
      * UPD : Delivery Sched Split      Update index
      * Renamed input format fields
     I              AGHONB                          WBHONB
     I              AGE0DT                          WBE0DT
     I              AGE6DT                          WBE6DT
     I              AGAGTH                          WBAGTH
     I              AGHZA1                          WBHZA1
     I              AGH5A1                          WBH5A1
     I              AGKNCD                          WBKNCD
     I              AGKOCD                          WBKOCD
     I              AGLDCD                          WBLDCD
     I              AGLECD                          WBLECD
     I              AGH6A1                          WBH6A1
     I              AGAAVN                          WBAAVN
     I              AGAADT                          WBAADT
     I              AGAMTM                          WBAMTM
     I              AGAJST                          WBAJST
     I              AGAHVN                          WBAHVN
     I              AGAGVN                          WBAGVN
     I              AGABVN                          WBABVN
     I              AGABDT                          WBABDT
     I              AGABTM                          WBABTM
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Delivery Sched Detail UPL
      * I :  DSU Company Number
     I                                        1   30P1TFA1
      * I :  DSU Transaction Date
     I                                    P   4   70P1AADX
      * I :  DSU Transaction Time
     I                                        8  130P1TGA1
      * I :  DSU Transaction Seq
     I                                       14  180P1THA1
      * I :  DSU Split Sequence
     I                                    P  19  210P1TPA1
      * I : MAP DSU Movement Number
     I                                    P  22  250P1TOA1
      * I :  DSU Record Status
     I                                       26  26 P1FFSS
     IP2PARM      DS
      * FLD: Delivery Sched Detail
      * I : MAP CC Company Number
     I                                    P   1   20P2HONB
      * I : MAP DSH Kill Date
     I                                    P   3   60P2E0DT
      * I : MAP DSD Delivery Date
     I                                    P   7  100P2E6DT
      * I : MAP DSD Delivery Time
     I                                    P  11  130P2AGTH
      * I : MAP DSD Delivery Time Seq
     I                                    P  14  150P2HZA1
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1TFA1    PARM           WP0001  30       DSU Company Num
     C           P1AADX    PARM           WP0002  70       DSU Transaction
     C           P1TGA1    PARM           WP0003  60       DSU Transaction
     C           P1THA1    PARM           WP0004  50       DSU Transaction
     C           P1TPA1    PARM           WP0005  50       DSU Split Seque
     C           P1TOA1    PARM           WP0006  70       DSU Movement Nu
     C           P1FFSS    PARM           WP0007  1        DSU Record Stat
     C           P2HONB    PARM           WP0008  30       CC Company Numb
     C           P2E0DT    PARM           WP0009  70       DSH Kill Date
     C           P2E6DT    PARM           WP0010  70       DSD Delivery Da
     C           P2AGTH    PARM           WP0011  40       DSD Delivery Ti
     C           P2HZA1    PARM           WP0012  30       DSD Delivery Ti
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * ZBld Split from Mtech  XF
      * Read the deliery schedule upl for the split records
      * find the split records for this movement
      * use the fields from the 1st record and populate the shell
      * and then on the splits pass farm and building information
      * Rtv MTech RecordsSplitRT - Delivery Sched Detail UPL  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv MTech RecordsSplitRT - Delivery Sched Detail UPL  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WATOA1    WQSA01           DSU Movement Nu
     C           *LIKE     DEFN WATFA1    WQSA02           DSU Company Num
     C           *LIKE     DEFN WAAADX    WQSA03           DSU Transaction
     C           *LIKE     DEFN WATGA1    WQSA04           DSU Transaction
     C           *LIKE     DEFN WATHA1    WQSA05           DSU Transaction
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WQSA01           DSU Movement Nu
     C                     KFLD           WQSA02           DSU Company Num
     C                     KFLD           WQSA03           DSU Transaction
     C                     KFLD           WQSA04           DSU Transaction
     C                     KFLD           WQSA05           DSU Transaction
     C                     KFLD           WATPA1           DSU Split Seque
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           DSU Movement Nu
     C                     KFLD           WQSA02           DSU Company Num
     C                     KFLD           WQSA03           DSU Transaction
     C                     KFLD           WQSA04           DSU Transaction
     C                     KFLD           WQSA05           DSU Transaction
      * Setup key
     C                     Z-ADDP1TOA1    WQSA01           DSU Movement Nu
     C                     Z-ADDP1TFA1    WQSA02           DSU Company Num
     C                     Z-ADDP1AADX    WQSA03           DSU Transaction
     C                     Z-ADDP1TGA1    WQSA04           DSU Transaction
     C                     Z-ADDP1THA1    WQSA05           DSU Transaction
     C                     Z-ADD00002     WATPA1           DSU Split Seque
      * Establish starting position
     C           KPSSA     SETLL@BJCPRX                    *
     C           KRSSA     READE@BJCPRX                  90*
      * Data record not found
     C   90                MOVEL'PRK1275' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Crt Delv Sched Split  CR - Delivery Sched Split  * 
     C                     EXSR SBCRRC
     C           KRSSA     READE@BJCPRX                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Crt Delv Sched Split  CR - Delivery Sched Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGCPIL
     C                     Z-ADDP1TFA1    WBHONB           CC Company Numb
     C                     Z-ADDP2E0DT    WBE0DT           DSH Kill Date
     C                     Z-ADDP2E6DT    WBE6DT           DSD Delivery Da
     C                     Z-ADDP2AGTH    WBAGTH           DSD Delivery Ti
     C                     Z-ADDP2HZA1    WBHZA1           DSD Delivery Ti
     C                     Z-ADDWATPA1    WBH5A1           DSS Split Seque
     C                     MOVELWAPJCD    WBKNCD           DSS Building
     C                     MOVELWAPKCD    WBKOCD           DSS Room
     C                     MOVELWAPLCD    WBLDCD           DSS Sire Line C
     C                     MOVELWAPMCD    WBLECD           DSS Hog Group C
     C                     Z-ADDWATMA1    WBH6A1           DSS Scheduled H
     C                     MOVELWUAAVN    WBAAVN           RS User Changed
     C                     Z-ADDWUAADT    WBAADT           RS Date Changed
     C                     Z-ADDWUAMTM    WBAMTM           RS Time Changed
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVELWUAHVN    WBAHVN           RS Job
     C                     MOVELWUAGVN    WBAGVN           RS Program
     C                     MOVELWUABVN    WBABVN           RS User Added
     C                     Z-ADDWUABDT    WBABDT           RS Date Added
     C                     Z-ADDWUABTM    WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
     C                     Z-ADD##JDT     WBABDT           RS Date Added
     C                     Z-ADD##JTM     WBABTM           RS Time Added
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSB    KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C                     KFLD           WBE0DT           DSH Kill Date
     C                     KFLD           WBE6DT           DSD Delivery Da
     C                     KFLD           WBAGTH           DSD Delivery Ti
     C                     KFLD           WBHZA1           DSD Delivery Ti
     C                     KFLD           WBH5A1           DSS Split Seque
      * Check for duplicate primary key
     C           KLCRSB    SETLL@AGCPIL                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1033' W0RTN   7
      * Send message 'Delivery Sched Split   EX'
     C                     MOVEL'PRK1033' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@AGCPIL                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WATFA1           DSU Company Num
     C                     Z-ADD*ZERO     WAAADX           DSU Transaction
     C                     Z-ADD*ZERO     WATGA1           DSU Transaction
     C                     Z-ADD*ZERO     WATHA1           DSU Transaction
     C                     Z-ADD*ZERO     WATPA1           DSU Split Seque
     C                     Z-ADD*ZERO     WAGXDT           DSU Kill Date
     C                     Z-ADD*ZERO     WAGTDT           DSU Delivery Da
     C                     Z-ADD*ZERO     WAB8TH           DSU Delivery Ti
     C                     Z-ADD*ZERO     WATKA1           DSU Farm Site C
     C                     Z-ADD*ZERO     WATMA1           DSU Scheduled D
     C                     Z-ADD*ZERO     WATOA1           DSU Movement Nu
     C                     Z-ADD*ZERO     WAGWDT           DSU Sched Route
     C                     Z-ADD*ZERO     WACATH           DSU Sched Route
     C                     Z-ADD*ZERO     WAGUDT           DSU Sch Farm Ar
     C                     Z-ADD*ZERO     WAB9TH           DSU Sch Farm Ar
     C                     Z-ADD*ZERO     WAGVDT           DSU Sch Start L
     C                     Z-ADD*ZERO     WACBTH           DSU Sch Start L
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WAYYA1           DSU PRD Srv Bat
     C                     Z-ADD*ZERO     WAYZA1           DSU PRD Srv Sch
     C                     Z-ADD*ZERO     WAFGSS           DSU Process Sta
     C                     Z-ADD*ZERO     WAPVCD           DSU Change Date
     C                     Z-ADD*ZERO     WAPWCD           DSU Change Time
      * Define work field RS User Changed
     C                     MOVEL*BLANK    WUAAVN 10
      * Define work field RS Date Changed
     C                     Z-ADD*ZERO     WUAADT  70
      * Define work field RS Time Changed
     C                     Z-ADD*ZERO     WUAMTM  60
      * Define work field RS Job
     C                     MOVEL*BLANK    WUAHVN 10
      * Define work field RS Program
     C                     MOVEL*BLANK    WUAGVN 10
      * Define work field RS User Added
     C                     MOVEL*BLANK    WUABVN 10
      * Define work field RS Date Added
     C                     Z-ADD*ZERO     WUABDT  70
      * Define work field RS Time Added
     C                     Z-ADD*ZERO     WUABTM  60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHONB           CC Company Numb
     C                     Z-ADD*ZERO     WBE0DT           DSH Kill Date
     C                     Z-ADD*ZERO     WBE6DT           DSD Delivery Da
     C                     Z-ADD*ZERO     WBAGTH           DSD Delivery Ti
     C                     Z-ADD*ZERO     WBHZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     WBH5A1           DSS Split Seque
     C                     Z-ADD*ZERO     WBH6A1           DSS Scheduled H
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
