/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT DSO A/R CUSTOMER REPORT AND BUILD WORKFILE, &  */
/*             EMAIL IT.                                            */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 04/11/00                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &COPIESL    - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/*          &HOLD       - HOLD PRINT FLAG                           */
/*          &SAVE       - SAVE PRINT FLAG                           */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - TO DATE                                   */
/*          &CUSTL      - CUSTOMER                                  */
/*          &PARENL     - PARENT                                    */
/*          &EMAILF     - EMAIL FILE NAME                           */
/*          &EMAILA     - EMAIL ADDRESS                             */
/********************************************************************/
/* 11/22/02 RMC ADDED PARENT CUST PARM, ADDED PAST 12 MONTHS AVG    */
/*              DAYS TO PAY TO OUTFILE/SEQUEL.                      */
/* 03/01/05 PKD ADDED CITY, STATE, AND COUNTRY FOR THE CUSTOMER     */
/********************************************************************/

 POE4PCLP:   PGM        PARM(&PGM &COMPL &FDATEL &TDATEL &CUSTL +
                  &PARENL &EMAILF         &OUTQ &HOLD &SAVE +
                          &COPIESL &NIGHTQ &EMAILA)


        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #     */
        DCL    &COMPL     *DEC                    /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)          /*  FROM DATE      */
        DCL    &FDATEL    *DEC                   /*  FOR PASSING    */
        DCL    &TDATE     *DEC    (7 0)          /*  THROUGH DATE   */
        DCL    &TDATEL    *DEC                   /*  FOR PASSING    */
        DCL    &COPIES    *DEC    (3 0)           /*  # OF COPIES   */
        DCL    &COPIESL   *DEC                    /*  FOR PASSING   */
        DCL    &CUST      *DEC    (7 0)          /*  A/R CUSTOMER   */
        DCL    &PARENT    *DEC    (7 0)          /*  PARENT         */
             DCL        VAR(&EMAILA) TYPE(*CHAR) LEN(32) /*  EMAIL +
                          ADDRESS */
        DCL    &CUSTL     *DEC                   /*  FOR PASSING    */
        DCL    &PARENL    *DEC                   /*  FOR PASSING    */
        DCL    &EMAILF    *CHAR   6               /*  EMAIL FILE NM */
        DCL    &OUTQ      *CHAR   10             /*  OUTPUT QUEUE   */
        DCL    &NIGHTQ    *CHAR   10             /*  NIGHT JOB QUEUE*/
        DCL    &SAVE      *CHAR   4              /*  SAVE SPOOL     */
        DCL    &HOLD      *CHAR   4              /*  HOLD SPOOL     */
        DCL    &PGM       *CHAR   10              /*  PGM NAME      */
        DCL    &COMPA     *CHAR   3               /*  COMPANY ALPHA */
        DCL    &FDATEA    *CHAR   7               /*  FROM DT ALPHA */
        DCL    &TDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &CUSTA     *CHAR   7               /*  CUSTOMER      */
        DCL    &PAREA     *CHAR   (7)          /*  PARENT         */
        DCL    &COMMAND    *CHAR   (512)

/* SEND PROGRAM MESSAGE PARAMETERS  */

        DCL    &USER      *CHAR   10              /*  USER ID       */
        DCL    &MSGRTN    *CHAR   10              /*  MSG QUEUE     */
        DCL    &PGMO      *CHAR   10              /*  PRINTER FILE  */
             /* Internal Fields */
             DCL  VAR(&ALREADY)  TYPE(*CHAR) LEN(1)

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&TDATE) VALUE(&TDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&CUST) VALUE(&CUSTL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&PARENT) VALUE(&PARENL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&COPIES) VALUE(&COPIESL) /* change to +
                          length for print program */

/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/


             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')


/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/

/*  THIS USED TO SPECIFY DRAWER(2)                                */
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/*********************************************************************/
/*   CALL LISTING PROGRAM                                            */
/*********************************************************************/

             CLRPFM     FILE(POANCPP)
             CALL       PGM(&PGM) PARM('' &FDATE &TDATE &COMP &CUST &PARENT)

   IF COND(&EMAILF *NE '      ') THEN(DO)
             ADDLIBLE LIB(SEQUEL) POSITION(*LAST)
             MONMSG MSGID(CPF2103) EXEC(DO)       /* already in libl */
                CHGVAR VAR(&ALREADY) VALUE('Y')
             ENDDO
   /*--------------------------------------------*/
   /* Convert "A/R SUMMARY DSO FILE TO EXCEL" */
   /*--------------------------------------------*/
   /*  COMMENTED OUT 03/01/05 */
 /*          EXECUTE    SQL('SELECT ANAIC3 COLHDG("Company"), ANANC7 +
                          COLHDG("Customer" "Nbr"), ANAYTX +
                          COLHDG("Customer" "Name"), ANMUNX +
                          COLHDG("Avg Days" "To Pay"),      +
 ANSTNX COLHDG("MO"), ANSSNX COLHDG("Avg Days"), +
 ANSUNX COLHDG("MO"), ANSVNX COLHDG("Avg Days"), +
 ANSWNX COLHDG("MO"), ANSXNX COLHDG("Avg Days"), +
 ANSYNX COLHDG("MO"), ANSZNX COLHDG("Avg Days"), +
 ANS0NX COLHDG("MO"), ANS1NX COLHDG("Avg Days"), +
 ANS2NX COLHDG("MO"), ANS3NX COLHDG("Avg Days"), +
 ANS4NX COLHDG("MO"), ANS5NX COLHDG("Avg Days"), +
 ANS6NX COLHDG("MO"), ANS7NX COLHDG("Avg Days"), +
 ANS8NX COLHDG("MO"), ANS9NX COLHDG("Avg Days"), +
 ANTANX COLHDG("MO"), ANTBNX COLHDG("Avg Days"), +
 ANTFNX COLHDG("MO"), ANTCNX COLHDG("Avg Days"), +
 ANTDNX COLHDG("MO"), ANTENX COLHDG("Avg Days") +
                    FROM  POANCPP') TOFLR(GUY.IS) TODOC(&EMAILF) +
                          PCFMT(*XLS) REPLACE(*YES) TEXT('DSO A/R +
                          Summary File') +
                          RECIPIENT(&EMAILA) +
                          EMLMSG('DSO A/R SUMMARY FILE')  */

/* ADDED SHIPTO STATE AND COUNTRY 03/01/05 */
             EXECUTE    SQL('SELECT ANAIC3 COLHDG("Company"), ANANC7 +
                          COLHDG("Customer" "Nbr"), ANAYTX +
                          COLHDG("Customer" "Name"), ANMUNX +
                          COLHDG("Avg Days" "To Pay"),      +
 ANSTNX COLHDG("MO"), ANSSNX COLHDG("Avg Days"), +
 ANSUNX COLHDG("MO"), ANSVNX COLHDG("Avg Days"), +
 ANSWNX COLHDG("MO"), ANSXNX COLHDG("Avg Days"), +
 ANSYNX COLHDG("MO"), ANSZNX COLHDG("Avg Days"), +
 ANS0NX COLHDG("MO"), ANS1NX COLHDG("Avg Days"), +
 ANS2NX COLHDG("MO"), ANS3NX COLHDG("Avg Days"), +
 ANS4NX COLHDG("MO"), ANS5NX COLHDG("Avg Days"), +
 ANS6NX COLHDG("MO"), ANS7NX COLHDG("Avg Days"), +
 ANS8NX COLHDG("MO"), ANS9NX COLHDG("Avg Days"), +
 ANTANX COLHDG("MO"), ANTBNX COLHDG("Avg Days"), +
 ANTFNX COLHDG("MO"), ANTCNX COLHDG("Avg Days"), +
 ANTDNX COLHDG("MO"), ANTENX COLHDG("Avg Days"), +
 BBAJNA COLHDG("City"), +
 BBBGCD COLHDG("State" "Code"), +
 BBKXCD COLHDG("Country" "Code")  +
 FROM  POANCPP, CABBREP JOIN ANANC7=BBBKC7')   +
                          TOFLR(GUY.IS) TODOC(&EMAILF) +
                          PCFMT(*XLS) REPLACE(*YES) TEXT('DSO A/R +
                          Summary File') +
                          RECIPIENT(&EMAILA) +
                          EMLMSG('DSO A/R SUMMARY FILE')
   /*---------------------------------*/
   /* Remove SEQUEL Library from List */
   /*---------------------------------*/
             IF COND(&ALREADY *EQ 'N') THEN(DO)
                RMVLIBLE   LIB(SEQUEL)
             ENDDO
             ENDDO

 END:        ENDPGM
