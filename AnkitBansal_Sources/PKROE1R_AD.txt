// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKROE1R
// ?Date: 14.08.2025 Time: 02:50:18
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?History
DO;

//?FP1284 HPE TF Non-Member Purchases:
//?H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Number
ENDDO;

//?USER: Initialize detail screen (existing record)

// DTL.Condition Name USR = Condition name of DTL.CCC BO Payment Type
DTL.Condition_Name_USR = RTVCND(DTL.CCC_BO_Payment_Type);

// DTL.Buy Order Type Desc USR = Condition name of DTL.CCC BO Type
DTL.Buy_Order_Type_Desc_USR = RTVCND(DTL.CCC_BO_Type);

//?Correction on moving to description
// DTL.Condition Name 3 USR = Condition name of DTL.CCC Hog Class Type
DTL.Condition_Name_3_USR = RTVCND(DTL.CCC_Hog_Class_Type);

//?FP1284
// DTL.Src Cntrct Typ Desc Usr = Condition name of DTL.CCC Source Contract Type
DTL.Src_Cntrct_Typ_Desc_Usr = RTVCND(DTL.CCC_Source_Contract_Type);

//?USER: Validate detail screen fields

// WRK.Company Number Alpha Usr = CVTVAR(DTL.CC Company Number)
WRK.Company_Number_Alpha_Usr = CVTVAR(DTL.CC_Company_Number);

//?Select Cost Center
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.CCC Cost Center
IF PGM.*Cursor_field = DTL.CCC_Cost_Center;

// Call program Sel Cost Center       UP.
CALL PROGRAM(Sel Cost Center       UP) ('CCSEL');
PARAMETER(PGM.*Return_code);
PARAMETER(WRK.Company_Number_Alpha_Usr);
PARAMETER(DTL.CCC_Cost_Center);
PARAMETER(DTL.Cost_Center_Desc_USR);

// IF *OTHERWISE
IF *OTHERWISE;

// Send information message - 'Prompt Not Valid for this field'
MESSAGE(PRK0383 *INFO);

// *MO.VE             1183529*Bu = ilt. in functions
PGM.*Defer_confirm = 'Y';

ENDIF;

ENDIF;

//?SEL:  G/L Code
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.CCC G/L Code
AND PGM.*Cursor_field = DTL.CCC_G_L_Code;

// Call program Sel G/L Accounts      SR.
CALL PROGRAM(Sel G/L Accounts      SR) ('PKVCSRR');
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.CCC_G_L_Code);
PARAMETER(LCL.CGL_Code_Description);
PARAMETER(LCL.CGl_GL_Acct_ID);
PARAMETER('HPE');
PARAMETER(LCL.CGL_Account_Category_Code);

ENDIF;

// Call program Rtv Cost Center Desc  UP.
CALL PROGRAM(Rtv Cost Center Desc  UP) ('CCRET');
PARAMETER(PGM.*Return_code);
PARAMETER(WRK.Company_Number_Alpha_Usr);
PARAMETER(DTL.CCC_Cost_Center);
PARAMETER(DTL.Cost_Center_Desc_USR);

CASE;

// IF DTL.Cost Center Desc USR EQ WRK.Blank USR
IF DTL.Cost_Center_Desc_USR = WRK.Blank_USR;

// Send error message - 'Cost Center Invalid'
ERROR(PRK0404);
MSGPARM(DTL.CCC_Cost_Center);

ENDIF;

EXECUTE FUNCTION(Val G/L Act Cde       RT) TYPE(RTVOBJ) FILE(PKCWREP)           AB1156060;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.CCC_G_L_Code);
PARAMETER(LCL.CGL_Code_Description);
PARAMETER(LCL.CGl_GL_Acct_ID);
PARAMETER('HPE');
PARAMETER(LCL.CGL_Account_Category_Code);
PARAMETER(LCL.Record_Found_USR);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Processing if Data record not found

 // *MO.VE             1183529*Bu = ilt. in functions
 PAR.Record_Found_USR = 'N';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PAR.Record Found USR = CND.Record Found
 PAR.Record_Found_USR = 'Y';

 //?Validate Account Type 1
 CASE;

 // IF PAR.CGl Account Type 1 NE WRK.Blank USR
 IF PAR.CGl_System_Reference_Code <> WRK.Blank_USR;

 CASE;

 // IF PAR.CGl Account Type 1 NE DB1.CGl Account Type 1
 IF PAR.CGl_System_Reference_Code <> DB1.CGl_System_Reference_Code;

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 MOVE *ALL (To: PAR From: CON);

 ENDIF;

 ENDIF;

 //?Validate Account Type 2
 CASE;

 // IF PAR.CGL Account Type 2 NE WRK.Blank USR
 IF PAR.CGL_Account_Category_Code <> WRK.Blank_USR;

 CASE;

 // IF PAR.CGL Account Type 2 NE DB1.CGL Account Type 2
 IF PAR.CGL_Account_Category_Code <> DB1.CGL_Account_Category_Code;

 // PAR.Record Found USR = CND.Record Not Found
 PAR.Record_Found_USR = 'N';

 MOVE *ALL (To: PAR From: CON);

 ENDIF;

 ENDIF;

}


CASE;

// IF LCL.Record Found USR is Record Not Found
IF LCL.Record_Found_USR = 'N';

// Send error message - 'G_L Account Codes not found.'
ERROR(PRK0400);

// IF *OTHERWISE
IF *OTHERWISE;

// Call program Rtv Account ID Desc   UP.
CALL PROGRAM(Rtv Account ID Desc   UP) ('ACTRET');
PARAMETER(PGM.*Return_code);
PARAMETER(LCL.CGl_GL_Acct_ID);
PARAMETER(DTL.GL_Act_ID_ObjSubDsc_USR);

ENDIF;

//?USER: Change DBF record

EXECUTE FUNCTION(Chg HPE Cost Center   CH) TYPE(CHGOBJ) FILE(PKCVREP)           AB1143865;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.CCC_BO_Payment_Type);
PARAMETER(DTL.CCC_BO_Type);
PARAMETER(DTL.CCC_Hog_Class_Type);
PARAMETER(DTL.CCC_Source_Contract_Type);
PARAMETER(DTL.CCC_Cost_Center);
PARAMETER(DTL.CCC_G_L_Code);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

