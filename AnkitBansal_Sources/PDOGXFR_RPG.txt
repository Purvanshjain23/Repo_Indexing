     H/TITLE CHG Ship Prc Detail    XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/22/10  Time  : 17:11:02
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDIMCPW0UF  E           K        DISK
      * UPD : Order Detail Pricing      Upd Index for Work File
      *
     FPDIMCPL0UF  E           K        DISK
      * UPD : Order Detail Pricing      Update index
      *
     I@IMCPZ4
      * Order Detail Pricing      Upd Index for Work File
      * Renamed input format fields
     I              IMAIC3                          WAAIC3
     I              IMC4NB                          WAC4NB
     I              IMDPNB                          WADPNB
     I              IMUENB                          WAUENB
     I              IMQ9CD                          WAQ9CD
     I              IMPDSQ                          WAPDSQ
     I              IMBNPR                          WABNPR
     I              IMU6ST                          WAU6ST
     I              IMUVST                          WAUVST
     I              IMUWST                          WAUWST
     I              IMUXST                          WAUXST
     I              IMAATM                          WAAATM
     I              IMAYNA                          WAAYNA
     I              IMA0NA                          WAA0NA
     I              IMAXDT                          WAAXDT
      *
     I@IMCPSD
      * Order Detail Pricing      Update index
      * Renamed input format fields
     I              IMAIC3                          WBAIC3
     I              IMC4NB                          WBC4NB
     I              IMDPNB                          WBDPNB
     I              IMUENB                          WBUENB
     I              IMQ9CD                          WBQ9CD
     I              IMPDSQ                          WBPDSQ
     I              IMBNPR                          WBBNPR
     I              IMU6ST                          WBU6ST
     I              IMUVST                          WBUVST
     I              IMUWST                          WBUWST
     I              IMUXST                          WBUXST
     I              IMAATM                          WBAATM
     I              IMAYNA                          WBAYNA
     I              IMA0NA                          WBA0NA
     I              IMAXDT                          WBAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDIM1    E DSPDIMCPW0
      * UPD : Order Detail Pricing      Upd Index for Work File
      * Renamed input format fields
     I              IMAIC3                          WAAIC3
     I              IMC4NB                          WAC4NB
     I              IMDPNB                          WADPNB
     I              IMUENB                          WAUENB
     I              IMQ9CD                          WAQ9CD
     I              IMPDSQ                          WAPDSQ
     I              IMBNPR                          WABNPR
     I              IMU6ST                          WAU6ST
     I              IMUVST                          WAUVST
     I              IMUWST                          WAUWST
     I              IMUXST                          WAUXST
     I              IMAATM                          WAAATM
     I              IMAYNA                          WAAYNA
     I              IMA0NA                          WAA0NA
     I              IMAXDT                          WAAXDT
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPDIM2    E DSPDIMCPL0
      * UPD : Order Detail Pricing      Update index
      * Renamed input format fields
     I              IMAIC3                          WBAIC3
     I              IMC4NB                          WBC4NB
     I              IMDPNB                          WBDPNB
     I              IMUENB                          WBUENB
     I              IMQ9CD                          WBQ9CD
     I              IMPDSQ                          WBPDSQ
     I              IMBNPR                          WBBNPR
     I              IMU6ST                          WBU6ST
     I              IMUVST                          WBUVST
     I              IMUWST                          WBUWST
     I              IMUXST                          WBUXST
     I              IMAATM                          WBAATM
     I              IMAYNA                          WBAYNA
     I              IMA0NA                          WBA0NA
     I              IMAXDT                          WBAXDT
      *
     IYARDCS      DS                             56
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Detail Pricing
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Order Number
     I                                    P   3   60P1C4NB
      * I :  Order Sequence Number
     I                                    P   7   80P1DPNB
      * I :  Order Secondary Line Seq
     I                                    P   9  100P1UENB
      * I :  Price Method Componant
     I                                       11  16 P1Q9CD
      * I :  Price Detail Sequence
     I                                    P  17  180P1PDSQ
      * I :  Componant Price
     I                                    P  19  244P1BNPR
      * I :  PD Status
     I                                       25  25 P1U6ST
      * I :  EDI Status 1
     I                                       26  26 P1UVST
      * I :  EDI Status 2
     I                                       27  27 P1UWST
      * I :  EDI Status 3
     I                                       28  28 P1UXST
     IP2PARM      DS
      * I :  Work/Prod or Both Flag
     I                                        1   1 P2YSST
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P1DPNB    PARM           WP0003  30       Order Sequence
     C           P1UENB    PARM           WP0004  30       Order Secondary
     C           P1Q9CD    PARM           WP0005  6        Price Method Co
     C           P1PDSQ    PARM           WP0006  30       Price Detail Se
     C           P1BNPR    PARM           WP0007 114       Componant Price
     C           P1U6ST    PARM           WP0008  1        PD Status
     C           P1UVST    PARM           WP0009  1        EDI Status 1
     C           P1UWST    PARM           WP0010  1        EDI Status 2
     C           P1UXST    PARM           WP0011  1        EDI Status 3
     C           P2YSST    PARM           WP0012  1        Work/Prod or Bo
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CHG Shp Prc Wrk & Prod XF
      * Update Work file if parm = Work or Both
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Work/Prod or Both Flag is Work
      *   |- c2    : PAR.Work/Prod or Both Flag is Work & Production
      *   '-
     C           P2YSST    IFEQ 'W'                        *IF
     C           P2YSST    OREQ 'B'                        *OR
      * CHG PD Shp Dtl Prc Wrk CH - PD Ship Detail Pricing  * 
     C                     EXSR SACHRC
     C                     END                             *FI
      * Update Prod file if parm = Prod or Both
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Work/Prod or Both Flag is Production
      *   |- c2    : PAR.Work/Prod or Both Flag is Work & Production
      *   '-
     C           P2YSST    IFEQ 'P'                        *IF
     C           P2YSST    OREQ 'B'                        *OR
      * CHG PD Ship Dtl Pricng CH - PD Ship Detail Pricing  * 
     C                     EXSR SBCHRC
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * CHG PD Shp Dtl Prc Wrk CH - PD Ship Detail Pricing  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  60       Job Time
     C                     MOVEL*BLANK    WN0002 10        User Id
     C                     MOVEL*BLANK    WN0003 10        Job Name
     C                     Z-ADD*ZERO     WN0004  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @IMCPZ4
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1C4NB    WAC4NB           Order Number
     C                     Z-ADDP1DPNB    WADPNB           Order Sequence
     C                     Z-ADDP1UENB    WAUENB           Order Secondary
     C                     MOVELP1Q9CD    WAQ9CD    P      Price Method Co
      *
     C           KLCHSA    KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAC4NB           Order Number
     C                     KFLD           WADPNB           Order Sequence
     C                     KFLD           WAUENB           Order Secondary
     C                     KFLD           WAQ9CD           Price Method Co
     C           KLCHSA    CHAIN@IMCPZ4              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDIMCPW0'MDACP
     C                     MOVEL'@IMCPZ4' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
      * Move non-key fields to @IMCPZ4
     C                     Z-ADDP1PDSQ    WAPDSQ           Price Detail Se
     C                     Z-ADDP1BNPR    WABNPR           Componant Price
     C                     MOVELP1U6ST    WAU6ST    P      PD Status
     C                     MOVELP1UVST    WAUVST    P      EDI Status 1
     C                     MOVELP1UWST    WAUWST    P      EDI Status 2
     C                     MOVELP1UXST    WAUXST    P      EDI Status 3
      *
     C                     UPDAT@IMCPZ4                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCHRC    BEGSR
      *================================================================
      * CHG PD Ship Dtl Pricng CH - PD Ship Detail Pricing  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0005  60       Job Time
     C                     MOVEL*BLANK    WN0006 10        User Id
     C                     MOVEL*BLANK    WN0007 10        Job Name
     C                     Z-ADD*ZERO     WN0008  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @IMCPSD
     C                     Z-ADDP1AIC3    WBAIC3           Company Number
     C                     Z-ADDP1C4NB    WBC4NB           Order Number
     C                     Z-ADDP1DPNB    WBDPNB           Order Sequence
     C                     Z-ADDP1UENB    WBUENB           Order Secondary
     C                     MOVELP1Q9CD    WBQ9CD    P      Price Method Co
      *
     C           KLCHSB    KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBC4NB           Order Number
     C                     KFLD           WBDPNB           Order Sequence
     C                     KFLD           WBUENB           Order Secondary
     C                     KFLD           WBQ9CD           Price Method Co
     C           KLCHSB    CHAIN@IMCPSD              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDIMCPL0'MDACP
     C                     MOVEL'@IMCPSD' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPDIM2    YARDCS
      * Move non-key fields to @IMCPSD
     C                     Z-ADDP1PDSQ    WBPDSQ           Price Detail Se
     C                     Z-ADDP1BNPR    WBBNPR           Componant Price
     C                     MOVELP1U6ST    WBU6ST    P      PD Status
     C                     MOVELP1UVST    WBUVST    P      EDI Status 1
     C                     MOVELP1UWST    WBUWST    P      EDI Status 2
     C                     MOVELP1UXST    WBUXST    P      EDI Status 3
      *
      * Set PGM.*Record Data Changed flag
     C           QPDIM2    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
     C                     Z-ADD##JTM     WBAATM           Job Time
     C                     MOVEL##USR     WBAYNA           User Id
     C                     MOVEL##JOB     WBA0NA           Job Name
     C                     Z-ADD##JDT     WBAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QPDIM2    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@IMCPSD                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDIMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WAPDSQ           Price Detail Se
     C                     Z-ADD*ZERO     WABNPR           Componant Price
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
