// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBG0XFR
// ?Date: 14.08.2025 Time: 03:47:56
// ?------------------------------------------------------------------------------------------------

//?Execute user function

CASE;

// IF PAR.Ship To Customer is not equal to zero
IF PAR.Ship_To_Customer <> *ZERO;

//?Read the Customer Accrual program for a specific accrual or all
//?The Parms will have the data need to build the remainding fields
//?Ship to customer, Name, description and etc
//?The accrual date selection will be perform in the Customer Accrual
//?Date selecting check:Ship to customer, Name, description and etc
EXECUTE FUNCTION(Rtv/Upd WF Brk CustRatRT) TYPE(RTVOBJ) FILE(OMHOREP)           AC2057247;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Accrual_Code);
PARAMETER(PAR.Date_Entered);
PARAMETER(PAR.Customer_Name_USR);
{
 //?USER: Process Data record

 // WRK.Record Selected       USR = CND.no
 WRK.Record_Selected_USR = 'N';

 //?Accrual Code selection
 CASE;

 // IF PAR.Accrual Code is Not Entered
 IF PAR.Accrual_Code = *BLANK;

 //?*all
 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 //?Accrual Code selection
 // IF PAR.Accrual Code is Entered
 IF PAR.Accrual_Code <> *BLANK;

 // AND PAR.Accrual Code EQ DB1.Accrual Code
 AND PAR.Accrual_Code = DB1.Accrual_Code;

 //?*Specific Accrual
 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 ENDIF;

 //?Date Selection
 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 CASE;

 // IF PAR.Date Entered GE DB1.Period Beginning Date
 IF PAR.Date_Entered >= DB1.Period_Beginning_Date;

 // AND PAR.Date Entered LE DB1.Period Ending Date
 AND PAR.Date_Entered <= DB1.Period_Ending_Date;

 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.Record Selected       USR = CND.no
 WRK.Record_Selected_USR = 'N';

 ENDIF;

 ENDIF;

 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 //?Build Customer Accrual for all Items = Finish Goods only
 CASE;

 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 // OR DB1.All Products (Y/N) is Yes
 OR DB1.All_Products_Y_N = 'Y';

 // OR DB1.All Products (Y/N) is Yes + Exceptions
 OR DB1.All_Products_Y_N = 'X';

 //?Step 1 Build all items based on this customer accrual
 //?Read all Active Item Defaults and build the base record
 //?Read all Active and Finish Goods only
 //?The rate will be from the Customer Accrual to Start with
 //?Write out all items for this customer accrual regardless
 // WRK.Accrual Rate Customer Usr = DB1.Accrual Rate
 WRK.Accrual_Rate_Customer_Usr = DB1.Accrual_Rate;

 EXECUTE FUNCTION(RTV/Bld WF Brkr RBase RT) TYPE(RTVOBJ) FILE(OMBYREP)           AC2057238;
 PARAMETER(*ZERO);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(PAR.Date_Entered);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(PAR.Customer_Name_USR);
 PARAMETER(DB1.Accrual_Rate);
 PARAMETER('C');
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Item Type Code is Finished Good
  IF DB1.Item_Type_Code = 'FG';

  //?All of the accruals will be built for Each Item and Each Customer
  //?This create "Rate"  is from the Input parm
  EXECUTE FUNCTION(RtvCrt WF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057040;
  PARAMETER(PAR.Accrual_Code);
  PARAMETER(PAR.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Description_Line_One);
  PARAMETER(PAR.Accrual_Rate);
  PARAMETER(PAR.Customer_Name_USR);
  PARAMETER(PAR.WFBC_Accrual_Built);
  {
   //?USER: Processing if Data record not found

   EXECUTE FUNCTION(Crt WF Brkr Comm Rate CR) TYPE(CRTOBJ) FILE(PBAQCPP)           AC2055286;
   PARAMETER(PAR.Accrual_Code);
   PARAMETER(PAR.Ship_To_Customer);
   PARAMETER(PAR.Item_Code);
   PARAMETER(PAR.Description_Line_One);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.Customer_Name);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

  ENDIF;

 }

 ENDIF;

 CASE;

 // IF DB1.All Products (Y/N) is Yes
 IF DB1.All_Products_Y_N = 'Y';

 //?Records were already created for this Customer Accrual
 //?due to the build of the Base
 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 //?Update all records from with the Customer Accrual Item
 //?if a Customer Accrual Item is found
 //?Rate will be from the Customer Accrual Item
 EXECUTE FUNCTION(Rtv/Upd WF Brk Cust RatRT) TYPE(RTVOBJ) FILE(OMHPREP)          AC2057262;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(DB1.CAH_Sequence_No);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  //?update all rates for this work files with
  //?Customer Accrual Item Rate
  EXECUTE FUNCTION(Rtv/UpdWF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057250;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER('I');
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Chg WF BrkrCustRateAftCH) TYPE(CHGOBJ) FILE(PBAQCPP)           AC2057249;
   PARAMETER(DB1.Accrual_Code);
   PARAMETER(DB1.Ship_To_Customer);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

 }

 // IF DB1.All Products (Y/N) is Yes + Exceptions
 IF DB1.All_Products_Y_N = 'X';

 //?Update all records from with the Customer Accrual Item
 //?if a Customer Accrual Item is found
 //?Rate will be from the Customer Accrual Item
 EXECUTE FUNCTION(Rtv/Upd WF Brk Cust RatRT) TYPE(RTVOBJ) FILE(OMHPREP)          AC2057262;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(DB1.CAH_Sequence_No);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  //?update all rates for this work files with
  //?Customer Accrual Item Rate
  EXECUTE FUNCTION(Rtv/UpdWF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057250;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER('I');
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Chg WF BrkrCustRateAftCH) TYPE(CHGOBJ) FILE(PBAQCPP)           AC2057249;
   PARAMETER(DB1.Accrual_Code);
   PARAMETER(DB1.Ship_To_Customer);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 ENDIF;

 ENDIF;

}


// IF PAR.Ship To Customer is grtr than or equal zero
IF PAR.Ship_To_Customer >= *ZERO;

//?Read all Customer Accrual programs
//?Accrual type is required for this process
//?a specific accrual or all
//?The Parms will have the data need to build the remainding fields
//?Ship to customer, Name, description and etc
//?The accrual date selection will be perform in the Customer Accrual
//?Date selecting check:Ship to customer, Name, description and etc
EXECUTE FUNCTION(Rtv/Upd WF Brk CustAllRT) TYPE(RTVOBJ) FILE(OMHOREP)           AC2057636;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Accrual_Code);
PARAMETER(PAR.Date_Entered);
PARAMETER(PAR.Accrual_Type);
{
 //?USER: Process Data record

 // WRK.Record Selected       USR = CND.no
 WRK.Record_Selected_USR = 'N';

 //?Accrual Code selection
 CASE;

 // IF PAR.Accrual Code is Not Entered
 IF PAR.Accrual_Code = *BLANK;

 //?*all
 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 //?Accrual Code selection
 // IF PAR.Accrual Code is Entered
 IF PAR.Accrual_Code <> *BLANK;

 // AND PAR.Accrual Code EQ DB1.Accrual Code
 AND PAR.Accrual_Code = DB1.Accrual_Code;

 //?*Specific Accrual
 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 ENDIF;

 //?Date Selection
 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 CASE;

 // IF PAR.Date Entered GE DB1.Period Beginning Date
 IF PAR.Date_Entered >= DB1.Period_Beginning_Date;

 // AND PAR.Date Entered LE DB1.Period Ending Date
 AND PAR.Date_Entered <= DB1.Period_Ending_Date;

 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.Record Selected       USR = CND.no
 WRK.Record_Selected_USR = 'N';

 ENDIF;

 ENDIF;

 //?Accrual Type
 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 //?Accrual type is required when by all customers
 EXECUTE FUNCTION(Val Accr Cde by Type  RT) TYPE(RTVOBJ) FILE(OMHLREP)           AC1957938;
 PARAMETER(PAR.Accrual_Type);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(WRK.Record_Found_USR);
 {
  //?USER: Initialize routine

  // PAR.Record Found USR = CND.Record Not Found
  PAR.Record_Found_USR = 'N';

  //?USER: Process Data record

  // PAR.Record Found USR = CND.Record Found
  PAR.Record_Found_USR = 'Y';

 }

 CASE;

 // IF WRK.Record Found USR is Record Found
 IF WRK.Record_Found_USR = 'Y';

 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.Record Selected       USR = CND.yes
 WRK.Record_Selected_USR = 'Y';

 ENDIF;

 ENDIF;

 //?All customer /get customer name and as the shipto
 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 EXECUTE FUNCTION(RTV Ship To-All Flds  RT) TYPE(RTVOBJ) FILE(CABBREP)           AC2052413;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(PAR.Customer_Name_USR);
 PARAMETER(NLL.Address_Line_1);
 PARAMETER(NLL.Address_Line_2);
 PARAMETER(NLL.Address_Line_3);
 PARAMETER(NLL.City);
 PARAMETER(NLL.State_Code);
 PARAMETER(NLL.County_Code);
 PARAMETER(NLL.Zip_Postal_Code);
 PARAMETER(NLL.Telephone_Number_FF);
 PARAMETER(NLL.Fax_Number_FF);
 PARAMETER(NLL.Alpha_Search);
 PARAMETER(NLL.Federal_Tax_Id);
 PARAMETER(NLL.New_Customer_Status);
 PARAMETER(NLL.SIC_Number);
 PARAMETER(NLL.D_B_Number);
 PARAMETER(NLL.D_B_Rating);
 PARAMETER(NLL.Date_of_D_B_Rating);
 PARAMETER(NLL.Credit_Line_Expire_Date);
 PARAMETER(NLL.AR_Customer_Number);
 PARAMETER(NLL.Parent_Customer);
 PARAMETER(NLL.Credit_Check_AR_Customer);
 PARAMETER(NLL.Credit_Check_Parent_Cust);
 PARAMETER(NLL.Country_Code);
 PARAMETER(NLL.EDI_Invoice_Sts);
 PARAMETER(NLL.Order_Entry_Hold);
 PARAMETER(NLL.Parent_Credit_Limit);
 PARAMETER(NLL.AR_Credit_Limit);
 PARAMETER(NLL.Order_Entry_Hold_Date);
 PARAMETER(NLL.Ship_To_Customer_Flag);
 PARAMETER(NLL.Field_vs_In_House_flag);
 PARAMETER(NLL.Email_When_Order_Shipped);
 PARAMETER(NLL.Print_Invoice_Sts);
 PARAMETER(NLL.Item_Reference_Status);
 PARAMETER(NLL.Statement_Print_Frequency);
 PARAMETER(NLL.EDI_Status_1);
 PARAMETER(NLL.EDI_Status_2);
 PARAMETER(NLL.EDI_Status_3);
 PARAMETER(NLL.Record_Status);
 {
  //?USER: Processing if Data record not found

  // PGM.*Record selected = CND.*NO
  PGM.*Record_selected = 'N';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Record selected = CND.*YES
  PGM.*Record_selected = 'Y';

 }

 ENDIF;

 CASE;

 // IF WRK.Record Selected       USR is yes
 IF WRK.Record_Selected_USR = 'Y';

 //?Build Customer Accrual for all Items = Finish Goods only
 CASE;

 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 // OR DB1.All Products (Y/N) is Yes
 OR DB1.All_Products_Y_N = 'Y';

 // OR DB1.All Products (Y/N) is Yes + Exceptions
 OR DB1.All_Products_Y_N = 'X';

 //?Step 1 Build all items based on this customer accrual
 //?Read all Active Item Defaults and build the base record
 //?Read all Active and Finish Goods only
 //?The rate will be from the Customer Accrual to Start with
 //?Write out all items for this customer accrual regardless
 // WRK.Accrual Rate Customer Usr = DB1.Accrual Rate
 WRK.Accrual_Rate_Customer_Usr = DB1.Accrual_Rate;

 EXECUTE FUNCTION(RTV/Bld WF Brkr RBase RT) TYPE(RTVOBJ) FILE(OMBYREP)           AC2057238;
 PARAMETER(*ZERO);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(PAR.Date_Entered);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(PAR.Customer_Name_USR);
 PARAMETER(DB1.Accrual_Rate);
 PARAMETER('C');
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Item Type Code is Finished Good
  IF DB1.Item_Type_Code = 'FG';

  //?All of the accruals will be built for Each Item and Each Customer
  //?This create "Rate"  is from the Input parm
  EXECUTE FUNCTION(RtvCrt WF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057040;
  PARAMETER(PAR.Accrual_Code);
  PARAMETER(PAR.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Description_Line_One);
  PARAMETER(PAR.Accrual_Rate);
  PARAMETER(PAR.Customer_Name_USR);
  PARAMETER(PAR.WFBC_Accrual_Built);
  {
   //?USER: Processing if Data record not found

   EXECUTE FUNCTION(Crt WF Brkr Comm Rate CR) TYPE(CRTOBJ) FILE(PBAQCPP)           AC2055286;
   PARAMETER(PAR.Accrual_Code);
   PARAMETER(PAR.Ship_To_Customer);
   PARAMETER(PAR.Item_Code);
   PARAMETER(PAR.Description_Line_One);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.Customer_Name);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

  ENDIF;

 }

 ENDIF;

 CASE;

 // IF DB1.All Products (Y/N) is Yes
 IF DB1.All_Products_Y_N = 'Y';

 //?Records were already created for this Customer Accrual
 //?due to the build of the Base
 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 //?Update all records from with the Customer Accrual Item
 //?if a Customer Accrual Item is found
 //?Rate will be from the Customer Accrual Item
 EXECUTE FUNCTION(Rtv/Upd WF Brk Cust RatRT) TYPE(RTVOBJ) FILE(OMHPREP)          AC2057262;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(DB1.CAH_Sequence_No);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  //?update all rates for this work files with
  //?Customer Accrual Item Rate
  EXECUTE FUNCTION(Rtv/UpdWF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057250;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER('I');
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Chg WF BrkrCustRateAftCH) TYPE(CHGOBJ) FILE(PBAQCPP)           AC2057249;
   PARAMETER(DB1.Accrual_Code);
   PARAMETER(DB1.Ship_To_Customer);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

 }

 // IF DB1.All Products (Y/N) is Yes + Exceptions
 IF DB1.All_Products_Y_N = 'X';

 //?Update all records from with the Customer Accrual Item
 //?if a Customer Accrual Item is found
 //?Rate will be from the Customer Accrual Item
 EXECUTE FUNCTION(Rtv/Upd WF Brk Cust RatRT) TYPE(RTVOBJ) FILE(OMHPREP)          AC2057262;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.Accrual_Code);
 PARAMETER(DB1.CAH_Sequence_No);
 PARAMETER(*ZERO);
 {
  //?USER: Process Data record

  //?update all rates for this work files with
  //?Customer Accrual Item Rate
  EXECUTE FUNCTION(Rtv/UpdWF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057250;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  PARAMETER(DB1.Accrual_Rate);
  PARAMETER('I');
  {
   //?USER: Process Data record

   EXECUTE FUNCTION(Chg WF BrkrCustRateAftCH) TYPE(CHGOBJ) FILE(PBAQCPP)           AC2057249;
   PARAMETER(DB1.Accrual_Code);
   PARAMETER(DB1.Ship_To_Customer);
   PARAMETER(DB1.Item_Code);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 ENDIF;

 ENDIF;

}


ENDIF;

