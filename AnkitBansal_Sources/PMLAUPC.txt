/***************************************************************** */
/*  PROGRAM NUMBER:  PMLAUPC                                       */
/*  PROGRAM NAME:    CALL PURGE PROGRAM FROM PURGE CONTROL         */
/*                   APPLICATION FILE                              */
/*  PROGRAMMER:      LARA BUSER                                    */
/*  CREATE DATE:     08/07/2007                                    */
/*                                                                 */
/*  FUNCTION:        STEP 2:                                       */
/*                   PURGE THE APPROPRIATE FILE BY CALLING THE     */
/*                   PROGRAM THAT IS IN THE PURGE CONTROL          */
/*                   APPLICATION FILE. PARMS WILL ALWAYS BE THE    */
/*                   SAME, SINCE THIS PROGRAM IS GENERIC, THE      */
/*                   CALLED PROGRAM WILL JUST USE WHAT IT NEEDS.   */
/*                                                                 */
/*******************************************************************/
/* MODIFICATIONS:                                                  */
/* LJB 01/30/2008 FP1009 POST INSTALL CHANGES                      */
/*  ADD "PURGE TO LIBRARY" AND ADD AS THE FIRST LIBRARY IN THE     */
/*  LIBRARY LIST SO CORRECT UPDATE INDEX AND FILE WILL BE USED.    */
/*                                                                 */
/* E6218 JJH 07/14/2016 MOVE "RMVLIBLE   LIB(&TOLIB)" TO THE END   */
/*  SO THAT PURGE PROGRAM WILL REMOVE THE CORRECT LIBRARY WHEN     */
/*  DONE.  THIS CORRECTS THE ISSUE THAT PREVENTED THE PURGE OF     */
/*  THE TRIUMPH FOODS IN THE PRKFTFP LIBRARY.                      */
/*  IF THE FROM LIBRARY IS EITHER PRKFTFP OR PRKFGUP, THEN REMOVE  */
/*  BOTH LIBRARIES FROM THE LIBRARY LIST.  THEN ADD THE FROM       */
/*  LIBRARY TO THE LIBRARY LIST AFTER PRKFLIB.                     */
/*                                                                 */
/* R15035 DN  06/05/19 - Added Co 440 STF Purge capability for     */
/*   Delivery Schedule files. STF Purge To Library IS 'PRGHPEFST'. */
/*   Added capability to run the purge from a TEST Environment     */
/*   using TEST Signon Profiles:                                   */
/*     PRKTESTGU, PRKTESTST, or PRKTESTTF.                         */
/*******************************************************************/

             PGM        PARM(&RTNCODE &PURGEDATE &PCAPGM &PCGCODE +
                          &PCGLIB &PCAPPLIC &FILENAME &PCFLGL +
                          &PCFTAPE &PCFIELD &DATEFMT &TOLIB)

             DCL        VAR(&RTNCODE) TYPE(*CHAR) LEN(7)
/*R15035     DCL        VAR(&PURGEDATE) TYPE(*DEC) LEN(7 0)   */
/*R15035 */  DCL        VAR(&PURGEDATE) TYPE(*DEC) LEN(15 5)
             DCL        VAR(&PCAPGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCGCODE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&PCGLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCAPPLIC) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FILENAME) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFLGL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFTAPE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFIELD) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DATEFMT) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB) TYPE(*CHAR) LEN(10)
/*R15035*/   DCL        VAR(&DTALIB) TYPE(*CHAR) LEN(10)
/*R15035*/   DCL        VAR(&PURGEDTE) TYPE(*DEC) LEN(7 0)
/*R15035*/   DCL        VAR(&PCAPGMN) TYPE(*CHAR) LEN(10)


    /* R15035 - Get System Value For Data File Library to Determine Whether +
              in PROD or TEST Environment */
             CALL       PGM(PPJXXFR) PARM(' ' 'DTALIB' &DTALIB)


    /*PRODUCTION ENV LIBRARY SETUP */
         /* Set Purge From Library After PRKFLIB - Co 960 - TF */
             IF         COND(&PCGLIB = 'PRKFTFP ') THEN(DO)
             RMVLIBLE   LIB(PRKFGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
/* R15035 */ RMVLIBLE   LIB(PRKFSTP)
/* R15035 */ MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

/* R15035    ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER PRKFLIB)        */
/* R15035 */ ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO

         /* Set Purge From Library After PRKFLIB - Co 360 - GUYMON */
             IF         COND(&PCGLIB = 'PRKFGUP ') THEN(DO)
             RMVLIBLE   LIB(PRKFGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
/* R15035 */ RMVLIBLE   LIB(PRKFSTP)
/* R15035 */ MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

/* R15035    ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER PRKFLIB)        */
/* R15035 */ ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO

         /* R15035 - Set Purge From Library After PRKFLIB - Co 440 - STF */
             IF         COND(&PCGLIB = 'PRKFSTP ') THEN(DO)
             RMVLIBLE   LIB(PRKFGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFSTP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

/* R15035    ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER PRKFLIB)        */
/* R15035 */ ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO


    /*TEST ENV LIBRARY SETUP - R15035 */
         /* Set Purge From Library After &DTALIB - Co 960 - TF */
             IF         COND(&PCGLIB = 'PRKFTSTTFP') THEN(DO)
             RMVLIBLE   LIB(PRKFTSTGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTSTP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

             ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO

         /* Set Purge From Library After &DTALIB - CO 360 - GUYMON */
             IF         COND(&PCGLIB = 'PRKFTSTGUP') THEN(DO)
             RMVLIBLE   LIB(PRKFTSTGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTSTP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

             ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO

         /* Set Purge From Library After &DTALIB - CO 440 - STF */
             IF         COND(&PCGLIB = 'PRKFTSTSTP') THEN(DO)
             RMVLIBLE   LIB(PRKFTSTGUP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTTFP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */
             RMVLIBLE   LIB(PRKFTSTSTP)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */

             ADDLIBLE   LIB(&PCGLIB) POSITION(*AFTER &DTALIB)

             ENDDO


    /* ADD PURGE TO LIBRARY - COMES FROM PURGE CONTROL GROUP (PMBEREP) */
             ADDLIBLE   LIB(&TOLIB) POSITION(*FIRST)

 /* R15035 - RESET PURGE PROGRAM CALL */
 /*   NOTE: ONLY PKVOXFR - TATTOO APPL CODE USES THE OTHER PARMS PASSED IN. */
             CHGVAR     VAR(&PCAPGMN) VALUE(&PCAPGM)
             CHGVAR     VAR(&PURGEDTE) VALUE(&PURGEDATE)

    /* CALL PROGRAM ASSIGNED IN PURGE CONTROL GROUP (PMBEREP) FILE */
 /*R15035 */ CALL       PGM(&PCAPGMN) PARM(&RTNCODE &PURGEDTE +
                          &PCGCODE &PCGLIB &PCAPPLIC &FILENAME +
                          &PCFLGL &PCFTAPE &PCFIELD &DATEFMT)

             MONMSG     MSGID(CPF0000) EXEC(CHGVAR VAR(&RTNCODE) +
                          VALUE('YU00032')) /* Error occurred on +
                          Call */

    /* REMOVE PURGE TO LIBRARY */
             RMVLIBLE   LIB(&TOLIB)
             MONMSG     MSGID(CPF2104 CPF0000) /* LIBRARY NOT FOUND */


             ENDPGM
