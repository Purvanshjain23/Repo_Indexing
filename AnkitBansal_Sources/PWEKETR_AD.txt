// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWEKETR
// ?Date: 14.08.2025 Time: 02:56:15
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?E11445 JJH 08/10/17 - Producer Site for Company 440
//?- Copied from Edit Site Mileage ET (PLGMETR)
//?- Due to Synon compile error with W0PMD, this is an EDTRN with
//?  all fields displayed OUTPUT.
//?R10369 JJH 07/07/17 - Producer Site Mileage Sync 960 with 440
//?- Modify program to only copy Producer Site Mileage from TF to STF
//?  if PSM Company = 961
//?- In ST, set Company to 440
//?R10369 JJH 07/04/17 - Producer Site Mileage Sync 960 with 440
//?- Crt Producer Site MileIF - Producer Site
//?- Chg Producer Site N/mlIF - Producer Site
//?  - Same logic added to the CRTOBJ and CHGOBJ of Producer Site
//?    Mileage
//?  - The Producer From field in the Producer Location From/To file
//?    is a Producer in the PRKFTFP library that has a Source of
//?    TO = Triumph Foods Only.
//?  - Any create or change for a Producer in the Producer From
//?    field in the Producer Location From/To file will CPYF/Replace
//?    the same record in the PRKFSTF library.
//?  - If Producer is in the Producer From field in the Producer
//?    From/To file get the Company Values for 960/PRDSTFMLIB and
//?    960/PRDSTTOLIB
//?R10369 JJH 05/22/17 - Producer Site Sync 960 with 440
//?- Crt Producer Site     IF - Producer Site
//?- Chg Producer Site N/mlIF - Producer Site
//?  - Same logic added to the CRTOBJ and CHGOBJ of Producer Site
//?  - The Producer From field in the Producer Location From/To file
//?    is a Producer in the PRKFTFP library that has a Source of
//?    TO = Triumph Foods Only.
//?  - Any create or change for a Producer in the Producer From
//?    field in the Producer Location From/To file will CPYF/Replace
//?    the same record in the PRKFSTF library.
//?  - If Producer is in the Producer From field in the Producer
//?    From/To file get the Company Values for 960/PRDSTFMLIB and
//?    960/PRDSTTOLIB
//?R7522 JJH 02/17/17 - Producer Site Mileage
//?- Set the Producer Site Mileage Record Status to the same value
//?  as the Producer Site Record Status.
//?E5389 JJH 03/07/16 - PS Premises ID.
//?- Upon entry or modification of Premises ID, convert all letters
//?  to uppercase.
//?E3814 JJH 10/05/15 - PS Premises ID.
//?- New optional field, to maintain the Premises Identification
//?  Number. 7-Character.
ENDDO;

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Validate header key fields

//?E5389 JJH 03/07/16 - PS Premises ID converted to all uppercase.
// Call program CVT to Upper w/SpclChrXF.
CALL PROGRAM(CVT to Upper w/SpclChrXF) ('PLYOXFR');
PARAMETER(CTL.PS_Premises_ID);
PARAMETER(LCL.PS_Premises_ID);

// CTL.PS Premises ID = LCL.PS Premises ID
CTL.PS_Premises_ID = LCL.PS_Premises_ID;

//?USER: Load existing header

// CTL.Record Status Desc Usr = Condition name of CTL.RS Record Status
CTL.Record_Status_Desc_Usr = RTVCND(CTL.RS_Record_Status);

//?USER: Validate header non-key fields

// Call program Rtv State Description UP.
CALL PROGRAM(Rtv State Description UP) ('STATERET');
PARAMETER(LCL.Return_Code_USR);
PARAMETER(CTL.PS_State);
PARAMETER(LCL.State_Desc_30_USR);

CASE;

// IF LCL.Return Code USR is *Normal
IF LCL.Return_Code_USR = *BLANK;

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'State Code is Invalid'
ERROR(PRK0308);
MSGPARM(CTL.PS_State);

ENDIF;

//?USER: Validate header non-key relations

//?E5389 JJH 03/07/16 - PS Premises ID converted to all uppercase.
// Call program CVT to Upper w/SpclChrXF.
CALL PROGRAM(CVT to Upper w/SpclChrXF) ('PLYOXFR');
PARAMETER(CTL.PS_Premises_ID);
PARAMETER(LCL.PS_Premises_ID);

// CTL.PS Premises ID = LCL.PS Premises ID
CTL.PS_Premises_ID = LCL.PS_Premises_ID;

//?USER: Validate subfile record relations

// Call program Val Company Number    XF.
CALL PROGRAM(Val Company Number    XF) ('PDGZXFR');
PARAMETER(RCD.PSM_Company_Number);
PARAMETER(LCL.Oms_Name);
PARAMETER(LCL.Invalid_Y_N_USR);

CASE;

// IF LCL.Invalid Y/N USR is Yes
IF LCL.Invalid_Y_N_USR = 'Y';

// Send error message - 'Invalid Company Number'
ERROR(PRK0299);
MSGPARM(RCD.PSM_Company_Number);

ENDIF;

//?CALC: Header function fields

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(CTL.Producer_Name_DRV);
PARAMETER(CTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?USER: Change header DBF record

EXECUTE FUNCTION(Chg Producer Site XX  IF) TYPE(EXCINTFUN) FILE(PLATREP)        AB1340100;

//?USER: Change detail DBF record

EXECUTE FUNCTION(Chg Prod Site Mile XX IF) TYPE(EXCINTFUN) FILE(PLASREP)        AB1340101;

