/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PML2UPC                                       */
/*  PROGRAM NAME:    PURGE RECORDS USING SQL TO DELETE             */
/*  PROGRAMMER:      LARA BUSER                                    */
/*  CREATE DATE:     08/14/2007                                    */
/*                                                                 */
/*  FUNCTION:        THIS CL WILL USE SQL TO DELETE RECORDS        */
/*                   FROM THE PRODUCTION FILE PRIOR TO THE         */
/*                   PURGE DATE WITHOUT FIRST COPYING TO           */
/*                   HISTORY OR TAPE.                              */
/*                                                                 */
/*  PARAMETERS:                                                    */
/*    &PDTE       7.0  PURGE FROM HISTORY DATE                     */
/*    &PCGCODE    3    GROUP CODE                                  */
/*    &PCGLIB    10    GROUP CODE LIBRARY                          */
/*    &FILE      10    FILE TO PURGE                               */
/*    &DATEFIELD  6    FIELD TO COMPARE DATE TO FOR PURGING        */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/*                                                                 */
/*******************************************************************/
 PML2UPC:    PGM        PARM(&PCGCODE &PCGLIB &FILE &DATEFIELD &PDTE)

/* PARAMETERS AND DECLARES                                         */
             DCL        VAR(&PDTE) TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&PDTEA) TYPE(*CHAR)  LEN(10)
             DCL        VAR(&PCGCODE) TYPE(*CHAR) LEN(6)
             DCL        VAR(&PCGLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATEFIELD) TYPE(*CHAR) LEN(6)
             DCL        VAR(&SEL)  TYPE(*CHAR) LEN(512) /* SELECT */

/*-----------------------------------------------------------------*/
/* INITIALIZE                                                      */
/*-----------------------------------------------------------------*/
             CHGVAR     VAR(&PDTEA) VALUE(&PDTE) /* PURGE DATE */

/*-----------------------------------------------------------------*/
/* MAINLINE                                                        */
/*-----------------------------------------------------------------*/
/* Delete from PRODUCTION */
             CHGVAR     VAR(&SEL) VALUE('from ' *CAT &FILE *CAT ' +
                          where ' *TCAT &DATEFIELD *BCAT '<' *BCAT +
                          &PDTEA)

             DELETE     SQL(&SEL)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(DELETEPRD))

/* Successful Completion */
             GOTO       CMDLBL(PGMMSG)
/*-----------------------------------------------------------------*/
/*                     ERROR MESSAGES                              */
/*-----------------------------------------------------------------*/
 DELETEPRD:  SNDPGRMSG  TOPGR(PRKPURGE) MSG('DELETE ERROR from file +
                          ' *CAT &FILE) CONFMSG(*NO)

 ERROR:      SNDPGRMSG  TOPGR(PRKPURGE) MSG('Purge of ' *CAT &FILE +
                          *CAT ' Ended Abnormally') CONFMSG(*NO)

             CHGJOB     LOG(4 00 *SECLVL)

             GOTO       CMDLBL(ENDPGM)
/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 PGMMSG:     SNDPGRMSG  TOPGR(PRKPURGE) MSG('Purge of ' *CAT &FILE +
                          *CAT ' Ended Normally') CONFMSG(*NO)
 ENDPGM:     ENDPGM
