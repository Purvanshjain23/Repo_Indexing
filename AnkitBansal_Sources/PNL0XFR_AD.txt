// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PNL0XFR
// ?Date: 14.08.2025 Time: 03:45:34
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?DOC
DO;

//?09/30/09 PKD This program is used for calculating the First
//?             Level Production for the two types of genetics:
//?             C5 and G5.
//?             For 360, when processing the Hot Scale transactions
//?             determine the Sire Line for the Tattoo. If the
//?             Sire Line is C5, then use the C5 Matrix; otherwise
//?             use G5 matrix.
//?             For 960, use the G5 Matrix for all hogs.
ENDDO;

//?360 Kill Date
CASE;

// IF PAR.Kill Date is EQ 0
IF PAR.Kill_Date = *ZERO;

EXECUTE FUNCTION(Rtv Prev Kill Date    RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1395074;
PARAMETER(360);
PARAMETER(JOB.*Job_date);
PARAMETER(LCL.Kill_Date);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Post to G/L Date EQ PAR.Post to G/L Date
 IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.Kill Day Status is yes
 IF DB1.Kill_Day_Status = 'Y';

 // PAR.Kill Date PRV USR = DB1.Post to G/L Date
 PAR.Kill_Date_PRV_USR = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

 ENDIF;

}


//?360 Kill Date
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Kill Date = PAR.Kill Date
LCL.Kill_Date = PAR.Kill_Date;

ENDIF;

//?COMPANY: 360/C5
EXECUTE FUNCTION(Rtv Init Pop Head     RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651821;
PARAMETER(360);
PARAMETER('PPSC5');
PARAMETER(0307);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Pop Head & %     CH) TYPE(CHGOBJ) FILE(PDIZREP)            AC1653864;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
}


// Call program Upd Pop Head     2HPE PF.
CALL PROGRAM(Upd Pop Head     2HPE PF) ('PKY2PFR');
PARAMETER(360);
PARAMETER(LCL.Kill_Date);
PARAMETER('PPSC5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('F');

EXECUTE FUNCTION(Clc Population %      RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651833;
PARAMETER(360);
PARAMETER('PPSC5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
{
 //?USER: Process Data record

 // LCL.Population Percent =       *
 LCL.Population_Percent = ( DB1.Population_Head / PAR.Head_Killed_USR 'H' ) * 100;

 EXECUTE FUNCTION(Chg Population %      CH) TYPE(CHGOBJ) FILE(PDIZREP)           AC1651839;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(LCL.Population_Percent);
}


// Call program U1LP Upd 1st Lvl Plan PF.
CALL PROGRAM(U1LP Upd 1st Lvl Plan PF) ('PDJZPFR');
PARAMETER(360);
PARAMETER('PPSC5');
PARAMETER(0307);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('C');

//?COMPANY: 360/G5
EXECUTE FUNCTION(Rtv Init Pop Head     RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651821;
PARAMETER(360);
PARAMETER('PPSG5');
PARAMETER(0307);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Pop Head & %     CH) TYPE(CHGOBJ) FILE(PDIZREP)            AC1653864;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
}


// Call program Upd Pop Head     2HPE PF.
CALL PROGRAM(Upd Pop Head     2HPE PF) ('PKY2PFR');
PARAMETER(360);
PARAMETER(LCL.Kill_Date);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('F');

EXECUTE FUNCTION(Clc Population %      RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651833;
PARAMETER(360);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
{
 //?USER: Process Data record

 // LCL.Population Percent =       *
 LCL.Population_Percent = ( DB1.Population_Head / PAR.Head_Killed_USR 'H' ) * 100;

 EXECUTE FUNCTION(Chg Population %      CH) TYPE(CHGOBJ) FILE(PDIZREP)           AC1651839;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(LCL.Population_Percent);
}


// Call program U1LP Upd 1st Lvl Plan PF.
CALL PROGRAM(U1LP Upd 1st Lvl Plan PF) ('PDJZPFR');
PARAMETER(360);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('G');

//?*-------------------------------------------------------*
//?360: Send XLS to Distribution List
EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
PARAMETER(360);
PARAMETER('PYBYGEN');
PARAMETER(LCL.Email_Address);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(CVT *CYMD to MM/DD/YY IF) TYPE(EXCINTFUN)                      AC1955623;
PARAMETER(LCL.Date_Char_8_USR);
PARAMETER(LCL.Kill_Date);
{
 //?Execute internal function

 // PAR.Date (Alpha) USR = CVTVAR(PAR.Date                  USR)
 PAR.Date_Alpha_USR = CVTVAR(PAR.Date_USR);

 //?** YEAR **
 // PAR.Year  (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.2,CON.2)
 PAR.Year_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:2:2);

 //?** MONTH **
 // PAR.Month (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.4,CON.2)
 PAR.Month_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:4:2);

 //?** DAY **
 // PAR.Day   (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.6,CON.2)
 PAR.Day_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:6:2);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Month (Char) USR,CON./,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Month_Char_USR + '/' (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,PAR.Day   (Char) USR,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + PAR.Day_Char_USR (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,CON./,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + '/' (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,PAR.Year  (Char) USR,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + PAR.Year_Char_USR (*ZERO);

}


// LCL.text usr 75 = CONCAT(CON.Primal Yield by Genetic,CON.360,CON.1)
LCL.text_usr_75 = 'Primal Yield by Genetic' + '360' (1);

// LCL.text usr 75 = CONCAT(LCL.text usr 75,LCL.Date (Char-8) USR,CON.1)
LCL.text_usr_75 = LCL.text_usr_75 + LCL.Date_Char_8_USR (1);

// Execute command - 'SND Primal Yield by GEN'
EXECUTE COMMAND(USR4192);
PARAMETER(360);
PARAMETER(LCL.Date_Char_8_USR);
PARAMETER(LCL.Email_Address);
PARAMETER(LCL.text_usr_75);

//?*-------------------------------------------------------*
// Execute command - 'ADDLIBLE'
EXECUTE COMMAND(USR3110);
PARAMETER('PRKFTFP');

//?960 Kill Date
CASE;

// IF PAR.Kill Date is EQ 0
IF PAR.Kill_Date = *ZERO;

EXECUTE FUNCTION(Rtv Prev Kill Date    RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1395074;
PARAMETER(960);
PARAMETER(JOB.*Job_date);
PARAMETER(LCL.Kill_Date);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Post to G/L Date EQ PAR.Post to G/L Date
 IF DB1.Post_to_G_L_Date = PAR.Post_to_G_L_Date;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF DB1.Kill Day Status is yes
 IF DB1.Kill_Day_Status = 'Y';

 // PAR.Kill Date PRV USR = DB1.Post to G/L Date
 PAR.Kill_Date_PRV_USR = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

 ENDIF;

}


//?960 Kill Date
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Kill Date = PAR.Kill Date
LCL.Kill_Date = PAR.Kill_Date;

ENDIF;

//?COMPANY: 960/G5
EXECUTE FUNCTION(Rtv Init Pop Head     RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651821;
PARAMETER(960);
PARAMETER('PPSG5');
PARAMETER(0307);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg Pop Head & %     CH) TYPE(CHGOBJ) FILE(PDIZREP)            AC1653864;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
}


// Call program Upd Pop Head     2HPE PF.
CALL PROGRAM(Upd Pop Head     2HPE PF) ('PKY2PFR');
PARAMETER(960);
PARAMETER(LCL.Kill_Date);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('B');

EXECUTE FUNCTION(Clc Population %      RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1651833;
PARAMETER(960);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Head_Killed_USR);
{
 //?USER: Process Data record

 // LCL.Population Percent =       *
 LCL.Population_Percent = ( DB1.Population_Head / PAR.Head_Killed_USR 'H' ) * 100;

 EXECUTE FUNCTION(Chg Population %      CH) TYPE(CHGOBJ) FILE(PDIZREP)           AC1651839;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(DB1.Lean_Percent);
 PARAMETER(LCL.Population_Percent);
}


// Call program U1LP Upd 1st Lvl Plan PF.
CALL PROGRAM(U1LP Upd 1st Lvl Plan PF) ('PDJZPFR');
PARAMETER(960);
PARAMETER('PPSG5');
PARAMETER(0307);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Kill_Date);
PARAMETER(LCL.Head_Killed_USR);
PARAMETER('G');

//?*-------------------------------------------------------*
//?960: Send XLS to Distribution List
EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
PARAMETER(960);
PARAMETER('PYBYGEN');
PARAMETER(LCL.Email_Address);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(CVT *CYMD to MM/DD/YY IF) TYPE(EXCINTFUN)                      AC1955623;
PARAMETER(LCL.Date_Char_8_USR);
PARAMETER(LCL.Kill_Date);
{
 //?Execute internal function

 // PAR.Date (Alpha) USR = CVTVAR(PAR.Date                  USR)
 PAR.Date_Alpha_USR = CVTVAR(PAR.Date_USR);

 //?** YEAR **
 // PAR.Year  (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.2,CON.2)
 PAR.Year_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:2:2);

 //?** MONTH **
 // PAR.Month (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.4,CON.2)
 PAR.Month_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:4:2);

 //?** DAY **
 // PAR.Day   (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.6,CON.2)
 PAR.Day_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:6:2);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Month (Char) USR,CON./,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Month_Char_USR + '/' (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,PAR.Day   (Char) USR,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + PAR.Day_Char_USR (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,CON./,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + '/' (*ZERO);

 // PAR.Date (Char-8) USR = CONCAT(PAR.Date (Char-8) USR,PAR.Year  (Char) USR,CON.*ZERO)
 PAR.Date_Char_8_USR = PAR.Date_Char_8_USR + PAR.Year_Char_USR (*ZERO);

}


// LCL.text usr 75 = CONCAT(CON.Primal Yield by Genetic,CON.960,CON.1)
LCL.text_usr_75 = 'Primal Yield by Genetic' + '960' (1);

// LCL.text usr 75 = CONCAT(LCL.text usr 75,LCL.Date (Char-8) USR,CON.1)
LCL.text_usr_75 = LCL.text_usr_75 + LCL.Date_Char_8_USR (1);

// Execute command - 'SND Primal Yield by GEN'
EXECUTE COMMAND(USR4192);
PARAMETER(960);
PARAMETER(LCL.Date_Char_8_USR);
PARAMETER(LCL.Email_Address);
PARAMETER(LCL.text_usr_75);

