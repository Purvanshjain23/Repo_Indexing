     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
     H/TITLE  E1I0902 - General Ledger Account Balance Retrieval for JDE Enterprise 1     00014
     H* ----------------------------------------------------------------
     H*
     H*    Copyright (c) 1992
     H*    J. D. Edwards & Company
     H*
     H*        This unpublished material is proprietary to
     H*        J. D. Edwards & Company.  All rights reserved.
     H*        The methods and techniques described herein are
     H*        considered trade secrets and/or confidential.
     H*        Reproduction or distribution, in whole or in part,
     H*        is forbidden except by express written permission
     H*        of J. D. Edwards & Company.
     H*
     H* ----------------------------------------------------------------
     F*    PROGRAM REVISION LOG
     F*    --------------------
     F*
     F*          Date     Programmer     Nature of Revision
     F*        --------   ----------  ------------------------------------
     F*        01/31/94     RANSOM    Sar # 00626661
     F*        05/19/94       BUSS    Sar # 00760296
     F*        08/02/94     LB266041  Sar # 00757126
     F*        01/30/95     LB266041  Sar # 00884109
     F*        02/19/95     KIRKWOOD  Sar # 00888556
     F*        05/22/95     KIRKWOOD  Sar # 00962091
     F*        06/20/95     HP4890303 Sar # 00972660
     F*        06/10/99     JP6382337 Sar #  2667917
     F*
     F*        03/31/20     B BADEN   Sar # SDN465    Copied from X0902
     F*
     F*             Rename: F0010 ------> E10010L1  (I0010 -> I0010L1)
     F*                     F0902LA ----> E10902LA  (I0902 -> I0902LA)
     F*                     F0902LE ----> E10902LE  (I0902 -> I0902LE)
     F*                     F0911LD ----> E10911LD  (I0911 -> I0911LD)
     F*                     F0911LN ----> E10911LN  (I0911 -> I0911LN)
     F*                     X0028 ------> E1I0028
     F*
     F*        05/24/21     RMC SDN440 comment call to X0028 that was missed
     F*                                scan for 5-24-21
     F*                         GBANn fields are 15.0 so change back to 15.0
     F*****************************************************************
     F*
     F*    PURPOSE
     F*    -------
     F*    This program performs the account balance retrieval
     F*    for a specific account for a specific Ledger Type
     F*    using date sensitivity.
     F*
     F*****************************************************************
     F*F0010     IF   E           K DISK
     FE10010L1  IF   E           K DISK
     F*   Company Constants  F0010
     F*
     F*----------------------------------------------------------
     F*
     F*F0902LA   IF   E           K DISK
     FE10902LA  IF   E           K DISK
     F*   Account Balances   F0902 - Unique index
     F*
     F*----------------------------------------------------------
     F*
     F*F0902LE   IF   E           K DISK
     F*                                     RENAME(I0902:I0902E)
     FE10902LE  IF   E           K DISK
     F                                     RENAME(I0902LE:I0902E)
     F*   Account Balances   F0902 - Act/Cn/FY/FQ/Lt/CC/SL/SLT
     F*
     F*----------------------------------------------------------
     F*
     F*F0911LD   IF   E           K DISK
     FE10911LD  IF   E           K DISK
     F*   Run Log J/E Detail F0911 - Acct/LT/GLDte/Crnc/SL/SLT
     F*
     F*----------------------------------------------------------
     F*
     F*F0911LN   IF   E           K DISK
     F*                                    RENAME(I0911:I0911N)
     FE10911LN  IF   E           K DISK
     F                                     RENAME(I0911LN:I0911N)
     F*   Run Log J/E Detail F0911 - Acct/CC/FY/FQ/LT/SL/...Pd
     F*
     F*----------------------------------------------------------
     F*
     F*****************************************************************
     D*    PROGRAM TABLES AND ARRAYS
     D*    -------------------------
     D*
     D @A              S              2    DIM(100)                             Budget Amt LT
     D @B              S              2    DIM(100)                             Budget DL01
     D @C              S              2    DIM(100)                             Pgm Amt LT
     D @U              S              2    DIM(100)                             Budget Unit LT
     D @V              S              2    DIM(100)                             Budget DL01
     D @W              S              2    DIM(100)                             Pgm Unit LT
     D @40             S              1    DIM(40)                              Allowed Values
     D @TC             S             21    DIM(50)                              Totals By Curr
     D*
     D*****************************************************************
     D*
     D*    Copy Composite Member for Common Subroutine - C0010
     D*
     D*/COPY JDECPY,E0010
     D**************************************************************
     D*  This is part of a composite common subroutine. In
     D*  order for the subroutine to work correctly, the
     D*  RPG program must /COPY in the following members:
     D*   E0010, I0010, C0010
     D*********************************************************************00021
     D*    PROGRAM TABLES AND ARRAYS
     D*    -------------------------
     D*
     D @DG             S              1    DIM(8)                               C0010 Digits
     D*****************************************************************
     D*
     D*    Copy Composite Member for Common Subroutine - C0012
     D*
     D*/COPY JDECPY,E0012
     D**************************************************************
     D*  This is part of a composite common subroutine. In
     D*  order for the subroutine to work correctly, the
     D*  RPG program must /COPY in the following members:
     D*   E0012, C0012
     D*********************************************************************00004
     D*    PROGRAM TABLES AND ARRAYS
     D*    -------------------------
     D*
     D @NM             S              1    DIM(22)                              C0012 Scrub arr
     D @N2             S              1    DIM(22)                              C0012 Scrub arr
     D*****************************************************************
     D*    PROGRAM INPUT SPECIFICATIONS AND DATA STRUCTURES
     D*    ------------------------------------------------
     D*
     D                 DS
     D  @AN                    1    210  0
     D                                     DIM(14)                              Net Posting
     D  GBAN01                 1     15  0
     D  GBAN02                16     30  0
     D  GBAN03                31     45  0
     D  GBAN04                46     60  0
     D  GBAN05                61     75  0
     D  GBAN06                76     90  0
     D  GBAN07                91    105  0
     D  GBAN08               106    120  0
     D  GBAN09               121    135  0
     D  GBAN10               136    150  0
     D  GBAN11               151    165  0
     D  GBAN12               166    180  0
     D  GBAN13               181    195  0
     D  GBAN14               196    210  0
      *
      * 03/31/20 JBB SDN465 - New GBAN fields are defined as 15.2
     D* GBAN01                 1     15  2
     D* GBAN02                16     30  2
     D* GBAN03                31     45  2
     D* GBAN04                46     60  2
     D* GBAN05                61     75  2
     D* GBAN06                76     90  2
     D* GBAN07                91    105  2
     D* GBAN08               106    120  2
     D* GBAN09               121    135  2
     D* GBAN10               136    150  2
     D* GBAN11               151    165  2
     D* GBAN12               166    180  2
     D* GBAN13               181    195  2
     D* GBAN14               196    210  2
     D*
     D*    Data Structure for Period End Dates
     D*
     D                 DS
     D  @DT                    1     84  0
     D                                     DIM(14) ASCEND                       Period End Dts
     D  CDD01J                 1      6  0
     D  CDD02J                 7     12  0
     D  CDD03J                13     18  0
     D  CDD04J                19     24  0
     D  CDD05J                25     30  0
     D  CDD06J                31     36  0
     D  CDD07J                37     42  0
     D  CDD08J                43     48  0
     D  CDD09J                49     54  0
     D  CDD10J                55     60  0
     D  CDD11J                61     66  0
     D  CDD12J                67     72  0
     D  CDD13J                73     78  0
     D  CDD14J                79     84  0
     D*
     D*    Data Structure for Period End Centuries
     D*
     D                 DS
     D  @CT                    1     28  0
     D                                     DIM(14) ASCEND                       Period End Dts
     D  CDD01#                 1      2  0
     D  CDD02#                 3      4  0
     D  CDD03#                 5      6  0
     D  CDD04#                 7      8  0
     D  CDD05#                 9     10  0
     D  CDD06#                11     12  0
     D  CDD07#                13     14  0
     D  CDD08#                15     16  0
     D  CDD09#                17     18  0
     D  CDD10#                19     20  0
     D  CDD11#                21     22  0
     D  CDD12#                23     24  0
     D  CDD13#                25     26  0
     D  CDD14#                27     28  0
     D*
     D*    Data Structure for Currency and total amount
     D*
     D                 DS
     D  CURTOT                 1     21
     D  $CRNCY                 1      3
     D  $CRCX                  4      6
     D  $AMNT                  7     21  0
     D*
     D*/COPY JDECPY,I00DSINX
     D*                                                                    00001
     D*    This data strucure provides the field definitions of all
     D*    possible array index field names useable by all common
     D*    subroutines.
     D*
     D DSINX           DS                  INZ                                   00001
     D*
     D*    Indexes of 1 digit 0 decimals
     D*
     D  #A                     1      1  0
     D  #B                     2      2  0
     D  #C                     3      3  0
     D  #D                     4      4  0
     D  #E                     5      5  0
     D  #F                     6      6  0
     D*
     D*    Indexes of 2 digits 0 decimals
     D*
     D  #G                     7      8  0
     D  #H                     9     10  0
     D  #I                    11     12  0
     D  #J                    13     14  0
     D  #K                    15     16  0
     D  #L                    17     18  0
     D*
     D*    Indexes of 3 digits 0 decimals
     D*
     D  #M                    19     21  0
     D  #N                    22     24  0
     D  #O                    25     27  0
     D  #P                    28     30  0
     D  #Q                    31     33  0
     D  #R                    34     36  0
     D*
     D*    Indexes of 4 digits 0 decimals
     D*
     D  #S                    37     40  0
     D  #T                    41     44  0
     D  #U                    45     48  0
     D  #V                    49     52  0
     D  #W                    53     56  0
     D  #X                    57     60  0
     D  #Y                    61     64  0
     D  #Z                    65     68  0
     D*/COPY JDECPY,I00DSPROG
     D*****************************************************************    00003
     D*
     D*    PROGRAM STATUS DATA STRUCTURE
     D*    -----------------------------
     D*
     D*    Portions of this data structure are loaded at the time the
     D*    program is loaded.  Other portions of this data structure
     D*    are loaded as you perform I/O.
     D*
     D*    PURPOSE
     D*    -------
     D*    This common subroutine is set up to be used with C0000
     D*    (Cost Center Security) common subroutine and C0001(Edit
     D*    Action Code) common subroutine.  Those two subroutines
     D*    will retrieve ##USER for the user name.
     D*
     D*    No program calcs are done in this subroutine.
     D*
     D ##PSDS         SDS
     D*
     D*          Program Name
     D  ##PROG                 1     10
     D*          Status Code(09999=I/O Error)
     D  ##STAT                11     15  0
     D*          Previous Status code
     D  ##PSTA                16     20  0
     D*          RPG Source Statement Sequence Number
     D  ##SEQN                21     28
     D*          RPG Routine in Which Exception/Error Occured
     D  ##ROUT                29     36
     D*          Number of Parameters Passed to This Program
     D  ##PARM                37     39  0
     D*          Exception Type(MCH=Machine, CPF=CPF)
     D  ##ETYP                40     42
     D*          Exception Message Number
     D  ##ENBR                43     46
     D*          Machine Instruction/Object Definition Template Number
     D  ##MINO                47     50
     D*          Work Area for Messages
     D  ##MWRK                51     80
     D*          Name of Library in Which Program is Located
     D  ##PLIB                81     90
     D*          Retrieved Exdeption Data.  CPF Messages.
     D  ##MSG                 91    170
     D*          Identification of Exception That Caused RPG9001
     D  ##9001               171    174
     D*          Unused
     D  ##FLR1               175    200
     D*          Name of File for Last I/O(Only Updated if Error)
     D  ##LFIL               201    208
     D*          Status Info on Last File Used(Only on Error)
     D  ##LFST               209    243
     D*          Status Code on Last File Used(Only on Error)
     D  ##LFS5               209    213
     D*          Job Name
     D  ##JOBN               244    253
     D*          User Name From User Profile
     D  ##USER               254    263
     D*          Job Number
     D  ##JOB#               264    269  0
     D*          Date Job Entered the System(MMDDYY)
     D  ##JDT                270    275  0
     D*          Date of Program Execution(MMDDYY)
     D  ##EDT                276    281  0
     D*          Time of Program Execttion(HHMMSS)
     D  ##ETM                282    287  0
     D*          Date Program Was Compiled
     D  ##CDT                288    293  0
     D*          Time Program Was Compiled
     D  ##CTM                294    299  0
     D*          Level of the Compiler
     D  ##LVL                300    303
     D*          Source File Name
     D  ##SRCN               304    313
     D*          Source Library Name
     D  ##SRCL               314    323
     D*          Source File Member Name
     D  ##SRCM               324    333
     D*          Unused
     D  ##FLR2               334    429
     D*/COPY JDECPY,IO43199
     D*/COPY JDECPY,I00XFSRV
     D**************************************************************
     D*  This data structure contains the control parameter list
     D*  for the XF data file servers.
     D*****************************************************************
     D*
     D*    Parameter 1 - Fixed functional control parameters.
     D*
     D PS@@1           DS           128
     D*
     D*    Access Method (K=Keyed  R=Relative Record).
     D  @@ACCS                 1      1
     D*    Operation Code (all standard RPG operation codes).
     D  @@OPER                 2     11
     D*    Lock record (Y=Yes or N=No).
     D  @@LOCK                12     12
     D*    Changed record action (If record changed between read and
     D*    update, do:  O=Overlay changed record with new, N=No update,
     D*    R=Return changed record, blank=Return message to caller)
     D  @@CHGR                13     13
     D*    Key List Name
     D  @@KLST                14     23
     D*    Number of Key Fields to Use
     D  @@KNUM                24     28  0
     D*    Format Name
     D  @@FMT                 29     38
     D*    Read Equal Flag
     D  @@RE                  39     39
     D*    DDP Field
     D  @@DDP                 40     49
     D*    Relative record number
     D  @@#RRN                50     58  0
     D*    Input/Output result
     D  @@IOR                 59     61
     D*    Return Code
     D  @@ERR                 62     71
     D*    Field in error
     D  @@ERRS                72     81
     D*
     D*----------------------------------------------------------------
     D*****************************************************************
     D*
     D*    PARAMETERS
     D*    ----------
     D*
     D*        #CAID - Account Master Account ID  ( 8 byte alpha)
     D*        #CCO  - Account Master Company     ( 5 byte alpha)
     D*        #CLT  - Specific Ledger Type       ( 2 byte alpha)
     D*                Leave this field blank for the routine
     D*                   *** FOR FURTURE USE.
     D*                If specific LT is selected all amounts and
     D*                   units will be placed in #CAA and #CAU.
     D*        #CCTRY- Century                    ( 2 byte alpha)
     D*        #CFY  - Fiscal Year    (Thru Date) ( 2 byte numeric)
     D*        #CFQ  - Fiscal Quarter (Thru Date) ( 4 byte alpha)
     D*        #CFP  - Fiscal Period  (Thru Date) ( 2 byte numeric)
     D*        #CFDT - Beginning Date (From Date) ( 6 byte numeric)
     D*                Passed in *JULIAN Format
     D*        #CTDT - Ending Date    (Thru Date) ( 6 byte numeric)
     D*                Passed in *JULIAN Format
     D*        #CFLG1- Values flag                ( 1 byte alpha)
     D*                "1" = Inception to Date (default)
     D*                "2" = Year to Date
     D*                "3" = Period to Date
     D*        #CFLG2- Special flag 2             ( 1 byte alpha)
     D*        #CFLG3- Special flag 3             ( 2 byte alpha)
     D*        #CRTN - Return Code                ( 1 byte alpha).
     D*                " " = Not been executed       - 1st time
     D*                "1" = Has been executed       - 2nd time
     D*                "2" = End program SETON *INLR - Last Time
     D*        #CERR - Error Code                 ( 1 byte alpha).
     D*                No Error when = " "
     D*                Error Exist when NOT " "
     D*        #CSBL - Subledger                  ( 8 byte alpha)
     D*                Enter a "*" for all Subledgers
     D*        #CSBLT- Subledger Type             ( 1 byte alpha)
     D*        #C#POT- Posted or All              ( 1 byte alpha)
     D*                " " = Just Posted 911's
     D*                "*" = All 911's (Posted/Unposted/Error)
     D*        #C#ATV- Activity Option            ( 1 byte alpha)
     D*                **** FOR FUTURE USE.
     D*        #CLTJ   Override Ledger Type( 2 byte alpha)
     D*                This value is only valid when #CLT="  ".
     D*                *** FOR FUTURE USE.
     D*        #C#DPD- Days Prior to Thru Date.      (2 byte alpha)
     D*                The number of days prior to (and including)
     D*                the thru date. The AA and AU amounts for this
     D*                time period will be retrieved from the 0911
     D*                file and returned in #CDPA and #CDPU.
     D*        #CCRCD- Currency Code              ( 3 byte alpha)
     D*
     D*        #CAA  - Actual Amount              (15 byte numeric)
     D*                AA Ledger Type. (Field will also hold amounts
     D*                        of other Ledger types when specific
     D*                        specific Ledger type is specified.)
     D*        #CAU  - Actual Units               (15 byte numeric)
     D*                AU Ledger Type. (Field will also hold units
     D*                        of other Ledger types when specific
     D*                        specific Ledger type is specified.)
     D*        #C2A  - Alternate Amount           (15 byte numeric)
     D*                *** FOR FUTURE USE.
     D*        #C2U  - Alternate Units            (15 byte numeric)
     D*                *** FOR FUTURE USE.
     D*        #CDPA - Days Prior Amount          (15 byte numeric)
     D*                Actual Amount for the number of days
     D*                passed in #C#DPD.
     D*        #CDPU - Days Prior Units           (15 byte numeric)
     D*                Actual Unit amount for the number of days
     D*                passed in #C#DPD.
     D*
     D*****************************************************************
     D PARDS           DS
     D  #CAID                  1      8
     D  #CCO                   9     13
     D  #CLT                  14     15
     D  #CCTRY                16     17
     D  #CFY                  18     19  0
     D  #CFQ                  20     23
     D  #CFP                  24     25  0
     D  #CFDT                 26     31  0
     D  #CTDT                 32     37  0
     D  #CFLG1                38     38
     D  #CFLG2                39     39
     D  #CFLG3                40     41
     D  #CRTN                 42     42
     D  #CERR                 43     43
     D  #CSBL                 44     51
     D  #CSBLT                52     52
     D  #C#POT                53     53
     D  #C#ATV                54     54
     D  #CLTJ                 55     56
     D  #C#DPD                87     88
     D  #CCRCD                89     91
     D  #PRM1                  1    100
     D PARDS1          DS
     D  #CAA                   1     15  0
     D  #CAU                  16     30  0
     D  #C2A                  31     55  0
     D  #C2U                  56     70  0
     D  #CDPA                 71     85  0
     D  #CDPU                 86    100  0
     D  #PRM2                  1    100
     D*
     D*    Data Structures for Date Processing
     D                 DS
     D  $OLDGJ                 1      6  0
     D                 DS
     D  $EFDJ                  1      6  0
     D                 DS
     D  $ETDJ                  1      6  0
     D                 DS
     D  $GTDAJ                 1      6  0
     D                 DS
     D  $GFDAJ                 1      6  0
     D                 DS
     D  $MDYJ                  1      6  0
     D                 DS
     D  $TDATJ                 1      6  0
     D                 DS
     D  $FDATJ                 1      6  0
     D*****************************************************************
     D*
     D*    Copy Composite Member for Common Subroutine - C0010
     D*
     D*/COPY JDECPY,I0010
     D**************************************************************
     D*  This is part of a composite common subroutine. In
     D*  order for the subroutine to work correctly, the
     D*  RPG program must /COPY in the following members:
     D*   E0010, I0010, C0010
     D*****************************************************************
     D*    PROGRAM INPUT SPECIFICATIONS AND DATA STRUCTURES
     D*    ------------------------------------------------
     D*
     D                 DS
     D  @NC                    1     10
     D                                     DIM(10)                              C0010 Check Dg
     D  NNCK01                 1      1
     D  NNCK02                 2      2
     D  NNCK03                 3      3
     D  NNCK04                 4      4
     D  NNCK05                 5      5
     D  NNCK06                 6      6
     D  NNCK07                 7      7
     D  NNCK08                 8      8
     D  NNCK09                 9      9
     D  NNCK10                10     10
     D                 DS
     D  @NN                    1     80  0
     D                                     DIM(10)                              C0010 Nxt Nmbrs
     D  NNN001                 1      8  0
     D  NNN002                 9     16  0
     D  NNN003                17     24  0
     D  NNN004                25     32  0
     D  NNN005                33     40  0
     D  NNN006                41     48  0
     D  NNN007                49     56  0
     D  NNN008                57     64  0
     D  NNN009                65     72  0
     D  NNN010                73     80  0
     C*****************************************************************
     C*    MAINLINE PROGRAM
     C*    ----------------
     C*
     C*    *INZSR subroutine executed first time.
     C*
     C*    Process Housekeeping.
     C*
     C                   EXSR      S999
     C*                    ---- ----
     C*
     C     *INLR         CABEQ     '1'           EOJ
     C*                    -----          ---
     C*
     C*    Clear the Fields
     C*
     C                   EXSR      S001
     C*                    ---- ----
     C*
     C*    Get The Date Information if specific item change.
     C*
     C                   EXSR      S005
     C*                    ---- -----
     C*
B1   C*          #CCO      IFNE $$CO
     C*          #CFDT     ORNE $$FDT
     C*          #CTDT     ORNE $$TDT
     C*          #C#DPD    ORNE $$#DPD
     C*                    EXSR S005A
     C*                    ---- -----
E1   C*                    ENDIF
     C*
     C*    Set Ledger Types
     C*
B1   C     #CLT          IFNE      $$LT
     C                   EXSR      S005B
     C*                    ---- -----
E1   C                   ENDIF
     C*
     C*    Retrieve the Balances. If we are looking at all currencies
     C*    then we need to execute a different routine to total by
     C*    each currency.
     C*
B1   C     $TCRCD        IFNE      '*'
     C                   EXSR      S010
     C*                    ---- ----
X1   C                   ELSE
     C                   EXSR      S020
     C*                    ---- ----
E1   C                   ENDIF
     C*
     C     EOJ           TAG
     C*          ---       ---
     C*
     C*    Save off all program specific date to avoid redundant calcs.
     C*
     C                   EXSR      S005C
     C*                    ---- -----
     C*
     C                   MOVE      #PRM1         PSDS1
     C                   MOVE      #PRM2         PSDS2
     C*
     C*    Return to calling program, no LR.
     C*
B1   C     #CRTN         IFNE      '2'
     C                   RETURN
X1   C                   ELSE
     C                   SETON                                        LR
E1   C                   ENDIF
     C*
     C*
     C*    END OF MAINLINE PROGRAM
     C*    -----------------------
     C*****************************************************************
     C*
     C*    SUBROUTINE S001 - Clear Fields
     C*    ------------------------------
     C*
     C*    Processing:  1.  Initialize amount fields for process.
     C*
     CSR   S001          BEGSR
     C*          ----      -----
     C*
     CSR                 MOVE      *ZEROS        #PRM2
     C*
     CSR   END001        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S005  - Evaluate Dates
     C*    ---------------------------------
     C*
     C*    Processing:  1.  Setup all dates needed for routine.
     C*                     This process will only happen when
     C*                     Company or Dates change.
     C*
     CSR   S005          BEGSR
     C*          ----      -----
     C*
B1   CSR   #CCO          IFNE      $$CO
     CSR   #C#DPD        ORNE      $$#DPD
     CSR                 EXSR      S005A
     C*                    ---- -----
     CSR                 GOTO      END005
     C*                    ---- ------
     CSR                 ENDIF
     C*
     CSR                 SELECT
     C*
     CSR   #CFLG1        WHENEQ    '3'                                          PERIOD
     CSR   #CFDT         IFEQ      $FDTP
     CSR   #CTDT         ANDEQ     $TDTP
     CSR                 Z-ADD     $SVEFP        $EFDJ             6 0
     CSR                 Z-ADD     $SVGFP        $GFDAJ            6 0
     CSR                 Z-ADD     $SVFDP        $FDATJ            6 0
     CSR                 Z-ADD     $SVHFP        $HFDAJ            6 0
     CSR                 Z-ADD     $SVBFP        $BFDJ             6 0
     CSR                 Z-ADD     $SVFPP        $FFP              2 0
     CSR                 Z-ADD     $SVFPP        $XFP
     CSR                 Z-ADD     $SVFYP        $FFY              3 0
     CSR                 Z-ADD     $SVJFP        $JFEND            6 0
     CSR                 Z-ADD     $SVJTP        $JTEND            6 0
     CSR                 GOTO      END005
     C*                    ---- ------
     CSR                 ELSE
     CSR                 EXSR      S005A
     C*                    ---- -----
     CSR                 ENDIF
     C*
     CSR                 OTHER                                                  CUMMULATIVE
     CSR   #CFDT         IFEQ      $$FDT
     CSR   #CTDT         ANDEQ     $$TDT
     CSR                 Z-ADD     $SVEFC        $EFDJ             6 0
     CSR                 Z-ADD     $SVGFC        $GFDAJ            6 0
     CSR                 Z-ADD     $SVFDC        $FDATJ            6 0
     CSR                 Z-ADD     $SVHFC        $HFDAJ            6 0
     CSR                 Z-ADD     $SVBFC        $BFDJ             6 0
     CSR                 Z-ADD     $SVFPC        $FFP              2 0
     CSR                 Z-ADD     $SVFPC        $XFP
     CSR                 Z-ADD     $SVFYC        $FFY              3 0
     CSR                 Z-ADD     $SVJFC        $JFEND            6 0
     CSR                 Z-ADD     $SVJTC        $JTEND            6 0
     CSR                 GOTO      END005
     C*                    ---- ------
     CSR                 ELSE
     CSR                 EXSR      S005A
     C*                    ---- -----
     CSR                 ENDIF
     C                   ENDSL
     C*----------------------------------------------------------------
     C*
     CSR   END005        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S005A - Get Dates
     C*    ----------------------------
     C*
     C*    Processing:  1.  Setup all dates needed for routine.
     C*                     This process will only happen when
     C*                     Company or Dates change.
     C*
     CSR   S005A         BEGSR
     C*          -----     -----
     C*
     C*----------------------------------------------------------------
     C*
     CSR                 MOVE      ' '           $TFST             1
     CSR                 MOVE      ' '           $FFST             1
     C*----------------------------------------------------------------
     C*
     C*    Convert input date to G/L date format. (THRU DATE)
     C*
     CSR                 MOVE      #CTDT         $TDATJ
     C*
     C*    Convert input date to Century Year Month Day. (THRU DATE)
     C*
     CSR                 MOVE      $TDATJ        $GTDAJ
     C*
     C*    Now get day after the Thru date.
     C*
     CSR                 Z-ADD     #CTDT         $DAY1             6 0
     CSR                 ADD       1             $DAY1
     CSR                 MOVE      $DAY1         #SIDAT
     C*R                 CALL      'X0028   '                           83
     C*                    ---- ----------
     C*R                 PARM                    #SIDAT            6
     C*R                 PARM      *BLANK        #EDAT             8
     C*R                 PARM      '*JUL    '    #FFMT             7
     C*R                 PARM      '*JUL    '    #TFMT             7
     C*R                 PARM      '*NONE   '    #SEP              7
     C*R                 PARM      ' '           $ERTST
      *
     c                   CALL      'E1I0028 '                           83
     c                   PARM                    #SIDAT            6
     c                   PARM      *BLANK        #EDAT             8
     c                   PARM      '*JUL    '    #FFMT             7
     c                   PARM      '*JUL    '    #TFMT             7
     c                   PARM      '*NONE   '    #SEP              7
     c                   PARM      ' '           $ERTST
      *
     CSR                 MOVE      #SIDAT        $HTDAJ            6 0          YMD + 1
     C*
     C*----------------------------------------------------------------
     C*
     C*    Get the Thru Date Fiscal Year and Period
     C*
     C*R                 MOVE      $TDATJ        #DG               6 0
     C*R                 CALL      'X09031'
     C*                    ---- --------
     C*R                 PARM      '1'           #CALC
     C*R                 PARM      #CCO          #CO
     C*R                 PARM                    #DG
     C*R                 PARM      0             #PN               2 0
     C*R                 PARM      0             #FY               2 0
     C*R                 PARM                    #CTRY             2 0
     C*R                 PARM      *BLANK        #EDT
     C*R                 PARM      *BLANK        #DGSY
     C*R                 PARM      '1'           #JFLG             1
     C*R                 PARM      0             #BGDT             6 0
     C*R                 PARM      0             #BGCT             2 0
     C*R                 PARM                    @DT
     C*R                 PARM                    @CT
     C*
     C*-------------- Start of code to replace X09031 (E1I09031)
JEU56 * Begin of Added code for GET09031                                    p16169
JEU56 * Retrieve Acct. Period                                     copied from smlgen/qrpgsrc/edenupr
     c                   move      0             #bgdt             6 0
     CSR                 MOVE      $TDATJ        #DG               6 0
     C                   move      #cco          #CO
MN04 C*                  move      '1'           #CALC             1
MN04 C                   move      0             #CTRY             2 0
MN04 C                   move      0             #FY               2 0
      *
MN04 C*                  move      #DG           $WKDG             6
MN04 C*                  MOVEL     $WKDG         $CFY              3
MN04  *
MN04 C*                  move      $CFY          #FY
MN04  *
MN04 C*                  movel     $CFY          $CENT             1
MN04 C*                  if        $cent = '1'
MN04 C*                  move      20            #CTRY
MN04 C*                  ELSE
MN04 C*                  MOVE      19            #CTRY
MN04 C*                  endif
MN04  *
      *
MN04 C                   CALL      'GET09031'
MN04 C                   PARM                    #CO               5
MN04 C                   PARM                    #DG               6 0
MN04 C                   PARM      0             #PN               2 0
MD   C                   PARM      0             #FY               2 0
MD   C                   PARM      0             #CTRY             2 0
     C                   parm      ' '           BSSV              1
MN04  *
MN04  *
      ******* End of code added for GET09031                                     p16169
     C*-------------- End of code to replace X09031 (E1I09031)
     C*
     CSR                 MOVE      #PN           #CFP
     CSR                 MOVE      #FY           #CFY
     C*----------------------------------------------------------------
     C*
     C*    Get Ending date of the (Thru Date) period
     C*
B1   CSR   #CFP          IFEQ      0                                            End PERIOD
     CSR                 Z-ADD     1             #CFP
     CSR                 MOVE      '1'           #CERR
E1   CSR                 ENDIF
     CSR                 MOVE      @DT(#CFP)     $ETDJ
     CSR                 MOVE      $ETDJ         $MDYJ
     C*----------------------------------------------------------------
     C*
     C*    Get Begining date of the period for the Thru Date
     C*
B1   CSR   #CFP          IFEQ      1
     CSR                 Z-ADD     0             $XTP              2 0          End thru Period
     CSR                 MOVE      #BGDT         $BTDJ             6 0
     C*
X1   CSR                 ELSE
     C*
     CSR   #CFP          SUB       1             $XTP                           End Thru Period
     CSR                 MOVE      @DT($XTP)     $DAY1
     CSR                 ADD       1             $DAY1
     CSR                 MOVE      $DAY1         #SIDAT
     C**                 CALL      'X0028   '                           83   commented 5-24-21
     C*                    ---- ----------                                            "
     C*                  PARM                    #SIDAT            6                  "
     C*R                 PARM      *BLANK        #EDAT             8                  "
     C*R                 PARM      '*JUL    '    #FFMT             7                  "
     C*R                 PARM      '*JUL    '    #TFMT             7                  "
     C*R                 PARM      '*NONE   '    #SEP              7                  "
     C*R                 PARM      ' '           $ERTST                               "
      *
     c                   CALL      'E1I0028 '                           83
     c                   PARM                    #SIDAT            6
     c                   PARM      *BLANK        #EDAT             8
     c                   PARM      '*JUL    '    #FFMT             7
     c                   PARM      '*JUL    '    #TFMT             7
     c                   PARM      '*NONE   '    #SEP              7
     c                   PARM      ' '           $ERTST
      *
     CSR                 MOVE      #SIDAT        $BTDJ             6 0          + 1 END DT
     CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    If Thru date lies at period's end, no F0911 detail
     C*    needed on the "thru" side.
     C*
     CSR                 MOVE      '0'           $T911             1
B1   CSR   $GTDAJ        IFEQ      $ETDJ
     CSR                 MOVE      '1'           $T911                          No Need
     CSR                 ADD       1             $XTP                           End Thru Period
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    When the From Date is zero it needs to be set.
     C*
B1   CSR   #CFDT         IFEQ      0
B2   CSR   #CFLG1        IFEQ      *BLANKS
     CSR   #CFLG1        OREQ      '1'
     C*
     C*    Now set the beginning date to first day of year
     C*
     CSR                 MOVE      #BGDT         #CFDT
     CSR                 MOVE      '1'           #CFLG1
X2   CSR                 ELSE
B3   CSR   #CFLG1        IFEQ      '2'
     C*
     C*    Now set the beginning date to first day of year
     C*
     CSR                 MOVE      #BGDT         #CFDT
X3   CSR                 ELSE
B4   CSR   #CFLG1        IFEQ      '3'
     C*
     C*    Now set the beginning date to first day of period
     C*
B5   CSR   #CFP          IFEQ      1
     CSR                 MOVE      #BGDT         #CFDT
X5   CSR                 ELSE
     CSR   #CFP          SUB       1             $$$X              3 0          End Thru Period
     CSR                 MOVE      @DT($$$X)     $DAY1
     CSR                 ADD       1             $DAY1
     CSR                 MOVE      $DAY1         #SIDAT
     C*R                 CALL      'X0028   '                           83
     C*                    ---- ----------
     C*R                 PARM                    #SIDAT            6
     C*R                 PARM      *BLANK        #EDAT             8
     C*R                 PARM      '*JUL    '    #FFMT             7
     C*R                 PARM      '*JUL    '    #TFMT             7
     C*R                 PARM      '*NONE   '    #SEP              7
     C*R                 PARM      ' '           $ERTST
      *
     c                   CALL      'E1I0028 '                           83
     c                   PARM                    #SIDAT            6
     c                   PARM      *BLANK        #EDAT             8
     c                   PARM      '*JUL    '    #FFMT             7
     c                   PARM      '*JUL    '    #TFMT             7
     c                   PARM      '*NONE   '    #SEP              7
     c                   PARM      ' '           $ERTST
      *
     CSR                 MOVE      #SIDAT        #CFDT
E5   CSR                 ENDIF
E4   CSR                 ENDIF
E3   CSR                 ENDIF
E2   CSR                 ENDIF
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    Now set all the FROM DATE variables.
     C*
     CSR                 MOVE      #CFDT         $FDATJ
     C*
     C*    Convert input date to Year Month Day. (FROM DATE)
     C*
     CSR                 MOVE      $FDATJ        $GFDAJ
     C*
     C*    Now get the day before the From Date.
     C*
     CSR                 MOVE      #CFDT         #SDAT2
     CSR                 MOVE      *BLANKS       $#X
     CSR                 MOVE      '1'           $#X
     CSR                 CALL      'X0035   '                           99
     C*                    ----  -----
     CSR                 PARM      *BLANK        #SDAT1            6
     CSR                 PARM                    #SDAT2            6
     CSR                 PARM      '*JUL    '    #SFM1             7
     CSR                 PARM      '*JUL    '    #SFM2             7
     CSR                 PARM      *BLANK        #STYE             1
     CSR                 PARM      *BLANK        $ERTST            1
     CSR                 PARM                    $#X               9
     CSR                 PARM      *BLANK        #SICT1            2
     CSR                 PARM      *BLANK        #SICT2            2
     CSR                 MOVE      #SDAT1        $HFDAJ            6 0
     C*----------------------------------------------------------------
     C*
     C*    Get the From Date Fiscal Year and Period
     C*
     C*R                 MOVE      $FDATJ        #DG
     C*R                 CALL      'X09031'
     C*                    ---- --------
     C*R                 PARM      '1'           #CALC             1
     C*R                 PARM      #CCO          #CO
     C*R                 PARM                    #DG
     C*R                 PARM      0             #PN
     C*R                 PARM      0             #FY
     C*R                 PARM                    #CTRY
     C*R                 PARM      *BLANK        #EDT              1
     C*R                 PARM      *BLANK        #DGSY             1
     C*R                 PARM      '1'           #JFLG             1
     C*R                 PARM      0             #BGDT
     C*R                 PARM      0             #BGCT
     C*R                 PARM                    @DT
     C*R                 PARM                    @CT
     C*
     C*-------------- Start of code to replace X09031 (E1I09031)
JEU56 * Begin of Added code for GET09031                                    p16169
JEU56 * Retrieve Acct. Period                                     copied from smlgen/qrpgsrc/edenupr
     CSR                 MOVE      $FDATJ        #DG               6 0
     C                   move      #cco          #CO
MN04 C*                  move      '1'           #CALC             1
MN04 C                   move      0             #CTRY             2 0
MN04 C                   move      0             #FY               2 0
      *
MN04 C*                  move      #DG           $WKDG             6
MN04 C*                  MOVEL     $WKDG         $CFY              3
MN04  *
MN04 C*                  move      $CFY          #FY
MN04  *
MN04 C*                  movel     $CFY          $CENT             1
MN04 C*                  if        $cent = '1'
MN04 C*                  move      20            #CTRY
MN04 C*                  ELSE
MN04 C*                  MOVE      19            #CTRY
MN04 C*                  endif
MN04  *
      *
MN04 C                   CALL      'GET09031'
MN04 C                   PARM                    #CO               5
MN04 C                   PARM                    #DG               6 0
MN04 C                   PARM      0             #PN               2 0
MD   C                   PARM      0             #FY               2 0
MD   C                   PARM      0             #CTRY             2 0
     C                   parm      ' '           BSSV              1
MN04  *
MN04  *
      ******* End of code added for GET09031                                     p16169
     C*-------------- End of code to replace X09031 (E1I09031)
     CSR                 MOVE      #PN           $FFP              2 0
     CSR                 MOVE      #FY           $FFY              3 0
     C*----------------------------------------------------------------
     C*
     C*    Get Ending date of the (From Date) period
     C*
     CSR                 MOVE      @DT($FFP)     $EFDJ
     CSR                 MOVE      $EFDJ         $MDYJ
     C*----------------------------------------------------------------
     C*
     C*    Get Begining date of the period for the From Date
     C*
B1   CSR   $FFP          IFEQ      1
     CSR                 Z-ADD     0             $XFP              2 0          End thru Period
     CSR                 MOVE      #BGDT         $BFDJ             6 0
X1   CSR                 ELSE
     CSR   $FFP          SUB       1             $XFP                           End Thru Period
     CSR                 MOVE      @DT($XFP)     $DAY1
     CSR                 ADD       1             $DAY1
     CSR                 MOVE      $DAY1         #SIDAT
     C*R                 CALL      'X0028   '                           83
     C*                    ---- ----------
     C*R                 PARM                    #SIDAT            6
     C*R                 PARM      *BLANK        #EDAT             8
     C*R                 PARM      '*JUL    '    #FFMT             7
     C*R                 PARM      '*JUL    '    #TFMT             7
     C*R                 PARM      '*NONE   '    #SEP              7
     C*R                 PARM      ' '           $ERTST
      *
     c                   CALL      'E1I0028 '                           83
     c                   PARM                    #SIDAT            6
     c                   PARM      *BLANK        #EDAT             8
     c                   PARM      '*JUL    '    #FFMT             7
     c                   PARM      '*JUL    '    #TFMT             7
     c                   PARM      '*NONE   '    #SEP              7
     c                   PARM      ' '           $ERTST
      *
     CSR                 MOVE      #SIDAT        $BFDJ                          add 1 end dt
E1   CSR                 ENDIF
     C*
     C*----------------------------------------------------------------
     C*
     C*    If Beginning Date is on first date of period then all no
     C*    F0911 detail needed on "from" side.
     C*
B1   CSR   #CFDT         IFEQ      $BFDJ
     CSR                 MOVE      '1'           $F911             1            No Need
X1   CSR                 ELSE
     CSR                 MOVE      '0'           $F911                          Yes Need
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    If Start Date is same as first day of the month
     C*
     CSR                 Z-ADD     $FFP          $XFP                           End From Period
B1   CSR   $GFDAJ        IFEQ      $BFDJ
     CSR                 MOVE      '1'           $F911                          No Need
X1   CSR                 ELSE
     CSR   $XFP          ADD       1             $XFP                           End From Period
E1   CSR                 ENDIF
     C*
B1   CSR   $XFP          IFLT      1
     CSR                 Z-ADD     1             $XFP                                       iod
E1   CSR                 ENDIF
     C*
B1   CSR   $XFP          IFGT      14
     CSR                 Z-ADD     14            $XFP                                       iod
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
B1   CSR   $FFP          IFEQ      #CFP
     CSR   $FFY          ANDEQ     #CFY
     C*
     C*    IF only posted data wanted, and from/thru dates are exact
     C*    period begin/end dates, no detail (F0911) required.
     C*
B2   CSR   #CFDT         IFEQ      $BFDJ
     CSR   $GTDAJ        ANDEQ     $ETDJ
     CSR                 MOVE      '1'           $F911
     CSR                 MOVE      '1'           $T911
E2   CSR                 ENDIF
     C*
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    If detail needed on "thru" side, calculate number of days in
     C*    thru date's period.
     C*
B1   CSR   $T911         IFNE      '1'
     CSR                 MOVE      $BTDJ         #SDAT1
     CSR                 MOVE      $ETDJ         #SDAT2
     CSR                 CALL      'X0035   '                           99
     C*                    ----  -----
     CSR                 PARM                    #SDAT1
     CSR                 PARM                    #SDAT2
     CSR                 PARM      '*JUL    '    #SFM1
     CSR                 PARM      '*JUL    '    #SFM2
     CSR                 PARM      *BLANK        #STYE
     CSR                 PARM      *BLANK        $ERTST
     CSR                 PARM      *BLANK        $#X
     CSR                 PARM      *BLANK        #SICT1
     CSR                 PARM                    #SICT2
     CSR                 MOVE      $#X           $NBR09            9 0
     C*
     C*    Find midpoint date of thru period by adding half of period's
     C*    total days to period's begin date.
     C*
     CSR   $NBR09        DIV       2             $NBR09
     CSR                 MOVE      $BTDJ         #SDAT1
     CSR                 MOVE      $NBR09        $#X
     CSR                 CALL      'X0035   '                           99
     C*                    ----  -----
     CSR                 PARM                    #SDAT1
     CSR                 PARM      *BLANK        #SDAT2
     CSR                 PARM      '*JUL    '    #SFM1
     CSR                 PARM      '*JUL    '    #SFM2
     CSR                 PARM      *BLANK        #STYE
     CSR                 PARM      *BLANK        $ERTST
     CSR                 PARM                    $#X
     CSR                 MOVE      #SDAT2        $JTEND            6 0
     C*
     C*    If the Ledger Type is NOT 'CA' and 'AA', then set
     C*    $OLT flag to read whole period BEYOND thru date and
     C*    then SUBTRACT detail from thru date to end of period.
     C*    Reference SAR# 972660.
     C*
     C*R                   MOVE '0'       $OLT    1
B2   C*R         #CLT      IFNE 'AA'
     C*R         #CLT      ANDNE'CA'
     C*R                   MOVE '1'       $OLT
E2   C*R                   ENDIF
     C*
     C*    If thru date is on or after midpoint, set flag to read whole
     C*    period BEYOND thru date and then SUBTRACT detail from thru
     C*    date to end of period.
     C*
B2   CSR   #CTDT         IFGE      $JTEND
     C*R         $OLT      OREQ '1'
     CSR                 MOVE      '1'           $TFST
     CSR                 ADD       1             $XTP                           End Thru Period
E2   CSR                 ENDIF
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    If detail needed on "from" side, calculate number of days in
     C*    from date's period.
     C*
B1   CSR   $F911         IFNE      '1'
     CSR                 MOVE      $BFDJ         #SDAT1
     CSR                 MOVE      $EFDJ         #SDAT2
     CSR                 CALL      'X0035   '                           99
     C*                    ----  -----
     CSR                 PARM                    #SDAT1
     CSR                 PARM                    #SDAT2
     CSR                 PARM      '*JUL    '    #SFM1
     CSR                 PARM      '*JUL    '    #SFM2
     CSR                 PARM      *BLANK        #STYE
     CSR                 PARM      *BLANK        $ERTST
     CSR                 PARM      *BLANK        $#X
     CSR                 PARM      *BLANK        #SICT1
     CSR                 PARM                    #SICT2
     CSR                 MOVE      $#X           $NBR09
     C*
     C*    Find midpoint date of from period by adding half of period's
     C*    total days to period's begin date.
     C*
     CSR   $NBR09        DIV       2             $NBR09
     CSR                 MOVE      $BFDJ         #SDAT1
     CSR                 MOVE      $NBR09        $#X
     CSR                 CALL      'X0035   '                           99
     C*                    ----  -----
     CSR                 PARM                    #SDAT1
     CSR                 PARM      *BLANK        #SDAT2
     CSR                 PARM      '*JUL    '    #SFM1
     CSR                 PARM      '*JUL    '    #SFM2
     CSR                 PARM      *BLANK        #STYE
     CSR                 PARM      *BLANK        $ERTST
     CSR                 PARM                    $#X
     CSR                 MOVE      #SDAT2        $JFEND            6 0
     C*
     C*    If from date is before midpoint, set flag to read whole
     C*    period UP TO from date and then ADD detail from beginning
     C*    of period up to from date.
     C*
B2   CSR   #CFDT         IFLT      $JFEND
     CSR                 MOVE      '1'           $FFST
     CSR                 SUB       1             $XFP                           End From Period
E2   CSR                 ENDIF
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*
     C*    Save company, dates, post flag for compare on next call.
     C*
     CSR                 MOVE      #CCO          $$CO
     CSR                 MOVE      #C#DPD        $$#DPD            2
     C*
     CSR   #CFLG1        IFEQ      '3'
     CSR                 Z-ADD     #CFDT         $FDTP             6 0          PERIOD FROM
     CSR                 Z-ADD     #CTDT         $TDTP             6 0          PERIOD THRU
     CSR                 ELSE
     CSR                 Z-ADD     #CFDT         $$FDT             6 0          CUM FROM
     CSR                 Z-ADD     #CTDT         $$TDT             6 0          CUM THRU
     CSR                 ENDIF
     C*----------------------------------------------------------------
     CSR   END05A        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S005B - Set Ledger Type
     C*    ----------------------------------
     C*
     CSR   S005B         BEGSR
     C*          -----     -----
     C*
     CSR                 MOVE      @A            @C
     CSR                 MOVE      @U            @W
     C*
B1   CSR   #CLT          IFNE      *BLANKS
     C*
     C*    Is the selected Ledger Type a Budget Ledger?, $LT1 will
     C*    hold the 2nd character of the ledger type so we can tell
     C*    if we are working with 'U'(units) or 'A'(actual amounts).
     C*
     CSR                 MOVE      *BLANKS       $LT1              1
DBN1 CSR                 MOVE      #CLT          $LT1              1
     CSR                 MOVE      #CLT          $ALT              2
     C*
     C*
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     C*    Save Ledger Value for comparison
     C*
     CSR                 MOVE      #CLT          $$LT              2
     C*----------------------------------------------------------------
     CSR   END05B        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S005C - Save off Dates
     C*    ---------------------------------
     C*
     CSR   S005C         BEGSR
     C*          -----     -----
     C*
     CSR   #CFLG1        IFEQ      '3'
     CSR                 Z-ADD     $EFDJ         $SVEFP            6 0
     CSR                 Z-ADD     $GFDAJ        $SVGFP            6 0
     CSR                 Z-ADD     $FDATJ        $SVFDP            6 0
     CSR                 Z-ADD     $HFDAJ        $SVHFP            6 0
     CSR                 Z-ADD     $BFDJ         $SVBFP            6 0
     CSR                 Z-ADD     $FFP          $SVFPP            2 0
     CSR                 Z-ADD     $FFY          $SVFYP            3 0
     CSR                 Z-ADD     $JFEND        $SVJFP            6 0
     CSR                 Z-ADD     $JTEND        $SVJTP            6 0
     CSR                 ELSE
     CSR                 Z-ADD     $EFDJ         $SVEFC            6 0
     CSR                 Z-ADD     $GFDAJ        $SVGFC            6 0
     CSR                 Z-ADD     $FDATJ        $SVFDC            6 0
     CSR                 Z-ADD     $HFDAJ        $SVHFC            6 0
     CSR                 Z-ADD     $BFDJ         $SVBFC            6 0
     CSR                 Z-ADD     $FFP          $SVFPC            2 0
     CSR                 Z-ADD     $FFY          $SVFYC            3 0
     CSR                 Z-ADD     $JFEND        $SVJFC            6 0
     CSR                 Z-ADD     $JTEND        $SVJTC            6 0
     CSR                 ENDIF
     C*
     C*
     C*
     C*----------------------------------------------------------------
     CSR   END05C        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S010 - Retrieve Balances
     C*    -----------------------------------
     C*
     CSR   S010          BEGSR
     C*          ----      -----
     C*
     C*    Retrieve balances
     C*
     CSR                 Z-ADD     $FFY          $$FY              3 0
     CSR                 MOVE      $FFY          GBFY
     CSR                 MOVE      ' '           $TWICE            1
     CSR                 Z-ADD     0             $XA               3 0
     CSR                 Z-ADD     0             $XU               3 0
     C*
     CSR                 Z-ADD     $$FY          GBFY
     CSR                 MOVEL     #CAID         GBAID
     C**DELETE             MOVE #CCTRY    GBCTRY           DEL 2667917
     CSR                 MOVE      #CTRY         GBCTRY                         ADD 2667917
     CSR                 MOVE      #CFQ          GBFQ
     CSR                 MOVE      *BLANKS       GBSBL
     CSR                 MOVE      *BLANK        GBSBLT
     CSR                 MOVE      *BLANK        GBCRCD
     C*
B1   CSR   $LT1          IFEQ      *BLANKS
     CSR                 MOVE      'AA'          GBLT
X1   CSR                 ELSE
     CSR                 MOVE      $ALT          GBLT
E1   CSR                 ENDIF
     C*
     C*    We are always looking at a specific currency when we run
     C*    this routine.
     C*
B1   CSR   GBLT          IFEQ      'AA'
     CSR   GBLT          OREQ      'CA'
     CSR                 MOVE      #CCRCD        GBCRCD
X1   CSR                 ELSE
     CSR                 MOVE      *BLANKS       GBCRCD
E1   CSR                 ENDIF
     C*
B1   CSR   $TSBL         IFNE      '*'
     CSR                 MOVE      #CSBL         GBSBL
     CSR                 MOVE      #CSBLT        GBSBLT
E1   CSR                 ENDIF
     C*
B1   CSR   GBFY          IFEQ      $FFY
     CSR                 Z-ADD     $XFP          $SP               3 0
X1   CSR                 ELSE
     CSR                 Z-ADD     1             $SP
E1   CSR                 ENDIF
     C*
B1   CSR   GBFY          IFEQ      #CFY
     CSR                 Z-ADD     $XTP          $EP               3 0
X1   CSR                 ELSE
     CSR                 Z-ADD     14            $EP
E1   CSR                 ENDIF
     C*
     CSR                 SETOFF                                       81
     C*
B1   CSR   $TSBL         IFNE      '*'
     C*R   GBKY04        CHAIN     I0902                              8181
     C     GBKY04        CHAIN     I0902LA                            8181
X1   CSR                 ELSE
     CSR   GBKYE1        CHAIN     I0902E                             8181
E1   CSR                 ENDIF
     C*
B1   CSR   *IN81         DOWEQ     '0'
     C*
B2   C**         *IN81     IFEQ '0'
     C*
     CSR                 Z-ADD     0             $WK150           15 0
     C*
B3   CSR   #CFLG1        IFEQ      '1'
     CSR                 Z-ADD     GBAPYC        $WK150           15 0
E3   CSR                 ENDIF
     C*
     C*    Retreive the F0902 balance only if the 'thru' period
     C*    is greater than or equal to the 'from' period.  If the
     C*    thru period is less than the from period, then the
     C*    entire balance will come from F0911.
     C*
B3   CSR   $EP           IFGE      $SP
     C*
     CSR                 Z-ADD     $EP           $Z                2 0
B4   CSR   $Z            DOWGE     1
     CSR                 ADD       @AN($Z)       $WK150
     CSR                 SUB       1             $Z
B5   CSR   $Z            IFLT      $SP
     CSR                 Z-ADD     0             $Z
X5   CSR                 ELSE
B6   CSR   #CFLG1        IFEQ      '3'
     CSR                 Z-ADD     0             $Z
E6   CSR                 ENDIF
E5   CSR                 ENDIF
E4   CSR                 ENDDO
E3   CSR                 ENDIF
     C*
B3   CSR   $LT1          IFEQ      'U'
     CSR                 ADD       $WK150        #CAU
X3   CSR                 ELSE
     CSR                 ADD       $WK150        #CAA
E3   CSR                 ENDIF
E2   C**                   ENDIF
     C*
B2   CSR   $TSBL         IFNE      '*'
     C*R   GBKY04        READE     I0902                                9981
     C     GBKY04        READE     I0902LA                              9981
X2   CSR                 ELSE
     CSR   GBKYE1        READE     I0902E                               9981
E2   CSR                 ENDIF
E1   CSR                 ENDDO
     C*----------------------------------------------------------------
     CSR   T010          TAG
     C*          ----      ---
     C*
     C*    If all needed info found in F0902, no detail records
     C*    needed.
     C*
B1   CSR   $T911         IFEQ      '1'
     CSR   $F911         ANDEQ     '1'
     CSR                 GOTO      END010
     C*                    ---- ------
E1   CSR                 ENDIF
     C*
     CSR                 Z-ADD     1             $CNT              3 0
     CSR                 MOVE      ' '           $REV              1
     C*
B1   CSR   $T911         IFNE      '1'
     CSR   $F911         ANDNE     '1'
     CSR                 ADD       1             $CNT              3 0
E1   CSR                 ENDIF
B1   CSR   $T911         IFNE      '1'
B2   CSR   $TFST         IFNE      '1'
     CSR                 MOVE      $BTDJ         $STDAT            6 0
     CSR                 MOVE      $GTDAJ        $ENDAT            6 0
X2   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $HTDAJ        $STDAT
     CSR                 MOVE      $ETDJ         $ENDAT
E2   CSR                 ENDIF
     CSR                 MOVE      #CFP          $FPN              2 0
     CSR                 MOVE      #CFY          $FYN              3 0
X1   CSR                 ELSE
B2   CSR   $FFST         IFNE      '1'
     CSR                 MOVE      $GFDAJ        $STDAT
     CSR                 MOVE      $EFDJ         $ENDAT
X2   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $HFDAJ        $STDAT
     CSR                 MOVE      $BFDJ         $ENDAT
E2   CSR                 ENDIF
     CSR                 MOVE      $FFP          $FPN
     CSR                 MOVE      $FFY          $FYN
E1   CSR                 ENDIF
     C*
     CSR                 Z-ADD     0             $XX               3 0
     C*
B1   CSR                 DO        $CNT
     C*
     CSR                 ADD       1             $XX
B2   CSR   $XX           IFEQ      2
B3   CSR   $FFST         IFNE      '1'
     CSR                 MOVE      ' '           $REV
     CSR                 MOVE      $GFDAJ        $STDAT
     CSR                 MOVE      $EFDJ         $ENDAT
X3   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $HFDAJ        $STDAT
     CSR                 MOVE      $BFDJ         $ENDAT
E3   CSR                 ENDIF
     CSR                 MOVE      $FFP          $FPN
     CSR                 MOVE      $FFY          $FYN
E2   CSR                 ENDIF
     C*
     C*    Convert start date and end date to G/L  format. (START DATE)
     C*
     CSR                 MOVE      #CAID         GLAID
     C*
     C*    A specific Ledger Type.
     C*    This section is for getting each 911 ledger type needed.
     C*    Specific selected Ledger Type Amount / Units
     C*
B2   CSR   $LT1          IFNE      'U'
     CSR                 MOVE      $ALT          GLLT
     CSR                 ELSE
     CSR                 MOVEL     #CLT          $ALT
     CSR                 MOVE      'A'           $ALT
     CSR                 MOVE      $ALT          GLLT
     CSR                 ENDIF
     CSR                 MOVE      #CSBL         GLSBL
     CSR                 MOVE      #CSBLT        GLSBLT
B2   CSR   GLLT          IFEQ      'AA'
B2   CSR   GLLT          OREQ      'CA'
     CSR                 MOVE      #CCRCD        GLCRCD
X2   CSR                 ELSE
     CSR                 MOVE      *BLANKS       GLCRCD
E2   CSR                 ENDIF
     CSR                 EXSR      S015
     C*                    ---- ----
B2   CSR   $LT1          IFEQ      'U'
     CSR                 ADD       $UNT          #CAU
X2   CSR                 ELSE
     CSR                 ADD       $AMT          #CAA
E2   CSR                 ENDIF
     C*
E1   CSR                 ENDDO
     C*----------------------------------------------------------------
     CSR   END010        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S015  - Accum Detail Balances
     C*    ----------------------------------------
     C*
     CSR   S015          BEGSR
     C*          ----      -----
     C*
     C*    Now get the balances to selected Ledger Type from
     C*    the F0911 file.
     C*
     CSR                 Z-ADD     $STDAT        GLDGJ
     CSR                 Z-ADD     $STDAT        $SSDAT            6 0
     CSR                 SETOFF                                       82
     CSR                 MOVE      ' '           $DAYS             1
     CSR                 Z-ADD     0             $UNT             15 0
     CSR                 Z-ADD     0             $AMT             15 0
     C*
B1   CSR   $DAYS         DOWEQ     ' '
     C*
B2   CSR   $TSBL         IFEQ      '*'
     C*R   GLKYD2        CHAIN     I0911                              8282
     C     GLKYD2        CHAIN     I0911LD                            8282
X2   CSR                 ELSE
     C*R   GLKYD1        CHAIN     I0911                              8282
     C     GLKYD1        CHAIN     I0911LD                            8282
E2   CSR                 ENDIF
     C*
B2   CSR   *IN82         DOWEQ     '0'
     C*
     C*
     CSR                 MOVE      *BLANKS       $SEL              1
B4   CSR   $FPN          IFNE      GLPN
     CSR   $FYN          ORNE      GLFY
     CSR                 SETON                                          82
E4   CSR                 ENDIF
     C*
B4   CSR   GLPOST        IFNE      'P'
     CSR                 MOVE      '1'           $SEL
E4   CSR                 ENDIF
     C*
B4   CSR   *IN82         IFEQ      '0'
     CSR   $SEL          ANDEQ     *BLANKS
     CSR                 ADD       GLAA          $AMT
     CSR                 ADD       GLU           $UNT
E4   CSR                 ENDIF                                                  IFEQ
     C*
B3   CSR   $TSBL         IFEQ      '*'
     C*R   GLKYD2        READE     I0911                                9982
     C     GLKYD2        READE     I0911LD                              9982
X3   CSR                 ELSE
     C*R   GLKYD1        READE     I0911                                9982
     C     GLKYD1        READE     I0911LD                              9982
E3   CSR                 ENDIF
     C*
E2   CSR                 ENDDO                                                  DOWEQ
     C*
     C*    Add one to the day to find the balances in the F0911 for the
     C*    next day.
     C*
     CSR                 ADD       1             $SSDAT
     CSR                 MOVE      $SSDAT        #SIDAT
     C*R                 CALL      'X0028   '                           83
     C*                    ---- ----------
     C*R                 PARM                    #SIDAT            6
     C*R                 PARM      *BLANK        #EDAT             8
     C*R                 PARM      '*JUL    '    #FFMT             7
     C*R                 PARM      '*JUL    '    #TFMT             7
     C*R                 PARM      '*NONE   '    #SEP              7
     C*R                 PARM      ' '           $ERTST
      *
     c                   CALL      'E1I0028 '                           83
     c                   PARM                    #SIDAT            6
     c                   PARM      *BLANK        #EDAT             8
     c                   PARM      '*JUL    '    #FFMT             7
     c                   PARM      '*JUL    '    #TFMT             7
     c                   PARM      '*NONE   '    #SEP              7
     c                   PARM      ' '           $ERTST
      *
     CSR                 MOVE      #SIDAT        $SSDAT
     C*
     C*    If an error is returned or if the new date is greater than
     C*    thru date then end loop. Otherwise move the new date to the
     C*    key.
     C*
B2   CSR   $ERTST        IFNE      ' '
     CSR   $SSDAT        ORGT      $ENDAT
     CSR                 MOVE      '1'           $DAYS
X2   CSR                 ELSE
     CSR                 Z-ADD     $SSDAT        GLDGJ
     CSR                 SETOFF                                       82
E2   CSR                 ENDIF
     C*
E1   CSR                 ENDDO                                                  DOWEQ (days)
     C*
B1   CSR   $REV          IFEQ      '1'
     CSR   $AMT          MULT      -1            $AMT
     CSR   $UNT          MULT      -1            $UNT
E1   CSR                 ENDIF
     C*
     CSR   END015        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S020 - Retrieve Balances W/Totals by Currency
     C*    --------------------------------------------------------
     C*
     CSR   S020          BEGSR
     C*          ----      -----
     C*
     C*    Retrieve balances
     C*
     CSR                 Z-ADD     $FFY          $$FY              3 0
     CSR                 MOVE      $FFY          GBFY
     CSR                 Z-ADD     0             $XA               3 0
     CSR                 Z-ADD     0             $XU               3 0
     CSR                 Z-ADD     1             $X                3 0
     C*
     CSR                 Z-ADD     $$FY          GBFY
     CSR                 MOVEL     #CAID         GBAID
     C**DELETE             MOVE #CCTRY    GBCTRY           DEL 2667917
     CSR                 MOVE      #CTRY         GBCTRY                         ADD 2667917
     CSR                 MOVE      #CFQ          GBFQ
     CSR                 MOVE      *BLANKS       GBSBL
     CSR                 MOVE      *BLANK        GBSBLT
     CSR                 MOVE      *BLANK        GBCRCD
     C*
B1   CSR   $LT1          IFEQ      *BLANKS
     CSR                 MOVE      'AA'          GBLT
X1   CSR                 ELSE
     CSR                 MOVE      $ALT          GBLT
E1   CSR                 ENDIF
     C*
B1   CSR   $TSBL         IFNE      '*'
     CSR                 MOVE      #CSBL         GBSBL
     CSR                 MOVE      #CSBLT        GBSBLT
E1   CSR                 ENDIF
     C*
B1   CSR   GBFY          IFEQ      $FFY
     CSR                 Z-ADD     $XFP          $SP               3 0
X1   CSR                 ELSE
     CSR                 Z-ADD     1             $SP
E1   CSR                 ENDIF
     C*
B1   CSR   GBFY          IFEQ      #CFY
     CSR                 Z-ADD     $XTP          $EP               3 0
X1   CSR                 ELSE
     CSR                 Z-ADD     14            $EP
E1   CSR                 ENDIF
     C*
     CSR                 SETOFF                                       81
     C*
B1   CSR   $TSBL         IFNE      '*'
     C*R   GBKY01        CHAIN     I0902                              8181
     C     GBKY01        CHAIN     I0902LA                            8181
X1   CSR                 ELSE
     CSR   GBKY02        CHAIN     I0902E                             8181
E1   CSR                 ENDIF
     C*
     CSR                 Z-ADD     0             $WK150           15 0
     CSR                 Z-ADD     0             $CURTL           15 0
     CSR                 Z-ADD     1             $I                2 0
     C*
B1   CSR   *IN81         DOWEQ     '0'
     C*
B2   CSR   $SCRCD        IFNE      GBCRCD
B3   CSR   $CURTL        IFNE      *ZERO
     CSR                 MOVE      $SCRCD        $CRNCY
     CSR                 MOVE      $SCRCX        $CRCX
     CSR                 Z-ADD     $CURTL        $AMNT
     CSR                 MOVE      CURTOT        @TC($I)
     CSR                 ADD       1             $I
     CSR                 Z-ADD     0             $CURTL           15 0
     CSR                 Z-ADD     0             $WK150           15 0
E3   CSR                 ENDIF
E2   CSR                 ENDIF
     C*
B2   CSR   #CFLG1        IFEQ      '1'
     CSR                 Z-ADD     GBAPYC        $WK150           15 0
     CSR                 ADD       GBAPYC        $CURTL           15 0
E2   CSR                 ENDIF
     C*
     C*    Retreive the F0902 balance only if the 'thru' period
     C*    is greater than or equal to the 'from' period.  If the
     C*    thru period is less than the from period, then the
     C*    entire balance will come from F0911.
     C*
B2   CSR   $EP           IFGE      $SP
     C*
     CSR                 Z-ADD     $EP           $Z                2 0
B3   CSR   $Z            DOWGE     1
     CSR                 ADD       @AN($Z)       $WK150
     CSR                 ADD       @AN($Z)       $CURTL
     CSR                 SUB       1             $Z
B4   CSR   $Z            IFLT      $SP
     CSR                 Z-ADD     0             $Z
X4   CSR                 ELSE
B5   CSR   #CFLG1        IFEQ      '3'
     CSR                 Z-ADD     0             $Z
E5   CSR                 ENDIF
E4   CSR                 ENDIF
E3   CSR                 ENDDO
E2   CSR                 ENDIF
     C*
B2   CSR   $LT1          IFEQ      'U'
     CSR                 ADD       $WK150        #CAU
X2   CSR                 ELSE
     CSR                 ADD       $WK150        #CAA
E2   CSR                 ENDIF
     C*
     CSR                 Z-ADD     *ZEROS        $WK150
     C*
     C*    Save off the Key to F0911 here
     C*
     CSR                 MOVE      *BLANKS       $SAID
     CSR                 MOVE      GBAID         $SAID
     CSR                 Z-ADD     GBCTRY        $SCTRY
     CSR                 Z-ADD     GBFY          $SFY
     CSR                 MOVE      GBFQ          $SFQ
     CSR                 MOVE      GBLT          $SLT
     CSR                 MOVE      *BLANKS       $SSBL
     CSR                 MOVE      GBSBL         $SSBL
     CSR                 MOVE      GBSBLT        $SSBLT
     CSR                 MOVE      GBCRCD        $SCRCD
     C*
     C*    Save the originating currency code
     C*
     CSR                 MOVE      GBCRCX        $SCRCX
     C*
B2   CSR   $TSBL         IFNE      '*'
     C*R   GBKY01        READE     I0902                                9981
     C     GBKY01        READE     I0902LA                              9981
X2   CSR                 ELSE
     CSR   GBKY02        READE     I0902E                               9981
E2   CSR                 ENDIF
     C*
     C*    Get 911 balances here when the subledger, subledger type,
     C*    or currency code changes or when an end of file is read.
     C*
B2   CSR   GBCRCD        IFNE      $SCRCD
     CSR   GBSBL         ORNE      $SSBL
     CSR   GBSBLT        ORNE      $SSBLT
     CSR   *IN81         OREQ      '1'
     CSR                 EXSR      S022
     C*                    ---- ----
E2   CSR                 ENDIF
     C*
E1   CSR                 ENDDO
     C*
B1   CSR   $CURTL        IFNE      *ZERO
     CSR                 MOVE      $SCRCD        $CRNCY
     CSR                 MOVE      $SCRCX        $CRCX
     CSR                 Z-ADD     $CURTL        $AMNT
     CSR                 MOVE      CURTOT        @TC($I)
     CSR                 Z-ADD     0             $CURTL           15 0
E1   CSR                 ENDIF
     C*----------------------------------------------------------------
     CSR   T020          TAG
     C*          ----      ---
     C*----------------------------------------------------------------
     CSR   END020        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S022  -Accum Detail Balances W/Totals by Currency
     C*    ------------------------------------------------------------
     C*
     CSR   S022          BEGSR
     C*          ----      -----
     C*
     C*    If all needed info found in F0902, no detail records
     C*    needed.
     C*
B1   CSR   $T911         IFEQ      '1'
     CSR   $F911         ANDEQ     '1'
     CSR                 GOTO      END022
     C*                    ---- ------
E1   CSR                 ENDIF
     C*
     CSR                 Z-ADD     1             $CNT              3 0
     CSR                 MOVE      ' '           $REV              1
     C*
B1   CSR   $T911         IFNE      '1'
     CSR   $F911         ANDNE     '1'
     CSR                 ADD       1             $CNT              3 0
E1   CSR                 ENDIF
B1   CSR   $T911         IFNE      '1'
B2   CSR   $TFST         IFNE      '1'
     CSR                 MOVE      $BTDJ         $STDAT            6 0
     CSR                 MOVE      $GTDAJ        $ENDAT            6 0
X2   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $HTDAJ        $STDAT
     CSR                 MOVE      $ETDJ         $ENDAT
E2   CSR                 ENDIF
     CSR                 MOVE      #CFP          $FPN              2 0
     CSR                 MOVE      #CFY          $FYN              3 0
X1   CSR                 ELSE
B2   CSR   $FFST         IFNE      '1'
     CSR                 MOVE      $GFDAJ        $STDAT
     CSR                 MOVE      $EFDJ         $ENDAT
X2   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $BFDJ         $STDAT
     CSR                 MOVE      $HFDAJ        $ENDAT
E2   CSR                 ENDIF
     CSR                 MOVE      $FFP          $FPN
     CSR                 MOVE      $FFY          $FYN
E1   CSR                 ENDIF
     C*
     CSR                 Z-ADD     0             $XX               3 0
     C*
B1   CSR                 DO        $CNT
     C*
     CSR                 ADD       1             $XX
B2   CSR   $XX           IFEQ      2
B3   CSR   $FFST         IFNE      '1'
     CSR                 MOVE      ' '           $REV
     CSR                 MOVE      $GFDAJ        $STDAT
     CSR                 MOVE      $EFDJ         $ENDAT
X3   CSR                 ELSE
     CSR                 MOVE      '1'           $REV
     CSR                 MOVE      $BFDJ         $STDAT
     CSR                 MOVE      $HFDAJ        $ENDAT
E3   CSR                 ENDIF
     CSR                 MOVE      $FFP          $FPN
     CSR                 MOVE      $FFY          $FYN
E2   CSR                 ENDIF
     C*
     C*    Convert start date and end date to G/L  format. (START DATE)
     C*
     CSR                 MOVE      $SAID         GLAID
     CSR                 Z-ADD     $SCTRY        GLCTRY
     CSR                 Z-ADD     $SFY          GLFY
     CSR                 MOVE      $SFQ          GLFQ
B2   CSR   $LT1          IFNE      'U'
     CSR                 MOVE      $SLT          GLLT
     CSR                 ELSE
     CSR                 MOVEL     #CLT          $SLT
     CSR                 MOVE      'A'           $SLT
     CSR                 MOVE      $SLT          GLLT
     CSR                 ENDIF
     CSR                 MOVE      *BLANKS       GLSBL
     CSR                 MOVE      $SSBL         GLSBL
     CSR                 MOVE      $SSBLT        GLSBLT
     CSR                 MOVE      $SCRCD        GLCRCD
     C*
     CSR                 EXSR      S025
     C*                    ---- ----
     CSR                 ADD       $AMT          #CAA
     CSR                 ADD       $UNT          #CAU
B2   CSR   $LT1          IFEQ      'U'
     CSR                 ADD       $UNT          $CURTL
X2   CSR                 ELSE
     CSR                 ADD       $AMT          $CURTL
E2   CSR                 ENDIF
E1   CSR                 ENDDO
     C*----------------------------------------------------------------
     CSR   END022        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S025  -Accum Detail Balances W/Totals by Currency
     C*    ------------------------------------------------------------
     C*
     CSR   S025          BEGSR
     C*          ----      -----
     C*
     C*    Now get the balances to selected Ledger Type from
     C*    the F0911 file.
     C*
     CSR                 Z-ADD     $FPN          GLPN
     CSR                 SETOFF                                       82
     CSR                 Z-ADD     0             $UNT             15 0
     CSR                 Z-ADD     0             $AMT             15 0
     CSR                 MOVE      '0'           $SKIP             1
     C*
B1   CSR   $SCRCD        IFNE      *BLANK
     CSR   GLKY01        CHAIN     I0911N                             8282
X1   CSR                 ELSE
     CSR   GLKY02        CHAIN     I0911N                             8282
E1   CSR                 ENDIF
     C*
B1   CSR   *IN82         DOWEQ     '0'
     C*
     C*
     C*    Check to see if the record read is within the date range.
     C*
B3   CSR   GLDGJ         IFGT      $ENDAT
     CSR   GLDGJ         ORLT      $STDAT
     CSR                 MOVE      '1'           $SKIP
     C*
X3   CSR                 ELSE
     CSR                 MOVE      '0'           $SKIP
E3   CSR                 ENDIF
     C*
B3   CSR   $SKIP         IFEQ      '0'
     CSR                 ADD       GLAA          $AMT
     CSR                 ADD       GLU           $UNT
E3   CSR                 ENDIF                                                  IFEQ
     C*
B2   CSR   $SCRCD        IFNE      *BLANK
     CSR   GLKY01        READE     I0911N                               9982
X2   CSR                 ELSE
     CSR   GLKY02        READE     I0911N                               9982
E2   CSR                 ENDIF
     C*
E1   CSR                 ENDDO                                                  DOWEQ
     C*
B1   CSR   $REV          IFEQ      '1'
     CSR   $AMT          MULT      -1            $AMT
     CSR   $UNT          MULT      -1            $UNT
E1   CSR                 ENDIF
     C*
     CSR   END025        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE S999  - Housekeeping
     C*    -------------------------------
     C*
     C*    Processing:  1.  Passed parameters.
     C*                 2.  Load system date.
     C*
     CSR   S999          BEGSR
     C*          ----      -----
     C*
     C*    Required program parameters.
     C*
     CSR   *ENTRY        PLIST
     CSR                 PARM                    PSDS1           100
     CSR                 PARM                    PSDS2           100
     CSR                 PARM                    @TC
     C*
     CSR                 MOVE      PSDS1         #PRM1
     CSR                 MOVE      PSDS2         #PRM2
     C*
     C*    Set flags to determine if we are looking at all currencies
     C*    and/or all subledgers.
     C*
DBN  CSR                 MOVEL     #CCRCD        $TCRCD            1
DBN  CSR                 MOVEL     #CSBL         $TSBL             1
     C*
     C*    Special Return Logic.
     C*
     CSR   #CRTN         CABEQ     '1'           END999
     C*                    -----          ------
     CSR   #CRTN         CABEQ     '2'           END999                   LR
     C*                    -----          ------
     C*
     CSR                 MOVE      '1'           #CRTN
     C*
     C*    Retrieve Company Currency Code
     C*    override if doing foreign currency
     C*
     CSR                 MOVE      *BLANK        $CCRCD            3
B1   CSR   $@CNV         IFEQ      '1'
     CSR                 MOVE      #CO           CCCO
     C*R   CCCO          CHAIN     I0010                              8399
     C     CCCO          CHAIN     I0010L1                            8399
B2   CSR   *IN83         IFEQ      '0'
     CSR                 MOVE      CCCRCD        $CCRCD
X2   CSR                 ELSE
     CSR                 MOVE      '00000'       CCCO
     C*R   CCCO          CHAIN     I0010                              8399
     C     CCCO          CHAIN     I0010L1                            8399
     CSR                 MOVE      CCCRCD        $CCRCD
E2   CSR                 ENDIF
E1   CSR                 ENDIF
     C*
     CSR   END999        ENDSR
     C*****************************************************************
     C*
     C*    SUBROUTINE *INZSR - Initial subroutine - first time only
     C*    --------------------------------------------------------
     C*
     C*    Processing:
     C*                 1.  Initialized work fields
     C*                 2.  Retrieve constants
     C*                 3.  Define Key Lists
     C*                 4.  Define Like Work Fields
     C*
     CSR   *INZSR        BEGSR
     C*          ------    -----
     C*----------------------------------------------------------------
     C*
     C*    Initialize work fields.
     C*
     CSR                 MOVE      *HIVAL        $$CO
     CSR                 Z-ADD     999999        $$FDT             6 0
     CSR                 Z-ADD     999999        $$TDT             6 0
     C*----------------------------------------------------------------
     C*
     C*    Retrieve constant record for currency conversion
     C*
     C*R   '00000'       CHAIN     I0010                              8199
     C     '00000'       CHAIN     I0010L1                            8199
B1   CSR   *IN81         IFEQ      '0'
B2   CSR   CCCRYR        IFEQ      'Y'
     CSR   CCCRYR        OREQ      'Z'
     CSR   CCCRYR        OREQ      'S'
     CSR                 MOVE      '1'           $@CNV             1
E2   CSR                 ENDIF
E1   CSR                 ENDIF
     C*
     C*----------------------------------------------------------------
     C*
     C*    Key list for - LF - Acct ID, Century,FY,FQ,LT,SBL,SBLT
     C*    (F0902LA)
     C*
     CSR   GBKY01        KLIST
     CSR                 KFLD                    GBAID
     CSR                 KFLD                    GBCTRY
     CSR                 KFLD                    GBFY
     CSR                 KFLD                    GBFQ
     CSR                 KFLD                    GBLT
     CSR                 KFLD                    GBSBL
     CSR                 KFLD                    GBSBLT
     C*
     C*    Key list for - LF - Acct ID, Century,FY,FQ,LT
     C*    (F0902LA)
     C*
     CSR   GBKY02        KLIST
     CSR                 KFLD                    GBAID
     CSR                 KFLD                    GBCTRY
     CSR                 KFLD                    GBFY
     CSR                 KFLD                    GBFQ
     CSR                 KFLD                    GBLT
     C*
     C*    Key list for - LF - Acct ID, Century, FY,FQ
     C*    (F0902LA)
     C*
     CSR   GBKY03        KLIST
     CSR                 KFLD                    GBAID
     CSR                 KFLD                    GBCTRY
     CSR                 KFLD                    GBFY
     CSR                 KFLD                    GBFQ
     C*
     C*    Key list for - LF - Acct ID, Century,FY,FQ,LT,SBL,SBLT,CRCD
     C*    (F0902LA)
     C*
     CSR   GBKY04        KLIST
     CSR                 KFLD                    GBAID
     CSR                 KFLD                    GBCTRY
     CSR                 KFLD                    GBFY
     CSR                 KFLD                    GBFQ
     CSR                 KFLD                    GBLT
     CSR                 KFLD                    GBSBL
     CSR                 KFLD                    GBSBLT
     CSR                 KFLD                    GBCRCD
     C*----------------------------------------------------------------
     C*
     C*    Key list for - LF - Acct ID, Century,FY,FQ,LT,SBL,SBLT
     C*    (F0902LE)
     C*
     CSR   GBKYE1        KLIST
     CSR                 KFLD                    GBAID
     CSR                 KFLD                    GBCTRY
     CSR                 KFLD                    GBFY
     CSR                 KFLD                    GBFQ
     CSR                 KFLD                    GBLT
     CSR                 KFLD                    GBCRCD
     C*----------------------------------------------------------------
     C*
     C*    Key list for - LF - Acct ID, Century, Ficsal Year, Fiscal Qu
     C*    (F0911LN)
     CSR   GLKY01        KLIST
     CSR                 KFLD                    GLAID
     CSR                 KFLD                    GLCTRY
     CSR                 KFLD                    GLFY
     CSR                 KFLD                    GLFQ
     CSR                 KFLD                    GLLT
     CSR                 KFLD                    GLSBL
     CSR                 KFLD                    GLSBLT
     CSR                 KFLD                    GLCRCD
     CSR                 KFLD                    GLPN
     C*
     C*    Key list for - LF - Acct ID, Century, Ficsal Year, Fiscal Qu
     C*    (F0911LN)
     CSR   GLKY02        KLIST
     CSR                 KFLD                    GLAID
     CSR                 KFLD                    GLCTRY
     CSR                 KFLD                    GLFY
     CSR                 KFLD                    GLFQ
     CSR                 KFLD                    GLLT
     CSR                 KFLD                    GLSBL
     CSR                 KFLD                    GLSBLT
     C*----------------------------------------------------------------
     C*
     C*    Key list for - LF - Acct ID, Ledger Type, G/L Date, Currency
     C*    (F0911LD)
     CSR   GLKYD1        KLIST
     CSR                 KFLD                    GLAID
     CSR                 KFLD                    GLLT
     CSR                 KFLD                    GLDGJ
     CSR                 KFLD                    GLCRCD
     CSR                 KFLD                    GLSBL
     CSR                 KFLD                    GLSBLT
     C*
     C*    Key list for - LF - Acct ID, Ledger Type, G/L Date, Currency
     C*    (F0911LD)
     CSR   GLKYD2        KLIST
     CSR                 KFLD                    GLAID
     CSR                 KFLD                    GLLT
     CSR                 KFLD                    GLDGJ
     CSR                 KFLD                    GLCRCD
     C*----------------------------------------------------------------
     C*
     C*    Define work fields from file definitions.
     C*
     CSR   *LIKE         DEFINE    CCCO          $$CO
     CSR   *LIKE         DEFINE    CCCO          #CO
     CSR   *LIKE         DEFINE    GLAID         $SAID
     CSR   *LIKE         DEFINE    GLCTRY        $SCTRY
     CSR   *LIKE         DEFINE    GLFY          $SFY
     CSR   *LIKE         DEFINE    GLFQ          $SFQ
     CSR   *LIKE         DEFINE    GLLT          $SLT
     CSR   *LIKE         DEFINE    GLSBL         $SSBL
     CSR   *LIKE         DEFINE    GLSBLT        $SSBLT
     CSR   *LIKE         DEFINE    GLCRCD        $SCRCD
     CSR   *LIKE         DEFINE    GBCRCX        $SCRCX
     C*
     C*
     CSR   EINZSR        ENDSR
     C*****************************************************************
     C*
     C*    Copy Common Subroutine - Right Justify Numeric Fields
     C*
     C*/COPY JDECPY,C0012
     C**************************************************************
     C*  This is part of a composite common subroutine. In
     C*  order for the subroutine to work correctly, the
     C*  RPG program must /COPY in the following members:
     C*   E0012, C0012
     C**************************************************************************
    C*    REVISION LOG
    C*    ------------
    C*
    C*          Date     Programmer     Nature of Revision
    C*        --------   ----------  ------------------------------------
    C*        12/11/97   BECK        SAR# 1810110
    C*
     C**************************************************************************
     C*    MAINLINE PROGRAM
     C*    ----------------
     C*
     C*
     C*     SUBROUTINE C0012 - Right Justify Numeric Fields
     C*     -----------------------------------------------
     C*
     C*  PURPOSE
     C*  -------
     C*       To provide a subroutine common to all programs which
     C*       right justifies numeric fields and places the sign over
     C*       the low order byte of the fields, designated by either a
     C*       leading or trailing minus sign.  This routine also ignores
     C*       all non-numeric characters in the input field, and
     C*       determines the placement of the decimal point.
     C*
     C*  REMARKS
     C*  -------
     C*
     C*       Prior to executing this subroutine data from an
     C*       alphanumeric input field should be placed in the array
     C*       named '@NM' with a 'MOVEA' command.  The right justified
     C*       number is available from the subroutine field named
     C*       '#NUMR', which is a 15 digit 6 decimal field.
     C*       CAUTION: The largest number that can be handled
     C*       by this subroutine is 999,999,999.999999.
     C*       However, the input field may contain only 15
     C*       numbers.
     C*
     CSR   C0012         BEGSR
     C*          -----     -----
     C*
     CSR                 Z-ADD     0             #NUMR            29 9
     CSR                 Z-ADD     0             #NUMR2           15 2          Compile only
     CSR                 Z-ADD     0             #NUMR9           15 9          Compile only
     C*
     CSR                 MOVEA     @NM           #ALNUM           22
     CSR   #ALNUM        CABEQ     *BLANKS       EN0012
     CSR                 SETOFF                                       818384
     CSR                 MOVEA     *ALL'0'       @N2
     CSR                 Z-ADD     0             #K1               3 0
     CSR                 Z-ADD     0             #K2               3 0
     CSR                 Z-ADD     0             Q#                3 0
     CSR                 Z-ADD     0             J#                3 0
     CSR                 Z-ADD     0             M#                3 0
     C*
     C*    Retrieve date separation and decimal format characters.
     C*
     CSR   ###1          IFEQ      ' '                                          Do once
     CSR                 MOVE      '1'           ###1              1
     CSR                 CALL      'X00SFMT '                           81
     C*                    ---- ----------
     CSR                 PARM      '/'           ###DS             1
     CSR                 PARM      ' '           ###DF             1
     CSR                 MOVE      '.'           ###DC             1
     CSR   ###DF         IFEQ      'J'
     CSR   ###DF         OREQ      'I'
     CSR                 MOVE      ','           ###DC
     CSR                 END
     CSR                 MOVE      ' '           ###EQ             1
     CSR   ###DS         IFEQ      ###DC
     CSR                 MOVE      '1'           ###EQ
     CSR                 END
     CSR                 END
     C*
     C*    If date separator character equals decimal format character,
     C*    Test for multiple decimal point characters and replace with
     C*    US standard date separator character(/).
     C*
     CSR   ###EQ         IFEQ      '1'
     C*
     CSR                 Z-ADD     0             Q#
     CSR                 DO        22            M#
     CSR   @NM(M#)       IFEQ      ###DC
     CSR                 ADD       001           Q#
     CSR                 END
     CSR                 END
     C*
     CSR   Q#            IFGT      1
     CSR                 DO        22            M#
     CSR   @NM(M#)       IFEQ      ###DC
     CSR                 MOVE      '/'           @NM(M#)
     CSR                 END
     CSR                 END
     CSR                 END
     C*
     CSR                 MOVEA     @NM           #ALNUM
     CSR                 END
     C*
     C*    Initialize beginning and ending scan positions.
     C*
     CSR                 Z-ADD     +1            #LOW              3 0
     CSR                 Z-ADD     +22           #HIGH             3 0
     C*
     C*    Find first non-blank character.
     C*
     CSR   ' '           CHECK     #ALNUM        #LOW
     C*
     C*    Find last non-blank character.
     C*
     CSR   ' '           CHECKR    #ALNUM        #HIGH
     C*
     C*    Test minus sign.
     C*    String may be surrounded by quotes... ( dftval from DD )
     C*
     C* &&&      '-'       SCAN #ALNUM                   83
     CSR                 Z-ADD     #LOW          M#
     CSR   @NM(M#)       IFEQ      ''''
     CSR                 ADD       +1            M#
     CSR                 ENDIF
     C*
     CSR   @NM(M#)       COMP      '-'                                    83
     C*
     CSR   *IN83         IFEQ      '0'
     CSR                 Z-ADD     #HIGH         M#
     CSR   @NM(M#)       IFEQ      ''''
     CSR   M#            ANDGT     +1
     CSR                 SUB       1             M#
     CSR                 ENDIF
     C*
     CSR   @NM(M#)       COMP      '-'                                    83
     CSR                 ENDIF
     C*
     C*    Scrub numeric value.
     C*
     CSR                 Z-ADD     #HIGH         M#
     CSR                 Z-ADD     22            Q#
     CSR                 SUB       1             #LOW
     CSR   M#            DOWGT     #LOW
     CSR                 MOVE      @NM(M#)       @NMM#             1
     CSR   @NMM#         IFNE      *BLANKS
     CSR   @NMM#         IFGE      '0'
     CSR   @NMM#         ANDLE     '9'
     CSR   *IN84         IFEQ      '0'
     CSR                 ADD       001           #K1
     CSR                 END
     CSR                 MOVE      @NMM#         @N2(Q#)
     CSR                 SUB       01            Q#
     CSR                 END
     C*
     C*    If decimal point not already found, test for decimal.
     C*
     CSR   *IN84         IFEQ      '0'
     CSR   @NMM#         COMP      ###DC                                  84
     CSR                 END
     C*
     CSR                 END
     CSR                 SUB       001           M#
     CSR                 END
     C*
     C*    Move whole scrubbed number to work field.
     C*
     CSR                 MOVEA     @N2           #ALNUM
     CSR                 MOVE      #ALNUM        #WK29            29 0
     CSR                 Z-ADD     1             #MULTX           11 9
     CSR                 Z-ADD     1             #MULTY           11 9
     C*
     C*    Set up divisor for decimal positions.
     C*
     CSR   *IN84         IFEQ      '1'                                          DECIMAL FND
     CSR   #K1           IFGT      9
     CSR   #K1           SUB       9             #K2
     CSR                 DO        #K2
     CSR                 MULT      .1            #MULTY
     CSR                 END
     CSR                 Z-ADD     9             #K1
     CSR                 END
     CSR                 DO        #K1
     CSR                 MULT      .1            #MULTX
     CSR                 END
     CSR                 ELSE
     CSR                 Z-ADD     0             #K1
     CSR                 Z-ADD     0             #K2
     CSR                 END
     C*
     C*    If negative number, reverse sign on result.
     C*
     CSR   *IN83         IFEQ      '1'
     CSR                 MULT      -1            #WK29
     CSR                 END
     C*
     C*    Position decimal point in result.
     C*
     CSR   #WK29         MULT      #MULTX        #NUMR            29 9
     CSR   #K2           IFGT      0
     CSR                 MULT      #MULTY        #NUMR
     CSR                 END
     C*
     C*    Test for truncation of high value digits.
     C*
     CSR   6             SUB       #K1           M#
     CSR                 ADD       7             M#
     CSR                 Z-ADD     1             Q#
     CSR                 MOVE      ' '           #HV#              1
     CSR   Q#            DOWLE     M#
     CSR   @N2(Q#)       IFGT      '0'
     CSR                 MOVE      '1'           #HV#
     CSR                 Z-ADD     M#            Q#
     CSR                 END
     CSR                 ADD       01            Q#
     CSR                 END
     CSR   #HV#          IFEQ      '1'
     CSR   #WK29         MULT(H)   #MULTX        #NUMR2
     CSR   #K2           IFGT      0
     CSR                 MULT(H)   #MULTY        #NUMR2
     CSR                 END
     CSR                 END
     C*
     C*    Test for truncation of low value digits.
     C*
     CSR                 Z-ADD     0             $NBR3             3 0
     CSR   #K1           IFGT      6
     CSR                 Z-ADD     0             $NBR3
     CSR                 MOVE      #WK29         $NBR1             1 0
     CSR                 MOVE      $NBR1         $NBR3
     CSR                 END
     CSR   #K1           IFGT      7
     CSR                 Z-ADD     0             $NBR3
     CSR                 MOVE      #WK29         $NBR2             2 0
     CSR                 Z-ADD     $NBR2         $NBR3
     CSR                 END
     CSR   #K1           IFGT      8
     CSR                 MOVE      #WK29         $NBR3             3 0
     CSR                 END
     CSR   $NBR3         IFNE      0
     CSR   #WK29         MULT      #MULTX        #NUMR9
     CSR   #K2           IFGT      0
     CSR                 MULT      #MULTY        #NUMR9
     CSR                 END
     CSR                 END
     C*
     CSR                 MOVEA     *BLANK        @NM
     C*
     CSR   EN0012        ENDSR
     C*****************************************************************
