// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMFRXFR
// ?Date: 14.08.2025 Time: 03:42:58
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?*********************
//?Download ISC Worksheets and 5 downloads from MISC Menu to mail groups
//?  per company:  ISC Downloads - 360   /   ISC Downloads - 960
//?Run 5 downloads automatically??  NO for now 04/10/07- YES-4/30/07
//?*********************
//?Defaults to run from the Scheduler after ISC is run:
//? Download W/Q/B:   download Both from Sched
// PAR.Download Wgt or Qty usr = CND.Both
PAR.Download_Wgt_or_Qty_usr = 'B';

//?Combine whse values:  No
// PAR.Status - Y or N = CND.no
PAR.Status_Y_or_N = 'N';

//?Qry Select on company:  No
// PAR.Status Flag 1  Y/N = CND.No
PAR.Status_Flag_1_Y_N = 'N';

// PAR.ISC Week Ending Date = CVTVAR(PAR.Date (Char-8) USR)
PAR.ISC_Week_Ending_Date = CVTVAR(PAR.Date_Char_8_USR);

// WRK.Date (Char-8) USR = PAR.Date (Char-8) USR
WRK.Date_Char_8_USR = PAR.Date_Char_8_USR;

// WRK.Date (Char-6) USR = SUBSTRING(WRK.Date (Char-8) USR,CON.3,CON.6)
WRK.Date_Char_6_USR = SUBSTRING(WRK.Date_Char_8_USR:3:6);

// WRK.Date (Alpha) USR = CONCAT(CON.1,WRK.Date (Char-6) USR,CND.*None)
WRK.Date_Alpha_USR = '1' + WRK.Date_Char_6_USR (*ZERO);

// WRK.To Date               USR = CVTVAR(WRK.Date (Alpha) USR)
WRK.To_Date_USR = CVTVAR(WRK.Date_Alpha_USR);

//?Run 5 downloads automatically??  NO for now 04/10/07
//?Run 5 downloads automatically??  YES now 04/30/07
// WRK.Status Flag 2  Y/N = CND.Yes
WRK.Status_Flag_2_Y_N = 'Y';

//?  Call RTV to read Plant companies only
//?R9083 05/08/17 DN-Added ISC Valuation Grouping to Parm.
EXECUTE FUNCTION(RTV Co -ISC Workf Bld RT) TYPE(RTVOBJ) FILE(CAABREP)           AC1814683;
PARAMETER(*ZERO);
PARAMETER(*BLANK);
PARAMETER(WRK.To_Date_USR);
PARAMETER(PAR.ISC_Week_Ending_Date);
PARAMETER(PAR.Status_Y_or_N);
PARAMETER(PAR.Download_Wgt_or_Qty_usr);
PARAMETER(PAR.Status_Flag_1_Y_N);
PARAMETER(WRK.Status_Flag_2_Y_N);
PARAMETER(PAR.ISC_Valuation_Grouping);
{
 //?USER: Process Data record

 //?**************************************************************************
 //?**     Run for each Plant company
 //?**************************************************************************
 CASE;

 // IF DB1.Company Number is not equal to zero
 IF DB1.Company_Number <> *ZERO;

 EXECUTE FUNCTION(Rtv Plant Co Status   RT) TYPE(RTVOBJ) FILE(PDJYREP)           AC1761084;
 PARAMETER(DB1.Company_Number);
 PARAMETER(WRK.Plant_Company_Sts);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?R9083 05/08/17 DN-Get Valuation Grouping per Company.
 CASE;

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Desc & Val Alpha  RT) TYPE(RTVOBJ) FILE(PDKMREP)           AC2131892;
 PARAMETER(DB1.Company_Number);
 PARAMETER('IVFGROUP');
 PARAMETER(NLL.Description);
 PARAMETER(LCL.ISC_Valuation_Grouping);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 ENDIF;

 //?R9083 05/08/17 DN-Added Compound Condition c2 to Check Grouping.
 CASE;

 // IF WRK.Plant Company Sts is Plant Company
 IF WRK.Plant_Company_Sts = 'P';

 // AND PAR.ISC Valuation Grouping EQ LCL.ISC Valuation Grouping
 AND PAR.ISC_Valuation_Grouping = LCL.ISC_Valuation_Grouping;

 EXECUTE FUNCTION(Rtv Date/Time         RT) TYPE(RTVOBJ) FILE(PMA5REP)           AC1831861;
 PARAMETER(DB1.Company_Number);
 PARAMETER('RR');
 PARAMETER(LCL.ISC_From_Time);
 PARAMETER(LCL.ISC_To_Time);
 PARAMETER(PAR.To_Date_USR);
 PARAMETER(PAR.From_Date_USR);
 PARAMETER(LCL.Thru_Date_USR);
 {
  //?USER: Process Data record

  // PAR.ISC From Time = DB1.ISC From Time
  PAR.ISC_From_Time = DB1.ISC_From_Time;

  // PAR.ISC To Time = DB1.ISC To Time
  PAR.ISC_To_Time = DB1.ISC_To_Time;

  EXECUTE FUNCTION(Rtv Prior Day per par RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831878;
  PARAMETER(DB1.Company_Number);
  PARAMETER(PAR.Date_USR);
  PARAMETER(DB1.ISC_From_Day_of_week);
  PARAMETER(PAR.From_Date_USR);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   CASE;

   // IF DB1.Day of Week EQ PAR.Day of Week
   IF DB1.Day_of_Week = PAR.Day_of_Week;

   // PAR.Date Mon USR = DB1.Post to G/L Date
   PAR.Date_Mon_USR = DB1.Post_to_G_L_Date;

   QUIT;

   ENDIF;

  }

  EXECUTE FUNCTION(RTV Next Day per par  RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831883;
  PARAMETER(DB1.Company_Number);
  PARAMETER(PAR.Date_USR);
  PARAMETER(DB1.ISC_To_Day_of_Week);
  PARAMETER(PAR.Thru_Date_USR);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   CASE;

   // IF DB1.Day of Week EQ PAR.Day of Week
   IF DB1.Day_of_Week = PAR.Day_of_Week;

   // PAR.Scheduled Ship Date = DB1.Post to G/L Date
   PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

   QUIT;

   ENDIF;

  }

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 // WRK.ISC Warehouse Company = DB1.Company Number
 WRK.ISC_Warehouse_Company = DB1.Company_Number;

 // WRK.ISC Warehouse Code = CON.*BLANK
 WRK.ISC_Warehouse_Code = *BLANK;

 // Call program Rtv Alpha Value       XF.
 CALL PROGRAM(Rtv Alpha Value       XF) ('POMTXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER('ISCEMAIL');
 PARAMETER(WRK.Email_Address);

 // Call program Exc Bld Workf Dwnld   XF.
 SBMJOB;
 CALL PROGRAM(Exc Bld Workf Dwnld   XF) ('PME6XFR');
 PARAMETER(WRK.ISC_Warehouse_Company);
 PARAMETER(WRK.ISC_Warehouse_Code);
 PARAMETER(PAR.From_Date_USR);
 PARAMETER(LCL.Thru_Date_USR);
 PARAMETER(PAR.ISC_Week_Ending_Date);
 PARAMETER(PAR.Status_Y_or_N);
 PARAMETER(PAR.Download_Wgt_or_Qty_usr);
 PARAMETER(PAR.Status_Flag_1_Y_N);
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 PARAMETER(LCL.ISC_From_Time);
 PARAMETER(LCL.ISC_To_Time);
 SBMJOBOVR JOB(ISCWORKSHT);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?Run 5 downloads automatically???
 CASE;

 // IF PAR.Status Flag 2  Y/N is Yes
 IF PAR.Status_Flag_2_Y_N = 'Y';

 //?Auto run 5 downloads from Stock Closing menu:::
 // WRK.Company Number Pass   USR = DB1.Company Number
 WRK.Company_Number_Pass_USR = DB1.Company_Number;

 // WRK.Date 1          PASS  USR = PAR.From Date             USR
 WRK.Date_1_PASS_USR = PAR.From_Date_USR;

 // WRK.Date 2          PASS  USR = PAR.To Date               USR
 WRK.Date_2_PASS_USR = PAR.To_Date_USR;

 EXECUTE FUNCTION(Rtv Prior Sunday      RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1410775;
 PARAMETER(WRK.ISC_Warehouse_Company);
 PARAMETER(PAR.To_Date_USR);
 PARAMETER(WRK.Date_Sun_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week is Sunday
  IF DB1.Day_of_Week = '1';

  // PAR.Date Sun USR = DB1.Post to G/L Date
  PAR.Date_Sun_USR = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

 //?  Prior Monday 6:00 thru Monday 5:59--> Get from ctl file  06/29/07 RMC
 EXECUTE FUNCTION(Rtv Date/Time         RT) TYPE(RTVOBJ) FILE(PMA5REP)           AC1831861;
 PARAMETER(WRK.ISC_Warehouse_Company);
 PARAMETER('RR');
 PARAMETER(LCL.ISC_From_Time);
 PARAMETER(LCL.ISC_To_Time);
 PARAMETER(PAR.To_Date_USR);
 PARAMETER(PAR.From_Date_USR);
 PARAMETER(WRK.Date_Mon_USR);
 {
  //?USER: Process Data record

  // PAR.ISC From Time = DB1.ISC From Time
  PAR.ISC_From_Time = DB1.ISC_From_Time;

  // PAR.ISC To Time = DB1.ISC To Time
  PAR.ISC_To_Time = DB1.ISC_To_Time;

  EXECUTE FUNCTION(Rtv Prior Day per par RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831878;
  PARAMETER(DB1.Company_Number);
  PARAMETER(PAR.Date_USR);
  PARAMETER(DB1.ISC_From_Day_of_week);
  PARAMETER(PAR.From_Date_USR);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   CASE;

   // IF DB1.Day of Week EQ PAR.Day of Week
   IF DB1.Day_of_Week = PAR.Day_of_Week;

   // PAR.Date Mon USR = DB1.Post to G/L Date
   PAR.Date_Mon_USR = DB1.Post_to_G_L_Date;

   QUIT;

   ENDIF;

  }

  EXECUTE FUNCTION(RTV Next Day per par  RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC1831883;
  PARAMETER(DB1.Company_Number);
  PARAMETER(PAR.Date_USR);
  PARAMETER(DB1.ISC_To_Day_of_Week);
  PARAMETER(PAR.Thru_Date_USR);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   CASE;

   // IF DB1.Day of Week EQ PAR.Day of Week
   IF DB1.Day_of_Week = PAR.Day_of_Week;

   // PAR.Scheduled Ship Date = DB1.Post to G/L Date
   PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

   QUIT;

   ENDIF;

  }

 }

 // WRK.Date 2          PASS  USR = WRK.Date Mon USR
 WRK.Date_2_PASS_USR = WRK.Date_Mon_USR;

 // Call program PMT Pass for Prod Dwn UP.
 SBMJOB;
 CALL PROGRAM(PMT Pass for Prod Dwn UP) ('POFIUPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(WRK.Company_Number_Pass_USR);
 PARAMETER(WRK.Date_1_PASS_USR);
 PARAMETER(WRK.Date_2_PASS_USR);
 PARAMETER(*BLANK);
 PARAMETER(LCL.ISC_From_Time);
 PARAMETER(LCL.ISC_To_Time);
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 SBMJOBOVR JOB(DWNLD_PROD);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?  As of current date - 1 day
 // WRK.Date In = JOB.*Job date + CON.-1 *DAYS
 WRK.Date_In = DATEINCR(JOB.*Job_date '-1' 'DY' 1111111 'NONE' 'N' 1);

 // WRK.Date 1          PASS  USR = WRK.Date In
 WRK.Date_1_PASS_USR = WRK.Date_In;

 // Call program PMT Pass for EndInvDwnUP.
 SBMJOB;
 CALL PROGRAM(PMT Pass for EndInvDwnUP) ('POFQUPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(WRK.Company_Number_Pass_USR);
 PARAMETER(WRK.Date_1_PASS_USR);
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 SBMJOBOVR JOB(ENDINV_DWN);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?  Prior Sunday thru Saturday
 // WRK.Date 1          PASS  USR = WRK.Date Sun USR
 WRK.Date_1_PASS_USR = WRK.Date_Sun_USR;

 // WRK.Date 2          PASS  USR = PAR.To Date               USR
 WRK.Date_2_PASS_USR = PAR.To_Date_USR;

 // Call program PMT Pass for OrdDtlDwnUP.
 SBMJOB;
 CALL PROGRAM(PMT Pass for OrdDtlDwnUP) ('POF7UPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(WRK.Company_Number_Pass_USR);
 PARAMETER(WRK.Date_1_PASS_USR);
 PARAMETER(WRK.Date_2_PASS_USR);
 PARAMETER('D');
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 SBMJOBOVR JOB(ORDDTL_DWN);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?  Sunday after week ending date Ord Dtl shipments
 EXECUTE FUNCTION(RTV Next Sunday        RT) TYPE(RTVOBJ) FILE(CAAFREP)          AC1672814;
 PARAMETER(WRK.ISC_Warehouse_Company);
 PARAMETER(PAR.To_Date_USR);
 PARAMETER(WRK.Date_Sun_USR);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF DB1.Day of Week is Sunday
  IF DB1.Day_of_Week = '1';

  // PAR.Scheduled Ship Date = DB1.Post to G/L Date
  PAR.Scheduled_Ship_Date = DB1.Post_to_G_L_Date;

  QUIT;

  ENDIF;

 }

 // WRK.Date 1          PASS  USR = WRK.Date Sun USR
 WRK.Date_1_PASS_USR = WRK.Date_Sun_USR;

 // WRK.Date 2          PASS  USR = WRK.Date Sun USR
 WRK.Date_2_PASS_USR = WRK.Date_Sun_USR;

 // Call program PMT Pass for OrdDtlDwnUP.
 SBMJOB;
 CALL PROGRAM(PMT Pass for OrdDtlDwnUP) ('POF7UPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(WRK.Company_Number_Pass_USR);
 PARAMETER(WRK.Date_1_PASS_USR);
 PARAMETER(WRK.Date_2_PASS_USR);
 PARAMETER('D');
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 SBMJOBOVR JOB(ORDDT2_DWN);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 //?  Sunday after week ending date thru Monday Ord Dtl Shipments
 // WRK.Date 1          PASS  USR = WRK.Date Sun USR
 WRK.Date_1_PASS_USR = WRK.Date_Sun_USR;

 // WRK.Date 2          PASS  USR = WRK.Date Mon USR
 WRK.Date_2_PASS_USR = WRK.Date_Mon_USR;

 // Call program PMT Pass for OrdDtlDwnUP.
 SBMJOB;
 CALL PROGRAM(PMT Pass for OrdDtlDwnUP) ('POF7UPC');
 PARAMETER(WRK.Return_Code_Usr);
 PARAMETER(WRK.Company_Number_Pass_USR);
 PARAMETER(WRK.Date_1_PASS_USR);
 PARAMETER(WRK.Date_2_PASS_USR);
 PARAMETER('D');
 PARAMETER(WRK.Email_Address);
 PARAMETER(*BLANK);
 SBMJOBOVR JOB(ORDDT2_DWN);
 SBMJOBOVR JOBD(*USRPRF);
 SBMJOBEND;

 ENDIF;

 ENDIF;

 ENDIF;

 ENDIF;

}


//?If Valuation Grouping = S
CASE;

// IF PAR.ISC Valuation Grouping is Seaboard Triumph Foods
IF PAR.ISC_Valuation_Grouping = 'S';

//?Save from date (7 alpha)
// LCL.Date From Alpha       USR = WRK.Date (Alpha) USR
LCL.Date_From_Alpha_USR = WRK.Date_Alpha_USR;

//?Convert To Date to 7 alpha
// WRK.Date (Char-8) USR = CVTVAR(PAR.ISC Week Ending Date)
WRK.Date_Char_8_USR = CVTVAR(PAR.ISC_Week_Ending_Date);

// WRK.Date (Char-6) USR = SUBSTRING(WRK.Date (Char-8) USR,CON.3,CON.6)
WRK.Date_Char_6_USR = SUBSTRING(WRK.Date_Char_8_USR:3:6);

// LCL.Date From Convert USR = LCL.Date (Alpha) USR
LCL.Date_From_Convert_USR = LCL.Date_Alpha_USR;

// LCL.Date To Alpha         USR = CONCAT(CON.1,WRK.Date (Char-6) USR,CND.*None)
LCL.Date_To_Alpha_USR = '1' + WRK.Date_Char_6_USR (*ZERO);

// Call program UP Email COPACK Rprt CLP.
CALL PROGRAM(UP Email COPACK Rprt CLP) ('PUSDUPC');
PARAMETER(LCL.Date_From_Alpha_USR);
PARAMETER(LCL.Date_To_Alpha_USR);
PARAMETER(PAR.ISC_Valuation_Grouping);

ENDIF;

