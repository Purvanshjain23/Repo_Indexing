// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUQZXFR
// ?Date: 14.08.2025 Time: 03:51:08
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV Prc SHBOL p/Order RT) TYPE(RTVOBJ) FILE(PNF7REP)           AC2184106;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Distribution_Code);
PARAMETER(PAR.CDE_Sequence_Number);
PARAMETER(PAR.CDE_Destination_Type);
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Accounting_Company);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.CDE Destination Type EQ PAR.CDE Destination Type
 IF DB1.CDE_Destination_Type = PAR.CDE_Destination_Type;

 // AND DB1.Record Status is Active
 AND DB1.Record_Status = 'A';

 // LCL.Number Value - 7 = JOB.*Job number * CON.10 *
 LCL.Number_Value_7 = JOB.*Job_number * 10;

 // LCL.Number Value - 7 = LCL.Number Value - 7 + LCL.Count USR
 LCL.Number_Value_7 = LCL.Number_Value_7 + LCL.Count_USR;

 // LCL.Text USR 7 = CVTVAR(LCL.Number Value - 7)
 LCL.Text_USR_7 = CVTVAR(LCL.Number_Value_7);

 // LCL.Job Name CDE = CONCAT(CON.BOL,LCL.Text USR 7,CON.*ZERO)
 LCL.Job_Name_CDE = 'BOL' + LCL.Text_USR_7 (*ZERO);

 // LCL.Load ID Alpha USR = PAR.Load ID
 LCL.Load_ID_Alpha_USR = PAR.Load_ID;

 // LCL.Ship To Customer TXT = CVTVAR(DB1.Ship To Customer)
 LCL.Ship_To_Customer_TXT = CVTVAR(DB1.Ship_To_Customer);

 //?EMAIL / FAX
 CASE;

 // IF DB1.CDE Destination is Entered
 IF DB1.CDE_Destination <> *BLANK;

 //?submit job to email per jobname
 // LCL.CDD Type = CND.Bill of Lading - Email
 LCL.CDD_Type = 'BE';

 // LCL.CDD Department Code = CND.Traffic
 LCL.CDD_Department_Code = 'TRAFF';

 // Call program RTV CDD for Overlays   XF.
 CALL PROGRAM(RTV CDD for Overlays   XF) ('PMG9XFR');
 PARAMETER(PAR.Accounting_Company);
 PARAMETER(LCL.CDD_Type);
 PARAMETER(LCL.CDD_Department_Code);
 PARAMETER(LCL.Generic_Heading);
 PARAMETER(LCL.CDD_Program_Name);
 PARAMETER(LCL.CDD_Printer_File_Name);
 PARAMETER(LCL.CDD_Additional_Object);
 PARAMETER(LCL.CDD_Sender_Phone);
 PARAMETER(LCL.CDD_Sender_Fax);
 PARAMETER(LCL.Output_Queue);
 PARAMETER(LCL.Hold_File);
 PARAMETER(LCL.Save_File);
 PARAMETER(LCL.Source_Drawer);
 PARAMETER(LCL.Printer_Device_Type);
 PARAMETER(LCL.Page_Length_2);
 PARAMETER(LCL.Page_Width_2);
 PARAMETER(LCL.Page_LPI);
 PARAMETER(LCL.Page_CPI);
 PARAMETER(LCL.Page_Overflow);
 PARAMETER(LCL.Page_Rotation);
 PARAMETER(LCL.CDD_Comment_1);
 PARAMETER(LCL.CDD_Comment_2);
 PARAMETER(LCL.CDD_Comment_3);
 PARAMETER(LCL.CDD_Comment_4);
 PARAMETER(LCL.CDD_Comment_5);
 PARAMETER(LCL.Record_Status);

 // LCL.CDD Name of Overlay Back = CON.*BLANK
 LCL.CDD_Name_of_Overlay_Back = *BLANK;

 // Call program RTV CDD for Overlays   XF.
 CALL PROGRAM(RTV CDD for Overlays   XF) ('PMG9XFR');
 PARAMETER(PAR.Accounting_Company);
 PARAMETER('BK');
 PARAMETER('TRAFF');
 PARAMETER(LCL.CDD_Name_of_Overlay_Back);
 PARAMETER(NLL.CDD_Program_Name);
 PARAMETER(NLL.CDD_Printer_File_Name);
 PARAMETER(NLL.CDD_Additional_Object);
 PARAMETER(NLL.CDD_Sender_Phone);
 PARAMETER(NLL.CDD_Sender_Fax);
 PARAMETER(NLL.Output_Queue);
 PARAMETER(NLL.Hold_File);
 PARAMETER(NLL.Save_File);
 PARAMETER(NLL.Source_Drawer);
 PARAMETER(NLL.Printer_Device_Type);
 PARAMETER(NLL.Page_Length_2);
 PARAMETER(NLL.Page_Width_2);
 PARAMETER(NLL.Page_LPI);
 PARAMETER(NLL.Page_CPI);
 PARAMETER(NLL.Page_Overflow);
 PARAMETER(NLL.Page_Rotation);
 PARAMETER(NLL.CDD_Comment_1);
 PARAMETER(NLL.CDD_Comment_2);
 PARAMETER(NLL.CDD_Comment_3);
 PARAMETER(NLL.CDD_Comment_4);
 PARAMETER(NLL.CDD_Comment_5);
 PARAMETER(NLL.Record_Status);

 // LCL.Subject Line USR = CONCAT(CON.Bill of Lading for Load,LCL.Load ID Alpha USR,CON.2)
 LCL.Subject_Line_USR = 'Bill of Lading for Load' + LCL.Load_ID_Alpha_USR (2);

 // Call program CLP ESNDMAIL BOL-SBD  UP.
 CALL PROGRAM(CLP ESNDMAIL BOL-SBD  UP) ('PUQPUPC');
 PARAMETER(*BLANK);
 PARAMETER(DB1.CDE_Destination);
 PARAMETER(LCL.Subject_Line_USR);
 PARAMETER('Bill of Lading');
 PARAMETER(LCL.Job_Name_CDE);
 PARAMETER(LCL.Generic_Heading);
 PARAMETER(LCL.CDD_Name_of_Overlay_Back);
 PARAMETER(LCL.Load_ID_Alpha_USR);
 PARAMETER(LCL.Ship_To_Customer_TXT);

 //?EMAIL / FAX
 ENDIF;

 ENDIF;

}


//?Mark load/orders with Processing Sts to SENT
EXECUTE FUNCTION(RTV Chg for Ld Emd snt RT) TYPE(RTVOBJ) FILE(PMAMREP)          AC2184233;
PARAMETER(PAR.Load_ID);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.OHE Email BOL/Sent is Processing
 IF DB1.OHE_Email_BOL_Sent = 'P';

 EXECUTE FUNCTION(CHG OHE Email BOL      CH) TYPE(CHGOBJ) FILE(PMAMREP)          AC2183955;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER('S');
 {
  //?USER: Processing before Data update

  // DB1.Job Time = JOB.*Job time
  DB1.Job_Time = JOB.*Job_time;

  // DB1.Job Date = JOB.*Job date
  DB1.Job_Date = JOB.*Job_date;

  // DB1.Job Name = JOB.*PROGRAM
  DB1.Job_Name = JOB.*PROGRAM;

  // DB1.User Id = JOB.*USER
  DB1.User_Id = JOB.*USER;

 }

 ENDIF;

}


