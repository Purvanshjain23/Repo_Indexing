     H/TITLE Exc Prc From F01151   XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : E1IDEVMDL
     H* System        : E1IDEVMDL
     H* User name     : ISRCENT
     H* Date          : 11/12/20  Time  : 08:19:31
     H* Copyright     : E1IDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FEZ01151B  IF   E           K DISK
      * RTV : Electronic AddressF01151Z Retrieval index
      *
     FE101151B  IF   E           K DISK
      * RTV : Electronic Address F01151 Retrieval index
      *
     FE10101LA  IF   E           K DISK
      * RSQ : Address Book       F0101  Address Number
      *
     FE101151A  UF A E           K DISK
      * UPD : Electronic Address F01151 Update index
      *
     FEZ01151A  UF   E           K DISK
      * UPD : Electronic AddressF01151Z Update index
      *
      * Long constants
     D @CN#            S              6    DIM(01)CTDATA PERRCD(1)
     D @CN             S             25    DIM(01) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QE1011        E DS                  EXTNAME(E101151A)
      * UPD : Electronic Address F01151 Update index
      * Renamed input format fields
     D  WCAN8        E                     EXTFLD(EAAN8)
     D  WCIDLN       E                     EXTFLD(EAIDLN)
     D  WCRCK7       E                     EXTFLD(EARCK7)
     D  WCETP        E                     EXTFLD(EAETP)
     D  WCEMAL       E                     EXTFLD(EAEMAL)
     D  WCUSER       E                     EXTFLD(EAUSER)
     D  WCPID        E                     EXTFLD(EAPID)
     D  WCUPMJ       E                     EXTFLD(EAUPMJ)
     D  WCJOBN       E                     EXTFLD(EAJOBN)
     D  WCUPMT       E                     EXTFLD(EAUPMT)
     D  WCHIER       E                     EXTFLD(EAHIER)
     D  WCEFOR       E                     EXTFLD(EAEFOR)
     D  WCEACG       E                     EXTFLD(EAEACG)
     D  WCCFNO       E                     EXTFLD(EACFNO)
     D  WCGEN1       E                     EXTFLD(EAGEN1)
     D  WCFALG       E                     EXTFLD(EAFALG)
     D  WCSYNC       E                     EXTFLD(EASYNC)
     D  WCCAAD       E                     EXTFLD(EACAAD)
      *
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
     D YARDCS          DS           358
     D QEZ011        E DS                  EXTNAME(EZ01151A)
      * UPD : Electronic AddressF01151Z Update index
      * Renamed input format fields
     D  WEAN8        E                     EXTFLD(BEAN8)
     D  WEIDLN       E                     EXTFLD(BEIDLN)
     D  WERCK7       E                     EXTFLD(BERCK7)
     D  WEACTS       E                     EXTFLD(BEACTS)
     D  WETNAC       E                     EXTFLD(BETNAC)
     D  WEETP        E                     EXTFLD(BEETP)
     D  WEEMAL       E                     EXTFLD(BEEMAL)
     D  WEUSER       E                     EXTFLD(BEUSER)
     D  WEPID        E                     EXTFLD(BEPID)
     D  WEUPMJ       E                     EXTFLD(BEUPMJ)
     D  WEJOBN       E                     EXTFLD(BEJOBN)
     D  WEUPMT       E                     EXTFLD(BEUPMT)
     D  WEHIER       E                     EXTFLD(BEHIER)
     D  WEEFOR       E                     EXTFLD(BEEFOR)
     D  WEEACG       E                     EXTFLD(BEEACG)
     D  WECFNO       E                     EXTFLD(BECFNO)
     D  WEGEN1       E                     EXTFLD(BEGEN1)
     D  WEFALG       E                     EXTFLD(BEFALG)
     D  WESYNC       E                     EXTFLD(BESYNC)
     D  WECAAD       E                     EXTFLD(BECAAD)
     D  WEIEST       E                     EXTFLD(BEIEST)
     D  WEADDT       E                     EXTFLD(BEADDT)
     D  WEADTM       E                     EXTFLD(BEADTM)
      *
     D YBRDCS          DS           395
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  XDTSDL         S             26
     D  WQSE01         S                   LIKE(WDAN8)
     D  ZADFMF         S             10
     D  YARDC          S              1
     D  YBRDC          S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     D                 DS
     D  ZAMSDA                 1    132
     I@BECPE6
      * Electronic AddressF01151Z Retrieval index
      * Renamed input format fields
     I              BEAN8                       WAAN8
     I              BEIDLN                      WAIDLN
     I              BERCK7                      WARCK7
     I              BEACTS                      WAACTS
     I              BETNAC                      WATNAC
     I              BEETP                       WAETP
     I              BEEMAL                      WAEMAL
     I              BEUSER                      WAUSER
     I              BEPID                       WAPID
     I              BEUPMJ                      WAUPMJ
     I              BEJOBN                      WAJOBN
     I              BEUPMT                      WAUPMT
     I              BEHIER                      WAHIER
     I              BEEFOR                      WAEFOR
     I              BEEACG                      WAEACG
     I              BECFNO                      WACFNO
     I              BEGEN1                      WAGEN1
     I              BEFALG                      WAFALG
     I              BESYNC                      WASYNC
     I              BECAAD                      WACAAD
     I              BEIEST                      WAIEST
     I              BEADDT                      WAADDT
     I              BEADTM                      WAADTM
      *
     II01151B
      * Electronic Address F01151 Retrieval index
      * Renamed input format fields
     I              EAAN8                       WBAN8
     I              EAIDLN                      WBIDLN
     I              EARCK7                      WBRCK7
     I              EAETP                       WBETP
     I              EAEMAL                      WBEMAL
     I              EAUSER                      WBUSER
     I              EAPID                       WBPID
     I              EAUPMJ                      WBUPMJ
     I              EAJOBN                      WBJOBN
     I              EAUPMT                      WBUPMT
     I              EAHIER                      WBHIER
     I              EAEFOR                      WBEFOR
     I              EAEACG                      WBEACG
     I              EACFNO                      WBCFNO
     I              EAGEN1                      WBGEN1
     I              EAFALG                      WBFALG
     I              EASYNC                      WBSYNC
     I              EACAAD                      WBCAAD
      *
     II01151A
      * Electronic Address F01151 Update index
      * Renamed input format fields
     I              EAAN8                       WCAN8
     I              EAIDLN                      WCIDLN
     I              EARCK7                      WCRCK7
     I              EAETP                       WCETP
     I              EAEMAL                      WCEMAL
     I              EAUSER                      WCUSER
     I              EAPID                       WCPID
     I              EAUPMJ                      WCUPMJ
     I              EAJOBN                      WCJOBN
     I              EAUPMT                      WCUPMT
     I              EAHIER                      WCHIER
     I              EAEFOR                      WCEFOR
     I              EAEACG                      WCEACG
     I              EACFNO                      WCCFNO
     I              EAGEN1                      WCGEN1
     I              EAFALG                      WCFALG
     I              EASYNC                      WCSYNC
     I              EACAAD                      WCCAAD
      *
     II0101LA
      * Address Book       F0101  Address Number
      * Renamed input format fields
     I              ABAN8                       WDAN8
     I              ABALKY                      WDALKY
     I              ABTAX                       WDTAX
     I              ABALPH                      WDALPH
     I              ABDC                        WDDC
     I              ABMCU                       WDMCU
     I              ABSIC                       WDSIC
     I              ABLNGP                      WDLNGP
     I              ABAT1                       WDAT1
     I              ABCM                        WDCM
     I              ABTAXC                      WDTAXC
     I              ABAT2                       WDAT2
     I              ABAT3                       WDAT3
     I              ABAT4                       WDAT4
     I              ABAT5                       WDAT5
     I              ABATP                       WDATP
     I              ABATR1                      WDATR1
     I              ABATPR                      WDATPR
     I              ABAB3                       WDAB3
     I              ABATE                       WDATE
     I              ABSBLI                      WDSBLI
     I              ABEFTB                      WDEFTB
     I              ABAN81                      WDAN81
     I              ABAN82                      WDAN82
     I              ABAN83                      WDAN83
     I              ABAN84                      WDAN84
     I              ABAN86                      WDAN86
     I              ABAN85                      WDAN85
     I              ABAC01                      WDAC01
     I              ABAC02                      WDAC02
     I              ABAC03                      WDAC03
     I              ABAC04                      WDAC04
     I              ABAC05                      WDAC05
     I              ABAC06                      WDAC06
     I              ABAC07                      WDAC07
     I              ABAC08                      WDAC08
     I              ABAC09                      WDAC09
     I              ABAC10                      WDAC10
     I              ABAC11                      WDAC11
     I              ABAC12                      WDAC12
     I              ABAC13                      WDAC13
     I              ABAC14                      WDAC14
     I              ABAC15                      WDAC15
     I              ABAC16                      WDAC16
     I              ABAC17                      WDAC17
     I              ABAC18                      WDAC18
     I              ABAC19                      WDAC19
     I              ABAC20                      WDAC20
     I              ABAC21                      WDAC21
     I              ABAC22                      WDAC22
     I              ABAC23                      WDAC23
     I              ABAC24                      WDAC24
     I              ABAC25                      WDAC25
     I              ABAC26                      WDAC26
     I              ABAC27                      WDAC27
     I              ABAC28                      WDAC28
     I              ABAC29                      WDAC29
     I              ABAC30                      WDAC30
     I              ABGLBA                      WDGLBA
     I              ABPTI                       WDPTI
     I              ABPDI                       WDPDI
     I              ABMSGA                      WDMSGA
     I              ABRMK                       WDRMK
     I              ABTXCT                      WDTXCT
     I              ABTX2                       WDTX2
     I              ABALP1                      WDALP1
     I              ABURCD                      WDURCD
     I              ABURDT                      WDURDT
     I              ABURAT                      WDURAT
     I              ABURAB                      WDURAB
     I              ABURRF                      WDURRF
     I              ABUSER                      WDUSER
     I              ABPID                       WDPID
     I              ABUPMJ                      WDUPMJ
     I              ABJOBN                      WDJOBN
     I              ABUPMT                      WDUPMT
     I              ABPRGF                      WDPRGF
     I              ABSCCT                      WDSCCT
     I              ABTICK                      WDTICK
     I              ABEXCG                      WDEXCG
     I              ABDUNS                      WDDUNS
     I              ABCLS1                      WDCLS1
     I              ABCLS2                      WDCLS2
     I              ABCLS3                      WDCLS3
     I              ABCLS4                      WDCLS4
     I              ABCLS5                      WDCLS5
     I              ABNOE                       WDNOE
     I              ABGROW                      WDGROW
     I              ABYRST                      WDYRST
     I              ABEMPG                      WDEMPG
     I              ABACTI                      WDACTI
     I              ABREVR                      WDREVR
     I              ABSYNC                      WDSYNC
     I              ABPERR                      WDPERR
     I              ABCAAD                      WDCAAD
      *
     I@BECPE5
      * Electronic AddressF01151Z Update index
      * Renamed input format fields
     I              BEAN8                       WEAN8
     I              BEIDLN                      WEIDLN
     I              BERCK7                      WERCK7
     I              BEACTS                      WEACTS
     I              BETNAC                      WETNAC
     I              BEETP                       WEETP
     I              BEEMAL                      WEEMAL
     I              BEUSER                      WEUSER
     I              BEPID                       WEPID
     I              BEUPMJ                      WEUPMJ
     I              BEJOBN                      WEJOBN
     I              BEUPMT                      WEUPMT
     I              BEHIER                      WEHIER
     I              BEEFOR                      WEEFOR
     I              BEEACG                      WEEACG
     I              BECFNO                      WECFNO
     I              BEGEN1                      WEGEN1
     I              BEFALG                      WEFALG
     I              BESYNC                      WESYNC
     I              BECAAD                      WECAAD
     I              BEIEST                      WEIEST
     I              BEADDT                      WEADDT
     I              BEADTM                      WEADTM
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Exc Prc From F01151   XF
      * SDN 465 JDE to E1 RMC 4/24/2020
      *   Read staged table from E1 for the address book and update E1IDE
      *    table E101151 - process ADDS and CHANGES
      * Rtv Prc From F01151   RT - Electronic AddressF01151Z  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Prc From F01151   RT - Electronic AddressF01151Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KPSSA         KLIST
     C                   KFLD                    WAAN8                          Address Number
     C                   KFLD                    WAIDLN                         Who's Who Line
     C                   KFLD                    WARCK7                         Line Number ID
     C                   KFLD                    WAACTS                         Date Time Stamp
      * Initialize key list
     C                   MOVEL     *LOVAL        WAAN8                          Address Number
     C                   MOVEL     *LOVAL        WAIDLN                         Who's Who Line
     C                   MOVEL     *LOVAL        WARCK7                         Line Number ID
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
      * Setup key
      * Establish starting position
     C     KPSSA         SETLL     @BECPE6                                      *
     C                   READ      @BECPE6                                90    *
      * Data record not found
     C   90              MOVEL     'E1I0157'     W0RTN
      * USER: Process Data record
      * CASE: DB1.Transaction Action Z is Delete
     C                   DOW       NOT *IN90
      * Rtv/Del E101151 f/EZ   RT - Electronic Address F01151  * 
     C                   IF        WATNAC = 'D'
     C                   EXSR      SBRVGN
     C                   ELSE
      * CASE: *OTHERWISE
      * Rtv CrtChg From Stg   RT - Electronic Address F01151  * 
     C                   EXSR      SDRVGN
     C                   END                                                    *FI
      * Chg EZ01151 to Prcd   CH - Electronic AddressF01151Z  * 
     C                   EXSR      SHCHRC
     C                   READ      @BECPE6                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Rtv/Del E101151 f/EZ   RT - Electronic Address F01151  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBIDLN                         Who's Who Line
     C                   KFLD                    WBRCK7                         Line Number ID
      * Setup key
     C                   Z-ADD     WAAN8         WBAN8                          Address Number
     C                   Z-ADD     WAIDLN        WBIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WBRCK7                         Line Number ID
      * Establish starting position
     C     KRSSB         CHAIN     I01151B                            90        *
      * Data record not found
     C   90              MOVEL     'E1I0137'     W0RTN
      * USER: Process Data record
      * Del E101151 from Stage DL - Electronic Address F01151  * 
     C                   IF        NOT *IN90
     C                   EXSR      SCDLRC
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCDLRC        BEGSR
      *================================================================
      * Del E101151 from Stage DL - Electronic Address F01151  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to I01151A
     C                   Z-ADD     WBAN8         WCAN8                          Address Number
     C                   Z-ADD     WBIDLN        WCIDLN                         Who's Who Line
     C                   Z-ADD     WBRCK7        WCRCK7                         Line Number ID
      *
     C     KLDLSC        KLIST
     C                   KFLD                    WCAN8                          Address Number
     C                   KFLD                    WCIDLN                         Who's Who Line
     C                   KFLD                    WCRCK7                         Line Number ID
     C     KLDLSC        CHAIN     I01151A                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'E101151A'    MDACP
     C                   MOVEL     'I01151A'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    I01151A                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * Rtv CrtChg From Stg   RT - Electronic Address F01151  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    WBAN8                          Address Number
     C                   KFLD                    WBIDLN                         Who's Who Line
     C                   KFLD                    WBRCK7                         Line Number ID
      * Setup key
     C                   Z-ADD     WAAN8         WBAN8                          Address Number
     C                   Z-ADD     WAIDLN        WBIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WBRCK7                         Line Number ID
      * Establish starting position
     C     KRSSD         CHAIN     I01151B                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0137'     W0RTN
      * USER: Processing if Data record not found
      * dont create rcd if Address Master doesnt exist
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
     C                   EXSR      SERVGN
      * CASE: PGM.*Return code is *Normal
      * Crt Electronic Address - Electronic Address F01151  * 
     C                   IF        W0RTN = ' '
     C                   EXSR      SFCRRC
     C                   END                                                    *FI
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * Chg Electronic Address - Electronic Address F01151  * 
     C                   IF        NOT *IN90
     C                   EXSR      SGCHRC
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SERVGN        BEGSR
      *================================================================
      * Rtv Val Addr Nbr      RT - Address Book       F0101  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSE         KLIST
     C                   KFLD                    WQSE01                         Address Number
      * Setup key
     C                   Z-ADD     WAAN8         WQSE01                         Address Number
      * Establish starting position
     C     KRSSE         SETLL     I0101LA                                      *
     C     KRSSE         READE     I0101LA                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0078'     W0RTN
      * USER: Processing if Data record not found
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   EVAL      W0RTN = ' '                                  *Return code
     C     KRSSE         READE     I0101LA                                90    *
     C                   ENDDO
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCRRC        BEGSR
      *================================================================
      * Crt Electronic Address - Electronic Address F01151  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move all fields to I01151A
     C                   Z-ADD     WAAN8         WCAN8                          Address Number
     C                   Z-ADD     WAIDLN        WCIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WCRCK7                         Line Number ID
     C                   MOVEL     WAETP         WCETP                          Electronic Addr
     C                   MOVEL     WAEMAL        WCEMAL                         Electronic Addr
     C                   MOVEL     WAUSER        WCUSER                         User ID
     C                   MOVEL     WAPID         WCPID                          Program ID
     C                   Z-ADD     WAUPMJ        WCUPMJ                         Date - Updated
     C                   MOVEL     WAJOBN        WCJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WCUPMT                         Time - Last Upd
     C                   Z-ADD     WAHIER        WCHIER                         Messaging Indic
     C                   MOVEL     WAEFOR        WCEFOR                         Email Format
     C                   MOVEL     WAEACG        WCEACG                         Electronic Addr
     C                   Z-ADD     WACFNO        WCCFNO                         Generic Number
     C                   MOVEL     WAGEN1        WCGEN1                         Generic Informa
     C                   MOVEL     WAFALG        WCFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WCSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WCCAAD                         Server Status
      *
     C     KLCRSF        KLIST
     C                   KFLD                    WCAN8                          Address Number
     C                   KFLD                    WCIDLN                         Who's Who Line
     C                   KFLD                    WCRCK7                         Line Number ID
      * Check for duplicate primary key
     C     KLCRSF        SETLL     I01151A                                90    *
     C                   IF        *IN90
     C                   MOVEL     'E1I0138'     W0RTN
      * Send message 'Electronic Address F01 EX'
     C                   MOVEL     'E1I0138'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
     C                   WRITE     I01151A                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   SGCHRC        BEGSR
      *================================================================
      * Chg Electronic Address - Electronic Address F01151  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to I01151A
     C                   Z-ADD     WBAN8         WCAN8                          Address Number
     C                   Z-ADD     WBIDLN        WCIDLN                         Who's Who Line
     C                   Z-ADD     WBRCK7        WCRCK7                         Line Number ID
      *
     C     KLCHSG        KLIST
     C                   KFLD                    WCAN8                          Address Number
     C                   KFLD                    WCIDLN                         Who's Who Line
     C                   KFLD                    WCRCK7                         Line Number ID
     C     KLCHSG        CHAIN     I01151A                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'E101151A'    MDACP
     C                   MOVEL     'I01151A'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL002.
     C                   MOVEL     'LBL002'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SGEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SGEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QE1011        YARDCS
      * Move non-key fields to I01151A
     C                   MOVEL(P)  WAETP         WCETP                          Electronic Addr
     C                   MOVEL(P)  WAEMAL        WCEMAL                         Electronic Addr
     C                   MOVEL(P)  WAUSER        WCUSER                         User ID
     C                   MOVEL(P)  WAPID         WCPID                          Program ID
     C                   Z-ADD     WAUPMJ        WCUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WCJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WCUPMT                         Time - Last Upd
     C                   Z-ADD     WAHIER        WCHIER                         Messaging Indic
     C                   MOVEL(P)  WAEFOR        WCEFOR                         Email Format
     C                   MOVEL(P)  WAEACG        WCEACG                         Electronic Addr
     C                   Z-ADD     WACFNO        WCCFNO                         Generic Number
     C                   MOVEL(P)  WAGEN1        WCGEN1                         Generic Informa
     C                   MOVEL(P)  WAFALG        WCFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WCSYNC                         Synchronization
     C                   Z-ADD     WACAAD        WCCAAD                         Server Status
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QE1011 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    I01151A                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    E101151A                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SGEXIT        ENDSR
      /EJECT
     CSR   SHCHRC        BEGSR
      *================================================================
      * Chg EZ01151 to Prcd   CH - Electronic AddressF01151Z  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YBRDC = ' '
      *
      * Move key fields to @BECPE5
     C                   Z-ADD     WAAN8         WEAN8                          Address Number
     C                   Z-ADD     WAIDLN        WEIDLN                         Who's Who Line
     C                   Z-ADD     WARCK7        WERCK7                         Line Number ID
     C                   MOVEL(P)  WAACTS        WEACTS                         Date Time Stamp
      *
     C     KLCHSH        KLIST
     C                   KFLD                    WEAN8                          Address Number
     C                   KFLD                    WEIDLN                         Who's Who Line
     C                   KFLD                    WERCK7                         Line Number ID
     C                   KFLD                    WEACTS                         Date Time Stamp
     C     KLCHSH        CHAIN     @BECPE5                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'EZ01151A'    MDACP
     C                   MOVEL     '@BECPE5'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL003.
     C                   MOVEL     'LBL003'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SHEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SHEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QEZ011        YBRDCS
      * Move non-key fields to @BECPE5
     C                   MOVEL(P)  WATNAC        WETNAC                         Transaction Act
     C                   MOVEL(P)  WAETP         WEETP                          Electronic Addr
     C                   MOVEL(P)  WAEMAL        WEEMAL                         Electronic Addr
     C                   MOVEL(P)  WAUSER        WEUSER                         User ID
     C                   MOVEL(P)  WAPID         WEPID                          Program ID
     C                   Z-ADD     WAUPMJ        WEUPMJ                         Date - Updated
     C                   MOVEL(P)  WAJOBN        WEJOBN                         Work Station ID
     C                   Z-ADD     WAUPMT        WEUPMT                         Time - Last Upd
     C                   Z-ADD     WAHIER        WEHIER                         Messaging Indic
     C                   MOVEL(P)  WAEFOR        WEEFOR                         Email Format
     C                   MOVEL(P)  WAEACG        WEEACG                         Electronic Addr
     C                   Z-ADD     WACFNO        WECFNO                         Generic Number
     C                   MOVEL(P)  WAGEN1        WEGEN1                         Generic Informa
     C                   MOVEL(P)  WAFALG        WEFALG                         Future Flag Use
     C                   Z-ADD     WASYNC        WESYNC                         Synchronization
     C                   Z-ADD     WACAAD        WECAAD                         Server Status
     C                   MOVEL(P)  '1'           WEIEST                         OMS ERP Process
     C                   Z-ADD     ##JDT         WEADDT                         OMS ERP Process
     C                   Z-ADD     ##JTM         WEADTM                         OMS ERP Process
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QEZ011 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YBRDC = 'Y'
     C                   UPDATE    @BECPE5                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    EZ01151A                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SHEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAN8                          Address Number
     C                   Z-ADD     *ZERO         WAIDLN                         Who's Who Line
     C                   Z-ADD     *ZERO         WARCK7                         Line Number ID
     C                   MOVE(P)   '0'           XDTSDL
     C                   MOVEL     @CN(001)      XDTSDL
     C                   MOVEL     XDTSDL        WAACTS                         Date Time Stamp
     C                   Z-ADD     *ZERO         WAUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WAUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WAHIER                         Messaging Indic
     C                   Z-ADD     *ZERO         WACFNO                         Generic Number
     C                   Z-ADD     *ZERO         WASYNC                         Synchronization
     C                   Z-ADD     *ZERO         WACAAD                         Server Status
     C                   Z-ADD     *ZERO         WAADDT                         OMS ERP Process
     C                   Z-ADD     *ZERO         WAADTM                         OMS ERP Process
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAN8                          Address Number
     C                   Z-ADD     *ZERO         WBIDLN                         Who's Who Line
     C                   Z-ADD     *ZERO         WBRCK7                         Line Number ID
     C                   Z-ADD     *ZERO         WBUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WBUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WBHIER                         Messaging Indic
     C                   Z-ADD     *ZERO         WBCFNO                         Generic Number
     C                   Z-ADD     *ZERO         WBSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WBCAAD                         Server Status
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WDAN8                          Address Number
     C                   Z-ADD     *ZERO         WDEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WDAN81                         Address Number
     C                   Z-ADD     *ZERO         WDAN82                         Address Number
     C                   Z-ADD     *ZERO         WDAN83                         Address Number
     C                   Z-ADD     *ZERO         WDAN84                         Address Number
     C                   Z-ADD     *ZERO         WDAN86                         Address Number
     C                   Z-ADD     *ZERO         WDAN85                         Factor/Special
     C                   Z-ADD     *ZERO         WDPTI                          Time - Schedule
     C                   Z-ADD     *ZERO         WDPDI                          Date - Schedule
     C                   Z-ADD     *ZERO         WDURDT                         User Reserved D
     C                   Z-ADD     *ZERO         WDURAT                         User Reserved A
     C                   Z-ADD     *ZERO         WDURAB                         User Reserved N
     C                   Z-ADD     *ZERO         WDUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WDUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WDNOE                          Number of Emplo
     C                   Z-ADD     *ZERO         WDGROW                         Growth Rate
     C                   Z-ADD     *ZERO         WDSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WDPERR                         Previous Error
     C                   Z-ADD     *ZERO         WDCAAD                         Server Status
      * Obtain default message file
     C     *DTAARA       DEFINE    E1MGFLA       ZADFMF
     C                   IN        ZADFMF
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 0001-01-01-00.00.00.00000
