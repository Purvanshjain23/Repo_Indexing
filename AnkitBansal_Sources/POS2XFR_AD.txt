// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POS2XFR
// ?Date: 14.08.2025 Time: 03:38:56
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Calc the Market Price as printed on the Sales Realz Reports
// Call program RTV Item Details       XF.
CALL PROGRAM(RTV Item Details       XF) ('PDKAXFR');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Shipped_Item_Code);
PARAMETER(LCL.UOM_Primary);
PARAMETER(LCL.Conversion_Factor_1);
PARAMETER(LCL.Operation_Factor_1);
PARAMETER(LCL.UOM_Second);
PARAMETER(LCL.Conversion_Factor_2);
PARAMETER(LCL.Operation_Factor_2);
PARAMETER(LCL.UOM_Third);
PARAMETER(LCL.UOM_Pricing);
PARAMETER(PAR.Unit_Weight);
PARAMETER(WRK.Market_Overage);
PARAMETER(WRK.Standard_Overage_Underage);
PARAMETER(PAR.Commodity_Price_Group);
PARAMETER(LCL.Item_Pricing_Operation);
PARAMETER(LCL.Item_Pricing_Constant);

EXECUTE FUNCTION(RTV Print Realization  RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1387825;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Shipped_Item_Code);
PARAMETER(PAR.Commodity_Market_Code);
PARAMETER(LCL.Print_on_Realization_Rpt);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?subtract 1 from actual shipped date for starting point
// WRK.Actual Shipped Date = PAR.Actual Shipped Date + CON.-1 *DAYS
WRK.Actual_Shipped_Date = DATEINCR(PAR.Actual_Shipped_Date '-1' 'DY' 1111111 'NONE' 'N'            +
1);

EXECUTE FUNCTION(RTV Market Price       RT) TYPE(RTVOBJ) FILE(OMF0CPP)          AC1199313;
PARAMETER(PAR.Commodity_Market_Code);
PARAMETER(PAR.Commodity_Price_Group);
PARAMETER(WRK.Actual_Shipped_Date);
PARAMETER(WRK.Commodity_Market_Price);
PARAMETER(WRK.USR_Date_Priced);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 // PAR.Commodity Market Price = DB1.Commodity Market Price
 PAR.Commodity_Market_Price = DB1.Commodity_Market_Price;

 // PAR.USR Date Priced = DB1.Market Price Date
 PAR.USR_Date_Priced = DB1.Market_Price_Date;

 QUIT;

}


// WRK.U/M - Base Price = PAR.U/M - Base Price
WRK.U_M_Base_Price = PAR.U_M_Base_Price;

// Call program CLC Convert Price Qtys XF.
CALL PROGRAM(CLC Convert Price Qtys XF) ('PDKGXFR');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Shipped_Item_Code);
PARAMETER(WRK.U_M_Base_Price);
PARAMETER(LCL.Price_based_on_U_M1_S);
PARAMETER(WRK.Price_based_on_U_M2_S);
PARAMETER(WRK.Price_based_on_U_M3_S);
PARAMETER(WRK.Commodity_Market_Price);

// PAR.Price based on U/M1 S = LCL.Price based on U/M1 S
PAR.Price_based_on_U_M1_S = LCL.Price_based_on_U_M1_S;

