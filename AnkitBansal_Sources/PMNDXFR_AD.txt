// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMNDXFR
// ?Date: 14.08.2025 Time: 03:43:30
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV & Purge Files      RT) TYPE(RTVOBJ) FILE(PDLQREP)          AC1840770;
PARAMETER(PAR.PCG_Code);
PARAMETER(PAR.PCG_From_Library);
PARAMETER(PAR.Purge_Application_Code);
PARAMETER(PAR.Purge_Retention_Period);
PARAMETER(PAR.Purge_Run_Frequency);
PARAMETER(PAR.Purge_Last_Run_Date);
PARAMETER(PAR.PCA_Purge_Method);
PARAMETER(PAR.PCA_Purge_Program);
PARAMETER(PAR.Purge_Date_USR);
PARAMETER(PAR.To_Library_USR);
{
 //?USER: Initialize routine

 //?***** Change Log and Comments
 DO;

 //?** LJB 07/01/2008 FP1009 Post install changes
 //?** Return an error message if call to purge program fails.
 //?** LJB 01/30/2008 FP1009 Post install changes
 //?** Pass in the "Purge To Library" from the control file
 ENDDO;

 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?R15035 DN 06/14/19-Pass In Purge Date (15.5) Format.
 // LCL.From Date Pass        USR = PAR.Purge Date USR
 LCL.From_Date_Pass_USR = PAR.Purge_Date_USR;

 //?** Call the program from the application file to purge the records
 // Call program CLP Call Purge Pgms    CL.
 CALL PROGRAM(CLP Call Purge Pgms    CL) ('PMLAUPC');
 PARAMETER(LCL.Return_Code_Usr);
 PARAMETER(LCL.From_Date_Pass_USR);
 PARAMETER(PAR.PCA_Purge_Program);
 PARAMETER(DB1.PCG_Code);
 PARAMETER(DB1.PCG_From_Library);
 PARAMETER(DB1.Purge_Application_Code);
 PARAMETER(DB1.File_Name);
 PARAMETER(DB1.Purge_Logical);
 PARAMETER(DB1.Purge_Tape_Physical);
 PARAMETER(DB1.Field_Name);
 PARAMETER(DB1.Date_Format);
 PARAMETER(PAR.To_Library_USR);

 CASE;

 // IF LCL.Return Code Usr is *Error Occured on Call
 IF LCL.Return_Code_Usr = 'Y2U0032';

 // Send information message - 'Call to program ended in error.'
 MESSAGE(USR0417 *INFO);

 ENDIF;

 ENDIF;

 //?USER: Exit processing

 CASE;

 // IF LCL.Return Code Usr is *Error Occured on Call
 IF LCL.Return_Code_Usr = 'Y2U0032';

 // PGM.*Return code = CND.Copy Purge Files Cancelld
 PGM.*Return_code = 'USR3811';

 RETURN;

 ENDIF;

}


