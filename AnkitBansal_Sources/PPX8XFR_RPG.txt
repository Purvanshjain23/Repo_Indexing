     H/TITLE PRT Invc Excpt Select  XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 05/01/18  Time  : 13:00:27
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDNEREL1IF  E           K        DISK
      * RTV : Customer EXT              Retrieval index
      *
     FOPBFCPMJIF  E           K        DISK
      * RSQ : Order Header TRG          Co/ShipTo/PO/SSD/Ord <>X
      *
     I@NEREAT
      * Customer EXT              Retrieval index
      * Renamed input format fields
     I              NEBKC7                          WABKC7
     I              NEUFTX                          WAUFTX
     I              NEUGTX                          WAUGTX
     I              NEPFNA                          WAPFNA
     I              NEJ5NX                          WAJ5NX
     I              NEU5TX                          WAU5TX
     I              NEU6TX                          WAU6TX
     I              NEW0TX                          WAW0TX
     I              NEHSSX                          WAHSSX
     I              NEHUSX                          WAHUSX
     I              NEHVSX                          WAHVSX
     I              NEAAC8                          WAAAC8
     I              NEP0SX                          WAP0SX
     I              NEP1SX                          WAP1SX
     I              NEP2SX                          WAP2SX
     I              NEP3SX                          WAP3SX
     I              NEP4SX                          WAP4SX
     I              NEP5SX                          WAP5SX
     I              NEP6SX                          WAP6SX
     I              NEUVST                          WAUVST
     I              NEUWST                          WAUWST
     I              NEUXST                          WAUXST
     I              NEVSST                          WAVSST
     I              NEAATM                          WAAATM
     I              NEAYNA                          WAAYNA
     I              NEA0NA                          WAA0NA
     I              NEAXDT                          WAAXDT
      *
     I@BFCPHR
      * Order Header TRG          Co/ShipTo/PO/SSD/Ord <>X
      * Renamed input format fields
     I              BEAIC3                          WBAIC3
     I              BEC4NB                          WBC4NB
     I              BEJNCD                          WBJNCD
     I              BEANC7                          WBANC7
     I              BEBKC7                          WBBKC7
     I              BEBRTX                          WBBRTX
     I              BEHMNA                          WBHMNA
     I              BEHONA                          WBHONA
     I              BEHPNA                          WBHPNA
     I              BEHNNA                          WBHNNA
     I              BEDBCD                          WBDBCD
     I              BECKTX                          WBCKTX
     I              BEB0C7                          WBB0C7
     I              BEAETX                          WBAETX
     I              BEB1NA                          WBB1NA
     I              BEB3NA                          WBB3NA
     I              BEB4NA                          WBB4NA
     I              BEB2NA                          WBB2NA
     I              BEBHCD                          WBBHCD
     I              BEC8TX                          WBC8TX
     I              BEBCNA                          WBBCNA
     I              BEA0DT                          WBA0DT
     I              BEA5DT                          WBA5DT
     I              BEGNDT                          WBGNDT
     I              BEACDT                          WBACDT
     I              BEAQCD                          WBAQCD
     I              BEB6NA                          WBB6NA
     I              BEBYNA                          WBBYNA
     I              BEBZNA                          WBBZNA
     I              BEGTST                          WBGTST
     I              BEGVST                          WBGVST
     I              BEGUST                          WBGUST
     I              BEQFST                          WBQFST
     I              BECQCD                          WBCQCD
     I              BEGJST                          WBGJST
     I              BEGWST                          WBGWST
     I              BEGXST                          WBGXST
     I              BEGYST                          WBGYST
     I              BEAODT                          WBAODT
     I              BEAIVN                          WBAIVN
     I              BECXDT                          WBCXDT
     I              BEJZVA                          WBJZVA
     I              BEA1WG                          WBA1WG
     I              BEXIST                          WBXIST
     I              BEXJST                          WBXJST
     I              BEXKST                          WBXKST
     I              BEEIDT                          WBEIDT
     I              BEAFTM                          WBAFTM
     I              BEE8CD                          WBE8CD
     I              BEE9CD                          WBE9CD
     I              BERMNB                          WBRMNB
     I              BETBNB                          WBTBNB
     I              BER1NB                          WBR1NB
     I              BEPJST                          WBPJST
     I              BEU0ST                          WBU0ST
     I              BEU1ST                          WBU1ST
     I              BEQ2CD                          WBQ2CD
     I              BEU2ST                          WBU2ST
     I              BEVEST                          WBVEST
     I              BEVFST                          WBVFST
     I              BEVGST                          WBVGST
     I              BERPCD                          WBRPCD
     I              BERNNB                          WBRNNB
     I              BEVDST                          WBVDST
     I              BEATIN                          WBATIN
     I              BEU4ST                          WBU4ST
     I              BEU5ST                          WBU5ST
     I              BERSRN                          WBRSRN
     I              BEMHNA                          WBMHNA
     I              BEMINA                          WBMINA
     I              BEWBST                          WBWBST
     I              BER4CD                          WBR4CD
     I              BEBFCD                          WBBFCD
     I              BEQ4CD                          WBQ4CD
     I              BET3NB                          WBT3NB
     I              BESICD                          WBSICD
     I              BECONB                          WBCONB
     I              BECEST                          WBCEST
     I              BEAWDT                          WBAWDT
     I              BEJPCD                          WBJPCD
     I              BEXUST                          WBXUST
     I              BEZ1ST                          WBZ1ST
     I              BEVRVA                          WBVRVA
     I              BEOBST                          WBOBST
     I              BEBCST                          WBBCST
     I              BEBDST                          WBBDST
     I              BEB7VL                          WBB7VL
     I              BEGASX                          WBGASX
     I              BEGBSX                          WBGBSX
     I              BEGCSX                          WBGCSX
     I              BEGDSX                          WBGDSX
     I              BEFNSX                          WBFNSX
     I              BEFOSX                          WBFOSX
     I              BEFPSX                          WBFPSX
     I              BEFQSX                          WBFQSX
     I              BEFRSX                          WBFRSX
     I              BEFSSX                          WBFSSX
     I              BEFTSX                          WBFTSX
     I              BEFUSX                          WBFUSX
     I              BEFVSX                          WBFVSX
     I              BEFWSX                          WBFWSX
     I              BEFXSX                          WBFXSX
     I              BEFYSX                          WBFYSX
     I              BENODT                          WBNODT
     I              BENPDT                          WBNPDT
     I              BENQDT                          WBNQDT
     I              BENRDT                          WBNRDT
     I              BENSDT                          WBNSDT
     I              BEBPTM                          WBBPTM
     I              BEBQTM                          WBBQTM
     I              BEBRTM                          WBBRTM
     I              BEBSTM                          WBBSTM
     I              BEBTTM                          WBBTTM
     I              BEH0NX                          WBH0NX
     I              BEH1NX                          WBH1NX
     I              BEH2NX                          WBH2NX
     I              BEH3NX                          WBH3NX
     I              BEH4NX                          WBH4NX
     I              BEC0C7                          WBC0C7
     I              BEUVST                          WBUVST
     I              BEUWST                          WBUWST
     I              BEUXST                          WBUXST
     I              BEAATM                          WBAATM
     I              BEAYNA                          WBAYNA
     I              BEA0NA                          WBA0NA
     I              BEAXDT                          WBAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Order Header TRG
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Order Number
     I                                    P   3   60P1C4NB
      * I :  Order Type - Sales
     I                                        7   8 P1JNCD
      * I :  A/R Customer Number
     I                                    P   9  120P1ANC7
      * I :  Ship To Customer
     I                                    P  13  160P1BKC7
      * I :  Customer Purchase Order #
     I                                       17  31 P1BCNA
      * I :  Order Date
     I                                    P  32  350P1A0DT
      * I :  Actual Shipped Date
     I                                    P  36  390P1GNDT
      * I :  Header Status
     I                                       40  40 P1GWST
      * I :  Header Status Last
     I                                       41  41 P1GXST
      * I :  Scheduled Ship Date
     I                                    P  42  450P1AODT
      * I :  Load ID
     I                                    P  46  490P1RMNB
      * I :  Price Audit
     I                                       50  50 P1U0ST
      * I :  Price Status
     I                                       51  51 P1U1ST
      * I :  Shipping Method
     I                                       52  53 P1Q2CD
      * I :  Sales Route Code
     I                                       54  56 P1R4CD
      * I :  Event Code
     I                                       57  58 P1JPCD
      * I :  Billing Activity Type
     I                                       59  59 P1OBST
     IP2PARM      DS
      * FLD: *Arrays
      * I :  USR Order Number
     I                                    P   1   40P2MPNB
      * I :  Load ID USR
     I                                    P   5   80P2LOID
      * I :  USR Billing Activty Type
     I                                        9   9 P2USBA
      * I :  USR Actual Shipped Date
     I                                    P  10  130P2JWDT
      * B :  Update Exception Status
     I                                       14  14 P2F6ST
      * B :  *Record selected
     I                                       15  15 P2RSL
      * O :  Print Pre-Inv/Exception
     I                                       16  16 P2PPIX
      * N :  USR Date Shipped
     I                                    P  17  200P2FADT
      * N :  Load Status
     I                                       21  21 P2PKST
      * N :  Truck Departure Date
     I                                    P  22  250P2KIDT
      * N :  Truck Departure Time
     I                                    P  26  290P2ASTM
      * O :  Departure Sts USR
     I                                       30  30 P2GESX
      * N :  Hour 3 USR
     I                                    P  31  320P2IINX
      * N :  Hour 1 USR
     I                                    P  33  340P2IJNX
      * N :  Day NBR USR
     I                                    P  35  360P2DNBU
      * N :  Hour 2 usr
     I                                    P  37  380P2IKNX
      * N :  Hour 4 USR
     I                                    P  39  400P2ILNX
      * B :  System Value Numeric
     I                                    P  41  485P2M8NB
      * B :  Manual Prc Err Sts USR
     I                                       49  49 P2HOSX
      * B :  Projected Market Price
     I                                    P  50  554P2B8PR
      * B :  Average Ship Wgt Err USR
     I                                       56  56 P2Q6SX
      * B :  InterCo Price Err USR
     I                                       57  57 P2X6SX
      * B :  Record Found USR
     I                                       58  58 P2WXST
      * B :  Order Status
     I                                       59  59 P2UCST
      * N :  One Invoice Per PO
     I                                       60  60 P2HUSX
      * B :  GTIN Error Sts USR
     I                                       61  61 P2BBSC
      * B :  GTIN Error Item Code USR
     I                                    P  62  650P2FYC7
     IP3PARM      DS
      * N :  Ship Date USR
     I                                    P   1   40P3HLDT
     IP4PARM      DS
      * O :  Item Code USR
     I                                    P   1   40P4B6C7
     IP5PARM      DS
      * FLD: Company Item
      * O :  Item Code
     I                                    P   1   40P5HGCD
      * B :  Default Commod Mark basis
     I                                        5   7 P5LNCD
      * B :  Market Overage
     I                                    P   8  134P5BLPR
      * B :  Commodity Price Group
     I                                       14  20 P5LRCD
     IP6PARM      DS
      * FLD: Company Customer
      * N :  Type Code
     I                                        1   2 P6BOCD
     IP7PARM      DS
      * O :  Price Overage Override
     I                                    P   1   64P7BZPR
     IP8PARM      DS
      * I :  Process Cust Types Usr
     I                                        1   2 P8YDSX
     IP9PARM      DS
      * FLD: *Arrays
      * B :  USR Check Y/N Status
     I                                        1   1 P9JDST
      * B :  D-EDI INV PROC FLAG
     I                                        2   2 P9FLGX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1C4NB    PARM           WP0002  70       Order Number
     C           P1JNCD    PARM           WP0003  2        Order Type - Sa
     C           P1ANC7    PARM           WP0004  70       A/R Customer Nu
     C           P1BKC7    PARM           WP0005  70       Ship To Custome
     C           P1BCNA    PARM           WP0006 15        Customer Purcha
     C           P1A0DT    PARM           WP0007  70       Order Date
     C           P1GNDT    PARM           WP0008  70       Actual Shipped
     C           P1GWST    PARM           WP0009  1        Header Status
     C           P1GXST    PARM           WP0010  1        Header Status L
     C           P1AODT    PARM           WP0011  70       Scheduled Ship
     C           P1RMNB    PARM           WP0012  70       Load ID
     C           P1U0ST    PARM           WP0013  1        Price Audit
     C           P1U1ST    PARM           WP0014  1        Price Status
     C           P1Q2CD    PARM           WP0015  2        Shipping Method
     C           P1R4CD    PARM           WP0016  3        Sales Route Cod
     C           P1JPCD    PARM           WP0017  2        Event Code
     C           P1OBST    PARM           WP0018  1        Billing Activit
     C           P2MPNB    PARM           WP0019  70       USR Order Numbe
     C           P2LOID    PARM           WP0020  70       Load ID USR
     C           P2USBA    PARM           WP0021  1        USR Billing Act
     C           P2JWDT    PARM           WP0022  70       USR Actual Ship
     C           P2F6ST    PARM P2F6ST    WP0023  1        Update Exceptio
     C           P2RSL     PARM P2RSL     WP0024  1        *Record selecte
     C           P2PPIX    PARM P2PPIX    WP0025  1        Print Pre-Inv/E
     C           P2GESX    PARM P2GESX    WP0026  1        Departure Sts U
     C           P2M8NB    PARM P2M8NB    WP0027 155       System Value Nu
     C           P2HOSX    PARM P2HOSX    WP0028  1        Manual Prc Err
     C           P2B8PR    PARM P2B8PR    WP0029 114       Projected Marke
     C           P2Q6SX    PARM P2Q6SX    WP0030  1        Average Ship Wg
     C           P2X6SX    PARM P2X6SX    WP0031  1        InterCo Price E
     C           P2WXST    PARM P2WXST    WP0032  1        Record Found US
     C           P2UCST    PARM P2UCST    WP0033  1        Order Status
     C           P2BBSC    PARM P2BBSC    WP0034  1        GTIN Error Sts
     C           P2FYC7    PARM P2FYC7    WP0035  70       GTIN Error Item
     C           P4B6C7    PARM P4B6C7    WP0036  70       Item Code USR
     C           P5HGCD    PARM P5HGCD    WP0037  70       Item Code
     C           P5LNCD    PARM P5LNCD    WP0038  3        Default Commod
     C           P5BLPR    PARM P5BLPR    WP0039 114       Market Overage
     C           P5LRCD    PARM P5LRCD    WP0040  7        Commodity Price
     C           P7BZPR    PARM P7BZPR    WP0041 114       Price Overage O
     C           P8YDSX    PARM           WP0042  2        Process Cust Ty
     C           P9JDST    PARM P9JDST    WP0043  1        USR Check Y/N S
     C           P9FLGX    PARM P9FLGX    WP0044  1        D-EDI INV PROC
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * PRT Invc Excpt Select  XF
     C                     MOVELWUGSTX    P2PPIX           Print Pre-Inv/E
     C                     MOVELWUGSTX    P2F6ST           Update Exceptio
     C                     MOVELWUGSTX    P2PKST           Load Status
     C                     MOVEL*BLANK    P9JDST           USR Check Y/N S
      * ** The usr actual ship date = asd entered on the screen
      * ** Put DB1.ASD into the usr date shipped work field
     C                     Z-ADDP1GNDT    P2FADT           USR Date Shippe
     C                     MOVEL*BLANK    P2UCST           Order Status
      * Validate the first one
      * 05/01/18 DN R12926-Removed Absorbed Freight Rate CWT Parm on PMF3
      * PRT Invc Excpt Sel Val XF - Order Header TRG  * 
     C                     CALL 'PMF3XFR'              90  PRT Invc Excpt
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1AIC3    WQ0001  30       Company Number
     C                     PARM P1C4NB    WQ0002  70       Order Number
     C                     PARM P1JNCD    WQ0003  2        Order Type - Sa
     C                     PARM P1ANC7    WQ0004  70       A/R Customer Nu
     C                     PARM P1BKC7    WQ0005  70       Ship To Custome
     C                     PARM P1BCNA    WQ0006 15        Customer Purcha
     C                     PARM P1A0DT    WQ0007  70       Order Date
     C                     PARM P1GNDT    WQ0008  70       Actual Shipped
     C                     PARM P1GWST    WQ0009  1        Header Status
     C                     PARM P1GXST    WQ0010  1        Header Status L
     C                     PARM P1AODT    WQ0011  70       Scheduled Ship
     C                     PARM P1RMNB    WQ0012  70       Load ID
     C                     PARM P1U0ST    WQ0013  1        Price Audit
     C                     PARM P1U1ST    WQ0014  1        Price Status
     C                     PARM P1Q2CD    WQ0015  2        Shipping Method
     C                     PARM P1R4CD    WQ0016  3        Sales Route Cod
     C                     PARM P1JPCD    WQ0017  2        Event Code
     C                     PARM P1OBST    WQ0018  1        Billing Activit
     C                     PARM P2MPNB    WQ0019  70       USR Order Numbe
     C                     PARM P2LOID    WQ0020  70       Load ID USR
     C                     PARM P2USBA    WQ0021  1        USR Billing Act
     C                     PARM P2JWDT    WQ0022  70       USR Actual Ship
     C           P2F6ST    PARM P2F6ST    WQ0023  1        Update Exceptio
     C           P2RSL     PARM P2RSL     WQ0024  1        *Record selecte
     C           YL0001    PARM *BLANK    WQ0025  1        Print Pre-Inv/E
     C           P2GESX    PARM *BLANK    WQ0026  1        Departure Sts U
     C           P2M8NB    PARM P2M8NB    WQ0027 155       System Value Nu
     C           P2HOSX    PARM P2HOSX    WQ0028  1        Manual Prc Err
     C           P2B8PR    PARM P2B8PR    WQ0029 114       Projected Marke
     C           P2Q6SX    PARM P2Q6SX    WQ0030  1        Average Ship Wg
     C           P2X6SX    PARM P2X6SX    WQ0031  1        InterCo Price E
     C           P2WXST    PARM P2WXST    WQ0032  1        Record Found US
     C           P2UCST    PARM P2UCST    WQ0033  1        Order Status
     C           P2BBSC    PARM P2BBSC    WQ0034  1        GTIN Error Sts
     C           P2FYC7    PARM P2FYC7    WQ0035  70       GTIN Error Item
     C           P4B6C7    PARM *ZERO     WQ0036  70       Item Code USR
     C           P5HGCD    PARM *ZERO     WQ0037  70       Item Code
     C           P5LNCD    PARM P5LNCD    WQ0038  3        Default Commod
     C           P5BLPR    PARM P5BLPR    WQ0039 114       Market Overage
     C           P5LRCD    PARM P5LRCD    WQ0040  7        Commodity Price
     C           P7BZPR    PARM *ZERO     WQ0041 114       Price Overage O
     C                     PARM P8YDSX    WQ0042  2        Process Cust Ty
     C           P9JDST    PARM P9JDST    WQ0043  1        USR Check Y/N S
     C           P9FLGX    PARM P9FLGX    WQ0044  1        D-EDI INV PROC
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMF3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0001    P2PPIX           Print Pre-Inv/E
      * CASE: PAR.Billing Activity Type is Invoice
     C           P1OBST    IFEQ '1'                        *IF
      * Rtv One Invoice /PO   RT - Customer EXT  * 
     C                     EXSR SARVGN
     C                     MOVELWUGSTX    YL0002           Combo Exception
      * Combo po
      * CASE: PAR.One Invoice Per PO is Yes
     C           P2HUSX    IFEQ 'Y'                        *IF
      * CASE: PAR.Order Status is Open
     C           P2UCST    IFEQ 'O'                        *IF
      * *Note This will print error on the exception report  slm 042307
     C                     MOVEL'E'       YL0001           Print Pre-Inv/E
     C                     END                             *FI
      *  doc: on the multi records being searched for this combo
     C                     EXSR UASUBR                      doc: on the mu
      * PASS IN ZERO ON THE USER ORDER, AND USER DATE but do
      * pass in the load id based on PARM
      * following is the process for the combo orders
      * CASE: LCL.Print Pre-Inv/Exception is Print on Exception
     C           YL0001    IFEQ 'E'                        *IF
      * If errors then STOP. No need to loop thru more records for this
      * combo po. We will not print any of the orders if at least 1 error
     C                     ELSE
      * CASE: *OTHERWISE
      * First record was good now let see if the whole group is fine
      * also will validate if this order has all orders ready
      * for shipment.
      * Move Parm to LCL
     C                     EXSR UBSUBR                     Move Parm to LC
      * Val ComboAllasOne /PO RT - Order Header TRG  * 
     C                     EXSR SBRVGN
      * These errors will print on the exception report  slm 042307
      * CASE: LCL.Order Status is Open
     C           YL0030    IFEQ 'O'                        *IF
     C                     MOVEL'E'       YL0001           Print Pre-Inv/E
     C                     MOVELYL0030    P2UCST           Order Status
     C                     ELSE
      * CASE: LCL.Order Status is Cmb PO has Errors
     C           YL0030    IFEQ 'E'                        *IF
     C                     MOVEL'E'       YL0001           Print Pre-Inv/E
     C                     MOVELYL0030    P2UCST           Order Status
     C                     END                             *FI
     C                     END                             *FI
      * errors
      * CASE: LCL.Print Pre-Inv/Exception is Print on Exception
     C           YL0001    IFEQ 'E'                        *IF
     C                     MOVEL'E'       P2UCST           Order Status
     C                     MOVELYL0001    P2PPIX           Print Pre-Inv/E
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv One Invoice /PO   RT - Customer EXT  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WABKC7           Ship To Custome
      * Setup key
     C                     Z-ADDP1BKC7    WABKC7           Ship To Custome
      * Establish starting position
     C           KRSSA     CHAIN@NEREAT              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2880' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       P2HUSX           One Invoice Per
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWAHUSX    P2HUSX           One Invoice Per
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Val ComboAllasOne /PO RT - Order Header TRG  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       USR Date Shippe
     C                     MOVEL*BLANK    WN0002  1        Load Status
     C                     Z-ADD*ZERO     WN0003  70       Truck Departure
     C                     Z-ADD*ZERO     WN0004  60       Truck Departure
     C                     Z-ADD*ZERO     WN0005  20       Hour 3 USR
     C                     Z-ADD*ZERO     WN0006  20       Hour 1 USR
     C                     Z-ADD*ZERO     WN0007  20       Day NBR USR
     C                     Z-ADD*ZERO     WN0008  20       Hour 2 usr
     C                     Z-ADD*ZERO     WN0009  20       Hour 4 USR
     C                     Z-ADD*ZERO     WN0010 114       Projected Marke
     C                     MOVEL*BLANK    WN0011  1        Average Ship Wg
     C                     MOVEL*BLANK    WN0012  1        One Invoice Per
     C                     Z-ADD*ZERO     WN0013  70       Ship Date USR
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     MOVEL'C'       YL0030           Order Status
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBBKC7    WQSB02           Ship To Custome
     C           *LIKE     DEFN WBBCNA    WQSB03           Customer Purcha
     C           *LIKE     DEFN WBAODT    WQSB04           Scheduled Ship
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Ship To Custome
     C                     KFLD           WQSB03           Customer Purcha
     C                     KFLD           WQSB04           Scheduled Ship
      * Setup key
     C                     Z-ADDYL0003    WQSB01           Company Number
     C                     Z-ADDYL0006    WQSB02           Ship To Custome
     C                     MOVELYL0007    WQSB03           Customer Purcha
     C                     Z-ADDYL0012    WQSB04           Scheduled Ship
      * Establish starting position
     C           KRSSB     SETLL@BFCPHR                    *
     C           KRSSB     READE@BFCPHR                  90*
      * Data record not found
     C   90                MOVEL'USR0176' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Header Status is Conf/Comp/Canc
     C           WBGWST    IFEQ 'X'                        *IF
     C           WBGWST    OREQ 'C'
     C           WBGWST    OREQ 'R'
      * PRT Invc Excpt Sel Val XF - Order Header TRG  * 
     C                     CALL 'PMF3XFR'              90  PRT Invc Excpt
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WBAIC3    WQ0045  30       Company Number
     C                     PARM WBC4NB    WQ0046  70       Order Number
     C                     PARM WBJNCD    WQ0047  2        Order Type - Sa
     C                     PARM WBANC7    WQ0048  70       A/R Customer Nu
     C                     PARM WBBKC7    WQ0049  70       Ship To Custome
     C                     PARM WBBCNA    WQ0050 15        Customer Purcha
     C                     PARM WBA0DT    WQ0051  70       Order Date
     C                     PARM WBGNDT    WQ0052  70       Actual Shipped
     C                     PARM WBGWST    WQ0053  1        Header Status
     C                     PARM WBGXST    WQ0054  1        Header Status L
     C                     PARM WBAODT    WQ0055  70       Scheduled Ship
     C                     PARM WBRMNB    WQ0056  70       Load ID
     C                     PARM WBU0ST    WQ0057  1        Price Audit
     C                     PARM WBU1ST    WQ0058  1        Price Status
     C                     PARM WBQ2CD    WQ0059  2        Shipping Method
     C                     PARM WBR4CD    WQ0060  3        Sales Route Cod
     C                     PARM WBJPCD    WQ0061  2        Event Code
     C                     PARM WBOBST    WQ0062  1        Billing Activit
     C                     PARM 0         WQ0063  70       USR Order Numbe
     C                     PARM YL0020    WQ0064  70       Load ID USR
     C                     PARM YL0021    WQ0065  1        USR Billing Act
     C                     PARM 0         WQ0066  70       USR Actual Ship
     C           YL0023    PARM YL0023    WQ0067  1        Update Exceptio
     C           YL0024    PARM YL0024    WQ0068  1        *Record selecte
     C           YL0042    PARM *BLANK    WQ0069  1        Print Pre-Inv/E
     C           YL0025    PARM *BLANK    WQ0070  1        Departure Sts U
     C           YL0026    PARM YL0026    WQ0071 155       System Value Nu
     C           YL0027    PARM YL0027    WQ0072  1        Manual Prc Err
     C           WN0010    PARM WN0010    WQ0073 114       Projected Marke
     C           WN0011    PARM WN0011    WQ0074  1        Average Ship Wg
     C           YL0028    PARM YL0028    WQ0075  1        InterCo Price E
     C           YL0029    PARM YL0029    WQ0076  1        Record Found US
     C           YL0030    PARM YL0030    WQ0077  1        Order Status
     C           YL0043    PARM YL0043    WQ0078  1        GTIN Error Sts
     C           YL0044    PARM YL0044    WQ0079  70       GTIN Error Item
     C           YL0032    PARM *ZERO     WQ0080  70       Item Code USR
     C           YL0045    PARM *ZERO     WQ0081  70       Item Code
     C           YL0034    PARM YL0034    WQ0082  3        Default Commod
     C           YL0035    PARM YL0035    WQ0083 114       Market Overage
     C           YL0036    PARM YL0036    WQ0084  7        Commodity Price
     C           YL0046    PARM *ZERO     WQ0085 114       Price Overage O
     C                     PARM YL0040    WQ0086  2        Process Cust Ty
     C           YL0041    PARM YL0041    WQ0087  1        USR Check Y/N S
     C           P9FLGX    PARM P9FLGX    WQ0088  1        D-EDI INV PROC
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PMF3XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: LCL.Print Pre-Inv/Exception is Print on Exception
     C           YL0042    IFEQ 'E'                        *IF
     C                     MOVELYL0042    YL0001           Print Pre-Inv/E
     C                     MOVEL'E'       YL0030           Order Status
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
      * CASE: LCL.Record Found USR is Record Found
     C           YL0047    IFEQ 'Y'                        *IF
     C                     MOVELYL0047    YL0029           Record Found US
     C                     MOVEL'E'       YL0030           Order Status
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
      * Reason 1:  Order Unpriced
      * CASE: DB1.Price Status is Unpriced
     C           WBU1ST    IFEQ 'U'                        *IF
     C                     MOVEL'E'       YL0001           Print Pre-Inv/E
     C                     MOVEL'E'       YL0030           Order Status
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
      * Reason 2:  Order Marked for Price Audit
      * CASE: DB1.Price Audit is Needs Price Audit
     C           WBU0ST    IFEQ 'N'                        *IF
     C                     MOVEL'E'       YL0001           Print Pre-Inv/E
     C                     MOVEL'E'       YL0030           Order Status
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'O'       YL0030           Order Status
     C                     MOVEL'E'       YL0042           Print Pre-Inv/E
     C                     MOVELYL0042    YL0001           Print Pre-Inv/E
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSB     READE@BFCPHR                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      *  doc: on the multi records being searched for this combo
      *================================================================
      * Get the first one based on the order number so we can have the
      * order information for the one we are working with.
      * The next Routine will read all of the orders by
      * Customer/PO/Schedule Shipped Date and perform the validation.
      * Rules will be the same as a non combo, but we have to make sure
      * the whole group is validated
      * If error(s) on one or more then the print exception will be
      * turned on for the whole group.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Move Parm to LCL
      *================================================================
     C                     MOVEL*BLANK    YL0001           Print Pre-Inv/E
     C                     Z-ADDP1AIC3    YL0003           Company Number
     C                     Z-ADDP1C4NB    YL0004           Order Number
     C                     MOVELP1JNCD    YL0005           Order Type - Sa
     C                     Z-ADDP1BKC7    YL0006           Ship To Custome
     C                     MOVELP1BCNA    YL0007           Customer Purcha
     C                     Z-ADDP1A0DT    YL0008           Order Date
     C                     Z-ADDP1GNDT    YL0009           Actual Shipped
     C                     MOVELP1GWST    YL0010           Header Status
     C                     MOVELP1GXST    YL0011           Header Status L
     C                     Z-ADDP1AODT    YL0012           Scheduled Ship
     C                     Z-ADDP1RMNB    YL0013           Load ID
     C                     MOVELP1U1ST    YL0014           Price Status
     C                     MOVELP1Q2CD    YL0015           Shipping Method
     C                     MOVELP1R4CD    YL0016           Sales Route Cod
     C                     MOVELP1JPCD    YL0017           Event Code
     C                     MOVELP1OBST    YL0018           Billing Activit
     C                     Z-ADDP2MPNB    YL0019           USR Order Numbe
     C                     Z-ADDP2LOID    YL0020           Load ID USR
     C                     MOVELP2USBA    YL0021           USR Billing Act
     C                     Z-ADDP2JWDT    YL0022           USR Actual Ship
     C                     MOVELP2F6ST    YL0023           Update Exceptio
     C                     MOVELP2RSL     YL0024           *Record selecte
     C                     MOVEL*BLANK    YL0001           Print Pre-Inv/E
     C                     MOVELWUW0NB    YL0025           Departure Sts U
     C                     Z-ADDP2M8NB    YL0026           System Value Nu
     C                     MOVELP2HOSX    YL0027           Manual Prc Err
     C                     MOVELP2X6SX    YL0028           InterCo Price E
     C                     MOVELP2WXST    YL0029           Record Found US
     C                     MOVEL*BLANK    YL0030           Order Status
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2FADT           USR Date Shippe
     C                     MOVEL*BLANK    P2PKST           Load Status
     C                     Z-ADD*ZERO     P2KIDT           Truck Departure
     C                     Z-ADD*ZERO     P2ASTM           Truck Departure
     C                     Z-ADD*ZERO     P2IINX           Hour 3 USR
     C                     Z-ADD*ZERO     P2IJNX           Hour 1 USR
     C                     Z-ADD*ZERO     P2DNBU           Day NBR USR
     C                     Z-ADD*ZERO     P2IKNX           Hour 2 usr
     C                     Z-ADD*ZERO     P2ILNX           Hour 4 USR
     C                     MOVEL*BLANK    P2HUSX           One Invoice Per
     C                     Z-ADD*ZERO     P3HLDT           Ship Date USR
     C                     MOVEL*BLANK    P6BOCD           Type Code
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field BLANK
     C                     MOVEL*BLANK    WUGSTX256
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAAAC8           Customer G/L Ve
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBB0C7           Bill to Custome
     C                     Z-ADD*ZERO     WBA0DT           Order Date
     C                     Z-ADD*ZERO     WBA5DT           Requested Ship
     C                     Z-ADD*ZERO     WBGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WBACDT           Cancel Date
     C                     Z-ADD*ZERO     WBAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WBCXDT           Date of Origina
     C                     Z-ADD*ZERO     WBJZVA           Order Value Tot
     C                     Z-ADD*ZERO     WBA1WG           Order Weight To
     C                     Z-ADD*ZERO     WBEIDT           Requested Deliv
     C                     Z-ADD*ZERO     WBAFTM           Requested Deliv
     C                     Z-ADD*ZERO     WBRMNB           Load ID
     C                     Z-ADD*ZERO     WBTBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WBR1NB           Rated Freight
     C                     Z-ADD*ZERO     WBRNNB           Reefer Temperat
     C                     Z-ADD*ZERO     WBATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WBRSRN           Resell Referenc
     C                     Z-ADD*ZERO     WBT3NB           Attach to Order
     C                     Z-ADD*ZERO     WBCONB           Invoice Number
     C                     Z-ADD*ZERO     WBAWDT           Invoice Date
     C                     Z-ADD*ZERO     WBVRVA           A/R order Value
     C                     Z-ADD*ZERO     WBB7VL           Invoice Order V
     C                     Z-ADD*ZERO     WBNODT           OH Appt Confirm
     C                     Z-ADD*ZERO     WBNPDT           JPN Invoice Iss
     C                     Z-ADD*ZERO     WBNQDT           Load Actual Shi
     C                     Z-ADD*ZERO     WBNRDT           Load BOL Comple
     C                     Z-ADD*ZERO     WBNSDT           Load Truck Depa
     C                     Z-ADD*ZERO     WBBPTM           Maximum Gross W
     C                     Z-ADD*ZERO     WBBQTM           Time of Origina
     C                     Z-ADD*ZERO     WBBRTM           OH Appt Confirm
     C                     Z-ADD*ZERO     WBBSTM           Load BOL Comple
     C                     Z-ADD*ZERO     WBBTTM           Load Truck Depa
     C                     Z-ADD*ZERO     WBH0NX           Act Frt Referen
     C                     Z-ADD*ZERO     WBH1NX           Act Non-Ref Frt
     C                     Z-ADD*ZERO     WBH2NX           OH Fuel Surchar
     C                     Z-ADD*ZERO     WBH3NX           OH Total Non-Re
     C                     Z-ADD*ZERO     WBH4NX           OH Total Ref Fr
     C                     Z-ADD*ZERO     WBC0C7           Claim Number
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Print Pre-Inv/Exception
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Combo Exception Error Usr
     C                     MOVEL*BLANK    YL0002  1
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0003  30
      * Define local work field Order Number
     C                     Z-ADD*ZERO     YL0004  70
      * Define local work field Order Type - Sales
     C                     MOVEL*BLANK    YL0005  2
      * Define local work field Ship To Customer
     C                     Z-ADD*ZERO     YL0006  70
      * Define local work field Customer Purchase Order #
     C                     MOVEL*BLANK    YL0007 15
      * Define local work field Order Date
     C                     Z-ADD*ZERO     YL0008  70
      * Define local work field Actual Shipped Date
     C                     Z-ADD*ZERO     YL0009  70
      * Define local work field Header Status
     C                     MOVEL*BLANK    YL0010  1
      * Define local work field Header Status Last
     C                     MOVEL*BLANK    YL0011  1
      * Define local work field Scheduled Ship Date
     C                     Z-ADD*ZERO     YL0012  70
      * Define local work field Load ID
     C                     Z-ADD*ZERO     YL0013  70
      * Define local work field Price Status
     C                     MOVEL*BLANK    YL0014  1
      * Define local work field Shipping Method
     C                     MOVEL*BLANK    YL0015  2
      * Define local work field Sales Route Code
     C                     MOVEL*BLANK    YL0016  3
      * Define local work field Event Code
     C                     MOVEL*BLANK    YL0017  2
      * Define local work field Billing Activity Type
     C                     MOVEL*BLANK    YL0018  1
      * Define local work field USR Order Number
     C                     Z-ADD*ZERO     YL0019  70
      * Define local work field Load ID USR
     C                     Z-ADD*ZERO     YL0020  70
      * Define local work field USR Billing Activty Type
     C                     MOVEL*BLANK    YL0021  1
      * Define local work field USR Actual Shipped Date
     C                     Z-ADD*ZERO     YL0022  70
      * Define local work field Update Exception Status
     C                     MOVEL*BLANK    YL0023  1
      * Define local work field *Record selected
     C                     MOVEL*BLANK    YL0024  1
      * Define local work field Departure Sts USR
     C                     MOVEL*BLANK    YL0025  1
      * Define local work field System Value Numeric
     C                     Z-ADD*ZERO     YL0026 155
      * Define local work field Manual Prc Err Sts USR
     C                     MOVEL*BLANK    YL0027  1
      * Define local work field InterCo Price Err USR
     C                     MOVEL*BLANK    YL0028  1
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0029  1
      * Define local work field Order Status
     C                     MOVEL*BLANK    YL0030  1
      * Define local work field Price Audit
     C                     MOVEL*BLANK    YL0031  1
      * Define local work field Item Code USR
     C                     Z-ADD*ZERO     YL0032  70
      * Define local work field Item Code
     C                     Z-ADD*ZERO     YL0033  70
      * Define local work field Default Commod Mark basis
     C                     MOVEL*BLANK    YL0034  3
      * Define local work field Market Overage
     C                     Z-ADD*ZERO     YL0035 114
      * Define local work field Commodity Price Group
     C                     MOVEL*BLANK    YL0036  7
      * Define local work field Commodity Market Code
     C                     MOVEL*BLANK    YL0037  3
      * Define local work field Default Shipping Co Sts
     C                     MOVEL*BLANK    YL0038  1
      * Define local work field Price Overage Override
     C                     Z-ADD*ZERO     YL0039 114
      * Define local work field Process Cust Types Usr
     C                     MOVEL*BLANK    YL0040  2
      * Define local work field USR Check Y/N Status
     C                     MOVEL*BLANK    YL0041  1
      * Define local work field Print Pre-Inv/Exception
     C                     MOVEL*BLANK    YL0042  1
      * Define local work field GTIN Error Sts USR
     C                     MOVEL*BLANK    YL0043  1
      * Define local work field GTIN Error Item Code USR
     C                     Z-ADD*ZERO     YL0044  70
      * Define local work field Item Code
     C                     Z-ADD*ZERO     YL0045  70
      * Define local work field Price Overage Override
     C                     Z-ADD*ZERO     YL0046 114
      * Define local work field Record Found USR
     C                     MOVEL*BLANK    YL0047  1
      *================================================================
     CSR         ZZEXIT    ENDSR
