// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBMRXFR
// ?Date: 14.08.2025 Time: 03:48:35
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(UPD Mass CarrDest Rate RT) TYPE(RTVOBJ) FILE(PDLECPP)          AC2088787;
PARAMETER(PAR.Carrier_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Destination_City);
PARAMETER(PAR.State_Code);
PARAMETER(PAR.Rate_Adjustment);
PARAMETER(PAR.Rate_Adjustment_Type_sts);
PARAMETER(PAR.Select_Option);
{
 //?USER: Processing if Data record not found

 //?* Not an error if no record is found
 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(CHG Mass CarrDest Rate CH) TYPE(CHGOBJ) FILE(PDLECPP)          AC2088785;
 PARAMETER(DB1.Carrier_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.Destination_City);
 PARAMETER(DB1.State_Code);
 PARAMETER(DB1.Flat_Rate);
 PARAMETER(DB1.CDR_Unit_of_Measure);
 PARAMETER(DB1.Bulk_Rate);
 PARAMETER(DB1.Export_Fresh_Flat_Amt);
 PARAMETER(DB1.Export_Frozen_Flat_Amt);
 PARAMETER(DB1.Double_Fuel_Surcharge_Sts);
 PARAMETER(DB1.CDR_Unused_Sts_2);
 PARAMETER(DB1.CDR_Unused_Date_1);
 PARAMETER(DB1.CDR_Unused_Date_2);
 PARAMETER(DB1.CDR_Unused_Amount);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 PARAMETER(PAR.Rate_Adjustment);
 PARAMETER(PAR.Rate_Adjustment_Type_sts);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*JOB
   PAR.Job_Name = JOB.*JOB;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

  //?* Adjust Rate Per Mile
  CASE;

  // IF DB1.Flat Rate is NE Zero
  IF DB1.Flat_Rate <> *ZERO;

  CASE;

  // IF PAR.Rate Adjustment Type sts is Increase
  IF PAR.Rate_Adjustment_Type_sts = 'I';

  // DB1.Flat Rate = PAR.Rate Adjustment + DB1.Flat Rate
  DB1.Flat_Rate = PAR.Rate_Adjustment + DB1.Flat_Rate;

  ENDIF;

  CASE;

  // IF PAR.Rate Adjustment Type sts is Decrease
  IF PAR.Rate_Adjustment_Type_sts = 'D';

  // DB1.Flat Rate = PAR.Rate Adjustment - DB1.Flat Rate
  DB1.Flat_Rate = PAR.Rate_Adjustment - DB1.Flat_Rate;

  ENDIF;

  //?* Convert adjustment to percent then calc amount and add to rate
  CASE;

  // IF PAR.Rate Adjustment Type sts is Percent
  IF PAR.Rate_Adjustment_Type_sts = 'P';

  // LCL.Percent 7.4 USR = PAR.Rate Adjustment * CON..01 *
  LCL.Percent_7_4_USR = PAR.Rate_Adjustment * .01;

  // LCL.Flat Rate = LCL.Percent 7.4 USR * DB1.Flat Rate *
  LCL.Flat_Rate = LCL.Percent_7_4_USR * DB1.Flat_Rate;

  // DB1.Flat Rate = LCL.Flat Rate + DB1.Flat Rate
  DB1.Flat_Rate = LCL.Flat_Rate + DB1.Flat_Rate;

  ENDIF;

  ENDIF;

  //?* Adjust Bulk Rate
  CASE;

  // IF DB1.Bulk Rate is Not Zeros
  IF DB1.Bulk_Rate <> *ZERO;

  CASE;

  // IF PAR.Rate Adjustment Type sts is Increase
  IF PAR.Rate_Adjustment_Type_sts = 'I';

  // DB1.Bulk Rate = PAR.Rate Adjustment + DB1.Bulk Rate
  DB1.Bulk_Rate = PAR.Rate_Adjustment + DB1.Bulk_Rate;

  ENDIF;

  CASE;

  // IF PAR.Rate Adjustment Type sts is Decrease
  IF PAR.Rate_Adjustment_Type_sts = 'D';

  // DB1.Bulk Rate = PAR.Rate Adjustment - DB1.Bulk Rate
  DB1.Bulk_Rate = PAR.Rate_Adjustment - DB1.Bulk_Rate;

  ENDIF;

  //?* Convert adjustment to percent then calc amount and add to rate
  CASE;

  // IF PAR.Rate Adjustment Type sts is Percent
  IF PAR.Rate_Adjustment_Type_sts = 'P';

  // LCL.Percent 7.4 USR = PAR.Rate Adjustment * CON..01 *
  LCL.Percent_7_4_USR = PAR.Rate_Adjustment * .01;

  // LCL.Bulk Rate = LCL.Percent 7.4 USR * DB1.Bulk Rate *
  LCL.Bulk_Rate = LCL.Percent_7_4_USR * DB1.Bulk_Rate;

  // DB1.Bulk Rate = LCL.Bulk Rate + DB1.Bulk Rate
  DB1.Bulk_Rate = LCL.Bulk_Rate + DB1.Bulk_Rate;

  ENDIF;

  ENDIF;

 }

}


