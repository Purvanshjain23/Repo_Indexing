/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  JOB CONTROL PROMPT FOR PRINTER OVERRIDE INFORMATION */
/*              FOR LOAD ORDER CHANGE LOG FOR MPR AUDIT             */
/*                                                                  */
/*  SYSTEM    - OMS                                                 */
/*  PROGRAM   - PRT MPR AUDIT LOAD ORDER CHANGE LOG                 */
/*  DATE      - 10/29/12                                            */
/*                                                                  */
/*********************************************************************/
/* Modifications:                                                   */
/*                                                                  */
/*   Date     Pgmr     Description                                  */
/* -------- ---------- -------------------------------------------- */
/*********************************************************************/
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     O    &RETURN     - RETURN CODE                               */
/*     B    &ORDER      - ORDER          (PASSED)                   */
/*     B    &OUTQ       -  OUTPUT QUEUE                             */
/*     B    &HOLD       -  HOLD STATUS                              */
/*     B    &SAVE       -  SAVE STATUS                              */
/*     B    &COPYN      - NO. OF COPIES  (PASSED)                   */
/********************************************************************/
/* RMC 8/27/2013 E     CHG KEY ON PRNT FILE TO BE BY ORDER, IN CASE */
/*                     IT REPORTED ON DIFF DAYS                     */
/********************************************************************/

 PBF4UPC:    PGM        PARM(&RETURN  &OUTQ +
                          &HOLD &SAVE  &COMPYN &ORDERN &COPYN &IDENT +
                          &RPTDT &RPTTM &LOTID)
/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */
        DCL    &ORDERN     *DEC                  /* ORDER #                   */
        DCL    &COMPYN     *DEC                  /* COMPANY                   */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &IDENT      *CHAR   (05)          /* PLANT ID                  */
        DCL    &LOTID      *CHAR   (25)          /* LOT ID = ORDER #          */
        DCL    &RPTDT      *DEC    (07)          /* RPT DATE                  */
        DCL    &RPTTM      *DEC    (1)          /* RPT TIME                  */

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMP       *DEC    (3 0)         /* COMPANY                   */
        DCL    &ORDER      *DEC    (7 0)         /* ORDER #                   */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)

/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&ORDER) VALUE(&ORDERN)
             CHGVAR     VAR(&COMP) VALUE(&COMPYN)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

/********************************************************************/
/*   CALL PRINT MPR FILE DETAIL                               */
/********************************************************************/

             OVRPRTF    FILE(PBF9PFR$) OUTQ(&OUTQ) COPIES(&COPY) +
                          HOLD(&HOLD) SAVE(&SAVE)
             CALL       PGM(PBF9PFR) PARM(&RETURN  &LOTID)
/********************************************************************/
/*   CALL PRINT CHANGE LOGS                                    */
/********************************************************************/

             OVRPRTF    FILE(PBGLPFR$) OUTQ(&OUTQ) COPIES(&COPY) +
                          HOLD(&HOLD) SAVE(&SAVE)
             CALL       PGM(PBGLPFR) PARM(&RETURN &COMP &ORDER)
/********************************************************************/
/*   CALL PRINT ORDER ACCRUALS                                */
/********************************************************************/

             OVRPRTF    FILE(PBF6PFR$) OUTQ(&OUTQ) COPIES(&COPY) +
                          HOLD(&HOLD) SAVE(&SAVE)
             CALL       PGM(PBF6PFR) PARM(&RETURN &COMP  &ORDER)

/********************************************************************/
/*   EXEC SQL OF MPR FILE ENTRIES                                */
/********************************************************************/
     GOTO       CMDLBL(END)
             REPORT     REPORT(SQPBAOCPOR) +
                          VIEW(SQPBAOCPO) HOLD(&HOLD) +
                          SAVE(&SAVE) SETVAR((&LOTID &LOTID)) +
                          OUTQ(&OUTQ)
             GOTO       CMDLBL(END)

/*-------------------------USER QUIT--------------------------------*/
 USERQUIT:   CHGVAR     VAR(&RETURN) VALUE('Y2U0005')
             GOTO       CMDLBL(END)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM
