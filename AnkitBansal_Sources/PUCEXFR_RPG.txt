     H/TITLE Cnv Crt Packaging BOM XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 08/14/18  Time  : 11:13:54
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     Fpckgitmbomif   e           k disk                                         Pckg BOM Raw Data
     FPOARREL1  IF   E           K DISK
      * RTV : Packaging Item            Retrieval index
      *
     FCABZREL1  IF   E           K DISK
      * RTV : Company Item              Retrieval index       NV
      *
     FPOAZCPL1  IF   E           K DISK
      * RTV : Packaging BOM             Retrieval index
      *
     FPOAZCPL0  UF A E           K DISK
      * UPD : Packaging BOM             Update index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QPOAZ1        E DS                  EXTNAME(POAZCPL0)
      * UPD : Packaging BOM             Update index
      * Renamed input format fields
     D  WDAIC3       E                     EXTFLD(AZAIC3)
     D  WDHGCD       E                     EXTFLD(AZHGCD)
     D  WDBRAA       E                     EXTFLD(AZBRAA)
     D  WDM1QT       E                     EXTFLD(AZM1QT)
     D  WDI5SX       E                     EXTFLD(AZI5SX)
     D  WDD8AA       E                     EXTFLD(AZD8AA)
     D  WDM3SX       E                     EXTFLD(AZM3SX)
     D  WDM7SX       E                     EXTFLD(AZM7SX)
     D  WDM8SX       E                     EXTFLD(AZM8SX)
     D  WDVSST       E                     EXTFLD(AZVSST)
     D  WDMJDT       E                     EXTFLD(AZMJDT)
     D  WDBETM       E                     EXTFLD(AZBETM)
     D  WDCCVN       E                     EXTFLD(AZCCVN)
     D  WDCDVN       E                     EXTFLD(AZCDVN)
     D  WDMKDT       E                     EXTFLD(AZMKDT)
     D  WDBFTM       E                     EXTFLD(AZBFTM)
     D  WDCEVN       E                     EXTFLD(AZCEVN)
     D  WDCFVN       E                     EXTFLD(AZCFVN)
      *
     D YARDCS          DS           106
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  YN0001         S             50
     D  YN0002         S              5  0
     D  YN0003         S              3
     D  YL0001         S              2
     D  YN0004         S              7  0
     D  YN0005         S             11  4
     D  YN0006         S              9  2
     D  YL0002         S              5
     D  YL0003         S              5
     D  YN0007         S              1
     D  YN0008         S              2
     D  YN0009         S              1
     D  YN0010         S              1
     D  YN0011         S              1
     D  YN0012         S              2
     D  YN0013         S              2
     D  YN0014         S              2
     D  YN0015         S              2
     D  YN0016         S              2
     D  YN0017         S              6
     D  YN0018         S              1
     D  WL0001         S              3  0
     D  WL0002         S              7  0
     D  WL0003         S              3  0
     D  WL0004         S              7  0
     D  WL0005         S             25
     D  WL0006         S              7  3
     D  WL0007         S              2
     D  WL0008         S              5
     D  WL0009         S              5
     D  YL0004         S              1
     D  YL0005         S              1
     D  WN0001         S              1
     D  WN0002         S              7  0
     D  WN0003         S              6  0
     D  WN0004         S             10
     D  WN0005         S             10
     D  WN0006         S              7  0
     D  WN0007         S              6  0
     D  WN0008         S             10
     D  WN0009         S             10
     D  ZADFMF         S             10
     D  WN0010         S              1
     D  WN0011         S              1
     D  WN0012         S              1
     D  WN0013         S              7  0
     D  WN0014         S              6  0
     D  WN0015         S             10
     D  WN0016         S             10
     D  WN0017         S              7  0
     D  WN0018         S              6  0
     D  WN0019         S             10
     D  WN0020         S             10
     D  YARDC          S              1
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * FLD: Packaging BOM
      * N :  Item Code
     D  P1HGCD                 1      4P 0
      * N :  Packaging Item Code
     D  P1BRAA                 5     29
      * N :  Packaging Item Quantity
     D  P1M1QT                30     33P 3
     D P2PARM          DS
      * N :  First Time Flag
     D  P2TAST                 1      1
     D                 DS
     D  ZAMSDA                 1    132
     I@ARREGL
      * Packaging Item            Retrieval index
      * Renamed input format fields
     I              ARAIC3                      WAAIC3
     I              ARBRAA                      WABRAA
     I              ARXITX                      WAXITX
     I              ARNONX                      WANONX
     I              AREAAA                      WAEAAA
     I              ARI5SX                      WAI5SX
     I              ARHGCD                      WAHGCD
     I              ARBICS                      WABICS
     I              ARIIWG                      WAIIWG
     I              ARD8AA                      WAD8AA
     I              ARM3SX                      WAM3SX
     I              ARM1SX                      WAM1SX
     I              ARNGSX                      WANGSX
     I              ARM2SX                      WAM2SX
     I              ARNHSX                      WANHSX
     I              ARNISX                      WANISX
     I              ARNJSX                      WANJSX
     I              ARNKSX                      WANKSX
     I              ARNLSX                      WANLSX
     I              ARNMSX                      WANMSX
     I              ARNNSX                      WANNSX
     I              AREBAA                      WAEBAA
     I              ARVSST                      WAVSST
     I              ARMJDT                      WAMJDT
     I              ARBETM                      WABETM
     I              ARCCVN                      WACCVN
     I              ARCDVN                      WACDVN
     I              ARMKDT                      WAMKDT
     I              ARBFTM                      WABFTM
     I              ARCEVN                      WACEVN
     I              ARCFVN                      WACFVN
      *
     I@BZREJU
      * Company Item              Retrieval index       NV
      * Renamed input format fields
     I              BZAIC3                      WBAIC3
     I              BZHGCD                      WBHGCD
     I              BZAVNA                      WBAVNA
     I              BZAWNA                      WBAWNA
     I              BZL7NA                      WBL7NA
     I              BZL8NA                      WBL8NA
     I              BZL6NA                      WBL6NA
     I              BZMFNA                      WBMFNA
     I              BZADCD                      WBADCD
     I              BZAWPC                      WBAWPC
     I              BZLXST                      WBLXST
     I              BZAECD                      WBAECD
     I              BZAXPC                      WBAXPC
     I              BZLYST                      WBLYST
     I              BZAFCD                      WBAFCD
     I              BZAICD                      WBAICD
     I              BZAIWG                      WBAIWG
     I              BZHICD                      WBHICD
     I              BZRBCD                      WBRBCD
     I              BZFZST                      WBFZST
     I              BZAVST                      WBAVST
     I              BZCZWG                      WBCZWG
     I              BZC0WG                      WBC0WG
     I              BZURTN                      WBURTN
     I              BZAJC8                      WBAJC8
     I              BZRINB                      WBRINB
     I              BZRHNB                      WBRHNB
     I              BZRGNB                      WBRGNB
     I              BZLNCD                      WBLNCD
     I              BZTFNB                      WBTFNB
     I              BZN0CD                      WBN0CD
     I              BZX4ST                      WBX4ST
     I              BZTMVA                      WBTMVA
     I              BZTNVA                      WBTNVA
     I              BZBLPR                      WBBLPR
     I              BZBMPR                      WBBMPR
     I              BZLRCD                      WBLRCD
     I              BZU9ST                      WBU9ST
     I              BZCMCO                      WBCMCO
     I              BZQ1CD                      WBQ1CD
     I              BZQ8CD                      WBQ8CD
     I              BZCHTM                      WBCHTM
     I              BZQZCD                      WBQZCD
     I              BZXWST                      WBXWST
     I              BZXXST                      WBXXST
     I              BZVMST                      WBVMST
     I              BZSWGH                      WBSWGH
     I              BZPPHE                      WBPPHE
     I              BZR3CD                      WBR3CD
     I              BZSDCD                      WBSDCD
     I              BZICN1                      WBICN1
     I              BZSVCD                      WBSVCD
     I              BZICN2                      WBICN2
     I              BZSWCD                      WBSWCD
     I              BZV2NB                      WBV2NB
     I              BZSXCD                      WBSXCD
     I              BZITCN                      WBITCN
     I              BZSYCD                      WBSYCD
     I              BZITC5                      WBITC5
     I              BZSZCD                      WBSZCD
     I              BZICN6                      WBICN6
     I              BZS0CD                      WBS0CD
     I              BZICN7                      WBICN7
     I              BZS1CD                      WBS1CD
     I              BZICN8                      WBICN8
     I              BZS2CD                      WBS2CD
     I              BZICN9                      WBICN9
     I              BZS3CD                      WBS3CD
     I              BZICN0                      WBICN0
     I              BZS4CD                      WBS4CD
     I              BZSFNB                      WBSFNB
     I              BZA3WG                      WBA3WG
     I              BZSJNB                      WBSJNB
     I              BZLLCD                      WBLLCD
     I              BZLMCD                      WBLMCD
     I              BZP3ST                      WBP3ST
     I              BZSKNB                      WBSKNB
     I              BZSLNB                      WBSLNB
     I              BZSMNB                      WBSMNB
     I              BZP4ST                      WBP4ST
     I              BZCFNB                      WBCFNB
     I              BZCGNB                      WBCGNB
     I              BZILNB                      WBILNB
     I              BZCHNB                      WBCHNB
     I              BZCINB                      WBCINB
     I              BZCJNB                      WBCJNB
     I              BZCMNB                      WBCMNB
     I              BZCNNB                      WBCNNB
     I              BZCRNB                      WBCRNB
     I              BZCSNB                      WBCSNB
     I              BZCVNB                      WBCVNB
     I              BZCWNB                      WBCWNB
     I              BZCXNB                      WBCXNB
     I              BZCZNB                      WBCZNB
     I              BZC0NB                      WBC0NB
     I              BZN1CD                      WBN1CD
     I              BZB4NB                      WBB4NB
     I              BZB5NB                      WBB5NB
     I              BZX5ST                      WBX5ST
     I              BZX6ST                      WBX6ST
     I              BZX7ST                      WBX7ST
     I              BZPCCT                      WBPCCT
     I              BZBDNB                      WBBDNB
     I              BZBJNB                      WBBJNB
     I              BZSUST                      WBSUST
     I              BZSVST                      WBSVST
     I              BZSYST                      WBSYST
     I              BZSZST                      WBSZST
     I              BZS1ST                      WBS1ST
     I              BZXRCD                      WBXRCD
     I              BZXTCD                      WBXTCD
     I              BZXUCD                      WBXUCD
     I              BZF5WG                      WBF5WG
     I              BZF6WG                      WBF6WG
     I              BZF7WG                      WBF7WG
     I              BZBLNB                      WBBLNB
     I              BZBNNB                      WBBNNB
     I              BZS2ST                      WBS2ST
     I              BZS4ST                      WBS4ST
     I              BZS5ST                      WBS5ST
     I              BZS6ST                      WBS6ST
     I              BZS8ST                      WBS8ST
     I              BZS9ST                      WBS9ST
     I              BZTCST                      WBTCST
     I              BZTDST                      WBTDST
     I              BZUVST                      WBUVST
     I              BZUWST                      WBUWST
     I              BZUXST                      WBUXST
     I              BZVSST                      WBVSST
     I              BZAATM                      WBAATM
     I              BZAYNA                      WBAYNA
     I              BZA0NA                      WBA0NA
     I              BZAXDT                      WBAXDT
      *
     I@AZCPHT
      * Packaging BOM             Retrieval index
      * Renamed input format fields
     I              AZAIC3                      WCAIC3
     I              AZHGCD                      WCHGCD
     I              AZBRAA                      WCBRAA
     I              AZM1QT                      WCM1QT
     I              AZI5SX                      WCI5SX
     I              AZD8AA                      WCD8AA
     I              AZM3SX                      WCM3SX
     I              AZM7SX                      WCM7SX
     I              AZM8SX                      WCM8SX
     I              AZVSST                      WCVSST
     I              AZMJDT                      WCMJDT
     I              AZBETM                      WCBETM
     I              AZCCVN                      WCCCVN
     I              AZCDVN                      WCCDVN
     I              AZMKDT                      WCMKDT
     I              AZBFTM                      WCBFTM
     I              AZCEVN                      WCCEVN
     I              AZCFVN                      WCCFVN
      *
     I@AZCPHS
      * Packaging BOM             Update index
      * Renamed input format fields
     I              AZAIC3                      WDAIC3
     I              AZHGCD                      WDHGCD
     I              AZBRAA                      WDBRAA
     I              AZM1QT                      WDM1QT
     I              AZI5SX                      WDI5SX
     I              AZD8AA                      WDD8AA
     I              AZM3SX                      WDM3SX
     I              AZM7SX                      WDM7SX
     I              AZM8SX                      WDM8SX
     I              AZVSST                      WDVSST
     I              AZMJDT                      WDMJDT
     I              AZBETM                      WDBETM
     I              AZCCVN                      WDCCVN
     I              AZCDVN                      WDCDVN
     I              AZMKDT                      WDMKDT
     I              AZBFTM                      WDBFTM
     I              AZCEVN                      WDCEVN
     I              AZCFVN                      WDCFVN
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Cnv Crt Packaging BOM XF
     C                   MOVEL     'Y'           P2TAST                         First Time Flag
      * Cnv Read PCKGITMBOM   US - Packaging Item  * 
      *
      *
     C                   dow       not %eof(pckgitmbom)
     C                   read      pckgitmbom
      *
     C                   eval      P1HGCD = PITMCD                              Item Code
     C                   eval      P1BRAA = PPITCD                              Packaging Item Code
     C                   eval      P1M1QT = PITMQT                              Packaging Item Qty
      *
      * Get Packaging Item Type, Reporting Group & Group Cat from Co 360.
      * CASE: PAR.First Time Flag is Yes
     C                   IF        P2TAST = 'Y'
     C                   MOVEL     'N'           P2TAST                         First Time Flag
      * RTV for All           RT - Packaging Item  * 
     C                   EXSR      SARVGN
     C                   END                                                    *FI
      * Update Packaging BOM for All Companies Only If Exist in Company I
      * CASE: *OTHERWISE
      * Val Company/Item Exist RT - Company Item  * Co 360
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     360           WL0001                         Company Number
     C                   Z-ADD     P1HGCD        WL0002                         Item Code
     C                   EXSR      SBRVGN
      * Record Exist for Co 360.
      * CASE: PGM.*Return code is *Normal
      * Update Packaging BOM for Co 360.
      * Cnv Update Pckg BOM   RT - Packaging BOM  * 
      * Move input parameters to subroutine local variables.
     C                   IF        W0RTN = ' '
     C                   Z-ADD     360           WL0003                         Company Number
     C                   Z-ADD     P1HGCD        WL0004                         Item Code
     C                   MOVEL(P)  P1BRAA        WL0005                         Packaging Item
     C                   Z-ADD     P1M1QT        WL0006                         Packaging Item
     C                   MOVEL(P)  YL0001        WL0007                         Pckg Item Type
     C                   MOVEL(P)  YL0002        WL0008                         Pckg Reporting
     C                   MOVEL(P)  YL0003        WL0009                         Pckg Group Cate
     C                   EXSR      SCRVGN
     C                   END                                                    *FI
      * Val Company/Item Exist RT - Company Item  * Co 440
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     440           WL0001                         Company Number
     C                   Z-ADD     P1HGCD        WL0002                         Item Code
     C                   EXSR      SBRVGN
      * Record Exist for Co 440.
      * CASE: PGM.*Return code is *Normal
      * Update Packaging BOM for Co 440.
      * Cnv Update Pckg BOM   RT - Packaging BOM  * 
      * Move input parameters to subroutine local variables.
     C                   IF        W0RTN = ' '
     C                   Z-ADD     440           WL0003                         Company Number
     C                   Z-ADD     P1HGCD        WL0004                         Item Code
     C                   MOVEL(P)  P1BRAA        WL0005                         Packaging Item
     C                   Z-ADD     P1M1QT        WL0006                         Packaging Item
     C                   MOVEL(P)  YL0001        WL0007                         Pckg Item Type
     C                   MOVEL(P)  YL0002        WL0008                         Pckg Reporting
     C                   MOVEL(P)  YL0003        WL0009                         Pckg Group Cate
     C                   EXSR      SCRVGN
     C                   END                                                    *FI
      * Val Company/Item Exist RT - Company Item  * Co 960
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     960           WL0001                         Company Number
     C                   Z-ADD     P1HGCD        WL0002                         Item Code
     C                   EXSR      SBRVGN
      * Record Exist for Co 960.
      * CASE: PGM.*Return code is *Normal
      * Update Packaging BOM for Co 960.
      * Cnv Update Pckg BOM   RT - Packaging BOM  * 
      * Move input parameters to subroutine local variables.
     C                   IF        W0RTN = ' '
     C                   Z-ADD     960           WL0003                         Company Number
     C                   Z-ADD     P1HGCD        WL0004                         Item Code
     C                   MOVEL(P)  P1BRAA        WL0005                         Packaging Item
     C                   Z-ADD     P1M1QT        WL0006                         Packaging Item
     C                   MOVEL(P)  YL0001        WL0007                         Pckg Item Type
     C                   MOVEL(P)  YL0002        WL0008                         Pckg Reporting
     C                   MOVEL(P)  YL0003        WL0009                         Pckg Group Cate
     C                   EXSR      SCRVGN
     C                   END                                                    *FI
      * Cnv EndDo             US - Packaging Item  * 
      *
     C                   enddo                                                  dow not %eof
      *
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * RTV for All           RT - Packaging Item  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
      * PAR = CON By name
     C                   EVAL      YL0001 = ' '                                 Pckg Item Type
     C                   EVAL      YL0002 = ' '                                 Pckg Reporting
     C                   EVAL      YL0003 = ' '                                 Pckg Group Cate
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WAAIC3                         Company Number
     C                   KFLD                    WABRAA                         Packaging Item
      * Setup key
     C                   Z-ADD     360           WAAIC3                         Company Number
     C                   MOVEL     P1BRAA        WABRAA                         Packaging Item
      * Establish starting position
     C     KRSSA         CHAIN     @ARREGL                            90        *
      * Data record not found
     C   90              MOVEL     'USR2982'     W0RTN
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   MOVEL     WAI5SX        YL0001                         Pckg Item Type
     C                   MOVEL     WAD8AA        YL0002                         Pckg Reporting
     C                   MOVEL     WAM3SX        YL0003                         Pckg Group Cate
     C                   ENDIF
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Val Company/Item Exist RT - Company Item  * Co 360
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WBAIC3                         Company Number
     C                   KFLD                    WBHGCD                         Item Code
      * Setup key
     C                   Z-ADD     WL0001        WBAIC3                         Company Number
     C                   Z-ADD     WL0002        WBHGCD                         Item Code
      * Establish starting position
     C     KRSSB         CHAIN     @BZREJU                            90        *
      * Data record not found
     C   90              MOVEL     'USR0326'     W0RTN
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Cnv Update Pckg BOM   RT - Packaging BOM  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WCAIC3                         Company Number
     C                   KFLD                    WCHGCD                         Item Code
     C                   KFLD                    WCBRAA                         Packaging Item
      * Setup key
     C                   Z-ADD     WL0003        WCAIC3                         Company Number
     C                   Z-ADD     WL0004        WCHGCD                         Item Code
     C                   MOVEL     WL0005        WCBRAA                         Packaging Item
      * Establish starting position
     C     KRSSC         CHAIN     @AZCPHT                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR3007'     W0RTN
      * USER: Processing if Data record not found
      * Cnv Create Pckg BOM   CR - Packaging BOM  * 
     C                   EXSR      SDCRRC
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * CASE: DB1.Packaging Item Quantity NE PAR.Packaging Item Quantity
     C                   IF        NOT *IN90
      * Cnv Update Pckg BOM   CH - Packaging BOM  * 
     C                   IF        WCM1QT <> WL0006
     C                   EXSR      SECHRC
     C                   END                                                    *FI
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDCRRC        BEGSR
      *================================================================
      * Cnv Create Pckg BOM   CR - Packaging BOM  * 
      *================================================================
      *
     C                   EVAL      WN0001 = ' '                                 Record Status
     C                   Z-ADD     *ZERO         WN0002                         Create Date
     C                   Z-ADD     *ZERO         WN0003                         Create Time
     C                   EVAL      WN0004 = ' '                                 Create User
     C                   EVAL      WN0005 = ' '                                 Create Program
     C                   Z-ADD     *ZERO         WN0006                         Change Date
     C                   Z-ADD     *ZERO         WN0007                         Change Time
     C                   EVAL      WN0008 = ' '                                 Change User
     C                   EVAL      WN0009 = ' '                                 Change Program
      *
     C                   EVAL      W0RTN = ' '
      * Move all fields to @AZCPHS
     C                   Z-ADD     WL0003        WDAIC3                         Company Number
     C                   Z-ADD     WL0004        WDHGCD                         Item Code
     C                   MOVEL     WL0005        WDBRAA                         Packaging Item
     C                   Z-ADD     WL0006        WDM1QT                         Packaging Item
     C                   MOVEL     WL0007        WDI5SX                         Pckg Item Type
     C                   MOVEL     WL0008        WDD8AA                         Pckg Reporting
     C                   MOVEL     WL0009        WDM3SX                         Pckg Group Cate
     C                   MOVEL     YL0004        WDM7SX                         Pckg BOM Unused
     C                   MOVEL     YL0005        WDM8SX                         Pckg BOM Unused
      *
      * USER: Processing before Data update
      * Set Crt Date/Time      IF
      * *** Set RECORD STATUS field. ***
     C                   MOVEL     'A'           WDVSST                         Record Status
      * *** Set CREATE fields. ***
     C                   Z-ADD     ##JDT         WDMJDT                         Create Date
     C                   Z-ADD     ##JTM         WDBETM                         Create Time
     C                   MOVEL     ##USR         WDCCVN                         Create User
     C                   MOVEL     ##PGM         WDCDVN                         Create Program
      * *** Set CHANGE fields. ***
     C                   Z-ADD     0             WDMKDT                         Change Date
     C                   Z-ADD     0             WDBFTM                         Change Time
     C                   EVAL      WDCEVN = ' '                                 Change User
     C                   EVAL      WDCFVN = ' '                                 Change Program
     C     KLCRSD        KLIST
     C                   KFLD                    WDAIC3                         Company Number
     C                   KFLD                    WDHGCD                         Item Code
     C                   KFLD                    WDBRAA                         Packaging Item
      * Check for duplicate primary key
     C     KLCRSD        SETLL     @AZCPHS                                90    *
     C                   IF        *IN90
     C                   MOVEL     'USR3008'     W0RTN
      * Send message 'Packaging BOM          EX'
     C                   MOVEL     'USR3008'     ZAMSID
     C                   EXSR      ZASNMS
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
     C                   WRITE     @AZCPHS                              91      *
      *
      * Write error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
     C                   ENDIF
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SECHRC        BEGSR
      *================================================================
      * Cnv Update Pckg BOM   CH - Packaging BOM  * 
      *================================================================
      *
     C                   EVAL      WN0010 = ' '                                 Pckg BOM Unused
     C                   EVAL      WN0011 = ' '                                 Pckg BOM Unused
     C                   EVAL      WN0012 = ' '                                 Record Status
     C                   Z-ADD     *ZERO         WN0013                         Create Date
     C                   Z-ADD     *ZERO         WN0014                         Create Time
     C                   EVAL      WN0015 = ' '                                 Create User
     C                   EVAL      WN0016 = ' '                                 Create Program
     C                   Z-ADD     *ZERO         WN0017                         Change Date
     C                   Z-ADD     *ZERO         WN0018                         Change Time
     C                   EVAL      WN0019 = ' '                                 Change User
     C                   EVAL      WN0020 = ' '                                 Change Program
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to @AZCPHS
     C                   Z-ADD     WCAIC3        WDAIC3                         Company Number
     C                   Z-ADD     WCHGCD        WDHGCD                         Item Code
     C                   MOVEL(P)  WCBRAA        WDBRAA                         Packaging Item
      *
     C     KLCHSE        KLIST
     C                   KFLD                    WDAIC3                         Company Number
     C                   KFLD                    WDHGCD                         Item Code
     C                   KFLD                    WDBRAA                         Packaging Item
     C     KLCHSE        CHAIN     @AZCPHS                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'POAZCPL0'    MDACP
     C                   MOVEL     '@AZCPHS'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QPOAZ1        YARDCS
      * Move non-key fields to @AZCPHS
     C                   Z-ADD     WL0006        WDM1QT                         Packaging Item
     C                   MOVEL(P)  WCI5SX        WDI5SX                         Pckg Item Type
     C                   MOVEL(P)  WCD8AA        WDD8AA                         Pckg Reporting
     C                   MOVEL(P)  WCM3SX        WDM3SX                         Pckg Group Cate
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QPOAZ1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * USER: Processing before Data update
      * Set Chg Date/Time      IF
     C                   Z-ADD     ##JDT         WDMKDT                         Change Date
     C                   Z-ADD     ##JTM         WDBFTM                         Change Time
     C                   MOVEL     ##USR         WDCEVN                         Change User
     C                   MOVEL     ##PGM         WDCFVN                         Change Program
      * Set PGM.*Record Data Changed flag
     C                   IF        QPOAZ1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    @AZCPHS                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    POAZCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C                   IF        ZAMSGF = ' '
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Clear all neither parameters
     C                   Z-ADD     *ZERO         P1HGCD                         Item Code
     C                   EVAL      P1BRAA = ' '                                 Packaging Item
     C                   Z-ADD     *ZERO         P1M1QT                         Packaging Item
     C                   EVAL      P2TAST = ' '                                 First Time Flag
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WANONX                         Pckg List Seque
     C                   Z-ADD     *ZERO         WAHGCD                         Item Code
     C                   Z-ADD     *ZERO         WABICS                         Pckg Unit Cost
     C                   Z-ADD     *ZERO         WAIIWG                         Pckg Tare Weigh
     C                   Z-ADD     *ZERO         WAMJDT                         Create Date
     C                   Z-ADD     *ZERO         WABETM                         Create Time
     C                   Z-ADD     *ZERO         WAMKDT                         Change Date
     C                   Z-ADD     *ZERO         WABFTM                         Change Time
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAIC3                         Company Number
     C                   Z-ADD     *ZERO         WBHGCD                         Item Code
     C                   Z-ADD     *ZERO         WBAWPC                         Conversion Fact
     C                   Z-ADD     *ZERO         WBAXPC                         Conversion Fact
     C                   Z-ADD     *ZERO         WBAIWG                         Unit Weight
     C                   Z-ADD     *ZERO         WBCZWG                         Minimum Weight
     C                   Z-ADD     *ZERO         WBC0WG                         Maximum Weight
     C                   Z-ADD     *ZERO         WBURTN                         Number Cases On
     C                   Z-ADD     *ZERO         WBAJC8                         Vendor - Item D
     C                   Z-ADD     *ZERO         WBRINB                         Item Structure
     C                   Z-ADD     *ZERO         WBRHNB                         Item Structure
     C                   Z-ADD     *ZERO         WBRGNB                         Item Structure
     C                   Z-ADD     *ZERO         WBTFNB                         Transportation
     C                   Z-ADD     *ZERO         WBTMVA                         Maximum Audit V
     C                   Z-ADD     *ZERO         WBTNVA                         Minimum Audit V
     C                   Z-ADD     *ZERO         WBBLPR                         Market Overage
     C                   Z-ADD     *ZERO         WBBMPR                         Standard Overag
     C                   Z-ADD     *ZERO         WBCMCO                         Item Pricing Co
     C                   Z-ADD     *ZERO         WBCHTM                         Fresh Chilling
     C                   Z-ADD     *ZERO         WBSWGH                         Std Weight/Head
     C                   Z-ADD     *ZERO         WBPPHE                         Pieces Per Head
     C                   Z-ADD     *ZERO         WBICN1                         Item Category N
     C                   Z-ADD     *ZERO         WBICN2                         Item Category N
     C                   Z-ADD     *ZERO         WBV2NB                         Item Category N
     C                   Z-ADD     *ZERO         WBITCN                         Item Category N
     C                   Z-ADD     *ZERO         WBITC5                         Item Category N
     C                   Z-ADD     *ZERO         WBICN6                         Item Category N
     C                   Z-ADD     *ZERO         WBICN7                         Item Category N
     C                   Z-ADD     *ZERO         WBICN8                         Item Category N
     C                   Z-ADD     *ZERO         WBICN9                         Item Category N
     C                   Z-ADD     *ZERO         WBICN0                         Item Category N
     C                   Z-ADD     *ZERO         WBSFNB                         Pallet Tare Wei
     C                   Z-ADD     *ZERO         WBA3WG                         Misc Tare Weigh
     C                   Z-ADD     *ZERO         WBSJNB                         Production Lead
     C                   Z-ADD     *ZERO         WBSKNB                         Agrimetrics gro
     C                   Z-ADD     *ZERO         WBSLNB                         Agrimetrics pac
     C                   Z-ADD     *ZERO         WBSMNB                         Agrimetrics gra
     C                   Z-ADD     *ZERO         WBCFNB                         PM Pounds per H
     C                   Z-ADD     *ZERO         WBCGNB                         Item Frt Overag
     C                   Z-ADD     *ZERO         WBILNB                         Packages per ca
     C                   Z-ADD     *ZERO         WBCHNB                         Use/Freeze/Sell
     C                   Z-ADD     *ZERO         WBCINB                         PM Batch Size
     C                   Z-ADD     *ZERO         WBCJNB                         Package Level s
     C                   Z-ADD     *ZERO         WBCMNB                         Partial Item Co
     C                   Z-ADD     *ZERO         WBCNNB                         WIP Item Code
     C                   Z-ADD     *ZERO         WBCRNB                         WIP Reject Code
     C                   Z-ADD     *ZERO         WBCSNB                         Std Costing Uni
     C                   Z-ADD     *ZERO         WBCVNB                         FP Std Green We
     C                   Z-ADD     *ZERO         WBCWNB                         PM Standard LBS
     C                   Z-ADD     *ZERO         WBCXNB                         PM Raw Meat LBS
     C                   Z-ADD     *ZERO         WBCZNB                         PM Formula LBS/
     C                   Z-ADD     *ZERO         WBC0NB                         PM Finished LBS
     C                   Z-ADD     *ZERO         WBB4NB                         PM R/M Type Cod
     C                   Z-ADD     *ZERO         WBB5NB                         PM Line Number
     C                   Z-ADD     *ZERO         WBBDNB                         Pieces Per Bag
     C                   Z-ADD     *ZERO         WBBJNB                         Bags Per Unit
     C                   Z-ADD     *ZERO         WBF5WG                         Item Target Pri
     C                   Z-ADD     *ZERO         WBF6WG                         Minimum Piece W
     C                   Z-ADD     *ZERO         WBF7WG                         Maximum Piece W
     C                   Z-ADD     *ZERO         WBBLNB                         Seaboard Equiva
     C                   Z-ADD     *ZERO         WBBNNB                         Production Qty
     C                   Z-ADD     *ZERO         WBAATM                         Job Time
     C                   Z-ADD     *ZERO         WBAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCAIC3                         Company Number
     C                   Z-ADD     *ZERO         WCHGCD                         Item Code
     C                   Z-ADD     *ZERO         WCM1QT                         Packaging Item
     C                   Z-ADD     *ZERO         WCMJDT                         Create Date
     C                   Z-ADD     *ZERO         WCBETM                         Create Time
     C                   Z-ADD     *ZERO         WCMKDT                         Change Date
     C                   Z-ADD     *ZERO         WCBFTM                         Change Time
      * Clear all neither parameters
      * Cnv Create Pckg BOM   CR - Packaging BOM  * 
     C                   Z-ADD     *ZERO         WDMJDT                         Create Date
     C                   Z-ADD     *ZERO         WDBETM                         Create Time
     C                   Z-ADD     *ZERO         WDMKDT                         Change Date
     C                   Z-ADD     *ZERO         WDBFTM                         Change Time
      * Obtain default message file
     C     *DTAARA       DEFINE    CAMGFLA       ZADFMF
     C                   IN        ZADFMF
     C                   MOVEL     'N'           W0PMT
      * Define local variables for subroutine SBRVGN.
     C                   Z-ADD     *ZERO         WL0001
     C                   Z-ADD     *ZERO         WL0002
      * Define local variables for subroutine SCRVGN.
     C                   Z-ADD     *ZERO         WL0003
     C                   Z-ADD     *ZERO         WL0004
     C                   EVAL      WL0005 = ' '
     C                   Z-ADD     *ZERO         WL0006
     C                   EVAL      WL0007 = ' '
     C                   EVAL      WL0008 = ' '
     C                   EVAL      WL0009 = ' '
      * Define null work field Pckg Item Description
     C                   EVAL      YN0001 = ' '
      * Define null work field Pckg List Sequence
     C                   Z-ADD     *ZERO         YN0002
      * Define null work field Pckg Type Class
     C                   EVAL      YN0003 = ' '
      * Define local work field Pckg Item Type
     C                   EVAL      YL0001 = ' '
      * Define null work field Item Code
     C                   Z-ADD     *ZERO         YN0004
      * Define null work field Pckg Unit Cost
     C                   Z-ADD     *ZERO         YN0005
      * Define null work field Pckg Tare Weight
     C                   Z-ADD     *ZERO         YN0006
      * Define local work field Pckg Reporting Group
     C                   EVAL      YL0002 = ' '
      * Define local work field Pckg Group Category
     C                   EVAL      YL0003 = ' '
      * Define null work field Pckg Modified Weight
     C                   EVAL      YN0007 = ' '
      * Define null work field Pckg Unused Status 3
     C                   EVAL      YN0008 = ' '
      * Define null work field Pckg Unused Sts 2
     C                   EVAL      YN0009 = ' '
      * Define null work field Pre-printed Bag Sts
     C                   EVAL      YN0010 = ' '
      * Define null work field Pckg Unused Status 5
     C                   EVAL      YN0011 = ' '
      * Define null work field Pckg Unused Status 6
     C                   EVAL      YN0012 = ' '
      * Define null work field Pckg Unused Status 7
     C                   EVAL      YN0013 = ' '
      * Define null work field Pckg Unused Status 8
     C                   EVAL      YN0014 = ' '
      * Define null work field Pckg Unused Status 9
     C                   EVAL      YN0015 = ' '
      * Define null work field Pckg Unused Status 10
     C                   EVAL      YN0016 = ' '
      * Define null work field Pckg Unused Code
     C                   EVAL      YN0017 = ' '
      * Define null work field Record Status
     C                   EVAL      YN0018 = ' '
      * Define local work field Pckg BOM Unused Sts 1
     C                   EVAL      YL0004 = ' '
      * Define local work field Pckg BOM Unused Sts 2
     C                   EVAL      YL0005 = ' '
      *================================================================
     CSR   ZZEXIT        ENDSR
