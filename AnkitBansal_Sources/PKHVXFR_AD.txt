// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKHVXFR
// ?Date: 14.08.2025 Time: 02:51:42
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?R10690 JJH 06/08/17 - Producer Address
//?- This function is no longer used, and function is now Z...
//?- APLUS, shows that this is called by PKMQUPC and PKMRUPC and
//?  both of these programs are zzz
//?- WRKOBJ in PRKPLIB shows that this program has never been used.
ENDDO;

// PAR.Index = CON.*ZERO
PAR.Index = *ZERO;

//?Setup producer fax
CASE;

// IF PAR.Fax Producer USR is Yes
IF PAR.Fax_Producer_USR = 'Y';

// Call program Get Vendor Address    RT.
CALL PROGRAM(Get Vendor Address    RT) ('VNDFAXR');
PARAMETER(WRK.Vendor_Return_Code_Usr);
PARAMETER(PAR.PD_VND_Address_Number);
PARAMETER(PAR.Fax_Recipient);
PARAMETER(WRK.Address_1);
PARAMETER(WRK.Address_2);
PARAMETER(WRK.Address_3);
PARAMETER(WRK.City);
PARAMETER(WRK.State);
PARAMETER(WRK.Zip);
PARAMETER(WRK.Area_Code);
PARAMETER(WRK.Telephone);
PARAMETER(PAR.Fax_Area_Code_#);
PARAMETER(PAR.Fax_Telephone);
PARAMETER(WRK.Fax_Area_Code_#_2);
PARAMETER(WRK.Fax_Telephone_2);
PARAMETER(WRK.Vendor_1099);
PARAMETER(WRK.Vendor_Tax_Id);
PARAMETER(WRK.Country_Code);
PARAMETER(WRK.Producer_Trucker_Sts_Usr);

CASE;

// IF WRK.Vendor Return Code Usr is Vendor Error
IF WRK.Vendor_Return_Code_Usr = 'ERR';

// PGM.*Return code = CND.*Record does not exist
PGM.*Return_code = 'Y2U0005';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Index = PAR.Index + CON.1
PAR.Index = PAR.Index + 1;

// PAR.Fax Area Code = PAR.Fax Area Code #
PAR.Fax_Area_Code = PAR.Fax_Area_Code_#;

// PAR.Fax Phone Number = PAR.Fax Telephone
PAR.Fax_Phone_Number = PAR.Fax_Telephone;

// PAR.Spool File Selection = CON.*JOB
PAR.Spool_File_Selection = *JOB;

// PAR.Display Fax Select Screen = CND.Yes
PAR.Display_Fax_Select_Screen = 'Y';

//?Convert to MDY format.
// WRK.Date Alpha USR = CVTVAR(JOB.*Job date)
WRK.Date_Alpha_USR = CVTVAR(JOB.*Job_date);

// WRK.Date From Convert USR = WRK.Date Alpha USR
WRK.Date_From_Convert_USR = WRK.Date_Alpha_USR;

// Call program Cvt Date              UP.
CALL PROGRAM(Cvt Date              UP) ('PKPOUPR');
PARAMETER(WRK.Date_From_Convert_USR);
PARAMETER(WRK.Date_To_Convert_USR);
PARAMETER(*CYMD);
PARAMETER(*MDY);
PARAMETER(*NONE);

// WRK.Code USR = WRK.Date To Convert USR
WRK.Code_USR = WRK.Date_To_Convert_USR;

// PAR.Send Date = CVTVAR(WRK.Code USR)
PAR.Send_Date = CVTVAR(WRK.Code_USR);

// Execute function PRC Load FastFax Array US.
EXECUTE FUNCTION(PRC Load FastFax Array US) TYPE(EXCUSRSRC) ('PKHOUFR');
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Company_Recipient_Name);
PARAMETER(PAR.Fax_Area_Code);
PARAMETER(PAR.Fax_Phone_Number);
PARAMETER(PAR.Routing_Code);
PARAMETER(PAR.International_Code);
PARAMETER(PAR.Fast_Fax_Address_Line_1);
PARAMETER(PAR.Fast_Fax_Address_Line_2);
PARAMETER(PAR.City_for_Fax);
PARAMETER(PAR.Fast_Fax_State_Code);
PARAMETER(PAR.Zip_Code_for_Fax);
PARAMETER(PAR.Country_Description);
PARAMETER(PAR.Index);
{
 C                     Z-ADD#IINDE    X       30                   TEXT2
 C                     MOVEL#ILLTX    QRCP,X                       TEXT2
 C                     MOVEL#ILMTX    QRCO,X                       Y
 C                     MOVEL#IXDCD    QFXA,X                       E ARRAY
 C                     MOVEL#ILNTX    QFXN,X                       RRAY
 C                     MOVEL#IGJCD    QRTG,X                        ARRAY
 C                     MOVEL#IP0ST    QINT,X                       'INT'
 C                     MOVEL#IAQNA    QAD1,X                       ARRAY
 C                     MOVEL#IARNA    QAD2,X                       ARRAY
 C                     MOVEL#ILOTX    QCTY,X                       RRAY
 C                     MOVEL#IEINA    QSTA,X                       ARRAY
 C                     MOVEL#ILPTX    QZIP,X                       RAY
 C                     MOVEL#IASNA    QCNY,X                       Y ARRAY
}


ENDIF;

ENDIF;

//?Setup producer location fax
CASE;

// IF PAR.Fax Producer/Location USR is Yes
IF PAR.Fax_Producer_Location_USR = 'Y';

// Call program Get Vendor Address    RT.
CALL PROGRAM(Get Vendor Address    RT) ('VNDFAXR');
PARAMETER(WRK.Vendor_Return_Code_Usr);
PARAMETER(PAR.Pl_VND_Address_Number);
PARAMETER(PAR.Fax_Recipient);
PARAMETER(WRK.Address_1);
PARAMETER(WRK.Address_2);
PARAMETER(WRK.Address_3);
PARAMETER(WRK.City);
PARAMETER(WRK.State);
PARAMETER(WRK.Zip);
PARAMETER(WRK.Area_Code);
PARAMETER(WRK.Telephone);
PARAMETER(PAR.Fax_Area_Code_#);
PARAMETER(PAR.Fax_Telephone);
PARAMETER(WRK.Fax_Area_Code_#_2);
PARAMETER(WRK.Fax_Telephone_2);
PARAMETER(WRK.Vendor_1099);
PARAMETER(WRK.Vendor_Tax_Id);
PARAMETER(WRK.Country_Code);
PARAMETER(WRK.Producer_Trucker_Sts_Usr);

CASE;

// IF WRK.Vendor Return Code Usr is Vendor Error
IF WRK.Vendor_Return_Code_Usr = 'ERR';

// PGM.*Return code = CND.*Record does not exist
PGM.*Return_code = 'Y2U0005';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Index = PAR.Index + CON.1
PAR.Index = PAR.Index + 1;

// PAR.Fax Area Code = PAR.Fax Area Code #
PAR.Fax_Area_Code = PAR.Fax_Area_Code_#;

// PAR.Fax Phone Number = PAR.Fax Telephone
PAR.Fax_Phone_Number = PAR.Fax_Telephone;

// PAR.Spool File Selection = CON.*JOB
PAR.Spool_File_Selection = *JOB;

// PAR.Display Fax Select Screen = CND.Yes
PAR.Display_Fax_Select_Screen = 'Y';

//?Convert Date to MDY.
// WRK.Date Alpha USR = CVTVAR(JOB.*Job date)
WRK.Date_Alpha_USR = CVTVAR(JOB.*Job_date);

// WRK.Date From Convert USR = WRK.Date Alpha USR
WRK.Date_From_Convert_USR = WRK.Date_Alpha_USR;

// Call program Cvt Date              UP.
CALL PROGRAM(Cvt Date              UP) ('PKPOUPR');
PARAMETER(WRK.Date_From_Convert_USR);
PARAMETER(WRK.Date_To_Convert_USR);
PARAMETER(*CYMD);
PARAMETER(*MDY);
PARAMETER(*NONE);

// WRK.Code USR = WRK.Date To Convert USR
WRK.Code_USR = WRK.Date_To_Convert_USR;

// PAR.Send Date = CVTVAR(WRK.Code USR)
PAR.Send_Date = CVTVAR(WRK.Code_USR);

// Execute function PRC Load FastFax Array US.
EXECUTE FUNCTION(PRC Load FastFax Array US) TYPE(EXCUSRSRC) ('PKHOUFR');
PARAMETER(PAR.Fax_Recipient);
PARAMETER(PAR.Company_Recipient_Name);
PARAMETER(PAR.Fax_Area_Code);
PARAMETER(PAR.Fax_Phone_Number);
PARAMETER(PAR.Routing_Code);
PARAMETER(PAR.International_Code);
PARAMETER(PAR.Fast_Fax_Address_Line_1);
PARAMETER(PAR.Fast_Fax_Address_Line_2);
PARAMETER(PAR.City_for_Fax);
PARAMETER(PAR.Fast_Fax_State_Code);
PARAMETER(PAR.Zip_Code_for_Fax);
PARAMETER(PAR.Country_Description);
PARAMETER(PAR.Index);
{
 C                     Z-ADD#IINDE    X       30                   TEXT2
 C                     MOVEL#ILLTX    QRCP,X                       TEXT2
 C                     MOVEL#ILMTX    QRCO,X                       Y
 C                     MOVEL#IXDCD    QFXA,X                       E ARRAY
 C                     MOVEL#ILNTX    QFXN,X                       RRAY
 C                     MOVEL#IGJCD    QRTG,X                        ARRAY
 C                     MOVEL#IP0ST    QINT,X                       'INT'
 C                     MOVEL#IAQNA    QAD1,X                       ARRAY
 C                     MOVEL#IARNA    QAD2,X                       ARRAY
 C                     MOVEL#ILOTX    QCTY,X                       RRAY
 C                     MOVEL#IEINA    QSTA,X                       ARRAY
 C                     MOVEL#ILPTX    QZIP,X                       RAY
 C                     MOVEL#IASNA    QCNY,X                       Y ARRAY
}


ENDIF;

ENDIF;

//?Send fax if index is GT 0, that means no errors
CASE;

// IF PAR.Index is Not Zero
IF PAR.Index <> *ZERO;

// PAR.Cover Sheet Name = CON.SC
PAR.Cover_Sheet_Name = 'SC';

// Execute function PRC Call FastFax PGM  US.
EXECUTE FUNCTION(PRC Call FastFax PGM  US) TYPE(EXCUSRSRC) ('PKHNUFR');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(PAR.Display_Fax_Select_Screen);
PARAMETER(PAR.User_defined_attribute);
PARAMETER(PAR.Send_Date);
PARAMETER(PAR.Send_Time);
PARAMETER(PAR.Send_Priority);
PARAMETER(PAR.Cost_Account_Name);
PARAMETER(PAR.Cover_Sheet_Name);
PARAMETER(PAR.Forms_Type_Str);
PARAMETER(PAR.Fax_Resolution);
PARAMETER(PAR.From_Page);
PARAMETER(PAR.To_Page);
PARAMETER(PAR.Page_Length);
PARAMETER(PAR.Page_Width);
PARAMETER(PAR.CPI);
PARAMETER(PAR.LPI);
PARAMETER(PAR.Save_Copy_of_Fax);
PARAMETER(PAR.Print_Copy_of_Fax);
PARAMETER(PAR.Printer_Name_or_Outq);
PARAMETER(PAR.Outq_Library);
PARAMETER(PAR.Print_on_Form);
PARAMETER(PAR.Landscape);
{
 E                    QRCP       45 25
 E                    QRCO       45 30
 E                    QFXA       45  3
 E                    QFXN       45 12
 E                    QRTG       45  3
 E                    QINT       45  3
 E                    QAD1       45 30
 E                    QAD2       45 30
 E                    QCTY       45 30
 E                    QSTA       45  2
 E                    QZIP       45 10
 E                    QCNY       45 30
 E                    QCT1       15 80
 E                    QCT2       15 80
 IQIAPDS      DS
 I                                        1  10 QSDR
 I*                                                  USER ID OF SENDER
 I                                       11  160QSDT
 I*                                                  SEND DATE MMDDYY
 I                                       17  200QSTM
 I*                                                  SEND TIME  24HR HHMM
 I                                       21  220QPTY
 I*                                                  SEND PRIORITY
 I*                                                  01=HI - 98=LO 99=HLD
 I                                       23  29 QCAC
 I*                                                  COST ACCOUNT
 I                                       30  39 QCVR
 I*                                                  COVER NAME
 I                                       40  49 QFMN
 I*                                                  FORM NAME
 I                                       50  500QRSL
 I*                                                  FUTURE/RESOLUTTION
 I                                       51  530QFPG
 I*                                                  FUTURE/FROM PAGE
 I                                       54  560QTPG
 I*                                                  FUTURE/TO PAGE
 I                                       57  590QPGL
 I*                                                  FUTURE/PAGE LENGTH
 I                                       60  620QPGW
 I*                                                  FUTURE/PAGE WIDTH
 I                                       63  640QCPI
 I*                                                  FUTURE/CPI
 I                                       65  660QLPI
 I*                                                  FUTURE/LPI
 I                                       67  710QFNT
 I*                                                  FUTURE/FONT NAME
 I                                       72  74 QSVC
 I*                                                  SAVE COPY OF FAX
 I*                                                  0=NO 999=PERM X=DAYS
 I                                       75  75 QPRC
 I*                                                  PRINT COPY OF FAX
 I*                                                  0=NO 1=IMMED 2=SENT
 I                                       76  85 QPRQ
 I*                                                  PRINTER/OUTQ NAME
 I                                       86  95 QQLB
 I*                                                  OUTQ LIBRARY
 I                                       96  96 QPRF
 I*                                                  FUTURE/PRINT W/FORM
 I                                       97  97 QLAN
 I*                                                  FUTURE/LANDSCAPE
 C****************************************************************
 C           QIAPRM    PLIST
 C                     PARM           QSLCT  10        SPOOL FILE SELE
 C*                                                  *JOB *USER 'USER DATE'
 C                     PARM           QSBMT   1        PARMS SET/DISPALAY SC
 C*                                                  ERRORS 'Y' 'N' ' '
 C                     PARM           QIAPDS           DATA STRUCTURE ABOVE
 C                     PARM           QRCP             RECIPIENT ARRAY
 C                     PARM           QRCO             COMPANY ARRAY
 C                     PARM           QFXA             FAX AREA CODE ARRAY
 C                     PARM           QFXN             FAX NUMBER ARRAY
 C                     PARM           QRTG             ROUTING CODE ARRAY
 C                     PARM           QINT             'USA' 'CAN' 'INT'
 C*                                                    'OTH' 'PVT'
 C                     PARM           QAD1             RECIP ADDR1 ARRAY
 C                     PARM           QAD2             RECIP ADDR2 ARRAY
 C                     PARM           QCTY             RECIP CITY ARRAY
 C                     PARM           QSTA             RECIP STATE ARRAY
 C                     PARM           QZIP             RECIP ZIP ARRAY
 C                     PARM           QCNY             RECIP COUNTRY ARRAY
 C                     PARM           QCT1             COVER SHEET TEXT1
 C                     PARM           QCT2             COVER SHEET TEXT2
 C****************************************************************
 C                     MOVEL#IAFNA    QSLCT
 C                     MOVEL#IPHST    QSBMT
 C                     MOVE #IUATR    QSDR
 C                     Z-ADD#IKXDT    QSDT
 C                     Z-ADD#ISDTM    QSTM
 C                     Z-ADD#IFRNB    QPTY
 C                     MOVEL#IAGNA    QCAC
 C                     MOVEL#IAHNA    QCVR
 C                     MOVEL#IFDNA    QFMN
 C                     Z-ADD#IFAXR    QRSL
 C                     Z-ADD#IFRMP    QFPG
 C                     Z-ADD#ITOPG    QTPG
 C                     Z-ADD#IPGLN    QPGL
 C                     Z-ADD#IPGWD    QPGW
 C                     Z-ADD#ICPII    QCPI
 C                     Z-ADD#ILPII    QLPI
 C                     MOVEL#ILITX    QSVC
 C                     MOVEL#IPCOF    QPRC
 C                     MOVEL#ILJTX    QPRQ
 C                     MOVEL#ILKTX    QQLB
 C                     MOVEL#IPROF    QPRF
 C                     MOVEL#IPSST    QLAN
 C*
 C                     MOVEL'FASTFAX/'QIAPGM 16
 C                     MOVE 'FFX300CL'QIAPGM
 C                     CALL QIAPGM    QIAPRM
 C                     SETON                     LR
}


ENDIF;

