/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  HP3718CL                                      */
/*  PROGRAM NAME:    BATCH POPULATE OF FARM BUDGET                 */
/*  PROGRAMMER:      LEANNE FEDOR                                  */
/*  CREATE DATE:     03/22/04                                      */
/*                                                                 */
/*  FUNCTION:        THIS FUNCTION ATTEMPTS TO POPULATE THE        */
/*                   FARM BUDGET ON RECORDS THAT WERE CREATED      */
/*                   IN HPS BY MP2--AND, THEREFORE, DON'T HAVE     */
/*                   FARM BUDGETS.                                 */
/*                                                                 */
/*                   THIS CL SHOULD BE SUBMITTED FROM EITHER:      */
/*                   1) THE A/S400 JOB SCHEDULER IN THE WEE HOURS  */
/*                      OF THE MORNING OR                          */
/*                   2) BY JOHN L. AFTER HE DOES HIS THING         */
/***************************************************************** */

             PGM

             DCL        VAR(&QDATA) TYPE(*CHAR) LEN(110)

/*------------------------------------------------------------------*/
/*  BUILD QUERY STATEMENT                                           */
/*------------------------------------------------------------------*/

/*  SELECT ONLY REQUEST DETAIL RECORDS WHERE                        */
/*   1) FARM BUDGET IS ZERO                                         */
/*   2) REQUESTED QUANTITY IS ZERO                                  */
/*   3) USED QUANTITY IS NOT ZERO                                   */
/*   4) DETAIL LINE STATUS IS NOT D=DELETE OR E=ERROR               */
/*   5) ITEM BUDGET FLAG IS YES                                     */

             CHGVAR     VAR(%SST(&QDATA 1 12)) VALUE('QDFBSN *EQ 0')
             CHGVAR     VAR(%SST(&QDATA 14 17)) VALUE('*AND QDRQQT +
                          *EQ 0')
             CHGVAR     VAR(%SST(&QDATA 32 17)) VALUE('*AND QDUSQT +
                          *GT 0')
             CHGVAR     VAR(%SST(&QDATA 50 20)) VALUE('*AND QDRQSCD *NE +
                          "D"')
             CHGVAR     VAR(%SST(&QDATA 71 20)) VALUE('*AND QDRQSCD *NE +
                          "E"')
             CHGVAR     VAR(%SST(&QDATA 92 19)) VALUE('*AND IMBGFL *EQ +
                          "Y"')


/*----------------------------------------------------------------------*/
/*  RUN QUERY OVER JOIN FILE OF: REQUEST DETAIL/ITEM MASTER             */
/*----------------------------------------------------------------------*/

             OVRDBF     FILE(HSJ193I) SHARE(*YES)
             OPNQRYF    FILE((HSJ193I)) QRYSLT(&QDATA)


/*----------------------------------------------------------------------*/
/* CALL PROGRAM TO POPULATE FARM BUDGET NUMBER IN REQUEST DETAIL RECORD */
/*----------------------------------------------------------------------*/

             CALL       PGM(HP3718)

             CLOF       OPNID(HSJ193I)
             DLTOVR     FILE(*ALL)

             ENDPGM

