     H/TITLE Z-Build Cal with Dtaara   Prompt & validate record
     H DATEDIT(*YMD)
     F* CRTRPGPGM
     F* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Prompts fields, allowing user changes
     H* - Validates fields
     H* - If valid, performs an action
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Prompt & validate record
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISERICL
     H* Date          : 10/26/21  Time  : 13:33:53
     H* Copyright     : OMS Development Model
      *
      *================================================================
     F* Maintenance   :
      *================================================================
     FCAVLLSL0  IF   E           K DISK
      * Values list details file
      *
     FPUUHPVR#  CF   E             WORKSTN
     F                                     INFDS(INFDS#)
      * DSP: Z-Build Cal with Dtaara   Prompt & validate record
      *
     FCAABREL1  IF   E           K DISK
      * RTV : Company Name and Address  Retrieval index       V
      *
     FCAAFREL1  IF   E           K DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FCAABREL4  IF   E           K DISK
      * RTV : Company Name and Address  Active records
      *
     FCADNREL2  IF   E           K DISK
      * RSQ : Application               RSQ Application Code
      *
     D J3              S              1    DIM(3)
     D K3              S              1    DIM(3)
      * RIGHT JUSTIFY INPUT FIELD
      * Days in month for date validation
     D @XD             S              2  0 DIM(12) CTDATA PERRCD(12)
     D #L3             S              1    DIM(3)
     D UCT             S              1    DIM(40)                              CENTER TABLE
      * Long constants
     D @CN#            S              6    DIM(01) CTDATA PERRCD(1)
     D @CN             S             25    DIM(01) ALT(@CN#)
     D YDOW            S              1    DIM(7)                               *Days of week
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
      * ABO DEFINE LARGE STRING FOR CL CMD
     D YARTCM          DS           512
     D  DUMMY1                 1      1
     D INFDS#        E DS                  EXTNAME(Y2I#DSP)
      * Display file information data structure
      *
      * Outward parameters
     D PARC            DS            75
      * RCD : Calendar                  Retrieval index       NV
      * I :  Company Number
     D  PAAIC3                 1      2P 0
      * I :  Accounting Year Code
     D  PAESNB                10     12P 0
      * I :  Accounting Period Code
     D  PAETNB                13     14P 0
      * I :  Week Number
     D  PAEINB                18     19P 0
      * I :  Billing Cycle
     D  PAAQNB                21     22P 0
      * I :  Payroll Quarter
     D  PACMST                23     23
      * I :  HPS PIC Date
     D  PAOJDT                27     29P 0
      * I :  HPS Calendar Year
     D  PANQNX                30     32P 0
      * I :  HPS Calendar Week
     D  PANRNX                33     34P 0
      *
      /EJECT
     D XDEX            DS
      * External date
     D  XDEXDT                 1      8  0
     D  XDEY01                 1      4  0
     D  XDEX01                 1      2  0
     D  XDEX02                 3      4  0
     D  XDEY02                 5      8  0
     D  XDEX03                 5      6  0
     D  XDEX04                 7      8  0
      /EJECT
     D XDINT           DS
      * Internal date
     D  XDINDT                 1      7  0
     D  XDINYY                 1      3  0
     D  XDINMM                 4      5  0
     D  XDINDD                 6      7  0
      /EJECT
     D XTCK            DS
      * Time: hours, minutes, seconds
     D  XTTIM                  1      6  0
     D  XTHH                   1      2  0
     D  XTNN                   3      4  0
     D  XTSS                   5      6  0
      /EJECT
     D XDOFF           DS
      * Cut-off year
     D  XOFF                   1      4  0
     D  XOFFYY                 3      4  0
      /EJECT
     D XD2T            DS
      * Internal date
     D  XDINT2                 1      7  0
     D  XDINY2                 1      3  0
     D  XDINM2                 4      5  0
     D  XDIND2                 6      7  0
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * N :  USR Program mode Calendar
     D  P1EEST                 1      1
     D                 DS
     D  ZAMSDA                 1    132
      * Message data for 'CD3 Non numeric data'
      * Message data for 'Date Build Yr/Mo/Dy'
      * USR Year Alpha
     D  ZA0001                 1      2
      * Month USR
     D  ZA0002                 3      4
      * Day USR
     D  ZA0003                 5      6
      * Message data for 'Date Build Yr/Mo/Dy'
      * USR Year Alpha
     D  ZA0004                 1      2
      * Month USR
     D  ZA0005                 3      4
      * Day USR
     D  ZA0006                 5      6
      * Message data for 'From Date already exists'
      * USR From Date
     D  ZA0007                 1      4P 0
      * Message data for 'From date not found'
      * USR From Date
     D  ZA0008                 1      4P 0
      * Message data for 'thru Date already exists'
      * USR Through Date
     D  ZA0009                 1      4P 0
      * Message data for 'Thru date not found'
      * USR Through Date
     D  ZA0010                 1      4P 0
      * Message data for 'Week End Dte < Start Dte'
      * Period Beginning Date
     D  ZA0011                 1      4P 0
      * Period Ending Date
     D  ZA0012                 5      8P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0013                 1      4P 0
      * USR From Date
     D  ZA0014                 5      8P 0
      * USR Through Date
     D  ZA0015                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0016                 1      4P 0
      * USR From Date
     D  ZA0017                 5      8P 0
      * USR Through Date
     D  ZA0018                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0019                 1      4P 0
      * USR From Date
     D  ZA0020                 5      8P 0
      * USR Through Date
     D  ZA0021                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0022                 1      4P 0
      * USR From Date
     D  ZA0023                 5      8P 0
      * USR Through Date
     D  ZA0024                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0025                 1      4P 0
      * USR From Date
     D  ZA0026                 5      8P 0
      * USR Through Date
     D  ZA0027                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0028                 1      4P 0
      * USR From Date
     D  ZA0029                 5      8P 0
      * USR Through Date
     D  ZA0030                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0031                 1      4P 0
      * USR From Date
     D  ZA0032                 5      8P 0
      * USR Through Date
     D  ZA0033                 9     12P 0
      * Message data for 'Date Not In Range'
      * *DATE
     D  ZA0034                 1      4P 0
      * USR From Date
     D  ZA0035                 5      8P 0
      * USR Through Date
     D  ZA0036                 9     12P 0
      * Message data for 'Century must be entered'
      * Accounting Year
     D  ZA0037                 1      3P 0

     D  CALVALDA       DS          2000    DtaAra(CALVALDA)
     D  DACNY                  9     11
     D  DAYR                  67     70
     D  DASATKILL            116    116
     D  DASATPRD             124    124
     D  DASUNKILL            166    166
     D  DASUNPRD             174    174
     D  DAHOL01              211    216
     D  DAHOL02              219    224
     D  DAHOL03              227    232
     D  DAHOL04              235    240
     D  DAHOL05              261    266
     D  DAHOL06              269    274
     D  DAHOL07              277    282
     D  DAHOL08              285    290

     I@ABREAK
      * Company Name and Address  Retrieval index       V
      * Renamed input format fields
     I              ABAIC3                      WAAIC3
     I              ABADTX                      WAADTX
     I              ABACNA                      WAACNA
     I              ABADNA                      WAADNA
     I              ABAENA                      WAAENA
     I              ABAJNA                      WAAJNA
     I              ABBTTX                      WABTTX
     I              ABBVTX                      WABVTX
     I              ABBWTX                      WABWTX
     I              ABA2NA                      WAA2NA
     I              ABABTX                      WAABTX
     I              ABBGCD                      WABGCD
     I              ABKXCD                      WAKXCD
     I              ABUVST                      WAUVST
     I              ABUWST                      WAUWST
     I              ABUXST                      WAUXST
     I              ABVSST                      WAVSST
     I              ABAATM                      WAAATM
     I              ABAYNA                      WAAYNA
     I              ABA0NA                      WAA0NA
     I              ABAXDT                      WAAXDT
      *
     I@ABREUA
      * Company Name and Address  Active records
      * Renamed input format fields
     I              ABAIC3                      WBAIC3
     I              ABADTX                      WBADTX
     I              ABACNA                      WBACNA
     I              ABADNA                      WBADNA
     I              ABAENA                      WBAENA
     I              ABAJNA                      WBAJNA
     I              ABBTTX                      WBBTTX
     I              ABBVTX                      WBBVTX
     I              ABBWTX                      WBBWTX
     I              ABA2NA                      WBA2NA
     I              ABABTX                      WBABTX
     I              ABBGCD                      WBBGCD
     I              ABKXCD                      WBKXCD
     I              ABUVST                      WBUVST
     I              ABUWST                      WBUWST
     I              ABUXST                      WBUXST
     I              ABVSST                      WBVSST
     I              ABAATM                      WBAATM
     I              ABAYNA                      WBAYNA
     I              ABA0NA                      WBA0NA
     I              ABAXDT                      WBAXDT
      *
     I@DNRESF
      * Application               RSQ Application Code
      * Renamed input format fields
     I              DNDNCD                      WCDNCD
     I              DNAUNA                      WCAUNA
     I              DNVKST                      WCVKST
     I              DNRSCD                      WCRSCD
     I              DNUVST                      WCUVST
     I              DNUWST                      WCUWST
     I              DNUXST                      WCUXST
     I              DNAATM                      WCAATM
     I              DNAYNA                      WCAYNA
     I              DNA0NA                      WCA0NA
     I              DNAXDT                      WCAXDT
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN             7
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Conduct screen conversation
     C                   DO        *HIVAL
      * Start new transaction
     C                   MOVEL     'Y'           W0TRN             1
      * Process current transaction
     C     W0TRN         DOWEQ     'Y'
      * Convert fields to external form
     C                   EXSR      MNCV#1
      * Display screen
     C                   EXSR      CAEXFM
      * Process response
      * Cancel & exit program
     C   03              CAS                     ZXEXPG
      * HOME: Reset screen fields
     C   30              CAS                     MALDSC
      * Process screen input
     C                   CAS                     DAPRSC
     C                   END
      *
     C                   END
      *
     C                   END
      *****************************************************************
      /EJECT
     CSR   CAEXFM        BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Update screen time
     C                   TIME                    ##TME
     C     W0HLP         DOUEQ     'N'
     C                   MOVEL     'N'           W0HLP             1
     C                   MOVE      *IN04         YPMT04            1
     C                   MOVE      *IN25         HELP25            1
     C                   MOVE      *ALL'0'       ##OFF            30
     C                   MOVEA     ##OFF         *IN(1)
     C                   MOVE      YPMT04        *IN04
     C                   MOVE      HELP25        *IN25
      * Set cursor by *SET CURSOR data
     C     YSETCS        IFEQ      'Y'
     C                   EXSR      Y0SET
     C                   END
     C                   WRITE     #MSGCTL
     C                   WRITE     #CMDTXT1
     C                   EXFMT     #RCDDTL1
      * Test cursor
     C                   EXSR      Y8TST
      * Check if prompt requested
     C                   EXSR      ZDVPMT
      * Clear set cursor DDS indicator
     C     WCSRLC        IFEQ      'OFF'
     C                   SETOFF                                       94        *
     C                   END
     C                   MOVE      *BLANK        WCSRLC
      * If help requested, display help text
     C   25              EXSR      ZHHPKY
     C                   END
      * Update job time
     C                   TIME                    ##JTM
      * Clear messages from program message queue
     C                   CALL      'Y2CLMSC'
     C                   PARM      ##PGM         ZAPGMQ           10
     C                   PARM      '*SAME'       ZAPGRL            5
      * Reset first message only flag
     C                   MOVEL     'Y'           ZAFSMS            1      99    *
     C     YSETCS        IFEQ      'Y'
     C                   EXSR      Y9CLR
     C                   END
      *================================================================
     CSR   CAEXIT        ENDSR
      /EJECT
     CSR   DAPRSC        BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Confirm/update is not deferred
     C                   MOVEL     'N'           W0DCF             1
      * Validate screen input
     C                   EXSR      DBVLSC
      * If error, exit
     C     *IN99         CABEQ     '1'           DAEXIT
      * Defer confirm/update requested
     C     W0DCF         CABEQ     'Y'           DAEXIT
      * Prompt for confirmation
     C                   EXSR      DHPMCF
      * Quit if not confirmed
     C     *IN99         CABEQ     '1'           DAEXIT
      * USER: User defined action
      * EXC Maint Cal (12 Pr) XF - Calendar  * 
     C                   CLEAR                   PARC
     C     *LOCK         IN        CALVALDA
     C                   MOVE      #1AIC3        DACNY                          Company Number
     C                   MOVE      #DANNB        DAYR                           Accounting Year
     C                   MOVE      #DQ1ST        DASATKILL                      Status Flag 1
     C                   MOVE      #DQ2ST        DASATPRD                       Status Flag 2
     C                   MOVE      #DQ3ST        DASUNKILL                      Status Flag 3
     C                   MOVE      #DFMST        DASUNPRD                       Status Flag 4
     C                   MOVE      #DFFDT        DAHOL01                        USR Day 1
     C                   MOVE      #DE1DT        DAHOL02                        USR Day 2
     C                   MOVE      #DE2DT        DAHOL03                        USR Day 3
     C                   MOVE      #DE3DT        DAHOL04                        USR Day 4
     C                   MOVE      #DE4DT        DAHOL05                        USR Day 5
     C                   MOVE      #DE5DT        DAHOL06                        USR Day 6
     C                   MOVE      #DE6DT        DAHOL07                        USR Day 7
     C                   MOVE      #DFKDT        DAHOL08                        USR Day 8
     C                   OUT       CALVALDA
      *
     C                   Z-ADD     *ZERO         #DBDDT                         USR From Date
     C                   Z-ADD     *ZERO         #DBEDT                         USR Through Dat
     C                   Z-ADD     *ZERO         #DANNB                         Accounting Year
     C                   Z-ADD     *ZERO         #DE0DT                         USR Week Beginn
     C                   Z-ADD     *ZERO         #DGLDT                         USR Week Ending
     C                   Z-ADD     *ZERO         #DFFDT                         USR Day 1
     C                   Z-ADD     *ZERO         #DE1DT                         USR Day 2
     C                   Z-ADD     *ZERO         #DE2DT                         USR Day 3
     C                   Z-ADD     *ZERO         #DE3DT                         USR Day 4
     C                   Z-ADD     *ZERO         #DE4DT                         USR Day 5
     C                   Z-ADD     *ZERO         #DE5DT                         USR Day 6
     C                   Z-ADD     *ZERO         #DE6DT                         USR Day 7
     C                   Z-ADD     *ZERO         #DFKDT                         USR Day 8
      * Request new transaction
     C                   MOVEL     'N'           W0TRN
      *================================================================
     CSR   DAEXIT        ENDSR
      /EJECT
     CSR   DBVLSC        BEGSR
      *================================================================
      * Validate screen input
      *================================================================
      * Validate Company Number and convert to internal.
      * CD3 Ext/Int
     C                   MOVEL     V1AIC3        WUI3ST                         USR First Posit
     C                   MOVEL     *BLANK        W0RTN                          *Return code
      * CASE: WRK.USR First Position is Search request
     C     WUI3ST        IFEQ      '?'                                          *IF
     C                   ELSE
      * CASE: *OTHERWISE
     C                   MOVEL     V1AIC3        WUDMCD                         CD3 Ext Numeric
      * CD3 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                   MOVE      *BLANKS       JUSTC3            3
     C                   MOVEA     *BLANKS       K3
     C                   Z-ADD     3             C                 3 0
     C                   Z-ADD     3             D                 3 0
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                   MOVEA     WUDMCD        J3
     C                   MOVE      *BLANKS       W0RTN
     C                   DO        3
     C     J3(C)         IFNE      ' '
     C                   MOVEA     J3(C)         K3(D)
     C                   SUB       1             D
     C                   END
     C                   SUB       1             C
     C                   END
     C                   MOVEA     K3            JUSTC3
      * TEST FOR INVALID DATA IN FIELD
     C                   MOVE      JUSTC3        TESTC             1
     C     TESTC         IFGT      '?'
     C     TESTC         ANDLT     '0'
     C                   MOVE      'USR0752'     W0RTN
     C                   ELSE
     C                   MOVE      *IN60         HLDIN             1
     C                   TESTN                   JUSTC3               606060
     C     *IN60         IFEQ      '0'
     C                   MOVE      'USR0752'     W0RTN
     C                   END
     C                   END
     C                   MOVE      JUSTC3        WUDMCD
     C                   MOVE      HLDIN         *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C     W0RTN         IFEQ      @CN(001)                                     *IF
      * Setup message data for message
      * Send message 'CD3 Non numeric data'
     C                   MOVEL     'USR0752'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   Z-ADD     *ZERO         #1AIC3                         CD3 Int Numeric
     C                   ELSE
      * CASE: *OTHERWISE
     C                   MOVE      WUDMCD        #1AIC3                         CD3 Int Numeric
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Validate Status Flag 1  Y/N
     C                   MOVEL     *BLANK        W0RTN
      * Name search required?
     C     '#DQ1ST'      IFEQ      YPMTFD
      * Status Flag 1  Y/N
     C                   MOVEL     #DQ1ST        W0INVL           25
      * Set current value in drop down list.
     C                   MOVEL     *ZEROS        ZHQ1ST
     C                   SELECT
     C     W0INVL        WHENEQ    'N'                                          N
     C                   Z-ADD     1             ZHQ1ST
     C     W0INVL        WHENEQ    'Y'                                          Y
     C                   Z-ADD     2             ZHQ1ST
     C                   ENDSL
     C                   EXFMT     ZGQ1ST
      * Set selected value from drop down list.
     C                   MOVEL     *BLANKS       W0INVL
     C                   SELECT
     C     ZHQ1ST        WHENEQ    1
     C                   MOVEL     'N'           W0INVL                         N
     C     ZHQ1ST        WHENEQ    2
     C                   MOVEL     'Y'           W0INVL                         Y
     C                   ENDSL
     C                   SETOFF                                       90        *
     C                   MOVEL     W0INVL        #DQ1ST
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
      *
      * Validate Status Flag 2  Y/N
     C                   MOVEL     *BLANK        W0RTN
      * Name search required?
     C     '#DQ2ST'      IFEQ      YPMTFD
      * Status Flag 2  Y/N
     C                   MOVEL     #DQ2ST        W0INVL           25
      * Set current value in drop down list.
     C                   MOVEL     *ZEROS        ZHQ2ST
     C                   SELECT
     C     W0INVL        WHENEQ    'N'                                          N
     C                   Z-ADD     1             ZHQ2ST
     C     W0INVL        WHENEQ    'Y'                                          Y
     C                   Z-ADD     2             ZHQ2ST
     C                   ENDSL
     C                   EXFMT     ZGQ2ST
      * Set selected value from drop down list.
     C                   MOVEL     *BLANKS       W0INVL
     C                   SELECT
     C     ZHQ2ST        WHENEQ    1
     C                   MOVEL     'N'           W0INVL                         N
     C     ZHQ2ST        WHENEQ    2
     C                   MOVEL     'Y'           W0INVL                         Y
     C                   ENDSL
     C                   SETOFF                                       90        *
     C                   MOVEL     W0INVL        #DQ2ST
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
      *
      * Validate Status Flag 3  Y/N
     C                   MOVEL     *BLANK        W0RTN
      * Name search required?
     C     '#DQ3ST'      IFEQ      YPMTFD
      * Status Flag 3  Y/N
     C                   MOVEL     #DQ3ST        W0INVL           25
      * Set current value in drop down list.
     C                   MOVEL     *ZEROS        ZHQ3ST
     C                   SELECT
     C     W0INVL        WHENEQ    'N'                                          N
     C                   Z-ADD     1             ZHQ3ST
     C     W0INVL        WHENEQ    'Y'                                          Y
     C                   Z-ADD     2             ZHQ3ST
     C                   ENDSL
     C                   EXFMT     ZGQ3ST
      * Set selected value from drop down list.
     C                   MOVEL     *BLANKS       W0INVL
     C                   SELECT
     C     ZHQ3ST        WHENEQ    1
     C                   MOVEL     'N'           W0INVL                         N
     C     ZHQ3ST        WHENEQ    2
     C                   MOVEL     'Y'           W0INVL                         Y
     C                   ENDSL
     C                   SETOFF                                       90        *
     C                   MOVEL     W0INVL        #DQ3ST
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
      *
      * Validate Status Flag 4  Y/N
     C                   MOVEL     *BLANK        W0RTN
      * Name search required?
     C     '#DFMST'      IFEQ      YPMTFD
      * Status Flag 4  Y/N
     C                   MOVEL     #DFMST        W0INVL           25
      * Set current value in drop down list.
     C                   MOVEL     *ZEROS        ZHFMST
     C                   SELECT
     C     W0INVL        WHENEQ    'N'                                          N
     C                   Z-ADD     1             ZHFMST
     C     W0INVL        WHENEQ    'Y'                                          Y
     C                   Z-ADD     2             ZHFMST
     C                   ENDSL
     C                   EXFMT     ZGFMST
      * Set selected value from drop down list.
     C                   MOVEL     *BLANKS       W0INVL
     C                   SELECT
     C     ZHFMST        WHENEQ    1
     C                   MOVEL     'N'           W0INVL                         N
     C     ZHFMST        WHENEQ    2
     C                   MOVEL     'Y'           W0INVL                         Y
     C                   ENDSL
     C                   SETOFF                                       90        *
     C                   MOVEL     W0INVL        #DFMST
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
      *
      * Validate USR Day 1
      * External date
     C                   Z-ADD     VDFFDT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9937      *
     C                   END
     C                   Z-ADD     XDINDT        #DFFDT
      * Validate USR Day 2
      * External date
     C                   Z-ADD     VDE1DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9938      *
     C                   END
     C                   Z-ADD     XDINDT        #DE1DT
      * Validate USR Day 3
      * External date
     C                   Z-ADD     VDE2DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9939      *
     C                   END
     C                   Z-ADD     XDINDT        #DE2DT
      * Validate USR Day 4
      * External date
     C                   Z-ADD     VDE3DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9940      *
     C                   END
     C                   Z-ADD     XDINDT        #DE3DT
      * Validate USR Day 5
      * External date
     C                   Z-ADD     VDE4DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9941      *
     C                   END
     C                   Z-ADD     XDINDT        #DE4DT
      * Validate USR Day 6
      * External date
     C                   Z-ADD     VDE5DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9942      *
     C                   END
     C                   Z-ADD     XDINDT        #DE5DT
      * Validate USR Day 7
      * External date
     C                   Z-ADD     VDE6DT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9943      *
     C                   END
     C                   Z-ADD     XDINDT        #DE6DT
      * Validate USR Day 8
      * External date
     C                   Z-ADD     VDFKDT        XDEXDT
      * Check date
     C                   EXSR      XDCK2
     C     W0RTN         IFNE      *BLANK
     C                   SETON                                        9944      *
     C                   END
     C                   Z-ADD     XDINDT        #DFKDT
     C     YPMTFD        IFEQ      *BLANKS
      * USER: Validate fields
      * RTV Company Name - Company Name and Address  * 
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     #1AIC3        WL0001                         Company Number
     C                   EXSR      SARVGN
      * Move subroutine local variables to output parameters.
     C                   MOVEL(P)  WL0002        #DAGTX                         Name
      * Set Up From & To Date / Beginning Week & Ending Week
     C                   EXSR      UASUBR                                       Set Up From & T
      * Edit through date to be greater than from date
      * Val:  Through Date
      * CASE: DTL.USR From Date GT DTL.USR Through Date
     C     #DBDDT        IFGT      #DBEDT                                       *IF
      * Send message 'Through date not greater'
     C                   MOVEL     'USR0032'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
      * Validate From date
     C                   EXSR      UBSUBR                                       Validate From d
      * Validate Thru date
     C                   EXSR      UCSUBR                                       Validate Thru d
      * Edit 1st week ending date cannot be less than 1st week starting d
      * Val:  Week Beginning Date
      * CASE: DTL.USR Week Beginning Date GT DTL.USR Week Ending Date
     C     #DE0DT        IFGT      #DGLDT                                       *IF
      * Setup message data for message
      * Convert USR Week Beginning Date to display format
      * Convert date
     C     1000000       ADD       #DE0DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0011
      * Convert USR Week Ending Date to display format
      * Convert date
     C     1000000       ADD       #DGLDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0012
      * Send message 'Week End Dte < Start Dte'
     C                   MOVEL     'USR1790'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
      * Val:  Holiday Day Dates
      * CASE: Day 1 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 1 is GT Zero
      *   |- c1    : DTL.USR Day 1 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 1 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DFFDT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DFFDT        IFLT      #DBDDT                                       *IF
     C     #DFFDT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 1 to display format
      * Convert date
     C     1000000       ADD       #DFFDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0013
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0014
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0015
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9937      *
      *
     C                   ELSE
      * CASE: Day 2 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 2 is GT Zero
      *   |- c1    : DTL.USR Day 2 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 2 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE1DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE1DT        IFLT      #DBDDT                                       *IF
     C     #DE1DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 2 to display format
      * Convert date
     C     1000000       ADD       #DE1DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0016
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0017
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0018
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9938      *
      *
     C                   ELSE
      * CASE: Day 3 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 3 is GT Zero
      *   |- c1    : DTL.USR Day 3 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 3 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE2DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE2DT        IFLT      #DBDDT                                       *IF
     C     #DE2DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 3 to display format
      * Convert date
     C     1000000       ADD       #DE2DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0019
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0020
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0021
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9939      *
      *
     C                   ELSE
      * CASE: Day 4 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 4 is GT Zero
      *   |- c1    : DTL.USR Day 4 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 4 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE3DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE3DT        IFLT      #DBDDT                                       *IF
     C     #DE3DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 4 to display format
      * Convert date
     C     1000000       ADD       #DE3DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0022
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0023
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0024
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9940      *
      *
     C                   ELSE
      * CASE: Day 5 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 5 is GT Zero
      *   |- c1    : DTL.USR Day 5 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 5 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE4DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE4DT        IFLT      #DBDDT                                       *IF
     C     #DE4DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 5 to display format
      * Convert date
     C     1000000       ADD       #DE4DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0025
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0026
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0027
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9941      *
      *
     C                   ELSE
      * CASE: Day 6 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 6 is GT Zero
      *   |- c1    : DTL.USR Day 6 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 6 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE5DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE5DT        IFLT      #DBDDT                                       *IF
     C     #DE5DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 6 to display format
      * Convert date
     C     1000000       ADD       #DE5DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0028
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0029
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0030
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9942      *
      *
     C                   ELSE
      * CASE: Day 7 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 7 is GT Zero
      *   |- c1    : DTL.USR Day 7 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 7 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DE6DT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DE6DT        IFLT      #DBDDT                                       *IF
     C     #DE6DT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 7 to display format
      * Convert date
     C     1000000       ADD       #DE6DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0031
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0032
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0033
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9943      *
      *
     C                   ELSE
      * CASE: Day 8 Not Between From And Through Date
      *  - c3 AND (c1 OR c2)
      *   |- c3    : DTL.USR Day 8 is GT Zero
      *   |- c1    : DTL.USR Day 8 LT DTL.USR From Date
      *   |- c2    : DTL.USR Day 8 GT DTL.USR Through Date
      *   '-
     C                   MOVEL     '0'           Y0CX01            1
     C     #DFKDT        IFGT      *ZERO                                        *IF
     C                   MOVEL     '0'           Y0CX02            1
     C     #DFKDT        IFLT      #DBDDT                                       *IF
     C     #DFKDT        ORGT      #DBEDT                                       *OR
     C                   MOVEL     '1'           Y0CX02
     C                   END                                                    *FI
     C     Y0CX02        IFEQ      '1'                                          *IF
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C     Y0CX01        IFEQ      '1'                                          *IF
      * Setup message data for message
      * Convert USR Day 8 to display format
      * Convert date
     C     1000000       ADD       #DFKDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0034
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0035
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0036
      * Send message 'Date Not In Range'
     C                   MOVEL     'USR2248'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9944      *
      *
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Century must be entered for year
      * CASE: DTL.Accounting Year is Less than 1900
     C     #DANNB        IFLT      1900                                         *IF
      * Setup message data for message
     C                   Z-ADD     #DANNB        ZA0037                         Accounting Year
      * Send message 'Century must be entered'
     C                   MOVEL     'USR2429'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        9932      *
      *
     C                   END                                                    *FI
     C                   END
      * Bypass ref file checks if error already detected
     C   99              GOTO      DBEXIT
      * Check reference to Company Name and Address
     C                   EXSR      VACKRL
     C     W0RTN         IFNE      *BLANK
     C     YPMTFD        ANDEQ     *BLANK
     C                   SETON                                        9931      *
     C                   END
     C     YPMTFD        IFEQ      *BLANKS
      * USER: Validate relations
      * WRK.USR Year = DTL.USR From Date *YEAR
     C     #DBDDT        ADD       1000000       XDINDT
     C     1800          ADD       XDINYY        WUB0NB
      * WRK.@Year Code = DTL.USR Through Date *YEAR
     C     #DBEDT        ADD       1000000       XDINDT
     C     1800          ADD       XDINYY        WUPSNB
      * CASE: WRK.USR Year NE WRK.@Year Code
     C     WUB0NB        IFNE      WUPSNB                                       *IF
      * Send message 'Multiple years entered'
     C                   MOVEL     'USR1791'     ZAMSID
     C                   MOVEL     '*INFO  '     ZAMSTP                         Message type
     C                   EXSR      ZASNMS
      *
     C                   END                                                    *FI
     C                   END
      * Company Number required
     C     #1AIC3        IFEQ      *ZERO                                        IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9931      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      * Accounting Year required
     C     #DANNB        IFEQ      *ZERO                                        IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9932      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      * Status Flag 1  Y/N required
     C     #DQ1ST        IFEQ      *BLANK                                       IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9933      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      * Status Flag 2  Y/N required
     C     #DQ2ST        IFEQ      *BLANK                                       IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9934      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      * Status Flag 3  Y/N required
     C     #DQ3ST        IFEQ      *BLANK                                       IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9935      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      * Status Flag 4  Y/N required
     C     #DFMST        IFEQ      *BLANK                                       IF
     C     YPMTFD        ANDEQ     *BLANKS
     C                   SETON                                        9936      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END                                                    FI
      *================================================================
     CSR   DBEXIT        ENDSR
      /EJECT
     CSR   DHPMCF        BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                   EXSR      MNCV#1
      * Update screen time
     C                   TIME                    ##TME
      * Refresh screen
     C                   MOVEL     *BLANK        ##CFCD
     C                   MOVEL     'N'           ##CFCD
      * Save CMD keys
     C                   MOVEA     *IN           WN30             30
     C                   SETOFF                                       29        *
      * Generate internal/external key list
     C     KINEX         KLIST
     C                   KFLD                    Y2LSNO
     C                   KFLD                    Y2INVL
      * Convert *CONFIRM to external value
     C                   Z-ADD     1001713       Y2LSNO
     C                   MOVEL     *BLANK        Y2INVL
     C                   MOVEL     ##CFCD        Y2INVL                         *CONFIRM
     C     KINEX         CHAIN     @Y2INEX                            90        *
     C  N90              MOVEL     Y2EXVL        V#CFCD                         *CONFIRM
      *
     C     W0HLP         DOUEQ     'N'
     C     *IN29         ANDEQ     '0'
     C                   WRITE     #MSGCTL
     C                   WRITE     #CMDTXT1
     C                   WRITE     #RCDDTL1
     C                   EXFMT     #CONFIRM
     C     *IN29         IFEQ      '1'
     C                   SETON                                        99
     C                   GOTO      DHEXIT
     C                   END
      * Clear set cursor DDS indicator
     C     WCSRLC        IFEQ      'OFF'
     C                   SETOFF                                       94        *
     C                   END
     C                   MOVE      *BLANK        WCSRLC
      * If help requested, display help text
     C   25              EXSR      ZHHPKY
      * Validate *CONFIRM
     C                   MOVEL     *BLANK        W0RTN
     C                   MOVEL     V#CFCD        W0NSRQ            1            *CONFIRM
      * Name search required?
     C     W0NSRQ        IFEQ      '?'
     C     'V#CFCD'      OREQ      YPMTFD
     C                   CALL      'CAVLLSR'                            90      *
     C                   PARM                    W0RTN             7
     C                   PARM      1001713       Y2LSNO            7 0
     C     V#CFCD        PARM      V#CFCD        W0EXVL           25            *CONFIRM
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
     C     W0NSRQ        IFNE      '?'
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
     C                   END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C     KEXIN         KLIST
     C                   KFLD                    Y2LSNO
     C                   KFLD                    Y2EXVL
      * Convert *CONFIRM to internal value
     C                   Z-ADD     1001713       Y2LSNO
     C                   MOVEL     *BLANK        Y2EXVL
     C                   MOVEL     V#CFCD        Y2EXVL                         *CONFIRM
     C     KEXIN         CHAIN     @Y2EXIN                            90        *
     C     *IN90         IFEQ      '1'
     C                   MOVEL     *BLANK        ##CFCD
     C     YPMTFD        IFEQ      *BLANK
     C                   SETON                                        96        *
     C                   WRITE     #CONFIRM
     C                   SETOFF                                       96        *
     C                   END
     C                   ELSE
     C                   MOVEL     Y2INVL        ##CFCD                         *CONFIRM
     C                   END
      *
     C   90              SETON                                        29        *
     C  N90              SETOFF                                       29        *
     C                   END
      * Restore CMD keys
     C                   MOVEA     WN30          *IN
      * Update job time
     C                   TIME                    ##JTM
     C     ##CFCD        IFEQ      'Y'
      * Clear messages from program message queue
     C                   CALL      'Y2CLMSC'
     C                   PARM      ##PGM         ZAPGMQ           10
     C                   PARM      '*SAME'       ZAPGRL            5
      * Reset first message only flag
     C                   MOVEL     'Y'           ZAFSMS            1      99    *
     C                   END
     C     ##CFCD        COMP      'Y'                                9999      *
      * Not confirmed
      *================================================================
     CSR   DHEXIT        ENDSR
      /EJECT
     CSR   MALDSC        BEGSR
      *================================================================
      * Load screen from passed parameters
      *================================================================
     C                   MOVEL     *BLANK        #1V9ST                         Kill Day Status
     C                   MOVEL     *BLANK        #1WAST                         Production Day
     C                   MOVEL     *BLANK        #1X2ST                         Prodcution Sch/
     C                   Z-ADD     *ZERO         #1OJDT                         HPS PIC Date
     C                   Z-ADD     *ZERO         #1NQNX                         HPS Calendar Ye
     C                   Z-ADD     *ZERO         #1NRNX                         HPS Calendar We
     C                   MOVEL     *BLANK        #1I9SX                         Number of Prod
     C                   MOVEL     *BLANK        #1JASX                         Calendar Unused
     C                   Z-ADD     *ZERO         #1OKDT                         Calendar Unused
     C                   Z-ADD     *ZERO         #1OLDT                         Calendar Unused
     C                   Z-ADD     *ZERO         #1AIC3                         Company Number
      * Clear external version also
     C                   MOVEL     *BLANK        V1AIC3
     C                   MOVEL     *BLANK        #DAGTX                         USR Company Nam
     C                   Z-ADD     *ZERO         #DANNB                         Accounting Year
     C                   Z-ADD     *ZERO         #DBDDT                         USR From Date
      * Clear external version also
     C                   Z-ADD     *ZERO         VDBDDT
     C                   Z-ADD     *ZERO         #DBEDT                         USR Through Dat
      * Clear external version also
     C                   Z-ADD     *ZERO         VDBEDT
     C                   Z-ADD     *ZERO         #1EINB                         Week Number
     C                   Z-ADD     *ZERO         #DAMNB                         Accounting Peri
     C                   Z-ADD     *ZERO         #DE0DT                         USR Week Beginn
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE0DT
     C                   Z-ADD     *ZERO         #DGLDT                         USR Week Ending
      * Clear external version also
     C                   Z-ADD     *ZERO         VDGLDT
     C                   MOVEL     *BLANK        #DQ1ST                         Status Flag 1
     C                   MOVEL     *BLANK        #DQ2ST                         Status Flag 2
     C                   MOVEL     *BLANK        #DQ3ST                         Status Flag 3
     C                   MOVEL     *BLANK        #DFMST                         Status Flag 4
     C                   Z-ADD     *ZERO         #DFFDT                         USR Day 1
      * Clear external version also
     C                   Z-ADD     *ZERO         VDFFDT
     C                   Z-ADD     *ZERO         #DE1DT                         USR Day 2
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE1DT
     C                   Z-ADD     *ZERO         #DE2DT                         USR Day 3
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE2DT
     C                   Z-ADD     *ZERO         #DE3DT                         USR Day 4
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE3DT
     C                   Z-ADD     *ZERO         #DE4DT                         USR Day 5
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE4DT
     C                   Z-ADD     *ZERO         #DE5DT                         USR Day 6
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE5DT
     C                   Z-ADD     *ZERO         #DE6DT                         USR Day 7
      * Clear external version also
     C                   Z-ADD     *ZERO         VDE6DT
     C                   Z-ADD     *ZERO         #DFKDT                         USR Day 8
      * Clear external version also
     C                   Z-ADD     *ZERO         VDFKDT
      * USER: Load screen
      * Retrieve Company - Company Name and Address  * 
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     #1AIC3        WL0001                         Company Number
     C                   EXSR      SARVGN
      * Move subroutine local variables to output parameters.
     C                   MOVEL(P)  WL0002        #DAGTX                         Name
     C                   MOVEL     'N'           #DQ1ST                         Status Flag 1
     C                   MOVEL     'N'           #DQ2ST                         Status Flag 2
     C                   MOVEL     'N'           #DQ3ST                         Status Flag 3
     C                   MOVEL     'N'           #DFMST                         Status Flag 4
     C                   Z-ADD     1             #1EINB                         Week Number
     C                   Z-ADD     1             #DAMNB                         Accounting Peri
      *================================================================
     CSR   MAEXIT        ENDSR
      /EJECT
     CSR   MNCV#1        BEGSR
      *================================================================
      * Convert fields into external form
      *================================================================
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C     #1AIC3        IFNE      0                                            *IF
     C                   MOVEL     *BLANK        WUDMCD                         CD3 Ext Numeric
     C                   MOVEL     #1AIC3        WUDMCD                         CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                   MOVEA     WUDMCD        #L3                            EDIT ARRAY
     C                   Z-ADD     1             #E                3 0
     C                   MOVE      *IN61         UUIN61            1
     C                   SETOFF                                       61
     C                   DO        3
     C     #L3(#E)       IFEQ      '0'                                          ZERO VALUE
     C     *IN61         IFEQ      '0'
     C                   MOVE      ' '           #L3(#E)
     C                   ADD       1             #E
     C                   END
     C                   ELSE
     C                   SETON                                        61
     C                   END
     C                   END
     C                   MOVEA     #L3           WUDMCD
     C                   MOVE      UUIN61        *IN61
     C                   MOVEL     WUDMCD        V1AIC3                         CD3 Ext Numeric
     C                   ELSE
      * CASE: *OTHERWISE
     C                   MOVEL     *BLANK        V1AIC3                         CD3 Ext Numeric
     C                   END                                                    *FI
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDBDDT
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDBEDT
      * Convert USR Week Beginning Date to display format
      * Convert date
     C     1000000       ADD       #DE0DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE0DT
      * Convert USR Week Ending Date to display format
      * Convert date
     C     1000000       ADD       #DGLDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDGLDT
      * Convert USR Day 1 to display format
      * Convert date
     C     1000000       ADD       #DFFDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDFFDT
      * Convert USR Day 2 to display format
      * Convert date
     C     1000000       ADD       #DE1DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE1DT
      * Convert USR Day 3 to display format
      * Convert date
     C     1000000       ADD       #DE2DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE2DT
      * Convert USR Day 4 to display format
      * Convert date
     C     1000000       ADD       #DE3DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE3DT
      * Convert USR Day 5 to display format
      * Convert date
     C     1000000       ADD       #DE4DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE4DT
      * Convert USR Day 6 to display format
      * Convert date
     C     1000000       ADD       #DE5DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE5DT
      * Convert USR Day 7 to display format
      * Convert date
     C     1000000       ADD       #DE6DT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDE6DT
      * Convert USR Day 8 to display format
      * Convert date
     C     1000000       ADD       #DFKDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        VDFKDT
      *================================================================
     CSR   MNEXIT        ENDSR
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * RTV Company Name - Company Name and Address  * 
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WAAIC3                         Company Number
      * Setup key
     C                   Z-ADD     WL0001        WAAIC3                         Company Number
      * Establish starting position
     C     KRSSA         CHAIN     @ABREAK                            90        *
      * Data record not found
     C   90              MOVEL     'USR0003'     W0RTN             7
     C     *IN90         IFEQ      '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                   MOVEL     WAADTX        WL0002                         Name
     C                   ENDIF
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Retrieve Calendar - Calendar  * 
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    AFAIC3                         Company Number
     C                   KFLD                    AFBCDT                         Post to G/L Dat
      * Setup key
     C                   Z-ADD     WL0003        AFAIC3                         Company Number
     C                   Z-ADD     WL0004        AFBCDT                         Post to G/L Dat
      * Establish starting position
     C     KRSSB         CHAIN     @AFREBE                            90        *
     C     *IN90         IFEQ      '1'
      * Data record not found
     C                   MOVEL     'USR0018'     W0RTN             7
      * USER: Processing if Data record not found
     C                   MOVEL     'USR0018'     W0RTN                          *Return code
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
     C     *IN90         IFEQ      '0'
      * USER: Process Data record
     C                   MOVEL     *BLANK        W0RTN                          *Return code
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Declare restrictor key work fields
     C     *LIKE         DEFINE    WCDNCD        WQSC01                         Application Cod
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WQSC01                         Application Cod
      * Setup key
     C                   MOVE      *BLANK        WQSC01                         Application Cod
     C                   MOVEL     'C/S'         WQSC01                         Application Cod
      * Establish starting position
     C     KRSSC         SETLL     @DNRESF                                      *
     C     KRSSC         READE     @DNRESF                                90    *
      * Data record not found
     C   90              MOVEL     'USR0755'     W0RTN             7
     C     *IN90         DOWEQ     '0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C     WCRSCD        IFEQ      *BLANK                                       *IF
      * PAR = DB1 By name
     C                   MOVEL     WCAUNA        WUAUNA                         Description
     C                   ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                   EXSR      SDRVGN
     C                   END                                                    *FI
     C     KRSSC         READE     @DNRESF                                90    *
     C                   ENDDO
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Declare restrictor key work fields
     C     *LIKE         DEFINE    WCDNCD        WQSD01                         Application Cod
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    WQSD01                         Application Cod
      * Setup key
     C                   MOVEL     WCRSCD        WQSD01                         Application Cod
      * Establish starting position
     C     KRSSD         SETLL     @DNRESF                                      *
     C     KRSSD         READE     @DNRESF                                90    *
     C     *IN90         IFEQ      '1'
      * Data record not found
     C                   MOVEL     'USR0755'     W0RTN             7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                   MOVEL     *BLANK        WUAUNA                         Description
     C                   MOVEL     'Y2U0005'     W0RTN                          *Return code
     C                   GOTO      SDEXIT
     C                   ENDIF
      *
     C     *IN90         DOWEQ     '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                   MOVEL     WCAUNA        WUAUNA                         Description
     C     KRSSD         READE     @DNRESF                                90    *
     C                   ENDDO
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   UASUBR        BEGSR
      *================================================================
      * Set Up From & To Date / Beginning Week & Ending Week
      *================================================================
     C                   MOVEL     *BLANK        WUN8CD                         USR Accounting
     C                   MOVEL     #DANNB        WUN8CD                         USR Accounting
     C                   Z-ADD     2             YRSW00
     C                   Z-ADD     3             ZQ                5 0
     C     YRSW00        IFLT      1
     C     ZQ            ORLT      1
     C     YRSW00        ORGT      00004
     C     ZQ            ORGT      00004
     C                   MOVEL     'Y2U0510'     W0RTN
     C                   ELSE
     C     YRSW00        SUBST(P)  WUN8CD:ZQ     WUVRCD                 90      USR Year Alpha
     C   90              MOVEL     'Y2U0510'     W0RTN
     C                   END
     C                   MOVE      WUVRCD        WUJBYR                         USR Job Year
      * From Date
     C                   Z-ADD     *ZERO         WUEQNB                         USR From Date N
      * Setup message data for message
     C                   MOVEL     WUVRCD        ZA0001                         USR Year Alpha
     C                   MOVEL     '01'          ZA0002                         Month USR
     C                   MOVEL     '01'          ZA0003                         Day USR
      * Retrieve message Date Build Yr/Mo/Dy
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   CALL      'Y2RVMGC'                            90      *
     C                   PARM      *BLANK        W0RTN             7            Return code
     C                   PARM      'USR2434'     ZAMSID            7            Message ID
     C                   PARM                    ZAMSGF           10            Message file
     C                   PARM                    ZAMSDA                         Message data
     C     WUKBTX        PARM                    W0MTX           132            Returned messag
     C                   MOVEL     *BLANK        ZAMSDA
     C                   MOVEL     *BLANK        ZAMSGF
     C                   Z-ADD     *ZERO         WUEQNB                         USR From Date N
     C                   MOVE      WUKBTX        WUEQNB                         USR From Date N
      * Next Century
      * CASE: WRK.USR Job Year is LT 40
     C     WUJBYR        IFLT      40                                           *IF
     C                   ADD       1000000       WUEQNB                         USR From Date N
     C                   END                                                    *FI
      * DTL.USR From Date = WRK.USR From Date Numeric
     C                   Z-ADD     WUEQNB        #DBDDT                         USR From Date
      * DTL.USR Week Beginning Date = WRK.USR From Date Numeric
     C                   Z-ADD     WUEQNB        #DE0DT                         USR Week Beginn
      * To Date
     C                   Z-ADD     *ZERO         WUEQNB                         USR From Date N
      * Setup message data for message
     C                   MOVEL     WUVRCD        ZA0004                         USR Year Alpha
     C                   MOVEL     '12'          ZA0005                         Month USR
     C                   MOVEL     '31'          ZA0006                         Day USR
      * Retrieve message Date Build Yr/Mo/Dy
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   CALL      'Y2RVMGC'                            90      *
     C                   PARM      *BLANK        W0RTN             7            Return code
     C                   PARM      'USR2434'     ZAMSID            7            Message ID
     C                   PARM                    ZAMSGF           10            Message file
     C                   PARM                    ZAMSDA                         Message data
     C     WUKBTX        PARM                    W0MTX           132            Returned messag
     C                   MOVEL     *BLANK        ZAMSDA
     C                   MOVEL     *BLANK        ZAMSGF
     C                   Z-ADD     *ZERO         WUEQNB                         USR From Date N
     C                   MOVE      WUKBTX        WUEQNB                         USR From Date N
      * Next Century
      * CASE: WRK.USR Job Year is LT 40
     C     WUJBYR        IFLT      40                                           *IF
     C                   ADD       1000000       WUEQNB                         USR From Date N
     C                   END                                                    *FI
      * DTL.USR Through Date = WRK.USR From Date Numeric
     C                   Z-ADD     WUEQNB        #DBEDT                         USR Through Dat
      * Week Ending (Saturday)
      * WRK.Day of Week (SYN) USR = DTL.USR From Date *DAY OF WEEK
     C     #DBDDT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C     XDAY1         ADD       3             XDWK1             8 0
     C                   DIV       7             XDWK1
     C                   MVR                     XDWK1
     C     XDWK1         IFEQ      0
     C                   Z-ADD     7             XDWK1
     C                   END
     C     XDAY1         SUB       XDWK1         XDAY2             6 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   MOVEL     'NONE'        WUDLN            10
     C                   EXSR      XDUDY
     C                   MOVE      XDURR         WU
      * Set Up Week Ending Date
      * CASE: WRK.Day of Week (SYN) USR is Monday
     C     WU            IFEQ      1                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.5 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     5             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Tuesday
     C     WU            IFEQ      2                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.4 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     4             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Wednesday
     C     WU            IFEQ      3                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.3 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     3             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Thursday
     C     WU            IFEQ      4                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.2 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     2             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Friday
     C     WU            IFEQ      5                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.1 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     1             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Saturday
     C     WU            IFEQ      6                                            *IF
     C                   Z-ADD     #DE0DT        #DGLDT                         USR Week Ending
     C                   ELSE
      * CASE: WRK.Day of Week (SYN) USR is Sunday
     C     WU            IFEQ      7                                            *IF
      * DTL.USR Week Ending Date = DTL.USR Week Beginning Date + CON.6 *D
     C     #DE0DT        ADD       1000000       XDINDT
     C                   EXSR      XCVTA
     C                   Z-ADD     XDAY1         XDAY2             6 0
     C                   Z-ADD     6             XDURR             8 0
     C                   MOVEL     '1'           XDSEL             1
     C                   MOVEL     '1111111'     XDCDW             7
     C                   EXSR      XDOWS
     C                   EXSR      XDADY
     C                   EXSR      XCVFA
     C     XDINDT        IFLT      010101
     C     XDINDT        ORGT      4000000
     C                   Z-ADD     *ZERO         #DGLDT
     C                   ELSE
     C     XDINDT        SUB       1000000       #DGLDT
     C                   END
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      *================================================================
     CSR   UAEXIT        ENDSR
      /EJECT
     CSR   UBSUBR        BEGSR
      *================================================================
      * Validate From date
      *================================================================
      * Retrieve Calendar - Calendar  * 
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     #1AIC3        WL0003                         Company Number
     C                   Z-ADD     #DBDDT        WL0004                         Post to G/L Dat
     C                   EXSR      SBRVGN
      * CASE: PGM.*Return code is *Normal
     C     W0RTN         IFEQ      *BLANK                                       *IF
      * Error if in build mode
      * CASE: PAR.USR Program mode Calendar is Build mode
     C     P1EEST        IFEQ      'B'                                          *IF
      * Setup message data for message
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0007
      * Send message 'From Date already exists'
     C                   MOVEL     'USR1784'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
     C                   ELSE
      * CASE: *OTHERWISE
      * Error if in change mode
      * CASE: PAR.USR Program mode Calendar is Update Acct. Per. Values
     C     P1EEST        IFEQ      '3'                                          *IF
      * Setup message data for message
      * Convert USR From Date to display format
      * Convert date
     C     1000000       ADD       #DBDDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0008
      * Send message 'From date not found'
     C                   MOVEL     'USR1786'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
     C                   END                                                    *FI
      *================================================================
     CSR   UBEXIT        ENDSR
      /EJECT
     CSR   UCSUBR        BEGSR
      *================================================================
      * Validate Thru date
      *================================================================
      * Retrieve Calendar - Calendar  * 
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     #1AIC3        WL0003                         Company Number
     C                   Z-ADD     #DBEDT        WL0004                         Post to G/L Dat
     C                   EXSR      SBRVGN
      * CASE: PGM.*Return code is *Normal
     C     W0RTN         IFEQ      *BLANK                                       *IF
      * Error if in build mode
      * CASE: PAR.USR Program mode Calendar is Build mode
     C     P1EEST        IFEQ      'B'                                          *IF
      * Setup message data for message
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0009
      * Send message 'thru Date already exists'
     C                   MOVEL     'USR1785'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
     C                   ELSE
      * CASE: *OTHERWISE
      * Error if in change mode
      * CASE: PAR.USR Program mode Calendar is Update Acct. Per. Values
     C     P1EEST        IFEQ      '3'                                          *IF
      * Setup message data for message
      * Convert USR Through Date to display format
      * Convert date
     C     1000000       ADD       #DBEDT        XDINDT
     C                   EXSR      XDVC2T
     C                   Z-ADD     XDEXDT        ZA0010
      * Send message 'Thru date not found'
     C                   MOVEL     'USR1787'     ZAMSID
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
      *
     C                   END                                                    *FI
     C                   END                                                    *FI
      *================================================================
     CSR   UCEXIT        ENDSR
      /EJECT
     CSR   VACKRL        BEGSR
      *================================================================
      * Check reference to Company Name and Address
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Name search required?
     C                   MOVEL     V1AIC3        WK1X01            1
     C     WK1X01        IFEQ      '?'                                          Company Number
     C     YPMTFD        OREQ      '#1AIC3'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DTL) #1AIC3' defaulted for 'Company Number'.
     C                   CALL      'CAAJSRR'                            90      SEL Company by
     C                   PARM      *BLANK        W0RTN             7
     C     #1AIC3        PARM      #1AIC3        WQ0018            3 0          Company Number
      *
     C     *IN90         IFEQ      '1'
      * Call to program ended in error
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   MOVEL     *BLANKS       W0CLPG           10
     C                   MOVEL     'CAAJSRR'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   END
      * Error detected?
     C     W0RTN         IFNE      *BLANK
     C     W0RTN         ANDNE     'Y2U0016'
     C                   SETON                                        9931      *
     C                   END
      *
     C     #1AIC3        IFNE      *ZERO                                        Company Number
     C     YPMTFD        ANDNE     *BLANK
     C     W0RTN         ANDEQ     *BLANK
     C     WK1X01        ANDNE     '?'
     C                   MOVEL     '*DONE'       YPMTFD
     C                   END
      * Defer confirm
     C                   MOVEL     'Y'           W0DCF             1
      * No value selected, exit
     C     W0RTN         IFNE      *BLANK
     C     YPMTFD        ANDEQ     *BLANK
     C                   GOTO      VAEXIT
     C                   END
     C                   END
      *................................................................
      * If all low order keys not entered, exit
     C     #1AIC3        IFEQ      *ZERO                                        Company Number
     C                   GOTO      VAEXIT
     C                   END
      *
     C     KLVAWB        KLIST
     C                   KFLD                    WBAIC3                         Company Number
      * Setup key
     C                   Z-ADD     #1AIC3        WBAIC3
     C     KLVAWB        CHAIN     @ABREUA                            9091      *
     C     *IN90         IFEQ      '0'
      * Record found - move back any virtuals
     C                   GOTO      VAEXIT
     C                   END
     C     YPMTFD        IFNE      *BLANK
     C                   SETOFF                                       9091
     C                   GOTO      VAEXIT
     C                   END
      * Send message 'Company Name and Addre NF'
     C                   MOVEL     'USR0003'     ZAMSID
     C                   EXSR      ZASNMS
     C                   MOVEL     'USR0003'     W0RTN
      *================================================================
     CSR   VAEXIT        ENDSR
      /EJECT
     CSR   XCVFA         BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C     XDAY1         IFGT      109267
     C                   ADD       2             XDAY1
     C                   ELSE
     C     XDAY1         IFGT      36218
     C                   ADD       1             XDAY1
     C                   END
     C                   END
      * Full years (up to the date)
     C     XDAY1         DIV       365.25        XDWK1             8 0
     C                   MVR                     XDWK3             7 1
     C                   Z-ADD     XDWK1         XDINYY
     C     XDWK3         IFEQ      0
      * The date is the end of a year
     C                   Z-ADD     12            XDINMM
     C                   Z-ADD     31            XDINDD
     C                   ELSE
      * Year days up to the date
     C     XDWK1         MULT      365.25        XDWK2             6 0
     C                   SUB       XDWK2         XDAY1
     C                   ADD       1             XDINYY
      * Leap year ?
     C     XDINYY        DIV       4             XDWK1
     C                   MVR                     XDWK1
      * March 1 (relative day of the year)
     C     XDWK1         IFEQ      0
     C                   Z-ADD     60            XDWK1
     C                   ELSE
     C                   Z-ADD     59            XDWK1
     C                   END
      * Define date base month and offset day -
     C     XDAY1         IFLE      XDWK1
      *  - January (thru February)
     C                   Z-ADD     1             XDINMM
     C                   ELSE
     C                   SUB       XDWK1         XDAY1
     C     XDAY1         IFLE      153
      *  - March (thru July)
     C                   Z-ADD     3             XDINMM
     C                   ELSE
      *  - August (thru December)
     C                   Z-ADD     8             XDINMM
     C                   SUB       153           XDAY1
     C                   END
      * Calculate 2 month base and offset day
     C     XDAY1         SUB       1             XDWK1
     C                   DIV       61            XDWK1
     C                   MVR                     XDAY1
     C                   ADD       1             XDAY1
     C                   MULT      2             XDWK1
     C                   ADD       XDWK1         XDINMM
     C                   END
      * Calculate date increment,
     C     XDAY1         IFGT      31
     C                   ADD       1             XDINMM
     C                   SUB       31            XDAY1
     C                   END
     C                   Z-ADD     XDAY1         XDINDD
     C                   END
      *================================================================
     CSR   XCVFAE        ENDSR
      /EJECT
     CSR   XCVTA         BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C     XDINYY        SUB       1             XDWK1             8 0
     C     XDWK1         MULT      365.25        XDAY1             6 0
     C     XDWK1         IFGE      300
     C                   SUB       2             XDAY1
     C                   ELSE
     C     XDWK1         IFGE      100
     C                   SUB       1             XDAY1
     C                   END
     C                   END
      * (from the beginning of the year to the beginning of the month:)
     C     XDINMM        SUB       1             XDWK1
     C     XDINMM        IFLT      3
      *     ...+31*(MM-1) (for January-February) ...
     C                   MULT      31            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                   MULT      30            XDWK1
     C                   ADD       XDWK1         XDAY1
      *         ...-2 (for preceding February) ...
     C                   SUB       2             XDAY1
     C     XDINYY        IFNE      100
     C     XDINYY        ANDNE     300
      *         ...+1 (for preceding February, if leap year) ...
     C     XDINYY        DIV       4             XDWK1
     C                   MVR                     XDWK1
     C     XDWK1         IFEQ      0
     C                   ADD       1             XDAY1
     C                   END
     C                   END
     C     XDINMM        IFLT      8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C     XDINMM        MULT      .5            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C     XDINMM        ADD       1             XDWK1
     C                   MULT      .5            XDWK1
     C                   ADD       XDWK1         XDAY1
     C                   END
     C                   END
      * ...+DD (days in the month up to the ending date)
     C                   ADD       XDINDD        XDAY1
      *================================================================
     CSR   XCVTAE        ENDSR
      /EJECT
     CSR   XDADY         BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C     XDURR         IFEQ      0
     C     XDWSL         OREQ      0
      * None days of week selected
     C                   Z-ADD     XDAY2         XDAY1
     C     XDURR         IFNE      *ZERO
      * Return Code: Unable to increment date.
     C                   MOVEL     'Y2U0059'     W0RTN             7
     C                   ENDIF
     C                   GOTO      XDADYE
     C                   ENDIF
     C     XDWSL         IFEQ      7
      * All days of week selected
     C     XDAY2         ADD       XDURR         XDAY1
     C                   GOTO      XDADYM
     C                   ENDIF
      * Some days of week selected
     C     XDURR         IFGE      0
     C                   Z-ADD     1             XDSTP             1 0
     C                   ELSE
     C                   Z-ADD     -1            XDSTP
     C                   ENDIF
      * Get number of full weeks in the duration
     C     XDURR         DIV       XDWSL         XDWNB             6 0
      * Isolate the last week
     C                   MVR                     XDLSW             1 0
     C     XDLSW         IFEQ      0
     C     XDWSL         MULT      XDSTP         XDLSW
     C                   SUB       XDSTP         XDWNB
     C                   ENDIF
      * Increment the date by the full weeks
     C     XDWNB         MULT      7             XDWK1             8 0
     C     XDAY2         ADD       XDWK1         XDAY1             6 0
      * Determine day of week of the beginning date
     C     XDAY2         ADD       3             YY                6 0
     C                   DIV       7             YY
     C                   MVR                     YY
     C     YY            IFEQ      0
     C                   Z-ADD     7             YY
     C                   ENDIF
      * Loop: Increment the date by the last week
     C     XDLSW         DOWNE     0
      * Increment the date
     C                   ADD       XDSTP         XDAY1
      * Increment the day of week
     C                   ADD       XDSTP         YY
      * Put day of week into the range 1-7
     C     YY            IFEQ      0
     C                   Z-ADD     7             YY
     C                   ELSE
     C     YY            IFEQ      8
     C                   Z-ADD     1             YY
     C                   ELSE
     C     YY            IFEQ      -1
     C                   Z-ADD     6             YY
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C     YDOW(YY)      IFEQ      XDSEL
      * Selected day of the last week has been processed
     C                   SUB       XDSTP         XDLSW
     C                   ENDIF
      * End of loop
     C                   ENDDO
     C     XDADYM        TAG
     C     XDINDD        IFLT      1
     C                   Z-ADD     1             XDINDD
     C                   MOVEL     'Y2U0006'     W0RTN             7
     C                   ENDIF
      *================================================================
     CSR   XDADYE        ENDSR
      /EJECT
     CSR   XDCK2         BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
     C                   Z-ADD     *ZERO         XDINDT
      * If external date is zero, do not check
     C     XDEXDT        CABEQ     *ZERO         XDCK2E
      *................................................................
      * Map external to internal according to date format
     C     XDDTFM        IFEQ      'DMY'
     C                   Z-ADD     XDEX02        XDINDD                         DD
     C                   Z-ADD     XDEX03        XDINMM                         MM
     C                   Z-ADD     XDEX04        XDINYY                         YY
     C                   ELSE
     C     XDDTFM        IFEQ      'MDY'
     C                   Z-ADD     XDEX02        XDINMM                         MM
     C                   Z-ADD     XDEX03        XDINDD                         DD
     C                   Z-ADD     XDEX04        XDINYY                         YY
     C                   ELSE
      * YMD format
     C                   Z-ADD     XDEX02        XDINYY                         YY
     C                   Z-ADD     XDEX03        XDINMM                         MM
     C                   Z-ADD     XDEX04        XDINDD                         DD
     C                   END
     C                   END
      * If YY prior to the 'cut-off' year treat as 20YY.
     C     XDINYY        IFLT      XOFFYY
     C                   ADD       100           XDINYY
     C                   END
     C     YPMTFD        CABNE     *BLANK        XDCK2E
      *................................................................
      * Check months in range 1 to 12
     C     XDINMM        CABLT     1             XDCK2M
     C     XDINMM        CABGT     12            XDCK2M
      *................................................................
      * Check days in range 1 to maximum for month
     C     XDINDD        CABLT     1             XDCK2M
     C     XDINDD        CABGT     @XD(XDINMM)   XDCK2M
      *................................................................
      * Special case: leap year
     C     XDINMM        IFEQ      2
     C     XDINYY        IFNE      *ZERO
     C     XDINYY        ANDNE     200
     C     XDINYY        DIV       4             XDWK1             8 0
     C                   MVR                     XDWK1
     C                   ELSE
     C                   Z-ADD     1             XDWK1
     C                   END
      * Year is not leap
     C     XDWK1         IFNE      *ZERO
     C     XDINDD        CABGT     28            XDCK2M
     C                   END
     C                   END
     C                   GOTO      XDCK2E
      *................................................................
      * Send error message
     C     XDCK2M        TAG
      * Send message '*Invalid date'
     C                   MOVEL     'Y2U0006'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   MOVEL     'Y2U0006'     W0RTN
      * Disable time portion if timestamp is validated
     C                   Z-ADD     *ZERO         XTTIM
      *================================================================
     CSR   XDCK2E        ENDSR
      /EJECT
     CSR   XDOWS         BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                   MOVEA     XDCDW         YDOW
     C                   Z-ADD     0             XDWSL             1 0
     C                   Z-ADD     1             YY
     C     YY            DOWLE     7
     C     YDOW(YY)      IFEQ      XDSEL
     C                   ADD       1             XDWSL
     C                   END
     C                   ADD       1             YY
     C                   END
      *================================================================
     CSR   XDOWSE        ENDSR
      /EJECT
     CSR   XDUDY         BEGSR
      *================================================================
      * Calculate duration, *DAYS
      *================================================================
     C     XDAY1         IFLT      1
     C     XDAY2         ORLT      1
     C                   Z-ADD     0             XDURR
     C                   MOVEL     'Y2U0006'     W0RTN             7
     C                   GOTO      XDUDYE
     C                   END
     C     XDAY1         IFGE      XDAY2
      * From date2 to date1
     C                   Z-ADD     XDAY2         XABEG             6 0
     C                   Z-ADD     XDAY1         XAEND             6 0
     C                   ELSE
      * From date1 to date2
     C                   Z-ADD     XDAY1         XABEG             6 0
     C                   Z-ADD     XDAY2         XAEND             6 0
     C                   END
     C     XDWSL         IFEQ      0
      * None days of week selected
     C                   Z-ADD     0             XDURR
     C                   GOTO      XDUDYC
     C                   END
     C     XAEND         SUB       XABEG         XDURR             8 0
     C     XDWSL         IFEQ      7
      * All days of week selected
     C                   GOTO      XDUDYC
     C                   END
      * Some days of week selected
     C                   DIV       7             XDURR
     C                   MVR                     XDLSW             1 0
     C                   MULT      XDWSL         XDURR
     C     XDLSW         IFNE      0
      * Determine day of week of the beginning date
     C     XABEG         ADD       3             YY                6 0
     C                   DIV       7             YY
     C                   MVR                     YY
      * Loop: Increment the date by the last week
     C     XDLSW         DOWGT     0
      * Increment the day of week
     C                   ADD       1             YY
     C                   SUB       1             XDLSW
      * Put day of week into the range 1-7
     C     YY            IFEQ      8
     C                   Z-ADD     1             YY
     C                   END
      * Selected day of the last week has been processed
     C     YDOW(YY)      IFEQ      XDSEL
      * Increment duration
     C                   ADD       1             XDURR
     C                   END
      * End of loop
     C                   END
     C                   END
     C     XDUDYC        TAG
     C     XDURR         IFEQ      0
      * Return Code: Unable to calculate duration
     C                   MOVEL     'Y2U0060'     W0RTN             7
     C                   ELSE
     C                   MOVEL     *BLANK        W0RTN             7
     C                   END
      *================================================================
     CSR   XDUDYE        ENDSR
      /EJECT
     CSR   XDVC2T        BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                   Z-ADD     0             XDEX01                         CC
     C     XDDTFM        IFEQ      'DMY'
     C                   Z-ADD     XDINDD        XDEX02                         DD
     C                   Z-ADD     XDINMM        XDEX03                         MM
     C                   Z-ADD     XDINYY        XDEX04                         YY
     C                   ELSE
     C     XDDTFM        IFEQ      'MDY'
     C                   Z-ADD     XDINMM        XDEX02                         MM
     C                   Z-ADD     XDINDD        XDEX03                         DD
     C                   Z-ADD     XDINYY        XDEX04                         YY
     C                   ELSE
      * YMD format
     C                   Z-ADD     XDINYY        XDEX02                         YY
     C                   Z-ADD     XDINMM        XDEX03                         MM
     C                   Z-ADD     XDINDD        XDEX04                         DD
     C                   END
     C                   END
      *================================================================
     CSR   XDVC2E        ENDSR
      /EJECT
     CSR   Y0SET         BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR   Y0EXIT        ENDSR
      /EJECT
     CSR   Y8TST         BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                   Z-ADD     @#RWCL        ZINPOS            5 0
     C     ZINPOS        DIV       256           W0CRW
     C                   MVR                     W0CCL
      *================================================================
     CSR   Y8EXIT        ENDSR
      /EJECT
     CSR   Y9CLR         BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR   Y9EXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C     ZAPGMQ        IFEQ      *BLANK
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
      * If no message file specified, use default
     C     ZAMSGF        IFEQ      *BLANK
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ           10            Program queue
     C                   PARM                    ZAPGRL            5            Rel queue
     C                   PARM                    ZAMSID            7            Message ID
     C                   PARM                    ZAMSGF           10            Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP            7            Message type
      * Clear all fields for default mechanism next time
     C                   MOVEL     *BLANK        ZAPGMQ
     C                   MOVEL     *BLANK        ZAPGRL
     C                   MOVEL     *BLANK        ZAMSID
     C                   MOVEL     *BLANK        ZAMSGF
     C                   MOVEL     *BLANK        ZAMSDA
     C                   MOVEL     *BLANK        ZAMSTP
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZDVPMT        BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                   MOVEL     *BLANK        YPMTFD           10
     C                   Z-ADD     *ZERO         YAFSCH            4 0
     C                   Z-ADD     *ZERO         YPMRRN            4 0
      *
     C     *IN04         IFEQ      '1'
      *
      * Extract cursor row and column
     C     @#RWCL        DIV       256           ZHCSRW            5 0
     C                   MVR                     ZHCSCL            5 0
      *
      * Save cursor position for redisplay
     C                   Z-ADD     ZHCSRW        ZZCSRW            3 0          Row
     C                   Z-ADD     ZHCSCL        ZZCSCL            3 0          Column
      *
     C     ZHCSRW        IFEQ      004
     C     ZHCSCL        ANDGE     016
     C     ZHCSCL        ANDLE     018
     C     @#DFMT        ANDEQ     '#RCDDTL1'
     C                   MOVEL     '#1AIC3'      YPMTFD                         Company Number
     C                   END
      *
     C     ZHCSRW        IFEQ      015
     C     ZHCSCL        ANDEQ     021
     C     @#DFMT        ANDEQ     '#RCDDTL1'
     C                   MOVEL     '#DQ1ST'      YPMTFD                         Status Flag 1
     C                   END
      *
     C     ZHCSRW        IFEQ      015
     C     ZHCSCL        ANDEQ     037
     C     @#DFMT        ANDEQ     '#RCDDTL1'
     C                   MOVEL     '#DQ2ST'      YPMTFD                         Status Flag 2
     C                   END
      *
     C     ZHCSRW        IFEQ      016
     C     ZHCSCL        ANDEQ     021
     C     @#DFMT        ANDEQ     '#RCDDTL1'
     C                   MOVEL     '#DQ3ST'      YPMTFD                         Status Flag 3
     C                   END
      *
     C     ZHCSRW        IFEQ      016
     C     ZHCSCL        ANDEQ     037
     C     @#DFMT        ANDEQ     '#RCDDTL1'
     C                   MOVEL     '#DFMST'      YPMTFD                         Status Flag 4
     C                   END
      *
     C     YPMTFD        IFEQ      *BLANK
      * Error if user defined prompting is not specified.
     C     W0PMT         IFEQ      'N'
     C                   MOVEL     '*NONE'       YPMTFD
     C                   MOVEL     'Y'           W0HLP             1
     C                   MOVEL     'Y'           ZAFSMS
      * Send error message.
     C                   MOVEL     'Y2U0101'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   END
     C                   END
      *
     C                   END
      *================================================================
     CSR   ZDEXIT        ENDSR
      /EJECT
     CSR   ZHHPKY        BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                   MOVEL     'Y'           W0HLP             1
      *
      * Extract cursor row and column
     C     @#RWCL        DIV       256           ZHCSRW            5 0          Row
     C                   MVR                     ZHCSCL            5 0          Column
      *
      * Save cursor position for redisplay
     C                   Z-ADD     ZHCSRW        ZZCSRW            3 0          Row
     C                   Z-ADD     ZHCSCL        ZZCSCL            3 0          Column
      *
      *
     C                   CALL      'YDDSHPR'
     C                   PARM      ##PGM         W0HPMB           10            Help text sourc
     C                   PARM      *BLANK        YYHPFL           10            Help text file
     C                   PARM      *BLANK        YYHPLB           10            Help text libra
     C                   PARM                    W0RTN             7
     C                   PARM      '*START'      YYHLVN           10            Help label
     C                   PARM      '*NORMAL'     YYUSOP           10            Options
     C                   PARM      ZHCSRW        YYRW              5 0          Row
     C                   PARM      ZHCSCL        YYCL              5 0          Column
     C                   PARM      *ZERO         YYLGCT            5 0          # of grps
     C                   PARM      *BLANK        YYLGVN           10            Label grps
      *
      * Clear set cursor DDS indicator
     C  N94              MOVEL     'OFF'         WCSRLC
     C  N94              SETON                                        94        *
      *================================================================
     CSR   ZHEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                   MOVEL     *BLANK        P0RTN
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C     W0ICL         IFEQ      *BLANK
     C                   MOVEL     'Y'           W0ICL             1            *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   MOVE      *BLANK        P0RTN
     C                   MOVE      *BLANK        W0RTN             7
     C                   MOVEL     *BLANK        W0RSL             1
     C                   MOVEL     *BLANK        W0RSF             1
     C                   MOVEL     *ZEROS        W0RTW             9 0
     C                   MOVEL     '400'         W0ENV             3
      * Clear all neither parameters
     C                   MOVEL     *BLANK        P1EEST                         USR Program mod
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME             6 0
      * Define work field USR First Position
     C                   MOVEL     *BLANK        WUI3ST            1
      * Define work field CD3 Ext Numeric Key
     C                   MOVEL     *BLANK        WUDMCD            3
      * Obtain default message file
     C     *DTAARA       DEFINE    CAMGFLA       ZADFMF           10
     C                   IN        ZADFMF
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WAAATM                         Job Time
     C                   Z-ADD     *ZERO         WAAXDT                         Job Date
      * Define work field USR Accounting Year Alpha
     C                   MOVEL     *BLANK        WUN8CD            4
      * Define work field USR Year Alpha
     C                   MOVEL     *BLANK        WUVRCD            2
      * Define work field USR Job Year
     C                   Z-ADD     *ZERO         WUJBYR            2 0
      * Define work field USR From Date Numeric
     C                   Z-ADD     *ZERO         WUEQNB            7 0
      * Define work field USR Date Alpha
     C                   MOVEL     *BLANK        WUKBTX            6
      * Define work field Day of Week (SYN) USR
     C                   Z-ADD     *ZERO         WU                1 0
      * Define work field USR Year
     C                   Z-ADD     *ZERO         WUB0NB            4 0
      * Define work field @Year Code
     C                   Z-ADD     *ZERO         WUPSNB            4 0
      * Define work field Description
     C                   MOVEL     *BLANK        WUAUNA           30
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCAATM                         Job Time
     C                   Z-ADD     *ZERO         WCAXDT                         Job Date
      * Define work field USR Description 40
     C                   MOVEL     *BLANK        WUDSC4           40
      * Define work field USR Description 40   2
     C                   MOVEL     *BLANK        WUDE40           40
      * Flag no *SET CURSOR in the program
     C                   MOVE      'N'           YSETCS            1
     C                   MOVE      *BLANK        WCSRLC            3
      * Define *Synon program work fields
     C                   Z-ADD     *ZEROS        YRSW00            5 0          *Synon (5,0) wo
     C                   Z-ADD     *ZEROS        YRSW01            5 0          *Synon (5,0) wo
     C                   MOVEL     *BLANKS       W0CFL            10            *Cursor field
     C                   Z-ADD     *ZEROS        W0CRW             5 0          *Cursor row
     C                   Z-ADD     *ZEROS        W0CCL             5 0          *Cursor column
      * Move main file information to JOB context
     C                   MOVE      @1FFL         ZZFFL            10            Main file name
     C                   MOVE      @1FLB         ZZFLB            10            Main file lib
     C                   MOVE      @1FMB         ZZFMB            10            Main file mbr
     C                   MOVE      ZZFFL         @1FFL            10
     C                   MOVE      ZZFLB         @1FLB            10
     C                   MOVE      ZZFMB         @1FMB            10
     C                   CALL      'Y2QLVNR'
     C                   PARM                    ZZFFL            10
     C                   PARM                    ZZFLB            10
     C                   PARM                    ZZFQL            21            LIBRARY/FILE
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     'N'           W0PMT             1
      * Define local variables for subroutine SARVGN.
     C                   Z-ADD     *ZERO         WL0001            3 0
     C                   MOVEL     *BLANK        WL0002           30
      * Define local variables for subroutine SBRVGN.
     C                   Z-ADD     *ZERO         WL0003            3 0
     C                   Z-ADD     *ZERO         WL0004            7 0
      * Obtain system date format
     C     *DTAARA       DEFINE    Y2DTFMA       XDDTFM            3
     C                   IN        XDDTFM
      * Retrieve the 'cut-off' year YY: 19YY-1999,2000-20(YY-1).
     C     *DTAARA       DEFINE    Y2CTOFF       XOFF
     C                   IN        XOFF
      * *DTAARA = *COMPANY N
     C     *DTAARA       DEFINE    YYCOTXA       ##CMP
     C                   IN        *DTAARA
      *................................................................
     C                   MOVEL     *BLANK        W0GRP             1
      * USER: Initialize program
      * VAL Rtv and Center Hdg IF
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                   EXSR      SCRVGN
     C                   MOVEL     *BLANK        WUDSC4                         USR Description
     C                   MOVEL     WUAUNA        WUDSC4                         USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                   MOVEA     WUDSC4        UCT                            LOAD ARRAY
     C                   Z-ADD     40            UX                2 0          SET COUNTER
     C     UX            DOWGT     0
     C     UCT(UX)       IFEQ      ' '
     C                   SUB       1             UX
     C                   ELSE
     C                   Z-ADD     UX            UXH               2 0
     C                   Z-ADD     0             UX
     C                   END
     C                   END
     C     40            SUB       UXH           UX
     C     UX            DIV       2             UX
     C     UX            IFGT      0
     C                   MOVE      *BLANKS       UCT
     C                   MOVEA     WUDSC4        UCT(UX)
     C                   END
     C                   MOVEA     UCT           WUDE40                         LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                   MOVE      WUDE40        ##CMP            40
     C                   MOVEL     '1'           P1EEST                         USR Program mod
      * Load screen
     C                   EXSR      MALDSC
      *================================================================
     CSR   ZZEXIT        ENDSR
** @XD
312931303130313130313031
** @CN
00001 USR0752
