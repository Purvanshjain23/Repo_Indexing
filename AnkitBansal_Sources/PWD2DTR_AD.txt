// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWD2DTR
// ?Date: 14.08.2025 Time: 02:56:08
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modifications and Comments
DO;

//?E68243 JBB 09/01/20 - Remove Edit option from this screen
//?- Revise condition commented out.  User can only display Tattoos
//?E11288 JJH 08/01/17 - Tattoo Header Modifications
//?- Change Option 2=Edit to call
//?E11288 JJH 07/25/17 - Tattoo Header Modifications
//?- New function to alllow 961 to Edit Unpaid Tattoo
//?- Copied from WW Tattoo DT (PLS3DTR)
ENDDO;

//?E00144 LFT Left on Truck and EUT/KOA - redesign screen
DO;

//?6/11/2008 slm
//?New fields from the buy order load and from the tattoo header
ENDDO;

EXECUTE FUNCTION(C2140 Trn TTo Dbl Inv) TYPE(EXCINTFUN)                         AB1188593;
{
 //?Execute internal function

 //?12/23/96   SLM     Transfer of one tattoo to another the
 //?                   tattoo detail was doubling up
 //?                   Establish proceudre of how this will be done
 //?                   for the scale people.
 //?                   The orginal tattoo scale ticket must be printed
 //?                   before this transfer can be completed.
 //?                   Do not allow transfer to be selected if
 //?                   any weightments have not been printed.
 //?                   Give user message and not select the transfer
 //?                   Also on the create of the scale weight record
 //?                   create a record but the active status flag stays
 //?                   as was on the orginal record
}


EXECUTE FUNCTION(C2156 DOA HELD OVERS) TYPE(EXCINTFUN)                          AB1188624;
{
 //?Execute internal function

 //?12/24/96   SLM     User was report of Doa after scale tickets
 //?                   were done.  The tattoo was sent to kill and they
 //?                   missed reporting doas.  So if the user had the
 //?                   scaling pgm up for this tattoo before the sent
 //?                   was completed then when the scaleing exits the
 //?                   scale ticket file is recounted which puts the
 //?                   held overs back on the org day.  Tattoo scale
 //?                   tickets are not moved for held overs.
 //?                   Validate if there is one tattoo detail for this
 //?                   tattoo that has been driven then do not allow
 //?                   user to change the tattoo scale file.
 //?                   Also if error go to display pgm
 //?                   Only if no error, and all open tattoo detail
 //?                   will the edits be allowed.
}


EXECUTE FUNCTION(HPE076) TYPE(EXCINTFUN)                                        AB1188851;
{
 //?Execute internal function

 //?C1108 -- Duplicate Tattoo Problem
 //?  PKLYDTR -- WW Tattoo
 //?  PKL0E1R -- Edt TTt Hdr
 //?  PKO6PVR-- Edt Ttt Hdr (PV)
}


// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


// Call program Rtv User Code Model   XF.
CALL PROGRAM(Rtv User Code Model   XF) ('POYBXFR');
PARAMETER(JOB.*USER);
PARAMETER(LCL.User_Code_Model_USR);

//?E2423 Mtech Live or Not Live *** Interfaces to HPS ***
//?Made some updates during the e2423 as such
//?option 10 = no need for either plant at this time
//?             remove from the option line and * out
//?             the code
//?option 11 = will be used by TF, but just a note here
//?             nothing was done with this (leave as is)
//?option 12 = no need for either plant at this time
//?             remove from the option line and * out
//?             the code
//?Get the MTech Live Yes or No
DO;

//?Mtech Live Yes or no
// Call program Rtv Company Values    XF.
CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
PARAMETER(PAR.BOH_Company_Number);
PARAMETER('MTECHLIVE');
PARAMETER(WRK.System_Value_Alpha_USR);

// LCL.MTech Live Yes or No = WRK.System Value Alpha    USR
LCL.MTech_Live_Yes_or_No = WRK.System_Value_Alpha_USR;

// WRK.MTech Live Yes or No = WRK.System Value Alpha    USR
WRK.MTech_Live_Yes_or_No = WRK.System_Value_Alpha_USR;

ENDDO;

//?H16853 ISE 11/02/2020 CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
//?USER: Validate header fields

CASE;

// IF WRK.First Time Flag Usr EQ WRK.Blank USR
IF WRK.First_Time_Flag_Usr = WRK.Blank_USR;

// CTL.BOH Company Number = PAR.BOH Company Number
CTL.BOH_Company_Number = PAR.BOH_Company_Number;

// WRK.Display Print Prompt  Usr = CND.Prompt is to be displayed
WRK.Display_Print_Prompt_Usr = 'Y';

// WRK.First Time Flag Usr = CND.Yes
WRK.First_Time_Flag_Usr = 'Y';

// CTL.RS Record Status = CND.Active
CTL.RS_Record_Status = 'A';

ENDIF;

EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: Initialize subfile record

// RCD.No Scale Record Prted Us = CND.Yes
RCD.No_Scale_Record_Prted_Us = 'Y';

// RCD.Group Reference Code  USR = RCD.TH Tattoo Reference
RCD.Group_Reference_Code_USR = RCD.TH_Group_Reference;

// RCD.Site Text Name Usr = CON.*BLANK
RCD.Site_Text_Name_Usr = *BLANK;

// RCD.Site Text Usr = CON.*BLANK
RCD.Site_Text_Usr = *BLANK;

CASE;

// IF RCD.TH Source Type is Internal
IF RCD.TH_Source_Type = 'I';

// RCD.Site Text Name Usr = CON.FarmSite
RCD.Site_Text_Name_Usr = 'FarmSite';

// LCL.Farm Site Alpha       USR = CVTVAR(RCD.TH HPS Farm Site)
LCL.Farm_Site_Alpha_USR = CVTVAR(RCD.TH_HPS_Farm_Site);

// RCD.Site Text Usr = LCL.Farm Site Alpha       USR
RCD.Site_Text_Usr = LCL.Farm_Site_Alpha_USR;

// IF RCD.TH Source Type is External
IF RCD.TH_Source_Type = 'E';

EXECUTE FUNCTION(Rtv Site ID            RT) TYPE(RTVOBJ) FILE(PKDNCPP)          AB1268433;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(LCL.PS_Site_ID);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF LCL.PS Site ID is Not Blank
IF LCL.PS_Site_ID <> *BLANK;

// RCD.Site Text Name Usr = CON.Prd Site
RCD.Site_Text_Name_Usr = 'Prd Site';

// RCD.Site Text Usr = CVTVAR(LCL.PS Site ID)
RCD.Site_Text_Usr = CVTVAR(LCL.PS_Site_ID);

ENDIF;

ENDIF;

//?Will only need if Internal and Live with MTech
// RCD.TM Tattoo MTech Reference = CON.*BLANK
RCD.TM_Tattoo_MTech_Reference = *BLANK;

CASE;

// IF RCD.TH Source Type is Internal
IF RCD.TH_Source_Type = 'I';

// AND LCL.MTech Live Yes or No is No MTech not Live
AND LCL.MTech_Live_Yes_or_No = 'N';

//?* 01/27/03 PKD PK0495 Replaced HP255 with HP249.
// Call program Z1v HPS Farm Info     UP.
CALL PROGRAM(Z1v HPS Farm Info     UP) ('HP249');
PARAMETER(WRK.*Return_code);
PARAMETER(RCD.TH_HPS_Movement_Ref_#);
PARAMETER(WRK.Farm_site_Name_f_HPS_USR);
PARAMETER(WRK.Farm_Site_USR);
PARAMETER(RCD.HPS_FS_Comp_Relation_USR);
PARAMETER(WRK.State);

// IF RCD.TH Source Type is Internal
IF RCD.TH_Source_Type = 'I';

// AND LCL.MTech Live Yes or No is Yes MTech is Live
AND LCL.MTech_Live_Yes_or_No = 'Y';

//?NOT needed
// RCD.HPS FS Comp Relation USR = CON.*BLANK
RCD.HPS_FS_Comp_Relation_USR = *BLANK;

//?Will only need if Internal and Live with MTech
//?But regardless if found then display due to when
//?we go live with mtech the pass history would need to show
// RCD.TM Tattoo MTech Reference = CON.*BLANK
RCD.TM_Tattoo_MTech_Reference = *BLANK;

EXECUTE FUNCTION(Rtv Tattoo/MTech ReferRT) TYPE(RTVOBJ) FILE(PLBQCPP)           AB1318390;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER(RCD.TM_Tattoo_MTech_Reference);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


ENDIF;

// WRK.@Record Found = CND.Record Not Found
WRK.@Record_Found = 'N';

// WRK.Found Act Scl Rec Sts Usr = CND.Blank
WRK.Found_Act_Scl_Rec_Sts_Usr = *BLANK;

EXECUTE FUNCTION(Rtv Scl Tkt Val Edt   RT) TYPE(RTVOBJ) FILE(PKB3CPP)           AB1157790;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER(WRK.@Record_Found);
PARAMETER(WRK.Found_Act_Scl_Rec_Sts_Usr);
{
 //?USER: Processing if Data record not found

 // PAR.@Record Found = CND.Record Not Found
 PAR.@Record_Found = 'N';

 //?USER: Process Data record

 // PAR.@Record Found = CND.Record Found
 PAR.@Record_Found = 'Y';

 CASE;

 // IF DB1.RS Record Status is Active
 IF DB1.RS_Record_Status = 'A';

 // PAR.Found Act Scl Rec Sts Usr = CND.Yes
 PAR.Found_Act_Scl_Rec_Sts_Usr = 'Y';

 ENDIF;

}


EXECUTE FUNCTION(Rtv Employee Id       RT) TYPE(RTVOBJ) FILE(PKFJCPP)           AB1255709;
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.Employee_ID);
PARAMETER(RCD.Employee_Number_2_Employe);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


//?Save to use if ADD is selected
CASE;

// IF LCL.TH Group Reference EQ WRK.Blank Usr 1 fld Usr
IF LCL.TH_Group_Reference = WRK.Blank_Usr_1_fld_Usr;

// LCL.TH HPS Movement Ref # = RCD.TH HPS Movement Ref #
LCL.TH_HPS_Movement_Ref_# = RCD.TH_HPS_Movement_Ref_#;

// LCL.TH Group Reference = RCD.TH Group Reference
LCL.TH_Group_Reference = RCD.TH_Group_Reference;

// LCL.GN Genetic Code = RCD.GN Genetic Code
LCL.GN_Genetic_Code = RCD.GN_Genetic_Code;

ENDIF;

// RCD.LFT usr = RCD.TH Head LFT
RCD.LFT_usr = RCD.TH_Head_LFT;

// RCD.EUT/KOA Hogs usr = RCD.TH Head EUT/KOA
RCD.EUT_KOA_Hogs_usr = RCD.TH_Head_EUT_KOA;

//?USER: Validate subfile record relations

//?E11288 JJH 07/25/17 - Only allow options 2=Edit and 5=Display
//?Options
CASE;

//?Options
//?Options
//?Options
// IF RCD.*SFLSEL is *Option 5 request
IF RCD.*SFLSEL = '5'/'5';

// Call program Dsp Tattoo Hdr/Defect DR.
CALL PROGRAM(Dsp Tattoo Hdr/Defect DR) ('PWD0D1R');
PARAMETER(RCD.BOH_Company_Number);
PARAMETER(RCD.BOH_Buy_Order_Number);
PARAMETER(RCD.BOL_Load_Number);
PARAMETER(RCD.TH_Tattoo_Number);
PARAMETER(RCD.TH_Kill_Date);
PARAMETER(RCD.TH_Group_Reference);
PARAMETER(RCD.TH_Sex);
PARAMETER(RCD.TH_HPS_Movement_Ref_#);
PARAMETER(RCD.TH_Hog_Class_Type);
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.PL_Location_Code);
PARAMETER(RCD.GN_Genetic_Code);
PARAMETER(CTL.Oms_System_Value_Alpha);
PARAMETER(CTL.Name_USR);
PARAMETER(CTL.BOL_Pln_Delv_Date);
PARAMETER(LCL.Record_Added_Usr);
PARAMETER(CTL.PD_Name);
PARAMETER(CTL.PL_Name);
PARAMETER(WRK.User_modified_0_not_modi);
PARAMETER(*BLANK);
PARAMETER(PAR.SBD_Top_Load_Sts);

//?Options
//?Options
//?Options
//?Options
//?Options
//?Options
//?Options
// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?CALC: Subfile record function fields

CTL.Head_Total_SUM = SUM(RCD.TH_Head_Received);

CTL.Weight_SUM = SUM(RCD.TH_Live_Wgt);

//?USER: Process command keys

//?New - RMC 1/18/05 dont allow create for jancie/mel (porkproc4)
CASE;

// IF CTL.*CMD key is *Create
IF CTL.*CMD_key = '06';

// OR CTL.*CMD key is CF08
OR CTL.*CMD_key = '08';

// OR CTL.*CMD key is CF09
OR CTL.*CMD_key = '09';

CASE;

// IF LCL.User Code Model USR is Procurement 4
IF LCL.User_Code_Model_USR = 'PORKPROC4';

// Send error message - 'Option not allowed for user &1'
ERROR(PRK1126);
MSGPARM(JOB.*USER);

QUIT;

ENDIF;

ENDIF;

CASE;

// IF CTL.*CMD key is Refresh
IF CTL.*CMD_key = '05';

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// IF CTL.*CMD key is Create
IF CTL.*CMD_key = '06';

EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF CTL.PD Producer Code is SEABOA
IF CTL.PD_Producer_Code = 'SEABOA';

// LCL.GN Genetic Code = CND.PIC
LCL.GN_Genetic_Code = 'PIC';

ENDIF;

// Call program Edt Ttt Hdr (create)  PV.
CALL PROGRAM(Edt Ttt Hdr (create)  PV) ('PKO6PVR');
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(*ZERO);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(LCL.TH_Group_Reference);
PARAMETER('X');
PARAMETER(LCL.TH_HPS_Movement_Ref_#);
PARAMETER('M');
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(LCL.GN_Genetic_Code);
PARAMETER(CTL.Oms_System_Value_Alpha);
PARAMETER(CTL.Name_USR);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(CTL.PD_Name);
PARAMETER(CTL.PL_Name);
PARAMETER('N');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// IF CTL.*CMD key is CF08
IF CTL.*CMD_key = '08';

EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF CTL.PD Producer Code is SEABOA
IF CTL.PD_Producer_Code = 'SEABOA';

// LCL.GN Genetic Code = CND.PIC
LCL.GN_Genetic_Code = 'PIC';

ENDIF;

// Call program Edt Ttt Hdr (create)  PV.
CALL PROGRAM(Edt Ttt Hdr (create)  PV) ('PKO6PVR');
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(*ZERO);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(LCL.TH_Group_Reference);
PARAMETER('X');
PARAMETER(LCL.TH_HPS_Movement_Ref_#);
PARAMETER('M');
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(LCL.GN_Genetic_Code);
PARAMETER(CTL.Oms_System_Value_Alpha);
PARAMETER(CTL.Name_USR);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(CTL.PD_Name);
PARAMETER(CTL.PL_Name);
PARAMETER('Y');

// CTL.BOL Head Received = CTL.Head Total SUM
CTL.BOL_Head_Received = CTL.Head_Total_SUM;

// CTL.BOL Live Wgt Received = CTL.Weight SUM
CTL.BOL_Live_Wgt_Received = CTL.Weight_SUM;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// IF CTL.*CMD key is CF09
IF CTL.*CMD_key = '09';

EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PD_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(CTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF CTL.PD Producer Code is SEABOA
IF CTL.PD_Producer_Code = 'SEABOA';

// LCL.GN Genetic Code = CND.PIC
LCL.GN_Genetic_Code = 'PIC';

ENDIF;

// Call program Edt Ttt Hdr (create)  PV.
CALL PROGRAM(Edt Ttt Hdr (create)  PV) ('PKO6PVR');
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(*ZERO);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(LCL.TH_Group_Reference);
PARAMETER('X');
PARAMETER(LCL.TH_HPS_Movement_Ref_#);
PARAMETER('R');
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.PL_Location_Code);
PARAMETER(LCL.GN_Genetic_Code);
PARAMETER(CTL.Oms_System_Value_Alpha);
PARAMETER(CTL.Name_USR);
PARAMETER(CTL.BOL_Kill_Date);
PARAMETER(CTL.PD_Name);
PARAMETER(CTL.PL_Name);
PARAMETER('N');

// CTL.BOL Head Received = CTL.Head Total SUM
CTL.BOL_Head_Received = CTL.Head_Total_SUM;

// CTL.BOL Live Wgt Received = CTL.Weight SUM
CTL.BOL_Live_Wgt_Received = CTL.Weight_SUM;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

CASE;

// IF CTL.*CMD key is CF14
IF CTL.*CMD_key = '14';

// Call program Edt Buy Order Load    E1.
CALL PROGRAM(Edt Buy Order Load    E1) ('PKLZE1R');
PARAMETER(CTL.BOH_Company_Number);
PARAMETER(CTL.BOH_Buy_Order_Number);
PARAMETER(CTL.BOL_Load_Number);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(CTL.Name_USR);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

// PGM.*Continue transaction = CND.*NO
PGM.*Continue_transaction = 'N';

QUIT;

