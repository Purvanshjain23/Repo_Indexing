/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR PERFORMANCE REPORT */
/*             CO, WEEK ENDING DATE, YEAR, QUARTER, CARRIER, CUST,  */
/*             LOAD TYPE, LOAD NUMBER                               */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT PERFORMANCE REPORT                            */
/*  DATE      - 06/04/97                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &CUSTN      - SHIP TO CUSTOMER                          */
/*          &WEDDATN    - WEEK ENDING DATE                          */
/*          &FRMDATN    - FROM SHIP DATE                            */
/*          &THRDATN    - THROUGH SHIP DATE                         */
/*          &LOADN      - LOAD NUMBER                               */
/*          &CARRIER    - CARRIER CODE                              */
/*          &LOADT      - LOAD TYPE                                 */
/*          &YEARN      - YEAR                                      */
/*          &QUARTER    - QUARTER E                                 */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/********************************************************************/
/*  RMC 5/14/04 PKTR01 MAKE COMPANY OPTIONAL ON QRYSLT              */
/********************************************************************/

 PDUAPCLP:   PGM        PARM(&COMPNYN &CUSTN &WEDDATN &FRMDATN +
                          &THRDATN &LOADN &CARRIER &LOADT &YEARN +
                          &QUARTER &OUTQ &HOLD &SAVE &COPYN &NIGHTQ +
                          &REPORT &UOM)
/* PARMS                                                                      */
        DCL    &COMPNYN    *DEC                  /* Company Number (Passed)   */
        DCL    &CUSTN      *DEC                  /* CUSTOMER       (Passed)   */
        DCL    &WEDDATN    *DEC                  /* WEEK ENDING DTE(Passed)   */
        DCL    &FRMDATN    *DEC                  /* FROM SHIP DATE (Passed)   */
        DCL    &THRDATN    *DEC                  /* THRU SHIP DATE (PASSED)   */
        DCL    &LOADN      *DEC                  /* LOAD NUMBER    (PASSED)   */
        DCL    &CARRIER    *CHAR   (3)           /* CARRIER CODE              */
        DCL    &LOADT      *CHAR   (1)           /* LOAD TYPE                 */
        DCL    &YEARN      *DEC                  /* YEAR           (PASSED)   */
        DCL    &QUARTER    *CHAR   (1)           /* QUARTER                   */
        DCL    &REPORT     *CHAR   (1)           /* REPORT                    */
        DCL    &UOM        *CHAR   (2)           /* UNIT OF MEASURE           */
        DCL    &DESC       *CHAR   (25)          /* DESCRIPTION               */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &NIGHTQ     *CHAR   (10)          /* Night Job Queue           */
        DCL    &COMMAND    *CHAR   (512)

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMPANY    *DEC    (3 0)         /* Company Number            */
        DCL    &CUST       *DEC    (7 0)         /* CUSTOMER                  */
        DCL    &WEDDATE    *DEC    (7 0)         /* WEEK ENDING DATE          */
        DCL    &FRMDAT     *DEC    (7 0)         /* FROM SHIP DATE            */
        DCL    &THRDAT     *DEC    (7 0)         /* THRU SHIP DATE            */
        DCL    &YEAR       *DEC    (5 0)         /* YEAR                      */
        DCL    &LOAD       *DEC    (7 0)         /* LOAD NUMBER               */

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* COMPANY                   */
        DCL    &CUSTA      *CHAR    3            /* CUSTOMER                  */
        DCL    &FRMDATA    *CHAR    7            /* FROM SHIP DATE (Passed)   */
        DCL    &THRDATA    *CHAR    7            /* THRU SHIP DATE (Passed)   */
        DCL    &YEARA      *CHAR    5            /* YEAR           (Passed)   */
        DCL    &LOADA      *CHAR    7            /* LOAD NUMBER    (Passed)   */

        DCL     &A        *CHAR   30              /* QRY COMPANY    */
        DCL     &B        *CHAR   50              /* QRY FROM DATE  */
        DCL     &C        *CHAR   50              /* QRY THRU DATE  */
        DCL     &D        *CHAR   50              /* QRY CARRIER    */
        DCL     &E        *CHAR   50              /* QRY LOAD TYPE  */
        DCL     &F        *CHAR   40              /* QRY LOAD NUMBER*/
        DCL     &G        *CHAR   45              /* QRY SHIP STATUS*/
        DCL     &Q        *CHAR  315              /* QRY ALL        */
/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/

             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&CUST) VALUE(&CUSTN)
             CHGVAR     VAR(&WEDDATE) VALUE(&WEDDATN)
             CHGVAR     VAR(&FRMDAT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FRMDATA) VALUE(&FRMDAT)
             CHGVAR     VAR(&THRDAT) VALUE(&THRDATN)
             CHGVAR     VAR(&THRDATA) VALUE(&THRDAT)
             CHGVAR     VAR(&YEAR) VALUE(&YEARN)
             CHGVAR     VAR(&LOAD) VALUE(&LOADN)
             CHGVAR     VAR(&LOADA) VALUE(&LOAD)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)
/********************************************************************/
/*  THIS IS THE CARRIER PERFORMANCE REPORT BY SCHEDULED SHIPPED     */
/*  DATE.                                                           */
/********************************************************************/
/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR INVOICING REPORTS         */
/*********************************************************************/
             IF COND(&REPORT *EQ '1') THEN(DO)
/* SELECT COMPANY                                                    */
             IF         COND(&COMPA *NE '000') THEN(DO)
             CHGVAR     VAR(&A) VALUE('FJAIC3 *EQ ' *CAT &COMPA *BCAT '*AND')
             ENDDO

/* SELECT FROM DATE                                                  */
             CHGVAR     VAR(&B) VALUE('((FJAODT *GE ' *CAT +
                         &FRMDATA *CAT ' *AND FJAODT *LE '    +
                         *CAT &THRDATA *CAT ')')

/* TO THRU DATE                                                      */
             CHGVAR     VAR(&C) VALUE('*OR (FJEIDT *GE ' *CAT +
                         &FRMDATA *CAT ' *AND FJEIDT *LE '   +
                         *CAT &THRDATA *CAT '))')
             ENDDO

/* SELECT CARRIER                                                    */
             IF COND(&CARRIER *NE ' ') THEN(DO)
             CHGVAR     VAR(&D) VALUE('*AND FJBZNA *EQ "' *CAT +
                         &CARRIER *CAT '"')
             ENDDO

/* SELECT LOAD TYPE                                                  */
/*           IF COND(&LOADT *NE ' ') THEN(DO)                        */
/*           CHGVAR     VAR(&E) VALUE('*AND FJVDST *EQ "' *CAT +     */
/*                       &LOADT *CAT '"')                            */
/*           ENDDO                                                   */

/* SELECT LOAD NUMBER                                                */
             IF COND(&LOADA *NE '0000000') THEN(DO)
             CHGVAR     VAR(&F) VALUE('*AND FJRMNB *EQ ' *CAT +
                         &LOADA)
             ENDDO

/* SELECT ONLY SHIPPED                                              */
/* * * * * * C3391:  REMOVE THIS FROM CL AND PUT IN PGM; SOME       */
/* * * * * *         UNSHIPPED LOADS WILL BE INCLUDED               */
/* * * * * * CHGVAR     VAR(&G) VALUE('*AND FJPKST *EQ %VALUES("I" +
                          "S")')                                    */

             CHGVAR     VAR(&Q) VALUE(&A *BCAT &B *BCAT &C *BCAT &D +
                                      *BCAT &E *BCAT &F)

/*  RUN QUERY TO READ LOAD HEADER BY DATE RANGE  */

             IF COND(&REPORT *EQ '1') THEN(DO)
             OVRDBF     FILE(OMFJCPL4) SHARE(*YES)
             OPNQRYF    FILE(OMFJCPL4) +
                        QRYSLT(&Q) +
                        KEYFLD(*FILE)
/*           MONMSG     MSGID(CPF9899)                              */

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDZSPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)


/*********************************************************************/
/*   CALL PRINT PROGRAM -
/*********************************************************************/

             CALL       PGM(PDZSPFR) PARM(' ' &LOAD &COMPANY &THRDAT +
                          &CARRIER &LOADT &FRMDAT &UOM &CUST +
                          &YEAR &QUARTER)

             CLOF       OPNID(OMFJCPL4)
             DLTOVR     FILE(OMFJCPL4)
             ENDDO

/********************************************************************/
/*  THIS IS THE CARRIER PERFORMANCE REPORT BY REQUESTED DELIVERY    */
/*  DATE.                                                           */
/********************************************************************/
             IF COND(&REPORT *EQ '2') THEN(DO)
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDXRPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE)

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/* SELECT COMPANY                                                    */
             IF         COND(&COMPA *NE '000') THEN(DO)
             CHGVAR     VAR(&A) VALUE('FJAIC3 *EQ ' *CAT &COMPA *BCAT '*AND')
             ENDDO

/* SELECT FROM DATE                                                  */
/*           CHGVAR     VAR(&B) VALUE('((FJAODT *GE ' *CAT +    */
/*                       &FRMDATA *CAT ' *AND FJAODT *LE '    +      */
/*                       *CAT &THRDATA *CAT ')')                     */

/* TO THRU DATE                                                      */
             CHGVAR     VAR(&C) VALUE('(FJEIDT *GE ' *CAT +
                         &FRMDATA *CAT ' *AND FJEIDT *LE '   +
                         *CAT  &THRDATA *CAT ')')
             ENDDO

/* SELECT CARRIER                                                    */
             IF COND(&CARRIER *NE ' ') THEN(DO)
             CHGVAR     VAR(&D) VALUE('*AND FJBZNA *EQ "' *CAT +
                         &CARRIER *CAT '"')
             ENDDO

/* SELECT LOAD TYPE                                                  */
             IF COND(&LOADT *NE ' ') THEN(DO)
             CHGVAR     VAR(&E) VALUE('*AND FJVDST *EQ "' *CAT +
                         &LOADT *CAT '"')
             ENDDO

/* SELECT LOAD NUMBER                                                */
             IF COND(&LOADA *NE '0000000') THEN(DO)
             CHGVAR     VAR(&F) VALUE('*AND FJRMNB *EQ ' *CAT +
                         &LOADA)
             ENDDO

/* SELECT ONLY SHIPPED                                              */
/* * * * * * C3391:  REMOVE THIS FROM CL AND PUT IN PGM; SOME       */
/* * * * * *         UNSHIPPED LOADS WILL BE INCLUDED               */
/* * * * * * CHGVAR     VAR(&G) VALUE('*AND FJPKST *EQ %VALUES("I" +
                          "S")')                                    */

             CHGVAR     VAR(&Q) VALUE(&A *BCAT &C *BCAT &D +
                                      *BCAT &E *BCAT &F)

/*  RUN QUERY TO READ LOAD HEADER BY DATE RANGE  */

             IF COND(&REPORT *EQ '2') THEN(DO)
             OVRDBF     FILE(OMFJCPLQ) SHARE(*YES)
             OPNQRYF    FILE(OMFJCPLQ) +
                        QRYSLT(&Q) +
                        KEYFLD(*FILE)
             CALL       PGM(PDXRPFR) PARM(' ' &LOAD &COMPANY &THRDAT +
                          &CARRIER &LOADT &FRMDAT &UOM &CUST +
                          &YEAR &QUARTER)

             CLOF       OPNID(OMFJCPLQ)
             DLTOVR     FILE(OMFJCPLQ)
             ENDDO

 END:        ENDPGM
