// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUMGXFR
// ?Date: 14.08.2025 Time: 03:50:48
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Send email if customer is valid
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// PGM.*Return code = CND.*Record does not exist
PGM.*Return_code = 'Y2U0005';

//?Send email if customer is valid
// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Display Fax Select Screen = CND.Yes
PAR.Display_Fax_Select_Screen = 'Y';

EXECUTE FUNCTION(CNV cyymmdd to mmddyy) TYPE(EXCINTFUN)                         AC1563472;
PARAMETER(JOB.*Job_date);
PARAMETER(PAR.Send_Date);
{
 //?Execute internal function

 //?convert numeric date to character date.
 // PAR.Date (Alpha) USR = CVTVAR(PAR.Date In  (7,0) USR)
 PAR.Date_Alpha_USR = CVTVAR(PAR.Date_In_70_USR);

 //?extract month, day, and year.
 // PAR.Year  (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.2,CON.2)
 PAR.Year_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:2:2);

 // PAR.Month (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.4,CON.2)
 PAR.Month_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:4:2);

 // PAR.Day   (Char) USR = SUBSTRING(PAR.Date (Alpha) USR,CON.6,CON.2)
 PAR.Day_Char_USR = SUBSTRING(PAR.Date_Alpha_USR:6:2);

 //?reconstruct date in mmddyy format.
 // PAR.Date (Char-6) USR = CONCAT(PAR.Month (Char) USR,PAR.Day   (Char) USR,CON.*ZE
 PAR.Date_Char_6_USR = PAR.Month_Char_USR + PAR.Day_Char_USR (*ZERO);

 // PAR.Date (Char-6) USR = CONCAT(PAR.Date (Char-6) USR,PAR.Year  (Char) USR,CON.*Z
 PAR.Date_Char_6_USR = PAR.Date_Char_6_USR + PAR.Year_Char_USR (*ZERO);

 //?convert character date to numeric date.
 // PAR.Date Out (6,0) USR = CVTVAR(PAR.Date (Char-6) USR)
 PAR.Date_Out_60_USR = CVTVAR(PAR.Date_Char_6_USR);

}


EXECUTE FUNCTION(RTV Snd Email 1/inv RT) TYPE(RTVOBJ) FILE(PNF7REP)             AC2170489;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER('AR-INVOICE');
PARAMETER('O');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(PAR.Display_Fax_Select_Screen);
PARAMETER(PAR.Send_Date);
PARAMETER(PAR.Printer_Name_or_Outq);
PARAMETER(PAR.Outq_Library);
PARAMETER(PAR.Country_Description);
PARAMETER(PAR.Spool_File_Selection_2);
PARAMETER(PAR.Company_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 // AND DB1.CDE Destination Type is One Email/Invoice
 AND DB1.CDE_Destination_Type = 'O';

 //?** Customer name
 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(WRK.Customer_Name);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?Invoice:
 CASE;

 // IF PAR.Spool File Selection is Entered
 IF PAR.Spool_File_Selection <> *BLANK;

 // Call program Exc ESNDMAIL w/Attchmt UP.
 CALL PROGRAM(Exc ESNDMAIL w/Attchmt UP) ('PMB8UPC');
 PARAMETER(PAR.Spool_File_Selection);
 PARAMETER(DB1.CDE_Name);
 PARAMETER(DB1.CDE_Destination);
 PARAMETER(*PDF);

 ENDIF;

 //?BOL:                                         8/30/19 DN S15356
 CASE;

 // IF PAR.Spool File Selection 2 is Entered
 IF PAR.Spool_File_Selection_2 <> *BLANK;

 // Call program Exc ESNDMAIL w/Attchmt UP.
 CALL PROGRAM(Exc ESNDMAIL w/Attchmt UP) ('PMB8UPC');
 PARAMETER(PAR.Spool_File_Selection_2);
 PARAMETER(DB1.CDE_Name);
 PARAMETER(DB1.CDE_Destination);
 PARAMETER(*PDF);

 ENDIF;

 ENDIF;

}


// Call program EXC DLTSPLF command    UP.
CALL PROGRAM(EXC DLTSPLF command    UP) ('PNRAUPC');
PARAMETER(PAR.Spool_File_Selection);
PARAMETER(*ALL);

//?08/30/19 DN S15356-Uncommented Out to Delete the BOLs.
// Call program EXC DLTSPLF command    UP.
CALL PROGRAM(EXC DLTSPLF command    UP) ('PNRAUPC');
PARAMETER(PAR.Spool_File_Selection_2);
PARAMETER(*ALL);

ENDIF;

