// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKKGPVR
// ?Date: 14.08.2025 Time: 02:49:46
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Load screen

EXECUTE FUNCTION(Rtv CMP Info Record   RT) TYPE(RTVOBJ) FILE(PKARREP)           AB1263852;
PARAMETER(PAR.CMP_Program_Code);
PARAMETER(DTL.Name_USR);
PARAMETER(DTL.CMP_Grading_Type);
PARAMETER(DTL.CMP_Sort_Basis);
PARAMETER(DTL.CMP_Sts);
PARAMETER(DTL.CMP_Carc_Wgt_Type);
PARAMETER(DTL.CMP_Std_Lean_Percent);
PARAMETER(DTL.CMP_Lean_Factor);
PARAMETER(DTL.CMP_Optimal_Row_Nbr_f_srt);
PARAMETER(DTL.CMP_Type);
PARAMETER(DTL.CMP_Market_Add_Deduct);
PARAMETER(DTL.CMP_of_Carcass_Cutout);
PARAMETER(DTL.CMP_Fixed_Cost_Per_Head);
PARAMETER(*MISSING);
PARAMETER(*MISSING);
PARAMETER(DTL.RS_Record_Status);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// DTL.Grading Type Desc Usr = Condition name of DTL.CMP Grading Type
DTL.Grading_Type_Desc_Usr = RTVCND(DTL.CMP_Grading_Type);

// DTL.Sort Basis Desc Usr = Condition name of DTL.CMP Sort Basis
DTL.Sort_Basis_Desc_Usr = RTVCND(DTL.CMP_Sort_Basis);

// DTL.Carc Wgt Type Desc Usr = Condition name of DTL.CMP Carc Wgt Type
DTL.Carc_Wgt_Type_Desc_Usr = RTVCND(DTL.CMP_Carc_Wgt_Type);

// DTL.Sort Weight Desc Usr = Condition name of DTL.CMP Optimal Row Nbr f/srt
DTL.Sort_Weight_Desc_Usr = RTVCND(DTL.CMP_Optimal_Row_Nbr_f_srt);

// DTL.CMP Type Desc Usr = Condition name of DTL.CMP Type
DTL.CMP_Type_Desc_Usr = RTVCND(DTL.CMP_Type);

// DTL.Record Status Desc Usr = Condition name of DTL.RS Record Status
DTL.Record_Status_Desc_Usr = RTVCND(DTL.RS_Record_Status);

//?USER: Validate fields

EXECUTE FUNCTION(Rtv CMP Description  RT) TYPE(RTVOBJ) FILE(PKARREP)            AB1124280;
PARAMETER(DTL.Carc_Merit_Pgm_Code_USR);
PARAMETER(DTL.CMP_Description);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // *MO.VE             1183529*Bu = ilt. in functions
 PGM.*Return_code = 999;

}


CASE;

// IF PGM.*Return code is Record Found
IF PGM.*Return_code = '999';

// Send error message - 'Carcass Merit Program already exists.'
ERROR(PRK0040);

QUIT;

ENDIF;

//?USER: User defined action

CASE;

// IF DTL.*CMD key is CF13
IF DTL.*CMD_key = '13';

// Call program Cpy Carc Merit Pgm     XF.
CALL PROGRAM(Cpy Carc Merit Pgm     XF) ('PKI7XFR');
PARAMETER(DTL.CMP_Program_Code);
PARAMETER(DTL.CMP_Description);
PARAMETER(DTL.Carc_Merit_Pgm_Code_USR);

// Send completion message - 'Carcass Merit Pgm Copied'
MESSAGE(PRK0225 *COMPLETION);

RETURN;

ENDIF;

