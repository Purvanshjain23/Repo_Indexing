     H/TITLE Exc Default Averages  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 00:48:59
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKBVCPL0UF  E           K        DISK                      A
      * UPD : Eval Trans                Update index
      *
     I@BVCPF0
      * Eval Trans                Update index
      * Renamed input format fields
     I              BVHSNB                          WAHSNB
     I              BVA9DT                          WAA9DT
     I              BVFJNB                          WAFJNB
     I              BVHCNB                          WAHCNB
     I              BVGDNB                          WAGDNB
     I              BVFINB                          WAFINB
     I              BVLKNB                          WALKNB
     I              BVEAST                          WAEAST
     I              BVAMPC                          WAAMPC
     I              BVAIPC                          WAAIPC
     I              BVAJPC                          WAAJPC
     I              BVAKPC                          WAAKPC
     I              BVX8NB                          WAX8NB
     I              BVFVPC                          WAFVPC
     I              BVFWPC                          WAFWPC
     I              BVFXPC                          WAFXPC
     I              BVALPC                          WAALPC
     I              BVDIST                          WADIST
     I              BVFYST                          WAFYST
     I              BVD2ST                          WAD2ST
     I              BVEHST                          WAEHST
     I              BVG1ST                          WAG1ST
     I              BVH4ST                          WAH4ST
     I              BVJLST                          WAJLST
     I              BVUUST                          WAUUST
     I              BVVHST                          WAVHST
     I              BVVIST                          WAVIST
     I              BVVJST                          WAVJST
     I              BVVKST                          WAVKST
     I              BVVLST                          WAVLST
     I              BVHMNB                          WAHMNB
     I              BVBNNB                          WABNNB
     I              BVBONB                          WABONB
     I              BVCVNB                          WACVNB
     I              BVB0DT                          WAB0DT
     I              BVAAVN                          WAAAVN
     I              BVAADT                          WAAADT
     I              BVAMTM                          WAAMTM
     I              BVAJST                          WAAJST
     I              BVAHVN                          WAAHVN
     I              BVAGVN                          WAAGVN
     I              BVABVN                          WAABVN
     I              BVABDT                          WAABDT
     I              BVABTM                          WAABTM
     I              BVB8DT                          WAB8DT
     I              BVAOTM                          WAAOTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKBV1    E DSPKBVCPL0
      * UPD : Eval Trans                Update index
      * Renamed input format fields
     I              BVHSNB                          WAHSNB
     I              BVA9DT                          WAA9DT
     I              BVFJNB                          WAFJNB
     I              BVHCNB                          WAHCNB
     I              BVGDNB                          WAGDNB
     I              BVFINB                          WAFINB
     I              BVLKNB                          WALKNB
     I              BVEAST                          WAEAST
     I              BVAMPC                          WAAMPC
     I              BVAIPC                          WAAIPC
     I              BVAJPC                          WAAJPC
     I              BVAKPC                          WAAKPC
     I              BVX8NB                          WAX8NB
     I              BVFVPC                          WAFVPC
     I              BVFWPC                          WAFWPC
     I              BVFXPC                          WAFXPC
     I              BVALPC                          WAALPC
     I              BVDIST                          WADIST
     I              BVFYST                          WAFYST
     I              BVD2ST                          WAD2ST
     I              BVEHST                          WAEHST
     I              BVG1ST                          WAG1ST
     I              BVH4ST                          WAH4ST
     I              BVJLST                          WAJLST
     I              BVUUST                          WAUUST
     I              BVVHST                          WAVHST
     I              BVVIST                          WAVIST
     I              BVVJST                          WAVJST
     I              BVVKST                          WAVKST
     I              BVVLST                          WAVLST
     I              BVHMNB                          WAHMNB
     I              BVBNNB                          WABNNB
     I              BVBONB                          WABONB
     I              BVCVNB                          WACVNB
     I              BVB0DT                          WAB0DT
     I              BVAAVN                          WAAAVN
     I              BVAADT                          WAAADT
     I              BVAMTM                          WAAMTM
     I              BVAJST                          WAAJST
     I              BVAHVN                          WAAHVN
     I              BVAGVN                          WAAGVN
     I              BVABVN                          WAABVN
     I              BVABDT                          WAABDT
     I              BVABTM                          WAABTM
     I              BVB8DT                          WAB8DT
     I              BVAOTM                          WAAOTM
      *
     IYARDCS      DS                            144
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      * Outward parameters
     IPARC        DS                             18
      * KEY : Eval Trans                Retrieval index
      * I : MAP ET Company Number
     I                                    P   1   20PAHSNB
      * I : MAP ET Kill Date
     I                                    P   3   60PAA9DT
      * I : MAP ET Scale Sequence Number
     I                                    P   7  100PAFJNB
      * I : MAP ET Carcass Number
     I                                    P  11  140PAHCNB
      * I : MAP ET Carcass Number Insert
     I                                    P  15  180PAGDNB
      *
     IYBRDCS      DS                            144
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Eval Trans
      * I :  ET Company Number
     I                                    P   1   20P1HSNB
      * I :  ET Kill Date
     I                                    P   3   60P1A9DT
      * I :  ET Scale Sequence Number
     I                                    P   7  100P1FJNB
      * I :  ET Carcass Number
     I                                    P  11  140P1HCNB
      * I :  ET Carcass Number Insert
     I                                    P  15  180P1GDNB
      * I :  ET Tattoo Number
     I                                    P  19  210P1FINB
      * I :  ET Lot
     I                                    P  22  240P1LKNB
      * I :  ET Shift
     I                                       25  25 P1EAST
      * I :  ET Hot Wgt
     I                                    P  26  281P1AMPC
      * I :  ET Backfat Thickness Inch
     I                                    P  29  301P1AIPC
      * I :  ET Loin-Eye Depth Inches
     I                                    P  31  321P1AJPC
      * I :  ET Lean Percent NPPC
     I                                    P  33  341P1AKPC
      * I :  ET Backfat Thickness MM
     I                                    P  35  361P1X8NB
      * I :  ET Loineye Depth MM
     I                                    P  37  381P1FVPC
      * I :  ET Light Reflectance MM
     I                                    P  39  401P1FWPC
      * I :  ET Lean Percent FOM
     I                                    P  41  421P1FXPC
      * I :  ET Light Reflectance
     I                                    P  43  441P1ALPC
      * I :  ET Trim Area
     I                                       45  45 P1DIST
      * I :  ET Carcass Sex
     I                                       46  46 P1FYST
      * I :  ET Error Sts
     I                                       47  47 P1D2ST
      * I :  ET Record Add/Del Sts
     I                                       48  48 P1EHST
      * I :  ET Record Created W/Avg
     I                                       49  49 P1G1ST
      * I :  ET Record Created Status
     I                                       50  50 P1H4ST
      * I :  ET User Error Override
     I                                       51  51 P1JLST
      * I :  BOH Company Number
     I                                    P  52  530P1HMNB
      * I :  BOH Buy Order Number
     I                                    P  54  570P1BNNB
      * I :  BOL Load Number
     I                                    P  58  600P1BONB
      * I :  TH Tattoo Number
     I                                    P  61  630P1CVNB
      * I :  TH Kill Date
     I                                    P  64  670P1B0DT
      * I :  RS User Changed
     I                                       68  77 P1AAVN
      * I :  RS Date Changed
     I                                    P  78  810P1AADT
      * I :  RS Time Changed
     I                                    P  82  850P1AMTM
      * I :  RS Record Status
     I                                       86  86 P1AJST
      * I :  RS Job
     I                                       87  96 P1AHVN
      * I :  RS Program
     I                                       97 106 P1AGVN
      * I :  RS User Added
     I                                      107 116 P1ABVN
      * I :  RS Date Added
     I                                    P 117 1200P1ABDT
      * I :  RS Time Added
     I                                    P 121 1240P1ABTM
      * I :  RU Date
     I                                    P 125 1280P1B8DT
      * I :  RU Time
     I                                    P 129 1320P1AOTM
     IP2PARM      DS
      * FLD: Tattoo Header
      * I :  TH Live Wgt
     I                                    P   1   41P2CYNB
      * I :  TH Hot Wgt
     I                                    P   5   81P2E0NB
      * I :  TH Tot Loin Eye Depth
     I                                    P   9  121P2A5PC
      * I :  TH Tot Backfat Inches
     I                                    P  13  161P2FBNB
      * I :  TH Tot Light Reflectance
     I                                    P  17  201P2A4PC
      * I :  TH Avg Live Wgt
     I                                    P  21  231P2F7NB
      * I :  TH Avg Hot Wgt
     I                                    P  24  261P2HDNB
      * I :  TH Avg Light Reflectance
     I                                    P  27  281P2F5NB
      * I :  TH Avg Lean Percent
     I                                    P  29  301P2F4NB
      * B :  TH Avg Loin Eye Depth
     I                                    P  31  321P2F3NB
      * B :  TH Avg Backfat
     I                                    P  33  341P2F2NB
      * I :  TH Std Yield Percent
     I                                    P  35  372P2AVPC
      * I :  TH Actual Yield %
     I                                    P  38  402P2AWPC
      * I :  TH Yield Difference
     I                                    P  41  432P2A8PC
      * I :  TH Recalc Live Wgt
     I                                    P  44  451P2A7PC
      * I :  TH Schedule Kill Shift
     I                                       46  46 P2LIST
     IP3PARM      DS
      * I :  Oms System Value Alpha
     I                                        1  40 P3EVTX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HSNB    PARM           WP0001  30       ET Company Numb
     C           P1A9DT    PARM           WP0002  70       ET Kill Date
     C           P1FJNB    PARM           WP0003  60       ET Scale Sequen
     C           P1HCNB    PARM           WP0004  60       ET Carcass Numb
     C           P1GDNB    PARM           WP0005  60       ET Carcass Numb
     C           P1FINB    PARM           WP0006  50       ET Tattoo Numbe
     C           P1LKNB    PARM           WP0007  50       ET Lot
     C           P1EAST    PARM           WP0008  1        ET Shift
     C           P1AMPC    PARM           WP0009  51       ET Hot Wgt
     C           P1AIPC    PARM           WP0010  31       ET Backfat Thic
     C           P1AJPC    PARM           WP0011  31       ET Loin-Eye Dep
     C           P1AKPC    PARM           WP0012  31       ET Lean Percent
     C           P1X8NB    PARM           WP0013  31       ET Backfat Thic
     C           P1FVPC    PARM           WP0014  31       ET Loineye Dept
     C           P1FWPC    PARM           WP0015  31       ET Light Reflec
     C           P1FXPC    PARM           WP0016  31       ET Lean Percent
     C           P1ALPC    PARM           WP0017  31       ET Light Reflec
     C           P1DIST    PARM           WP0018  1        ET Trim Area
     C           P1FYST    PARM           WP0019  1        ET Carcass Sex
     C           P1D2ST    PARM           WP0020  1        ET Error Sts
     C           P1EHST    PARM           WP0021  1        ET Record Add/D
     C           P1G1ST    PARM           WP0022  1        ET Record Creat
     C           P1H4ST    PARM           WP0023  1        ET Record Creat
     C           P1JLST    PARM           WP0024  1        ET User Error O
     C           P1HMNB    PARM           WP0025  30       BOH Company Num
     C           P1BNNB    PARM           WP0026  70       BOH Buy Order N
     C           P1BONB    PARM           WP0027  50       BOL Load Number
     C           P1CVNB    PARM           WP0028  50       TH Tattoo Numbe
     C           P1B0DT    PARM           WP0029  70       TH Kill Date
     C           P1AAVN    PARM           WP0030 10        RS User Changed
     C           P1AADT    PARM           WP0031  70       RS Date Changed
     C           P1AMTM    PARM           WP0032  60       RS Time Changed
     C           P1AJST    PARM           WP0033  1        RS Record Statu
     C           P1AHVN    PARM           WP0034 10        RS Job
     C           P1AGVN    PARM           WP0035 10        RS Program
     C           P1ABVN    PARM           WP0036 10        RS User Added
     C           P1ABDT    PARM           WP0037  70       RS Date Added
     C           P1ABTM    PARM           WP0038  60       RS Time Added
     C           P1B8DT    PARM           WP0039  70       RU Date
     C           P1AOTM    PARM           WP0040  60       RU Time
     C           P2CYNB    PARM           WP0041  71       TH Live Wgt
     C           P2E0NB    PARM           WP0042  71       TH Hot Wgt
     C           P2A5PC    PARM           WP0043  61       TH Tot Loin Eye
     C           P2FBNB    PARM           WP0044  61       TH Tot Backfat
     C           P2A4PC    PARM           WP0045  61       TH Tot Light Re
     C           P2F7NB    PARM           WP0046  51       TH Avg Live Wgt
     C           P2HDNB    PARM           WP0047  51       TH Avg Hot Wgt
     C           P2F5NB    PARM           WP0048  31       TH Avg Light Re
     C           P2F4NB    PARM           WP0049  31       TH Avg Lean Per
     C           P2F3NB    PARM P2F3NB    WP0050  31       TH Avg Loin Eye
     C           P2F2NB    PARM P2F2NB    WP0051  31       TH Avg Backfat
     C           P2AVPC    PARM           WP0052  52       TH Std Yield Pe
     C           P2AWPC    PARM           WP0053  52       TH Actual Yield
     C           P2A8PC    PARM           WP0054  52       TH Yield Differ
     C           P2A7PC    PARM           WP0055  31       TH Recalc Live
     C           P2LIST    PARM           WP0056  1        TH Schedule Kil
     C           P3EVTX    PARM           WP0057 40        Oms System Valu
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Default Averages  XF
      * MODIFICATIONS
      * 11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM
     C                     Z-ADDP1AMPC    WUZBNB           Hot Wgt Usr
      * CLC Inches to MM      XF - Eval Trans  * 
     C                     CALL 'PKQQXFR'              90  CLC Inches to M
     C                     PARM *BLANK    W0RTN   7
     C           P2F2NB    PARM P2F2NB    WQ0001  31       ET Backfat Thic
     C           P2F3NB    PARM P2F3NB    WQ0002  31       ET Loin-Eye Dep
     C           WUVENB    PARM WUVENB    WQ0003  31       ET Backfat Thic
     C           WUFKPC    PARM WUFKPC    WQ0004  31       ET Loineye Dept
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKQQXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      *
     C                     MOVEL*BLANK    WN0001  3        ET Adjust/Add T
     C                     MOVEL*BLANK    WN0002  1        ET Broken Back
     C                     MOVEL*BLANK    WN0003  1        ET Unused Sts 2
     C                     MOVEL*BLANK    WN0004  2        ET Adjust/Add S
     C                     MOVEL*BLANK    WN0005  2        ET Unused Sts 4
     C                     MOVEL*BLANK    WN0006  3        ET Unused Sts 5
      *
      * Chg Eval Trans W/Avg IF
      * CASE: PAR.ET Carcass Number is 700000 - 799999
     C           P1HCNB    IFGE 700000                     *IF
     C           P1HCNB    ANDLE799999
      * Record has alread been changed do not assign new carcass #
      * Perform regular change
      * Chg Evaluation Trans   CO - Eval Trans  * 
     C                     EXSR SACHRC
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.ET Record Created W/Avg is Not Created With Average
     C           P1G1ST    IFEQ *BLANK                     *IF
      * Create a copy of orginal only 1 time
      * Save orginal records but change status
      * UPD Eval Trans Rec    XF - Eval Trans  * 
     C                     CLEARPARC
     C                     Z-ADDP1HSNB    PAHSNB           ET Company Numb
     C                     Z-ADDP1A9DT    PAA9DT           ET Kill Date
     C                     Z-ADDP1FJNB    PAFJNB           ET Scale Sequen
     C                     Z-ADDP1HCNB    PAHCNB           ET Carcass Numb
     C                     Z-ADDP1GDNB    PAGDNB           ET Carcass Numb
      *
     C                     CALL 'PKO4XFR'              90  UPD Eval Trans
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Eval Trans
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKO4XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Create new carcass with averages key by user and override carcass
     C           700000    ADD  P1FJNB    WUFJNB           ET Scale Sequen
     C           700000    ADD  P1HCNB    WUK2NB           ET Carcass Numb
      * Create Evaluation Transac - Eval Trans  * 
     C                     EXSR SBCRRC
     C                     MOVEL'Y'       WUABST           @Status (Yes/No
     C                     ELSE
      * CASE: *OTHERWISE
      * Chg Evaluation Trans   CO - Eval Trans  * 
     C                     EXSR SCCHRC
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.@Status (Yes/No) is Yes
     C           WUABST    IFEQ 'Y'                        *IF
      * Bal Tattoo W/Kill Edt  XF - STR Batch Processing  * 
     C                     CALL 'PKLHXFR'              90  Bal Tattoo W/Ki
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HMNB    WQ0005  30       CC Company Numb
     C                     PARM P1B0DT    WQ0006  70       Current Kill Da
     C                     PARM P1HMNB    WQ0007  30       BOH Company Num
     C                     PARM P1BNNB    WQ0008  70       BOH Buy Order N
     C                     PARM P1BONB    WQ0009  50       BOL Load Number
     C                     PARM P1CVNB    WQ0010  50       TH Tattoo Numbe
     C                     PARM P1B0DT    WQ0011  70       TH Kill Date
     C                     PARM 'E'       WQ0012  1        TH Kill Balanci
     C                     PARM P2LIST    WQ0013  1        TH Schedule Kil
     C                     PARM 'N'       WQ0014  1        Requested by Us
     C                     PARM P3EVTX    WQ0015 40        Oms System Valu
     C                     PARM *BLANK    WQ0016  1        Execution Locat
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKLHXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Chg Evaluation Trans   CO - Eval Trans  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0007  3        ET Adjust/Add T
     C                     MOVEL*BLANK    WN0008  1        ET Broken Back
     C                     MOVEL*BLANK    WN0009  1        ET Unused Sts 2
     C                     MOVEL*BLANK    WN0010  2        ET Adjust/Add S
     C                     MOVEL*BLANK    WN0011  2        ET Unused Sts 4
     C                     MOVEL*BLANK    WN0012  3        ET Unused Sts 5
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BVCPF0
     C                     Z-ADDP1HSNB    WAHSNB           ET Company Numb
     C                     Z-ADDP1A9DT    WAA9DT           ET Kill Date
     C                     Z-ADDP1FJNB    WAFJNB           ET Scale Sequen
     C                     Z-ADDP1HCNB    WAHCNB           ET Carcass Numb
     C                     Z-ADDP1GDNB    WAGDNB           ET Carcass Numb
      *
     C           KLCHSA    KLIST
     C                     KFLD           WAHSNB           ET Company Numb
     C                     KFLD           WAA9DT           ET Kill Date
     C                     KFLD           WAFJNB           ET Scale Sequen
     C                     KFLD           WAHCNB           ET Carcass Numb
     C                     KFLD           WAGDNB           ET Carcass Numb
     C           KLCHSA    CHAIN@BVCPF0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKBVCPL0'MDACP
     C                     MOVEL'@BVCPF0' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKBV1    YARDCS
      * Move non-key fields to @BVCPF0
     C                     Z-ADDP1FINB    WAFINB           ET Tattoo Numbe
     C                     Z-ADDP1LKNB    WALKNB           ET Lot
     C                     MOVELP1EAST    WAEAST    P      ET Shift
     C                     Z-ADDWUZBNB    WAAMPC           ET Hot Wgt
     C                     Z-ADDP2F2NB    WAAIPC           ET Backfat Thic
     C                     Z-ADDP2F3NB    WAAJPC           ET Loin-Eye Dep
     C                     Z-ADDP1AKPC    WAAKPC           ET Lean Percent
     C                     Z-ADDWUVENB    WAX8NB           ET Backfat Thic
     C                     Z-ADDWUFKPC    WAFVPC           ET Loineye Dept
     C                     Z-ADDP1FWPC    WAFWPC           ET Light Reflec
     C                     Z-ADDP1FXPC    WAFXPC           ET Lean Percent
     C                     Z-ADDP1ALPC    WAALPC           ET Light Reflec
     C                     MOVELP1DIST    WADIST    P      ET Trim Area
     C                     MOVELP1FYST    WAFYST    P      ET Carcass Sex
     C                     MOVELP1D2ST    WAD2ST    P      ET Error Sts
     C                     MOVELP1EHST    WAEHST    P      ET Record Add/D
     C                     MOVELP1G1ST    WAG1ST    P      ET Record Creat
     C                     MOVELP1H4ST    WAH4ST    P      ET Record Creat
     C                     MOVELP1JLST    WAJLST    P      ET User Error O
     C                     Z-ADDP1HMNB    WAHMNB           BOH Company Num
     C                     Z-ADDP1BNNB    WABNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    WABONB           BOL Load Number
     C                     Z-ADDP1CVNB    WACVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WAB0DT           TH Kill Date
     C                     MOVELP1AAVN    WAAAVN    P      RS User Changed
     C                     Z-ADDP1AADT    WAAADT           RS Date Changed
     C                     Z-ADDP1AMTM    WAAMTM           RS Time Changed
     C                     MOVELP1AJST    WAAJST    P      RS Record Statu
     C                     MOVELP1AHVN    WAAHVN    P      RS Job
     C                     MOVELP1AGVN    WAAGVN    P      RS Program
     C                     MOVELP1ABVN    WAABVN    P      RS User Added
     C                     Z-ADDP1ABDT    WAABDT           RS Date Added
     C                     Z-ADDP1ABTM    WAABTM           RS Time Added
     C                     Z-ADDP1B8DT    WAB8DT           RU Date
     C                     Z-ADDP1AOTM    WAAOTM           RU Time
      *
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WAAAVN           RS User Changed
     C                     Z-ADD##JDT     WAAADT           RS Date Changed
     C                     Z-ADD##JTM     WAAMTM           RS Time Changed
     C                     MOVEL##JOB     WAAHVN           RS Job
     C                     MOVEL##PGM     WAAGVN           RS Program
      * Record is changed
     C                     MOVEL'Y'       WUABST           @Status (Yes/No
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BVCPF0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKBVCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Create Evaluation Transac - Eval Trans  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BVCPF0
     C                     Z-ADDP1HSNB    WAHSNB           ET Company Numb
     C                     Z-ADDP1A9DT    WAA9DT           ET Kill Date
     C                     Z-ADDWUFJNB    WAFJNB           ET Scale Sequen
     C                     Z-ADDWUK2NB    WAHCNB           ET Carcass Numb
     C                     Z-ADDP1GDNB    WAGDNB           ET Carcass Numb
     C                     Z-ADDP1FINB    WAFINB           ET Tattoo Numbe
     C                     Z-ADDP1LKNB    WALKNB           ET Lot
     C                     MOVELP1EAST    WAEAST           ET Shift
     C                     Z-ADDWUZBNB    WAAMPC           ET Hot Wgt
     C                     Z-ADDP2F2NB    WAAIPC           ET Backfat Thic
     C                     Z-ADDP2F3NB    WAAJPC           ET Loin-Eye Dep
     C                     Z-ADDP1AKPC    WAAKPC           ET Lean Percent
     C                     Z-ADDWUVENB    WAX8NB           ET Backfat Thic
     C                     Z-ADDWUFKPC    WAFVPC           ET Loineye Dept
     C                     Z-ADDP1FWPC    WAFWPC           ET Light Reflec
     C                     Z-ADDP1FXPC    WAFXPC           ET Lean Percent
     C                     Z-ADDP1ALPC    WAALPC           ET Light Reflec
     C                     MOVELP1DIST    WADIST           ET Trim Area
     C                     MOVELP1FYST    WAFYST           ET Carcass Sex
     C                     MOVEL'B'       WAD2ST           ET Error Sts
     C                     MOVELP1EHST    WAEHST           ET Record Add/D
     C                     MOVEL'C'       WAG1ST           ET Record Creat
     C                     MOVELP1H4ST    WAH4ST           ET Record Creat
     C                     MOVELP1JLST    WAJLST           ET User Error O
     C                     MOVELWN0001    WAUUST           ET Adjust/Add T
     C                     MOVELWN0002    WAVHST           ET Broken Back
     C                     MOVELWN0003    WAVIST           ET Unused Sts 2
     C                     MOVELWN0004    WAVJST           ET Adjust/Add S
     C                     MOVELWN0005    WAVKST           ET Unused Sts 4
     C                     MOVELWN0006    WAVLST           ET Unused Sts 5
     C                     Z-ADDP1HMNB    WAHMNB           BOH Company Num
     C                     Z-ADDP1BNNB    WABNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    WABONB           BOL Load Number
     C                     Z-ADDP1CVNB    WACVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WAB0DT           TH Kill Date
     C                     MOVELP1AAVN    WAAAVN           RS User Changed
     C                     Z-ADDP1AADT    WAAADT           RS Date Changed
     C                     Z-ADDP1AMTM    WAAMTM           RS Time Changed
     C                     MOVEL'A'       WAAJST           RS Record Statu
     C                     MOVELP1AHVN    WAAHVN           RS Job
     C                     MOVELP1AGVN    WAAGVN           RS Program
     C                     MOVELP1ABVN    WAABVN           RS User Added
     C                     Z-ADDP1ABDT    WAABDT           RS Date Added
     C                     Z-ADDP1ABTM    WAABTM           RS Time Added
     C                     Z-ADDP1B8DT    WAB8DT           RU Date
     C                     Z-ADDP1AOTM    WAAOTM           RU Time
      *
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) WAAHVN' defaulted for 'RS Job'.
      * Field '(DB1) WAAGVN' defaulted for 'RS Program'.
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WAAJST           RS Record Statu
     C                     MOVEL##USR     WAABVN           RS User Added
     C                     Z-ADD##JDT     WAABDT           RS Date Added
     C                     Z-ADD##JTM     WAABTM           RS Time Added
     C                     MOVEL##PGM     WAAGVN           RS Program
     C                     MOVEL##JOB     WAAHVN           RS Job
     C           KLCRSB    KLIST
     C                     KFLD           WAHSNB           ET Company Numb
     C                     KFLD           WAA9DT           ET Kill Date
     C                     KFLD           WAFJNB           ET Scale Sequen
     C                     KFLD           WAHCNB           ET Carcass Numb
     C                     KFLD           WAGDNB           ET Carcass Numb
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BVCPF0                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0122' W0RTN   7
      * Send message 'Eval Trans             EX'
     C                     MOVEL'PRK0122' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@BVCPF0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Evaluation Trans   CO - Eval Trans  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0013  3        ET Adjust/Add T
     C                     MOVEL*BLANK    WN0014  1        ET Broken Back
     C                     MOVEL*BLANK    WN0015  1        ET Unused Sts 2
     C                     MOVEL*BLANK    WN0016  2        ET Adjust/Add S
     C                     MOVEL*BLANK    WN0017  2        ET Unused Sts 4
     C                     MOVEL*BLANK    WN0018  3        ET Unused Sts 5
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @BVCPF0
     C                     Z-ADDP1HSNB    WAHSNB           ET Company Numb
     C                     Z-ADDP1A9DT    WAA9DT           ET Kill Date
     C                     Z-ADDP1FJNB    WAFJNB           ET Scale Sequen
     C                     Z-ADDP1HCNB    WAHCNB           ET Carcass Numb
     C                     Z-ADDP1GDNB    WAGDNB           ET Carcass Numb
      *
     C           KLCHSC    KLIST
     C                     KFLD           WAHSNB           ET Company Numb
     C                     KFLD           WAA9DT           ET Kill Date
     C                     KFLD           WAFJNB           ET Scale Sequen
     C                     KFLD           WAHCNB           ET Carcass Numb
     C                     KFLD           WAGDNB           ET Carcass Numb
     C           KLCHSC    CHAIN@BVCPF0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKBVCPL0'MDACP
     C                     MOVEL'@BVCPF0' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKBV1    YBRDCS
      * Move non-key fields to @BVCPF0
     C                     Z-ADDP1FINB    WAFINB           ET Tattoo Numbe
     C                     Z-ADDP1LKNB    WALKNB           ET Lot
     C                     MOVELP1EAST    WAEAST    P      ET Shift
     C                     Z-ADDWUZBNB    WAAMPC           ET Hot Wgt
     C                     Z-ADDP2F2NB    WAAIPC           ET Backfat Thic
     C                     Z-ADDP2F3NB    WAAJPC           ET Loin-Eye Dep
     C                     Z-ADDP1AKPC    WAAKPC           ET Lean Percent
     C                     Z-ADDWUVENB    WAX8NB           ET Backfat Thic
     C                     Z-ADDWUFKPC    WAFVPC           ET Loineye Dept
     C                     Z-ADDP1FWPC    WAFWPC           ET Light Reflec
     C                     Z-ADDP1FXPC    WAFXPC           ET Lean Percent
     C                     Z-ADDP1ALPC    WAALPC           ET Light Reflec
     C                     MOVELP1DIST    WADIST    P      ET Trim Area
     C                     MOVELP1FYST    WAFYST    P      ET Carcass Sex
     C                     MOVEL'B'       WAD2ST    P      ET Error Sts
     C                     MOVELP1EHST    WAEHST    P      ET Record Add/D
     C                     MOVEL'C'       WAG1ST    P      ET Record Creat
     C                     MOVELP1H4ST    WAH4ST    P      ET Record Creat
     C                     MOVELP1JLST    WAJLST    P      ET User Error O
     C                     Z-ADDP1HMNB    WAHMNB           BOH Company Num
     C                     Z-ADDP1BNNB    WABNNB           BOH Buy Order N
     C                     Z-ADDP1BONB    WABONB           BOL Load Number
     C                     Z-ADDP1CVNB    WACVNB           TH Tattoo Numbe
     C                     Z-ADDP1B0DT    WAB0DT           TH Kill Date
     C                     MOVELP1AAVN    WAAAVN    P      RS User Changed
     C                     Z-ADDP1AADT    WAAADT           RS Date Changed
     C                     Z-ADDP1AMTM    WAAMTM           RS Time Changed
     C                     MOVEL'A'       WAAJST    P      RS Record Statu
     C                     MOVELP1AHVN    WAAHVN    P      RS Job
     C                     MOVELP1AGVN    WAAGVN    P      RS Program
     C                     MOVELP1ABVN    WAABVN    P      RS User Added
     C                     Z-ADDP1ABDT    WAABDT           RS Date Added
     C                     Z-ADDP1ABTM    WAABTM           RS Time Added
     C                     Z-ADDP1B8DT    WAB8DT           RU Date
     C                     Z-ADDP1AOTM    WAAOTM           RU Time
      *
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WAAAVN           RS User Changed
     C                     Z-ADD##JDT     WAAADT           RS Date Changed
     C                     Z-ADD##JTM     WAAMTM           RS Time Changed
     C                     MOVEL##JOB     WAAHVN           RS Job
     C                     MOVEL##PGM     WAAGVN           RS Program
      * Record is changed
     C                     MOVEL'Y'       WUABST           @Status (Yes/No
      * Set PGM.*Record Data Changed flag
     C           QPKBV1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@BVCPF0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKBVCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Hot Wgt Usr
     C                     Z-ADD*ZERO     WUZBNB  71
      * Define work field Backfat USR
     C                     Z-ADD*ZERO     WUVENB  31
      * Define work field Loin-Eye USR
     C                     Z-ADD*ZERO     WUFKPC  31
      * Define work field @Status (Yes/No)
     C                     MOVEL*BLANK    WUABST  1
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHSNB           ET Company Numb
     C                     Z-ADD*ZERO     WAA9DT           ET Kill Date
     C                     Z-ADD*ZERO     WAFJNB           ET Scale Sequen
     C                     Z-ADD*ZERO     WAHCNB           ET Carcass Numb
     C                     Z-ADD*ZERO     WAGDNB           ET Carcass Numb
     C                     Z-ADD*ZERO     WAFINB           ET Tattoo Numbe
     C                     Z-ADD*ZERO     WALKNB           ET Lot
     C                     Z-ADD*ZERO     WAAMPC           ET Hot Wgt
     C                     Z-ADD*ZERO     WAAIPC           ET Backfat Thic
     C                     Z-ADD*ZERO     WAAJPC           ET Loin-Eye Dep
     C                     Z-ADD*ZERO     WAAKPC           ET Lean Percent
     C                     Z-ADD*ZERO     WAX8NB           ET Backfat Thic
     C                     Z-ADD*ZERO     WAFVPC           ET Loineye Dept
     C                     Z-ADD*ZERO     WAFWPC           ET Light Reflec
     C                     Z-ADD*ZERO     WAFXPC           ET Lean Percent
     C                     Z-ADD*ZERO     WAALPC           ET Light Reflec
     C                     Z-ADD*ZERO     WAHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WABNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WABONB           BOL Load Number
     C                     Z-ADD*ZERO     WACVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WAB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
     C                     Z-ADD*ZERO     WAB8DT           RU Date
     C                     Z-ADD*ZERO     WAAOTM           RU Time
      * Define work field ET Scale Sequence Number
     C                     Z-ADD*ZERO     WUFJNB  60
      * Define work field ET Carcass Number Usr
     C                     Z-ADD*ZERO     WUK2NB  60
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
