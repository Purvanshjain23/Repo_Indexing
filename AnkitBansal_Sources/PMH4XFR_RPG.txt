     H/TITLE Exc Accum Mo Sales $  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/23/10  Time  : 09:00:09
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAAFREL1IF  E           K        DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FCAATREL1IF  E           K        DISK
      * RTV : Calendar Summary          Retrieval index
      *
     FCAATREL3IF  E           K        DISK
      * RSQ : Calendar Summary       NV Co/Year/Period Reverse N
      *
     FOMHRCPL7IF  E           K        DISK
      * RSQ : Shipping Dtl Accrual      Acc/Brk/ShipTo/ShpDte
      *
     FOMHSTPL1IF  E           K        DISK
      * RTV : Sales History             Retrieval index
      *
     FARBDCPL3IF  E           K        DISK
      * RTV : A/R Header                Retrieval index       NV
      *
     I@AFREBE
      * Calendar                  Retrieval index       NV
      * Renamed input format fields
     I              AFAIC3                          WAAIC3
     I              AFBCDT                          WABCDT
     I              AFCQNB                          WACQNB
     I              AFESNB                          WAESNB
     I              AFETNB                          WAETNB
     I              AFBZNB                          WABZNB
     I              AFA9ST                          WAA9ST
     I              AFEINB                          WAEINB
     I              AFC5ST                          WAC5ST
     I              AFAQNB                          WAAQNB
     I              AFCMST                          WACMST
     I              AFV9ST                          WAV9ST
     I              AFWAST                          WAWAST
     I              AFX2ST                          WAX2ST
     I              AFOJDT                          WAOJDT
     I              AFNQNX                          WANQNX
     I              AFNRNX                          WANRNX
     I              AFI9SX                          WAI9SX
     I              AFJASX                          WAJASX
     I              AFOKDT                          WAOKDT
     I              AFOLDT                          WAOLDT
     I              AFUVST                          WAUVST
     I              AFUWST                          WAUWST
     I              AFUXST                          WAUXST
     I              AFAATM                          WAAATM
     I              AFAYNA                          WAAYNA
     I              AFA0NA                          WAA0NA
     I              AFAXDT                          WAAXDT
      *
     I@ATRECF
      * Calendar Summary          Retrieval index
      * Renamed input format fields
     I              ATAIC3                          WBAIC3
     I              ATESNB                          WBESNB
     I              ATETNB                          WBETNB
     I              ATBZNB                          WBBZNB
     I              ATTBST                          WBTBST
     I              ATBFDT                          WBBFDT
     I              ATA2DT                          WBA2DT
     I              ATUVST                          WBUVST
     I              ATUWST                          WBUWST
     I              ATUXST                          WBUXST
     I              ATAATM                          WBAATM
     I              ATAYNA                          WBAYNA
     I              ATA0NA                          WBA0NA
     I              ATAXDT                          WBAXDT
      *
     I@ATREY1
      * Calendar Summary       NV Co/Year/Period Reverse N
      * Renamed input format fields
     I              ATAIC3                          WCAIC3
     I              ATESNB                          WCESNB
     I              ATETNB                          WCETNB
     I              ATBZNB                          WCBZNB
     I              ATTBST                          WCTBST
     I              ATBFDT                          WCBFDT
     I              ATA2DT                          WCA2DT
     I              ATUVST                          WCUVST
     I              ATUWST                          WCUWST
     I              ATUXST                          WCUXST
     I              ATAATM                          WCAATM
     I              ATAYNA                          WCAYNA
     I              ATA0NA                          WCA0NA
     I              ATAXDT                          WCAXDT
      *
     I@HRCPV6
      * Shipping Dtl Accrual      Acc/Brk/ShipTo/ShpDte
      * Renamed input format fields
     I              HRAIC3                          WDAIC3
     I              HRC4NB                          WDC4NB
     I              HRDPNB                          WDDPNB
     I              HRUENB                          WDUENB
     I              HRDXNB                          WDDXNB
     I              HRBKPR                          WDBKPR
     I              HRC5PC                          WDC5PC
     I              HRAYVA                          WDAYVA
     I              HREDVL                          WDEDVL
     I              HRHGCD                          WDHGCD
     I              HRBKC7                          WDBKC7
     I              HRDUC7                          WDDUC7
     I              HRHHAA                          WDHHAA
     I              HRPODT                          WDPODT
     I              HRBYWG                          WDBYWG
     I              HRBVST                          WDBVST
     I              HRP7SX                          WDP7SX
     I              HROKCD                          WDOKCD
     I              HRP8SX                          WDP8SX
     I              HRP9SX                          WDP9SX
     I              HRQASX                          WDQASX
     I              HRQBSX                          WDQBSX
     I              HRPPDT                          WDPPDT
     I              HRPQDT                          WDPQDT
     I              HREEVL                          WDEEVL
     I              HREFVL                          WDEFVL
     I              HRFITX                          WDFITX
     I              HRFJTX                          WDFJTX
     I              HRQ8DT                          WDQ8DT
     I              HRFKTX                          WDFKTX
     I              HRH0NY                          WDH0NY
     I              HRKQT1                          WDKQT1
     I              HRKTT1                          WDKTT1
     I              HRHIAA                          WDHIAA
     I              HRHLAA                          WDHLAA
     I              HROJCD                          WDOJCD
     I              HRAVNB                          WDAVNB
     I              HRDSCD                          WDDSCD
     I              HRUVST                          WDUVST
     I              HRUWST                          WDUWST
     I              HRUXST                          WDUXST
     I              HRAATM                          WDAATM
     I              HRAYNA                          WDAYNA
     I              HRA0NA                          WDA0NA
     I              HRAXDT                          WDAXDT
      *
     I@FHSTD3
      * Sales History             Retrieval index
      * Renamed input format fields
     I              F4AIC3                          WEAIC3
     I              F4C4NB                          WEC4NB
     I              F4DPNB                          WEDPNB
     I              F4UENB                          WEUENB
     I              F4MONA                          WEMONA
     I              F4RJCD                          WERJCD
     I              F4RKCD                          WERKCD
     I              F4GPTX                          WEGPTX
     I              F4ABTX                          WEABTX
     I              F4KXCD                          WEKXCD
     I              F4BOCD                          WEBOCD
     I              F4BTC7                          WEBTC7
     I              F4ANC7                          WEANC7
     I              F4AQTX                          WEAQTX
     I              F4BKC7                          WEBKC7
     I              F4BRTX                          WEBRTX
     I              F4HNNA                          WEHNNA
     I              F4DBCD                          WEDBCD
     I              F4CKTX                          WECKTX
     I              F4BCNA                          WEBCNA
     I              F4A0DT                          WEA0DT
     I              F4ACDT                          WEACDT
     I              F4R4CD                          WER4CD
     I              F4R5CD                          WER5CD
     I              F4BFCD                          WEBFCD
     I              F4Q4CD                          WEQ4CD
     I              F4AQCD                          WEAQCD
     I              F4TBNB                          WETBNB
     I              F4BZNA                          WEBZNA
     I              F4RLCD                          WERLCD
     I              F4JNCD                          WEJNCD
     I              F4Q2CD                          WEQ2CD
     I              F4U2ST                          WEU2ST
     I              F4ATIN                          WEATIN
     I              F4T3NB                          WET3NB
     I              F4RSRN                          WERSRN
     I              F4ORIT                          WEORIT
     I              F4AJCD                          WEAJCD
     I              F4AVQT                          WEAVQT
     I              F4D0WG                          WED0WG
     I              F4CCQT                          WECCQT
     I              F4AUWG                          WEAUWG
     I              F4AGCD                          WEAGCD
     I              F4AKPR                          WEAKPR
     I              F4AUPR                          WEAUPR
     I              F4CRCD                          WECRCD
     I              F4A5DT                          WEA5DT
     I              F4AWDT                          WEAWDT
     I              F4HDDT                          WEHDDT
     I              F4AGCS                          WEAGCS
     I              F4AQCS                          WEAQCS
     I              F4AVWG                          WEAVWG
     I              F4AYVA                          WEAYVA
     I              F4AMST                          WEAMST
     I              F4ANST                          WEANST
     I              F4VAST                          WEVAST
     I              F4L6NB                          WEL6NB
     I              F4UMCD                          WEUMCD
     I              F4HCDT                          WEHCDT
     I              F4ESNB                          WEESNB
     I              F4ETNB                          WEETNB
     I              F4BZNB                          WEBZNB
     I              F4EXQT                          WEEXQT
     I              F4BYWG                          WEBYWG
     I              F4S5NB                          WES5NB
     I              F4MAVA                          WEMAVA
     I              F4KDVA                          WEKDVA
     I              F4USVA                          WEUSVA
     I              F4UTVA                          WEUTVA
     I              F4A4WG                          WEA4WG
     I              F4CKNB                          WECKNB
     I              F4BMST                          WEBMST
     I              F4R8NB                          WER8NB
     I              F4RMCD                          WERMCD
     I              F4BZPR                          WEBZPR
     I              F4RDCD                          WERDCD
     I              F4Q7CD                          WEQ7CD
     I              F4EXDT                          WEEXDT
     I              F4LQCD                          WELQCD
     I              F4HICD                          WEHICD
     I              F4RBCD                          WERBCD
     I              F4RGNB                          WERGNB
     I              F4RHNB                          WERHNB
     I              F4RINB                          WERINB
     I              F4R1NB                          WER1NB
     I              F4CONB                          WECONB
     I              F4CEST                          WECEST
     I              F4GNDT                          WEGNDT
     I              F4RMNB                          WERMNB
     I              F4AODT                          WEAODT
     I              F4LLCD                          WELLCD
     I              F4LMCD                          WELMCD
     I              F4SKNB                          WESKNB
     I              F4SLNB                          WESLNB
     I              F4SMNB                          WESMNB
     I              F4G7NA                          WEG7NA
     I              F4ONVA                          WEONVA
     I              F4N0CD                          WEN0CD
     I              F4B4NB                          WEB4NB
     I              F4B5NB                          WEB5NB
     I              F4N1CD                          WEN1CD
     I              F4GIDT                          WEGIDT
     I              F4Z1ST                          WEZ1ST
     I              F4ULVA                          WEULVA
     I              F4UNVA                          WEUNVA
     I              F4UOVA                          WEUOVA
     I              F4UPVA                          WEUPVA
     I              F4UQVA                          WEUQVA
     I              F4SDCD                          WESDCD
     I              F4QZCD                          WEQZCD
     I              F4XWST                          WEXWST
     I              F4T9CD                          WET9CD
     I              F4UBCD                          WEUBCD
     I              F4CFC7                          WECFC7
     I              F4X1CD                          WEX1CD
     I              F4GASX                          WEGASX
     I              F4DUPR                          WEDUPR
     I              F4B6VL                          WEB6VL
     I              F4IANX                          WEIANX
     I              F4IBNX                          WEIBNX
     I              F4RPCD                          WERPCD
     I              F4NYDT                          WENYDT
     I              F4BZTM                          WEBZTM
     I              F4Z4NB                          WEZ4NB
     I              F4XACD                          WEXACD
     I              F4OANA                          WEOANA
     I              F4OKTX                          WEOKTX
     I              F4K4TX                          WEK4TX
     I              F4NBBO                          WENBBO
     I              F4OCFR                          WEOCFR
     I              F4C0C7                          WEC0C7
     I              F4A1AA                          WEA1AA
     I              F4VEST                          WEVEST
     I              F4A5PR                          WEA5PR
     I              F4CDPR                          WECDPR
     I              F4D0PR                          WED0PR
     I              F4D0VL                          WED0VL
     I              F4IRSX                          WEIRSX
     I              F4CEVL                          WECEVL
     I              F4ISSX                          WEISSX
     I              F4ITSX                          WEITSX
     I              F4IUSX                          WEIUSX
     I              F4OHDT                          WEOHDT
     I              F4D9PR                          WED9PR
     I              F4CFVL                          WECFVL
     I              F4UVST                          WEUVST
     I              F4UWST                          WEUWST
     I              F4UXST                          WEUXST
     I              F4AATM                          WEAATM
     I              F4AYNA                          WEAYNA
     I              F4A0NA                          WEA0NA
     I              F4AXDT                          WEAXDT
      *
     I@BDCPF7
      * A/R Header                Retrieval index       NV
      * Renamed input format fields
     I              BDAIC3                          WFAIC3
     I              BDCONB                          WFCONB
     I              BDCEST                          WFCEST
     I              BDUHCD                          WFUHCD
     I              BDBSVA                          WFBSVA
     I              BDAIVA                          WFAIVA
     I              BDAOVA                          WFAOVA
     I              BDBGVA                          WFBGVA
     I              BDAJST                          WFAJST
     I              BDE3ST                          WFE3ST
     I              BDG4CD                          WFG4CD
     I              BDCKNB                          WFCKNB
     I              BDCAC7                          WFCAC7
     I              BDBKC7                          WFBKC7
     I              BDBCCD                          WFBCCD
     I              BDR4CD                          WFR4CD
     I              BDB4DT                          WFB4DT
     I              BDATDT                          WFATDT
     I              BDH0DT                          WFH0DT
     I              BDH3DT                          WFH3DT
     I              BDH4DT                          WFH4DT
     I              BDH5DT                          WFH5DT
     I              BDANC7                          WFANC7
     I              BDCPTX                          WFCPTX
     I              BDBSDY                          WFBSDY
     I              BDUVST                          WFUVST
     I              BDUWST                          WFUWST
     I              BDUXST                          WFUXST
     I              BDAATM                          WFAATM
     I              BDAYNA                          WFAYNA
     I              BDA0NA                          WFA0NA
     I              BDAXDT                          WFAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Shipping Dtl Accrual
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Ship To Customer
     I                                    P   3   60P1BKC7
      * I :  Broker Code
     I                                        7  12 P1HHAA
      * I :  SDA Actual Ship Date
     I                                    P  13  160P1PODT
      * I :  Accrual Code
     I                                       17  19 P1OJCD
     IP2PARM      DS
      * B :  Sales Net Amount
     I                                    P   1   62P2SQVA
     IP3PARM      DS
      * N :  Period Beginning Date
     I                                    P   1   40P3BFDT
     IP4PARM      DS
      * N :  Period Ending Date
     I                                    P   1   40P4A2DT
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1BKC7    PARM           WP0002  70       Ship To Custome
     C           P1HHAA    PARM           WP0003  6        Broker Code
     C           P1PODT    PARM           WP0004  70       SDA Actual Ship
     C           P1OJCD    PARM           WP0005  3        Accrual Code
     C           P2SQVA    PARM P2SQVA    WP0006 112       Sales Net Amoun
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Accum Mo Sales $  XF
      * Rtv Calendar YR/Per.   RT - Calendar  * 
     C                     EXSR SARVGN
      * RTV First Dte of PeriodRT - Calendar Summary  * 
     C                     EXSR SBRVGN
      * RTV Last Date of PeriodRT - Calendar Summary  * 
     C                     EXSR SCRVGN
      * Rtv Accum Mo Sales $  RT - Shipping Dtl Accrual  * 
     C                     EXSR SDRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Calendar YR/Per.   RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WABCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADDP1AIC3    WAAIC3           Company Number
     C                     Z-ADDP1PODT    WABCDT           Post to G/L Dat
      * Establish starting position
     C           KRSSA     CHAIN@AFREBE              90    *
      * Data record not found
     C   90                MOVEL'USR0018' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDWAETNB    YL0002           Accounting Peri
     C                     Z-ADDWAESNB    YL0001           Accounting Year
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV First Dte of PeriodRT - Calendar Summary  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBESNB    WQSB02           Accounting Year
     C           *LIKE     DEFN WBETNB    WQSB03           Accounting Peri
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Accounting Year
     C                     KFLD           WQSB03           Accounting Peri
      * Setup key
     C                     Z-ADDP1AIC3    WQSB01           Company Number
     C                     Z-ADDYL0001    WQSB02           Accounting Year
     C                     Z-ADDYL0002    WQSB03           Accounting Peri
      * Establish starting position
     C           KRSSB     SETLL@ATRECF                    *
     C           KRSSB     READE@ATRECF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0060' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * PAR = CON By name
     C                     Z-ADD*ZERO     P3BFDT           Period Beginnin
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDWBBFDT    P3BFDT           Period Beginnin
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@ATRECF                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Last Date of PeriodRT - Calendar Summary  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAIC3    WQSC01           Company Number
     C           *LIKE     DEFN WCESNB    WQSC02           Accounting Year
     C           *LIKE     DEFN WCETNB    WQSC03           Accounting Peri
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Accounting Year
     C                     KFLD           WQSC03           Accounting Peri
      * Setup key
     C                     Z-ADDP1AIC3    WQSC01           Company Number
     C                     Z-ADDYL0001    WQSC02           Accounting Year
     C                     Z-ADDYL0002    WQSC03           Accounting Peri
      * Establish starting position
     C           KRSSC     SETLL@ATREY1                    *
     C           KRSSC     READE@ATREY1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0060' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * PAR = CON By name
     C                     Z-ADD*ZERO     P4A2DT           Period Ending D
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDWCA2DT    P4A2DT           Period Ending D
     C                     GOTO SCEXIT                     *QUIT
     C           KRSSC     READE@ATREY1                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Accum Mo Sales $  RT - Shipping Dtl Accrual  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       Order Number Sa
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     P2SQVA           Sales Net Amoun
     C                     Z-ADD*ZERO     WN0001           Order Number Sa
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDOJCD    WQSD01           Accrual Code
     C           *LIKE     DEFN WDHHAA    WQSD02           Broker Code
     C           *LIKE     DEFN WDBKC7    WQSD03           Ship To Custome
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WQSD01           Accrual Code
     C                     KFLD           WQSD02           Broker Code
     C                     KFLD           WQSD03           Ship To Custome
     C                     KFLD           WDPODT           SDA Actual Ship
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Accrual Code
     C                     KFLD           WQSD02           Broker Code
     C                     KFLD           WQSD03           Ship To Custome
      * Setup key
     C                     MOVELP1OJCD    WQSD01           Accrual Code
     C                     MOVELP1HHAA    WQSD02           Broker Code
     C                     Z-ADDP1BKC7    WQSD03           Ship To Custome
     C                     Z-ADDP3BFDT    WDPODT           SDA Actual Ship
      * Establish starting position
     C           KPSSD     SETLL@HRCPV6                    *
     C           KRSSD     READE@HRCPV6                  90*
      * Data record not found
     C   90                MOVEL'USR1526' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.SDA Actual Ship Date GE PAR.Period Beginning Dat
      *   |- c2    : DB1.SDA Actual Ship Date LE PAR.Period Ending Date
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WDPODT    IFGE P3BFDT                     *IF
     C           WDPODT    IFLE P4A2DT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * CASE: DB1.Order Number NE PAR.Order Number Saved USR
     C           WDC4NB    IFNE WN0001                     *IF
      * RTV Net Sales-been pd RT - Sales History  * 
     C                     EXSR SERVGN
     C                     ADD  YL0003    P2SQVA           Sales Net Amoun
      * Accum at order number break -  so save it
     C                     Z-ADDWDC4NB    WN0001           Order Number Sa
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSD     READE@HRCPV6                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV Net Sales-been pd RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0003           FOB Gross Amoun
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEAIC3    WQSE01           Company Number
     C           *LIKE     DEFN WEC4NB    WQSE02           Order Number
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           Company Number
     C                     KFLD           WQSE02           Order Number
      * Setup key
     C                     Z-ADDWDAIC3    WQSE01           Company Number
     C                     Z-ADDWDC4NB    WQSE02           Order Number
      * Establish starting position
     C           KRSSE     SETLL@FHSTD3                    *
     C           KRSSE     READE@FHSTD3                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Per the SEIDAI contract:
      *  Accum Sale Amount only if the Invoice has been paid in full
      * RTV Invoice/Remaining  RT - A/R Header  * 
     C                     EXSR SFRVGN
      * CASE: LCL.Remaining Balance Due is equal to zero
     C           YL0004    IFEQ *ZERO                      *IF
      * Compute:Net Sale Amt
      * PAR.FOB Gross Amount =
      *    *COMPUTE (x1 + x2 - x3)
      * x1    : PAR.FOB Gross Amount
      * +     : PGM.*Synon (15,2) work field
      * x2    : DB1.FOB Gross Amount
      * -     : PGM.*Synon (17,7) work field
      * x3    : DB1.Ledgrd Trd Fund Accrl Amt
     C           YL0003    ADD  WEUSVA    W0WA01           *Synon (15,2) w
     C           W0WA01    SUB  WEUNVA    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    YL0003           FOB Gross Amoun
     C                     END                             *FI
     C           KRSSE     READE@FHSTD3                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * RTV Invoice/Remaining  RT - A/R Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WFAIC3           Company Number
     C                     KFLD           WFCONB           Invoice Number
     C                     KFLD           WFCEST           Invoice Suffix
      * Setup key
     C                     Z-ADDWEAIC3    WFAIC3           Company Number
     C                     Z-ADDWECONB    WFCONB           Invoice Number
     C                     MOVELWECEST    WFCEST           Invoice Suffix
      * Establish starting position
     C           KRSSF     CHAIN@BDCPF7              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0174' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0004           Remaining Balan
     C                     Z-ADD*ZERO     YL0005           A/R Customer Nu
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWFBGVA    YL0004           Remaining Balan
     C                     Z-ADDWFANC7    YL0005           A/R Customer Nu
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P3BFDT           Period Beginnin
     C                     Z-ADD*ZERO     P4A2DT           Period Ending D
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WABCDT           Post to G/L Dat
     C                     Z-ADD*ZERO     WACQNB           Julian Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEINB           Week Number
     C                     Z-ADD*ZERO     WAAQNB           Billing Cycle
     C                     Z-ADD*ZERO     WAOJDT           HPS PIC Date
     C                     Z-ADD*ZERO     WANQNX           HPS Calendar Ye
     C                     Z-ADD*ZERO     WANRNX           HPS Calendar We
     C                     Z-ADD*ZERO     WAOKDT           Calendar Unused
     C                     Z-ADD*ZERO     WAOLDT           Calendar Unused
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBESNB           Accounting Year
     C                     Z-ADD*ZERO     WBETNB           Accounting Peri
     C                     Z-ADD*ZERO     WBBZNB           OM Week
     C                     Z-ADD*ZERO     WBBFDT           Period Beginnin
     C                     Z-ADD*ZERO     WBA2DT           Period Ending D
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDDXNB           Sequence Number
     C                     Z-ADD*ZERO     WDBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WDC5PC           Accrual Percent
     C                     Z-ADD*ZERO     WDAYVA           Extended Amount
     C                     Z-ADD*ZERO     WDEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WDHGCD           Item Code
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDDUC7           A/R Customer
     C                     Z-ADD*ZERO     WDPODT           SDA Actual Ship
     C                     Z-ADD*ZERO     WDBYWG           Weight Billed
     C                     Z-ADD*ZERO     WDPPDT           SDA Ord Dtl Acr
     C                     Z-ADD*ZERO     WDPQDT           SDA Unused Date
     C                     Z-ADD*ZERO     WDEEVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDEFVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDQ8DT           SDA Invoice Dat
     C                     Z-ADD*ZERO     WDH0NY           SDA G/L Sub Led
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEAIC3           Company Number
     C                     Z-ADD*ZERO     WEC4NB           Order Number
     C                     Z-ADD*ZERO     WEDPNB           Order Sequence
     C                     Z-ADD*ZERO     WEUENB           Order Secondary
     C                     Z-ADD*ZERO     WEBTC7           Parent Customer
     C                     Z-ADD*ZERO     WEANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WEBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WEA0DT           Order Date
     C                     Z-ADD*ZERO     WEACDT           Cancel Date
     C                     Z-ADD*ZERO     WETBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WEATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WET3NB           Attach to Order
     C                     Z-ADD*ZERO     WERSRN           Resell Referenc
     C                     Z-ADD*ZERO     WEORIT           Original Item
     C                     Z-ADD*ZERO     WEAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WED0WG           Weight Ordered
     C                     Z-ADD*ZERO     WECCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WEAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WEAKPR           Unit Price
     C                     Z-ADD*ZERO     WEAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WEA5DT           Requested Ship
     C                     Z-ADD*ZERO     WEAWDT           Invoice Date
     C                     Z-ADD*ZERO     WEHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WEAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WEAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WEAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WEAYVA           Extended Amount
     C                     Z-ADD*ZERO     WEL6NB           Contract Number
     C                     Z-ADD*ZERO     WEHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WEESNB           Accounting Year
     C                     Z-ADD*ZERO     WEETNB           Accounting Peri
     C                     Z-ADD*ZERO     WEBZNB           OM Week
     C                     Z-ADD*ZERO     WEEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WEBYWG           Weight Billed
     C                     Z-ADD*ZERO     WES5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WEMAVA           Billing Detail
     C                     Z-ADD*ZERO     WEKDVA           Billing Detail
     C                     Z-ADD*ZERO     WEUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WEUTVA           Standard Overag
     C                     Z-ADD*ZERO     WEA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WECKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WER8NB           Shipping Compan
     C                     Z-ADD*ZERO     WEBZPR           Price Overage O
     C                     Z-ADD*ZERO     WEEXDT           Market Pricing
     C                     Z-ADD*ZERO     WERGNB           Item Structure
     C                     Z-ADD*ZERO     WERHNB           Item Structure
     C                     Z-ADD*ZERO     WERINB           Item Structure
     C                     Z-ADD*ZERO     WER1NB           Rated Freight
     C                     Z-ADD*ZERO     WECONB           Invoice Number
     C                     Z-ADD*ZERO     WEGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WERMNB           Load ID
     C                     Z-ADD*ZERO     WEAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WESKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WESLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WESMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WEONVA           Actual Freight
     C                     Z-ADD*ZERO     WEB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WEB5NB           PM Line Number
     C                     Z-ADD*ZERO     WEGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WEULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WEUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WEUOVA           Commission Amou
     C                     Z-ADD*ZERO     WEUPVA           Financials Amou
     C                     Z-ADD*ZERO     WEUQVA           Financials Amou
     C                     Z-ADD*ZERO     WECFC7           Order Group Cod
     C                     Z-ADD*ZERO     WEDUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WEB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WEIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WEIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WENYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WEBZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WEZ4NB           MPC Number
     C                     Z-ADD*ZERO     WEOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WEC0C7           Claim Number
     C                     Z-ADD*ZERO     WEA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WEA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WECDPR           Market Value
     C                     Z-ADD*ZERO     WED0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WED0VL           Raw Material Co
     C                     Z-ADD*ZERO     WECEVL           Sales Expense T
     C                     Z-ADD*ZERO     WEOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WED9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WECFVL           HST Item Target
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFAIC3           Company Number
     C                     Z-ADD*ZERO     WFCONB           Invoice Number
     C                     Z-ADD*ZERO     WFBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WFAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WFAOVA           Amount Paid
     C                     Z-ADD*ZERO     WFBGVA           Remaining Balan
     C                     Z-ADD*ZERO     WFCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WFCAC7           Order Number Re
     C                     Z-ADD*ZERO     WFBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WFB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WFATDT           Due Date
     C                     Z-ADD*ZERO     WFH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WFH3DT           Unused Date Cod
     C                     Z-ADD*ZERO     WFH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WFH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WFANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WFBSDY           Days to Pay
     C                     Z-ADD*ZERO     WFAATM           Job Time
     C                     Z-ADD*ZERO     WFAXDT           Job Date
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WA01 152       *Synon (15,2) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Accounting Year Code
     C                     Z-ADD*ZERO     YL0001  40
      * Define local work field Accounting Period Code
     C                     Z-ADD*ZERO     YL0002  20
      * Define local work field FOB Gross Amount
     C                     Z-ADD*ZERO     YL0003 112
      * Define local work field Remaining Balance Due
     C                     Z-ADD*ZERO     YL0004 112
      * Define local work field A/R Customer Number
     C                     Z-ADD*ZERO     YL0005  70
      *================================================================
     CSR         ZZEXIT    ENDSR
