// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBUGDFR
// ?Date: 14.08.2025 Time: 03:49:27
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// LCL.First Time Flag = CND.Yes
LCL.First_Time_Flag = 'Y';

//?USER: Initialize subfile control

//?First Time Logic
CASE;

// IF LCL.First Time Flag is Yes
IF LCL.First_Time_Flag = 'Y';

// CTL.Record Status = CND.Active
CTL.Record_Status = 'A';

// LCL.First Time Flag = CND.NO
LCL.First_Time_Flag = 'N';

ENDIF;

//?USER: Process subfile control (Pre-confirm)

//?F6=Create
CASE;

// IF CTL.*CMD key is CF06
IF CTL.*CMD_key = '06';

// LCL.Sales Channel Code = CND.Not Entered
LCL.Sales_Channel_Code = *BLANK;

// Call program Pmt Sales Chnl Mkt    PV.
CALL PROGRAM(Pmt Sales Chnl Mkt    PV) ('PBUKPVR');
PARAMETER(LCL.Sales_Channel_Code);
PARAMETER(LCL.SC_Market_Code);

CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

//?S16143 DN 02/17/20-Added Parms STC, SST & USR Update Flag. Not used here.
// Call program Edt Sales Chnl Mkt    E1.
CALL PROGRAM(Edt Sales Chnl Mkt    E1) ('PBT4E1R');
PARAMETER(LCL.Sales_Channel_Code);
PARAMETER(LCL.SC_Market_Code);
PARAMETER(LCL.SC_Market_Description);
PARAMETER(LCL.SC_Territory_Code);
PARAMETER(LCL.Zero_USR);
PARAMETER(LCL.Zero_USR);
PARAMETER(LCL.USR_Update_Flag);

CASE;

// IF LCL.SC Market Description is Entered
IF LCL.SC_Market_Description <> *BLANK;

// AND LCL.SC Territory Code is Entered
AND LCL.SC_Territory_Code <> *BLANK;

// CTL.Sales Channel Code = LCL.Sales Channel Code
CTL.Sales_Channel_Code = LCL.Sales_Channel_Code;

// Send information message - 'Sales Channel Territory '&1' added.'
MESSAGE(USR4877 *INFO);
MSGPARM(LCL.SC_Market_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// Send information message - 'Sales Channel Market NOT added.'
MESSAGE(USR4875 *INFO);

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// Send information message - 'Sales Channel Market NOT added.'
MESSAGE(USR4875 *INFO);

ENDIF;

ENDIF;

//?USER: Process subfile record (Pre-confirm)

//?1=Select
CASE;

// IF RCD.*SFLSEL is *Select#1
IF RCD.*SFLSEL = '1';

// PAR.Sales Channel Code = RCD.Sales Channel Code
PAR.Sales_Channel_Code = RCD.Sales_Channel_Code;

// PAR.SC Market Code = RCD.SC Market Code
PAR.SC_Market_Code = RCD.SC_Market_Code;

PGM.*Return_code = *BLANK;

RETURN;

ENDIF;

