/*********************************************************************/
/* PROGRAM    : PNHOUPC                                              */
/* TITLE      : EXECUTE SEQUEL VIEW                                  */
/* DATE       : 04/13/2009                                           */
/* Description: EXECUTE A SEQUEL VIEW COMMAND AND SEND THE RESULT    */
/*                TO A RECIPIENT                                     */
/*                THIS IS THE WAY TO SEND *XLS REPORTS               */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &VIEW       SEQUEL VIEW BEING EMAILED                    */
/*    I     &TEXT       TEXT FOR EMAIL MESSAGE                       */
/*    I     &EMAIL      EMAIL ADDRESS BEING EMAILED TO               */
/*    I     &PCFMT      FORMAT FOR THE VIEW                          */
/*********************************************************************/
/* Modifications:                                                    */
/*-------------------------------------------------------------------*/
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*                                                                   */
/*********************************************************************/
 PNHOUPC:    PGM        PARM(&VIEW &TEXT &EMAIL &PCFMT)

/*-------------------------------------------------------------------*/
/* Declare Variables                                                 */
/*-------------------------------------------------------------------*/
             DCL        VAR(&VIEW)     TYPE(*CHAR) LEN(10)
             DCL        VAR(&TEXT)     TYPE(*CHAR) LEN(50)
             DCL        VAR(&EMAIL)    TYPE(*CHAR) LEN(50)
             DCL        VAR(&PCFMT)    TYPE(*CHAR) LEN(10)

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

/*-------------------------------------------------------------------*/
/* SEND A COPY OF THE SPOOLED FILE AS AN ATTACHMENT TO THE EMAIL     */
/* ADDRESS THAT IS PASSED IN                                         */
/*-------------------------------------------------------------------*/

             EXECUTE    VIEW(&VIEW) MBROPT(*REPLACE) PCFMT(&PCFMT) +
                          REPLACE(*YES) RECIPIENT(&EMAIL) EMLMSG(&TEXT)

             MONMSG     MSGID(CPF9999 EML9999) EXEC(GOTO +
                          CMDLBL(MSGTRAP))

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ENDPGM))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000)

 ENDPGM:     ENDPGM
