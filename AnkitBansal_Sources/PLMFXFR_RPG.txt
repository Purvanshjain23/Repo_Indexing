     H/TITLE Dlt CMP & Lower Files XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 01:32:00
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKAQCPL7IF  E           K        DISK
      * RSQ : Producer Sub-Contract     Chk Crcs Mrt/Prd Sbcn
      *
     FPKAWCPLCIF  E           K        DISK
      * RSQ : Buy Order Header          Chk CMP
      *
     FPKB0REL1IF  E           K        DISK
      * RTV : Carcass Merit Prog Com    Retrieval index
      *
     FPKBZREL1IF  E           K        DISK
      * RTV : Carcass Merit Matrix Col  Retrieval index
      *
     FPKBYREL1IF  E           K        DISK
      * RTV : Carcass Merit Matrix Row  Retrieval index
      *
     FPKB0REL0UF  E           K        DISK
      * UPD : Carcass Merit Prog Com    Update index
      *
     FPKBZREL0UF  E           K        DISK
      * UPD : Carcass Merit Matrix Col  Update index
      *
     FPKBYREL0UF  E           K        DISK
      * UPD : Carcass Merit Matrix Row  Update index
      *
     FPKARREL1UF  E           K        DISK
      * UPD : Carcass Merit Program     Update index
      *
     I@AQCPLP
      * Producer Sub-Contract     Chk Crcs Mrt/Prd Sbcn
      * Renamed input format fields
     I              AQAKCD                          WAAKCD
     I              AQALCD                          WAALCD
     I              AQAHDT                          WAAHDT
     I              AQA2ST                          WAA2ST
     I              AQAZPR                          WAAZPR
     I              AQA0PR                          WAA0PR
     I              AQA9PC                          WAA9PC
     I              AQA7PR                          WAA7PR
     I              AQA8PR                          WAA8PR
     I              AQF3ST                          WAF3ST
     I              AQA9PR                          WAA9PR
     I              AQERCD                          WAERCD
     I              AQESCD                          WAESCD
     I              AQF6PR                          WAF6PR
     I              AQJ3TX                          WAJ3TX
     I              AQABCD                          WAABCD
     I              AQAECD                          WAAECD
     I              AQAGCD                          WAAGCD
     I              AQAICD                          WAAICD
     I              AQAMCD                          WAAMCD
     I              AQAAVN                          WAAAVN
     I              AQAADT                          WAAADT
     I              AQAMTM                          WAAMTM
     I              AQAJST                          WAAJST
     I              AQAHVN                          WAAHVN
     I              AQAGVN                          WAAGVN
     I              AQABVN                          WAABVN
     I              AQABDT                          WAABDT
     I              AQABTM                          WAABTM
      *
     I@AWCPSB
      * Buy Order Header          Chk CMP
      * Renamed input format fields
     I              AWHMNB                          WBHMNB
     I              AWBNNB                          WBBNNB
     I              AWARDT                          WBARDT
     I              AWASDT                          WBASDT
     I              AWA4ST                          WBA4ST
     I              AWA5ST                          WBA5ST
     I              AWAAPR                          WBAAPR
     I              AWA6ST                          WBA6ST
     I              AWA7ST                          WBA7ST
     I              AWB3ST                          WBB3ST
     I              AWALPR                          WBALPR
     I              AWETCD                          WBETCD
     I              AWEUCD                          WBEUCD
     I              AWJ5TX                          WBJ5TX
     I              AWD5DT                          WBD5DT
     I              AWD6DT                          WBD6DT
     I              AWD7DT                          WBD7DT
     I              AWD8DT                          WBD8DT
     I              AWD9DT                          WBD9DT
     I              AWJOEJ                          WBJOEJ
     I              AWKOFF                          WBKOFF
     I              AWKWPE                          WBKWPE
     I              AWIMBF                          WBIMBF
     I              AWOPTR                          WBOPTR
     I              AWOEJD                          WBOEJD
     I              AWIRMF                          WBIRMF
     I              AWJIRM                          WBJIRM
     I              AWJRKF                          WBJRKF
     I              AWKFIR                          WBKFIR
     I              AWUZST                          WBUZST
     I              AWU0ST                          WBU0ST
     I              AWU1ST                          WBU1ST
     I              AWU2ST                          WBU2ST
     I              AWU3ST                          WBU3ST
     I              AWHXNB                          WBHXNB
     I              AWGANB                          WBGANB
     I              AWGBNB                          WBGBNB
     I              AWABCD                          WBABCD
     I              AWAECD                          WBAECD
     I              AWAKCD                          WBAKCD
     I              AWALCD                          WBALCD
     I              AWAGCD                          WBAGCD
     I              AWAICD                          WBAICD
     I              AWAMCD                          WBAMCD
     I              AWACCD                          WBACCD
     I              AWAAVN                          WBAAVN
     I              AWAADT                          WBAADT
     I              AWAMTM                          WBAMTM
     I              AWAJST                          WBAJST
     I              AWAHVN                          WBAHVN
     I              AWAGVN                          WBAGVN
     I              AWABVN                          WBABVN
     I              AWABDT                          WBABDT
     I              AWABTM                          WBABTM
      *
     I@B0REGL
      * Carcass Merit Prog Com    Retrieval index
      * Renamed input format fields
     I              B0AMCD                          WCAMCD
     I              B0ESNB                          WCESNB
     I              B0B5TX                          WCB5TX
     I              B0ENST                          WCENST
     I              B0AAVN                          WCAAVN
     I              B0AADT                          WCAADT
     I              B0AMTM                          WCAMTM
     I              B0AJST                          WCAJST
     I              B0AHVN                          WCAHVN
     I              B0AGVN                          WCAGVN
     I              B0ABVN                          WCABVN
     I              B0ABDT                          WCABDT
     I              B0ABTM                          WCABTM
      *
     I@B0REGK
      * Carcass Merit Prog Com    Update index
      * Renamed input format fields
     I              B0AMCD                          WDAMCD
     I              B0ESNB                          WDESNB
     I              B0B5TX                          WDB5TX
     I              B0ENST                          WDENST
     I              B0AAVN                          WDAAVN
     I              B0AADT                          WDAADT
     I              B0AMTM                          WDAMTM
     I              B0AJST                          WDAJST
     I              B0AHVN                          WDAHVN
     I              B0AGVN                          WDAGVN
     I              B0ABVN                          WDABVN
     I              B0ABDT                          WDABDT
     I              B0ABTM                          WDABTM
      *
     I@BZREGI
      * Carcass Merit Matrix Col  Retrieval index
      * Renamed input format fields
     I              BZAMCD                          WEAMCD
     I              BZE8NB                          WEE8NB
     I              BZE4NB                          WEE4NB
     I              BZA1PC                          WEA1PC
     I              BZE7NB                          WEE7NB
     I              BZCHCD                          WECHCD
     I              BZERNB                          WEERNB
     I              BZAAVN                          WEAAVN
     I              BZAADT                          WEAADT
     I              BZAMTM                          WEAMTM
     I              BZAJST                          WEAJST
     I              BZAHVN                          WEAHVN
     I              BZAGVN                          WEAGVN
     I              BZABVN                          WEABVN
     I              BZABDT                          WEABDT
     I              BZABTM                          WEABTM
      *
     I@BZREGH
      * Carcass Merit Matrix Col  Update index
      * Renamed input format fields
     I              BZAMCD                          WFAMCD
     I              BZE8NB                          WFE8NB
     I              BZE4NB                          WFE4NB
     I              BZA1PC                          WFA1PC
     I              BZE7NB                          WFE7NB
     I              BZCHCD                          WFCHCD
     I              BZERNB                          WFERNB
     I              BZAAVN                          WFAAVN
     I              BZAADT                          WFAADT
     I              BZAMTM                          WFAMTM
     I              BZAJST                          WFAJST
     I              BZAHVN                          WFAHVN
     I              BZAGVN                          WFAGVN
     I              BZABVN                          WFABVN
     I              BZABDT                          WFABDT
     I              BZABTM                          WFABTM
      *
     I@BYREGF
      * Carcass Merit Matrix Row  Retrieval index
      * Renamed input format fields
     I              BYAMCD                          WGAMCD
     I              BYE8NB                          WGE8NB
     I              BYEGNB                          WGEGNB
     I              BYEHNB                          WGEHNB
     I              BYEINB                          WGEINB
     I              BYEJNB                          WGEJNB
     I              BYEKNB                          WGEKNB
     I              BYAQPC                          WGAQPC
     I              BYEMNB                          WGEMNB
     I              BYE2NB                          WGE2NB
     I              BYLJA1                          WGLJA1
     I              BYAAVN                          WGAAVN
     I              BYAADT                          WGAADT
     I              BYAMTM                          WGAMTM
     I              BYAJST                          WGAJST
     I              BYAHVN                          WGAHVN
     I              BYAGVN                          WGAGVN
     I              BYABVN                          WGABVN
     I              BYABDT                          WGABDT
     I              BYABTM                          WGABTM
      *
     I@BYREGE
      * Carcass Merit Matrix Row  Update index
      * Renamed input format fields
     I              BYAMCD                          WHAMCD
     I              BYE8NB                          WHE8NB
     I              BYEGNB                          WHEGNB
     I              BYEHNB                          WHEHNB
     I              BYEINB                          WHEINB
     I              BYEJNB                          WHEJNB
     I              BYEKNB                          WHEKNB
     I              BYAQPC                          WHAQPC
     I              BYEMNB                          WHEMNB
     I              BYE2NB                          WHE2NB
     I              BYLJA1                          WHLJA1
     I              BYAAVN                          WHAAVN
     I              BYAADT                          WHAADT
     I              BYAMTM                          WHAMTM
     I              BYAJST                          WHAJST
     I              BYAHVN                          WHAHVN
     I              BYAGVN                          WHAGVN
     I              BYABVN                          WHABVN
     I              BYABDT                          WHABDT
     I              BYABTM                          WHABTM
      *
     I@ARREBG
      * Carcass Merit Program     Update index
      * Renamed input format fields
     I              ARAMCD                          WIAMCD
     I              ARA3TX                          WIA3TX
     I              ARDLST                          WIDLST
     I              ARDMST                          WIDMST
     I              ARDOST                          WIDOST
     I              ARDQST                          WIDQST
     I              ARAZPC                          WIAZPC
     I              ARA0PC                          WIA0PC
     I              ARDTST                          WIDTST
     I              ARF5ST                          WIF5ST
     I              ARI1PR                          WII1PR
     I              ARVEPR                          WIVEPR
     I              ARVFPR                          WIVFPR
     I              ARVHPR                          WIVHPR
     I              ARVIPR                          WIVIPR
     I              ARVJPR                          WIVJPR
     I              ARZ2ST                          WIZ2ST
     I              ARZ3ST                          WIZ3ST
     I              ARZ4ST                          WIZ4ST
     I              ARAAVN                          WIAAVN
     I              ARAADT                          WIAADT
     I              ARAMTM                          WIAMTM
     I              ARAJST                          WIAJST
     I              ARAHVN                          WIAHVN
     I              ARAGVN                          WIAGVN
     I              ARABVN                          WIABVN
     I              ARABDT                          WIABDT
     I              ARABTM                          WIABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKB01    E DSPKB0REL0
      * UPD : Carcass Merit Prog Com    Update index
      * Renamed input format fields
     I              B0AMCD                          WDAMCD
     I              B0ESNB                          WDESNB
     I              B0B5TX                          WDB5TX
     I              B0ENST                          WDENST
     I              B0AAVN                          WDAAVN
     I              B0AADT                          WDAADT
     I              B0AMTM                          WDAMTM
     I              B0AJST                          WDAJST
     I              B0AHVN                          WDAHVN
     I              B0AGVN                          WDAGVN
     I              B0ABVN                          WDABVN
     I              B0ABDT                          WDABDT
     I              B0ABTM                          WDABTM
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPKBZ1    E DSPKBZREL0
      * UPD : Carcass Merit Matrix Col  Update index
      * Renamed input format fields
     I              BZAMCD                          WFAMCD
     I              BZE8NB                          WFE8NB
     I              BZE4NB                          WFE4NB
     I              BZA1PC                          WFA1PC
     I              BZE7NB                          WFE7NB
     I              BZCHCD                          WFCHCD
     I              BZERNB                          WFERNB
     I              BZAAVN                          WFAAVN
     I              BZAADT                          WFAADT
     I              BZAMTM                          WFAMTM
     I              BZAJST                          WFAJST
     I              BZAHVN                          WFAHVN
     I              BZAGVN                          WFAGVN
     I              BZABVN                          WFABVN
     I              BZABDT                          WFABDT
     I              BZABTM                          WFABTM
      *
     IQPKBY1    E DSPKBYREL0
      * UPD : Carcass Merit Matrix Row  Update index
      * Renamed input format fields
     I              BYAMCD                          WHAMCD
     I              BYE8NB                          WHE8NB
     I              BYEGNB                          WHEGNB
     I              BYEHNB                          WHEHNB
     I              BYEINB                          WHEINB
     I              BYEJNB                          WHEJNB
     I              BYEKNB                          WHEKNB
     I              BYAQPC                          WHAQPC
     I              BYEMNB                          WHEMNB
     I              BYE2NB                          WHE2NB
     I              BYLJA1                          WHLJA1
     I              BYAAVN                          WHAAVN
     I              BYAADT                          WHAADT
     I              BYAMTM                          WHAMTM
     I              BYAJST                          WHAJST
     I              BYAHVN                          WHAHVN
     I              BYAGVN                          WHAGVN
     I              BYABVN                          WHABVN
     I              BYABDT                          WHABDT
     I              BYABTM                          WHABTM
      *
     IQPKAR1    E DSPKARREL1
      * UPD : Carcass Merit Program     Update index
      * Renamed input format fields
     I              ARAMCD                          WIAMCD
     I              ARA3TX                          WIA3TX
     I              ARDLST                          WIDLST
     I              ARDMST                          WIDMST
     I              ARDOST                          WIDOST
     I              ARDQST                          WIDQST
     I              ARAZPC                          WIAZPC
     I              ARA0PC                          WIA0PC
     I              ARDTST                          WIDTST
     I              ARF5ST                          WIF5ST
     I              ARI1PR                          WII1PR
     I              ARVEPR                          WIVEPR
     I              ARVFPR                          WIVFPR
     I              ARVHPR                          WIVHPR
     I              ARVIPR                          WIVIPR
     I              ARVJPR                          WIVJPR
     I              ARZ2ST                          WIZ2ST
     I              ARZ3ST                          WIZ3ST
     I              ARZ4ST                          WIZ4ST
     I              ARAAVN                          WIAAVN
     I              ARAADT                          WIAADT
     I              ARAMTM                          WIAMTM
     I              ARAJST                          WIAJST
     I              ARAHVN                          WIAHVN
     I              ARAGVN                          WIAGVN
     I              ARABVN                          WIABVN
     I              ARABDT                          WIABDT
     I              ARABTM                          WIABTM
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * B : MAP *Return code
     I                                        1   7 P1RTN
     IP2PARM      DS
      * FLD: Carcass Merit Program
      * I : MAP CMP Program Code
     I                                        1   3 P2AMCD
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1RTN     PARM P1RTN     WP0001  7        *Return code
     C           P2AMCD    PARM           WP0002  3        CMP Program Cod
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Dlt CMP & Lower Files XF
      * Modifications
      * 11/05/2020 ISE H16853 - Recompiled due to change in Buy Order Num
      * Chk Crcs Mrt/Prd Sc    Rt - Producer Sub-Contract  * 
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Chk CMP in BOH        RT - Buy Order Header  * 
     C                     EXSR SBRVGN
     C                     END                             *FI
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * DLT Carc Mrt Pgm Com  RT - Carcass Merit Prog Com  * 
     C                     EXSR SCRVGN
      * DLT CMM COL DelCMP    RT - Carcass Merit Matrix Col  * 
     C                     EXSR SERVGN
      * Dlt CMM Row DelCMP    RT - Carcass Merit Matrix Row  * 
     C                     EXSR SGRVGN
      * Dlt Carc Merit Pgm    DO - Carcass Merit Program  * 
     C                     EXSR SJDLRC
     C                     MOVEL*BLANK    P1RTN            *Return code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELW0RTN     P1RTN            *Return code
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Chk Crcs Mrt/Prd Sc    Rt - Producer Sub-Contract  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAMCD    WQSA01           CMP Program Cod
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           CMP Program Cod
      * Setup key
     C                     MOVELP2AMCD    WQSA01           CMP Program Cod
      * Establish starting position
     C           KRSSA     SETLL@AQCPLP                    *
     C           KRSSA     READE@AQCPLP                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0037' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'999'     W0RTN            *Return code
      * Send message 'Prdcr Sub-Contract Exists'
     C                     MOVEL'PRK0264' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@AQCPLP                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Chk CMP in BOH        RT - Buy Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAMCD    WQSB01           CMP Program Cod
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           CMP Program Cod
      * Setup key
     C                     MOVELP2AMCD    WQSB01           CMP Program Cod
      * Establish starting position
     C           KRSSB     SETLL@AWCPSB                    *
     C           KRSSB     READE@AWCPSB                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0049' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'999'     W0RTN            *Return code
      * Send message 'Buy Order Header Exists.'
     C                     MOVEL'PRK0263' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@AWCPSB                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * DLT Carc Mrt Pgm Com  RT - Carcass Merit Prog Com  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAMCD    WQSC01           CMP Program Cod
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           CMP Program Cod
      * Setup key
     C                     MOVELP2AMCD    WQSC01           CMP Program Cod
      * Establish starting position
     C           KRSSC     SETLL@B0REGL                    *
     C           KRSSC     READE@B0REGL                  90*
      * Data record not found
     C   90                MOVEL'PRK0136' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * DLT Carc Mrt Prg Com  DO - Carcass Merit Prog Com  * 
     C                     EXSR SDDLRC
     C           KRSSC     READE@B0REGL                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * DLT Carc Mrt Prg Com  DO - Carcass Merit Prog Com  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @B0REGK
     C                     MOVELWCAMCD    WDAMCD           CMP Program Cod
     C                     Z-ADDWCESNB    WDESNB           CMPC Comment Li
      *
     C           KLDLSD    KLIST
     C                     KFLD           WDAMCD           CMP Program Cod
     C                     KFLD           WDESNB           CMPC Comment Li
     C           KLDLSD    CHAIN@B0REGK              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKB0REL0'MDACP
     C                     MOVEL'@B0REGK' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@B0REGK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * DLT CMM COL DelCMP    RT - Carcass Merit Matrix Col  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEAMCD    WQSE01           CMP Program Cod
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           CMP Program Cod
      * Setup key
     C                     MOVELP2AMCD    WQSE01           CMP Program Cod
      * Establish starting position
     C           KRSSE     SETLL@BZREGI                    *
     C           KRSSE     READE@BZREGI                  90*
      * Data record not found
     C   90                MOVEL'PRK0134' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Dlt CMM COl           DO - Carcass Merit Matrix Col  * 
     C                     EXSR SFDLRC
     C           KRSSE     READE@BZREGI                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * Dlt CMM COl           DO - Carcass Merit Matrix Col  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BZREGH
     C                     MOVELWEAMCD    WFAMCD           CMP Program Cod
     C                     Z-ADDWEE8NB    WFE8NB           CMMR Row Number
     C                     Z-ADDWEE4NB    WFE4NB           CMMC Column Num
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFAMCD           CMP Program Cod
     C                     KFLD           WFE8NB           CMMR Row Number
     C                     KFLD           WFE4NB           CMMC Column Num
     C           KLDLSF    CHAIN@BZREGH              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKBZREL0'MDACP
     C                     MOVEL'@BZREGH' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BZREGH                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Dlt CMM Row DelCMP    RT - Carcass Merit Matrix Row  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGAMCD    WQSG01           CMP Program Cod
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           CMP Program Cod
      * Setup key
     C                     MOVELP2AMCD    WQSG01           CMP Program Cod
      * Establish starting position
     C           KRSSG     SETLL@BYREGF                    *
     C           KRSSG     READE@BYREGF                  90*
      * Data record not found
     C   90                MOVEL'PRK0132' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Dlt Carc Mrt Matr ROW DO - Carcass Merit Matrix Row  * 
     C                     EXSR SHDLRC
     C           KRSSG     READE@BYREGF                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHDLRC    BEGSR
      *================================================================
      * Dlt Carc Mrt Matr ROW DO - Carcass Merit Matrix Row  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data update
     C                     MOVEL*BLANK    W0RTN            *Return code
      * Chk Col               RT - Carcass Merit Matrix Col  * 
     C                     EXSR SIRVGN
      * CASE: PGM.*Return code is Record Found
     C           W0RTN     IFEQ '999'                      *IF
      * Send message 'Delete other files first'
     C                     MOVEL'PRK0226' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO SHEXIT                     *QUIT
     C                     END                             *FI
      * Move key fields to @BYREGE
     C                     MOVELWGAMCD    WHAMCD           CMP Program Cod
     C                     Z-ADDWGE8NB    WHE8NB           CMMR Row Number
      *
     C           KLDLSH    KLIST
     C                     KFLD           WHAMCD           CMP Program Cod
     C                     KFLD           WHE8NB           CMMR Row Number
     C           KLDLSH    CHAIN@BYREGE              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKBYREL0'MDACP
     C                     MOVEL'@BYREGE' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BYREGE                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Chk Col               RT - Carcass Merit Matrix Col  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEAMCD    WQSI01           CMP Program Cod
     C           *LIKE     DEFN WEE8NB    WQSI02           CMMR Row Number
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WQSI01           CMP Program Cod
     C                     KFLD           WQSI02           CMMR Row Number
      * Setup key
     C                     MOVELWGAMCD    WQSI01           CMP Program Cod
     C                     Z-ADDWGE8NB    WQSI02           CMMR Row Number
      * Establish starting position
     C           KRSSI     SETLL@BZREGI                    *
     C           KRSSI     READE@BZREGI                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0134' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SIEXIT                     *QUIT
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'999'     W0RTN            *Return code
     C                     GOTO SIEXIT                     *QUIT
     C           KRSSI     READE@BZREGI                  90*
     C                     ENDDO
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJDLRC    BEGSR
      *================================================================
      * Dlt Carc Merit Pgm    DO - Carcass Merit Program  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @ARREBG
     C                     MOVELP2AMCD    WIAMCD           CMP Program Cod
      *
     C           KLDLSJ    KLIST
     C                     KFLD           WIAMCD           CMP Program Cod
     C           KLDLSJ    CHAIN@ARREBG              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKARREL1'MDACP
     C                     MOVEL'@ARREBG' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@ARREBG                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAHDT           PSC Date
     C                     Z-ADD*ZERO     WAAZPR           PSC Floor Price
     C                     Z-ADD*ZERO     WAA0PR           PSC Ceiling Pri
     C                     Z-ADD*ZERO     WAA9PC           PSC Market Perc
     C                     Z-ADD*ZERO     WAA7PR           PSC Break Even
     C                     Z-ADD*ZERO     WAA8PR           PSC FLoor Price
     C                     Z-ADD*ZERO     WAA9PR           PSC Mkt Percent
     C                     Z-ADD*ZERO     WAF6PR           PSC Mkt + or -
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WBBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WBARDT           BOH Buy Order D
     C                     Z-ADD*ZERO     WBASDT           BOH Kill Date
     C                     Z-ADD*ZERO     WBAAPR           BOH Market Add/
     C                     Z-ADD*ZERO     WBALPR           BOH Quoted Base
     C                     Z-ADD*ZERO     WBD5DT           BOH MPR Reporti
     C                     Z-ADD*ZERO     WBD6DT           BOH Hedge Date
     C                     Z-ADD*ZERO     WBD7DT           BOH Unused Date
     C                     Z-ADD*ZERO     WBD8DT           BOH Unused Date
     C                     Z-ADD*ZERO     WBD9DT           BOH Unused Date
     C                     Z-ADD*ZERO     WBJOEJ           BOH Hedge Head
     C                     Z-ADD*ZERO     WBKOFF           BOH Hedge Refer
     C                     Z-ADD*ZERO     WBKWPE           BOH Hedge Time
     C                     Z-ADD*ZERO     WBIMBF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBOPTR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBOEJD           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBIRMF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBJIRM           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBJRKF           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBKFIR           BOH Unused Nbr
     C                     Z-ADD*ZERO     WBHXNB           PPWS Company Nu
     C                     Z-ADD*ZERO     WBGANB           CW Year
     C                     Z-ADD*ZERO     WBGBNB           CW Week Number
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCESNB           CMPC Comment Li
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEE8NB           CMMR Row Number
     C                     Z-ADD*ZERO     WEE4NB           CMMC Column Num
     C                     Z-ADD*ZERO     WEA1PC           CMMC Lean Perce
     C                     Z-ADD*ZERO     WEE7NB           CMMC Backfat In
     C                     Z-ADD*ZERO     WEERNB           CMMC Premium Va
     C                     Z-ADD*ZERO     WEAADT           RS Date Changed
     C                     Z-ADD*ZERO     WEAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WEABDT           RS Date Added
     C                     Z-ADD*ZERO     WEABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGE8NB           CMMR Row Number
     C                     Z-ADD*ZERO     WGEGNB           CMMR Carc Wgt M
     C                     Z-ADD*ZERO     WGEHNB           CMMR Carc Wgt M
     C                     Z-ADD*ZERO     WGEINB           CMMR Carc Wgt M
     C                     Z-ADD*ZERO     WGEJNB           CMMR Live Wgt M
     C                     Z-ADD*ZERO     WGEKNB           CMMR Live Wgt M
     C                     Z-ADD*ZERO     WGAQPC           CMMR Std Dressi
     C                     Z-ADD*ZERO     WGEMNB           CMMR Sort Disco
     C                     Z-ADD*ZERO     WGE2NB           CMMR Unused Fie
     C                     Z-ADD*ZERO     WGLJA1           CMMR Midpoint
     C                     Z-ADD*ZERO     WGAADT           RS Date Changed
     C                     Z-ADD*ZERO     WGAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WGABDT           RS Date Added
     C                     Z-ADD*ZERO     WGABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WIAZPC           CMP Std Lean Pe
     C                     Z-ADD*ZERO     WIA0PC           CMP Lean Factor
     C                     Z-ADD*ZERO     WII1PR           CMP Market Add/
     C                     Z-ADD*ZERO     WIVEPR           CMP % of Carcas
     C                     Z-ADD*ZERO     WIVFPR           CMP Fixed Cost
     C                     Z-ADD*ZERO     WIVHPR           CMP Grade Type
     C                     Z-ADD*ZERO     WIVIPR           CMP Unused Pric
     C                     Z-ADD*ZERO     WIVJPR           CMP Unused Pric
     C                     Z-ADD*ZERO     WIAADT           RS Date Changed
     C                     Z-ADD*ZERO     WIAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WIABDT           RS Date Added
     C                     Z-ADD*ZERO     WIABTM           RS Time Added
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
