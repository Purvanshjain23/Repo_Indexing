// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBMMXFR
// ?Date: 14.08.2025 Time: 03:48:35
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(UPD Carrier Rates      RT) TYPE(RTVOBJ) FILE(PDKHREP)          AC2088458;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Region_Code);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Carrier_Code);
PARAMETER(PAR.Rate_Adjustment);
PARAMETER(PAR.Rate_Adjustment_Type_sts);
PARAMETER(PAR.Select_Option);
{
 //?USER: Initialize routine

 //?***** Change Log
 DO;

 //?** 05/19/2014 LJB E003118
 //?*****
 ENDDO;

 //?USER: Processing if Data record not found

 //?* Not an error if no record is found
 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 //?USER: Process Data record

 EXECUTE FUNCTION(CHG UPD Carr Rate-1CarrCH) TYPE(CHGOBJ) FILE(PDKHREP)          AC2088675;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Region_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.Carrier_Code);
 PARAMETER(DB1.Starting_Miles);
 PARAMETER(DB1.Carrier_Rate);
 PARAMETER(DB1.Description);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Record_Status);
 PARAMETER(PAR.Rate_Adjustment);
 PARAMETER(PAR.Rate_Adjustment_Type_sts);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*JOB
   PAR.Job_Name = JOB.*JOB;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

  CASE;

  // IF PAR.Rate Adjustment Type sts is Increase
  IF PAR.Rate_Adjustment_Type_sts = 'I';

  // DB1.Carrier Rate = PAR.Rate Adjustment + DB1.Carrier Rate
  DB1.Carrier_Rate = PAR.Rate_Adjustment + DB1.Carrier_Rate;

  ENDIF;

  CASE;

  // IF PAR.Rate Adjustment Type sts is Decrease
  IF PAR.Rate_Adjustment_Type_sts = 'D';

  // DB1.Carrier Rate = PAR.Rate Adjustment - DB1.Carrier Rate
  DB1.Carrier_Rate = PAR.Rate_Adjustment - DB1.Carrier_Rate;

  ENDIF;

  //?* Convert adjustment to percent then calc amount and add to rate
  CASE;

  // IF PAR.Rate Adjustment Type sts is Percent
  IF PAR.Rate_Adjustment_Type_sts = 'P';

  // LCL.Percent 7.4 USR = PAR.Rate Adjustment * CON..01 *
  LCL.Percent_7_4_USR = PAR.Rate_Adjustment * .01;

  // LCL.Carrier Rate = LCL.Percent 7.4 USR * DB1.Carrier Rate *
  LCL.Carrier_Rate = LCL.Percent_7_4_USR * DB1.Carrier_Rate;

  // DB1.Carrier Rate = LCL.Carrier Rate + DB1.Carrier Rate
  DB1.Carrier_Rate = LCL.Carrier_Rate + DB1.Carrier_Rate;

  ENDIF;

 }

}


