// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBAOXFR
// ?Date: 14.08.2025 Time: 03:47:13
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// PAR.ST02-Trans Set Cont NBR = CVTVAR(PAR.TRANS SET CONTROL APLHA)
PAR.ST02_Trans_Set_Cont_NBR = CVTVAR(PAR.TRANS_SET_CONTROL_APLHA);

CASE;

// IF PAR.EDI Function Sts USR is Error
IF PAR.EDI_Function_Sts_USR = 'E';

// Call program RTV System Value Alpha XF.
CALL PROGRAM(RTV System Value Alpha XF) ('PPJXXFR');
PARAMETER('EDI820');
PARAMETER(LCL.System_Value_Alpha);

// LCL.Email Address = LCL.System Value Alpha
LCL.Email_Address = LCL.System_Value_Alpha;

// Retrieve message - 'Error occured for Trading Partner &1 Transaction Set Control &2. Contact the
LCL.Office_Message_USR = RTVMSG(USR3137);
PARAMETER(PAR.EDI_Trading_Partner_No);
PARAMETER(PAR.TRANS_SET_CONTROL_APLHA);
PARAMETER(PAR.EDI_Function_Sts_USR);
PARAMETER(PAR.EDI_In_Process_Sts_USR);

// Execute command - 'ESNDMAIL'
EXECUTE COMMAND(USR4501);
PARAMETER(LCL.Email_Address);
PARAMETER(LCL.Office_Message_USR);
PARAMETER(PAR.EDI_Trading_Partner_No);

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV EDI Remit Adv     RT) TYPE(RTVOBJ) FILE(ECP043)            AC2029461;
PARAMETER(PAR.ST02_Trans_Set_Cont_NBR);
{
 //?USER: Initialize routine

 //?***Modifications *****************************************************
 //?SAZ 03/12/12 Added function to update the processed flag.
 //?USER: Process Data record

 // Call program Prt EDI-Remit Advice  PF.
 CALL PROGRAM(Prt EDI-Remit Advice  PF) ('PBAPPFR');
 PARAMETER(PAR.ST02_TRANS_SET_CONTROL_NU);

 EXECUTE FUNCTION(Chg EDI Remit Adv Hdr CH) TYPE(CHGOBJ) FILE(ECP043)            AC2027417;
 PARAMETER(PAR.ST02_TRANS_SET_CONTROL_NU);
 PARAMETER('Y');
 // Call program RTV System Value Alpha XF.
 CALL PROGRAM(RTV System Value Alpha XF) ('PPJXXFR');
 PARAMETER('EDI820');
 PARAMETER(LCL.System_Value_Alpha);

 // LCL.Text USR 20 = CVTVAR(DB1.ST02-TRANS SET CONTROL NU)
 LCL.Text_USR_20 = CVTVAR(DB1.ST02_TRANS_SET_CONTROL_NU);

 // LCL.Email Address = LCL.System Value Alpha
 LCL.Email_Address = LCL.System_Value_Alpha;

 // LCL.Customer Comment Line = CONCAT(DB1.N102-Payer,CON.Remit Adv# :,CON.1)
 LCL.Customer_Comment_Line = DB1.N102_Payer + 'Remit Adv# :' (1);

 // LCL.Customer Comment Line = CONCAT(LCL.Customer Comment Line,LCL.Text USR 20,CON.1)
 LCL.Customer_Comment_Line = LCL.Customer_Comment_Line + LCL.Text_USR_20 (1);

 // Execute command - 'ESNDMAIL'
 EXECUTE COMMAND(USR3109);
 PARAMETER(LCL.Email_Address);
 PARAMETER(LCL.Customer_Comment_Line);
 PARAMETER('PBAPPFR$');
 PARAMETER(*YES);

}


ENDIF;

