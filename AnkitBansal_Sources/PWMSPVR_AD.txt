// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PWMSPVR
// ?Date: 14.08.2025 Time: 02:56:57
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?Modification history
DO;

//? 8/27/2021 JBB WHD83521 - Auto Create EDI Carcass Detail
//?                        Function modified.  Add deletion and
//?                        recreation of the EDI Carcass Summary and
//?                        Detail.
//? 7/06/2021 JBB SDN619 - Repayment by Business User
//?               P17058   Function created.  This screen allow the
//?                        user to confirm that they want to execute
//?                        the Repayment Approval process.
ENDDO;

//?USER: Load screen

MOVE *ALL (To: DTL From: PAR);

//?USER: User defined action

// Send completion message - 'Marking Tattoo(s) as Paid. Marking Repayment as Repaid.'
MESSAGE(PRK1614 *COMPLETION);

// Call program Exc Apprv/Mark Repaid XF.
CALL PROGRAM(Exc Apprv/Mark Repaid XF) ('PWNAXFR');
PARAMETER(PAR.CC_Company_Number);
PARAMETER(PAR.TRH_Repayment_ID);

// Send completion message - 'Recreating EDI Carcass Summary/Detail.'
MESSAGE(PRK1615 *COMPLETION);

//?Re-Create EDI Carcass Summary & Detail
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

//?*** Purge EDI Carcass Summary
EXECUTE FUNCTION(Del EDI CarcSumReRun  RT) TYPE(RTVOBJ) FILE(PKD3CPP)           AB1281686;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.TH_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del EDI Carc Summ     DO) TYPE(DLTOBJ) FILE(PKD3CPP)           AB1200905;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
}


//?*** Purge EDI Carcass detail
EXECUTE FUNCTION(Del EDI Carc DetReRun RT) TYPE(RTVOBJ) FILE(PKD4CPP)           AB1283926;
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.TH_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del EDI Carc Detail   DO) TYPE(DLTOBJ) FILE(PKD4CPP)           AB1200934;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(DB1.TH_Tattoo_Number);
 PARAMETER(DB1.TH_Kill_Date);
 PARAMETER(DB1.CD_Carcass_Number);
}


//?*** Purge Producer Event
EXECUTE FUNCTION(Del ProdEvent ReRun   RT) TYPE(RTVOBJ) FILE(PKD9CPP)           AB1283904;
PARAMETER(DTL.CC_Company_Number);
PARAMETER('EDI');
PARAMETER(DTL.TH_Kill_Date);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del Producer Event    DL) TYPE(DLTOBJ) FILE(PKD9CPP)           AB1205070;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.PD_Producer_Code);
 PARAMETER(DB1.EV_Event_Code);
 PARAMETER(DB1.PE_Kill_Date);
}


//?** Create the EDI CARCASS SUMMARY & CARCASS DETAIL & PRODUCER EVENT
// Call program Crt EDI Carc Sum/Dtl  XF.
CALL PROGRAM(Crt EDI Carc Sum/Dtl  XF) ('PKLNXFR');
PARAMETER(DTL.CC_Company_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER('R');

ENDIF;

