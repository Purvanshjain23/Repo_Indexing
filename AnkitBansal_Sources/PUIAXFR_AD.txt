// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUIAXFR
// ?Date: 14.08.2025 Time: 03:50:28
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(RTV Load ID            RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1384375;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.Load_ID);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(CRT Load/Order Chg Log2IF) TYPE(EXCINTFUN)                     AC2155525;
PARAMETER(LCL.Load_ID);
PARAMETER(PAR.Load_Change_Type);
PARAMETER(PAR.Department_Control_Code);
PARAMETER(PAR.Change_Log_Prior_Value);
PARAMETER(PAR.Change_Log_New_Value);
PARAMETER(PAR.User_Id);
PARAMETER(PAR.Job_Name);
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
{
 //?Execute internal function

 CASE;

 // IF PAR.Load ID is Blank
 IF PAR.Load_ID = *ZERO;

 EXECUTE FUNCTION(RTV Next Key f/crt dt RT) TYPE(RTVOBJ) FILE(PDLHCPP)           AC2052180;
 PARAMETER(JOB.*Job_date);
 PARAMETER(JOB.*Job_time);
 PARAMETER(LCL.Sequence_Number);
 {
  //?USER: Initialize routine

  // PAR.Sequence Number = CON.1
  PAR.Sequence_Number = 1;

  //?USER: Processing if Data record not found

  // PAR.Sequence Number = CON.1
  PAR.Sequence_Number = 1;

  QUIT;

  //?USER: Process Data record

  CASE;

  // IF DB1.Sequence Number is EQ 999
  IF DB1.Sequence_Number = 999;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Sequence Number = DB1.Sequence Number + CON.1
  PAR.Sequence_Number = DB1.Sequence_Number + 1;

  QUIT;

  ENDIF;

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Next Key           RT) TYPE(RTVOBJ) FILE(PDLHCPP)          AC1485145;
 PARAMETER(PAR.Load_ID);
 PARAMETER(LCL.Sequence_Number);
 {
  //?USER: Initialize routine

  // PAR.Sequence Number = CON.1
  PAR.Sequence_Number = 1;

  //?USER: Processing if Data record not found

  // PAR.Sequence Number = CON.1
  PAR.Sequence_Number = 1;

  QUIT;

  //?USER: Process Data record

  CASE;

  // IF DB1.Sequence Number is EQ 999
  IF DB1.Sequence_Number = 999;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Sequence Number = DB1.Sequence Number + CON.1
  PAR.Sequence_Number = DB1.Sequence_Number + 1;

  QUIT;

  ENDIF;

 }

 ENDIF;

 //?Use system date/time to minimize dup record creation
 // Call program RTV System Date/Time   UP.
 CALL PROGRAM(RTV System Date/Time   UP) ('PDGFUPC');
 PARAMETER(LCL.Current_System_Date);
 PARAMETER(LCL.Current_System_Time);

 EXECUTE FUNCTION(CRT Load/Order Chg Log CR) TYPE(CRTOBJ) FILE(PDLHCPP)          AC1465744;
 PARAMETER(LCL.Current_System_Date);
 PARAMETER(LCL.Current_System_Time);
 PARAMETER(LCL.Sequence_Number);
 PARAMETER(PAR.Load_ID);
 PARAMETER(*ZERO);
 PARAMETER(PAR.Load_Change_Type);
 PARAMETER(PAR.Department_Control_Code);
 PARAMETER(PAR.Change_Log_Prior_Value);
 PARAMETER(PAR.Change_Log_New_Value);
 PARAMETER(PAR.User_Id);
 PARAMETER(PAR.Job_Name);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(PAR.Company_Number);
 PARAMETER(PAR.Order_Number);
 {
  //?USER: Processing if Data record already exists

  // PGM.*Return code = CND.*Record already exists
  PGM.*Return_code = 'Y2U0003';

  //?USER: Processing after Data update

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

 }

 //?Add seconds until it can be added successfully
 CASE;

 // IF PGM.*Return code is *Record already exists
 IF PGM.*Return_code = 'Y2U0003';

 // LCL.Created Time = LCL.Current System Time
 LCL.Created_Time = LCL.Current_System_Time;

 // DOW PGM.*Return code is *Record already exists
 DOW PGM.*Return_code = 'Y2U0003';

 // LCL.Created Time = LCL.Created Time + CON.1 *SECONDS
 LCL.Created_Time = TIMEINCR(LCL.Created_Time 1 'SC');

 EXECUTE FUNCTION(CRT Load/Order Chg Log CR) TYPE(CRTOBJ) FILE(PDLHCPP)          AC1465744;
 PARAMETER(LCL.Current_System_Date);
 PARAMETER(LCL.Created_Time);
 PARAMETER(LCL.Sequence_Number);
 PARAMETER(PAR.Load_ID);
 PARAMETER(*ZERO);
 PARAMETER(PAR.Load_Change_Type);
 PARAMETER(PAR.Department_Control_Code);
 PARAMETER(PAR.Change_Log_Prior_Value);
 PARAMETER(PAR.Change_Log_New_Value);
 PARAMETER(PAR.User_Id);
 PARAMETER(PAR.Job_Name);
 PARAMETER(*BLANK);
 PARAMETER(*BLANK);
 PARAMETER(PAR.Company_Number);
 PARAMETER(PAR.Order_Number);
 {
  //?USER: Processing if Data record already exists

  // PGM.*Return code = CND.*Record already exists
  PGM.*Return_code = 'Y2U0003';

  //?USER: Processing after Data update

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

 }

 ENDDO;

 ENDIF;

}


