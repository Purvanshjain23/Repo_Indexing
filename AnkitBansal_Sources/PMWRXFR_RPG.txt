     H/TITLE Prt Cust AccrualCrtWrkXP  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 10/24/18  Time  : 14:31:25
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOMHSTPLMIF  E           K        DISK
      * RSQ : Sales History             Date/Company/Parent/etc
      *
     FPDICCPL3IF  E           K        DISK
      * RSQ : History Dtl Accrual       Co/Ord/Sq/Sq2/ATyp/AcCde
      *
     FCABBREL1IF  E           K        DISK
      * RTV : Customer                  Retrieval index       NV
      *
     FPMD1CPL0IF  E           K        DISK                      A
      * UPD : WF Sales History          Update index
      *
      * Long constants
     E                    @CN#    1  03  6   @CN    25
     I@HSTPRH
      * Sales History             Date/Company/Parent/etc
      * Renamed input format fields
     I              F4AIC3                          WAAIC3
     I              F4C4NB                          WAC4NB
     I              F4DPNB                          WADPNB
     I              F4UENB                          WAUENB
     I              F4MONA                          WAMONA
     I              F4RJCD                          WARJCD
     I              F4RKCD                          WARKCD
     I              F4GPTX                          WAGPTX
     I              F4ABTX                          WAABTX
     I              F4KXCD                          WAKXCD
     I              F4BOCD                          WABOCD
     I              F4BTC7                          WABTC7
     I              F4ANC7                          WAANC7
     I              F4AQTX                          WAAQTX
     I              F4BKC7                          WABKC7
     I              F4BRTX                          WABRTX
     I              F4HNNA                          WAHNNA
     I              F4DBCD                          WADBCD
     I              F4CKTX                          WACKTX
     I              F4BCNA                          WABCNA
     I              F4A0DT                          WAA0DT
     I              F4ACDT                          WAACDT
     I              F4R4CD                          WAR4CD
     I              F4R5CD                          WAR5CD
     I              F4BFCD                          WABFCD
     I              F4Q4CD                          WAQ4CD
     I              F4AQCD                          WAAQCD
     I              F4TBNB                          WATBNB
     I              F4BZNA                          WABZNA
     I              F4RLCD                          WARLCD
     I              F4JNCD                          WAJNCD
     I              F4Q2CD                          WAQ2CD
     I              F4U2ST                          WAU2ST
     I              F4ATIN                          WAATIN
     I              F4T3NB                          WAT3NB
     I              F4RSRN                          WARSRN
     I              F4ORIT                          WAORIT
     I              F4AJCD                          WAAJCD
     I              F4AVQT                          WAAVQT
     I              F4D0WG                          WAD0WG
     I              F4CCQT                          WACCQT
     I              F4AUWG                          WAAUWG
     I              F4AGCD                          WAAGCD
     I              F4AKPR                          WAAKPR
     I              F4AUPR                          WAAUPR
     I              F4CRCD                          WACRCD
     I              F4A5DT                          WAA5DT
     I              F4AWDT                          WAAWDT
     I              F4HDDT                          WAHDDT
     I              F4AGCS                          WAAGCS
     I              F4AQCS                          WAAQCS
     I              F4AVWG                          WAAVWG
     I              F4AYVA                          WAAYVA
     I              F4AMST                          WAAMST
     I              F4ANST                          WAANST
     I              F4VAST                          WAVAST
     I              F4L6NB                          WAL6NB
     I              F4UMCD                          WAUMCD
     I              F4HCDT                          WAHCDT
     I              F4ESNB                          WAESNB
     I              F4ETNB                          WAETNB
     I              F4BZNB                          WABZNB
     I              F4EXQT                          WAEXQT
     I              F4BYWG                          WABYWG
     I              F4S5NB                          WAS5NB
     I              F4MAVA                          WAMAVA
     I              F4KDVA                          WAKDVA
     I              F4USVA                          WAUSVA
     I              F4UTVA                          WAUTVA
     I              F4A4WG                          WAA4WG
     I              F4CKNB                          WACKNB
     I              F4BMST                          WABMST
     I              F4R8NB                          WAR8NB
     I              F4RMCD                          WARMCD
     I              F4BZPR                          WABZPR
     I              F4RDCD                          WARDCD
     I              F4Q7CD                          WAQ7CD
     I              F4EXDT                          WAEXDT
     I              F4LQCD                          WALQCD
     I              F4HICD                          WAHICD
     I              F4RBCD                          WARBCD
     I              F4RGNB                          WARGNB
     I              F4RHNB                          WARHNB
     I              F4RINB                          WARINB
     I              F4R1NB                          WAR1NB
     I              F4CONB                          WACONB
     I              F4CEST                          WACEST
     I              F4GNDT                          WAGNDT
     I              F4RMNB                          WARMNB
     I              F4AODT                          WAAODT
     I              F4LLCD                          WALLCD
     I              F4LMCD                          WALMCD
     I              F4SKNB                          WASKNB
     I              F4SLNB                          WASLNB
     I              F4SMNB                          WASMNB
     I              F4G7NA                          WAG7NA
     I              F4ONVA                          WAONVA
     I              F4N0CD                          WAN0CD
     I              F4B4NB                          WAB4NB
     I              F4B5NB                          WAB5NB
     I              F4N1CD                          WAN1CD
     I              F4GIDT                          WAGIDT
     I              F4Z1ST                          WAZ1ST
     I              F4ULVA                          WAULVA
     I              F4UNVA                          WAUNVA
     I              F4UOVA                          WAUOVA
     I              F4UPVA                          WAUPVA
     I              F4UQVA                          WAUQVA
     I              F4SDCD                          WASDCD
     I              F4QZCD                          WAQZCD
     I              F4XWST                          WAXWST
     I              F4T9CD                          WAT9CD
     I              F4UBCD                          WAUBCD
     I              F4CFC7                          WACFC7
     I              F4X1CD                          WAX1CD
     I              F4GASX                          WAGASX
     I              F4DUPR                          WADUPR
     I              F4B6VL                          WAB6VL
     I              F4IANX                          WAIANX
     I              F4IBNX                          WAIBNX
     I              F4RPCD                          WARPCD
     I              F4NYDT                          WANYDT
     I              F4BZTM                          WABZTM
     I              F4Z4NB                          WAZ4NB
     I              F4XACD                          WAXACD
     I              F4OANA                          WAOANA
     I              F4OKTX                          WAOKTX
     I              F4K4TX                          WAK4TX
     I              F4NBBO                          WANBBO
     I              F4OCFR                          WAOCFR
     I              F4C0C7                          WAC0C7
     I              F4A1AA                          WAA1AA
     I              F4VEST                          WAVEST
     I              F4A5PR                          WAA5PR
     I              F4CDPR                          WACDPR
     I              F4D0PR                          WAD0PR
     I              F4D0VL                          WAD0VL
     I              F4IRSX                          WAIRSX
     I              F4CEVL                          WACEVL
     I              F4ISSX                          WAISSX
     I              F4ITSX                          WAITSX
     I              F4IUSX                          WAIUSX
     I              F4OHDT                          WAOHDT
     I              F4D9PR                          WAD9PR
     I              F4CFVL                          WACFVL
     I              F4UVST                          WAUVST
     I              F4UWST                          WAUWST
     I              F4UXST                          WAUXST
     I              F4AATM                          WAAATM
     I              F4AYNA                          WAAYNA
     I              F4A0NA                          WAA0NA
     I              F4AXDT                          WAAXDT
      *
     I@ICCPKI
      * History Dtl Accrual       Co/Ord/Sq/Sq2/ATyp/AcCde
      * Renamed input format fields
     I              ICAIC3                          WBAIC3
     I              ICC4NB                          WBC4NB
     I              ICDPNB                          WBDPNB
     I              ICUENB                          WBUENB
     I              ICDXNB                          WBDXNB
     I              ICBKPR                          WBBKPR
     I              ICAYVA                          WBAYVA
     I              ICEDVL                          WBEDVL
     I              ICHGCD                          WBHGCD
     I              ICBKC7                          WBBKC7
     I              ICPTDT                          WBPTDT
     I              ICBYWG                          WBBYWG
     I              ICBVST                          WBBVST
     I              ICP7SX                          WBP7SX
     I              ICOKCD                          WBOKCD
     I              ICQQSX                          WBQQSX
     I              ICQRSX                          WBQRSX
     I              ICFLTX                          WBFLTX
     I              ICQSSX                          WBQSSX
     I              ICPRDT                          WBPRDT
     I              ICPSDT                          WBPSDT
     I              ICEGVL                          WBEGVL
     I              ICEHVL                          WBEHVL
     I              ICAVNB                          WBAVNB
     I              ICDSCD                          WBDSCD
     I              ICFMTX                          WBFMTX
     I              ICFNTX                          WBFNTX
     I              ICQ9DT                          WBQ9DT
     I              ICFOTX                          WBFOTX
     I              ICH1NY                          WBH1NY
     I              ICKRT1                          WBKRT1
     I              ICKST1                          WBKST1
     I              ICHJAA                          WBHJAA
     I              ICHKAA                          WBHKAA
     I              ICHHAA                          WBHHAA
     I              ICOJCD                          WBOJCD
     I              ICAATM                          WBAATM
     I              ICAYNA                          WBAYNA
     I              ICA0NA                          WBA0NA
     I              ICAXDT                          WBAXDT
      *
     I@BBREE9
      * Customer                  Retrieval index       NV
      * Renamed input format fields
     I              BBBKC7                          WCBKC7
     I              BBAYTX                          WCAYTX
     I              BBACNA                          WCACNA
     I              BBADNA                          WCADNA
     I              BBAENA                          WCAENA
     I              BBAJNA                          WCAJNA
     I              BBBGCD                          WCBGCD
     I              BBG5CD                          WCG5CD
     I              BBBTTX                          WCBTTX
     I              BBBVTX                          WCBVTX
     I              BBBWTX                          WCBWTX
     I              BBABTX                          WCABTX
     I              BBA2NA                          WCA2NA
     I              BBCBST                          WCCBST
     I              BBB0NA                          WCB0NA
     I              BBP3NB                          WCP3NB
     I              BBAXNA                          WCAXNA
     I              BBI6DT                          WCI6DT
     I              BBAYDT                          WCAYDT
     I              BBANC7                          WCANC7
     I              BBBTC7                          WCBTC7
     I              BBK6ST                          WCK6ST
     I              BBUZST                          WCUZST
     I              BBKXCD                          WCKXCD
     I              BBLTCD                          WCLTCD
     I              BBQNST                          WCQNST
     I              BBS2NB                          WCS2NB
     I              BBVHVA                          WCVHVA
     I              BBI7DT                          WCI7DT
     I              BBRJST                          WCRJST
     I              BBRKST                          WCRKST
     I              BBQWST                          WCQWST
     I              BBQXST                          WCQXST
     I              BBQYST                          WCQYST
     I              BBUNCS                          WCUNCS
     I              BBUVST                          WCUVST
     I              BBUWST                          WCUWST
     I              BBUXST                          WCUXST
     I              BBVSST                          WCVSST
     I              BBAATM                          WCAATM
     I              BBAYNA                          WCAYNA
     I              BBA0NA                          WCA0NA
     I              BBAXDT                          WCAXDT
      *
     I@D1CPT4
      * WF Sales History          Update index
      * Renamed input format fields
     I              D1AIC3                          WDAIC3
     I              D1C4NB                          WDC4NB
     I              D1DPNB                          WDDPNB
     I              D1UENB                          WDUENB
     I              D1BKTP                          WDBKTP
     I              D1ORT1                          WDORT1
     I              D1BTC7                          WDBTC7
     I              D1OVT1                          WDOVT1
     I              D1ANC7                          WDANC7
     I              D1AQTX                          WDAQTX
     I              D1BKC7                          WDBKC7
     I              D1BRTX                          WDBRTX
     I              D1BCNA                          WDBCNA
     I              D1JNCD                          WDJNCD
     I              D1AKPR                          WDAKPR
     I              D1AYVA                          WDAYVA
     I              D1EXQT                          WDEXQT
     I              D1BYWG                          WDBYWG
     I              D1S5NB                          WDS5NB
     I              D1CONB                          WDCONB
     I              D1F9DT                          WDF9DT
     I              D1RMNB                          WDRMNB
     I              D1BKPR                          WDBKPR
     I              D1UNVA                          WDUNVA
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPMD11    E DSPMD1CPL0
      * UPD : WF Sales History          Update index
      * Renamed input format fields
     I              D1AIC3                          WDAIC3
     I              D1C4NB                          WDC4NB
     I              D1DPNB                          WDDPNB
     I              D1UENB                          WDUENB
     I              D1BKTP                          WDBKTP
     I              D1ORT1                          WDORT1
     I              D1BTC7                          WDBTC7
     I              D1OVT1                          WDOVT1
     I              D1ANC7                          WDANC7
     I              D1AQTX                          WDAQTX
     I              D1BKC7                          WDBKC7
     I              D1BRTX                          WDBRTX
     I              D1BCNA                          WDBCNA
     I              D1JNCD                          WDJNCD
     I              D1AKPR                          WDAKPR
     I              D1AYVA                          WDAYVA
     I              D1EXQT                          WDEXQT
     I              D1BYWG                          WDBYWG
     I              D1S5NB                          WDS5NB
     I              D1CONB                          WDCONB
     I              D1F9DT                          WDF9DT
     I              D1RMNB                          WDRMNB
     I              D1BKPR                          WDBKPR
     I              D1UNVA                          WDUNVA
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : MAP WF Sales History - BrkTyp
     I                                        1   1 P1USBT
     IP2PARM      DS
      * FLD: Sales History
      * I : MAP Parent Customer
     I                                    P   1   40P2BTC7
      * I : MAP A/R Customer Number
     I                                    P   5   80P2ANC7
      * I : MAP Ship To Customer
     I                                    P   9  120P2BKC7
      * I : MAP Actual Shipped Date
     I                                    P  13  160P2GNDT
     IP3PARM      DS
      * I :  Company Number
     I                                    P   1   20P3AIC3
     IP4PARM      DS
      * I :  USR From Date
     I                                    P   1   40P4BDDT
     IP5PARM      DS
      * I :  USR To Date
     I                                    P   1   40P5FDDT
     IP6PARM      DS
      * FLD: *Arrays
      * I :  Item Type Code
     I                                        1   3 P6N0CD
      * I :  Quality Level
     I                                        4   5 P6HICD
      * I :  Status - Y or N
     I                                        6   6 P6B8ST
      * I :  Report Type USR
     I                                        7   7 P6QBST
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1USBT    PARM           WP0001  1        WF Sales Histor
     C           P2BTC7    PARM           WP0002  70       Parent Customer
     C           P2ANC7    PARM           WP0003  70       A/R Customer Nu
     C           P2BKC7    PARM           WP0004  70       Ship To Custome
     C           P2GNDT    PARM           WP0005  70       Actual Shipped
     C           P3AIC3    PARM           WP0006  30       Company Number
     C           P4BDDT    PARM           WP0007  70       USR From Date
     C           P5FDDT    PARM           WP0008  70       USR To Date
     C           P6N0CD    PARM           WP0009  3        Item Type Code
     C           P6HICD    PARM           WP0010  2        Quality Level
     C           P6B8ST    PARM           WP0011  1        Status - Y or N
     C           P6QBST    PARM           WP0012  1        Report Type USR
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Prt Cust AccrualCrtWrkXP
      * RMC use lf with Actual ship date as 1st key field so we can posit
      * Crt WF SlsHistbyShpNm RT - Sales History  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Crt WF SlsHistbyShpNm RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAGNDT           Actual Shipped
      * Setup key
     C                     Z-ADDP4BDDT    WAGNDT           Actual Shipped
      * Establish starting position
     C           KPSSA     SETLL@HSTPRH                    *
     C                     READ @HSTPRH                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y'       YL0001           *Record selecte
      * ** Select by Company Number
      * CASE:
      *  - c2 AND c1
      *   |- c2    : PAR.Company Number is not equal to zero
      *   |- c1    : DB1.Company Number NE PAR.Company Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P3AIC3    IFNE 0                          *IF
     C           WAAIC3    IFNE P3AIC3                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       YL0001           *Record selecte
     C                     END                             *FI
      * ** If Record Selected, test by Actual Shipped Date
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * ** Select by Actual Shipped Date
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.Actual Shipped Date GT PAR.USR To Date
      *   |- c2    : DB1.Actual Shipped Date LT PAR.USR From Date
      *   '-
     C           WAGNDT    IFGT P5FDDT                     *IF
     C           WAGNDT    ORLT P4BDDT                     *OR
     C                     MOVEL'N'       YL0001           *Record selecte
      * quit when date is gt parms
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * ** If Record Selected, test Parent Number
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Parent Customer is not equal to zero
      *   |- c2    : PAR.Parent Customer NE DB1.Parent Customer
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P2BTC7    IFNE 0                          *IF
     C           P2BTC7    IFNE WABTC7                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       YL0001           *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** If Record Selected, test A/R Customer number
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.A/R Customer Number is not equal to zero
      *   |- c2    : PAR.A/R Customer Number NE DB1.A/R Customer Number
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P2ANC7    IFNE 0                          *IF
     C           P2ANC7    IFNE WAANC7                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       YL0001           *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * ** If Record Selected, test Ship to number
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Ship To Customer is not equal to zero
      *   |- c2    : PAR.Ship To Customer NE DB1.Ship To Customer
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P2BKC7    IFNE 0                          *IF
     C           P2BKC7    IFNE WABKC7                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       YL0001           *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADD0         YL0002           Extended Amt To
      * ** If Record Selected, test Accrual Type accum Ledgrd Trd Fund Ac
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * ** par.quality level = Accrual Type
      * ** par.item type code = Accrual code
      * ** par.status - y/n  = Ledger Accrual Y/N
      * ** Retrieve Accrual Rate by Accrual Type
      * CASE: PAR.Quality Level is Entered
     C           P6HICD    IFNE *BLANK                     *IF
      * 7/30/02
      * 3/07/05 RMC - accum extended amt by order/order seq -- not by sec
      * ** Retrieve by Accrual Type
      * 7/31/08 RMC - accum extended amt tot by order/order seq -- not by
      * Rtv Accrual by Type   RT - History Dtl Accrual  * 
     C                     EXSR SBRVGN
      * CASE: LCL.Accrual Rate is equal to zero
     C           YL0003    IFEQ 0                          *IF
     C                     MOVEL'N'       YL0001           *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    YL0004           WF SalesHst Bre
      * CASE: LCL.*Record selected is *YES
     C           YL0001    IFEQ 'Y'                        *IF
      * RTV Parent / Name      RT - Customer  * 
     C                     EXSR SCRVGN
      * Format Parent Break A/R Break or Ship to
      * CASE: PAR.WF Sales History - BrkTyp is Parent
     C           P1USBT    IFEQ 'P'                        *IF
     C                     MOVEL*BLANK    WUK1TX           Text 10A USR
     C                     MOVELWABTC7    WUK1TX           Text 10A USR
     C                     Z-ADD2         ZQ      50
     C           @CN,001   CAT  WUK1TX:ZQ YL0004    P      WF SalesHst Bre
     C                     Z-ADD2         ZQ      50
     C           YL0004    CAT  YL0005:ZQ YL0004    P      WF SalesHst Bre
     C                     ELSE
      * CASE: PAR.WF Sales History - BrkTyp is Bill To
     C           P1USBT    IFEQ 'B'                        *IF
     C                     MOVELWAAQTX    WUK1TX           Text 10A USR
     C                     Z-ADD2         ZQ      50
     C           @CN,002   CAT  WUK1TX:ZQ YL0004    P      WF SalesHst Bre
     C                     Z-ADD2         ZQ      50
     C           YL0004    CAT  WAAQTX:ZQ YL0004    P      WF SalesHst Bre
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUK1TX           Text 10A USR
     C                     MOVELWABKC7    WUK1TX           Text 10A USR
     C                     Z-ADD2         ZQ      50
     C           @CN,003   CAT  WUK1TX:ZQ YL0004    P      WF SalesHst Bre
     C                     Z-ADD2         ZQ      50
     C           YL0004    CAT  WABRTX:ZQ YL0004    P      WF SalesHst Bre
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADDWABYWG    YL0006           Weight Billed
      * reverse sign if credit memo and positive   3/29/05 RMC
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.Ledgrd Trd Fund Accrl Amt is Less than zero
      *   |- c2    : DB1.Weight Billed is Greater than zero
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WAUNVA    IFLT 0                          *IF
     C           WABYWG    IFGT 0                          *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C           0         SUB  WABYWG    YL0006           Weight Billed
     C                     END                             *FI
      * Create WF Sales History - WF Sales History  * 
     C                     EXSR SDCRRC
     C                     END                             *FI
     C                     READ @HSTPRH                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Accrual by Type   RT - History Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0002           Extended Amount
     C                     Z-ADD0         YL0003           Accrual Rate
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBC4NB    WQSB02           Order Number
     C           *LIKE     DEFN WBDPNB    WQSB03           Order Sequence
     C           *LIKE     DEFN WBUENB    WQSB04           Order Secondary
     C           *LIKE     DEFN WBOKCD    WQSB05           Accrual Type
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
     C                     KFLD           WQSB03           Order Sequence
     C                     KFLD           WQSB04           Order Secondary
     C                     KFLD           WQSB05           Accrual Type
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWAC4NB    WQSB02           Order Number
     C                     Z-ADDWADPNB    WQSB03           Order Sequence
     C                     Z-ADDWAUENB    WQSB04           Order Secondary
     C                     MOVELP6HICD    WQSB05           Accrual Type
      * Establish starting position
     C           KRSSB     SETLL@ICCPKI                    *
     C           KRSSB     READE@ICCPKI                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1655' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     YL0003           Accrual Rate
     C                     Z-ADD*ZERO     YL0002           Extended Amount
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y'       W0RSL            *Record selecte
      * SEL: Ledgered Accrual
      * CASE: PAR.Ledger Accrual (Y/N) NE DB1.HDA Ledger Accrual Y/N
     C           P6B8ST    IFNE WBFMTX                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * SEL: Accrual Code
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.Accrual Code is Entered
      *   |- c2    : PAR.Accrual Code NE DB1.Accrual Code
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           P6N0CD    IFNE *BLANK                     *IF
     C           P6N0CD    IFNE WBOJCD                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
     C                     ADD  WBAYVA    YL0002           Extended Amount
     C                     Z-ADDWBBKPR    YL0003           Accrual Rate
     C                     END                             *FI
      * 11/25/11 PKD Below code was not working.
     C           KRSSB     READE@ICCPKI                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Parent / Name      RT - Customer  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCBKC7           Ship To Custome
      * Setup key
     C                     Z-ADDWABTC7    WCBKC7           Ship To Custome
      * Establish starting position
     C           KRSSC     CHAIN@BBREE9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0170' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0005           Customer Name
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCAYTX    YL0005           Customer Name
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCRRC    BEGSR
      *================================================================
      * Create WF Sales History - WF Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @D1CPT4
     C                     Z-ADDWAAIC3    WDAIC3           Company Number
     C                     Z-ADDWAC4NB    WDC4NB           Order Number
     C                     Z-ADDWADPNB    WDDPNB           Order Sequence
     C                     Z-ADDWAUENB    WDUENB           Order Secondary
     C                     MOVELP1USBT    WDBKTP           WF SalesHst Brk
     C                     MOVELYL0004    WDORT1           WF SalesHst Bre
     C                     Z-ADDWABTC7    WDBTC7           Parent Customer
     C                     MOVELYL0005    WDOVT1           Parent Name
     C                     Z-ADDWAANC7    WDANC7           A/R Customer Nu
     C                     MOVELWAAQTX    WDAQTX           A/R Customer Na
     C                     Z-ADDWABKC7    WDBKC7           Ship To Custome
     C                     MOVELWABRTX    WDBRTX           Ship To Name
     C                     MOVELWABCNA    WDBCNA           Customer Purcha
     C                     MOVELWAJNCD    WDJNCD           Order Type - Sa
     C                     Z-ADDWAAKPR    WDAKPR           Unit Price
     C                     Z-ADDWAAYVA    WDAYVA           Extended Amount
     C                     Z-ADDWAEXQT    WDEXQT           Quantity Billed
     C                     Z-ADDYL0006    WDBYWG           Weight Billed
     C                     Z-ADDWAS5NB    WDS5NB           Shipped Item Co
     C                     Z-ADDWACONB    WDCONB           Invoice Number
     C                     Z-ADDWAGNDT    WDF9DT           Actual Ship Dat
     C                     Z-ADDWARMNB    WDRMNB           Load ID
     C                     Z-ADDYL0003    WDBKPR           Accrual Rate
     C                     Z-ADDYL0002    WDUNVA           Ledgrd Trd Fund
      *
     C           KLCRSD    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDC4NB           Order Number
     C                     KFLD           WDDPNB           Order Sequence
     C                     KFLD           WDUENB           Order Secondary
      * Check for duplicate primary key
     C           KLCRSD    SETLL@D1CPT4                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3966' W0RTN   7
      * Send message 'WF Sales History       EX'
     C                     MOVEL'USR3966' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C                     WRITE@D1CPT4                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WABTC7           Parent Customer
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAORIT           Original Item
     C                     Z-ADD*ZERO     WAAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WAD0WG           Weight Ordered
     C                     Z-ADD*ZERO     WACCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WAAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WAAKPR           Unit Price
     C                     Z-ADD*ZERO     WAAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WAAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WAAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WAAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WAAYVA           Extended Amount
     C                     Z-ADD*ZERO     WAL6NB           Contract Number
     C                     Z-ADD*ZERO     WAHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WABYWG           Weight Billed
     C                     Z-ADD*ZERO     WAS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WAMAVA           Billing Detail
     C                     Z-ADD*ZERO     WAKDVA           Billing Detail
     C                     Z-ADD*ZERO     WAUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WAUTVA           Standard Overag
     C                     Z-ADD*ZERO     WAA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WAR8NB           Shipping Compan
     C                     Z-ADD*ZERO     WABZPR           Price Overage O
     C                     Z-ADD*ZERO     WAEXDT           Market Pricing
     C                     Z-ADD*ZERO     WARGNB           Item Structure
     C                     Z-ADD*ZERO     WARHNB           Item Structure
     C                     Z-ADD*ZERO     WARINB           Item Structure
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WASKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WASLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WASMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WAONVA           Actual Freight
     C                     Z-ADD*ZERO     WAB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WAB5NB           PM Line Number
     C                     Z-ADD*ZERO     WAGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WAULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WAUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WAUOVA           Commission Amou
     C                     Z-ADD*ZERO     WAUPVA           Financials Amou
     C                     Z-ADD*ZERO     WAUQVA           Financials Amou
     C                     Z-ADD*ZERO     WACFC7           Order Group Cod
     C                     Z-ADD*ZERO     WADUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WAB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WAIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WAIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WANYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WABZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WAZ4NB           MPC Number
     C                     Z-ADD*ZERO     WAOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WAA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WACDPR           Market Value
     C                     Z-ADD*ZERO     WAD0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WAD0VL           Raw Material Co
     C                     Z-ADD*ZERO     WACEVL           Sales Expense T
     C                     Z-ADD*ZERO     WAOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WAD9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WACFVL           HST Item Target
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBDPNB           Order Sequence
     C                     Z-ADD*ZERO     WBUENB           Order Secondary
     C                     Z-ADD*ZERO     WBDXNB           Sequence Number
     C                     Z-ADD*ZERO     WBBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WBAYVA           Extended Amount
     C                     Z-ADD*ZERO     WBEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WBHGCD           Item Code
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBPTDT           HDA Actual Ship
     C                     Z-ADD*ZERO     WBBYWG           Weight Billed
     C                     Z-ADD*ZERO     WBPRDT           HDA SA Week End
     C                     Z-ADD*ZERO     WBPSDT           HDA Atch to Ord
     C                     Z-ADD*ZERO     WBEGVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WBEHVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WBQ9DT           HDA Invoice Dat
     C                     Z-ADD*ZERO     WBH1NY           HDA G/L Sub Led
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WCP3NB           D & B Number
     C                     Z-ADD*ZERO     WCI6DT           Date of D & B R
     C                     Z-ADD*ZERO     WCAYDT           Credit Line Exp
     C                     Z-ADD*ZERO     WCANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WCBTC7           Parent Customer
     C                     Z-ADD*ZERO     WCS2NB           Parent Credit L
     C                     Z-ADD*ZERO     WCVHVA           A/R Credit Limi
     C                     Z-ADD*ZERO     WCI7DT           Order Entry Hol
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Define work field Text 10A USR
     C                     MOVEL*BLANK    WUK1TX 10
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDBTC7           Parent Customer
     C                     Z-ADD*ZERO     WDANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDAKPR           Unit Price
     C                     Z-ADD*ZERO     WDAYVA           Extended Amount
     C                     Z-ADD*ZERO     WDEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WDBYWG           Weight Billed
     C                     Z-ADD*ZERO     WDS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WDCONB           Invoice Number
     C                     Z-ADD*ZERO     WDF9DT           Actual Ship Dat
     C                     Z-ADD*ZERO     WDRMNB           Load ID
     C                     Z-ADD*ZERO     WDBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WDUNVA           Ledgrd Trd Fund
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field *Record selected
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Extended Amt Total
     C                     Z-ADD*ZERO     YL0002 112
      * Define local work field Accrual Rate
     C                     Z-ADD*ZERO     YL0003  96
      * Define local work field WF SalesHst Break Level 1
     C                     MOVEL*BLANK    YL0004125
      * Define local work field Parent Name
     C                     MOVEL*BLANK    YL0005 30
      * Define null work field Parent Customer
     C                     Z-ADD*ZERO     YN0001  70
      * Define local work field Weight Billed
     C                     Z-ADD*ZERO     YL0006 112
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 Parent:
00002 A/R Customer:
00003 Shipped To Customer:
