/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CL PROGRAM FOR DOWNLOADING MPR WHOLESALE PORK DAILY */
/*             E2247  - NEW 01/07/2013                             */
/*                                                                  */
/*                                                                  */
/*  SYSTEM    - OMS                                                 */
/*  DATE      - 10/16/2012                                          */
/*  DEVELOPER - ROSE CENTONZE                                       */
/*                                                                  */
/********************************************************************/
/* MODIFICATIONS:                                                   */
/*         C2638   RMC 6/13/13 CHG OUTQ TO *NONE ON EMAIL OPTION    */
/*         E2639   RMC 6/14/13 EMAIL DAY'S REPORT FOR BOTH PLTS, BOTH SBM +
/*             TIMES,SELECT ITEMS TO RICK H, BCC BRAD/DAMON   SCAN:E2639     */
/*         E2649   RMC 7/31/13 PASS IN DATA MART STS PARM TO UPD FILE WITH */
/*                   VALUE "R"EADY FOR COGNOS. ADD CALL TO DATA MART PGM */
/*         E2639   RMC 8/22/13 ADD MCCLAIN TO TF EXEC EMAIL         */
/*         c3285   RMC 8/06/14 swap rick h for mark c               */
/*         E4230   RMC 11/5/15 NEW SQL FOR KEVIN/JOSH -SQPBAOCPK.     */
/*          SAME AS TF'S BUT WITH SCHED SHIP DATE, AND CUST /SLS# IN NULL */
/*         FIELDS IN A QTEMP COPY OF PBAOCPP      */
/*         E4249   RMC 12/3/15 ADD ANDREA FRAZIER TO ABOVE SQL EMAIL   */
/*         E4249   RMC 03/2/16 CHG KEVIN JOSH SQL TO DIST LIST       */
/*                  MPR_LS89_KEVINJOSH                                */
/*   RMC R14015 05/14/19 CHANGED TO NEW SERVER - CODE HERE REPLACES FTPMPRPLT */
/*                             */
/*  Santosh      11/23/24  Task: SR3000247 CM: S300247             */
/*                         Logic is added to email the report to a */
/*                         distribution list                       */
/*‚JM   05/15/25 SDN1295 - MPR Upgrade-Add new folder for Test env */
/*‚JM   05/29/25 SDN1295 - MPR Upgrade-Add Company,program,run num */
/*****************************************************************************/
             PGM        PARM(&PLTCO &RPTTMEX)

/* WORK FIELDS */
             DCL        VAR(&PLTEST) TYPE(*CHAR) LEN(5)   /*PLT ESTABLISHMENT#*/
             DCL        VAR(&RPTDTE) TYPE(*DEC ) LEN(7 0) /*REPORTING DATE    */
             DCL        VAR(&RPTDTEX) TYPE(*CHAR) LEN(7) /*REPORTING DATE    */
             DCL        VAR(&RPTTME) TYPE(*DEC ) LEN(1 0) /*REPORTING TIME    */
             DCL        VAR(&RPTTMEX) TYPE(*CHAR) LEN(1) /*REPORTING TIME    */
             DCL        VAR(&RPTDAY) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&DATMRT) TYPE(*CHAR) LEN(1)   /*DATA MART STS */
             DCL        VAR(&YYMD)   TYPE(*CHAR) LEN(8)   /*YYYYMMDD          */
             DCL        VAR(&YYYY)   TYPE(*CHAR) LEN(4)   /*YEAR              */
             DCL        VAR(&MM)     TYPE(*CHAR) LEN(2)   /*MONTH             */
             DCL        VAR(&DD)     TYPE(*CHAR) LEN(2)   /*DAY               */
             DCL        VAR(&TIME)   TYPE(*CHAR) LEN(6)   /*SYSTEM TIME       */
             DCL        VAR(&PLTCO)  TYPE(*CHAR) LEN(3 )  /* PLANT COMPANY */
             DCL        VAR(&PLTNO) TYPE(*CHAR) LEN(2) /* PLANT 1ST 2 DIGITS */
             DCL        VAR(&COMP)  TYPE(*DEC) LEN(3 0)  /* PLANT COMPANY */
             DCL        VAR(&NEWFLD) TYPE(*CHAR) LEN(1) VALUE('W') +
                          /* PUSH TO NEW FOLDER  */

             DCL        VAR(&USRCLS) TYPE(*CHAR) LEN(10) /*  USER CLASS       */

             DCL        VAR(&DOC)   TYPE(*CHAR) LEN(10)   /*DOCUMENT NAME     */
             DCL        VAR(&PCFILE) TYPE(*CHAR) LEN(32) /*PC FILE           */
                        /* FORMAT: LS89_PPPPP_YYYYMMDDHHMMSS.MPR */

             DCL        VAR(&RMTCMD) TYPE(*CHAR) LEN(256) /*REMOTE COMMAND*/

             DCL        VAR(&SEL)   TYPE(*CHAR) LEN(800) /*SELECT STATEMENT  */
             DCL        VAR(&DISTSCH) TYPE(*CHAR) LEN(30) /* SCHED +
                          EMAIL DIST LIST */
             DCL        VAR(&MPRPRINT) TYPE(*CHAR) LEN(10) /* JOBQ */
             DCL        VAR(&HOLDSEL) TYPE(*CHAR) LEN(10) /* HOLD */

/*‚JM   05/15/25 SDN1295 */
/*           DCL        VAR(&DIR1) TYPE(*CHAR) LEN(36) */
             DCL        VAR(&DIR1) TYPE(*CHAR) LEN(41)
/*           DCL        VAR(&IDIR) TYPE(*CHAR) LEN(50) */
             DCL        VAR(&IDIR) TYPE(*CHAR) LEN(55)
             DCL        VAR(&SYSNAME) TYPE(*CHAR) LEN(10)
/*‚JM   05/29/25 SDN1295 */
             DCL        VAR(&PROGRAM) TYPE(*CHAR) LEN(7) +
                          VALUE('PBFZUPC')
             DCL        VAR(&COMPNAME) TYPE(*CHAR) LEN(30)
             DCL        VAR(&RUNNUM) TYPE(*CHAR) LEN(1)
             DCL        VAR(&NEWMSG) TYPE(*CHAR) LEN(240)
             DCL        VAR(&JOBDNAME) TYPE(*CHAR) LEN(10)
/*‚JM   05/29/25 SDN1295 */
             DCL        VAR(&DIR) TYPE(*CHAR) LEN(14)
             DCL        VAR(&IDIRNM) TYPE(*CHAR) LEN(90)
/* S300247*/ DCL        VAR(&DISTLST1) TYPE(*CHAR) LEN(30) VALUE(' ')
/* S300247*/ DCL        VAR(&DISTLST2) TYPE(*CHAR) LEN(30) VALUE(' ')
             CHGVAR     VAR(&COMP) VALUE(&PLTCO)
 PLTNO:      CHGVAR     VAR(&PLTNO) VALUE(%SST(&PLTCO 1 2))
/*-----------------------------------------------------------------*/
/* INITILIZATION                                                   */
/*-----------------------------------------------------------------*/
             RTVUSRPRF  USRCLS(&USRCLS)
     /*      ADDLIBLE   LIB(TPMTESTP)     +
             ADDLIBLE   LIB(TPMTESTF)     */
/*-----------------------------------------------------------------*/
/* MAINLINE                                                        */
/*-----------------------------------------------------------------*/
             CHGVAR     VAR(&RPTTME) VALUE(&RPTTMEX)
             CHGVAR     VAR(&DATMRT) VALUE('R')
/*‚JM   05/29/25 SDN1295 */
             RTVNETA    SYSNAME(&SYSNAME)
             IF         COND(&SYSNAME *EQ 'SBFDEV') THEN(DO)

             SELECT
             WHEN       COND(&PLTCO *EQ '360') THEN(CHGVAR +
                          VAR(&JOBDNAME) VALUE('MPRGUPJD'))
             WHEN       COND(&PLTCO *EQ '440') THEN(CHGVAR +
                          VAR(&JOBDNAME) VALUE('MPRSTPJD'))
             WHEN       COND(&PLTCO *EQ '960') THEN(CHGVAR +
                          VAR(&JOBDNAME) VALUE('MPRTFPJD'))
             OTHERWISE
             ENDSELECT

             CHKOBJ     OBJ(&JOBDNAME) OBJTYPE(*JOBD)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&JOBDNAME) VALUE('MPRJOBD')
             CHKOBJ     OBJ(&JOBDNAME) OBJTYPE(*JOBD)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&JOBDNAME) VALUE('PRKPRDGUY')
             ENDDO
             ENDDO
             SETLIBL    JOBD(&JOBDNAME)
             RMVLIBLE   LIB(PRKFLIB)
             MONMSG     MSGID(CPF0000)

             CALL       PGM(PNH7XFR) PARM((' ') (&COMP) (&COMPNAME))
             CHGVAR     VAR(&RUNNUM) VALUE(&RPTTMEX)
             CHGVAR     VAR(&NEWMSG) VALUE('This report was +
                          generated from the TEST environment for +
                          the SDN 1295 IBMi MPR Upgrade project.' +
                          *CAT 'Program = ' *CAT &PROGRAM *CAT ' ,' +
                          *CAT '  Company = ' *CAT %TRIM(&COMPNAME) +
                          *CAT ' ,' *CAT 'Run Number = ' *CAT &RUNNUM)
             ENDDO
/*‚JM   05/29/25 SDN1295 */
/*-----------------------------------------------------------------*/
/*    BUILD FILE LS89 IN PBAOCPP                                  */
/*-----------------------------------------------------------------*/
/*  GOTO ENDTEST     TEST ONLY */

/* GOTO TESTSEND   */

             CALL       PGM(PBFOXFR) PARM('' &COMP &PLTEST &RPTDTE +
                          &RPTTME &DATMRT)
/*-----------------------------------------------------------------*/
  SENDIT:    /* SET UP DATE AND TIME */
             CHGVAR     VAR(&RPTDTEX) VALUE(&RPTDTE)
 /*          CHGVAR     VAR(&RPTTMEX) VALUE(&RPTTME)                  */
             CVTDAT     DATE(&RPTDTEX) TOVAR(&YYMD) FROMFMT(*CYMD) +
                          TOFMT(*YYMD) TOSEP(*NONE)
             CHGVAR     VAR(&YYYY) VALUE(%sst(&YYMD 1 4))
             CHGVAR     VAR(&MM)   VALUE(%sst(&YYMD 5 2))
             CHGVAR     VAR(&DD)   VALUE(%sst(&YYMD 7 2))

             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)

  /******* SEND FILE : LS89 MPR WHOLESALE PORK    (PBOACPP)   *******/

             CHGVAR     VAR(&DOC)  VALUE('PBOACP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('LS89_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

/*-----------------------------------------------------------------*/
/* WHEN DOING FTP ->NO LONGER USED  10.31.18    R14015                  */
/*-----------------------------------------------------------------*/
/*‚JM   05/29/25 SDN1295 */
             IF         COND(&SYSNAME *NE 'SBFDEV') THEN(DO)
             CHGVAR     VAR(&NEWMSG) VALUE(' ')
             ENDDO
/*‚JM   05/29/25 SDN1295 */
  GOTO NEW
/*‚JM   05/29/25 SDN1295 */
             EXECUTE    VIEW(SQPBAOCPP) PCFMT(*COMMA) TOFLR(GUY.IS) +
                          TODOC(&DOC) REPLACE(*YES) EMLMSG(&NEWMSG) +
                          SETVAR((&PLTEST &PLTEST) (&RPTDTEX +
                          &RPTDTEX) (&RPTTMEX &RPTTMEX)) +
                          DTSTYLE(*USA /)
/*           EXECUTE    VIEW(SQPBAOCPP) PCFMT(*COMMA) TOFLR(GUY.IS) + */
/*                        TODOC(&DOC) REPLACE(*YES) SETVAR((&PLTEST + */
/*                        &PLTEST) (&RPTDTEX &RPTDTEX) (&RPTTMEX +    */
/*                        &RPTTMEX)) DTSTYLE(*USA /)                  */
/*‚JM   05/29/25 SDN1295 */
             CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)
/*-----------------------------------------------------------------*/
/* NEW PUSH TO SHARED FOLDER - NEW  10.31.18  R14015                    */
/*-----------------------------------------------------------------*/
TESTSEND:
NEW:
             MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
/*‚JM   05/15/25 SDN1295 */
             CALLSUBR   SUBR(TESTFOLDER)
/*‚JM   05/15/25 SDN1295 */
             CHGVAR     VAR(&DIR) VALUE('UPLOADLS89' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

/*‚JM   05/29/25 SDN1295 */
             EXECUTE    VIEW(PRKFLIB/SQPBAOCPP) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES) +
                          EMLMSG(&NEWMSG) SETVAR((&PLTEST &PLTEST) +
                          (&RPTDTEX &RPTDTEX) (&RPTTMEX &RPTTMEX)) +
                          DTSTYLE(*USA /)
/*           EXECUTE    VIEW(PRKFLIB/SQPBAOCPP) PCFMT(*COMMA) +         */
/*                        TOSTMF(&IDIRNM) REPLACE(*YES) +               */
/*                        SETVAR((&PLTEST &PLTEST) (&RPTDTEX +          */
/*                        &RPTDTEX) (&RPTTMEX &RPTTMEX)) DTSTYLE(*USA /)*/
/*‚JM   05/29/25 SDN1295 */

 /*          SNDMSG     MSG(TESTING) TOMSGQ(ISRCENT) MSGTYPE(*INQ)    */

/*  GOTO ENDTEST      TEST ONLY */
/*-----------------------------------------------------------------*/
/*    CALL COGNOS DATA MART PGM TO GRAB THE RECORDS JUST WRITTEN  */
/*-----------------------------------------------------------------*/
             CALL       PGM(SH216CL) PARM(&DATMRT)
/*-----------------------------------------------------------------*/

/*-----------------------------------------------------------------*/
/*  EMAIL OR PRINT SQL OF LS89                     */
/*-----------------------------------------------------------------*/
 PRINT:  /* GET EMAIL LIST AND PRINTER ID   */
             CALL       PGM(POMTXFR) PARM(' ' &COMP 'MPRLS89EML'  +
                          &DISTSCH)

             CALL       PGM(POMTXFR) PARM(' ' &COMP 'MPRLS89PRT'  +
                          &MPRPRINT)

             IF         COND(&USRCLS *EQ '*PGMR') THEN(DO)
             CHGVAR     VAR(&MPRPRINT) VALUE(QPRINT2)
             ENDDO

/*------------------------------------------------------------------*/
/*- PRINT REPORT FOR USER ON PAPER          ------------------------*/
/*------------------------------------------------------------------*/
   SEND:
             CHGVAR     VAR(&HOLDSEL) VALUE(*NO)

             IF         COND(&DISTSCH *NE +
                          '                               ') THEN(DO)
             CHGVAR     VAR(&HOLDSEL) VALUE(*YES)
/*‚JM   05/29/25 SDN1295 */
             REPORT     REPORT(SQPBAOCPPR) VIEW(SQPBAOCPP) +
                          HOLD(&HOLDSEL) SETVAR((&PLTEST &PLTEST) +
                          (&RPTDTEX &RPTDTEX) (&RPTTMEX &RPTTMEX)) +
                          RECIPIENT(&DISTSCH) EMLMSG(&NEWMSG) +
                          OUTQ(*NONE)
             GOTO ENDPGM
/*           REPORT     REPORT(SQPBAOCPPR) VIEW(SQPBAOCPP) +        */
/*                        HOLD(&HOLDSEL) SETVAR((&PLTEST &PLTEST) + */
/*                        (&RPTDTEX &RPTDTEX) (&RPTTMEX &RPTTMEX)) +*/
/*                        RECIPIENT(&DISTSCH) OUTQ(*NONE)           */
/*           GOTO ENDPGM                                            */
/*‚JM   05/29/25 SDN1295 */
             ENDDO

             IF         COND(&DISTSCH = +
                          '                               ') THEN(DO)
             CHGVAR     VAR(&HOLDSEL) VALUE(*NO)
             REPORT     REPORT(SQPBAOCPPR) VIEW(SQPBAOCPP) +
                          HOLD(&HOLDSEL) SETVAR((&PLTEST &PLTEST) +
                          (&RPTDTEX &RPTDTEX) (&RPTTMEX &RPTTMEX)) +
                          OUTQ(&MPRPRINT)
             GOTO ENDPGM
             ENDDO

 ENDPGM:
/*------------------------------------------------------------------*/
/*- E2639 SEND REPORT TO EXECS - ALL ITEM CODES, BOTH PLANTS, ALL DAY */
/*     AFTER TF'S AFTERNOON RUN                                         */
/*------------------------------------------------------------------*/
   EXEC:
         IF         COND(&RPTTMEX *EQ '2' *AND &PLTCO *EQ '960') THEN(DO)

/* S300247 Changes Begin */
/*           EXECUTE    VIEW(SQPBAOCPE) PCFMT(*XLS) +
                          RECIPIENT('mcampbell@triumphfoods.com,mengla+
                          nd@triumphfoods.com,msouthwell@triumphfoods+
                          .com,(bcc)brad.hamilton@seaboardfoods.com, +
                          damon.ginther@seaboardfoods.com,rose.centon+
                          ze@seaboardfoods.com') SETVAR((&RPTDTEX +
                          &RPTDTEX))                                    */
             CALL       PGM(POMTXFR) PARM((' ') (&COMP) +
                          ('MPREXCLS89') (&DISTLST1))
             IF         COND(&DISTLST1 *NE ' ') THEN(DO)
/*‚JM   05/29/25 SDN1295 */
/*           EXECUTE    VIEW(SQPBAOCPE) PCFMT(*XLS) +               */
/*                        RECIPIENT(&DISTLST1) SETVAR((&RPTDTEX +   */
/*                        &RPTDTEX))                                */
             EXECUTE    VIEW(SQPBAOCPE) PCFMT(*XLS) +
                          RECIPIENT(&DISTLST1) EMLMSG(&NEWMSG) +
                          SETVAR((&RPTDTEX &RPTDTEX))
/*‚JM   05/29/25 SDN1295 */
             ENDDO
             CALL       PGM(POMTXFR) PARM((' ') (&COMP) +
                          ('MPRECCLS89') (&DISTLST2))
             IF         COND(&DISTLST2 *NE ' ') THEN(DO)
/*‚JM   05/29/25 SDN1295 */
/*           EXECUTE    VIEW(SQPBAOCPE) PCFMT(*XLS) +             */
/*                        RECIPIENT(&DISTLST2) SETVAR((&RPTDTEX + */
/*                        &RPTDTEX))                              */
             EXECUTE    VIEW(SQPBAOCPE) PCFMT(*XLS) +
                          RECIPIENT(&DISTLST2) EMLMSG(&NEWMSG) +
                          SETVAR((&RPTDTEX &RPTDTEX))
/*‚JM   05/29/25 SDN1295 */
             ENDDO
/* S300247 Changes End */
 E4230:      CRTDUPOBJ  OBJ(PBAOCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*YES)
             CRTDUPOBJ  OBJ(PBAOCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PBAOCPL3) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CALL       PGM(PBTXXFR) PARM('' &RPTDTE) /* PUT CUST & +
                          SALES IN NULL  AND NULL 1  */
/*‚JM   05/29/25 SDN1295 */
/*           EXECUTE    VIEW(SQPBAOCPK) PCFMT(*XLS) +          */
/*                        RECIPIENT('MPR_LS89_KEVINJOSH') +    */
/*                        SETVAR((&RPTDTEX &RPTDTEX))          */
             EXECUTE    VIEW(SQPBAOCPK) PCFMT(*XLS) +
                          RECIPIENT('MPR_LS89_KEVINJOSH') +
                          EMLMSG(&NEWMSG) SETVAR((&RPTDTEX &RPTDTEX))
             ENDDO
/*‚JM   05/29/25 SDN1295 */
/*-----------------------------------------------------------------*/
/* END PROGRAM                                                     */
/*-----------------------------------------------------------------*/
 ENDTEST:    DLTOVR     FILE(*ALL)
/*‚JM   05/15/25 SDN1295 */
             SUBR       SUBR(TESTFOLDER)
             IF         COND(&SYSNAME *EQ 'SBFDEV') THEN(DO)
             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR_+
                          TEST/')
             ENDDO
             ENDSUBR
/*‚JM   05/15/25 SDN1295 */

             ENDPGM
