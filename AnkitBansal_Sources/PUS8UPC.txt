/*********************************************************************/
/*  PROGRAM:       PUS8UPC                                           */
/*  PROGRAM DESC:  EXC BLD WF A/R HEADER CL  EXECUTE USER PROGRAM    */
/*  PROGRAMMER:    D.NGUYEN                                          */
/*  DATE:          06/18/2021                                        */
/*  PROJECT ID:    W79712 - PRINT                                    */
/*                                                                   */
/*  PURPOSE:       THIS PROGRAM WILL BUILD THE WF A/R HEADER         */
/*                 (PUB5CPP) FILE IN QTEMP.                          */
/*                 SEQUEL WILL THEN EMAIL THE REPORT.                */
/*                                                                   */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  CHANGE DESCRIPTION                                   */
/* -------- --- -----------------------------------------------------*/
/* MM/DD/YY xxx Project ID. - Change Desc.                           */
/*                                                                   */
/*********************************************************************/

             PGM        PARM(&COMP &EMAILDL)

             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)
             DCL        VAR(&COMPA) TYPE(*CHAR) LEN(3)
             DCL        VAR(&EMAILDL) TYPE(*CHAR) LEN(50)

             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10)

             DCL        VAR(&EMLMSG) TYPE(*CHAR) LEN(100)


             CHGVAR     VAR(&COMPA) VALUE(&COMP)
             CHGVAR     VAR(&EMLMSG) VALUE('A/R Inter Company +
                          Balance Due for Company' *BCAT &COMPA)

/*-------------------------------------------------------------------*/
/* CREATE WORKFILE IN QTEMP - WF A/R HEADER                          */
/*-------------------------------------------------------------------*/
 AGAIN:      CRTDUPOBJL OBJ(PUB5CPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF2130) EXEC(DO)
             DLTF       FILE(QTEMP/PUB5CP*)
             GOTO       CMDLBL(AGAIN)
             ENDDO

             CRTDUPOBJL OBJ(PUB5CPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CRTDUPOBJL OBJ(PUB5CPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

/*-------------------------------------------------------------------*/
/* OVERRIDE WORKFILE TO QTEMP                                        */
/*-------------------------------------------------------------------*/
             OVRDBF     FILE(PUB5CPP) TOFILE(QTEMP/PUB5CPP)
             OVRDBF     FILE(PUB5CPL0) TOFILE(QTEMP/PUB5CPL0)
             OVRDBF     FILE(PUB5CPL1) TOFILE(QTEMP/PUB5CPL1)

/*-------------------------------------------------------------------*/
/* BUILD WORKFILE                                                    */
/*-------------------------------------------------------------------*/
             CALL       PGM(PUTAXFR) PARM(' ' &COMP)

/*-----------------------------------------------------------------*/
/* Determine If In PROD or TEST Env.                               */
/*-----------------------------------------------------------------*/
             CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

    /* Concat 'TEST' to Email Message If Not PROD Data Library */
             IF         COND(&DATA *NE 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&EMLMSG) VALUE(&EMLMSG *BCAT '- TEST')

             EXECUTE    VIEW(ARINTCOBAL) PCFMT(*XLS) +
                          RECIPIENT(&EMAILDL) EMLMSG(&EMLMSG)

             GOTO       CMDLBL(END)
             ENDDO

/*-----------------------------------------------------------------*/
/* Call SEQUEL to Print                                            */
/*-----------------------------------------------------------------*/

             EXECUTE    VIEW(ARINTCOBAL) PCFMT(*XLS) +
                          RECIPIENT(&EMAILDL) EMLMSG(&EMLMSG)


 END:        ENDPGM
