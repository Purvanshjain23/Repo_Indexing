// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVCXEFR
// ?Date: 14.08.2025 Time: 03:51:54
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

CASE;

// IF PAR.Model Library is Blanks
IF PAR.Model_Library = *BLANK;

// PAR.Model Library = CND.OMSDEVMDL
PAR.Model_Library = 'OMSDEVMDL';

ENDIF;

//?USER: Initialize subfile record (existing record)

CASE;

// IF CTL.Field Long Name is Entered
IF CTL.Field_Long_Name <> *BLANK;

CASE;

// IF CTL.Field Long Name NE RCD.Field Long Name
IF CTL.Field_Long_Name <> RCD.Field_Long_Name;

// PGM.*Record selected = CND.*NO
PGM.*Record_selected = 'N';

ENDIF;

ENDIF;

//?USER: Validate subfile record fields

CASE;

// IF RCD.*SFLSEL is *Change
IF RCD.*SFLSEL = '2';

// Call program Edit Field.
CALL PROGRAM(Edit Field) ('PVD0E1R');
PARAMETER(RCD.Model_Library);
PARAMETER(RCD.Table_Name);
PARAMETER(RCD.Field_Long_Name);
PARAMETER('CHG');

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Delete DDL Table Configur) TYPE(DLTOBJ) FILE(PVBVREP)          AC2221178;
PARAMETER(RCD.Model_Library);
PARAMETER(RCD.Table_Name);
PARAMETER(RCD.Field_Long_Name);

// Send error message - 'Record deleted.'
ERROR(Y2U0013);

// IF RCD.*SFLSEL is *Display
IF RCD.*SFLSEL = '5'/'5';

// Call program Edit Field.
CALL PROGRAM(Edit Field) ('PVD0E1R');
PARAMETER(RCD.Model_Library);
PARAMETER(RCD.Table_Name);
PARAMETER(RCD.Field_Long_Name);
PARAMETER('DSP');

ENDIF;

CASE;

// IF RCD.*SFLSEL is *Change
IF RCD.*SFLSEL = '2';

// OR RCD.*SFLSEL is *Delete
OR RCD.*SFLSEL = '4'/'4';

// OR RCD.*SFLSEL is *Display
OR RCD.*SFLSEL = '5'/'5';

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

// RCD.*SFLSEL = CND.*Reset to blank
RCD.*SFLSEL = *BLANK;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?USER: Delete DBF record

EXECUTE FUNCTION(Delete DDL Table Configur) TYPE(DLTOBJ) FILE(PVBVREP)          AC2221178;
PARAMETER(RCD.Model_Library);
PARAMETER(RCD.Table_Name);
PARAMETER(RCD.Field_Long_Name);

//?USER: Change DBF record

EXECUTE FUNCTION(Change DDL Table Configur) TYPE(CHGOBJ) FILE(PVBVREP)          AC2221177;
PARAMETER(RCD.Model_Library);
PARAMETER(RCD.Table_Name);
PARAMETER(RCD.Field_Long_Name);
PARAMETER(RCD.Field_DataType);
PARAMETER(RCD.Field_Length);
PARAMETER(RCD.Field_Length_Dec_Pos);
PARAMETER(RCD.Primary_Key);
PARAMETER(RCD.Foreign_Key);
PARAMETER(RCD.Unique_Key);
PARAMETER(RCD.Allow_Null);
PARAMETER(RCD.Generate_As_Identity);
PARAMETER(RCD.Generate_as_Row_Change_TS);
PARAMETER(RCD.Table_Gen_Name);
PARAMETER(RCD.Field_Gen_Name);
PARAMETER(RCD.Primary_Key_Name);
PARAMETER(RCD.Primary_Key_Seq);
PARAMETER(RCD.Foreign_Key_Name);
PARAMETER(RCD.Foreign_Key_Seq);
PARAMETER(RCD.Referenced_Table);
PARAMETER(RCD.Referenced_Field);
PARAMETER(RCD.Referenced_Table_Gen_Name);
PARAMETER(RCD.Referenced_Field_Gen_Name);
PARAMETER(RCD.Default_Value);
PARAMETER(RCD.Comment_On_Table);
PARAMETER(RCD.Record_Status);
PARAMETER(RCD.Created_By);
PARAMETER(RCD.Created_Dt_Tm);
PARAMETER(RCD.Updated_By);
PARAMETER(RCD.Updated_Dt_Tm);

//?USER: Extra processing after DBF update

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

//?USER: Process command keys

CASE;

// IF CTL.*CMD key is *Add
IF CTL.*CMD_key = '09';

// Call program Edit Field.
CALL PROGRAM(Edit Field) ('PVD0E1R');
PARAMETER(CTL.Model_Library);
PARAMETER(CTL.Table_Name);
PARAMETER(CTL.Field_Long_Name);
PARAMETER('ADD');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// IF CTL.*CMD key is CF10
IF CTL.*CMD_key = '10';

// Call program UpdateModelTable&Keys.
CALL PROGRAM(UpdateModelTable&Keys) ('UPDTBLCFG');
PARAMETER(CTL.Model_Library);
PARAMETER(CTL.Table_Name);
PARAMETER('UPDATEKEYS');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

