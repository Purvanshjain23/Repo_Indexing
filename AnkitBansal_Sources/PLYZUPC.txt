/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PLYZUPC (FROM PLL7UPC)                        */
/*  PROGRAM NAME:    MPR LS118A ONLY     FOR MPR                 */
/*  PROGRAMMER:      ROSE CENTONZE                                 */
/*  CREATE DATE:     06/07/16                                      */
/*                                                                 */
/*           TFS:    R6124                                          */
/*                                                                 */
/*                                                                 */
/*                  2) CREATE LS118A PKE5CPP PRIOR DAY SCHED .  */
/*                  4) DOWNLOAD THE MPR REPORTING FILES TO THE USDA */
/*                                                                 */
/*******************************************************************/
/*  Modification History                                           */
/* RMC R14015 05/15/19 CHANGED TO NEW SERVER - CODE HERE REPLACES FTPMPRPLT */
/*            06/11/19 CHANGE &IDIR TO 47 LONG  */
/*******************************************************************/
             PGM        PARM(&PLTCO &JOBD)
/* PRINT OPTION PARMS                                             */
          /* DCL        VAR(&RTN) TYPE(*CHAR) LEN(7)           */
             DCL        VAR(&PDEV) TYPE(*CHAR) LEN(10) VALUE(QPRINT2)
             DCL        VAR(&HOLD) TYPE(*CHAR) LEN(4) VALUE('*YES')
             DCL        VAR(&SAVE) TYPE(*CHAR) LEN(4) VALUE('*NO ')

/* FUNCTION SPECIFIC PARMS                                        */
             DCL        VAR(&APP) TYPE(*CHAR) LEN(33) VALUE('Hog +
                          Procurement and Evaluation')
             DCL        VAR(&LPP) TYPE(*CHAR) LEN(40)
             DCL        VAR(&PLTCO) TYPE(*CHAR) LEN(3)
             DCL        VAR(&JOBD) TYPE(*CHAR) LEN(10)
             DCL        VAR(&KILLDT) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&STEP) TYPE(*DEC) LEN(5 0)
             DCL        VAR(&USRCLS) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MPRJOB) TYPE(*CHAR) LEN(1) VALUE('Y')
             DCL        VAR(&LS118C) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&PLTEST) TYPE(*CHAR) LEN(5)   /*PLT ESTABLISHMENT#*/
             DCL        VAR(&RPTDTE) TYPE(*DEC ) LEN(7 0) /*REPORTING DATE    */
             DCL        VAR(&RPTDTEX) TYPE(*CHAR) LEN(7) /*REPORTING DATE    */
             DCL        VAR(&RPTTME) TYPE(*DEC ) LEN(1 0) /*REPORTING TIME    */
             DCL        VAR(&RPTTMEX) TYPE(*CHAR) LEN(1) /*REPORTING TIME    */
             DCL        VAR(&RPTDAY) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&LS118C) TYPE(*CHAR) LEN(1)   /*REPORTING DAY STS */
             DCL        VAR(&YYMD)   TYPE(*CHAR) LEN(8)   /*YYYYMMDD          */
             DCL        VAR(&YYYY)   TYPE(*CHAR) LEN(4)   /*YEAR              */
             DCL        VAR(&MM)     TYPE(*CHAR) LEN(2)   /*MONTH             */
             DCL        VAR(&DD)     TYPE(*CHAR) LEN(2)   /*DAY               */
             DCL        VAR(&TIME)   TYPE(*CHAR) LEN(6)   /*SYSTEM TIME       */
             DCL        VAR(&PLTNO) TYPE(*CHAR) LEN(2) /* PLANT 1ST 2 DIGITS */
             DCL        VAR(&DOC)   TYPE(*CHAR) LEN(10)   /*DOCUMENT NAME     */
             DCL        VAR(&PCFILE) TYPE(*CHAR) LEN(32) /*PC FILE           */
                        /* FORMAT: LS118A_PPPPP_YYYYMMDDHHMMSS.MPR */
             DCL        VAR(&NEWFLD) TYPE(*CHAR) LEN(1) VALUE('Y') +
                          /* PUSH TO NEW FOLDER  */

             DCL        VAR(&RMTCMD) TYPE(*CHAR) LEN(256) /*REMOTE COMMAND*/

             DCL        VAR(&SEL)   TYPE(*CHAR) LEN(800) /*SELECT STATEMENT  */

/* NUMERIC VARIABLES                                             */
             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0)

/* SBDPRTOVR VARIABLE                                          */
             DCL        VAR(&CMD) TYPE(*CHAR) LEN(512)

             DCL        VAR(&DIR1) TYPE(*CHAR) LEN(36)
             DCL        VAR(&DIR) TYPE(*CHAR) LEN(11)
      /*     DCL        VAR(&IDIR) TYPE(*CHAR) LEN(50)  */
             DCL        VAR(&IDIR) TYPE(*CHAR) LEN(47)
             DCL        VAR(&IDIRNM) TYPE(*CHAR) LEN(90)


/* CHANGE ALPHA PARMS TO NUMERIC VARIABLES                       */
             CHGVAR     VAR(&COMP) VALUE(&PLTCO)
 PLTNO:      CHGVAR     VAR(&PLTNO) VALUE(%SST(&PLTCO 1 2))
             CHGVAR     VAR(&LPP) VALUE(&APP)

/* SET LIBRARY LIST                              */
             RTVUSRPRF  GRPAUT(&USRCLS)
             IF         COND(&USRCLS *NE '*PGMR') THEN(DO)
             ENDDO

/* *********************************************************/

             SETLIBL    JOBD(&JOBD)

             CALL       PGM(PLYYXFR) PARM('' &COMP  &PLTEST &RPTDTE &RPTTME +
                          &RPTDAY &LS118C)

  /******* SEND FILE A: LS118A MPR PRIOR DAY SCHEDULED (PKE5CPP)   *******/

             /* SET UP DATE AND TIME */
             CALL       PGM(PKWCXFR) PARM('' &COMP  &PLTEST &RPTDTE &RPTTME +
                          &RPTDAY &LS118C)
             CHGVAR     VAR(&RPTDTEX) VALUE(&RPTDTE)
             CHGVAR     VAR(&RPTTMEX) VALUE(&RPTTME)
             CVTDAT     DATE(&RPTDTEX) TOVAR(&YYMD) FROMFMT(*CYMD) +
                          TOFMT(*YYMD) TOSEP(*NONE)
             CHGVAR     VAR(&YYYY) VALUE(%sst(&YYMD 1 4))
             CHGVAR     VAR(&MM)   VALUE(%sst(&YYMD 5 2))
             CHGVAR     VAR(&DD)   VALUE(%sst(&YYMD 7 2))

             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&TIME)

             CHGVAR     VAR(&DOC)  VALUE('PKE5CP' *CAT &PLTNO)

             CHGVAR     VAR(&PCFILE) VALUE('ls118a_' *CAT &PLTEST +
                          *CAT '_' *CAT &YYYY *CAT &MM *CAT &DD +
                          *CAT &TIME *CAT '.MPR')

             CHGVAR     VAR(&SEL) VALUE('SELECT +
                          E5H8CD,CHAR(CVTDATE(E5ETDT,CYMD),USA) +
                          LEN(10) NAME(RPTDTE), E5C2A1, E5C4A1, +
                          E5C5A1, E5C6A1, E5C7A1, E5C8A1, E5C9A1, +
                          E5DAA1, E5DBA1, E5DCA1, E5DDA1, E5DEA1, +
                          E5DFA1, E5DGA1, E5DHA1 FROM PKE5CPP WHERE +
                          E5H8CD="' *CAT &PLTEST *CAT '" AND +
                          E5ETDT=' *CAT &RPTDTEX *BCAT 'AND +
                          E5C2A1=' *CAT &RPTTMEX)
GOTO NEW
             EXECUTE    SQL(&SEL) +
                          TOFLR(GUY.IS) +
                          TODOC(&DOC) PCFMT(*COMMA) +
                          REPLACE(*YES)

             CALL       PGM(FTPMPRPLT) PARM(&PLTCO &DOC &PCFILE &NEWFLD)

NEW:         MKDIR      DIR('/QNTC/ENTKCPRDFIL1/')
             MONMSG     MSGID(CPFA0A0)

             CHGVAR     VAR(&DIR1) +
                          VALUE('/QNTC/ENTKCPRDFIL1/FTP_HPE_PORK/MPR/')
             CHGVAR     VAR(&DIR) VALUE('UPLOADN' *TCAT &PLTCO +
                          *CAT '/')

             CHGVAR     VAR(&IDIR) VALUE(&DIR1 *CAT &DIR)
             CHGVAR     VAR(&IDIRNM) VALUE(&IDIR *CAT &PCFILE)

             EXECUTE    SQL(&SEL) PCFMT(*COMMA) +
                          TOSTMF(&IDIRNM) REPLACE(*YES)


 END:        DLTOVR *ALL
             ENDPGM
