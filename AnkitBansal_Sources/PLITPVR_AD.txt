// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLITPVR
// ?Date: 14.08.2025 Time: 02:54:24
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?11/04/16 R7805 RMC Add purch type to BOH for MPR
//?03/22/07
//?RMC added MPR Reported sts so they can say to not report it on a 5am run
//?11/02/2020 ISE H16853 - CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5 TO 7
//?USER: Load screen

EXECUTE FUNCTION(Val Company Number    IF) TYPE(EXCINTFUN)                      AB1129077;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.Oms_Name);
PARAMETER(WRK.Invalid_Y_N_USR);
{
 //?Execute internal function

 // Call program Val Company Number    XF.
 CALL PROGRAM(Val Company Number    XF) ('PDGZXFR');
 PARAMETER(PAR.CC_Company_Number);
 PARAMETER(PAR.Oms_Name);
 PARAMETER(WRK.Invalid_Y_N_USR);

 CASE;

 // IF WRK.Invalid Y/N USR is Yes
 IF WRK.Invalid_Y_N_USR = 'Y';

 // Send error message - 'Invalid Company Number'
 ERROR(PRK0299);
 MSGPARM(PAR.CC_Company_Number);

 ENDIF;

 // PAR.Invalid Y/N USR = WRK.Invalid Y/N USR
 PAR.Invalid_Y_N_USR = WRK.Invalid_Y_N_USR;

}


EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PD_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv Pdctn Loc Name    RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1101543;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(DTL.PL_Name);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(Rtv MPR Reported      RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1278165;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_MPR_Prior_Day_Prch);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.BOL MPR Prior Day Prch = DTL.BOL MPR Prior Day Prch
LCL.BOL_MPR_Prior_Day_Prch = DTL.BOL_MPR_Prior_Day_Prch;

CASE;

// IF PAR.BOH MPR Purchase Type is *ALL values
IF PAR.BOH_MPR_Purchase_Type = '01'/'02'/'03'/'04'/'05'/'06'/'07'/'08'/'09'/'10'/'11';

// DTL.BOH MPR Purchase Type = PAR.BOH MPR Purchase Type
DTL.BOH_MPR_Purchase_Type = PAR.BOH_MPR_Purchase_Type;

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV MPR Prdcr Purch TpRT) TYPE(RTVOBJ) FILE(PKE3CPP)           AB1235599;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(WRK.MPR_Purchase_Type_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


// DTL.BOH MPR Purchase Type = CVTVAR(WRK.MPR Purchase Type Code)
DTL.BOH_MPR_Purchase_Type = CVTVAR(WRK.MPR_Purchase_Type_Code);

ENDIF;

// DTL.Description 30 USR = Condition name of DTL.BOH MPR Purchase Type
DTL.Description_30_USR = RTVCND(DTL.BOH_MPR_Purchase_Type);

//?USER: Validate fields

// DTL.Description 30 USR = Condition name of DTL.BOH Status 3
DTL.Description_30_USR = RTVCND(DTL.BOH_MPR_Purchase_Type);

//?USER: User defined action

EXECUTE FUNCTION(Chg BOH MPR ReportDt  CH) TYPE(CHGOBJ) FILE(PKAWCPP)           AB1276854;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOH_MPR_Reporting_Date);
PARAMETER(DTL.BOH_MPR_Reporting_Time);
PARAMETER(DTL.BOH_MPR_Purchase_Type);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 {
  //?Execute internal function

  // PAR.RS User Changed = JOB.*USER
  PAR.RS_User_Changed = JOB.*USER;

  // PAR.RS Date Changed = JOB.*Job date
  PAR.RS_Date_Changed = JOB.*Job_date;

  // PAR.RS Time Changed = JOB.*Job time
  PAR.RS_Time_Changed = JOB.*Job_time;

  // PAR.RS Job = JOB.*JOB
  PAR.RS_Job = JOB.*JOB;

  // PAR.RS Program = JOB.*PROGRAM
  PAR.RS_Program = JOB.*PROGRAM;

 }

}


CASE;

// IF DTL.BOL MPR Prior Day Prch NE LCL.BOL MPR Prior Day Prch
IF DTL.BOL_MPR_Prior_Day_Prch <> LCL.BOL_MPR_Prior_Day_Prch;

EXECUTE FUNCTION(Rtv Chg MPR PriorDay  RT) TYPE(RTVOBJ) FILE(PKAXCPP)           AB1278167;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_MPR_Prior_Day_Prch);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Chg MPR PriorDayPurch CH) TYPE(CHGOBJ) FILE(PKAXCPP)           AB1239197;
 PARAMETER(DB1.BOH_Company_Number);
 PARAMETER(DB1.BOH_Buy_Order_Number);
 PARAMETER(DB1.BOL_Load_Number);
 PARAMETER(PAR.BOL_MPR_Prior_Day_Prch);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Rtv Change Stamp-SysDtIF) TYPE(EXCINTFUN)                      AB1237006;
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  {
   //?Execute internal function

   // PAR.RS User Changed = JOB.*USER
   PAR.RS_User_Changed = JOB.*USER;

   // Call program Rtv System Date & Tim UP.
   CALL PROGRAM(Rtv System Date & Tim UP) ('PKWDUPC');
   PARAMETER(PAR.RS_Date_Changed);
   PARAMETER(PAR.RS_Time_Changed);

   // PAR.RS Job = JOB.*JOB
   PAR.RS_Job = JOB.*JOB;

   // PAR.RS Program = JOB.*PROGRAM
   PAR.RS_Program = JOB.*PROGRAM;

  }

 }

}


ENDIF;

