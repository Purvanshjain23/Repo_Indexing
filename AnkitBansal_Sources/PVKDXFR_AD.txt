// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVKDXFR
// ?Date: 14.08.2025 Time: 03:52:22
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?NOTE: JS 'TMSORDSWP' will call this program 24/7 every 30 mins.
//?Company Must Be Entered & Job Time NOT within 2:30am - 5:30am Else Exit.
CASE;

// IF PAR.Company Number Alpha is Zero
IF PAR.Company_Number_Alpha = '000';

// OR PAR.Company Number Alpha is Not Entered
OR PAR.Company_Number_Alpha = *BLANK;

// OR JOB.*Job time is Between 2:30am & 5:30am
OR JOB.*Job_time >= 023000;
AND JOB.*Job_time <= 053000;

//?Job time added to not disrupt critical JS.
PGM.*Return_code = *BLANK;

RETURN;

ENDIF;

//?Format/Set All Parameter Variables.
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

//?Set Company.
// LCL.Company Number = CVTVAR(PAR.Company Number Alpha)
LCL.Company_Number = CVTVAR(PAR.Company_Number_Alpha);

// LCL.Company Number Pass   USR = LCL.Company Number
LCL.Company_Number_Pass_USR = LCL.Company_Number;

//?Set From Date.
// LCL.Job Date Usr = JOB.*Job date
LCL.Job_Date_Usr = JOB.*Job_date;

// LCL.From Date Pass        USR = LCL.Job Date Usr
LCL.From_Date_Pass_USR = LCL.Job_Date_Usr;

//?Set Through Date Based on # of Days Value in System Values.
EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(CADPREP)          AC1510877;
PARAMETER('TMSORDSWP');
PARAMETER(LCL.Days);
{
 //?USER: Process Data record

 // PAR.System Value Numeric = DB1.System Value Numeric
 PAR.System_Value_Numeric = DB1.System_Value_Numeric;

 QUIT;

}


// LCL.USR Through Date = JOB.*Job date + LCL.Days *DAYS
LCL.USR_Through_Date = DATEINCR(JOB.*Job_date LCL.Days 'DY' 1111111 'NONE' 'N' 1);

// Call program CLC TMS Sweep Dates    XF.
CALL PROGRAM(CLC TMS Sweep Dates    XF) ('PBTGXFR');
PARAMETER(LCL.Company_Number);
PARAMETER(LCL.USR_Through_Date);
PARAMETER(LCL.Date_0_RGT);
PARAMETER(NLL.Date_1_RGT);
PARAMETER(LCL.Date_2_RGT);

//?For Thur: Sat, Sun, Mon dates are put into date 2 for end date
CASE;

// IF LCL.Date 2 RGT is Entered
IF LCL.Date_2_RGT <> *ZERO;

// LCL.USR Through Date = LCL.Date 2 RGT
LCL.USR_Through_Date = LCL.Date_2_RGT;

//?For Thur: Sat, Sun, Mon dates are put into date 2 for end date
// IF *OTHERWISE
IF *OTHERWISE;

//?For Mon, Tue, Wed, or Fri date 0 is used for From date
// LCL.USR Through Date = LCL.Date 0 RGT
LCL.USR_Through_Date = LCL.Date_0_RGT;

ENDIF;

// LCL.Thru Date Pass        USR = LCL.USR Through Date
LCL.Thru_Date_Pass_USR = LCL.USR_Through_Date;

ENDIF;

//?Call Program to Sweep Orders to MercuryGate.
// Call program SBM Sweep Ords to MG   CL.
CALL PROGRAM(SBM Sweep Ords to MG   CL) ('PBTJUPC');
PARAMETER(NLL.Return_Code_Usr);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER('Y');
PARAMETER(LCL.Thru_Date_Pass_USR);
PARAMETER(LCL.From_Date_Pass_USR);
PARAMETER(*ZERO);
PARAMETER(LCL.Company_Number_Pass_USR);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER('A');
PARAMETER(*BLANK);
PARAMETER('SWP');

