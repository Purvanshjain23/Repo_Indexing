     H/TITLE Prg Eval Trans UPL    XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDNGUY
     H* Date          : 06/07/19  Time  : 10:31:57
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKCPCPL6IF  E           K        DISK
      * RSQ : Eval Trans UPL            Kill Date (D) / Company
      *
     FPLBAREL1IF  E           K        DISK
      * RTV : Eval Trans UPL Comment    Retrieval index
      *
     FPLBAREL5IF  E           K        DISK                      A
      * UPD : Eval Trans UPL Comment    Update index for purge
      *
     FPLBAREL0UF  E           K        DISK
      * UPD : Eval Trans UPL Comment    Update index
      *
     FPKCPCPL5IF  E           K        DISK                      A
      * UPD : Eval Trans UPL            Update Index Purge
      *
     FPKCPCPL0UF  E           K        DISK
      * UPD : Eval Trans UPL            Update index
      *
     I@CPCPVN
      * Eval Trans UPL            Kill Date (D) / Company
      * Renamed input format fields
     I              CPHKST                          WAHKST
     I              CPB7DT                          WAB7DT
     I              CPKINB                          WAKINB
     I              CPKHNB                          WAKHNB
     I              CPLNNB                          WALNNB
     I              CPHLST                          WAHLST
     I              CPKJNB                          WAKJNB
     I              CPKKNB                          WAKKNB
     I              CPBQPC                          WABQPC
     I              CPBRPC                          WABRPC
     I              CPHMST                          WAHMST
     I              CPHNST                          WAHNST
     I              CPHTST                          WAHTST
     I              CPHUST                          WAHUST
     I              CPX6NB                          WAX6NB
     I              CPFQPC                          WAFQPC
     I              CPFRPC                          WAFRPC
     I              CPM7CD                          WAM7CD
     I              CPX7ST                          WAX7ST
     I              CPX8ST                          WAX8ST
     I              CPX9ST                          WAX9ST
     I              CPYAST                          WAYAST
     I              CPYBST                          WAYBST
     I              CPYCST                          WAYCST
     I              CPZJST                          WAZJST
     I              CPZKST                          WAZKST
     I              CPZLST                          WAZLST
     I              CPB8DT                          WAB8DT
     I              CPAOTM                          WAAOTM
      *
     I@BAREQB
      * Eval Trans UPL Comment    Retrieval index
      * Renamed input format fields
     I              BAHKST                          WBHKST
     I              BAB7DT                          WBB7DT
     I              BAKINB                          WBKINB
     I              BASUA1                          WBSUA1
     I              BAV9TX                          WBV9TX
     I              BAEBSS                          WBEBSS
     I              BAEESS                          WBEESS
     I              BASWA1                          WBSWA1
     I              BAGHDT                          WBGHDT
     I              BASXA1                          WBSXA1
     I              BASZA1                          WBSZA1
     I              BAGIDT                          WBGIDT
     I              BASYA1                          WBSYA1
     I              BAAAVN                          WBAAVN
     I              BAAADT                          WBAADT
     I              BAAMTM                          WBAMTM
     I              BAAJST                          WBAJST
     I              BAAHVN                          WBAHVN
     I              BAAGVN                          WBAGVN
     I              BAABVN                          WBABVN
     I              BAABDT                          WBABDT
     I              BAABTM                          WBABTM
      *
     I@BAREZH
      * Eval Trans UPL Comment    Update index for purge
      * Renamed input format fields
     I              BAHKST                          WCHKST
     I              BAB7DT                          WCB7DT
     I              BAKINB                          WCKINB
     I              BASUA1                          WCSUA1
     I              BAV9TX                          WCV9TX
     I              BAEBSS                          WCEBSS
     I              BAEESS                          WCEESS
     I              BASWA1                          WCSWA1
     I              BAGHDT                          WCGHDT
     I              BASXA1                          WCSXA1
     I              BASZA1                          WCSZA1
     I              BAGIDT                          WCGIDT
     I              BASYA1                          WCSYA1
     I              BAAAVN                          WCAAVN
     I              BAAADT                          WCAADT
     I              BAAMTM                          WCAMTM
     I              BAAJST                          WCAJST
     I              BAAHVN                          WCAHVN
     I              BAAGVN                          WCAGVN
     I              BAABVN                          WCABVN
     I              BAABDT                          WCABDT
     I              BAABTM                          WCABTM
      *
     I@BAREQA
      * Eval Trans UPL Comment    Update index
      * Renamed input format fields
     I              BAHKST                          WDHKST
     I              BAB7DT                          WDB7DT
     I              BAKINB                          WDKINB
     I              BASUA1                          WDSUA1
     I              BAV9TX                          WDV9TX
     I              BAEBSS                          WDEBSS
     I              BAEESS                          WDEESS
     I              BASWA1                          WDSWA1
     I              BAGHDT                          WDGHDT
     I              BASXA1                          WDSXA1
     I              BASZA1                          WDSZA1
     I              BAGIDT                          WDGIDT
     I              BASYA1                          WDSYA1
     I              BAAAVN                          WDAAVN
     I              BAAADT                          WDAADT
     I              BAAMTM                          WDAMTM
     I              BAAJST                          WDAJST
     I              BAAHVN                          WDAHVN
     I              BAAGVN                          WDAGVN
     I              BAABVN                          WDABVN
     I              BAABDT                          WDABDT
     I              BAABTM                          WDABTM
      *
     I@CPCPVO
      * Eval Trans UPL            Update Index Purge
      * Renamed input format fields
     I              CPHKST                          WEHKST
     I              CPB7DT                          WEB7DT
     I              CPKINB                          WEKINB
     I              CPKHNB                          WEKHNB
     I              CPLNNB                          WELNNB
     I              CPHLST                          WEHLST
     I              CPKJNB                          WEKJNB
     I              CPKKNB                          WEKKNB
     I              CPBQPC                          WEBQPC
     I              CPBRPC                          WEBRPC
     I              CPHMST                          WEHMST
     I              CPHNST                          WEHNST
     I              CPHTST                          WEHTST
     I              CPHUST                          WEHUST
     I              CPX6NB                          WEX6NB
     I              CPFQPC                          WEFQPC
     I              CPFRPC                          WEFRPC
     I              CPM7CD                          WEM7CD
     I              CPX7ST                          WEX7ST
     I              CPX8ST                          WEX8ST
     I              CPX9ST                          WEX9ST
     I              CPYAST                          WEYAST
     I              CPYBST                          WEYBST
     I              CPYCST                          WEYCST
     I              CPZJST                          WEZJST
     I              CPZKST                          WEZKST
     I              CPZLST                          WEZLST
     I              CPB8DT                          WEB8DT
     I              CPAOTM                          WEAOTM
      *
     I@CPCPMW
      * Eval Trans UPL            Update index
      * Renamed input format fields
     I              CPHKST                          WFHKST
     I              CPB7DT                          WFB7DT
     I              CPKINB                          WFKINB
     I              CPKHNB                          WFKHNB
     I              CPLNNB                          WFLNNB
     I              CPHLST                          WFHLST
     I              CPKJNB                          WFKJNB
     I              CPKKNB                          WFKKNB
     I              CPBQPC                          WFBQPC
     I              CPBRPC                          WFBRPC
     I              CPHMST                          WFHMST
     I              CPHNST                          WFHNST
     I              CPHTST                          WFHTST
     I              CPHUST                          WFHUST
     I              CPX6NB                          WFX6NB
     I              CPFQPC                          WFFQPC
     I              CPFRPC                          WFFRPC
     I              CPM7CD                          WFM7CD
     I              CPX7ST                          WFX7ST
     I              CPX8ST                          WFX8ST
     I              CPX9ST                          WFX9ST
     I              CPYAST                          WFYAST
     I              CPYBST                          WFYBST
     I              CPYCST                          WFYCST
     I              CPZJST                          WFZJST
     I              CPZKST                          WFZKST
     I              CPZLST                          WFZLST
     I              CPB8DT                          WFB8DT
     I              CPAOTM                          WFAOTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPLBA1    E DSPLBAREL5
      * UPD : Eval Trans UPL Comment    Update index for purge
      * Renamed input format fields
     I              BAHKST                          WCHKST
     I              BAB7DT                          WCB7DT
     I              BAKINB                          WCKINB
     I              BASUA1                          WCSUA1
     I              BAV9TX                          WCV9TX
     I              BAEBSS                          WCEBSS
     I              BAEESS                          WCEESS
     I              BASWA1                          WCSWA1
     I              BAGHDT                          WCGHDT
     I              BASXA1                          WCSXA1
     I              BASZA1                          WCSZA1
     I              BAGIDT                          WCGIDT
     I              BASYA1                          WCSYA1
     I              BAAAVN                          WCAAVN
     I              BAAADT                          WCAADT
     I              BAAMTM                          WCAMTM
     I              BAAJST                          WCAJST
     I              BAAHVN                          WCAHVN
     I              BAAGVN                          WCAGVN
     I              BAABVN                          WCABVN
     I              BAABDT                          WCABDT
     I              BAABTM                          WCABTM
      *
     IQPLBA2    E DSPLBAREL0
      * UPD : Eval Trans UPL Comment    Update index
      * Renamed input format fields
     I              BAHKST                          WDHKST
     I              BAB7DT                          WDB7DT
     I              BAKINB                          WDKINB
     I              BASUA1                          WDSUA1
     I              BAV9TX                          WDV9TX
     I              BAEBSS                          WDEBSS
     I              BAEESS                          WDEESS
     I              BASWA1                          WDSWA1
     I              BAGHDT                          WDGHDT
     I              BASXA1                          WDSXA1
     I              BASZA1                          WDSZA1
     I              BAGIDT                          WDGIDT
     I              BASYA1                          WDSYA1
     I              BAAAVN                          WDAAVN
     I              BAAADT                          WDAADT
     I              BAAMTM                          WDAMTM
     I              BAAJST                          WDAJST
     I              BAAHVN                          WDAHVN
     I              BAAGVN                          WDAGVN
     I              BAABVN                          WDABVN
     I              BAABDT                          WDABDT
     I              BAABTM                          WDABTM
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQPKCP1    E DSPKCPCPL5
      * UPD : Eval Trans UPL            Update Index Purge
      * Renamed input format fields
     I              CPHKST                          WEHKST
     I              CPB7DT                          WEB7DT
     I              CPKINB                          WEKINB
     I              CPKHNB                          WEKHNB
     I              CPLNNB                          WELNNB
     I              CPHLST                          WEHLST
     I              CPKJNB                          WEKJNB
     I              CPKKNB                          WEKKNB
     I              CPBQPC                          WEBQPC
     I              CPBRPC                          WEBRPC
     I              CPHMST                          WEHMST
     I              CPHNST                          WEHNST
     I              CPHTST                          WEHTST
     I              CPHUST                          WEHUST
     I              CPX6NB                          WEX6NB
     I              CPFQPC                          WEFQPC
     I              CPFRPC                          WEFRPC
     I              CPM7CD                          WEM7CD
     I              CPX7ST                          WEX7ST
     I              CPX8ST                          WEX8ST
     I              CPX9ST                          WEX9ST
     I              CPYAST                          WEYAST
     I              CPYBST                          WEYBST
     I              CPYCST                          WEYCST
     I              CPZJST                          WEZJST
     I              CPZKST                          WEZKST
     I              CPZLST                          WEZLST
     I              CPB8DT                          WEB8DT
     I              CPAOTM                          WEAOTM
      *
     IQPKCP2    E DSPKCPCPL0
      * UPD : Eval Trans UPL            Update index
      * Renamed input format fields
     I              CPHKST                          WFHKST
     I              CPB7DT                          WFB7DT
     I              CPKINB                          WFKINB
     I              CPKHNB                          WFKHNB
     I              CPLNNB                          WFLNNB
     I              CPHLST                          WFHLST
     I              CPKJNB                          WFKJNB
     I              CPKKNB                          WFKKNB
     I              CPBQPC                          WFBQPC
     I              CPBRPC                          WFBRPC
     I              CPHMST                          WFHMST
     I              CPHNST                          WFHNST
     I              CPHTST                          WFHTST
     I              CPHUST                          WFHUST
     I              CPX6NB                          WFX6NB
     I              CPFQPC                          WFFQPC
     I              CPFRPC                          WFFRPC
     I              CPM7CD                          WFM7CD
     I              CPX7ST                          WFX7ST
     I              CPX8ST                          WFX8ST
     I              CPX9ST                          WFX9ST
     I              CPYAST                          WFYAST
     I              CPYBST                          WFYBST
     I              CPYCST                          WFYCST
     I              CPZJST                          WFZJST
     I              CPZKST                          WFZKST
     I              CPZLST                          WFZLST
     I              CPB8DT                          WFB8DT
     I              CPAOTM                          WFAOTM
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Purge Date USR
     I                                    P   1   40P1EPDT
     IP2PARM      DS
      * FLD: *Arrays
      * I : RST Purge Code
     I                                        1   3 P2N7CD
      * I : RST Library
     I                                        4  13 P2LBNM
      * I : RST Purge Application Code
     I                                       14  19 P2HWCD
      * I :  File
     I                                       20  29 P2A4VN
      * I :  Logical Name
     I                                       30  39 P2A8VN
      * I :  Tape Physical File
     I                                       40  49 P2A9VN
      * I :  Field Name
     I                                       50  55 P2A7VN
      * I :  Date Format
     I                                       56  65 P2VLTX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1EPDT    PARM           WP0001  70       Purge Date USR
     C           P2N7CD    PARM           WP0002  3        Purge Code
     C           P2LBNM    PARM           WP0003 10        Library
     C           P2HWCD    PARM           WP0004  6        Purge Applicati
     C           P2A4VN    PARM           WP0005 10        File
     C           P2A8VN    PARM           WP0006 10        Logical Name
     C           P2A9VN    PARM           WP0007 10        Tape Physical F
     C           P2A7VN    PARM           WP0008  6        Field Name
     C           P2VLTX    PARM           WP0009 10        Date Format
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Prg Eval Trans UPL    XF
      * All the records that are older than the Purge Date will be
      * deleted.
      * Prg Eval Trans UPL    RT - Eval Trans UPL  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Prg Eval Trans UPL    RT - Eval Trans UPL  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WAB7DT           EA Kill Date
      * Setup key
     C                     Z-ADDP1EPDT    WAB7DT           EA Kill Date
      * Establish starting position
     C           KPSSA     SETLL@CPCPVN                    *
     C                     READ @CPCPVN                  90*
      * Data record not found
     C   90                MOVEL'PRK0341' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * ** Purge the recs to the file in purge library. These will be cop
      * ** the Purge Tape Physical File "Z" member.
      * ** Then delete the record from production.
      * 10/25/2018 JBB E13926 - New files to add to purge
      * Prg Eval Trans UPL Com RT - Eval Trans UPL Comment  * 
     C                     EXSR SBRVGN
      * Prg Eval Trans UPL    CR - Eval Trans UPL  * 
     C                     EXSR SECRRC
      * Prg Eval Trans UPL    DL - Eval Trans UPL  * 
     C                     EXSR SFDLRC
     C                     READ @CPCPVN                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Prg Eval Trans UPL Com RT - Eval Trans UPL Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBHKST    WQSB01           EA Company Numb
     C           *LIKE     DEFN WBB7DT    WQSB02           EA Kill Date
     C           *LIKE     DEFN WBKINB    WQSB03           EA Scale Sequen
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           EA Company Numb
     C                     KFLD           WQSB02           EA Kill Date
     C                     KFLD           WQSB03           EA Scale Sequen
      * Setup key
     C                     Z-ADDWAHKST    WQSB01           EA Company Numb
     C                     Z-ADDWAB7DT    WQSB02           EA Kill Date
     C                     Z-ADDWAKINB    WQSB03           EA Scale Sequen
      * Establish starting position
     C           KRSSB     SETLL@BAREQB                    *
     C           KRSSB     READE@BAREQB                  90*
      * Data record not found
     C   90                MOVEL'PRK1233' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Prg Eval Trans UPL Com CR - Eval Trans UPL Comment  * 
     C                     EXSR SCCRRC
      * Del Eval Trans UPL Com DL - Eval Trans UPL Comment  * 
     C                     EXSR SDDLRC
     C           KRSSB     READE@BAREQB                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Prg Eval Trans UPL Com CR - Eval Trans UPL Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BAREZH
     C                     Z-ADDWBHKST    WCHKST           EA Company Numb
     C                     Z-ADDWBB7DT    WCB7DT           EA Kill Date
     C                     Z-ADDWBKINB    WCKINB           EA Scale Sequen
     C                     Z-ADDWBSUA1    WCSUA1           EV Comment Line
     C                     MOVELWBV9TX    WCV9TX           EV Comment
     C                     MOVELWBEBSS    WCEBSS           EV Comment Type
     C                     MOVELWBEESS    WCEESS           EV Event Proces
     C                     Z-ADDWBSWA1    WCSWA1           Previous Compan
     C                     Z-ADDWBGHDT    WCGHDT           Previous Kill D
     C                     Z-ADDWBSXA1    WCSXA1           Previous Tattoo
     C                     Z-ADDWBSZA1    WCSZA1           Move To Company
     C                     Z-ADDWBGIDT    WCGIDT           Move To Kill Da
     C                     Z-ADDWBSYA1    WCSYA1           Move To Tattoo
     C                     MOVELWBAAVN    WCAAVN           RS User Changed
     C                     Z-ADDWBAADT    WCAADT           RS Date Changed
     C                     Z-ADDWBAMTM    WCAMTM           RS Time Changed
     C                     MOVELWBAJST    WCAJST           RS Record Statu
     C                     MOVELWBAHVN    WCAHVN           RS Job
     C                     MOVELWBAGVN    WCAGVN           RS Program
     C                     MOVELWBABVN    WCABVN           RS User Added
     C                     Z-ADDWBABDT    WCABDT           RS Date Added
     C                     Z-ADDWBABTM    WCABTM           RS Time Added
      *
     C           KLCRSC    KLIST
     C                     KFLD           WCHKST           EA Company Numb
     C                     KFLD           WCB7DT           EA Kill Date
     C                     KFLD           WCKINB           EA Scale Sequen
     C                     KFLD           WCSUA1           EV Comment Line
      * Check for duplicate primary key
     C           KLCRSC    SETLL@BAREZH                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1234' W0RTN   7
      * Send message 'Eval Trans UPL Comment EX'
     C                     MOVEL'PRK1234' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@BAREZH                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * Del Eval Trans UPL Com DL - Eval Trans UPL Comment  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BAREQA
     C                     Z-ADDWBHKST    WDHKST           EA Company Numb
     C                     Z-ADDWBB7DT    WDB7DT           EA Kill Date
     C                     Z-ADDWBKINB    WDKINB           EA Scale Sequen
     C                     Z-ADDWBSUA1    WDSUA1           EV Comment Line
      *
     C           KLDLSD    KLIST
     C                     KFLD           WDHKST           EA Company Numb
     C                     KFLD           WDB7DT           EA Kill Date
     C                     KFLD           WDKINB           EA Scale Sequen
     C                     KFLD           WDSUA1           EV Comment Line
     C           KLDLSD    CHAIN@BAREQA              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLBAREL0'MDACP
     C                     MOVEL'@BAREQA' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BAREQA                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Prg Eval Trans UPL    CR - Eval Trans UPL  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @CPCPVO
     C                     Z-ADDWAHKST    WEHKST           EA Company Numb
     C                     Z-ADDWAB7DT    WEB7DT           EA Kill Date
     C                     Z-ADDWAKINB    WEKINB           EA Scale Sequen
     C                     Z-ADDWAKHNB    WEKHNB           EA Tattoo Numbe
     C                     Z-ADDWALNNB    WELNNB           EA Lot
     C                     MOVELWAHLST    WEHLST           EA Shift
     C                     Z-ADDWAKJNB    WEKJNB           EA Hot Weight
     C                     Z-ADDWAKKNB    WEKKNB           EA Backfat Thic
     C                     Z-ADDWABQPC    WEBQPC           EA Loin-Eye Dep
     C                     Z-ADDWABRPC    WEBRPC           EA Light Reflec
     C                     MOVELWAHMST    WEHMST           EA Trim Area
     C                     MOVELWAHNST    WEHNST           EA Carcass Sex
     C                     MOVELWAHTST    WEHTST           EA Record Creat
     C                     MOVELWAHUST    WEHUST           EA Record Proce
     C                     Z-ADDWAX6NB    WEX6NB           EA Backfat MM
     C                     Z-ADDWAFQPC    WEFQPC           EA LoinEye MM
     C                     Z-ADDWAFRPC    WEFRPC           EA Light Refl M
     C                     MOVELWAM7CD    WEM7CD           EA Trolley Id
     C                     MOVELWAX7ST    WEX7ST           EA Broken Back
     C                     MOVELWAX8ST    WEX8ST           EA Unused Sts 1
     C                     MOVELWAX9ST    WEX9ST           EA Unused Sts 2
     C                     MOVELWAYAST    WEYAST           EA Unused Sts 3
     C                     MOVELWAYBST    WEYBST           EA Unused Sts 4
     C                     MOVELWAYCST    WEYCST           EA Unused Sts 5
     C                     MOVELWAZJST    WEZJST           EA Unused Sts 6
     C                     MOVELWAZKST    WEZKST           EA Unused Sts 7
     C                     MOVELWAZLST    WEZLST           EA Unused Sts 8
     C                     Z-ADDWAB8DT    WEB8DT           RU Date
     C                     Z-ADDWAAOTM    WEAOTM           RU Time
      *
     C           KLCRSE    KLIST
     C                     KFLD           WEHKST           EA Company Numb
     C                     KFLD           WEB7DT           EA Kill Date
     C                     KFLD           WEKINB           EA Scale Sequen
      * Check for duplicate primary key
     C           KLCRSE    SETLL@CPCPVO                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0342' W0RTN   7
      * Send message 'Eval Trans UPL         EX'
     C                     MOVEL'PRK0342' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@CPCPVO                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * Prg Eval Trans UPL    DL - Eval Trans UPL  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @CPCPMW
     C                     Z-ADDWAHKST    WFHKST           EA Company Numb
     C                     Z-ADDWAB7DT    WFB7DT           EA Kill Date
     C                     Z-ADDWAKINB    WFKINB           EA Scale Sequen
      *
     C           KLDLSF    KLIST
     C                     KFLD           WFHKST           EA Company Numb
     C                     KFLD           WFB7DT           EA Kill Date
     C                     KFLD           WFKINB           EA Scale Sequen
     C           KLDLSF    CHAIN@CPCPMW              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKCPCPL0'MDACP
     C                     MOVEL'@CPCPMW' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@CPCPMW                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHKST           EA Company Numb
     C                     Z-ADD*ZERO     WAB7DT           EA Kill Date
     C                     Z-ADD*ZERO     WAKINB           EA Scale Sequen
     C                     Z-ADD*ZERO     WAKHNB           EA Tattoo Numbe
     C                     Z-ADD*ZERO     WALNNB           EA Lot
     C                     Z-ADD*ZERO     WAKJNB           EA Hot Weight
     C                     Z-ADD*ZERO     WAKKNB           EA Backfat Thic
     C                     Z-ADD*ZERO     WABQPC           EA Loin-Eye Dep
     C                     Z-ADD*ZERO     WABRPC           EA Light Reflec
     C                     Z-ADD*ZERO     WAX6NB           EA Backfat MM
     C                     Z-ADD*ZERO     WAFQPC           EA LoinEye MM
     C                     Z-ADD*ZERO     WAFRPC           EA Light Refl M
     C                     Z-ADD*ZERO     WAB8DT           RU Date
     C                     Z-ADD*ZERO     WAAOTM           RU Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHKST           EA Company Numb
     C                     Z-ADD*ZERO     WBB7DT           EA Kill Date
     C                     Z-ADD*ZERO     WBKINB           EA Scale Sequen
     C                     Z-ADD*ZERO     WBSUA1           EV Comment Line
     C                     Z-ADD*ZERO     WBSWA1           Previous Compan
     C                     Z-ADD*ZERO     WBGHDT           Previous Kill D
     C                     Z-ADD*ZERO     WBSXA1           Previous Tattoo
     C                     Z-ADD*ZERO     WBSZA1           Move To Company
     C                     Z-ADD*ZERO     WBGIDT           Move To Kill Da
     C                     Z-ADD*ZERO     WBSYA1           Move To Tattoo
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
