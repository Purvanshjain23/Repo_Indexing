// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLFHXFR
// ?Date: 14.08.2025 Time: 02:54:03
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Fix Tattoo nbr        RT) TYPE(RTVOBJ) FILE(PKDLCPP)           AB1262777;
PARAMETER(360);
PARAMETER(1050203);
PARAMETER(46);
{
 //?USER: Process Data record

 //?**** Get tattoo from Eval Trans Upl per Trolley/Kill dt
 // Call program Rtv Prev Kill Date    XF.
 CALL PROGRAM(Rtv Prev Kill Date    XF) ('PDRUXFR');
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.PSA_Cut_Date);
 PARAMETER(WRK.Date_USR);

 EXECUTE FUNCTION(Rtv Tattoo f/trolley  RT) TYPE(RTVOBJ) FILE(PKCPCPP)           AB1260632;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(WRK.Date_USR);
 PARAMETER(WRK.PSA_Tattoo);
 PARAMETER(DB1.PSA_Trolley_Id);
 {
  //?USER: Initialize routine

  // PAR.EA Tattoo Number = CON.*ZERO
  PAR.EA_Tattoo_Number = *ZERO;

  //?USER: Process Data record

  //?Look for a match on trolley id going back only 2 days.
  CASE;

  // IF DB1.EA Kill Date NE PAR.EA Kill Date
  IF DB1.EA_Kill_Date <> PAR.EA_Kill_Date;

  // WRK.Days USR = DB1.EA Kill Date - PAR.EA Kill Date *DAYS
  WRK.Days_USR = DURATION(DB1.EA_Kill_Date PAR.EA_Kill_Date 'DY' 1111110 'NONE' 'N' 1);

  CASE;

  // IF WRK.Days USR is GT 2
  IF WRK.Days_USR > 2;

  QUIT;

  ENDIF;

  ENDIF;

  //?S00321 RMC 7/11/08 If tattoo found within 2 days, validate it.
  EXECUTE FUNCTION(Rtv Val Ttt,Kll Dt    RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1154371;
  PARAMETER(DB1.EA_Company_Number);
  PARAMETER(DB1.EA_Kill_Date);
  PARAMETER(DB1.EA_Tattoo_Number);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

  }

  CASE;

  // IF PGM.*Return code is *Record does not exist
  IF PGM.*Return_code = 'Y2U0005';

  //?S00321 RMC 7/11/08
  //?if its not valid, get next Eval Trans Upl rcd per RU Date/Time
  EXECUTE FUNCTION(Rtv Tattoo f/RU Dt/Tm RT) TYPE(RTVOBJ) FILE(PKCPCPP)           AB1287961;
  PARAMETER(DB1.EA_Company_Number);
  PARAMETER(DB1.EA_Kill_Date);
  PARAMETER(LCL.EA_Tattoo_Number);
  PARAMETER(DB1.RU_Date);
  PARAMETER(DB1.RU_Time);
  {
   //?USER: Initialize routine

   // PAR.EA Tattoo Number = CON.*ZERO
   PAR.EA_Tattoo_Number = *ZERO;

   //?USER: Process Data record

   //?S00321 RMC new -- Validate tattoo number - quit when valid
   EXECUTE FUNCTION(Rtv Val Ttt,Kll Dt    RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1154371;
   PARAMETER(DB1.EA_Company_Number);
   PARAMETER(DB1.EA_Kill_Date);
   PARAMETER(DB1.EA_Tattoo_Number);
   {
    //?USER: Processing if Data record not found

    // PGM.*Return code = CND.*Record does not exist
    PGM.*Return_code = 'Y2U0005';

   }

   CASE;

   // IF PGM.*Return code is *Record does not exist
   IF PGM.*Return_code = 'Y2U0005';

   // IF *OTHERWISE
   IF *OTHERWISE;

   // PAR.EA Tattoo Number = DB1.EA Tattoo Number
   PAR.EA_Tattoo_Number = DB1.EA_Tattoo_Number;

   QUIT;

   ENDIF;

  }

  CASE;

  // IF LCL.EA Tattoo Number is Not found
  IF LCL.EA_Tattoo_Number = 0;

  //?if one later isnt found, get prev Eval Trans Upl rcd per RU Time
  EXECUTE FUNCTION(Rtv Tattoo f/RU DtTmD RT) TYPE(RTVOBJ) FILE(PKCPCPP)           AB1288070;
  PARAMETER(DB1.EA_Company_Number);
  PARAMETER(DB1.EA_Kill_Date);
  PARAMETER(LCL.EA_Tattoo_Number);
  PARAMETER(DB1.RU_Date);
  PARAMETER(DB1.RU_Time);
  {
   //?USER: Initialize routine

   //?get prev ru date/time rcd
   // PAR.EA Tattoo Number = CON.*ZERO
   PAR.EA_Tattoo_Number = *ZERO;

   //?USER: Process Data record

   //?S00321 RMC new -- Validate tattoo number - quit when valid
   EXECUTE FUNCTION(Rtv Val Ttt,Kll Dt    RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1154371;
   PARAMETER(DB1.EA_Company_Number);
   PARAMETER(DB1.EA_Kill_Date);
   PARAMETER(DB1.EA_Tattoo_Number);
   {
    //?USER: Processing if Data record not found

    // PGM.*Return code = CND.*Record does not exist
    PGM.*Return_code = 'Y2U0005';

   }

   CASE;

   // IF PGM.*Return code is *Record does not exist
   IF PGM.*Return_code = 'Y2U0005';

   // IF *OTHERWISE
   IF *OTHERWISE;

   // PAR.EA Tattoo Number = DB1.EA Tattoo Number
   PAR.EA_Tattoo_Number = DB1.EA_Tattoo_Number;

   QUIT;

   ENDIF;

  }

  ENDIF;

  // PAR.EA Tattoo Number = LCL.EA Tattoo Number
  PAR.EA_Tattoo_Number = LCL.EA_Tattoo_Number;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.EA Tattoo Number = DB1.EA Tattoo Number
  PAR.EA_Tattoo_Number = DB1.EA_Tattoo_Number;

  ENDIF;

  QUIT;

 }

 EXECUTE FUNCTION(Change Primal Scale Detai) TYPE(CHGOBJ) FILE(PKDLCPP)          AB1174499;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.PSA_Scale_ID);
 PARAMETER(DB1.PSA_Cut_Date);
 PARAMETER(DB1.PSA_Cut_Time);
 PARAMETER(DB1.PSA_Sequence);
 PARAMETER(DB1.PSA_Count);
 PARAMETER(DB1.PSA_Weight);
 PARAMETER(WRK.PSA_Tattoo);
 PARAMETER(DB1.PSA_Shift);
 PARAMETER(DB1.PSA_Trolley_Id);
 PARAMETER(DB1.RS_User_Changed);
 PARAMETER(DB1.RS_Date_Changed);
 PARAMETER(DB1.RS_Time_Changed);
 PARAMETER(DB1.RS_Record_Status);
 PARAMETER(DB1.RS_Job);
 PARAMETER(DB1.RS_Program);
 PARAMETER(DB1.RS_User_Added);
 PARAMETER(DB1.RS_Date_Added);
 PARAMETER(DB1.RS_Time_Added);
 //?****
}


