/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM FOR SALES TAX REPORT WITH SELECTIONS   */
/*             FOR COMPANY, ACTUAL SHIP DATE RANGE, AND WAREHOUSES. */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT SALES TAX REPORT BY STATE                     */
/*  DATE      - 12/17/97                                            */
/*                                                                  */
/*  PARAMETERS                                                      */
/*                                                                  */
/*      &CMPNBR    B    Company Number                              */
/*      &FDATE     B    From Date                                   */
/*      &TDATE     B    To Date                                     */
/*      &WHSE1     B    Selection Warehouse 1                       */
/*      &WHSE2     B    Selection Warehouse 2                       */
/*      &WHSE3     B    Selection Warehouse 3                       */
/*      &WHSE4     B    Selection Warehouse 4                       */
/*      &WHSE5     B    Selection Warehouse 5                       */
/*      &WHSE6     B    Selection Warehouse 6                       */
/*      &WHSE7     B    Selection Warehouse 7                       */
/*      &WHSE8     B    Selection Warehouse 8                       */
/*      &WHSE9     B    Selection Warehouse 9                       */
/*      &WHSE10    B    Selection Warehouse 10                      */
/*      &SOFLAG    B    Warehouse Select/Omit Flag                  */
/*      &OUTQ      B    Report Output Queue                         */
/*      &HOLD      B    Hold Spool File (Yes/No)                    */
/*      &SAVE      B    Save Spool File (Yes/No)                    */
/*      &COPIES    B    Number of Copies                            */
/*      &EXPORT    B    Export(Y) or Domestic(N) or Both(blank)     */
/*      &SORT      B    Sort Cntry/State or State only              */
/********************************************************************/
/* PIO 05/30/23  REPLACE OPNQRYF WITH OPNSQLF FOR OMHSTPP FILE      */
/*               ADDED NEEDED OVRDBF AROUND THE COMMAND.            */
/*               CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=,*/
/*               *GT TO > IN &H                                     */
/********************************************************************/
 PDEOCLP:    PGM  PARM(&CMPNBR &FDATE &TDATE &WHSE1 &WHSE2 &WHSE3 +
                       &WHSE4 &WHSE5 &WHSE6 &WHSE7 &WHSE8 &WHSE9 +
                       &WHSE10 &SOFLAG &OUTQ &HOLD &SAVE &COPIES +
                       &EXPORT &SORT &RPTTYP &ITMCLS &STATE)

/*************************/
/*** DECLARE VARIABLES ***/
/*************************/

        /*** I/O Parameters ***/
             DCL  VAR(&CMPNBR)   TYPE(*DEC)  LEN(15 5)
             DCL  VAR(&FDATE)    TYPE(*DEC)  LEN(15 5)
             DCL  VAR(&TDATE)    TYPE(*DEC)  LEN(15 5)
             DCL  VAR(&WHSE1)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE2)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE3)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE4)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE5)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE6)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE7)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE8)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE9)    TYPE(*CHAR) LEN(3)
             DCL  VAR(&WHSE10)   TYPE(*CHAR) LEN(3)
             DCL  VAR(&SOFLAG)   TYPE(*CHAR) LEN(1)
             DCL  VAR(&OUTQ)     TYPE(*CHAR) LEN(10)
             DCL  VAR(&HOLD)     TYPE(*CHAR) LEN(4)
             DCL  VAR(&SAVE)     TYPE(*CHAR) LEN(4)
             DCL  VAR(&COPIES)   TYPE(*DEC)  LEN(15 5)
             DCL  VAR(&EXPORT)   TYPE(*CHAR) LEN(1)
             DCL  VAR(&SORT)     TYPE(*CHAR) LEN(1)
             DCL  VAR(&RPTTYP)   TYPE(*CHAR) LEN(1)
             DCL  VAR(&ITMCLS)   TYPE(*DEC)  LEN(3 0)
             DCL  VAR(&STATE)    TYPE(*CHAR) LEN(2)

        /*** Internal Work Fields ***/
             DCL  VAR(&CMPNBR_N) TYPE(*DEC)  LEN(3 0)
             DCL  VAR(&FDATE_N)  TYPE(*DEC)  LEN(7 0)
             DCL  VAR(&TDATE_N)  TYPE(*DEC)  LEN(7 0)
             DCL  VAR(&COPIES_N) TYPE(*DEC)  LEN(3 0)

             DCL  VAR(&CMPNBR_A) TYPE(*CHAR) LEN(3)
             DCL  VAR(&TDATE_A)  TYPE(*CHAR) LEN(7)
             DCL  VAR(&FDATE_A)  TYPE(*CHAR) LEN(7)
             DCL  VAR(&XITMCLS)  TYPE(*CHAR) LEN(3)

             DCL  VAR(&COMMAND)  TYPE(*CHAR) LEN(512)
             DCL  VAR(&A)        TYPE(*CHAR) LEN(20)
             DCL  VAR(&B)        TYPE(*CHAR) LEN(25)
             DCL  VAR(&C)        TYPE(*CHAR) LEN(25)
             DCL  VAR(&D)        TYPE(*CHAR) LEN(25)
             DCL  VAR(&E)        TYPE(*CHAR) LEN(25)
             DCL  VAR(&H)        TYPE(*CHAR) LEN(145)

/*************************/
/*** Convert Variables ***/
/*************************/

        /*** Set to proper length for print program ***/
             CHGVAR VAR(&CMPNBR_N) VALUE(&CMPNBR)
             CHGVAR VAR(&FDATE_N)  VALUE(&FDATE)
             CHGVAR VAR(&TDATE_N)  VALUE(&TDATE)
             CHGVAR VAR(&COPIES_N) VALUE(&COPIES)

        /*** Convert to alpha for query data ***/
             CHGVAR VAR(&CMPNBR_A)  VALUE(&CMPNBR_N)
             CHGVAR VAR(&FDATE_A) VALUE(&FDATE_N)
             CHGVAR VAR(&TDATE_A) VALUE(&TDATE_N)
             CHGVAR VAR(&XITMCLS)   VALUE(&ITMCLS)

/******************************************************/
/*** Build Selection for Open Query & Execute Query ***/
/******************************************************/

 /*PIO       CHGVAR VAR(&A) VALUE('F4GNDT *GE ' *CAT &FDATE_A)   */
 /*PIO*/     CHGVAR VAR(&A) VALUE('F4GNDT >=  ' *CAT &FDATE_A)
 /*PIO       CHGVAR VAR(&B) VALUE('*AND F4GNDT *LE ' *CAT &TDATE_A) */
 /*PIO*/     CHGVAR VAR(&B) VALUE(' AND F4GNDT <=  ' *CAT &TDATE_A)

             IF COND(&EXPORT *EQ 'Y') THEN(DO)
                /* Export Only(Y) */
 /*PIO          CHGVAR VAR(&C) VALUE('*AND F4U2ST *EQ ''Y''')  */
 /*PIO*/        CHGVAR VAR(&C) VALUE(' AND F4U2ST  =  ''Y''')
             ENDDO
             ELSE CMD(DO)
                IF COND(&EXPORT *EQ 'N') THEN(DO)
                   /* Domestic Only(N) */
 /*PIO             CHGVAR VAR(&C) VALUE('*AND F4U2ST *NE ''Y''')   */
 /*PIO*/           CHGVAR VAR(&C) VALUE(' AND F4U2ST <>  ''Y''')
                ENDDO
                ELSE CMD(DO)
                   /* Both Export & Domestic */
                ENDDO
             ENDDO

             IF COND(&STATE *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&D) VALUE('*AND F4DBCD *EQ "' *CAT +  +
                          &STATE *CAT '"')                       */
 /*PIO*/     CHGVAR     VAR(&D) VALUE(' AND F4DBCD  =  "' *CAT +
                          &STATE *CAT '"')
             ENDDO

             IF COND(&ITMCLS *NE 0) THEN(DO)
 /*PIO       CHGVAR VAR(&E) VALUE('*AND F4RINB *EQ ' *CAT &XITMCLS) */
 /*PIO*/     CHGVAR VAR(&E) VALUE(' AND F4RINB  =  ' *CAT &XITMCLS)
             ENDDO

             CHGVAR     VAR(&H) VALUE(&A *BCAT &B *BCAT &C *BCAT &D +
                          *BCAT &E)

 /*PIO       OVRDBF FILE(OMHSTPLJ) SHARE(*YES)   +
             OPNQRYF FILE(OMHSTPLJ) +            +
                     QRYSLT(&H) +                +
                     KEYFLD(*FILE)              */

  /*PIO*/    OVRDBF     FILE(OMHSTPP) TOFILE(OMHSTPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMHSTPP Where  ' *BCAT &H +
                          *BCAT ' ORDER BY F4AIC3 ASC, F4UMCD ASC, +
                          F4DBCD ASC') OPNID(OMHSTPLJ) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@HSTPRD) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OMHSTPLJ) TOFILE(OMHSTPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)


/******************************************************/
/*** Override Print File with User Specified Values ***/
/******************************************************/
             SBDPRTOVR CMDVAR(&COMMAND) FILE(PDEOPFR$) OUTQ(&OUTQ) +
                       COPIES(&COPIES_N) HOLD(&HOLD) SAVE(&SAVE)
             CALL PGM(QCMDEXC) PARM(&COMMAND 512)

/*************************************/
/*** Call Sales Tax Report Program ***/
/*************************************/
             CALL PGM(PDEOPFR) +
                  PARM('' &CMPNBR_N &FDATE_N &TDATE_N +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 +
                          &WHSE5 &WHSE6 &WHSE7 &WHSE8 +
                          &WHSE9 &WHSE10 &SOFLAG +
                          &EXPORT &SORT &RPTTYP &ITMCLS &STATE)
             CLOF OPNID(OMHSTPLJ)
   /*PIO     DLTOVR FILE(OMHSTPLJ)   */
             DLTOVR     FILE(OMHSTPLJ) LVL(*JOB) /*PIO*/

 END:
             ENDPGM
