/********************************************************************/
/**ˆNOTE: THIS IS A CLONE FROM PDJWPCLP PROGRAM. HOWEVER, IT HAS    */
/**      ˆBEEN MODIFIED TO SIMPLY PRINT THE ORDER ACK IN QPRINT &   */
/**      ˆCONVERT SPOOLED FILE TO PDF & SEND IT TO IFS.             */
/*                                                                  */
/*  SYNOPSIS - PRINT PROGRAM WITH SELECTIONS FOR ACKNOWLEDGEMENTS-  */
/*             CO#, FROM ORDER, TO ORDER, ENTRY DATE, REQ. SHIP DATE*/
/*             ORDER TYPE, & USER ID                                */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PRINT ACKNOWLEDGEMENTS                              */
/*  DATE      -  3/27/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &COMPNYN    - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FRMORDN    - FROM ORDER                                */
/*          &TOORDRN    - TO ORDER                                  */
/*          &ENTDATN    - ENTRY DATE                                */
/*          &REQDATN    - SCHECULED SHIP DATE                       */
/*          &OTYPE      - ORDER TYPE - BLANK FOR ALL IN BILL TYPE   */
/*          &BILLTYP    - BILL ACT. TYPE - BLANK FOR CR & DR MEMOS  */
/*                                         1 FOR ORDERS             */
/*                                         2 FOR CREDIT MEMOS       */
/*                                         3 FOR DEBIT MEMOS        */
/*          &EXPSLS     - EXPORT SALES                              */
/*          &OUTQ       - OUTPUT QUEUE                              */
/*          &HOLD       - HOLD PRINT                                */
/*          &SAVE       - SAVE PRINT                                */
/*          &COPYN      - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT OUTPUT QUEUE                        */
/*          &WHSE1      - WAREHOUSE 1                               */
/*          &WHSE2      - WAREHOUSE 2                               */
/*          &WHSE3      - WAREHOUSE 3                               */
/*          &WHSE4      - WAREHOUSE 4                               */
/*          &WHSE5      - WAREHOUSE 5                               */
/*          &WHSE6      - WAREHOUSE 6                               */
/*          &WHSE7      - WAREHOUSE 7                               */
/*          &WHSE8      - WAREHOUSE 8                               */
/*          &WHSE9      - WAREHOUSE 9                               */
/*          &WHSE10     - WAREHOUSE 10                              */
/*          &SOFLAG     - SELECT/OMIT FLAG                          */
/*          &EMTWHS     - EMAIL TO WAREHOUSE                        */
/*          &EMWHSS     - EMAIL THIS WAREHOUSE SELECTED             */
/********************************************************************/
/* RMC 06/23/04 IF OUTQ IS FAXQ, DO OVRPRTF NOT SBDPRTOVR           */
/* RMC 06/17/13 IF OUTQ IS BLANK, DONT PRINT IT, JUST SEND TO WHSE  */
/* LJB 01/28/15 IF PGMR THEN CHANGE OUTQ TO QPRINT3 (TESTING)       */
/* DN  11/26/18 R13944 - CONVERT PDKOPFR SPOOLED FILE TO PDF & SAVE */
/*     TO IFS.                                                      */
/* DN  12/09/21 DO2416 - Based on the Company default the following to    */
/*                       set the following prefix to the IFS filename:    */
/*                       to the IFS filename:                             */
/*                       Co:    Prefix:                                   */
/*                       360 -> 'G'uymon                                  */
/*                       440 -> 'S'ioux City                              */
/*                       960 -> 'T'riumph Foods                           */
/* DN  01/31/22 DO2416 - Call PUVVXFR to update the IFS PHIS Document     */
/*                       filename in order for Business Integrations team */
/*                       can send the file to the USDA PHIS website.      */
/*                       Will use Doc Type 'A' as the Order Ack filename. */
/* PIO 05/19/23  - REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPP FILE         . */
/*                 ADDED NEEDED OVRDBF AROUND THE COMMAND               . */
/*                 CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=,  . */
/*                 *GT TO > IN &E                                       . */
/* SG  04/25/25  - PASSED PARAMETER TO PDKOPFR AS N                     . */
/* SG  05/02/25  - Parameter length is changed for PDKOPFR(Tag S029516) . */
/**************************************************************************/

 PDJWPCLP:   PGM        PARM(&COMPNYN &FRMORDN &TOORDRN &ENTDATN +
                          &REQDATN &REQDATN2 &OTYPE &SHPMTH +
                          &BILLTYP &EXPSLS &WHSE1 &WHSE2 &WHSE3 +
                          &WHSE4 &WHSE5 &WHSE6 &WHSE7 &WHSE8 &WHSE9 +
                          &WHSE10 &SOFLAG &OUTQ &HOLD &SAVE &COPYN +
                          &NIGHTQ &ACSDTTN &EMTWHS &EMWHSS)

/* PARMS                                                                      */
        DCL    &COMPNYN    *DEC                  /* Company Number (Passed)   */
        DCL    &FRMORDN    *DEC                  /* FROM ORDER     (Passed)   */
        DCL    &TOORDRN    *DEC                  /* TO ORDER       (Passed)   */
        DCL    &ENTDATN    *DEC                  /* ENTRY DATE     (Passed)   */
        DCL    &REQDATN    *DEC                  /* SCH SHIP DATE  (Passed)   */
        DCL    &REQDATN2   *DEC                  /* SCH SHIP DATE  (Passed)   */
        DCL    &OTYPE      *CHAR   (2)           /* Order Type                */
        DCL    &SHPMTH     *CHAR   (2)           /* SHIPPING METHOD           */
        DCL    &BILLTYP    *CHAR   (1)           /* Billing Activity Type     */
        DCL    &EXPSLS     *CHAR   (1)           /* EXPORT SALES       pe     */
        DCL    &COPYN      *DEC                  /* No. of Copies             */
        DCL    &OUTQ       *CHAR   (10)          /* Output Queue              */
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &NIGHTQ     *CHAR   (10)          /* Night Job Queue           */
        DCL    &PGMO       *CHAR    10           /*  PRINTER FILE  */
        DCL    &SOFLAG     *CHAR   (1)           /* WAREHOUSE                 */
        DCL    &WHSE1      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE2      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE3      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE4      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE5      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE6      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE7      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE8      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE9      *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &WHSE10     *CHAR   (3)           /* WAREHOUSE                 */
        DCL    &ACSDTTN    *DEC                  /* ACTUAL SHIP DT (Passed)   */
        DCL    &EMTWHS     *CHAR   (1)           /* Email To Warehouse select */
        DCL    &EMWHSS     *CHAR   (3)           /* Email to this Warehouse   */
 /* S020798 - Declared new variable to pass to PDKOPFR    */
 /*     DCL    &EMLSLS     *CHAR   (1)           /* Email To Salesperson      */
 /* S029516 - Length of parameter is changed to 50        */
        DCL    &EMLSLS     *CHAR   (50)          /* Email addr of Salesperson */

        DCL    &B          *CHAR    30           /*  QRY-SEL CO.#  */
        DCL    &C          *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &CC         *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &CCC        *CHAR    30           /*  QRY-SEL ORDER TYPE */
        DCL    &D          *CHAR    25           /*  QRY-EXPORT SALES  */
        DCL    &DD         *CHAR    30           /*  QRY-SEL ENTRY DATE  */
        DCL    &DDD        *CHAR    50           /*  QRY-SEL REQ. SHIP DATE  */
        DCL    &DDDD       *CHAR    30           /*  QRY-SEL ACT. SHIP DATE  */
        DCL    &DDDDD      *CHAR    30           /*  QRY-SEL SHPPING METHOD  */
 /*PIO  DCL    &E          *CHAR   275      */   /*  QRY COMPLETE SEL. */
 /*PIO*/DCL    &E          *CHAR   325           /*  QRY COMPLETE SEL. */
 /*PIO*/DCL    &F          *CHAR   250
        DCL    &COMMAND    *CHAR   (512)

/* INTERNAL FIELDS                                                            */
        DCL    &COPY       *DEC    (2 0)         /* Number of copies          */
        DCL    &COMPANY    *DEC    (3 0)         /* Company Number            */
        DCL    &JOBNM      *CHAR   (10)          /* JOB NAME */
        DCL    &JOBNB      *CHAR   (6)           /* JOB NUMBER */
        DCL    &RTNCDE     *CHAR   (7)           /* RETURN CODE */
        DCL    &SYSVCDE    *CHAR   (10) VALUE('PRKEXPDOC')
        DCL    &PREFIX     *CHAR   (1)           /* PREFIX FOR IFS FILE */
        DCL    &IFSSTMF    *CHAR   (50)          /* IFS STREAM FILE DIR */
        DCL    &IFSEND     *CHAR   (8) VALUE('_SUP.pdf')
        DCL    &IFSFILNM   *CHAR   (50)          /* IFS DOC FILENAME */


/* Name of the distriubtion list that will be used                 */
        DCL    &DISTNME    *CHAR   (60)
        DCL    &EDESC      *CHAR   (50)          /* Email Description         */
        DCL    &ITDESC     *CHAR   (30)          /* Internal desc title       */
        DCL    &EMVALU     *CHAR   (10)          /* Email Distribution Code   */
        DCL    &EADDR      *CHAR   (50)          /* EMAIL Address             */
        DCL    &FRORDR     *DEC    (7 0)         /* From ORDER                */
        DCL    &TOORDR     *DEC    (7 0)         /* To ORDER                  */
        DCL    &ENTDAT     *DEC    (7 0)         /* ENTRY DATE                */
        DCL    &REQDAT     *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &REQDAT2    *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &ACTSDAT    *DEC    (7 0)         /* REQ. SHIP DATE            */
        DCL    &COMMAND    *CHAR   (512)         /* FOR PRT OVERRIDE          */
        DCL    &USER       *CHAR   (10)
        DCL    &GRPPRF     *CHAR   (10)

/* OPENQRYF FIELDS                                                            */
        DCL    &COMPA      *CHAR    3            /* ACK COMPLETE              */
        DCL    &FRMORDA    *CHAR    7            /* FROM ORDER                */
        DCL    &TOORDRA    *CHAR    7            /* TO ORDER       (Passed)   */
        DCL    &ENTDATA    *CHAR    7            /* ENTRY DATE     (Passed)   */
        DCL    &REQDATA    *CHAR    7            /* REQ SHIP DATE  (Passed)   */
        DCL    &REQDATA2   *CHAR    7            /* REQ SHIP DATE  (Passed)   */
        DCL    &ACSDATA    *CHAR    7            /* ACTUAL SHP DT  (Passed)   */
        DCL    &BLK50      *CHAR    50           /* BLANKS                    */

             RTVJOBA    JOB(&JOBNM) USER(&USER) NBR(&JOBNB)
             RTVUSRPRF  USRPRF(&USER) GRPPRF(&GRPPRF)

/********************************************************************/
/* CHANGE VARIABLES FOR USE IN PROGRAM                              */
/********************************************************************/
             CHGVAR     VAR(&PGMO) VALUE(PDKOPFR$)
             CHGVAR     VAR(&COMPANY) VALUE(&COMPNYN)
             CHGVAR     VAR(&COMPA) VALUE(&COMPANY)
             CHGVAR     VAR(&FRORDR) VALUE(&FRMORDN)
             CHGVAR     VAR(&FRMORDA) VALUE(&FRORDR)
             CHGVAR     VAR(&TOORDR) VALUE(&TOORDRN)
             CHGVAR     VAR(&TOORDRA) VALUE(&TOORDR)
             CHGVAR     VAR(&ENTDAT) VALUE(&ENTDATN)
             CHGVAR     VAR(&ENTDATA) VALUE(&ENTDAT)
             CHGVAR     VAR(&REQDAT) VALUE(&REQDATN)
             CHGVAR     VAR(&REQDATA) VALUE(&REQDAT)
             CHGVAR     VAR(&REQDAT2) VALUE(&REQDATN2)
             CHGVAR     VAR(&REQDATA2) VALUE(&REQDAT2)
             CHGVAR     VAR(&COPY) VALUE(&COPYN)
             CHGVAR     VAR(&ACTSDAT) VALUE(&ACSDTTN)
             CHGVAR     VAR(&ACSDATA) VALUE(&ACTSDAT)

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED TO SELECT ACKS.               */
/*********************************************************************/
/*  IF CO. NUMBER SELECTED  */
             IF         COND(&COMPA *NE '000') THEN(DO)
   /*PIO     CHGVAR     VAR(&B) VALUE('BEAIC3 *EQ ' *CAT &COMPA)  */
  /*PIO*/    CHGVAR     VAR(&B) VALUE('BEAIC3  =  ' *CAT &COMPA)
             ENDDO

/*  IF FROM ORDER IS ENTERED */

             IF         COND(&FRMORDA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&CC) VALUE('*AND BEC4NB *GE ' *CAT &FRMORDA) */
  /*PIO*/    CHGVAR     VAR(&CC) VALUE(' AND BEC4NB >=  ' *CAT &FRMORDA)
             ENDDO

/*  IF TO ORDER IS ENTERED */
             IF         COND(&TOORDRA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&CCC) VALUE('*AND BEC4NB *LE ' *CAT &TOORDRA) */
  /*PIO*/    CHGVAR     VAR(&CCC) VALUE(' AND BEC4NB <=  ' *CAT &TOORDRA)
             ENDDO

/*  IF ENTRY DATE IS SELECTED */

             IF         COND(&ENTDATA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&DD) VALUE('*AND BECXDT *EQ ' *CAT &ENTDATA) */
  /*PIO*/    CHGVAR     VAR(&DD) VALUE(' AND BECXDT  =  ' *CAT &ENTDATA)
             ENDDO

/*  IF SCHEDULED SHIP DATE IS SELECTED */

             IF         COND(&REQDATA *NE '0000000') THEN(DO)
  /*PIO      CHGVAR     VAR(&DDD) VALUE('*AND BEAODT *GE ' *CAT +  +
                          &REQDATA *BCAT '*AND BEAODT *LE ' *CAT + +
                          &REQDATA2)                              */
  /*PIO*/    CHGVAR     VAR(&DDD) VALUE(' AND BEAODT >=  ' *CAT +
                          &REQDATA *BCAT ' AND BEAODT <=  ' *CAT +
                          &REQDATA2)
             ENDDO

/*  IF ACTUAL SHIPPED DATE IS SELECTED */

             IF         COND(&ACSDATA *NE '0000000') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDDD) VALUE('*AND BEGNDT *EQ ' *CAT + +
                          &ACSDATA)                               */
 /*PIO*/     CHGVAR     VAR(&DDDD) VALUE(' AND BEGNDT  =  ' *CAT +
                          &ACSDATA)
             ENDDO

/*  IF SHIPPING METHOD IS SELECTED     */

             IF         COND(&SHPMTH *NE '  ') THEN(DO)
 /*PIO       CHGVAR     VAR(&DDDDD) VALUE('*AND BEQ2CD *EQ "' *CAT + +
                          &SHPMTH *CAT '"')                        */
 /*PIO*/     CHGVAR     VAR(&DDDDD) VALUE(' AND BEQ2CD =   "' *CAT +
                          &SHPMTH *CAT '"')
             ENDDO

/*  ORDER TYPE - IF NOT BLANK, INCLUDE ONLY THAT SELECT, ELSE  */
/*   INCLUDE ANY EXCEPT 'I ' (INVOICED FROM CONFIRMATION)      */
             IF         COND(&OTYPE *NE '  ') THEN(DO)
  /*PIO      CHGVAR     VAR(&C) VALUE('*AND BEJNCD *EQ "' *CAT &OTYPE + +
                        *CAT '"')                                    */
  /*PIO*/    CHGVAR     VAR(&C) VALUE(' AND BEJNCD  =  "' *CAT &OTYPE +
                        *CAT '"')
             ENDDO

             IF         COND(&EXPSLS *EQ 'N') THEN(DO)
  /*PIO      CHGVAR     VAR(&D) VALUE('*AND BEU2ST *NE ' *CAT '"Y"')  */
  /*PIO*/    CHGVAR     VAR(&D) VALUE(' AND BEU2ST  <> ' *CAT '"Y"')
             ENDDO
             IF         COND(&EXPSLS *EQ 'E') THEN(DO)
  /*PIO      CHGVAR     VAR(&D) VALUE('*AND BEU2ST *EQ ' *CAT + +
                         '"Y"')                                */
 /*PIO*/     CHGVAR     VAR(&D) VALUE(' AND BEU2ST  =  ' *CAT +
                         '"Y"')
             ENDDO

  /*PIO*/    CHGVAR     VAR(&F) VALUE(' AND BEGJST = "N" AND BEGWST IN +
                                ("L","A","C","R","E","H","I")')


  /*PIO      CHGVAR     VAR(&E) VALUE(&B *BCAT &C *BCAT &CC *BCAT + +
                          &CCC *BCAT &D *BCAT &DD *BCAT &DDD *BCAT ++
                          &DDDD *BCAT &DDDDD)                       */
  /*PIO*/    CHGVAR     VAR(&E) VALUE(&B *BCAT &C *BCAT &CC *BCAT +
                          &CCC *BCAT &D *BCAT &DD *BCAT &DDD *BCAT +
                          &DDDD *BCAT &DDDDD *BCAT &F)

  /*PIO      OVRDBF     FILE(OPBFCPLN) SHARE(*YES)     +
             OPNQRYF    FILE((OPBFCPLN)) QRYSLT(&E) KEYFLD((BEAIC3) + +
                          (BEC4NB)) SEQONLY(*YES)        */

  /*PIO*/    OVRDBF     FILE(OPBFCPP) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP where  ' *BCAT &E +
                          *BCAT ' ORDER BY BEAIC3 ASC, BEC4NB ASC, +
                          BEBKC7 ASC  ') OPNID(OPBFCPLN) +
                          OPTION(*ALL) SEQONLY(*NO) RCDFMT(@BFCPYX) +
                          ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPLN) TOFILE(OPBFCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

/********************************************************************/
/* OVERRIDE PRINTER FILE WITH USER SPECIFIED SELECTION VALUES       */
/********************************************************************/
             IF         COND(&OUTQ *EQ 'FAXQ') THEN(OVRPRTF +
                          FILE(PDKOPFR$) PAGRTT(90) OUTQ(PRKFLIB/FAXQ))
             ELSE       CMD(DO)
             IF         COND(&OUTQ *NE '      ') THEN(DO)
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDKOPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPY) HOLD(&HOLD) SAVE(&SAVE) +
                          USRDTA(&FRMORDA) LETTER(*YES)
             MONMSG     MSGID(CPF2702 CPF0000)

/* IF A PGMR IS RUNNING THIS PGM THEN CHANGE THE OUTQ TO A TEST OUTQ */
             IF         COND(&GRPPRF *EQ 'SBDPGMR') THEN(DO)
             CHGVAR     VAR(&OUTQ) VALUE(QPRINT3)
             ENDDO

             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
             ENDDO
             ENDDO

/*********************************************************************/
/*   CALL PRINT PROGRAM -  IF OUTQ NOT BLANK - IF BLANK THEY DIDN'T  */
/*   SELECT TO PRINT IT.. JUST SEND TO THE WAREHOUSE                 */
/*********************************************************************/
             IF         COND(&OUTQ *NE '      ') THEN(DO)
             CALL       PGM(PDKOPFR) PARM(' ' &COMPANY &BILLTYP +
                          &WHSE1 &WHSE2 &WHSE3 &WHSE4 &WHSE5 &WHSE6 +
                          &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG &EMLSLS)
    /* S020798            &WHSE7 &WHSE8 &WHSE9 &WHSE10 &SOFLAG)      */

    /*===========================================*/
    /* Select Prefix Based on Company Number     */
    /*===========================================*/
             SELECT
               WHEN       COND(&COMPANY *EQ 360) THEN(CHGVAR +
                          VAR(&PREFIX) VALUE('G'))
               WHEN       COND(&COMPANY *EQ 440) THEN(CHGVAR +
                          VAR(&PREFIX) VALUE('S'))
               OTHERWISE  CMD(DO)
                          CHGVAR VAR(&PREFIX) VALUE('T') /* Co = 960 */
               ENDDO
             ENDSELECT

    /* DN 11/26/18 R13944--CONVERT SPOOLED FILE TO PDF & SAVE TO IFS */
         /* Get Pork Export Doc IFS Path */
             CALL       PGM(PPJXXFR) PARM(&RTNCDE &SYSVCDE &IFSSTMF)
    /* DN 12/09/21 DO2416--Concat Prefix to IFS Stream filename */
         /*  CHGVAR     VAR(&IFSSTMF) VALUE(&IFSSTMF *TCAT &FRMORDA +
                          *TCAT &IFSEND)  */
             CHGVAR     VAR(&IFSSTMF) VALUE(&IFSSTMF *TCAT &PREFIX +
                          *TCAT &FRMORDA *TCAT &IFSEND)
             CPYSPLIFS  SPLF(PDKOPFR$) JOB(&JOBNB/&USER/&JOBNM) +
                          TYPE(*PDF) STMF(&IFSSTMF) REPLACE(*YES)
    /* DN 01/31/21 DO2416-Update EDE IFS PHIS Doc Filename in PUA6CPP +
          for the Order Ack filename */
             CHGVAR     VAR(&IFSFILNM) VALUE(&PREFIX *TCAT &FRMORDA +
                          *TCAT &IFSEND)
             CALL       PGM(PUVVXFR) PARM(' ' &COMPANY &FRORDR 'A' +
                          &IFSFILNM)

             ENDDO

/*********************************************************************/
/*   CLOSE OPEN QUERY FILE -
/*********************************************************************/

             CLOF       OPNID(OPBFCPLN)
  /*PIO      DLTOVR     FILE(OPBFCPLN)    */
             DLTOVR     FILE(OPBFCPLN) LVL(*JOB) /*PIO*/

 END:        ENDPGM
