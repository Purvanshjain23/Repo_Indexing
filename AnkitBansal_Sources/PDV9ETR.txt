     H/TITLE EDT Calc Rated Frt OLD ET Edit transaction
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain DBF header and associated DBF detail records
     H* - DBF header record fields appear on SFL control record
     H* - DBF detail records appear on SFL detail record
     H* - Program functions in two modes : *ADD and *CHANGE
     H* - Existing records may be updated or deleted
     H*   But key changes are not allowed
      *
     H* Generated by  : SYNON/2  Version:  1418
     H* Function type : Edit transaction
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISPPATE
     H* Date          : 06/24/97  Time  : 01:17:36
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPDV9ETR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: EDT Calc Rated Frt OLD ET Edit transaction
      *
     FOMFJCPL6IF  E           K        DISK
     F                                              KINFDS INFDS1
      * SPN : OM Load Header            SPN Co/Load/Stop/Order
      *
     FOMFFREL0IF  E           K        DISK
      * RTV : OM Carrier                Retrieval index
      *
     FOMFLCPL1IF  E           K        DISK
      * RTV : OM Load Detail            Retrieval index
      *
     FOPBFCPL1IF  E           K        DISK
      * RTV : PD Order Header           Retrieval index       NV
      *
     FCAAFREL1IF  E           K        DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FOMFKREL0IF  E           K        DISK
      * RTV : OM Truck Size             Retrieval index
      *
     FCAADREL1IF  E           K        DISK
      * RTV : Warehouse                 Retrieval index       NV
      *
     FCAACREL1IF  E           K        DISK
      * RTV : State                     Retrieval index       NV
      *
     FPDLCREL0IF  E           K        DISK
      * RTV : PD Shipping Line/Port     Retrieval index
      *
     FOPBFCPLJIF  E           K        DISK
      * RSQ : PD Order Header           RSQ Co Load(Desc) not bl
      *
     FOPBGWKL1IF  E           K        DISK
      * RTV : PD Order Detail           Retrieval index
      *
     FCAABREL1IF  E           K        DISK
      * RTV : Company Name and Address  Retrieval index       V
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : Application Profile       Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FOMFLCPL4IF  E           K        DISK
      * RSQ : OM Load Detail            Co/Stop Descending
      *
     FOPBFCPL0UF  E           K        DISK
      * UPD : PD Order Header           Update index
      *
     FOPBGWKL0UF  E           K        DISK
      * UPD : PD Order Detail           Update index
      *
     FOMFJCPL1UF  E           K        DISK
      * UPD : OM Load Header            Update index
      *
     FOMFLCPL0UF  E           K        DISK
      * UPD : OM Load Detail            Update index
      *
     E                    #L7         7  1
     E                    J7          7  1
     E                    K7          7  1
      * RIGHT JUSTIFY INPUT FIELD
     E                    UCT        40  1               CENTER TABLE
     I@FLCPBW
      * OM Load Detail            Retrieval index
      * Renamed input format fields
     I              FLAIC3                          WAAIC3
     I              FLRMNB                          WARMNB
     I              FLRUNB                          WARUNB
     I              FLRVNB                          WARVNB
     I              FLDQTX                          WADQTX
     I              FLRWNB                          WARWNB
     I              FLRXNB                          WARXNB
     I              FLSQNB                          WASQNB
     I              FLT0NB                          WAT0NB
     I              FLT1NB                          WAT1NB
     I              FLR1NB                          WAR1NB
     I              FLC4NB                          WAC4NB
     I              FLVCST                          WAVCST
     I              FLKEDT                          WAKEDT
     I              FLSXNB                          WASXNB
     I              FLKFDT                          WAKFDT
     I              FLACTM                          WAACTM
     I              FLK5TX                          WAK5TX
     I              FLW5CD                          WAW5CD
     I              FLEJDT                          WAEJDT
     I              FLAGTM                          WAAGTM
     I              FLKJDT                          WAKJDT
     I              FLATTM                          WAATTM
     I              FLHDDT                          WAHDDT
     I              FLAUTM                          WAAUTM
     I              FLKKDT                          WAKKDT
     I              FLAVTM                          WAAVTM
     I              FLUVST                          WAUVST
     I              FLUWST                          WAUWST
     I              FLUXST                          WAUXST
     I              FLAATM                          WAAATM
     I              FLAYNA                          WAAYNA
     I              FLA0NA                          WAA0NA
     I              FLAXDT                          WAAXDT
      *
     I@BFCPNQ
      * PD Order Header           RSQ Co Load(Desc) not bl
      * Renamed input format fields
     I              BEAIC3                          WBAIC3
     I              BEC4NB                          WBC4NB
     I              BEJNCD                          WBJNCD
     I              BEANC7                          WBANC7
     I              BEBKC7                          WBBKC7
     I              BEBRTX                          WBBRTX
     I              BEHMNA                          WBHMNA
     I              BEHONA                          WBHONA
     I              BEHPNA                          WBHPNA
     I              BEHNNA                          WBHNNA
     I              BEDBCD                          WBDBCD
     I              BECKTX                          WBCKTX
     I              BEB0C7                          WBB0C7
     I              BEAETX                          WBAETX
     I              BEB1NA                          WBB1NA
     I              BEB3NA                          WBB3NA
     I              BEB4NA                          WBB4NA
     I              BEB2NA                          WBB2NA
     I              BEBHCD                          WBBHCD
     I              BEC8TX                          WBC8TX
     I              BEBCNA                          WBBCNA
     I              BEA0DT                          WBA0DT
     I              BEA5DT                          WBA5DT
     I              BEGNDT                          WBGNDT
     I              BEACDT                          WBACDT
     I              BEAQCD                          WBAQCD
     I              BEB6NA                          WBB6NA
     I              BEBYNA                          WBBYNA
     I              BEBZNA                          WBBZNA
     I              BEGTST                          WBGTST
     I              BEGVST                          WBGVST
     I              BEGUST                          WBGUST
     I              BEQFST                          WBQFST
     I              BECQCD                          WBCQCD
     I              BEGJST                          WBGJST
     I              BEGWST                          WBGWST
     I              BEGXST                          WBGXST
     I              BEGYST                          WBGYST
     I              BEAODT                          WBAODT
     I              BEAIVN                          WBAIVN
     I              BECXDT                          WBCXDT
     I              BEJZVA                          WBJZVA
     I              BEA1WG                          WBA1WG
     I              BEXIST                          WBXIST
     I              BEXJST                          WBXJST
     I              BEXKST                          WBXKST
     I              BEEIDT                          WBEIDT
     I              BEAFTM                          WBAFTM
     I              BEE8CD                          WBE8CD
     I              BEE9CD                          WBE9CD
     I              BERMNB                          WBRMNB
     I              BETBNB                          WBTBNB
     I              BER1NB                          WBR1NB
     I              BEPJST                          WBPJST
     I              BEU0ST                          WBU0ST
     I              BEU1ST                          WBU1ST
     I              BEQ2CD                          WBQ2CD
     I              BEU2ST                          WBU2ST
     I              BEVEST                          WBVEST
     I              BEVFST                          WBVFST
     I              BEVGST                          WBVGST
     I              BERPCD                          WBRPCD
     I              BERNNB                          WBRNNB
     I              BEVDST                          WBVDST
     I              BEATIN                          WBATIN
     I              BEU4ST                          WBU4ST
     I              BEU5ST                          WBU5ST
     I              BERSRN                          WBRSRN
     I              BEMHNA                          WBMHNA
     I              BEMINA                          WBMINA
     I              BEWBST                          WBWBST
     I              BER4CD                          WBR4CD
     I              BEBFCD                          WBBFCD
     I              BEQ4CD                          WBQ4CD
     I              BET3NB                          WBT3NB
     I              BESICD                          WBSICD
     I              BECONB                          WBCONB
     I              BECEST                          WBCEST
     I              BEAWDT                          WBAWDT
     I              BEJPCD                          WBJPCD
     I              BEXUST                          WBXUST
     I              BEZ1ST                          WBZ1ST
     I              BEVRVA                          WBVRVA
     I              BEOBST                          WBOBST
     I              BEBCST                          WBBCST
     I              BEBDST                          WBBDST
     I              BEUVST                          WBUVST
     I              BEUWST                          WBUWST
     I              BEUXST                          WBUXST
     I              BEAATM                          WBAATM
     I              BEAYNA                          WBAYNA
     I              BEA0NA                          WBA0NA
     I              BEAXDT                          WBAXDT
      *
     I@FLCPE8
      * OM Load Detail            Co/Stop Descending
      * Renamed input format fields
     I              FLAIC3                          WCAIC3
     I              FLRMNB                          WCRMNB
     I              FLRUNB                          WCRUNB
     I              FLRVNB                          WCRVNB
     I              FLDQTX                          WCDQTX
     I              FLRWNB                          WCRWNB
     I              FLRXNB                          WCRXNB
     I              FLSQNB                          WCSQNB
     I              FLT0NB                          WCT0NB
     I              FLT1NB                          WCT1NB
     I              FLR1NB                          WCR1NB
     I              FLC4NB                          WCC4NB
     I              FLVCST                          WCVCST
     I              FLKEDT                          WCKEDT
     I              FLSXNB                          WCSXNB
     I              FLKFDT                          WCKFDT
     I              FLACTM                          WCACTM
     I              FLK5TX                          WCK5TX
     I              FLW5CD                          WCW5CD
     I              FLEJDT                          WCEJDT
     I              FLAGTM                          WCAGTM
     I              FLKJDT                          WCKJDT
     I              FLATTM                          WCATTM
     I              FLHDDT                          WCHDDT
     I              FLAUTM                          WCAUTM
     I              FLKKDT                          WCKKDT
     I              FLAVTM                          WCAVTM
     I              FLUVST                          WCUVST
     I              FLUWST                          WCUWST
     I              FLUXST                          WCUXST
     I              FLAATM                          WCAATM
     I              FLAYNA                          WCAYNA
     I              FLA0NA                          WCA0NA
     I              FLAXDT                          WCAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSOMFJCPL1
      * UPD : OM Load Header            Update index
      * Current/previous header format fields
      * Current/previous master file format fields for change control
      *
      *
     I@2DBRC    E DSOMFLCPL0
      * UPD : OM Load Detail            Update index
      * Current/previous detail format fields
      * Current/previous master file format fields for change control
      *
      *
      * Outward parameters
     IPARC        DS                             13
      * KEY : OM Load Detail            Co/Load/Stop
      * I : RST Company Number
     I                                    P   1   20PAAIC3
      * I : RST Load ID
     I                                    P   3   60PARMNB
      * I : RST Stop/Drop
     I                                    P   7   90PARVNB
      *
     IQOPBF1    E DSOPBFCPL0
      * UPD : PD Order Header           Update index
     IYARDCS      DS                            676
     IQOPBG1    E DSOPBGWKL0
      * UPD : PD Order Detail           Update index
     IYBRDCS      DS                            340
     IYCRDCS      DS                            340
     IYDRDCS      DS                            340
     IYERDCS      DS                            510
     IYFRDCS      DS                            193
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: OM Load Header
      * I : RST Company Number
     I                                    P   1   20P1AIC3
      * I : RST Load ID
     I                                    P   3   60P1RMNB
      * I :  Total Weight
     I                                    P   7  100P1RPNB
      * B :  Flat Amount
     I                                    P  11  162P1FLAM
      * B :  Allocate Pounds/Miles
     I                                       17  17 P1XQST
      * I :  Carrier Code
     I                                       18  20 P1BZNA
      * B :  Rated Freight
     I                                    P  21  262P1R1NB
      * B :  Total Load Miles
     I                                    P  27  300P1TLMI
      * I :  Ship From Warehouse
     I                                       31  33 P1VPCD
      * I :  Ship To State Code
     I                                       34  35 P1DBCD
      * I :  Carrier Broker
     I                                       36  38 P1XCCD
     IP2PARM      DS
      * FLD: OM Carrier
      * I :  Name
     I                                        1  30 P2ADTX
      * N :  Flat Rate
     I                                    P  31  362P2NMVA
     IP3PARM      DS
      * N :  Count USR
     I                                    P   1   30P3CNTU
     IP4PARM      DS
      * FLD: OM Load Detail
      * N :  Stop/Drop Sequence Number
     I                                    P   1   30P4RUNB
      * N :  Stop/Drop
     I                                    P   4   60P4RVNB
     IP5PARM      DS
      * FLD: *Arrays
      * N :  @Percent 9/6
     I                                    P   1   56P5CFPC
      * N :  Freight Stop Charge
     I                                    P   6   92P5T1NB
      * N :  USR Orders on Stop
     I                                    P  10  120P5ZONB
      * N :  USR Stop Total Weight
     I                                    P  13  182P5D8WG
      * N :  USR Order Weight
     I                                    P  19  242P5AYWG
      * N :  @Rated Freight
     I                                    P  25  302P5RAFR
      * N :  Total Stops Cost
     I                                    P  31  362P5TMNB
      * N :  @Number to Rank
     I                                    P  37  390P5RCNB
      * N :  Maximum Miles
     I                                    P  40  430P5MXML
      * N :  Total Miles
     I                                    P  44  470P5TKNB
      * N :  Rate Per Stop
     I                                    P  48  512P5NPVA
      * N :  Mile Rate 1
     I                                    P  52  574P5BQPR
      * N :  Weight Rate 1
     I                                    P  58  634P5B2PR
     IP6PARM      DS
      * N :  USR Update Flag
     I                                        1   1 P6R4ST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Value Required'
      * @Allocation Type
     I                                        1   1 ZA0001
      * Message data for 'CD7 Non numeric data'
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0002
      * Application Code
     I                                       11  16 ZA0003
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0004
      * Application Code
     I                                       11  16 ZA0005
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1RMNB    PARM           WP0002  70       Load ID
     C           P1RPNB    PARM           WP0003  70       Total Weight
     C           P1FLAM    PARM P1FLAM    WP0004 112       Flat Amount
     C           P1XQST    PARM P1XQST    WP0005  1        Allocate Pounds
     C           P1BZNA    PARM           WP0006  3        Carrier Code
     C           P1R1NB    PARM P1R1NB    WP0007 112       Rated Freight
     C           P1TLMI    PARM P1TLMI    WP0008  70       Total Load Mile
     C           P1VPCD    PARM           WP0009  3        Ship From Wareh
     C           P1DBCD    PARM           WP0010  2        Ship To State C
     C           P1XCCD    PARM           WP0011  3        Carrier Broker
     C           P2ADTX    PARM           WP0012 30        Name
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Conduct program process
     C                     DO   *HIVAL                     DO
      * Initialize screen
     C                     EXSR ABIZSF
      * Set screen bypass indicator
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'Y'       W0BYP   1
     C                     ELSE
     C                     MOVEL'N'       W0BYP
     C                     END
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'                        DO
      * Convert fields to external form
     C                     EXSR MOCV#1
      * Bypass first screen for new transaction
     C           W0BYP     IFNE 'Y'
      * Display screen
     C                     EXSR CAEXFM
     C                     ELSE
      * Ensure all command keys set off
     C                     MOVE *ALL'0'   WKIN30 30
     C                     MOVEAWKIN30    *IN,1
     C                     END
      * Cancel screen bypass indicator
     C                     MOVEL'N'       W0BYP
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG           CAS
      * HOME: Request subfile reload
     C   30                CAS            ADHMKY
     C                     END                             SAC
     C           W0TRN     IFEQ 'Y'
      * Convert header fields to internal form
     C                     EXSR MPCV#1
      * Validate screen input
     C                     EXSR DAPRSF
     C                     END                             FI
      *
     C                     END                             OD
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
     C                     END                             OD
      *****************************************************************
      /EJECT
     CSR         ABIZSF    BEGSR
      *================================================================
      * Initialize screen
      *================================================================
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  1
     C                     MOVE *ALL'1'   WKIND1  1
     C                     MOVEAWKIND0    *IN,36
     C                     SETOF                     81    *
      * Initialise subfile control
     C                     EXSR MAIZ#1
      * Clear subfile
     C                     SETON                     80    *
     C                     WRITE#SFLCTL
     C                     SETOF                     80    *
      * Reset count of SFL records
     C                     Z-ADD*ZERO     ##RRMX  50
     C                     Z-ADD*ZERO     ##RR    50
      * USER: Initialize screen for old transaction
     C                     Z-ADDP1FLAM    #1FLAM           Flat Amount
     C                     MOVELP1XQST    #1XQST           Allocate Pounds
     C                     Z-ADDP1TLMI    #1TLMI           Total Load Mile
      * first time processing
      * CASE: WRK.First Time Flag is Yes
     C           WUTAST    IFEQ 'Y'                        *IF
     C                     MOVEL'N'       WUTAST           First Time Flag
      * Send message 'Rated Frt may have chgd'
     C                     MOVEL'USR2144' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     MOVEL'KEY'     W0SCR   3
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
     C                     MOVEL'Y'       W0TRN   1
     C                     MOVEL'Y'       W0FST   1
      *================================================================
     CSR         ABEXIT    ENDSR
      /EJECT
     CSR         ADHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN   1
      *================================================================
     CSR         ADEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
     C                     MOVELW0SCR     W0GRP   1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END                              UOD
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSF    BEGSR
      *================================================================
      * Process subfile records
      *================================================================
      * Confirm/update is not deferred
     C           YPMTFD    IFEQ *BLANKS
     C                     MOVEL'N'       W0DCF   1
     C                     END
      * Validate SFL control keys if input
     C           W0SCR     IFEQ 'KEY'
     C                     EXSR DCVLH1
      * QUIT if error:
     C   99                GOTO DAEXIT
     C                     END
      * If keys only, now get the rest of the data
     C           W0SCR     IFEQ 'KEY'
     C           YPMTFD    ANDEQ*BLANKS
     C                     EXSR DBLDSF
     C                     GOTO DAEXIT
     C                     END
      * Validate SFL control non keys
     C                     EXSR DEVLH2
      *................................................................
      * Process subfile records
     C           *IN81     IFEQ '1'
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,36
     C                     SETOF                     98    No errors
      * Copy header keys to detail record for validation
     C                     Z-ADD#1AIC3    #2AIC3           Company Number
     C                     Z-ADD#1RMNB    #2RMNB           Load ID
      * Check for null record
     C                     EXSR DGNLRC
     C           W0NLR     IFEQ 'Y'
      * Null record - clear value mapped fields
     C                     EXSR MQIZ#2
     C                     END
      * Validate non-null subfile record
     C           W0NLR     IFEQ 'N'
     C           ##RR      OREQ YPMRRN
     C                     EXSR DIVLSF
     C                     END
      * If SFLRCD invalid, note that errors present
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      * Convert fields to external form
     C                     EXSR MNCV#2
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C                     END                             FI
      *................................................................
      * Quit if subfile invalid:
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * USER: Validate totals
     C                     MOVEL*BLANK    P6R4ST           USR Update Flag
      * Quit if user errors signalled
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Update DBF from screen
     C                     EXSR EAUPFL
      * Quit if DBF updates failed:
     C           *IN99     CABEQ'1'       DAEXIT
      *
      * Exit after successful update
     C                     EXSR ZXEXPG
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBLDSF    BEGSR
      *================================================================
      * Load screen fields from DBF
      *================================================================
      * Load subfile control from DBF
     C                     EXSR MBFL#1
      * Validate SFL control non keys
     C                     EXSR DFVLH3
     C           YPMTFD    IFEQ *BLANKS
      * USER: Load existing header
     C                     MOVELP2ADTX    #CADTX           Name
     C                     Z-ADDP5MXML    #CMXML           Maximum Miles
     C                     Z-ADDP1RPNB    #1RPNB           Total Weight
     C                     Z-ADDFJTLMI    #1TLMI           Total Load Mile
      * CLC Mile Rate          XF - PD Carrier Rates  * 
     C                     CALL 'PDELXFR'              90  CLC Mile Rate
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1AIC3    WQ0001  30       Company Number
     C                     PARM P1VPCD    WQ0002  3        Warehouse Code
     C                     PARM P1XCCD    WQ0003  3        Carrier Code
     C                     PARM #1TLMI    WQ0004  70       Starting Miles
     C           P5BQPR    PARM *ZERO     WQ0005 114       Carrier Rate
     C                     PARM P1DBCD    WQ0006  2        Ship To State C
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDELXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDP5NPVA    #CNPVA           Rate Per Stop
     C                     Z-ADDP5BQPR    #CBQPR           Mile Rate 1
     C                     Z-ADDP5B2PR    #CB2PR           Weight Rate 1
     C                     MOVELP1XCCD    #1XCCD           Carrier Broker
      * RTV Carrier Name       RT - OM Carrier  * 
     C                     EXSR SARVGN
      * Clc Sum misc. freight  RT - OM Load Detail  * 
     C                     EXSR SBRVGN
      * Pounds/Miles computation
      * CASE: CTL.Allocate Pounds/Miles is Miles
     C           #1XQST    IFEQ 'M'                        *IF
     C           #1TLMI    MULT #CBQPR    W0WB             *Synon (15,5) w
     C                     ELSE
      * CASE: CTL.Allocate Pounds/Miles is Pounds
     C           #1XQST    IFEQ 'P'                        *IF
     C           #1RPNB    MULT #CB2PR    W0WB             *Synon (15,5) w
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     W0WB             *Synon (15,5) w
     C                     END                             *FI
     C                     END                             *FI
     C           W0WB      ADD  FJFLAM    #CTLNB           Total Base Cost
      * Total stops cost
      * CTL.Total Stops Cost =
      *    *COMPUTE ((x1 - x2) * x3)
      * x1    : DB1.Total Stops
      * -     : PGM.*Synon (17,7) work field
      * x2    : CON.1
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x3    : CTL.Rate Per Stop
     C           FJRRNB    SUB  1         W0WD01           *Synon (17,7) w
     C           W0WD01    MULT #CNPVA    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    #CTMNB           Total Stops Cos
      * Total Rated Freight
      * CTL.Rated Freight =
      *    *COMPUTE (x1 + x2 + x3)
      * x1    : CTL.Total Base Cost
      * +     : PGM.*Synon (17,7) work field
      * x2    : CTL.Total Stops Cost
      * +     : PGM.*Synon (17,7) work field
      * x3    : CTL.Total Miscellaneous Cost
     C           #CTLNB    ADD  #CTMNB    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  #CTNNB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    #1R1NB           Rated Freight
     C                     Z-ADD*ZERO     P4RVNB           Stop/Drop
     C                     Z-ADD*ZERO     P5RAFR           @Rated Freight
     C                     END
      * Read all DBF detail records for header
      * Read ahead
     C           KSPNH     READE@FLCPEY                  92*
     C           *IN92     DOWEQ'0'
      * For each DBF detail record read:
     C                     ADD  1         ##RR    50
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,36
      * Initialise and load subfile record from DBF
     C                     EXSR MDIZ#2
     C                     EXSR MEFL#2
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile record (old record)
     C                     Z-ADDFLT0NB    #RTWNB           USR Freight Mis
      * RTV Order Weight       RT - OP Order Header  * 
     C                     EXSR SCRVGN
      * Stop break
      * CASE: DB2.Stop/Drop NE PAR.Stop/Drop
     C           FLRVNB    IFNE P4RVNB                     *IF
      * Clc Stop Totals        XF - OM Load Detail  * 
     C                     CLEARPARC
     C                     Z-ADDP1AIC3    PAAIC3           Company Number
     C                     Z-ADDP1RMNB    PARMNB           Load ID
     C                     Z-ADDFLRVNB    PARVNB           Stop/Drop
      *
     C                     CALL 'PDJKXFR'              90  CLC Stop Totals
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: OM Load De
     C           P5ZONB    PARM P5ZONB    WQ0007  50       USR Orders on S
     C           P5D8WG    PARM P5D8WG    WQ0008 112       USR Stop Total
     C           WUNFNN    PARM WUNFNN    WQ0009 112       USR Misc. Amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDJKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADDFLRVNB    P4RVNB           Stop/Drop
     C                     END                             *FI
      * Stop charge
      * CASE: DB2.Stop/Drop EQ PAR.@Number to Rank
     C           FLRVNB    IFEQ P5RCNB                     *IF
     C                     Z-ADD*ZERO     P5T1NB           Freight Stop Ch
     C                     ELSE
      * CASE: RCD.Stop/Drop EQ PAR.@Number to Rank
     C           #2RVNB    IFEQ P5RCNB                     *IF
     C                     Z-ADD*ZERO     P5T1NB           Freight Stop Ch
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.USR Orders on Stop EQ WRK.ZERO
     C           P5ZONB    IFEQ WUW0NB                     *IF
     C                     Z-ADD*ZERO     P5T1NB           Freight Stop Ch
     C                     ELSE
      * CASE: *OTHERWISE
     C           #CNPVA    DIV  P5ZONB    P5T1NB    H      Freight Stop Ch
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADDP5T1NB    #2T1NB           Freight Stop Ch
      * Compute rated freight
     C                     EXSR UASUBR                     Compute rated f
     C           1         MULT W0WC      #2R1NB    H      Rated Freight
     C                     ADD  #2R1NB    P5RAFR           @Rated Freight
      * Adjust last detail if necessary
      * CASE: DB2.Stop/Drop Sequence Number EQ PAR.Stop/Drop Sequence Num
     C           FLRUNB    IFEQ P4RUNB                     *IF
      * Adjust last load detail's rated freight if necessary
      * CASE: PAR.@Rated Freight NE CTL.Rated Freight
     C           P5RAFR    IFNE #1R1NB                     *IF
     C           #1R1NB    SUB  P5RAFR    WUAIVA           Adjustment Amou
     C                     ADD  WUAIVA    #2R1NB           Rated Freight
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     MOVEL'1'       *IN84            *Re-read Subfil
     C                     END
      * Validate details
     C                     EXSR DJVLSF
      * Output DBF to subfile
      * Convert fields to external form
     C                     EXSR MNCV#2
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
      * Read next Data record
     C           KSPNH     READE@FLCPEY                  92*
     C                     END                             WOD
     C                     Z-ADD##RR      ##RRMX     81    *
     C                     MOVEL'DTL'     W0SCR
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCVLH1    BEGSR
      *================================================================
      * Validate header keys
      *================================================================
      * Check restriction within
     C                     EXSR VACKRL
      * Check existence of header
     C           YPMTFD    IFEQ *BLANKS
     C                     EXSR DDRDH1
      * If header not found, error
     C           *IN90     IFEQ '1'
     C                     SETON                     99    PC
      * Send message 'OM Load Header         NF'
     C                     MOVEL'USR1188' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDRDH1    BEGSR
      *================================================================
      * Read header record
      *================================================================
     C           KSPNH     KLIST
     C                     KFLD           FJAIC3           Company Number
     C                     KFLD           FJRMNB           Load ID
      * Setup key
     C                     Z-ADD#1AIC3    FJAIC3
     C                     Z-ADD#1RMNB    FJRMNB
     C           KSPNH     CHAIN@FJCPEX              90    *
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEVLH2    BEGSR
      *================================================================
      * Validate header non-key fields
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate header non-key fields
      * CASE: PAR.Total Load Miles NE CTL.Total Load Miles
     C           P1TLMI    IFNE #1TLMI                     *IF
      * CLC Mile Rate          XF - PD Carrier Rates  * 
     C                     CALL 'PDELXFR'              90  CLC Mile Rate
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1AIC3    WQ0012  30       Company Number
     C                     PARM P1VPCD    WQ0013  3        Warehouse Code
     C                     PARM P1XCCD    WQ0014  3        Carrier Code
     C                     PARM #1TLMI    WQ0015  70       Starting Miles
     C           P5BQPR    PARM *ZERO     WQ0016 114       Carrier Rate
     C                     PARM P1DBCD    WQ0017  2        Ship To State C
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDELXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     END                             *FI
     C                     Z-ADDP1RPNB    #1RPNB           Total Weight
     C                     Z-ADDP5MXML    #CMXML           Maximum Miles
     C                     Z-ADDP5NPVA    #CNPVA           Rate Per Stop
     C                     Z-ADDP5BQPR    #CBQPR           Mile Rate 1
     C                     Z-ADDP5B2PR    #CB2PR           Weight Rate 1
     C                     Z-ADD*ZERO     P4RVNB           Stop/Drop
     C                     Z-ADD*ZERO     P5RAFR           @Rated Freight
      * Pounds/Miles computation
      * CASE: CTL.Allocate Pounds/Miles is Miles
     C           #1XQST    IFEQ 'M'                        *IF
     C           #1TLMI    MULT #CBQPR    W0WB             *Synon (15,5) w
     C                     ELSE
      * CASE: CTL.Allocate Pounds/Miles is Pounds
     C           #1XQST    IFEQ 'P'                        *IF
     C           #1RPNB    MULT #CB2PR    W0WB             *Synon (15,5) w
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     W0WB             *Synon (15,5) w
      * Setup message data for message
     C                     MOVEL#1XQST    ZA0001           Allocate Pounds
      * Send message 'Value Required'
     C                     MOVEL'USR1852' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C           W0WB      ADD  #1FLAM    #CTLNB           Total Base Cost
      * Total Rated Freight
      * CTL.Rated Freight =
      *    *COMPUTE (x1 + x2 + x3)
      * x1    : CTL.Total Base Cost
      * +     : PGM.*Synon (17,7) work field
      * x2    : CTL.Total Stops Cost
      * +     : PGM.*Synon (17,7) work field
      * x3    : CTL.Total Miscellaneous Cost
     C           #CTLNB    ADD  #CTMNB    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  #CTNNB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    #1R1NB           Rated Freight
      * Reload if flat rate, allocation or total miles have changed
      * CASE: PAR.Flat Amount NE CTL.Flat Amount
     C           P1FLAM    IFNE #1FLAM                     *IF
     C                     MOVEL'Y'       P6R4ST           USR Update Flag
     C                     ELSE
      * CASE: PAR.Allocate Pounds/Miles NE CTL.Allocate Pounds/Miles
     C           P1XQST    IFNE #1XQST                     *IF
     C                     MOVEL'Y'       P6R4ST           USR Update Flag
     C                     ELSE
      * CASE: PAR.Total Load Miles NE CTL.Total Load Miles
     C           P1TLMI    IFNE #1TLMI                     *IF
     C                     MOVEL'Y'       P6R4ST           USR Update Flag
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL#1XQST    P1XQST           Allocate Pounds
     C                     Z-ADD#1FLAM    P1FLAM           Flat Amount
     C                     Z-ADD#1TLMI    P1TLMI           Total Load Mile
     C                     Z-ADD#1R1NB    P1R1NB           Rated Freight
     C                     MOVELP2ADTX    #CADTX           Name
     C                     END
      * Validate relations
     C                     EXSR DFVLH3
      * Allocate Pounds/Miles required
     C           #1XQST    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Total Load Miles required
     C           #1TLMI    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFVLH3    BEGSR
      *================================================================
      * Validate header non-key relations
      *================================================================
      * Check reference to Calendar
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to OM Carrier
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to OM Truck Size
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Calendar
     C                     EXSR VECKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Calendar
     C                     EXSR VFCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Warehouse
     C                     EXSR VGCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to State
     C                     EXSR VHCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to OM Carrier
     C                     EXSR VICKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to PD Shipping Line/Port
     C                     EXSR VJCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Warehouse
     C                     EXSR VKCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DGNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
      * Existing records are never null
     C           #2OLRC    CABNE*BLANK    DGEXIT
     C           #2T0NB    CABNE*ZERO     DGEXIT           Freight Misc. C
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                     EXSR MOCV#1
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
      * Refresh screen
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     MOVELW0SCR     W0GRP   1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 20        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         DIVLSF    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record fields
      * CTL Flat Amt or type of alloc have changed
      * CASE: PAR.USR Update Flag is Yes
     C           P6R4ST    IFEQ 'Y'                        *IF
      * Stop break
      * CASE: RCD.Stop/Drop NE PAR.Stop/Drop
     C           #2RVNB    IFNE P4RVNB                     *IF
      * Clc Stop Totals        XF - OM Load Detail  * 
     C                     CLEARPARC
     C                     Z-ADDP1AIC3    PAAIC3           Company Number
     C                     Z-ADDP1RMNB    PARMNB           Load ID
     C                     Z-ADD#2RVNB    PARVNB           Stop/Drop
      *
     C                     CALL 'PDJKXFR'              90  CLC Stop Totals
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: OM Load De
     C           P5ZONB    PARM P5ZONB    WQ0028  50       USR Orders on S
     C           P5D8WG    PARM P5D8WG    WQ0029 112       USR Stop Total
     C           WUNFNN    PARM WUNFNN    WQ0030 112       USR Misc. Amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDJKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD#2RVNB    P4RVNB           Stop/Drop
     C                     END                             *FI
      * Stop charge
      * CASE: RCD.Stop/Drop EQ PAR.@Number to Rank
     C           #2RVNB    IFEQ P5RCNB                     *IF
     C                     Z-ADD*ZERO     P5T1NB           Freight Stop Ch
     C                     ELSE
      * CASE: *OTHERWISE
     C           #CNPVA    DIV  P5ZONB    P5T1NB    H      Freight Stop Ch
     C                     END                             *FI
     C                     Z-ADDP5T1NB    #2T1NB           Freight Stop Ch
      * Compute rated freight
     C                     EXSR UBSUBR                     Compute rated f
     C           1         MULT W0WC      #2R1NB    H      Rated Freight
     C                     ADD  #2R1NB    P5RAFR           @Rated Freight
      * Adjust last detail if necessary
      * CASE: RCD.Stop/Drop Sequence Number EQ PAR.Stop/Drop Sequence Num
     C           #2RUNB    IFEQ P4RUNB                     *IF
      * Adjust last load detail's rated freight if necessary
      * CASE: PAR.@Rated Freight NE CTL.Rated Freight
     C           P5RAFR    IFNE #1R1NB                     *IF
     C           #1R1NB    SUB  P5RAFR    WUAIVA           Adjustment Amou
     C                     ADD  WUAIVA    #2R1NB           Rated Freight
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Misc. Charge has changed
      * CASE: RCD.Freight Misc. Charge NE RCD.USR Freight Misc. Cost
     C           #2T0NB    IFNE #RTWNB                     *IF
     C                     SUB  #2R1NB    #1R1NB           Rated Freight
     C                     SUB  #2R1NB    P5RAFR           @Rated Freight
     C                     SUB  #RTWNB    #CTNNB           Total Miscellan
     C                     ADD  #2T0NB    #CTNNB           Total Miscellan
     C                     SUB  #RTWNB    #2R1NB           Rated Freight
     C                     ADD  #2T0NB    #2R1NB           Rated Freight
     C                     ADD  #2R1NB    #1R1NB           Rated Freight
     C                     ADD  #2R1NB    P5RAFR           @Rated Freight
     C                     Z-ADD#2T0NB    #RTWNB           USR Freight Mis
     C                     END                             *FI
     C                     MOVEL'N'       W0DCF            *Defer confirm
     C                     END
      * Validate relations
     C                     EXSR DJVLSF
      *================================================================
     CSR         DIEXIT    ENDSR
      /EJECT
     CSR         DJVLSF    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to PD Order Header
     C                     EXSR VLCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      *
      *================================================================
     CSR         DJEXIT    ENDSR
      /EJECT
     CSR         EAUPFL    BEGSR
      *================================================================
      * Update DBFs from screen
      *================================================================
      * Process header record
      * Change header
     C                     CAS            ECCHHD
     C                     END
      * Quit if header update failed
     C   99                GOTO EAEXIT
      * Process subfile records
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
     C  N92                DO
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,36
      * Copy header keys to detail record for update
     C                     Z-ADD#1AIC3    #2AIC3           Company Number
     C                     Z-ADD#1RMNB    #2RMNB           Load ID
      * Process change request
     C                     CAS            EFCHLN
     C                     END
      * USER: Process detail record
     C                     Z-ADD#1FLAM    P1FLAM           Flat Amount
     C                     MOVEL#1XQST    P1XQST           Allocate Pounds
     C                     Z-ADD#1TLMI    P1TLMI           Total Load Mile
     C                     Z-ADD#1R1NB    P1R1NB           Rated Freight
      * CHG Rated Freight      CH - OP Order Header  * 
     C                     EXSR SDCHRC
      * Chg Adjust Rated Frt   RT - OP Order Header  * 
     C                     EXSR SERVGN
      * Convert fields to external form
     C                     EXSR MNCV#2
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C  N92                END                             OD
      *
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         ECCHHD    BEGSR
      *================================================================
      * Change header record
      *================================================================
      * USER: Change header DBF record
      * CHG Recovery Freight   CH - OM Load Header  * 
     C                     EXSR SJCHRC
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    PC
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EFCHLN    BEGSR
      *================================================================
      * Change detail record
      *================================================================
      * USER: Change detail DBF record
      * CHG Recovery Freight   CH - OM Load Detail  * 
     C                     EXSR SKCHRC
     C           W0RTN     IFNE *BLANK
      * Set on record error indicators
     C                     MOVEAWKIND1    *IN,36
     C                     SETON                         99*
     C                     END
      *================================================================
     CSR         EFEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
      * Protect detail key fields if existing record
     C           #2OLRC    COMP 'Y'                      82*
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     SETOF                     89    *
     C           W0SCR     COMP 'KEY'                    88*
      * Protect header key fields in change mode, full screen
     C                     SETOF                     87    *
     C  N88N89             SETON                     87    *
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise header fields
      *================================================================
      * Existing record indicator
     C                     MOVEL*BLANK    #1OLRC
     C                     Z-ADDP1AIC3    #1AIC3           Company Number
     C                     Z-ADD*ZERO     #1AODT           Scheduled Ship
     C                     MOVEL*BLANK    #1PJST           LTL Flag
     C                     MOVEL*BLANK    #1PKST           Load Status
     C                     Z-ADD*ZERO     #1RNNB           Reefer Temperat
     C                     MOVEL*BLANK    #1DMTX           Seal 1
     C                     MOVEL*BLANK    #1DNTX           Seal 2
     C                     MOVEL*BLANK    #1DOTX           Seal 3
     C                     MOVEL*BLANK    #1DXTX           Trailer Id
     C                     MOVEL*BLANK    #1DYTX           Initials of Con
     C                     Z-ADD*ZERO     #1SBNB           BOL Time
     C                     MOVEL*BLANK    #1RONB           Truck Size
     C                     Z-ADD*ZERO     #1SQNB           Actual Freight
     C                     MOVEL*BLANK    #1VCST           Ship Status
     C                     MOVEL*BLANK    #1VDST           Load Type
     C                     Z-ADD*ZERO     #1SDNB           Number Pallets
     C                     Z-ADD*ZERO     #1PAOU           Number Pallets
     C                     Z-ADD*ZERO     #1DGWG           Tare Lbs/Pallet
     C                     Z-ADD*ZERO     #1SXNB           Estimated Arriv
     C                     Z-ADD*ZERO     #1HADT           Actual Arrival
     C                     Z-ADD*ZERO     #1AART           Actual Arrival
     C                     Z-ADD*ZERO     #1DHWG           Trailer IN Weig
     C                     Z-ADD*ZERO     #1DIWG           Trailer OUT Wei
     C                     Z-ADD*ZERO     #1AQDT           Actual Departur
     C                     Z-ADD*ZERO     #1S6NB           Departure Time
     C                     Z-ADD*ZERO     #1T4NB           Schedule Sequen
     C                     Z-ADD*ZERO     #1PRTM           Product Tempera
     C                     Z-ADD*ZERO     #1NPSV           Number Pallets
     C                     MOVEL*BLANK    #1J8TX           Car/Veh. Initia
     C                     MOVEL*BLANK    #1J9TX           Recorder ID
     C                     MOVEL*BLANK    #1Q2CD           Shipping Method
     C                     MOVEL*BLANK    #1VPCD           Ship From Wareh
     C                     MOVEL*BLANK    #1DBCD           Ship To State C
     C                     Z-ADD*ZERO     #1GRWE           Gross Weight
     C                     MOVEL*BLANK    #1U2ST           Export Status
     C                     Z-ADD*ZERO     #1F9DT           Actual Ship Dat
     C                     MOVEL*BLANK    #1ONTM           On Time - (Y/N)
     C                     Z-ADD*ZERO     #1J4DT           Truck Ready Dat
     C                     Z-ADD*ZERO     #1TRTM           Truck Ready Tim
     C                     Z-ADD*ZERO     #1J5DT           Spotted Date
     C                     Z-ADD*ZERO     #1SPTM           Spotted Time
     C                     Z-ADD*ZERO     #1J6DT           Load Finished D
     C                     Z-ADD*ZERO     #1LFTM           Load Finished T
     C                     Z-ADD*ZERO     #1J7DT           BOL Complete Da
     C                     Z-ADD*ZERO     #1BOTM           BOL Complete Ti
     C                     Z-ADD*ZERO     #1J8DT           BOL Received Da
     C                     Z-ADD*ZERO     #1BLTM           BOL Received Ti
     C                     Z-ADD*ZERO     #1KIDT           Truck Departure
     C                     Z-ADD*ZERO     #1ASTM           Truck Departure
     C                     Z-ADD*ZERO     #1KADT           Adjusted Depart
     C                     Z-ADD*ZERO     #1AJCM           Adjusted Depart
     C                     MOVEL*BLANK    #1XACD           Shipping Line
     C                     MOVEL*BLANK    #1OANA           Sail Port City
     C                     MOVEL*BLANK    #1K4TX           Vessel Name
     C                     Z-ADD*ZERO     #1VOAG           Voyage
     C                     Z-ADD*ZERO     #1KBDT           Sail Date
     C                     MOVEL*BLANK    #1NBBO           Booking Number
     C                     MOVEL*BLANK    #1W4CD           Discharge Port
     C                     Z-ADD*ZERO     #1EFDT           Arrival Date
     C                     MOVEL*BLANK    #1CNTN           Container Numbe
     C                     Z-ADD*ZERO     #1KCDT           Date In
     C                     Z-ADD*ZERO     #1TMIN           Time In
     C                     Z-ADD*ZERO     #1KDDT           Date Out
     C                     Z-ADD*ZERO     #1VMNB           Time Out
     C                     Z-ADD*ZERO     #1OCFR           Ocean Freight
     C                     Z-ADD*ZERO     #1KJDT           Scheduled Deliv
     C                     Z-ADD*ZERO     #1ATTM           Scheduled Deliv
     C                     MOVEL*BLANK    #1OTRS           On Time Reason
     C                     MOVEL*BLANK    #1RNST           BOL Printed Fla
     C                     Z-ADD*ZERO     #1BRBK           Bring Back Mile
     C                     Z-ADD*ZERO     #1EIDT           Requested Deliv
     C                     MOVEL*BLANK    #1RMST           Load Acceptance
     C                     MOVEL*BLANK    #1AJCD           Warehouse Code
     C                     Z-ADD*ZERO     #1KKDT           On Yard Date
     C                     Z-ADD*ZERO     #1AVTM           On Yard Time
     C                     Z-ADD*ZERO     #1KZDT           Unused Load Dat
     C                     Z-ADD*ZERO     #1AXTM           Unused Load Tim
     C                     Z-ADD*ZERO     #1K0DT           Unused Load Dat
     C                     Z-ADD*ZERO     #1AYTM           Unused Load Tim
     C                     Z-ADD*ZERO     #1K1DT           Unused Load Dat
     C                     Z-ADD*ZERO     #1AZTM           Unused Load Tim
     C                     Z-ADD*ZERO     #1K2DT           Unused Load Dat
     C                     Z-ADD*ZERO     #1A0TM           Unused Load Tim
     C                     MOVEL*BLANK    #1ROST           Unused Load Sta
     C                     MOVEL*BLANK    #1RPST           Unused Load Sta
     C                     MOVEL*BLANK    #1RQST           Unused Load Sta
     C                     MOVEL*BLANK    #1RRST           Unused Load Sta
     C                     Z-ADD*ZERO     #1ZBVA           Unused Load Val
     C                     MOVEL*BLANK    #1UVST           EDI Status 1
     C                     MOVEL*BLANK    #1UWST           EDI Status 2
     C                     MOVEL*BLANK    #1UXST           EDI Status 3
     C                     Z-ADD*ZERO     #1AATM           Job Time
     C                     MOVEL*BLANK    #1AYNA           User Id
     C                     MOVEL*BLANK    #1A0NA           Job Name
     C                     Z-ADD*ZERO     #1AXDT           Job Date
     C                     Z-ADDP1RMNB    #1RMNB           Load ID
     C                     MOVEL*BLANK    #1BZNA           Carrier Code
     C                     MOVEL*BLANK    #CADTX           Name
     C                     MOVEL*BLANK    #1XCCD           Carrier Broker
     C                     MOVEL*BLANK    #CAUNA           Description
     C                     Z-ADD*ZERO     #1RRNB           Total Stops
     C                     Z-ADD*ZERO     #1RPNB           Total Weight
     C                     MOVEL*BLANK    #1XQST           Allocate Pounds
     C                     Z-ADD*ZERO     #CMXML           Maximum Miles
     C                     Z-ADD*ZERO     #1TLMI           Total Load Mile
     C                     Z-ADD*ZERO     #CBQPR           Mile Rate 1
     C                     Z-ADD*ZERO     #CB2PR           Weight Rate 1
     C                     Z-ADD*ZERO     #1FLAM           Flat Amount
     C                     Z-ADD*ZERO     #CTLNB           Total Base Cost
     C                     Z-ADD*ZERO     #CNPVA           Rate Per Stop
     C                     Z-ADD*ZERO     #CTMNB           Total Stops Cos
     C                     Z-ADD*ZERO     #CTNNB           Total Miscellan
     C                     Z-ADD*ZERO     #1R1NB           Rated Freight
     C                     Z-ADD*ZERO     #CRVNB           Stop/Drop
     C                     Z-ADD*ZERO     #CC4NB           Order Number
      * Clear external version also
     C                     MOVEL*BLANK    VCC4NB
      * Check restriction within
     C                     EXSR VMCKRL
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move header DBF record fields to header screen
      *================================================================
      * Existing record indicator
     C                     MOVEL'Y'       #1OLRC
     C                     Z-ADDFJAIC3    #1AIC3           Company Number
     C                     Z-ADDFJAODT    #1AODT           Scheduled Ship
     C                     MOVELFJPJST    #1PJST           LTL Flag
     C                     MOVELFJPKST    #1PKST           Load Status
     C                     Z-ADDFJRNNB    #1RNNB           Reefer Temperat
     C                     MOVELFJDMTX    #1DMTX           Seal 1
     C                     MOVELFJDNTX    #1DNTX           Seal 2
     C                     MOVELFJDOTX    #1DOTX           Seal 3
     C                     MOVELFJDXTX    #1DXTX           Trailer Id
     C                     MOVELFJDYTX    #1DYTX           Initials of Con
     C                     Z-ADDFJSBNB    #1SBNB           BOL Time
     C                     MOVELFJRONB    #1RONB           Truck Size
     C                     Z-ADDFJSQNB    #1SQNB           Actual Freight
     C                     MOVELFJVCST    #1VCST           Ship Status
     C                     MOVELFJVDST    #1VDST           Load Type
     C                     Z-ADDFJSDNB    #1SDNB           Number Pallets
     C                     Z-ADDFJPAOU    #1PAOU           Number Pallets
     C                     Z-ADDFJDGWG    #1DGWG           Tare Lbs/Pallet
     C                     Z-ADDFJSXNB    #1SXNB           Estimated Arriv
     C                     Z-ADDFJHADT    #1HADT           Actual Arrival
     C                     Z-ADDFJAART    #1AART           Actual Arrival
     C                     Z-ADDFJDHWG    #1DHWG           Trailer IN Weig
     C                     Z-ADDFJDIWG    #1DIWG           Trailer OUT Wei
     C                     Z-ADDFJAQDT    #1AQDT           Actual Departur
     C                     Z-ADDFJS6NB    #1S6NB           Departure Time
     C                     Z-ADDFJT4NB    #1T4NB           Schedule Sequen
     C                     Z-ADDFJPRTM    #1PRTM           Product Tempera
     C                     Z-ADDFJNPSV    #1NPSV           Number Pallets
     C                     MOVELFJJ8TX    #1J8TX           Car/Veh. Initia
     C                     MOVELFJJ9TX    #1J9TX           Recorder ID
     C                     MOVELFJQ2CD    #1Q2CD           Shipping Method
     C                     MOVELFJVPCD    #1VPCD           Ship From Wareh
     C                     MOVELFJDBCD    #1DBCD           Ship To State C
     C                     Z-ADDFJGRWE    #1GRWE           Gross Weight
     C                     MOVELFJU2ST    #1U2ST           Export Status
     C                     Z-ADDFJF9DT    #1F9DT           Actual Ship Dat
     C                     MOVELFJONTM    #1ONTM           On Time - (Y/N)
     C                     Z-ADDFJJ4DT    #1J4DT           Truck Ready Dat
     C                     Z-ADDFJTRTM    #1TRTM           Truck Ready Tim
     C                     Z-ADDFJJ5DT    #1J5DT           Spotted Date
     C                     Z-ADDFJSPTM    #1SPTM           Spotted Time
     C                     Z-ADDFJJ6DT    #1J6DT           Load Finished D
     C                     Z-ADDFJLFTM    #1LFTM           Load Finished T
     C                     Z-ADDFJJ7DT    #1J7DT           BOL Complete Da
     C                     Z-ADDFJBOTM    #1BOTM           BOL Complete Ti
     C                     Z-ADDFJJ8DT    #1J8DT           BOL Received Da
     C                     Z-ADDFJBLTM    #1BLTM           BOL Received Ti
     C                     Z-ADDFJKIDT    #1KIDT           Truck Departure
     C                     Z-ADDFJASTM    #1ASTM           Truck Departure
     C                     Z-ADDFJKADT    #1KADT           Adjusted Depart
     C                     Z-ADDFJAJCM    #1AJCM           Adjusted Depart
     C                     MOVELFJXACD    #1XACD           Shipping Line
     C                     MOVELFJOANA    #1OANA           Sail Port City
     C                     MOVELFJK4TX    #1K4TX           Vessel Name
     C                     Z-ADDFJVOAG    #1VOAG           Voyage
     C                     Z-ADDFJKBDT    #1KBDT           Sail Date
     C                     MOVELFJNBBO    #1NBBO           Booking Number
     C                     MOVELFJW4CD    #1W4CD           Discharge Port
     C                     Z-ADDFJEFDT    #1EFDT           Arrival Date
     C                     MOVELFJCNTN    #1CNTN           Container Numbe
     C                     Z-ADDFJKCDT    #1KCDT           Date In
     C                     Z-ADDFJTMIN    #1TMIN           Time In
     C                     Z-ADDFJKDDT    #1KDDT           Date Out
     C                     Z-ADDFJVMNB    #1VMNB           Time Out
     C                     Z-ADDFJOCFR    #1OCFR           Ocean Freight
     C                     Z-ADDFJKJDT    #1KJDT           Scheduled Deliv
     C                     Z-ADDFJATTM    #1ATTM           Scheduled Deliv
     C                     MOVELFJOTRS    #1OTRS           On Time Reason
     C                     MOVELFJRNST    #1RNST           BOL Printed Fla
     C                     Z-ADDFJBRBK    #1BRBK           Bring Back Mile
     C                     Z-ADDFJEIDT    #1EIDT           Requested Deliv
     C                     MOVELFJRMST    #1RMST           Load Acceptance
     C                     MOVELFJAJCD    #1AJCD           Warehouse Code
     C                     Z-ADDFJKKDT    #1KKDT           On Yard Date
     C                     Z-ADDFJAVTM    #1AVTM           On Yard Time
     C                     Z-ADDFJKZDT    #1KZDT           Unused Load Dat
     C                     Z-ADDFJAXTM    #1AXTM           Unused Load Tim
     C                     Z-ADDFJK0DT    #1K0DT           Unused Load Dat
     C                     Z-ADDFJAYTM    #1AYTM           Unused Load Tim
     C                     Z-ADDFJK1DT    #1K1DT           Unused Load Dat
     C                     Z-ADDFJAZTM    #1AZTM           Unused Load Tim
     C                     Z-ADDFJK2DT    #1K2DT           Unused Load Dat
     C                     Z-ADDFJA0TM    #1A0TM           Unused Load Tim
     C                     MOVELFJROST    #1ROST           Unused Load Sta
     C                     MOVELFJRPST    #1RPST           Unused Load Sta
     C                     MOVELFJRQST    #1RQST           Unused Load Sta
     C                     MOVELFJRRST    #1RRST           Unused Load Sta
     C                     Z-ADDFJZBVA    #1ZBVA           Unused Load Val
     C                     MOVELFJUVST    #1UVST           EDI Status 1
     C                     MOVELFJUWST    #1UWST           EDI Status 2
     C                     MOVELFJUXST    #1UXST           EDI Status 3
     C                     Z-ADDFJAATM    #1AATM           Job Time
     C                     MOVELFJAYNA    #1AYNA           User Id
     C                     MOVELFJA0NA    #1A0NA           Job Name
     C                     Z-ADDFJAXDT    #1AXDT           Job Date
     C                     Z-ADDFJRMNB    #1RMNB           Load ID
     C                     MOVELFJBZNA    #1BZNA           Carrier Code
     C                     MOVELFJXCCD    #1XCCD           Carrier Broker
     C                     Z-ADDFJRRNB    #1RRNB           Total Stops
     C                     Z-ADDFJRPNB    #1RPNB           Total Weight
     C                     MOVELFJXQST    #1XQST           Allocate Pounds
     C                     Z-ADDFJTLMI    #1TLMI           Total Load Mile
     C                     Z-ADDFJFLAM    #1FLAM           Flat Amount
     C                     Z-ADDFJR1NB    #1R1NB           Rated Freight
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#2    BEGSR
      *================================================================
      * Initialise screen detail record
      *================================================================
      * Existing record indicator
     C                     MOVEL*BLANK    #2OLRC
     C                     Z-ADD#1AIC3    #2AIC3           Company Number
     C                     Z-ADD#1RMNB    #2RMNB           Load ID
     C                     Z-ADD*ZERO     #2RUNB           Stop/Drop Seque
     C                     MOVEL*BLANK    #2DQTX           Comments for Pi
     C                     Z-ADD*ZERO     #2RWNB           Miles to next s
     C                     Z-ADD*ZERO     #2RXNB           Freight Charge
     C                     Z-ADD*ZERO     #2SQNB           Actual Freight
     C                     Z-ADD*ZERO     #RTWNB           USR Freight Mis
     C                     Z-ADD*ZERO     #2T1NB           Freight Stop Ch
     C                     MOVEL*BLANK    #2VCST           Ship Status
     C                     Z-ADD*ZERO     #2KEDT           Estimated Arriv
     C                     Z-ADD*ZERO     #2SXNB           Estimated Arriv
     C                     Z-ADD*ZERO     #2KFDT           Appointment Con
     C                     Z-ADD*ZERO     #2ACTM           Appointment Con
     C                     MOVEL*BLANK    #2K5TX           Confirmation Ma
     C                     MOVEL*BLANK    #2W5CD           Confirmation Nu
     C                     Z-ADD*ZERO     #2EJDT           Actual Delivery
     C                     Z-ADD*ZERO     #2AGTM           Actual Delivery
     C                     Z-ADD*ZERO     #2KJDT           Scheduled Deliv
     C                     Z-ADD*ZERO     #2ATTM           Scheduled Deliv
     C                     Z-ADD*ZERO     #2HDDT           Unused Date 2
     C                     Z-ADD*ZERO     #2AUTM           Unused Time 2
     C                     Z-ADD*ZERO     #2KKDT           On Yard Date
     C                     Z-ADD*ZERO     #2AVTM           On Yard Time
     C                     MOVEL*BLANK    #2UVST           EDI Status 1
     C                     MOVEL*BLANK    #2UWST           EDI Status 2
     C                     MOVEL*BLANK    #2UXST           EDI Status 3
     C                     Z-ADD*ZERO     #2AATM           Job Time
     C                     MOVEL*BLANK    #2AYNA           User Id
     C                     MOVEL*BLANK    #2A0NA           Job Name
     C                     Z-ADD*ZERO     #2AXDT           Job Date
     C                     Z-ADD*ZERO     #2RVNB           Stop/Drop
     C                     Z-ADD*ZERO     #2C4NB           Order Number
      * Clear external version also
     C                     MOVEL*BLANK    V2C4NB
     C                     Z-ADD*ZERO     #RAYWG           USR Order Weigh
     C                     Z-ADD*ZERO     #2T0NB           Freight Misc. C
     C                     Z-ADD*ZERO     #2R1NB           Rated Freight
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         MEFL#2    BEGSR
      *================================================================
      * Load screen detail record
      *================================================================
      * Existing record indicator
     C                     MOVEL'Y'       #2OLRC
     C                     Z-ADDFLAIC3    #2AIC3           Company Number
     C                     Z-ADDFLRMNB    #2RMNB           Load ID
     C                     Z-ADDFLRUNB    #2RUNB           Stop/Drop Seque
     C                     MOVELFLDQTX    #2DQTX           Comments for Pi
     C                     Z-ADDFLRWNB    #2RWNB           Miles to next s
     C                     Z-ADDFLRXNB    #2RXNB           Freight Charge
     C                     Z-ADDFLSQNB    #2SQNB           Actual Freight
     C                     Z-ADDFLT1NB    #2T1NB           Freight Stop Ch
     C                     MOVELFLVCST    #2VCST           Ship Status
     C                     Z-ADDFLKEDT    #2KEDT           Estimated Arriv
     C                     Z-ADDFLSXNB    #2SXNB           Estimated Arriv
     C                     Z-ADDFLKFDT    #2KFDT           Appointment Con
     C                     Z-ADDFLACTM    #2ACTM           Appointment Con
     C                     MOVELFLK5TX    #2K5TX           Confirmation Ma
     C                     MOVELFLW5CD    #2W5CD           Confirmation Nu
     C                     Z-ADDFLEJDT    #2EJDT           Actual Delivery
     C                     Z-ADDFLAGTM    #2AGTM           Actual Delivery
     C                     Z-ADDFLKJDT    #2KJDT           Scheduled Deliv
     C                     Z-ADDFLATTM    #2ATTM           Scheduled Deliv
     C                     Z-ADDFLHDDT    #2HDDT           Unused Date 2
     C                     Z-ADDFLAUTM    #2AUTM           Unused Time 2
     C                     Z-ADDFLKKDT    #2KKDT           On Yard Date
     C                     Z-ADDFLAVTM    #2AVTM           On Yard Time
     C                     MOVELFLUVST    #2UVST           EDI Status 1
     C                     MOVELFLUWST    #2UWST           EDI Status 2
     C                     MOVELFLUXST    #2UXST           EDI Status 3
     C                     Z-ADDFLAATM    #2AATM           Job Time
     C                     MOVELFLAYNA    #2AYNA           User Id
     C                     MOVELFLA0NA    #2A0NA           Job Name
     C                     Z-ADDFLAXDT    #2AXDT           Job Date
     C                     Z-ADDFLRVNB    #2RVNB           Stop/Drop
     C                     Z-ADDFLC4NB    #2C4NB           Order Number
     C                     Z-ADDFLT0NB    #2T0NB           Freight Misc. C
     C                     Z-ADDFLR1NB    #2R1NB           Rated Freight
      * Update saved record image
     C                     MOVEL@2DBRC    #2DBRC
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MNCV#2    BEGSR
      *================================================================
      * Convert subfile fields into external form
      *================================================================
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #2C4NB    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#2C4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    V2C4NB           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    V2C4NB           CD7 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         MOCV#1    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert Order Number to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           #CC4NB    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL#CC4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VCC4NB           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VCC4NB           CD7 Ext Numeric
     C                     END                             *FI
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         MPCV#1    BEGSR
      *================================================================
      * Convert control fields into internal form
      *================================================================
      * Quit if only keys available
     C           W0SCR     CABEQ'KEY'     MPEXIT
      * Validate Allocate Pounds/Miles
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1XQST    W0NSRQ  1        Allocate Pounds
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           '#1XQST'  OREQ YPMTFD
     C                     CALL 'CAVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1289413   Y2LSNO  70
     C           #1XQST    PARM #1XQST    W0EXVL 20        Allocate Pounds
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      *
      * Validate Order Number and convert to internal.
      * CD7 Ext/Int
     C                     MOVELVCC4NB    WUI3ST           USR First Posit
     C                     MOVEL*BLANK    W0RTN            *Return code
      * CASE: WRK.USR First Position is Search request
     C           WUI3ST    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELVCC4NB    WUEOCD           CD7 Ext Numeric
      * CD7 Ext/Int EXCUSRSRC - *Field attribute types  * 
     C                     MOVE *BLANKS   JUSTC7  7
     C                     MOVEA*BLANKS   K7
     C                     Z-ADD7         C       30
     C                     Z-ADD7         D       30
      * FIELD LOADED TO WRK CONTEXT BY INTERNAL FUNCTION
     C                     MOVEAWUEOCD    J7
     C                     MOVE *BLANKS   W0RTN
     C                     DO   7
     C           J7,C      IFNE ' '
     C                     MOVEAJ7,C      K7,D
     C                     SUB  1         D
     C                     END
     C                     SUB  1         C
     C                     END
     C                     MOVEAK7        JUSTC7
      * TEST FOR INVALID DATA IN FIELD
     C                     MOVE JUSTC7    TEST7   1
     C           TEST7     IFGT '?'
     C           TEST7     ANDLT'0'
     C                     MOVE 'USR0752' W0RTN
     C                     ELSE
     C                     MOVE *IN60     HLDIN   1
     C                     TESTN          JUSTC7     606060
     C           *IN60     IFEQ '0'
     C                     MOVE 'USR0752' W0RTN
     C                     END
     C                     END
     C                     MOVE JUSTC7    WUEOCD
     C                     MOVE HLDIN     *IN60
      * CASE: PGM.*Return code is CD3 Non numeric data
     C           W0RTN     IFEQ 'USR0752'                  *IF
      * Setup message data for message
      * Send message 'CD7 Non numeric data'
     C                     MOVEL'USR0802' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     Z-ADD*ZERO     #CC4NB           CD7 Int Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUEOCD    #CC4NB           CD7 Int Numeric
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         MPEXIT    ENDSR
      /EJECT
     CSR         MQIZ#2    BEGSR
      *================================================================
      * Clear value mapped fields
      *================================================================
      *================================================================
     CSR         MQEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Carrier Name       RT - OM Carrier  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           FFBZNA           Carrier Code
      * Setup key
     C                     MOVEL#1XCCD    FFBZNA           Carrier Code
      * Establish starting position
     C           KRSSA     CHAIN@FFREBF              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1180' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    #CAUNA           Name
     C                     MOVEL*BLANK    WUVSST           Record Status
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELFFADTX    #CAUNA           Name
     C                     MOVELFFVSST    WUVSST           Record Status
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Clc Sum misc. freight  RT - OM Load Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     #CTNNB           Total Miscellan
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WARMNB    WQSB02           Load ID
      * Define keylist
     C           KPSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Load ID
     C                     KFLD           WARUNB           Stop/Drop Seque
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Load ID
      * Setup key
     C                     Z-ADDP1AIC3    WQSB01           Company Number
     C                     Z-ADDP1RMNB    WQSB02           Load ID
     C                     Z-ADD*ZERO     WARUNB           Stop/Drop Seque
      * Establish starting position
     C           KPSSB     SETLL@FLCPBW                    *
     C           KRSSB     READE@FLCPBW                  90*
      * Data record not found
     C   90                MOVEL'USR1192' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     ADD  WAT0NB    #CTNNB           Total Miscellan
     C           KRSSB     READE@FLCPBW                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Order Weight       RT - OP Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEC4NB           Order Number
      * Setup key
     C                     Z-ADD#2AIC3    BEAIC3           Company Number
     C                     Z-ADD#2C4NB    BEC4NB           Order Number
      * Establish starting position
     C           KRSSC     CHAIN@BECPFK              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0176' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     #RAYWG           Order Weight To
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDBEA1WG    #RAYWG           Order Weight To
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * CHG Rated Freight      CH - OP Order Header  * 
      *================================================================
      * Clear all neither parameters
     C                     MOVEL*BLANK    WN0001  2        Order Type - Sa
     C                     Z-ADD*ZERO     WN0002  70       A/R Customer Nu
     C                     Z-ADD*ZERO     WN0003  70       Ship To Custome
     C                     MOVEL*BLANK    WN0004 30        Ship To Name
     C                     MOVEL*BLANK    WN0005 30        Ship To Address
     C                     MOVEL*BLANK    WN0006 30        Ship To Address
     C                     MOVEL*BLANK    WN0007 30        Ship To Address
     C                     MOVEL*BLANK    WN0008 20        Ship To City
     C                     MOVEL*BLANK    WN0009  2        Ship To State C
     C                     MOVEL*BLANK    WN0010 11        Ship To Zip/Pos
     C                     Z-ADD*ZERO     WN0011  70       Bill to Custome
     C                     MOVEL*BLANK    WN0012 30        Bill to Name
     C                     MOVEL*BLANK    WN0013 30        Bill to Address
     C                     MOVEL*BLANK    WN0014 30        Bill to Address
     C                     MOVEL*BLANK    WN0015 30        Bill to Address
     C                     MOVEL*BLANK    WN0016 20        Bill to City
     C                     MOVEL*BLANK    WN0017  2        Bill to State C
     C                     MOVEL*BLANK    WN0018 11        Bill to Zip/Pos
     C                     MOVEL*BLANK    WN0019 15        Customer Purcha
     C                     Z-ADD*ZERO     WN0020  70       Order Date
     C                     Z-ADD*ZERO     WN0021  70       Requested Ship
     C                     Z-ADD*ZERO     WN0022  70       Actual Shipped
     C                     Z-ADD*ZERO     WN0023  70       Cancel Date
     C                     MOVEL*BLANK    WN0024  2        Terms Code
     C                     MOVEL*BLANK    WN0025 40        Special Instruc
     C                     MOVEL*BLANK    WN0026 40        Special Instruc
     C                     MOVEL*BLANK    WN0027  3        Carrier Code
     C                     MOVEL*BLANK    WN0028  1        Comment Print A
     C                     MOVEL*BLANK    WN0029  1        Comment Print I
     C                     MOVEL*BLANK    WN0030  1        Comment Print P
     C                     MOVEL*BLANK    WN0031  1        Comment Print S
     C                     MOVEL*BLANK    WN0032  3        Reason Code
     C                     MOVEL*BLANK    WN0033  1        Order in Use
     C                     MOVEL*BLANK    WN0034  1        Header Status
     C                     MOVEL*BLANK    WN0035  1        Header Status L
     C                     MOVEL*BLANK    WN0036  1        Order Type Prin
     C                     Z-ADD*ZERO     WN0037  70       Scheduled Ship
     C                     MOVEL*BLANK    WN0038 10        User Original E
     C                     Z-ADD*ZERO     WN0039  70       Date of Origina
     C                     Z-ADD*ZERO     WN0040 112       Order Value Tot
     C                     Z-ADD*ZERO     WN0041 112       Order Weight To
     C                     MOVEL*BLANK    WN0042  1        Credit Hold
     C                     MOVEL*BLANK    WN0043  1        Production Hold
     C                     MOVEL*BLANK    WN0044  1        New Customer Ho
     C                     Z-ADD*ZERO     WN0045  70       Requested Deliv
     C                     Z-ADD*ZERO     WN0046  40       Requested Deliv
     C                     MOVEL*BLANK    WN0047  4        Accounts Receiv
     C                     MOVEL*BLANK    WN0048 12        Accounts Receiv
     C                     Z-ADD*ZERO     WN0049  70       Load ID
     C                     Z-ADD*ZERO     WN0050  52       Absorbed Freigh
     C                     MOVEL*BLANK    WN0051  1        LTL Flag
     C                     MOVEL*BLANK    WN0052  1        Price Audit
     C                     MOVEL*BLANK    WN0053  1        Price Status
     C                     MOVEL*BLANK    WN0054  2        Shipping Method
     C                     MOVEL*BLANK    WN0055  1        Export Status
     C                     MOVEL*BLANK    WN0056  1        Palletize
     C                     MOVEL*BLANK    WN0057  1        Shrink Wrap
     C                     MOVEL*BLANK    WN0058  1        Slip Sheet
     C                     MOVEL*BLANK    WN0059  1        Age Code
     C                     Z-ADD*ZERO     WN0060  52       Reefer Temperat
     C                     MOVEL*BLANK    WN0061  1        Load Type
     C                     Z-ADD*ZERO     WN0062  70       Attach to Invoi
     C                     MOVEL*BLANK    WN0063  1        Load Plan Order
     C                     MOVEL*BLANK    WN0064  1        Print Pick Slip
     C                     Z-ADD*ZERO     WN0065  70       Resell Referenc
     C                     MOVEL*BLANK    WN0066 30        Special Comment
     C                     MOVEL*BLANK    WN0067 30        Special Comment
     C                     MOVEL*BLANK    WN0068  1        Affect Auto Acc
     C                     MOVEL*BLANK    WN0069  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0070  2        Manager Level C
     C                     MOVEL*BLANK    WN0071  3        VP Level Code
     C                     Z-ADD*ZERO     WN0072  70       Attach to Order
     C                     MOVEL*BLANK    WN0073  3        Reason for Pric
     C                     Z-ADD*ZERO     WN0074  70       Invoice Number
     C                     MOVEL*BLANK    WN0075  2        Invoice Suffix
     C                     Z-ADD*ZERO     WN0076  70       Invoice Date
     C                     MOVEL*BLANK    WN0077  2        Event Code
     C                     MOVEL*BLANK    WN0078  1        Trans Contol AS
     C                     MOVEL*BLANK    WN0079  1        Modified Flag
     C                     Z-ADD*ZERO     WN0080 112       A/R order Value
     C                     MOVEL*BLANK    WN0081  1        Billing Activit
     C                     MOVEL*BLANK    WN0082  1        Block Order Fla
     C                     MOVEL*BLANK    WN0083  1        Unused Processi
     C                     MOVEL*BLANK    WN0084  1        EDI Status 1
     C                     MOVEL*BLANK    WN0085  1        EDI Status 2
     C                     MOVEL*BLANK    WN0086  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0087  60       Job Time
     C                     MOVEL*BLANK    WN0088 10        User Id
     C                     MOVEL*BLANK    WN0089 10        Job Name
     C                     Z-ADD*ZERO     WN0090  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @BECPFJ
     C                     Z-ADD#2AIC3    BEAIC3           Company Number
     C                     Z-ADD#2C4NB    BEC4NB           Order Number
      *
     C           KLCHSD    KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEC4NB           Order Number
     C           KLCHSD    CHAIN@BECPFJ              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOPBF1    YARDCS
      * Move non-key fields to @BECPFJ
     C                     Z-ADD#2R1NB    BER1NB           Rated Freight
      *
      * Set PGM.*Record Data Changed flag
     C           QOPBF1    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     BEAATM           Job Time
     C                     MOVEL##USR     BEAYNA           User Id
     C                     MOVEL##JOB     BEA0NA           Job Name
     C                     Z-ADD##JDT     BEAXDT           Job Date
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BECPFJ                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOPBFCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Chg Adjust Rated Frt   RT - OP Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSE01           Company Number
     C           *LIKE     DEFN WBRMNB    WQSE02           Load ID
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           Company Number
     C                     KFLD           WQSE02           Load ID
      * Setup key
     C                     Z-ADD#2AIC3    WQSE01           Company Number
     C                     Z-ADD#2RMNB    WQSE02           Load ID
      * Establish starting position
     C           KRSSE     SETLL@BFCPNQ                    *
     C           KRSSE     READE@BFCPNQ                  90*
      * Data record not found
     C   90                MOVEL'USR0176' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * UPD Rated Freight      RT - PD Order Detail  * 
     C                     EXSR SFRVGN
     C           KRSSE     READE@BFCPNQ                  90*
     C                     ENDDO
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * UPD Rated Freight      RT - PD Order Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0091  30       Order Sequence
     C                     Z-ADD*ZERO     WN0092  30       Order Secondary
     C                     Z-ADD*ZERO     WN0093 112       Rated Freight
     C                     Z-ADD*ZERO     WN0094 112       @Rated Freight
     C                     MOVEL*BLANK    WN0095  1        USR Process sta
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * par.@rated freight is the sum of all the detail rated frt, for ad
     C                     Z-ADD*ZERO     WN0094           @Rated Freight
      * par.usr process status is used to indicate if there are detail pr
     C                     MOVEL'N'       WN0095           USR Process sta
      * Declare restrictor key work fields
     C           *LIKE     DEFN OMAIC3    WQSF01           Company Number
     C           *LIKE     DEFN OMC4NB    WQSF02           Order Number
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           Company Number
     C                     KFLD           WQSF02           Order Number
      * Setup key
     C                     Z-ADDWBAIC3    WQSF01           Company Number
     C                     Z-ADDWBC4NB    WQSF02           Order Number
      * Establish starting position
     C           KRSSF     SETLL@BGWKL1                    *
     C           KRSSF     READE@BGWKL1                  90*
      * Data record not found
     C   90                MOVEL'USR1309' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Detail Line Status is Cancelled
     C           OMGMST    IFEQ 'X'                        *IF
      * CHG Rated Freight      CH - PD Order Detail  * 
     C                     EXSR SGCHRC
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WN0095           USR Process sta
      * CASE:
      *  - c1 OR c2
      *   |- c1    : PAR.Order Weight Total is Equal to zero
      *   |- c2    : PAR.Total Rated Freight is Zero
      *   '-
     C           WBA1WG    IFEQ *ZERO                      *IF
     C           WBR1NB    OREQ *ZERO                      *OR
     C                     Z-ADD*ZERO     WN0093           Rated Freight
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DB1.Detail Line Status is Confirmed & Complete
     C           OMGMST    IFEQ 'C'                        *IF
     C           OMGMST    OREQ 'R'
      * Compute Dtl Rated Freight
      * PGM.*Synon (17,9) work field =
      *    *COMPUTE (x1 / x3 * x4)
      * x1    : DB1.Weight Shipped Total
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Order Weight Total
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x4    : PAR.Total Rated Freight
     C           OMATWG    DIV  WBA1WG    W0WD01    H      *Synon (17,7) w
     C           W0WD01    MULT WBR1NB    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    W0WE             *Synon (17,9) w
     C                     ELSE
      * CASE: *OTHERWISE
      * Compute Dtl Rated Freight
      * PGM.*Synon (17,9) work field =
      *    *COMPUTE ((x1 * x2) / x3 * x4)
      * x1    : DB1.Quantity Ordered
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x2    : DB1.Unit Weight Ordered U/M
      * /     : PGM.*Synon (17,7) work field *Rounded
      * x3    : PAR.Order Weight Total
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x4    : PAR.Total Rated Freight
     C           OMAVQT    MULT OMAVWG    W0WD02           *Synon (17,7) w
     C           W0WD02    DIV  WBA1WG    W0WD01    H      *Synon (17,7) w
     C           W0WD01    MULT WBR1NB    W0WD00    H      *Synon (17,7) w
     C                     Z-ADDW0WD00    W0WE             *Synon (17,9) w
     C                     END                             *FI
     C           W0WE      MULT 1         WN0093    H      Rated Freight
     C                     END                             *FI
      * CHG Rated Freight      CH - PD Order Detail  * 
     C                     EXSR SHCHRC
     C                     ADD  WN0093    WN0094           @Rated Freight
     C                     Z-ADDOMDPNB    WN0091           Order Sequence
     C                     Z-ADDOMUENB    WN0092           Order Secondary
     C                     END                             *FI
     C           KRSSF     READE@BGWKL1                  90*
     C                     ENDDO
      * USER: Exit processing
      * Adjust totals
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.@Rated Freight NE PAR.Total Rated Freight
      *   |- c2    : PAR.USR Process status is yes
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WN0094    IFNE WBR1NB                     *IF
     C           WN0095    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C           WBR1NB    SUB  WN0094    WUICVA           USR Adjustment
     C                     ADD  WUICVA    WN0093           Rated Freight
      * Update last detail line processed
      * CHG Rated Freight      CH - PD Order Detail  * 
     C                     EXSR SICHRC
     C                     END                             *FI
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCHRC    BEGSR
      *================================================================
      * CHG Rated Freight      CH - PD Order Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0096  70       Item Code
     C                     MOVEL*BLANK    WN0097  3        Warehouse Code
     C                     Z-ADD*ZERO     WN0098  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0099  70       Order Group Cod
     C                     MOVEL*BLANK    WN0100  1        Detail Line Sta
     C                     MOVEL*BLANK    WN0101  1        Detail Line Sta
     C                     Z-ADD*ZERO     WN0102 112       Billing Detail
     C                     Z-ADD*ZERO     WN0103 112       Billing Detail
     C                     Z-ADD*ZERO     WN0104 112       Billing Detail
     C                     Z-ADD*ZERO     WN0105 112       Quantity to Sub
     C                     MOVEL*BLANK    WN0106  1        Comment Print A
     C                     MOVEL*BLANK    WN0107  1        Comment Print I
     C                     MOVEL*BLANK    WN0108  1        Comment Print P
     C                     MOVEL*BLANK    WN0109  1        Comment Print S
     C                     Z-ADD*ZERO     WN0110 112       Extended Amount
     C                     Z-ADD*ZERO     WN0111  70       Market Pricing
     C                     MOVEL*BLANK    WN0112  3        Commodity Marke
     C                     MOVEL*BLANK    WN0113  3        Date Method Cod
     C                     MOVEL*BLANK    WN0114  3        Price Method Co
     C                     Z-ADD*ZERO     WN0115 114       Price Overage O
     C                     Z-ADD*ZERO     WN0116  70       Contract Number
     C                     MOVEL*BLANK    WN0117  1        Price Status
     C                     Z-ADD*ZERO     WN0118  70       Pricing Date Us
     C                     MOVEL*BLANK    WN0119  2        U/M - Base Pric
     C                     MOVEL*BLANK    WN0120  2        U/M - Ordered
     C                     MOVEL*BLANK    WN0121  1        Work Confirm St
     C                     MOVEL*BLANK    WN0122  1        Work Over/Short
     C                     MOVEL*BLANK    WN0123  1        Work Extra Stat
     C                     MOVEL*BLANK    WN0124 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0125 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0126  1        Age Code
     C                     MOVEL*BLANK    WN0127  1        Palletize
     C                     MOVEL*BLANK    WN0128  1        Slip Sheet
     C                     MOVEL*BLANK    WN0129  1        Catch Weight St
     C                     MOVEL*BLANK    WN0130  1        Price Audit
     C                     MOVEL*BLANK    WN0131  3        Price Audit Rea
     C                     MOVEL*BLANK    WN0132  1        Production Date
     C                     Z-ADD*ZERO     WN0133 112       Quantity Ordere
     C                     Z-ADD*ZERO     WN0134 112       Weight Ordered
     C                     Z-ADD*ZERO     WN0135 112       Quantity Schedu
     C                     Z-ADD*ZERO     WN0136 112       Weight Schedule
     C                     Z-ADD*ZERO     WN0137 112       Quantity Shippe
     C                     Z-ADD*ZERO     WN0138 112       Weight Shipped
     C                     Z-ADD*ZERO     WN0139 114       Unit Cost Order
     C                     Z-ADD*ZERO     WN0140 114       Unit Cost Per P
     C                     Z-ADD*ZERO     WN0141 114       Unit Price
     C                     Z-ADD*ZERO     WN0142 114       Unit Price - Cr
     C                     Z-ADD*ZERO     WN0143 114       Unit Price Orde
     C                     Z-ADD*ZERO     WN0144 112       Unit Weight Ord
     C                     Z-ADD*ZERO     WN0145 112       Tare Weight Tot
     C                     Z-ADD*ZERO     WN0146  70       Requested Ship
     C                     Z-ADD*ZERO     WN0147  70       Scheduled Ship
     C                     Z-ADD*ZERO     WN0148  70       Actual Shipped
     C                     MOVEL*BLANK    WN0149  1        Affect Inventor
     C                     MOVEL*BLANK    WN0150  1        Affect Sales Do
     C                     MOVEL*BLANK    WN0151  1        Affect Sales Pn
     C                     Z-ADD*ZERO     WN0152  30       Item Structure
     C                     Z-ADD*ZERO     WN0153  30       Item Structure
     C                     Z-ADD*ZERO     WN0154  30       Item Structure
     C                     MOVEL*BLANK    WN0155  2        Item Level
     C                     MOVEL*BLANK    WN0156  2        Quality Level
     C                     MOVEL*BLANK    WN0157  2        Pricing Product
     C                     MOVEL*BLANK    WN0158  2        Season Product
     C                     Z-ADD*ZERO     WN0159  70       Date of Origina
     C                     MOVEL*BLANK    WN0160 10        User Profile Na
     C                     MOVEL*BLANK    WN0161  6        Country Code
     C                     MOVEL*BLANK    WN0162  2        Event Code
     C                     MOVEL*BLANK    WN0163  3        Reason Code
     C                     MOVEL*BLANK    WN0164  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0165  1        Modified Flag
     C                     MOVEL*BLANK    WN0166  1        Substituted Fla
     C                     MOVEL*BLANK    WN0167  1        Order Detail St
     C                     MOVEL*BLANK    WN0168  1        EDI Status 1
     C                     MOVEL*BLANK    WN0169  1        EDI Status 2
     C                     MOVEL*BLANK    WN0170  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0171  60       Job Time
     C                     MOVEL*BLANK    WN0172 10        User Id
     C                     MOVEL*BLANK    WN0173 10        Job Name
     C                     Z-ADD*ZERO     WN0174  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @BGWKL0
      *
     C           KLCHSG    KLIST
     C                     KFLD           OMAIC3           Company Number
     C                     KFLD           OMC4NB           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
     C           KLCHSG    CHAIN@BGWKL0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SGEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOPBG1    YBRDCS
      * Move non-key fields to @BGWKL0
     C                     Z-ADD*ZERO     OMR1NB           Rated Freight
      *
      * Set PGM.*Record Data Changed flag
     C           QOPBG1    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     OMAATM           Job Time
     C                     MOVEL##USR     OMAYNA           User Id
     C                     MOVEL##JOB     OMA0NA           Job Name
     C                     Z-ADD##JDT     OMAXDT           Job Date
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@BGWKL0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOPBGWKL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * CHG Rated Freight      CH - PD Order Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0175  70       Item Code
     C                     MOVEL*BLANK    WN0176  3        Warehouse Code
     C                     Z-ADD*ZERO     WN0177  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0178  70       Order Group Cod
     C                     MOVEL*BLANK    WN0179  1        Detail Line Sta
     C                     MOVEL*BLANK    WN0180  1        Detail Line Sta
     C                     Z-ADD*ZERO     WN0181 112       Billing Detail
     C                     Z-ADD*ZERO     WN0182 112       Billing Detail
     C                     Z-ADD*ZERO     WN0183 112       Billing Detail
     C                     Z-ADD*ZERO     WN0184 112       Quantity to Sub
     C                     MOVEL*BLANK    WN0185  1        Comment Print A
     C                     MOVEL*BLANK    WN0186  1        Comment Print I
     C                     MOVEL*BLANK    WN0187  1        Comment Print P
     C                     MOVEL*BLANK    WN0188  1        Comment Print S
     C                     Z-ADD*ZERO     WN0189 112       Extended Amount
     C                     Z-ADD*ZERO     WN0190  70       Market Pricing
     C                     MOVEL*BLANK    WN0191  3        Commodity Marke
     C                     MOVEL*BLANK    WN0192  3        Date Method Cod
     C                     MOVEL*BLANK    WN0193  3        Price Method Co
     C                     Z-ADD*ZERO     WN0194 114       Price Overage O
     C                     Z-ADD*ZERO     WN0195  70       Contract Number
     C                     MOVEL*BLANK    WN0196  1        Price Status
     C                     Z-ADD*ZERO     WN0197  70       Pricing Date Us
     C                     MOVEL*BLANK    WN0198  2        U/M - Base Pric
     C                     MOVEL*BLANK    WN0199  2        U/M - Ordered
     C                     MOVEL*BLANK    WN0200  1        Work Confirm St
     C                     MOVEL*BLANK    WN0201  1        Work Over/Short
     C                     MOVEL*BLANK    WN0202  1        Work Extra Stat
     C                     MOVEL*BLANK    WN0203 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0204 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0205  1        Age Code
     C                     MOVEL*BLANK    WN0206  1        Palletize
     C                     MOVEL*BLANK    WN0207  1        Slip Sheet
     C                     MOVEL*BLANK    WN0208  1        Catch Weight St
     C                     MOVEL*BLANK    WN0209  1        Price Audit
     C                     MOVEL*BLANK    WN0210  3        Price Audit Rea
     C                     MOVEL*BLANK    WN0211  1        Production Date
     C                     Z-ADD*ZERO     WN0212 112       Quantity Ordere
     C                     Z-ADD*ZERO     WN0213 112       Weight Ordered
     C                     Z-ADD*ZERO     WN0214 112       Quantity Schedu
     C                     Z-ADD*ZERO     WN0215 112       Weight Schedule
     C                     Z-ADD*ZERO     WN0216 112       Quantity Shippe
     C                     Z-ADD*ZERO     WN0217 112       Weight Shipped
     C                     Z-ADD*ZERO     WN0218 114       Unit Cost Order
     C                     Z-ADD*ZERO     WN0219 114       Unit Cost Per P
     C                     Z-ADD*ZERO     WN0220 114       Unit Price
     C                     Z-ADD*ZERO     WN0221 114       Unit Price - Cr
     C                     Z-ADD*ZERO     WN0222 114       Unit Price Orde
     C                     Z-ADD*ZERO     WN0223 112       Unit Weight Ord
     C                     Z-ADD*ZERO     WN0224 112       Tare Weight Tot
     C                     Z-ADD*ZERO     WN0225  70       Requested Ship
     C                     Z-ADD*ZERO     WN0226  70       Scheduled Ship
     C                     Z-ADD*ZERO     WN0227  70       Actual Shipped
     C                     MOVEL*BLANK    WN0228  1        Affect Inventor
     C                     MOVEL*BLANK    WN0229  1        Affect Sales Do
     C                     MOVEL*BLANK    WN0230  1        Affect Sales Pn
     C                     Z-ADD*ZERO     WN0231  30       Item Structure
     C                     Z-ADD*ZERO     WN0232  30       Item Structure
     C                     Z-ADD*ZERO     WN0233  30       Item Structure
     C                     MOVEL*BLANK    WN0234  2        Item Level
     C                     MOVEL*BLANK    WN0235  2        Quality Level
     C                     MOVEL*BLANK    WN0236  2        Pricing Product
     C                     MOVEL*BLANK    WN0237  2        Season Product
     C                     Z-ADD*ZERO     WN0238  70       Date of Origina
     C                     MOVEL*BLANK    WN0239 10        User Profile Na
     C                     MOVEL*BLANK    WN0240  6        Country Code
     C                     MOVEL*BLANK    WN0241  2        Event Code
     C                     MOVEL*BLANK    WN0242  3        Reason Code
     C                     MOVEL*BLANK    WN0243  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0244  1        Modified Flag
     C                     MOVEL*BLANK    WN0245  1        Substituted Fla
     C                     MOVEL*BLANK    WN0246  1        Order Detail St
     C                     MOVEL*BLANK    WN0247  1        EDI Status 1
     C                     MOVEL*BLANK    WN0248  1        EDI Status 2
     C                     MOVEL*BLANK    WN0249  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0250  60       Job Time
     C                     MOVEL*BLANK    WN0251 10        User Id
     C                     MOVEL*BLANK    WN0252 10        Job Name
     C                     Z-ADD*ZERO     WN0253  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YCRDC   1
      *
      * Move key fields to @BGWKL0
      *
     C           KLCHSH    KLIST
     C                     KFLD           OMAIC3           Company Number
     C                     KFLD           OMC4NB           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
     C           KLCHSH    CHAIN@BGWKL0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOPBG1    YCRDCS
      * Move non-key fields to @BGWKL0
     C                     Z-ADDWN0093    OMR1NB           Rated Freight
      *
      * Set PGM.*Record Data Changed flag
     C           QOPBG1    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     OMAATM           Job Time
     C                     MOVEL##USR     OMAYNA           User Id
     C                     MOVEL##JOB     OMA0NA           Job Name
     C                     Z-ADD##JDT     OMAXDT           Job Date
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@BGWKL0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOPBGWKL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICHRC    BEGSR
      *================================================================
      * CHG Rated Freight      CH - PD Order Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0254  70       Item Code
     C                     MOVEL*BLANK    WN0255  3        Warehouse Code
     C                     Z-ADD*ZERO     WN0256  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0257  70       Order Group Cod
     C                     MOVEL*BLANK    WN0258  1        Detail Line Sta
     C                     MOVEL*BLANK    WN0259  1        Detail Line Sta
     C                     Z-ADD*ZERO     WN0260 112       Billing Detail
     C                     Z-ADD*ZERO     WN0261 112       Billing Detail
     C                     Z-ADD*ZERO     WN0262 112       Billing Detail
     C                     Z-ADD*ZERO     WN0263 112       Quantity to Sub
     C                     MOVEL*BLANK    WN0264  1        Comment Print A
     C                     MOVEL*BLANK    WN0265  1        Comment Print I
     C                     MOVEL*BLANK    WN0266  1        Comment Print P
     C                     MOVEL*BLANK    WN0267  1        Comment Print S
     C                     Z-ADD*ZERO     WN0268 112       Extended Amount
     C                     Z-ADD*ZERO     WN0269  70       Market Pricing
     C                     MOVEL*BLANK    WN0270  3        Commodity Marke
     C                     MOVEL*BLANK    WN0271  3        Date Method Cod
     C                     MOVEL*BLANK    WN0272  3        Price Method Co
     C                     Z-ADD*ZERO     WN0273 114       Price Overage O
     C                     Z-ADD*ZERO     WN0274  70       Contract Number
     C                     MOVEL*BLANK    WN0275  1        Price Status
     C                     Z-ADD*ZERO     WN0276  70       Pricing Date Us
     C                     MOVEL*BLANK    WN0277  2        U/M - Base Pric
     C                     MOVEL*BLANK    WN0278  2        U/M - Ordered
     C                     MOVEL*BLANK    WN0279  1        Work Confirm St
     C                     MOVEL*BLANK    WN0280  1        Work Over/Short
     C                     MOVEL*BLANK    WN0281  1        Work Extra Stat
     C                     MOVEL*BLANK    WN0282 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0283 30        Order Desc. Lin
     C                     MOVEL*BLANK    WN0284  1        Age Code
     C                     MOVEL*BLANK    WN0285  1        Palletize
     C                     MOVEL*BLANK    WN0286  1        Slip Sheet
     C                     MOVEL*BLANK    WN0287  1        Catch Weight St
     C                     MOVEL*BLANK    WN0288  1        Price Audit
     C                     MOVEL*BLANK    WN0289  3        Price Audit Rea
     C                     MOVEL*BLANK    WN0290  1        Production Date
     C                     Z-ADD*ZERO     WN0291 112       Quantity Ordere
     C                     Z-ADD*ZERO     WN0292 112       Weight Ordered
     C                     Z-ADD*ZERO     WN0293 112       Quantity Schedu
     C                     Z-ADD*ZERO     WN0294 112       Weight Schedule
     C                     Z-ADD*ZERO     WN0295 112       Quantity Shippe
     C                     Z-ADD*ZERO     WN0296 112       Weight Shipped
     C                     Z-ADD*ZERO     WN0297 114       Unit Cost Order
     C                     Z-ADD*ZERO     WN0298 114       Unit Cost Per P
     C                     Z-ADD*ZERO     WN0299 114       Unit Price
     C                     Z-ADD*ZERO     WN0300 114       Unit Price - Cr
     C                     Z-ADD*ZERO     WN0301 114       Unit Price Orde
     C                     Z-ADD*ZERO     WN0302 112       Unit Weight Ord
     C                     Z-ADD*ZERO     WN0303 112       Tare Weight Tot
     C                     Z-ADD*ZERO     WN0304  70       Requested Ship
     C                     Z-ADD*ZERO     WN0305  70       Scheduled Ship
     C                     Z-ADD*ZERO     WN0306  70       Actual Shipped
     C                     MOVEL*BLANK    WN0307  1        Affect Inventor
     C                     MOVEL*BLANK    WN0308  1        Affect Sales Do
     C                     MOVEL*BLANK    WN0309  1        Affect Sales Pn
     C                     Z-ADD*ZERO     WN0310  30       Item Structure
     C                     Z-ADD*ZERO     WN0311  30       Item Structure
     C                     Z-ADD*ZERO     WN0312  30       Item Structure
     C                     MOVEL*BLANK    WN0313  2        Item Level
     C                     MOVEL*BLANK    WN0314  2        Quality Level
     C                     MOVEL*BLANK    WN0315  2        Pricing Product
     C                     MOVEL*BLANK    WN0316  2        Season Product
     C                     Z-ADD*ZERO     WN0317  70       Date of Origina
     C                     MOVEL*BLANK    WN0318 10        User Profile Na
     C                     MOVEL*BLANK    WN0319  6        Country Code
     C                     MOVEL*BLANK    WN0320  2        Event Code
     C                     MOVEL*BLANK    WN0321  3        Reason Code
     C                     MOVEL*BLANK    WN0322  3        Sales Route Cod
     C                     MOVEL*BLANK    WN0323  1        Modified Flag
     C                     MOVEL*BLANK    WN0324  1        Substituted Fla
     C                     MOVEL*BLANK    WN0325  1        Order Detail St
     C                     MOVEL*BLANK    WN0326  1        EDI Status 1
     C                     MOVEL*BLANK    WN0327  1        EDI Status 2
     C                     MOVEL*BLANK    WN0328  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0329  60       Job Time
     C                     MOVEL*BLANK    WN0330 10        User Id
     C                     MOVEL*BLANK    WN0331 10        Job Name
     C                     Z-ADD*ZERO     WN0332  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YDRDC   1
      *
      * Move key fields to @BGWKL0
     C                     Z-ADDWBAIC3    OMAIC3           Company Number
     C                     Z-ADDWBC4NB    OMC4NB           Order Number
     C                     Z-ADDWN0091    OMDPNB           Order Sequence
     C                     Z-ADDWN0092    OMUENB           Order Secondary
      *
     C           KLCHSI    KLIST
     C                     KFLD           OMAIC3           Company Number
     C                     KFLD           OMC4NB           Order Number
     C                     KFLD           OMDPNB           Order Sequence
     C                     KFLD           OMUENB           Order Secondary
     C           KLCHSI    CHAIN@BGWKL0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOPBG1    YDRDCS
      * Move non-key fields to @BGWKL0
     C                     Z-ADDWN0093    OMR1NB           Rated Freight
      *
      * Set PGM.*Record Data Changed flag
     C           QOPBG1    IFNE YDRDCS
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     OMAATM           Job Time
     C                     MOVEL##USR     OMAYNA           User Id
     C                     MOVEL##JOB     OMA0NA           Job Name
     C                     Z-ADD##JDT     OMAXDT           Job Date
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@BGWKL0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOPBGWKL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * CHG Recovery Freight   CH - OM Load Header  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0333  70       Scheduled Ship
     C                     MOVEL*BLANK    WN0334  1        LTL Flag
     C                     MOVEL*BLANK    WN0335  1        Load Status
     C                     Z-ADD*ZERO     WN0336  52       Reefer Temperat
     C                     MOVEL*BLANK    WN0337 15        Seal 1
     C                     MOVEL*BLANK    WN0338 15        Seal 2
     C                     MOVEL*BLANK    WN0339 15        Seal 3
     C                     Z-ADD*ZERO     WN0340  70       Total Weight
     C                     Z-ADD*ZERO     WN0341  50       Total Stops
     C                     MOVEL*BLANK    WN0342 20        Trailer Id
     C                     MOVEL*BLANK    WN0343  3        Initials of Con
     C                     Z-ADD*ZERO     WN0344  40       BOL Time
     C                     MOVEL*BLANK    WN0345  3        Carrier Code
     C                     MOVEL*BLANK    WN0346  7        Truck Size
     C                     Z-ADD*ZERO     WN0347  70       Actual Freight
     C                     MOVEL*BLANK    WN0348  1        Ship Status
     C                     MOVEL*BLANK    WN0349  1        Load Type
     C                     Z-ADD*ZERO     WN0350  50       Number Pallets
     C                     Z-ADD*ZERO     WN0351  50       Number Pallets
     C                     Z-ADD*ZERO     WN0352 112       Tare Lbs/Pallet
     C                     Z-ADD*ZERO     WN0353  60       Estimated Arriv
     C                     Z-ADD*ZERO     WN0354  70       Actual Arrival
     C                     Z-ADD*ZERO     WN0355  40       Actual Arrival
     C                     Z-ADD*ZERO     WN0356 112       Trailer IN Weig
     C                     Z-ADD*ZERO     WN0357 112       Trailer OUT Wei
     C                     Z-ADD*ZERO     WN0358  70       Actual Departur
     C                     Z-ADD*ZERO     WN0359  40       Departure Time
     C                     Z-ADD*ZERO     WN0360  50       Schedule Sequen
     C                     Z-ADD*ZERO     WN0361  52       Product Tempera
     C                     Z-ADD*ZERO     WN0362  50       Number Pallets
     C                     MOVEL*BLANK    WN0363 12        Car/Veh. Initia
     C                     MOVEL*BLANK    WN0364 12        Recorder ID
     C                     MOVEL*BLANK    WN0365  2        Shipping Method
     C                     MOVEL*BLANK    WN0366  3        Ship From Wareh
     C                     MOVEL*BLANK    WN0367  2        Ship To State C
     C                     Z-ADD*ZERO     WN0368  70       Gross Weight
     C                     MOVEL*BLANK    WN0369  3        Carrier Broker
     C                     MOVEL*BLANK    WN0370  1        Export Status
     C                     Z-ADD*ZERO     WN0371  70       Actual Ship Dat
     C                     MOVEL*BLANK    WN0372  1        On Time - (Y/N)
     C                     Z-ADD*ZERO     WN0373  70       Truck Ready Dat
     C                     Z-ADD*ZERO     WN0374  60       Truck Ready Tim
     C                     Z-ADD*ZERO     WN0375  70       Spotted Date
     C                     Z-ADD*ZERO     WN0376  60       Spotted Time
     C                     Z-ADD*ZERO     WN0377  70       Load Finished D
     C                     Z-ADD*ZERO     WN0378  60       Load Finished T
     C                     Z-ADD*ZERO     WN0379  70       BOL Complete Da
     C                     Z-ADD*ZERO     WN0380  60       BOL Complete Ti
     C                     Z-ADD*ZERO     WN0381  70       BOL Received Da
     C                     Z-ADD*ZERO     WN0382  60       BOL Received Ti
     C                     Z-ADD*ZERO     WN0383  70       Truck Departure
     C                     Z-ADD*ZERO     WN0384  60       Truck Departure
     C                     Z-ADD*ZERO     WN0385  70       Adjusted Depart
     C                     Z-ADD*ZERO     WN0386  60       Adjusted Depart
     C                     MOVEL*BLANK    WN0387  3        Shipping Line
     C                     MOVEL*BLANK    WN0388 20        Sail Port City
     C                     MOVEL*BLANK    WN0389 30        Vessel Name
     C                     Z-ADD*ZERO     WN0390  50       Voyage
     C                     Z-ADD*ZERO     WN0391  70       Sail Date
     C                     MOVEL*BLANK    WN0392 12        Booking Number
     C                     MOVEL*BLANK    WN0393 20        Discharge Port
     C                     Z-ADD*ZERO     WN0394  70       Arrival Date
     C                     MOVEL*BLANK    WN0395 12        Container Numbe
     C                     Z-ADD*ZERO     WN0396  70       Date In
     C                     Z-ADD*ZERO     WN0397  60       Time In
     C                     Z-ADD*ZERO     WN0398  70       Date Out
     C                     Z-ADD*ZERO     WN0399  60       Time Out
     C                     Z-ADD*ZERO     WN0400 112       Ocean Freight
     C                     Z-ADD*ZERO     WN0401  70       Scheduled Deliv
     C                     Z-ADD*ZERO     WN0402  60       Scheduled Deliv
     C                     MOVEL*BLANK    WN0403  1        On Time Reason
     C                     MOVEL*BLANK    WN0404  1        BOL Printed Fla
     C                     Z-ADD*ZERO     WN0405  70       Bring Back Mile
     C                     Z-ADD*ZERO     WN0406  70       Requested Deliv
     C                     MOVEL*BLANK    WN0407  1        Load Acceptance
     C                     MOVEL*BLANK    WN0408  3        Warehouse Code
     C                     Z-ADD*ZERO     WN0409  70       On Yard Date
     C                     Z-ADD*ZERO     WN0410  60       On Yard Time
     C                     Z-ADD*ZERO     WN0411  70       Unused Load Dat
     C                     Z-ADD*ZERO     WN0412  60       Unused Load Tim
     C                     Z-ADD*ZERO     WN0413  70       Unused Load Dat
     C                     Z-ADD*ZERO     WN0414  60       Unused Load Tim
     C                     Z-ADD*ZERO     WN0415  70       Unused Load Dat
     C                     Z-ADD*ZERO     WN0416  60       Unused Load Tim
     C                     Z-ADD*ZERO     WN0417  70       Unused Load Dat
     C                     Z-ADD*ZERO     WN0418  60       Unused Load Tim
     C                     MOVEL*BLANK    WN0419  1        Unused Load Sta
     C                     MOVEL*BLANK    WN0420  1        Unused Load Sta
     C                     MOVEL*BLANK    WN0421  1        Unused Load Sta
     C                     MOVEL*BLANK    WN0422  1        Unused Load Sta
     C                     Z-ADD*ZERO     WN0423 112       Unused Load Val
     C                     MOVEL*BLANK    WN0424  1        EDI Status 1
     C                     MOVEL*BLANK    WN0425  1        EDI Status 2
     C                     MOVEL*BLANK    WN0426  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0427  60       Job Time
     C                     MOVEL*BLANK    WN0428 10        User Id
     C                     MOVEL*BLANK    WN0429 10        Job Name
     C                     Z-ADD*ZERO     WN0430  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YERDC   1
      *
      * Move key fields to @FJCPBO
     C                     Z-ADD#1AIC3    FJAIC3           Company Number
     C                     Z-ADD#1RMNB    FJRMNB           Load ID
      *
     C           KLCHSJ    KLIST
     C                     KFLD           FJAIC3           Company Number
     C                     KFLD           FJRMNB           Load ID
     C           KLCHSJ    CHAIN@FJCPBO              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SJEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKOMFJCPL1               91  *
     C                     GOTO SJEXIT
     C                     ENDIF                           FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YERDCS
      * Move non-key fields to @FJCPBO
     C                     Z-ADD#1FLAM    FJFLAM           Flat Amount
     C                     MOVEL#1XQST    FJXQST           Allocate Pounds
     C                     Z-ADD#1R1NB    FJR1NB           Rated Freight
     C                     Z-ADD#1TLMI    FJTLMI           Total Load Mile
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YERDCS
     C                     MOVE 'Y'       YERDC
     C                     ENDIF
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) FJAATM' defaulted for 'Job Time'.
      * Field '(DB1) FJAYNA' defaulted for 'User Id'.
      * Field '(DB1) FJA0NA' defaulted for 'Job Name'.
      * Field '(DB1) FJAXDT' defaulted for 'Job Date'.
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     FJAATM           Job Time
     C                     MOVEL##USR     FJAYNA           User Id
     C                     MOVEL##JOB     FJA0NA           Job Name
     C                     Z-ADD##JDT     FJAXDT           Job Date
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@FJCPBO                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMFJCPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
      * USER: Processing after Data update
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     ENDIF
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCHRC    BEGSR
      *================================================================
      * CHG Recovery Freight   CH - OM Load Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0431  50       Stop/Drop
     C                     MOVEL*BLANK    WN0432 30        Comments for Pi
     C                     Z-ADD*ZERO     WN0433  72       Freight Charge
     C                     Z-ADD*ZERO     WN0434  70       Actual Freight
     C                     Z-ADD*ZERO     WN0435  70       Order Number
     C                     MOVEL*BLANK    WN0436  1        Ship Status
     C                     Z-ADD*ZERO     WN0437  70       Estimated Arriv
     C                     Z-ADD*ZERO     WN0438  60       Estimated Arriv
     C                     Z-ADD*ZERO     WN0439  70       Appointment Con
     C                     Z-ADD*ZERO     WN0440  60       Appointment Con
     C                     MOVEL*BLANK    WN0441 30        Confirmation Ma
     C                     MOVEL*BLANK    WN0442 10        Confirmation Nu
     C                     Z-ADD*ZERO     WN0443  70       Actual Delivery
     C                     Z-ADD*ZERO     WN0444  60       Actual Delivery
     C                     Z-ADD*ZERO     WN0445  70       Scheduled Deliv
     C                     Z-ADD*ZERO     WN0446  60       Scheduled Deliv
     C                     Z-ADD*ZERO     WN0447  70       Unused Date 2
     C                     Z-ADD*ZERO     WN0448  60       Unused Time 2
     C                     Z-ADD*ZERO     WN0449  70       On Yard Date
     C                     Z-ADD*ZERO     WN0450  60       On Yard Time
     C                     MOVEL*BLANK    WN0451  1        EDI Status 1
     C                     MOVEL*BLANK    WN0452  1        EDI Status 2
     C                     MOVEL*BLANK    WN0453  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0454  60       Job Time
     C                     MOVEL*BLANK    WN0455 10        User Id
     C                     MOVEL*BLANK    WN0456 10        Job Name
     C                     Z-ADD*ZERO     WN0457  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YFRDC   1
      *
      * Move key fields to @FLCPBM
     C                     Z-ADD#2AIC3    FLAIC3           Company Number
     C                     Z-ADD#2RMNB    FLRMNB           Load ID
     C                     Z-ADD#2RUNB    FLRUNB           Stop/Drop Seque
      *
     C           KLCHSK    KLIST
     C                     KFLD           FLAIC3           Company Number
     C                     KFLD           FLRMNB           Load ID
     C                     KFLD           FLRUNB           Stop/Drop Seque
     C           KLCHSK    CHAIN@FLCPBM              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SKEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #2DBRC    IFNE @2DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKOMFLCPL0               91  *
     C                     GOTO SKEXIT
     C                     ENDIF                           FI #2DBRC
      * Store record data for null update check
     C                     MOVE @2DBRC    YFRDCS
      * Move non-key fields to @FLCPBM
     C                     Z-ADD#2RWNB    FLRWNB           Miles to next s
     C                     Z-ADD#2T0NB    FLT0NB           Freight Misc. C
     C                     Z-ADD#2T1NB    FLT1NB           Freight Stop Ch
     C                     Z-ADD#2R1NB    FLR1NB           Rated Freight
      *
      * Set PGM.*Record Data Changed flag
     C           @2DBRC    IFNE YFRDCS
     C                     MOVE 'Y'       YFRDC
     C                     ENDIF
      * USER: Processing before Data update
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) FLAATM' defaulted for 'Job Time'.
      * Field '(DB1) FLAYNA' defaulted for 'User Id'.
      * Field '(DB1) FLA0NA' defaulted for 'Job Name'.
      * Field '(DB1) FLAXDT' defaulted for 'Job Date'.
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     FLAATM           Job Time
     C                     MOVEL##USR     FLAYNA           User Id
     C                     MOVEL##JOB     FLA0NA           Job Name
     C                     Z-ADD##JDT     FLAXDT           Job Date
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@FLCPBM                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMFLCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@2DBRC    #2DBRC
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * RTV Program Setup      RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           DRAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0458    DRAJVN           User Profile Na
      * Establish starting position
     C           KRSSL     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SLEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDRI6ST    WUI6ST           Allow Multi-Com
     C                     MOVELDRMPNA    WUMPNA           Default Printer
     C                     MOVELDRBCCD    WUBCCD           Salesperson Cod
     C                     MOVELDRBUVN    WN0459           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Retrieve Appl. Profile - Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWN0458    DTAJVN           User Profile Na
     C                     MOVE *BLANK    DTDNCD           Application Cod
     C                     MOVEL'TRF'     DTDNCD           Application Cod
      * Establish starting position
     C           KRSSM     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WUAIC3           Company Number
     C                     MOVELDTAJCD    WUAJCD           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * Retrieve Appl. Profile - Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           DTAJVN           User Profile Na
     C                     KFLD           DTDNCD           Application Cod
      * Setup key
     C                     MOVELWN0459    DTAJVN           User Profile Na
     C                     MOVE *BLANK    DTDNCD           Application Cod
     C                     MOVEL'TRF'     DTDNCD           Application Cod
      * Establish starting position
     C           KRSSN     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDDTAIC3    WUAIC3           Company Number
     C                     MOVELDTAJCD    WUAJCD           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSO01           Application Cod
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WQSO01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSO01           Application Cod
     C                     MOVEL'TRF'     WQSO01           Application Cod
      * Establish starting position
     C           KRSSO     SETLL@DNRESF                    *
     C           KRSSO     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SPRVGN
     C                     END                             *FI
     C           KRSSO     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSP01           Application Cod
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WQSP01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSP01           Application Cod
      * Establish starting position
     C           KRSSP     SETLL@DNRESF                    *
     C           KRSSP     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SPEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSP     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * CLC Maximum Load Miles RT - OM Load Detail  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0460  50       Stop/Drop
     C                     Z-ADD*ZERO     WN0461  50       Miles to next s
     C                     Z-ADD*ZERO     WN0462  92       Mileage To Cust
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Change Log
     C                     EXSR UCSUBR                     Change Log
     C                     Z-ADD*ZERO     P5MXML           Maximum Miles
     C                     Z-ADD*ZERO     WN0460           Stop/Drop
     C                     Z-ADD*ZERO     WN0461           Miles to next s
     C                     Z-ADD99999     P5RCNB           @Number to Rank
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAIC3    WQSQ01           Company Number
     C           *LIKE     DEFN WCRMNB    WQSQ02           Load ID
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WQSQ01           Company Number
     C                     KFLD           WQSQ02           Load ID
      * Setup key
     C                     Z-ADDP1AIC3    WQSQ01           Company Number
     C                     Z-ADDP1RMNB    WQSQ02           Load ID
      * Establish starting position
     C           KRSSQ     SETLL@FLCPE8                    *
     C           KRSSQ     READE@FLCPE8                  90*
      * Data record not found
     C   90                MOVEL'USR1192' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Assumption:  1 customer per stop
      * Set up 1st stop
      * CASE: PAR.Stop/Drop NE DB1.Stop/Drop
     C           WN0460    IFNE WCRVNB                     *IF
     C                     Z-ADDWCRVNB    WN0460           Stop/Drop
      * Set 1st stop (number to rank)
      * CASE: DB1.Stop/Drop LT PAR.@Number to Rank
     C           WCRVNB    IFLT P5RCNB                     *IF
     C                     Z-ADDWCRVNB    P5RCNB           @Number to Rank
     C                     END                             *FI
     C                     END                             *FI
      * CASE: DB1.Miles to next stop GT PAR.Maximum Miles
     C           WCRWNB    IFGT P5MXML                     *IF
     C                     Z-ADDWCRWNB    P5MXML           Maximum Miles
     C                     END                             *FI
     C           KRSSQ     READE@FLCPE8                  90*
     C                     ENDDO
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * Clc Rate Per Pound     RT - OM Carrier  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           FFBZNA           Carrier Code
      * Setup key
     C                     MOVELP1XCCD    FFBZNA           Carrier Code
      * Establish starting position
     C           KRSSR     CHAIN@FFREBF              90    *
      * Data record not found
     C   90                MOVEL'USR1180' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     Z-ADDFFNPVA    P5NPVA           Rate Per Stop
      * Pounds rate
      * CASE: PAR.Total Weight LE DB1.Weight Range 1
     C           P1RPNB    IFLE FFDJWG                     *IF
     C                     Z-ADDFFB2PR    P5B2PR           Weight Rate 1
     C                     ELSE
      * CASE: PAR.Total Weight LE DB1.Weight Range 2
     C           P1RPNB    IFLE FFDKWG                     *IF
     C                     Z-ADDFFB3PR    P5B2PR           Weight Rate 1
     C                     ELSE
      * CASE: PAR.Total Weight LE DB1.Weight Range 3
     C           P1RPNB    IFLE FFDLWG                     *IF
     C                     Z-ADDFFB4PR    P5B2PR           Weight Rate 1
     C                     ELSE
      * CASE: PAR.Total Weight LE DB1.Weight Range 4
     C           P1RPNB    IFLE FFDMWG                     *IF
     C                     Z-ADDFFB5PR    P5B2PR           Weight Rate 1
     C                     ELSE
      * CASE: PAR.Total Weight LE DB1.Weight Range 5
     C           P1RPNB    IFLE FFDNWG                     *IF
     C                     Z-ADDFFB6PR    P5B2PR           Weight Rate 1
     C                     ELSE
      * CASE: PAR.Total Weight LE DB1.Weight Range 6
     C           P1RPNB    IFLE FFDOWG                     *IF
     C                     Z-ADDFFB7PR    P5B2PR           Weight Rate 1
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Compute rated freight
      *================================================================
      * Compute ratio
      * CASE: CTL.Total Weight EQ WRK.ZERO
     C           #1RPNB    IFEQ WUW0NB                     *IF
     C                     Z-ADD*ZERO     P5CFPC           @Percent 9/6
     C                     ELSE
      * CASE: *OTHERWISE
     C           #RAYWG    DIV  #1RPNB    P5CFPC    H      @Percent 9/6
     C                     END                             *FI
      * Compute Rated Freight
      * PGM.*Synon (17,5) work field =
      *    *COMPUTE (((x1 * x2) + x3 + x4))
      * x1    : PAR.@Percent 9/6
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CTL.Total Base Cost
      * +     : PGM.*Synon (17,7) work field
      * x3    : DB2.Freight Misc. Charge
      * +     : PGM.*Synon (17,7) work field
      * x4    : PAR.Freight Stop Charge
     C           P5CFPC    MULT #CTLNB    W0WD02    H      *Synon (17,7) w
     C           W0WD02    ADD  FLT0NB    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  P5T1NB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    W0WC             *Synon (17,5) w
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Compute rated freight
      *================================================================
      * Compute ratio
      * CASE: CTL.Total Weight EQ WRK.ZERO
     C           #1RPNB    IFEQ WUW0NB                     *IF
     C                     Z-ADD*ZERO     P5CFPC           @Percent 9/6
     C                     ELSE
      * CASE: *OTHERWISE
     C           #RAYWG    DIV  #1RPNB    P5CFPC    H      @Percent 9/6
     C                     END                             *FI
      * Compute Rated Freight
      * PGM.*Synon (17,5) work field =
      *    *COMPUTE (((x1 * x2) + x3 + x4))
      * x1    : PAR.@Percent 9/6
      * *     : PGM.*Synon (17,7) work field *Rounded
      * x2    : CTL.Total Base Cost
      * +     : PGM.*Synon (17,7) work field
      * x3    : DB2.Freight Misc. Charge
      * +     : PGM.*Synon (17,7) work field
      * x4    : PAR.Freight Stop Charge
     C           P5CFPC    MULT #CTLNB    W0WD02    H      *Synon (17,7) w
     C           W0WD02    ADD  FLT0NB    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  P5T1NB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    W0WC             *Synon (17,5) w
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Change Log
      *================================================================
      * OMS186 2/12/97 PLL
      *    changed so use Miles to Next Stop instead of retrieving mileag
      *    customer from co/cust file.
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#1AIC3'
     C           YPMTFD    OREQ '#1RMNB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1AIC3' defaulted for 'Company Number'.
      * Field '(CTL) #1RMNB' defaulted for 'Load ID'.
     C                     CALL 'PDJHSRR'              90  SEL Locked/Ship
     C                     PARM *BLANK    W0RTN   7
     C           #1AIC3    PARM #1AIC3    WQ0010  30       Company Number
     C           #1RMNB    PARM #1RMNB    WQ0011  70       Load ID
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDJHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1RMNB    IFNE *ZERO                      Load ID
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Calendar
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1AODT    IFEQ *ZERO                      Post to G/L Dat
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBAF    KLIST
     C                     KFLD           AFAIC3           Company Number
     C                     KFLD           AFBCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADD#1AIC3    AFAIC3
     C                     Z-ADD#1AODT    AFBCDT
     C           KLVBAF    CHAIN@AFREBE              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Calendar not found'
     C                     MOVEL'USR0018' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0018' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to OM Carrier
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BZNA    WK1X01  1
     C           WK1X01    IFEQ '?'                        Carrier Code
     C           YPMTFD    OREQ '#1BZNA'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1BZNA' defaulted for 'Carrier Code'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #CADTX' defaulted for 'Name'.
     C                     CALL 'PDWHSRR'              90  SEL Carrier Nam
     C                     PARM *BLANK    W0RTN   7
     C           #1BZNA    PARM #1BZNA    WQ0018  3        Carrier Code
     C           #CADTX    PARM *BLANK    WQ0019 30        Name
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDWHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1BZNA    IFNE *BLANK                     Carrier Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BZNA    IFEQ *BLANK                     Carrier Code
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCFF    KLIST
     C                     KFLD           FFBZNA           Carrier Code
      * Setup key
     C                     MOVEL#1BZNA    FFBZNA
     C           KLVCFF    CHAIN@FFREBF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'OM Carrier             NF'
     C                     MOVEL'USR1180' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1180' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to OM Truck Size
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1RONB    WK1X01  1
     C           WK1X01    IFEQ '?'                        Truck Size
     C           YPMTFD    OREQ '#1RONB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1RONB' defaulted for 'Truck Size'.
     C                     CALL 'PDEPSRR'              90  SEL Truck Size
     C                     PARM *BLANK    W0RTN   7
     C           #1RONB    PARM #1RONB    WQ0020  7        Truck Size
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDEPSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1RONB    IFNE *BLANK                     Truck Size
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1RONB    IFEQ *BLANK                     Truck Size
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDFK    KLIST
     C                     KFLD           FKRONB           Truck Size
      * Setup key
     C                     MOVEL#1RONB    FKRONB
     C           KLVDFK    CHAIN@FKREBT              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'OM Truck Size          NF'
     C                     MOVEL'USR1190' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1190' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         VECKRL    BEGSR
      *================================================================
      * Check reference to Calendar
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1HADT    IFEQ *ZERO                      Post to G/L Dat
     C                     GOTO VEEXIT
     C                     END
      *
     C           KLVEAF    KLIST
     C                     KFLD           AFAIC3           Company Number
     C                     KFLD           AFBCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADD#1AIC3    AFAIC3
     C                     Z-ADD#1HADT    AFBCDT
     C           KLVEAF    CHAIN@AFREBE              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VEEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VEEXIT
     C                     END
      * Send message 'Calendar not found'
     C                     MOVEL'USR0018' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0018' W0RTN
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         VFCKRL    BEGSR
      *================================================================
      * Check reference to Calendar
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1AQDT    IFEQ *ZERO                      Post to G/L Dat
     C                     GOTO VFEXIT
     C                     END
      *
     C           KLVFAF    KLIST
     C                     KFLD           AFAIC3           Company Number
     C                     KFLD           AFBCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADD#1AIC3    AFAIC3
     C                     Z-ADD#1AQDT    AFBCDT
     C           KLVFAF    CHAIN@AFREBE              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VFEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VFEXIT
     C                     END
      * Send message 'Calendar not found'
     C                     MOVEL'USR0018' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0018' W0RTN
      *================================================================
     CSR         VFEXIT    ENDSR
      /EJECT
     CSR         VGCKRL    BEGSR
      *================================================================
      * Check reference to Warehouse
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1VPCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Warehouse Code
     C           YPMTFD    OREQ '#1VPCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1VPCD' defaulted for 'Ship From Warehouse'.
     C                     CALL 'PDL4SRR'              90  SEL Non-Prod Wh
     C                     PARM *BLANK    W0RTN   7
     C           #1VPCD    PARM #1VPCD    WQ0021  3        Warehouse Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL4SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1VPCD    IFNE *BLANK                     Warehouse Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VGEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1VPCD    IFEQ *BLANK                     Warehouse Code
     C                     GOTO VGEXIT
     C                     END
      *
     C           KLVGAD    KLIST
     C                     KFLD           ADAJCD           Warehouse Code
      * Setup key
     C                     MOVEL#1VPCD    ADAJCD
     C           KLVGAD    CHAIN@ADREAO              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VGEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VGEXIT
     C                     END
      * Send message 'Warehouse              NF'
     C                     MOVEL'USR0007' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0007' W0RTN
      *================================================================
     CSR         VGEXIT    ENDSR
      /EJECT
     CSR         VHCKRL    BEGSR
      *================================================================
      * Check reference to State
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1DBCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        State Code
     C           YPMTFD    OREQ '#1DBCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1DBCD' defaulted for 'Ship To State Code'.
     C                     CALL 'CAAHSRR'              90  SEL State
     C                     PARM *BLANK    W0RTN   7
     C           #1DBCD    PARM #1DBCD    WQ0022  2        State Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'CAAHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1DBCD    IFNE *BLANK                     State Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VHEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1DBCD    IFEQ *BLANK                     State Code
     C                     GOTO VHEXIT
     C                     END
      *
     C           KLVHAC    KLIST
     C                     KFLD           ACBGCD           State Code
      * Setup key
     C                     MOVEL#1DBCD    ACBGCD
     C           KLVHAC    CHAIN@ACREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VHEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VHEXIT
     C                     END
      * Send message 'State                  NF'
     C                     MOVEL'USR0005' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0005' W0RTN
      *================================================================
     CSR         VHEXIT    ENDSR
      /EJECT
     CSR         VICKRL    BEGSR
      *================================================================
      * Check reference to OM Carrier
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1XCCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Carrier Code
     C           YPMTFD    OREQ '#1XCCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1XCCD' defaulted for 'Carrier Broker'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #CADTX' defaulted for 'Name'.
     C                     CALL 'PDWHSRR'              90  SEL Carrier Nam
     C                     PARM *BLANK    W0RTN   7
     C           #1XCCD    PARM #1XCCD    WQ0023  3        Carrier Code
     C           #CADTX    PARM *BLANK    WQ0024 30        Name
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDWHSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1XCCD    IFNE *BLANK                     Carrier Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VIEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1XCCD    IFEQ *BLANK                     Carrier Code
     C                     GOTO VIEXIT
     C                     END
      *
     C           KLVIFF    KLIST
     C                     KFLD           FFBZNA           Carrier Code
      * Setup key
     C                     MOVEL#1XCCD    FFBZNA
     C           KLVIFF    CHAIN@FFREBF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VIEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VIEXIT
     C                     END
      * Send message 'OM Carrier             NF'
     C                     MOVEL'USR1180' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1180' W0RTN
      *================================================================
     CSR         VIEXIT    ENDSR
      /EJECT
     CSR         VJCKRL    BEGSR
      *================================================================
      * Check reference to PD Shipping Line/Port
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1XACD    WK1X01  1
     C                     MOVEL#1OANA    WK1X02  1
     C           WK1X01    IFEQ '?'                        Shipping Line
     C           YPMTFD    OREQ '#1XACD'
     C           WK1X02    OREQ '?'                        Sail Port City
     C           YPMTFD    OREQ '#1OANA'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1XACD' defaulted for 'Shipping Line'.
      * Field '(CTL) #1OANA' defaulted for 'Sail Port City'.
     C                     CALL 'PDUMSRR'              90  SEL Shipping Li
     C                     PARM *BLANK    W0RTN   7
     C           #1XACD    PARM #1XACD    WQ0025  3        Shipping Line
     C           #1OANA    PARM #1OANA    WQ0026 20        Sail Port City
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDUMSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1XACD    IFNE *BLANK                     Shipping Line
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1OANA    IFNE *BLANK                     Sail Port City
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VJEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1XACD    IFEQ *BLANK                     Shipping Line
     C           #1OANA    ANDEQ*BLANK                     Sail Port City
     C                     GOTO VJEXIT
     C                     END
      *
     C           KLVJLC    KLIST
     C                     KFLD           LCXACD           Shipping Line
     C                     KFLD           LCOANA           Sail Port City
      * Setup key
     C                     MOVEL#1XACD    LCXACD
     C                     MOVEL#1OANA    LCOANA
     C           KLVJLC    CHAIN@LCREL2              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VJEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VJEXIT
     C                     END
      * Send message 'PD Shipping Line/Port  NF'
     C                     MOVEL'USR2419' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR2419' W0RTN
      *================================================================
     CSR         VJEXIT    ENDSR
      /EJECT
     CSR         VKCKRL    BEGSR
      *================================================================
      * Check reference to Warehouse
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1AJCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Warehouse Code
     C           YPMTFD    OREQ '#1AJCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1AJCD' defaulted for 'Warehouse Code'.
     C                     CALL 'PDL4SRR'              90  SEL Non-Prod Wh
     C                     PARM *BLANK    W0RTN   7
     C           #1AJCD    PARM #1AJCD    WQ0027  3        Warehouse Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL4SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AJCD    IFNE *BLANK                     Warehouse Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VKEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1AJCD    IFEQ *BLANK                     Warehouse Code
     C                     GOTO VKEXIT
     C                     END
      *
     C           KLVKAD    KLIST
     C                     KFLD           ADAJCD           Warehouse Code
      * Setup key
     C                     MOVEL#1AJCD    ADAJCD
     C           KLVKAD    CHAIN@ADREAO              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VKEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VKEXIT
     C                     END
      * Send message 'Warehouse              NF'
     C                     MOVEL'USR0007' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0007' W0RTN
      *================================================================
     CSR         VKEXIT    ENDSR
      /EJECT
     CSR         VLCKRL    BEGSR
      *================================================================
      * Check reference to PD Order Header
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVELV2C4NB    WK1X02  1
     C           WK1X02    IFEQ '?'                        Order Number
     C           YPMTFD    OREQ '#2C4NB'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #2AIC3' defaulted for 'Company Number'.
      * Field '(RCD) #2C4NB' defaulted for 'Order Number'.
     C                     CALL 'PDPMSRR'              90  SEL Ord Avail O
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0031  30       Company Number
     C           #2C4NB    PARM #2C4NB    WQ0032  70       Order Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDPMSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      *
     C           #2C4NB    IFNE *ZERO                      Order Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VLEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #2C4NB    IFEQ *ZERO                      Order Number
     C                     GOTO VLEXIT
     C                     END
      *
     C           KLVLBE    KLIST
     C                     KFLD           BEAIC3           Company Number
     C                     KFLD           BEC4NB           Order Number
      * Setup key
     C                     Z-ADD#2AIC3    BEAIC3
     C                     Z-ADD#2C4NB    BEC4NB
     C           KLVLBE    CHAIN@BECPFK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VLEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VLEXIT
     C                     END
      * Send message 'PD Order Header        NF'
     C                     MOVEL'USR0176' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0176' W0RTN
      *================================================================
     CSR         VLEXIT    ENDSR
      /EJECT
     CSR         VMCKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C           YPMTFD    IFEQ '#1AIC3'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #2AIC3' defaulted for 'Company Number'.
     C                     CALL 'PDL7SRR'              90  SEL Co - Rtn 0
     C                     PARM *BLANK    W0RTN   7
     C           #2AIC3    PARM #2AIC3    WQ0033  30       Company Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDL7SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AIC3    IFNE *ZERO                      Company Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VM999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVMAB    KLIST
     C                     KFLD           ABAIC3           Company Number
      * Setup key
     C                     Z-ADD#1AIC3    ABAIC3
     C           KLVMAB    CHAIN@ABREAK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VMEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VMEXIT
     C                     END
     C           VM999     TAG
      * Restrictor relation not satisfied
      * Send message 'Company Name and Addre NF'
     C                     MOVEL'USR0003' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'USR0003' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VMEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD017       ZHSTRW  40
     C                     Z-ADD021       ZHNDRW  40
     C                     Z-ADD001       ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           ZHCSRW    IFEQ 007
     C           ZHCSCL    ANDEQ077
     C           @#DFMT    ANDEQ'#SFLCTL'
     C                     MOVEL'#1XQST'  YPMTFD           Allocate Pounds
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
      * USER: Exit program processing
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     GOTO ZXEXIT                     *QUIT
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2NMVA           Flat Rate
     C                     Z-ADD*ZERO     P3CNTU           Count USR
     C                     Z-ADD*ZERO     P4RUNB           Stop/Drop Seque
     C                     Z-ADD*ZERO     P4RVNB           Stop/Drop
     C                     Z-ADD*ZERO     P5CFPC           @Percent 9/6
     C                     Z-ADD*ZERO     P5T1NB           Freight Stop Ch
     C                     Z-ADD*ZERO     P5ZONB           USR Orders on S
     C                     Z-ADD*ZERO     P5D8WG           USR Stop Total
     C                     Z-ADD*ZERO     P5AYWG           USR Order Weigh
     C                     Z-ADD*ZERO     P5RAFR           @Rated Freight
     C                     Z-ADD*ZERO     P5TMNB           Total Stops Cos
     C                     Z-ADD*ZERO     P5RCNB           @Number to Rank
     C                     Z-ADD*ZERO     P5MXML           Maximum Miles
     C                     Z-ADD*ZERO     P5TKNB           Total Miles
     C                     Z-ADD*ZERO     P5NPVA           Rate Per Stop
     C                     Z-ADD*ZERO     P5BQPR           Mile Rate 1
     C                     Z-ADD*ZERO     P5B2PR           Weight Rate 1
     C                     MOVEL*BLANK    P6R4ST           USR Update Flag
      *
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field First Time Flag
     C                     MOVEL*BLANK    WUTAST  1
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Record Status
     C                     MOVEL*BLANK    WUVSST  1
      * Define work field Numeric Field Not Needed
     C                     Z-ADD*ZERO     WUNFNN  70
      * Define work field ZERO
     C                     Z-ADD*ZERO     WUW0NB 305
      * Define work field Adjustment Amount
     C                     Z-ADD*ZERO     WUAIVA 112
      * Define work field USR Adjustment Amount 1
     C                     Z-ADD*ZERO     WUICVA 112
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Define work field USR First Position
     C                     MOVEL*BLANK    WUI3ST  1
      * Define work field Warehouse Code
     C                     MOVEL*BLANK    WUAJCD  3
      * Define work field Company Number
     C                     Z-ADD*ZERO     WUAIC3  30
      * Define work field Salesperson Code
     C                     MOVEL*BLANK    WUBCCD  3
      * Define work field Allow Multi-Company
     C                     MOVEL*BLANK    WUI6ST  1
      * Define work field Default Printer
     C                     MOVEL*BLANK    WUMPNA 10
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WB   155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WD01 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD02 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WC   175       *Synon (17,5) w
     C                     Z-ADD*ZEROS    W0WE   179       *Synon (17,9) w
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      * Subfile page size
     C                     Z-ADD05        ##SFPG  30       SFLPAG
      * Initialise subfile positioner
     C                     Z-ADD1         ##SFRC
      *
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Clear all neither parameters
     C                     MOVEL*BLANK    WN0458 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0458           User Profile Na
      * Clear all neither parameters
     C                     MOVEL*BLANK    WN0459 10        User Code Model
      *
      * VAL User/Application   IF
      * RTV Program Setup      RT - User Profile Control  * 
     C                     EXSR SLRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Set Message Queue Dest. - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0458    ZA0002           User Profile Na
     C                     MOVEL'TRF'     ZA0003           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0459    IFEQ *BLANK                     *IF
      * Retrieve Appl. Profile - Application Profile  * 
     C                     EXSR SMRVGN
     C                     ELSE
      * CASE: *OTHERWISE
      * Retrieve Appl. Profile - Application Profile  * 
     C                     EXSR SNRVGN
     C                     END                             *FI
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Set Message Queue Dest. - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0458    ZA0004           User Profile Na
     C                     MOVEL'TRF'     ZA0005           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SORVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * Center Txt String 40 - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * Move Appl Desc to Co Head - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP
     C                     MOVEL'Y'       WUTAST           First Time Flag
     C                     MOVEL*BLANK    P6R4ST           USR Update Flag
      * CLC Maximum Load Miles RT - OM Load Detail  * 
     C                     EXSR SQRVGN
      * Clc Rate Per Pound     RT - OM Carrier  * 
     C                     EXSR SRRVGN
      * RTV Last Load Dtl Seq  XF - OM Load Detail  * 
     C                     CALL 'PDYBXFR'              90  RTV Last Load D
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1AIC3    WQ0034  30       Company Number
     C                     PARM P1RMNB    WQ0035  70       Load ID
     C           P4RUNB    PARM *ZERO     WQ0036  50       Stop/Drop Seque
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDYBXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      *****************************************************************
      *================================================================
     CSR         ZZEXIT    ENDSR
