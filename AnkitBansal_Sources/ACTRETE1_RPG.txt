     H/TITLE Rtv Acct C/O/S/D   E1 XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7 (1632)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : E1IDEVMDL
     H* System        : E1IDEVMDL
     H* User name     : ISRCENT
     H* Date          : 11/14/21  Time  : 10:46:37
     H* Copyright     : E1IDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FE10901LA  IF   E           K DISK
      * RSQ : Account Master     F0901  Account ID     (Primary)
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              8
     D  WP0002         S             50
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  WQSA01         S                   LIKE(WAAID)
     D  WQ0001         S             12
     D  WQ0002         S              6
     D  WQ0003         S              8
     D  WQ0004         S             30
     D  WQ0005         S             50
     D  W0CLPG         S             10
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * I :  Account ID
     D  P1AID                  1      8
     D P2PARM          DS
      * O :  CC + Obj + Subs + Desc 50
     D  P2MXTX                 1     50
     D                 DS
     D  ZAMSDA                 1    132
     II0901LA
      * Account Master     F0901  Account ID     (Primary)
      * Renamed input format fields
     I              GMCO                        WACO
     I              GMAID                       WAAID
     I              GMMCU                       WAMCU
     I              GMOBJ                       WAOBJ
     I              GMSUB                       WASUB
     I              GMANS                       WAANS
     I              GMDL01                      WADL01
     I              GMLDA                       WALDA
     I              GMBPC                       WABPC
     I              GMPEC                       WAPEC
     I              GMBILL                      WABILL
     I              GMCRCD                      WACRCD
     I              GMUM                        WAUM
     I              GMR001                      WAR001
     I              GMR002                      WAR002
     I              GMR003                      WAR003
     I              GMR004                      WAR004
     I              GMR005                      WAR005
     I              GMR006                      WAR006
     I              GMR007                      WAR007
     I              GMR008                      WAR008
     I              GMR009                      WAR009
     I              GMR010                      WAR010
     I              GMR011                      WAR011
     I              GMR012                      WAR012
     I              GMR013                      WAR013
     I              GMR014                      WAR014
     I              GMR015                      WAR015
     I              GMR016                      WAR016
     I              GMR017                      WAR017
     I              GMR018                      WAR018
     I              GMR019                      WAR019
     I              GMR020                      WAR020
     I              GMR021                      WAR021
     I              GMR022                      WAR022
     I              GMR023                      WAR023
     I              GMOBJA                      WAOBJA
     I              GMSUBA                      WASUBA
     I              GMWCMP                      WAWCMP
     I              GMCCT                       WACCT
     I              GMERC                       WAERC
     I              GMHTC                       WAHTC
     I              GMQLDA                      WAQLDA
     I              GMCCC                       WACCC
     I              GMFMOD                      WAFMOD
     I              GMUSER                      WAUSER
     I              GMPID                       WAPID
     I              GMJOBN                      WAJOBN
     I              GMUPMJ                      WAUPMJ
     I              GMUPMT                      WAUPMT
     I              GMCEC1                      WACEC1
     I              GMCEC2                      WACEC2
     I              GMCEC3                      WACEC3
     I              GMCEC4                      WACEC4
     I              GMIEC                       WAIEC
     I              GMFPEC                      WAFPEC
     I              GMSTPC                      WASTPC
     I              GMTXGL                      WATXGL
     I              GMTOBJ                      WATOBJ
     I              GMTSUB                      WATSUB
     I              GMPRGF                      WAPRGF
     I              GMTXA1                      WATXA1
     I              GMR024                      WAR024
     I              GMR025                      WAR025
     I              GMR026                      WAR026
     I              GMR027                      WAR027
     I              GMR028                      WAR028
     I              GMR029                      WAR029
     I              GMR030                      WAR030
     I              GMR031                      WAR031
     I              GMR032                      WAR032
     I              GMR033                      WAR033
     I              GMR034                      WAR034
     I              GMR035                      WAR035
     I              GMR036                      WAR036
     I              GMR037                      WAR037
     I              GMR038                      WAR038
     I              GMR039                      WAR039
     I              GMR040                      WAR040
     I              GMR041                      WAR041
     I              GMR042                      WAR042
     I              GMR043                      WAR043
     I              GMADJE                      WAADJE
     I              GMUAFL                      WAUAFL
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1AID         PARM                    WP0001                         Account ID
     C     P2MXTX        PARM      P2MXTX        WP0002                         CC + Obj + Subs
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Rtv Acct C/O/S/D   E1 XF
      * Modification history
     C                   EXSR      UASUBR                                       Modification hi
      * Rtv Acct C/O/S/D   E1 RT - Account Master     F0901  * 
     C                   EXSR      SARVGN
      * RMC ADDED THIS TO KEEP THE RETURN CODE SET   11-14-21
     C                   MOVEL     W0RTN         P0RTN                          *Return code
     C                   EXSR      ZYEXPG
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Acct C/O/S/D   E1 RT - Account Master     F0901  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WQSA01                         Account ID
      * Setup key
     C                   MOVEL     P1AID         WQSA01                         Account ID
      * Establish starting position
     C     KRSSA         SETLL     I0901LA                                      *
     C     KRSSA         READE     I0901LA                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0096'     W0RTN
      * USER: Processing if Data record not found
     C                   EVAL      W0RTN = ' '                                  *Return code
     C                   MOVEL     'ERR'         W0RTN                          *Return code
     C                   GOTO      SAEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * Rtv CC/Obj/Sub/Dsc 50 UP - Account Master     F0901  * 
     C                   DOW       NOT *IN90
     C                   CALL      'ACTRETUP'                           90      Rtv CC/Obj/Sub/
     C                   PARM      WAMCU         WQ0001                         Business Unit/C
     C                   PARM      WAOBJ         WQ0002                         Object Account
     C                   PARM      WASUB         WQ0003                         Subsidiary
     C                   PARM      WADL01        WQ0004                         Description
     C     P2MXTX        PARM      *BLANK        WQ0005                         CC + Obj + Subs
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'ACTRETUP'    W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C     KRSSA         READE     I0901LA                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   UASUBR        BEGSR
      *================================================================
      * Modification history
      *================================================================
      *  3/17/2020 JBB P16169 - JDE World to JDE Enterprise 1
      *                SDN465   Function created.  This function
      *                         retrieves the JDE Account Cost Center,
      *                         Object, Subsidiary, and Description.
      *                         The values are passed back to the calling
      *                         program in a 50-byte character text.
      *================================================================
     CSR   UAEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WAUPMT                         Time - Last Upd
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
