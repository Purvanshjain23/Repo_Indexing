// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVJAXFR
// ?Date: 14.08.2025 Time: 03:52:18
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Creation & Modification log
DO;

//?S022945 JM 01/17/25-Update consignee address line 3 or 4.
//?This will fix export order for city/state swap.
ENDDO;

EXECUTE FUNCTION(Rtv/Chg Consignee Fix  RT) TYPE(RTVOBJ) FILE(PDMRREP)          AC2239628;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.ED_Export_Document_Type);
PARAMETER(PAR.Country_Code);
PARAMETER(PAR.Edit_Or_Update_Mode);
PARAMETER(PAR.Print_Yes_No_USR);
{
 //?USER: Process Data record

 // LCL.Consignee Chg Y/N Usr = CND.no
 LCL.Consignee_Chg_Y_N_Usr = 'N';

 // PAR.Consignee Address Line 3 = CND.Blank
 PAR.Consignee_Address_Line_3 = *BLANK;

 // PAR.Consignee Address Ln4City = CND.Blank
 PAR.Consignee_Address_Ln4City = *BLANK;

 EXECUTE FUNCTION(Rtv Consignee for Fix RT) TYPE(RTVOBJ) FILE(POA2REP)           AC2239629;
 PARAMETER('E');
 PARAMETER(DB1.ED_Consignee_Name);
 PARAMETER(DB1.ED_Consignee_Addr_1);
 PARAMETER(LCL.Consignee_Address_Line_3);
 PARAMETER(LCL.Consignee_Address_Ln4City);
 PARAMETER(DB1.ED_Consignee_Postal);
 PARAMETER(DB1.ED_Consignee_Country_Code);
 {
  //?USER: Initialize routine

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  CASE;

  // IF PAR.Consignee Postal EQ DB1.Consignee Postal
  IF PAR.Consignee_Postal = DB1.Consignee_Postal;

  // OR PAR.Address Country Code EQ DB1.Address Country Code
  OR PAR.Address_Country_Code = DB1.Address_Country_Code;

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

  ENDIF;

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 //?Get Consignee address line 3
 CASE;

 // IF LCL.Consignee Address Line 3 NE DB1.ED Consignee Addr 3
 IF LCL.Consignee_Address_Line_3 <> DB1.ED_Consignee_Addr_3;

 // LCL.Consignee Chg Y/N Usr = CND.yes
 LCL.Consignee_Chg_Y_N_Usr = 'Y';

 // PAR.Consignee Address Line 3 = LCL.Consignee Address Line 3
 PAR.Consignee_Address_Line_3 = LCL.Consignee_Address_Line_3;

 ENDIF;

 //?Get Consignee address line 4
 CASE;

 // IF LCL.Consignee Address Ln4City NE DB1.ED Consignee Addr 4
 IF LCL.Consignee_Address_Ln4City <> DB1.ED_Consignee_Addr_4;

 // AND LCL.Consignee Address Ln4City is Not Blank
 AND LCL.Consignee_Address_Ln4City <> *BLANK;

 // LCL.Consignee Chg Y/N Usr = CND.yes
 LCL.Consignee_Chg_Y_N_Usr = 'Y';

 // PAR.Consignee Address Ln4City = LCL.Consignee Address Ln4City
 PAR.Consignee_Address_Ln4City = LCL.Consignee_Address_Ln4City;

 //?Get Consignee address line 4
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Consignee Address Ln4City = DB1.ED Consignee Addr 4
 PAR.Consignee_Address_Ln4City = DB1.ED_Consignee_Addr_4;

 ENDIF;

 //?Update Consignee if applicable
 CASE;

 // IF LCL.Consignee Chg Y/N Usr is yes
 IF LCL.Consignee_Chg_Y_N_Usr = 'Y';

 //?Print report for first doc type only
 CASE;

 // IF PAR.Print (Yes/No) USR is Yes
 IF PAR.Print_Yes_No_USR = 'Y';

 // Call program PRT Fix Consignee Addr XF.
 CALL PROGRAM(PRT Fix Consignee Addr XF) ('PVJEPFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.ED_Export_Document_Type);
 PARAMETER(DB1.Country_Code);
 PARAMETER(PAR.Consignee_Address_Line_3);
 PARAMETER(PAR.Consignee_Address_Ln4City);

 ENDIF;

 CASE;

 // IF PAR.Edit Or Update Mode is Update
 IF PAR.Edit_Or_Update_Mode = 'U';

 EXECUTE FUNCTION(Chg Exp Doc Consignee  CH) TYPE(CHGOBJ) FILE(PDMRREP)          AC1611424;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.ED_Export_Document_Type);
 PARAMETER(DB1.Country_Code);
 PARAMETER(DB1.ED_Consignor_Name);
 PARAMETER(DB1.ED_Consignor_Addr_1);
 PARAMETER(DB1.ED_Consignor_Addr_2);
 PARAMETER(DB1.ED_Consignor_Addr_3);
 PARAMETER(DB1.ED_Consignor_Addr_4);
 PARAMETER(DB1.ED_Consignor_State);
 PARAMETER(DB1.ED_Consignor_Postal);
 PARAMETER(DB1.ED_Consignor_Country_Code);
 PARAMETER(DB1.ED_Consignee_Name);
 PARAMETER(DB1.ED_Consignee_Addr_1);
 PARAMETER(DB1.ED_Consignee_Addr_2);
 PARAMETER(PAR.Consignee_Address_Line_3);
 PARAMETER(PAR.Consignee_Address_Ln4City);
 PARAMETER(DB1.ED_Consignee_State);
 PARAMETER(DB1.ED_Consignee_Postal);
 PARAMETER(DB1.ED_Consignee_Country_Code);
 PARAMETER(DB1.ED_Shipping_Marks_Txt);
 PARAMETER(DB1.ED_Remark_Constant_1);
 PARAMETER(DB1.ED_Remark_Constant_2);
 PARAMETER(DB1.ED_Remark_Constant_3);
 PARAMETER(DB1.ED_Remark_Constant_4);
 PARAMETER(DB1.ED_Remark_Constant_5);
 PARAMETER(DB1.ED_Remark_Constant_7);
 PARAMETER(DB1.ED_Remark_Constant_8);
 PARAMETER(DB1.ED_Remark_Constant_6);
 PARAMETER(DB1.ED_Consignee_Address_Nbr);
 PARAMETER(DB1.ED_Form_Identification_Tx);
 PARAMETER(DB1.ED_Cold_Storage_Name);
 PARAMETER(DB1.ED_Cold_Storage_Addr_1);
 PARAMETER(DB1.ED_Cold_Storage_Addr_2);
 PARAMETER(DB1.ED_Cold_Storage_Plant_Nbr);
 PARAMETER(DB1.ED_Slaughter_Date_CofE_1);
 PARAMETER(DB1.ED_Production_mo_yr_ln_1);
 PARAMETER(DB1.ED_Production_mo_yr_ln_2);
 PARAMETER(DB1.ED_Booking_Nbr);
 PARAMETER(DB1.ED_MPR_Canadian_Province);
 PARAMETER(DB1.ED_Submit_Status);
 PARAMETER(DB1.EDOH_Unused_Sts_2);
 PARAMETER(DB1.EDOH_Unused_Text_1);
 PARAMETER(DB1.EDOH_Unused_Text_2);
 PARAMETER(DB1.EDOH_Unused_Number_1);
 PARAMETER(DB1.EDOH_Unused_Date_1);
 {
  //?USER: Processing after Data read

  //?* E00994 Susan Mason
  //?* these functions will execute the new routines
  //?* that will create records to the comment file
  //?* if the consignee or consignor changed
  CASE;

  // IF DB1.ED Export Document Type is MPD
  IF DB1.ED_Export_Document_Type = 'H';

  // OR DB1.ED Export Document Type is 9290/9285/9295/9115/9450
  OR DB1.ED_Export_Document_Type = 'E';

  //?R16637 DN 09/11/20-Pass in New Consignor/Consignee Fields.
  // Call program Rtv/Consignor/ConsigneXF.
  CALL PROGRAM(Rtv/Consignor/ConsigneXF) ('PNVIXFR');
  PARAMETER(JOB.*PROGRAM);
  PARAMETER(DB1.ED_Consignor_Name);
  PARAMETER(DB1.ED_Consignor_Addr_1);
  PARAMETER(DB1.ED_Consignor_Addr_2);
  PARAMETER(DB1.ED_Consignor_Addr_3);
  PARAMETER(DB1.ED_Consignor_Addr_4);
  PARAMETER(DB1.ED_Consignor_State);
  PARAMETER(DB1.ED_Consignor_Postal);
  PARAMETER(DB1.ED_Consignor_Country_Code);
  PARAMETER(DB1.ED_Consignee_Name);
  PARAMETER(DB1.ED_Consignee_Addr_1);
  PARAMETER(DB1.ED_Consignee_Addr_2);
  PARAMETER(DB1.ED_Consignee_Addr_3);
  PARAMETER(DB1.ED_Consignee_Addr_4);
  PARAMETER(DB1.ED_Consignee_State);
  PARAMETER(DB1.ED_Consignee_Postal);
  PARAMETER(DB1.ED_Consignee_Country_Code);
  PARAMETER(PAR.Company_Number);
  PARAMETER(PAR.Order_Number);
  PARAMETER(PAR.ED_Export_Document_Type);
  PARAMETER(PAR.Country_Code);
  PARAMETER(PAR.ED_Area_Office);
  PARAMETER(PAR.ED_Destination);
  PARAMETER(PAR.ED_Consignor_Name);
  PARAMETER(PAR.ED_Consignor_Addr_1);
  PARAMETER(PAR.ED_Consignor_Addr_2);
  PARAMETER(PAR.ED_Consignor_Addr_3);
  PARAMETER(PAR.ED_Consignor_Addr_4);
  PARAMETER(PAR.ED_Consignor_State);
  PARAMETER(PAR.ED_Consignor_Postal);
  PARAMETER(PAR.ED_Consignor_Country_Code);
  PARAMETER(PAR.ED_Consignee_Name);
  PARAMETER(PAR.ED_Consignee_Addr_1);
  PARAMETER(PAR.ED_Consignee_Addr_2);
  PARAMETER(PAR.ED_Consignee_Addr_3);
  PARAMETER(PAR.ED_Consignee_Addr_4);
  PARAMETER(PAR.ED_Consignee_State);
  PARAMETER(PAR.ED_Consignee_Postal);
  PARAMETER(PAR.ED_Consignee_Country_Code);

  ENDIF;

  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 ENDIF;

 ENDIF;

}


