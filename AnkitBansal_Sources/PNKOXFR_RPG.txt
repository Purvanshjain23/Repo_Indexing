     H/TITLE Clc Transfer Price    XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 04/05/17  Time  : 08:48:47
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPNF4REL1IF  E           K        DISK
      * RTV : IP Cust Pricing Dtl       Retrieval index
      *
     FOMHSTPO6IF  E           K        DISK
      * RSQ : Sales History             Itm/ASD-d/Co/Ord RegSls
      *
     FPDKMREL1IF  E           K        DISK
      * RTV : Company Values            Retrieval index
      *
      * Long constants
     E                    @CN#    1  01  6   @CN    25
     I@F4REFS
      * IP Cust Pricing Dtl       Retrieval index
      * Renamed input format fields
     I              F4BKC7                          WABKC7
     I              F4MMAA                          WAMMAA
     I              F4MKAA                          WAMKAA
     I              F4MLAA                          WAMLAA
     I              F4CXC3                          WACXC3
     I              F4LQST                          WALQST
     I              F4ALCD                          WAALCD
     I              F4NAAA                          WANAAA
     I              F4VSST                          WAVSST
     I              F4MJDT                          WAMJDT
     I              F4BETM                          WABETM
     I              F4CCVN                          WACCVN
     I              F4CDVN                          WACDVN
     I              F4MKDT                          WAMKDT
     I              F4BFTM                          WABFTM
     I              F4CEVN                          WACEVN
     I              F4CFVN                          WACFVN
      *
     I@HSTPEW
      * Sales History             Itm/ASD-d/Co/Ord RegSls
      * Renamed input format fields
     I              F4AIC3                          WBAIC3
     I              F4C4NB                          WBC4NB
     I              F4DPNB                          WBDPNB
     I              F4UENB                          WBUENB
     I              F4MONA                          WBMONA
     I              F4RJCD                          WBRJCD
     I              F4RKCD                          WBRKCD
     I              F4GPTX                          WBGPTX
     I              F4ABTX                          WBABTX
     I              F4KXCD                          WBKXCD
     I              F4BOCD                          WBBOCD
     I              F4BTC7                          WBBTC7
     I              F4ANC7                          WBANC7
     I              F4AQTX                          WBAQTX
     I              F4BKC7                          WBBKC7
     I              F4BRTX                          WBBRTX
     I              F4HNNA                          WBHNNA
     I              F4DBCD                          WBDBCD
     I              F4CKTX                          WBCKTX
     I              F4BCNA                          WBBCNA
     I              F4A0DT                          WBA0DT
     I              F4ACDT                          WBACDT
     I              F4R4CD                          WBR4CD
     I              F4R5CD                          WBR5CD
     I              F4BFCD                          WBBFCD
     I              F4Q4CD                          WBQ4CD
     I              F4AQCD                          WBAQCD
     I              F4TBNB                          WBTBNB
     I              F4BZNA                          WBBZNA
     I              F4RLCD                          WBRLCD
     I              F4JNCD                          WBJNCD
     I              F4Q2CD                          WBQ2CD
     I              F4U2ST                          WBU2ST
     I              F4ATIN                          WBATIN
     I              F4T3NB                          WBT3NB
     I              F4RSRN                          WBRSRN
     I              F4ORIT                          WBORIT
     I              F4AJCD                          WBAJCD
     I              F4AVQT                          WBAVQT
     I              F4D0WG                          WBD0WG
     I              F4CCQT                          WBCCQT
     I              F4AUWG                          WBAUWG
     I              F4AGCD                          WBAGCD
     I              F4AKPR                          WBAKPR
     I              F4AUPR                          WBAUPR
     I              F4CRCD                          WBCRCD
     I              F4A5DT                          WBA5DT
     I              F4AWDT                          WBAWDT
     I              F4HDDT                          WBHDDT
     I              F4AGCS                          WBAGCS
     I              F4AQCS                          WBAQCS
     I              F4AVWG                          WBAVWG
     I              F4AYVA                          WBAYVA
     I              F4AMST                          WBAMST
     I              F4ANST                          WBANST
     I              F4VAST                          WBVAST
     I              F4L6NB                          WBL6NB
     I              F4UMCD                          WBUMCD
     I              F4HCDT                          WBHCDT
     I              F4ESNB                          WBESNB
     I              F4ETNB                          WBETNB
     I              F4BZNB                          WBBZNB
     I              F4EXQT                          WBEXQT
     I              F4BYWG                          WBBYWG
     I              F4S5NB                          WBS5NB
     I              F4MAVA                          WBMAVA
     I              F4KDVA                          WBKDVA
     I              F4USVA                          WBUSVA
     I              F4UTVA                          WBUTVA
     I              F4A4WG                          WBA4WG
     I              F4CKNB                          WBCKNB
     I              F4BMST                          WBBMST
     I              F4R8NB                          WBR8NB
     I              F4RMCD                          WBRMCD
     I              F4BZPR                          WBBZPR
     I              F4RDCD                          WBRDCD
     I              F4Q7CD                          WBQ7CD
     I              F4EXDT                          WBEXDT
     I              F4LQCD                          WBLQCD
     I              F4HICD                          WBHICD
     I              F4RBCD                          WBRBCD
     I              F4RGNB                          WBRGNB
     I              F4RHNB                          WBRHNB
     I              F4RINB                          WBRINB
     I              F4R1NB                          WBR1NB
     I              F4CONB                          WBCONB
     I              F4CEST                          WBCEST
     I              F4GNDT                          WBGNDT
     I              F4RMNB                          WBRMNB
     I              F4AODT                          WBAODT
     I              F4LLCD                          WBLLCD
     I              F4LMCD                          WBLMCD
     I              F4SKNB                          WBSKNB
     I              F4SLNB                          WBSLNB
     I              F4SMNB                          WBSMNB
     I              F4G7NA                          WBG7NA
     I              F4ONVA                          WBONVA
     I              F4N0CD                          WBN0CD
     I              F4B4NB                          WBB4NB
     I              F4B5NB                          WBB5NB
     I              F4N1CD                          WBN1CD
     I              F4GIDT                          WBGIDT
     I              F4Z1ST                          WBZ1ST
     I              F4ULVA                          WBULVA
     I              F4UNVA                          WBUNVA
     I              F4UOVA                          WBUOVA
     I              F4UPVA                          WBUPVA
     I              F4UQVA                          WBUQVA
     I              F4SDCD                          WBSDCD
     I              F4QZCD                          WBQZCD
     I              F4XWST                          WBXWST
     I              F4T9CD                          WBT9CD
     I              F4UBCD                          WBUBCD
     I              F4CFC7                          WBCFC7
     I              F4X1CD                          WBX1CD
     I              F4GASX                          WBGASX
     I              F4DUPR                          WBDUPR
     I              F4B6VL                          WBB6VL
     I              F4IANX                          WBIANX
     I              F4IBNX                          WBIBNX
     I              F4RPCD                          WBRPCD
     I              F4NYDT                          WBNYDT
     I              F4BZTM                          WBBZTM
     I              F4Z4NB                          WBZ4NB
     I              F4XACD                          WBXACD
     I              F4OANA                          WBOANA
     I              F4OKTX                          WBOKTX
     I              F4K4TX                          WBK4TX
     I              F4NBBO                          WBNBBO
     I              F4OCFR                          WBOCFR
     I              F4C0C7                          WBC0C7
     I              F4A1AA                          WBA1AA
     I              F4VEST                          WBVEST
     I              F4A5PR                          WBA5PR
     I              F4CDPR                          WBCDPR
     I              F4D0PR                          WBD0PR
     I              F4D0VL                          WBD0VL
     I              F4IRSX                          WBIRSX
     I              F4CEVL                          WBCEVL
     I              F4ISSX                          WBISSX
     I              F4ITSX                          WBITSX
     I              F4IUSX                          WBIUSX
     I              F4OHDT                          WBOHDT
     I              F4D9PR                          WBD9PR
     I              F4CFVL                          WBCFVL
     I              F4UVST                          WBUVST
     I              F4UWST                          WBUWST
     I              F4UXST                          WBUXST
     I              F4AATM                          WBAATM
     I              F4AYNA                          WBAYNA
     I              F4A0NA                          WBA0NA
     I              F4AXDT                          WBAXDT
      *
     I@KMREHC
      * Company Values            Retrieval index
      * Renamed input format fields
     I              KMAIC3                          WCAIC3
     I              KMV8CD                          WCV8CD
     I              KMAUNA                          WCAUNA
     I              KMI5ST                          WCI5ST
     I              KMBXTX                          WCBXTX
     I              KMM8NB                          WCM8NB
     I              KMUVST                          WCUVST
     I              KMUWST                          WCUWST
     I              KMUXST                          WCUXST
     I              KMVSST                          WCVSST
     I              KMAATM                          WCAATM
     I              KMAYNA                          WCAYNA
     I              KMA0NA                          WCA0NA
     I              KMAXDT                          WCAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Sales History
      * I : RST Shipped Item Code
     I                                    P   1   40P1S5NB
      * I :  Actual Shipped Date
     I                                    P   5   80P1GNDT
     IP2PARM      DS
      * FLD: Sales History
      * I :  Company Number
     I                                    P   1   20P2AIC3
      * B :  Weight Billed
     I                                    P   3   82P2BYWG
      * B :  FOB Gross Amount
     I                                    P   9  142P2USVA
      * I :  Shipping Company Number
     I                                    P  15  160P2R8NB
     IP3PARM      DS
      * I :  Date From             USR
     I                                    P   1   40P3JEDT
     IP4PARM      DS
      * I :  Date To               USR
     I                                    P   1   40P4JFDT
     IP5PARM      DS
      * I :  Ship To Customer
     I                                    P   1   40P5BKC7
     IP6PARM      DS
      * FLD: IP Cust Pricing Dtl
      * N :  TP Sales Company Select
     I                                    P   1   20P6CXC3
      * N :  TP Sales Company
     I                                        3   3 P6LQST
     IP7PARM      DS
      * I :  Inter Company Group USR
     I                                        1   1 P7GKU1
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1S5NB    PARM           WP0001  70       Shipped Item Co
     C           P1GNDT    PARM           WP0002  70       Actual Shipped
     C           P2AIC3    PARM           WP0003  30       Company Number
     C           P2BYWG    PARM P2BYWG    WP0004 112       Weight Billed
     C           P2USVA    PARM P2USVA    WP0005 112       FOB Gross Amoun
     C           P2R8NB    PARM           WP0006  30       Shipping Compan
     C           P3JEDT    PARM           WP0007  70       Date From
     C           P4JFDT    PARM           WP0008  70       Date To
     C           P5BKC7    PARM           WP0009  70       Ship To Custome
     C           P7GKU1    PARM           WP0010  1        Inter Company G
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Clc Transfer Price    XF
      * Rtv TP Sales Comp Sel RT - IP Cust Pricing Dtl  * 
     C                     EXSR SARVGN
      * 04/03/17 DN R9700-Added Inter Company Group Flag as Input Parm.
      * Clc Transfer Price    RT - Sales History  * 
     C                     EXSR SBRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv TP Sales Comp Sel RT - IP Cust Pricing Dtl  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WABKC7           Ship To Custome
      * Setup key
     C                     Z-ADDP5BKC7    WABKC7           Ship To Custome
      * Establish starting position
     C           KRSSA     CHAIN@F4REFS              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR4283' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     P6CXC3           TP Sales Compan
     C                     MOVEL*BLANK    P6LQST           TP Sales Compan
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWACXC3    P6CXC3           TP Sales Compan
     C                     MOVELWALQST    P6LQST           TP Sales Compan
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Clc Transfer Price    RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     Z-ADD*ZERO     P2BYWG           Weight Billed
     C                     Z-ADD*ZERO     P2USVA           FOB Gross Amoun
      * ***** Change Log and Comments
     C                     EXSR UASUBR                     ***** Change Lo
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBS5NB    WQSB01           Shipped Item Co
      * Define keylist
     C           KPSSB     KLIST
     C                     KFLD           WQSB01           Shipped Item Co
     C                     KFLD           WBGNDT           Actual Shipped
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Shipped Item Co
      * Setup key
     C                     Z-ADDP1S5NB    WQSB01           Shipped Item Co
     C                     Z-ADDP1GNDT    WBGNDT           Actual Shipped
      * Establish starting position
     C           KPSSB     SETLL@HSTPEW                    *
     C           KRSSB     READE@HSTPEW                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y'       W0RSL            *Record selecte
      * EOF:  Actual Ship Date LT "FROM DATE"
      * CASE: DB1.Actual Shipped Date LT PAR.Date From             USR
     C           WBGNDT    IFLT P3JEDT                     *IF
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
      * OMT:  Exempt Items
      * CASE: DB1.Order TF Exempt Code is Exempt Items
     C           WBIUSX    IFEQ 'EC'                       *IF
     C           WBIUSX    OREQ 'EP'
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * OMT:  Type Code = Inter Company
      * CASE: DB1.Type Code is Inter Company
     C           WBBOCD    IFEQ 'IC'                       *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * OMT:  Type Code = Inter-Company Sales Agreement      FP1314
      * CASE: DB1.Type Code is Inter-Comp Sales Agreemnt
     C           WBBOCD    IFEQ 'IS'                       *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
      * OMT:  IC Group S (440) If IC Group G (360/960) or vice-versa.
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
      * RTV Alpha Value 2     RT - Company Values  * Get Company IC Group
     C                     EXSR SCRVGN
      * CASE: PAR.Inter Company Group USR NE LCL.Inter Company Group USR
     C           P7GKU1    IFNE YL0001                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * 04/03/17 DN R9700-Commented Out 'SEL: Accounting Company' & Moved
      * 04/03/17 DN R9700-Process 'SEL: Accounting Company' if only IC Gr
      * CASE: PAR.Inter Company Group USR is Guymon & Triumph
     C           P7GKU1    IFEQ 'G'                        *IF
      * SEL: Accounting Company
      * CASE: PAR.TP Sales Company is Select Company
     C           P6LQST    IFEQ 'S'                        *IF
      * CASE: PAR.TP Sales Company Select is greater than zero
     C           P6CXC3    IFGT 0                          *IF
      * CASE: DB1.Company Number NE PAR.TP Sales Company Select
     C           WBAIC3    IFNE P6CXC3                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.TP Sales Company is Order Accounting Company
     C           P6LQST    IFEQ 'O'                        *IF
      * CASE: DB1.Company Number NE PAR.Company Number
     C           WBAIC3    IFNE P2AIC3                     *IF
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * PRC:  Record Selected
      * CASE: PGM.*Record selected is *YES
     C           W0RSL     IFEQ 'Y'                        *IF
     C                     ADD  WBBYWG    P2BYWG           Weight Billed
     C                     ADD  WBUSVA    P2USVA           FOB Gross Amoun
     C                     END                             *FI
     C           KRSSB     READE@HSTPEW                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Alpha Value 2     RT - Company Values  * Get Company IC Grou
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0001           System Value Al
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCV8CD           Company Value C
      * Setup key
     C                     Z-ADDWBAIC3    WCAIC3           Company Number
     C                     MOVEL@CN,001   WCV8CD           Company Value C
      * Establish starting position
     C           KRSSC     CHAIN@KMREHC              90    *
      * Data record not found
     C   90                MOVEL'USR2221' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCBXTX    YL0001           System Value Al
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * ***** Change Log and Comments
      *================================================================
      * ** 06/29-2009 LJB FP1314
      * ** Omit type code of IS=Inter-Company Sales Agreement
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P6CXC3           TP Sales Compan
     C                     MOVEL*BLANK    P6LQST           TP Sales Compan
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WACXC3           TP Sales Compan
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCM8NB           System Value Nu
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field Inter Company Group USR
     C                     MOVEL*BLANK    YL0001  1
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 ICPRGROUP
