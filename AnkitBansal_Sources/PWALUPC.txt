/**************************************************************************/
/*  PROGRAM:       PWALUPC                                                */
/*  PROGRAM DESC:  UPD M3 SUPPLR 4/EA CMP UP EXECUTE USER PROGRAM         */
/*  PROGRAMMER:    Danny Nguyen                                           */
/*  CREATE DATE:   12/27/2016                                             */
/*                                                                        */
/*  PURPOSE:       Process will select ERP Process Sts (0=Not Processed)  */
/*                 & set it to (1=Processed) which will update the M3     */
/*                 Supplier (PLB2REP) & the M3 Supplier Interface         */
/*                 PWAACPP) files in the M3 Interface file library.       */
/*                 NOTE - For Production:                                 */
/*                   PWAACPP will update in M3IFLIB.                      */
/*                   PLB2REP will update in PRKFLIB.                      */
/*                 Process will also update HPE files for each Company    */
/*                 in it's associated library by M3 Division Code.        */
/*                   HPE Files: Producer (PKACREP), Producer Location     */
/*                   (PKAFREP) & Trucker (PKBAREP).                       */
/**************************************************************************/
/* MODIFICATION HISTORY                                                   */
/**************************************************************************/
/* DATE     INT  PROJECT DESCRIPTION                                      */
/* -------- ---- ------- -------------------------------------------------*/
/* MM/DD/YY                                                               */
/**************************************************************************/

             PGM        PARM(&RTNCDE)

             DCL        VAR(&RTNCDE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&M3LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB360) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB440) TYPE(*CHAR) LEN(10)
             DCL        VAR(&TOLIB960) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DIV#360) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DIV#440) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DIV#960) TYPE(*CHAR) LEN(10)

/*-------------------------------------------------------------------*/
/* GET M3 INTERFACE LIBRARY & HPE COMPANY LIBRARIES                  */
/*-------------------------------------------------------------------*/
             CALL       PGM(PBSHXFR) PARM('' &M3LIB) /* SYSTEM VALUE +
                          M3ILIB - M3 SUPPLIER (PLB2REP) FILE LIB  */

             CALL       PGM(POMTXFR) PARM('' X'360F' 'HPELIB' +
                          &TOLIB360) /*  COMPANY VALUE - GUYMON LIB */
             CALL       PGM(POMTXFR) PARM('' X'440F' 'HPELIB' +
                          &TOLIB440) /*  COMPANY VALUE - SIOUX CITY LIB */
             CALL       PGM(POMTXFR) PARM('' X'960F' 'HPELIB' +
                          &TOLIB960) /*  COMPANY VALUE - ST. JOSEPH LIB */

/*-------------------------------------------------------------------*/
/* GET M3 DIVISION NUMBER FOR EACH COMPANY                           */
/*-------------------------------------------------------------------*/
             CALL       PGM(POMTXFR) PARM('' X'360F' 'M3HPEDIV' +
                          &DIV#360) /*  COMPANY VALUE - GUYMON DIV # */
             CHGVAR     VAR(%SST(&DIV#360 4 7)) VALUE('0000000')

             CALL       PGM(POMTXFR) PARM('' X'440F' 'M3HPEDIV' +
                          &DIV#440) /*  COMPANY VALUE - SIOUX CITY +
                          DIV # */
             CHGVAR     VAR(%SST(&DIV#440 4 7)) VALUE('0000000')

             CALL       PGM(POMTXFR) PARM('' X'960F' 'M3HPEDIV' +
                          &DIV#960) /*  COMPANY VALUE - ST. JOSEPH +
                          DIV # */
             CHGVAR     VAR(%SST(&DIV#960 4 7)) VALUE('0000000')

/*-------------------------------------------------------------------*/
/* SETUP M3 FILE LIBRARY & OVERRIDE PRIMARY READ INDEX               */
/*-------------------------------------------------------------------*/
             RMVLIBLE   LIB(&M3LIB)
             MONMSG     MSGID(CPF2110 CPF2104) /* LIB NOT FOUND */
             ADDLIBLE   LIB(&M3LIB)
             MONMSG     MSGID(CPF2103) /* LIB ALREADY EXIST */

    /* PWAACPL2 ACCESS PATH SEL M3I ERP PROCESS STS='0' (NOT PROCESSED) */
             OVRDBF     FILE(PWAACPL2) TOFILE(&M3LIB/PWAACPL2) /* READ */
             OVRDBF     FILE(PWAACPL0) TOFILE(&M3LIB/PWAACPL0) /* UPDATE */

/*-------------------------------------------------------------------*/
/* UPDATE M3 SUPPLIER (PLB2REP) FILE FOR EACH COMPANY ASSOCIATED LIB.*/
/* UPDATE M3 ERP PROCESS STS FROM 0 (UNPROCESSED) TO 1 (PROCESSED).  */
/*-------------------------------------------------------------------*/
UPD360:
             RMVLIBLE   LIB(&TOLIB360)
             MONMSG     MSGID(CPF2110 CPF2104) /* LIB NOT FOUND */
             ADDLIBLE   LIB(&TOLIB360)
             MONMSG     MSGID(CPF2103) /* LIB ALREADY EXIST */

    /* OVERRIDE ACCESS PATHS TO USE COMPANY 360 LIB */
         /* Producer EXT2 */
             OVRDBF     FILE(PLB4REL2) TOFILE(&TOLIB360/PLB4REL2)
         /* Producer */
             OVRDBF     FILE(PKACREL1) TOFILE(&TOLIB360/PKACREL1)
             OVRDBF     FILE(PKACREL0) TOFILE(&TOLIB360/PKACREL0)
         /* Producer Location EXT */
             OVRDBF     FILE(PLB5REL2) TOFILE(&TOLIB360/PLB5REL2)
         /* Producer Location */
             OVRDBF     FILE(PKAFREL0) TOFILE(&TOLIB360/PKAFREL0)
             OVRDBF     FILE(PKAFREL1) TOFILE(&TOLIB360/PKAFREL1)
         /* Trucker */
             OVRDBF     FILE(PKBAREL3) TOFILE(&TOLIB360/PKBAREL3)
             OVRDBF     FILE(PKBAREL1) TOFILE(&TOLIB360/PKBAREL1)

             CALL       PGM(PWAKXFR) PARM(&RTNCDE &DIV#360)

             DLTOVR     FILE(PLB4REL2 PKACREL1 PKACREL0 PLB5REL2 +
                          PKAFREL0 PKAFREL1 PKBAREL3 PKBAREL1)
             RMVLIBLE   LIB(&TOLIB360)

UPD440:
             RMVLIBLE   LIB(&TOLIB440)
             MONMSG     MSGID(CPF2110 CPF2104) /* LIB NOT FOUND */
             ADDLIBLE   LIB(&TOLIB440)
             MONMSG     MSGID(CPF2103) /* LIB ALREADY EXIST */

    /* OVERRIDE ACCESS PATHS TO USE COMPANY 440 LIB */
         /* Producer EXT2 */
             OVRDBF     FILE(PLB4REL2) TOFILE(&TOLIB440/PLB4REL2)
         /* Producer */
             OVRDBF     FILE(PKACREL1) TOFILE(&TOLIB440/PKACREL1)
             OVRDBF     FILE(PKACREL0) TOFILE(&TOLIB440/PKACREL0)
         /* Producer Location EXT */
             OVRDBF     FILE(PLB5REL2) TOFILE(&TOLIB440/PLB5REL2)
         /* Producer Location */
             OVRDBF     FILE(PKAFREL0) TOFILE(&TOLIB440/PKAFREL0)
             OVRDBF     FILE(PKAFREL1) TOFILE(&TOLIB440/PKAFREL1)
         /* Trucker */
             OVRDBF     FILE(PKBAREL3) TOFILE(&TOLIB440/PKBAREL3)
             OVRDBF     FILE(PKBAREL1) TOFILE(&TOLIB440/PKBAREL1)

             CALL       PGM(PWAKXFR) PARM(&RTNCDE &DIV#440)

             DLTOVR     FILE(PLB4REL2 PKACREL1 PKACREL0 PLB5REL2 +
                          PKAFREL0 PKAFREL1 PKBAREL3 PKBAREL1)
             RMVLIBLE   LIB(&TOLIB440)

UPD960:
             RMVLIBLE   LIB(&TOLIB960)
             MONMSG     MSGID(CPF2110 CPF2104) /* LIB NOT FOUND */
             ADDLIBLE   LIB(&TOLIB960)
             MONMSG     MSGID(CPF2103) /* LIB ALREADY EXIST */

    /* OVERRIDE ACCESS PATHS TO USE COMPANY 960 LIB */
         /* Producer EXT2 */
             OVRDBF     FILE(PLB4REL2) TOFILE(&TOLIB960/PLB4REL2)
         /* Producer */
             OVRDBF     FILE(PKACREL1) TOFILE(&TOLIB960/PKACREL1)
             OVRDBF     FILE(PKACREL0) TOFILE(&TOLIB960/PKACREL0)
         /* Producer Location EXT */
             OVRDBF     FILE(PLB5REL2) TOFILE(&TOLIB960/PLB5REL2)
         /* Producer Location */
             OVRDBF     FILE(PKAFREL0) TOFILE(&TOLIB960/PKAFREL0)
             OVRDBF     FILE(PKAFREL1) TOFILE(&TOLIB960/PKAFREL1)
         /* Trucker */
             OVRDBF     FILE(PKBAREL3) TOFILE(&TOLIB960/PKBAREL3)
             OVRDBF     FILE(PKBAREL1) TOFILE(&TOLIB960/PKBAREL1)

             CALL       PGM(PWAKXFR) PARM(&RTNCDE &DIV#960)

             DLTOVR     FILE(*ALL)
             RMVLIBLE   LIB(&TOLIB960)
             RMVLIBLE   LIB(&M3LIB)


 ENDPGM:
             ENDPGM
