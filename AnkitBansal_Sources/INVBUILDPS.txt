/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - CL PROGRAM TO BE RUN AT NIGHT TO BUILD THE 1ST LEVEL  */
/*             CUT FOR BOTH PLANTS, THEN BUILD THE PRODUCTION SCHEDULE. */
/*             THIS RUNS BEFORE INVNIGHTRN, INVNIGHTRS         */
/*                                                                  */
/*  SYSTEM     - PPS                                                 */
/*  DATE       - 03/04/09                                            */
/*  PROGRAMMER - ROSE CENTONZE                                       */
/*                                                                  */
/*------------------------------------------------------------------*/
/* RMC 5/12/09 MONMSG AND CHGJOB LOGGING TO CRT JOB LOG FOR PROCESSES UP */
/*             TO ALLOCATING THE ORDERS. WE WANT THE JOB TO FALL OUT IF */
/*             THERE'S A CPF MSG IN THE 1ST LEVEL CUT OR HOG POP BUILD   */
/*             SO THE ORDERS WONT BE SCHEDULED WITH -0- QTY AND PUT ON HOLD */
/*                                                                   */
/* JBB 2/15/17 Adding company 440 (Iowa) processing to this program. */
/*     E9064   Continuing to hardcode the company values.  Additions */
/*             to this program is to call each program that is       */
/*             company specific for new company 440. Also, instead   */
/*             of going to tag ROLLDATE is program PXXXXFR fails,    */
/*             go to tag END so dates are not rolled.                */
/* RMC 9/07/17 CHG CHGCURLIB TO ADDLIBLE. IT ISNT RUNNING FORM 440/960   */
/* RMC 9/14/17 ROLL DATE FOR COMPANY 961 TOO                             */
/*                                                                      */
/*------------------------------------------------------------------*/
INVNIGHTPS:  PGM
             DCL        &COMP       *DEC     (3 0)
             DCL        VAR(&TDATE) TYPE(*DEC) LEN(7 0) +
                          VALUE(0000000) /* PROD DATE RGT */
             DCL        &JOBDATE    *CHAR   6
             DCL        &JOBDTE     *CHAR   7
             DCL        &HOLD       *CHAR    4
             DCL        &SAVE       *CHAR    4
             DCL        &COPY       *DEC     2 0
             DCL        &OUTQ5      *CHAR    10
             DCL        &HOLD5      *CHAR    4
             DCL        &HOLDNO     *CHAR    4
             DCL        &SAVE5      *CHAR    4
             DCL        &COPY5      *DEC     2 0
             DCL        &LIB360     *CHAR    10
             DCL        &LIB440     *CHAR    10
             DCL        &LIB960     *CHAR    10
             DCL        &COMMAND    *CHAR    512
             CHGVAR     VAR(&HOLD) VALUE(*NO)
             CHGVAR     VAR(&SAVE) VALUE(*YES)
             CHGVAR     VAR(&COPY) VALUE(1)
/*------------------------------------------------------------------*/
/* INIT TO DATE TO A DATE                                                 */
/*------------------------------------------------------------------*/
             RTVJOBA    DATE(&JOBDATE)
             CVTDAT     DATE(&JOBDATE) TOVAR(&JOBDTE) FROMFMT(*MDY) +
                          TOFMT(*CYMD) TOSEP(*NONE)
             CHGVAR     VAR(&TDATE) VALUE(&JOBDTE)
/*------------------------------------------------------------------*/
/* BUILD PRODUCTION SCHEDULE                                               */
/*------------------------------------------------------------------*/

             SNDMSG     MSG('Build Production Schedule has started +
                          for the nightly run program') TOUSR(SEABOARD)

/* GET OUTQ -- WHICH IS CURRENTLY PRKPRT05     */
 GETOUTQ:    CALL       PGM(POMTXFR) PARM(' ' X'360F' 'INVNIGHTQ' &OUTQ5)

/* DEFAULT HOLDNO TO OVERRIDE SELECT OUTQ'S FOR PRKPRT05    T070     */
             CHGVAR     VAR(&HOLDNO) VALUE(*NO)
             CHGVAR     VAR(&HOLD5) VALUE(*YES)
             CHGVAR     VAR(&SAVE5) VALUE(*YES)
             CHGVAR     VAR(&COPY5) VALUE(1)

/* RETURN TO THE ORIGINAL CALL WITH NO HOLD(*YES)            T070    */
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDZ9PFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PDAEPFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PKY2PFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PMFPPFR$) +
                          OUTQ(&OUTQ5) COPIES(&COPY5) HOLD(&HOLD5) +
                          SAVE(&SAVE5)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/*-------------------------------------------------------------------*/
/* CALCULATE BONING RATE   */
/*-------------------------------------------------------------------*/
/*    GOTO       CMDLBL(SKIPBONE)                                 */

 GUYM:       CALL       PGM(POSTUPR) PARM(X'360F' &OUTQ5)
             MONMSG     MSGID(CPF0000)
 SBTF:       CALL       PGM(POSTUPR) PARM(X'440F' &OUTQ5)
             MONMSG     MSGID(CPF0000)
 STJO:       CALL       PGM(POSTUPR) PARM(X'960F' &OUTQ5)
             MONMSG     MSGID(CPF0000)
SKIPBONE:
/*-------------------------------------------------------------------*/
/* BUILD 1ST LEVEL CUT FOR EACH PLANT THEN BUILD THE SCHEDULE       */
/*   PMFZXFR CALLS PMFVXFR WHICH CALLS                               */
/*                    PDAEPFR AND PDZ9PFR REPORTS.          */
/*-------------------------------------------------------------------*/
/* GET HPE DATA LIBRARY PER PLANT 360          */
 GETLIB3:   CALL       PGM(POMTXFR) PARM(' ' X'360F' 'HPELIB   ' &LIB360)
/* GET HPE DATA LIBRARY PER PLANT 360          */
 GETLIB4:   CALL       PGM(POMTXFR) PARM(' ' X'440F' 'HPELIB   ' &LIB440)
/* GET HPE DATA LIBRARY PER PLANT 960                                 */
 GETLIB9:   CALL       PGM(POMTXFR) PARM(' ' X'960F' 'HPELIB   ' &LIB960)
/*-------------------------------------------------------------------*/
/*-------------------------------------------------------------------*/
/*  G U Y M O N  -- HOG POP AND 1ST LEVEL CUT                         */
/*-------------------------------------------------------------------*/
  /*         CHGCURLIB  CURLIB(&LIB360)       DONT NEED THIS ONE  */
             CALL       PGM(PMFZXFR) PARM('' X'360F'  &TDATE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGJOB     LOG(4 00 *SECLVL)
             SNDPGRMSG  TOPGR(PRKSCHERR) MSG('Build Production +
                          Schedule has ended abnormally from the +
                          nightly run')
/*           GOTO ROLLDATE    */
             GOTO END
             ENDDO
/*-------------------------------------------------------------------*/
/*   RLS SPOOL FILE 1ST FEW PAGES FOR DAMON    ---------------------*/
/*-------------------------------------------------------------------*/
             CHGSPLFA   FILE(PDAEPFR$) PAGERANGE(1 4) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDAEPFR$)
             MONMSG     MSGID(CPF0000)

             CHGSPLFA   FILE(PDZ9PFR$) PAGERANGE(1 7) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDZ9PFR$)
             MONMSG     MSGID(CPF0000)
/*-------------------------------------------------------------------*/
/*  S E A B O A R D   T R I U M P H   --  HOG POP AND  1ST LEVEL CUT */
/*-------------------------------------------------------------------*/
/*           CHGCURLIB  CURLIB(&LIB440)             */
             ADDLIBLE   LIB(&LIB440) POSITION(*AFTER QTEMP)
             MONMSG     MSGID(CPF2103)
             CALL       PGM(PMFZXFR) PARM('' X'440F'  &TDATE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGJOB     LOG(4 00 *SECLVL)
             SNDPGRMSG  TOPGR(PRKSCHERR) MSG('Build Production +
                          Schedule has ended abnormally from the +
                          nightly run')
             GOTO END
             ENDDO
/*-------------------------------------------------------------------*/
/*   RLS SPOOL FILE 1ST FEW PAGES FOR DAMON    ---------------------*/
/*-------------------------------------------------------------------*/
             CHGSPLFA   FILE(PDAEPFR$) PAGERANGE(1 4) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDAEPFR$)
             MONMSG     MSGID(CPF0000)

             CHGSPLFA   FILE(PDZ9PFR$) PAGERANGE(1 7) SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDZ9PFR$)
             MONMSG     MSGID(CPF0000)
/*-------------------------------------------------------------------*/
/*  T R I U M P H   --  HOG POP AND  1ST LEVEL CUT                   */
/*-------------------------------------------------------------------*/
/*           CHGCURLIB  CURLIB(&LIB960)             */
             ADDLIBLE   LIB(&LIB960) POSITION(*AFTER QTEMP)
             MONMSG     MSGID(CPF2103)
             CALL       PGM(PMFZXFR) PARM('' X'960F' &TDATE)
             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGJOB     LOG(4 00 *SECLVL)
             SNDPGRMSG  TOPGR(PRKSCHERR) MSG('Build Production +
                          Schedule has ended abnormally from the +
                          nightly run')
/*           GOTO ROLLDATE    */
             GOTO END
             ENDDO
/*-------------------------------------------------------------------*/
/*-------------------------------------------------------------------*/
/*   RLS SPOOL FILE 1ST FEW PAGES FOR DAMON    ---------------------*/
/*-------------------------------------------------------------------*/
             CHGSPLFA   FILE(PDAEPFR$) SPLNBR(*LAST) PAGERANGE(1 4) +
                          SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDAEPFR$) SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)

             CHGSPLFA   FILE(PDZ9PFR$) SPLNBR(*LAST) PAGERANGE(1 7) +
                          SAVE(*YES)
             MONMSG     MSGID(CPF0000)
             RLSSPLF    FILE(PDZ9PFR$) SPLNBR(*LAST)
             MONMSG     MSGID(CPF0000)

/*-------------------------------------------------------------------*/
/* BUILD SCHEDULE FOR BOTH COMPANIES AT THE SAME TIME                */
/*-------------------------------------------------------------------*/
             CLRPFM     FILE(PME6CPP)   /* ORD DTL SCHED BUILD */

             CALL       PGM(PMD1XFR)   PARM(' ' '1' &TDATE)
/*-------------------------------------------------------------------*/
/* AFTER SCHED BUILD PROCESSING  - ROLL KILL DATES IN OMS AND HPE    */
/*-------------------------------------------------------------------*/
/*-------------------------------------------------------------------*/
/* ROLL KILL DATE PER 360 HPE DATA LIBRARY          */
/*-------------------------------------------------------------------*/
ROLLDATE:    CHGCURLIB  CURLIB(&LIB360)
             CALL       PGM(PMFWXFR)  PARM(' ' X'360F')

/*-------------------------------------------------------------------*/
/* ROLL KILL DATE PER 440 HPE DATA LIBRARY                */
/*-------------------------------------------------------------------*/
             CHGCURLIB  CURLIB(&LIB440)
             CALL       PGM(PMFWXFR)  PARM(' ' X'440F')
/*-------------------------------------------------------------------*/
/* ROLL KILL DATE PER 960 HPE DATA LIBRARY                */
/*-------------------------------------------------------------------*/
             CHGCURLIB  CURLIB(&LIB960)
             CALL       PGM(PMFWXFR)  PARM(' ' X'960F')
             CALL       PGM(PMFWXFR)  PARM(' ' X'961F')
/*-------------------------------------------------------------------*/
/* REMOVE SUNDAY DATE FROM PDI8CPP- IN CASE ITS THERE                */
/*-------------------------------------------------------------------*/
/*           CALL       PGM(PDC5XFR) PARM(' ' X'360F') */
/*           CALL       PGM(PDC5XFR) PARM(' ' X'440F') */
/*           CALL       PGM(PDC5XFR) PARM(' ' X'960F') */
/*-------------------------------------------------------------------*/

   /*        SNDPGRMSG  TOPGR(PRKBLDSC) MSG('Nightly Build of the +
                          Production Schedule and Plan ended +
                          Normally.') CONFMSG(*NO)               */
             SNDMSG     MSG('Build Production Schedule has completed +
                          for the nightly run program') TOUSR(SEABOARD)

  END:                    ENDPGM
