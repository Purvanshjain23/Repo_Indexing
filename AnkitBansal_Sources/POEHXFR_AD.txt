// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POEHXFR
// ?Date: 14.08.2025 Time: 03:36:52
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(CNV PK0199 NewFields  RT) TYPE(RTVOBJ) FILE(OMHSTPP)           AC1598470;
{
 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Item Info&Std Ovr  RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1388167;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(WRK.UOM_Primary);
 PARAMETER(WRK.UOM_Pricing);
 PARAMETER(LCL.Unit_Weight);
 PARAMETER(WRK.Catch_Weight_Status);
 PARAMETER(WRK.Standard_Overage_Underage);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(RTV Print Realization  RT) TYPE(RTVOBJ) FILE(CABZREP)          AC1387825;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(LCL.Commodity_Market_Code);
 PARAMETER(WRK.Print_on_Realization_Rpt);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?Retrieve needed fields from Item & IC Item Balance files
 // Call program RTV Copy to History    XF.
 CALL PROGRAM(RTV Copy to History    XF) ('PDRFXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Shipped_Item_Code);
 PARAMETER(WRK.Item_Type_Code);
 PARAMETER(LCL.Commodity_Price_Group);
 PARAMETER(WRK.Base_Conv_Loss_Item);
 PARAMETER(WRK.Variety_Rendered_Cut);
 PARAMETER(WRK.Group_for_Packaging);
 PARAMETER(WRK.Packaging_Code);
 PARAMETER(WRK.Item_Market_Code);
 PARAMETER(WRK.Agrimetrics_group);
 PARAMETER(WRK.Agrimetrics_pack);
 PARAMETER(WRK.Agrimetrics_grade);
 PARAMETER(WRK.SH_Unused_was_broker);
 PARAMETER(WRK.PM_Raw_Material_Type_Code);
 PARAMETER(WRK.PM_Line_Number);

 //?Compute Market Price    PK0199  (calcs copied from sls rlztn reports)
 DO;

 //?subtract 1 from actual shipped date for starting point
 // WRK.Actual Shipped Date = DB1.Actual Shipped Date + CON.-1 *DAYS
 WRK.Actual_Shipped_Date = DATEINCR(DB1.Actual_Shipped_Date '-1' 'DY' 1111111 'NONE' 'N'
 1);

 EXECUTE FUNCTION(RTV Market Price       RT) TYPE(RTVOBJ) FILE(OMF0CPP)          AC1199313;
 PARAMETER(LCL.Commodity_Market_Code);
 PARAMETER(LCL.Commodity_Price_Group);
 PARAMETER(WRK.Actual_Shipped_Date);
 PARAMETER(LCL.Commodity_Market_Price);
 PARAMETER(WRK.USR_Date_Priced);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Commodity Market Price = DB1.Commodity Market Price
  PAR.Commodity_Market_Price = DB1.Commodity_Market_Price;

  // PAR.USR Date Priced = DB1.Market Price Date
  PAR.USR_Date_Priced = DB1.Market_Price_Date;

  QUIT;

 }

 ENDDO;

 //?Compute Market Price for Default Cmdty Mkt Code    PK0199
 DO;

 EXECUTE FUNCTION(RTV Alpha Value        RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1381513;
 PARAMETER(DB1.Company_Number);
 PARAMETER('DFTMKT');
 PARAMETER(LCL.Commodity_Market_Code_USR);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 //?subtract 1 from actual shipped date for starting point
 // WRK.Actual Shipped Date = DB1.Actual Shipped Date + CON.-1 *DAYS
 WRK.Actual_Shipped_Date = DATEINCR(DB1.Actual_Shipped_Date '-1' 'DY' 1111111 'NONE' 'N'
 1);

 EXECUTE FUNCTION(RTV Market Price       RT) TYPE(RTVOBJ) FILE(OMF0CPP)          AC1199313;
 PARAMETER(LCL.Commodity_Market_Code_USR);
 PARAMETER(LCL.Commodity_Price_Group);
 PARAMETER(WRK.Actual_Shipped_Date);
 PARAMETER(LCL.Default_Cmdty_Mkt_Price);
 PARAMETER(WRK.USR_Date_Priced);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Commodity Market Price = DB1.Commodity Market Price
  PAR.Commodity_Market_Price = DB1.Commodity_Market_Price;

  // PAR.USR Date Priced = DB1.Market Price Date
  PAR.USR_Date_Priced = DB1.Market_Price_Date;

  QUIT;

 }

 ENDDO;

 EXECUTE FUNCTION(RTV Palletize          RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1598472;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Palletize);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF DB1.Actual Shipped Date is In the year 2000
 IF DB1.Actual_Shipped_Date >= 1000101;

 // WRK.Sales Expense Process Sts = CND.no
 WRK.Sales_Expense_Process_Sts = 'N';

 // IF *OTHERWISE
 IF *OTHERWISE;

 // WRK.Sales Expense Process Sts = CND.yes
 WRK.Sales_Expense_Process_Sts = 'Y';

 ENDIF;

 EXECUTE FUNCTION(CHG PK0199 New fields) TYPE(CHGOBJ) FILE(OMHSTPP)              AC1598471;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Palletize);
 PARAMETER(LCL.Commodity_Market_Price);
 PARAMETER(*ZERO);
 PARAMETER(LCL.Default_Cmdty_Mkt_Price);
 PARAMETER(*ZERO);
 PARAMETER(WRK.Sales_Expense_Process_Sts);
 {
  //?USER: Processing after Data read

  // DB1.Data Mart Process Sts = CND.no
  DB1.Data_Mart_Process_Sts = 'N';

 }

}


