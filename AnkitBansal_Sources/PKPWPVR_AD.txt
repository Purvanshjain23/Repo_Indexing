// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKPWPVR
// ?Date: 14.08.2025 Time: 02:50:09
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?USER: Load screen

// DTL.BOH Company Number = PAR.BOH Company Number
DTL.BOH_Company_Number = PAR.BOH_Company_Number;

// DTL.BOH Buy Order Number = PAR.BOH Buy Order Number
DTL.BOH_Buy_Order_Number = PAR.BOH_Buy_Order_Number;

// DTL.BOH Kill Date = PAR.BOH Kill Date
DTL.BOH_Kill_Date = PAR.BOH_Kill_Date;

// DTL.PPWS Company Number = PAR.PPWS Company Number
DTL.PPWS_Company_Number = PAR.PPWS_Company_Number;

EXECUTE FUNCTION(Rtv Week Nbr f/ a Dte RT) TYPE(RTVOBJ) FILE(PKCFREP)           AB1127384;
PARAMETER(DTL.CW_Year);
PARAMETER(DTL.CW_Week_Number);
PARAMETER(DTL.BOH_Kill_Date);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


//?USER: Process command keys

CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.PD Producer Code
IF PGM.*Cursor_field = DTL.PD_Producer_Code;

// OR PGM.*Cursor field <IS> DTL.PL Location Code
OR PGM.*Cursor_field = DTL.PL_Location_Code;

// Call program Sel Producer Loc      SR.
CALL PROGRAM(Sel Producer Loc      SR) ('PKKMSRR');
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);

ENDIF;

ENDIF;

//?USER: Validate fields

EXECUTE FUNCTION(Rtv Pdctn Loc Nm,Sts  RT) TYPE(RTVOBJ) FILE(PKAFREP)           AB1165416;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(DTL.PL_Name);
PARAMETER(WRK.RS_Record_Status);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

CASE;

// IF WRK.RS Record Status is InActive
IF WRK.RS_Record_Status = 'I';

// Send error message - 'Producer Location has an inactive status.  Please re-select.'
ERROR(PRK0561);

ENDIF;

// IF *OTHERWISE
IF *OTHERWISE;

// Send error message - 'Producer Location not found.'
ERROR(PRK0015);

ENDIF;

EXECUTE FUNCTION(Rtv Prdcr Name, Sts   RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1165413;
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PD_Name);
PARAMETER(WRK.RS_Record_Status);
{
 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF WRK.RS Record Status is InActive
IF WRK.RS_Record_Status = 'I';

// Send error message - 'Producer has an inactive status. Please re-select.'
ERROR(PRK0560);

ENDIF;

//?USER: User defined action

//?Create Prpducer Purchase Plan if it does not exist.
EXECUTE FUNCTION(Upd Prdcr Purch Pln   RT) TYPE(RTVOBJ) FILE(PKAVCPP)           AB1145472;
PARAMETER(DTL.PPWS_Company_Number);
PARAMETER(DTL.CW_Year);
PARAMETER(DTL.CW_Week_Number);
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
{
 //?USER: Processing if Data record not found

 EXECUTE FUNCTION(Chg Run Log Header    CH) TYPE(CRTOBJ) FILE(PKAVCPP)           AA1100470;
 PARAMETER(PAR.PPWS_Company_Number);
 PARAMETER(PAR.CW_Year);
 PARAMETER(PAR.CW_Week_Number);
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.PL_Location_Code);
 PARAMETER(PAR.PPP_Week_Head_Est);
 PARAMETER(PAR.PPP_Mon_Head_Est);
 PARAMETER(PAR.PPP_Mon_Plan_Head);
 PARAMETER(PAR.PPP_Tue_Head_Est);
 PARAMETER(PAR.PPP_Tue_Plan_Head);
 PARAMETER(PAR.PPP_Wed_Head_Est);
 PARAMETER(PAR.PPP_Wed_Plan_Head);
 PARAMETER(PAR.PPP_Thu_Head_Est);
 PARAMETER(PAR.PPP_Thu_Plan_Head);
 PARAMETER(PAR.PPP_Fri_Head_Est);
 PARAMETER(PAR.PPP_Fri_Plan_Head);
 PARAMETER(PAR.PPP_Sat_Head_Est);
 PARAMETER(PAR.PPP_Sat_Plan_Head);
 PARAMETER(PAR.PPP_Sun_Head_Est);
 PARAMETER(PAR.PPP_Sun_Plan_Head);
 PARAMETER(PAR.RS_User_Changed);
 PARAMETER(PAR.RS_Date_Changed);
 PARAMETER(PAR.RS_Time_Changed);
 PARAMETER(PAR.RS_Record_Status);
 PARAMETER(PAR.RS_Job);
 PARAMETER(PAR.RS_Program);
 PARAMETER(PAR.RS_User_Added);
 PARAMETER(PAR.RS_Date_Added);
 PARAMETER(PAR.RS_Time_Added);
}


// Call program Crt Buy Order and Load ET.
CALL PROGRAM(Crt Buy Order and Load ET) ('PKANETR');
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Kill_Date);
PARAMETER(DTL.PPWS_Company_Number);
PARAMETER(DTL.CW_Year);
PARAMETER(DTL.CW_Week_Number);
PARAMETER(DTL.PD_Producer_Code);
PARAMETER(DTL.PL_Location_Code);
PARAMETER(WRK.Head_Total_USR);
PARAMETER(PAR.Oms_Name);
PARAMETER(PAR.Oms_System_Value_Alpha);

