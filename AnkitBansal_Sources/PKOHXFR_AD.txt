// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKOHXFR
// ?Date: 14.08.2025 Time: 02:52:19
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?get prior week ending date (Sat)
EXECUTE FUNCTION(Clc Weekly Floor Prc  RT) TYPE(RTVOBJ) FILE(PKAQCPP)           AB1209078;
{
 //?USER: Initialize routine

 //?get prior week ending date (for create) (Sunday)
 // PAR.Day of Week USR = JOB.*Job date *DAY OF WEEK
 PAR.Day_of_Week_USR = DATEDTLS(JOB.*Job_date 'DW' 1111111 'NONE' 'N' 1);

 // PAR.Day of Week USR = CON.*ZERO - PAR.Day of Week USR
 PAR.Day_of_Week_USR = *ZERO - PAR.Day_of_Week_USR;

 // PAR.PFP Week Ending Date = JOB.*Job date + PAR.Day of Week USR *DAYS
 PAR.PFP_Week_Ending_Date = DATEINCR(JOB.*Job_date PAR.Day_of_Week_USR 'DY' 1111111
 'NONE' 'N' 1);

 //?USER: Process Data record

 CASE;

 // IF DB1.PSC Sub-Contract Type is Market/Carcass Merit
 IF DB1.PSC_Sub_Contract_Type = 'M';

 //?Get base floor price (DB1)
 //?Calculate possible adjusted price
 EXECUTE FUNCTION(Clc Weekly Adj Flr Prc RT) TYPE(RTVOBJ) FILE(PKEBREP)          AB1209221;
 PARAMETER(DB1.PC_Contract_Code);
 PARAMETER(DB1.PSC_Sub_Contract_Code);
 PARAMETER(JOB.*Job_date);
 PARAMETER(DB1.PSC_Floor_Price);
 PARAMETER(PAR.PFP_Adjusted_Floor_Price);
 {
  //?USER: Initialize routine

  // PAR.PFP Adjusted Floor Price = CON.*ZERO
  PAR.PFP_Adjusted_Floor_Price = *ZERO;

  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  //?PAR.OMS Market Price Amt Usr  is 11.4
  // Call program RTV Market Price      XF.
  CALL PROGRAM(RTV Market Price      XF) ('PDMWXFR');
  PARAMETER(PGM.*Return_code);
  PARAMETER(DB1.FPC_Commodity_Market_Code);
  PARAMETER(DB1.FPC_Commodity_Price_Group);
  PARAMETER(PAR.Date_USR);
  PARAMETER(*ZERO);
  PARAMETER(PAR.OMS_Market_Price_Amt_Usr);
  PARAMETER(LCL.Pricing_Date_USR);
  PARAMETER(DB1.FPC_Company_Number);
  PARAMETER(DB1.FPC_Market_Date_Method);
  PARAMETER('H');
  PARAMETER(WRK.OMS_Error_Return_Usr);

  // PAR.Market Amount         USR = PAR.OMS Market Price Amt Usr * CON.1 *Rounded
  PAR.Market_Amount_USR = PAR.OMS_Market_Price_Amt_Usr * 1 'H';

  // Calc Adjusted Floor Price
  PAR.PFP_Adjusted_Floor_Price = PAR.PFP_Adjusted_Floor_Price + ( ( DB1.FPC_Constant_1 * (
  PAR.Market_Amount_USR - DB1.FPC_Constant_2 ) 'H' ) * 1 'H' );

  //?USER: Exit processing

  // PAR.PFP Adjusted Floor Price = PAR.PFP Base Floor Price + PAR.PFP Adjusted Floor
  PAR.PFP_Adjusted_Floor_Price = PAR.PFP_Base_Floor_Price + PAR.PFP_Adjusted_Floor_Price;

 }

 //?create week's floor price
 //?9/23/98 -Purva
 //?Crt wkly floor price rec; adjusted price is greater of Base or Adj
 CASE;

 // IF DB1.PSC Floor Price GT PAR.PFP Adjusted Floor Price
 IF DB1.PSC_Floor_Price > PAR.PFP_Adjusted_Floor_Price;

 EXECUTE FUNCTION(CRT Producer SC Floor CR) TYPE(CRTOBJ) FILE(PKECCPP)           AB1208307;
 PARAMETER(DB1.PC_Contract_Code);
 PARAMETER(DB1.PSC_Sub_Contract_Code);
 PARAMETER(PAR.PFP_Week_Ending_Date);
 PARAMETER(DB1.PSC_Floor_Price);
 PARAMETER(DB1.PSC_Floor_Price);
 PARAMETER(PAR.PFP_Adjusted_Floor_Price);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 //?Crt wkly floor price rec; adjusted price is greater of Base or Adj
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(CRT Producer SC Floor CR) TYPE(CRTOBJ) FILE(PKECCPP)           AB1208307;
 PARAMETER(DB1.PC_Contract_Code);
 PARAMETER(DB1.PSC_Sub_Contract_Code);
 PARAMETER(PAR.PFP_Week_Ending_Date);
 PARAMETER(DB1.PSC_Floor_Price);
 PARAMETER(PAR.PFP_Adjusted_Floor_Price);
 PARAMETER(PAR.PFP_Adjusted_Floor_Price);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 PARAMETER(*ZERO);
 ENDIF;

 ENDIF;

}


