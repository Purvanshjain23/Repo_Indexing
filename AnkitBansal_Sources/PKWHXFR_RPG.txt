     H/TITLE Bld Non CrcMrt Prem   XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISSGOYA
     H* Date          : 11/25/24  Time  : 11:25:15
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKFACPL1IF  E           K        DISK
      * RTV : MPR Non Carc Merit Prem   Retrieval index
      *
     FPKFACPL0UF  E           K        DISK                      A
      * UPD : MPR Non Carc Merit Prem   Update index
      *
      * Long constants
     E                    @CN#    1  10  6   @CN    25
     I@FACPGD
      * MPR Non Carc Merit Prem   Retrieval index
      * Renamed input format fields
     I              FAH8CD                          WAH8CD
     I              FAETDT                          WAETDT
     I              FAC2A1                          WAC2A1
     I              FAENA1                          WAENA1
     I              FAEOA1                          WAEOA1
     I              FAEPA1                          WAEPA1
     I              FAEQA1                          WAEQA1
     I              FAERA1                          WAERA1
     I              FAESA1                          WAESA1
     I              FAETA1                          WAETA1
     I              FAEUA1                          WAEUA1
     I              FAEVA1                          WAEVA1
     I              FAEWA1                          WAEWA1
     I              FAEXA1                          WAEXA1
     I              FAEYA1                          WAEYA1
     I              FAEZA1                          WAEZA1
     I              FAE0A1                          WAE0A1
     I              FAE1A1                          WAE1A1
     I              FAE2A1                          WAE2A1
     I              FAE3A1                          WAE3A1
     I              FAE4A1                          WAE4A1
     I              FAE5A1                          WAE5A1
     I              FAE6A1                          WAE6A1
     I              FAE7A1                          WAE7A1
     I              FAE8A1                          WAE8A1
     I              FAE9A1                          WAE9A1
     I              FAFAA1                          WAFAA1
     I              FAFBA1                          WAFBA1
     I              FAAAVN                          WAAAVN
     I              FAAADT                          WAAADT
     I              FAAMTM                          WAAMTM
     I              FAAJST                          WAAJST
     I              FAAHVN                          WAAHVN
     I              FAAGVN                          WAAGVN
     I              FAABVN                          WAABVN
     I              FAABDT                          WAABDT
     I              FAABTM                          WAABTM
      *
     I@FACPGC
      * MPR Non Carc Merit Prem   Update index
      * Renamed input format fields
     I              FAH8CD                          WBH8CD
     I              FAETDT                          WBETDT
     I              FAC2A1                          WBC2A1
     I              FAENA1                          WBENA1
     I              FAEOA1                          WBEOA1
     I              FAEPA1                          WBEPA1
     I              FAEQA1                          WBEQA1
     I              FAERA1                          WBERA1
     I              FAESA1                          WBESA1
     I              FAETA1                          WBETA1
     I              FAEUA1                          WBEUA1
     I              FAEVA1                          WBEVA1
     I              FAEWA1                          WBEWA1
     I              FAEXA1                          WBEXA1
     I              FAEYA1                          WBEYA1
     I              FAEZA1                          WBEZA1
     I              FAE0A1                          WBE0A1
     I              FAE1A1                          WBE1A1
     I              FAE2A1                          WBE2A1
     I              FAE3A1                          WBE3A1
     I              FAE4A1                          WBE4A1
     I              FAE5A1                          WBE5A1
     I              FAE6A1                          WBE6A1
     I              FAE7A1                          WBE7A1
     I              FAE8A1                          WBE8A1
     I              FAE9A1                          WBE9A1
     I              FAFAA1                          WBFAA1
     I              FAFBA1                          WBFBA1
     I              FAAAVN                          WBAAVN
     I              FAAADT                          WBAADT
     I              FAAMTM                          WBAMTM
     I              FAAJST                          WBAJST
     I              FAAHVN                          WBAHVN
     I              FAAGVN                          WBAGVN
     I              FAABVN                          WBABVN
     I              FAABDT                          WBABDT
     I              FAABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPKFA1    E DSPKFACPL0
      * UPD : MPR Non Carc Merit Prem   Update index
      * Renamed input format fields
     I              FAH8CD                          WBH8CD
     I              FAETDT                          WBETDT
     I              FAC2A1                          WBC2A1
     I              FAENA1                          WBENA1
     I              FAEOA1                          WBEOA1
     I              FAEPA1                          WBEPA1
     I              FAEQA1                          WBEQA1
     I              FAERA1                          WBERA1
     I              FAESA1                          WBESA1
     I              FAETA1                          WBETA1
     I              FAEUA1                          WBEUA1
     I              FAEVA1                          WBEVA1
     I              FAEWA1                          WBEWA1
     I              FAEXA1                          WBEXA1
     I              FAEYA1                          WBEYA1
     I              FAEZA1                          WBEZA1
     I              FAE0A1                          WBE0A1
     I              FAE1A1                          WBE1A1
     I              FAE2A1                          WBE2A1
     I              FAE3A1                          WBE3A1
     I              FAE4A1                          WBE4A1
     I              FAE5A1                          WBE5A1
     I              FAE6A1                          WBE6A1
     I              FAE7A1                          WBE7A1
     I              FAE8A1                          WBE8A1
     I              FAE9A1                          WBE9A1
     I              FAFAA1                          WBFAA1
     I              FAFBA1                          WBFBA1
     I              FAAAVN                          WBAAVN
     I              FAAADT                          WBAADT
     I              FAAMTM                          WBAMTM
     I              FAAJST                          WBAJST
     I              FAAHVN                          WBAHVN
     I              FAAGVN                          WBAGVN
     I              FAABVN                          WBABVN
     I              FAABDT                          WBABDT
     I              FAABTM                          WBABTM
      *
     IYARDCS      DS                            627
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                            627
     IYCRDCS      DS                            627
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Company Number USR
     I                                    P   1   20P1GGNB
     IP2PARM      DS
      * B :  MPR Identification Num
     I                                        1   5 P2H8CD
     IP3PARM      DS
      * FLD: MPR Non Carc Merit Prem
      * B :  MPR Reporting Date
     I                                    P   1   40P3ETDT
      * B :  MPR Reporting Time
     I                                    P   5   50P3C2A1
      * N :  MPR Volume Low
     I                                    P   6   82P3ENA1
      * N :  MPR Volume High
     I                                    P   9  112P3EOA1
      * N :  MPR Transportation Low
     I                                    P  12  142P3EPA1
      * N :  MPR Transportation High
     I                                    P  15  172P3EQA1
      * N :  MPR Delv Timing Low
     I                                    P  18  202P3ERA1
      * N :  MPR Delv Timing High
     I                                    P  21  232P3ESA1
      * N :  MPR Breed Low
     I                                    P  24  262P3ETA1
      * N :  MPR Breed High
     I                                    P  27  292P3EUA1
      * N :  MPR NPPC QA Low
     I                                    P  30  322P3EVA1
      * N :  MPR NPPC QA High
     I                                    P  33  352P3EWA1
      * N :  MPR Other Desc 1
     I                                       36 135 P3EXA1
      * N :  MPR Other Value 1 Low
     I                                    P 136 1382P3EYA1
      * N :  MPR Other Value 1 High
     I                                    P 139 1412P3EZA1
      * N :  MPR Other Desc 2
     I                                      142 241 P3E0A1
      * N :  MPR Other Value 2 Low
     I                                    P 242 2442P3E1A1
      * N :  MPR Other Value 2 High
     I                                    P 245 2472P3E2A1
      * N :  MPR Other Desc 3
     I                                      248 347 P3E3A1
      * N :  MPR Other Value 3 Low
     I                                    P 348 3502P3E4A1
      * N :  MPR Other Value 3 High
     I                                    P 351 3532P3E5A1
      * N :  MPR Other Desc 4
     I                                      354 453 P3E6A1
      * N :  MPR Other Value 4 Low
     I                                    P 454 4562P3E7A1
      * N :  MPR Other Value 4 High
     I                                    P 457 4592P3E8A1
      * N :  MPR Other Desc 5
     I                                      460 559 P3E9A1
      * N :  MPR Other Value 5 Low
     I                                    P 560 5622P3FAA1
      * N :  MPR Other Value 5 High
     I                                    P 563 5652P3FBA1
     IP4PARM      DS
      * B :  MPR Day Sts USR
     I                                        1   1 P4V8ST
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1GGNB    PARM           WP0001  30       Company Number
     C           P2H8CD    PARM P2H8CD    WP0002  5        MPR Identificat
     C           P3ETDT    PARM P3ETDT    WP0003  70       MPR Reporting D
     C           P3C2A1    PARM P3C2A1    WP0004  10       MPR Reporting T
     C           P4V8ST    PARM P4V8ST    WP0005  1        MPR Day Sts USR
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Bld Non CrcMrt Prem   XF
      * PAR = CON By name
     C                     MOVEL*BLANK    P2H8CD           MPR Identificat
     C                     Z-ADD*ZERO     P3ETDT           MPR Reporting D
     C                     Z-ADD*ZERO     P3C2A1           MPR Reporting T
     C                     Z-ADD*ZERO     P3ENA1           MPR Volume Low
     C                     Z-ADD*ZERO     P3EOA1           MPR Volume High
     C                     Z-ADD*ZERO     P3EPA1           MPR Transportat
     C                     Z-ADD*ZERO     P3EQA1           MPR Transportat
     C                     Z-ADD*ZERO     P3ERA1           MPR Delv Timing
     C                     Z-ADD*ZERO     P3ESA1           MPR Delv Timing
     C                     Z-ADD*ZERO     P3ETA1           MPR Breed Low
     C                     Z-ADD*ZERO     P3EUA1           MPR Breed High
     C                     Z-ADD*ZERO     P3EVA1           MPR NPPC QA Low
     C                     Z-ADD*ZERO     P3EWA1           MPR NPPC QA Hig
     C                     MOVEL*BLANK    P3EXA1           MPR Other Desc
     C                     Z-ADD*ZERO     P3EYA1           MPR Other Value
     C                     Z-ADD*ZERO     P3EZA1           MPR Other Value
     C                     MOVEL*BLANK    P3E0A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E1A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E2A1           MPR Other Value
     C                     MOVEL*BLANK    P3E3A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E4A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E5A1           MPR Other Value
     C                     MOVEL*BLANK    P3E6A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E7A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E8A1           MPR Other Value
     C                     MOVEL*BLANK    P3E9A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3FAA1           MPR Other Value
     C                     Z-ADD*ZERO     P3FBA1           MPR Other Value
     C                     MOVEL*BLANK    P4V8ST           MPR Day Sts USR
     C                     MOVEL'N'       P4V8ST           MPR Day Sts USR
      * * Retrieve Plant Establishment Number from the Company Values *
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0001  30       BOH Company Num
     C                     PARM 'PLTESTNO'WQ0002 10        Company Value C
     C           YL0001    PARM *BLANK    WQ0003 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELYL0001    P2H8CD           MPR Identificat
      * * Create a record in MPR Non Carcass Merit Premiun File *
      * Rtv System Date       UP - STR User Source Functions  * 
     C                     CALL 'PKPSUPR'              90  Rtv System Date
     C           P3ETDT    PARM *ZERO     WQ0004  70       *DATE
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKPSUPR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     Z-ADD3         P3C2A1           MPR Reporting T
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0005  30       BOH Company Num
     C                     PARM @CN,001   WQ0006 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0007 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3ENA1           MPR Volume Low
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0008  30       BOH Company Num
     C                     PARM @CN,002   WQ0009 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0010 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3EOA1           MPR Volume High
      * CASE: PAR.MPR Volume Low is GT 0
     C           P3ENA1    IFGT 0                          *IF
     C                     MOVEL*BLANK    P3EXA1           MPR Other Desc
     C                     MOVEL@CN,003   P3EXA1           MPR Other Desc
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
     C                     EXSR SARVGN
     C                     MOVEL'Y'       P4V8ST           MPR Day Sts USR
     C                     END                             *FI
      * 3003449 Beg
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0015  30       BOH Company Num
     C                     PARM @CN,004   WQ0016 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0017 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3ENA1           MPR Volume Low
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0018  30       BOH Company Num
     C                     PARM @CN,005   WQ0019 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0020 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3EOA1           MPR Volume High
     C                     Z-ADD4         P3C2A1           MPR Reporting T
      * CASE: PAR.MPR Volume Low is GT 0
     C           P3ENA1    IFGT 0                          *IF
     C                     MOVEL*BLANK    YL0003           Description 30
     C                     MOVEL@CN,006   YL0003           Description 30
     C                     Z-ADD1         ZQ      50
     C           YL0003    CAT  @CN,007:ZQYL0003    P      Description 30
     C                     MOVEL*BLANK    P3EXA1           MPR Other Desc
     C                     MOVELYL0003    P3EXA1           MPR Other Desc
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
     C                     EXSR SDRVGN
     C                     MOVEL'Y'       P4V8ST           MPR Day Sts USR
     C                     END                             *FI
     C                     MOVEL*BLANK    YL0003           Description 30
      * 3003449 End
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0025  30       BOH Company Num
     C                     PARM @CN,008   WQ0026 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0027 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3EYA1           MPR Other Value
      * Rtv Company Value Nbr XF - STR Order Management Sys  * 
     C                     CALL 'PDHGXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1GGNB    WQ0028  30       BOH Company Num
     C                     PARM @CN,009   WQ0029 10        Company Value C
     C           YL0002    PARM *ZERO     WQ0030 155       System Value Nu
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDHGXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDYL0002    P3EZA1           MPR Other Value
     C                     Z-ADD3         P3C2A1           MPR Reporting T
      * CASE: PAR.MPR Other Value 1 Low is GT 0
     C           P3EYA1    IFGT 0                          *IF
     C                     MOVEL*BLANK    P3EXA1           MPR Other Desc
     C                     MOVEL@CN,010   P3EXA1           MPR Other Desc
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
     C                     EXSR SGRVGN
     C                     MOVEL'Y'       P4V8ST           MPR Day Sts USR
     C                     END                             *FI
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAH8CD           MPR Identificat
     C                     KFLD           WAETDT           MPR Reporting D
     C                     KFLD           WAC2A1           MPR Reporting T
      * Setup key
     C                     MOVELP2H8CD    WAH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WAETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WAC2A1           MPR Reporting T
      * Establish starting position
     C           KRSSA     CHAIN@FACPGD              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0981' W0RTN   7
      * USER: Processing if Data record not found
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
     C                     EXSR SBCRRC
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
     C                     EXSR SCCHRC
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1           MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1           MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1           MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1           MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1           MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp-Sys Dt  IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBABDT    PARM *ZERO     WQ0011  70       *DATE
     C           WBABTM    PARM *ZERO     WQ0012  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSB    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
      * Check for duplicate primary key
     C           KLCRSB    SETLL@FACPGC                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0982' W0RTN   7
      * Send message 'MPR Non Carc Merit Pre EX'
     C                     MOVEL'PRK0982' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@FACPGC                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001 10        RS User Changed
     C                     Z-ADD*ZERO     WN0002  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0003  60       RS Time Changed
     C                     MOVEL*BLANK    WN0004  1        RS Record Statu
     C                     MOVEL*BLANK    WN0005 10        RS Job
     C                     MOVEL*BLANK    WN0006 10        RS Program
     C                     MOVEL*BLANK    WN0007 10        RS User Added
     C                     Z-ADD*ZERO     WN0008  70       RS Date Added
     C                     Z-ADD*ZERO     WN0009  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD    P      MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
      *
     C           KLCHSC    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
     C           KLCHSC    CHAIN@FACPGC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKFACPL0'MDACP
     C                     MOVEL'@FACPGC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKFA1    YARDCS
      * Move non-key fields to @FACPGC
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1    P      MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1    P      MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1    P      MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1    P      MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1    P      MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
      *
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp-SysDtIF
     C                     MOVEL##USR     WBAAVN           RS User Changed
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBAADT    PARM *ZERO     WQ0013  70       *DATE
     C           WBAMTM    PARM *ZERO     WQ0014  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@FACPGC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKFACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WAH8CD           MPR Identificat
     C                     KFLD           WAETDT           MPR Reporting D
     C                     KFLD           WAC2A1           MPR Reporting T
      * Setup key
     C                     MOVELP2H8CD    WAH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WAETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WAC2A1           MPR Reporting T
      * Establish starting position
     C           KRSSD     CHAIN@FACPGD              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0981' W0RTN   7
      * USER: Processing if Data record not found
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
     C                     EXSR SECRRC
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
     C                     EXSR SFCHRC
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECRRC    BEGSR
      *================================================================
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1           MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1           MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1           MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1           MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1           MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp-Sys Dt  IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBABDT    PARM *ZERO     WQ0021  70       *DATE
     C           WBABTM    PARM *ZERO     WQ0022  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSE    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
      * Check for duplicate primary key
     C           KLCRSE    SETLL@FACPGC                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0982' W0RTN   7
      * Send message 'MPR Non Carc Merit Pre EX'
     C                     MOVEL'PRK0982' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C                     WRITE@FACPGC                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0010 10        RS User Changed
     C                     Z-ADD*ZERO     WN0011  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0012  60       RS Time Changed
     C                     MOVEL*BLANK    WN0013  1        RS Record Statu
     C                     MOVEL*BLANK    WN0014 10        RS Job
     C                     MOVEL*BLANK    WN0015 10        RS Program
     C                     MOVEL*BLANK    WN0016 10        RS User Added
     C                     Z-ADD*ZERO     WN0017  70       RS Date Added
     C                     Z-ADD*ZERO     WN0018  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD    P      MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
      *
     C           KLCHSF    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
     C           KLCHSF    CHAIN@FACPGC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKFACPL0'MDACP
     C                     MOVEL'@FACPGC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKFA1    YBRDCS
      * Move non-key fields to @FACPGC
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1    P      MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1    P      MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1    P      MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1    P      MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1    P      MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
      *
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp-SysDtIF
     C                     MOVEL##USR     WBAAVN           RS User Changed
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBAADT    PARM *ZERO     WQ0023  70       *DATE
     C           WBAMTM    PARM *ZERO     WQ0024  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@FACPGC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKFACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Upd Non CrcMrt Prem   RT - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WAH8CD           MPR Identificat
     C                     KFLD           WAETDT           MPR Reporting D
     C                     KFLD           WAC2A1           MPR Reporting T
      * Setup key
     C                     MOVELP2H8CD    WAH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WAETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WAC2A1           MPR Reporting T
      * Establish starting position
     C           KRSSG     CHAIN@FACPGD              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0981' W0RTN   7
      * USER: Processing if Data record not found
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
     C                     EXSR SHCRRC
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
     C                     EXSR SICHRC
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCRRC    BEGSR
      *================================================================
      * Crt Non CrcMerit Prem CR - MPR Non Carc Merit Prem  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD           MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1           MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1           MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1           MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1           MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1           MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
     C                     MOVEL*BLANK    WBAAVN           RS User Changed
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL*BLANK    WBAHVN           RS Job
     C                     MOVEL*BLANK    WBAGVN           RS Program
     C                     MOVEL*BLANK    WBABVN           RS User Added
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp-Sys Dt  IF
     C                     MOVEL'A'       WBAJST           RS Record Statu
     C                     MOVEL##USR     WBABVN           RS User Added
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBABDT    PARM *ZERO     WQ0031  70       *DATE
     C           WBABTM    PARM *ZERO     WQ0032  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##PGM     WBAGVN           RS Program
     C                     MOVEL##JOB     WBAHVN           RS Job
     C           KLCRSH    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
      * Check for duplicate primary key
     C           KLCRSH    SETLL@FACPGC                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0982' W0RTN   7
      * Send message 'MPR Non Carc Merit Pre EX'
     C                     MOVEL'PRK0982' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C                     WRITE@FACPGC                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICHRC    BEGSR
      *================================================================
      * Chg Non CrcMerit Prem CH - MPR Non Carc Merit Prem  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0019 10        RS User Changed
     C                     Z-ADD*ZERO     WN0020  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0021  60       RS Time Changed
     C                     MOVEL*BLANK    WN0022  1        RS Record Statu
     C                     MOVEL*BLANK    WN0023 10        RS Job
     C                     MOVEL*BLANK    WN0024 10        RS Program
     C                     MOVEL*BLANK    WN0025 10        RS User Added
     C                     Z-ADD*ZERO     WN0026  70       RS Date Added
     C                     Z-ADD*ZERO     WN0027  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @FACPGC
     C                     MOVELP2H8CD    WBH8CD    P      MPR Identificat
     C                     Z-ADDP3ETDT    WBETDT           MPR Reporting D
     C                     Z-ADDP3C2A1    WBC2A1           MPR Reporting T
      *
     C           KLCHSI    KLIST
     C                     KFLD           WBH8CD           MPR Identificat
     C                     KFLD           WBETDT           MPR Reporting D
     C                     KFLD           WBC2A1           MPR Reporting T
     C           KLCHSI    CHAIN@FACPGC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PKFACPL0'MDACP
     C                     MOVEL'@FACPGC' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPKFA1    YCRDCS
      * Move non-key fields to @FACPGC
     C                     Z-ADDP3ENA1    WBENA1           MPR Volume Low
     C                     Z-ADDP3EOA1    WBEOA1           MPR Volume High
     C                     Z-ADDP3EPA1    WBEPA1           MPR Transportat
     C                     Z-ADDP3EQA1    WBEQA1           MPR Transportat
     C                     Z-ADDP3ERA1    WBERA1           MPR Delv Timing
     C                     Z-ADDP3ESA1    WBESA1           MPR Delv Timing
     C                     Z-ADDP3ETA1    WBETA1           MPR Breed Low
     C                     Z-ADDP3EUA1    WBEUA1           MPR Breed High
     C                     Z-ADDP3EVA1    WBEVA1           MPR NPPC QA Low
     C                     Z-ADDP3EWA1    WBEWA1           MPR NPPC QA Hig
     C                     MOVELP3EXA1    WBEXA1    P      MPR Other Desc
     C                     Z-ADDP3EYA1    WBEYA1           MPR Other Value
     C                     Z-ADDP3EZA1    WBEZA1           MPR Other Value
     C                     MOVELP3E0A1    WBE0A1    P      MPR Other Desc
     C                     Z-ADDP3E1A1    WBE1A1           MPR Other Value
     C                     Z-ADDP3E2A1    WBE2A1           MPR Other Value
     C                     MOVELP3E3A1    WBE3A1    P      MPR Other Desc
     C                     Z-ADDP3E4A1    WBE4A1           MPR Other Value
     C                     Z-ADDP3E5A1    WBE5A1           MPR Other Value
     C                     MOVELP3E6A1    WBE6A1    P      MPR Other Desc
     C                     Z-ADDP3E7A1    WBE7A1           MPR Other Value
     C                     Z-ADDP3E8A1    WBE8A1           MPR Other Value
     C                     MOVELP3E9A1    WBE9A1    P      MPR Other Desc
     C                     Z-ADDP3FAA1    WBFAA1           MPR Other Value
     C                     Z-ADDP3FBA1    WBFBA1           MPR Other Value
      *
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp-SysDtIF
     C                     MOVEL##USR     WBAAVN           RS User Changed
      * Rtv System Date & Tim UP - STR User Source Functions  * 
     C                     CALL 'PKWDUPC'              90  Rtv System Date
     C           WBAADT    PARM *ZERO     WQ0033  70       *DATE
     C           WBAMTM    PARM *ZERO     WQ0034  60       *TIME
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKWDUPC' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     99    *
     C                     END
     C                     MOVEL##JOB     WBAHVN           RS Job
     C                     MOVEL##PGM     WBAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           QPKFA1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@FACPGC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKFACPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      *
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P3ENA1           MPR Volume Low
     C                     Z-ADD*ZERO     P3EOA1           MPR Volume High
     C                     Z-ADD*ZERO     P3EPA1           MPR Transportat
     C                     Z-ADD*ZERO     P3EQA1           MPR Transportat
     C                     Z-ADD*ZERO     P3ERA1           MPR Delv Timing
     C                     Z-ADD*ZERO     P3ESA1           MPR Delv Timing
     C                     Z-ADD*ZERO     P3ETA1           MPR Breed Low
     C                     Z-ADD*ZERO     P3EUA1           MPR Breed High
     C                     Z-ADD*ZERO     P3EVA1           MPR NPPC QA Low
     C                     Z-ADD*ZERO     P3EWA1           MPR NPPC QA Hig
     C                     MOVEL*BLANK    P3EXA1           MPR Other Desc
     C                     Z-ADD*ZERO     P3EYA1           MPR Other Value
     C                     Z-ADD*ZERO     P3EZA1           MPR Other Value
     C                     MOVEL*BLANK    P3E0A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E1A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E2A1           MPR Other Value
     C                     MOVEL*BLANK    P3E3A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E4A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E5A1           MPR Other Value
     C                     MOVEL*BLANK    P3E6A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3E7A1           MPR Other Value
     C                     Z-ADD*ZERO     P3E8A1           MPR Other Value
     C                     MOVEL*BLANK    P3E9A1           MPR Other Desc
     C                     Z-ADD*ZERO     P3FAA1           MPR Other Value
     C                     Z-ADD*ZERO     P3FBA1           MPR Other Value
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAETDT           MPR Reporting D
     C                     Z-ADD*ZERO     WAC2A1           MPR Reporting T
     C                     Z-ADD*ZERO     WAENA1           MPR Volume Low
     C                     Z-ADD*ZERO     WAEOA1           MPR Volume High
     C                     Z-ADD*ZERO     WAEPA1           MPR Transportat
     C                     Z-ADD*ZERO     WAEQA1           MPR Transportat
     C                     Z-ADD*ZERO     WAERA1           MPR Delv Timing
     C                     Z-ADD*ZERO     WAESA1           MPR Delv Timing
     C                     Z-ADD*ZERO     WAETA1           MPR Breed Low
     C                     Z-ADD*ZERO     WAEUA1           MPR Breed High
     C                     Z-ADD*ZERO     WAEVA1           MPR NPPC QA Low
     C                     Z-ADD*ZERO     WAEWA1           MPR NPPC QA Hig
     C                     Z-ADD*ZERO     WAEYA1           MPR Other Value
     C                     Z-ADD*ZERO     WAEZA1           MPR Other Value
     C                     Z-ADD*ZERO     WAE1A1           MPR Other Value
     C                     Z-ADD*ZERO     WAE2A1           MPR Other Value
     C                     Z-ADD*ZERO     WAE4A1           MPR Other Value
     C                     Z-ADD*ZERO     WAE5A1           MPR Other Value
     C                     Z-ADD*ZERO     WAE7A1           MPR Other Value
     C                     Z-ADD*ZERO     WAE8A1           MPR Other Value
     C                     Z-ADD*ZERO     WAFAA1           MPR Other Value
     C                     Z-ADD*ZERO     WAFBA1           MPR Other Value
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL@CN,1     @CN,1
     C                     MOVEL'N'       W0PMT   1
      * Define local work field System Value Alpha    USR
     C                     MOVEL*BLANK    YL0001 40
      * Define local work field System Value Numeric  USR
     C                     Z-ADD*ZERO     YL0002 155
      * Define local work field Description 30 USR
     C                     MOVEL*BLANK    YL0003 30
      *================================================================
     CSR         ZZEXIT    ENDSR
** @CN
00001 MPRBETALO
00002 MPRBETAHI
00003 Beta Agonist Free
00004 MPRACLLO
00005 MPRACLHI
00006 Animal Confinement
00007 Legislation
00008 SOWHOUSLO
00009 SOWHOUSHI
00010 Sow Housing
