/*********************************************************************/
/* PROGRAM    : PBKTUPC                                              */
/* TITLE      : GENERIC PROGRAM TO EXECUTE THE ESNDMAIL COMMAND      */
/* DATE       : 11/07/2013                                           */
/* Description: EXECUTE THE ESNDNMAIL COMMAND                        */
/*                                                                   */
/*  Parameters:                                                      */
/*  Usage   Field       Field Description                            */
/*  -----   ---------   ------------------------------------------   */
/*    I     &SPLF       SPOOLED FILE TO EMAIL                        */
/*    I     &EADDRESS   EMAIL ADDRESS TO SEND TO                     */
/*    I     &ESUBJECT   EMAIL SUBJECT (LIMIT OF 60 CHAR)             */
/*    I     &EMESSAGE   MESSAGE TO SEND                              */
/*********************************************************************/
/* Modifications:                                                    */
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/*                                                                   */
/*********************************************************************/
 PBKTUPC:    PGM        PARM(&RETURN &EADDRESS &ESUBJECT &EMESSAGE +
                          &SPLF)

/* Variables                                                         */
             DCL        VAR(&RETURN)   TYPE(*CHAR) LEN(7)
             DCL        VAR(&SPLF)     TYPE(*CHAR) LEN(10)
             DCL        VAR(&EADDRESS) TYPE(*CHAR) LEN(50)
             DCL        VAR(&ESUBJECT) TYPE(*CHAR) LEN(60)
             DCL        VAR(&EMESSAGE) TYPE(*CHAR) LEN(256)

/* ERROR MESSAGE FIELDS                                                       */
             DCL        VAR(&MSG)   TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)  TYPE(*DEC) LEN(5 0)
             DCL        VAR(&MSG2)  TYPE(*CHAR) LEN(512)

             MONMSG     MSGID(CPF9999 EML9999 CPF0000 EML0000)
/*-------------------------------------------------------------------*/
/* EXECUTE THE COMMAND AND MONITOR FOR ERRORS                        */
/*-------------------------------------------------------------------*/
             ESEND/ESNDMAIL RECIPIENT(&EADDRESS) SUBJECT(&ESUBJECT) +
                          MSG(&EMESSAGE) ATTLIST((&SPLF *PDF *N &SPLF))
             MONMSG     MSGID(CPF9999 EML9999 CPF0000 EML0000) EXEC(DO)
             CHGVAR     VAR(&RETURN) VALUE('ESEND_ERR')
             GOTO       CMDLBL(MSGTRAP)
             ENDDO

             GOTO       CMDLBL(ENDPGM)

/*----------------------RECEIVE MESSAGES----------------------------*/
 MSGTRAP:    SNDMSG     MSG('ERROR IN ESNDMAIL FOR ' *CAT &EMESSAGE +
                          *BCAT 'in program PBKTUPC') TOUSR(SEABOARD)
             CHGJOB     LOG(4 0 *SECLVL)

ENDPGM:      ENDPGM
