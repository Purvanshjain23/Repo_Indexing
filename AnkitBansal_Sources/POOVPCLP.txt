/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - PRINT FREIGHT COMPARISON REPORT FOR TRANSFER ORDRS   */
/*             OVER LOAD HEADER                                     */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 01/25/02                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &OUTQ       - OUTPUT QUEUE                             */
/*          &COPEIS     - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/*          &HOLD       - HOLD PRINT FLAG                           */
/*          &SAVE       - SAVE PRINT FLAG                           */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &FDATEL     - FROM DATE                                 */
/*          &TDATEL     - TO DATE                                   */
/*          &FLAG       - PAID FREIGHT FLAG                         */
/*********************************************************************/
/*  RMC 2/11/02 ADDED 2 PARMS FOR SELECTION: &EXCLPD =EXCLUDE CARRIER*/
/*              PAID, &EXCLCT=EXCLUDE COLLECT TRUCKS                 */
/*  RMC 6/10/08 E00156 ADDED SUMMARY RPT PARM AND CALL PMVIPFR       */
/*              DO USE OPN QRY ON ORDER HEADER FOR DETAIL RPT BECAUSE +
       ORDER HEADER ACT SHIP DATE MAY BE DIFF THAN LOAD HEADER ACT SHIP +
       SO USE THE ONE FROM THE LOAD HEADER BECAUSE THATS WHAT THE 'DETAIL' +
       REPORT USES                                                   */
/*  LJB 11/24/2009 W262 CHANGED &EXCLPD TO &PAIDYN, RECEIVE          */
/*      E=EXCLUDE CARRIERS PAID IN FULL, I=INCLUDE ONLY CARRIERS     */
/*      PAID IN FULL, BLANKS=ALL                                     */
/* LJB 12/17/2009 E000322  IF EMAIL IS REQUESTED, BUILD THE WORK    */
/*      FILE IN QTEMP. IF IT IS ALREADY THERE, CLEAR IT.            */
/*  RMC 08/14/13 E2719 DO FTP IF &DOC8 IS ENTERED                    */
/*  PIO 07/17/23 REPLACE OPNQRYF WITH OPNSQLF IN OMFJCPP FILE        */
/*               ADDED NEEDED OVRDBF AROUND THE COMMAND.             */
/*               CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*               *GT TO > IN &G                                      */
/*  PIO 07/17/23 REPLACE OPNQRYF WITH OPNSQLF IN OPBFCPP FILE        */
/*               ADDED NEEDED OVRDBF AROUND THE COMMAND.             */
/*               CHANGE *AND TO AND, *EQ TO =, *GE TO >=, *LE TO <=, */
/*               *GT TO > IN &G                                      */
/*********************************************************************/
 POOVPCLP:   PGM        PARM(&PGM &COMPL &FDATEL &TDATEL &FLAG2 +
                          &PAIDYN &EXCLCT &RPTTYP &OUTQ &HOLD &SAVE +
                          &COPIESL &NIGHTQ &DOC8  &EMAILADDR)

        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #     */
        DCL    &COMPL     *DEC                    /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)          /*  FROM DATE      */
        DCL    &FDATEL    *DEC                   /*  FOR PASSING    */
        DCL    &TDATE     *DEC    (7 0)          /*  THROUGH DATE   */
        DCL    &TDATEL    *DEC                   /*  FOR PASSING    */
        DCL    &FLAG2     *CHAR   1               /* PAID FREIGHT   */
        DCL    &PAIDYN     *CHAR   (1)           /* CARRIER PAID SELECTION    */
        DCL    &EXCLCT     *CHAR   (1)           /* EXCL CARRIER TRUCKS       */
        DCL    &RPTTYP     *CHAR   (1)           /* DTL / SUMMARY             */
        DCL    &COPIES    *DEC    (3 0)           /*  # OF COPIES   */
        DCL    &COPIESL   *DEC                    /*  FOR PASSING   */
        DCL    &OUTQ      *CHAR   10              /*  OUTPUT QUEUE  */
        DCL    &NIGHTQ    *CHAR   10              /*  NIGHT JOB QUE.*/
        DCL    &HOLD       *CHAR   (4)           /* Hold Status               */
        DCL    &SAVE       *CHAR   (4)           /* Save Status               */
        DCL    &PGM       *CHAR   10              /*  PGM NAME      */
        DCL    &COMPA     *CHAR   3               /*  COMPANY ALPHA */
        DCL    &TDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &FDATEA    *CHAR   7               /*  TO   DT ALPHA */
        DCL    &DOC8      *CHAR   8               /*  FTP DOCUMENT */
        DCL    &EMAILADDR *CHAR   50              /* EMAIL ADDRESS  */
        DCL    &COMMAND    *CHAR   (512)

/* SEND PROGRAM MESSAGE PARAMETERS  */

        DCL    &PGMO      *CHAR   10              /*  PRINTER FILE  */
        DCL     &A        *CHAR   20              /* QRY YTD DATE   */
        DCL     &B        *CHAR   25              /* QRY TO DATE    */
        DCL     &C        *CHAR   25              /* QRY COMPANY    */
        DCL     &D        *CHAR   25              /* QRY BILLACTVITY */
        DCL     &G        *CHAR  145              /* QRY ALL        */
 /*PIO*/DCL     &E        *CHAR  200              /* QRY ALL        */

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&COMPA) VALUE(&COMP) /* Change to alpha +
                          for message data */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATEA) VALUE(&FDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&TDATE) VALUE(&TDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&TDATEA) VALUE(&TDATE) /* Change to alpha +
                          for query data */
             CHGVAR    VAR(&COPIES) VALUE(&COPIESL) /* change to +
                          length for print program */

/*********************************************************************/
/*   RUN DETAIL REPORT                                               */
/*********************************************************************/
  IF COND(&RPTTYP = 'D')     THEN(DO)

/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/
             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')

/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED FOR REPORT                    */
/*********************************************************************/
  /*PIO      CHGVAR     VAR(&A) VALUE('FJAODT *GE ' *CAT +  +
                         &FDATEA)                          */
  /*PIO*/    CHGVAR     VAR(&A) VALUE('FJAODT >=  ' *CAT +
                         &FDATEA)

  /*PIO      CHGVAR     VAR(&B) VALUE('*AND FJAODT *LE ' *CAT + +
                         &TDATEA)                              */
  /*PIO*/    CHGVAR     VAR(&B) VALUE(' AND FJAODT  <= ' *CAT +
                         &TDATEA)

             IF         COND(&COMPA *GT '000') THEN(DO)
  /*PIO      CHGVAR     VAR(&C) VALUE('*AND FJAIC3 *EQ ' *CAT + +
                         &COMPA)                               */
  /*PIO*/    CHGVAR     VAR(&C) VALUE(' AND FJAIC3  =  ' *CAT +
                         &COMPA)
             ENDDO

             CHGVAR     VAR(&G) VALUE(&A *BCAT &B *BCAT &C *BCAT &D)

  /*PIO      OVRDBF     FILE(OMFJCPLC) SHARE(*YES)   +
             OPNQRYF    FILE((OMFJCPLC)) FORMAT(OMFJCPLC) + +
                          QRYSLT(&G) KEYFLD(*FILE)       */

  /*PIO*/    OVRDBF     FILE(OMFJCPP) TOFILE(OMFJCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OMFJCPP Where  ' *BCAT &G +
                          *BCAT '  ORDER BY FJRMNB ASC') +
                          OPNID(OMFJCPLC) OPTION(*ALL) SEQONLY(*NO) +
                          RCDFMT(@FJCPKW) ALWCPY(*IFRQD) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OMFJCPLC) TOFILE(OMFJCPP) LVLCHK(*NO) +
                        OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)

/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/
             SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) +
                          SAVE(&SAVE)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)

/********************************************************************/
/* 12/10/2009 LJB E000322                                           */
/* IF EMAIL IS REQUESTED, BUILD THE WORK FILE IN QTEMP. IF IT IS    */
/* ALREADY THERE, CLEAR IT.                                         */
/********************************************************************/
             DLTF       FILE(QTEMP/PNFWCPL0)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PNFWCPL1)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PNFWCPP)
             MONMSG     MSGID(CPF0000)

/* CUSTOMER HEADINGS WORKFILE                                       */
             CRTDUPOBJ  OBJ(PNFWCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PNFWCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PNFWCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

/*********************************************************************/
/*   CALL LISTING PROGRAM                                            */
/*********************************************************************/
             CALL       PGM(&PGM) PARM('' &FDATE &TDATE &FLAG2 &COMP +
                          &PAIDYN &EXCLCT)

             IF         COND(&EMAILADDR *NE '            ') THEN(DO)
             EXECUTE    VIEW(PNFWCPPV1) MBROPT(*REPLACE) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADDR) EMLMSG('Freight +
                          Comparison Report for Transfers, Detail')
             ENDDO

FTP:         IF         COND(&DOC8 *NE '        ') THEN(DO)
             CHGVAR     VAR(&EMAILADDR) +
                          VALUE('ftp:download.pork/transportation/' +
                          *CAT &DOC8 *TCAT '.xls')
             EXECUTE    VIEW(PNFWCPPV1) MBROPT(*REPLACE) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADDR)
             ENDDO
             CLOF       OPNID(OMFJCPLC)
    /*PIO    DLTOVR     FILE(OMFJCPLC)  */
             DLTOVR     FILE(OMFJCPLC) LVL(*JOB) /*PIO*/
             ENDDO

/*********************************************************************/
/*   RUN SUMMARY REPORT -  OPEN QRY OVER ORDER HEADER              */
/*********************************************************************/
  IF COND(&RPTTYP = 'S')     THEN(DO)

    /*PIO    CHGVAR     VAR(&A) VALUE('FJAODT *GE ' *CAT + +
                         &FDATEA)                         */
    /*PIO*/  CHGVAR     VAR(&A) VALUE('FJAODT >=  ' *CAT +
                         &FDATEA)

    /*PIO    CHGVAR     VAR(&B) VALUE('*AND FJAODT *LE ' *CAT + +
                         &TDATEA)                              */
   /*PIO*/   CHGVAR     VAR(&B) VALUE(' AND FJAODT  <= ' *CAT +
                         &TDATEA)
   /*PIO*/   CHGVAR     VAR(&E) VALUE(' AND BEJNCD = "TR" AND BEGWST = "C"')


  /*PIO      CHGVAR     VAR(&G) VALUE(&A *BCAT &B)    */
  /*PIO*/    CHGVAR     VAR(&G) VALUE(&A *BCAT &B *BCAT &E)

   /*PIO     OVRDBF     FILE(OPBFCPNU) SHARE(*YES)      +
                                                           +
             OPNQRYF    FILE((OPBFCPNU) (OMFJCPL0)) FORMAT(OPBFCPNU) + +
                          QRYSLT(&G) KEYFLD(*FILE) JFLD((BERMNB +     +
                          FJRMNB))                                  */

  /*PIO*/    OVRDBF     FILE(OPBFCPP ) TOFILE(OPBFCPP) LVLCHK(*NO)
             OPNSQLF    SQL('Select * from OPBFCPP, OMFJCPP JOIN BY +
                          BERMNB.OPBFCPP = FJRMNB.OMFJCPP Where  ' +
                          *BCAT &G *BCAT ' ORDER BY BEBRTX ASC, +
                          BEBKC7 ASC, BEAIC3 ASC, BERMNB ASC, +
                          BEC4NB ASC') OPNID(OPBFCPNU) OPTION(*ALL) +
                          SEQONLY(*NO) RCDFMT(@BFCPTN) +
                          ALWCPY(*IFRQD) MSG(*YES) JTYPE(*INNER) +
                          JORDER(*FILE) /*PIO*/
  /*PIO*/    OVRDBF     FILE(OPBFCPNU) TOFILE(OPBFCPP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB) +
                          SEQONLY(*NO)


             SBDPRTOVR  CMDVAR(&COMMAND) FILE(PMVIPFR$) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) +
                          SAVE(&SAVE)
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)
/********************************************************************/
/* 12/10/2009 LJB E000322                                           */
/* IF EMAIL IS REQUESTED, BUILD THE WORK FILE IN QTEMP. IF IT IS    */
/* ALREADY THERE, CLEAR IT.                                         */
/********************************************************************/
             DLTF       FILE(QTEMP/PNFWCPL0)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PNFWCPL1)
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/PNFWCPP)
             MONMSG     MSGID(CPF0000)

/* CUSTOMER HEADINGS WORKFILE                                       */
             CRTDUPOBJ  OBJ(PNFWCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PNFWCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ  OBJ(PNFWCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CALL       PGM(PMVIPFR) PARM('' &COMP &FDATE &TDATE +
                          &FLAG2 &PAIDYN &EXCLCT)

             IF         COND(&EMAILADDR *NE '            ') THEN(DO)
             EXECUTE    VIEW(PNFWCPPV1) MBROPT(*REPLACE) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADDR) EMLMSG('Freight +
                          Comparison Report for Transfers, Summary')
             ENDDO
FTPSUM:      IF         COND(&DOC8 *NE '        ') THEN(DO)
             CHGVAR     VAR(&EMAILADDR) +
                          VALUE('ftp:download.pork/transportation/' +
                          *CAT &DOC8 *TCAT '.xls')
             EXECUTE    VIEW(PNFWCPPV1) MBROPT(*REPLACE) PCFMT(*XLS) +
                          RECIPIENT(&EMAILADDR)
             ENDDO


             CLOF       OPNID(OPBFCPNU)
   /*PIO     DLTOVR     FILE(OPBFCPNU)   */
             DLTOVR     FILE(OPBFCPNU) LVL(*JOB) /*PIO*/
             ENDDO

 ENDPGM
