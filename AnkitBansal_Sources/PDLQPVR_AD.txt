// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDLQPVR
// ?Date: 14.08.2025 Time: 03:35:06
// ?------------------------------------------------------------------------------------------------

//?USER: Load screen

// DTL.@Yes/No Flag = CND.No
DTL.AAYes_No_Flag = 'N';

//?USER: Validate fields

EXECUTE FUNCTION(RTV Bank Cd f/Lckbx   RT) TYPE(RTVOBJ) FILE(CAEBREP)           AC1623891;
PARAMETER(LCL.Bank_Code);
PARAMETER(DTL.LckBx_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


EXECUTE FUNCTION(VAL Bank Deposit Exist RT) TYPE(RTVOBJ) FILE(PDJ2CPP)          AC1520069;
PARAMETER(LCL.Bank_Code);
PARAMETER(PAR.LckBx_Deposit_Date);
PARAMETER(PAR.LckBx_Deposit_Time);

CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

// Send error message - 'AR Bank Deposit already exists.'
ERROR(USR2040);

ENDIF;

//?USER: Validate relations

CASE;

// IF DTL.@Yes/No Flag is No
IF DTL.AAYes_No_Flag = 'N';

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?USER: User defined action

CASE;

// IF DTL.@Yes/No Flag is Yes
IF DTL.AAYes_No_Flag = 'Y';

//?*** Submit Post to Batch. ***
// Call program PRC Lckbx to A/R Post  XF.
SBMJOB;
CALL PROGRAM(PRC Lckbx to A/R Post  XF) ('PDLMXFR');
PARAMETER(DTL.LckBx_Number);
PARAMETER(DTL.LckBx_Deposit_Date);
PARAMETER(DTL.LckBx_Deposit_Time);
SBMJOBEND;

//?*** Change the status of the Lockbox Deposit Record to posted. ***
EXECUTE FUNCTION(CHG Lockbox Status     CH) TYPE(CHGOBJ) FILE(PDMACPP)          AC1509835;
PARAMETER(DTL.LckBx_Number);
PARAMETER(DTL.LckBx_Deposit_Date);
PARAMETER(DTL.LckBx_Deposit_Time);
PARAMETER('P');

ENDIF;

