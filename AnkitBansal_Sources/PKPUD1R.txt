// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKPUD1R
// ?Date: 14.08.2025 Time: 02:50:08
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);

//?USER: Load detail screen from DBF record

EXECUTE FUNCTION(RTV SF WIP Flag       RT) TYPE(RTVOBJ) FILE(PKCOCPP)           AB1134207;
PARAMETER(1);
PARAMETER(WRK.SF_Cancel_Get_Weight_Flag);
PARAMETER(WRK.SF_PC_WIP_Flag);

CASE;

// IF WRK.SF Cancel Get Weight Flag is Status is on
IF WRK.SF_Cancel_Get_Weight_Flag = '1';

// *MO.VE             1183529*Bu = ilt. in functions
DTL.@Status_Yes_No = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// *MO.VE             1183529*Bu = ilt. in functions
DTL.@Status_Yes_No = 'N';

ENDIF;

EXECUTE FUNCTION(Rtv Hog Class Desc    RT) TYPE(RTVOBJ) FILE(PKA8REP)           AB1127790;
PARAMETER(DTL.HC_Class_Code);
PARAMETER(DTL.HC_Description);

EXECUTE FUNCTION(Rtv Hog Defect Desc   RT) TYPE(RTVOBJ) FILE(PKA7REP)           AB1127787;
PARAMETER(DTL.DF_Defect_Code);
PARAMETER(DTL.DF_Description);

//?USER: Validate detail screen

EXECUTE FUNCTION(Rtv Hog Class Desc    RT) TYPE(RTVOBJ) FILE(PKA8REP)           AB1127790;
PARAMETER(DTL.HC_Class_Code);
PARAMETER(DTL.HC_Description);

EXECUTE FUNCTION(Rtv Hog Defect Desc   RT) TYPE(RTVOBJ) FILE(PKA7REP)           AB1127787;
PARAMETER(DTL.DF_Defect_Code);
PARAMETER(DTL.DF_Description);

CASE;

// IF DTL.@Status (Yes/No) is Yes
IF DTL.@Status_Yes_No = 'Y';

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_Cancel_Get_Weight_Flag = 1;

// IF *OTHERWISE
IF *OTHERWISE;

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_Cancel_Get_Weight_Flag = 0;

ENDIF;

//?USER: Perform confirmed action

EXECUTE FUNCTION(Rtv/Chg Cancel Flag   RT) TYPE(RTVOBJ) FILE(PKCOCPP)           AB1136939;
PARAMETER(1);
PARAMETER(WRK.SF_Cancel_Get_Weight_Flag);

//?USER: Process command keys

//?Simulate Weighing in Process     (For Test until PC comm. done)
CASE;

// IF DTL.*CMD key is CF23
IF DTL.*CMD_key = '23';

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_PC_WIP_Flag = 1;

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_New_Tattoo_Group_Flag = 0;

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_Cancel_Get_Weight_Flag = 0;

EXECUTE FUNCTION(Rtv/Chg Scale Flags   RT) TYPE(RTVOBJ) FILE(PKCOCPP)           AB1136430;
PARAMETER(1);
PARAMETER(WRK.SF_New_Tattoo_Group_Flag);
PARAMETER(WRK.SF_Cancel_Get_Weight_Flag);
PARAMETER(WRK.SF_PC_WIP_Flag);

ENDIF;

//?Simulate Weighing Complete       (For Test until PC comm. done.)
CASE;

// IF DTL.*CMD key is CF24
IF DTL.*CMD_key = '24';

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_PC_WIP_Flag = 0;

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_New_Tattoo_Group_Flag = 0;

// *MO.VE             1183529*Bu = ilt. in functions
WRK.SF_Cancel_Get_Weight_Flag = 0;

EXECUTE FUNCTION(Rtv/Chg Scale Flags   RT) TYPE(RTVOBJ) FILE(PKCOCPP)           AB1136430;
PARAMETER(1);
PARAMETER(WRK.SF_New_Tattoo_Group_Flag);
PARAMETER(WRK.SF_Cancel_Get_Weight_Flag);
PARAMETER(WRK.SF_PC_WIP_Flag);

EXECUTE FUNCTION(Rtv Last Seq Nbr      RT) TYPE(RTVOBJ) FILE(PKB3CPP)           AB1128234;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(WRK.TST_Sequence_Number);

// WRK.TST Sequence Number = WRK.TST Sequence Number + CON.1
WRK.TST_Sequence_Number = WRK.TST_Sequence_Number + 1;

// WRK.TST Wgt = DTL.TW Head Count * CON.250 *
WRK.TST_Wgt = DTL.TW_Head_Count * 250;

EXECUTE FUNCTION(Crt Tattoo Scale Tkt  CR) TYPE(CRTOBJ) FILE(PKB3CPP)           AB1113769;
PARAMETER(DTL.BOH_Company_Number);
PARAMETER(DTL.BOH_Buy_Order_Number);
PARAMETER(DTL.BOL_Load_Number);
PARAMETER(DTL.TH_Tattoo_Number);
PARAMETER(DTL.TH_Kill_Date);
PARAMETER(WRK.TST_Sequence_Number);
PARAMETER(DTL.TW_Head_Count);
PARAMETER(WRK.TST_Wgt);
PARAMETER(JOB.*Job_date);
PARAMETER(JOB.*Job_time);
PARAMETER(*MISSING);
PARAMETER(JOB.*Job_date);
PARAMETER(JOB.*Job_time);
PARAMETER('P');
PARAMETER(DTL.Pen_Company_Number);
PARAMETER(DTL.Pen_Number);
PARAMETER(DTL.RS_User_Changed);
PARAMETER(DTL.RS_Date_Changed);
PARAMETER(DTL.RS_Time_Changed);
PARAMETER(DTL.RS_Record_Status);
PARAMETER(DTL.RS_Job);
PARAMETER(DTL.RS_Program);
PARAMETER(DTL.RS_User_Added);
PARAMETER(DTL.RS_Date_Added);
PARAMETER(DTL.RS_Time_Added);

// *MO.VE             1183529*Bu = ilt. in functions
PAR.Simulate_Weight_Cmplt_Usr = 'Y';

ENDIF;

