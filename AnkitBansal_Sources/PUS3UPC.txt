/*********************************************************************/
/*  PROGRAM:       PUS3UPC                                           */
/*  PROGRAM DESC:  EXC EDI INV W/ NO TEXT CL EXECUTE USER PROGRAM    */
/*  PROGRAMMER:    D.NGUYEN                                          */
/*  DATE:          03/31/2021                                        */
/*  PROJECT ID:    WHD76966 - AHOLD FINANCIAL INVOICE ERRORS AND     */
/*                   NOT GETTING TO EDI.                             */
/*  PURPOSE:       THIS PROGRAM EXECUTES A SQL TO LIST THE           */
/*                 INVOICES THAT DO NOT HAVE THE TEXT FIELD          */
/*                 POPULATED WITH INV810 OR INV880.                  */
/*                                                                   */
/*  NOTE:          Copied SAZFLIB/INVTEXT code to PUS3UPC.           */
/*                 Copied SAZFLIB/ECP001TXT SEQUEL TO PRKPLIB.       */
/*                 Changed JS 'EDINVSQL' to call PUS3UPC instead of  */
/*                 INVTEXT.                                          */
/*                 This is to allow process to run in the standard   */
/*                 PROD / TEST env.                                  */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  CHANGE DESCRIPTION                                   */
/* -------- --- -----------------------------------------------------*/
/* MM/DD/YY xxx Project ID. Desc                                     */
/*                                                                   */
/*********************************************************************/

             PGM

             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10)
             DCL        VAR(&EMLMSG) TYPE(*CHAR) LEN(100)


             CHGVAR     VAR(&EMLMSG) VALUE('ECP001 Invoices not +
                          processed, TEXT Missing')

/*-----------------------------------------------------------------*/
/* Determine If In PROD or TEST Env.                               */
/*-----------------------------------------------------------------*/
             CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

    /* Concat 'TEST' to Email Message If Not PROD Data Library */
             IF         COND(&DATA *NE 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&EMLMSG) VALUE(&EMLMSG *BCAT '- TEST')

             SBMJOB     CMD(EXECUTE VIEW(*LIBL/ECP001TXT) +
                          PCFMT(*XLS) RECIPIENT(PRKDEVISC) +
                          EMLMSG(&EMLMSG)) JOB(EDIINVSQL) +
                          USER(*CURRENT) INLLIBL(*CURRENT) LOG(4 00 +
                          *SECLVL)

             GOTO       CMDLBL(END)
             ENDDO

/*-----------------------------------------------------------------*/
/* Call SEQUEL to Print EDI Invoice List.                          */
/*-----------------------------------------------------------------*/

             SBMJOB     CMD(EXECUTE VIEW(*LIBL/ECP001TXT) +
                          PCFMT(*XLS) +
                          RECIPIENT(EDISUPPORT@SEABOARDFOODS.COM) +
                          EMLMSG(&EMLMSG)) JOB(EDIINVSQL) +
                          USER(*CURRENT) INLLIBL(*CURRENT) LOG(4 00 +
                          *SECLVL)

 END:        ENDPGM
