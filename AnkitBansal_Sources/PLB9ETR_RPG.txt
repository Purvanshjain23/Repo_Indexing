     H/TITLE Edt Delivery Split    ET  Edit transaction
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Maintain DBF header and associated DBF detail records
     H* - DBF header record fields appear on SFL control record
     H* - DBF detail records appear on SFL detail record
     H* - Program functions in two modes : *ADD and *CHANGE
     H* - Existing records may be updated or deleted
     H*   But key changes are not allowed
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Edit transaction
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISJBADE
     H* Date          : 02/05/21  Time  : 16:26:12
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPLB9ETR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Edt Delivery Split    ET  Edit transaction
      *
     FPLAECPLDIF  E           K        DISK
     F                                              KINFDS INFDS1
      * SPN : Delivery Sched Detail     Sch Detail/Split
      *
     FPLANREL1IF  E           K        DISK
      * RTV : Contract Hauler Reason    Retrieval index
      *
     FPKAAREL0IF  E           K        DISK
      * RTV : Source                    Retrieval index
      *
     FPKAFREL0IF  E           K        DISK
      * RTV : Producer Location         Retrieval index
      *
     FPKAXCPL0IF  E           K        DISK
      * RTV : Buy Order Load            Retrieval index
      *
     FPLAGCPL2IF  E           K        DISK
      * RSQ : Delivery Sched Split      Co/KDt/DDt/DTm/Sq/SSq-d
      *
     FPLAECPL0IF  E           K        DISK
      * RTV : Delivery Sched Detail     Retrieval index
      *
     FPLADCPL0IF  E           K        DISK
      * RTV : Delivery Sched Header     Retrieval index
      *
     FPLAECPL1UF  E           K        DISK
      * UPD : Delivery Sched Detail     Update index
      *
     FPLAGCPL0UF  E           K        DISK                      A
      * UPD : Delivery Sched Split      Update index
      *
      * Screen: Field position and name array
     E                    W0BEG   7 016  5 0A
     E                    W0END   7 016  5 0A
     E                    W0NAM   7 016 10
      * Long constants
     E                    @CN#    1  03  6   @CN    25
     I@AGCPJS
      * Delivery Sched Split      Co/KDt/DDt/DTm/Sq/SSq-d
      * Renamed input format fields
     I              AGHONB                          WAHONB
     I              AGE0DT                          WAE0DT
     I              AGE6DT                          WAE6DT
     I              AGAGTH                          WAAGTH
     I              AGHZA1                          WAHZA1
     I              AGH5A1                          WAH5A1
     I              AGKNCD                          WAKNCD
     I              AGKOCD                          WAKOCD
     I              AGLDCD                          WALDCD
     I              AGLECD                          WALECD
     I              AGH6A1                          WAH6A1
     I              AGAAVN                          WAAAVN
     I              AGAADT                          WAAADT
     I              AGAMTM                          WAAMTM
     I              AGAJST                          WAAJST
     I              AGAHVN                          WAAHVN
     I              AGAGVN                          WAAGVN
     I              AGABVN                          WAABVN
     I              AGABDT                          WAABDT
     I              AGABTM                          WAABTM
      *
     I@AECPIG
      * Delivery Sched Detail     Retrieval index
      * Renamed input format fields
     I              AEHONB                          WBHONB
     I              AEE0DT                          WBE0DT
     I              AEE6DT                          WBE6DT
     I              AEAGTH                          WBAGTH
     I              AEHZA1                          WBHZA1
     I              AEH0A1                          WBH0A1
     I              AEH1A1                          WBH1A1
     I              AEJ4CD                          WBJ4CD
     I              AEJ5CD                          WBJ5CD
     I              AELBCD                          WBLBCD
     I              AELCCD                          WBLCCD
     I              AEIOA1                          WBIOA1
     I              AEH2A1                          WBH2A1
     I              AEIJA1                          WBIJA1
     I              AEK9CD                          WBK9CD
     I              AEK8CD                          WBK8CD
     I              AEJ6CD                          WBJ6CD
     I              AEJ7CD                          WBJ7CD
     I              AEMGCD                          WBMGCD
     I              AEW1ST                          WBW1ST
     I              AEW2ST                          WBW2ST
     I              AEH3A1                          WBH3A1
     I              AEMECD                          WBMECD
     I              AEMFCD                          WBMFCD
     I              AEW4ST                          WBW4ST
     I              AEXWST                          WBXWST
     I              AEFRDT                          WBFRDT
     I              AEBOTH                          WBBOTH
     I              AEE7DT                          WBE7DT
     I              AEAHTH                          WBAHTH
     I              AEE8DT                          WBE8DT
     I              AEAITH                          WBAITH
     I              AEXBST                          WBXBST
     I              AEXGST                          WBXGST
     I              AEXPST                          WBXPST
     I              AEXNST                          WBXNST
     I              AEXTST                          WBXTST
     I              AEXLST                          WBXLST
     I              AEW0ST                          WBW0ST
     I              AEYEST                          WBYEST
     I              AEFZDT                          WBFZDT
     I              AEB1TH                          WBB1TH
     I              AEAACD                          WBAACD
     I              AEABCD                          WBABCD
     I              AEAECD                          WBAECD
     I              AEHMNB                          WBHMNB
     I              AEBNNB                          WBBNNB
     I              AEBONB                          WBBONB
     I              AEY0A1                          WBY0A1
     I              AEY1A1                          WBY1A1
     I              AEDGT1                          WBDGT1
     I              AEDHT1                          WBDHT1
     I              AEIISS                          WBIISS
     I              AEAAVN                          WBAAVN
     I              AEAADT                          WBAADT
     I              AEAMTM                          WBAMTM
     I              AEAJST                          WBAJST
     I              AEAHVN                          WBAHVN
     I              AEAGVN                          WBAGVN
     I              AEABVN                          WBABVN
     I              AEABDT                          WBABDT
     I              AEABTM                          WBABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSPLAECPL1
      * UPD : Delivery Sched Detail     Update index
      * Current/previous header format fields
      * Current/previous master file format fields for change control
      *
      *
     I@2DBRC    E DSPLAGCPL0
      * UPD : Delivery Sched Split      Update index
      * Current/previous detail format fields
      * Current/previous master file format fields for change control
      *
      *
     IYARDCS      DS                            275
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                            275
     IYCRDCS      DS                             98
     IYDRDCS      DS                            275
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             15
      * KEY: Delivery Sched Detail     Retrieval index
      * I : RST CC Company Number
     I                                    P   1   20P1HONB
      * I : RST DSH Kill Date
     I                                    P   3   60P1E0DT
      * I : RST DSD Delivery Date
     I                                    P   7  100P1E6DT
      * I : RST DSD Delivery Time
     I                                    P  11  130P1AGTH
      * I : RST DSD Delivery Time Seq
     I                                    P  14  150P1HZA1
     IP2PARM      DS
      * FLD: *Arrays
      * N :  Oms Warehouse Code
     I                                        1   3 P2J8NB
      * N :  Oms Application Code
     I                                        4   9 P2C7CD
      * N :  Oms SalesPerson Code
     I                                       10  12 P2C8CD
      * N :  Oms Allow Multi-Company
     I                                       13  13 P2G8ST
      * N :  Oms Default Printer
     I                                       14  23 P2G9ST
      * N :  Oms Name
     I                                       24  53 P2EUTX
      * N :  Oms System Value Alpha
     I                                       54  93 P2EVTX
      * N :  Oms Access Denied (Y/N)
     I                                       94  94 P2HAST
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Farm Site Invalid.'
      * HRH Farm Site
     I                                    P   1   30ZA0001
      * Message data for 'Farm Site Invalid.'
      * HRH Farm Site
     I                                    P   1   30ZA0002
      * Message data for 'Buildng/room not valid'
      * Message data for 'Buildng/room mult group'
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Delivery S
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Conduct program process
     C                     DO   *HIVAL                     DO
      * Initialize screen
     C                     EXSR ABIZSF
      * Set screen bypass indicator
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'Y'       W0BYP   1
     C                     ELSE
     C                     MOVEL'N'       W0BYP
     C                     END
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'                        DO
      * Convert fields to external form
     C                     EXSR MOCV#1
      * Bypass first screen for new transaction
     C           W0BYP     IFNE 'Y'
      * Display screen
     C                     EXSR CAEXFM
     C                     ELSE
      * Ensure all command keys set off
     C                     MOVE *ALL'0'   WKIN30 30
     C                     MOVEAWKIN30    *IN,1
     C                     END
      * Cancel screen bypass indicator
     C                     MOVEL'N'       W0BYP
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG           CAS
      * HOME: Request subfile reload
     C   30                CAS            ADHMKY
     C                     END                             SAC
     C           W0TRN     IFEQ 'Y'
      * Convert header fields to internal form
     C                     EXSR MPCV#1
      * Display next SFL page
     C   27                CAS            BAIZSF
      * Validate screen input
     C                     CAS            DAPRSF
     C                     END                             SAC
     C                     END                             FI
      *
     C                     END                             OD
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
     C                     END                             OD
      *****************************************************************
      /EJECT
     CSR         ABIZSF    BEGSR
      *================================================================
      * Initialize screen
      *================================================================
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  4
     C                     MOVE *ALL'1'   WKIND1  4
     C                     MOVEAWKIND0    *IN,32
     C                     SETOF                     81    *
      * Initialise subfile control
     C                     EXSR MAIZ#1
      * Clear subfile
     C                     SETON                     80    *
     C                     WRITE#SFLCTL
     C                     SETOF                     80    *
      * Reset count of SFL records
     C                     Z-ADD*ZERO     ##RRMX  50
     C                     Z-ADD*ZERO     ##RR    50
     C                     MOVEL'KEY'     W0SCR   3
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
     C                     MOVEL'Y'       W0TRN   1
     C                     MOVEL'Y'       W0FST   1
      *================================================================
     CSR         ABEXIT    ENDSR
      /EJECT
     CSR         ADHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN   1
      *================================================================
     CSR         ADEXIT    ENDSR
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Fill remainder of subfile page with blank records
      *================================================================
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,32
      * Load subfile
     C                     Z-ADD##RRMX    ##RR    50
     C           1         DO   ##SFPG                     DO
     C                     ADD  1         ##RR
     C                     EXSR MDIZ#2
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           ##RR      DIV  ##SFPG    WK5N0   50
     C                     MVR            WK5N0          90*
     C  N90                END                             OD
      * Save highest SFL record number used
     C                     Z-ADD##RR      ##RRMX     81    *
     C           ##RRMX    SUB  ##SFPG    ##SFRC
     C                     ADD  1         ##SFRC
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN88     ORNE CAIN88
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN88     CAIN88  1
     C                     MOVE *IN81     CAIN81  1
     C                     MOVELW0SCR     W0GRP   1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END                              UOD
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSF    BEGSR
      *================================================================
      * Process subfile records
      *================================================================
      * Confirm/update is not deferred
     C           YPMTFD    IFEQ *BLANKS
     C                     MOVEL'N'       W0DCF   1
     C                     END
     C           YPMTFD    IFEQ *BLANKS
      * Initialise derived fields
     C                     EXSR MJIZ#2
     C                     END
      * Validate SFL control keys if input
     C           W0SCR     IFEQ 'KEY'
     C                     EXSR DCVLH1
      * QUIT if error:
     C   99                GOTO DAEXIT
     C                     END
      * If keys only, now get the rest of the data
     C           W0SCR     IFEQ 'KEY'
     C           YPMTFD    ANDEQ*BLANKS
     C                     EXSR DBLDSF
     C                     GOTO DAEXIT
     C                     END
      * Validate SFL control non keys
     C                     EXSR DEVLH2
      *................................................................
      * Process subfile records
     C           *IN81     IFEQ '1'
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,32
     C                     SETOF                     98    No errors
      * Copy header keys to detail record for validation
     C                     Z-ADD#1HONB    #2HONB           CC Company Numb
     C                     Z-ADD#1E0DT    #2E0DT           DSH Kill Date
     C                     Z-ADD#1E6DT    #2E6DT           DSD Delivery Da
     C                     Z-ADD#1AGTH    #2AGTH           DSD Delivery Ti
     C                     Z-ADD#1HZA1    #2HZA1           DSD Delivery Ti
      * Check for null record
     C                     EXSR DGNLRC
     C           W0NLR     IFEQ 'Y'
      * Null record - clear value mapped fields
     C                     EXSR MQIZ#2
     C                     END
      * Validate non-null subfile record
     C           W0NLR     IFEQ 'N'
      * But ignore if marked as deleted
     C           #2SEL     ANDNE'4'
     C           ##RR      OREQ YPMRRN
      * But ignore if marked as deleted
     C           #2SEL     ANDNE'4'
     C                     EXSR DIVLSF
     C                     END
      * If SFLRCD invalid, note that errors present
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C                     END                             FI
      *................................................................
      * Quit if subfile invalid:
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * USER: Validate totals
      * CASE: CTL.Load Count CNT is Eq Zero
     C           #CIQA1    IFEQ *ZERO                      *IF
     C                     MOVEL'F'       #1W2ST           DSD Full/Split
     C                     ELSE
      * CASE: CTL.Load Count CNT is GT 1
     C           #CIQA1    IFGT 1                          *IF
     C                     MOVEL'S'       #1W2ST           DSD Full/Split
     C                     MOVEL*BLANK    #1J4CD           DSD Building
     C                     MOVEL*BLANK    #1J5CD           DSD Room
     C                     MOVEL*BLANK    #1LBCD           DSD Sire Line C
     C                     MOVEL*BLANK    #1LCCD           DSD Hog Group C
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Split Invalid'
     C                     MOVEL'PRK1074' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Quit if user errors signalled
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Update DBF from screen
     C                     EXSR EAUPFL
      * Quit if DBF updates failed:
     C           *IN99     CABEQ'1'       DAEXIT
      *
      * USER: Process command keys
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
      * Exit after successful update
     C                     EXSR ZXEXPG
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBLDSF    BEGSR
      *================================================================
      * Load screen fields from DBF
      *================================================================
      * Load subfile control from DBF
     C                     EXSR MBFL#1
      * Validate SFL control non keys
     C                     EXSR DFVLH3
     C           YPMTFD    IFEQ *BLANKS
      * USER: Load existing header
      * CASE: CTL.DSD Source Type is Internal
     C           #1W0ST    IFEQ 'I'                        *IF
      * CASE: LCL.MTech Live Yes or No is No MTech not Live
     C           YL0001    IFEQ 'N'                        *IF
      * Val HPS Farm Site DS  UP - STR HPS Interface  * 
     C                     CALL 'HP271'                90  Val HPS Farm Si
     C           YL0002    PARM *BLANK    WQ0001  7        Return Code USR
     C                     PARM #1H1A1    WQ0002  50       HRH Farm Site
     C           #CKQTX    PARM *BLANK    WQ0003 25        Farm site Name
     C           WUDRTX    PARM *BLANK    WQ0004  3        State
     C           #1K9CD    PARM *BLANK    WQ0005  5        DT Transportati
     C           #CLICD    PARM *BLANK    WQ0006  5        DT Trucker Code
     C           #CJ9CD    PARM *BLANK    WQ0007  5        DT Loading Crew
     C           #CJ8CD    PARM *BLANK    WQ0008  5        DT Driver
     C                     PARM *BLANK    WQ0009 20        MTech Farm Site
     C                     PARM *BLANK    WQ0010 20        MTech Trucker R
     C                     PARM *BLANK    WQ0011 20        MTech Load Crew
     C                     PARM *BLANK    WQ0012 20        MTech Driver Re
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP271'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
     C                     END
     C                     ELSE
      * CASE: LCL.MTech Live Yes or No is Yes MTech is Live
     C           YL0001    IFEQ 'Y'                        *IF
      * Val HPS Farm Site DS  UP - STR HPS Interface  * 
     C                     CALL 'HP271'                90  Val HPS Farm Si
     C           YL0002    PARM *BLANK    WQ0013  7        Return Code USR
     C                     PARM #1H1A1    WQ0014  50       HRH Farm Site
     C           #CKQTX    PARM *BLANK    WQ0015 25        Farm site Name
     C           WUDRTX    PARM *BLANK    WQ0016  3        State
     C           #1K9CD    PARM *BLANK    WQ0017  5        DT Transportati
     C           #CLICD    PARM *BLANK    WQ0018  5        DT Trucker Code
     C           #CJ9CD    PARM *BLANK    WQ0019  5        DT Loading Crew
     C           #CJ8CD    PARM *BLANK    WQ0020  5        DT Driver
     C                     PARM *BLANK    WQ0021 20        MTech Farm Site
     C                     PARM *BLANK    WQ0022 20        MTech Trucker R
     C                     PARM *BLANK    WQ0023 20        MTech Load Crew
     C                     PARM *BLANK    WQ0024 20        MTech Driver Re
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP271'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * Read all DBF detail records for header
      * Read ahead
     C           KSPNH     READE@AGCPJ5                  92*
     C           *IN92     DOWEQ'0'
      * For each DBF detail record read:
     C                     ADD  1         ##RR    50
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,32
      * Initialise and load subfile record from DBF
     C                     EXSR MDIZ#2
     C                     EXSR MEFL#2
     C           YPMTFD    IFEQ *BLANKS
      * USER: Initialize subfile record (old record)
      * RMC 2/15/05 - save for later comparison
     C                     MOVEL#2KNCD    #RK0CD           DT Building
     C                     MOVEL#2KOCD    #RK1CD           DT Room
     C                     END
      * Validate details
     C                     EXSR DJVLSF
      * Output DBF to subfile
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
      * Read next Data record
     C           KSPNH     READE@AGCPJ5                  92*
     C                     END                             WOD
     C                     Z-ADD##RR      ##RRMX     81    *
      * Fill to end of page with blank records
     C           ##RR      DIV  ##SFPG    WK5N0   50
     C                     MVR            WK5N0          90*
     C   90      ##RR      COMP *ZERO                9090  *
     C  N90                EXSR BAIZSF
     C                     MOVEL'DTL'     W0SCR
      * Position subfile on page 1
     C                     Z-ADD1         ##SFRC
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCVLH1    BEGSR
      *================================================================
      * Validate header keys
      *================================================================
      * Check existence of header
     C           YPMTFD    IFEQ *BLANKS
     C                     EXSR DDRDH1
      * If header not found, error
     C           *IN90     IFEQ '1'
     C                     SETON                     99    PC
      * Send message 'Delivery Sched Detail  NF'
     C                     MOVEL'PRK1028' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDRDH1    BEGSR
      *================================================================
      * Read header record
      *================================================================
     C           KSPNH     KLIST
     C                     KFLD           AEHONB           CC Company Numb
     C                     KFLD           AEE0DT           DSH Kill Date
     C                     KFLD           AEE6DT           DSD Delivery Da
     C                     KFLD           AEAGTH           DSD Delivery Ti
     C                     KFLD           AEHZA1           DSD Delivery Ti
      * Setup key
     C                     Z-ADD#1HONB    AEHONB
     C                     Z-ADD#1E0DT    AEE0DT
     C                     Z-ADD#1E6DT    AEE6DT
     C                     Z-ADD#1AGTH    AEAGTH
     C                     Z-ADD#1HZA1    AEHZA1
     C           KSPNH     CHAIN@AECPJ4              90    *
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEVLH2    BEGSR
      *================================================================
      * Validate header non-key fields
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate header non-key fields
      * CASE: CTL.PD Producer Code is SEABOA
     C           #1ABCD    IFEQ @CN,001                    *IF
      * E2423 MTech REGARDLESS This validation should only be done
      * for Seaboard Not on other producers
      * F4=Prompt
      * CASE: CTL.*CMD key is *Prompt
     C           *IN04     IFEQ '1'                        *IF
      * CASE: PGM.*Cursor field <IS> CTL.DSD Farm Site Code
     C           W0CFL     IFEQ '#1H1A1'                   *IF
      * E2423 MTech
      * Can use the same program here for Live or Not Live with Mtech
      * Sel HPS Farm Site     UP - STR HPS Interface  * 
     C                     CALL 'HP5003'               90  Sel HPS Farm Si
     C           WULMST    PARM WULMST    WQ0025  7        Return Code USR
     C           #1H1A1    PARM #1H1A1    WQ0026  50       HRH Farm Site
     C           #CKQTX    PARM #CKQTX    WQ0027 25        Farm site Name
     C                     PARM *BLANK    WQ0028 20        MTech Farm Site
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP5003'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
     C                     END
     C                     END                             *FI
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: LCL.MTech Live Yes or No is No MTech not Live
     C           YL0001    IFEQ 'N'                        *IF
      * Val HPS Farm Site DS  UP - STR HPS Interface  * 
     C                     CALL 'HP271'                90  Val HPS Farm Si
     C           YL0002    PARM *BLANK    WQ0029  7        Return Code USR
     C                     PARM #1H1A1    WQ0030  50       HRH Farm Site
     C           #CKQTX    PARM *BLANK    WQ0031 25        Farm site Name
     C           WUDRTX    PARM *BLANK    WQ0032  3        State
     C           #1K9CD    PARM *BLANK    WQ0033  5        DT Transportati
     C           #CLICD    PARM *BLANK    WQ0034  5        DT Trucker Code
     C           #CJ9CD    PARM *BLANK    WQ0035  5        DT Loading Crew
     C           #CJ8CD    PARM *BLANK    WQ0036  5        DT Driver
     C                     PARM *BLANK    WQ0037 20        MTech Farm Site
     C                     PARM *BLANK    WQ0038 20        MTech Trucker R
     C                     PARM *BLANK    WQ0039 20        MTech Load Crew
     C                     PARM *BLANK    WQ0040 20        MTech Driver Re
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP271'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
     C                     END
      * CASE: LCL.Return Code USR is Error Found
     C           YL0002    IFEQ 'ERROR'                    *IF
      * Setup message data for message
     C                     Z-ADD#1H1A1    ZA0001           DSD Farm Site C
      * Send message 'Farm Site Invalid.'
     C                     MOVEL'PRK0688' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: LCL.MTech Live Yes or No is Yes MTech is Live
     C           YL0001    IFEQ 'Y'                        *IF
      * e2423 QUESTION DELIVERY SPLIT WITH TRANSPORTATION????
      * e2423 I don't think we will have splits in the DELIVERY SCH SPLIT
      * E2423 MTech
      * Rtv HPS Farm Inf-Mtech UP - STR HPS Interface  * 
     C                     CALL 'HP293'                90  Rtv HPS Farm In
     C           YL0002    PARM YL0002    WQ0041  7        *Return code
     C           #CKQTX    PARM *BLANK    WQ0042 25        Farm site Name
     C                     PARM #1H1A1    WQ0043  50       Farm Site USR
     C                     PARM *BLANK    WQ0044  5        HPS FS Comp Rel
     C           WUDRTX    PARM *BLANK    WQ0045  3        State
     C                     PARM *BLANK    WQ0046 25        HPS Farm County
     C                     PARM *BLANK    WQ0047  5        HPS Cell Manage
     C                     PARM *BLANK    WQ0048 25        HPS Cell Manage
     C                     PARM *BLANK    WQ0049 20        MTech Farm Site
     C                     PARM *BLANK    WQ0050 20        MTech Cell Mana
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP293'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
     C                     END
      * CASE: LCL.Return Code USR is Error Found
     C           YL0002    IFEQ 'ERROR'                    *IF
      * Setup message data for message
     C                     Z-ADD#1H1A1    ZA0002           DSD Farm Site C
      * Send message 'Farm Site Invalid.'
     C                     MOVEL'PRK0688' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * Validate relations
     C                     EXSR DFVLH3
      * DSD Farm Site Code required
     C           #1H1A1    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFVLH3    BEGSR
      *================================================================
      * Validate header non-key relations
      *================================================================
      * Check reference to Contract Hauler Reason
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Source
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Producer Location
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      * Check reference to Buy Order Load
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     99    *
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DGNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
      * Existing records are never null
     C           #2OLRC    CABNE*BLANK    DGEXIT
     C           #2KNCD    CABNE*BLANK    DGEXIT           DSS Building
     C           #2KOCD    CABNE*BLANK    DGEXIT           DSS Room
     C           #2H6A1    CABNE*ZERO     DGEXIT           DSS Scheduled H
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         DIVLSF    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record fields
      * CASE: LCL.MTech Live Yes or No is No MTech not Live
     C           YL0001    IFEQ 'N'                        *IF
      * SEL:  Bldng/room
      * CASE: CTL.*CMD key is *Prompt
     C           *IN04     IFEQ '1'                        *IF
      * CASE:
      *  - c1ORc2
      *   |- c1    : PGM.*Cursor field <IS> RCD.DSS Building
      *   |- c2    : PGM.*Cursor field <IS> RCD.DSS Room
      *   '-
     C           W0CSRR    IFEQ ##RR                       *
     C           W0CFL     ANDEQ'#2KNCD'                   *IF
     C           W0CSRR    OREQ ##RR                       *
     C           W0CFL     ANDEQ'#2KOCD'                   *OR
      * Z1Sel HPS Building/RoomUP - STR HPS Interface  * 
     C                     CALL 'HP5950'               90  Z1Sel HPS Build
     C                     PARM #1H1A1    WQ0060  50       DSD Farm Site C
     C                     PARM WUKQTX    WQ0061 25        Farm site Name
     C           #2KNCD    PARM #2KNCD    WQ0062  5        DSD Building
     C           #2KOCD    PARM #2KOCD    WQ0063  5        DSD Room
     C           #2LECD    PARM #2LECD    WQ0064  7        DSD Hog Group C
     C           WULLCD    PARM WULLCD    WQ0065  2        HPS Hog Group S
     C           WULNCD    PARM WULNCD    WQ0066  5        HPS Hog Product
     C           WULMCD    PARM WULMCD    WQ0067  5        HPS Hog Product
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP5950'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     983133*
     C                     SETON                     34    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * VAL:  Building & Room  - rmc 2/15/05 if changed and entered
      * CASE:
      *  - (c3ORc4)AND(c1ORc2)
      *   |- c3    : RCD.DSS Building NE RCD.DT Building
      *   |- c4    : RCD.DSS Room NE RCD.DT Room
      *   |- c1    : RCD.DSS Building is Entered
      *   |- c2    : RCD.DSS Room is Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C                     MOVEL'0'       Y0CX02  1
     C           #2KNCD    IFNE #RK0CD                     *IF
     C           #2KOCD    ORNE #RK1CD                     *OR
     C                     MOVEL'1'       Y0CX02
     C                     END                             *FI
     C           Y0CX02    IFEQ '1'                        *IF
     C                     MOVEL'0'       Y0CX02  1
     C           #2KNCD    IFNE *BLANK                     *IF
     C           #2KOCD    ORNE *BLANK                     *OR
     C                     MOVEL'1'       Y0CX02
     C                     END                             *FI
     C           Y0CX02    IFEQ '1'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Z1Val HPS Building/RoomUP - STR HPS Interface  * 
     C                     CALL 'HP274'                90  Z1Val HPS Build
     C           YL0002    PARM *BLANK    WQ0068  7        Return Code USR
     C                     PARM #1E6DT    WQ0069  70       DT Delivery Dat
     C                     PARM #1H1A1    WQ0070  50       DT Farm Site Co
     C                     PARM #2KNCD    WQ0071  5        DT Building
     C                     PARM #2KOCD    WQ0072  5        DT Room
     C           #2LECD    PARM *BLANK    WQ0073 10        DT Hog Group Re
     C           #2LDCD    PARM *BLANK    WQ0074  5        DT Sire Line Co
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'HP274'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     SETON                     983133*
     C                     SETON                     34    *
     C                     END
      * CASE: LCL.Return Code USR is *Normal
     C           YL0002    IFEQ *BLANK                     *IF
     C                     MOVEL#2KNCD    #RK0CD           DT Building
     C                     MOVEL#2KOCD    #RK1CD           DT Room
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: LCL.Return Code USR is Error Found
     C           YL0002    IFEQ 'ERROR'                    *IF
      * Setup message data for message
      * Send message 'Buildng/room not valid'
     C                     MOVEL'PRK1077' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
      *
     C                     ELSE
      * CASE: LCL.Return Code USR is Multiple group no selectn
     C           YL0002    IFEQ @CN,002                    *IF
      * Setup message data for message
      * Send message 'Buildng/room mult group'
     C                     MOVEL'PRK1129' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * Validate relations
     C                     EXSR DJVLSF
      * DSS Building required
     C           #2KNCD    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9833  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * DSS Room required
     C           #2KOCD    IFEQ *BLANK                     IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9834  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * DSS Scheduled Head required
     C           #2H6A1    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9835  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DIEXIT    ENDSR
      /EJECT
     CSR         DJVLSF    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      *
     C           YPMTFD    IFEQ *BLANKS
      * CALC: Subfile record function fields
     C                     ADD  #2H6A1    #CIVA1           Scheduled Head
     C                     ADD  1         #CIQA1           Load Count CNT
     C                     END
      *================================================================
     CSR         DJEXIT    ENDSR
      /EJECT
     CSR         EAUPFL    BEGSR
      *================================================================
      * Update DBFs from screen
      *================================================================
      * Process header record
      * Change header
     C                     CAS            ECCHHD
     C                     END
      * Quit if header update failed
     C   99                GOTO EAEXIT
      * Process subfile records
     C           1         DO   ##RRMX    ##RR
     C           ##RR      CHAIN#SFLRCD              92    *
     C  N92                DO
      * Setof record error indicators
     C                     MOVEAWKIND0    *IN,32
      * Copy header keys to detail record for update
     C                     Z-ADD#1HONB    #2HONB           CC Company Numb
     C                     Z-ADD#1E0DT    #2E0DT           DSH Kill Date
     C                     Z-ADD#1E6DT    #2E6DT           DSD Delivery Da
     C                     Z-ADD#1AGTH    #2AGTH           DSD Delivery Ti
     C                     Z-ADD#1HZA1    #2HZA1           DSD Delivery Ti
      * Process delete detail request
     C           #2SEL     CASEQ'4'       EGDLLN
      * Process add line request
     C           #2OLRC    CASEQ*BLANK    EEADLN
      * Process change request
     C                     CAS            EFCHLN
     C                     END
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     END                             OD
     C  N92                END                             OD
      *
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         ECCHHD    BEGSR
      *================================================================
      * Change header record
      *================================================================
      * USER: Change header DBF record
      * Chg Split Info        CH - Delivery Sched Detail  * 
     C                     EXSR SACHRC
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    PC
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EEADLN    BEGSR
      *================================================================
      * Add detail record
      *================================================================
      * Ignore line marked as deleted
     C           #2SEL     CABEQ'4'       EEEXIT
      * Check for null record
     C                     EXSR DGNLRC
     C           W0NLR     CABEQ'Y'       EEEXIT
      * USER: Create detail DBF record
      *
     C                     Z-ADD*ZERO     WN0035  30       DSS Split Seque
     C                     MOVEL*BLANK    WN0036 10        RS User Changed
     C                     Z-ADD*ZERO     WN0037  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0038  60       RS Time Changed
     C                     MOVEL*BLANK    WN0039  1        RS Record Statu
     C                     MOVEL*BLANK    WN0040 10        RS Job
     C                     MOVEL*BLANK    WN0041 10        RS Program
     C                     MOVEL*BLANK    WN0042 10        RS User Added
     C                     Z-ADD*ZERO     WN0043  70       RS Date Added
     C                     Z-ADD*ZERO     WN0044  60       RS Time Added
      *
      * Crt Delv Sched Split  IF
      * Rtv Next Seq Num      RT - Delivery Sched Split  * 
     C                     EXSR SBRVGN
      * Crt Delv Sched Split  CR - Delivery Sched Split  * 
     C                     EXSR SCCRRC
      * Rtv Chg Post Sts      RT - Delivery Sched Detail  * 
     C                     EXSR SDRVGN
     C           W0RTN     IFNE *BLANK
      * Set on record error indicators
     C                     MOVEAWKIND1    *IN,32
     C                     SETON                         99*
     C                     ELSE
     C                     MOVEL@2DBRC    #2DBRC
     C                     MOVEL'Y'       #2OLRC
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         EFCHLN    BEGSR
      *================================================================
      * Change detail record
      *================================================================
      * USER: Change detail DBF record
      * Chg Delv Sched Split  CH - Delivery Sched Split  * 
     C                     EXSR SFCHRC
     C           W0RTN     IFNE *BLANK
      * Set on record error indicators
     C                     MOVEAWKIND1    *IN,32
     C                     SETON                         99*
     C                     END
      *================================================================
     CSR         EFEXIT    ENDSR
      /EJECT
     CSR         EGDLLN    BEGSR
      *================================================================
      * Delete detail record
      *================================================================
     C           #2OLRC    CABEQ*BLANK    EGEXIT
      * USER: Delete detail DBF record
      * Del Delv Sched Split  DL - Delivery Sched Split  * 
     C                     EXSR SIDLRC
     C           W0RTN     IFNE *BLANK
      * Set on record error indicators
     C                     MOVEAWKIND1    *IN,32
     C                     SETON                         99*
     C                     END
      *================================================================
     CSR         EGEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
      * Protect detail key fields if existing record
     C           #2OLRC    COMP 'Y'                      82*
     C                     MOVEL'0'       *IN78
     C           #1XLST    IFEQ 'L'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     SETOF                     89    *
     C           W0SCR     COMP 'KEY'                    88*
      * Protect header key fields in change mode, full screen
     C                     SETOF                     87    *
     C  N88N89             SETON                     87    *
     C                     MOVEL'0'       *IN79
     C           #1XLST    IFEQ 'L'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise header fields
      *================================================================
      * Existing record indicator
     C                     MOVEL*BLANK    #1OLRC
     C                     MOVEL*BLANK    #CJ8CD           DT Driver
     C                     MOVEL*BLANK    #CLICD           DT Trucker Code
     C                     MOVEL*BLANK    #CJ9CD           DT Loading Crew
     C                     Z-ADD*ZERO     #1H0A1           DSD Scheduled H
     C                     MOVEL*BLANK    #1J4CD           DSD Building
     C                     MOVEL*BLANK    #1J5CD           DSD Room
     C                     MOVEL*BLANK    #1LBCD           DSD Sire Line C
     C                     MOVEL*BLANK    #1LCCD           DSD Hog Group C
     C                     Z-ADD*ZERO     #1IOA1           DSD Unused Head
     C                     Z-ADD*ZERO     #1H2A1           DSD Scheduled D
     C                     Z-ADD*ZERO     #1IJA1           DSD Scheduled K
     C                     MOVEL*BLANK    #1K9CD           DSD Transportat
     C                     MOVEL*BLANK    #1K8CD           DSD Trucker Cod
     C                     MOVEL*BLANK    #1J6CD           DSD Driver
     C                     MOVEL*BLANK    #1J7CD           DSD Loading Cre
     C                     MOVEL*BLANK    #1MGCD           CHR Code
     C                     MOVEL*BLANK    #1W1ST           DSD Load Type
     C                     MOVEL*BLANK    #1W2ST           DSD Full/Split
     C                     Z-ADD*ZERO     #1H3A1           DSD Movement Nu
     C                     MOVEL*BLANK    #1MECD           DSD Truck ID
     C                     MOVEL*BLANK    #1MFCD           DSD Trailer ID
     C                     MOVEL*BLANK    #1W4ST           DSD Movement Pr
     C                     MOVEL*BLANK    #1XWST           DSD Sched Route
     C                     Z-ADD*ZERO     #1FRDT           DSD Sched Route
     C                     Z-ADD*ZERO     #1BOTH           DSD Sched Route
     C                     Z-ADD*ZERO     #1E7DT           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     #1AHTH           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     #1E8DT           DSD Sch Start L
     C                     Z-ADD*ZERO     #1AITH           DSD Sch Start L
     C                     MOVEL*BLANK    #1XBST           DSD Receiving S
     C                     MOVEL*BLANK    #1XGST           DSD Kill Shift
     C                     MOVEL*BLANK    #1XPST           DSD BOL Kill Sh
     C                     MOVEL*BLANK    #1XNST           DSD HPS Post St
     C                     MOVEL*BLANK    #1XTST           DSD HPE Post St
     C                     MOVEL*BLANK    #1XLST           DSD Lock Status
     C                     MOVEL*BLANK    #1W0ST           DSD Source Type
     C                     MOVEL*BLANK    #1YEST           DSD Transfer St
     C                     Z-ADD*ZERO     #1FZDT           DSD Unused Date
     C                     Z-ADD*ZERO     #1B1TH           DSD Unused Time
     C                     MOVEL*BLANK    #1AACD           SR Source Code
     C                     MOVEL*BLANK    #1ABCD           PD Producer Cod
     C                     MOVEL*BLANK    #1AECD           PL Location Cod
     C                     Z-ADD*ZERO     #1HMNB           BOH Company Num
     C                     Z-ADD*ZERO     #1BNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     #1BONB           BOL Load Number
     C                     Z-ADD*ZERO     #1Y0A1           DSD PRD Srv Bat
     C                     Z-ADD*ZERO     #1Y1A1           DSD PRD Srv Sch
     C                     MOVEL*BLANK    #1DGT1           DSD Ref 1
     C                     MOVEL*BLANK    #1DHT1           DSD Ref 2
     C                     MOVEL*BLANK    #1IISS           DSD Ref Status
     C                     MOVEL*BLANK    #1AAVN           RS User Changed
     C                     Z-ADD*ZERO     #1AADT           RS Date Changed
     C                     Z-ADD*ZERO     #1AMTM           RS Time Changed
     C                     MOVEL*BLANK    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1AHVN           RS Job
     C                     MOVEL*BLANK    #1AGVN           RS Program
     C                     MOVEL*BLANK    #1ABVN           RS User Added
     C                     Z-ADD*ZERO     #1ABDT           RS Date Added
     C                     Z-ADD*ZERO     #1ABTM           RS Time Added
     C                     Z-ADD*ZERO     #CIQA1           Load Count CNT
     C                     Z-ADDP1HONB    #1HONB           CC Company Numb
     C                     Z-ADDP1E6DT    #1E6DT           DSD Delivery Da
      * Clear external version also
     C                     Z-ADD*ZERO     V1E6DT
     C                     Z-ADDP1E0DT    #1E0DT           DSH Kill Date
      * Clear external version also
     C                     Z-ADD*ZERO     V1E0DT
     C                     Z-ADDP1AGTH    #1AGTH           DSD Delivery Ti
     C                     Z-ADDP1HZA1    #1HZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     #1H1A1           DSD Farm Site C
     C                     MOVEL*BLANK    #CKQTX           Farm site Name
     C                     Z-ADD*ZERO     #CIVA1           Scheduled Head
      * Check restriction within
     C                     EXSR VECKRL
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move header DBF record fields to header screen
      *================================================================
      * Existing record indicator
     C                     MOVEL'Y'       #1OLRC
     C                     Z-ADDAEH0A1    #1H0A1           DSD Scheduled H
     C                     MOVELAEJ4CD    #1J4CD           DSD Building
     C                     MOVELAEJ5CD    #1J5CD           DSD Room
     C                     MOVELAELBCD    #1LBCD           DSD Sire Line C
     C                     MOVELAELCCD    #1LCCD           DSD Hog Group C
     C                     Z-ADDAEIOA1    #1IOA1           DSD Unused Head
     C                     Z-ADDAEH2A1    #1H2A1           DSD Scheduled D
     C                     Z-ADDAEIJA1    #1IJA1           DSD Scheduled K
     C                     MOVELAEK9CD    #1K9CD           DSD Transportat
     C                     MOVELAEK8CD    #1K8CD           DSD Trucker Cod
     C                     MOVELAEJ6CD    #1J6CD           DSD Driver
     C                     MOVELAEJ7CD    #1J7CD           DSD Loading Cre
     C                     MOVELAEMGCD    #1MGCD           CHR Code
     C                     MOVELAEW1ST    #1W1ST           DSD Load Type
     C                     MOVELAEW2ST    #1W2ST           DSD Full/Split
     C                     Z-ADDAEH3A1    #1H3A1           DSD Movement Nu
     C                     MOVELAEMECD    #1MECD           DSD Truck ID
     C                     MOVELAEMFCD    #1MFCD           DSD Trailer ID
     C                     MOVELAEW4ST    #1W4ST           DSD Movement Pr
     C                     MOVELAEXWST    #1XWST           DSD Sched Route
     C                     Z-ADDAEFRDT    #1FRDT           DSD Sched Route
     C                     Z-ADDAEBOTH    #1BOTH           DSD Sched Route
     C                     Z-ADDAEE7DT    #1E7DT           DSD Sch Farm Ar
     C                     Z-ADDAEAHTH    #1AHTH           DSD Sch Farm Ar
     C                     Z-ADDAEE8DT    #1E8DT           DSD Sch Start L
     C                     Z-ADDAEAITH    #1AITH           DSD Sch Start L
     C                     MOVELAEXBST    #1XBST           DSD Receiving S
     C                     MOVELAEXGST    #1XGST           DSD Kill Shift
     C                     MOVELAEXPST    #1XPST           DSD BOL Kill Sh
     C                     MOVELAEXNST    #1XNST           DSD HPS Post St
     C                     MOVELAEXTST    #1XTST           DSD HPE Post St
     C                     MOVELAEXLST    #1XLST           DSD Lock Status
     C                     MOVELAEW0ST    #1W0ST           DSD Source Type
     C                     MOVELAEYEST    #1YEST           DSD Transfer St
     C                     Z-ADDAEFZDT    #1FZDT           DSD Unused Date
     C                     Z-ADDAEB1TH    #1B1TH           DSD Unused Time
     C                     MOVELAEAACD    #1AACD           SR Source Code
     C                     MOVELAEABCD    #1ABCD           PD Producer Cod
     C                     MOVELAEAECD    #1AECD           PL Location Cod
     C                     Z-ADDAEHMNB    #1HMNB           BOH Company Num
     C                     Z-ADDAEBNNB    #1BNNB           BOH Buy Order N
     C                     Z-ADDAEBONB    #1BONB           BOL Load Number
     C                     Z-ADDAEY0A1    #1Y0A1           DSD PRD Srv Bat
     C                     Z-ADDAEY1A1    #1Y1A1           DSD PRD Srv Sch
     C                     MOVELAEDGT1    #1DGT1           DSD Ref 1
     C                     MOVELAEDHT1    #1DHT1           DSD Ref 2
     C                     MOVELAEIISS    #1IISS           DSD Ref Status
     C                     MOVELAEAAVN    #1AAVN           RS User Changed
     C                     Z-ADDAEAADT    #1AADT           RS Date Changed
     C                     Z-ADDAEAMTM    #1AMTM           RS Time Changed
     C                     MOVELAEAJST    #1AJST           RS Record Statu
     C                     MOVELAEAHVN    #1AHVN           RS Job
     C                     MOVELAEAGVN    #1AGVN           RS Program
     C                     MOVELAEABVN    #1ABVN           RS User Added
     C                     Z-ADDAEABDT    #1ABDT           RS Date Added
     C                     Z-ADDAEABTM    #1ABTM           RS Time Added
     C                     Z-ADDAEHONB    #1HONB           CC Company Numb
     C                     Z-ADDAEE6DT    #1E6DT           DSD Delivery Da
     C                     Z-ADDAEE0DT    #1E0DT           DSH Kill Date
     C                     Z-ADDAEAGTH    #1AGTH           DSD Delivery Ti
     C                     Z-ADDAEHZA1    #1HZA1           DSD Delivery Ti
     C                     Z-ADDAEH1A1    #1H1A1           DSD Farm Site C
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#2    BEGSR
      *================================================================
      * Initialise screen detail record
      *================================================================
      * Existing record indicator
     C                     MOVEL*BLANK    #2OLRC
     C                     Z-ADD#1HONB    #2HONB           CC Company Numb
     C                     Z-ADD#1E0DT    #2E0DT           DSH Kill Date
     C                     Z-ADD#1E6DT    #2E6DT           DSD Delivery Da
     C                     Z-ADD#1AGTH    #2AGTH           DSD Delivery Ti
     C                     Z-ADD#1HZA1    #2HZA1           DSD Delivery Ti
     C                     MOVEL*BLANK    #RK0CD           DT Building
     C                     MOVEL*BLANK    #RK1CD           DT Room
     C                     MOVEL*BLANK    #2AAVN           RS User Changed
     C                     Z-ADD*ZERO     #2AADT           RS Date Changed
     C                     Z-ADD*ZERO     #2AMTM           RS Time Changed
     C                     MOVEL*BLANK    #2AJST           RS Record Statu
     C                     MOVEL*BLANK    #2AHVN           RS Job
     C                     MOVEL*BLANK    #2AGVN           RS Program
     C                     MOVEL*BLANK    #2ABVN           RS User Added
     C                     Z-ADD*ZERO     #2ABDT           RS Date Added
     C                     Z-ADD*ZERO     #2ABTM           RS Time Added
     C                     MOVEL*BLANK    #2SEL            *SFLSEL
     C                     MOVEL*BLANK    #2KNCD           DSS Building
     C                     MOVEL*BLANK    #2KOCD           DSS Room
     C                     Z-ADD*ZERO     #2H6A1           DSS Scheduled H
     C                     MOVEL*BLANK    #2LDCD           DSS Sire Line C
     C                     MOVEL*BLANK    #2LECD           DSS Hog Group C
     C                     Z-ADD*ZERO     #2H5A1           DSS Split Seque
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         MEFL#2    BEGSR
      *================================================================
      * Load screen detail record
      *================================================================
      * Existing record indicator
     C                     MOVEL'Y'       #2OLRC
     C                     Z-ADDAGHONB    #2HONB           CC Company Numb
     C                     Z-ADDAGE0DT    #2E0DT           DSH Kill Date
     C                     Z-ADDAGE6DT    #2E6DT           DSD Delivery Da
     C                     Z-ADDAGAGTH    #2AGTH           DSD Delivery Ti
     C                     Z-ADDAGHZA1    #2HZA1           DSD Delivery Ti
     C                     MOVELAGAAVN    #2AAVN           RS User Changed
     C                     Z-ADDAGAADT    #2AADT           RS Date Changed
     C                     Z-ADDAGAMTM    #2AMTM           RS Time Changed
     C                     MOVELAGAJST    #2AJST           RS Record Statu
     C                     MOVELAGAHVN    #2AHVN           RS Job
     C                     MOVELAGAGVN    #2AGVN           RS Program
     C                     MOVELAGABVN    #2ABVN           RS User Added
     C                     Z-ADDAGABDT    #2ABDT           RS Date Added
     C                     Z-ADDAGABTM    #2ABTM           RS Time Added
     C                     MOVELAGKNCD    #2KNCD           DSS Building
     C                     MOVELAGKOCD    #2KOCD           DSS Room
     C                     Z-ADDAGH6A1    #2H6A1           DSS Scheduled H
     C                     MOVELAGLDCD    #2LDCD           DSS Sire Line C
     C                     MOVELAGLECD    #2LECD           DSS Hog Group C
     C                     Z-ADDAGH5A1    #2H5A1           DSS Split Seque
      * Update saved record image
     C                     MOVEL@2DBRC    #2DBRC
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         MJIZ#2    BEGSR
      *================================================================
      * Initialise derived fields
      *================================================================
     C                     Z-ADD*ZERO     #CIQA1           Load Count CNT
     C                     Z-ADD*ZERO     #CIVA1           Scheduled Head
      *================================================================
     CSR         MJEXIT    ENDSR
      /EJECT
     CSR         MOCV#1    BEGSR
      *================================================================
      * Convert control fields into external form
      *================================================================
      * Convert DSD Delivery Date to display format
      * Convert date
     C           1000000   ADD  #1E6DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1E6DT
      * Convert DSH Kill Date to display format
      * Convert date
     C           1000000   ADD  #1E0DT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    V1E0DT
      *================================================================
     CSR         MOEXIT    ENDSR
      /EJECT
     CSR         MPCV#1    BEGSR
      *================================================================
      * Convert control fields into internal form
      *================================================================
      * Quit if only keys available
     C           W0SCR     CABEQ'KEY'     MPEXIT
      *================================================================
     CSR         MPEXIT    ENDSR
      /EJECT
     CSR         MQIZ#2    BEGSR
      *================================================================
      * Clear value mapped fields
      *================================================================
      *================================================================
     CSR         MQEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Chg Split Info        CH - Delivery Sched Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  20       DSD Scheduled H
     C                     Z-ADD*ZERO     WN0002  30       DSD Unused Head
     C                     Z-ADD*ZERO     WN0003  30       DSD Scheduled K
     C                     MOVEL*BLANK    WN0004  2        DSD Load Type
     C                     Z-ADD*ZERO     WN0005  70       DSD Movement Nu
     C                     MOVEL*BLANK    WN0006  1        DSD Movement Pr
     C                     MOVEL*BLANK    WN0007  1        DSD Sched Route
     C                     Z-ADD*ZERO     WN0008  70       DSD Sched Route
     C                     Z-ADD*ZERO     WN0009  40       DSD Sched Route
     C                     Z-ADD*ZERO     WN0010  70       DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WN0011  40       DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WN0012  70       DSD Sch Start L
     C                     Z-ADD*ZERO     WN0013  40       DSD Sch Start L
     C                     MOVEL*BLANK    WN0014  1        DSD Receiving S
     C                     MOVEL*BLANK    WN0015  1        DSD Kill Shift
     C                     MOVEL*BLANK    WN0016  1        DSD BOL Kill Sh
     C                     MOVEL*BLANK    WN0017  1        DSD HPS Post St
     C                     MOVEL*BLANK    WN0018  1        DSD HPE Post St
     C                     MOVEL*BLANK    WN0019  1        DSD Lock Status
     C                     MOVEL*BLANK    WN0020  4        DSD Transfer St
     C                     Z-ADD*ZERO     WN0021  70       DSD Unused Date
     C                     Z-ADD*ZERO     WN0022  40       DSD Unused Time
     C                     Z-ADD*ZERO     WN0023  30       BOH Company Num
     C                     Z-ADD*ZERO     WN0024  70       BOH Buy Order N
     C                     Z-ADD*ZERO     WN0025  50       BOL Load Number
     C                     MOVEL*BLANK    WN0026 10        RS User Changed
     C                     Z-ADD*ZERO     WN0027  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0028  60       RS Time Changed
     C                     MOVEL*BLANK    WN0029  1        RS Record Statu
     C                     MOVEL*BLANK    WN0030 10        RS Job
     C                     MOVEL*BLANK    WN0031 10        RS Program
     C                     MOVEL*BLANK    WN0032 10        RS User Added
     C                     Z-ADD*ZERO     WN0033  70       RS Date Added
     C                     Z-ADD*ZERO     WN0034  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @AECPIH
     C                     Z-ADD#1HONB    AEHONB           CC Company Numb
     C                     Z-ADD#1E0DT    AEE0DT           DSH Kill Date
     C                     Z-ADD#1E6DT    AEE6DT           DSD Delivery Da
     C                     Z-ADD#1AGTH    AEAGTH           DSD Delivery Ti
     C                     Z-ADD#1HZA1    AEHZA1           DSD Delivery Ti
      *
     C           KLCHSA    KLIST
     C                     KFLD           AEHONB           CC Company Numb
     C                     KFLD           AEE0DT           DSH Kill Date
     C                     KFLD           AEE6DT           DSD Delivery Da
     C                     KFLD           AEAGTH           DSD Delivery Ti
     C                     KFLD           AEHZA1           DSD Delivery Ti
     C           KLCHSA    CHAIN@AECPIH              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAECPL1'MDACP
     C                     MOVEL'@AECPIH' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SAEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKPLAECPL1               91  *
     C                     GOTO SAEXIT
     C                     ENDIF                           FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YARDCS
      * Move non-key fields to @AECPIH
     C                     Z-ADD#1H1A1    AEH1A1           DSD Farm Site C
     C                     MOVEL#1J4CD    AEJ4CD    P      DSD Building
     C                     MOVEL#1J5CD    AEJ5CD    P      DSD Room
     C                     MOVEL#1LBCD    AELBCD    P      DSD Sire Line C
     C                     MOVEL#1LCCD    AELCCD    P      DSD Hog Group C
     C                     Z-ADD#CIVA1    AEH2A1           DSD Scheduled D
     C                     MOVEL#1K9CD    AEK9CD    P      DSD Transportat
     C                     MOVEL#CLICD    AEK8CD    P      DSD Trucker Cod
     C                     MOVEL#CJ8CD    AEJ6CD    P      DSD Driver
     C                     MOVEL#CJ9CD    AEJ7CD    P      DSD Loading Cre
     C                     MOVEL#1MGCD    AEMGCD    P      CHR Code
     C                     MOVEL#1W2ST    AEW2ST    P      DSD Full/Split
     C                     MOVEL#1MECD    AEMECD    P      DSD Truck ID
     C                     MOVEL#1MFCD    AEMFCD    P      DSD Trailer ID
     C                     MOVEL'I'       AEW0ST    P      DSD Source Type
     C                     MOVEL'SBD'     AEAACD    P      SR Source Code
     C                     MOVEL@CN,001   AEABCD    P      PD Producer Cod
     C                     MOVEL'SB01'    AEAECD    P      PL Location Cod
     C                     Z-ADD#1Y0A1    AEY0A1           DSD PRD Srv Bat
     C                     Z-ADD#1Y1A1    AEY1A1           DSD PRD Srv Sch
     C                     MOVEL#1DGT1    AEDGT1    P      DSD Ref 1
     C                     MOVEL#1DHT1    AEDHT1    P      DSD Ref 2
     C                     MOVEL#1IISS    AEIISS    P      DSD Ref Status
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     AEAAVN           RS User Changed
     C                     Z-ADD##JDT     AEAADT           RS Date Changed
     C                     Z-ADD##JTM     AEAMTM           RS Time Changed
     C                     MOVEL##JOB     AEAHVN           RS Job
     C                     MOVEL##PGM     AEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AECPIH                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAECPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Next Seq Num      RT - Delivery Sched Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHONB    WQSB01           CC Company Numb
     C           *LIKE     DEFN WAE0DT    WQSB02           DSH Kill Date
     C           *LIKE     DEFN WAE6DT    WQSB03           DSD Delivery Da
     C           *LIKE     DEFN WAAGTH    WQSB04           DSD Delivery Ti
     C           *LIKE     DEFN WAHZA1    WQSB05           DSD Delivery Ti
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           CC Company Numb
     C                     KFLD           WQSB02           DSH Kill Date
     C                     KFLD           WQSB03           DSD Delivery Da
     C                     KFLD           WQSB04           DSD Delivery Ti
     C                     KFLD           WQSB05           DSD Delivery Ti
      * Setup key
     C                     Z-ADD#2HONB    WQSB01           CC Company Numb
     C                     Z-ADD#2E0DT    WQSB02           DSH Kill Date
     C                     Z-ADD#2E6DT    WQSB03           DSD Delivery Da
     C                     Z-ADD#2AGTH    WQSB04           DSD Delivery Ti
     C                     Z-ADD#2HZA1    WQSB05           DSD Delivery Ti
      * Establish starting position
     C           KRSSB     SETLL@AGCPJS                    *
     C           KRSSB     READE@AGCPJS                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK1032' W0RTN   7
      * USER: Processing if Data record not found
     C                     Z-ADD1         WN0035           DSS Split Seque
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C           WAH5A1    ADD  1         WN0035           DSS Split Seque
     C                     GOTO SBEXIT                     *QUIT
     C           KRSSB     READE@AGCPJS                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Crt Delv Sched Split  CR - Delivery Sched Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGCPIL
     C                     Z-ADD#2HONB    AGHONB           CC Company Numb
     C                     Z-ADD#2E0DT    AGE0DT           DSH Kill Date
     C                     Z-ADD#2E6DT    AGE6DT           DSD Delivery Da
     C                     Z-ADD#2AGTH    AGAGTH           DSD Delivery Ti
     C                     Z-ADD#2HZA1    AGHZA1           DSD Delivery Ti
     C                     Z-ADDWN0035    AGH5A1           DSS Split Seque
     C                     MOVEL#2KNCD    AGKNCD           DSS Building
     C                     MOVEL#2KOCD    AGKOCD           DSS Room
     C                     MOVEL#2LDCD    AGLDCD           DSS Sire Line C
     C                     MOVEL#2LECD    AGLECD           DSS Hog Group C
     C                     Z-ADD#2H6A1    AGH6A1           DSS Scheduled H
     C                     MOVELWN0036    AGAAVN           RS User Changed
     C                     Z-ADDWN0037    AGAADT           RS Date Changed
     C                     Z-ADDWN0038    AGAMTM           RS Time Changed
     C                     MOVELWN0039    AGAJST           RS Record Statu
     C                     MOVELWN0040    AGAHVN           RS Job
     C                     MOVELWN0041    AGAGVN           RS Program
     C                     MOVELWN0042    AGABVN           RS User Added
     C                     Z-ADDWN0043    AGABDT           RS Date Added
     C                     Z-ADDWN0044    AGABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       AGAJST           RS Record Statu
     C                     MOVEL##USR     AGABVN           RS User Added
     C                     Z-ADD##JDT     AGABDT           RS Date Added
     C                     Z-ADD##JTM     AGABTM           RS Time Added
     C                     MOVEL##PGM     AGAGVN           RS Program
     C                     MOVEL##JOB     AGAHVN           RS Job
     C           KLCRSC    KLIST
     C                     KFLD           AGHONB           CC Company Numb
     C                     KFLD           AGE0DT           DSH Kill Date
     C                     KFLD           AGE6DT           DSD Delivery Da
     C                     KFLD           AGAGTH           DSD Delivery Ti
     C                     KFLD           AGHZA1           DSD Delivery Ti
     C                     KFLD           AGH5A1           DSS Split Seque
      * Check for duplicate primary key
     C           KLCRSC    SETLL@AGCPIL                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK1033' W0RTN   7
      * Send message 'Delivery Sched Split   EX'
     C                     MOVEL'PRK1033' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C                     WRITE@AGCPIL                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Chg Post Sts      RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C                     KFLD           WBE0DT           DSH Kill Date
     C                     KFLD           WBE6DT           DSD Delivery Da
     C                     KFLD           WBAGTH           DSD Delivery Ti
     C                     KFLD           WBHZA1           DSD Delivery Ti
      * Setup key
     C                     Z-ADD#2HONB    WBHONB           CC Company Numb
     C                     Z-ADD#2E0DT    WBE0DT           DSH Kill Date
     C                     Z-ADD#2E6DT    WBE6DT           DSD Delivery Da
     C                     Z-ADD#2AGTH    WBAGTH           DSD Delivery Ti
     C                     Z-ADD#2HZA1    WBHZA1           DSD Delivery Ti
      * Establish starting position
     C           KRSSD     CHAIN@AECPIG              90    *
      * Data record not found
     C   90                MOVEL'PRK1028' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.DSD HPS Post Status is Error
      *   |- c2    : DB1.DSD HPS Post Status is Posted
      *   '-
     C           WBXNST    IFEQ 'E'                        *IF
     C           WBXNST    OREQ 'P'                        *OR
     C                     MOVELWBW4ST    YL0003           DSD Movement Pr
      * CASE: DB1.DSD Movement Printed is Printed
     C           WBW4ST    IFEQ 'P'                        *IF
     C                     MOVEL'R'       YL0003           DSD Movement Pr
     C                     END                             *FI
      * Chg Delv Sched Dtl    CH - Delivery Sched Detail  * 
     C                     EXSR SECHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Chg Delv Sched Dtl    CH - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @AECPIH
     C                     Z-ADDWBHONB    AEHONB           CC Company Numb
     C                     Z-ADDWBE0DT    AEE0DT           DSH Kill Date
     C                     Z-ADDWBE6DT    AEE6DT           DSD Delivery Da
     C                     Z-ADDWBAGTH    AEAGTH           DSD Delivery Ti
     C                     Z-ADDWBHZA1    AEHZA1           DSD Delivery Ti
      *
     C           KLCHSE    KLIST
     C                     KFLD           AEHONB           CC Company Numb
     C                     KFLD           AEE0DT           DSH Kill Date
     C                     KFLD           AEE6DT           DSD Delivery Da
     C                     KFLD           AEAGTH           DSD Delivery Ti
     C                     KFLD           AEHZA1           DSD Delivery Ti
     C           KLCHSE    CHAIN@AECPIH              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAECPL1'MDACP
     C                     MOVEL'@AECPIH' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE @1DBRC    YBRDCS
      * Move non-key fields to @AECPIH
     C                     Z-ADDWBH0A1    AEH0A1           DSD Scheduled H
     C                     Z-ADDWBH1A1    AEH1A1           DSD Farm Site C
     C                     MOVELWBJ4CD    AEJ4CD    P      DSD Building
     C                     MOVELWBJ5CD    AEJ5CD    P      DSD Room
     C                     MOVELWBLBCD    AELBCD    P      DSD Sire Line C
     C                     MOVELWBLCCD    AELCCD    P      DSD Hog Group C
     C                     Z-ADDWBIOA1    AEIOA1           DSD Unused Head
     C                     Z-ADDWBH2A1    AEH2A1           DSD Scheduled D
     C                     Z-ADDWBIJA1    AEIJA1           DSD Scheduled K
     C                     MOVELWBK9CD    AEK9CD    P      DSD Transportat
     C                     MOVELWBK8CD    AEK8CD    P      DSD Trucker Cod
     C                     MOVELWBJ6CD    AEJ6CD    P      DSD Driver
     C                     MOVELWBJ7CD    AEJ7CD    P      DSD Loading Cre
     C                     MOVELWBMGCD    AEMGCD    P      CHR Code
     C                     MOVELWBW1ST    AEW1ST    P      DSD Load Type
     C                     MOVELWBW2ST    AEW2ST    P      DSD Full/Split
     C                     Z-ADDWBH3A1    AEH3A1           DSD Movement Nu
     C                     MOVELWBMECD    AEMECD    P      DSD Truck ID
     C                     MOVELWBMFCD    AEMFCD    P      DSD Trailer ID
     C                     MOVELYL0003    AEW4ST    P      DSD Movement Pr
     C                     MOVELWBXWST    AEXWST    P      DSD Sched Route
     C                     Z-ADDWBFRDT    AEFRDT           DSD Sched Route
     C                     Z-ADDWBBOTH    AEBOTH           DSD Sched Route
     C                     Z-ADDWBE7DT    AEE7DT           DSD Sch Farm Ar
     C                     Z-ADDWBAHTH    AEAHTH           DSD Sch Farm Ar
     C                     Z-ADDWBE8DT    AEE8DT           DSD Sch Start L
     C                     Z-ADDWBAITH    AEAITH           DSD Sch Start L
     C                     MOVELWBXBST    AEXBST    P      DSD Receiving S
     C                     MOVELWBXGST    AEXGST    P      DSD Kill Shift
     C                     MOVELWBXPST    AEXPST    P      DSD BOL Kill Sh
     C                     MOVEL'R'       AEXNST    P      DSD HPS Post St
     C                     MOVELWBXTST    AEXTST    P      DSD HPE Post St
     C                     MOVELWBXLST    AEXLST    P      DSD Lock Status
     C                     MOVELWBW0ST    AEW0ST    P      DSD Source Type
     C                     MOVELWBYEST    AEYEST    P      DSD Transfer St
     C                     Z-ADDWBFZDT    AEFZDT           DSD Unused Date
     C                     Z-ADDWBB1TH    AEB1TH           DSD Unused Time
     C                     MOVELWBAACD    AEAACD    P      SR Source Code
     C                     MOVELWBABCD    AEABCD    P      PD Producer Cod
     C                     MOVELWBAECD    AEAECD    P      PL Location Cod
     C                     Z-ADDWBHMNB    AEHMNB           BOH Company Num
     C                     Z-ADDWBBNNB    AEBNNB           BOH Buy Order N
     C                     Z-ADDWBBONB    AEBONB           BOL Load Number
     C                     Z-ADDWBY0A1    AEY0A1           DSD PRD Srv Bat
     C                     Z-ADDWBY1A1    AEY1A1           DSD PRD Srv Sch
     C                     MOVELWBDGT1    AEDGT1    P      DSD Ref 1
     C                     MOVELWBDHT1    AEDHT1    P      DSD Ref 2
     C                     MOVELWBIISS    AEIISS    P      DSD Ref Status
     C                     MOVELWBAAVN    AEAAVN    P      RS User Changed
     C                     Z-ADDWBAADT    AEAADT           RS Date Changed
     C                     Z-ADDWBAMTM    AEAMTM           RS Time Changed
     C                     MOVELWBAJST    AEAJST    P      RS Record Statu
     C                     MOVELWBAHVN    AEAHVN    P      RS Job
     C                     MOVELWBAGVN    AEAGVN    P      RS Program
     C                     MOVELWBABVN    AEABVN    P      RS User Added
     C                     Z-ADDWBABDT    AEABDT           RS Date Added
     C                     Z-ADDWBABTM    AEABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     AEAAVN           RS User Changed
     C                     Z-ADD##JDT     AEAADT           RS Date Changed
     C                     Z-ADD##JTM     AEAMTM           RS Time Changed
     C                     MOVEL##JOB     AEAHVN           RS Job
     C                     MOVEL##PGM     AEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AECPIH                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAECPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * Chg Delv Sched Split  CH - Delivery Sched Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @AGCPIL
     C                     Z-ADD#2HONB    AGHONB           CC Company Numb
     C                     Z-ADD#2E0DT    AGE0DT           DSH Kill Date
     C                     Z-ADD#2E6DT    AGE6DT           DSD Delivery Da
     C                     Z-ADD#2AGTH    AGAGTH           DSD Delivery Ti
     C                     Z-ADD#2HZA1    AGHZA1           DSD Delivery Ti
     C                     Z-ADD#2H5A1    AGH5A1           DSS Split Seque
      *
     C           KLCHSF    KLIST
     C                     KFLD           AGHONB           CC Company Numb
     C                     KFLD           AGE0DT           DSH Kill Date
     C                     KFLD           AGE6DT           DSD Delivery Da
     C                     KFLD           AGAGTH           DSD Delivery Ti
     C                     KFLD           AGHZA1           DSD Delivery Ti
     C                     KFLD           AGH5A1           DSS Split Seque
     C           KLCHSF    CHAIN@AGCPIL              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAGCPL0'MDACP
     C                     MOVEL'@AGCPIL' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #2DBRC    IFNE @2DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKPLAGCPL0               91  *
     C                     GOTO SFEXIT
     C                     ENDIF                           FI #2DBRC
      * Store record data for null update check
     C                     MOVE @2DBRC    YCRDCS
      * Move non-key fields to @AGCPIL
     C                     MOVEL#2KNCD    AGKNCD    P      DSS Building
     C                     MOVEL#2KOCD    AGKOCD    P      DSS Room
     C                     MOVEL#2LDCD    AGLDCD    P      DSS Sire Line C
     C                     MOVEL#2LECD    AGLECD    P      DSS Hog Group C
     C                     Z-ADD#2H6A1    AGH6A1           DSS Scheduled H
     C                     MOVEL#2AAVN    AGAAVN    P      RS User Changed
     C                     Z-ADD#2AADT    AGAADT           RS Date Changed
     C                     Z-ADD#2AMTM    AGAMTM           RS Time Changed
     C                     MOVEL#2AJST    AGAJST    P      RS Record Statu
     C                     MOVEL#2AHVN    AGAHVN    P      RS Job
     C                     MOVEL#2AGVN    AGAGVN    P      RS Program
     C                     MOVEL#2ABVN    AGABVN    P      RS User Added
     C                     Z-ADD#2ABDT    AGABDT           RS Date Added
     C                     Z-ADD#2ABTM    AGABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           @2DBRC    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     AGAAVN           RS User Changed
     C                     Z-ADD##JDT     AGAADT           RS Date Changed
     C                     Z-ADD##JTM     AGAMTM           RS Time Changed
     C                     MOVEL##JOB     AGAHVN           RS Job
     C                     MOVEL##PGM     AGAGVN           RS Program
      * Rtv Chg Post Sts      RT - Delivery Sched Detail  * 
     C                     EXSR SGRVGN
      * Set PGM.*Record Data Changed flag
     C           @2DBRC    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@AGCPIL                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAGCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@2DBRC    #2DBRC
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Chg Post Sts      RT - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WBHONB           CC Company Numb
     C                     KFLD           WBE0DT           DSH Kill Date
     C                     KFLD           WBE6DT           DSD Delivery Da
     C                     KFLD           WBAGTH           DSD Delivery Ti
     C                     KFLD           WBHZA1           DSD Delivery Ti
      * Setup key
     C                     Z-ADDAGHONB    WBHONB           CC Company Numb
     C                     Z-ADDAGE0DT    WBE0DT           DSH Kill Date
     C                     Z-ADDAGE6DT    WBE6DT           DSD Delivery Da
     C                     Z-ADDAGAGTH    WBAGTH           DSD Delivery Ti
     C                     Z-ADDAGHZA1    WBHZA1           DSD Delivery Ti
      * Establish starting position
     C           KRSSG     CHAIN@AECPIG              90    *
      * Data record not found
     C   90                MOVEL'PRK1028' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE:
      *  - c1ORc2
      *   |- c1    : DB1.DSD HPS Post Status is Error
      *   |- c2    : DB1.DSD HPS Post Status is Posted
      *   '-
     C           WBXNST    IFEQ 'E'                        *IF
     C           WBXNST    OREQ 'P'                        *OR
     C                     MOVELWBW4ST    YL0003           DSD Movement Pr
      * CASE: DB1.DSD Movement Printed is Printed
     C           WBW4ST    IFEQ 'P'                        *IF
     C                     MOVEL'R'       YL0003           DSD Movement Pr
     C                     END                             *FI
      * Chg Delv Sched Dtl    CH - Delivery Sched Detail  * 
     C                     EXSR SHCHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Chg Delv Sched Dtl    CH - Delivery Sched Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @AECPIH
     C                     Z-ADDWBHONB    AEHONB           CC Company Numb
     C                     Z-ADDWBE0DT    AEE0DT           DSH Kill Date
     C                     Z-ADDWBE6DT    AEE6DT           DSD Delivery Da
     C                     Z-ADDWBAGTH    AEAGTH           DSD Delivery Ti
     C                     Z-ADDWBHZA1    AEHZA1           DSD Delivery Ti
      *
     C           KLCHSH    KLIST
     C                     KFLD           AEHONB           CC Company Numb
     C                     KFLD           AEE0DT           DSH Kill Date
     C                     KFLD           AEE6DT           DSD Delivery Da
     C                     KFLD           AEAGTH           DSD Delivery Ti
     C                     KFLD           AEHZA1           DSD Delivery Ti
     C           KLCHSH    CHAIN@AECPIH              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAECPL1'MDACP
     C                     MOVEL'@AECPIH' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE @1DBRC    YDRDCS
      * Move non-key fields to @AECPIH
     C                     Z-ADDWBH0A1    AEH0A1           DSD Scheduled H
     C                     Z-ADDWBH1A1    AEH1A1           DSD Farm Site C
     C                     MOVELWBJ4CD    AEJ4CD    P      DSD Building
     C                     MOVELWBJ5CD    AEJ5CD    P      DSD Room
     C                     MOVELWBLBCD    AELBCD    P      DSD Sire Line C
     C                     MOVELWBLCCD    AELCCD    P      DSD Hog Group C
     C                     Z-ADDWBIOA1    AEIOA1           DSD Unused Head
     C                     Z-ADDWBH2A1    AEH2A1           DSD Scheduled D
     C                     Z-ADDWBIJA1    AEIJA1           DSD Scheduled K
     C                     MOVELWBK9CD    AEK9CD    P      DSD Transportat
     C                     MOVELWBK8CD    AEK8CD    P      DSD Trucker Cod
     C                     MOVELWBJ6CD    AEJ6CD    P      DSD Driver
     C                     MOVELWBJ7CD    AEJ7CD    P      DSD Loading Cre
     C                     MOVELWBMGCD    AEMGCD    P      CHR Code
     C                     MOVELWBW1ST    AEW1ST    P      DSD Load Type
     C                     MOVELWBW2ST    AEW2ST    P      DSD Full/Split
     C                     Z-ADDWBH3A1    AEH3A1           DSD Movement Nu
     C                     MOVELWBMECD    AEMECD    P      DSD Truck ID
     C                     MOVELWBMFCD    AEMFCD    P      DSD Trailer ID
     C                     MOVELYL0003    AEW4ST    P      DSD Movement Pr
     C                     MOVELWBXWST    AEXWST    P      DSD Sched Route
     C                     Z-ADDWBFRDT    AEFRDT           DSD Sched Route
     C                     Z-ADDWBBOTH    AEBOTH           DSD Sched Route
     C                     Z-ADDWBE7DT    AEE7DT           DSD Sch Farm Ar
     C                     Z-ADDWBAHTH    AEAHTH           DSD Sch Farm Ar
     C                     Z-ADDWBE8DT    AEE8DT           DSD Sch Start L
     C                     Z-ADDWBAITH    AEAITH           DSD Sch Start L
     C                     MOVELWBXBST    AEXBST    P      DSD Receiving S
     C                     MOVELWBXGST    AEXGST    P      DSD Kill Shift
     C                     MOVELWBXPST    AEXPST    P      DSD BOL Kill Sh
     C                     MOVEL'R'       AEXNST    P      DSD HPS Post St
     C                     MOVELWBXTST    AEXTST    P      DSD HPE Post St
     C                     MOVELWBXLST    AEXLST    P      DSD Lock Status
     C                     MOVELWBW0ST    AEW0ST    P      DSD Source Type
     C                     MOVELWBYEST    AEYEST    P      DSD Transfer St
     C                     Z-ADDWBFZDT    AEFZDT           DSD Unused Date
     C                     Z-ADDWBB1TH    AEB1TH           DSD Unused Time
     C                     MOVELWBAACD    AEAACD    P      SR Source Code
     C                     MOVELWBABCD    AEABCD    P      PD Producer Cod
     C                     MOVELWBAECD    AEAECD    P      PL Location Cod
     C                     Z-ADDWBHMNB    AEHMNB           BOH Company Num
     C                     Z-ADDWBBNNB    AEBNNB           BOH Buy Order N
     C                     Z-ADDWBBONB    AEBONB           BOL Load Number
     C                     Z-ADDWBY0A1    AEY0A1           DSD PRD Srv Bat
     C                     Z-ADDWBY1A1    AEY1A1           DSD PRD Srv Sch
     C                     MOVELWBDGT1    AEDGT1    P      DSD Ref 1
     C                     MOVELWBDHT1    AEDHT1    P      DSD Ref 2
     C                     MOVELWBIISS    AEIISS    P      DSD Ref Status
     C                     MOVELWBAAVN    AEAAVN    P      RS User Changed
     C                     Z-ADDWBAADT    AEAADT           RS Date Changed
     C                     Z-ADDWBAMTM    AEAMTM           RS Time Changed
     C                     MOVELWBAJST    AEAJST    P      RS Record Statu
     C                     MOVELWBAHVN    AEAHVN    P      RS Job
     C                     MOVELWBAGVN    AEAGVN    P      RS Program
     C                     MOVELWBABVN    AEABVN    P      RS User Added
     C                     Z-ADDWBABDT    AEABDT           RS Date Added
     C                     Z-ADDWBABTM    AEABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     AEAAVN           RS User Changed
     C                     Z-ADD##JDT     AEAADT           RS Date Changed
     C                     Z-ADD##JTM     AEAMTM           RS Time Changed
     C                     MOVEL##JOB     AEAHVN           RS Job
     C                     MOVEL##PGM     AEAGVN           RS Program
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AECPIH                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAECPL1               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIDLRC    BEGSR
      *================================================================
      * Del Delv Sched Split  DL - Delivery Sched Split  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGCPIL
     C                     Z-ADD#2HONB    AGHONB           CC Company Numb
     C                     Z-ADD#2E0DT    AGE0DT           DSH Kill Date
     C                     Z-ADD#2E6DT    AGE6DT           DSD Delivery Da
     C                     Z-ADD#2AGTH    AGAGTH           DSD Delivery Ti
     C                     Z-ADD#2HZA1    AGHZA1           DSD Delivery Ti
     C                     Z-ADD#2H5A1    AGH5A1           DSS Split Seque
      *
     C           KLDLSI    KLIST
     C                     KFLD           AGHONB           CC Company Numb
     C                     KFLD           AGE0DT           DSH Kill Date
     C                     KFLD           AGE6DT           DSD Delivery Da
     C                     KFLD           AGAGTH           DSD Delivery Ti
     C                     KFLD           AGHZA1           DSD Delivery Ti
     C                     KFLD           AGH5A1           DSS Split Seque
     C           KLDLSI    CHAIN@AGCPIL              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAGCPL0'MDACP
     C                     MOVEL'@AGCPIL' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL005.
     C                     MOVEL'LBL005'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SIEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     ENDIF
      *
      * Check for changed record
     C           #2DBRC    IFNE @2DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C           KLDLSI    SETLL@AGCPIL              9091  *
     C                     GOTO SIEXIT
     C                     ENDIF                           FI #2DBRC
      *................................................................
     C                     DELET@AGCPIL                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Get the MTech Live Yes or No
      *================================================================
      * Mtech Live Yes or no
      * Rtv Company Values    XF - STR Order Management Sys  * 
     C                     CALL 'PDGKXFR'              90  Rtv Company Val
     C                     PARM *BLANK    W0RTN   7
     C                     PARM P1HONB    WQ0084  30       BOH Company Num
     C                     PARM @CN,003   WQ0085 10        Company Value C
     C           WUKBTX    PARM *BLANK    WQ0086 40        System Value Al
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGKXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELWUKBTX    YL0001           MTech Live Yes
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Contract Hauler Reason
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1MGCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        CHR Code
     C           YPMTFD    OREQ '#1MGCD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1MGCD' defaulted for 'CHR Code'.
     C                     CALL 'PLDSSRR'              90  Sel Contrct Hau
     C                     PARM *BLANK    W0RTN   7
     C           #1MGCD    PARM #1MGCD    WQ0051  6        CHR Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLDSSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1MGCD    IFNE *BLANK                     CHR Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1MGCD    IFEQ *BLANK                     CHR Code
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAAN    KLIST
     C                     KFLD           ANMGCD           CHR Code
      * Setup key
     C                     MOVEL#1MGCD    ANMGCD
     C           KLVAAN    CHAIN@ANREKG              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Contract Hauler Reason NF'
     C                     MOVEL'PRK1094' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK1094' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Source
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1AACD    WK1X01  1
     C           WK1X01    IFEQ '?'                        SR Source Code
     C           YPMTFD    OREQ '#1AACD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1AACD' defaulted for 'SR Source Code'.
     C                     CALL 'PKDRSRR'              90  Sel Source
     C                     PARM *BLANK    W0RTN   7
     C           #1AACD    PARM #1AACD    WQ0052  3        SR Source Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKDRSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1AACD    IFNE *BLANK                     SR Source Code
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1AACD    IFEQ *BLANK                     SR Source Code
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBAA    KLIST
     C                     KFLD           AAAACD           SR Source Code
      * Setup key
     C                     MOVEL#1AACD    AAAACD
     C           KLVBAA    CHAIN@AAREAC              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Source                 NF'
     C                     MOVEL'PRK0005' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0005' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Producer Location
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1ABCD    WK1X01  1
     C                     MOVEL#1AECD    WK1X02  1
     C           WK1X01    IFEQ '?'                        PD Producer Cod
     C           YPMTFD    OREQ '#1ABCD'
     C           WK1X02    OREQ '?'                        PL Location Cod
     C           YPMTFD    OREQ '#1AECD'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1ABCD' defaulted for 'PD Producer Code'.
      * Field '(CTL) #1AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PWF5SRR'              90  Sel Prod Loc by
     C                     PARM *BLANK    W0RTN   7
     C           #1ABCD    PARM #1ABCD    WQ0053  6        PD Producer Cod
     C           #1AECD    PARM #1AECD    WQ0054  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PWF5SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1ABCD    IFNE *BLANK                     PD Producer Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X01    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1AECD    IFNE *BLANK                     PL Location Cod
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C           WK1X02    ANDNE'?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ABCD    IFEQ *BLANK                     PD Producer Cod
     C           #1AECD    ANDEQ*BLANK                     PL Location Cod
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCAF    KLIST
     C                     KFLD           AFABCD           PD Producer Cod
     C                     KFLD           AFAECD           PL Location Cod
      * Setup key
     C                     MOVEL#1ABCD    AFABCD
     C                     MOVEL#1AECD    AFAECD
     C           KLVCAF    CHAIN@AFREAR              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Producer Location      NF'
     C                     MOVEL'PRK0015' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0015' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Buy Order Load
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C           YPMTFD    IFEQ '#1HMNB'
     C           YPMTFD    OREQ '#1BNNB'
     C           YPMTFD    OREQ '#1BONB'
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1HMNB' defaulted for 'BOH Company Number'.
      * Field '(CTL) #1BNNB' defaulted for 'BOH Buy Order Number'.
      * Field '(CTL) #1BONB' defaulted for 'BOL Load Number'.
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(CTL) #1ABCD' defaulted for 'PD Producer Code'.
      * Field '(CTL) #1AECD' defaulted for 'PL Location Code'.
     C                     CALL 'PKQJSRR'              90  Sel Producer BO
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1HMNB    WQ0055  30       BOH Company Num
     C           #1BNNB    PARM #1BNNB    WQ0056  70       BOH Buy Order N
     C           #1BONB    PARM #1BONB    WQ0057  50       BOL Load Number
     C                     PARM #1ABCD    WQ0058  6        PD Producer Cod
     C                     PARM #1AECD    WQ0059  6        PL Location Cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKQJSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      *
     C           #1HMNB    IFNE *ZERO                      BOH Company Num
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BONB    IFNE *ZERO                      BOL Load Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1HMNB    IFEQ *ZERO                      BOH Company Num
     C           #1BNNB    ANDEQ*ZERO                      BOH Buy Order N
     C           #1BONB    ANDEQ*ZERO                      BOL Load Number
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDAX    KLIST
     C                     KFLD           AXHMNB           BOH Company Num
     C                     KFLD           AXBNNB           BOH Buy Order N
     C                     KFLD           AXBONB           BOL Load Number
      * Setup key
     C                     Z-ADD#1HMNB    AXHMNB
     C                     Z-ADD#1BNNB    AXBNNB
     C                     Z-ADD#1BONB    AXBONB
     C           KLVDAX    CHAIN@AXCPBX              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Buy Order Load         NF'
     C                     MOVEL'PRK0051' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0051' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         VECKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      *
     C           KLVEAD    KLIST
     C                     KFLD           ADHONB           CC Company Numb
     C                     KFLD           ADE0DT           DSH Kill Date
      * Setup key
     C                     Z-ADD#1HONB    ADHONB
     C                     Z-ADD#1E0DT    ADE0DT
     C           KLVEAD    CHAIN@ADCPID              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VEEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VEEXIT
     C                     END
      * Restrictor relation not satisfied
      * Send message 'Delivery Sched Header  NF'
     C                     MOVEL'PRK1026' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'PRK1026' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C           ZINPOS    IFGE 03584
     C           ZINPOS    ANDLE05632
      * Cursor in the subfile record area
      * Reset cursor position to the basic (first) record for lookup
     C           W0CRW     SUB  14        W0CSRR  50
     C           03584     ADD  W0CCL     ZINPOS
      * Calculate rrn of the cursor position
     C                     ADD  ##SFRC    W0CSRR
     C                     ENDIF
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     ENDIF
     C           W0CFL     IFEQ *BLANK
     C                     Z-ADD0         W0CSRR
     C                     ENDIF
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD14        ZHSTRW  40
     C                     Z-ADD21        ZHNDRW  40
     C                     Z-ADD1         ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              9292  *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P2J8NB           Oms Warehouse C
     C                     MOVEL*BLANK    P2C7CD           Oms Application
     C                     MOVEL*BLANK    P2C8CD           Oms SalesPerson
     C                     MOVEL*BLANK    P2G8ST           Oms Allow Multi
     C                     MOVEL*BLANK    P2G9ST           Oms Default Pri
     C                     MOVEL*BLANK    P2EUTX           Oms Name
     C                     MOVEL*BLANK    P2EVTX           Oms System Valu
     C                     MOVEL*BLANK    P2HAST           Oms Access Deni
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field State
     C                     MOVEL*BLANK    WUDRTX  3
      * Define work field Return Code USR
     C                     MOVEL*BLANK    WULMST  7
      * Define work field Farm site Name f/ HPS USR
     C                     MOVEL*BLANK    WUKQTX 25
      * Define work field HPS Hog Group Status
     C                     MOVEL*BLANK    WULLCD  2
      * Define work field HPS Hog Production Phase
     C                     MOVEL*BLANK    WULNCD  5
      * Define work field HPS Hog Production Type
     C                     MOVEL*BLANK    WULMCD  5
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAHONB           CC Company Numb
     C                     Z-ADD*ZERO     WAE0DT           DSH Kill Date
     C                     Z-ADD*ZERO     WAE6DT           DSD Delivery Da
     C                     Z-ADD*ZERO     WAAGTH           DSD Delivery Ti
     C                     Z-ADD*ZERO     WAHZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     WAH5A1           DSS Split Seque
     C                     Z-ADD*ZERO     WAH6A1           DSS Scheduled H
     C                     Z-ADD*ZERO     WAAADT           RS Date Changed
     C                     Z-ADD*ZERO     WAAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WAABDT           RS Date Added
     C                     Z-ADD*ZERO     WAABTM           RS Time Added
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBHONB           CC Company Numb
     C                     Z-ADD*ZERO     WBE0DT           DSH Kill Date
     C                     Z-ADD*ZERO     WBE6DT           DSD Delivery Da
     C                     Z-ADD*ZERO     WBAGTH           DSD Delivery Ti
     C                     Z-ADD*ZERO     WBHZA1           DSD Delivery Ti
     C                     Z-ADD*ZERO     WBH0A1           DSD Scheduled H
     C                     Z-ADD*ZERO     WBH1A1           DSD Farm Site C
     C                     Z-ADD*ZERO     WBIOA1           DSD Unused Head
     C                     Z-ADD*ZERO     WBH2A1           DSD Scheduled D
     C                     Z-ADD*ZERO     WBIJA1           DSD Scheduled K
     C                     Z-ADD*ZERO     WBH3A1           DSD Movement Nu
     C                     Z-ADD*ZERO     WBFRDT           DSD Sched Route
     C                     Z-ADD*ZERO     WBBOTH           DSD Sched Route
     C                     Z-ADD*ZERO     WBE7DT           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WBAHTH           DSD Sch Farm Ar
     C                     Z-ADD*ZERO     WBE8DT           DSD Sch Start L
     C                     Z-ADD*ZERO     WBAITH           DSD Sch Start L
     C                     Z-ADD*ZERO     WBFZDT           DSD Unused Date
     C                     Z-ADD*ZERO     WBB1TH           DSD Unused Time
     C                     Z-ADD*ZERO     WBHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WBBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WBBONB           BOL Load Number
     C                     Z-ADD*ZERO     WBY0A1           DSD PRD Srv Bat
     C                     Z-ADD*ZERO     WBY1A1           DSD PRD Srv Sch
     C                     Z-ADD*ZERO     WBAADT           RS Date Changed
     C                     Z-ADD*ZERO     WBAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WBABDT           RS Date Added
     C                     Z-ADD*ZERO     WBABTM           RS Time Added
      * Define work field System Value Alpha    USR
     C                     MOVEL*BLANK    WUKBTX 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'Y'       W0PMT   1
      * Define local work field MTech Live Yes or No
     C                     MOVEL*BLANK    YL0001  1
      * Define local work field Return Code USR
     C                     MOVEL*BLANK    YL0002  7
      * Define null work field MTech Farm Site Ref
     C                     MOVEL*BLANK    YN0001 20
      * Define null work field MTech Trucker Ref
     C                     MOVEL*BLANK    YN0002 20
      * Define null work field MTech Load Crew Ref
     C                     MOVEL*BLANK    YN0003 20
      * Define null work field MTech Driver Ref
     C                     MOVEL*BLANK    YN0004 20
      * Define null work field HPS FS Comp Relation USR
     C                     MOVEL*BLANK    YN0005  5
      * Define null work field HPS Farm County
     C                     MOVEL*BLANK    YN0006 25
      * Define null work field HPS Cell Manager Code USR
     C                     MOVEL*BLANK    YN0007  5
      * Define null work field HPS Cell Manager Nm USR
     C                     MOVEL*BLANK    YN0008 25
      * Define null work field MTech Cell Manager Ref
     C                     MOVEL*BLANK    YN0009 20
      * Define local work field DSD Movement Printed
     C                     MOVEL*BLANK    YL0003  1
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      * Subfile page size
     C                     Z-ADD08        ##SFPG  30       SFLPAG
      * Initialise subfile positioner
     C                     Z-ADD1         ##SFRC
      *
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Val Application/User  IF
      * Val Application/User  XF - STR Order Management Sys  * 
     C                     CALL 'PDGXXFR'              90  Val Application
     C                     PARM *BLANK    W0RTN   7
     C           P2J8NB    PARM *BLANK    WQ0075  3        Oms Warehouse C
     C           #1HONB    PARM *ZERO     WQ0076  30       CC Company Numb
     C                     PARM 'HPE'     WQ0077  6        Oms Application
     C           P2C8CD    PARM *BLANK    WQ0078  3        Oms SalesPerson
     C           P2G8ST    PARM *BLANK    WQ0079  1        Oms Allow Multi
     C           P2G9ST    PARM *BLANK    WQ0080 10        Oms Default Pri
     C           P2EUTX    PARM *BLANK    WQ0081 30        Oms Name
     C           P2EVTX    PARM *BLANK    WQ0082 40        Oms System Valu
     C           P2HAST    PARM *BLANK    WQ0083  1        Oms Access Deni
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PDGXXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PAR.Oms Access Denied (Y/N) is Yes
     C           P2HAST    IFEQ 'Y'                        *IF
      * Send message 'Access Denied for User'
     C                     MOVEL'PRK0298' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP2EVTX    ##CMP
     C                     END                             *FI
      * E2423 Mtech Not Live will use this HPS program
      * Get the MTech Live Yes or No
     C                     EXSR UASUBR                     Get the MTech L
      * We will come back to this one when we put in the
      * data base changes for Mtech
      * Vist later validation on Farm Site.
      * H16853 ISE 11/02/2020 CHANGE BUY ORDER NUMBER FIELD LENGTH FROM 5
      *****************************************************************
      *================================================================
     CSR         ZZEXIT    ENDSR
** W0BEG
01040010680129601324015570206902078
02562028350358603589035960360303609
0361603625
** W0END
01042010750130301328015590207302102
02639028370358603593036000360503613
0362203627
** W0NAM
#1HONB    V1E6DT    V1E0DT    #1AGTH    #1HZA1    #1H1A1    #CKQTX
#2ST1     #CIVA1    #2SEL     #2KNCD    #2KOCD    #2H6A1    #2LDCD
#2LECD    #2H5A1
** @CN
00001 SEABOA
00002 SELECT
00003 MTECHLIVE
