/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - BUILT THE SALESHIST DOWNLOAD FILES FOR TOM DYE TO FTP*/
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 05/16/00                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FDATEL     - FROM ACTUAL SHIPPED DATE                  */
/*          &TDATEL     - THROUGH    DATE                           */
/*          &DTLSUM     - DETAIL OR SUMMARY                         */
/*          &DOCUM      - DOCUMENT NAME                             */
/*          &DOCUMENT   - PARM DOCUMENT                             */
/*          &EMAIL      - EMAIL ADDR                                */
/*          &EMAIL2     - EMAIL ADDR 2 OPTIONAL                     */
/********************************************************************/
/* RMC  1/9/2001  CALL FTPPRKSRVR TO PUSH DOCUMENT TO FTP WEBSITE   */
/* RMC  7/10/02   ADD INCLUDE DM/CM PARM AND PROCESSING             */
/* RMC  7/10/02   ADD INCLUDE ALL PROD PARM AND PROCESSING          */
/* RMC  1/11/2002 CALL FTPPRKSRV3 TO PUSH DOC TO \\PORKCFILE\TDYE$  */
/* RMC  7/17/2002 ADDED WAREHOUSE TO THE FILE, FTP                  */
/* RMC  1/20/2006 ADDED ORDER TF EXEMPT TO FILE/FTP FOR DTL ONLY    */
/* RMC  4/09/2007 CHG FTP TO EMAIL                                  */
/* LJB  6/01/2009 PASS PARMS IN REPORTING PARMS ARRAY, ADD PARM     */
/*                FOR INCL/EXCL/ONLY SAMPLE ITEMS                   */
/********************************************************************/
 POFGUPC:    PGM        PARM(&RTN &COMPL &FDATEL &TDATEL &DMCM +
                          &ALLPRD &DTLSUM &SAMPLES &EMAIL &EMAIL2)

        DCL    &RTN       *CHAR   (7)          /*  RETURN CODE   */
        DCL    &COMP      *DEC    (3 0)        /*  COMPANY #     */
        DCL    &COMPL     *DEC                 /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)        /*  FROM DATE      */
        DCL    &FDATEL    *DEC                 /*  FOR PASSING    */
        DCL    &FDATEX    *CHAR   (7)          /*  FROM DATE      */
        DCL    &TDATE     *DEC    (7 0)        /*  TO  DATE      */
        DCL    &TDATEL    *DEC                 /*  FOR PASSING    */
        DCL    &TDATEX    *CHAR   (7)          /*  TO DATE      */
        DCL    &DTLSUM    *CHAR   (1)          /*  REPORT TYPE    */
        DCL    &DOCUMENT  *CHAR   (10)
        DCL    &PCFILE    *CHAR   (32)
        DCL    &DOCUM     *CHAR   (08)
        DCL    &DMCM      *CHAR   (1)
        DCL    &ALLPRD    *CHAR   (1)
        DCL    &SAMPLES   *CHAR   (1)
        DCL    &EMAIL     *CHAR   (50)
        DCL    &EMAIL2    *CHAR   (50)
        DCL     &DATA     *CHAR   10
        DCL     &DATAH    *CHAR   10

/* Internal Fields */
             DCL  VAR(&ALREADY)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&SEL)  TYPE(*CHAR) LEN(1500)

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATEX) VALUE(&FDATE) /* Change to CHAR  */
             CHGVAR    VAR(&TDATE) VALUE(&TDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&TDATEX) VALUE(&TDATE) /* Change to CHAR  */

             ADDLIBLE LIB(SEQUEL) POSITION(*LAST)
             MONMSG MSGID(CPF2103) EXEC(DO)       /* already in libl */
                CHGVAR VAR(&ALREADY) VALUE('Y')
                ENDDO
   /*------------------------------------------------*/
   /*  BUILD THE FILE             */
   /*-----------------------------------------------*/
BUILD:       CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)
             CRTDUPOBJ  OBJ(POAUCPP) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF9999 CPF2130)
             CLRPFM     FILE(QTEMP/POAUCPP)
             CRTDUPOBJ OBJ(POAUCPL0) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF9999)
             CRTDUPOBJ OBJ(POAUCPL1) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF9999)
             CRTDUPOBJ OBJ(POAUCPL2) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             MONMSG     MSGID(CPF9999)

             CALL       PGM(POF1XFR) PARM('' &COMP &DTLSUM &FDATE +
                          &TDATE &DMCM &ALLPRD &SAMPLES)
   /*------------------------------------------------*/
   /* EXECUTE SEQUEL TO CREATE THE OUTFILE TO FTP */
   /*-----------------------------------------------*/
 DETAIL:     IF         COND(&DTLSUM = 'D') THEN(DO)
             CHGVAR     VAR(&SEL) VALUE('SELECT AUAIC3 +
                          COLHDG("Company"),  AUGNDT +
                          COLHDG("Actual" "Ship Date"), aud2c7 +
                          COLHDG("Order" "Number"), aus5nb +
                          COLHDG("Item Code"), +
                          auajcd COLHDG("Whse"), +
                  aua5pr  COLHDG("Market" "Price"), auexqt +
                          COLHDG("Quantity Billed"), AUBYWG +
                          COLHDG("Weight Billed"), AUUSVA +
                          COLHDG("FOB Gross"), aue3pc COLHDG("FOB +
        Price/CWT"),AUIUSX COLHDG("TF" "Exempt")   FROM QTEMP/POAUCPP')


             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') +
                          TEXT('Sales History Download')
             IF         COND(&EMAIL2 > '      ') THEN(DO)
             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL2) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') +
                          TEXT('Sales History Download')
             ENDDO
             ENDDO
SUMMARY:     IF         COND(&DTLSUM = 'S') THEN(DO)
             CHGVAR     VAR(&SEL) VALUE('SELECT AUAIC3 +
                          COLHDG("Company"), AUGNDT COLHDG("Actual" +
                          "Ship Date"),  aud2c7 COLHDG("Item Code"),+
                          auajcd COLHDG("Whse"), +
                            AUA5PR COLHDG("Market" "Price"), +
                          auexqt COLHDG("Quantity Billed"), AUBYWG +
                          COLHDG("Weight Billed"), AUUSVA +
                          COLHDG("FOB Gross"), aue3pc COLHDG("FOB +
                          Price/CWT") FROM QTEMP/POAUCPP')

             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') +
                          TEXT('Sales History Download')
             IF         COND(&EMAIL2 > '      ') THEN(DO)
             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL2) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') +
                          TEXT('Sales History Download')
      ENDDO
      ENDDO
      GOTO END
   /*---------------------------------*/
   /* Remove SEQUEL Library from List */
   /*---------------------------------*/
             IF COND(&ALREADY *EQ 'N') THEN(DO)
                RMVLIBLE   LIB(SEQUEL)
             ENDDO
   /*------------------------------------*/
   /* PUSH documents to  \\PORKCFILE01\TDYE$    */
   /*------------------------------------*/
             CHGVAR VAR(&DOCUMENT) VALUE(&DOCUM)
             CHGVAR VAR(&PCFILE)   VALUE(&DOCUM *TCAT '.CSV')
             CALL PGM(FTPPRKSRV3) PARM(&DOCUMENT &PCFILE)


 END:        ENDPGM
