// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PORGXFR
// ?Date: 14.08.2025 Time: 03:38:46
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?***** Changes and Comments
DO;

//? 9/20/19 JBB E15505 - Change parameter to always print rebills in
//?  RTVOBJ Rtv Print Statements  RT - Customer.  Recompile.
//?RMC 11/1/13 E2855 chg ar lf used from arbdcplx to arbdcpl6
//?07/09/12 LJB E002169   Change passed outq to the outq in the command
//?  line, per Helen. (Changed back from Rob Wallace's request)
//?06/01/12 LJB E002121   Add status flags for Print, Fax, Email, and
//?  Print Co# on Statement and default in their required values,
//?  which, for the job scheduler, will be *NO.
//?  Also, send default values for Cust Distribution Entry fields.
//?05/01/12 LJB E000909   Change Statements to Fax or Email to
//?  the number(s) in Cust Distribution file. Also, if not Dailys then
//?  dup the spooled file to A/R outq so it prints for Soni.
//?8/22/02 RMC PK0476  Print statements matching the input parm
//?  frequency from the job scheduler
ENDDO;

//?1=Fax: Default to *NO for job scheduler job (don't pass from here)
// PAR.Status Flag 1  Y/N = CND.No
PAR.Status_Flag_1_Y_N = 'N';

//?2=Print: Default to *NO for job scheduler job (don't pass from here)
// PAR.Status Flag 2  Y/N = CND.No
PAR.Status_Flag_2_Y_N = 'N';

//?3=Email: Default to *NO for job scheduler job (don't pass from here)
// PAR.Status Flag 3  Y/N = CND.No
PAR.Status_Flag_3_Y_N = 'N';

//?4=Print Co# on statement:
// PAR.Status Flag 4  Y/N = CND.no
PAR.Status_Flag_4_Y_N = 'N';

//?6=Sent from Job Scheduler:
// PAR.Status Flag 6  Y/N = CND.Yes
PAR.Status_Flag_6_Y_N = 'Y';

// WRK.CDE Name = CND.blanks
WRK.CDE_Name = *BLANK;

// WRK.CDE Destination = PAR.PRT Printer Device
WRK.CDE_Destination = PAR.PRT_Printer_Device;

EXECUTE FUNCTION(Rtv Print Statements  RT) TYPE(RTVOBJ) FILE(CABBREP)           AC1651657;
PARAMETER(PAR.Statement_Print_Frequency);
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.Copies);
PARAMETER(PAR.Statement_Type);
PARAMETER(PAR.Text_1_Length_USR);
PARAMETER(PAR.Status_Flag_1_Y_N);
PARAMETER(PAR.Status_Flag_2_Y_N);
PARAMETER(PAR.Status_Flag_3_Y_N);
PARAMETER(PAR.Status_Flag_4_Y_N);
PARAMETER(PAR.Status_Flag_5_Y_N);
PARAMETER(PAR.Status_Flag_6_Y_N);
{
 //?USER: Initialize routine

 //?***** Changes and Comments
 DO;

 //? 9/20/19 JBB E15505 - Change parameter to always print rebills
 //?  separate functions for Statements.
 //?06/01/12 LJB E002121  Pass new parms because Fax and Email are now
 //?  separate functions for Statements.
 //?05/01/12 LJB E000909  Change to submit a program that will Fax/Email
 //?  Pass org to AR605CLP so splf will be dup'd if not Dailys
 //?RMC ARS011 pass 000 company to print combined stmt
 //?SAZ Pass company to print stmts for SLC or MSL,for Pork it will still
 //?be zeros.
 //?Text 1 Length USR = Drawer
 ENDDO;

 // LCL.Company Number Pass   USR = PAR.Company Number
 LCL.Company_Number_Pass_USR = PAR.Company_Number;

 // Call program Rtv Plant Co/Org      XF.
 CALL PROGRAM(Rtv Plant Co/Org      XF) ('PMOVXFR');
 PARAMETER(PAR.Company_Number);
 PARAMETER(NLL.Plant_Company_Sts);
 PARAMETER(WRK.Company_Organization);

 // PAR.Status Flag 5  Y/N = WRK.Company Organization
 PAR.Status_Flag_5_Y_N = WRK.Company_Organization;

 // Call program RTV System Value Alpha XF.
 CALL PROGRAM(RTV System Value Alpha XF) ('PPJXXFR');
 PARAMETER('ARSTMTOUTQ');
 PARAMETER(WRK.Default_Printer);

 //?USER: Process Data record

 //?PRINT STATEMENTS MATCHING THE PAR STATEMENT FREQUENCY
 CASE;

 // IF PAR.Statement Print Frequency EQ DB1.Statement Print Frequency
 IF PAR.Statement_Print_Frequency = DB1.Statement_Print_Frequency;

 // AND DB1.Ship To Customer EQ DB1.A/R Customer Number
 AND DB1.Ship_To_Customer = DB1.AR_Customer_Number;

 // LCL.Customer Number Pass  USR = DB1.A/R Customer Number
 LCL.Customer_Number_Pass_USR = DB1.AR_Customer_Number;

 //?5/22/03 Call print statement if a balance exists
 //?If company # entered
 //?chk bal
 CASE;

 // IF PAR.Company Number is greater than zero
 IF PAR.Company_Number > *ZERO;

 EXECUTE FUNCTION(RTV Check Bal exist   RT) TYPE(RTVOBJ) FILE(ARBDCPP)           AC1863979;
 PARAMETER(PAR.Company_Number);
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(WRK.Status_Flag_1_Y_N);
 {
  //?USER: Initialize routine

  //?rmc 11/1/13 e2855 chg to arbdcpl6
  // PAR.Status Flag 1  Y/N = CND.No
  PAR.Status_Flag_1_Y_N = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.Remaining Balance Due is less or equal to zero
  IF DB1.Remaining_Balance_Due <= *ZERO;

  // OR DB1.Invoice Suffix is CM or OA
  OR ( DB1.Invoice_Suffix = 'CM'/'OA';

  // AND DB1.Transaction Amount is greater than zero
  AND DB1.Transaction_Amount > *ZERO );

  // OR DB1.Adjustment Type Code is A/R Entry by Customer
  OR DB1.Adjustment_Type_Code = 'ARC';

  // OR DB1.Adjustment Type Code is A/R Miscellaneous Acct
  OR DB1.Adjustment_Type_Code = 'ARM';

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Status Flag 1  Y/N = CND.Yes
  PAR.Status_Flag_1_Y_N = 'Y';

  QUIT;

  ENDIF;

 }

 //?chk bal
 // IF *OTHERWISE
 IF *OTHERWISE;

 EXECUTE FUNCTION(RTV Check Balance exst RT) TYPE(RTVOBJ) FILE(ARBDCPP)          AC1665233;
 PARAMETER(DB1.AR_Customer_Number);
 PARAMETER(WRK.Status_Flag_1_Y_N);
 {
  //?USER: Initialize routine

  // PAR.Status Flag 1  Y/N = CND.No
  PAR.Status_Flag_1_Y_N = 'N';

  //?USER: Process Data record

  CASE;

  // IF DB1.Remaining Balance Due is less or equal to zero
  IF DB1.Remaining_Balance_Due <= *ZERO;

  // OR DB1.Invoice Suffix is CM or OA
  OR ( DB1.Invoice_Suffix = 'CM'/'OA';

  // AND DB1.Transaction Amount is greater than zero
  AND DB1.Transaction_Amount > *ZERO );

  // OR DB1.Adjustment Type Code is A/R Entry by Customer
  OR DB1.Adjustment_Type_Code = 'ARC';

  // OR DB1.Adjustment Type Code is A/R Miscellaneous Acct
  OR DB1.Adjustment_Type_Code = 'ARM';

  // IF *OTHERWISE
  IF *OTHERWISE;

  // PAR.Status Flag 1  Y/N = CND.Yes
  PAR.Status_Flag_1_Y_N = 'Y';

  QUIT;

  ENDIF;

 }

 ENDIF;

 //?sbmjob
 CASE;

 // IF WRK.Status Flag 1  Y/N is Yes
 IF WRK.Status_Flag_1_Y_N = 'Y';

 //?05/01/12 LJB E000909  Change to submit a program that will Fax/Email
 //?ARS011 RMC 8/30/05 Default the Print Co on Stmt to NO, pass 000 company
 // LCL.Include Credit Memos = CND.No
 LCL.Include_Credit_Memos = 'N';

 // PAR.Distribution Code = CND.Statements
 PAR.Distribution_Code = 'AR-STMTS';

 // PAR.Record Status = CND.Active
 PAR.Record_Status = 'A';

 //? 9/20/19 JBB E15505 - Change parameter to always print rebills
 // Call program PRC Fax A/R Statement  UP.
 CALL PROGRAM(PRC Fax A/R Statement  UP) ('POQ1UPC');
 PARAMETER(WRK.CDE_Destination);
 PARAMETER(PAR.PRT_Hold_Output_Sts);
 PARAMETER(PAR.PRT_Save_Output_Sts);
 PARAMETER(LCL.Company_Number_Pass_USR);
 PARAMETER(LCL.Customer_Number_Pass_USR);
 PARAMETER(PAR.PRT_Number_of_Copies);
 PARAMETER(LCL.Include_Credit_Memos);
 PARAMETER('Y');
 PARAMETER(DB1.Customer_Name);
 PARAMETER(PAR.Statement_Type);
 PARAMETER('Y');
 PARAMETER(PAR.Status_Flag_1_Y_N);
 PARAMETER(PAR.Status_Flag_2_Y_N);
 PARAMETER(PAR.Status_Flag_3_Y_N);
 PARAMETER(PAR.Status_Flag_4_Y_N);
 PARAMETER(PAR.Status_Flag_5_Y_N);
 PARAMETER(PAR.Status_Flag_6_Y_N);
 PARAMETER(WRK.Default_Printer);
 PARAMETER(PAR.Text_1_Length_USR);
 PARAMETER(PAR.Distribution_Code);
 PARAMETER(PAR.Record_Status);
 PARAMETER('Y');

 ENDIF;

 ENDIF;

}


