     H/TITLE Exc Delete OA trans   XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : 2E  Version:  1135
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISRCENT
     H* Date          : 12/23/05  Time  : 11:47:27
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDNHCPL1IF  E           K        DISK
      * RTV : A/R OA/CM Transactions    Retrieval index
      *
     FARBECPL1IF  E           K        DISK
      * RTV : A/R Detail                Retrieval index       V
      *
     FARBDCPL3IF  E           K        DISK
      * RTV : A/R Header                Retrieval index       NV
      *
     FPDNHCPL0UF  E           K        DISK
      * UPD : A/R OA/CM Transactions    Update index
      *
     FARBECPL0UF  E           K        DISK
      * UPD : A/R Detail                Update index
      *
     FARBDCPL0UF  E           K        DISK
      * UPD : A/R Header                Update index
      *
     I@NHCPBH
      * A/R OA/CM Transactions    Retrieval index
      * Renamed input format fields
     I              NHAIC3                          WAAIC3
     I              NHCONB                          WACONB
     I              NHCEST                          WACEST
     I              NHJZNX                          WAJZNX
     I              NHHNSX                          WAHNSX
     I              NHBSVA                          WABSVA
     I              NHVSST                          WAVSST
     I              NHMJDT                          WAMJDT
     I              NHBETM                          WABETM
     I              NHCCVN                          WACCVN
     I              NHCDVN                          WACDVN
     I              NHMKDT                          WAMKDT
     I              NHBFTM                          WABFTM
     I              NHCEVN                          WACEVN
     I              NHCFVN                          WACFVN
      *
     I@NHCPBG
      * A/R OA/CM Transactions    Update index
      * Renamed input format fields
     I              NHAIC3                          WBAIC3
     I              NHCONB                          WBCONB
     I              NHCEST                          WBCEST
     I              NHJZNX                          WBJZNX
     I              NHHNSX                          WBHNSX
     I              NHBSVA                          WBBSVA
     I              NHVSST                          WBVSST
     I              NHMJDT                          WBMJDT
     I              NHBETM                          WBBETM
     I              NHCCVN                          WBCCVN
     I              NHCDVN                          WBCDVN
     I              NHMKDT                          WBMKDT
     I              NHBFTM                          WBBFTM
     I              NHCEVN                          WBCEVN
     I              NHCFVN                          WBCFVN
      *
     I@BFCPFO
      * A/R Detail                Retrieval index       V
      * Renamed input format fields
     I              BFAIC3                          WCAIC3
     I              BFCONB                          WCCONB
     I              BFCEST                          WCCEST
     I              BFDXNB                          WCDXNB
     I              BFUHCD                          WCUHCD
     I              BFBSVA                          WCBSVA
     I              BFCPTX                          WCCPTX
     I              BFNGNA                          WCNGNA
     I              BFB4DT                          WCB4DT
     I              BFDVDT                          WCDVDT
     I              BFYXNX                          WCYXNX
     I              BFHYDT                          WCHYDT
     I              BFG4CD                          WCG4CD
     I              BFCKNB                          WCCKNB
     I              BFA5ST                          WCA5ST
     I              BFAJST                          WCAJST
     I              BFB1VN                          WCB1VN
     I              BFEAZT                          WCEAZT
     I              BFC1NY                          WCC1NY
     I              BFIZTX                          WCIZTX
     I              BFETSX                          WCETSX
     I              BFW3SX                          WCW3SX
     I              BFW4SX                          WCW4SX
     I              BFW5SX                          WCW5SX
     I              BFW6SX                          WCW6SX
     I              BFW7SX                          WCW7SX
     I              BFW8SX                          WCW8SX
     I              BFQHDT                          WCQHDT
     I              BFQIDT                          WCQIDT
     I              BFQJDT                          WCQJDT
     I              BFQKDT                          WCQKDT
     I              BFQLDT                          WCQLDT
     I              BFGLVL                          WCGLVL
     I              BFGMVL                          WCGMVL
     I              BFGNVL                          WCGNVL
     I              BFGOVL                          WCGOVL
     I              BFGPVL                          WCGPVL
     I              BFUVST                          WCUVST
     I              BFUWST                          WCUWST
     I              BFUXST                          WCUXST
     I              BFAATM                          WCAATM
     I              BFAYNA                          WCAYNA
     I              BFA0NA                          WCA0NA
     I              BFAXDT                          WCAXDT
      *
     I@BFCPFN
      * A/R Detail                Update index
      * Renamed input format fields
     I              BFAIC3                          WDAIC3
     I              BFCONB                          WDCONB
     I              BFCEST                          WDCEST
     I              BFDXNB                          WDDXNB
     I              BFUHCD                          WDUHCD
     I              BFBSVA                          WDBSVA
     I              BFCPTX                          WDCPTX
     I              BFNGNA                          WDNGNA
     I              BFB4DT                          WDB4DT
     I              BFDVDT                          WDDVDT
     I              BFYXNX                          WDYXNX
     I              BFHYDT                          WDHYDT
     I              BFG4CD                          WDG4CD
     I              BFCKNB                          WDCKNB
     I              BFA5ST                          WDA5ST
     I              BFAJST                          WDAJST
     I              BFB1VN                          WDB1VN
     I              BFEAZT                          WDEAZT
     I              BFC1NY                          WDC1NY
     I              BFIZTX                          WDIZTX
     I              BFETSX                          WDETSX
     I              BFW3SX                          WDW3SX
     I              BFW4SX                          WDW4SX
     I              BFW5SX                          WDW5SX
     I              BFW6SX                          WDW6SX
     I              BFW7SX                          WDW7SX
     I              BFW8SX                          WDW8SX
     I              BFQHDT                          WDQHDT
     I              BFQIDT                          WDQIDT
     I              BFQJDT                          WDQJDT
     I              BFQKDT                          WDQKDT
     I              BFQLDT                          WDQLDT
     I              BFGLVL                          WDGLVL
     I              BFGMVL                          WDGMVL
     I              BFGNVL                          WDGNVL
     I              BFGOVL                          WDGOVL
     I              BFGPVL                          WDGPVL
     I              BFUVST                          WDUVST
     I              BFUWST                          WDUWST
     I              BFUXST                          WDUXST
     I              BFAATM                          WDAATM
     I              BFAYNA                          WDAYNA
     I              BFA0NA                          WDA0NA
     I              BFAXDT                          WDAXDT
      *
     I@BDCPF7
      * A/R Header                Retrieval index       NV
      * Renamed input format fields
     I              BDAIC3                          WEAIC3
     I              BDCONB                          WECONB
     I              BDCEST                          WECEST
     I              BDUHCD                          WEUHCD
     I              BDBSVA                          WEBSVA
     I              BDAIVA                          WEAIVA
     I              BDAOVA                          WEAOVA
     I              BDBGVA                          WEBGVA
     I              BDAJST                          WEAJST
     I              BDE3ST                          WEE3ST
     I              BDG4CD                          WEG4CD
     I              BDCKNB                          WECKNB
     I              BDCAC7                          WECAC7
     I              BDBKC7                          WEBKC7
     I              BDBCCD                          WEBCCD
     I              BDR4CD                          WER4CD
     I              BDB4DT                          WEB4DT
     I              BDATDT                          WEATDT
     I              BDH0DT                          WEH0DT
     I              BDH3DT                          WEH3DT
     I              BDH4DT                          WEH4DT
     I              BDH5DT                          WEH5DT
     I              BDANC7                          WEANC7
     I              BDCPTX                          WECPTX
     I              BDBSDY                          WEBSDY
     I              BDUVST                          WEUVST
     I              BDUWST                          WEUWST
     I              BDUXST                          WEUXST
     I              BDAATM                          WEAATM
     I              BDAYNA                          WEAYNA
     I              BDA0NA                          WEA0NA
     I              BDAXDT                          WEAXDT
      *
     I@BDCPFG
      * A/R Header                Update index
      * Renamed input format fields
     I              BDAIC3                          WFAIC3
     I              BDCONB                          WFCONB
     I              BDCEST                          WFCEST
     I              BDUHCD                          WFUHCD
     I              BDBSVA                          WFBSVA
     I              BDAIVA                          WFAIVA
     I              BDAOVA                          WFAOVA
     I              BDBGVA                          WFBGVA
     I              BDAJST                          WFAJST
     I              BDE3ST                          WFE3ST
     I              BDG4CD                          WFG4CD
     I              BDCKNB                          WFCKNB
     I              BDCAC7                          WFCAC7
     I              BDBKC7                          WFBKC7
     I              BDBCCD                          WFBCCD
     I              BDR4CD                          WFR4CD
     I              BDB4DT                          WFB4DT
     I              BDATDT                          WFATDT
     I              BDH0DT                          WFH0DT
     I              BDH3DT                          WFH3DT
     I              BDH4DT                          WFH4DT
     I              BDH5DT                          WFH5DT
     I              BDANC7                          WFANC7
     I              BDCPTX                          WFCPTX
     I              BDBSDY                          WFBSDY
     I              BDUVST                          WFUVST
     I              BDUWST                          WFUWST
     I              BDUXST                          WFUXST
     I              BDAATM                          WFAATM
     I              BDAYNA                          WFAYNA
     I              BDA0NA                          WFA0NA
     I              BDAXDT                          WFAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDNH1    E DSPDNHCPL0
      * UPD : A/R OA/CM Transactions    Update index
      * Renamed input format fields
     I              NHAIC3                          WBAIC3
     I              NHCONB                          WBCONB
     I              NHCEST                          WBCEST
     I              NHJZNX                          WBJZNX
     I              NHHNSX                          WBHNSX
     I              NHBSVA                          WBBSVA
     I              NHVSST                          WBVSST
     I              NHMJDT                          WBMJDT
     I              NHBETM                          WBBETM
     I              NHCCVN                          WBCCVN
     I              NHCDVN                          WBCDVN
     I              NHMKDT                          WBMKDT
     I              NHBFTM                          WBBFTM
     I              NHCEVN                          WBCEVN
     I              NHCFVN                          WBCFVN
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQARBE1    E DSARBECPL0
      * UPD : A/R Detail                Update index
      * Renamed input format fields
     I              BFAIC3                          WDAIC3
     I              BFCONB                          WDCONB
     I              BFCEST                          WDCEST
     I              BFDXNB                          WDDXNB
     I              BFUHCD                          WDUHCD
     I              BFBSVA                          WDBSVA
     I              BFCPTX                          WDCPTX
     I              BFNGNA                          WDNGNA
     I              BFB4DT                          WDB4DT
     I              BFDVDT                          WDDVDT
     I              BFYXNX                          WDYXNX
     I              BFHYDT                          WDHYDT
     I              BFG4CD                          WDG4CD
     I              BFCKNB                          WDCKNB
     I              BFA5ST                          WDA5ST
     I              BFAJST                          WDAJST
     I              BFB1VN                          WDB1VN
     I              BFEAZT                          WDEAZT
     I              BFC1NY                          WDC1NY
     I              BFIZTX                          WDIZTX
     I              BFETSX                          WDETSX
     I              BFW3SX                          WDW3SX
     I              BFW4SX                          WDW4SX
     I              BFW5SX                          WDW5SX
     I              BFW6SX                          WDW6SX
     I              BFW7SX                          WDW7SX
     I              BFW8SX                          WDW8SX
     I              BFQHDT                          WDQHDT
     I              BFQIDT                          WDQIDT
     I              BFQJDT                          WDQJDT
     I              BFQKDT                          WDQKDT
     I              BFQLDT                          WDQLDT
     I              BFGLVL                          WDGLVL
     I              BFGMVL                          WDGMVL
     I              BFGNVL                          WDGNVL
     I              BFGOVL                          WDGOVL
     I              BFGPVL                          WDGPVL
     I              BFUVST                          WDUVST
     I              BFUWST                          WDUWST
     I              BFUXST                          WDUXST
     I              BFAATM                          WDAATM
     I              BFAYNA                          WDAYNA
     I              BFA0NA                          WDA0NA
     I              BFAXDT                          WDAXDT
      *
     IQARBD1    E DSARBDCPL0
      * UPD : A/R Header                Update index
      * Renamed input format fields
     I              BDAIC3                          WFAIC3
     I              BDCONB                          WFCONB
     I              BDCEST                          WFCEST
     I              BDUHCD                          WFUHCD
     I              BDBSVA                          WFBSVA
     I              BDAIVA                          WFAIVA
     I              BDAOVA                          WFAOVA
     I              BDBGVA                          WFBGVA
     I              BDAJST                          WFAJST
     I              BDE3ST                          WFE3ST
     I              BDG4CD                          WFG4CD
     I              BDCKNB                          WFCKNB
     I              BDCAC7                          WFCAC7
     I              BDBKC7                          WFBKC7
     I              BDBCCD                          WFBCCD
     I              BDR4CD                          WFR4CD
     I              BDB4DT                          WFB4DT
     I              BDATDT                          WFATDT
     I              BDH0DT                          WFH0DT
     I              BDH3DT                          WFH3DT
     I              BDH4DT                          WFH4DT
     I              BDH5DT                          WFH5DT
     I              BDANC7                          WFANC7
     I              BDCPTX                          WFCPTX
     I              BDBSDY                          WFBSDY
     I              BDUVST                          WFUVST
     I              BDUWST                          WFUWST
     I              BDUXST                          WFUXST
     I              BDAATM                          WFAATM
     I              BDAYNA                          WFAYNA
     I              BDA0NA                          WFA0NA
     I              BDAXDT                          WFAXDT
      *
     IYARDCS      DS                            134
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: A/R OA/CM Transactions
      * I :  Company Number
     I                                    P   1   20P1AIC3
      * I :  Invoice Number
     I                                    P   3   60P1CONB
      * I :  Invoice Suffix
     I                                        7   8 P1CEST
      * I :  Reference Number
     I                                    P   9  120P1JZNX
      * I :  Reference Suffix
     I                                       13  14 P1HNSX
      * I :  Transaction Amount
     I                                    P  15  202P1BSVA
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1CONB    PARM           WP0002  70       Invoice Number
     C           P1CEST    PARM           WP0003  2        Invoice Suffix
     C           P1JZNX    PARM           WP0004  70       Reference Numbe
     C           P1HNSX    PARM           WP0005  2        Reference Suffi
     C           P1BSVA    PARM           WP0006 112       Transaction Amo
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Delete OA trans   XF
      * **************************************************************
      * RMC 3/11/05 New function to Delete an OA transaction
      * **************************************************************
      * Delete OA transaction for OA Inv and Ref Inv
      * Rtv OA Trans to Del   RT - A/R OA/CM Transactions  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1AIC3    WL0001           Company Number
     C                     Z-ADDP1CONB    WL0002           Invoice Number
     C                     MOVELP1CEST    WL0003    P      Invoice Suffix
     C                     Z-ADDP1JZNX    WL0004           Reference Numbe
     C                     MOVELP1HNSX    WL0005    P      Reference Suffi
     C                     EXSR SARVGN
      * Rtv OA Trans to Del   RT - A/R OA/CM Transactions  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1AIC3    WL0001           Company Number
     C                     Z-ADDP1JZNX    WL0002           Invoice Number
     C                     MOVELP1HNSX    WL0003    P      Invoice Suffix
     C                     Z-ADDP1CONB    WL0004           Reference Numbe
     C                     MOVELP1CEST    WL0005    P      Reference Suffi
     C                     EXSR SARVGN
      * Delete A/R Detail SPR/ARC transactions for Ref Inv
      * RTV Inv to Del Arc/Spr RT - A/R Detail  * 
     C                     EXSR SCRVGN
      * Update A/R Hdr for OA Inv:  - Amt Pd and + Rem Bal Due
      * RTV Change Amt Pd     RT - A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1AIC3    WL0010           Company Number
     C                     Z-ADDP1CONB    WL0011           Invoice Number
     C                     MOVELP1CEST    WL0012    P      Invoice Suffix
     C                     Z-ADDP1BSVA    WL0013           Transaction Amo
     C                     EXSR SERVGN
      * Update A/R Hdr for Ref Inv:  - Amt Pd and + Rem Bal Due
      * RTV Change Amt Pd     RT - A/R Header  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1AIC3    WL0010           Company Number
     C                     Z-ADDP1JZNX    WL0011           Invoice Number
     C                     MOVELP1HNSX    WL0012    P      Invoice Suffix
     C                     Z-ADDP1BSVA    WL0013           Transaction Amo
     C                     EXSR SERVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv OA Trans to Del   RT - A/R OA/CM Transactions  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WACONB           Invoice Number
     C                     KFLD           WACEST           Invoice Suffix
     C                     KFLD           WAJZNX           Reference Numbe
     C                     KFLD           WAHNSX           Reference Suffi
      * Setup key
     C                     Z-ADDWL0001    WAAIC3           Company Number
     C                     Z-ADDWL0002    WACONB           Invoice Number
     C                     MOVELWL0003    WACEST           Invoice Suffix
     C                     Z-ADDWL0004    WAJZNX           Reference Numbe
     C                     MOVELWL0005    WAHNSX           Reference Suffi
      * Establish starting position
     C           KRSSA     CHAIN@NHCPBH              90    *
      * Data record not found
     C   90                MOVEL'USR2900' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * DLT A/R OA/CM Trans    DL - A/R OA/CM Transactions  * 
     C                     EXSR SBDLRC
     C                     ENDIF
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * DLT A/R OA/CM Trans    DL - A/R OA/CM Transactions  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @NHCPBG
     C                     Z-ADDWAAIC3    WBAIC3           Company Number
     C                     Z-ADDWACONB    WBCONB           Invoice Number
     C                     MOVELWACEST    WBCEST           Invoice Suffix
     C                     Z-ADDWAJZNX    WBJZNX           Reference Numbe
     C                     MOVELWAHNSX    WBHNSX           Reference Suffi
      *
     C           KLDLSB    KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBCONB           Invoice Number
     C                     KFLD           WBCEST           Invoice Suffix
     C                     KFLD           WBJZNX           Reference Numbe
     C                     KFLD           WBHNSX           Reference Suffi
     C           KLDLSB    CHAIN@NHCPBG              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDNHCPL0'MDACP
     C                     MOVEL'@NHCPBG' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@NHCPBG                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Inv to Del Arc/Spr RT - A/R Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C           *ZERO     SUB  P1BSVA    WUBSVA           Transaction Amo
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAIC3    WQSC01           Company Number
     C           *LIKE     DEFN WCCONB    WQSC02           Invoice Number
     C           *LIKE     DEFN WCCEST    WQSC03           Invoice Suffix
      * Define keylist
     C           KPSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Invoice Number
     C                     KFLD           WQSC03           Invoice Suffix
     C                     KFLD           WCDXNB           Sequence Number
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Invoice Number
     C                     KFLD           WQSC03           Invoice Suffix
      * Setup key
     C                     Z-ADDP1AIC3    WQSC01           Company Number
     C                     Z-ADDP1JZNX    WQSC02           Invoice Number
     C                     MOVELP1HNSX    WQSC03           Invoice Suffix
     C                     Z-ADD*ZERO     WCDXNB           Sequence Number
      * Establish starting position
     C           KPSSC     SETLL@BFCPFO                    *
     C           KRSSC     READE@BFCPFO                  90*
      * Data record not found
     C   90                MOVEL'USR0178' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Adjustment Type Code is Spread
      *   |- c2    : PAR.Transaction Amount EQ DB1.Transaction Amount
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WCUHCD    IFEQ 'SPR'                      *IF
     C           P1BSVA    IFEQ WCBSVA                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * DLT A/R Detail         DL - A/R Detail  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWCAIC3    WL0006           Company Number
     C                     Z-ADDWCCONB    WL0007           Invoice Number
     C                     MOVELWCCEST    WL0008    P      Invoice Suffix
     C                     Z-ADDWCDXNB    WL0009           Sequence Number
     C                     EXSR SDDLRC
     C                     END                             *FI
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.Adjustment Type Code is A/R Entry by Customer
      *   |- c2    : WRK.Transaction Amount EQ DB1.Transaction Amount
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WCUHCD    IFEQ 'ARC'                      *IF
     C           WUBSVA    IFEQ WCBSVA                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * DLT A/R Detail         DL - A/R Detail  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWCAIC3    WL0006           Company Number
     C                     Z-ADDWCCONB    WL0007           Invoice Number
     C                     MOVELWCCEST    WL0008    P      Invoice Suffix
     C                     Z-ADDWCDXNB    WL0009           Sequence Number
     C                     EXSR SDDLRC
     C                     END                             *FI
     C           KRSSC     READE@BFCPFO                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * DLT A/R Detail         DL - A/R Detail  * 
      *================================================================
      * This is a shared subroutine
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BFCPFN
     C                     Z-ADDWL0006    WDAIC3           Company Number
     C                     Z-ADDWL0007    WDCONB           Invoice Number
     C                     MOVELWL0008    WDCEST           Invoice Suffix
     C                     Z-ADDWL0009    WDDXNB           Sequence Number
      *
     C           KLDLSD    KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDCONB           Invoice Number
     C                     KFLD           WDCEST           Invoice Suffix
     C                     KFLD           WDDXNB           Sequence Number
     C           KLDLSD    CHAIN@BFCPFN              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'ARBECPL0'MDACP
     C                     MOVEL'@BFCPFN' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BFCPFN                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV Change Amt Pd     RT - A/R Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001 112       USR Adjustments
     C                     Z-ADD*ZERO     WN0002 112       USR Adj Temp To
     C                     Z-ADD*ZERO     WN0003 112       USR Amount Appl
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WECONB           Invoice Number
     C                     KFLD           WECEST           Invoice Suffix
      * Setup key
     C                     Z-ADDWL0010    WEAIC3           Company Number
     C                     Z-ADDWL0011    WECONB           Invoice Number
     C                     MOVELWL0012    WECEST           Invoice Suffix
      * Establish starting position
     C           KRSSE     CHAIN@BDCPF7              90    *
      * Data record not found
     C   90                MOVEL'USR0174' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           WEAOVA    SUB  WL0013    WUAOVA           Amount Paid
     C           WEBGVA    ADD  WL0013    WUBGVA           Remaining Balan
      * CASE: WRK.Remaining Balance Due is equal to zero
     C           WUBGVA    IFEQ *ZERO                      *IF
     C                     Z-ADD##JDT     WUH4DT           Paid in Full Da
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUH4DT           Paid in Full Da
     C                     END                             *FI
      * CHG Adj Amount field   CH - A/R Header  * 
     C                     EXSR SFCHRC
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * CHG Adj Amount field   CH - A/R Header  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0004  3        Adjustment Type
     C                     MOVEL*BLANK    WN0005  1        A/R Processing
     C                     MOVEL*BLANK    WN0006  1        Purge Status
     C                     MOVEL*BLANK    WN0007  6        Bank Code
     C                     Z-ADD*ZERO     WN0008  80       G/L Document Nu
     C                     Z-ADD*ZERO     WN0009  70       Order Number Re
     C                     Z-ADD*ZERO     WN0010  70       Ship To Custome
     C                     MOVEL*BLANK    WN0011  3        Salesperson Cod
     C                     MOVEL*BLANK    WN0012  3        Sales Route Cod
     C                     Z-ADD*ZERO     WN0013  70       Transaction Dat
     C                     Z-ADD*ZERO     WN0014  70       Due Date
     C                     Z-ADD*ZERO     WN0015  70       Last Payment Da
     C                     Z-ADD*ZERO     WN0016  70       Unused Date Cod
     C                     Z-ADD*ZERO     WN0017  70       Last G/L Post D
     C                     Z-ADD*ZERO     WN0018  70       A/R Customer Nu
     C                     MOVEL*BLANK    WN0019 10        A/R Check Numbe
     C                     MOVEL*BLANK    WN0020  1        EDI Status 1
     C                     MOVEL*BLANK    WN0021  1        EDI Status 2
     C                     MOVEL*BLANK    WN0022  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0023  60       Job Time
     C                     MOVEL*BLANK    WN0024 10        User Id
     C                     MOVEL*BLANK    WN0025 10        Job Name
     C                     Z-ADD*ZERO     WN0026  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BDCPFG
     C                     Z-ADDWL0010    WFAIC3           Company Number
     C                     Z-ADDWECONB    WFCONB           Invoice Number
     C                     MOVELWECEST    WFCEST    P      Invoice Suffix
      *
     C           KLCHSF    KLIST
     C                     KFLD           WFAIC3           Company Number
     C                     KFLD           WFCONB           Invoice Number
     C                     KFLD           WFCEST           Invoice Suffix
     C           KLCHSF    CHAIN@BDCPFG              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'ARBDCPL0'MDACP
     C                     MOVEL'@BDCPFG' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QARBD1    YARDCS
      * Move non-key fields to @BDCPFG
     C                     Z-ADDWEBSVA    WFBSVA           Transaction Amo
     C                     Z-ADDWEAIVA    WFAIVA           Adjustment Amou
     C                     Z-ADDWUAOVA    WFAOVA           Amount Paid
     C                     Z-ADDWUBGVA    WFBGVA           Remaining Balan
     C                     Z-ADDWUH4DT    WFH4DT           Paid in Full Da
     C                     Z-ADDWEBSDY    WFBSDY           Days to Pay
      *
      * Set PGM.*Record Data Changed flag
     C           QARBD1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WFAATM           Job Time
     C                     MOVEL##USR     WFAYNA           User Id
     C                     MOVEL##JOB     WFA0NA           Job Name
     C                     Z-ADD##JDT     WFAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QARBD1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BDCPFG                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKARBDCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAJZNX           Reference Numbe
     C                     Z-ADD*ZERO     WABSVA           Transaction Amo
     C                     Z-ADD*ZERO     WAMJDT           Create Date
     C                     Z-ADD*ZERO     WABETM           Create Time
     C                     Z-ADD*ZERO     WAMKDT           Change Date
     C                     Z-ADD*ZERO     WABFTM           Change Time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCCONB           Invoice Number
     C                     Z-ADD*ZERO     WCDXNB           Sequence Number
     C                     Z-ADD*ZERO     WCBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WCB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WCDVDT           Payment/Deposit
     C                     Z-ADD*ZERO     WCYXNX           Deposit Time
     C                     Z-ADD*ZERO     WCHYDT           G/L Post Date
     C                     Z-ADD*ZERO     WCCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WCC1NY           G/L Posting Com
     C                     Z-ADD*ZERO     WCQHDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQIDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQJDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQKDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCQLDT           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGLVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGMVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGNVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGOVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCGPVL           A/R Dtl UnUsed
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Define work field Transaction Amount
     C                     Z-ADD*ZERO     WUBSVA 112
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEAIC3           Company Number
     C                     Z-ADD*ZERO     WECONB           Invoice Number
     C                     Z-ADD*ZERO     WEBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WEAIVA           Adjustment Amou
     C                     Z-ADD*ZERO     WEAOVA           Amount Paid
     C                     Z-ADD*ZERO     WEBGVA           Remaining Balan
     C                     Z-ADD*ZERO     WECKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WECAC7           Order Number Re
     C                     Z-ADD*ZERO     WEBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WEB4DT           Transaction Dat
     C                     Z-ADD*ZERO     WEATDT           Due Date
     C                     Z-ADD*ZERO     WEH0DT           Last Payment Da
     C                     Z-ADD*ZERO     WEH3DT           Unused Date Cod
     C                     Z-ADD*ZERO     WEH4DT           Paid in Full Da
     C                     Z-ADD*ZERO     WEH5DT           Last G/L Post D
     C                     Z-ADD*ZERO     WEANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WEBSDY           Days to Pay
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
      * Define work field Amount Paid
     C                     Z-ADD*ZERO     WUAOVA 112
      * Define work field Remaining Balance Due
     C                     Z-ADD*ZERO     WUBGVA 112
      * Define work field Paid in Full Date
     C                     Z-ADD*ZERO     WUH4DT  70
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SARVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  70
     C                     MOVEL*BLANK    WL0003  2
     C                     Z-ADD*ZERO     WL0004  70
     C                     MOVEL*BLANK    WL0005  2
      * Define local variables for subroutine SDDLRC.
     C                     Z-ADD*ZERO     WL0006  30
     C                     Z-ADD*ZERO     WL0007  70
     C                     MOVEL*BLANK    WL0008  2
     C                     Z-ADD*ZERO     WL0009  30
      * Define local variables for subroutine SERVGN.
     C                     Z-ADD*ZERO     WL0010  30
     C                     Z-ADD*ZERO     WL0011  70
     C                     MOVEL*BLANK    WL0012  2
     C                     Z-ADD*ZERO     WL0013 112
      *================================================================
     CSR         ZZEXIT    ENDSR
