     H/TITLE BPS Dept RMA          PF  Print file
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     W* Warning: This program does not set on the LR indicator
      *
     H* SYNOPSIS :
     H* - Print report of file contents
      *
     H* Generated by  : 2E  Version:  1135
     H* Function type : Print file
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 05/10/04  Time  : 18:46:36
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPDI8CPLMIF  E           K        DISK
      * RSQ : PS Prod Item Schedule     Co/Dpt/Typ/Dt/Itm/Whs RM
      *
     FCABZREL7IF  E           K        DISK
      * RSQ : Company Item              RSQ by Item only      NV
      *
     FPDI7CPL2IF  E           K        DISK
      * RSQ : PS Production Capability  Co/Dept/EftDte(d)
      *
     FPDLMCPL1IF  E           K        DISK
      * RTV : PS Prod Dept Schedule     Retrieval index
      *
     FPDLMCPL0UF  E           K        DISK                      A
      * UPD : PS Prod Dept Schedule     Update index
      *
     FPDAEPFR$O   E             97     PRINTER
     F                                              KINFDS INFDS$
      * PRT: BPS Dept RMA          PF  Print file
      *
     E                    UCT        40  1               CENTER TABLE
     E                    #L3         3  1
     E                    #L7         7  1
     I@LMCPO0
      * PS Prod Dept Schedule     Update index
      * Renamed input format fields
     I              LMAIC3                          WAAIC3
     I              LMV5ST                          WAV5ST
     I              LMELDT                          WAELDT
     I              LMR3CD                          WAR3CD
     I              LMRMPA                          WARMPA
     I              LMGFWG                          WAGFWG
     I              LMGGWG                          WAGGWG
     I              LMCLNB                          WACLNB
     I              LMGHWG                          WAGHWG
     I              LMDVNB                          WADVNB
     I              LMGNWG                          WAGNWG
     I              LMDZNB                          WADZNB
     I              LMGOWG                          WAGOWG
     I              LMD0NB                          WAD0NB
     I              LMGPWG                          WAGPWG
     I              LMD1NB                          WAD1NB
     I              LMGQWG                          WAGQWG
     I              LMD4NB                          WAD4NB
     I              LMGRWG                          WAGRWG
     I              LMTKST                          WATKST
     I              LMTLST                          WATLST
     I              LMTNST                          WATNST
     I              LMCD3S                          WACD3S
     I              LMTVST                          WATVST
     I              LMTWST                          WATWST
     I              LMUVST                          WAUVST
     I              LMUWST                          WAUWST
     I              LMUXST                          WAUXST
     I              LMVSST                          WAVSST
     I              LMAATM                          WAAATM
     I              LMAYNA                          WAAYNA
     I              LMA0NA                          WAA0NA
     I              LMAXDT                          WAAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IINFDS$    E DSY2I$DSP
      * Printer file information data structure
      *
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
     IQPDLM1    E DSPDLMCPL0
      * UPD : PS Prod Dept Schedule     Update index
      * Renamed input format fields
     I              LMAIC3                          WAAIC3
     I              LMV5ST                          WAV5ST
     I              LMELDT                          WAELDT
     I              LMR3CD                          WAR3CD
     I              LMRMPA                          WARMPA
     I              LMGFWG                          WAGFWG
     I              LMGGWG                          WAGGWG
     I              LMCLNB                          WACLNB
     I              LMGHWG                          WAGHWG
     I              LMDVNB                          WADVNB
     I              LMGNWG                          WAGNWG
     I              LMDZNB                          WADZNB
     I              LMGOWG                          WAGOWG
     I              LMD0NB                          WAD0NB
     I              LMGPWG                          WAGPWG
     I              LMD1NB                          WAD1NB
     I              LMGQWG                          WAGQWG
     I              LMD4NB                          WAD4NB
     I              LMGRWG                          WAGRWG
     I              LMTKST                          WATKST
     I              LMTLST                          WATLST
     I              LMTNST                          WATNST
     I              LMCD3S                          WACD3S
     I              LMTVST                          WATVST
     I              LMTWST                          WATWST
     I              LMUVST                          WAUVST
     I              LMUWST                          WAUWST
     I              LMUXST                          WAUXST
     I              LMVSST                          WAVSST
     I              LMAATM                          WAAATM
     I              LMAYNA                          WAAYNA
     I              LMA0NA                          WAA0NA
     I              LMAXDT                          WAAXDT
      *
     IYARDCS      DS                            130
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: PS Prod Item Schedule
      * I : RST Company Number
     I                                    P   1   20P1AIC3
      * I : RST Production Type
     I                                        3   3 P1V5ST
      * I : RST Production Date
     I                                    P   4   70P1ELDT
      * I : RST Department Code
     I                                        8  13 P1R3CD
     IP2PARM      DS
      * FLD: PS Prod Dept Schedule
      * N :  CDS RM Pieces Avail
     I                                    P   1   40P2RMPA
      * N :  CDS RM Weight Avail
     I                                    P   5  102P2GFWG
      * I :  CDS Department Type
     I                                       11  11 P2TKST
     IP3PARM      DS
      * I :  Std Mix Prod Type USR
     I                                        1   2 P3URST
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
     C           P1V5ST    PARM           WP0002  1        Production Type
     C           P1ELDT    PARM           WP0003  70       Production Date
     C           P1R3CD    PARM           WP0004  6        Department Code
     C           P2TKST    PARM           WP0005  1        CDS Department
     C           P3URST    PARM           WP0006  2        Std Mix Prod Ty
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * BPS Dept RMA          PF: Mainline
     C                     EXSR A0MAIN
      * Print headers then End of report format
     C                     EXSR Q0PRNT
     C                     WRITE$IENDRPT
      * Exit program
     C                     EXSR ZXEXPG
      * ------------------------------------------------------
      /EJECT
     CSR         A0MAIN    BEGSR
      *================================================================
      * BPS Dept RMA          PF: Mainline
      *================================================================
      * Declare restrictor key work fields
     C           *LIKE     DEFN I8AIC3    WQKA01           Company Number
     C           *LIKE     DEFN I8R3CD    WQKA02           Department Code
     C           *LIKE     DEFN I8V5ST    WQKA03           Production Type
     C           *LIKE     DEFN I8ELDT    WQKA04           Production Date
      * Define keylist
     C           KRSA      KLIST
     C                     KFLD           WQKA01           Company Number
     C                     KFLD           WQKA02           Department Code
     C                     KFLD           WQKA03           Production Type
     C                     KFLD           WQKA04           Production Date
      * Setup key
     C                     Z-ADDP1AIC3    WQKA01           Company Number
     C                     MOVELP1R3CD    WQKA02           Department Code
     C                     MOVELP1V5ST    WQKA03           Production Type
     C                     Z-ADDP1ELDT    WQKA04           Production Date
      * Establish starting position
     C           KRSA      SETLL@I8CPO9                    *
      * Read first record with user selection
     C                     EXSR A3READ
     C           W0EOFA    IFNE '0'                        IF
     C                     ELSE
      * Request all headings
     C                     MOVEL'Y'       W0AL1P  1        First page
     C                     MOVEL'Y'       W0AL00  1        Company Number
     C                     MOVEL'Y'       W0AL01  1        Department Code
     C                     MOVEL'Y'       W0AL02  1        Production Type
     C                     MOVEL'Y'       W0AL03  1        Production Date
     C                     MOVEL'Y'       W0AL04  1        Item Code
     C                     MOVEL'Y'       W0AL05  1        Warehouse Code
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
      * Print report body
     C           W0EOFA    DOWEQ'0'                        DOW
      * Prepare heading formats for printing
     C                     EXSR A1PHDR
      * Print report detail line
     C                     EXSR A2PDTL
      * Read next record with user selection
     C                     EXSR A3READ
      * Print totals
     C                     EXSR A4PTOT
     C                     END                             WOD
     C                     END                             FI
      *================================================================
     CSR         A0EXIT    ENDSR
      /EJECT
     CSR         A1PHDR    BEGSR
      *================================================================
      * Prepare heading formats for printing
      *================================================================
     C           W0AL1P    IFEQ 'Y'
      * Load key header format
     C                     Z-ADD*ZERO     $BAIC3           Company Number
     C                     MOVEL*BLANK    $BR3CD           Department Code
     C                     MOVEL*BLANK    $BV5ST           Production Type
     C                     Z-ADD*ZERO     $BELDT           Production Date
     C                     MOVEL*BLANK    $BURST           Std Mix Prod Ty
      * USER: Process before print of first page format
      * 1PG = PAR By name
     C                     Z-ADDP1AIC3    $BAIC3           Company Number
     C                     MOVELP1R3CD    $BR3CD           Department Code
     C                     MOVELP1V5ST    $BV5ST           Production Type
     C                     Z-ADDP1ELDT    $BELDT           Production Date
     C                     MOVELP3URST    $BURST           Std Mix Prod Ty
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP1P  1
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
      * Load key header format
     C                     Z-ADDI8AIC3    $CAIC3           Company Number
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP00  1
     C                     END
      *
     C           W0AL01    IFEQ 'Y'
      * Load key header format
     C                     Z-ADDI8AIC3    $DAIC3           Company Number
     C                     MOVELI8R3CD    $DR3CD           Department Code
      * Load related totals format
     C                     Z-ADDI8AIC3    $HAIC3           Company Number
     C                     MOVELI8R3CD    $HR3CD           Department Code
     C                     Z-ADD*ZERO     $HZSNB           Pieces Sched Pr
     C                     Z-ADD*ZERO     $HEAWG           Weight Sched Pr
     C                     MOVEL*BLANK    $HDPT1           Department Type
     C                     Z-ADD*ZERO     $HEOPC           Boning Rate
     C                     Z-ADD*ZERO     $HGGWG           CDS Avg Piece W
     C                     Z-ADD*ZERO     $HPPDA           Pieces Per Day
     C                     Z-ADD*ZERO     $HCLNB           CDS CV Pieces A
     C                     Z-ADD*ZERO     $HDRWG           Weight Per Day
     C                     Z-ADD*ZERO     $HGHWG           CDS CV Weight A
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP01  1
     C                     END
      *
     C           W0AL02    IFEQ 'Y'
      * Load key header format
     C                     Z-ADDI8AIC3    $EAIC3           Company Number
     C                     MOVELI8V5ST    $EV5ST           Production Type
     C                     MOVELI8R3CD    $ER3CD           Department Code
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP02  1
     C                     END
      *
     C           W0AL03    IFEQ 'Y'
      * Load key header format
     C                     Z-ADDI8AIC3    $FAIC3           Company Number
     C                     MOVELI8V5ST    $FV5ST           Production Type
     C                     Z-ADDI8ELDT    $FELDT           Production Date
     C                     MOVELI8R3CD    $FR3CD           Department Code
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP03  1
     C                     END
      *
     C           W0AL04    IFEQ 'Y'
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP04  1
     C                     END
      *
     C           W0AL05    IFEQ 'Y'
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP05  1
     C                     END
      *
      *================================================================
     CSR         A1EXIT    ENDSR
      /EJECT
     CSR         A2PDTL    BEGSR
      *================================================================
      * Process detail record
      *================================================================
      * Load details format
     C                     Z-ADDI8AIC3    $GAIC3           Company Number
     C                     MOVELI8V5ST    $GV5ST           Production Type
     C                     Z-ADDI8ELDT    $GELDT           Production Date
     C                     Z-ADDI8HGCD    $GHGCD           Item Code
     C                     MOVEL*BLANK    $GGENA           Item Descriptio
     C                     MOVELI8AJCD    $GAJCD           Warehouse Code
     C                     Z-ADDI8GPDT    $GGPDT           PS Available Sh
     C                     Z-ADDI8QTSP    $GQTSP           PS Pieces Plann
     C                     Z-ADDI8WTSP    $GWTSP           PS Weight Plann
     C                     Z-ADDI8DJPC    $GDJPC           PS % of Carcass
     C                     Z-ADDI8F8WG    $GF8WG           PS Avg Piece Wg
     C                     Z-ADDI8WTIN    $GWTIN           PS Weight Inv O
     C                     Z-ADDI8D5NB    $GD5NB           PS Pieces Inv O
     C                     Z-ADDI8DXWG    $GDXWG           PS Weight Stand
     C                     Z-ADDI8B2NB    $GB2NB           PS Pieces Stand
     C                     Z-ADDI8WTCN    $GWTCN           PS Weight Conve
     C                     Z-ADDI8PSCV    $GPSCV           PS Pieces Conve
     C                     Z-ADDI8SAWT    $GSAWT           PS Weight Shipp
     C                     Z-ADDI8B9NB    $GB9NB           PS Pieces Shipp
     C                     Z-ADDI8D1WG    $GD1WG           PS Weight Prod
     C                     Z-ADDI8CBNB    $GCBNB           PS Pieces Prod
     C                     Z-ADDI8EZWG    $GEZWG           PS Weight Inv A
     C                     Z-ADDI8CCNB    $GCCNB           PS Pieces Inv A
     C                     Z-ADDI8E0WG    $GE0WG           PS Weight Ship
     C                     Z-ADDI8D6NB    $GD6NB           PS Pieces Ship
     C                     Z-ADDI8OAWT    $GOAWT           PS Weight Prod
     C                     Z-ADDI8CDNB    $GCDNB           PS Pieces Prod
     C                     Z-ADDI8UNW2    $GUNW2           PS Weight Inv A
     C                     Z-ADDI8CENB    $GCENB           PS Pieces Inv A
     C                     Z-ADDI8F9WG    $GF9WG           PS Unit Weight
     C                     Z-ADDI8BPNB    $GBPNB           PS Pieces Unuse
     C                     Z-ADDI8GAWG    $GGAWG           PS Weight Unuse
     C                     Z-ADDI8BQNB    $GBQNB           PS Pieces Unuse
     C                     Z-ADDI8GBWG    $GGBWG           PS Weight Unuse
     C                     Z-ADDI8BRNB    $GBRNB           PS Pieces Unuse
     C                     Z-ADDI8GCWG    $GGCWG           PS Weight Unuse
     C                     Z-ADDI8BSNB    $GBSNB           PS Pieces Unuse
     C                     Z-ADDI8GDWG    $GGDWG           PS Weight Unuse
     C                     Z-ADDI8BWNB    $GBWNB           PS Pieces Unuse
     C                     Z-ADDI8GEWG    $GGEWG           PS Weight Unuse
     C                     Z-ADDI8PS6U    $GPS6U           PS Pieces Unuse
     C                     MOVELI8WCST    $GWCST           PS Item Id
     C                     MOVELI8WPST    $GWPST           Warehouse Type
     C                     MOVELI8B5ST    $GB5ST           PS Lock Status
     C                     MOVELI8TFST    $GTFST           PS Export/Domes
     C                     MOVELI8TEST    $GTEST           PS Print On Sch
     C                     MOVELI8THST    $GTHST           PS Piece Count
     C                     MOVELI8UDST    $GUDST           PS Unused Sts 1
     C                     MOVELI8UFST    $GUFST           PS Unused Sts 2
     C                     MOVELI8UGST    $GUGST           PS Unused Sts 3
     C                     MOVELI8UHST    $GUHST           PS Unused Sts 4
     C                     MOVELI8B6ST    $GB6ST           PS Item Sched N
     C                     MOVELI8B7ST    $GB7ST           PS Shift/Priori
     C                     Z-ADDI8DVWG    $GDVWG           PS Weight Order
     C                     Z-ADDI8D7NB    $GD7NB           PS Pieces Order
     C                     Z-ADDI8FCAD    $GFCAD           PS Weight FC Ad
     C                     Z-ADDI8D9NB    $GD9NB           PS Pieces FC Ad
     C                     Z-ADDI8DWWG    $GDWWG           PS Weight FX Ad
     C                     Z-ADDI8EANB    $GEANB           PS Pieces FX Ad
     C                     Z-ADDI8SHWT    $GSHWT           PS Weight Sched
     C                     Z-ADDI8EBNB    $GEBNB           PS Pieces Sched
     C                     Z-ADDI8AVWT    $GAVWT           PS Weight Avail
     C                     Z-ADDI8ECNB    $GECNB           PS Pieces Avail
     C                     Z-ADDI8WTON    $GWTON           PS Weight Produ
     C                     Z-ADDI8EDNB    $GEDNB           PS Pieces Produ
     C                     Z-ADDI8FNWT    $GFNWT           PS Weight Fab N
     C                     Z-ADDI8EENB    $GEENB           PS Pieces Fab N
     C                     Z-ADDI8QTAS    $GQTAS           PS Weight Sched
     C                     Z-ADDI8EFNB    $GEFNB           PS Pieces Sched
     C                     Z-ADDI8WAIO    $GWAIO           PS Weight Sched
     C                     Z-ADDI8EGNB    $GEGNB           PS Pieces Sched
     C                     MOVELI8R3CD    $GR3CD           Department Code
     C                     Z-ADDI8RGNB    $GRGNB           Item Structure
     C                     Z-ADDI8RHNB    $GRHNB           Item Structure
     C                     Z-ADDI8RINB    $GRINB           Item Structure
     C                     MOVELI8XRCD    $GXRCD           Primal Group Co
     C                     MOVELI8UVST    $GUVST           EDI Status 1
     C                     MOVELI8UWST    $GUWST           EDI Status 2
     C                     MOVELI8UXST    $GUXST           EDI Status 3
     C                     MOVELI8VSST    $GVSST           Record Status
     C                     Z-ADDI8AATM    $GAATM           Job Time
     C                     MOVELI8AYNA    $GAYNA           User Id
     C                     MOVELI8A0NA    $GA0NA           Job Name
     C                     Z-ADDI8AXDT    $GAXDT           Job Date
      * USER: Process before print of detail format
      * Rtv Item Description   RT - Company/Item  * 
     C                     EXSR SCRVGN
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0APDT  1
      * Call print routine
     C                     EXSR Q0PRNT
      * USER: Process after print of detail format
     C                     ADD  $GQTSP    $HZSNB           Pieces Sched Pr
     C                     ADD  $GWTSP    $HEAWG           Weight Sched Pr
      *
      *================================================================
     CSR         A2EXIT    ENDSR
      /EJECT
     CSR         A3READ    BEGSR
      *================================================================
      * Read next record
      *================================================================
      * Hold current values
     C           *LIKE     DEFN I8AIC3    WZA001           Company Number
     C                     Z-ADDI8AIC3    WZA001
     C           *LIKE     DEFN I8R3CD    WZA002           Department Code
     C                     MOVELI8R3CD    WZA002
     C           *LIKE     DEFN I8V5ST    WZA003           Production Type
     C                     MOVELI8V5ST    WZA003
     C           *LIKE     DEFN I8ELDT    WZA004           Production Date
     C                     Z-ADDI8ELDT    WZA004
     C           *LIKE     DEFN I8HGCD    WZA005           Item Code
     C                     Z-ADDI8HGCD    WZA005
     C           *LIKE     DEFN I8AJCD    WZA006           Warehouse Code
     C                     MOVELI8AJCD    WZA006
      * Read next record
     C           W0RSL     DOUEQ'Y'                        DOU
     C           W0EOFA    OREQ '1'
     C           KRSA      READE@I8CPO9                  90*
      * Transfer error indicator to EOF flag
     C                     MOVEL*IN90     W0EOFA  1
      * Quit if no record read
     C           W0EOFA    IFNE '1'                        IF
      * Select record unless user action states otherwise
     C                     MOVEL'Y'       W0RSL   1
     C                     END                             FI
     C                     END                             UOD
      *
      * Reset key level breaks
     C                     MOVEL*BLANK    W0AL00  1        Company Number
     C                     MOVEL*BLANK    W0AL01  1        Department Code
     C                     MOVEL*BLANK    W0AL02  1        Production Type
     C                     MOVEL*BLANK    W0AL03  1        Production Date
     C                     MOVEL*BLANK    W0AL04  1        Item Code
     C                     MOVEL*BLANK    W0AL05  1        Warehouse Code
     C           W0EOFA    IFEQ '1'
      * End of file - Signal all level breaks
     C                     MOVEL'Y'       W0AL00  1        Company Number
     C                     MOVEL'Y'       W0AL01  1        Department Code
     C                     MOVEL'Y'       W0AL02  1        Production Type
     C                     MOVEL'Y'       W0AL03  1        Production Date
     C                     MOVEL'Y'       W0AL04  1        Item Code
     C                     MOVEL'Y'       W0AL05  1        Warehouse Code
     C                     ELSE
      * Next record - Detect level breaks
     C           I8AIC3    IFNE WZA001                     Company Number
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL00
     C                     END
     C           I8R3CD    IFNE WZA002                     Department Code
     C           W0AL00    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL01
     C                     END
     C           I8V5ST    IFNE WZA003                     Production Type
     C           W0AL01    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL02
     C                     END
     C           I8ELDT    IFNE WZA004                     Production Date
     C           W0AL02    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL03
     C                     END
     C           I8HGCD    IFNE WZA005                     Item Code
     C           W0AL03    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL04
     C                     END
     C           I8AJCD    IFNE WZA006                     Warehouse Code
     C           W0AL04    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL05
     C                     END
     C                     END
      *================================================================
     CSR         A3EXIT    ENDSR
      /EJECT
     CSR         A4PTOT    BEGSR
      *================================================================
      * Print report Totals
      *================================================================
      * Print level break totals as required
     C           W0AL05    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP05
     C                     END
      *
     C           W0AL04    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP04
     C                     END
      *
     C           W0AL03    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP03
     C                     END
      *
     C           W0AL02    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP02
     C                     END
      *
     C           W0AL01    IFEQ 'Y'
      * USER: Process before print of Department Code format
     C                     MOVELP2TKST    $HDPT1           Department Type
      * Rtv BngRte/Pcs/Wgt    RT - PS Production Capability  * 
     C                     EXSR SDRVGN
     C                     Z-ADD$HZSNB    P2RMPA           CDS RM Pieces A
     C                     Z-ADD$HEAWG    P2GFWG           CDS RM Weight A
      * CDS Average Piece Weight
      * CASE:
      *  - c1 AND c2
      *   |- c1    : CUR.Pieces Sched Prod SUM is GT Zero
      *   |- c2    : PAR.CDS Department Type is Piece Converting
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           $HZSNB    IFGT *ZERO                      *IF
     C           P2TKST    IFEQ 'P'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C           $HEAWG    DIV  $HZSNB    $HGGWG    H      CDS Avg Piece W
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     $HGGWG           CDS Avg Piece W
     C                     END                             *FI
      * Calculate Converting Pieces/Weight
      * CASE: PAR.CDS Department Type is Piece Converting
     C           P2TKST    IFEQ 'P'                        *IF
      * Conv Pieces Avail
      * CUR.CDS CV Pieces Avail =
      *    *COMPUTE (x1 * (x2 / x3))
      * x1    : PAR.CDS RM Pieces Avail
      * *     : PGM.*Synon (15,0) work field *Rounded
      * x2    : CUR.Boning Rate
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x3    : CON.100
     C           $HEOPC    DIV  100       W0WB01    H      *Synon (15,5) w
     C           P2RMPA    MULT W0WB01    W0WJ00    H      *Synon (15,0) w
     C                     Z-ADDW0WJ00    $HCLNB           CDS CV Pieces A
      * CASE: CUR.CDS CV Pieces Avail GT CUR.Pieces Per Day
     C           $HCLNB    IFGT $HPPDA                     *IF
     C                     Z-ADD$HPPDA    $HCLNB           CDS CV Pieces A
     C                     END                             *FI
      * Conv Weight Avail
      * CUR.CDS CV Weight Avail =
      *    *COMPUTE (x1 * x2)
      * x1    : CUR.CDS CV Pieces Avail
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x2    : CUR.CDS Avg Piece Wgt
     C           $HCLNB    MULT $HGGWG    W0WA00           *Synon (15,2) w
     C                     Z-ADDW0WA00    $HGHWG           CDS CV Weight A
     C                     ELSE
      * CASE: PAR.CDS Department Type is Weight Converting
     C           P2TKST    IFEQ 'W'                        *IF
      * Conv weight Avail
      * CUR.CDS CV Weight Avail =
      *    *COMPUTE (x1 * (x2 / x3))
      * x1    : PAR.CDS RM Weight Avail
      * *     : PGM.*Synon (15,2) work field *Rounded
      * x2    : CUR.Boning Rate
      * /     : PGM.*Synon (15,5) work field *Rounded
      * x3    : CON.100
     C           $HEOPC    DIV  100       W0WB01    H      *Synon (15,5) w
     C           P2GFWG    MULT W0WB01    W0WA00    H      *Synon (15,2) w
     C                     Z-ADDW0WA00    $HGHWG           CDS CV Weight A
      * CASE: CUR.CDS CV Weight Avail GT CUR.Weight Per Day
     C           $HGHWG    IFGT $HDRWG                     *IF
     C                     Z-ADD$HDRWG    $HGHWG           CDS CV Weight A
     C                     END                             *FI
      * Conv Pieces Avail
      * CASE: CUR.CDS Avg Piece Wgt is GT Zero
     C           $HGGWG    IFGT *ZERO                      *IF
      * Conv Pieces Avail
      * CUR.CDS CV Pieces Avail =
      *    *COMPUTE (x1 / x2)
      * x1    : CUR.CDS CV Weight Avail
      * /     : PGM.*Synon (15,0) work field *
      * x2    : CUR.CDS Avg Piece Wgt
     C           $HGHWG    DIV  $HGGWG    W0WJ00           *Synon (15,0) w
     C                     Z-ADDW0WJ00    $HCLNB           CDS CV Pieces A
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * If there is not enough space on the
      * physical page for this format:
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 7
      * Signal new page required
     C                     MOVE 'Y'       W0NEWP
      * Start new page
     C                     EXSR Q0PRNT
     C                     END
      * Convert fields to external form
      * Print format
     C                     WRITE$HKEYTTL
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP01
      * USER: Process after print of Department Code format
      * BPS Upd Dept Sch/Pln  RT - PS Prod Dept Schedule  * 
     C                     EXSR SERVGN
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP00
     C                     END
      *
     C           W0EOFA    IFEQ '1'
     C                     END
      *
      *================================================================
     CSR         A4EXIT    ENDSR
      /EJECT
     CSR         Q0PRNT    BEGSR
      *================================================================
      * Print report formats
      *================================================================
      * Select formats to print
     C                     EXSR Q1FSEL
      * Calculate length of formats selected for printing
     C                     EXSR Q2PLEN
      * Add column heading length to print length
     C                     ADD  W0COLN    W0FSUM
     C           W0NEWP    IFNE 'Y'
      * Signal overflow if requested headings would cause
      * detail format to start past the overflow line
     C           W0FSUM    IFGT W0OFL
     C                     MOVE 'Y'       W0NEWP
     C                     ELSE
      * Signal overflow if requested headings would cause
      * Detail format to be printed past end of page
     C                     ADD  W0DTLN    W0FSUM
     C           W0FSUM    IFGT W0PGL
     C                     MOVE 'Y'       W0NEWP
     C                     END
     C                     END
     C                     END
      * Print Standard report header of BPS Dept RMA          PF
      * If it is ready to print, then do so,
     C           W0NEWP    IFEQ 'Y'                        IF
     C                     EXSR Q3PTNP
     C                     END                             FI
      *
      * Print First Page Format of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP1P    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP1P    ANDEQ'P'
      * Convert fields to external form
      * Convert Company Number to external.
      * CD3 Int/Ext
      * CASE: PAR.CD3 Int Numeric Key is not equal zero
     C           $BAIC3    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUDMCD           CD3 Ext Numeric
     C                     MOVEL$BAIC3    WUDMCD           CD3 Ext Numeric
      * CD3 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUDMCD    #L3              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   3
     C           #L3,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L3,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L3       WUDMCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUDMCD    VBAIC3           CD3 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VBAIC3           CD3 Ext Numeric
     C                     END                             *FI
      * Convert Production Date to display format
      * Convert date
     C           1000000   ADD  $BELDT    XDINDT
     C                     EXSR XDVC2T
     C                     Z-ADDXDEXDT    VBELDT
      * Print format
     C                     WRITE$B1STPAG
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0AP1P
      * Clear first page flag.
     C                     MOVE *BLANK    W0AL1P
     C                     END                             FI
      * Print Company Number of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP00    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP00    ANDEQ'P'
      * Mention hidden format
     C   99N99             WRITE$CKEYHDR
      * Reset format print flag
     C                     MOVE *BLANK    W0AP00
     C                     END                             FI
      * Print Department Code of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP01    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP01    ANDEQ'P'
      * Mention hidden format
     C   99N99             WRITE$DKEYHDR
      * Reset format print flag
     C                     MOVE *BLANK    W0AP01
     C                     END                             FI
      * Print Production Type of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP02    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP02    ANDEQ'P'
      * Mention hidden format
     C   99N99             WRITE$EKEYHDR
      * Reset format print flag
     C                     MOVE *BLANK    W0AP02
     C                     END                             FI
      * Print Production Date of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP03    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP03    ANDEQ'P'
      * Mention hidden format
     C   99N99             WRITE$FKEYHDR
      * Reset format print flag
     C                     MOVE *BLANK    W0AP03
     C                     END                             FI
      * Print Item Code of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP04    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP04    ANDEQ'P'
      * Reset format print flag
     C                     MOVE *BLANK    W0AP04
     C                     END                             FI
      * Print Warehouse Code of BPS Dept RMA          PF
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP05    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP05    ANDEQ'P'
      * Reset format print flag
     C                     MOVE *BLANK    W0AP05
     C                     END                             FI
      * Print Detail line. of BPS Dept RMA          PF
      * If new page then set column headings active
     C           W0NEWP    IFEQ 'Y'
     C                     MOVE 'Y'       W0ACDT  1
     C                     END
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0APDT    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0APDT    ANDEQ'P'
      * Convert fields to external form
      * Convert Item Code to external.
      * CD7 Int/Ext
      * CASE: PAR.CD7 Int Numeric Key is not equal zero
     C           $GHGCD    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUEOCD           CD7 Ext Numeric
     C                     MOVEL$GHGCD    WUEOCD           CD7 Ext Numeric
      * CD7 Int/Ext EXCUSRSRC - *Field attribute types  * 
     C                     MOVEAWUEOCD    #L7              EDIT ARRAY
     C                     Z-ADD1         #E      30
     C                     MOVE *IN61     UUIN61  1
     C                     SETOF                     61
     C                     DO   7
     C           #L7,#E    IFEQ '0'                        ZERO VALUE
     C           *IN61     IFEQ '0'
     C                     MOVE ' '       #L7,#E
     C                     ADD  1         #E
     C                     END
     C                     ELSE
     C                     SETON                     61
     C                     END
     C                     END
     C                     MOVEA#L7       WUEOCD
     C                     MOVE UUIN61    *IN61
     C                     MOVELWUEOCD    VGHGCD           CD7 Ext Numeric
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    VGHGCD           CD7 Ext Numeric
     C                     END                             *FI
      * Print column headings if required
     C           W0ACDT    IFEQ 'Y'
     C                     WRITE$GCOLHDG
      * Clear column headings control flag
     C                     MOVE *BLANK    W0ACDT
     C                     END                             FI
      * Print format
     C                     WRITE$GDTLRCD
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0APDT
     C                     END                             FI
      * Clear new page flag
     C                     MOVE *BLANK    W0NEWP
      *================================================================
     CSR         Q0EXIT    ENDSR
      /EJECT
     CSR         Q1FSEL    BEGSR
      *================================================================
      * Format select
      *================================================================
      *================================================================
     CSR         Q1EXIT    ENDSR
      /EJECT
     CSR         Q2PLEN    BEGSR
      *================================================================
      * Evaluate print length
      *================================================================
     C           *LIKE     DEFN @$CLN     W0FSUM
     C           *LIKE     DEFN @$CLN     W0DTLN
     C           *LIKE     DEFN @$CLN     W0COLN
     C                     Z-ADD@$CLN     W0FSUM
     C                     Z-ADD*ZERO     W0DTLN
     C                     Z-ADD*ZERO     W0COLN
      * * First Page Format of BPS Dept RMA          PF
     C           W0AP1P    IFEQ 'Y'
     C                     ADD  5         W0FSUM
     C                     END                             FI
      *
      * * Company Number of BPS Dept RMA          PF
     C           W0AP00    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Department Code of BPS Dept RMA          PF
     C           W0AP01    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Production Type of BPS Dept RMA          PF
     C           W0AP02    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Production Date of BPS Dept RMA          PF
     C           W0AP03    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Item Code of BPS Dept RMA          PF
     C           W0AP04    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Warehouse Code of BPS Dept RMA          PF
     C           W0AP05    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Detail line. of BPS Dept RMA          PF
     C           W0APDT    IFEQ 'Y'
     C                     Z-ADD1         W0DTLN
     C           W0ACDT    IFEQ 'Y'
     C                     Z-ADD4         W0COLN
     C                     END                             FI
     C                     END                             FI
      *
      *================================================================
     CSR         Q2EXIT    ENDSR
      /EJECT
     CSR         Q3PTNP    BEGSR
      *================================================================
      * Format select
      *================================================================
     C                     WRITE$APAGHDR
      * Clear page overflow indicator
     C                     SETOF                     97    *
      *================================================================
     CSR         Q3EXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSA01           Application Cod
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSA01           Application Cod
     C                     MOVEL'P/S'     WQSA01           Application Cod
      * Establish starting position
     C           KRSSA     SETLL@DNRESF                    *
     C           KRSSA     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           DNRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SBRVGN
     C                     END                             *FI
     C           KRSSA     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN DNDNCD    WQSB01           Application Cod
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Application Cod
      * Setup key
     C                     MOVELDNRSCD    WQSB01           Application Cod
      * Establish starting position
     C           KRSSB     SETLL@DNRESF                    *
     C           KRSSB     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELDNAUNA    WUAUNA           Description
     C           KRSSB     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Item Description   RT - Company/Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN BZHGCD    WQSC01           Item Code
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Item Code
      * Setup key
     C                     Z-ADD$GHGCD    WQSC01           Item Code
      * Establish starting position
     C           KRSSC     SETLL@BZRED0                    *
     C           KRSSC     READE@BZRED0                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0326' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    $GGENA           Description Lin
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELBZAVNA    $GGENA           Description Lin
     C           KRSSC     READE@BZRED0                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv BngRte/Pcs/Wgt    RT - PS Production Capability  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN I7AIC3    WQSD01           Company Number
     C           *LIKE     DEFN I7R3CD    WQSD02           Department Code
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Department Code
     C                     KFLD           I7GJDT           Effective Produ
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Department Code
      * Setup key
     C                     Z-ADD$HAIC3    WQSD01           Company Number
     C                     MOVEL$HR3CD    WQSD02           Department Code
     C                     Z-ADDP1ELDT    I7GJDT           Effective Produ
      * Establish starting position
     C           KPSSD     SETLL@I7CPBK                    *
     C           KRSSD     READE@I7CPBK                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1761' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     Z-ADD*ZERO     $HPPDA           Pieces Per Day
     C                     Z-ADD*ZERO     $HDRWG           Weight Per Day
     C                     Z-ADD*ZERO     $HEOPC           Boning Rate
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDI7PPDA    $HPPDA           Pieces Per Day
     C                     Z-ADDI7DRWG    $HDRWG           Weight Per Day
     C                     Z-ADDI7EOPC    $HEOPC           Boning Rate
     C                     GOTO SDEXIT                     *QUIT
     C           KRSSD     READE@I7CPBK                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * BPS Upd Dept Sch/Pln  RT - PS Prod Dept Schedule  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0002 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0003  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0004 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0005  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0006 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0007  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0008 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0009  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0010 112       CDS Weight Unus
     C                     MOVEL*BLANK    WN0011  1        CDS Unused Sts
     C                     MOVEL*BLANK    WN0012  1        CDS Unused Sts
     C                     MOVEL*BLANK    WN0013  2        CDS Unused Sts
     C                     MOVEL*BLANK    WN0014  2        CDS Unused Sts
     C                     MOVEL*BLANK    WN0015  3        CDS Unused Sts
     C                     MOVEL*BLANK    WN0016  1        EDI Status 1
     C                     MOVEL*BLANK    WN0017  1        EDI Status 2
     C                     MOVEL*BLANK    WN0018  1        EDI Status 3
     C                     MOVEL*BLANK    WN0019  1        Record Status
     C                     Z-ADD*ZERO     WN0020  60       Job Time
     C                     MOVEL*BLANK    WN0021 10        User Id
     C                     MOVEL*BLANK    WN0022 10        Job Name
     C                     Z-ADD*ZERO     WN0023  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           LMAIC3           Company Number
     C                     KFLD           LMV5ST           Production Type
     C                     KFLD           LMELDT           Production Date
     C                     KFLD           LMR3CD           Department Code
      * Setup key
     C                     Z-ADD$HAIC3    LMAIC3           Company Number
     C                     MOVELP1V5ST    LMV5ST           Production Type
     C                     Z-ADDP1ELDT    LMELDT           Production Date
     C                     MOVEL$HR3CD    LMR3CD           Department Code
      * Establish starting position
     C           KRSSE     CHAIN@LMCPO1              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2507' W0RTN   7
      * USER: Processing if Data record not found
      * Create PS Prod Dept Sched - PS Prod Dept Schedule  * 
     C                     EXSR SFCRRC
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * BPS Chg Dept Sch/Pln  CH - PS Prod Dept Schedule  * 
     C                     EXSR SGCHRC
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * Create PS Prod Dept Sched - PS Prod Dept Schedule  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @LMCPO0
     C                     Z-ADD$HAIC3    WAAIC3           Company Number
     C                     MOVELP1V5ST    WAV5ST           Production Type
     C                     Z-ADDP1ELDT    WAELDT           Production Date
     C                     MOVEL$HR3CD    WAR3CD           Department Code
     C                     Z-ADDP2RMPA    WARMPA           CDS RM Pieces A
     C                     Z-ADDP2GFWG    WAGFWG           CDS RM Weight A
     C                     Z-ADD$HGGWG    WAGGWG           CDS Avg Piece W
     C                     Z-ADD$HCLNB    WACLNB           CDS CV Pieces A
     C                     Z-ADD$HGHWG    WAGHWG           CDS CV Weight A
     C                     Z-ADDWN0001    WADVNB           CDS Pieces Unus
     C                     Z-ADDWN0002    WAGNWG           CDS Weight Unus
     C                     Z-ADDWN0003    WADZNB           CDS Pieces Unus
     C                     Z-ADDWN0004    WAGOWG           CDS Weight Unus
     C                     Z-ADDWN0005    WAD0NB           CDS Pieces Unus
     C                     Z-ADDWN0006    WAGPWG           CDS Weight Unus
     C                     Z-ADDWN0007    WAD1NB           CDS Pieces Unus
     C                     Z-ADDWN0008    WAGQWG           CDS Weight Unus
     C                     Z-ADDWN0009    WAD4NB           CDS Pieces Unus
     C                     Z-ADDWN0010    WAGRWG           CDS Weight Unus
     C                     MOVELP2TKST    WATKST           CDS Department
     C                     MOVELWN0011    WATLST           CDS Unused Sts
     C                     MOVELWN0012    WATNST           CDS Unused Sts
     C                     MOVELWN0013    WACD3S           CDS Unused Sts
     C                     MOVELWN0014    WATVST           CDS Unused Sts
     C                     MOVELWN0015    WATWST           CDS Unused Sts
     C                     MOVELWN0016    WAUVST           EDI Status 1
     C                     MOVELWN0017    WAUWST           EDI Status 2
     C                     MOVELWN0018    WAUXST           EDI Status 3
     C                     MOVELWN0019    WAVSST           Record Status
     C                     Z-ADDWN0020    WAAATM           Job Time
     C                     MOVELWN0021    WAAYNA           User Id
     C                     MOVELWN0022    WAA0NA           Job Name
     C                     Z-ADDWN0023    WAAXDT           Job Date
      *
      * USER: Processing before Data update
      * UPS CRTOBJ Stamp      IF
     C                     MOVEL'A'       WAVSST           Record Status
     C                     Z-ADD##JTM     WAAATM           Job Time
     C                     MOVEL##USR     WAAYNA           User Id
     C                     MOVEL##PGM     WAA0NA           Job Name
     C                     Z-ADD##JDT     WAAXDT           Job Date
     C           KLCRSF    KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAV5ST           Production Type
     C                     KFLD           WAELDT           Production Date
     C                     KFLD           WAR3CD           Department Code
      * Check for duplicate primary key
     C           KLCRSF    SETLL@LMCPO0                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR2508' W0RTN   7
      * Send message 'PS Prod Dept Schedule  EX'
     C                     MOVEL'USR2508' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@LMCPO0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCHRC    BEGSR
      *================================================================
      * BPS Chg Dept Sch/Pln  CH - PS Prod Dept Schedule  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0024  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0025 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0026  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0027 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0028  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0029 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0030  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0031 112       CDS Weight Unus
     C                     Z-ADD*ZERO     WN0032  70       CDS Pieces Unus
     C                     Z-ADD*ZERO     WN0033 112       CDS Weight Unus
     C                     MOVEL*BLANK    WN0034  1        CDS Department
     C                     MOVEL*BLANK    WN0035  1        CDS Unused Sts
     C                     MOVEL*BLANK    WN0036  1        CDS Unused Sts
     C                     MOVEL*BLANK    WN0037  2        CDS Unused Sts
     C                     MOVEL*BLANK    WN0038  2        CDS Unused Sts
     C                     MOVEL*BLANK    WN0039  3        CDS Unused Sts
     C                     MOVEL*BLANK    WN0040  1        EDI Status 1
     C                     MOVEL*BLANK    WN0041  1        EDI Status 2
     C                     MOVEL*BLANK    WN0042  1        EDI Status 3
     C                     MOVEL*BLANK    WN0043  1        Record Status
     C                     Z-ADD*ZERO     WN0044  60       Job Time
     C                     MOVEL*BLANK    WN0045 10        User Id
     C                     MOVEL*BLANK    WN0046 10        Job Name
     C                     Z-ADD*ZERO     WN0047  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @LMCPO0
     C                     Z-ADDLMAIC3    WAAIC3           Company Number
     C                     MOVELLMV5ST    WAV5ST    P      Production Type
     C                     Z-ADDLMELDT    WAELDT           Production Date
     C                     MOVELLMR3CD    WAR3CD    P      Department Code
      *
     C           KLCHSG    KLIST
     C                     KFLD           WAAIC3           Company Number
     C                     KFLD           WAV5ST           Production Type
     C                     KFLD           WAELDT           Production Date
     C                     KFLD           WAR3CD           Department Code
     C           KLCHSG    CHAIN@LMCPO0              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDLMCPL0'MDACP
     C                     MOVEL'@LMCPO0' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPDLM1    YARDCS
      * Move non-key fields to @LMCPO0
     C                     Z-ADDP2RMPA    WARMPA           CDS RM Pieces A
     C                     Z-ADDP2GFWG    WAGFWG           CDS RM Weight A
     C                     Z-ADD$HGGWG    WAGGWG           CDS Avg Piece W
     C                     Z-ADD$HCLNB    WACLNB           CDS CV Pieces A
     C                     Z-ADD$HGHWG    WAGHWG           CDS CV Weight A
      *
      * Set PGM.*Record Data Changed flag
     C           QPDLM1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * USER: Processing before Data update
      * UPS CHGOBJ Stamp      IF
     C                     Z-ADD##JTM     WAAATM           Job Time
     C                     MOVEL##USR     WAAYNA           User Id
     C                     MOVEL##PGM     WAA0NA           Job Name
     C                     Z-ADD##JDT     WAAXDT           Job Date
      * Set PGM.*Record Data Changed flag
     C           QPDLM1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@LMCPO0                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDLMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         XDVC2T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDINDD    XDEX02           DD
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDINMM    XDEX02           MM
     C                     Z-ADDXDINDD    XDEX03           DD
     C                     Z-ADDXDINYY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDINYY    XDEX02           YY
     C                     Z-ADDXDINMM    XDEX03           MM
     C                     Z-ADDXDINDD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDVC2E    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2RMPA           CDS RM Pieces A
     C                     Z-ADD*ZERO     P2GFWG           CDS RM Weight A
      *
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Initialize KEY fields.
     C                     MOVEL*LOVAL    I8AIC3           Company Number
     C                     MOVEL*LOVAL    I8R3CD           Department Code
     C                     MOVEL*LOVAL    I8V5ST           Production Type
     C                     MOVEL*LOVAL    I8ELDT           Production Date
     C                     MOVEL*LOVAL    I8HGCD           Item Code
     C                     MOVEL*LOVAL    I8AJCD           Warehouse Code
      * Define work field CD3 Ext Numeric Key
     C                     MOVEL*BLANK    WUDMCD  3
      * Define work field CD7 Ext Numeric Key
     C                     MOVEL*BLANK    WUEOCD  7
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAELDT           Production Date
     C                     Z-ADD*ZERO     WARMPA           CDS RM Pieces A
     C                     Z-ADD*ZERO     WAGFWG           CDS RM Weight A
     C                     Z-ADD*ZERO     WAGGWG           CDS Avg Piece W
     C                     Z-ADD*ZERO     WACLNB           CDS CV Pieces A
     C                     Z-ADD*ZERO     WAGHWG           CDS CV Weight A
     C                     Z-ADD*ZERO     WADVNB           CDS Pieces Unus
     C                     Z-ADD*ZERO     WAGNWG           CDS Weight Unus
     C                     Z-ADD*ZERO     WADZNB           CDS Pieces Unus
     C                     Z-ADD*ZERO     WAGOWG           CDS Weight Unus
     C                     Z-ADD*ZERO     WAD0NB           CDS Pieces Unus
     C                     Z-ADD*ZERO     WAGPWG           CDS Weight Unus
     C                     Z-ADD*ZERO     WAD1NB           CDS Pieces Unus
     C                     Z-ADD*ZERO     WAGQWG           CDS Weight Unus
     C                     Z-ADD*ZERO     WAD4NB           CDS Pieces Unus
     C                     Z-ADD*ZERO     WAGRWG           CDS Weight Unus
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    W0WB01 155       *Synon (15,5) w
     C                     Z-ADD*ZEROS    W0WJ00 150       *Synon (15,0) w
     C                     Z-ADD*ZEROS    W0WA00 152       *Synon (15,2) w
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'N'       W0PMT   1
      * Declare initial value data areas
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   $ACMP
     C                     IN   *NAMVAR
      *................................................................
     C                     MOVEL##PGM     $APGM
     C                     MOVEL##USR     $AUSR
     C                     MOVEL*BLANK    W0PFM   1
     C                     Z-ADD*ZERO     @$WRK   40
     C                     Z-ADD*ZERO     @$HDL   40
     C                     Z-ADD*ZERO     @$CLN
     C                     Z-ADD*ZERO     @$PGN
      * Adjust page length and overflow as necessary
     C           @$PGL     SUB  2         W0PGL   40
     C           @$OFL     IFGE W0PGL
     C           W0PGL     SUB  2         W0OFL   40
     C                     ELSE
     C                     Z-ADD@$OFL     W0OFL
     C                     END
      * Clear overflow indicator
     C                     SETOF                     97
      * Request new page
     C                     MOVEL'Y'       W0NEWP  1
      * USER: Initialize program
      * VAL Rtv & Ctr Prt Hdg  IF
      * SET Setup Prt Headings IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SARVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * Center Txt String 40 - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc to PrtCo US - /UT User Source  * 
     C                     MOVE WUDE40    $ACMP
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
      *================================================================
     CSR         ZZEXIT    ENDSR
