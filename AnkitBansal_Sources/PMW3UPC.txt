/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  SUBMITTED PROGRAM TO PRINT AUTOMATED ORDERS         */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  PROGRAM   - PROCESSES AND PRINTS THE AUTOMATED ORDER REPORTS    */
/*  DATE      - 07/16/2008                                          */
/*  PROGRAMMER- LARA BUSER                                          */
/*                                                                  */
/*  PARAMETERS:                                                     */
/*  O    &RETURN     - RETURN CODE                                  */
/*  I    &APPLIC     - APPLICATION CODE                             */
/*  I    &PGM        - SUBMITTED CL PROGRAM TO PRINT JCO REPORT     */
/*  I    &DESC       - PRINT PROGRAM DESCRIPTION                    */
/*  B    &OUTQ       -  OUTPUT QUEUE                                */
/*  B    &HOLD       -  HOLD STATUS                                 */
/*  B    &SAVE       -  SAVE STATUS                                 */
/*  B    &NQSTAT     -  INDICATOR WHETHER MUST RUN IN NIGHT Q       */
/*  B    &NIGHTQ     -  NIGHT JOB QUEUE                             */
/*  B    &CUSTN      - CUSTOMER NUMBER 15.5 (BILL TO CUSTOMER)      */
/*  B    &FRMDATN    - FROM ACTUAL SHIPPED DATE 15.5                */
/*  B    &THRDATN    - THRU ACTUAL SHIPPED DATE 15.5                */
/*  B    &FROMPRCDE  - FROM PRICE CODE 15.5  ** ZEROS PASSED IN     */
/*  B    &TOPRCDE    - TO PRICE CODE 15.5    ** ZEROS PASSED IN     */
/*  B    &COPYN      - NO. OF COPIES  (PASSED)                      */
/*  B    &EMAILADDR  - EMAIL ADDRESS                                */
/*  B    &SELECT     - PASSED AS 1 CHAR - 1 THRU 8                  */
/*  B    &BROKER     - BROKER CODE (SEI FOR SEIDAI/SUMIE)           */
/********************************************************************/
/* JBB 11/28/2018 E14027   Recompiled Only.  No source to compare.  */
/*     This program was not the issue.  The issue was a SQL view.   */
/* 09/19/2017 DN  E011527  UNDO &SELECT CHANGE FROM 2 BACK TO 1 BYTE*/
/* 08/25/2017 LJB E011527  SELECT FIELD CHANGED TO 2 CHAR.          */
/* 07/24/2014 LJB E003182  ADD ORDER NUMBER AND FROM AND THRU       */
/*   PO NUMBERS                                                     */
/* 11/07/2013 LJB E002854  ADD PRINTER PARMS TO CLP, ADD CALL       */
/*   TO PRINTER OPTIONS PGM. PASS PRINTER PARMS TO CALLED           */
/*   PGMS. ADD MANIFEST TYPE TO PARM LIST                           */
/* 06/12/2013 LJB E002587  REMOVE PRINTED REPORT - EMAIL            */
/*   SPREADSHEET ONLY. CHANGE TO RUN BY BILL TO CUSTOMER #.         */
/*   ADD WAREHOUSE TYPE - FRESH OR FROZEN, PASS BROKER TO PMX7UPC,  */
/*   ADD NEW PROGRAM SAME AS PMX7UPC BUT FOR BROKER NOT BLANKS      */
/* 03/20/2012 LJB E001893  ADD COMPANY TO ALL THE SEQUEL VIEWS      */
/*   AND TO THE REPORTS, TABLES, SPREADSHEETS.                      */
/*   NOTE: SEQUEL'S SELECT BY REQUESTED SHIP DATE, NOT ASD.         */
/* 01/06/2012 LJB E001704  ADD BROKER CODE TO PARMS. PASS TO        */
/*   JAPANESE REPORT.                                               */
/* 06/06/2011 LJB C001593  CHANGE JCO_V4 TO USE ITEM DESCRIPTION    */
/*   FROM THE ORDER DETAIL INSTEAD OF THE ITEM DEFAULT. NO RECORDS  */
/*   FOR 960 IN THE ITEM DEFAULT FILE.                              */
/* 03/03/2010 LJB E000227  ADD COMPANY NUMBER PARM. ADD AN          */
/*   ADDITIONAL SPREADSHEET: SUMMARY OF ALL ITEMS SHIPPED BY        */
/*   CUSTOMER FOR SELECTED PRICE CODE RANGE AND DATE RANGE.         */
/*   COMPANY WILL BE FOR REPORT SELECTION 4 ONLY.                   */
/* 10/30/2009 LJB E00520   ADD A NEW SPREADSHEET FUNCTION WITH      */
/*   ORDERED QUANTITY AND WEIGHT, AND ONE WITH BOTH SHIPPED AND     */
/*   ORDERED.                                                       */
/* 09/09/2008 LJB E00220   ADD NEW SEQUEL TO CREATE AND EMAIL A     */
/*   SPREADSHEET ONLY SUMMARY REPORT BY PRICE CODE, DATE RANGE AND  */
/*   COMPANY#. COMPANY NUMBER PARM ADDED TO EMAIL TYPE = "S".       */
/*   COMPANY NUMBER NOT ALLOWED ON OTHER REPORT TYPES.              */
/********************************************************************/
 PMW3UPC:    PGM        PARM(&RETURN &OUTQ &HOLD &SAVE &COPYN &COMPN +
                          &CUSTN &FRMDATN &THRDATN &ORDERN +
                          &WHSETYPE &SELECT &PO#FILLED &BROKER +
                          &MANTYPE &PONBR &EMAILADDR)

             DCL        VAR(&RETURN)    TYPE(*CHAR) LEN(7)
             DCL        VAR(&COMPN)     TYPE(*DEC)
             DCL        VAR(&COMP)      TYPE(*DEC)  LEN(3)
             DCL        VAR(&COMPA)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&CUSTN)     TYPE(*DEC)
             DCL        VAR(&CUST)      TYPE(*DEC)  LEN(7)
             DCL        VAR(&CUSTA)     TYPE(*CHAR) LEN(7)
             DCL        VAR(&EMAILADDR) TYPE(*CHAR) LEN(50)
             DCL        VAR(&EMAILTYPE) TYPE(*CHAR) LEN(1) VALUE('S')
             DCL        VAR(&SELECT)    TYPE(*CHAR) LEN(1)
             DCL        VAR(&FRMDATN)   TYPE(*DEC)
             DCL        VAR(&FROMDT)    TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&FROMDTA)   TYPE(*CHAR) LEN(7)
             DCL        VAR(&FDATE)     TYPE(*CHAR) LEN(12)
             DCL        VAR(&THRDATN)   TYPE(*DEC)
             DCL        VAR(&TODT)      TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&TODTA)     TYPE(*CHAR) LEN(7)
             DCL        VAR(&TDATE)     TYPE(*CHAR) LEN(12)
             DCL        VAR(&OUTQ)      TYPE(*CHAR) LEN(10)
             DCL        VAR(&HOLD)      TYPE(*CHAR) LEN(4)
             DCL        VAR(&SAVE)      TYPE(*CHAR) LEN(4)
             DCL        VAR(&COPYN)     TYPE(*DEC)
             DCL        VAR(&COPIES)    TYPE(*DEC) LEN(2 0)
             DCL        VAR(&BROKER)    TYPE(*CHAR) LEN(6)
             DCL        VAR(&WHSETYPE)  TYPE(*CHAR) LEN(2)
             DCL        VAR(&FROMPRCDE) TYPE(*DEC)  LEN(7)
             DCL        VAR(&TOPRCDE)   TYPE(*CHAR) LEN(7)
             DCL        VAR(&ORDERN)    TYPE(*DEC)
             DCL        VAR(&PONBR)     TYPE(*CHAR) LEN(15)
             DCL        VAR(&PO#FILLED) TYPE(*CHAR) LEN(15)
/* ERROR MESSAGE FIELDS                                             */
             DCL        VAR(&MSG)       TYPE(*CHAR) LEN(512)
             DCL        VAR(&MSGID)     TYPE(*CHAR) LEN(7)
             DCL        VAR(&MSGL)      TYPE(*DEC)  LEN(5 0)
             DCL        VAR(&SUBJECT)   TYPE(*CHAR) LEN(80)
             DCL        VAR(&EMSG)      TYPE(*CHAR) LEN(100)
             DCL        VAR(&MANTYPE)   TYPE(*CHAR) LEN(2)

             MONMSG     MSGID(CPF0000)

             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&CUST) VALUE(&CUSTN)
             CHGVAR     VAR(&CUSTA) VALUE(&CUST)
             CHGVAR     VAR(&COMP) VALUE(&COMPN)
             CHGVAR     VAR(&COMPA) VALUE(&COMP)
             CHGVAR     VAR(&COPIES) VALUE(&COPYN)
             CHGVAR     VAR(&SUBJECT) VALUE('Japanese Orders Report')

             IF         COND(&FRMDATN *GT 0) THEN(DO)
             CHGVAR     VAR(&FROMDT) VALUE(&FRMDATN)
             CHGVAR     VAR(&FROMDTA) VALUE(&FROMDT)
             CVTDAT     DATE(&FROMDTA) TOVAR(&FDATE) FROMFMT(*CYMD) +
                          TOFMT(*MDYY) TOSEP('/')
             ENDDO

             IF         COND(&THRDATN *GT 0) THEN(DO)
             CHGVAR     VAR(&TODT) VALUE(&THRDATN)
             CHGVAR     VAR(&TODTA) VALUE(&TODT)
             CVTDAT     DATE(&TODTA) TOVAR(&TDATE) FROMFMT(*CYMD) +
                          TOFMT(*MDYY) TOSEP('/')
             ENDDO

/*-------------------------------------------------------------------*/
/* CREATE AND EMAIL THE SPREADSHEET                                  */
/*-------------------------------------------------------------------*/
 SPRDSHEET:  IF         COND(&EMAILTYPE *EQ 'S') THEN(DO)

             IF         COND(&BROKER *EQ '      ') THEN(CALL +
                          PGM(PMX7UPC) PARM(&COMPN &CUSTN &FRMDATN +
                          &THRDATN &ORDERN &WHSETYPE &RETURN +
                          &PO#FILLED &BROKER &SELECT &OUTQ &HOLD +
                          &SAVE &COPYN &MANTYPE &PONBR &EMAILADDR))

 XLS_BROKER: IF         COND(&BROKER *NE '      ') THEN(CALL +
                          PGM(PBJDUPC) PARM(&COMPN &CUSTN &FRMDATN +
                          &THRDATN &ORDERN &WHSETYPE &EMAILADDR +
                          &RETURN &PO#FILLED &BROKER &SELECT &OUTQ +
                          &HOLD &SAVE &COPYN &MANTYPE &PONBR))

             ENDDO      /*  &EMAILTYPE *EQ 'S'  */
             GOTO       CMDLBL(END)

/*-------------------------USER QUIT--------------------------------*/
 QFILERROR:  CHGVAR     VAR(&RETURN) VALUE('Y2U0005')
             GOTO       CMDLBL(END)

/*----------------------RECEIVE MESSAGES----------------------------*/
 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM
