// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUJSXFR
// ?Date: 14.08.2025 Time: 03:50:33
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modification history
DO;

//?10/11/2018 JBB E13896 - Check Day of Week and Time Range
//? - Function created.  This function receives company values for a
//?   Day of the Week, a From Time, and a To Time.  The values are
//?   retrieved for the Company Values and are compared to the
//?   current day and time.  If the current day is the same as the
//?   Company Value Day of the Week, and the current time is within
//?   From and To Company Values, the Yes 'Y' flag is output.  If it
//?   is not within the from and to times, the No ' ' flag is output.
ENDDO;

//?Get the current day of the week and current time
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

//?Get current Day of the Week
// LCL.Current Day of the Week = JOB.*Job date *DAY OF WEEK
LCL.Current_Day_of_the_Week = DATEDTLS(JOB.*Job_date 'DW' 1111111 'NONE' 'N' 1);

//?Get current time
// LCL.Current Time = JOB.*Job time
LCL.Current_Time = JOB.*Job_time;

ENDIF;

//?Retrieve the Company Values for Day of Week and Time range
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
PARAMETER(PAR.Company);
PARAMETER(PAR.Company_Value_Day_of_Week);
PARAMETER(LCL.System_Value_Numeric);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Day of Week (SYN) USR = LCL.System Value Numeric
LCL.Day_of_Week_SYN_USR = LCL.System_Value_Numeric;

EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
PARAMETER(PAR.Company);
PARAMETER(PAR.Company_Value_From_Time);
PARAMETER(LCL.System_Value_Numeric);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Time From = LCL.System Value Numeric
LCL.Time_From = LCL.System_Value_Numeric;

EXECUTE FUNCTION(RTV Numeric Value      RT) TYPE(RTVOBJ) FILE(PDKMREP)          AC1394480;
PARAMETER(PAR.Company);
PARAMETER(PAR.Company_Value_To_Time);
PARAMETER(LCL.System_Value_Numeric);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


// LCL.Time To = LCL.System Value Numeric
LCL.Time_To = LCL.System_Value_Numeric;

ENDIF;

//?Compare current day/time values to incoming parameter values
CASE;

// IF LCL.Current Day of the Week NE LCL.Day of Week (SYN) USR
IF LCL.Current_Day_of_the_Week <> LCL.Day_of_Week_SYN_USR;

// PAR.Within Day and Time = CND.No
PAR.Within_Day_and_Time = *BLANK;

//?Compare current day/time values to incoming parameter values
// IF LCL.Current Time LT LCL.Time From
IF LCL.Current_Time < LCL.Time_From;

// PAR.Within Day and Time = CND.No
PAR.Within_Day_and_Time = *BLANK;

//?Compare current day/time values to incoming parameter values
// IF LCL.Current Time GT LCL.Time To
IF LCL.Current_Time > LCL.Time_To;

// PAR.Within Day and Time = CND.No
PAR.Within_Day_and_Time = *BLANK;

//?Compare current day/time values to incoming parameter values
// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Within Day and Time = CND.Yes
PAR.Within_Day_and_Time = 'Y';

ENDIF;

