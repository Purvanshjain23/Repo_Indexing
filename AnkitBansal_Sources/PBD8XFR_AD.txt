// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBD8XFR
// ?Date: 14.08.2025 Time: 03:47:35
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Count how many days back it is until 3 production days have been counted
EXECUTE FUNCTION(RTV Prior Prod Day    RT) TYPE(RTVOBJ) FILE(CAAFREP)           AC2047105;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Post_to_G_L_Date);
PARAMETER(PAR.CTL_Prior_Day);
PARAMETER(PAR.Date_From_USR);
PARAMETER(PAR.Day_1_Production_50_USR);
{
 //?USER: Initialize routine

 //?CTL Prior Day is the number of days to count backwards
 // PAR.Count USR = CON.1
 PAR.Count_USR = 1;

 // PAR.Day 1 Production 5,0  USR = CON.*ZERO
 PAR.Day_1_Production_50_USR = *ZERO;

 //?USER: Process Data record

 //?If input parm is 0 days to go back, force exit
 CASE;

 // IF PAR.CTL Prior Day is Zero
 IF PAR.CTL_Prior_Day = *ZERO;

 // PAR.Day 1 Production 5,0  USR = CON.*ZERO
 PAR.Day_1_Production_50_USR = 0;

 // PAR.Date From             USR = DB1.Post to G/L Date
 PAR.Date_From_USR = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

 //?Dont count 1st day as 1 day
 CASE;

 // IF PAR.Post to G/L Date NE DB1.Post to G/L Date
 IF PAR.Post_to_G_L_Date <> DB1.Post_to_G_L_Date;

 // PAR.Day 1 Production 5,0  USR = PAR.Day 1 Production 5,0  USR + CON.1
 PAR.Day_1_Production_50_USR = PAR.Day_1_Production_50_USR + 1;

 ENDIF;

 CASE;

 // IF DB1.Production Day Status is yes
 IF DB1.Production_Day_Status = 'Y';

 CASE;

 // IF PAR.Post to G/L Date EQ DB1.Post to G/L Date
 IF PAR.Post_to_G_L_Date = DB1.Post_to_G_L_Date;

 // IF *OTHERWISE
 IF *OTHERWISE;

 CASE;

 // IF PAR.CTL Prior Day EQ PAR.Count USR
 IF PAR.CTL_Prior_Day = PAR.Count_USR;

 // PAR.Date From             USR = DB1.Post to G/L Date
 PAR.Date_From_USR = DB1.Post_to_G_L_Date;

 QUIT;

 ENDIF;

 // PAR.Count USR = PAR.Count USR + CON.1
 PAR.Count_USR = PAR.Count_USR + 1;

 ENDIF;

 ENDIF;

}


