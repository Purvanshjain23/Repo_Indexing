// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PMOQXFR
// ?Date: 14.08.2025 Time: 03:43:39
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// LCL.Return Code Usr = CND.*Blank
LCL.Return_Code_Usr = *BLANK;

// LCL.Text USR 5 = CON.*INQ
LCL.Text_USR_5 = *INQ;

// LCL.Subject Line USR = CONCAT(CON.Please place Purge tapes,CON.into the tape drive (C,G),CON.1)
LCL.Subject_Line_USR = 'Please place Purge tapes' + 'into the tape drive (C,G)' (1);

// Call program CLP SNDUSRMSG-rply opt UP.
CALL PROGRAM(CLP SNDUSRMSG-rply opt UP) ('POKAUPR');
PARAMETER(LCL.Return_Code_Usr);
PARAMETER(LCL.Subject_Line_USR);
PARAMETER(LCL.Text_USR_5);

CASE;

// IF LCL.Return Code Usr is *Blank
IF LCL.Return_Code_Usr = *BLANK;

EXECUTE FUNCTION(RTV Copy Files to Tape RT) TYPE(RTVOBJ) FILE(PMBEREP)          AC1851895;
PARAMETER(PAR.Purge_Run_Frequency);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 // PAR.Return Code Usr = CND.None
 PAR.Return_Code_Usr = 'NONE';

 // PAR.PCA Purge Method = CND.Tape
 PAR.PCA_Purge_Method = 'T';

 EXECUTE FUNCTION(RTV Zmbr 4Appli by Frq RT) TYPE(RTVOBJ) FILE(PDLPREP)          AC1932292;
 PARAMETER(DB1.PCG_Code);
 PARAMETER(DB1.PCG_From_Library);
 PARAMETER(PAR.Purge_Run_Frequency);
 PARAMETER(PAR.PCA_Purge_Method);
 PARAMETER(DB1.PCG_Purge_To_Library);
 PARAMETER(LCL.Return_Code_Usr);
 {
  //?USER: Processing if Data record not found

  // PAR.Return Code Usr = CND.None
  PAR.Return_Code_Usr = 'NONE';

  //?USER: Process Data record

  //?07/21/25 DN SDD1296-Commented Out. Copy/Added C3 Record Status='Active'.
  //?For Method=Tape only, and Frequency = par.frequency
  CASE;

  // IF DB1.Purge Run Frequency EQ PAR.Purge Run Frequency
  IF DB1.Purge_Run_Frequency = PAR.Purge_Run_Frequency;

  // AND DB1.PCA Purge Method EQ PAR.PCA Purge Method
  AND DB1.PCA_Purge_Method = PAR.PCA_Purge_Method;

  // AND DB1.Record Status is Active
  AND DB1.Record_Status = 'A';

  //?07/21/25 DN SDD1296-Added c3 condition.
  EXECUTE FUNCTION(Val "Z" Members Exist  RT) TYPE(RTVOBJ) FILE(PDLQREP)          AC1932279;
  PARAMETER(PAR.PCG_Code);
  PARAMETER(PAR.PCG_From_Library);
  PARAMETER(PAR.PCG_Purge_To_Library);
  PARAMETER(PAR.Return_Code_Usr);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   // PAR.Return Code Usr = CND.None
   PAR.Return_Code_Usr = 'NONE';

   //?USER: Process Data record

   // PAR.Return Code Usr = CND.None
   PAR.Return_Code_Usr = 'NONE';

   // Call program CLP Val "Z" Mbrs Exist CL.
   CALL PROGRAM(CLP Val "Z" Mbrs Exist CL) ('PMRIUPC');
   PARAMETER(PAR.PCG_Code);
   PARAMETER(PAR.PCG_From_Library);
   PARAMETER(DB1.Purge_Application_Code);
   PARAMETER(DB1.Purge_Tape_Physical);
   PARAMETER(PAR.PCG_Purge_To_Library);
   PARAMETER(PAR.Return_Code_Usr);

   CASE;

   // IF PAR.Return Code Usr is Record Found
   IF PAR.Return_Code_Usr = 'RCDFND';

   QUIT;

   ENDIF;

  }

  ENDIF;

 }

 CASE;

 // IF LCL.Return Code Usr is Record Found
 IF LCL.Return_Code_Usr = 'RCDFND';

 // Call program EXC Copy to Tape       CL.
 CALL PROGRAM(EXC Copy to Tape       CL) ('PMK9UPC');
 PARAMETER(PAR.Return_Code_Usr);
 PARAMETER(DB1.PCG_Code);
 PARAMETER(DB1.PCG_From_Library);
 PARAMETER(PAR.Purge_Run_Frequency);
 PARAMETER(DB1.PCG_Purge_To_Library);

 ENDIF;

 ENDIF;

}


// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Text USR 5 = CON.*INFO
LCL.Text_USR_5 = *INFO;

// LCL.Subject Line USR = CONCAT(CON.Copy purged records to,CON.tape was cancelled,CON.1)
LCL.Subject_Line_USR = 'Copy purged records to' + 'tape was cancelled' (1);

// Call program CLP SNDUSRMSG-rply opt UP.
CALL PROGRAM(CLP SNDUSRMSG-rply opt UP) ('POKAUPR');
PARAMETER(LCL.Return_Code_Usr);
PARAMETER(LCL.Subject_Line_USR);
PARAMETER(LCL.Text_USR_5);

ENDIF;

