     H/TITLE Snd PFS Manif Hdr&Dtl XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 06/27/24  Time  : 10:46:49
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPPBRCPL3  IF   E           K DISK
      * RSQ : PFS Manifest Header       Co/ManifID SEL Unprocess
      *
     FCAADREL1  IF   E           K DISK
      * RTV : Warehouse Codes           Retrieval index       NV
      *
     FPPBNCPL3  IF   E           K DISK
      * RSQ : PFS Manifest Detail       ManifID/DtlID SEL Unproc
      *
     FPPBNCPL0  UF   E           K DISK
      * UPD : PFS Manifest Detail       Update index
      *
     FPPBRCPL0  UF   E           K DISK
      * UPD : PFS Manifest Header       Update index
      *
      * Long constants
     D @CN#            S              6    DIM(10)CTDATA PERRCD(1)
     D @CN             S             25    DIM(10) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
     D QPPBN1        E DS                  EXTNAME(PPBNCPL0)
      * UPD : PFS Manifest Detail       Update index
      * Renamed input format fields
     D  WDKENZ       E                     EXTFLD(BNKENZ)
     D  WDKFNZ       E                     EXTFLD(BNKFNZ)
     D  WDZPNX       E                     EXTFLD(BNZPNX)
     D  WDZXNX       E                     EXTFLD(BNZXNX)
     D  WDZYNX       E                     EXTFLD(BNZYNX)
     D  WDWGU1       E                     EXTFLD(BNWGU1)
     D  WDBZSC       E                     EXTFLD(BNBZSC)
     D  WDU4SX       E                     EXTFLD(BNU4SX)
     D  WDE6AB       E                     EXTFLD(BNE6AB)
     D  WDP7DT       E                     EXTFLD(BNP7DT)
     D  WDXOU1       E                     EXTFLD(BNXOU1)
     D  WDY2NX       E                     EXTFLD(BNY2NX)
     D  WDZ4NX       E                     EXTFLD(BNZ4NX)
     D  WDZ8NX       E                     EXTFLD(BNZ8NX)
     D  WDKWNZ       E                     EXTFLD(BNKWNZ)
     D  WDKXNZ       E                     EXTFLD(BNKXNZ)
     D  WDAANY       E                     EXTFLD(BNAANY)
     D  WDUWSX       E                     EXTFLD(BNUWSX)
     D  WDUXSX       E                     EXTFLD(BNUXSX)
     D  WDAHNY       E                     EXTFLD(BNAHNY)
     D  WDAINY       E                     EXTFLD(BNAINY)
     D  WDAJNY       E                     EXTFLD(BNAJNY)
     D  WDAKNY       E                     EXTFLD(BNAKNY)
      *
     D YARDCS          DS           166
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
     D QPPBR1        E DS                  EXTNAME(PPBRCPL0)
      * UPD : PFS Manifest Header       Update index
      * Renamed input format fields
     D  WEKENZ       E                     EXTFLD(BRKENZ)
     D  WEY1NX       E                     EXTFLD(BRY1NX)
     D  WEZPNX       E                     EXTFLD(BRZPNX)
     D  WEX4DT       E                     EXTFLD(BRX4DT)
     D  WEF8AA       E                     EXTFLD(BRF8AA)
     D  WEF9AA       E                     EXTFLD(BRF9AA)
     D  WEVESX       E                     EXTFLD(BRVESX)
     D  WEUWSX       E                     EXTFLD(BRUWSX)
     D  WEUXSX       E                     EXTFLD(BRUXSX)
     D  WEAHNY       E                     EXTFLD(BRAHNY)
     D  WEAINY       E                     EXTFLD(BRAINY)
     D  WEAJNY       E                     EXTFLD(BRAJNY)
     D  WEAKNY       E                     EXTFLD(BRAKNY)
      *
     D YBRDCS          DS            75
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              3
     D  WP0002         S              1
     D  WP0003         S              1
     D  WP0004         S              1
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  YL0001         S              3  0
     D  WQSA01         S                   LIKE(WAY1NX)
     D  YL0002         S              1
     D  YL0003         S              3  0
     D  WQSC01         S                   LIKE(WCKENZ)
     D  YL0004         S             20
     D  WQ0001         S             20
     D  WQ0002         S             20
     D  WQ0003         S             10
     D  WQ0004         S             10
     D  W0CLPG         S             10
     D  WQ0005         S             20
     D  WQ0006         S             20
     D  WQ0007         S             10
     D  WQ0008         S             10
     D  WQ0009         S             20
     D  WQ0010         S             20
     D  WQ0011         S             10
     D  WQ0012         S             10
     D  WQSD01         S                   LIKE(WCKENZ)
     D  YL0005         S             20
     D  YL0006         S             20
     D  WQ0013         S             20
     D  WQ0014         S             20
     D  WQ0015         S             10
     D  WQ0016         S             10
     D  WQ0017         S             20
     D  WQ0018         S             20
     D  WQ0019         S             10
     D  WQ0020         S             10
     D  WQ0021         S             20
     D  WQ0022         S             20
     D  WQ0023         S             10
     D  WQ0024         S             10
     D  WN0001         S              7  0
     D  WN0002         S              3  0
     D  WN0003         S              3  0
     D  WN0004         S             17  0
     D  WN0005         S              2
     D  WN0006         S              3
     D  WN0007         S              6
     D  WN0008         S              8  0
     D  WN0009         S             10
     D  WN0010         S              7  0
     D  WN0011         S              8  0
     D  WN0012         S              8  2
     D  WN0013         S              2  0
     D  WN0014         S              4  0
     D  WN0015         S              8  2
     D  WN0016         S              1
     D  WN0017         S              8  0
     D  WN0018         S              6  0
     D  WN0019         S              8  0
     D  WN0020         S              6  0
     D  YARDC          S              1
     D  WQ0025         S             15  5
     D  WQ0026         S             15  5
     D  WL0001         S             20  0
     D  WL0002         S              1  0
     D  WN0021         S              3  0
     D  WN0022         S              7  0
     D  WN0023         S              8  0
     D  WN0024         S              3
     D  WN0025         S              3
     D  WN0026         S              1
     D  WN0027         S              1
     D  WN0028         S              8  0
     D  WN0029         S              6  0
     D  WN0030         S              8  0
     D  WN0031         S              6  0
     D  YBRDC          S              1
     D  WQ0027         S             15  5
     D  WQ0028         S             15  5
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * I :  PFS Company Number Alpha
     D  P1EWU1                 1      3
     D P2PARM          DS
      * O :  Upd Suffix File f/360 USR
     D  P2P2SC                 1      1
     D P3PARM          DS
      * O :  Upd Suffix File f/440 USR
     D  P3P3SC                 1      1
     D P4PARM          DS
      * O :  Upd Suffix File f/960 USR
     D  P4P4SC                 1      1
     D                 DS
     D  ZAMSDA                 1    132
     I@BRCPQN
      * PFS Manifest Header       Co/ManifID SEL Unprocess
      * Renamed input format fields
     I              BRKENZ                      WAKENZ
     I              BRY1NX                      WAY1NX
     I              BRZPNX                      WAZPNX
     I              BRX4DT                      WAX4DT
     I              BRF8AA                      WAF8AA
     I              BRF9AA                      WAF9AA
     I              BRVESX                      WAVESX
     I              BRUWSX                      WAUWSX
     I              BRUXSX                      WAUXSX
     I              BRAHNY                      WAAHNY
     I              BRAINY                      WAAINY
     I              BRAJNY                      WAAJNY
     I              BRAKNY                      WAAKNY
      *
     I@ADREAO
      * Warehouse Codes           Retrieval index       NV
      * Renamed input format fields
     I              ADAJCD                      WBAJCD
     I              ADF8NA                      WBF8NA
     I              ADACNA                      WBACNA
     I              ADADNA                      WBADNA
     I              ADAENA                      WBAENA
     I              ADAJNA                      WBAJNA
     I              ADBTTX                      WBBTTX
     I              ADAOCD                      WBAOCD
     I              ADBGCD                      WBBGCD
     I              ADVHST                      WBVHST
     I              ADMPNA                      WBMPNA
     I              ADWPST                      WBWPST
     I              ADXUST                      WBXUST
     I              ADT0ST                      WBT0ST
     I              ADT1ST                      WBT1ST
     I              ADDBNB                      WBDBNB
     I              ADT2ST                      WBT2ST
     I              ADT3ST                      WBT3ST
     I              ADT4ST                      WBT4ST
     I              ADT6ST                      WBT6ST
     I              ADBWC3                      WBBWC3
     I              ADBTC3                      WBBTC3
     I              ADBUC3                      WBBUC3
     I              ADBVC3                      WBBVC3
     I              ADFCAA                      WBFCAA
     I              ADRQSX                      WBRQSX
     I              ADRRSX                      WBRRSX
     I              ADRSSX                      WBRSSX
     I              ADRTSX                      WBRTSX
     I              ADT7ST                      WBT7ST
     I              ADT8ST                      WBT8ST
     I              ADRNSX                      WBRNSX
     I              ADROSX                      WBROSX
     I              ADRPSX                      WBRPSX
     I              ADUVST                      WBUVST
     I              ADUWST                      WBUWST
     I              ADUXST                      WBUXST
     I              ADVSST                      WBVSST
     I              ADAATM                      WBAATM
     I              ADAYNA                      WBAYNA
     I              ADA0NA                      WBA0NA
     I              ADAXDT                      WBAXDT
      *
     I@BNCPQQ
      * PFS Manifest Detail       ManifID/DtlID SEL Unproc
      * Renamed input format fields
     I              BNKENZ                      WCKENZ
     I              BNKFNZ                      WCKFNZ
     I              BNZPNX                      WCZPNX
     I              BNZXNX                      WCZXNX
     I              BNZYNX                      WCZYNX
     I              BNWGU1                      WCWGU1
     I              BNBZSC                      WCBZSC
     I              BNU4SX                      WCU4SX
     I              BNE6AB                      WCE6AB
     I              BNP7DT                      WCP7DT
     I              BNXOU1                      WCXOU1
     I              BNY2NX                      WCY2NX
     I              BNZ4NX                      WCZ4NX
     I              BNZ8NX                      WCZ8NX
     I              BNKWNZ                      WCKWNZ
     I              BNKXNZ                      WCKXNZ
     I              BNAANY                      WCAANY
     I              BNUWSX                      WCUWSX
     I              BNUXSX                      WCUXSX
     I              BNAHNY                      WCAHNY
     I              BNAINY                      WCAINY
     I              BNAJNY                      WCAJNY
     I              BNAKNY                      WCAKNY
      *
     I@BNCPZL
      * PFS Manifest Detail       Update index
      * Renamed input format fields
     I              BNKENZ                      WDKENZ
     I              BNKFNZ                      WDKFNZ
     I              BNZPNX                      WDZPNX
     I              BNZXNX                      WDZXNX
     I              BNZYNX                      WDZYNX
     I              BNWGU1                      WDWGU1
     I              BNBZSC                      WDBZSC
     I              BNU4SX                      WDU4SX
     I              BNE6AB                      WDE6AB
     I              BNP7DT                      WDP7DT
     I              BNXOU1                      WDXOU1
     I              BNY2NX                      WDY2NX
     I              BNZ4NX                      WDZ4NX
     I              BNZ8NX                      WDZ8NX
     I              BNKWNZ                      WDKWNZ
     I              BNKXNZ                      WDKXNZ
     I              BNAANY                      WDAANY
     I              BNUWSX                      WDUWSX
     I              BNUXSX                      WDUXSX
     I              BNAHNY                      WDAHNY
     I              BNAINY                      WDAINY
     I              BNAJNY                      WDAJNY
     I              BNAKNY                      WDAKNY
      *
     I@BRCPPD
      * PFS Manifest Header       Update index
      * Renamed input format fields
     I              BRKENZ                      WEKENZ
     I              BRY1NX                      WEY1NX
     I              BRZPNX                      WEZPNX
     I              BRX4DT                      WEX4DT
     I              BRF8AA                      WEF8AA
     I              BRF9AA                      WEF9AA
     I              BRVESX                      WEVESX
     I              BRUWSX                      WEUWSX
     I              BRUXSX                      WEUXSX
     I              BRAHNY                      WEAHNY
     I              BRAINY                      WEAINY
     I              BRAJNY                      WEAJNY
     I              BRAKNY                      WEAKNY
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1EWU1        PARM                    WP0001                         PFS Company Num
     C                   PARM      P2P2SC        WP0002                         Upd Suffix File
     C                   PARM      P3P3SC        WP0003                         Upd Suffix File
     C                   PARM      P4P4SC        WP0004                         Upd Suffix File
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Snd PFS Manif Hdr&Dtl XF
     C                   MOVEL     'N'           P2P2SC                         Upd Suffix File
     C                   MOVEL     'N'           P3P3SC                         Upd Suffix File
     C                   MOVEL     'N'           P4P4SC                         Upd Suffix File
     C                   MOVE      P1EWU1        YL0001                         PFS Company Num
      * Snd PFS Manif Hdr&Dtl RT - PFS Manifest Header  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Snd PFS Manif Hdr&Dtl RT - PFS Manifest Header  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * USER: Initialize routine
     C                   MOVEL     'N'           P2P2SC                         Upd Suffix File
     C                   MOVEL     'N'           P3P3SC                         Upd Suffix File
     C                   MOVEL     'N'           P4P4SC                         Upd Suffix File
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WQSA01                         PFS Company Num
      * Setup key
     C                   Z-ADD     YL0001        WQSA01                         PFS Company Num
      * Establish starting position
     C     KRSSA         SETLL     @BRCPQN                                      *
     C     KRSSA         READE     @BRCPQN                                90    *
      * Data record not found
     C   90              MOVEL     'USR5405'     W0RTN
      * USER: Process Data record
      * Initialization.
      * CASE: *OTHERWISE
     C                   DOW       NOT *IN90
     C                   MOVEL     'Y'           YL0002                         Continue (Yes/N
      * Get Shipping Company from PFS Ship To Warehouse.
      * RTV Shipping Co        RT - Warehouse Codes  * 
     C                   EXSR      SBRVGN
      * Validations.
      * CASE: *OTHERWISE
      * HDR & DTL Records Must Exist ELSE Set to PFS Process Sts to 'Erro
      * CASE: *OTHERWISE
      * Rtv Record Exist      RT - PFS Manifest Detail  * 
     C                   EXSR      SCRVGN
      * Record Exist?
      * CASE: PGM.*Return code is *Normal
     C                   IF        W0RTN = ' '
     C                   ELSE
      * CASE: *OTHERWISE
      * Per Judi Llupo (Carlisle), we should NEVER have orphan during
      * their export data to Seaboard.
     C                   MOVEL     'N'           YL0002                         Continue (Yes/N
     C                   END                                                    *FI
      * Processing.
      * CASE: LCL.Continue (Yes/No) USR is Yes
     C                   IF        YL0002 = 'Y'
     C                   MOVEL     WAKENZ        YL0004                         PFS Manifest ID
      * The Shipping Co will Designate What Suffixed File to Write to.
      * Copy PFS Manifest HDR Record to Suffixed File in QTEMP - *ADD.
      * CASE: LCL.Shipping Company is Guymon
     C                   IF        YL0003 = 360
     C                   MOVEL     'Y'           P2P2SC                         Upd Suffix File
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0004        WQ0001                         PFS Manifest ID
     C                   PARM      @CN(001)      WQ0002                         PFS Manifest De
     C                   PARM      @CN(002)      WQ0003                         File Name
     C                   PARM      @CN(003)      WQ0004                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   ELSE
      * CASE: LCL.Shipping Company is Sioux City
     C                   IF        YL0003 = 440
     C                   MOVEL     'Y'           P3P3SC                         Upd Suffix File
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0004        WQ0005                         PFS Manifest ID
     C                   PARM      @CN(001)      WQ0006                         PFS Manifest De
     C                   PARM      @CN(002)      WQ0007                         File Name
     C                   PARM      @CN(004)      WQ0008                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   ELSE
      * CASE: LCL.Shipping Company is St. Joseph
     C                   IF        YL0003 = 960
     C                   MOVEL     'Y'           P4P4SC                         Upd Suffix File
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0004        WQ0009                         PFS Manifest ID
     C                   PARM      @CN(005)      WQ0010                         PFS Manifest De
     C                   PARM      @CN(002)      WQ0011                         File Name
     C                   PARM      @CN(006)      WQ0012                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Read PFS Manifest Dtl to Copy Record in Suffixed File in QTEMP -
      * Snd PFS Manifest DTL  RT - PFS Manifest Detail  * 
     C                   EXSR      SDRVGN
      * Chg PFS Process Status CH - PFS Manifest Header  * Upd to Process
      * Move input parameters to subroutine local variables.
     C                   Z-ADD     WAKENZ        WL0001                         PFS Manifest ID
     C                   Z-ADD     1             WL0002                         PFS Process Sta
     C                   EXSR      SFCHRC
     C                   END                                                    *FI
      * If Error, Update PFS Process Status=2 (Error/Void).
      * CASE: LCL.Continue (Yes/No) USR is No
      * This scenario should not happen, per Carlisle.
      * Chg PFS Process Status CH - PFS Manifest Header  * 
      * Move input parameters to subroutine local variables.
     C                   IF        YL0002 = 'N'
     C                   Z-ADD     WAKENZ        WL0001                         PFS Manifest ID
     C                   Z-ADD     2             WL0002                         PFS Process Sta
     C                   EXSR      SFCHRC
     C                   END                                                    *FI
     C     KRSSA         READE     @BRCPQN                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * RTV Shipping Co        RT - Warehouse Codes  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WBAJCD                         Warehouse Code
      * Setup key
     C                   MOVEL     WAF9AA        WBAJCD                         Warehouse Code
      * Establish starting position
     C     KRSSB         CHAIN     @ADREAO                            90        *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'USR0007'     W0RTN
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                   Z-ADD     *ZERO         YL0003                         Shipping Compan
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * PAR = DB1 By name
     C                   IF        NOT *IN90
     C                   Z-ADD     WBBWC3        YL0003                         Shipping Compan
     C                   ENDIF
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCRVGN        BEGSR
      *================================================================
      * Rtv Record Exist      RT - PFS Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSC         KLIST
     C                   KFLD                    WQSC01                         PFS Manifest ID
      * Setup key
     C                   Z-ADD     WAKENZ        WQSC01                         PFS Manifest ID
      * Establish starting position
     C     KRSSC         SETLL     @BNCPQQ                                      *
     C     KRSSC         READE     @BNCPQQ                                90    *
      * Data record not found
     C   90              MOVEL     'USR3510'     W0RTN
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   GOTO      SCEXIT                                       *QUIT
     C     KRSSC         READE     @BNCPQQ                                90    *
     C                   ENDDO
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDRVGN        BEGSR
      *================================================================
      * Snd PFS Manifest DTL  RT - PFS Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSD         KLIST
     C                   KFLD                    WQSD01                         PFS Manifest ID
      * Setup key
     C                   Z-ADD     WAKENZ        WQSD01                         PFS Manifest ID
      * Establish starting position
     C     KRSSD         SETLL     @BNCPQQ                                      *
     C     KRSSD         READE     @BNCPQQ                                90    *
      * Data record not found
     C   90              MOVEL     'USR3510'     W0RTN
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   MOVEL     WCKENZ        YL0005                         PFS Manifest ID
     C                   MOVEL     WCKFNZ        YL0006                         PFS Manifest De
      * Copy PFS Manifest DTL Record to Suffixed File in QTEMP - *ADD.
      * CASE: PAR.Shipping Company is Guymon
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   IF        YL0003 = 360
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0005        WQ0013                         PFS Manifest ID
     C                   PARM      YL0006        WQ0014                         PFS Manifest De
     C                   PARM      @CN(007)      WQ0015                         File Name
     C                   PARM      @CN(008)      WQ0016                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   ELSE
      * CASE: PAR.Shipping Company is Sioux City
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   IF        YL0003 = 440
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0005        WQ0017                         PFS Manifest ID
     C                   PARM      YL0006        WQ0018                         PFS Manifest De
     C                   PARM      @CN(007)      WQ0019                         File Name
     C                   PARM      @CN(009)      WQ0020                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   ELSE
      * CASE: PAR.Shipping Company is St. Joseph
      * Cpy ManHdrDtl to SfxFilCL - PFS Manifest Header  * 
     C                   IF        YL0003 = 960
     C                   CALL      'PVDAUPC'                            90      Cpy ManHdrDtl t
     C                   PARM      YL0005        WQ0021                         PFS Manifest ID
     C                   PARM      YL0006        WQ0022                         PFS Manifest De
     C                   PARM      @CN(007)      WQ0023                         File Name
     C                   PARM      @CN(010)      WQ0024                         Download Suffix
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVDAUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
      * Chg PFS Process Status CH - PFS Manifest Detail  * Upd to Process
     C                   EXSR      SECHRC
     C     KRSSD         READE     @BNCPQQ                                90    *
     C                   ENDDO
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SECHRC        BEGSR
      *================================================================
      * Chg PFS Process Status CH - PFS Manifest Detail  * Upd to Proces
      *================================================================
      *
     C                   Z-ADD     *ZERO         WN0001                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WN0002                         PFS Order Line
     C                   Z-ADD     *ZERO         WN0003                         PFS Substitutio
     C                   Z-ADD     *ZERO         WN0004                         PFS Pallet ID
     C                   EVAL      WN0005 = ' '                                 PFS Fresh_Froze
     C                   EVAL      WN0006 = ' '                                 PFS From Wareho
     C                   EVAL      WN0007 = ' '                                 PFS Manifest Lo
     C                   Z-ADD     *ZERO         WN0008                         PFS Production
     C                   EVAL      WN0009 = ' '                                 PFS Serial Numb
     C                   Z-ADD     *ZERO         WN0010                         PFS Item Code
     C                   Z-ADD     *ZERO         WN0011                         PFS Label Date
     C                   Z-ADD     *ZERO         WN0012                         PFS Net Weight
     C                   Z-ADD     *ZERO         WN0013                         PFS Date AI
     C                   Z-ADD     *ZERO         WN0014                         PFS Weight AI
     C                   Z-ADD     *ZERO         WN0015                         PFS Gross Weigh
     C                   EVAL      WN0016 = ' '                                 PFS Record Stat
     C                   Z-ADD     *ZERO         WN0017                         PFS Create Date
     C                   Z-ADD     *ZERO         WN0018                         PFS Create Time
     C                   Z-ADD     *ZERO         WN0019                         PFS Change Date
     C                   Z-ADD     *ZERO         WN0020                         PFS Change Time
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YARDC = ' '
      *
      * Move key fields to @BNCPZL
     C                   Z-ADD     WCKENZ        WDKENZ                         PFS Manifest ID
     C                   Z-ADD     WCKFNZ        WDKFNZ                         PFS Manifest De
      *
     C     KLCHSE        KLIST
     C                   KFLD                    WDKENZ                         PFS Manifest ID
     C                   KFLD                    WDKFNZ                         PFS Manifest De
     C     KLCHSE        CHAIN     @BNCPZL                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBNCPL0'    MDACP
     C                   MOVEL     '@BNCPZL'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SEEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QPPBN1        YARDCS
      * Move non-key fields to @BNCPZL
     C                   Z-ADD     1             WDUXSX                         PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBN1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * USER: Processing before Data update
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     WDAJNY        PARM      *ZERO         WQ0025                         Current System
     C     WDAKNY        PARM      *ZERO         WQ0026                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBN1 <> YARDCS AND
     C                             YARDC <> 'N'
     C                   MOVE      'Y'           YARDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YARDC = 'Y'
     C                   UPDATE    @BNCPZL                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    PPBNCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFCHRC        BEGSR
      *================================================================
      * Chg PFS Process Status CH - PFS Manifest Header  * Upd to Proces
      *================================================================
      * This is a shared subroutine
      *================================================================
      *
     C                   Z-ADD     *ZERO         WN0021                         PFS Company Num
     C                   Z-ADD     *ZERO         WN0022                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WN0023                         PFS Ship Date
     C                   EVAL      WN0024 = ' '                                 PFS Ship From W
     C                   EVAL      WN0025 = ' '                                 PFS Ship To War
     C                   EVAL      WN0026 = ' '                                 PFS Order Statu
     C                   EVAL      WN0027 = ' '                                 PFS Record Stat
     C                   Z-ADD     *ZERO         WN0028                         PFS Create Date
     C                   Z-ADD     *ZERO         WN0029                         PFS Create Time
     C                   Z-ADD     *ZERO         WN0030                         PFS Change Date
     C                   Z-ADD     *ZERO         WN0031                         PFS Change Time
      *
     C                   EVAL      W0RTN = ' '
      * Set PGM.*Record Data Changed flag
     C                   EVALR     YBRDC = ' '
      *
      * Move key fields to @BRCPPD
     C                   Z-ADD     WL0001        WEKENZ                         PFS Manifest ID
      *
     C     KLCHSF        KLIST
     C                   KFLD                    WEKENZ                         PFS Manifest ID
     C     KLCHSF        CHAIN     @BRCPPD                            9091      *
      *
      * Record not found
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'PPBRCPL0'    MDACP
     C                   MOVEL     '@BRCPPD'     MDFMT
     C                   MOVEL     '*CHG'        MDACT
      * Record not found label: LBL002.
     C                   MOVEL     'LBL002'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SFEXIT
     C                   ENDIF
      *
      * Store record data for null update check
     C                   MOVE      QPPBR1        YBRDCS
      * Move non-key fields to @BRCPPD
     C                   Z-ADD     WL0002        WEUXSX                         PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBR1 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * USER: Processing before Data update
      * RTV System Date/Time   UP - /UT User Programs  * 
     C                   CALL      'PDGFUPC'                            90      RTV System Date
     C     WEAJNY        PARM      *ZERO         WQ0027                         Current System
     C     WEAKNY        PARM      *ZERO         WQ0028                         Current System
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PDGFUPC'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
      * Set PGM.*Record Data Changed flag
     C                   IF        QPPBR1 <> YBRDCS AND
     C                             YBRDC <> 'N'
     C                   MOVE      'Y'           YBRDC
     C                   ENDIF
      * If changed update record otherwise release record
     C                   IF        YBRDC = 'Y'
     C                   UPDATE    @BRCPPD                              91      *
     C                   ELSE
      * Release record lock
     C                   UNLOCK    PPBRCPL0                             91      *
     C                   ENDIF
      * Change error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ELSE
      *
      * DBF change successful
     C                   ENDIF
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      *
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAKENZ                         PFS Manifest ID
     C                   Z-ADD     *ZERO         WAY1NX                         PFS Company Num
     C                   Z-ADD     *ZERO         WAZPNX                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WAX4DT                         PFS Ship Date
     C                   Z-ADD     *ZERO         WAUXSX                         PFS Process Sta
     C                   Z-ADD     *ZERO         WAAHNY                         PFS Create Date
     C                   Z-ADD     *ZERO         WAAINY                         PFS Create Time
     C                   Z-ADD     *ZERO         WAAJNY                         PFS Change Date
     C                   Z-ADD     *ZERO         WAAKNY                         PFS Change Time
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBDBNB                         Warehouse Chill
     C                   Z-ADD     *ZERO         WBBWC3                         Shipping Compan
     C                   Z-ADD     *ZERO         WBBTC3                         Accounting Comp
     C                   Z-ADD     *ZERO         WBBUC3                         WHS Sched Prod
     C                   Z-ADD     *ZERO         WBBVC3                         WHS Inventory C
     C                   Z-ADD     *ZERO         WBAATM                         Job Time
     C                   Z-ADD     *ZERO         WBAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WCKENZ                         PFS Manifest ID
     C                   Z-ADD     *ZERO         WCKFNZ                         PFS Manifest De
     C                   Z-ADD     *ZERO         WCZPNX                         PFS Order Numbe
     C                   Z-ADD     *ZERO         WCZXNX                         PFS Order Line
     C                   Z-ADD     *ZERO         WCZYNX                         PFS Substitutio
     C                   Z-ADD     *ZERO         WCWGU1                         PFS Pallet ID
     C                   Z-ADD     *ZERO         WCP7DT                         PFS Production
     C                   Z-ADD     *ZERO         WCY2NX                         PFS Item Code
     C                   Z-ADD     *ZERO         WCZ4NX                         PFS Label Date
     C                   Z-ADD     *ZERO         WCZ8NX                         PFS Net Weight
     C                   Z-ADD     *ZERO         WCKWNZ                         PFS Date AI
     C                   Z-ADD     *ZERO         WCKXNZ                         PFS Weight AI
     C                   Z-ADD     *ZERO         WCAANY                         PFS Gross Weigh
     C                   Z-ADD     *ZERO         WCUXSX                         PFS Process Sta
     C                   Z-ADD     *ZERO         WCAHNY                         PFS Create Date
     C                   Z-ADD     *ZERO         WCAINY                         PFS Create Time
     C                   Z-ADD     *ZERO         WCAJNY                         PFS Change Date
     C                   Z-ADD     *ZERO         WCAKNY                         PFS Change Time
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     @CN(1)        @CN(1)
     C                   MOVEL     'N'           W0PMT
      * Define local variables for subroutine SFCHRC.
     C                   Z-ADD     *ZERO         WL0001
     C                   Z-ADD     *ZERO         WL0002
      * Define local work field PFS Company Number
     C                   Z-ADD     *ZERO         YL0001
      * Define local work field Continue (Yes/No) USR
     C                   EVAL      YL0002 = ' '
      * Define local work field Shipping Company
     C                   Z-ADD     *ZERO         YL0003
      * Define local work field PFS Manifest ID Text USR
     C                   EVAL      YL0004 = ' '
      * Define local work field PFS Manifest ID Text USR
     C                   EVAL      YL0005 = ' '
      * Define local work field PFS Manifest Detail ID U
     C                   EVAL      YL0006 = ' '
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 *BLANKS
00002 PPBRCPP
00003 PPBRCPPGUY
00004 PPBRCPPSTF
00005 CON *BLANKS
00006 PPBRCPPSTJ
00007 PPBNCPP
00008 PPBNCPPGUY
00009 PPBNCPPSTF
00010 PPBNCPPSTJ
