     H/TITLE Rtv Addr/Fmt C/S/Z E1 XF  Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : E1IDEVMDL
     H* System        : E1IDEVMDL
     H* User name     : ISJBADE
     H* Date          : 05/28/20  Time  : 16:18:49
     H* Copyright     : E1IDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FE10101LA  IF   E           K DISK
      * RSQ : Address Book       F0101  Address Number
      *
     FE10116L1  IF   E           K DISK
      * RTV : Address by Date    F0116  Retrieval index
      *
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  WP0001         S              8  0
     D  WP0002         S             40
     D  WP0003         S             40
     D  WP0004         S             40
     D  WP0005         S             40
     D  WP0006         S             40
     D  WP0007         S              3
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  WQSA01         S                   LIKE(WAAN8)
     D  WQSB01         S                   LIKE(WBAN8)
     D  Y0CX01         S              1
     D  W0PMT          S              1
      /EJECT
      * Parameter declarations
     D P1PARM          DS
      * I :  Address Number
     D  P1AN8                  1      8  0
     D P2PARM          DS
      * O :  Name - Alpha
     D  P2ALPH                 1     40
     D P3PARM          DS
      * O :  Address Line 1
     D  P3ADD1                 1     40
     D P4PARM          DS
      * O :  Address Line 2
     D  P4ADD2                 1     40
     D P5PARM          DS
      * O :  Address Line 3
     D  P5ADD3                 1     40
     D P6PARM          DS
      * O :  Address Line 4
     D  P6ADD4                 1     40
     D P7PARM          DS
      * O :  Country
     D  P7CTR                  1      3
     II0101LA
      * Address Book       F0101  Address Number
      * Renamed input format fields
     I              ABAN8                       WAAN8
     I              ABALKY                      WAALKY
     I              ABTAX                       WATAX
     I              ABALPH                      WAALPH
     I              ABDC                        WADC
     I              ABMCU                       WAMCU
     I              ABSIC                       WASIC
     I              ABLNGP                      WALNGP
     I              ABAT1                       WAAT1
     I              ABCM                        WACM
     I              ABTAXC                      WATAXC
     I              ABAT2                       WAAT2
     I              ABAT3                       WAAT3
     I              ABAT4                       WAAT4
     I              ABAT5                       WAAT5
     I              ABATP                       WAATP
     I              ABATR1                      WAATR1
     I              ABATPR                      WAATPR
     I              ABAB3                       WAAB3
     I              ABATE                       WAATE
     I              ABSBLI                      WASBLI
     I              ABEFTB                      WAEFTB
     I              ABAN81                      WAAN81
     I              ABAN82                      WAAN82
     I              ABAN83                      WAAN83
     I              ABAN84                      WAAN84
     I              ABAN86                      WAAN86
     I              ABAN85                      WAAN85
     I              ABAC01                      WAAC01
     I              ABAC02                      WAAC02
     I              ABAC03                      WAAC03
     I              ABAC04                      WAAC04
     I              ABAC05                      WAAC05
     I              ABAC06                      WAAC06
     I              ABAC07                      WAAC07
     I              ABAC08                      WAAC08
     I              ABAC09                      WAAC09
     I              ABAC10                      WAAC10
     I              ABAC11                      WAAC11
     I              ABAC12                      WAAC12
     I              ABAC13                      WAAC13
     I              ABAC14                      WAAC14
     I              ABAC15                      WAAC15
     I              ABAC16                      WAAC16
     I              ABAC17                      WAAC17
     I              ABAC18                      WAAC18
     I              ABAC19                      WAAC19
     I              ABAC20                      WAAC20
     I              ABAC21                      WAAC21
     I              ABAC22                      WAAC22
     I              ABAC23                      WAAC23
     I              ABAC24                      WAAC24
     I              ABAC25                      WAAC25
     I              ABAC26                      WAAC26
     I              ABAC27                      WAAC27
     I              ABAC28                      WAAC28
     I              ABAC29                      WAAC29
     I              ABAC30                      WAAC30
     I              ABGLBA                      WAGLBA
     I              ABPTI                       WAPTI
     I              ABPDI                       WAPDI
     I              ABMSGA                      WAMSGA
     I              ABRMK                       WARMK
     I              ABTXCT                      WATXCT
     I              ABTX2                       WATX2
     I              ABALP1                      WAALP1
     I              ABURCD                      WAURCD
     I              ABURDT                      WAURDT
     I              ABURAT                      WAURAT
     I              ABURAB                      WAURAB
     I              ABURRF                      WAURRF
     I              ABUSER                      WAUSER
     I              ABPID                       WAPID
     I              ABUPMJ                      WAUPMJ
     I              ABJOBN                      WAJOBN
     I              ABUPMT                      WAUPMT
     I              ABPRGF                      WAPRGF
     I              ABSCCT                      WASCCT
     I              ABTICK                      WATICK
     I              ABEXCG                      WAEXCG
     I              ABDUNS                      WADUNS
     I              ABCLS1                      WACLS1
     I              ABCLS2                      WACLS2
     I              ABCLS3                      WACLS3
     I              ABCLS4                      WACLS4
     I              ABCLS5                      WACLS5
     I              ABNOE                       WANOE
     I              ABGROW                      WAGROW
     I              ABYRST                      WAYRST
     I              ABEMPG                      WAEMPG
     I              ABACTI                      WAACTI
     I              ABREVR                      WAREVR
     I              ABSYNC                      WASYNC
     I              ABPERR                      WAPERR
     I              ABCAAD                      WACAAD
      *
     II0116L1
      * Address by Date    F0116  Retrieval index
      * Renamed input format fields
     I              ALAN8                       WBAN8
     I              ALEFTB                      WBEFTB
     I              ALEFTF                      WBEFTF
     I              ALADD1                      WBADD1
     I              ALADD2                      WBADD2
     I              ALADD3                      WBADD3
     I              ALADD4                      WBADD4
     I              ALADDZ                      WBADDZ
     I              ALCTY1                      WBCTY1
     I              ALCOUN                      WBCOUN
     I              ALADDS                      WBADDS
     I              ALCRTE                      WBCRTE
     I              ALBKML                      WBBKML
     I              ALCTR                       WBCTR
     I              ALUSER                      WBUSER
     I              ALPID                       WBPID
     I              ALUPMJ                      WBUPMJ
     I              ALJOBN                      WBJOBN
     I              ALUPMT                      WBUPMT
     I              ALSYNC                      WBSYNC
     I              ALCAAD                      WBCAAD
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
     C     P1AN8         PARM                    WP0001                         Address Number
     C     P2ALPH        PARM      P2ALPH        WP0002                         Name - Alpha
     C     P3ADD1        PARM      P3ADD1        WP0003                         Address Line 1
     C     P4ADD2        PARM      P4ADD2        WP0004                         Address Line 2
     C     P5ADD3        PARM      P5ADD3        WP0005                         Address Line 3
     C     P6ADD4        PARM      P6ADD4        WP0006                         Address Line 4
     C     P7CTR         PARM      P7CTR         WP0007                         Country
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Rtv Addr/Fmt C/S/Z E1 XF
      * Rtv Addr/Fmt C/S/Z E1 RT - Address Book       F0101  * 
     C                   EXSR      SARVGN
      * If record not found, set return code to ERR
      * CASE:
      *  - NOTc1
      *   |- c1    : PGM.*Return code is *Normal
      *   '-
     C                   MOVEL     '0'           Y0CX01
     C                   IF        W0RTN = ' '
     C                   ELSE
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   IF        Y0CX01 = '1'
     C                   MOVEL     'ERR'         P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Rtv Addr/Fmt C/S/Z E1 RT - Address Book       F0101  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSA         KLIST
     C                   KFLD                    WQSA01                         Address Number
      * Setup key
     C                   Z-ADD     P1AN8         WQSA01                         Address Number
      * Establish starting position
     C     KRSSA         SETLL     I0101LA                                      *
     C     KRSSA         READE     I0101LA                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0078'     W0RTN
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                   EVAL      P2ALPH = ' '                                 Name - Alpha
     C                   EVAL      P3ADD1 = ' '                                 Address Line 1
     C                   EVAL      P4ADD2 = ' '                                 Address Line 2
     C                   EVAL      P5ADD3 = ' '                                 Address Line 3
     C                   EVAL      P6ADD4 = ' '                                 Address Line 4
     C                   EVAL      P7CTR = ' '                                  Country
     C                   EVAL      W0RTN = ' '                                  *Return code
     C                   MOVEL     'ERRS'        W0RTN                          *Return code
     C                   GOTO      SAEXIT
     C                   ENDIF
      *
      * USER: Process Data record
     C                   DOW       NOT *IN90
     C                   MOVEL     WAALPH        P2ALPH                         Name - Alpha
      * Rtv Addr/Fmt C/S/Z E1 RT - Address by Date    F0116  * 
     C                   EXSR      SBRVGN
     C     KRSSA         READE     I0101LA                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Rtv Addr/Fmt C/S/Z E1 RT - Address by Date    F0116  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WQSB01                         Address Number
      * Setup key
     C                   Z-ADD     WAAN8         WQSB01                         Address Number
      * Establish starting position
     C     KRSSB         SETLL     I0116L1                                      *
     C     KRSSB         READE     I0116L1                                90    *
      * Data record not found
     C                   IF        *IN90
     C                   MOVEL     'E1I0084'     W0RTN
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                   EVAL      P3ADD1 = ' '                                 Address Line 1
     C                   EVAL      P4ADD2 = ' '                                 Address Line 2
     C                   EVAL      P5ADD3 = ' '                                 Address Line 3
     C                   EVAL      P6ADD4 = ' '                                 Address Line 4
     C                   EVAL      P7CTR = ' '                                  Country
     C                   EVAL      W0RTN = ' '                                  *Return code
     C                   MOVEL     'ERR'         W0RTN                          *Return code
     C                   GOTO      SBEXIT
     C                   ENDIF
      *
      * USER: Process Data record
      * PAR = DB1 By name
     C                   DOW       NOT *IN90
     C                   MOVEL     WBADD1        P3ADD1                         Address Line 1
     C                   MOVEL     WBADD2        P4ADD2                         Address Line 2
     C                   MOVEL     WBADD3        P5ADD3                         Address Line 3
     C                   MOVEL     WBADD4        P6ADD4                         Address Line 4
     C                   MOVEL     WBCTR         P7CTR                          Country
     C     KRSSB         READE     I0116L1                                90    *
     C                   ENDDO
      * USER: Exit processing
     C                   EVAL      P7CTR = ' '                                  Country
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAN8                          Address Number
     C                   Z-ADD     *ZERO         WAEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WAAN81                         Address Number
     C                   Z-ADD     *ZERO         WAAN82                         Address Number
     C                   Z-ADD     *ZERO         WAAN83                         Address Number
     C                   Z-ADD     *ZERO         WAAN84                         Address Number
     C                   Z-ADD     *ZERO         WAAN86                         Address Number
     C                   Z-ADD     *ZERO         WAAN85                         Factor/Special
     C                   Z-ADD     *ZERO         WAPTI                          Time - Schedule
     C                   Z-ADD     *ZERO         WAPDI                          Date - Schedule
     C                   Z-ADD     *ZERO         WAURDT                         User Reserved D
     C                   Z-ADD     *ZERO         WAURAT                         User Reserved A
     C                   Z-ADD     *ZERO         WAURAB                         User Reserved N
     C                   Z-ADD     *ZERO         WAUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WAUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WANOE                          Number of Emplo
     C                   Z-ADD     *ZERO         WAGROW                         Growth Rate
     C                   Z-ADD     *ZERO         WASYNC                         Synchronization
     C                   Z-ADD     *ZERO         WAPERR                         Previous Error
     C                   Z-ADD     *ZERO         WACAAD                         Server Status
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAN8                          Address Number
     C                   Z-ADD     *ZERO         WBEFTB                         Date-Beginning
     C                   Z-ADD     *ZERO         WBUPMJ                         Date - Updated
     C                   Z-ADD     *ZERO         WBUPMT                         Time - Last Upd
     C                   Z-ADD     *ZERO         WBSYNC                         Synchronization
     C                   Z-ADD     *ZERO         WBCAAD                         Server Status
     C                   MOVEL     'N'           W0PMT
      *================================================================
     CSR   ZZEXIT        ENDSR
