// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PVH5XFR
// ?Date: 14.08.2025 Time: 03:52:15
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?***This is for warranty fix on CR # 7001057 due to DDS to DDL
//?   conversion change to the O.D. table where Bruce P. process,
//?   the Order Close Stored Procedure was updating the 'Detail Line
//?   Status' with the 'Work Over_Short Status' field from O.D. file.
EXECUTE FUNCTION(Cnv Fix Detail Line StsRT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC2236680;
{
 //?USER: Process Data record

 // LCL.Detail Line Status Txt U = DB1.Detail Line Status
 LCL.Detail_Line_Status_Txt_U = DB1.Detail_Line_Status;

 //?SELECT only 'Detail Line Status = O or S'.
 CASE;

 // IF LCL.Detail Line Status Txt U is Overage
 IF LCL.Detail_Line_Status_Txt_U = 'O';

 // OR LCL.Detail Line Status Txt U is Short
 OR LCL.Detail_Line_Status_Txt_U = 'S';

 //?Save original status.
 // WRK.Detail Line Status Txt U = LCL.Detail Line Status Txt U
 WRK.Detail_Line_Status_Txt_U = LCL.Detail_Line_Status_Txt_U;

 //?Check Ordered QTY.
 CASE;

 // IF DB1.Quantity Ordered is Greater than zero
 IF DB1.Quantity_Ordered > *ZERO;

 //?Check Shipped QTY to update the Detail Line Status per OH Hdr Sts.
 CASE;

 // IF DB1.Quantity Shipped Total is Greater than zero
 IF DB1.Quantity_Shipped_Total > *ZERO;

 EXECUTE FUNCTION(RTV Header Status      RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1231329;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Header_Status);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(CHG Dtl Line&Wrk O/S StCH) TYPE(CHGOBJ) FILE(OPBGWKP)          AC2236684;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Header_Status);
 PARAMETER(WRK.Detail_Line_Status_Txt_U);
 //?Check Shipped QTY to update the Detail Line Status per OH Hdr Sts.
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Ordered QTY>0 & Shipped QTY=0, what status to update?
 //?Per Barb G., will set it to 'R' even if Hdr Sts is 'C'. Will
 //?have to cleanup with whatever comes through afterwards.
 EXECUTE FUNCTION(CHG Dtl Line&Wrk O/S StCH) TYPE(CHGOBJ) FILE(OPBGWKP)          AC2236684;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER('R');
 PARAMETER(WRK.Detail_Line_Status_Txt_U);
 ENDIF;

 //?Check Ordered QTY.
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?If Ordered QTY is 0, then Shipping personnel added this line
 //?with a Line Seq of 50's.
 //?If Shipped QTY > 0, update the Detail Line Status per OH Hdr Sts.
 CASE;

 // IF DB1.Quantity Shipped Total is Greater than zero
 IF DB1.Quantity_Shipped_Total > *ZERO;

 EXECUTE FUNCTION(RTV Header Status      RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1231329;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Header_Status);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 EXECUTE FUNCTION(CHG Dtl Line&Wrk O/S StCH) TYPE(CHGOBJ) FILE(OPBGWKP)          AC2236684;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Header_Status);
 PARAMETER(WRK.Detail_Line_Status_Txt_U);
 //?If Shipped QTY > 0, update the Detail Line Status per OH Hdr Sts.
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?Ordered QTY=0 & Shipped QTY=0, no scenarios exist with this criteria.
 ENDIF;

 ENDIF;

 ENDIF;

}


