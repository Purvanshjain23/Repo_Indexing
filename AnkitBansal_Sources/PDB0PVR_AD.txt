// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDB0PVR
// ?Date: 14.08.2025 Time: 03:27:49
// ?------------------------------------------------------------------------------------------------

//?USER: Validate fields

EXECUTE FUNCTION(Val Exist (Cpy Dist)  RT) TYPE(RTVOBJ) FILE(PDI4REP)           AC1256441;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.Min_Carcass_Weight);
PARAMETER(DTL.Max_Carcass_Weight);
PARAMETER(DTL.Lean_Percent_USR);
PARAMETER(PAR.Record_Found_PS_CI_USR);
{
 //?USER: Processing if Data record not found

 // PAR.Record Found -PS CI USR = CND.Record Not Found
 PAR.Record_Found_PS_CI_USR = 'N';

 //?USER: Process Data record

 // PAR.Record Found -PS CI USR = CND.Record Found
 PAR.Record_Found_PS_CI_USR = 'Y';

 QUIT;

}


CASE;

// IF PAR.Record Found -PS CI USR is Record Found
IF PAR.Record_Found_PS_CI_USR = 'Y';

// Send error message - 'Items already exists for &1 lean percent.'
ERROR(USR1741);
MSGPARM(DTL.Lean_Percent_USR);

ENDIF;

//?USER: Validate relations

EXECUTE FUNCTION(Rtv Dist Info         RT) TYPE(RTVOBJ) FILE(PDIZREP)           AC1283304;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.Min_Carcass_Weight);
PARAMETER(DTL.Max_Carcass_Weight);
PARAMETER(DTL.Lean_Percent);
PARAMETER(DTL.Average_Cold_Wgt);
PARAMETER(DTL.Population_Percent);
PARAMETER(DTL.Average_Lean_Percent);
PARAMETER(DTL.Average_Backfat_Inches);
PARAMETER(DTL.Average_Loin_Eye_Depth);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?USER: User defined action

//?Create distribution record with new lean percent.
EXECUTE FUNCTION(Crt Distribution      CR) TYPE(CRTOBJ) FILE(PDIZREP)           AC1254596;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.Min_Carcass_Weight);
PARAMETER(DTL.Max_Carcass_Weight);
PARAMETER(DTL.Lean_Percent_USR);
PARAMETER(DTL.Average_Cold_Wgt);
PARAMETER(DTL.Population_Percent);
PARAMETER(DTL.Average_Lean_Percent);
PARAMETER(DTL.Average_Backfat_Inches);
PARAMETER(DTL.Average_Loin_Eye_Depth);
PARAMETER(DTL.Population_Head);
PARAMETER(DTL.EDI_Status_1);
PARAMETER(DTL.EDI_Status_2);
PARAMETER(DTL.EDI_Status_3);
PARAMETER(DTL.Record_Status);
PARAMETER(DTL.Job_Time);
PARAMETER(DTL.User_Id);
PARAMETER(DTL.Job_Name);
PARAMETER(DTL.Job_Date);
{
 //?USER: Processing before Data update

 EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
 PARAMETER(DB1.Record_Status);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?Execute internal function

  // PAR.Record Status = CND.Active
  PAR.Record_Status = 'A';

  // PAR.Job Time = JOB.*Job time
  PAR.Job_Time = JOB.*Job_time;

  // PAR.User Id = JOB.*USER
  PAR.User_Id = JOB.*USER;

  // PAR.Job Name = JOB.*PROGRAM
  PAR.Job_Name = JOB.*PROGRAM;

  // PAR.Job Date = JOB.*Job date
  PAR.Job_Date = JOB.*Job_date;

 }

}


//?Copy items for the new lean percent.
EXECUTE FUNCTION(Cpy Distribution      RT) TYPE(RTVOBJ) FILE(PDI4REP)           AC1256457;
PARAMETER(DTL.Company_Number);
PARAMETER(DTL.Cutout_Matrix_Code);
PARAMETER(DTL.Effective_Month_Day);
PARAMETER(DTL.Min_Carcass_Weight);
PARAMETER(DTL.Max_Carcass_Weight);
PARAMETER(DTL.Lean_Percent);
PARAMETER(DTL.Lean_Percent_USR);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Crt Cutout Item       CR) TYPE(CRTOBJ) FILE(PDI4REP)           AC1255832;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Cutout_Matrix_Code);
 PARAMETER(DB1.Effective_Month_Day);
 PARAMETER(DB1.Min_Carcass_Weight);
 PARAMETER(DB1.Max_Carcass_Weight);
 PARAMETER(PAR.Lean_Percent_USR);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Percent_of_Carcass);
 PARAMETER(DB1.Primal_Group_Code);
 PARAMETER(DB1.EDI_Status_1);
 PARAMETER(DB1.EDI_Status_2);
 PARAMETER(DB1.EDI_Status_3);
 PARAMETER(DB1.Record_Status);
 PARAMETER(DB1.Job_Time);
 PARAMETER(DB1.User_Id);
 PARAMETER(DB1.Job_Name);
 PARAMETER(DB1.Job_Date);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(SET Record Stamp CRTOB IF) TYPE(EXCINTFUN)                     AC1282865;
  PARAMETER(DB1.Record_Status);
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Record Status = CND.Active
   PAR.Record_Status = 'A';

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

}


