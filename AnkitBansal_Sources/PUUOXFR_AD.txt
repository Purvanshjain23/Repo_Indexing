// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUUOXFR
// ?Date: 14.08.2025 Time: 03:51:26
// ?------------------------------------------------------------------------------------------------

//?Execute user function

// Execute function Cnv SHP253 File Spec  US.
EXECUTE FUNCTION(Cnv SHP253 File Spec  US) TYPE(EXCUSRSRC) ('PUUNUFR');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Item_Code);
PARAMETER(PAR.Item_Age_Days);
{
 *
 Fshp253    uf   e           k disk
 *
}


//?Access Path SELECTS only 'I'nvoiced Loads Only.
EXECUTE FUNCTION(Cnv Upd Sls Route Info RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC2200571;
PARAMETER(1200101);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Cnv Upd Sls Route Info RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC2200665;
 PARAMETER(DB1.Load_ID);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Rtv STC/Sales Route   RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC2200572;
  PARAMETER(DB1.Load_ID);
  PARAMETER(DB1.Order_Number);
  PARAMETER(LCL.Ship_To_Customer);
  PARAMETER(LCL.Sales_Route_Code);
  {
   //?USER: Initialize routine

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  EXECUTE FUNCTION(RTV Description        RT) TYPE(RTVOBJ) FILE(PDJEREP)          AC1270614;
  PARAMETER(LCL.Sales_Route_Code);
  PARAMETER(LCL.Sales_Route_Description);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  CASE;

  // IF PGM.*Return code is *Normal
  IF PGM.*Return_code = *BLANK;

  // Execute function Cnv SHP253 Upd Sls Rte US.
  EXECUTE FUNCTION(Cnv SHP253 Upd Sls Rte US) TYPE(EXCUSRSRC) ('PUUPUFR');
  PARAMETER(DB1.Load_ID);
  PARAMETER(DB1.Stop_Drop);
  PARAMETER(LCL.Ship_To_Customer);
  PARAMETER(LCL.Sales_Route_Code);
  PARAMETER(LCL.Sales_Route_Description);
  {
   *
   D k_CoOrg         s              1    inz('S')
   D k_LoadID        s              7  0
   D k_StopDrop      s              5  0
   D k_STC           s              8  0
   *
   D w_SlsRoute      s              3
   D w_SlsRouteDsc   s             30
   *
   C                   eval      k_LoadID = #IRMNB                            Load ID
   C                   eval      k_StopDrop = #IRVNB                          Stop/Drop
   C                   eval      k_STC = #IBKC7                               Ship To Cust
   C                   eval      w_SlsRoute = #IR4CD                          Sls Route
   C                   eval      w_SlsRouteDsc = #IMZNA                       Sls Route Dsc
   *
   C     key01         klist
   C                   kfld                    k_CoOrg                        Co Org
   C                   kfld                    k_LoadID                       Load ID
   C                   kfld                    k_StopDrop                     Stop/Drop
   C                   kfld                    k_STC                          Ship To Cust
   *
   C**   key01         setll     SHP253
   C**                 dou       *in91 = *on                                  Do load detail
   C**   key01         reade     SHP253                                 91
   C**                 if        *in91 = *off                                 If not eof
   C     key01         chain     SHP253
   C                   if        %Found(SHP253)
   *
   * If Sales Route is Blank then Proceed to Update.
   C                   if        LSSRCD = *Blank
   C                   eval      LSSRCD = w_SlsRoute                          Sls Route
   C                   eval      LSSLSRTNM = w_SlsRouteDsc                    Sls Route Dsc
   *
   C                   update    LSREC
   *
   C                   endif
   *
   C                   endif
   *
  }

  ENDIF;

 }

}


