     H/TITLE Exc DP Product Fields XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISJBADE
     H* Date          : 04/21/17  Time  : 10:11:49
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDJYREL3IF  E           K        DISK
      * RTV : Company Defaults Internal Plant Companies Only CO
      *
     FCABZREL1IF  E           K        DISK
      * RTV : Company Item              Retrieval index       NV
      *
     FOMBYREL1IF  E           K        DISK
      * RTV : Item Default              Retrieval index
      *
     E                    YK01      100 15  A            ARR Co/ITM Avg
      *
     I@JYREEY
      * Company Defaults Internal Plant Companies Only CO
      * Renamed input format fields
     I              JYAIC3                          WAAIC3
     I              JYZ9ST                          WAZ9ST
     I              JYCSST                          WACSST
     I              JYZ8ST                          WAZ8ST
     I              JYCXST                          WACXST
     I              JYSWST                          WASWST
     I              JYXXTM                          WAXXTM
     I              JYUECD                          WAUECD
     I              JYHSST                          WAHSST
     I              JYAMEO                          WAAMEO
     I              JYSSDF                          WASSDF
     I              JYPDFT                          WAPDFT
     I              JYYISX                          WAYISX
     I              JYYJSX                          WAYJSX
     I              JYYKSX                          WAYKSX
     I              JYYLSX                          WAYLSX
     I              JYYMSX                          WAYMSX
     I              JYYNSX                          WAYNSX
     I              JYUVST                          WAUVST
     I              JYUWST                          WAUWST
     I              JYUXST                          WAUXST
     I              JYVSST                          WAVSST
     I              JYAATM                          WAAATM
     I              JYAYNA                          WAAYNA
     I              JYA0NA                          WAA0NA
     I              JYAXDT                          WAAXDT
      *
     I@BZREJU
      * Company Item              Retrieval index       NV
      * Renamed input format fields
     I              BZAIC3                          WCAIC3
     I              BZHGCD                          WCHGCD
     I              BZAVNA                          WCAVNA
     I              BZAWNA                          WCAWNA
     I              BZL7NA                          WCL7NA
     I              BZL8NA                          WCL8NA
     I              BZL6NA                          WCL6NA
     I              BZMFNA                          WCMFNA
     I              BZADCD                          WCADCD
     I              BZAWPC                          WCAWPC
     I              BZLXST                          WCLXST
     I              BZAECD                          WCAECD
     I              BZAXPC                          WCAXPC
     I              BZLYST                          WCLYST
     I              BZAFCD                          WCAFCD
     I              BZAICD                          WCAICD
     I              BZAIWG                          WCAIWG
     I              BZHICD                          WCHICD
     I              BZRBCD                          WCRBCD
     I              BZFZST                          WCFZST
     I              BZAVST                          WCAVST
     I              BZCZWG                          WCCZWG
     I              BZC0WG                          WCC0WG
     I              BZURTN                          WCURTN
     I              BZAJC8                          WCAJC8
     I              BZRINB                          WCRINB
     I              BZRHNB                          WCRHNB
     I              BZRGNB                          WCRGNB
     I              BZLNCD                          WCLNCD
     I              BZTFNB                          WCTFNB
     I              BZN0CD                          WCN0CD
     I              BZX4ST                          WCX4ST
     I              BZTMVA                          WCTMVA
     I              BZTNVA                          WCTNVA
     I              BZBLPR                          WCBLPR
     I              BZBMPR                          WCBMPR
     I              BZLRCD                          WCLRCD
     I              BZU9ST                          WCU9ST
     I              BZCMCO                          WCCMCO
     I              BZQ1CD                          WCQ1CD
     I              BZQ8CD                          WCQ8CD
     I              BZCHTM                          WCCHTM
     I              BZQZCD                          WCQZCD
     I              BZXWST                          WCXWST
     I              BZXXST                          WCXXST
     I              BZVMST                          WCVMST
     I              BZSWGH                          WCSWGH
     I              BZPPHE                          WCPPHE
     I              BZR3CD                          WCR3CD
     I              BZSDCD                          WCSDCD
     I              BZICN1                          WCICN1
     I              BZSVCD                          WCSVCD
     I              BZICN2                          WCICN2
     I              BZSWCD                          WCSWCD
     I              BZV2NB                          WCV2NB
     I              BZSXCD                          WCSXCD
     I              BZITCN                          WCITCN
     I              BZSYCD                          WCSYCD
     I              BZITC5                          WCITC5
     I              BZSZCD                          WCSZCD
     I              BZICN6                          WCICN6
     I              BZS0CD                          WCS0CD
     I              BZICN7                          WCICN7
     I              BZS1CD                          WCS1CD
     I              BZICN8                          WCICN8
     I              BZS2CD                          WCS2CD
     I              BZICN9                          WCICN9
     I              BZS3CD                          WCS3CD
     I              BZICN0                          WCICN0
     I              BZS4CD                          WCS4CD
     I              BZSFNB                          WCSFNB
     I              BZA3WG                          WCA3WG
     I              BZSJNB                          WCSJNB
     I              BZLLCD                          WCLLCD
     I              BZLMCD                          WCLMCD
     I              BZP3ST                          WCP3ST
     I              BZSKNB                          WCSKNB
     I              BZSLNB                          WCSLNB
     I              BZSMNB                          WCSMNB
     I              BZP4ST                          WCP4ST
     I              BZCFNB                          WCCFNB
     I              BZCGNB                          WCCGNB
     I              BZILNB                          WCILNB
     I              BZCHNB                          WCCHNB
     I              BZCINB                          WCCINB
     I              BZCJNB                          WCCJNB
     I              BZCMNB                          WCCMNB
     I              BZCNNB                          WCCNNB
     I              BZCRNB                          WCCRNB
     I              BZCSNB                          WCCSNB
     I              BZCVNB                          WCCVNB
     I              BZCWNB                          WCCWNB
     I              BZCXNB                          WCCXNB
     I              BZCZNB                          WCCZNB
     I              BZC0NB                          WCC0NB
     I              BZN1CD                          WCN1CD
     I              BZB4NB                          WCB4NB
     I              BZB5NB                          WCB5NB
     I              BZX5ST                          WCX5ST
     I              BZX6ST                          WCX6ST
     I              BZX7ST                          WCX7ST
     I              BZPCCT                          WCPCCT
     I              BZBDNB                          WCBDNB
     I              BZBJNB                          WCBJNB
     I              BZSUST                          WCSUST
     I              BZSVST                          WCSVST
     I              BZSYST                          WCSYST
     I              BZSZST                          WCSZST
     I              BZS1ST                          WCS1ST
     I              BZXRCD                          WCXRCD
     I              BZXTCD                          WCXTCD
     I              BZXUCD                          WCXUCD
     I              BZF5WG                          WCF5WG
     I              BZF6WG                          WCF6WG
     I              BZF7WG                          WCF7WG
     I              BZBLNB                          WCBLNB
     I              BZBNNB                          WCBNNB
     I              BZS2ST                          WCS2ST
     I              BZS4ST                          WCS4ST
     I              BZS5ST                          WCS5ST
     I              BZS6ST                          WCS6ST
     I              BZS8ST                          WCS8ST
     I              BZS9ST                          WCS9ST
     I              BZTCST                          WCTCST
     I              BZTDST                          WCTDST
     I              BZUVST                          WCUVST
     I              BZUWST                          WCUWST
     I              BZUXST                          WCUXST
     I              BZVSST                          WCVSST
     I              BZAATM                          WCAATM
     I              BZAYNA                          WCAYNA
     I              BZA0NA                          WCA0NA
     I              BZAXDT                          WCAXDT
      *
     I@BYREA1
      * Item Default              Retrieval index
      * Renamed input format fields
     I              BYHGCD                          WDHGCD
     I              BYAVNA                          WDAVNA
     I              BYAWNA                          WDAWNA
     I              BYL7NA                          WDL7NA
     I              BYL8NA                          WDL8NA
     I              BYL6NA                          WDL6NA
     I              BYMFNA                          WDMFNA
     I              BYHHCD                          WDHHCD
     I              BYAWPC                          WDAWPC
     I              BYLXST                          WDLXST
     I              BYLGCD                          WDLGCD
     I              BYAXPC                          WDAXPC
     I              BYLYST                          WDLYST
     I              BYLHCD                          WDLHCD
     I              BYLICD                          WDLICD
     I              BYAIWG                          WDAIWG
     I              BYHICD                          WDHICD
     I              BYRBCD                          WDRBCD
     I              BYFZST                          WDFZST
     I              BYAVST                          WDAVST
     I              BYCZWG                          WDCZWG
     I              BYC0WG                          WDC0WG
     I              BYURTN                          WDURTN
     I              BYACC8                          WDACC8
     I              BYRINB                          WDRINB
     I              BYRHNB                          WDRHNB
     I              BYRGNB                          WDRGNB
     I              BYLNCD                          WDLNCD
     I              BYTFNB                          WDTFNB
     I              BYN0CD                          WDN0CD
     I              BYX4ST                          WDX4ST
     I              BYCHTM                          WDCHTM
     I              BYQZCD                          WDQZCD
     I              BYXWST                          WDXWST
     I              BYXXST                          WDXXST
     I              BYVMST                          WDVMST
     I              BYSWGH                          WDSWGH
     I              BYPPHE                          WDPPHE
     I              BYLRCD                          WDLRCD
     I              BYSFNB                          WDSFNB
     I              BYA3WG                          WDA3WG
     I              BYSJNB                          WDSJNB
     I              BYLLCD                          WDLLCD
     I              BYLMCD                          WDLMCD
     I              BYP3ST                          WDP3ST
     I              BYSKNB                          WDSKNB
     I              BYSLNB                          WDSLNB
     I              BYSMNB                          WDSMNB
     I              BYP4ST                          WDP4ST
     I              BYCFNB                          WDCFNB
     I              BYCGNB                          WDCGNB
     I              BYILNB                          WDILNB
     I              BYCHNB                          WDCHNB
     I              BYCINB                          WDCINB
     I              BYCJNB                          WDCJNB
     I              BYCMNB                          WDCMNB
     I              BYCNNB                          WDCNNB
     I              BYCRNB                          WDCRNB
     I              BYCSNB                          WDCSNB
     I              BYCVNB                          WDCVNB
     I              BYCWNB                          WDCWNB
     I              BYCXNB                          WDCXNB
     I              BYCZNB                          WDCZNB
     I              BYC0NB                          WDC0NB
     I              BYN1CD                          WDN1CD
     I              BYB4NB                          WDB4NB
     I              BYX5ST                          WDX5ST
     I              BYX6ST                          WDX6ST
     I              BYX7ST                          WDX7ST
     I              BYTMVA                          WDTMVA
     I              BYTNVA                          WDTNVA
     I              BYBLPR                          WDBLPR
     I              BYBMPR                          WDBMPR
     I              BYU9ST                          WDU9ST
     I              BYCMCO                          WDCMCO
     I              BYQ1CD                          WDQ1CD
     I              BYAIC3                          WDAIC3
     I              BYQ8CD                          WDQ8CD
     I              BYR3CD                          WDR3CD
     I              BYSDCD                          WDSDCD
     I              BYICN1                          WDICN1
     I              BYSVCD                          WDSVCD
     I              BYICN2                          WDICN2
     I              BYSWCD                          WDSWCD
     I              BYV2NB                          WDV2NB
     I              BYSXCD                          WDSXCD
     I              BYITCN                          WDITCN
     I              BYSYCD                          WDSYCD
     I              BYITC5                          WDITC5
     I              BYSZCD                          WDSZCD
     I              BYICN6                          WDICN6
     I              BYS0CD                          WDS0CD
     I              BYICN7                          WDICN7
     I              BYS1CD                          WDS1CD
     I              BYICN8                          WDICN8
     I              BYS2CD                          WDS2CD
     I              BYICN9                          WDICN9
     I              BYS3CD                          WDS3CD
     I              BYICN0                          WDICN0
     I              BYS4CD                          WDS4CD
     I              BYB5NB                          WDB5NB
     I              BYXRCD                          WDXRCD
     I              BYPCCT                          WDPCCT
     I              BYBDNB                          WDBDNB
     I              BYBJNB                          WDBJNB
     I              BYSUST                          WDSUST
     I              BYSVST                          WDSVST
     I              BYSYST                          WDSYST
     I              BYSZST                          WDSZST
     I              BYS1ST                          WDS1ST
     I              BYXTCD                          WDXTCD
     I              BYXUCD                          WDXUCD
     I              BYF5WG                          WDF5WG
     I              BYF6WG                          WDF6WG
     I              BYF7WG                          WDF7WG
     I              BYBLNB                          WDBLNB
     I              BYBNNB                          WDBNNB
     I              BYS2ST                          WDS2ST
     I              BYS4ST                          WDS4ST
     I              BYS5ST                          WDS5ST
     I              BYS6ST                          WDS6ST
     I              BYS8ST                          WDS8ST
     I              BYS9ST                          WDS9ST
     I              BYTCST                          WDTCST
     I              BYTDST                          WDTDST
     I              BYUVST                          WDUVST
     I              BYUWST                          WDUWST
     I              BYUXST                          WDUXST
     I              BYVSST                          WDVSST
     I              BYAHTM                          WDAHTM
     I              BYBEVN                          WDBEVN
     I              BYBFVN                          WDBFVN
     I              BYEKDT                          WDEKDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IYD01        DS
     I                                        1   70YI0101
     I                                        8  100YI0102
     I                                       11  150YI01
      *
     IYM01        DS                        100
     I                                        1   70WBHGCD
     I                                        8  100WBAIC3
     I                                       11  12 WBADCD
     I                                       13  232WBAIWG
     I                                       24  24 WBPCCT
     I                                       25  310WBBDNB
     I                                       32  380WBBJNB
     I                                       39  39 WBVSST
     I                                       40  534WBTPNR
      *
     IYW01        DS
     I                                        1   70XAHGCD
     I                                        8  100XAAIC3
     I                                       11  12 XAADCD
     I                                       13  232XAAIWG
     I                                       24  24 XAPCCT
     I                                       25  310XABDNB
     I                                       32  380XABJNB
     I                                       39  39 XAVSST
     I                                       40  534XATPNR
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Company Item
      * I :  Item Code
     I                                    P   1   40P1HGCD
      * N :  U/M - Primary
     I                                        5   6 P1ADCD
     IP2PARM      DS
      * O :  DP Unit Weight Average
     I                                        1  144P2AGNB
     IP3PARM      DS
      * B :  DP Total Pieces per unit
     I                                        1  144P3AFNB
     IP4PARM      DS
      * B :  DP Record Status
     I                                        1   1 P4ADSC
     IP5PARM      DS
      * B :  DP Base Unit of Measure
     I                                        1  10 P5TCAA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1HGCD    PARM           WP0001  70       Item Code
     C           P2AGNB    PARM P2AGNB    WP0002 144       DP Unit Weight
     C           P3AFNB    PARM P3AFNB    WP0003 144       DP Total Pieces
     C           P4ADSC    PARM P4ADSC    WP0004  1        DP Record Statu
     C           P5TCAA    PARM P5TCAA    WP0005 10        DP Base Unit of
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc DP Product Fields XF
      * Modification history
     C                     EXSR UASUBR                     Modification hi
      * Bld Avg Unit Weight array - Company Defaults Internal  * All Plan
     C                     EXSR SARVGN
      * Rtv Co/ITM Avg Unit Wgt - *Arrays  * Values from active plants
     C                     EXSR SERVGN
      * Use the item dft fields if item not assigned to a company
      * CASE: LCL.Count USR is Zero
     C           YL0009    IFEQ *ZERO                      *IF
      * Rtv DP Fields         RT - Item Default  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDP1HGCD    WL0010           Item Code
     C                     EXSR SFRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0011    YL0011    P      U/M - Primary D
     C                     MOVELWL0012    YL0012    P      U/M - Pricing D
     C                     Z-ADDWL0013    YL0013           Unit Weight
     C                     Z-ADDWL0014    YL0014           Pieces Per Bag
     C                     Z-ADDWL0015    YL0015           Bags Per Unit
     C                     MOVELWL0016    YL0016    P      Record Status
     C           YL0014    MULT YL0015    P3AFNB           DP Total Pieces
     C                     MOVELYL0011    P1ADCD           U/M - Primary
      * CASE: PAR.DP Total Pieces per unit is EQ 0
     C           P3AFNB    IFEQ 0                          *IF
     C                     Z-ADD1         P3AFNB           DP Total Pieces
     C                     END                             *FI
     C                     Z-ADDYL0013    P2AGNB           DP Unit Weight
     C                     MOVELYL0016    P4ADSC           DP Record Statu
     C                     END                             *FI
     C                     MOVEL*BLANK    P5TCAA           DP Base Unit of
     C                     MOVELP1ADCD    P5TCAA           DP Base Unit of
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Bld Avg Unit Weight array - Company Defaults Internal  * All Pla
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001  2        U/M - Primary
      *
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Clr Co/ITM Avg Unit Wgt - *Arrays  * 
     C                     EXSR SBDLRC
      * Establish starting position
     C           *LOVAL    SETLL@JYREEY                    *
     C                     READ @JYREEY                  90*
      * Data record not found
     C   90                MOVEL'USR2025' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * If record is active, process it
      * CASE: DB1.Record Status is Active
     C           WAVSST    IFEQ 'A'                        *IF
      * RTV Pces*Bag,Unit wtAvgRT - Company Item  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWAAIC3    WL0001           Company Number
     C                     Z-ADDP1HGCD    WL0002           Item Code
     C                     EXSR SCRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0003    YL0001    P      U/M - Primary
     C                     Z-ADDWL0004    YL0002           Unit Weight
     C                     MOVELWL0005    YL0003    P      Piece Count Ite
     C                     Z-ADDWL0006    YL0004           Pieces Per Bag
     C                     Z-ADDWL0007    YL0005           Bags Per Unit
     C                     MOVELWL0008    YL0006    P      Record Status
     C                     MOVELWL0009    YL0007    P      Record Status 1
      * If record found, calc Total Pieces per Unit/Crt array record
      * CASE: LCL.Record Status 1 Usr is *Exists
     C           YL0007    IFEQ 'E'                        *IF
     C           YL0004    MULT YL0005    YL0008           Total Pieces pe
      * If Total Pieces per unit is zero, make it 1
      * CASE: LCL.Total Pieces per Unit is EQ 0
     C           YL0008    IFEQ 0                          *IF
     C                     Z-ADD1         YL0008           Total Pieces pe
     C                     END                             *FI
      * Crt Co/ITM Avg Unit Wgt - *Arrays  * 
     C                     EXSR SDCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @JYREEY                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * Clr Co/ITM Avg Unit Wgt - *Arrays  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Initialize array variables
     C                     MOVEA*HIVAL    YK01
      * Initialize last used element number
     C                     Z-ADD0         YL01
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Pces*Bag,Unit wtAvgRT - Company Item  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCHGCD           Item Code
      * Setup key
     C                     Z-ADDWL0001    WCAIC3           Company Number
     C                     Z-ADDWL0002    WCHGCD           Item Code
      * Establish starting position
     C           KRSSC     CHAIN@BZREJU              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0326' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'N'       WL0009           Record Status 1
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWCADCD    WL0003           U/M - Primary
     C                     Z-ADDWCAIWG    WL0004           Unit Weight
     C                     MOVELWCPCCT    WL0005           Piece Count Ite
     C                     Z-ADDWCBDNB    WL0006           Pieces Per Bag
     C                     Z-ADDWCBJNB    WL0007           Bags Per Unit
     C                     MOVELWCVSST    WL0008           Record Status
     C                     MOVEL'E'       WL0009           Record Status 1
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCRRC    BEGSR
      *================================================================
      * Crt Co/ITM Avg Unit Wgt - *Arrays  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Array full, cannot add any more elements
     C           YL01      IFEQ 100
     C                     MOVEL'Y2U0036' W0RTN   7
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C                     Z-ADD*ZERO     XAHGCD           Item Code
     C                     Z-ADD*ZERO     XAAIC3           Company Number
     C                     MOVEL*BLANK    XAADCD           U/M - Primary
     C                     Z-ADD*ZERO     XAAIWG           Unit Weight
     C                     MOVEL*BLANK    XAPCCT           Piece Count Ite
     C                     Z-ADD*ZERO     XABDNB           Pieces Per Bag
     C                     Z-ADD*ZERO     XABJNB           Bags Per Unit
     C                     MOVEL*BLANK    XAVSST           Record Status
     C                     Z-ADD*ZERO     XATPNR           Total Pieces pe
      * Move all fields to ARR Co/ITM Avg Unit Wgt
     C                     Z-ADDP1HGCD    XAHGCD           Item Code
     C                     Z-ADDWAAIC3    XAAIC3           Company Number
     C                     MOVELYL0001    XAADCD           U/M - Primary
     C                     Z-ADDYL0002    XAAIWG           Unit Weight
     C                     MOVELYL0003    XAPCCT           Piece Count Ite
     C                     Z-ADDYL0004    XABDNB           Pieces Per Bag
     C                     Z-ADDYL0005    XABJNB           Bags Per Unit
     C                     MOVELYL0006    XAVSST           Record Status
     C                     Z-ADDYL0008    XATPNR           Total Pieces pe
      *
      * Move key fields to ARR Co/ITM Avg Unit Wgt
     C                     Z-ADDXAHGCD    YI0101           Item Code
     C                     Z-ADDXAAIC3    YI0102           Company Number
      *
      * Check for duplicate primary key
      * Initialize internal index
     C                     Z-ADD*ZERO     YI01
      * Only search if key is not beyond range of current elements
     C           YL01      IFGT 0
     C           YK01,YL01 ANDGTYD01
      * Set search index to first element of array
     C                     Z-ADD1         Y       50
     C           YD01      LOKUPYK01,Y               90    Look for >
     C                     ELSE
     C                     SETOF                     90    *
     C                     ENDIF
     C           *IN90     IFEQ '1'
      * Move to data structure for comparison
     C                     MOVELYK01,Y    YD01
      * Compare
     C           YI0101    IFEQ XAHGCD
     C           YI0102    ANDEQXAAIC3
      * Array element already exists
     C                     MOVEL'Y2U0003' W0RTN   7
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C                     ENDIF
      *
      * Insert after last used element
     C           YL01      ADD  1         Y       50
      * Check if element was a previously deleted element
     C           YK01,Y    IFNE *HIVAL
      * If so, reuse MODS index
     C                     MOVELYK01,Y    YD01
     C                     ELSE
      * If not, use element number as MODS index
     C                     Z-ADDY         YI01
     C                     ENDIF
      *
      * Create(insert) new element
      * Move key fields to ARR Co/ITM Avg Unit Wgt
     C                     Z-ADDXAHGCD    YI0101           Item Code
     C                     Z-ADDXAAIC3    YI0102           Company Number
      *
     C                     MOVELYD01      YK01,Y
     C           YI01      OCUR YM01
      * Update MODS fields
     C                     Z-ADDXAHGCD    WBHGCD           Item Code
     C                     Z-ADDXAAIC3    WBAIC3           Company Number
     C                     MOVELXAADCD    WBADCD           U/M - Primary
     C                     Z-ADDXAAIWG    WBAIWG           Unit Weight
     C                     MOVELXAPCCT    WBPCCT           Piece Count Ite
     C                     Z-ADDXABDNB    WBBDNB           Pieces Per Bag
     C                     Z-ADDXABJNB    WBBJNB           Bags Per Unit
     C                     MOVELXAVSST    WBVSST           Record Status
     C                     Z-ADDXATPNR    WBTPNR           Total Pieces pe
      * Only sort if element is out of position
     C           YL01      IFGT 0
     C           YK01,YL01 ANDGTYD01
      * Adjust RTVOBJ index to reflect position of added/removed element
     C           YR01      IFGT 0
     C           YR01      ANDLE100
     C           YK01,YR01 ANDGTYD01
     C                     ADD  1         YR01    50
     C                     ENDIF
      * Sort array to place element in correct position
     C                     SORTAYK01
     C                     ENDIF
      * Adjust number of elements currently in array
     C                     ADD  1         YL01
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Co/ITM Avg Unit Wgt - *Arrays  * Values from active plants
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD0         YL0009           Count USR
     C                     MOVEL*BLANK    P4ADSC           DP Record Statu
     C                     Z-ADD1         Y       50
     C           YL01      IFGT 0
     C                     MOVELYK01,Y    YD01
     C           YI01      OCUR YM01
     C                     ELSE
      * Array element not found
     C                     MOVEL'Y2U0005' W0RTN   7
     C                     ENDIF
      *
      * Sequence through qualified elements:
     C                     Z-ADDY         YR01    50
     C           YR01      DOWLEYL01
     C                     Z-ADDYR01      Y
     C                     MOVELYK01,Y    YD01
     C           YI01      OCUR YM01
      * USER: Process Data record
     C                     ADD  1         YL0009           Count USR
     C                     ADD  WBAIWG    YL0010           Unit Weight
      * If at least one Record Status is Active, return value
      * CASE: DB1.Record Status is Active
     C           WBVSST    IFEQ 'A'                        *IF
     C                     MOVELWBVSST    P4ADSC           DP Record Statu
     C                     END                             *FI
      * If U/M Primary is not blank, populate the return value
      * CASE: DB1.U/M - Primary is Entered
     C           WBADCD    IFNE *BLANK                     *IF
     C                     MOVELWBADCD    P1ADCD           U/M - Primary
     C                     END                             *FI
     C                     ADD  1         YR01
     C                     ENDDO
      * USER: Exit processing
      * If count > 0, calculate DP Unit Average Weight
      * CASE: PAR.Count USR is GT 0
     C           YL0009    IFGT 0                          *IF
     C           YL0010    DIV  YL0009    P2AGNB           DP Unit Weight
     C                     END                             *FI
     C                     Z-ADDWBTPNR    P3AFNB           DP Total Pieces
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv DP Fields         RT - Item Default  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WDHGCD           Item Code
      * Setup key
     C                     Z-ADDWL0010    WDHGCD           Item Code
      * Establish starting position
     C           KRSSF     CHAIN@BYREA1              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1160' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWDHHCD    WL0011           U/M - Primary D
     C                     MOVELWDLICD    WL0012           U/M - Pricing D
     C                     Z-ADDWDAIWG    WL0013           Unit Weight
     C                     Z-ADDWDBDNB    WL0014           Pieces Per Bag
     C                     Z-ADDWDBJNB    WL0015           Bags Per Unit
     C                     MOVELWDVSST    WL0016           Record Status
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Modification history
      *================================================================
      *  2/17/17 Brad Baden  E9064 - Add company 440 processing
      *          Changed the logic in the program to read the Company
      *          Defaults Internal file to process every Plant Company,
      *          instead of hard coding each and every Plant Company.
      *          The data for calculating the average weight is now
      *          stored in an array for the restricted Item and the
      *          current Plant Company in the file.  After the array is
      *          built, the array is read and the average calculated
      *          based on each record in the array.
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P1ADCD           U/M - Primary
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAXXTM           Departure Time
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      *
     C           W0ICL     IFEQ 'Y'
      * Initialize array variables
     C                     MOVEA*HIVAL    YK01
      * Initialize last used element number
     C                     Z-ADD0         YL01    50
     C                     Z-ADD1         Y       50
     C                     ENDIF
      *
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCHGCD           Item Code
     C                     Z-ADD*ZERO     WCAWPC           Conversion Fact
     C                     Z-ADD*ZERO     WCAXPC           Conversion Fact
     C                     Z-ADD*ZERO     WCAIWG           Unit Weight
     C                     Z-ADD*ZERO     WCCZWG           Minimum Weight
     C                     Z-ADD*ZERO     WCC0WG           Maximum Weight
     C                     Z-ADD*ZERO     WCURTN           Number Cases On
     C                     Z-ADD*ZERO     WCAJC8           Vendor - Item D
     C                     Z-ADD*ZERO     WCRINB           Item Structure
     C                     Z-ADD*ZERO     WCRHNB           Item Structure
     C                     Z-ADD*ZERO     WCRGNB           Item Structure
     C                     Z-ADD*ZERO     WCTFNB           Transportation
     C                     Z-ADD*ZERO     WCTMVA           Maximum Audit V
     C                     Z-ADD*ZERO     WCTNVA           Minimum Audit V
     C                     Z-ADD*ZERO     WCBLPR           Market Overage
     C                     Z-ADD*ZERO     WCBMPR           Standard Overag
     C                     Z-ADD*ZERO     WCCMCO           Item Pricing Co
     C                     Z-ADD*ZERO     WCCHTM           Fresh Chilling
     C                     Z-ADD*ZERO     WCSWGH           Std Weight/Head
     C                     Z-ADD*ZERO     WCPPHE           Pieces Per Head
     C                     Z-ADD*ZERO     WCICN1           Item Category N
     C                     Z-ADD*ZERO     WCICN2           Item Category N
     C                     Z-ADD*ZERO     WCV2NB           Item Category N
     C                     Z-ADD*ZERO     WCITCN           Item Category N
     C                     Z-ADD*ZERO     WCITC5           Item Category N
     C                     Z-ADD*ZERO     WCICN6           Item Category N
     C                     Z-ADD*ZERO     WCICN7           Item Category N
     C                     Z-ADD*ZERO     WCICN8           Item Category N
     C                     Z-ADD*ZERO     WCICN9           Item Category N
     C                     Z-ADD*ZERO     WCICN0           Item Category N
     C                     Z-ADD*ZERO     WCSFNB           Pallet Tare Wei
     C                     Z-ADD*ZERO     WCA3WG           Misc Tare Weigh
     C                     Z-ADD*ZERO     WCSJNB           Production Lead
     C                     Z-ADD*ZERO     WCSKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WCSLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WCSMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WCCFNB           PM Pounds per H
     C                     Z-ADD*ZERO     WCCGNB           Item Frt Overag
     C                     Z-ADD*ZERO     WCILNB           Packages per ca
     C                     Z-ADD*ZERO     WCCHNB           Use/Freeze/Sell
     C                     Z-ADD*ZERO     WCCINB           PM Batch Size
     C                     Z-ADD*ZERO     WCCJNB           Package Level s
     C                     Z-ADD*ZERO     WCCMNB           Partial Item Co
     C                     Z-ADD*ZERO     WCCNNB           WIP Item Code
     C                     Z-ADD*ZERO     WCCRNB           WIP Reject Code
     C                     Z-ADD*ZERO     WCCSNB           Std Costing Uni
     C                     Z-ADD*ZERO     WCCVNB           FP Std Green We
     C                     Z-ADD*ZERO     WCCWNB           PM Standard LBS
     C                     Z-ADD*ZERO     WCCXNB           PM Raw Meat LBS
     C                     Z-ADD*ZERO     WCCZNB           PM Formula LBS/
     C                     Z-ADD*ZERO     WCC0NB           PM Finished LBS
     C                     Z-ADD*ZERO     WCB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WCB5NB           PM Line Number
     C                     Z-ADD*ZERO     WCBDNB           Pieces Per Bag
     C                     Z-ADD*ZERO     WCBJNB           Bags Per Unit
     C                     Z-ADD*ZERO     WCF5WG           Item Target Pri
     C                     Z-ADD*ZERO     WCF6WG           Minimum Piece W
     C                     Z-ADD*ZERO     WCF7WG           Maximum Piece W
     C                     Z-ADD*ZERO     WCBLNB           Seaboard Equiva
     C                     Z-ADD*ZERO     WCBNNB           Production Qty
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDHGCD           Item Code
     C                     Z-ADD*ZERO     WDAWPC           Conversion Fact
     C                     Z-ADD*ZERO     WDAXPC           Conversion Fact
     C                     Z-ADD*ZERO     WDAIWG           Unit Weight
     C                     Z-ADD*ZERO     WDCZWG           Minimum Weight
     C                     Z-ADD*ZERO     WDC0WG           Maximum Weight
     C                     Z-ADD*ZERO     WDURTN           Number Cases On
     C                     Z-ADD*ZERO     WDACC8           Vendor item Def
     C                     Z-ADD*ZERO     WDRINB           Item Structure
     C                     Z-ADD*ZERO     WDRHNB           Item Structure
     C                     Z-ADD*ZERO     WDRGNB           Item Structure
     C                     Z-ADD*ZERO     WDTFNB           Transportation
     C                     Z-ADD*ZERO     WDCHTM           Fresh Chilling
     C                     Z-ADD*ZERO     WDSWGH           Std Weight/Head
     C                     Z-ADD*ZERO     WDPPHE           Pieces Per Head
     C                     Z-ADD*ZERO     WDSFNB           Pallet Tare Wei
     C                     Z-ADD*ZERO     WDA3WG           Misc Tare Weigh
     C                     Z-ADD*ZERO     WDSJNB           Production Lead
     C                     Z-ADD*ZERO     WDSKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WDSLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WDSMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WDCFNB           PM Pounds per H
     C                     Z-ADD*ZERO     WDCGNB           Item Frt Overag
     C                     Z-ADD*ZERO     WDILNB           Packages per ca
     C                     Z-ADD*ZERO     WDCHNB           Use/Freeze/Sell
     C                     Z-ADD*ZERO     WDCINB           PM Batch Size
     C                     Z-ADD*ZERO     WDCJNB           Package Level s
     C                     Z-ADD*ZERO     WDCMNB           Partial Item Co
     C                     Z-ADD*ZERO     WDCNNB           WIP Item Code
     C                     Z-ADD*ZERO     WDCRNB           WIP Reject Code
     C                     Z-ADD*ZERO     WDCSNB           Std Costing Uni
     C                     Z-ADD*ZERO     WDCVNB           FP Std Green We
     C                     Z-ADD*ZERO     WDCWNB           PM Standard LBS
     C                     Z-ADD*ZERO     WDCXNB           PM Raw Meat LBS
     C                     Z-ADD*ZERO     WDCZNB           PM Formula LBS/
     C                     Z-ADD*ZERO     WDC0NB           PM Finished LBS
     C                     Z-ADD*ZERO     WDB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WDTMVA           Maximum Audit V
     C                     Z-ADD*ZERO     WDTNVA           Minimum Audit V
     C                     Z-ADD*ZERO     WDBLPR           Market Overage
     C                     Z-ADD*ZERO     WDBMPR           Standard Overag
     C                     Z-ADD*ZERO     WDCMCO           Item Pricing Co
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDICN1           Item Category N
     C                     Z-ADD*ZERO     WDICN2           Item Category N
     C                     Z-ADD*ZERO     WDV2NB           Item Category N
     C                     Z-ADD*ZERO     WDITCN           Item Category N
     C                     Z-ADD*ZERO     WDITC5           Item Category N
     C                     Z-ADD*ZERO     WDICN6           Item Category N
     C                     Z-ADD*ZERO     WDICN7           Item Category N
     C                     Z-ADD*ZERO     WDICN8           Item Category N
     C                     Z-ADD*ZERO     WDICN9           Item Category N
     C                     Z-ADD*ZERO     WDICN0           Item Category N
     C                     Z-ADD*ZERO     WDB5NB           PM Line Number
     C                     Z-ADD*ZERO     WDBDNB           Pieces Per Bag
     C                     Z-ADD*ZERO     WDBJNB           Bags Per Unit
     C                     Z-ADD*ZERO     WDF5WG           Item Target Pri
     C                     Z-ADD*ZERO     WDF6WG           Minimum Piece W
     C                     Z-ADD*ZERO     WDF7WG           Maximum Piece W
     C                     Z-ADD*ZERO     WDBLNB           Seaboard Equiva
     C                     Z-ADD*ZERO     WDBNNB           Production Qty
     C                     Z-ADD*ZERO     WDAHTM           Job Time
     C                     Z-ADD*ZERO     WDEKDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SCRVGN.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  70
     C                     MOVEL*BLANK    WL0003  2
     C                     Z-ADD*ZERO     WL0004 112
     C                     MOVEL*BLANK    WL0005  1
     C                     Z-ADD*ZERO     WL0006  70
     C                     Z-ADD*ZERO     WL0007  70
     C                     MOVEL*BLANK    WL0008  1
     C                     MOVEL*BLANK    WL0009  1
      * Define local variables for subroutine SFRVGN.
     C                     Z-ADD*ZERO     WL0010  70
     C                     MOVEL*BLANK    WL0011  2
     C                     MOVEL*BLANK    WL0012  2
     C                     Z-ADD*ZERO     WL0013 112
     C                     Z-ADD*ZERO     WL0014  70
     C                     Z-ADD*ZERO     WL0015  70
     C                     MOVEL*BLANK    WL0016  1
      * Define local work field U/M - Primary
     C                     MOVEL*BLANK    YL0001  2
      * Define local work field Unit Weight
     C                     Z-ADD*ZERO     YL0002 112
      * Define local work field Piece Count Item
     C                     MOVEL*BLANK    YL0003  1
      * Define local work field Pieces Per Bag
     C                     Z-ADD*ZERO     YL0004  70
      * Define local work field Bags Per Unit
     C                     Z-ADD*ZERO     YL0005  70
      * Define local work field Record Status
     C                     MOVEL*BLANK    YL0006  1
      * Define local work field Record Status 1 Usr
     C                     MOVEL*BLANK    YL0007  1
      * Define local work field Total Pieces per Unit
     C                     Z-ADD*ZERO     YL0008 144
      * Define local work field Count USR
     C                     Z-ADD*ZERO     YL0009  50
      * Define local work field Unit Weight
     C                     Z-ADD*ZERO     YL0010 112
      * Define local work field U/M - Primary Dft
     C                     MOVEL*BLANK    YL0011  2
      * Define local work field U/M - Pricing Dft
     C                     MOVEL*BLANK    YL0012  2
      * Define local work field Unit Weight
     C                     Z-ADD*ZERO     YL0013 112
      * Define local work field Pieces Per Bag
     C                     Z-ADD*ZERO     YL0014  70
      * Define local work field Bags Per Unit
     C                     Z-ADD*ZERO     YL0015  70
      * Define local work field Record Status
     C                     MOVEL*BLANK    YL0016  1
      *================================================================
     CSR         ZZEXIT    ENDSR
