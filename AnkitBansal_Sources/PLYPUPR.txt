/***************************************************************** */
/*  PROGRAM NUMBER:  PLYPUPR                                       */
/*  PROGRAM NAME:    READ M3 INTERFACE HEAD/DTL AND DISTR TO EMAIL LIST*/
/*  PROGRAMMER:      ROSE CENTONZE                                 */
/*  CREATE DATE:     04/06/16                                      */
/*                                                                 */
/*  FUNCTION:        THIS CLP EMAILS THE M3 INTERFACE AR_INVOICE     */
/*                   TO EMAIL LIST FOR PUTTING INTO TRANSFER FOLDER       */
/*                   FOR INTERFACING WITH M3                 */
/*******************************************************************/
/*******************************************************************/
/* Modification History                                            */
/*                                                                 */
/* MM/DD/YY PGMR EXPLANATION OF CHANGE                             */
/* -------- ---- ------------------------------------------------- */
/*******************************************************************/
             PGM        PARM(&RTNCDE)
/*-----------------------------------------------------------------*/
/* PARAMETER                                                       */
/*-----------------------------------------------------------------*/
             DCL        VAR(&CO) TYPE(*CHAR) LEN(3)
             DCL        VAR(&KEYVALUE) TYPE(*CHAR) LEN(15)
             DCL        VAR(&M3LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&RTNCDE) TYPE(*CHAR) LEN(7)

/*-----------------------------------------------------------------*/
/* PROGRAM VARIABLES                                               */
             DCLF       FILE(*LIBL/PLB9CPL0)
/*-----------------------------------------------------------------*/
/* GET LIBRARIES                                                   */
/*-----------------------------------------------------------------*/
  CALL PBSHXFR ('' &M3LIB)       /* SYSTEM VALUE M3ILIB  */
     /*      CALL       PGM(POMTXFR) PARM('' X'360F' 'M3SUPLIB' +
                          &TOLIB360)     COMPANY VALUE  */
       /*    CALL       PGM(POMTXFR) PARM('' X'960F' 'M3SUPLIB' +
                          &TOLIB960)     COMPANY VALUE  */
/*-----------------------------------------------------------------*/
/* EMAIL AR_INVOICE RECORDS NOT PROCESSED TO EMAIL LIST  */
/*-----------------------------------------------------------------*/

 LOOP:       RCVF
             MONMSG     MSGID(CPF0864) EXEC(GOTO CMDLBL(ENDPGM))

 IF COND(&B9AJT1 = 'AR_INVOICE' *AND &B9G5SS = '0') THEN(DO)
             IF         COND(&B9AKT1 = 'OMS AR Open Invoice') THEN(DO)
             EXECUTE    VIEW(RMCFLIB/AR_INVOICE) +
                          TOSTMF('/TMP/AR_INV.TXT') REPLACE(*YES) +
                          RECIPIENT(ISRCENT) SETVAR((&KEYVALUE +
                          &B9AIT1))
                          GOTO UPDATE
                          ENDDO
             IF         COND(&B9AKT1 = 'OMS Debit Memo     ') THEN(DO)
             EXECUTE    VIEW(RMCFLIB/AR_INVOICE) +
                          TOSTMF('/TMP/AR_DM.TXT') REPLACE(*YES) +
                          RECIPIENT(ISRCENT) SETVAR((&KEYVALUE +
                          &B9AIT1))
                          GOTO UPDATE
                          ENDDO
             IF         COND(&B9AKT1 = 'OMS Credit Memo    ') THEN(DO)
             EXECUTE    VIEW(RMCFLIB/AR_INVOICE) +
                          TOSTMF('/TMP/AR_CM.TXT') REPLACE(*YES) +
                          RECIPIENT(ISRCENT) SETVAR((&KEYVALUE +
                          &B9AIT1))
                          GOTO UPDATE
                          ENDDO
                          ENDDO
                          GOTO LOOPIT

/* MARK AS PROCESSED  */

UPDATE:       CALL PLYSXFR   ('' &B9WJA1 &B9QXCD &B9AIT1)

LOOPIT:     GOTO       CMDLBL(LOOP)

/*-----------------------------------------------------------------*/


/*-----------------------------------------------------------------*/
/*                      PROGRAM END                                */
/*-----------------------------------------------------------------*/
 ENDPGM:

             ENDPGM
