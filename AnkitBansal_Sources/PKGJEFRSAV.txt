     H/TITLE Edt Drive Card        EF  Edit file
     H            Y
     Z* CRTRPGPGM
      *
     W* Warning: This program does not set on the LR indicator
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated
     H* - Key changes are not allowed
     H* - New records cannot be added
      *
     H* Generated by  : SYNON/2  Version:  1054
     H* Function type : Edit file
      *
     H* Company       :    Hog Procurement & Evaluation
     H* System        : HPEMDL
     H* User name     : ISRCENT
     H* Date          : 04/27/95  Time  : 14:00:05
     H* Copyright     :    Hog Procurement & Evaluation
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPKVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPKGJEFR#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Edt Drive Card        EF  Edit file
      *
     FPKA2CPL4IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RSQ : Tattoo Detail             Co/Dr Crd/Tattoo
      *
     FPKA8REL3IF  E           K        DISK
      * RSQ : Hog Classification        Hog Class Type 'S'ubject
      *
     FPKA3REL5IF  E           K        DISK
      * RSQ : Pen                       Co/Pen/Open
      *
     FPKA2CPL9IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Tattoo/Kill Date
      *
     FPKA7REL1IF  E           K        DISK
      * RTV : Hog Defect                Retrieval index
      *
     FPKA8REL1IF  E           K        DISK
      * RTV : Hog Classification        Retrieval index
      *
     FPKA1CPL0IF  E           K        DISK
      * RTV : Tattoo Header             Retrieval index
      *
     FPKA3REL1IF  E           K        DISK
      * RTV : Pen                       Retrieval index
      *
     FPKBXREL1IF  E           K        DISK
      * RTV : Tattoo Detail Process     Retrieval index
      *
     FPKA2CPL8IF  E           K        DISK
      * RSQ : Tattoo Detail             Co/Pen
      *
     FPKAIREL0IF  E           K        DISK
      * RTV : Genetic                   Retrieval index
      *
     FPKA2CPL0UF  E           K        DISK                      A
      * UPD : Tattoo Detail             Update index
      *
     FPKA1CPL1UF  E           K        DISK                      A
      * UPD : Tattoo Header             Update index
      *
     FPKA3REL0UF  E           K        DISK
      * UPD : Pen                       Update index
      *
      * Screen: Field position and name array
     E                    W0BEG   7 012  5 0A
     E                    W0END   7 012  5 0A
     E                    W0NAM   7 012 10
     I@A2CPKG
      * Tattoo Detail             Co/Tattoo/Kill Date
      * Renamed input format fields
     I              A2HMNB                          WAHMNB
     I              A2BNNB                          WABNNB
     I              A2BONB                          WABONB
     I              A2CVNB                          WACVNB
     I              A2B0DT                          WAB0DT
     I              A2C2NB                          WAC2NB
     I              A2CZNB                          WACZNB
     I              A2C0NB                          WAC0NB
     I              A2D8NB                          WAD8NB
     I              A2H7NB                          WAH7NB
     I              A2GGST                          WAGGST
     I              A2AJTM                          WAAJTM
     I              A2B7CD                          WAB7CD
     I              A2D7NB                          WAD7NB
     I              A2D9ST                          WAD9ST
     I              A2E3ST                          WAE3ST
     I              A2E4ST                          WAE4ST
     I              A2E5ST                          WAE5ST
     I              A2BVDT                          WABVDT
     I              A2BWDT                          WABWDT
     I              A2BXDT                          WABXDT
     I              A2HVNB                          WAHVNB
     I              A2CMCD                          WACMCD
     I              A2B9CD                          WAB9CD
     I              A2H8NB                          WAH8NB
     I              A2CYCD                          WACYCD
     I              A2AAVN                          WAAAVN
     I              A2AADT                          WAAADT
     I              A2AMTM                          WAAMTM
     I              A2AJST                          WAAJST
     I              A2AHVN                          WAAHVN
     I              A2AGVN                          WAAGVN
     I              A2ABVN                          WAABVN
     I              A2ABDT                          WAABDT
     I              A2ABTM                          WAABTM
      *
     I@A8REDA
      * Hog Classification        Retrieval index
      * Renamed input format fields
     I              A8BECD                          WBBECD
     I              A8BDTX                          WBBDTX
     I              A8BXST                          WBBXST
     I              A8BYST                          WBBYST
     I              A8BITX                          WBBITX
     I              A8B0ST                          WBB0ST
     I              A8FBST                          WBFBST
     I              A8AAVN                          WBAAVN
     I              A8AADT                          WBAADT
     I              A8AMTM                          WBAMTM
     I              A8AJST                          WBAJST
     I              A8AHVN                          WBAHVN
     I              A8AGVN                          WBAGVN
     I              A8ABVN                          WBABVN
     I              A8ABDT                          WBABDT
     I              A8ABTM                          WBABTM
      *
     I@A3REDD
      * Pen                       Retrieval index
      * Renamed input format fields
     I              A3HVNB                          WCHVNB
     I              A3CMCD                          WCCMCD
     I              A3BBTX                          WCBBTX
     I              A3CTNB                          WCCTNB
     I              A3D6NB                          WCD6NB
     I              A3B6CD                          WCB6CD
     I              A3DGST                          WCDGST
     I              A3EBNB                          WCEBNB
     I              A3FWST                          WCFWST
     I              A3HBNB                          WCHBNB
     I              A3AGCD                          WCAGCD
     I              A3AAVN                          WCAAVN
     I              A3AADT                          WCAADT
     I              A3AMTM                          WCAMTM
     I              A3AJST                          WCAJST
     I              A3AHVN                          WCAHVN
     I              A3AGVN                          WCAGVN
     I              A3ABVN                          WCABVN
     I              A3ABDT                          WCABDT
     I              A3ABTM                          WCABTM
      *
     I@A1CPC5
      * Tattoo Header             Update index
      * Renamed input format fields
     I              A1HMNB                          WDHMNB
     I              A1BNNB                          WDBNNB
     I              A1BONB                          WDBONB
     I              A1CVNB                          WDCVNB
     I              A1B0DT                          WDB0DT
     I              A1AWDT                          WDAWDT
     I              A1BICD                          WDBICD
     I              A1CPST                          WDCPST
     I              A1ACPR                          WDACPR
     I              A1C4ST                          WDC4ST
     I              A1AIPR                          WDAIPR
     I              A1A6DT                          WDA6DT
     I              A1C2ST                          WDC2ST
     I              A1CXNB                          WDCXNB
     I              A1CWNB                          WDCWNB
     I              A1FCNB                          WDFCNB
     I              A1H9NB                          WDH9NB
     I              A1FDNB                          WDFDNB
     I              A1FENB                          WDFENB
     I              A1HENB                          WDHENB
     I              A1HFNB                          WDHFNB
     I              A1CYNB                          WDCYNB
     I              A1E0NB                          WDE0NB
     I              A1A5PC                          WDA5PC
     I              A1FBNB                          WDFBNB
     I              A1A4PC                          WDA4PC
     I              A1F7NB                          WDF7NB
     I              A1HDNB                          WDHDNB
     I              A1F5NB                          WDF5NB
     I              A1F4NB                          WDF4NB
     I              A1F3NB                          WDF3NB
     I              A1F2NB                          WDF2NB
     I              A1AVPC                          WDAVPC
     I              A1AWPC                          WDAWPC
     I              A1A8PC                          WDA8PC
     I              A1A7PC                          WDA7PC
     I              A1AMPR                          WDAMPR
     I              A1ANPR                          WDANPR
     I              A1AYVA                          WDAYVA
     I              A1AWVA                          WDAWVA
     I              A1AOPR                          WDAOPR
     I              A1AXVA                          WDAXVA
     I              A1APPR                          WDAPPR
     I              A1ASPR                          WDASPR
     I              A1A4VA                          WDA4VA
     I              A1A5VA                          WDA5VA
     I              A1ATPR                          WDATPR
     I              A1A7VA                          WDA7VA
     I              A1A2PR                          WDA2PR
     I              A1CWST                          WDCWST
     I              A1D7ST                          WDD7ST
     I              A1D8ST                          WDD8ST
     I              A1DWST                          WDDWST
     I              A1D6ST                          WDD6ST
     I              A1GHNB                          WDGHNB
     I              A1BYDT                          WDBYDT
     I              A1E0ST                          WDE0ST
     I              A1E1ST                          WDE1ST
     I              A1E2ST                          WDE2ST
     I              A1BSDT                          WDBSDT
     I              A1BTDT                          WDBTDT
     I              A1BUDT                          WDBUDT
     I              A1HGNB                          WDHGNB
     I              A1HHNB                          WDHHNB
     I              A1HINB                          WDHINB
     I              A1A3PR                          WDA3PR
     I              A1A4PR                          WDA4PR
     I              A1A6PR                          WDA6PR
     I              A1J9NB                          WDJ9NB
     I              A1AGCD                          WDAGCD
     I              A1BECD                          WDBECD
     I              A1BDCD                          WDBDCD
     I              A1CSCD                          WDCSCD
     I              A1ABCD                          WDABCD
     I              A1AECD                          WDAECD
     I              A1ACCD                          WDACCD
     I              A1AAVN                          WDAAVN
     I              A1AADT                          WDAADT
     I              A1AMTM                          WDAMTM
     I              A1AJST                          WDAJST
     I              A1AHVN                          WDAHVN
     I              A1AGVN                          WDAGVN
     I              A1ABVN                          WDABVN
     I              A1ABDT                          WDABDT
     I              A1ABTM                          WDABTM
      *
     I@A2CPKE
      * Tattoo Detail             Co/Pen
      * Renamed input format fields
     I              A2HMNB                          WEHMNB
     I              A2BNNB                          WEBNNB
     I              A2BONB                          WEBONB
     I              A2CVNB                          WECVNB
     I              A2B0DT                          WEB0DT
     I              A2C2NB                          WEC2NB
     I              A2CZNB                          WECZNB
     I              A2C0NB                          WEC0NB
     I              A2D8NB                          WED8NB
     I              A2H7NB                          WEH7NB
     I              A2GGST                          WEGGST
     I              A2AJTM                          WEAJTM
     I              A2B7CD                          WEB7CD
     I              A2D7NB                          WED7NB
     I              A2D9ST                          WED9ST
     I              A2E3ST                          WEE3ST
     I              A2E4ST                          WEE4ST
     I              A2E5ST                          WEE5ST
     I              A2BVDT                          WEBVDT
     I              A2BWDT                          WEBWDT
     I              A2BXDT                          WEBXDT
     I              A2HVNB                          WEHVNB
     I              A2CMCD                          WECMCD
     I              A2B9CD                          WEB9CD
     I              A2H8NB                          WEH8NB
     I              A2CYCD                          WECYCD
     I              A2AAVN                          WEAAVN
     I              A2AADT                          WEAADT
     I              A2AMTM                          WEAMTM
     I              A2AJST                          WEAJST
     I              A2AHVN                          WEAHVN
     I              A2AGVN                          WEAGVN
     I              A2ABVN                          WEABVN
     I              A2ABDT                          WEABDT
     I              A2ABTM                          WEABTM
      *
     I@A3REDC
      * Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSPKA2CPL0
      * UPD : Tattoo Detail             Update index
      * Current/previous master file format fields for change control
      *
     IQPKA11    E DSPKA1CPL1
      * UPD : Tattoo Header             Update index
      * Renamed input format fields
     I              A1HMNB                          WDHMNB
     I              A1BNNB                          WDBNNB
     I              A1BONB                          WDBONB
     I              A1CVNB                          WDCVNB
     I              A1B0DT                          WDB0DT
     I              A1AWDT                          WDAWDT
     I              A1BICD                          WDBICD
     I              A1CPST                          WDCPST
     I              A1ACPR                          WDACPR
     I              A1C4ST                          WDC4ST
     I              A1AIPR                          WDAIPR
     I              A1A6DT                          WDA6DT
     I              A1C2ST                          WDC2ST
     I              A1CXNB                          WDCXNB
     I              A1CWNB                          WDCWNB
     I              A1FCNB                          WDFCNB
     I              A1H9NB                          WDH9NB
     I              A1FDNB                          WDFDNB
     I              A1FENB                          WDFENB
     I              A1HENB                          WDHENB
     I              A1HFNB                          WDHFNB
     I              A1CYNB                          WDCYNB
     I              A1E0NB                          WDE0NB
     I              A1A5PC                          WDA5PC
     I              A1FBNB                          WDFBNB
     I              A1A4PC                          WDA4PC
     I              A1F7NB                          WDF7NB
     I              A1HDNB                          WDHDNB
     I              A1F5NB                          WDF5NB
     I              A1F4NB                          WDF4NB
     I              A1F3NB                          WDF3NB
     I              A1F2NB                          WDF2NB
     I              A1AVPC                          WDAVPC
     I              A1AWPC                          WDAWPC
     I              A1A8PC                          WDA8PC
     I              A1A7PC                          WDA7PC
     I              A1AMPR                          WDAMPR
     I              A1ANPR                          WDANPR
     I              A1AYVA                          WDAYVA
     I              A1AWVA                          WDAWVA
     I              A1AOPR                          WDAOPR
     I              A1AXVA                          WDAXVA
     I              A1APPR                          WDAPPR
     I              A1ASPR                          WDASPR
     I              A1A4VA                          WDA4VA
     I              A1A5VA                          WDA5VA
     I              A1ATPR                          WDATPR
     I              A1A7VA                          WDA7VA
     I              A1A2PR                          WDA2PR
     I              A1CWST                          WDCWST
     I              A1D7ST                          WDD7ST
     I              A1D8ST                          WDD8ST
     I              A1DWST                          WDDWST
     I              A1D6ST                          WDD6ST
     I              A1GHNB                          WDGHNB
     I              A1BYDT                          WDBYDT
     I              A1E0ST                          WDE0ST
     I              A1E1ST                          WDE1ST
     I              A1E2ST                          WDE2ST
     I              A1BSDT                          WDBSDT
     I              A1BTDT                          WDBTDT
     I              A1BUDT                          WDBUDT
     I              A1HGNB                          WDHGNB
     I              A1HHNB                          WDHHNB
     I              A1HINB                          WDHINB
     I              A1A3PR                          WDA3PR
     I              A1A4PR                          WDA4PR
     I              A1A6PR                          WDA6PR
     I              A1J9NB                          WDJ9NB
     I              A1AGCD                          WDAGCD
     I              A1BECD                          WDBECD
     I              A1BDCD                          WDBDCD
     I              A1CSCD                          WDCSCD
     I              A1ABCD                          WDABCD
     I              A1AECD                          WDAECD
     I              A1ACCD                          WDACCD
     I              A1AAVN                          WDAAVN
     I              A1AADT                          WDAADT
     I              A1AMTM                          WDAMTM
     I              A1AJST                          WDAJST
     I              A1AHVN                          WDAHVN
     I              A1AGVN                          WDAGVN
     I              A1ABVN                          WDABVN
     I              A1ABDT                          WDABDT
     I              A1ABTM                          WDABTM
      *
     IYARDCS      DS                            314
     IQPKA31    E DSPKA3REL0
      * UPD : Pen                       Update index
      * Renamed input format fields
     I              A3HVNB                          WFHVNB
     I              A3CMCD                          WFCMCD
     I              A3BBTX                          WFBBTX
     I              A3CTNB                          WFCTNB
     I              A3D6NB                          WFD6NB
     I              A3B6CD                          WFB6CD
     I              A3DGST                          WFDGST
     I              A3EBNB                          WFEBNB
     I              A3FWST                          WFFWST
     I              A3HBNB                          WFHBNB
     I              A3AGCD                          WFAGCD
     I              A3AAVN                          WFAAVN
     I              A3AADT                          WFAADT
     I              A3AMTM                          WFAMTM
     I              A3AJST                          WFAJST
     I              A3AHVN                          WFAHVN
     I              A3AGVN                          WFAGVN
     I              A3ABVN                          WFABVN
     I              A3ABDT                          WFABDT
     I              A3ABTM                          WFABTM
      *
     IYBRDCS      DS                            107
     IYCRDCS      DS                            107
     IYDRDCS      DS                            107
     IYERDCS      DS                            107
     IYFRDCS      DS                            107
     IYGRDCS      DS                            107
     IYHRDCS      DS                            107
     IYIRDCS      DS                            107
     IYJRDCS      DS                            130
     IYKRDCS      DS                            314
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             10
      * KEY: Tattoo Detail             Co/Dr Crd/Tattoo
      * I : RST BOH Company Number
     I                                    P   1   20P1HMNB
      * I : RST TD Drive Card Number
     I                                    P   3   40P1B7CD
      * I : RST Pen Number
     I                                        5   7 P1CMCD
     IP2PARM      DS
      * FLD: Tattoo Header
      * N : MAP TH Dead On Arrival
     I                                    P   1   30P2CXNB
      * N : MAP TH Head Received
     I                                    P   4   60P2CWNB
      * N : MAP TH Yard Deads
     I                                    P   7   90P2FCNB
     IP3PARM      DS
      * I :  Oms System Value Alpha
     I                                        1  40 P3EVTX
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Pen &1 invalid f/held ovr'
      * Pen Held Over
     I                                        1   3 ZA0001
      * Message data for 'Tattoo exists for kill dt'
      * Tattoo Number New User
     I                                    P   1   30ZA0002
      * Message data for 'Pen &1 invalid f/subject'
      * Pen Usr
     I                                        1   3 ZA0003
      * Message data for 'Defect not allowd f/class'
      * DF Defect Code
     I                                        1   6 ZA0004
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Tattoo Det
     C           P3EVTX    PARM           WP0001 40        Oms System Valu
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   30                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      *................................................................
      * Position file
     C           KPOS      KLIST
     C                     KFLD           A2HMNB           BOH Company Num
     C                     KFLD           A2B7CD           TD Drive Card N
     C                     KFLD           A2CMCD           Pen Number
     C                     KFLD           A2CVNB           TH Tattoo Numbe
      * Setup key
     C                     Z-ADD#2HMNB    A2HMNB           BOH Company Num
     C                     Z-ADD#2B7CD    A2B7CD           TD Drive Card N
     C                     MOVEL#2CMCD    A2CMCD           Pen Number
     C                     Z-ADD#2CVNB    A2CVNB           TH Tattoo Numbe
      * 82=EOF
     C           KPOS      SETLL@A2CPIF              82    *
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           A2HMNB           BOH Company Num
     C                     KFLD           A2B7CD           TD Drive Card N
     C                     KFLD           A2CMCD           Pen Number
      * Setup key
     C                     Z-ADD#2HMNB    A2HMNB           BOH Company Num
     C                     Z-ADD#2B7CD    A2B7CD           TD Drive Card N
     C                     MOVEL#2CMCD    A2CMCD           Pen Number
     C  N82      KRST      READE@A2CPIF                9182*
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@A2CPIF                  90*
     C  N82                READ @A2CPIF                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  8
     C                     MOVE *ALL'1'   WKIND1  8
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * Load SFL fields
     C                     EXSR MBFL#1
      * Calculate function fields
     C                     EXSR DG#2FN
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
      * Rtv Hog Class Subjct  RT - Hog Classification  * 
     C                     EXSR SARVGN
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * 82=EOF
     C           KRST      READE@A2CPIF                  82*
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
     C           YPMTFD    CABNE*BLANKS   DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Prompt for confirmation
     C                     EXSR DHPRCF
      * Exit if not confirmed
     C           *IN99     IFEQ '1'
     C                     SETOF                     99
     C                     GOTO DAEXIT
     C                     END
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Read first changed slf record
     C           YAFSCH    IFNE *ZERO
     C           YAFSCH    CHAIN#SFLRCD              92    *
     C                     ELSE
     C                     READC#SFLRCD                  92*
     C                     END
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
      * No errors
     C                     SETOF                     98
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate subfile record fields
      * * User Defined * Prompts
      * CASE: CTL.*CMD key is *Prompt
     C           *IN04     IFEQ '1'                        *IF
      * CASE: PGM.*Cursor field <IS> RCD.Held Over Pen Number
     C           W0CSRR    IFEQ ##RR                       *
     C           W0CFL     ANDEQ'#1CYCD'                   *IF
      * Sel Pen               SR - Pen  * 
     C                     CALL 'PKJ0SRR'              90  Sel Pen
     C                     PARM *BLANK    W0RTN   7
     C           #1HVNB    PARM #1HVNB    WQ0001  30       Pen Company Num
     C           #1CYCD    PARM #1CYCD    WQ0002  3        Pen Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKJ0SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9832  *
     C                     END
     C                     ELSE
      * CASE: PGM.*Cursor field <IS> RCD.Pen Usr
     C           W0CSRR    IFEQ ##RR                       *
     C           W0CFL     ANDEQ'#RCBCD'                   *IF
      * Sel Pen               SR - Pen  * 
     C                     CALL 'PKJ0SRR'              90  Sel Pen
     C                     PARM *BLANK    W0RTN   7
     C           #1HVNB    PARM #1HVNB    WQ0003  30       Pen Company Num
     C           #RCBCD    PARM #RCBCD    WQ0004  3        Pen Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKJ0SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9835  *
     C                     END
     C                     ELSE
      * CASE: PGM.*Cursor field <IS> RCD.Defect Code Usr
     C           W0CSRR    IFEQ ##RR                       *
     C           W0CFL     ANDEQ'#RCTCD'                   *IF
      * Sel Hog Defect        SR - Hog Defect  * 
     C                     CALL 'PKCWSRR'              90  Sel Hog Defect
     C                     PARM *BLANK    W0RTN   7
     C           #RCTCD    PARM #RCTCD    WQ0005  6        DF Defect Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKCWSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9837  *
     C                     END
     C                     ELSE
      * CASE: PGM.*Cursor field <IS> RCD.HC Class Code
     C           W0CSRR    IFEQ ##RR                       *
     C           W0CFL     ANDEQ'#RBECD'                   *IF
      * Sel Hog Classifctn    SR - Hog Classification  * 
     C                     CALL 'PKC0SRR'              90  Sel Hog Classif
     C                     PARM *BLANK    W0RTN   7
     C           #RBECD    PARM #RBECD    WQ0006  3        HC Class Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKC0SRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9838  *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * * Yard Dead * Validations
      * CASE: RCD.TD Yard Dead GT RCD.TD Pen Head
     C           #1D8NB    IFGT #1C0NB                     *IF
      * Send message 'Yard Deads must <= pen hd'
     C                     MOVEL'PRK0231' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
      * * Held Over * Validations
      * CASE:
      *  - c1 AND c2
      *   |- c1    : RCD.TD Held Over EQ WRK.Zero USR
      *   |- c2    : RCD.Held Over Pen Number EQ WRK.Blank USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1H7NB    IFEQ WUE9NB                     *IF
     C           #1CYCD    IFEQ WUCRTX                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     Z-ADD*ZERO     #1H8NB           Held Over Pen C
     C                     ELSE
      * CASE: *OTHERWISE
      * If hogs are moved to a new pen, it must have an open status
      * CASE: RCD.Held Over Pen Number NE CTL.Pen Number
     C           #1CYCD    IFNE #2CMCD                     *IF
      * Rtv Val Pen-no parms  RT - Pen  * 
     C                     EXSR SBRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0001           Held Over Pen N
      * Send message 'Pen &1 invalid f/held ovr'
     C                     MOVEL'PRK0228' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Held Over head must be <= # head in pen
      * CASE: RCD.TD Held Over GT RCD.TD Pen Head
     C           #1H7NB    IFGT #1C0NB                     *IF
      * Send message 'Held over hd must <= pen'
     C                     MOVEL'PRK0227' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.TD Held Over EQ WRK.Zero USR
     C           #1H7NB    IFEQ WUE9NB                     *IF
      * Send message 'Held over hd cant be 0'
     C                     MOVEL'PRK0235' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     Z-ADD#1HVNB    #1H8NB           Held Over Pen C
     C                     END                             *FI
      * * Subject * Validations
      * CASE:
      *  - c1 AND c2 AND c3 AND c4
      *   |- c1    : RCD.Tattoo Number New User EQ WRK.Zero USR
      *   |- c2    : RCD.Pen Usr EQ WRK.Blank USR
      *   |- c3    : RCD.Head Total USR EQ WRK.Zero USR
      *   |- c4    : RCD.Defect Code Usr EQ WRK.Blank USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #RGENB    IFEQ WUE9NB                     *IF
     C           #RCBCD    IFEQ WUCRTX                     *IF
     C           #RB5NB    IFEQ WUE9NB                     *IF
     C           #RCTCD    IFEQ WUCRTX                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Tattoo is required and must be unique for the kill date.
      * CASE: RCD.Tattoo Number New User is Zero
     C           #RGENB    IFEQ *ZERO                      *IF
      * Send message 'New Tattoo Nbr required'
     C                     MOVEL'PRK0234' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Tattoo Number New User is Subject number range
     C           #RGENB    IFGE 1010                       *IF
     C           #RGENB    ANDLE1099
      * Rtv Val Tattoo/KillDt RT - Tattoo Detail  * 
     C                     EXSR SCRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     Z-ADD#RGENB    ZA0002           Tattoo Number N
      * Send message 'Tattoo exists for kill dt'
     C                     MOVEL'PRK0232' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Tattoo nbr <1010 or >1099'
     C                     MOVEL'PRK0369' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * The subject pen must have an open status.
      * CASE: RCD.Pen Usr NE CTL.Pen Number
     C           #RCBCD    IFNE #2CMCD                     *IF
      * Rtv Val Pen-no parms  RT - Pen  * 
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RCBCD    ZA0003           Pen Usr
      * Send message 'Pen &1 invalid f/subject'
     C                     MOVEL'PRK0229' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Subject Head must be <= # head in pen but not 0.
      * CASE: RCD.Head Total USR GT RCD.TD Pen Head
     C           #RB5NB    IFGT #1C0NB                     *IF
      * Send message 'Subject hd must <= pen hd'
     C                     MOVEL'PRK0230' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Head Total USR EQ WRK.Zero USR
     C           #RB5NB    IFEQ WUE9NB                     *IF
      * Send message 'Subject hd cant be 0'
     C                     MOVEL'PRK0236' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Validate Hog Defect
      * CASE: RCD.Defect Code Usr NE WRK.Blank USR
     C           #RCTCD    IFNE WUCRTX                     *IF
      * Rtv Hog Defect        RT - Hog Defect  * 
     C                     EXSR SERVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Hog Defect             NF'
     C                     MOVEL'PRK0073' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Validate Hog Classification code
      * CASE: RCD.HC Class Code EQ WRK.Blank USR
     C           #RBECD    IFEQ WUCRTX                     *IF
      * Send message 'Class required for subjct'
     C                     MOVEL'PRK0366' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * Rtv Hog Class         RT - Hog Classification  * 
     C                     EXSR SFRVGN
      * CASE: WRK.HC Class Type is Subject
     C           WUFBST    IFEQ 'S'                        *IF
      * CASE: WRK.HC Defect Required is Yes
     C           WUBXST    IFEQ 'Y'                        *IF
      * CASE: RCD.Defect Code Usr EQ WRK.Blank USR
     C           #RCTCD    IFEQ WUCRTX                     *IF
      * Send message 'Defect required for class'
     C                     MOVEL'PRK0357' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Defect Code Usr NE WRK.Blank USR
     C           #RCTCD    IFNE WUCRTX                     *IF
      * Setup message data for message
     C                     MOVEL#RCTCD    ZA0004           Defect Code Usr
      * Send message 'Defect not allowd f/class'
     C                     MOVEL'PRK0356' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Class must be a Subject'
     C                     MOVEL'PRK0367' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Sum of yard dead, held over, and subject head cannot exceed pen h
      * PGM.*Synon (17,7) work field =
      *    *COMPUTE (x1 + x2 + x3)
      * x1    : RCD.TD Yard Dead
      * +     : PGM.*Synon (17,7) work field
      * x2    : RCD.TD Held Over
      * +     : PGM.*Synon (17,7) work field
      * x3    : RCD.Head Total USR
     C           #1D8NB    ADD  #1H7NB    W0WD01           *Synon (17,7) w
     C           W0WD01    ADD  #RB5NB    W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    W0WD             *Synon (17,7) w
      * CASE: PGM.*Synon (17,7) work field GT RCD.TD Pen Head
     C           W0WD      IFGT #1C0NB                     *IF
      * Send message 'Sum yrds,held,subj > pen'
     C                     MOVEL'PRK0237' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
      * If Subjects, Reduce pen head,recalc live wgt in original pen Tatt
      * CASE: RCD.Head Total USR NE WRK.Zero USR
     C           #RB5NB    IFNE WUE9NB                     *IF
     C                     SUB  #RB5NB    #1C0NB           TD Pen Head
     C           #1D7NB    MULT #1C0NB    #1CZNB           TD Live Wgt
     C                     END                             *FI
     C                     MOVEL'N'       W0RSF            *Reload subfile
     C                     END
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Tattoo Header
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      * Check reference to Pen
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      * Check reference to Tattoo Detail Process
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     98    *
     C                     END
      * Check reference to Pen
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     SETON                     9832  *
     C                     END
      * Calculate function fields
     C                     EXSR DG#2FN
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DG#2FN    BEGSR
      *================================================================
      * Calculate subfile record function fields
      *================================================================
     C           YPMTFD    IFEQ *BLANKS
      * CALC: Subfile record function fields
      * RTV Tattoo Record     RT - Tattoo Header  * 
     C                     EXSR SGRVGN
     C                     ADD  WUCWNB    #PCWNB           TH Head Receive
     C                     ADD  WUCXNB    #PCXNB           TH Dead On Arri
     C                     ADD  WUFCNB    #PFCNB           TH Yard Deads
     C                     END
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         DHPRCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
      * Force PUTOVR
     C                     SETON                     86
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#SFLCTL
     C                     EXFMT#CONFIRM
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'PKVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 20        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C                     MOVEL'N'       W0RSF
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     98
      *
      * Process change request
     C                     EXSR EECHRQ
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     ELSE
      * USER: Extra processing after DBF update
      * Subjects
      * CASE: RCD.Head Total USR NE WRK.Zero USR
     C           #RB5NB    IFNE WUE9NB                     *IF
     C           #1D7NB    MULT #RB5NB    WUCZNB           TD Live Wgt
      * Create Tattoo dtl with new tattoo, pen, head, live wgt
      * Create Tattoo Detail - Tattoo Detail  * 
     C                     EXSR SHCRRC
      * Reduce hd rcvd by the subject head
      * Rtv/Chg Hd Rcvd       RT - Tattoo Header  * 
     C                     EXSR SIRVGN
      * Create Tattoo hdr with new tattoo, head, & live wgt
      * Crt Tto Hdr Subj hogs CR - Tattoo Header  * 
     C                     EXSR SKCRRC
      * Recount Subject Pen Head and Chg the Pen
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
     C                     EXSR SLRVGN
     C                     END                             *FI
      * Recount Assigned Pen Head and Chg the Pen
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
     C                     EXSR SVRVGN
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Chg Yrd Dead,Hld Ovr  CH - Tattoo Detail  * 
     C                     EXSR TFCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     Z-ADDP1HMNB    #1HMNB           BOH Company Num
     C                     Z-ADD*ZERO     #1C2NB           TD Sequence Num
     C                     Z-ADD*ZERO     #1BNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     #1BONB           BOL Load Number
     C                     Z-ADD*ZERO     #1B0DT           TH Kill Date
     C                     Z-ADD*ZERO     #1CZNB           TD Live Wgt
     C                     Z-ADD*ZERO     #1AJTM           TD Drive Time
     C                     Z-ADDP1B7CD    #1B7CD           TD Drive Card N
     C                     Z-ADD*ZERO     #1D7NB           TD Avg Live Wgt
     C                     MOVEL*BLANK    #1D9ST           TD Gen Bal To K
     C                     MOVEL*BLANK    #1E3ST           TD User Status
     C                     MOVEL*BLANK    #1E4ST           TD User Status
     C                     MOVEL*BLANK    #1E5ST           TD User Status
     C                     Z-ADD*ZERO     #1BVDT           TD User Date 1
     C                     Z-ADD*ZERO     #1BWDT           TD User Date 2
     C                     Z-ADD*ZERO     #1BXDT           TD Drive Date
     C                     Z-ADD*ZERO     #1HVNB           Pen Company Num
     C                     MOVELP1CMCD    #1CMCD           Pen Number
     C                     MOVEL*BLANK    #1GGST           TD Held Over St
     C                     MOVEL*BLANK    #1B9CD           TDP Process Cod
     C                     Z-ADD*ZERO     #1H8NB           Held Over Pen C
     C                     MOVEL*BLANK    #1AAVN           RS User Changed
     C                     Z-ADD*ZERO     #1AADT           RS Date Changed
     C                     Z-ADD*ZERO     #1AMTM           RS Time Changed
     C                     MOVEL*BLANK    #1AJST           RS Record Statu
     C                     MOVEL*BLANK    #1AHVN           RS Job
     C                     MOVEL*BLANK    #1AGVN           RS Program
     C                     MOVEL*BLANK    #1ABVN           RS User Added
     C                     Z-ADD*ZERO     #1ABDT           RS Date Added
     C                     Z-ADD*ZERO     #1ABTM           RS Time Added
     C                     Z-ADD*ZERO     #1CVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     #1C0NB           TD Pen Head
     C                     Z-ADD*ZERO     #1D8NB           TD Yard Dead
     C                     MOVEL*BLANK    #1CYCD           Held Over Pen N
     C                     Z-ADD*ZERO     #1H7NB           TD Held Over
     C                     Z-ADD*ZERO     #RGENB           Tattoo Number N
     C                     MOVEL*BLANK    #RCBCD           Pen Usr
     C                     Z-ADD*ZERO     #RB5NB           Head Total USR
     C                     MOVEL*BLANK    #RCTCD           Defect Code Usr
     C                     MOVEL*BLANK    #RBECD           HC Class Code
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @A2CPIF fields to subfile
      *================================================================
     C                     Z-ADDA2HMNB    #1HMNB           BOH Company Num
     C                     Z-ADDA2C2NB    #1C2NB           TD Sequence Num
     C                     Z-ADDA2BNNB    #1BNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    #1BONB           BOL Load Number
     C                     Z-ADDA2B0DT    #1B0DT           TH Kill Date
     C                     Z-ADDA2CZNB    #1CZNB           TD Live Wgt
     C                     Z-ADDA2AJTM    #1AJTM           TD Drive Time
     C                     Z-ADDA2B7CD    #1B7CD           TD Drive Card N
     C                     Z-ADDA2D7NB    #1D7NB           TD Avg Live Wgt
     C                     MOVELA2D9ST    #1D9ST           TD Gen Bal To K
     C                     MOVELA2E3ST    #1E3ST           TD User Status
     C                     MOVELA2E4ST    #1E4ST           TD User Status
     C                     MOVELA2E5ST    #1E5ST           TD User Status
     C                     Z-ADDA2BVDT    #1BVDT           TD User Date 1
     C                     Z-ADDA2BWDT    #1BWDT           TD User Date 2
     C                     Z-ADDA2BXDT    #1BXDT           TD Drive Date
     C                     Z-ADDA2HVNB    #1HVNB           Pen Company Num
     C                     MOVELA2CMCD    #1CMCD           Pen Number
     C                     MOVELA2GGST    #1GGST           TD Held Over St
     C                     MOVELA2B9CD    #1B9CD           TDP Process Cod
     C                     Z-ADDA2H8NB    #1H8NB           Held Over Pen C
     C                     MOVELA2AAVN    #1AAVN           RS User Changed
     C                     Z-ADDA2AADT    #1AADT           RS Date Changed
     C                     Z-ADDA2AMTM    #1AMTM           RS Time Changed
     C                     MOVELA2AJST    #1AJST           RS Record Statu
     C                     MOVELA2AHVN    #1AHVN           RS Job
     C                     MOVELA2AGVN    #1AGVN           RS Program
     C                     MOVELA2ABVN    #1ABVN           RS User Added
     C                     Z-ADDA2ABDT    #1ABDT           RS Date Added
     C                     Z-ADDA2ABTM    #1ABTM           RS Time Added
     C                     Z-ADDA2CVNB    #1CVNB           TH Tattoo Numbe
     C                     Z-ADDA2C0NB    #1C0NB           TD Pen Head
     C                     Z-ADDA2D8NB    #1D8NB           TD Yard Dead
     C                     MOVELA2CYCD    #1CYCD           Held Over Pen N
     C                     Z-ADDA2H7NB    #1H7NB           TD Held Over
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADDP1HMNB    #2HMNB           BOH Company Num
     C                     Z-ADD*ZERO     #2CVNB           TH Tattoo Numbe
     C                     Z-ADDP2CWNB    #PCWNB           TH Head Receive
     C                     Z-ADDP2CXNB    #PCXNB           TH Dead On Arri
     C                     Z-ADD*ZERO     #CEDNB           Head Held Over
     C                     Z-ADDP2FCNB    #PFCNB           TH Yard Deads
     C                     Z-ADDP1B7CD    #2B7CD           TD Drive Card N
     C                     MOVELP1CMCD    #2CMCD           Pen Number
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Hog Class Subjct  RT - Hog Classification  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           A8BECD           HC Class Code
      * Move fields to key list
     C                     MOVEL#RBECD    A8BECD           HC Class Code
     C           KPSSA     SETLL@A8RENO                    *
     C                     READ @A8RENO                  90*
      * Data record not found
     C   90                MOVEL'PRK0075' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA8BECD    #RBECD           HC Class Code
     C                     GOTO SAEXIT                     *QUIT
     C                     READ @A8RENO                  90*
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Rtv Val Pen-no parms  RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A3HVNB    WQSB01           Pen Company Num
     C           *LIKE     DEFN A3CMCD    WQSB02           Pen Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Pen Company Num
     C                     KFLD           WQSB02           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HVNB    WQSB01           Pen Company Num
     C                     MOVEL#1CYCD    WQSB02           Pen Number
     C           KRSSB     SETLL@A3REKF                    *
     C           KRSSB     READE@A3REKF                  90*
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Val Tattoo/KillDt RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAHMNB    WQSC01           BOH Company Num
     C           *LIKE     DEFN WACVNB    WQSC02           TH Tattoo Numbe
     C           *LIKE     DEFN WAB0DT    WQSC03           TH Kill Date
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           BOH Company Num
     C                     KFLD           WQSC02           TH Tattoo Numbe
     C                     KFLD           WQSC03           TH Kill Date
      * Move fields to key list
     C                     Z-ADD#1HMNB    WQSC01           BOH Company Num
     C                     Z-ADD#RGENB    WQSC02           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    WQSC03           TH Kill Date
     C           KRSSC     SETLL@A2CPKG                    *
     C           KRSSC     READE@A2CPKG                  90*
      * Data record not found
     C   90                MOVEL'PRK0063' W0RTN   7
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Val Pen-no parms  RT - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A3HVNB    WQSD01           Pen Company Num
     C           *LIKE     DEFN A3CMCD    WQSD02           Pen Number
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Pen Company Num
     C                     KFLD           WQSD02           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HVNB    WQSD01           Pen Company Num
     C                     MOVEL#RCBCD    WQSD02           Pen Number
     C           KRSSD     SETLL@A3REKF                    *
     C           KRSSD     READE@A3REKF                  90*
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Rtv Hog Defect        RT - Hog Defect  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           A7BDCD           DF Defect Code
      * Move fields to key list
     C                     MOVEL#RCTCD    A7BDCD           DF Defect Code
     C           KRSSE     CHAIN@A7REC1              90    *
      * Data record not found
     C   90                MOVEL'PRK0073' W0RTN   7
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Rtv Hog Class         RT - Hog Classification  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WBBECD           HC Class Code
      * Move fields to key list
     C                     MOVEL#RBECD    WBBECD           HC Class Code
     C           KRSSF     CHAIN@A8REDA              90    *
      * Data record not found
     C   90                MOVEL'PRK0075' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBBDTX    WUBDTX           HC Description
     C                     MOVELWBBXST    WUBXST           HC Defect Requi
     C                     MOVELWBBYST    WUBYST           HC Price Requir
     C                     MOVELWBBITX    WUBITX           HC Resolution
     C                     MOVELWBB0ST    WUB0ST           HC Qualificatio
     C                     MOVELWBFBST    WUFBST           HC Class Type
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * RTV Tattoo Record     RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Move fields to key list
     C                     Z-ADD#1HMNB    A1HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A1BONB           BOL Load Number
     C                     Z-ADD#1CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A1B0DT           TH Kill Date
     C           KRSSG     CHAIN@A1CPC4              90    *
      * Data record not found
     C   90                MOVEL'PRK0061' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDA1AWDT    WUAWDT           TH Purchase Dat
     C                     MOVELA1BICD    WUBICD           TH Tattoo Refer
     C                     MOVELA1CPST    WUCPST           TH Live Purchas
     C                     Z-ADDA1ACPR    WUACPR           TH Live Purchas
     C                     MOVELA1C4ST    WUC4ST           TH Resale UOM
     C                     Z-ADDA1AIPR    WUAIPR           TH Resale Price
     C                     Z-ADDA1A6DT    WUA6DT           TH Resale Invoi
     C                     MOVELA1C2ST    WUC2ST           TH Resale Print
     C                     Z-ADDA1CXNB    WUCXNB           TH Dead On Arri
     C                     Z-ADDA1CWNB    WUCWNB           TH Head Receive
     C                     Z-ADDA1FCNB    WUFCNB           TH Yard Deads
     C                     Z-ADDA1H9NB    WUH9NB           TH Held Over
     C                     Z-ADDA1FDNB    WUFDNB           TH Head Condemn
     C                     Z-ADDA1FENB    WUFENB           TH Head Killed
     C                     Z-ADDA1HENB    WUHENB           TH Head Adds
     C                     Z-ADDA1HFNB    WUHFNB           TH Head Analyze
     C                     Z-ADDA1CYNB    WUCYNB           TH Live Wgt
     C                     Z-ADDA1E0NB    WUE0NB           TH Hot Wgt
     C                     Z-ADDA1A5PC    WUA5PC           TH Tot Loin Eye
     C                     Z-ADDA1FBNB    WUFBNB           TH Tot Backfat
     C                     Z-ADDA1A4PC    WUA4PC           TH Tot Light Re
     C                     Z-ADDA1F7NB    WUF7NB           TH Avg Live Wgt
     C                     Z-ADDA1HDNB    WUHDNB           TH Avg Hot Wgt
     C                     Z-ADDA1F5NB    WUF5NB           TH Avg Light Re
     C                     Z-ADDA1F4NB    WUF4NB           TH Avg Lean Per
     C                     Z-ADDA1F3NB    WUF3NB           TH Avg Loin Eye
     C                     Z-ADDA1F2NB    WUF2NB           TH Avg Backfat
     C                     Z-ADDA1AVPC    WUAVPC           TH Std Yield Pe
     C                     Z-ADDA1AWPC    WUAWPC           TH Actual Yield
     C                     Z-ADDA1A8PC    WUA8PC           TH Yield Differ
     C                     Z-ADDA1A7PC    WUA7PC           TH UnUsed Field
     C                     Z-ADDA1AMPR    WUAMPR           TH Base Mkt Pri
     C                     Z-ADDA1ANPR    WUANPR           TH Base Mkt Pri
     C                     Z-ADDA1AYVA    WUAYVA           TH Sort Discoun
     C                     Z-ADDA1AWVA    WUAWVA           TH Yield Gain/L
     C                     Z-ADDA1AOPR    WUAOPR           TH Base Carcass
     C                     Z-ADDA1AXVA    WUAXVA           TH Lean AddOn/D
     C                     Z-ADDA1APPR    WUAPPR           TH Gross Amt
     C                     Z-ADDA1ASPR    WUASPR           TH Deduction Am
     C                     Z-ADDA1A4VA    WUA4VA           TH Total Net WO
     C                     Z-ADDA1A5VA    WUA5VA           TH Additions Am
     C                     Z-ADDA1ATPR    WUATPR           TH Net Amt
     C                     Z-ADDA1A7VA    WUA7VA           TH Contract Adj
     C                     Z-ADDA1A2PR    WUA2PR           TH Actual Value
     C                     MOVELA1CWST    WUCWST           TH Payment Sts
     C                     MOVELA1D7ST    WUD7ST           TH Header Error
     C                     MOVELA1D8ST    WUD8ST           TH Detail Error
     C                     MOVELA1DWST    WUDWST           TH Kill Balanci
     C                     MOVELA1D6ST    WUD6ST           TH Bal to Kill
     C                     Z-ADDA1GHNB    WUGHNB           TH Check Number
     C                     Z-ADDA1BYDT    WUBYDT           TH Check Date
     C                     MOVELA1E0ST    WUE0ST           TH Unused Statu
     C                     MOVELA1E1ST    WUE1ST           TH Held Over Re
     C                     MOVELA1E2ST    WUE2ST           TH Sex
     C                     Z-ADDA1BSDT    WUBSDT           TH Unused Date
     C                     Z-ADDA1BTDT    WUBTDT           TH Unused Date
     C                     Z-ADDA1BUDT    WUBUDT           TH Unused Date
     C                     Z-ADDA1HGNB    WUHGNB           TH Unused Wgt 1
     C                     Z-ADDA1HHNB    WUHHNB           TH Unused Wgt 2
     C                     Z-ADDA1HINB    WUHINB           TH FFLI
     C                     Z-ADDA1A3PR    WUA3PR           TH Kill Product
     C                     Z-ADDA1A4PR    WUA4PR           TH Cut Product
     C                     Z-ADDA1A6PR    WUA6PR           TH Render Produ
     C                     MOVELA1AGCD    WUAGCD           GN Genetic Code
     C                     MOVELA1BECD    WUBECD           HC Class Code
     C                     MOVELA1BDCD    WUBDCD           DF Defect Code
     C                     MOVELA1CSCD    WUCSCD           THP Process Cod
     C                     MOVELA1ABCD    WUABCD           PD Producer Cod
     C                     MOVELA1AECD    WUAECD           PL Location Cod
     C                     MOVELA1ACCD    WUACCD           HB Buyer Code
     C                     END
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCRRC    BEGSR
      *================================================================
      * Create Tattoo Detail - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @A2CPDF
     C                     Z-ADD#1HMNB    A2HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A2BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A2BONB           BOL Load Number
     C                     Z-ADD#RGENB    A2CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A2B0DT           TH Kill Date
     C                     Z-ADD#1C2NB    A2C2NB           TD Sequence Num
     C                     Z-ADDWUCZNB    A2CZNB           TD Live Wgt
     C                     Z-ADD#RB5NB    A2C0NB           TD Pen Head
     C                     Z-ADD*ZERO     A2D8NB           TD Yard Dead
     C                     Z-ADD*ZERO     A2H7NB           TD Held Over
     C                     MOVEL*BLANK    A2GGST           TD Held Over St
     C                     Z-ADD#1AJTM    A2AJTM           TD Drive Time
     C                     Z-ADD*ZERO     A2B7CD           TD Drive Card N
     C                     Z-ADD#1D7NB    A2D7NB           TD Avg Live Wgt
     C                     MOVEL#1D9ST    A2D9ST           TD Gen Bal To K
     C                     MOVEL#1E3ST    A2E3ST           TD User Status
     C                     MOVEL#1E4ST    A2E4ST           TD User Status
     C                     MOVEL#1E5ST    A2E5ST           TD User Status
     C                     Z-ADD#1BVDT    A2BVDT           TD User Date 1
     C                     Z-ADD#1BWDT    A2BWDT           TD User Date 2
     C                     Z-ADD#1BXDT    A2BXDT           TD Drive Date
     C                     Z-ADD#1HVNB    A2HVNB           Pen Company Num
     C                     MOVEL#RCBCD    A2CMCD           Pen Number
     C                     MOVE *BLANK    A2B9CD           TDP Process Cod
     C                     MOVEL'O'       A2B9CD           TDP Process Cod
     C                     Z-ADD*ZERO     A2H8NB           Held Over Pen C
     C                     MOVEL*BLANK    A2CYCD           Held Over Pen N
     C                     MOVEL*BLANK    A2AAVN           RS User Changed
     C                     Z-ADD*ZERO     A2AADT           RS Date Changed
     C                     Z-ADD*ZERO     A2AMTM           RS Time Changed
     C                     MOVEL#1AJST    A2AJST           RS Record Statu
     C                     MOVEL#1AHVN    A2AHVN           RS Job
     C                     MOVEL#1AGVN    A2AGVN           RS Program
     C                     MOVEL#1ABVN    A2ABVN           RS User Added
     C                     Z-ADD#1ABDT    A2ABDT           RS Date Added
     C                     Z-ADD#1ABTM    A2ABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       A2AJST           RS Record Statu
     C                     MOVEL##USR     A2ABVN           RS User Added
     C                     Z-ADD##JDT     A2ABDT           RS Date Added
     C                     Z-ADD##JTM     A2ABTM           RS Time Added
     C                     MOVEL##PGM     A2AGVN           RS Program
     C                     MOVEL##JOB     A2AHVN           RS Job
     C           KLCRSH    KLIST
     C                     KFLD           A2HMNB           BOH Company Num
     C                     KFLD           A2BNNB           BOH Buy Order N
     C                     KFLD           A2BONB           BOL Load Number
     C                     KFLD           A2CVNB           TH Tattoo Numbe
     C                     KFLD           A2B0DT           TH Kill Date
     C                     KFLD           A2C2NB           TD Sequence Num
      * Check for duplicate primary key
     C           KLCRSH    SETLL@A2CPDF                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0064' W0RTN   7
      * Send message 'Tattoo Detail          EX'
     C                     MOVEL'PRK0064' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     END
      *
     C                     WRITE@A2CPDF                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     END
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Rtv/Chg Hd Rcvd       RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Move fields to key list
     C                     Z-ADD#1HMNB    A1HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A1BONB           BOL Load Number
     C                     Z-ADD#1CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A1B0DT           TH Kill Date
     C           KRSSI     CHAIN@A1CPC4              90    *
      * Data record not found
     C   90                MOVEL'PRK0061' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           A1CWNB    SUB  #RB5NB    WUCWNB           TH Head Receive
     C           A1F7NB    MULT WUCWNB    WUCYNB           TH Live Wgt
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(DB1) A1J9NB' defaulted for 'TH Head Deletes'.
      * Change Tattoo Header - Tattoo Header  * 
     C                     EXSR SJCHRC
     C                     MOVELA1BECD    WUBECD           HC Class Code
     C                     MOVELA1BDCD    WUBDCD           DF Defect Code
     C                     END
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Change Tattoo Header - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @A1CPC5
     C                     Z-ADDA1HMNB    WDHMNB           BOH Company Num
     C                     Z-ADDA1BNNB    WDBNNB           BOH Buy Order N
     C                     Z-ADDA1BONB    WDBONB           BOL Load Number
     C                     Z-ADDA1CVNB    WDCVNB           TH Tattoo Numbe
     C                     Z-ADDA1B0DT    WDB0DT           TH Kill Date
      *
     C           KLCHSJ    KLIST
     C                     KFLD           WDHMNB           BOH Company Num
     C                     KFLD           WDBNNB           BOH Buy Order N
     C                     KFLD           WDBONB           BOL Load Number
     C                     KFLD           WDCVNB           TH Tattoo Numbe
     C                     KFLD           WDB0DT           TH Kill Date
     C           KLCHSJ    CHAIN@A1CPC5              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SJEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA11    YARDCS
      * Move non-key fields to @A1CPC5
     C                     Z-ADDA1AWDT    WDAWDT           TH Purchase Dat
     C                     MOVELA1BICD    WDBICD           TH Tattoo Refer
     C                     MOVELA1CPST    WDCPST           TH Live Purchas
     C                     Z-ADDA1ACPR    WDACPR           TH Live Purchas
     C                     MOVELA1C4ST    WDC4ST           TH Resale UOM
     C                     Z-ADDA1AIPR    WDAIPR           TH Resale Price
     C                     Z-ADDA1A6DT    WDA6DT           TH Resale Invoi
     C                     MOVELA1C2ST    WDC2ST           TH Resale Print
     C                     Z-ADDA1CXNB    WDCXNB           TH Dead On Arri
     C                     Z-ADDWUCWNB    WDCWNB           TH Head Receive
     C                     Z-ADDA1FCNB    WDFCNB           TH Yard Deads
     C                     Z-ADDA1H9NB    WDH9NB           TH Held Over
     C                     Z-ADDA1FDNB    WDFDNB           TH Head Condemn
     C                     Z-ADDA1FENB    WDFENB           TH Head Killed
     C                     Z-ADDA1HENB    WDHENB           TH Head Adds
     C                     Z-ADDA1HFNB    WDHFNB           TH Head Analyze
     C                     Z-ADDWUCYNB    WDCYNB           TH Live Wgt
     C                     Z-ADDA1E0NB    WDE0NB           TH Hot Wgt
     C                     Z-ADDA1A5PC    WDA5PC           TH Tot Loin Eye
     C                     Z-ADDA1FBNB    WDFBNB           TH Tot Backfat
     C                     Z-ADDA1A4PC    WDA4PC           TH Tot Light Re
     C                     Z-ADDA1F7NB    WDF7NB           TH Avg Live Wgt
     C                     Z-ADDA1HDNB    WDHDNB           TH Avg Hot Wgt
     C                     Z-ADDA1F5NB    WDF5NB           TH Avg Light Re
     C                     Z-ADDA1F4NB    WDF4NB           TH Avg Lean Per
     C                     Z-ADDA1F3NB    WDF3NB           TH Avg Loin Eye
     C                     Z-ADDA1F2NB    WDF2NB           TH Avg Backfat
     C                     Z-ADDA1AVPC    WDAVPC           TH Std Yield Pe
     C                     Z-ADDA1AWPC    WDAWPC           TH Actual Yield
     C                     Z-ADDA1A8PC    WDA8PC           TH Yield Differ
     C                     Z-ADDA1A7PC    WDA7PC           TH UnUsed Field
     C                     Z-ADDA1AMPR    WDAMPR           TH Base Mkt Pri
     C                     Z-ADDA1ANPR    WDANPR           TH Base Mkt Pri
     C                     Z-ADDA1AYVA    WDAYVA           TH Sort Discoun
     C                     Z-ADDA1AWVA    WDAWVA           TH Yield Gain/L
     C                     Z-ADDA1AOPR    WDAOPR           TH Base Carcass
     C                     Z-ADDA1AXVA    WDAXVA           TH Lean AddOn/D
     C                     Z-ADDA1APPR    WDAPPR           TH Gross Amt
     C                     Z-ADDA1ASPR    WDASPR           TH Deduction Am
     C                     Z-ADDA1A4VA    WDA4VA           TH Total Net WO
     C                     Z-ADDA1A5VA    WDA5VA           TH Additions Am
     C                     Z-ADDA1ATPR    WDATPR           TH Net Amt
     C                     Z-ADDA1A7VA    WDA7VA           TH Contract Adj
     C                     Z-ADDA1A2PR    WDA2PR           TH Actual Value
     C                     MOVELA1CWST    WDCWST           TH Payment Sts
     C                     MOVELA1D7ST    WDD7ST           TH Header Error
     C                     MOVELA1D8ST    WDD8ST           TH Detail Error
     C                     MOVELA1DWST    WDDWST           TH Kill Balanci
     C                     MOVELA1D6ST    WDD6ST           TH Bal to Kill
     C                     Z-ADDA1GHNB    WDGHNB           TH Check Number
     C                     Z-ADDA1BYDT    WDBYDT           TH Check Date
     C                     MOVELA1E0ST    WDE0ST           TH Unused Statu
     C                     MOVELA1E1ST    WDE1ST           TH Held Over Re
     C                     MOVELA1E2ST    WDE2ST           TH Sex
     C                     Z-ADDA1BSDT    WDBSDT           TH Unused Date
     C                     Z-ADDA1BTDT    WDBTDT           TH Unused Date
     C                     Z-ADDA1BUDT    WDBUDT           TH Unused Date
     C                     Z-ADDA1HGNB    WDHGNB           TH Unused Wgt 1
     C                     Z-ADDA1HHNB    WDHHNB           TH Unused Wgt 2
     C                     Z-ADDA1HINB    WDHINB           TH FFLI
     C                     Z-ADDA1A3PR    WDA3PR           TH Kill Product
     C                     Z-ADDA1A4PR    WDA4PR           TH Cut Product
     C                     Z-ADDA1A6PR    WDA6PR           TH Render Produ
     C                     Z-ADDA1J9NB    WDJ9NB           TH Head Deletes
     C                     MOVELA1AGCD    WDAGCD           GN Genetic Code
     C                     MOVELA1BECD    WDBECD           HC Class Code
     C                     MOVELA1BDCD    WDBDCD           DF Defect Code
     C                     MOVELA1CSCD    WDCSCD           THP Process Cod
     C                     MOVELA1ABCD    WDABCD           PD Producer Cod
     C                     MOVELA1AECD    WDAECD           PL Location Cod
     C                     MOVELA1ACCD    WDACCD           HB Buyer Code
     C                     MOVELA1AAVN    WDAAVN           RS User Changed
     C                     Z-ADDA1AADT    WDAADT           RS Date Changed
     C                     Z-ADDA1AMTM    WDAMTM           RS Time Changed
     C                     MOVELA1AJST    WDAJST           RS Record Statu
     C                     MOVELA1AHVN    WDAHVN           RS Job
     C                     MOVELA1AGVN    WDAGVN           RS Program
     C                     MOVELA1ABVN    WDABVN           RS User Added
     C                     Z-ADDA1ABDT    WDABDT           RS Date Added
     C                     Z-ADDA1ABTM    WDABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA11    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WDAAVN           RS User Changed
     C                     Z-ADD##JDT     WDAADT           RS Date Changed
     C                     Z-ADD##JTM     WDAMTM           RS Time Changed
     C                     MOVEL##JOB     WDAHVN           RS Job
     C                     MOVEL##PGM     WDAGVN           RS Program
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@A1CPC5                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA1CPL1               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKCRRC    BEGSR
      *================================================================
      * Crt Tto Hdr Subj hogs CR - Tattoo Header  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0001  70       TH Purchase Dat
     C                     MOVEL*BLANK    WN0002 10        TH Tattoo Refer
     C                     MOVEL*BLANK    WN0003  2        TH Live Purchas
     C                     Z-ADD*ZERO     WN0004  52       TH Live Purchas
     C                     Z-ADD*ZERO     WN0005  51       TH Avg Live Wgt
     C                     MOVEL*BLANK    WN0006  1        TH Sex
     C                     MOVEL*BLANK    WN0007  5        GN Genetic Code
     C                     MOVEL*BLANK    WN0008  6        THP Process Cod
     C                     MOVEL*BLANK    WN0009  6        PD Producer Cod
     C                     MOVEL*BLANK    WN0010  6        PL Location Cod
     C                     MOVEL*BLANK    WN0011  3        HB Buyer Code
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @A1CPC5
     C                     Z-ADD#1HMNB    WDHMNB           BOH Company Num
     C                     Z-ADD#1BNNB    WDBNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    WDBONB           BOL Load Number
     C                     Z-ADD#RGENB    WDCVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    WDB0DT           TH Kill Date
     C                     MOVELWUCRTX    WDC4ST           TH Resale UOM
     C                     Z-ADDWUE9NB    WDAIPR           TH Resale Price
     C                     Z-ADDWUE9NB    WDA6DT           TH Resale Invoi
     C                     MOVELWUCRTX    WDC2ST           TH Resale Print
     C                     Z-ADDWUE9NB    WDCXNB           TH Dead On Arri
     C                     Z-ADD#RB5NB    WDCWNB           TH Head Receive
     C                     Z-ADD*ZERO     WDFCNB           TH Yard Deads
     C                     Z-ADDWUE9NB    WDH9NB           TH Held Over
     C                     Z-ADDWUE9NB    WDFDNB           TH Head Condemn
     C                     Z-ADDWUE9NB    WDFENB           TH Head Killed
     C                     Z-ADDWUE9NB    WDHENB           TH Head Adds
     C                     Z-ADDWUE9NB    WDHFNB           TH Head Analyze
     C                     Z-ADDWUCZNB    WDCYNB           TH Live Wgt
     C                     Z-ADDWUE9NB    WDE0NB           TH Hot Wgt
     C                     Z-ADDWUE9NB    WDA5PC           TH Tot Loin Eye
     C                     Z-ADDWUE9NB    WDFBNB           TH Tot Backfat
     C                     Z-ADDWUE9NB    WDA4PC           TH Tot Light Re
     C                     Z-ADDWUE9NB    WDHDNB           TH Avg Hot Wgt
     C                     Z-ADDWUE9NB    WDF5NB           TH Avg Light Re
     C                     Z-ADDWUE9NB    WDF4NB           TH Avg Lean Per
     C                     Z-ADDWUE9NB    WDF3NB           TH Avg Loin Eye
     C                     Z-ADDWUE9NB    WDF2NB           TH Avg Backfat
     C                     Z-ADDWUE9NB    WDAVPC           TH Std Yield Pe
     C                     Z-ADDWUE9NB    WDAWPC           TH Actual Yield
     C                     Z-ADD*ZERO     WDA8PC           TH Yield Differ
     C                     Z-ADD*ZERO     WDA7PC           TH UnUsed Field
     C                     Z-ADD*ZERO     WDAMPR           TH Base Mkt Pri
     C                     Z-ADD*ZERO     WDANPR           TH Base Mkt Pri
     C                     Z-ADD*ZERO     WDAYVA           TH Sort Discoun
     C                     Z-ADD*ZERO     WDAWVA           TH Yield Gain/L
     C                     Z-ADD*ZERO     WDAOPR           TH Base Carcass
     C                     Z-ADD*ZERO     WDAXVA           TH Lean AddOn/D
     C                     Z-ADD*ZERO     WDAPPR           TH Gross Amt
     C                     Z-ADD*ZERO     WDASPR           TH Deduction Am
     C                     Z-ADD*ZERO     WDA4VA           TH Total Net WO
     C                     Z-ADD*ZERO     WDA5VA           TH Additions Am
     C                     Z-ADD*ZERO     WDATPR           TH Net Amt
     C                     Z-ADD*ZERO     WDA7VA           TH Contract Adj
     C                     Z-ADD*ZERO     WDA2PR           TH Actual Value
     C                     MOVEL'SL'      WDCWST           TH Payment Sts
     C                     MOVELWUCRTX    WDD7ST           TH Header Error
     C                     MOVELWUCRTX    WDD8ST           TH Detail Error
     C                     MOVELWUCRTX    WDDWST           TH Kill Balanci
     C                     MOVELWUCRTX    WDD6ST           TH Bal to Kill
     C                     Z-ADDWUE9NB    WDGHNB           TH Check Number
     C                     Z-ADDWUE9NB    WDBYDT           TH Check Date
     C                     MOVELWUCRTX    WDE0ST           TH Unused Statu
     C                     MOVELWUCRTX    WDE1ST           TH Held Over Re
     C                     Z-ADD*ZERO     WDBSDT           TH Unused Date
     C                     Z-ADD*ZERO     WDBTDT           TH Unused Date
     C                     Z-ADD*ZERO     WDBUDT           TH Unused Date
     C                     Z-ADD*ZERO     WDHGNB           TH Unused Wgt 1
     C                     Z-ADD*ZERO     WDHHNB           TH Unused Wgt 2
     C                     Z-ADD*ZERO     WDHINB           TH FFLI
     C                     Z-ADD*ZERO     WDA3PR           TH Kill Product
     C                     Z-ADD*ZERO     WDA4PR           TH Cut Product
     C                     Z-ADD*ZERO     WDA6PR           TH Render Produ
     C                     Z-ADD*ZERO     WDJ9NB           TH Head Deletes
     C                     MOVELWUBECD    WDBECD           HC Class Code
     C                     MOVELWUBDCD    WDBDCD           DF Defect Code
     C                     MOVEL*BLANK    WDAAVN           RS User Changed
     C                     Z-ADD*ZERO     WDAADT           RS Date Changed
     C                     Z-ADD*ZERO     WDAMTM           RS Time Changed
     C                     MOVEL#1AJST    WDAJST           RS Record Statu
     C                     MOVEL#1AHVN    WDAHVN           RS Job
     C                     MOVEL#1AGVN    WDAGVN           RS Program
     C                     MOVEL#1ABVN    WDABVN           RS User Added
     C                     Z-ADD#1ABDT    WDABDT           RS Date Added
     C                     Z-ADD#1ABTM    WDABTM           RS Time Added
      *
      * USER: Processing before Data update
      * Rtv Add Stamp         IF
     C                     MOVEL'A'       WDAJST           RS Record Statu
     C                     MOVEL##USR     WDABVN           RS User Added
     C                     Z-ADD##JDT     WDABDT           RS Date Added
     C                     Z-ADD##JTM     WDABTM           RS Time Added
     C                     MOVEL##PGM     WDAGVN           RS Program
     C                     MOVEL##JOB     WDAHVN           RS Job
     C           KLCRSK    KLIST
     C                     KFLD           WDHMNB           BOH Company Num
     C                     KFLD           WDBNNB           BOH Buy Order N
     C                     KFLD           WDBONB           BOL Load Number
     C                     KFLD           WDCVNB           TH Tattoo Numbe
     C                     KFLD           WDB0DT           TH Kill Date
      * Check for duplicate primary key
     C           KLCRSK    SETLL@A1CPC5                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'PRK0062' W0RTN   7
      * Send message 'Tattoo Header          EX'
     C                     MOVEL'PRK0062' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SKEXIT
     C                     END
      *
     C                     WRITE@A1CPC5                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     END
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Set Pen Totals to Zeros - Pen  * 
     C                     EXSR SMRVGN
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEHMNB    WQSL01           BOH Company Num
     C           *LIKE     DEFN WECMCD    WQSL02           Pen Number
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           WQSL01           BOH Company Num
     C                     KFLD           WQSL02           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HMNB    WQSL01           BOH Company Num
     C                     MOVEL#RCBCD    WQSL02           Pen Number
     C           KRSSL     SETLL@A2CPKE                    *
     C           KRSSL     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR SOCHRC
     C                     GOTO SLEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Update Pen Totals - Pen  * 
     C                     EXSR SPRVGN
     C           KRSSL     READE@A2CPKE                  90*
     C                     END
      * USER: Exit processing
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
     C                     EXSR SRRVGN
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR SUCHRC
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Set Pen Totals to Zeros - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HMNB    WCHVNB           Pen Company Num
     C                     MOVEL#RCBCD    WCCMCD           Pen Number
     C           KRSSM     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Pen               CH - Pen  * 
     C                     EXSR SNCHRC
     C                     END
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWCHVNB    WFHVNB           Pen Company Num
     C                     MOVELWCCMCD    WFCMCD           Pen Number
      *
     C           KLCHSN    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSN    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SNEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SNEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YBRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUCRTX    WFBBTX           Pen Description
     C                     Z-ADDWCCTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WFD6NB           Pen Current Hea
     C                     Z-ADDWCB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWCDGST    WFDGST           Pen Sts
     C                     Z-ADDWCEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWCFWST    WFFWST           Pen Type
     C                     Z-ADDWCHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWUCRTX    WFAGCD           GN Genetic Code
     C                     MOVELWCAAVN    WFAAVN           RS User Changed
     C                     Z-ADDWCAADT    WFAADT           RS Date Changed
     C                     Z-ADDWCAMTM    WFAMTM           RS Time Changed
     C                     MOVELWCAJST    WFAJST           RS Record Statu
     C                     MOVELWCAHVN    WFAHVN           RS Job
     C                     MOVELWCAGVN    WFAGVN           RS Program
     C                     MOVELWCABVN    WFABVN           RS User Added
     C                     Z-ADDWCABDT    WFABDT           RS Date Added
     C                     Z-ADDWCABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SOCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0012  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0013  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0014  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0015  1        Pen Sts
     C                     Z-ADD*ZERO     WN0016  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0017  1        Pen Type
     C                     Z-ADD*ZERO     WN0018  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0019 10        RS User Changed
     C                     Z-ADD*ZERO     WN0020  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0021  60       RS Time Changed
     C                     MOVEL*BLANK    WN0022  1        RS Record Statu
     C                     MOVEL*BLANK    WN0023 10        RS Job
     C                     MOVEL*BLANK    WN0024 10        RS Program
     C                     MOVEL*BLANK    WN0025 10        RS User Added
     C                     Z-ADD*ZERO     WN0026  70       RS Date Added
     C                     Z-ADD*ZERO     WN0027  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YCRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HMNB    WFHVNB           Pen Company Num
     C                     MOVEL#RCBCD    WFCMCD           Pen Number
      *
     C           KLCHSO    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSO    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SOEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SOEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YCRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX           Pen Description
     C                     MOVELWUAGCD    WFAGCD           GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * Update Pen Totals - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Move fields to key list
     C                     Z-ADDWEHMNB    WCHVNB           Pen Company Num
     C                     MOVELWECMCD    WCCMCD           Pen Number
     C           KRSSP     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           WEC0NB    ADD  WCD6NB    WUD6NB           Pen Current Hea
     C                     SUB  WED8NB    WUD6NB           Pen Current Hea
      * Chg Pen               CH - Pen  * 
     C                     EXSR SQCHRC
     C                     END
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YDRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWCHVNB    WFHVNB           Pen Company Num
     C                     MOVELWCCMCD    WFCMCD           Pen Number
      *
     C           KLCHSQ    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSQ    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SQEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SQEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YDRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWCBBTX    WFBBTX           Pen Description
     C                     Z-ADDWCCTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDWUD6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDWCB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWCDGST    WFDGST           Pen Sts
     C                     Z-ADDWCEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWCFWST    WFFWST           Pen Type
     C                     Z-ADDWCHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWCAGCD    WFAGCD           GN Genetic Code
     C                     MOVELWCAAVN    WFAAVN           RS User Changed
     C                     Z-ADDWCAADT    WFAADT           RS Date Changed
     C                     Z-ADDWCAMTM    WFAMTM           RS Time Changed
     C                     MOVELWCAJST    WFAJST           RS Record Statu
     C                     MOVELWCAHVN    WFAHVN           RS Job
     C                     MOVELWCAGVN    WFAGVN           RS Program
     C                     MOVELWCABVN    WFABVN           RS User Added
     C                     Z-ADDWCABDT    WFABDT           RS Date Added
     C                     Z-ADDWCABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YDRDCS
     C                     MOVE 'Y'       YDRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEHMNB    WQSR01           BOH Company Num
     C           *LIKE     DEFN WECMCD    WQSR02           Pen Number
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           WQSR01           BOH Company Num
     C                     KFLD           WQSR02           Pen Number
      * Move fields to key list
     C                     Z-ADDWEHMNB    WQSR01           BOH Company Num
     C                     MOVELWECMCD    WQSR02           Pen Number
     C           KRSSR     SETLL@A2CPKE                    *
     C           KRSSR     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     GOTO SREXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.TDP Process Code is Drive Card Printed
      *   |- c2    : DB1.TDP Process Code is Open
      *   '-
     C           WEB9CD    IFEQ 'D'                        *IF
     C           WEB9CD    OREQ 'O'                        *OR
      * Rtv Tattoo GENETICS - Tattoo Header  * 
     C                     EXSR SSRVGN
     C                     GOTO SREXIT                     *QUIT
     C                     END                             *FI
     C           KRSSR     READE@A2CPKE                  90*
     C                     END
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * Rtv Tattoo GENETICS - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A1HMNB    WQSS01           BOH Company Num
     C           *LIKE     DEFN A1BNNB    WQSS02           BOH Buy Order N
     C           *LIKE     DEFN A1BONB    WQSS03           BOL Load Number
     C           *LIKE     DEFN A1CVNB    WQSS04           TH Tattoo Numbe
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           WQSS01           BOH Company Num
     C                     KFLD           WQSS02           BOH Buy Order N
     C                     KFLD           WQSS03           BOL Load Number
     C                     KFLD           WQSS04           TH Tattoo Numbe
      * Move fields to key list
     C                     Z-ADDWEHMNB    WQSS01           BOH Company Num
     C                     Z-ADDWEBNNB    WQSS02           BOH Buy Order N
     C                     Z-ADDWEBONB    WQSS03           BOL Load Number
     C                     Z-ADDWECVNB    WQSS04           TH Tattoo Numbe
     C           KRSSS     SETLL@A1CPC4                    *
     C           KRSSS     READE@A1CPC4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     GOTO SSEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA1AGCD    WUAGCD           GN Genetic Code
      * Rtv Genetic Record    RT - Genetic  * 
     C                     EXSR STRVGN
     C           KRSSS     READE@A1CPC4                  90*
     C                     END
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STRVGN    BEGSR
      *================================================================
      * Rtv Genetic Record    RT - Genetic  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSST     KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Move fields to key list
     C                     MOVELA1AGCD    AIAGCD           GN Genetic Code
     C           KRSST     CHAIN@AIREA9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0021' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           GN Description
     C                     GOTO STEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAIAWTX    WUBBTX           GN Description
     C                     END
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SUCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0028  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0029  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0030  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0031  1        Pen Sts
     C                     Z-ADD*ZERO     WN0032  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0033  1        Pen Type
     C                     Z-ADD*ZERO     WN0034  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0035 10        RS User Changed
     C                     Z-ADD*ZERO     WN0036  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0037  60       RS Time Changed
     C                     MOVEL*BLANK    WN0038  1        RS Record Statu
     C                     MOVEL*BLANK    WN0039 10        RS Job
     C                     MOVEL*BLANK    WN0040 10        RS Program
     C                     MOVEL*BLANK    WN0041 10        RS User Added
     C                     Z-ADD*ZERO     WN0042  70       RS Date Added
     C                     Z-ADD*ZERO     WN0043  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YERDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HMNB    WFHVNB           Pen Company Num
     C                     MOVEL#RCBCD    WFCMCD           Pen Number
      *
     C           KLCHSU    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSU    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SUEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SUEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YERDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX           Pen Description
     C                     MOVELWUAGCD    WFAGCD           GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YERDCS
     C                     MOVE 'Y'       YERDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * Rtv Dtl hd/Chg Pen    RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * Set Pen Totals to Zeros - Pen  * 
     C                     EXSR SWRVGN
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEHMNB    WQSV01           BOH Company Num
     C           *LIKE     DEFN WECMCD    WQSV02           Pen Number
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           WQSV01           BOH Company Num
     C                     KFLD           WQSV02           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HMNB    WQSV01           BOH Company Num
     C                     MOVEL#1CMCD    WQSV02           Pen Number
     C           KRSSV     SETLL@A2CPKE                    *
     C           KRSSV     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR SYCHRC
     C                     GOTO SVEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Update Pen Totals - Pen  * 
     C                     EXSR SZRVGN
     C           KRSSV     READE@A2CPKE                  90*
     C                     END
      * USER: Exit processing
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
     C                     EXSR TBRVGN
      * Chg Pen Genetics      CH - Pen  * 
     C                     EXSR TECHRC
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         SWRVGN    BEGSR
      *================================================================
      * Set Pen Totals to Zeros - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSW     KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Move fields to key list
     C                     Z-ADD#1HMNB    WCHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WCCMCD           Pen Number
     C           KRSSW     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * Chg Pen               CH - Pen  * 
     C                     EXSR SXCHRC
     C                     END
      *================================================================
     CSR         SWEXIT    ENDSR
      /EJECT
     CSR         SXCHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YFRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWCHVNB    WFHVNB           Pen Company Num
     C                     MOVELWCCMCD    WFCMCD           Pen Number
      *
     C           KLCHSX    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSX    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SXEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SXEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YFRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUCRTX    WFBBTX           Pen Description
     C                     Z-ADDWCCTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADD*ZERO     WFD6NB           Pen Current Hea
     C                     Z-ADDWCB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWCDGST    WFDGST           Pen Sts
     C                     Z-ADDWCEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWCFWST    WFFWST           Pen Type
     C                     Z-ADDWCHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWUCRTX    WFAGCD           GN Genetic Code
     C                     MOVELWCAAVN    WFAAVN           RS User Changed
     C                     Z-ADDWCAADT    WFAADT           RS Date Changed
     C                     Z-ADDWCAMTM    WFAMTM           RS Time Changed
     C                     MOVELWCAJST    WFAJST           RS Record Statu
     C                     MOVELWCAHVN    WFAHVN           RS Job
     C                     MOVELWCAGVN    WFAGVN           RS Program
     C                     MOVELWCABVN    WFABVN           RS User Added
     C                     Z-ADDWCABDT    WFABDT           RS Date Added
     C                     Z-ADDWCABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YFRDCS
     C                     MOVE 'Y'       YFRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SXEXIT    ENDSR
      /EJECT
     CSR         SYCHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0044  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0045  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0046  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0047  1        Pen Sts
     C                     Z-ADD*ZERO     WN0048  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0049  1        Pen Type
     C                     Z-ADD*ZERO     WN0050  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0051 10        RS User Changed
     C                     Z-ADD*ZERO     WN0052  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0053  60       RS Time Changed
     C                     MOVEL*BLANK    WN0054  1        RS Record Statu
     C                     MOVEL*BLANK    WN0055 10        RS Job
     C                     MOVEL*BLANK    WN0056 10        RS Program
     C                     MOVEL*BLANK    WN0057 10        RS User Added
     C                     Z-ADD*ZERO     WN0058  70       RS Date Added
     C                     Z-ADD*ZERO     WN0059  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YGRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HMNB    WFHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WFCMCD           Pen Number
      *
     C           KLCHSY    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHSY    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SYEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SYEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YGRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX           Pen Description
     C                     MOVELWUAGCD    WFAGCD           GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YGRDCS
     C                     MOVE 'Y'       YGRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YGRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SYEXIT    ENDSR
      /EJECT
     CSR         SZRVGN    BEGSR
      *================================================================
      * Update Pen Totals - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSZ     KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Move fields to key list
     C                     Z-ADDWEHMNB    WCHVNB           Pen Company Num
     C                     MOVELWECMCD    WCCMCD           Pen Number
     C           KRSSZ     CHAIN@A3REDD              90    *
      * Data record not found
     C   90                MOVEL'PRK0065' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           WEC0NB    ADD  WCD6NB    WUD6NB           Pen Current Hea
     C                     SUB  WED8NB    WUD6NB           Pen Current Hea
      * Chg Pen               CH - Pen  * 
     C                     EXSR TACHRC
     C                     END
      *================================================================
     CSR         SZEXIT    ENDSR
      /EJECT
     CSR         TACHRC    BEGSR
      *================================================================
      * Chg Pen               CH - Pen  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YHRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADDWCHVNB    WFHVNB           Pen Company Num
     C                     MOVELWCCMCD    WFCMCD           Pen Number
      *
     C           KLCHTA    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTA    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TAEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YHRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWCBBTX    WFBBTX           Pen Description
     C                     Z-ADDWCCTNB    WFCTNB           Pen Maximun Cap
     C                     Z-ADDWUD6NB    WFD6NB           Pen Current Hea
     C                     Z-ADDWCB6CD    WFB6CD           Pen Current Dri
     C                     MOVELWCDGST    WFDGST           Pen Sts
     C                     Z-ADDWCEBNB    WFEBNB           Pen Drive Seque
     C                     MOVELWCFWST    WFFWST           Pen Type
     C                     Z-ADDWCHBNB    WFHBNB           Pen Adjustment
     C                     MOVELWCAGCD    WFAGCD           GN Genetic Code
     C                     MOVELWCAAVN    WFAAVN           RS User Changed
     C                     Z-ADDWCAADT    WFAADT           RS Date Changed
     C                     Z-ADDWCAMTM    WFAMTM           RS Time Changed
     C                     MOVELWCAJST    WFAJST           RS Record Statu
     C                     MOVELWCAHVN    WFAHVN           RS Job
     C                     MOVELWCAGVN    WFAGVN           RS Program
     C                     MOVELWCABVN    WFABVN           RS User Added
     C                     Z-ADDWCABDT    WFABDT           RS Date Added
     C                     Z-ADDWCABTM    WFABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YHRDCS
     C                     MOVE 'Y'       YHRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YHRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TAEXIT    ENDSR
      /EJECT
     CSR         TBRVGN    BEGSR
      *================================================================
      * Rtv Pen GENETICS      RT - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WEHMNB    WQTB01           BOH Company Num
     C           *LIKE     DEFN WECMCD    WQTB02           Pen Number
      * Define keylist
     C           KRSTB     KLIST
     C                     KFLD           WQTB01           BOH Company Num
     C                     KFLD           WQTB02           Pen Number
      * Move fields to key list
     C                     Z-ADDWEHMNB    WQTB01           BOH Company Num
     C                     MOVELWECMCD    WQTB02           Pen Number
     C           KRSTB     SETLL@A2CPKE                    *
     C           KRSTB     READE@A2CPKE                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     GOTO TBEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE:
      *  - c1 OR c2
      *   |- c1    : DB1.TDP Process Code is Drive Card Printed
      *   |- c2    : DB1.TDP Process Code is Open
      *   '-
     C           WEB9CD    IFEQ 'D'                        *IF
     C           WEB9CD    OREQ 'O'                        *OR
      * Rtv Tattoo GENETICS - Tattoo Header  * 
     C                     EXSR TCRVGN
     C                     GOTO TBEXIT                     *QUIT
     C                     END                             *FI
     C           KRSTB     READE@A2CPKE                  90*
     C                     END
      *================================================================
     CSR         TBEXIT    ENDSR
      /EJECT
     CSR         TCRVGN    BEGSR
      *================================================================
      * Rtv Tattoo GENETICS - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN A1HMNB    WQTC01           BOH Company Num
     C           *LIKE     DEFN A1BNNB    WQTC02           BOH Buy Order N
     C           *LIKE     DEFN A1BONB    WQTC03           BOL Load Number
     C           *LIKE     DEFN A1CVNB    WQTC04           TH Tattoo Numbe
      * Define keylist
     C           KRSTC     KLIST
     C                     KFLD           WQTC01           BOH Company Num
     C                     KFLD           WQTC02           BOH Buy Order N
     C                     KFLD           WQTC03           BOL Load Number
     C                     KFLD           WQTC04           TH Tattoo Numbe
      * Move fields to key list
     C                     Z-ADDWEHMNB    WQTC01           BOH Company Num
     C                     Z-ADDWEBNNB    WQTC02           BOH Buy Order N
     C                     Z-ADDWEBONB    WQTC03           BOL Load Number
     C                     Z-ADDWECVNB    WQTC04           TH Tattoo Numbe
     C           KRSTC     SETLL@A1CPC4                    *
     C           KRSTC     READE@A1CPC4                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0061' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUAGCD           GN Genetic Code
     C                     MOVEL*BLANK    WUBBTX           Pen Description
     C                     GOTO TCEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVELA1AGCD    WUAGCD           GN Genetic Code
      * Rtv Genetic Record    RT - Genetic  * 
     C                     EXSR TDRVGN
     C           KRSTC     READE@A1CPC4                  90*
     C                     END
      *================================================================
     CSR         TCEXIT    ENDSR
      /EJECT
     CSR         TDRVGN    BEGSR
      *================================================================
      * Rtv Genetic Record    RT - Genetic  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTD     KLIST
     C                     KFLD           AIAGCD           GN Genetic Code
      * Move fields to key list
     C                     MOVELA1AGCD    AIAGCD           GN Genetic Code
     C           KRSTD     CHAIN@AIREA9              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'PRK0021' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL*BLANK    WUBBTX           GN Description
     C                     GOTO TDEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELAIAWTX    WUBBTX           GN Description
     C                     END
      *================================================================
     CSR         TDEXIT    ENDSR
      /EJECT
     CSR         TECHRC    BEGSR
      *================================================================
      * Chg Pen Genetics      CH - Pen  * 
      *================================================================
      * Clear all neither parameters
     C                     Z-ADD*ZERO     WN0060  50       Pen Maximun Cap
     C                     Z-ADD*ZERO     WN0061  50       Pen Current Hea
     C                     Z-ADD*ZERO     WN0062  30       Pen Current Dri
     C                     MOVEL*BLANK    WN0063  1        Pen Sts
     C                     Z-ADD*ZERO     WN0064  30       Pen Drive Seque
     C                     MOVEL*BLANK    WN0065  1        Pen Type
     C                     Z-ADD*ZERO     WN0066  50       Pen Adjustment
     C                     MOVEL*BLANK    WN0067 10        RS User Changed
     C                     Z-ADD*ZERO     WN0068  70       RS Date Changed
     C                     Z-ADD*ZERO     WN0069  60       RS Time Changed
     C                     MOVEL*BLANK    WN0070  1        RS Record Statu
     C                     MOVEL*BLANK    WN0071 10        RS Job
     C                     MOVEL*BLANK    WN0072 10        RS Program
     C                     MOVEL*BLANK    WN0073 10        RS User Added
     C                     Z-ADD*ZERO     WN0074  70       RS Date Added
     C                     Z-ADD*ZERO     WN0075  60       RS Time Added
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YIRDC   1
      *
      * Move key fields to @A3REDC
     C                     Z-ADD#1HMNB    WFHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WFCMCD           Pen Number
      *
     C           KLCHTE    KLIST
     C                     KFLD           WFHVNB           Pen Company Num
     C                     KFLD           WFCMCD           Pen Number
     C           KLCHTE    CHAIN@A3REDC              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TEEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA31    YIRDCS
      * Move non-key fields to @A3REDC
     C                     MOVELWUBBTX    WFBBTX           Pen Description
     C                     MOVELWUAGCD    WFAGCD           GN Genetic Code
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA31    IFNE YIRDCS
     C                     MOVE 'Y'       YIRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WFAAVN           RS User Changed
     C                     Z-ADD##JDT     WFAADT           RS Date Changed
     C                     Z-ADD##JTM     WFAMTM           RS Time Changed
     C                     MOVEL##JOB     WFAHVN           RS Job
     C                     MOVEL##PGM     WFAGVN           RS Program
      * If changed update record otherwise release record
     C           YIRDC     IFEQ 'Y'
     C                     UPDAT@A3REDC                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA3REL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TEEXIT    ENDSR
      /EJECT
     CSR         TFCHRC    BEGSR
      *================================================================
      * Chg Yrd Dead,Hld Ovr  CH - Tattoo Detail  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YJRDC   1
      *
      * Move key fields to @A2CPDF
     C                     Z-ADD#1HMNB    A2HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A2BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A2BONB           BOL Load Number
     C                     Z-ADD#1CVNB    A2CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A2B0DT           TH Kill Date
     C                     Z-ADD#1C2NB    A2C2NB           TD Sequence Num
      *
     C           KLCHTF    KLIST
     C                     KFLD           A2HMNB           BOH Company Num
     C                     KFLD           A2BNNB           BOH Buy Order N
     C                     KFLD           A2BONB           BOL Load Number
     C                     KFLD           A2CVNB           TH Tattoo Numbe
     C                     KFLD           A2B0DT           TH Kill Date
     C                     KFLD           A2C2NB           TD Sequence Num
     C           KLCHTF    CHAIN@A2CPDF              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TFEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     GOTO TFEXIT
     C                     END                             FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YJRDCS
      * USER: Processing after Data read
      * Calculate the net change in Yard Dead and Held Over
      * to be added to the Tattoo Header after data update.
     C           #1D8NB    SUB  A2D8NB    WUD8NB           TD Yard Dead
     C           #1H7NB    SUB  A2H7NB    WUH7NB           TD Held Over
      * Move non-key fields to @A2CPDF
     C                     Z-ADD#1CZNB    A2CZNB           TD Live Wgt
     C                     Z-ADD#1C0NB    A2C0NB           TD Pen Head
     C                     Z-ADD#1D8NB    A2D8NB           TD Yard Dead
     C                     Z-ADD#1H7NB    A2H7NB           TD Held Over
     C                     MOVEL#1GGST    A2GGST           TD Held Over St
     C                     Z-ADD#1AJTM    A2AJTM           TD Drive Time
     C                     Z-ADD#1B7CD    A2B7CD           TD Drive Card N
     C                     Z-ADD#1D7NB    A2D7NB           TD Avg Live Wgt
     C                     MOVEL#1D9ST    A2D9ST           TD Gen Bal To K
     C                     MOVEL#1E3ST    A2E3ST           TD User Status
     C                     MOVEL#1E4ST    A2E4ST           TD User Status
     C                     MOVEL#1E5ST    A2E5ST           TD User Status
     C                     Z-ADD#1BVDT    A2BVDT           TD User Date 1
     C                     Z-ADD#1BWDT    A2BWDT           TD User Date 2
     C                     Z-ADD#1BXDT    A2BXDT           TD Drive Date
     C                     Z-ADD#1HVNB    A2HVNB           Pen Company Num
     C                     MOVEL#1CMCD    A2CMCD           Pen Number
     C                     MOVEL#1B9CD    A2B9CD           TDP Process Cod
     C                     Z-ADD#1H8NB    A2H8NB           Held Over Pen C
     C                     MOVEL#1CYCD    A2CYCD           Held Over Pen N
     C                     MOVEL#1AAVN    A2AAVN           RS User Changed
     C                     Z-ADD#1AADT    A2AADT           RS Date Changed
     C                     Z-ADD#1AMTM    A2AMTM           RS Time Changed
     C                     MOVEL#1AJST    A2AJST           RS Record Statu
     C                     MOVEL#1AHVN    A2AHVN           RS Job
     C                     MOVEL#1AGVN    A2AGVN           RS Program
     C                     MOVEL#1ABVN    A2ABVN           RS User Added
     C                     Z-ADD#1ABDT    A2ABDT           RS Date Added
     C                     Z-ADD#1ABTM    A2ABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YJRDCS
     C                     MOVE 'Y'       YJRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     A2AAVN           RS User Changed
     C                     Z-ADD##JDT     A2AADT           RS Date Changed
     C                     Z-ADD##JTM     A2AMTM           RS Time Changed
     C                     MOVEL##JOB     A2AHVN           RS Job
     C                     MOVEL##PGM     A2AGVN           RS Program
      * If held over head was changed but not to 0,
      * Set Held Over Status to 'Y' for Kill and Night processing routine
      * CASE: WRK.TD Held Over EQ WRK.Zero USR
     C           WUH7NB    IFEQ WUE9NB                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.TD Held Over NE WRK.Zero USR
     C           #1H7NB    IFNE WUE9NB                     *IF
     C                     MOVEL'Y'       A2GGST           TD Held Over St
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    A2GGST           TD Held Over St
     C                     Z-ADD*ZERO     A2H8NB           Held Over Pen C
     C                     END                             *FI
     C                     END                             *FI
      * If changed update record otherwise release record
     C           YJRDC     IFEQ 'Y'
     C                     UPDAT@A2CPDF                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA2CPL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
      * USER: Processing after Data update
      * Add the net change Yard dead and Held Over to the Tattoo Header
      * Rtv/Chg YrdDd,HldOvr  RT - Tattoo Header  * 
     C                     EXSR TGRVGN
     C                     END
      *================================================================
     CSR         TFEXIT    ENDSR
      /EJECT
     CSR         TGRVGN    BEGSR
      *================================================================
      * Rtv/Chg YrdDd,HldOvr  RT - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTG     KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Move fields to key list
     C                     Z-ADDA2HMNB    A1HMNB           BOH Company Num
     C                     Z-ADDA2BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADDA2BONB    A1BONB           BOL Load Number
     C                     Z-ADDA2CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADDA2B0DT    A1B0DT           TH Kill Date
     C           KRSTG     CHAIN@A1CPC4              90    *
      * Data record not found
     C   90                MOVEL'PRK0061' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C           A1FCNB    ADD  WUD8NB    WUFCNB           TH Yard Deads
     C           A1H9NB    ADD  WUH7NB    WUH9NB           TH Held Over
      * Change Tattoo Header - Tattoo Header  * 
     C                     EXSR THCHRC
     C                     END
      *================================================================
     CSR         TGEXIT    ENDSR
      /EJECT
     CSR         THCHRC    BEGSR
      *================================================================
      * Change Tattoo Header - Tattoo Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YKRDC   1
      *
      * Move key fields to @A1CPC5
     C                     Z-ADDA1HMNB    WDHMNB           BOH Company Num
     C                     Z-ADDA1BNNB    WDBNNB           BOH Buy Order N
     C                     Z-ADDA1BONB    WDBONB           BOL Load Number
     C                     Z-ADDA1CVNB    WDCVNB           TH Tattoo Numbe
     C                     Z-ADDA1B0DT    WDB0DT           TH Kill Date
      *
     C           KLCHTH    KLIST
     C                     KFLD           WDHMNB           BOH Company Num
     C                     KFLD           WDBNNB           BOH Buy Order N
     C                     KFLD           WDBONB           BOL Load Number
     C                     KFLD           WDCVNB           TH Tattoo Numbe
     C                     KFLD           WDB0DT           TH Kill Date
     C           KLCHTH    CHAIN@A1CPC5              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO THEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO THEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QPKA11    YKRDCS
      * Move non-key fields to @A1CPC5
     C                     Z-ADDA1AWDT    WDAWDT           TH Purchase Dat
     C                     MOVELA1BICD    WDBICD           TH Tattoo Refer
     C                     MOVELA1CPST    WDCPST           TH Live Purchas
     C                     Z-ADDA1ACPR    WDACPR           TH Live Purchas
     C                     MOVELA1C4ST    WDC4ST           TH Resale UOM
     C                     Z-ADDA1AIPR    WDAIPR           TH Resale Price
     C                     Z-ADDA1A6DT    WDA6DT           TH Resale Invoi
     C                     MOVELA1C2ST    WDC2ST           TH Resale Print
     C                     Z-ADDA1CXNB    WDCXNB           TH Dead On Arri
     C                     Z-ADDA1CWNB    WDCWNB           TH Head Receive
     C                     Z-ADDWUFCNB    WDFCNB           TH Yard Deads
     C                     Z-ADDWUH9NB    WDH9NB           TH Held Over
     C                     Z-ADDA1FDNB    WDFDNB           TH Head Condemn
     C                     Z-ADDA1FENB    WDFENB           TH Head Killed
     C                     Z-ADDA1HENB    WDHENB           TH Head Adds
     C                     Z-ADDA1HFNB    WDHFNB           TH Head Analyze
     C                     Z-ADDA1CYNB    WDCYNB           TH Live Wgt
     C                     Z-ADDA1E0NB    WDE0NB           TH Hot Wgt
     C                     Z-ADDA1A5PC    WDA5PC           TH Tot Loin Eye
     C                     Z-ADDA1FBNB    WDFBNB           TH Tot Backfat
     C                     Z-ADDA1A4PC    WDA4PC           TH Tot Light Re
     C                     Z-ADDA1F7NB    WDF7NB           TH Avg Live Wgt
     C                     Z-ADDA1HDNB    WDHDNB           TH Avg Hot Wgt
     C                     Z-ADDA1F5NB    WDF5NB           TH Avg Light Re
     C                     Z-ADDA1F4NB    WDF4NB           TH Avg Lean Per
     C                     Z-ADDA1F3NB    WDF3NB           TH Avg Loin Eye
     C                     Z-ADDA1F2NB    WDF2NB           TH Avg Backfat
     C                     Z-ADDA1AVPC    WDAVPC           TH Std Yield Pe
     C                     Z-ADDA1AWPC    WDAWPC           TH Actual Yield
     C                     Z-ADDA1A8PC    WDA8PC           TH Yield Differ
     C                     Z-ADDA1A7PC    WDA7PC           TH UnUsed Field
     C                     Z-ADDA1AMPR    WDAMPR           TH Base Mkt Pri
     C                     Z-ADDA1ANPR    WDANPR           TH Base Mkt Pri
     C                     Z-ADDA1AYVA    WDAYVA           TH Sort Discoun
     C                     Z-ADDA1AWVA    WDAWVA           TH Yield Gain/L
     C                     Z-ADDA1AOPR    WDAOPR           TH Base Carcass
     C                     Z-ADDA1AXVA    WDAXVA           TH Lean AddOn/D
     C                     Z-ADDA1APPR    WDAPPR           TH Gross Amt
     C                     Z-ADDA1ASPR    WDASPR           TH Deduction Am
     C                     Z-ADDA1A4VA    WDA4VA           TH Total Net WO
     C                     Z-ADDA1A5VA    WDA5VA           TH Additions Am
     C                     Z-ADDA1ATPR    WDATPR           TH Net Amt
     C                     Z-ADDA1A7VA    WDA7VA           TH Contract Adj
     C                     Z-ADDA1A2PR    WDA2PR           TH Actual Value
     C                     MOVELA1CWST    WDCWST           TH Payment Sts
     C                     MOVELA1D7ST    WDD7ST           TH Header Error
     C                     MOVELA1D8ST    WDD8ST           TH Detail Error
     C                     MOVELA1DWST    WDDWST           TH Kill Balanci
     C                     MOVELA1D6ST    WDD6ST           TH Bal to Kill
     C                     Z-ADDA1GHNB    WDGHNB           TH Check Number
     C                     Z-ADDA1BYDT    WDBYDT           TH Check Date
     C                     MOVELA1E0ST    WDE0ST           TH Unused Statu
     C                     MOVELA1E1ST    WDE1ST           TH Held Over Re
     C                     MOVELA1E2ST    WDE2ST           TH Sex
     C                     Z-ADDA1BSDT    WDBSDT           TH Unused Date
     C                     Z-ADDA1BTDT    WDBTDT           TH Unused Date
     C                     Z-ADDA1BUDT    WDBUDT           TH Unused Date
     C                     Z-ADDA1HGNB    WDHGNB           TH Unused Wgt 1
     C                     Z-ADDA1HHNB    WDHHNB           TH Unused Wgt 2
     C                     Z-ADDA1HINB    WDHINB           TH FFLI
     C                     Z-ADDA1A3PR    WDA3PR           TH Kill Product
     C                     Z-ADDA1A4PR    WDA4PR           TH Cut Product
     C                     Z-ADDA1A6PR    WDA6PR           TH Render Produ
     C                     Z-ADDA1J9NB    WDJ9NB           TH Head Deletes
     C                     MOVELA1AGCD    WDAGCD           GN Genetic Code
     C                     MOVELA1BECD    WDBECD           HC Class Code
     C                     MOVELA1BDCD    WDBDCD           DF Defect Code
     C                     MOVELA1CSCD    WDCSCD           THP Process Cod
     C                     MOVELA1ABCD    WDABCD           PD Producer Cod
     C                     MOVELA1AECD    WDAECD           PL Location Cod
     C                     MOVELA1ACCD    WDACCD           HB Buyer Code
     C                     MOVELA1AAVN    WDAAVN           RS User Changed
     C                     Z-ADDA1AADT    WDAADT           RS Date Changed
     C                     Z-ADDA1AMTM    WDAMTM           RS Time Changed
     C                     MOVELA1AJST    WDAJST           RS Record Statu
     C                     MOVELA1AHVN    WDAHVN           RS Job
     C                     MOVELA1AGVN    WDAGVN           RS Program
     C                     MOVELA1ABVN    WDABVN           RS User Added
     C                     Z-ADDA1ABDT    WDABDT           RS Date Added
     C                     Z-ADDA1ABTM    WDABTM           RS Time Added
      *
      * Set PGM.*Record Data Changed flag
     C           QPKA11    IFNE YKRDCS
     C                     MOVE 'Y'       YKRDC
     C                     END
      * USER: Processing before Data update
      * Rtv Change Stamp      IF
     C                     MOVEL##USR     WDAAVN           RS User Changed
     C                     Z-ADD##JDT     WDAADT           RS Date Changed
     C                     Z-ADD##JTM     WDAMTM           RS Time Changed
     C                     MOVEL##JOB     WDAHVN           RS Job
     C                     MOVEL##PGM     WDAGVN           RS Program
      * If changed update record otherwise release record
     C           YKRDC     IFEQ 'Y'
     C                     UPDAT@A1CPC5                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPKA1CPL1               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         THEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Tattoo Header
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C           YPMTFD    IFEQ '#1BNNB'
     C           ##RR      ANDEQYPMRRN
     C           YPMTFD    OREQ '#1BONB'
     C           ##RR      ANDEQYPMRRN
     C           YPMTFD    OREQ '#1CVNB'
     C           ##RR      ANDEQYPMRRN
     C           YPMTFD    OREQ '#1B0DT'
     C           ##RR      ANDEQYPMRRN
     W* Y2W0053 - One or more arguments defaulted to available contexts
      * Field '(RCD) #1HMNB' defaulted for 'BOH Company Number'.
      * Field '(RCD) #1BNNB' defaulted for 'BOH Buy Order Number'.
      * Field '(RCD) #1BONB' defaulted for 'BOL Load Number'.
      * Field '(RCD) #1CVNB' defaulted for 'TH Tattoo Number'.
      * Field '(RCD) #1B0DT' defaulted for 'TH Kill Date'.
     C                     CALL 'PKKQSRR'              90  Tst Sel Tattoo
     C                     PARM *BLANK    W0RTN   7
     C           #1HMNB    PARM #1HMNB    WQ0007  30       BOH Company Num
     C           #1BNNB    PARM #1BNNB    WQ0008  50       BOH Buy Order N
     C           #1BONB    PARM #1BONB    WQ0009  50       BOL Load Number
     C           #1CVNB    PARM #1CVNB    WQ0010  50       TH Tattoo Numbe
     C           #1B0DT    PARM #1B0DT    WQ0011  70       TH Kill Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PKKQSRR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      *
     C           #1BNNB    IFNE *ZERO                      BOH Buy Order N
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1BONB    IFNE *ZERO                      BOL Load Number
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1CVNB    IFNE *ZERO                      TH Tattoo Numbe
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      *
     C           #1B0DT    IFNE *ZERO                      TH Kill Date
     C           YPMTFD    ANDNE*BLANK
     C           W0RTN     ANDEQ*BLANK
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C           YPMTFD    ANDEQ*BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1HMNB    IFEQ *ZERO                      BOH Company Num
     C           #1BNNB    ANDEQ*ZERO                      BOH Buy Order N
     C           #1BONB    ANDEQ*ZERO                      BOL Load Number
     C           #1CVNB    ANDEQ*ZERO                      TH Tattoo Numbe
     C           #1B0DT    ANDEQ*ZERO                      TH Kill Date
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAA1    KLIST
     C                     KFLD           A1HMNB           BOH Company Num
     C                     KFLD           A1BNNB           BOH Buy Order N
     C                     KFLD           A1BONB           BOL Load Number
     C                     KFLD           A1CVNB           TH Tattoo Numbe
     C                     KFLD           A1B0DT           TH Kill Date
      * Setup key
     C                     Z-ADD#1HMNB    A1HMNB           BOH Company Num
     C                     Z-ADD#1BNNB    A1BNNB           BOH Buy Order N
     C                     Z-ADD#1BONB    A1BONB           BOL Load Number
     C                     Z-ADD#1CVNB    A1CVNB           TH Tattoo Numbe
     C                     Z-ADD#1B0DT    A1B0DT           TH Kill Date
     C           KLVAA1    CHAIN@A1CPC4              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Tattoo Header          NF'
     C                     MOVEL'PRK0061' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0061' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Pen
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1HVNB    IFEQ *ZERO                      Pen Company Num
     C           #1CMCD    ANDEQ*BLANK                     Pen Number
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBWC    KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Setup key
     C                     Z-ADD#1HVNB    WCHVNB           Pen Company Num
     C                     MOVEL#1CMCD    WCCMCD           Pen Number
     C           KLVBWC    CHAIN@A3REDD              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Pen                    NF'
     C                     MOVEL'PRK0065' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0065' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Tattoo Detail Process
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1B9CD    IFEQ *BLANK                     TDP Process Cod
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCBX    KLIST
     C                     KFLD           BXB9CD           TDP Process Cod
      * Setup key
     C                     MOVEL#1B9CD    BXB9CD           TDP Process Cod
     C           KLVCBX    CHAIN@BXREGA              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Tattoo Detail Process  NF'
     C                     MOVEL'PRK0128' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0128' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Pen
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1H8NB    IFEQ *ZERO                      Pen Company Num
     C           #1CYCD    ANDEQ*BLANK                     Pen Number
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDWC    KLIST
     C                     KFLD           WCHVNB           Pen Company Num
     C                     KFLD           WCCMCD           Pen Number
      * Setup key
     C                     Z-ADD#1H8NB    WCHVNB           Pen Company Num
     C                     MOVEL#1CYCD    WCCMCD           Pen Number
     C           KLVDWC    CHAIN@A3REDD              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
     C           YPMTFD    IFNE *BLANK
     C                     SETOF                     9091
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Pen                    NF'
     C                     MOVEL'PRK0065' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'PRK0065' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C           ZINPOS    IFGE 02560
     C           ZINPOS    ANDLE05376
      * Cursor in the subfile record area
      * Reset cursor position to the basic (first) record for lookup
     C           W0CRW     SUB  10        W0CSRR  50
     C           02560     ADD  W0CCL     ZINPOS
      * Calculate rrn of the cursor position
     C                     ADD  ##SFRC    W0CSRR
     C                     END
     C                     MOVE *BLANK    W0CFL
     C                     Z-ADD1         F       30
     C           ZINPOS    LOKUPW0END,F              96  96LE
     C           *IN96     IFEQ '1'
     C           ZINPOS    ANDGEW0BEG,F
     C                     MOVELW0NAM,F   W0CFL
     C                     END
     C           W0CFL     IFEQ *BLANK
     C                     Z-ADD0         W0CSRR
     C                     END
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      * Save sfl rrn at top of page
     C                     Z-ADD@#SFRC    Y#SFRC  40
      *
      * Initialise sfl workfields
     C                     Z-ADD010       ZHSTRW  40
     C                     Z-ADD020       ZHNDRW  40
     C                     Z-ADD001       ZHRLEN  40
     C                     Z-ADD*ZERO     ZHF4RW  40
     C                     Z-ADD*ZERO     ZHWK1#  40
      *
      * Resolve prompt row number on sfl
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
     C                     Z-ADDZHWK1#    YZSFDL  40
     C           ZHWK1#    MULT ZHRLEN    ZHWK1#
     C           ZHCSRW    SUB  ZHWK1#    ZHF4RW
      *
     C           YPMRRN    IFGT *ZERO
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
     C                     END
     C                     END
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
      * Save first changed  rrn
     C           ZHCSRW    IFGE ZHSTRW
     C           ZHCSRW    ANDLEZHNDRW
     C           YPMTFD    ANDNE'*NONE'
      *
     C           ##RR      IFNE *ZERO
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'
     C                     Z-ADD##RR      YAFSCH
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     END
     C                     END
      *
      * Calculate rrn for prompt slf record
     C           ZHCSRW    SUB  ZHSTRW    ZHWK1#
     C           ZHWK1#    DIV  ZHRLEN    ZHWK1#
     C           ZHWK1#    ADD  Y#SFRC    YPMRRN
      *
      * Chain to sfl record
     C           YPMRRN    CHAIN#SFLRCD              92    *
     C           *IN92     IFEQ '0'
     C                     SETON                     84    *
     C                     UPDAT#SFLRCD
     C                     ELSE
     C                     Z-ADD*ZERO     YPMRRN
     C                     END
      *
      * Test first changed rrn/prompt rrn
     C           YAFSCH    IFEQ *ZERO
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
      * If prompt rrn < first changed rrn
     C           YPMRRN    IFNE *ZERO
     C           YPMRRN    ANDLTYAFSCH
     C                     Z-ADDYPMRRN    YAFSCH
     C                     END
      *
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM 'PKGJEFRH'W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*CSRLOC' YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2CXNB           TH Dead On Arri
     C                     Z-ADD*ZERO     P2CWNB           TH Head Receive
     C                     Z-ADD*ZERO     P2FCNB           TH Yard Deads
      *
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN PKMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Zero USR
     C                     Z-ADD*ZERO     WUE9NB  10
      * Define work field Blank USR
     C                     MOVEL*BLANK    WUCRTX 80
      * Define work field HC Description
     C                     MOVEL*BLANK    WUBDTX 25
      * Define work field HC Defect Required
     C                     MOVEL*BLANK    WUBXST  1
      * Define work field HC Price Required
     C                     MOVEL*BLANK    WUBYST  1
      * Define work field HC Resolution
     C                     MOVEL*BLANK    WUBITX 60
      * Define work field HC Qualification
     C                     MOVEL*BLANK    WUB0ST  1
      * Define work field HC Class Type
     C                     MOVEL*BLANK    WUFBST  1
      * Define work field TH Purchase Date
     C                     Z-ADD*ZERO     WUAWDT  70
      * Define work field TH Tattoo Reference
     C                     MOVEL*BLANK    WUBICD 10
      * Define work field TH Live Purchase UOM
     C                     MOVEL*BLANK    WUCPST  2
      * Define work field TH Live Purchase Price
     C                     Z-ADD*ZERO     WUACPR  52
      * Define work field TH Resale UOM
     C                     MOVEL*BLANK    WUC4ST  2
      * Define work field TH Resale Price
     C                     Z-ADD*ZERO     WUAIPR  52
      * Define work field TH Resale Invoice Date
     C                     Z-ADD*ZERO     WUA6DT  70
      * Define work field TH Resale Print Sts
     C                     MOVEL*BLANK    WUC2ST  1
      * Define work field TH Dead On Arrival
     C                     Z-ADD*ZERO     WUCXNB  50
      * Define work field TH Head Received
     C                     Z-ADD*ZERO     WUCWNB  50
      * Define work field TH Yard Deads
     C                     Z-ADD*ZERO     WUFCNB  50
      * Define work field TH Held Over
     C                     Z-ADD*ZERO     WUH9NB  50
      * Define work field TH Head Condemned
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field TH Head Killed
     C                     Z-ADD*ZERO     WUFENB  50
      * Define work field TH Head Adds
     C                     Z-ADD*ZERO     WUHENB  50
      * Define work field TH Head Analyzed
     C                     Z-ADD*ZERO     WUHFNB  50
      * Define work field TH Live Wgt
     C                     Z-ADD*ZERO     WUCYNB  71
      * Define work field TH Hot Wgt
     C                     Z-ADD*ZERO     WUE0NB  71
      * Define work field TH Tot Loin Eye Depth
     C                     Z-ADD*ZERO     WUA5PC  61
      * Define work field TH Tot Backfat Inches
     C                     Z-ADD*ZERO     WUFBNB  61
      * Define work field TH Tot Light Reflectance
     C                     Z-ADD*ZERO     WUA4PC  61
      * Define work field TH Avg Live Wgt
     C                     Z-ADD*ZERO     WUF7NB  51
      * Define work field TH Avg Hot Wgt
     C                     Z-ADD*ZERO     WUHDNB  51
      * Define work field TH Avg Light Reflectance
     C                     Z-ADD*ZERO     WUF5NB  31
      * Define work field TH Avg Lean Percent
     C                     Z-ADD*ZERO     WUF4NB  31
      * Define work field TH Avg Loin Eye Depth
     C                     Z-ADD*ZERO     WUF3NB  31
      * Define work field TH Avg Backfat
     C                     Z-ADD*ZERO     WUF2NB  31
      * Define work field TH Std Yield Percent
     C                     Z-ADD*ZERO     WUAVPC  52
      * Define work field TH Actual Yield Percent
     C                     Z-ADD*ZERO     WUAWPC  52
      * Define work field TH Yield Difference
     C                     Z-ADD*ZERO     WUA8PC  52
      * Define work field TH UnUsed Field
     C                     Z-ADD*ZERO     WUA7PC  31
      * Define work field TH Base Mkt Price
     C                     Z-ADD*ZERO     WUAMPR  52
      * Define work field TH Base Mkt Price Amt
     C                     Z-ADD*ZERO     WUANPR  72
      * Define work field TH Sort Discount Amt
     C                     Z-ADD*ZERO     WUAYVA  72
      * Define work field TH Yield Gain/Loss Amt
     C                     Z-ADD*ZERO     WUAWVA  72
      * Define work field TH Base Carcass Value
     C                     Z-ADD*ZERO     WUAOPR  72
      * Define work field TH Lean AddOn/Deduct Amt
     C                     Z-ADD*ZERO     WUAXVA  72
      * Define work field TH Gross Amt
     C                     Z-ADD*ZERO     WUAPPR  72
      * Define work field TH Deduction Amt
     C                     Z-ADD*ZERO     WUASPR  72
      * Define work field TH Total Net WO Adds
     C                     Z-ADD*ZERO     WUA4VA  72
      * Define work field TH Additions Amt
     C                     Z-ADD*ZERO     WUA5VA  72
      * Define work field TH Net Amt
     C                     Z-ADD*ZERO     WUATPR  72
      * Define work field TH Contract Adjustment
     C                     Z-ADD*ZERO     WUA7VA  72
      * Define work field TH Actual Value Adjusted
     C                     Z-ADD*ZERO     WUA2PR  72
      * Define work field TH Payment Sts
     C                     MOVEL*BLANK    WUCWST  2
      * Define work field TH Header Error Sts
     C                     MOVEL*BLANK    WUD7ST  1
      * Define work field TH Detail Error Sts
     C                     MOVEL*BLANK    WUD8ST  1
      * Define work field TH Kill Balancing Sts
     C                     MOVEL*BLANK    WUDWST  1
      * Define work field TH Bal to Kill Gen
     C                     MOVEL*BLANK    WUD6ST  1
      * Define work field TH Check Number
     C                     Z-ADD*ZERO     WUGHNB  80
      * Define work field TH Check Date
     C                     Z-ADD*ZERO     WUBYDT  70
      * Define work field TH Unused Status 1
     C                     MOVEL*BLANK    WUE0ST  1
      * Define work field TH Held Over Record
     C                     MOVEL*BLANK    WUE1ST  1
      * Define work field TH Sex
     C                     MOVEL*BLANK    WUE2ST  1
      * Define work field TH Unused Date 1
     C                     Z-ADD*ZERO     WUBSDT  70
      * Define work field TH Unused Date 2
     C                     Z-ADD*ZERO     WUBTDT  70
      * Define work field TH Unused Date 3
     C                     Z-ADD*ZERO     WUBUDT  70
      * Define work field TH Unused Wgt 1
     C                     Z-ADD*ZERO     WUHGNB  71
      * Define work field TH Unused Wgt 2
     C                     Z-ADD*ZERO     WUHHNB  71
      * Define work field TH FFLI
     C                     Z-ADD*ZERO     WUHINB  31
      * Define work field TH Kill Product Value
     C                     Z-ADD*ZERO     WUA3PR  72
      * Define work field TH Cut Product Value
     C                     Z-ADD*ZERO     WUA4PR  72
      * Define work field TH Render Product Value
     C                     Z-ADD*ZERO     WUA6PR  72
      * Define work field GN Genetic Code
     C                     MOVEL*BLANK    WUAGCD  5
      * Define work field HC Class Code
     C                     MOVEL*BLANK    WUBECD  3
      * Define work field DF Defect Code
     C                     MOVEL*BLANK    WUBDCD  6
      * Define work field THP Process Code
     C                     MOVEL*BLANK    WUCSCD  6
      * Define work field PD Producer Code
     C                     MOVEL*BLANK    WUABCD  6
      * Define work field PL Location Code
     C                     MOVEL*BLANK    WUAECD  6
      * Define work field HB Buyer Code
     C                     MOVEL*BLANK    WUACCD  3
      * Define work field TD Live Wgt
     C                     Z-ADD*ZERO     WUCZNB  71
      * Define work field Pen Description
     C                     MOVEL*BLANK    WUBBTX 25
      * Define work field Pen Current Head
     C                     Z-ADD*ZERO     WUD6NB  50
      * Define work field TD Yard Dead
     C                     Z-ADD*ZERO     WUD8NB  50
      * Define work field TD Held Over
     C                     Z-ADD*ZERO     WUH7NB  50
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0WD01 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0WD   177       *Synon (17,7) w
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     MOVEL'Y'       W0PMT   1
      * *DTAARA = *COMPANY N
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      *................................................................
      *
     C                     Z-ADD11        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Mov ApplN to Company  US - STR User Source Functions  * 
     C***   MOVE USER SOURCE                      ***
     C                     MOVELP3EVTX    ##CMP
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
**
01041012970256502572025790258702592
0260102609026140262302632
**
01043012990256902576025830258902596
0260502611026200262802634
**
#2B7CD    #2CMCD    #1CVNB    #1C0NB    #1D8NB    #1CYCD    #1H7NB
#RGENB    #RCBCD    #RB5NB    #RCTCD    #RBECD
