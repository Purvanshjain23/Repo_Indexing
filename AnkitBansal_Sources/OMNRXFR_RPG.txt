     H/TITLE RTV Build Sls & Accls  XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/22/10  Time  : 17:03:27
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOMHSTPL1IF  E           K        DISK
      * RTV : Sales History             Retrieval index
      *
     FOMCRWKL1IF  E           K        DISK
      * RTV : Order Detail Fin          Retrieval index
      *
     FOMHRCPL1IF  E           K        DISK
      * RTV : Shipping Dtl Accrual      Retrieval index
      *
     FOMHLREL1IF  E           K        DISK
      * RTV : Accrual Program           Retrieval index
      *
     FOMHSCPL0IF  E           K        DISK                      A
      * UPD : WF Accrual History        Update index
      *
     I@FHSTD3
      * Sales History             Retrieval index
      * Renamed input format fields
     I              F4AIC3                          WAAIC3
     I              F4C4NB                          WAC4NB
     I              F4DPNB                          WADPNB
     I              F4UENB                          WAUENB
     I              F4MONA                          WAMONA
     I              F4RJCD                          WARJCD
     I              F4RKCD                          WARKCD
     I              F4GPTX                          WAGPTX
     I              F4ABTX                          WAABTX
     I              F4KXCD                          WAKXCD
     I              F4BOCD                          WABOCD
     I              F4BTC7                          WABTC7
     I              F4ANC7                          WAANC7
     I              F4AQTX                          WAAQTX
     I              F4BKC7                          WABKC7
     I              F4BRTX                          WABRTX
     I              F4HNNA                          WAHNNA
     I              F4DBCD                          WADBCD
     I              F4CKTX                          WACKTX
     I              F4BCNA                          WABCNA
     I              F4A0DT                          WAA0DT
     I              F4ACDT                          WAACDT
     I              F4R4CD                          WAR4CD
     I              F4R5CD                          WAR5CD
     I              F4BFCD                          WABFCD
     I              F4Q4CD                          WAQ4CD
     I              F4AQCD                          WAAQCD
     I              F4TBNB                          WATBNB
     I              F4BZNA                          WABZNA
     I              F4RLCD                          WARLCD
     I              F4JNCD                          WAJNCD
     I              F4Q2CD                          WAQ2CD
     I              F4U2ST                          WAU2ST
     I              F4ATIN                          WAATIN
     I              F4T3NB                          WAT3NB
     I              F4RSRN                          WARSRN
     I              F4ORIT                          WAORIT
     I              F4AJCD                          WAAJCD
     I              F4AVQT                          WAAVQT
     I              F4D0WG                          WAD0WG
     I              F4CCQT                          WACCQT
     I              F4AUWG                          WAAUWG
     I              F4AGCD                          WAAGCD
     I              F4AKPR                          WAAKPR
     I              F4AUPR                          WAAUPR
     I              F4CRCD                          WACRCD
     I              F4A5DT                          WAA5DT
     I              F4AWDT                          WAAWDT
     I              F4HDDT                          WAHDDT
     I              F4AGCS                          WAAGCS
     I              F4AQCS                          WAAQCS
     I              F4AVWG                          WAAVWG
     I              F4AYVA                          WAAYVA
     I              F4AMST                          WAAMST
     I              F4ANST                          WAANST
     I              F4VAST                          WAVAST
     I              F4L6NB                          WAL6NB
     I              F4UMCD                          WAUMCD
     I              F4HCDT                          WAHCDT
     I              F4ESNB                          WAESNB
     I              F4ETNB                          WAETNB
     I              F4BZNB                          WABZNB
     I              F4EXQT                          WAEXQT
     I              F4BYWG                          WABYWG
     I              F4S5NB                          WAS5NB
     I              F4MAVA                          WAMAVA
     I              F4KDVA                          WAKDVA
     I              F4USVA                          WAUSVA
     I              F4UTVA                          WAUTVA
     I              F4A4WG                          WAA4WG
     I              F4CKNB                          WACKNB
     I              F4BMST                          WABMST
     I              F4R8NB                          WAR8NB
     I              F4RMCD                          WARMCD
     I              F4BZPR                          WABZPR
     I              F4RDCD                          WARDCD
     I              F4Q7CD                          WAQ7CD
     I              F4EXDT                          WAEXDT
     I              F4LQCD                          WALQCD
     I              F4HICD                          WAHICD
     I              F4RBCD                          WARBCD
     I              F4RGNB                          WARGNB
     I              F4RHNB                          WARHNB
     I              F4RINB                          WARINB
     I              F4R1NB                          WAR1NB
     I              F4CONB                          WACONB
     I              F4CEST                          WACEST
     I              F4GNDT                          WAGNDT
     I              F4RMNB                          WARMNB
     I              F4AODT                          WAAODT
     I              F4LLCD                          WALLCD
     I              F4LMCD                          WALMCD
     I              F4SKNB                          WASKNB
     I              F4SLNB                          WASLNB
     I              F4SMNB                          WASMNB
     I              F4G7NA                          WAG7NA
     I              F4ONVA                          WAONVA
     I              F4N0CD                          WAN0CD
     I              F4B4NB                          WAB4NB
     I              F4B5NB                          WAB5NB
     I              F4N1CD                          WAN1CD
     I              F4GIDT                          WAGIDT
     I              F4Z1ST                          WAZ1ST
     I              F4ULVA                          WAULVA
     I              F4UNVA                          WAUNVA
     I              F4UOVA                          WAUOVA
     I              F4UPVA                          WAUPVA
     I              F4UQVA                          WAUQVA
     I              F4SDCD                          WASDCD
     I              F4QZCD                          WAQZCD
     I              F4XWST                          WAXWST
     I              F4T9CD                          WAT9CD
     I              F4UBCD                          WAUBCD
     I              F4CFC7                          WACFC7
     I              F4X1CD                          WAX1CD
     I              F4GASX                          WAGASX
     I              F4DUPR                          WADUPR
     I              F4B6VL                          WAB6VL
     I              F4IANX                          WAIANX
     I              F4IBNX                          WAIBNX
     I              F4RPCD                          WARPCD
     I              F4NYDT                          WANYDT
     I              F4BZTM                          WABZTM
     I              F4Z4NB                          WAZ4NB
     I              F4XACD                          WAXACD
     I              F4OANA                          WAOANA
     I              F4OKTX                          WAOKTX
     I              F4K4TX                          WAK4TX
     I              F4NBBO                          WANBBO
     I              F4OCFR                          WAOCFR
     I              F4C0C7                          WAC0C7
     I              F4A1AA                          WAA1AA
     I              F4VEST                          WAVEST
     I              F4A5PR                          WAA5PR
     I              F4CDPR                          WACDPR
     I              F4D0PR                          WAD0PR
     I              F4D0VL                          WAD0VL
     I              F4IRSX                          WAIRSX
     I              F4CEVL                          WACEVL
     I              F4ISSX                          WAISSX
     I              F4ITSX                          WAITSX
     I              F4IUSX                          WAIUSX
     I              F4OHDT                          WAOHDT
     I              F4D9PR                          WAD9PR
     I              F4CFVL                          WACFVL
     I              F4UVST                          WAUVST
     I              F4UWST                          WAUWST
     I              F4UXST                          WAUXST
     I              F4AATM                          WAAATM
     I              F4AYNA                          WAAYNA
     I              F4A0NA                          WAA0NA
     I              F4AXDT                          WAAXDT
      *
     I@HSCPL4
      * WF Accrual History        Update index
      * Renamed input format fields
     I              HSAIC3                          WBAIC3
     I              HSC4NB                          WBC4NB
     I              HSDXNB                          WBDXNB
     I              HSOJCD                          WBOJCD
     I              HSBKPR                          WBBKPR
     I              HSR4CD                          WBR4CD
     I              HSBKC7                          WBBKC7
     I              HSS5NB                          WBS5NB
     I              HSAWDT                          WBAWDT
     I              HSQ7NB                          WBQ7NB
     I              HSOMST                          WBOMST
     I              HSEXQT                          WBEXQT
     I              HSBYWG                          WBBYWG
     I              HSL8VA                          WBL8VA
     I              HSRGNB                          WBRGNB
     I              HSRHNB                          WBRHNB
     I              HSRINB                          WBRINB
     I              HSBMNA                          WBBMNA
     I              HSOOVA                          WBOOVA
     I              HSOPVA                          WBOPVA
     I              HSOQVA                          WBOQVA
      *
     I@CRWKL1
      * Order Detail Fin          Retrieval index
      * Renamed input format fields
     I              N1AIC3                          WCAIC3
     I              N1C4NB                          WCC4NB
     I              N1DPNB                          WCDPNB
     I              N1UENB                          WCUENB
     I              N1DXNB                          WCDXNB
     I              N1G4ST                          WCG4ST
     I              N1BSVA                          WCBSVA
     I              N1G5NA                          WCG5NA
     I              N1DQCD                          WCDQCD
     I              N1DRCD                          WCDRCD
     I              N1AVNB                          WCAVNB
     I              N1DSCD                          WCDSCD
     I              N1GFST                          WCGFST
     I              N1SANB                          WCSANB
     I              N1OJCD                          WCOJCD
     I              N1UVCD                          WCUVCD
     I              N1CKNB                          WCCKNB
     I              N1BMST                          WCBMST
     I              N1UVST                          WCUVST
     I              N1UWST                          WCUWST
     I              N1UXST                          WCUXST
     I              N1AATM                          WCAATM
     I              N1AYNA                          WCAYNA
     I              N1A0NA                          WCA0NA
     I              N1AXDT                          WCAXDT
      *
     I@HRCPLM
      * Shipping Dtl Accrual      Retrieval index
      * Renamed input format fields
     I              HRAIC3                          WDAIC3
     I              HRC4NB                          WDC4NB
     I              HRDPNB                          WDDPNB
     I              HRUENB                          WDUENB
     I              HRDXNB                          WDDXNB
     I              HRBKPR                          WDBKPR
     I              HRC5PC                          WDC5PC
     I              HRAYVA                          WDAYVA
     I              HREDVL                          WDEDVL
     I              HRHGCD                          WDHGCD
     I              HRBKC7                          WDBKC7
     I              HRDUC7                          WDDUC7
     I              HRHHAA                          WDHHAA
     I              HRPODT                          WDPODT
     I              HRBYWG                          WDBYWG
     I              HRBVST                          WDBVST
     I              HRP7SX                          WDP7SX
     I              HROKCD                          WDOKCD
     I              HRP8SX                          WDP8SX
     I              HRP9SX                          WDP9SX
     I              HRQASX                          WDQASX
     I              HRQBSX                          WDQBSX
     I              HRPPDT                          WDPPDT
     I              HRPQDT                          WDPQDT
     I              HREEVL                          WDEEVL
     I              HREFVL                          WDEFVL
     I              HRFITX                          WDFITX
     I              HRFJTX                          WDFJTX
     I              HRQ8DT                          WDQ8DT
     I              HRFKTX                          WDFKTX
     I              HRH0NY                          WDH0NY
     I              HRKQT1                          WDKQT1
     I              HRKTT1                          WDKTT1
     I              HRHIAA                          WDHIAA
     I              HRHLAA                          WDHLAA
     I              HROJCD                          WDOJCD
     I              HRAVNB                          WDAVNB
     I              HRDSCD                          WDDSCD
     I              HRUVST                          WDUVST
     I              HRUWST                          WDUWST
     I              HRUXST                          WDUXST
     I              HRAATM                          WDAATM
     I              HRAYNA                          WDAYNA
     I              HRA0NA                          WDA0NA
     I              HRAXDT                          WDAXDT
      *
     I@HLREK4
      * Accrual Program           Retrieval index
      * Renamed input format fields
     I              HLOJCD                          WEOJCD
     I              HLLENA                          WELENA
     I              HLTOST                          WETOST
     I              HLTQST                          WETQST
     I              HLTRST                          WETRST
     I              HLTSST                          WETSST
     I              HLOKCD                          WEOKCD
     I              HLTYST                          WETYST
     I              HLOQCD                          WEOQCD
     I              HLHHCD                          WEHHCD
     I              HLI2TX                          WEI2TX
     I              HLJFTX                          WEJFTX
     I              HLI3TX                          WEI3TX
     I              HLJGTX                          WEJGTX
     I              HLLEDG                          WELEDG
     I              HLTTST                          WETTST
     I              HLBKPR                          WEBKPR
     I              HLSHSX                          WESHSX
     I              HLQFSX                          WEQFSX
     I              HLFDTX                          WEFDTX
     I              HLFETX                          WEFETX
     I              HLFFTX                          WEFFTX
     I              HLFGTX                          WEFGTX
     I              HLHQVL                          WEHQVL
     I              HLFHTX                          WEFHTX
     I              HLUVST                          WEUVST
     I              HLUWST                          WEUWST
     I              HLUXST                          WEUXST
     I              HLVSST                          WEVSST
     I              HLAATM                          WEAATM
     I              HLAYNA                          WEAYNA
     I              HLA0NA                          WEA0NA
     I              HLAXDT                          WEAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQOMHS1    E DSOMHSCPL0
      * UPD : WF Accrual History        Update index
      * Renamed input format fields
     I              HSAIC3                          WBAIC3
     I              HSC4NB                          WBC4NB
     I              HSDXNB                          WBDXNB
     I              HSOJCD                          WBOJCD
     I              HSBKPR                          WBBKPR
     I              HSR4CD                          WBR4CD
     I              HSBKC7                          WBBKC7
     I              HSS5NB                          WBS5NB
     I              HSAWDT                          WBAWDT
     I              HSQ7NB                          WBQ7NB
     I              HSOMST                          WBOMST
     I              HSEXQT                          WBEXQT
     I              HSBYWG                          WBBYWG
     I              HSL8VA                          WBL8VA
     I              HSRGNB                          WBRGNB
     I              HSRHNB                          WBRHNB
     I              HSRINB                          WBRINB
     I              HSBMNA                          WBBMNA
     I              HSOOVA                          WBOOVA
     I              HSOPVA                          WBOPVA
     I              HSOQVA                          WBOQVA
      *
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * RTV Build Sls & Accls  XF
      * RTV Build Sls & Accrls RT - Sales History  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Build Sls & Accrls RT - Sales History  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@FHSTD3                    *
     C                     READ @FHSTD3                  90*
      * Data record not found
     C   90                MOVEL'USR1241' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * For each new order#, set the seq.# to zero, then increment by 1.
      * CASE: DB1.Order Number NE WRK.Order Number
     C           WAC4NB    IFNE WUC4NB                     *IF
     C                     Z-ADD*ZERO     WUQQNB           USR Sequence Nu
     C                     Z-ADDWAC4NB    WUC4NB           Order Number
     C                     END                             *FI
     C                     ADD  1         WUQQNB           USR Sequence Nu
     C                     Z-ADDWATBNB    WUOOVA           Extra Amount 1
      * CRT OM Accrual History CR - Accrual History Work  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWAAIC3    WL0001           Company Number
     C                     Z-ADDWAC4NB    WL0002           Order Number
     C                     Z-ADDWUQQNB    WL0003           Sequence Number
     C                     MOVEL*BLANK    WL0004           Accrual Code
     C                     Z-ADD*ZERO     WL0005           Accrual Rate
     C                     MOVELWAR4CD    WL0006    P      Sales Route Cod
     C                     Z-ADDWABKC7    WL0007           Ship To Custome
     C                     Z-ADDWAS5NB    WL0008           Shipped Item Co
     C                     Z-ADDWAAWDT    WL0009           Invoice Date
     C                     Z-ADDWACONB    WL0010           Invoice/Memo Nu
     C                     MOVELWACEST    WL0011    P      Invoice/Memo Su
     C                     Z-ADDWAEXQT    WL0012           Quantity Billed
     C                     Z-ADDWABYWG    WL0013           Weight Billed
     C                     Z-ADDWAUSVA    WL0014           Billing Detail
     C                     Z-ADDWARGNB    WL0015           Item Structure
     C                     Z-ADDWARHNB    WL0016           Item Structure
     C                     Z-ADDWARINB    WL0017           Item Structure
     C                     MOVELWAR4CD    WL0018    P      Route Code
     C                     Z-ADDWUOOVA    WL0019           Extra Amount 1
     C                     Z-ADD*ZERO     WL0020           Extra Amount 2
     C                     Z-ADD*ZERO     WL0021           Extra Amount 3
     C                     EXSR SBCRRC
      * RTV Accrl/ Sls & Accrl RT - Order Detail Fin  * 
     C                     EXSR SCRVGN
      * RTV Accrl/Sls & Accrl  RT - Shipping Dtl Accrual  * 
     C                     EXSR SDRVGN
     C                     READ @FHSTD3                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * CRT OM Accrual History CR - Accrual History Work  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @HSCPL4
     C                     Z-ADDWL0001    WBAIC3           Company Number
     C                     Z-ADDWL0002    WBC4NB           Order Number
     C                     Z-ADDWL0003    WBDXNB           Sequence Number
     C                     MOVELWL0004    WBOJCD           Accrual Code
     C                     Z-ADDWL0005    WBBKPR           Accrual Rate
     C                     MOVELWL0006    WBR4CD           Sales Route Cod
     C                     Z-ADDWL0007    WBBKC7           Ship To Custome
     C                     Z-ADDWL0008    WBS5NB           Shipped Item Co
     C                     Z-ADDWL0009    WBAWDT           Invoice Date
     C                     Z-ADDWL0010    WBQ7NB           Invoice/Memo Nu
     C                     MOVELWL0011    WBOMST           Invoice/Memo Su
     C                     Z-ADDWL0012    WBEXQT           Quantity Billed
     C                     Z-ADDWL0013    WBBYWG           Weight Billed
     C                     Z-ADDWL0014    WBL8VA           Billing Detail
     C                     Z-ADDWL0015    WBRGNB           Item Structure
     C                     Z-ADDWL0016    WBRHNB           Item Structure
     C                     Z-ADDWL0017    WBRINB           Item Structure
     C                     MOVELWL0018    WBBMNA           Route Code
     C                     Z-ADDWL0019    WBOOVA           Extra Amount 1
     C                     Z-ADDWL0020    WBOPVA           Extra Amount 2
     C                     Z-ADDWL0021    WBOQVA           Extra Amount 3
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBC4NB           Order Number
     C                     KFLD           WBDXNB           Sequence Number
      * Check for duplicate primary key
     C           KLCRSB    SETLL@HSCPL4                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1558' W0RTN   7
      * Send message 'WF Accrual History     EX'
     C                     MOVEL'USR1558' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@HSCPL4                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * RTV Accrl/ Sls & Accrl RT - Order Detail Fin  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCAIC3    WQSC01           Company Number
     C           *LIKE     DEFN WCC4NB    WQSC02           Order Number
     C           *LIKE     DEFN WCDPNB    WQSC03           Order Sequence
     C           *LIKE     DEFN WCUENB    WQSC04           Order Secondary
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Company Number
     C                     KFLD           WQSC02           Order Number
     C                     KFLD           WQSC03           Order Sequence
     C                     KFLD           WQSC04           Order Secondary
      * Setup key
     C                     Z-ADDWAAIC3    WQSC01           Company Number
     C                     Z-ADDWAC4NB    WQSC02           Order Number
     C                     Z-ADDWADPNB    WQSC03           Order Sequence
     C                     Z-ADDWAUENB    WQSC04           Order Secondary
      * Establish starting position
     C           KRSSC     SETLL@CRWKL1                    *
     C           KRSSC     READE@CRWKL1                  90*
      * Data record not found
     C   90                MOVEL'USR1317' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Financial Type is Accrual Charge
     C           WCG4ST    IFEQ 'A'                        *IF
     C                     ADD  1         WUQQNB           USR Sequence Nu
      * CRT OM Accrual History CR - Accrual History Work  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWCAIC3    WL0001           Company Number
     C                     Z-ADDWCC4NB    WL0002           Order Number
     C                     Z-ADDWUQQNB    WL0003           Sequence Number
     C                     MOVELWCOJCD    WL0004    P      Accrual Code
     C                     Z-ADDWCSANB    WL0005           Accrual Rate
     C                     MOVELWAR4CD    WL0006    P      Sales Route Cod
     C                     Z-ADDWABKC7    WL0007           Ship To Custome
     C                     Z-ADDWAS5NB    WL0008           Shipped Item Co
     C                     Z-ADDWAGNDT    WL0009           Invoice Date
     C                     Z-ADDWACONB    WL0010           Invoice/Memo Nu
     C                     MOVELWACEST    WL0011    P      Invoice/Memo Su
     C                     Z-ADDWAEXQT    WL0012           Quantity Billed
     C                     Z-ADDWABYWG    WL0013           Weight Billed
     C                     Z-ADDWCBSVA    WL0014           Billing Detail
     C                     Z-ADDWARGNB    WL0015           Item Structure
     C                     Z-ADDWARHNB    WL0016           Item Structure
     C                     Z-ADDWARINB    WL0017           Item Structure
     C                     MOVELWAR4CD    WL0018    P      Route Code
     C                     Z-ADD*ZERO     WL0019           Extra Amount 1
     C                     Z-ADDWCDPNB    WL0020           Extra Amount 2
     C                     Z-ADDWCUENB    WL0021           Extra Amount 3
     C                     EXSR SBCRRC
     C                     END                             *FI
     C           KRSSC     READE@CRWKL1                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * RTV Accrl/Sls & Accrl  RT - Shipping Dtl Accrual  * 
      *================================================================
      *
     C                     MOVEL*BLANK    WN0001 30        Accrual Descrip
     C                     MOVEL*BLANK    WN0002  1        Automatic Accru
     C                     MOVEL*BLANK    WN0003  1        Print On Invoic
     C                     MOVEL*BLANK    WN0004  1        Rate Usage
     C                     MOVEL*BLANK    WN0005  1        Add-on/Allowanc
     C                     MOVEL*BLANK    WN0006  2        Accrual Type
     C                     MOVEL*BLANK    WN0007  2        Sub Ledger Code
     C                     MOVEL*BLANK    WN0008  3        Reverse Accrual
     C                     MOVEL*BLANK    WN0009  2        U/M - Primary D
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WDAIC3    WQSD01           Company Number
     C           *LIKE     DEFN WDC4NB    WQSD02           Order Number
     C           *LIKE     DEFN WDDPNB    WQSD03           Order Sequence
     C           *LIKE     DEFN WDUENB    WQSD04           Order Secondary
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Company Number
     C                     KFLD           WQSD02           Order Number
     C                     KFLD           WQSD03           Order Sequence
     C                     KFLD           WQSD04           Order Secondary
      * Setup key
     C                     Z-ADDWAAIC3    WQSD01           Company Number
     C                     Z-ADDWAC4NB    WQSD02           Order Number
     C                     Z-ADDWADPNB    WQSD03           Order Sequence
     C                     Z-ADDWAUENB    WQSD04           Order Secondary
      * Establish starting position
     C           KRSSD     SETLL@HRCPLM                    *
     C           KRSSD     READE@HRCPLM                  90*
      * Data record not found
     C   90                MOVEL'USR1526' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * RTV All Values         RT - Accrual Code Master  * 
     C                     EXSR SERVGN
      * CASE: PAR.Automatic Accrual (Y/N) is Yes
     C           WN0002    IFEQ 'Y'                        *IF
     C                     ADD  1         WUQQNB           USR Sequence Nu
      * CRT OM Accrual History CR - WF Accrual History  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDWDAIC3    WL0001           Company Number
     C                     Z-ADDWDC4NB    WL0002           Order Number
     C                     Z-ADDWUQQNB    WL0003           Sequence Number
     C                     MOVELWDOJCD    WL0004    P      Accrual Code
     C                     Z-ADDWDBKPR    WL0005           Accrual Rate
     C                     MOVELWAR4CD    WL0006    P      Sales Route Cod
     C                     Z-ADDWABKC7    WL0007           Ship To Custome
     C                     Z-ADDWAS5NB    WL0008           Shipped Item Co
     C                     Z-ADDWAGNDT    WL0009           Invoice Date
     C                     Z-ADDWACONB    WL0010           Invoice/Memo Nu
     C                     MOVELWACEST    WL0011    P      Invoice/Memo Su
     C                     Z-ADDWAEXQT    WL0012           Quantity Billed
     C                     Z-ADDWABYWG    WL0013           Weight Billed
     C                     Z-ADDWDAYVA    WL0014           Billing Detail
     C                     Z-ADDWARGNB    WL0015           Item Structure
     C                     Z-ADDWARHNB    WL0016           Item Structure
     C                     Z-ADDWARINB    WL0017           Item Structure
     C                     MOVELWAR4CD    WL0018    P      Route Code
     C                     Z-ADD*ZERO     WL0019           Extra Amount 1
     C                     Z-ADD*ZERO     WL0020           Extra Amount 2
     C                     Z-ADD*ZERO     WL0021           Extra Amount 3
     C                     EXSR SBCRRC
     C                     END                             *FI
     C           KRSSD     READE@HRCPLM                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * RTV All Values         RT - Accrual Code Master  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WEOJCD           Accrual Code
      * Setup key
     C                     MOVELWDOJCD    WEOJCD           Accrual Code
      * Establish starting position
     C           KRSSE     CHAIN@HLREK4              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1514' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * PAR = CON By name
     C                     MOVEL*BLANK    WN0001           Accrual Descrip
     C                     MOVEL*BLANK    WN0002           Automatic Accru
     C                     MOVEL*BLANK    WN0003           Print On Invoic
     C                     MOVEL*BLANK    WN0004           Rate Usage
     C                     MOVEL*BLANK    WN0005           Add-on/Allowanc
     C                     MOVEL*BLANK    WN0006           Accrual Type
     C                     MOVEL*BLANK    WN0008           Reverse Accrual
     C                     MOVEL*BLANK    WN0009           U/M - Primary D
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL*BLANK    W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELWELENA    WN0001           Accrual Descrip
     C                     MOVELWETOST    WN0002           Automatic Accru
     C                     MOVELWETQST    WN0003           Print On Invoic
     C                     MOVELWETRST    WN0004           Rate Usage
     C                     MOVELWETSST    WN0005           Add-on/Allowanc
     C                     MOVELWEOKCD    WN0006           Accrual Type
     C                     MOVELWEOQCD    WN0008           Reverse Accrual
     C                     MOVELWEHHCD    WN0009           U/M - Primary D
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WABTC7           Parent Customer
     C                     Z-ADD*ZERO     WAANC7           A/R Customer Nu
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAA0DT           Order Date
     C                     Z-ADD*ZERO     WAACDT           Cancel Date
     C                     Z-ADD*ZERO     WATBNB           Absorbed Freigh
     C                     Z-ADD*ZERO     WAATIN           Attach to Invoi
     C                     Z-ADD*ZERO     WAT3NB           Attach to Order
     C                     Z-ADD*ZERO     WARSRN           Resell Referenc
     C                     Z-ADD*ZERO     WAORIT           Original Item
     C                     Z-ADD*ZERO     WAAVQT           Quantity Ordere
     C                     Z-ADD*ZERO     WAD0WG           Weight Ordered
     C                     Z-ADD*ZERO     WACCQT           Quantity Schedu
     C                     Z-ADD*ZERO     WAAUWG           Weight Schedule
     C                     Z-ADD*ZERO     WAAKPR           Unit Price
     C                     Z-ADD*ZERO     WAAUPR           Unit Price Orde
     C                     Z-ADD*ZERO     WAA5DT           Requested Ship
     C                     Z-ADD*ZERO     WAAWDT           Invoice Date
     C                     Z-ADD*ZERO     WAHDDT           Deadline Depart
     C                     Z-ADD*ZERO     WAAGCS           Unit Cost Per P
     C                     Z-ADD*ZERO     WAAQCS           Unit Cost Prici
     C                     Z-ADD*ZERO     WAAVWG           Unit Weight Ord
     C                     Z-ADD*ZERO     WAAYVA           Extended Amount
     C                     Z-ADD*ZERO     WAL6NB           Contract Number
     C                     Z-ADD*ZERO     WAHCDT           LD Arrival Date
     C                     Z-ADD*ZERO     WAESNB           Accounting Year
     C                     Z-ADD*ZERO     WAETNB           Accounting Peri
     C                     Z-ADD*ZERO     WABZNB           OM Week
     C                     Z-ADD*ZERO     WAEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WABYWG           Weight Billed
     C                     Z-ADD*ZERO     WAS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WAMAVA           Billing Detail
     C                     Z-ADD*ZERO     WAKDVA           Billing Detail
     C                     Z-ADD*ZERO     WAUSVA           FOB Gross Amoun
     C                     Z-ADD*ZERO     WAUTVA           Standard Overag
     C                     Z-ADD*ZERO     WAA4WG           Tare Weight Tot
     C                     Z-ADD*ZERO     WACKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WAR8NB           Shipping Compan
     C                     Z-ADD*ZERO     WABZPR           Price Overage O
     C                     Z-ADD*ZERO     WAEXDT           Market Pricing
     C                     Z-ADD*ZERO     WARGNB           Item Structure
     C                     Z-ADD*ZERO     WARHNB           Item Structure
     C                     Z-ADD*ZERO     WARINB           Item Structure
     C                     Z-ADD*ZERO     WAR1NB           Rated Freight
     C                     Z-ADD*ZERO     WACONB           Invoice Number
     C                     Z-ADD*ZERO     WAGNDT           Actual Shipped
     C                     Z-ADD*ZERO     WARMNB           Load ID
     C                     Z-ADD*ZERO     WAAODT           Scheduled Ship
     C                     Z-ADD*ZERO     WASKNB           Agrimetrics gro
     C                     Z-ADD*ZERO     WASLNB           Agrimetrics pac
     C                     Z-ADD*ZERO     WASMNB           Agrimetrics gra
     C                     Z-ADD*ZERO     WAONVA           Actual Freight
     C                     Z-ADD*ZERO     WAB4NB           PM R/M Type Cod
     C                     Z-ADD*ZERO     WAB5NB           PM Line Number
     C                     Z-ADD*ZERO     WAGIDT           Pricing Date Us
     C                     Z-ADD*ZERO     WAULVA           Absorbed Freigh
     C                     Z-ADD*ZERO     WAUNVA           Ledgrd Trd Fund
     C                     Z-ADD*ZERO     WAUOVA           Commission Amou
     C                     Z-ADD*ZERO     WAUPVA           Financials Amou
     C                     Z-ADD*ZERO     WAUQVA           Financials Amou
     C                     Z-ADD*ZERO     WACFC7           Order Group Cod
     C                     Z-ADD*ZERO     WADUPR           Invoice Unit Pr
     C                     Z-ADD*ZERO     WAB6VL           Invoice Extende
     C                     Z-ADD*ZERO     WAIANX           Req Shipping Te
     C                     Z-ADD*ZERO     WAIBNX           Actual Shipping
     C                     Z-ADD*ZERO     WANYDT           Req Delivery Da
     C                     Z-ADD*ZERO     WABZTM           Req Delivery Ti
     C                     Z-ADD*ZERO     WAZ4NB           MPC Number
     C                     Z-ADD*ZERO     WAOCFR           Load Total Frei
     C                     Z-ADD*ZERO     WAC0C7           Claim Number
     C                     Z-ADD*ZERO     WAA1AA           Ham Group Numbe
     C                     Z-ADD*ZERO     WAA5PR           Commodity Marke
     C                     Z-ADD*ZERO     WACDPR           Market Value
     C                     Z-ADD*ZERO     WAD0PR           Default Cmdty M
     C                     Z-ADD*ZERO     WAD0VL           Raw Material Co
     C                     Z-ADD*ZERO     WACEVL           Sales Expense T
     C                     Z-ADD*ZERO     WAOHDT           LD Sail Date
     C                     Z-ADD*ZERO     WAD9PR           NonLedgrd TrdFn
     C                     Z-ADD*ZERO     WACFVL           HST Item Target
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field Order Number
     C                     Z-ADD*ZERO     WUC4NB  70
      * Define work field USR Sequence Num. New ATR
     C                     Z-ADD*ZERO     WUQQNB  30
      * Define work field Extra Amount 1
     C                     Z-ADD*ZERO     WUOOVA 112
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBC4NB           Order Number
     C                     Z-ADD*ZERO     WBDXNB           Sequence Number
     C                     Z-ADD*ZERO     WBBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WBBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WBS5NB           Shipped Item Co
     C                     Z-ADD*ZERO     WBAWDT           Invoice Date
     C                     Z-ADD*ZERO     WBQ7NB           Invoice/Memo Nu
     C                     Z-ADD*ZERO     WBEXQT           Quantity Billed
     C                     Z-ADD*ZERO     WBBYWG           Weight Billed
     C                     Z-ADD*ZERO     WBL8VA           Billing Detail
     C                     Z-ADD*ZERO     WBRGNB           Item Structure
     C                     Z-ADD*ZERO     WBRHNB           Item Structure
     C                     Z-ADD*ZERO     WBRINB           Item Structure
     C                     Z-ADD*ZERO     WBOOVA           Extra Amount 1
     C                     Z-ADD*ZERO     WBOPVA           Extra Amount 2
     C                     Z-ADD*ZERO     WBOQVA           Extra Amount 3
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCAIC3           Company Number
     C                     Z-ADD*ZERO     WCC4NB           Order Number
     C                     Z-ADD*ZERO     WCDPNB           Order Sequence
     C                     Z-ADD*ZERO     WCUENB           Order Secondary
     C                     Z-ADD*ZERO     WCDXNB           Sequence Number
     C                     Z-ADD*ZERO     WCBSVA           Transaction Amo
     C                     Z-ADD*ZERO     WCSANB           Special Charge
     C                     Z-ADD*ZERO     WCCKNB           G/L Document Nu
     C                     Z-ADD*ZERO     WCAATM           Job Time
     C                     Z-ADD*ZERO     WCAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDDXNB           Sequence Number
     C                     Z-ADD*ZERO     WDBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WDC5PC           Accrual Percent
     C                     Z-ADD*ZERO     WDAYVA           Extended Amount
     C                     Z-ADD*ZERO     WDEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WDHGCD           Item Code
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDDUC7           A/R Customer
     C                     Z-ADD*ZERO     WDPODT           SDA Actual Ship
     C                     Z-ADD*ZERO     WDBYWG           Weight Billed
     C                     Z-ADD*ZERO     WDPPDT           SDA Ord Dtl Acr
     C                     Z-ADD*ZERO     WDPQDT           SDA Unused Date
     C                     Z-ADD*ZERO     WDEEVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDEFVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDQ8DT           SDA Invoice Dat
     C                     Z-ADD*ZERO     WDH0NY           SDA G/L Sub Led
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WEBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WEHQVL           Max Accrual Amo
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBCRRC.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  70
     C                     Z-ADD*ZERO     WL0003  30
     C                     MOVEL*BLANK    WL0004  3
     C                     Z-ADD*ZERO     WL0005  96
     C                     MOVEL*BLANK    WL0006  3
     C                     Z-ADD*ZERO     WL0007  70
     C                     Z-ADD*ZERO     WL0008  70
     C                     Z-ADD*ZERO     WL0009  70
     C                     Z-ADD*ZERO     WL0010  70
     C                     MOVEL*BLANK    WL0011  2
     C                     Z-ADD*ZERO     WL0012 112
     C                     Z-ADD*ZERO     WL0013 112
     C                     Z-ADD*ZERO     WL0014 112
     C                     Z-ADD*ZERO     WL0015  30
     C                     Z-ADD*ZERO     WL0016  30
     C                     Z-ADD*ZERO     WL0017  30
     C                     MOVEL*BLANK    WL0018  2
     C                     Z-ADD*ZERO     WL0019 112
     C                     Z-ADD*ZERO     WL0020 112
     C                     Z-ADD*ZERO     WL0021 112
      *================================================================
     CSR         ZZEXIT    ENDSR
