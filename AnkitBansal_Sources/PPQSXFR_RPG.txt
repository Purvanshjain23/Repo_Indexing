     H/TITLE Snd PFS Order Header  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 07/12/19  Time  : 09:06:47
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPPBBCPL3IF  E           K        DISK
      * RSQ : PFS Order Header          Co/Ord PSts=0
      *
     FPPBBCPL5IF  E           K        DISK                      A
      * UPD : PFS Order Header          Update Index QTEMP
      *
     FPPBBCPL0UF  E           K        DISK
      * UPD : PFS Order Header          Update index
      *
     I@BBCPB1
      * PFS Order Header          Co/Ord PSts=0
      * Renamed input format fields
     I              BBY1NX                          WAY1NX
     I              BBZPNX                          WAZPNX
     I              BBZGNX                          WAZGNX
     I              BBZWNX                          WAZWNX
     I              BBZVNX                          WAZVNX
     I              BBVCSX                          WAVCSX
     I              BBZQNX                          WAZQNX
     I              BBF0T1                          WAF0T1
     I              BBF1T1                          WAF1T1
     I              BBF2T1                          WAF2T1
     I              BBGUT1                          WAGUT1
     I              BBF3T1                          WAF3T1
     I              BBF4T1                          WAF4T1
     I              BBF5T1                          WAF5T1
     I              BBF6T1                          WAF6T1
     I              BBF7T1                          WAF7T1
     I              BBZENX                          WAZENX
     I              BBF8T1                          WAF8T1
     I              BBF9T1                          WAF9T1
     I              BBGAT1                          WAGAT1
     I              BBGVT1                          WAGVT1
     I              BBGBT1                          WAGBT1
     I              BBGCT1                          WAGCT1
     I              BBGDT1                          WAGDT1
     I              BBFZT1                          WAFZT1
     I              BBZRNX                          WAZRNX
     I              BBZSNX                          WAZSNX
     I              BBZTNX                          WAZTNX
     I              BBZUNX                          WAZUNX
     I              BBVBSX                          WAVBSX
     I              BBU3SX                          WAU3SX
     I              BBGET1                          WAGET1
     I              BBGFT1                          WAGFT1
     I              BBA1NY                          WAA1NY
     I              BBBKNY                          WABKNY
     I              BBATNY                          WAATNY
     I              BBVESX                          WAVESX
     I              BBF8AA                          WAF8AA
     I              BBF9AA                          WAF9AA
     I              BBC5NY                          WAC5NY
     I              BBF5NY                          WAF5NY
     I              BBF5AA                          WAF5AA
     I              BBFRT1                          WAFRT1
     I              BBFST1                          WAFST1
     I              BBFTT1                          WAFTT1
     I              BBFUT1                          WAFUT1
     I              BBFVT1                          WAFVT1
     I              BBFWT1                          WAFWT1
     I              BBFXT1                          WAFXT1
     I              BBZLNX                          WAZLNX
     I              BBF7AA                          WAF7AA
     I              BBF6AA                          WAF6AA
     I              BBS6NA                          WAS6NA
     I              BBZDSX                          WAZDSX
     I              BBZESX                          WAZESX
     I              BBZFSX                          WAZFSX
     I              BBZGSX                          WAZGSX
     I              BBZHSX                          WAZHSX
     I              BBMXU1                          WAMXU1
     I              BBUWSX                          WAUWSX
     I              BBUXSX                          WAUXSX
     I              BBV3SX                          WAV3SX
     I              BBAHNY                          WAAHNY
     I              BBAINY                          WAAINY
     I              BBAJNY                          WAAJNY
     I              BBAKNY                          WAAKNY
      *
     I@BBCPC0
      * PFS Order Header          Update Index QTEMP
      * Renamed input format fields
     I              BBY1NX                          WBY1NX
     I              BBZPNX                          WBZPNX
     I              BBZGNX                          WBZGNX
     I              BBZWNX                          WBZWNX
     I              BBZVNX                          WBZVNX
     I              BBVCSX                          WBVCSX
     I              BBZQNX                          WBZQNX
     I              BBF0T1                          WBF0T1
     I              BBF1T1                          WBF1T1
     I              BBF2T1                          WBF2T1
     I              BBGUT1                          WBGUT1
     I              BBF3T1                          WBF3T1
     I              BBF4T1                          WBF4T1
     I              BBF5T1                          WBF5T1
     I              BBF6T1                          WBF6T1
     I              BBF7T1                          WBF7T1
     I              BBZENX                          WBZENX
     I              BBF8T1                          WBF8T1
     I              BBF9T1                          WBF9T1
     I              BBGAT1                          WBGAT1
     I              BBGVT1                          WBGVT1
     I              BBGBT1                          WBGBT1
     I              BBGCT1                          WBGCT1
     I              BBGDT1                          WBGDT1
     I              BBFZT1                          WBFZT1
     I              BBZRNX                          WBZRNX
     I              BBZSNX                          WBZSNX
     I              BBZTNX                          WBZTNX
     I              BBZUNX                          WBZUNX
     I              BBVBSX                          WBVBSX
     I              BBU3SX                          WBU3SX
     I              BBGET1                          WBGET1
     I              BBGFT1                          WBGFT1
     I              BBA1NY                          WBA1NY
     I              BBBKNY                          WBBKNY
     I              BBATNY                          WBATNY
     I              BBVESX                          WBVESX
     I              BBF8AA                          WBF8AA
     I              BBF9AA                          WBF9AA
     I              BBC5NY                          WBC5NY
     I              BBF5NY                          WBF5NY
     I              BBF5AA                          WBF5AA
     I              BBFRT1                          WBFRT1
     I              BBFST1                          WBFST1
     I              BBFTT1                          WBFTT1
     I              BBFUT1                          WBFUT1
     I              BBFVT1                          WBFVT1
     I              BBFWT1                          WBFWT1
     I              BBFXT1                          WBFXT1
     I              BBZLNX                          WBZLNX
     I              BBF7AA                          WBF7AA
     I              BBF6AA                          WBF6AA
     I              BBS6NA                          WBS6NA
     I              BBZDSX                          WBZDSX
     I              BBZESX                          WBZESX
     I              BBZFSX                          WBZFSX
     I              BBZGSX                          WBZGSX
     I              BBZHSX                          WBZHSX
     I              BBMXU1                          WBMXU1
     I              BBUWSX                          WBUWSX
     I              BBUXSX                          WBUXSX
     I              BBV3SX                          WBV3SX
     I              BBAHNY                          WBAHNY
     I              BBAINY                          WBAINY
     I              BBAJNY                          WBAJNY
     I              BBAKNY                          WBAKNY
      *
     I@BBCPZR
      * PFS Order Header          Update index
      * Renamed input format fields
     I              BBY1NX                          WCY1NX
     I              BBZPNX                          WCZPNX
     I              BBZGNX                          WCZGNX
     I              BBZWNX                          WCZWNX
     I              BBZVNX                          WCZVNX
     I              BBVCSX                          WCVCSX
     I              BBZQNX                          WCZQNX
     I              BBF0T1                          WCF0T1
     I              BBF1T1                          WCF1T1
     I              BBF2T1                          WCF2T1
     I              BBGUT1                          WCGUT1
     I              BBF3T1                          WCF3T1
     I              BBF4T1                          WCF4T1
     I              BBF5T1                          WCF5T1
     I              BBF6T1                          WCF6T1
     I              BBF7T1                          WCF7T1
     I              BBZENX                          WCZENX
     I              BBF8T1                          WCF8T1
     I              BBF9T1                          WCF9T1
     I              BBGAT1                          WCGAT1
     I              BBGVT1                          WCGVT1
     I              BBGBT1                          WCGBT1
     I              BBGCT1                          WCGCT1
     I              BBGDT1                          WCGDT1
     I              BBFZT1                          WCFZT1
     I              BBZRNX                          WCZRNX
     I              BBZSNX                          WCZSNX
     I              BBZTNX                          WCZTNX
     I              BBZUNX                          WCZUNX
     I              BBVBSX                          WCVBSX
     I              BBU3SX                          WCU3SX
     I              BBGET1                          WCGET1
     I              BBGFT1                          WCGFT1
     I              BBA1NY                          WCA1NY
     I              BBBKNY                          WCBKNY
     I              BBATNY                          WCATNY
     I              BBVESX                          WCVESX
     I              BBF8AA                          WCF8AA
     I              BBF9AA                          WCF9AA
     I              BBC5NY                          WCC5NY
     I              BBF5NY                          WCF5NY
     I              BBF5AA                          WCF5AA
     I              BBFRT1                          WCFRT1
     I              BBFST1                          WCFST1
     I              BBFTT1                          WCFTT1
     I              BBFUT1                          WCFUT1
     I              BBFVT1                          WCFVT1
     I              BBFWT1                          WCFWT1
     I              BBFXT1                          WCFXT1
     I              BBZLNX                          WCZLNX
     I              BBF7AA                          WCF7AA
     I              BBF6AA                          WCF6AA
     I              BBS6NA                          WCS6NA
     I              BBZDSX                          WCZDSX
     I              BBZESX                          WCZESX
     I              BBZFSX                          WCZFSX
     I              BBZGSX                          WCZGSX
     I              BBZHSX                          WCZHSX
     I              BBMXU1                          WCMXU1
     I              BBUWSX                          WCUWSX
     I              BBUXSX                          WCUXSX
     I              BBV3SX                          WCV3SX
     I              BBAHNY                          WCAHNY
     I              BBAINY                          WCAINY
     I              BBAJNY                          WCAJNY
     I              BBAKNY                          WCAKNY
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPPBB1    E DSPPBBCPL5
      * UPD : PFS Order Header          Update Index QTEMP
      * Renamed input format fields
     I              BBY1NX                          WBY1NX
     I              BBZPNX                          WBZPNX
     I              BBZGNX                          WBZGNX
     I              BBZWNX                          WBZWNX
     I              BBZVNX                          WBZVNX
     I              BBVCSX                          WBVCSX
     I              BBZQNX                          WBZQNX
     I              BBF0T1                          WBF0T1
     I              BBF1T1                          WBF1T1
     I              BBF2T1                          WBF2T1
     I              BBGUT1                          WBGUT1
     I              BBF3T1                          WBF3T1
     I              BBF4T1                          WBF4T1
     I              BBF5T1                          WBF5T1
     I              BBF6T1                          WBF6T1
     I              BBF7T1                          WBF7T1
     I              BBZENX                          WBZENX
     I              BBF8T1                          WBF8T1
     I              BBF9T1                          WBF9T1
     I              BBGAT1                          WBGAT1
     I              BBGVT1                          WBGVT1
     I              BBGBT1                          WBGBT1
     I              BBGCT1                          WBGCT1
     I              BBGDT1                          WBGDT1
     I              BBFZT1                          WBFZT1
     I              BBZRNX                          WBZRNX
     I              BBZSNX                          WBZSNX
     I              BBZTNX                          WBZTNX
     I              BBZUNX                          WBZUNX
     I              BBVBSX                          WBVBSX
     I              BBU3SX                          WBU3SX
     I              BBGET1                          WBGET1
     I              BBGFT1                          WBGFT1
     I              BBA1NY                          WBA1NY
     I              BBBKNY                          WBBKNY
     I              BBATNY                          WBATNY
     I              BBVESX                          WBVESX
     I              BBF8AA                          WBF8AA
     I              BBF9AA                          WBF9AA
     I              BBC5NY                          WBC5NY
     I              BBF5NY                          WBF5NY
     I              BBF5AA                          WBF5AA
     I              BBFRT1                          WBFRT1
     I              BBFST1                          WBFST1
     I              BBFTT1                          WBFTT1
     I              BBFUT1                          WBFUT1
     I              BBFVT1                          WBFVT1
     I              BBFWT1                          WBFWT1
     I              BBFXT1                          WBFXT1
     I              BBZLNX                          WBZLNX
     I              BBF7AA                          WBF7AA
     I              BBF6AA                          WBF6AA
     I              BBS6NA                          WBS6NA
     I              BBZDSX                          WBZDSX
     I              BBZESX                          WBZESX
     I              BBZFSX                          WBZFSX
     I              BBZGSX                          WBZGSX
     I              BBZHSX                          WBZHSX
     I              BBMXU1                          WBMXU1
     I              BBUWSX                          WBUWSX
     I              BBUXSX                          WBUXSX
     I              BBV3SX                          WBV3SX
     I              BBAHNY                          WBAHNY
     I              BBAINY                          WBAINY
     I              BBAJNY                          WBAJNY
     I              BBAKNY                          WBAKNY
      *
     IQPPBB2    E DSPPBBCPL0
      * UPD : PFS Order Header          Update index
      * Renamed input format fields
     I              BBY1NX                          WCY1NX
     I              BBZPNX                          WCZPNX
     I              BBZGNX                          WCZGNX
     I              BBZWNX                          WCZWNX
     I              BBZVNX                          WCZVNX
     I              BBVCSX                          WCVCSX
     I              BBZQNX                          WCZQNX
     I              BBF0T1                          WCF0T1
     I              BBF1T1                          WCF1T1
     I              BBF2T1                          WCF2T1
     I              BBGUT1                          WCGUT1
     I              BBF3T1                          WCF3T1
     I              BBF4T1                          WCF4T1
     I              BBF5T1                          WCF5T1
     I              BBF6T1                          WCF6T1
     I              BBF7T1                          WCF7T1
     I              BBZENX                          WCZENX
     I              BBF8T1                          WCF8T1
     I              BBF9T1                          WCF9T1
     I              BBGAT1                          WCGAT1
     I              BBGVT1                          WCGVT1
     I              BBGBT1                          WCGBT1
     I              BBGCT1                          WCGCT1
     I              BBGDT1                          WCGDT1
     I              BBFZT1                          WCFZT1
     I              BBZRNX                          WCZRNX
     I              BBZSNX                          WCZSNX
     I              BBZTNX                          WCZTNX
     I              BBZUNX                          WCZUNX
     I              BBVBSX                          WCVBSX
     I              BBU3SX                          WCU3SX
     I              BBGET1                          WCGET1
     I              BBGFT1                          WCGFT1
     I              BBA1NY                          WCA1NY
     I              BBBKNY                          WCBKNY
     I              BBATNY                          WCATNY
     I              BBVESX                          WCVESX
     I              BBF8AA                          WCF8AA
     I              BBF9AA                          WCF9AA
     I              BBC5NY                          WCC5NY
     I              BBF5NY                          WCF5NY
     I              BBF5AA                          WCF5AA
     I              BBFRT1                          WCFRT1
     I              BBFST1                          WCFST1
     I              BBFTT1                          WCFTT1
     I              BBFUT1                          WCFUT1
     I              BBFVT1                          WCFVT1
     I              BBFWT1                          WCFWT1
     I              BBFXT1                          WCFXT1
     I              BBZLNX                          WCZLNX
     I              BBF7AA                          WCF7AA
     I              BBF6AA                          WCF6AA
     I              BBS6NA                          WCS6NA
     I              BBZDSX                          WCZDSX
     I              BBZESX                          WCZESX
     I              BBZFSX                          WCZFSX
     I              BBZGSX                          WCZGSX
     I              BBZHSX                          WCZHSX
     I              BBMXU1                          WCMXU1
     I              BBUWSX                          WCUWSX
     I              BBUXSX                          WCUXSX
     I              BBV3SX                          WCV3SX
     I              BBAHNY                          WCAHNY
     I              BBAINY                          WCAINY
     I              BBAJNY                          WCAJNY
     I              BBAKNY                          WCAKNY
      *
     IYARDCS      DS                            861
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Company Number
     I                                    P   1   20P1AIC3
     IP2PARM      DS
      * N :  PFS Company Number
     I                                        1   30P2Y1NX
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AIC3    PARM           WP0001  30       Company Number
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Snd PFS Order Header  XF
     C                     MOVE P1AIC3    P2Y1NX           PFS Company Num
      * Snd PFS Order Header  RT - PFS Order Header  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Snd PFS Order Header  RT - PFS Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAY1NX    WQSA01           PFS Company Num
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
      * Setup key
     C                     Z-ADDP2Y1NX    WQSA01           PFS Company Num
      * Establish starting position
     C           KRSSA     SETLL@BBCPB1                    *
     C           KRSSA     READE@BBCPB1                  90*
      * Data record not found
     C   90                MOVEL'USR3486' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Crt PFS OrdHdr QTEMP  CR - PFS Order Header  * 
     C                     EXSR SBCRRC
      * Chg Process Status    CH - PFS Order Header  * 
     C                     EXSR SCCHRC
     C           KRSSA     READE@BBCPB1                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Crt PFS OrdHdr QTEMP  CR - PFS Order Header  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BBCPC0
     C                     Z-ADDWAY1NX    WBY1NX           PFS Company Num
     C                     Z-ADDWAZPNX    WBZPNX           PFS Order Numbe
     C                     Z-ADDWAZGNX    WBZGNX           PFS Load ID
     C                     Z-ADDWAZWNX    WBZWNX           PFS Loading Seq
     C                     Z-ADDWAZVNX    WBZVNX           PFS Load Stop N
     C                     MOVELWAVCSX    WBVCSX           PFS Order Type
     C                     Z-ADDWAZQNX    WBZQNX           PFS Ship To Cus
     C                     MOVELWAF0T1    WBF0T1           PFS Ship To Cus
     C                     MOVELWAF1T1    WBF1T1           PFS Ship To Cus
     C                     MOVELWAF2T1    WBF2T1           PFS Ship To Cus
     C                     MOVELWAGUT1    WBGUT1           PFS Ship To Cus
     C                     MOVELWAF3T1    WBF3T1           PFS Ship To Cus
     C                     MOVELWAF4T1    WBF4T1           PFS Ship To Cus
     C                     MOVELWAF5T1    WBF5T1           PFS Ship To Cus
     C                     MOVELWAF6T1    WBF6T1           PFS Ship To Ema
     C                     MOVELWAF7T1    WBF7T1           PFS Ship To Pho
     C                     Z-ADDWAZENX    WBZENX           PFS Bill To Cus
     C                     MOVELWAF8T1    WBF8T1           PFS Bill To Cus
     C                     MOVELWAF9T1    WBF9T1           PFS Bill To Cus
     C                     MOVELWAGAT1    WBGAT1           PFS Bill To Cus
     C                     MOVELWAGVT1    WBGVT1           PFS Bill To Cus
     C                     MOVELWAGBT1    WBGBT1           PFS Bill To Cus
     C                     MOVELWAGCT1    WBGCT1           PFS Bill To Cus
     C                     MOVELWAGDT1    WBGDT1           PFS Bill To Cus
     C                     MOVELWAFZT1    WBFZT1           PFS Customer PO
     C                     Z-ADDWAZRNX    WBZRNX           PFS Order Date
     C                     Z-ADDWAZSNX    WBZSNX           PFS Scheduled S
     C                     Z-ADDWAZTNX    WBZTNX           PFS Requested D
     C                     Z-ADDWAZUNX    WBZUNX           PFS Requested D
     C                     MOVELWAVBSX    WBVBSX           PFS Export Stat
     C                     MOVELWAU3SX    WBU3SX           PFS Country Cod
     C                     MOVELWAGET1    WBGET1           PFS Special Ins
     C                     MOVELWAGFT1    WBGFT1           PFS Special Ins
     C                     Z-ADDWAA1NY    WBA1NY           PFS Maximum Gro
     C                     Z-ADDWABKNY    WBBKNY           PFS Estimated P
     C                     Z-ADDWAATNY    WBATNY           PFS Average Pal
     C                     MOVELWAVESX    WBVESX           PFS Order Statu
     C                     MOVELWAF8AA    WBF8AA           PFS Ship From W
     C                     MOVELWAF9AA    WBF9AA           PFS Ship To War
     C                     Z-ADDWAC5NY    WBC5NY           PFS Order Detai
     C                     Z-ADDWAF5NY    WBF5NY           PFS Sequence No
     C                     MOVELWAF5AA    WBF5AA           PFS Shipping Li
     C                     MOVELWAFRT1    WBFRT1           PFS Shipping Li
     C                     MOVELWAFST1    WBFST1           PFS Shipping Li
     C                     MOVELWAFTT1    WBFTT1           PFS Shipping Li
     C                     MOVELWAFUT1    WBFUT1           PFS Shipping Li
     C                     MOVELWAFVT1    WBFVT1           PFS Shipping Li
     C                     MOVELWAFWT1    WBFWT1           PFS Shipping LI
     C                     MOVELWAFXT1    WBFXT1           PFS Vessel Name
     C                     MOVELWAZLNX    WBZLNX           PFS Voyage
     C                     MOVELWAF7AA    WBF7AA           PFS Discharge P
     C                     MOVELWAF6AA    WBF6AA           PFS Booking Num
     C                     MOVELWAS6NA    WBS6NA           PFS Delivery P.
     C                     MOVELWAZDSX    WBZDSX           PFS Order Unuse
     C                     MOVELWAZESX    WBZESX           PFS Order Unuse
     C                     MOVELWAZFSX    WBZFSX           PFS Order Unuse
     C                     MOVELWAZGSX    WBZGSX           PFS Order Unuse
     C                     MOVELWAZHSX    WBZHSX           PFS Order Unuse
     C                     MOVELWAMXU1    WBMXU1           PFS Order Unuse
     C                     MOVELWAUWSX    WBUWSX           PFS Record Stat
     C                     Z-ADDWAUXSX    WBUXSX           PFS Process Sta
     C                     MOVELWAV3SX    WBV3SX           PFS Error Reaso
     C                     Z-ADDWAAHNY    WBAHNY           PFS Create Date
     C                     Z-ADDWAAINY    WBAINY           PFS Create Time
     C                     Z-ADDWAAJNY    WBAJNY           PFS Change Date
     C                     Z-ADDWAAKNY    WBAKNY           PFS Change time
      *
     C           KLCRSB    KLIST
     C                     KFLD           WBY1NX           PFS Company Num
     C                     KFLD           WBZPNX           PFS Order Numbe
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BBCPC0                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR3487' W0RTN   7
      * Send message 'PFS Order Header       EX'
     C                     MOVEL'USR3487' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C                     WRITE@BBCPC0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Process Status    CH - PFS Order Header  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  70       PFS Load ID
     C                     Z-ADD*ZERO     WN0002  20       PFS Loading Seq
     C                     Z-ADD*ZERO     WN0003  20       PFS Load Stop N
     C                     MOVEL*BLANK    WN0004  2        PFS Order Type
     C                     Z-ADD*ZERO     WN0005  70       PFS Ship To Cus
     C                     MOVEL*BLANK    WN0006 30        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0007 30        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0008 30        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0009 30        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0010 20        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0011  2        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0012 11        PFS Ship To Cus
     C                     MOVEL*BLANK    WN0013 50        PFS Ship To Ema
     C                     MOVEL*BLANK    WN0014 25        PFS Ship To Pho
     C                     Z-ADD*ZERO     WN0015  70       PFS Bill To Cus
     C                     MOVEL*BLANK    WN0016 30        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0017 30        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0018 30        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0019 30        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0020 20        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0021  2        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0022 11        PFS Bill To Cus
     C                     MOVEL*BLANK    WN0023 15        PFS Customer PO
     C                     Z-ADD*ZERO     WN0024  80       PFS Order Date
     C                     Z-ADD*ZERO     WN0025  80       PFS Scheduled S
     C                     Z-ADD*ZERO     WN0026  80       PFS Requested D
     C                     Z-ADD*ZERO     WN0027  60       PFS Requested D
     C                     MOVEL*BLANK    WN0028  1        PFS Export Stat
     C                     MOVEL*BLANK    WN0029  6        PFS Country Cod
     C                     MOVEL*BLANK    WN0030 40        PFS Special Ins
     C                     MOVEL*BLANK    WN0031 40        PFS Special Ins
     C                     Z-ADD*ZERO     WN0032  70       PFS Maximum Gro
     C                     Z-ADD*ZERO     WN0033  50       PFS Estimated P
     C                     Z-ADD*ZERO     WN0034  52       PFS Average Pal
     C                     MOVEL*BLANK    WN0035  1        PFS Order Statu
     C                     MOVEL*BLANK    WN0036  3        PFS Ship From W
     C                     MOVEL*BLANK    WN0037  3        PFS Ship To War
     C                     Z-ADD*ZERO     WN0038  50       PFS Order Detai
     C                     Z-ADD*ZERO     WN0039  90       PFS Sequence No
     C                     MOVEL*BLANK    WN0040  3        PFS Shipping Li
     C                     MOVEL*BLANK    WN0041 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0042 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0043 30        PFS Shipping Li
     C                     MOVEL*BLANK    WN0044 20        PFS Shipping Li
     C                     MOVEL*BLANK    WN0045  2        PFS Shipping Li
     C                     MOVEL*BLANK    WN0046 11        PFS Shipping LI
     C                     MOVEL*BLANK    WN0047 30        PFS Vessel Name
     C                     MOVEL*BLANK    WN0048 15        PFS Voyage
     C                     MOVEL*BLANK    WN0049 20        PFS Discharge P
     C                     MOVEL*BLANK    WN0050 15        PFS Booking Num
     C                     MOVEL*BLANK    WN0051  1        PFS Order Unuse
     C                     MOVEL*BLANK    WN0052  1        PFS Order Unuse
     C                     MOVEL*BLANK    WN0053  1        PFS Order Unuse
     C                     MOVEL*BLANK    WN0054  2        PFS Order Unuse
     C                     MOVEL*BLANK    WN0055  2        PFS Order Unuse
     C                     MOVEL*BLANK    WN0056 15        PFS Order Unuse
     C                     MOVEL*BLANK    WN0057  1        PFS Record Stat
     C                     MOVEL*BLANK    WN0058  6        PFS Error Reaso
     C                     Z-ADD*ZERO     WN0059  80       PFS Create Date
     C                     Z-ADD*ZERO     WN0060  60       PFS Create Time
     C                     Z-ADD*ZERO     WN0061  80       PFS Change Date
     C                     Z-ADD*ZERO     WN0062  60       PFS Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @BBCPZR
     C                     Z-ADDWAY1NX    WCY1NX           PFS Company Num
     C                     Z-ADDWAZPNX    WCZPNX           PFS Order Numbe
      *
     C           KLCHSC    KLIST
     C                     KFLD           WCY1NX           PFS Company Num
     C                     KFLD           WCZPNX           PFS Order Numbe
     C           KLCHSC    CHAIN@BBCPZR              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PPBBCPL0'MDACP
     C                     MOVEL'@BBCPZR' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPPBB2    YARDCS
      * Move non-key fields to @BBCPZR
     C                     MOVELWAS6NA    WCS6NA    P      PFS Delivery P.
     C                     Z-ADD1         WCUXSX           PFS Process Sta
      *
      * Set PGM.*Record Data Changed flag
     C           QPPBB2    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BBCPZR                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPPBBCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P2Y1NX           PFS Company Num
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAZPNX           PFS Order Numbe
     C                     Z-ADD*ZERO     WAZGNX           PFS Load ID
     C                     Z-ADD*ZERO     WAZWNX           PFS Loading Seq
     C                     Z-ADD*ZERO     WAZVNX           PFS Load Stop N
     C                     Z-ADD*ZERO     WAZQNX           PFS Ship To Cus
     C                     Z-ADD*ZERO     WAZENX           PFS Bill To Cus
     C                     Z-ADD*ZERO     WAZRNX           PFS Order Date
     C                     Z-ADD*ZERO     WAZSNX           PFS Scheduled S
     C                     Z-ADD*ZERO     WAZTNX           PFS Requested D
     C                     Z-ADD*ZERO     WAZUNX           PFS Requested D
     C                     Z-ADD*ZERO     WAA1NY           PFS Maximum Gro
     C                     Z-ADD*ZERO     WABKNY           PFS Estimated P
     C                     Z-ADD*ZERO     WAATNY           PFS Average Pal
     C                     Z-ADD*ZERO     WAC5NY           PFS Order Detai
     C                     Z-ADD*ZERO     WAF5NY           PFS Sequence No
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
