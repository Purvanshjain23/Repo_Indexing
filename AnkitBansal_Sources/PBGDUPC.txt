/********************************************************************/
/*                                                                   */
/*  SYNOPSIS -  BUILD CUSTOMER ACCRUAL PGM REPORT(XLS)               */
/*       AND    BUILD WF BRK CUST ACCRUAL RATE WORK FILE.            */
/*                                                                   */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                              */
/*  DATE      - 11/30/2012                                           */
/*  AUTHOR    - SUSAN MASON                                          */
/*                                                                   */
/*  PARAMETERS:                                                      */
/*  &RETURN      RETURN CODE                                         */
/*  &ACCRLCD     ACCRUAL CODE                                        */
/*  &DATEN       DATE ENTERED 15.5                                   */
/*  &EMAIL       EMAIL ADDRESS                                       */
/*********************************************************************/
/*  MODIFICATION                                                     */
/*********************************************************************/
/*  11/30/2012 SLM CLONE FROM PMXVUPC                                */
/*                 CHANGE LOGIC FOR ALL CUSTOMER ACCRUAL PGM XLS     */
/*********************************************************************/
 PBGDUPC:    PGM        PARM(&RETURN &ACCRLCD &DATEN &SHIPTO &EMAIL +
                        &CUSNAM &ACCRTYP)

             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(7)
             DCL        VAR(&ACCRLCD) TYPE(*CHAR) LEN(3)
             DCL        VAR(&DATEN) TYPE(*DEC)
             DCL        VAR(&DATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&SHIPTO) TYPE(*DEC)
             DCL        VAR(&SHIPNO) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&EMAIL) TYPE(*CHAR) LEN(50)
             DCL        VAR(&CUSNAM) TYPE(*CHAR) LEN(30)
             DCL        VAR(&ACCRTYP) TYPE(*CHAR) LEN(2)
             DCL        VAR(&MSG001) TYPE(*CHAR) LEN(80)
             /*****                 +
                          VALUE('Accrual Program Customer Rate +
                          Matrix - Customer: ' *BCAT &CUSNAM *TCAT') ****/


             CHGVAR     VAR(&RETURN) VALUE('       ')
             CHGVAR     VAR(&DATE) VALUE(&DATEN)
             CHGVAR     VAR(&SHIPNO) VALUE(&SHIPTO)


/* CREATE WORK FILE IN QTEMP                                         */
/* WF BRKR CUST RATE MATRIX                                          */
             CRTDUPOBJ  OBJ(PBAQCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PBAQCPP) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130) EXEC(CLRPFM FILE(QTEMP/PBAQCPP))

             CRTDUPOBJ  OBJ(PBAQCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PBAQCPL0) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130)

             CRTDUPOBJ  OBJ(PBAQCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(PBAQCPL1) CST(*NO) +
                          TRG(*NO)
             MONMSG     MSGID(CPF2130)

             CLRPFM     FILE(QTEMP/PBAQCPP)

/* WRITE RECORDS TO WF BRK CUST BASED ON ITEM DEFAULT & CUSTOMER ACCRUAL */

             CALL       PGM(PBG0XFR) PARM(&RETURN &ACCRLCD &DATE +
                          &SHIPNO &CUSNAM &ACCRTYP)
             IF         COND(&RETURN *NE '       ') THEN(GOTO +
                          CMDLBL(BUILDERR))
/* SUSAN IS TESTING HERE     *****/
/*           CPYF       FROMFILE(QTEMP/PBAQCPP) +   */
/*                        TOFILE(PRKTESTF/PBAQCPP) MBROPT(*REPLACE) */
/*           MONMSG     MSGID(CPF2869)        */

/* CREATE THE TABLE AND EMAIL AS A SPREADSHEET                       */
/* 1126/2012 Change the EMLMSG                                       */

             EXECUTE    VIEW(PBAQCPPVT) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('Customer +
                          Accrual Program Rate Matrix')
             MONMSG     MSGID(CPF0000) EXEC(CHGVAR VAR(&RETURN) +
                          VALUE('Y2U0032')) /* Error returned on +
                          call */

/*******     DLTF       FILE(QTEMP/PBAQCP*)        ********/


/* HANDLE ERRORS                                                     */
BUILDERR:

 END:        ENDPGM
