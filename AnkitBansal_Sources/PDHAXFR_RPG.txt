     H/TITLE CLC Month/Year         XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : COOL:2E  Version:  1000
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model         lopment-
     H* System        : OMS Development Model
     H* User name     : ISPPATE
     H* Date          : 07/02/02  Time  : 08:15:59
     H* Copyright     : OMS Development Model         lopment-
      *
      *================================================================
     M* Maintenance   :
      *================================================================
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * B :  @Date - ATR
     I                                    P   1   40P1AADT
     IP2PARM      DS
      * B : MAP Month/Year NBR        USR
     I                                    P   1   30P2MNDY
     IP3PARM      DS
      * N :  TXT Date-DTE          USR
     I                                        1   7 P3OQTX
     IP4PARM      DS
      * N :  TXT Month Number      USR
     I                                        1   2 P4ONTX
     IP5PARM      DS
      * N :  TXT Year Number       USR
     I                                        1   2 P5OPTX
     IP6PARM      DS
      * N :  Year 2000 Indicator
     I                                        1   1 P6ZHST
     IP7PARM      DS
      * N :  USR Work Field 7A
     I                                        1   7 P7E2TX
     IP8PARM      DS
      * N :  TXT Day Number        USR
     I                                        1   2 P8OOTX
     IP9PARM      DS
      * N :  TXT MM/YY             USR
     I                                        1   5 P9ORTX
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1AADT    PARM P1AADT    WP0001  70       @Date - ATR
     C           P2MNDY    PARM P2MNDY    WP0002  40       Month/Year NBR
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * CLC Month/Year         XF
      * This internal function will calculate the month and year for the
      * that is passed in.  If the month passed in is not a valid month,
      * will be moved to the output MM/DD/YY field.
     C                     MOVEL*BLANK    P3OQTX           TXT Date-DTE
     C                     MOVELP1AADT    P3OQTX           TXT Date-DTE
     C                     MOVEL*BLANK    P9ORTX           TXT MM/YY
     C                     MOVELP2MNDY    P9ORTX           TXT MM/YY
     C                     Z-ADD2         YRSW00
     C                     Z-ADD2         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00005
     C           ZQ        ORGT 00005
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP9ORTX:ZQ WUONTX    P  90  TXT Month Numbe
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * CASE: WRK.TXT Month Number      USR is *Zeroes
     C           WUONTX    IFEQ '00'                       *IF
     C                     Z-ADD2         YRSW00
     C                     Z-ADD4         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00007
     C           ZQ        ORGT 00007
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP3OQTX:ZQ P4ONTX    P  90  TXT Month Numbe
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD2         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00007
     C           ZQ        ORGT 00007
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP3OQTX:ZQ P5OPTX    P  90  TXT Year Number
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUONTX    P4ONTX           TXT Month Numbe
     C                     Z-ADD2         YRSW00
     C                     Z-ADD4         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00005
     C           ZQ        ORGT 00005
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP9ORTX:ZQ P5OPTX    P  90  TXT Year Number
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     END                             *FI
     C                     MOVEL'31'      P8OOTX           TXT Day Number
      * old after
      * CASE: PAR.TXT Month Number      USR is Valid Month
     C           P4ONTX    IFGE '01'                       *IF
     C           P4ONTX    ANDLE'12'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'MONERR'  W0RTN            *Return code
     C                     GOTO AAEXIT                     *QUIT
     C                     END                             *FI
      * CASE: PAR.TXT Year Number       USR is Y2K (For Year Use)
     C           P5OPTX    IFLT '40'                       *IF
     C                     MOVEL'Y'       P6ZHST           Year 2000 Indic
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       P6ZHST           Year 2000 Indic
     C                     END                             *FI
      * CASE: PAR.Year 2000 Indicator is *Yes
     C           P6ZHST    IFEQ 'Y'                        *IF
     C                     Z-ADD*ZERO     ZQ      50
     C           '1'       CAT  P5OPTX:ZQ P3OQTX    P      TXT Date-DTE
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     ZQ      50
     C           '0'       CAT  P5OPTX:ZQ P3OQTX    P      TXT Date-DTE
     C                     END                             *FI
     C                     Z-ADD*ZERO     ZQ      50
     C           P3OQTX    CAT  P4ONTX:ZQ P3OQTX    P      TXT Date-DTE
     C                     Z-ADD*ZERO     ZQ      50
     C           P3OQTX    CAT  P8OOTX:ZQ P3OQTX    P      TXT Date-DTE
     C                     MOVE P3OQTX    P1AADT           @Date - ATR
     C                     Z-ADD*ZERO     ZQ      50
     C           P4ONTX    CAT  P5OPTX:ZQ P9ORTX    P      TXT MM/YY
     C                     MOVE P9ORTX    WUMNDY           Month/Year NBR
     C           WUMNDY    DIV  10        P2MNDY           Month/Year NBR
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     MOVEL*BLANK    P3OQTX           TXT Date-DTE
     C                     MOVEL*BLANK    P4ONTX           TXT Month Numbe
     C                     MOVEL*BLANK    P5OPTX           TXT Year Number
     C                     MOVEL*BLANK    P6ZHST           Year 2000 Indic
     C                     MOVEL*BLANK    P7E2TX           USR Work Field
     C                     MOVEL*BLANK    P8OOTX           TXT Day Number
     C                     MOVEL*BLANK    P9ORTX           TXT MM/YY
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field TXT Month Number      USR
     C                     MOVEL*BLANK    WUONTX  2
      * Define work field Month/Year NBR        USR
     C                     Z-ADD*ZERO     WUMNDY  40
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
