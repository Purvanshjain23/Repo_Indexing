/********************************************************************/
/*  PROGRAM  - PBPLUPC                                              */
/*  SYNOPSIS - POPULATE THE DP FUTURE FILE FOR THE IHUB FOR THE        */
/*             SALES FORECAST REVIEW MI INPUT                       */
/*                                                                  */
/*  SYSTEM    - ORDER MANAGEMENT SYSTEM                             */
/*  DATE      -  09/16/2014                                        */
/*                                                                  */
/*   INPUT:  SELECT ORDERS BY REQUESTED SHIP DATE BY THIS RULE:   */
/*    SELECT ORDS 6 WEEEKS OUT STARTING WITH THE NEXT SUNDAY WEEK BEGIN DT   */
/*   OUTPUT FILE:  PBBVCPP  DP FUTURE ORDERS                    */
/********************************************************************/
PBPLUPC:    PGM  PARM(&RTNCDE)

/* PARMS */
            DCL        VAR(&RTNCDE) TYPE(*CHAR) LEN(7)
            DCL        VAR(&FDATE) TYPE(*DEC) LEN(7 0)
            DCL        VAR(&TDATE) TYPE(*DEC) LEN(7 0)
            DCL        VAR(&FDAT) TYPE(*DEC) LEN(7 0)
            DCL        VAR(&TDAT) TYPE(*DEC) LEN(7 0)
            DCL        VAR(&CURDAT) TYPE(*DEC) LEN(7 0)
            DCL        VAR(&FDATEA) TYPE(*CHAR) LEN(7)
            DCL        VAR(&TDATEA) TYPE(*CHAR) LEN(7)
            DCL        VAR(&JOBDATE) TYPE(*CHAR) LEN(6)
            DCL        VAR(&JOBDTE) TYPE(*CHAR) LEN(7)
            DCL        VAR(&NODAYS) TYPE(*DEC) LEN(5 0)
            DCL        VAR(&WEEK) TYPE(*DEC) LEN(2 0)
            DCL        VAR(&PDATE) TYPE(*DEC) LEN(7 0)

  /* GET CURRENT DATE TO GET PERIOD BEGIN/END DATES    */

             RTVJOBA    DATE(&JOBDATE)
             CVTDAT     DATE(&JOBDATE) TOVAR(&JOBDTE) FROMFMT(*MDY)   +
                          TOFMT(*CYMD) TOSEP(*NONE)
             CHGVAR     VAR(&CURDAT) VALUE(&JOBDTE)

   /* Send FUTURE ORDERS STARTING WITH THE NEXT WEEK BEGIN DATE     */
       CALL    PGM(PBPKXFR) PARM('' &CURDAT &PDATE) /* NEXT SUNDAY  */
             CHGVAR     VAR(&FDATEA) VALUE(&PDATE)

 /* GO OUT 7 WEEKS  FOR THE TO DATE -- WEEK ENDING SATURDAY DATE 7 WEEKS OUT */
             CHGVAR     VAR(&NODAYS) VALUE(49)
 CALL    PGM(PBPJXFR) PARM('' &CURDAT &NODAYS &PDATE) /* 7 WEEKS OUT END DATE */
             CHGVAR     VAR(&TDATEA) VALUE(&PDATE)

  /* CREATE DPFUTURE FILE ON AS400 FOR INPUT TO NEXT STEP  */

             EXECUTE    VIEW(DPFUTURE) OUTFILE(QTEMP/DPFUTURE) +
                          SETVAR((&FDATE &FDATEA) (&TDATE &TDATEA)) +
                          MSG(*NO)

  /* RECREATE DP FUTURE ORDERS FILE WITH REQ SHIP DATE RANGED ORDERS */

             CLRPFM     FILE(PBBVCPP)
             CALL       PGM(PBPMXFR) PARM(&RTNCDE)

  /* EMAIL SQL OF ORDERS WITH ITEMS NOT IN DP PRODUCT      */

   /*        EXECUTE    VIEW(DPEXCEPT) PCFMT(*XLS) RECIPIENT(DPEXCEPT)   */

             ENDPGM
