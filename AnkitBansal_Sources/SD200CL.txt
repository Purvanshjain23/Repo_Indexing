/***************************************************************** */
/*                                                                 */
/*  SYSTEM:          SIGNAL DEMAND                                 */
/*  PROGRAM NUMBER:  SD200CL                                       */
/*  PROGRAM NAME:    BUILD FILES FOR SIGNAL DEMAND                 */
/*  PROGRAMMER:      LEANNE RAMSEY                                 */
/*  CREATE DATE:     12/28/07                                      */
/*                                                                 */
/*                                                                 */
/*******************************************************************/
/* MODIFICATIONS:                                                  */
/*                                                                 */
/* 04/09/09  LeAnne Ramsey                                         */
/*           Removed query logic/file SHP203-Datamart: Sales       */
/*           Customer. We will no longer use SHP203; we will build */
/*           our Signal Demand Customer file using the real        */
/*           Customer file.                                        */
/*           AND, since SHP203 was the only "datamart" file being  */
/*           accessed, we no longer needed library PRKDMFLIB.      */
/*******************************************************************/

             PGM

             DCL        VAR(&QDATA) TYPE(*CHAR) LEN(85)
             DCL        VAR(&COMP) TYPE(*DEC) LEN(3 0) VALUE(360)

/*-----------------------------------------------------------------*/
/* CLEAR FILES                                                     */
/*-----------------------------------------------------------------*/
             CLRPFM     FILE(*LIBL/SDP200)  /* Commodity Prices         */
             CLRPFM     FILE(*LIBL/SDP208)  /* Commodity Futures Header */
             CLRPFM     FILE(*LIBL/SDP209)  /* Commodity Futures Detail */

             CLRPFM     FILE(*LIBL/SDP203)  /* Customer         */

             CLRPFM     FILE(*LIBL/SDP201)  /* Item             */
             CLRPFM     FILE(*LIBL/SDP205)  /* Item Structure   */
             CLRPFM     FILE(*LIBL/SDP206)  /* Item BOM         */
             CLRPFM     FILE(*LIBL/SDP218)  /* Item Costs       */

             CLRPFM     FILE(*LIBL/SDP216)  /* Aged Inventory       */
             CLRPFM     FILE(*LIBL/SDP217)  /* Planned Availability */
             CLRPFM     FILE(*LIBL/SDP219)  /* Freezer Allocation   */

             CLRPFM     FILE(*LIBL/SDP212) /* Sales History Header */
             CLRPFM     FILE(*LIBL/SDP213) /* Sales History Detail */

             CLRPFM     FILE(*LIBL/SDP214) /* Open Order Header */
             CLRPFM     FILE(*LIBL/SDP215) /* Open Order Detail */

/*-----------------------------------------------------------------*/
/* BUILD FILES                                                     */
/*-----------------------------------------------------------------*/

/* Commodity prices                                                */
             CALL       PGM(SD200)

/* Commodity futures                                               */
             CALL       PGM(SD208)

/* Item                                                            */
             CALL       PGM(SD201)

/* Item BOM                                                        */
/* Before building the Signal Demand file, clear/build a Synon     */
/* workfile. (Purva has done all the prep work to get the data     */
/* the way Signal Demand wants it. So, we just use her workfile.)  */

             CLRPFM     FILE(PMDYCPP)            /* Synon workfile */
             CALL       PGM(PMUUXFR) PARM('       ' &COMP)
             CALL       PGM(SD206)

/* Item structure                                                  */
             CALL       PGM(SD205)

/* Aged inventory                                                  */
             CALL       PGM(SD216)

/* Planned availability                                            */
             CALL       PGM(SD217)

/* Freezer allocation                                              */
             CALL       PGM(SD219)

/* Item costs                                                      */
             CALL       PGM(SD218)

/* Customer                                                        */
             CALL       PGM(SD203)

/* Sales history (invoiced orders)                                 */

             CALL       PGM(SD212)

/* Open orders                                                     */

             CHGVAR     VAR(&QDATA) VALUE(' ')
             CHGVAR     VAR(%SST(&QDATA 1 14)) VALUE('BEGWST *NE "C"')
             CHGVAR     VAR(%SST(&QDATA 16 19)) VALUE('*AND BEGWST +
                          *NE "X"')
             CHGVAR     VAR(%SST(&QDATA 36 20)) VALUE('*AND BEJNCD +
                          *EQ "OR"')

             OVRDBF     FILE(OPBFCPL1) SHARE(*YES)
             OPNQRYF    FILE((OPBFCPL1)) QRYSLT(&QDATA) KEYFLD(*FILE)  +
                          SEQONLY(*YES)
             CALL       PGM(SD214)
             CLOF       OPNID(OPBFCPL1)
             DLTOVR     FILE(OPBFCPL1)

             ENDPGM

