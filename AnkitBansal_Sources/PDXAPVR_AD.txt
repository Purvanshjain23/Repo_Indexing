// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDXAPVR
// ?Date: 14.08.2025 Time: 03:33:29
// ?------------------------------------------------------------------------------------------------

//?USER: Validate fields

// DTL.Scheduled Delivery Date = CON.*ZERO
DTL.Scheduled_Delivery_Date = *ZERO;

// DTL.Scheduled Delivery Time = CON.*ZERO
DTL.Scheduled_Delivery_Time = *ZERO;

//?CALC: Screen function fields

EXECUTE FUNCTION(TST Scheduled Delivery IF) TYPE(EXCINTFUN)                     AC1456111;
PARAMETER(DTL.Total_Load_Miles);
PARAMETER(DTL.Scheduled_Delivery_Date);
PARAMETER(DTL.Scheduled_Delivery_Time);
PARAMETER(DTL.BOL_Complete_Date);
PARAMETER(DTL.BOL_Complete_Time);
{
 //?Execute internal function

 // PAR.Scheduled Delivery Date = PAR.BOL Complete Date
 PAR.Scheduled_Delivery_Date = PAR.BOL_Complete_Date;

 // PAR.Scheduled Delivery Time = PAR.BOL Complete Time
 PAR.Scheduled_Delivery_Time = PAR.BOL_Complete_Time;

 EXECUTE FUNCTION(RTV Legal Run Miles DscRT) TYPE(RTVOBJ) FILE(PDLGCPP)          AC1456042;
 PARAMETER(PAR.Total_Load_Miles);
 PARAMETER(PAR.Hours_Required);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

 }

 //?get number of whole days + remaining hours
 //?Calculate # whole days + hours left
 CASE;

 // IF PAR.Hours Required is Less than 1 day
 IF PAR.Hours_Required < 24;

 // PAR.@Days 5 = CON.*ZERO
 PAR.@Days_5 = *ZERO;

 // PAR.USR Hours Remaining = PAR.Hours Required
 PAR.USR_Hours_Remaining = PAR.Hours_Required;

 //?Calculate # whole days + hours left
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.@Days 5 = PAR.Hours Required / CON.24 USR Hours Remaining
 PAR.@Days_5 = PAR.Hours_Required / 24 ,REMAINDER: PAR.USR_Hours_Remaining;

 ENDIF;

 //?Add # whole days to current date
 CASE;

 // IF PAR.@Days 5 EQ WRK.ZERO
 IF PAR.@Days_5 = WRK.ZERO;

 //?Add # whole days to current date
 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Scheduled Delivery Date = PAR.Scheduled Delivery Date + PAR.@Days 5 *DAYS
 PAR.Scheduled_Delivery_Date = DATEINCR(PAR.Scheduled_Delivery_Date PAR.@Days_5 'DY'
 1111111 'NONE' 'N' 1);

 ENDIF;

 // WRK.Scheduled Delivery Time = CON.*ZERO + PAR.USR Hours Remaining *HOURS
 WRK.Scheduled_Delivery_Time = TIMEINCR(*ZERO PAR.USR_Hours_Remaining 'HR');

 // PAR.USR Hours Remaining = WRK.Scheduled Delivery Time *HOURS
 PAR.USR_Hours_Remaining = TIMEDTLS(WRK.Scheduled_Delivery_Time 'HR');

 //?Calculate scheduled delivery time; recalc date if past midnight
 CASE;

 // IF PAR.USR Hours Remaining is Not Zero
 IF PAR.USR_Hours_Remaining <> *ZERO;

 // PAR.Estimated Arrival Time = CON.240000 - PAR.Scheduled Delivery Time *HHMMSS
 PAR.Estimated_Arrival_Time = TIMELAPSED(240000 PAR.Scheduled_Delivery_Time 'HS');

 // PAR.USR Hours to Midnight = PAR.Estimated Arrival Time *HOURS
 PAR.USR_Hours_to_Midnight = TIMEDTLS(PAR.Estimated_Arrival_Time 'HR');

 // WRK.USR Period = PAR.Estimated Arrival Time *MINUTES
 WRK.USR_Period = TIMEDTLS(PAR.Estimated_Arrival_Time 'MN');

 // Synon (15,2) work field =       * calc minutes % of hour
 PGM.*Synon_152_work_field = ( 60 - WRK.USR_Period ) / 60;

 // calc hours to midnight
 PAR.USR_Hours_to_Midnight = PAR.USR_Hours_to_Midnight + PGM.*Synon_152_work_field;

 CASE;

 // IF PAR.USR Hours to Midnight LT PAR.USR Hours Remaining
 IF PAR.USR_Hours_to_Midnight < PAR.USR_Hours_Remaining;

 // PAR.Scheduled Delivery Date = PAR.Scheduled Delivery Date + CON.1 *DAYS
 PAR.Scheduled_Delivery_Date = DATEINCR(PAR.Scheduled_Delivery_Date 1 'DY' 1111111 'NONE'
 'N' 1);

 // PAR.USR Hours Remaining = PAR.USR Hours Remaining - PAR.USR Hours to Midnight
 PAR.USR_Hours_Remaining = PAR.USR_Hours_Remaining - PAR.USR_Hours_to_Midnight;

 // PAR.Scheduled Delivery Time = CON.*ZERO + PAR.USR Hours Remaining *HOURS
 PAR.Scheduled_Delivery_Time = TIMEINCR(*ZERO PAR.USR_Hours_Remaining 'HR');

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PAR.Scheduled Delivery Time = PAR.Scheduled Delivery Time + PAR.USR Hours Remain
 PAR.Scheduled_Delivery_Time = TIMEINCR(PAR.Scheduled_Delivery_Time
 PAR.USR_Hours_Remaining 'HR');

 ENDIF;

 ENDIF;

}


