// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBOHXFR
// ?Date: 14.08.2025 Time: 03:48:41
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Auto Inv Rest Cmp RT) TYPE(RTVOBJ) FILE(PDJYREP)           AC2132473;
{
 //?USER: Process Data record

 //?If record is active, process it
 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 //?Determine if Auto Inventory Restoration set up for company
 EXECUTE FUNCTION(RTV WHS Auto Inv Rest  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC2094284;
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.WHS_Auto_Inv_Rest_Co_USR);
 PARAMETER(LCL.WHS_Auto_Inv_Rest_Cnt_USR);
 {
  //?USER: Initialize routine

  // PAR.WHS Auto Inv Rest Co  USR = CND.No
  PAR.WHS_Auto_Inv_Rest_Co_USR = 'N';

  // PAR.WHS Auto Inv Rest Cnt USR = CND.Eq Zero
  PAR.WHS_Auto_Inv_Rest_Cnt_USR = *ZERO;

  // LCL.WHS Auto Inv Rest Cnt USR = CND.Eq Zero
  LCL.WHS_Auto_Inv_Rest_Cnt_USR = *ZERO;

  // LCL.Physical Start Date = JOB.*Job date
  LCL.Physical_Start_Date = JOB.*Job_date;

  //?USER: Process Data record

  CASE;

  // IF DB1.WHS Auto Inv Restoration is Yes
  IF DB1.WHS_Auto_Inv_Restoration = 'Y';

  // PAR.WHS Auto Inv Rest Co  USR = CND.Yes
  PAR.WHS_Auto_Inv_Rest_Co_USR = 'Y';

  EXECUTE FUNCTION(Rtv Auto Inv Rest Cmp  RT) TYPE(RTVOBJ) FILE(OMHCCPP)          AC2094281;
  PARAMETER(PAR.Shipping_Company);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Physical_Start_Date);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   //?USER: Process Data record

   // PGM.*Return code = CND.*Record already exists
   PGM.*Return_code = 'Y2U0003';

  }

  CASE;

  // IF PGM.*Return code is *Record already exists
  IF PGM.*Return_code = 'Y2U0003';

  // LCL.WHS Auto Inv Rest Cnt USR = LCL.WHS Auto Inv Rest Cnt USR + CON.1
  LCL.WHS_Auto_Inv_Rest_Cnt_USR = LCL.WHS_Auto_Inv_Rest_Cnt_USR + 1;

  ENDIF;

  ENDIF;

  //?USER: Exit processing

  // PAR.WHS Auto Inv Rest Cnt USR = LCL.WHS Auto Inv Rest Cnt USR
  PAR.WHS_Auto_Inv_Rest_Cnt_USR = LCL.WHS_Auto_Inv_Rest_Cnt_USR;

 }

 //?Set WHS Auto Inv Rest USR or Send Email if not processed
 CASE;

 // IF LCL.WHS Auto Inv Rest Co  USR is Yes
 IF LCL.WHS_Auto_Inv_Rest_Co_USR = 'Y';

 //?If Count = zero
 CASE;

 // IF LCL.WHS Auto Inv Rest Cnt USR is Eq Zero
 IF LCL.WHS_Auto_Inv_Rest_Cnt_USR = *ZERO;

 //?No Warehouses were processed for Company
 // LCL.WHS Auto Inv Rest Co  USR = CND.No
 LCL.WHS_Auto_Inv_Rest_Co_USR = 'N';

 //?Send Email Message
 // Call program Rtv Alpha Value       XF.
 CALL PROGRAM(Rtv Alpha Value       XF) ('POMTXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER('INVRST');
 PARAMETER(LCL.Email_Address);

 //?If Email address is found, send email
 CASE;

 // IF LCL.Email Address is Entered
 IF LCL.Email_Address <> *BLANK;

 // LCL.Company Number Alpha = CVTVAR(DB1.Company Number)
 LCL.Company_Number_Alpha = CVTVAR(DB1.Company_Number);

 //?S13816 DN 09/28/18-Changed Message Content & use RTV MsgID USR5090.
 // Retrieve message - '*** AUTO INV. RESTORATION not received by 3:30am for Co &1.'
 LCL.Subject_Line_USR = RTVMSG(USR5090);
 PARAMETER(LCL.Company_Number_Alpha);

 //?S13816 DN 09/28/18-Commented Out. Doesn't Work & is Not Required.
 // Execute command - 'ESNDMAIL - Email Address, Subject Line, and Message'
 EXECUTE COMMAND(USR4974);
 PARAMETER(LCL.Email_Address);
 PARAMETER(*BLANK);
 PARAMETER(LCL.Subject_Line_USR);

 ENDIF;

 //?If Count = zero
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?At least one Warehouse was processed for the Company
 // LCL.WHS Auto Inv Rest Co  USR = CND.Yes
 LCL.WHS_Auto_Inv_Rest_Co_USR = 'Y';

 ENDIF;

 //?Set WHS Auto Inv Rest USR or Send Email if not processed
 // IF *OTHERWISE
 IF *OTHERWISE;

 //?This Company is not using Auto Inventory Restoration
 // LCL.WHS Auto Inv Rest Co  USR = CND.No
 LCL.WHS_Auto_Inv_Rest_Co_USR = 'N';

 ENDIF;

 EXECUTE FUNCTION(Rtv Auto Inv Rest Cmp RT) TYPE(RTVOBJ) FILE(CAADREP)           AC2132483;
 PARAMETER(DB1.Company_Number);
 PARAMETER(LCL.WHS_Auto_Inv_Rest_Co_USR);
 {
  //?USER: Process Data record

  //?If Warehouse Auto Inventory Restoration Company, check warehouse
  CASE;

  // IF PAR.WHS Auto Inv Rest Co  USR is Yes
  IF PAR.WHS_Auto_Inv_Rest_Co_USR = 'Y';

  //?If Whs Auto Inventory Restoration Company, get physical count
  CASE;

  // IF DB1.WHS Auto Inv Restoration is Yes
  IF DB1.WHS_Auto_Inv_Restoration = 'Y';

  // LCL.Physical Start Date = JOB.*Job date
  LCL.Physical_Start_Date = JOB.*Job_date;

  EXECUTE FUNCTION(Rtv Auto Inv Rest Cmp  RT) TYPE(RTVOBJ) FILE(OMHCCPP)          AC2094281;
  PARAMETER(DB1.Shipping_Company);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Physical_Start_Date);
  {
   //?USER: Processing if Data record not found

   // PGM.*Return code = CND.*Record does not exist
   PGM.*Return_code = 'Y2U0005';

   //?USER: Process Data record

   // PGM.*Return code = CND.*Record already exists
   PGM.*Return_code = 'Y2U0003';

  }

  //?If record not found, get quantity and weight from Inv Lot Loc
  CASE;

  // IF PGM.*Return code is *Record does not exist
  IF PGM.*Return_code = 'Y2U0005';

  // LCL.Quantity Inv On-Hand USR = CON.*ZERO
  LCL.Quantity_Inv_On_Hand_USR = *ZERO;

  EXECUTE FUNCTION(Rtv Item Loc Qty,Wgt  RT) TYPE(RTVOBJ) FILE(PDL5CPP)           AC1769896;
  PARAMETER(DB1.Shipping_Company);
  PARAMETER(DB1.Warehouse_Code);
  PARAMETER(LCL.Quantity_Inv_On_Hand_USR);
  PARAMETER(LCL.Weight_1_2_U);
  {
   //?USER: Initialize routine

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   // PAR.Quantity Inv On-Hand USR = PAR.Quantity Inv On-Hand USR + DB1.ILL Item Qty On-Hand
   PAR.Quantity_Inv_On_Hand_USR = PAR.Quantity_Inv_On_Hand_USR + DB1.ILL_Item_Qty_On_Hand;

   // PAR.Weight 1.2             .U = PAR.Weight 1.2             .U + DB1.ILl Item Wgt On-Hand
   PAR.Weight_1_2_U = PAR.Weight_1_2_U + DB1.ILL_Item_Wgt_On_Hand;

  }

  //?If retrieved quantity > 0, send email message
  CASE;

  // IF LCL.Quantity Inv On-Hand USR is Greater than Zero
  IF LCL.Quantity_Inv_On_Hand_USR > *ZERO;

  //?Send Email Message
  // Call program Rtv Alpha Value       XF.
  CALL PROGRAM(Rtv Alpha Value       XF) ('POMTXFR');
  PARAMETER(DB1.Shipping_Company);
  PARAMETER('INVRST');
  PARAMETER(LCL.Email_Address);

  //?If email address exists, build and send message
  CASE;

  // IF LCL.Email Address is Entered
  IF LCL.Email_Address <> *BLANK;

  // LCL.Text USR 43 = CONCAT(CON.Inventory Restoration,CON.Did NOT POST for:,CON.1)
  LCL.Text_USR_43 = 'Inventory Restoration' + 'Did NOT POST for:' (1);

  // LCL.Office Message USR = CONCAT(LCL.Text USR 43,DB1.Warehouse Code,CON.2)
  LCL.Office_Message_USR = LCL.Text_USR_43 + DB1.Warehouse_Code (2);

  // Execute command - 'ESNDMAIL'
  EXECUTE COMMAND(USR4703);
  PARAMETER(LCL.Email_Address);
  PARAMETER(LCL.Office_Message_USR);

  ENDIF;

  ENDIF;

  ENDIF;

  ENDIF;

  ENDIF;

 }

 ENDIF;

}


