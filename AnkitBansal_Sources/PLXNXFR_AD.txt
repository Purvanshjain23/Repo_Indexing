// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLXNXFR
// ?Date: 14.08.2025 Time: 02:55:43
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications and Comments
DO;

//?E4154 JJH 07/22/15 - Pen Revisions
//?- New function which will determine if the Pen Maximum Capacity
//?  exceeded.
//?- Current Pen Head + Sum of Un-Printed Scale Tickes + Additional
//?  Head is compared to the Pen Max Capacity.
//?H16853 ISE 11/05/2020 - Recompiled due to change in Buy Order Number
ENDDO;

//?Get Pen Current Head and Pen Maximum Capacity
EXECUTE FUNCTION(Rtv Pen Head/Max Cap  RT) TYPE(RTVOBJ) FILE(PKA3REP)           AB1325769;
PARAMETER(PAR.Pen_Company_Number);
PARAMETER(PAR.Pen_Number);
PARAMETER(LCL.Pen_Maximun_Capacity);
PARAMETER(LCL.Pen_Current_Head);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Get Sum of Un-Printed Tattoo Scale Tickets for Pen
EXECUTE FUNCTION(Rtv TtoSclTkt Hd N/P USR) TYPE(RTVOBJ) FILE(PKB3CPP)           AB1325770;
PARAMETER(PAR.Pen_Company_Number);
PARAMETER(PAR.Pen_Number);
PARAMETER(LCL.Pen_Tto_Scl_Tkt_Head_USR);
{
 //?USER: Initialize routine

 // LCL.Pen Tto Scl Tkt Head USR = CON.*ZERO
 LCL.Pen_Tto_Scl_Tkt_Head_USR = *ZERO;

 //?USER: Process Data record

 CASE;

 // IF DB1.RS Record Status is Active
 IF DB1.RS_Record_Status = 'A';

 // LCL.Pen Tto Scl Tkt Head USR = DB1.TST Head + LCL.Pen Tto Scl Tkt Head USR
 LCL.Pen_Tto_Scl_Tkt_Head_USR = DB1.TST_Head + LCL.Pen_Tto_Scl_Tkt_Head_USR;

 ENDIF;

 //?USER: Exit processing

 // PAR.Pen Tto Scl Tkt Head USR = LCL.Pen Tto Scl Tkt Head USR
 PAR.Pen_Tto_Scl_Tkt_Head_USR = LCL.Pen_Tto_Scl_Tkt_Head_USR;

}


//?Calculate the Pen Head Total = Pen Current Head + Sum of Un-Prt
//?Tatto Scale Ticket + Pen Additional Head
// LCL.Pen Head Total       USR =       *
LCL.Pen_Head_Total_USR = ( LCL.Pen_Current_Head + LCL.Pen_Tto_Scl_Tkt_Head_USR )                   +
+ PAR.Pen_Additional_Head_USR;

//?Determine if Pen Maximum Capacity Exceeded
CASE;

// IF LCL.Pen Head Total       USR GT LCL.Pen Maximun Capacity
IF LCL.Pen_Head_Total_USR > LCL.Pen_Maximun_Capacity;

// PAR.Pen Exceeds Max Cap USR = CND.Yes
PAR.Pen_Exceeds_Max_Cap_USR = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.Pen Exceeds Max Cap USR = CND.No
PAR.Pen_Exceeds_Max_Cap_USR = 'N';

ENDIF;

//?Output Sum of Un-Printed Tattoo Scale Tickets for Pen
// PAR.Pen Tto Scl Tkt Head USR = LCL.Pen Tto Scl Tkt Head USR
PAR.Pen_Tto_Scl_Tkt_Head_USR = LCL.Pen_Tto_Scl_Tkt_Head_USR;

