// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POFNXFR
// ?Date: 14.08.2025 Time: 03:37:01
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Create Item Download file for Tom Dye
EXECUTE FUNCTION(Rtv Build ItmDwnlWrkf RT) TYPE(RTVOBJ) FILE(CABZREP)           AC1601871;
PARAMETER(PAR.Company_Number);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(RTV Market Price       RT) TYPE(RTVOBJ) FILE(OMF0CPP)          AC1199313;
 PARAMETER(DB1.Default_Commod_Mark_basis);
 PARAMETER(DB1.Commodity_Price_Group);
 PARAMETER(PAR.Market_Price_Date);
 PARAMETER(WRK.Commodity_Market_Price);
 PARAMETER(LCL.USR_Market_Pricing_Date);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  // PAR.Commodity Market Price = DB1.Commodity Market Price
  PAR.Commodity_Market_Price = DB1.Commodity_Market_Price;

  // PAR.USR Date Priced = DB1.Market Price Date
  PAR.USR_Date_Priced = DB1.Market_Price_Date;

  QUIT;

 }

 // WRK.USR Price per Pricing U/M = DB1.Standard Overage/Underage + WRK.Commodity Market Price
 WRK.USR_Price_per_Pricing_U_M = DB1.Standard_Overage_Underage
 + WRK.Commodity_Market_Price;

 // LCL.U/M - Pricing = DB1.U/M - Pricing
 LCL.UOM_Pricing = DB1.UOM_Pricing;

 // Call program CLC Convert Price Qtys XF.
 CALL PROGRAM(CLC Convert Price Qtys XF) ('PDKGXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(LCL.UOM_Pricing);
 PARAMETER(WRK.Price_based_on_U_M1_S);
 PARAMETER(WRK.Price_based_on_U_M2_S);
 PARAMETER(WRK.Price_based_on_U_M3_S);
 PARAMETER(WRK.USR_Price_per_Pricing_U_M);

 CASE;

 // IF WRK.Price based on U/M1 S is Not Zeros
 IF WRK.Price_based_on_U_M1_S <> *ZERO;

 // LCL.USR Price per Pricing U/M = WRK.Price based on U/M1 S / DB1.Unit Weight *
 LCL.USR_Price_per_Pricing_U_M = WRK.Price_based_on_U_M1_S / DB1.Unit_Weight;

 ENDIF;

 EXECUTE FUNCTION(Create W008 Company/Item) TYPE(CRTOBJ) FILE(POAPCPP)           AC1601866;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Description_Line_One);
 PARAMETER(DB1.Default_Commod_Mark_basis);
 PARAMETER(DB1.Commodity_Price_Group);
 PARAMETER(PAR.Market_Price_Date);
 PARAMETER(LCL.USR_Price_per_Pricing_U_M);
}


