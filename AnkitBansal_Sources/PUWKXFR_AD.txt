// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PUWKXFR
// ?Date: 14.08.2025 Time: 03:51:34
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?On not shipped orders, update consignr on "A" doc with consignor on "H"
EXECUTE FUNCTION(Rtv/Chg Consignor FIX  RT) TYPE(RTVOBJ) FILE(PDMRREP)          AC2205979;
{
 //?USER: Initialize routine

 // LCL.Date From             USR = CON.1220627
 LCL.Date_From_USR = 1220627;

 //?USER: Process Data record

 CASE;

 // IF DB1.ED Export Document Type is Application for Export
 IF DB1.ED_Export_Document_Type = 'A';

 EXECUTE FUNCTION(RTV Header Status      RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1231329;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Header_Status);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Header Status is Avail/Alloc/Enter/Hold
 IF LCL.Header_Status = 'L'/'A'/'E'/'H';

 EXECUTE FUNCTION(Rtv SchShpDte         RT) TYPE(RTVOBJ) FILE(OPBFCPP)           AC2079195;
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Scheduled_Ship_Date);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Scheduled Ship Date GT LCL.Date From             USR
 IF LCL.Scheduled_Ship_Date > LCL.Date_From_USR;

 EXECUTE FUNCTION(Rtv Consignee/Consgnr2 RT) TYPE(RTVOBJ) FILE(PDMRREP)          AC2191691;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER('H');
 PARAMETER(LCL.Country_Code);
 PARAMETER(LCL.ED_Consignor_Name);
 PARAMETER(LCL.ED_Consignor_Addr_1);
 PARAMETER(LCL.ED_Consignor_Addr_2);
 PARAMETER(LCL.ED_Consignor_Addr_3);
 PARAMETER(LCL.ED_Consignor_Addr_4);
 PARAMETER(LCL.ED_Consignor_State);
 PARAMETER(LCL.ED_Consignor_Postal);
 PARAMETER(LCL.ED_Consignor_Country_Code);
 PARAMETER(LCL.ED_Consignee_Name);
 PARAMETER(LCL.ED_Consignee_Addr_1);
 PARAMETER(LCL.ED_Consignee_Addr_2);
 PARAMETER(LCL.ED_Consignee_Addr_3);
 PARAMETER(LCL.ED_Consignee_Addr_4);
 PARAMETER(LCL.ED_Consignee_State);
 PARAMETER(LCL.ED_Consignee_Postal);
 PARAMETER(LCL.ED_Consignee_Country_Code);
 PARAMETER(LCL.ED_Shipping_Marks_Txt);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  QUIT;

 }

 EXECUTE FUNCTION(Chg Exp Doc Consignor  CH) TYPE(CHGOBJ) FILE(PDMRREP)          AC2205981;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.ED_Export_Document_Type);
 PARAMETER(DB1.Country_Code);
 PARAMETER(LCL.ED_Consignor_Name);
 PARAMETER(LCL.ED_Consignor_Addr_1);
 PARAMETER(LCL.ED_Consignor_Addr_2);
 PARAMETER(LCL.ED_Consignor_Addr_3);
 PARAMETER(LCL.ED_Consignor_Addr_4);
 PARAMETER(LCL.ED_Consignor_State);
 PARAMETER(LCL.ED_Consignor_Postal);
 PARAMETER(LCL.ED_Consignor_Country_Code);
 {
  //?USER: Processing after Data read

  //?* E00994 Susan Mason
  //?* these functions will execute the new routines
  //?* that will create records to the comment file
  //?* if the consignee or consignor changed
  CASE;

  // IF DB1.ED Export Document Type is MPD
  IF DB1.ED_Export_Document_Type = 'H';

  // OR DB1.ED Export Document Type is 9290/9285/9295/9115/9450
  OR DB1.ED_Export_Document_Type = 'E';

  //?R16637 DN 09/11/20-Pass in New Consignor/Consignee Fields.
  // Call program Rtv/Consignor/ConsigneXF.
  CALL PROGRAM(Rtv/Consignor/ConsigneXF) ('PNVIXFR');
  PARAMETER(JOB.*PROGRAM);
  PARAMETER(DB1.ED_Consignor_Name);
  PARAMETER(DB1.ED_Consignor_Addr_1);
  PARAMETER(DB1.ED_Consignor_Addr_2);
  PARAMETER(DB1.ED_Consignor_Addr_3);
  PARAMETER(DB1.ED_Consignor_Addr_4);
  PARAMETER(DB1.ED_Consignor_State);
  PARAMETER(DB1.ED_Consignor_Postal);
  PARAMETER(DB1.ED_Consignor_Country_Code);
  PARAMETER(DB1.ED_Consignee_Name);
  PARAMETER(DB1.ED_Consignee_Addr_1);
  PARAMETER(DB1.ED_Consignee_Addr_2);
  PARAMETER(DB1.ED_Consignee_Addr_3);
  PARAMETER(DB1.ED_Consignee_Addr_4);
  PARAMETER(DB1.ED_Consignee_State);
  PARAMETER(DB1.ED_Consignee_Postal);
  PARAMETER(DB1.ED_Consignee_Country_Code);
  PARAMETER(PAR.Company_Number);
  PARAMETER(PAR.Order_Number);
  PARAMETER(PAR.ED_Export_Document_Type);
  PARAMETER(PAR.Country_Code);
  PARAMETER(PAR.ED_Area_Office);
  PARAMETER(PAR.ED_Destination);
  PARAMETER(PAR.ED_Consignor_Name);
  PARAMETER(PAR.ED_Consignor_Addr_1);
  PARAMETER(PAR.ED_Consignor_Addr_2);
  PARAMETER(PAR.ED_Consignor_Addr_3);
  PARAMETER(PAR.ED_Consignor_Addr_4);
  PARAMETER(PAR.ED_Consignor_State);
  PARAMETER(PAR.ED_Consignor_Postal);
  PARAMETER(PAR.ED_Consignor_Country_Code);
  PARAMETER(PAR.ED_Consignee_Name);
  PARAMETER(PAR.ED_Consignee_Addr_1);
  PARAMETER(PAR.ED_Consignee_Addr_2);
  PARAMETER(PAR.ED_Consignee_Addr_3);
  PARAMETER(PAR.ED_Consignee_Addr_4);
  PARAMETER(PAR.ED_Consignee_State);
  PARAMETER(PAR.ED_Consignee_Postal);
  PARAMETER(PAR.ED_Consignee_Country_Code);

  ENDIF;

  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 ENDIF;

 ENDIF;

}


