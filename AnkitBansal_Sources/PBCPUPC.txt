/***************************************************************** */
/*                                                                 */
/*  PROGRAM NUMBER:  PBCPUPC                                       */
/*  PROGRAM NAME:    PURGE TRAILER RECORDS USING SQL DELETE        */
/*  PROGRAMMER:      LARA BUSER                                    */
/*  CREATE DATE:     03/12/2012                                    */
/*                                                                 */
/*  FUNCTION:        THIS CL WILL USE SQL TO DELETE RECORDS        */
/*                   THAT HAVE ON YARD STATUS <>"Y",               */
/*                   ASSIGNED STATUS <> "N",                       */
/*                   AVAILABLE STATUS <> "Y",                      */
/*                   AND RECORD STATUS <> "A"                      */
/*  NOTES:           NUMBER OF MONTHS RETENTION HAS NO MEANING     */
/*                   HERE SINCE TRAILER FILE HAS NO DATES.         */
/*  PARAMETERS:                                                    */
/*    &PURGEDATE  7.0  PURGE THROUGHD DATE                         */
/*    &PRGLIB    10    GROUP CODE LIBRARY                          */
/*    &FILENAME  10    FILE TO PURGE                               */
/*    &FIELDNAME  6    FIELD NAME IN THE FILE TO USE               */
/*******************************************************************/
/*  Modification History                                           */
/*  99/99/9999 XXX X999999                                         */
/*                                                                 */
/*******************************************************************/
             PGM        PARM(&RTNCODE &PURGEDATE &PCGCODE &PCGLIB +
                          &PCAPPLIC &FILENAME &PCFLGL &PCFTAPE +
                          &PCFIELD &DATEFMT)

             DCL        VAR(&RTNCODE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&PURGEDATE) TYPE(*DEC) LEN(7 0)
             DCL        VAR(&PCGCODE) TYPE(*CHAR) LEN(3)
             DCL        VAR(&PCGLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCAPPLIC) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FILENAME) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFLGL) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFTAPE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PCFIELD) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DATEFMT) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PRGDATE) TYPE(*CHAR) LEN(7)
             DCL        VAR(&PURGEDATEA) TYPE(*CHAR)  LEN(8)
             DCL        VAR(&SEL)  TYPE(*CHAR) LEN(100) /* SELECT */

             MONMSG     MSGID(CPF0000 SQL0000) EXEC(GOTO +
                          CMDLBL(DLTRAILER))
/*-------------------------------------------------------------------*/
/* TRAILER FILE IS NOT PURGED BY DATE (NO DATE IN FILE TO USE)       */
/*-------------------------------------------------------------------*/
             CHGVAR     VAR(&PRGDATE) VALUE(&PURGEDATE)
             CHGVAR     VAR(&PURGEDATEA) VALUE(&PRGDATE)

/*-------------------------------------------------------------------*/
/*                          MAINLINE                                 */
/*-------------------------------------------------------------------*/
/* Delete from TRAILER FILE, KEEP ONLY ON YARD = "Y", ASSIGNED= "N", */
/*   AVAILABLE = "Y" AND RECORD STATUS = "A"                         */

             DELETE     SQL('FROM PDLYREL0 WHERE  LYSTOY <> ''Y'' ') +
                          OPTIMIZE(*MINWAIT)
             DELETE     SQL('FROM PDLYREL0 WHERE LYSTAS <> ''N''') +
                          OPTIMIZE(*MINWAIT)
             DELETE     SQL('FROM PDLYREL0 WHERE LYXRST <> ''Y''') +
                          OPTIMIZE(*MINWAIT)
             DELETE     SQL('FROM PDLYREL0 WHERE  LYVSST <> ''A''') +
                          OPTIMIZE(*MINWAIT)

/* Successful Completion */
             GOTO       CMDLBL(ENDPGM)
/*-------------------------------------------------------------------*/
/*                       ERROR MESSAGES                              */
/*-------------------------------------------------------------------*/
 DLTRAILER:  CHGVAR     VAR(&RTNCODE) VALUE('SQLERR')

/*-------------------------------------------------------------------*/
/*                        PROGRAM END                                */
/*-------------------------------------------------------------------*/
 ENDPGM:     ENDPGM
