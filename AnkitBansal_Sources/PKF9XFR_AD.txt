// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PKF9XFR
// ?Date: 14.08.2025 Time: 02:51:29
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?H16853 ISE 11/09/2020 - Recompiled due to change in Buy Order Number
EXECUTE FUNCTION(Exc Print Drive Card  IF) TYPE(EXCINTFUN)                      AB1184187;
PARAMETER(PAR.Pen_Number);
PARAMETER(PAR.Pen_Company_Number);
PARAMETER(WRK.Last_Drive_Card_Number);
PARAMETER(WRK.TDP_Process_Code);
PARAMETER(WRK.Pen_Sts);
{
 //?Execute internal function

 //?Get Next Drive Card Nbr
 EXECUTE FUNCTION(Rtv/Upd Last Drv Crd  RT) TYPE(RTVOBJ) FILE(PKAZREP)           AB1117402;
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER(PAR.Last_Drive_Card_Number);
 {
  //?USER: Processing if Data record not found

  // PAR.Last Drive Card Number = CON.1
  PAR.Last_Drive_Card_Number = 1;

  //?USER: Process Data record

  // PAR.Last Drive Card Number = DB1.Last Drive Card Number + CON.1
  PAR.Last_Drive_Card_Number = DB1.Last_Drive_Card_Number + 1;

  EXECUTE FUNCTION(Chg Last Drv Crd      CH) TYPE(CHGOBJ) FILE(PKAZREP)           AB1117417;
  PARAMETER(DB1.CC_Company_Number);
  PARAMETER(PAR.Last_Drive_Card_Number);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
   PARAMETER(DB1.RS_User_Changed);
   PARAMETER(DB1.RS_Date_Changed);
   PARAMETER(DB1.RS_Time_Changed);
   PARAMETER(DB1.RS_Job);
   PARAMETER(DB1.RS_Program);
   {
    //?Execute internal function

    // PAR.RS User Changed = JOB.*USER
    PAR.RS_User_Changed = JOB.*USER;

    // PAR.RS Date Changed = JOB.*Job date
    PAR.RS_Date_Changed = JOB.*Job_date;

    // PAR.RS Time Changed = JOB.*Job time
    PAR.RS_Time_Changed = JOB.*Job_time;

    // PAR.RS Job = JOB.*JOB
    PAR.RS_Job = JOB.*JOB;

    // PAR.RS Program = JOB.*PROGRAM
    PAR.RS_Program = JOB.*PROGRAM;

   }

  }

 }

 //?Clear Drive Card Work file
 EXECUTE FUNCTION(Rtv/Dlt Drv Crd Wrk   RT) TYPE(RTVOBJ) FILE(PKCTCPP)           AB1135868;
 PARAMETER(PAR.BOH_Company_Number);
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(Delete Drive Card Work) TYPE(DLTOBJ) FILE(PKCTCPP)             AB1134512;
  PARAMETER(DB1.Pen_Company_Number);
  PARAMETER(DB1.Pen_Number);
  PARAMETER(DB1.DCW_Sequence_Number);
 }

 //?Retrieve/Change the Pen's Tattoo Dtls: Drive card nbr ,process code
 //? and Create Drive Card Work records for print routine
 EXECUTE FUNCTION(Rtv/Chg TttDtl Drvcrd RT) TYPE(RTVOBJ) FILE(PKA2CPP)           AB1117429;
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER(PAR.Last_Drive_Card_Number);
 PARAMETER(PAR.Pen_Number);
 PARAMETER(PAR.TDP_Process_Code);
 {
  //?USER: Initialize routine

  // WRK.DCW Sequence Number = CON.*ZERO
  WRK.DCW_Sequence_Number = *ZERO;

  //?USER: Process Data record

  // PAR.TDP Process Code = CND.Drive Card Printed
  PAR.TDP_Process_Code = 'D';

  EXECUTE FUNCTION(Chg Tattoo Detail     CH) TYPE(CHGOBJ) FILE(PKA2CPP)           AB1101751;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(DB1.TD_Sequence_Number);
  PARAMETER(DB1.TD_Live_Wgt);
  PARAMETER(DB1.TD_Pen_Head);
  PARAMETER(DB1.TD_Yard_Dead);
  PARAMETER(DB1.TD_Held_Over);
  PARAMETER(DB1.TD_Held_Over_Status);
  PARAMETER(DB1.TD_Drive_Time);
  PARAMETER(DB1.TD_Drive_Hour);
  PARAMETER(PAR.TD_Drive_Card_Number);
  PARAMETER(DB1.TD_Avg_Live_Wgt);
  PARAMETER(DB1.TD_Gen_Bal_To_Kill);
  PARAMETER(DB1.TD_Recs_Created_for_HO);
  PARAMETER(DB1.TD_User_Status_2);
  PARAMETER(DB1.TD_User_Status_3);
  PARAMETER(DB1.TD_User_Date_1);
  PARAMETER(DB1.TD_User_Date_2);
  PARAMETER(DB1.TD_Drive_Date);
  PARAMETER(DB1.Pen_Company_Number);
  PARAMETER(DB1.Pen_Number);
  PARAMETER(PAR.TDP_Process_Code);
  PARAMETER(DB1.Held_Over_Pen_Company_Num);
  PARAMETER(DB1.Held_Over_Pen_Number);
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Record_Status);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  PARAMETER(DB1.RS_User_Added);
  PARAMETER(DB1.RS_Date_Added);
  PARAMETER(DB1.RS_Time_Added);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
   PARAMETER(DB1.RS_User_Changed);
   PARAMETER(DB1.RS_Date_Changed);
   PARAMETER(DB1.RS_Time_Changed);
   PARAMETER(DB1.RS_Job);
   PARAMETER(DB1.RS_Program);
   {
    //?Execute internal function

    // PAR.RS User Changed = JOB.*USER
    PAR.RS_User_Changed = JOB.*USER;

    // PAR.RS Date Changed = JOB.*Job date
    PAR.RS_Date_Changed = JOB.*Job_date;

    // PAR.RS Time Changed = JOB.*Job time
    PAR.RS_Time_Changed = JOB.*Job_time;

    // PAR.RS Job = JOB.*JOB
    PAR.RS_Job = JOB.*JOB;

    // PAR.RS Program = JOB.*PROGRAM
    PAR.RS_Program = JOB.*PROGRAM;

   }

  }

  //?Build and Create Drive Card Work file record for print
  EXECUTE FUNCTION(Rtv Ttt Hdr Purch Dt  RT) TYPE(RTVOBJ) FILE(PKA1CPP)           AB1134522;
  PARAMETER(DB1.BOH_Company_Number);
  PARAMETER(DB1.BOH_Buy_Order_Number);
  PARAMETER(DB1.BOL_Load_Number);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(DB1.TH_Kill_Date);
  PARAMETER(WRK.TH_Purchase_Date);
  {
   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  // WRK.DCW Sequence Number = WRK.DCW Sequence Number + CON.1
  WRK.DCW_Sequence_Number = WRK.DCW_Sequence_Number + 1;

  // WRK.DCW Pen Head = DB1.TD Pen Head - DB1.TD Yard Dead
  WRK.DCW_Pen_Head = DB1.TD_Pen_Head - DB1.TD_Yard_Dead;

  EXECUTE FUNCTION(Create Drive Card Work) TYPE(CRTOBJ) FILE(PKCTCPP)             AB1134510;
  PARAMETER(DB1.Pen_Company_Number);
  PARAMETER(DB1.Pen_Number);
  PARAMETER(WRK.DCW_Sequence_Number);
  PARAMETER(WRK.TH_Purchase_Date);
  PARAMETER(DB1.TH_Tattoo_Number);
  PARAMETER(WRK.DCW_Pen_Head);
  PARAMETER(PAR.TD_Drive_Card_Number);
  PARAMETER(DB1.TH_Kill_Date);
 }

 // Call program Rtv Cmp Val Num & Incr XF.
 CALL PROGRAM(Rtv Cmp Val Num & Incr XF) ('PMVCXFR');
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER('HPEDRVSEQ');
 PARAMETER(LCL.System_Value_Numeric_USR);

 // WRK.Pen Drive Sequence = LCL.System Value Numeric  USR
 WRK.Pen_Drive_Sequence = LCL.System_Value_Numeric_USR;

 //?Rtv/Chg the Pen: Drive card nbr, drive seq, and status 'C'losed
 EXECUTE FUNCTION(Rtv/Chg Pen DrvCrdPrt RT) TYPE(RTVOBJ) FILE(PKA3REP)           AB1117442;
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER(PAR.Pen_Number);
 PARAMETER(PAR.Last_Drive_Card_Number);
 PARAMETER(PAR.Pen_Sts);
 PARAMETER(WRK.Pen_Drive_Sequence);
 {
  //?USER: Process Data record

  // PAR.Pen Sts = CND.Closed
  PAR.Pen_Sts = 'C';

  EXECUTE FUNCTION(Chg Pen               CH) TYPE(CHGOBJ) FILE(PKA3REP)           AB1102758;
  PARAMETER(DB1.Pen_Company_Number);
  PARAMETER(DB1.Pen_Number);
  PARAMETER(DB1.Pen_Description);
  PARAMETER(DB1.Pen_Maximun_Capacity);
  PARAMETER(DB1.Pen_Current_Head);
  PARAMETER(PAR.Pen_Current_Drive_Card_No);
  PARAMETER(PAR.Pen_Sts);
  PARAMETER(PAR.Pen_Drive_Sequence);
  PARAMETER(DB1.Pen_Type);
  PARAMETER(*ZERO);
  PARAMETER(DB1.GN_Genetic_Code);
  PARAMETER(DB1.RS_User_Changed);
  PARAMETER(DB1.RS_Date_Changed);
  PARAMETER(DB1.RS_Time_Changed);
  PARAMETER(DB1.RS_Record_Status);
  PARAMETER(DB1.RS_Job);
  PARAMETER(DB1.RS_Program);
  PARAMETER(DB1.RS_User_Added);
  PARAMETER(DB1.RS_Date_Added);
  PARAMETER(DB1.RS_Time_Added);
  {
   //?USER: Processing before Data update

   EXECUTE FUNCTION(Rtv Change Stamp      IF) TYPE(EXCINTFUN)                      AB1100934;
   PARAMETER(DB1.RS_User_Changed);
   PARAMETER(DB1.RS_Date_Changed);
   PARAMETER(DB1.RS_Time_Changed);
   PARAMETER(DB1.RS_Job);
   PARAMETER(DB1.RS_Program);
   {
    //?Execute internal function

    // PAR.RS User Changed = JOB.*USER
    PAR.RS_User_Changed = JOB.*USER;

    // PAR.RS Date Changed = JOB.*Job date
    PAR.RS_Date_Changed = JOB.*Job_date;

    // PAR.RS Time Changed = JOB.*Job time
    PAR.RS_Time_Changed = JOB.*Job_time;

    // PAR.RS Job = JOB.*JOB
    PAR.RS_Job = JOB.*JOB;

    // PAR.RS Program = JOB.*PROGRAM
    PAR.RS_Program = JOB.*PROGRAM;

   }

  }

 }

 //?**********************************
 //?  Print Drive Card
 //?**********************************
 EXECUTE FUNCTION(Prt Drive Card        IF) TYPE(EXCINTFUN)                      AB1231896;
 PARAMETER(PAR.BOH_Company_Number);
 PARAMETER(PAR.Pen_Number);
 {
  //?Execute internal function

  // Call program Rtv Company Values    XF.
  CALL PROGRAM(Rtv Company Values    XF) ('PDGKXFR');
  PARAMETER(PAR.Pen_Company_Number);
  PARAMETER('HPEDRVCRD');
  PARAMETER(LCL.System_Value_Alpha_USR);

  // LCL.PRT Printer Device = LCL.System Value Alpha    USR
  LCL.PRT_Printer_Device = LCL.System_Value_Alpha_USR;

  // Execute command - 'OVRPRTF Printer'
  EXECUTE COMMAND(PRK0941);
  PARAMETER('PKOZPFR$');
  PARAMETER(LCL.PRT_Printer_Device);

  // Call program Prt Drive Card        PF.
  CALL PROGRAM(Prt Drive Card        PF) ('PKOZPFR');
  PARAMETER(PAR.Pen_Company_Number);
  PARAMETER(PAR.Pen_Number);

 }

}


