// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PURKPVR
// ?Date: 14.08.2025 Time: 03:51:11
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?WRK used for setting the Email to Warehouse flag
// WRK.First Time Flag = CND.Yes
WRK.First_Time_Flag = 'Y';

//?LCL used for changing Regional Salesperson flag
// LCL.First Time Flag = CND.Yes
LCL.First_Time_Flag = 'Y';

//?USER: Load screen

//?Initialize screen Print and Status flags to No
CASE;

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Print (Yes/No) USR = CND.No
DTL.Print_Yes_No_USR = 'N';

// DTL.Status Flag 2  Y/N = CND.No
DTL.Status_Flag_2_Y_N = 'N';

// DTL.Status Flag 3  Y/N = CND.No
DTL.Status_Flag_3_Y_N = 'N';

// DTL.Status Flag 7  Y/N = CND.No
DTL.Status_Flag_7_Y_N = 'N';

// DTL.Status Flag 8  Y/N = CND.No
DTL.Status_Flag_8_Y_N = 'N';

ENDIF;

//?Retrieve Warehouse Code and Country for Warehouse Dist List
EXECUTE FUNCTION(RTV Chk DtlExists Info RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC2062446;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.Warehouse_Code);
PARAMETER(LCL.Country_Code);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

 MOVE *ALL (To: PAR From: DB1);

}


//?MSG 'Order has no line items'
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// Send information message - 'Warning:  Order has no line items'
MESSAGE(USR2058 *INFO);

ENDIF;

//?If Country is Japan, retrieve Warehouse Type and OHE Booking Nbr
CASE;

// IF LCL.Country Code is Japan
IF LCL.Country_Code = 'JPN';

EXECUTE FUNCTION(RTV Warehouse Type     RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1285482;
PARAMETER(LCL.Warehouse_Code);
PARAMETER(LCL.Warehouse_Type);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(RTV Booking # f/ord   RT) TYPE(RTVOBJ) FILE(PMAMREP)           AC2069357;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.OHE_Booking_Number);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 QUIT;

}


ENDIF;

EXECUTE FUNCTION(Rtv Whs Dist Email    RT) TYPE(RTVOBJ) FILE(PNGVREP)           AC2062676;
PARAMETER(LCL.Warehouse_Code);
PARAMETER('SL-ACKNOWL');
PARAMETER(LCL.Email_To_Whs);
{
 //?USER: Initialize routine

 // PAR.Email To Whs = CND.no
 PAR.Email_To_Whs = 'N';

 //?USER: Process Data record

 CASE;

 // IF DB1.Record Status is Active
 IF DB1.Record_Status = 'A';

 // PAR.Email To Whs = CND.yes
 PAR.Email_To_Whs = 'Y';

 QUIT;

 ENDIF;

}


//?First time, check Email to Warehouse flag
CASE;

// IF WRK.First Time Flag is Yes
IF WRK.First_Time_Flag = 'Y';

// WRK.First Time Flag = CND.NO
WRK.First_Time_Flag = 'N';

//?If Email to Warehouse flag is Yes
CASE;

// IF LCL.Email To Whs is yes
IF LCL.Email_To_Whs = 'Y';

// DTL.Status Flag 8  Y/N = CND.Yes
DTL.Status_Flag_8_Y_N = 'Y';

ENDIF;

ENDIF;

//?* Load Plan Ready will be a hidden field/unavailable  2386/4119
//?C2586  05/16/13 RMC Dft reg sls mgr email=Y if one is found
//?Default Regional Sales Manager Email
CASE;

// IF DTL.Print (Yes/No) USR is *yes/no
IF DTL.Print_Yes_No_USR = 'N'/'Y';

EXECUTE FUNCTION(RTV Order/ShipState    RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1718268;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(LCL.Ship_To_State_Code);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(PDLWREP)          AC1718261;
PARAMETER(LCL.Ship_To_State_Code);
PARAMETER(LCL.Salesperson_Name);
PARAMETER(LCL.Fax_Phone_Number);
PARAMETER(LCL.Regional_Salesperson_Code);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.Territory State        NF
 PGM.*Return_code = 'USR0650';

 //?USER: Process Data record

 // PAR.Salesperson Name = CON.*BLANK
 PAR.Salesperson_Name = *BLANK;

 // PAR.Fax Number FF = CON.*BLANK
 PAR.Fax_Number_FF = *BLANK;

 EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(PDLVREP)          AC1718262;
 PARAMETER(DB1.Territory_Code);
 PARAMETER(PAR.Regional_Salesperson_Code);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  QUIT;

 }

 CASE;

 // IF PGM.*Return code is *Normal
 IF PGM.*Return_code = *BLANK;

 EXECUTE FUNCTION(RTV Reg Sls Mgr FaxOnlyRT) TYPE(RTVOBJ) FILE(CAAPREP)          AC1718263;
 PARAMETER(PAR.Regional_Salesperson_Code);
 PARAMETER(PAR.Salesperson_Name);
 PARAMETER(PAR.Fax_Number_FF);
 {
  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

  // PGM.*Return code = CND.*Normal
  PGM.*Return_code = *BLANK;

  QUIT;

 }

 // IF *OTHERWISE
 IF *OTHERWISE;

 QUIT;

 ENDIF;

}


// DTL.Salesperson Code = LCL.Regional Salesperson Code
DTL.Salesperson_Code = LCL.Regional_Salesperson_Code;

// Call program Exc Rtv Reg Sls Email  XF.
CALL PROGRAM(Exc Rtv Reg Sls Email  XF) ('PBISXFR');
PARAMETER(LCL.Regional_Salesperson_Code);
PARAMETER(LCL.Email_Address);

//?If Email Address or Fax is entered, load Salesperson Name
CASE;

// IF LCL.Email Address is Entered
IF LCL.Email_Address <> *BLANK;

// OR LCL.Fax Phone Number is NE Blanks
OR LCL.Fax_Phone_Number <> *BLANK;

// DTL.Text USR 7 = LCL.Salesperson Name
DTL.Text_USR_7 = LCL.Salesperson_Name;

ENDIF;

ENDIF;

//?08/06/24 SP S312312-Start
// DTL.Email to Broker Usr = CND.No
DTL.Email_to_Broker_Usr = 'N';

EXECUTE FUNCTION(Rtv Ship to Broker Eml RT) TYPE(RTVOBJ) FILE(OMHOREP)          AC2230823;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(JOB.*Job_date);
PARAMETER(LCL.Broker_Code);
PARAMETER(NLL.Broker_Email_Address);
{
 //?USER: Initialize routine

 // PAR.Broker Code = CND.Not entered
 PAR.Broker_Code = *BLANK;

 // PAR.Broker Email Address = CND.Blank
 PAR.Broker_Email_Address = *BLANK;

 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Period Beginning Date LE PAR.Date From             USR
 IF DB1.Period_Beginning_Date <= PAR.Date_From_USR;

 // AND DB1.Period Ending Date GE PAR.Date From             USR
 AND DB1.Period_Ending_Date >= PAR.Date_From_USR;

 CASE;

 // IF DB1.Broker Code is Entered
 IF DB1.Broker_Code <> *BLANK;

 EXECUTE FUNCTION(Rtv All details        RT) TYPE(RTVOBJ) FILE(POC5REP)          AC2232586;
 PARAMETER(DB1.Broker_Code);
 PARAMETER(NLL.Broker_Name);
 PARAMETER(NLL.Broker_Address_Line_1);
 PARAMETER(NLL.Broker_Address_Line_2);
 PARAMETER(NLL.Broker_City);
 PARAMETER(NLL.Broker_State);
 PARAMETER(NLL.Broker_Zip);
 PARAMETER(NLL.Broker_Office_Manager);
 PARAMETER(NLL.Broker_Telephone_Number);
 PARAMETER(NLL.Broker_Fax_Number);
 PARAMETER(LCL.Broker_Email_Address);
 PARAMETER(NLL.Broker_G_L_Vendor_Number);
 PARAMETER(NLL.Broker_unused_txt_1);
 PARAMETER(NLL.Broker_M3_Supplier);
 PARAMETER(NLL.Broker_EDI_Trade_Partner);
 PARAMETER(NLL.Broker_Fax_Email_Inv);
 PARAMETER(NLL.Broker_Fax_Email_Prc_Sht);
 PARAMETER(NLL.Payee_Type);
 PARAMETER(NLL.Broker_unused_sts_4);
 PARAMETER(NLL.Salesperson_Code);
 PARAMETER(NLL.EDI_Status_1);
 PARAMETER(NLL.EDI_Status_2);
 PARAMETER(NLL.EDI_Status_3);
 PARAMETER(LCL.Record_Status);
 {
  //?USER: Initialize routine

  MOVE *ALL (To: PAR From: CON);

  //?USER: Processing if Data record not found

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

 CASE;

 // IF LCL.Record Status is Active
 IF LCL.Record_Status = 'A';

 // PAR.Broker Code = DB1.Broker Code
 PAR.Broker_Code = DB1.Broker_Code;

 // PAR.Broker Email Address = LCL.Broker Email Address
 PAR.Broker_Email_Address = LCL.Broker_Email_Address;

 QUIT;

 ENDIF;

 ENDIF;

 ENDIF;

}


//?08/06/24 SP S312312-End
// DTL.Email to Salesperson Usr = CND.No
DTL.Email_to_Salesperson_Usr = 'N';

//?USER: Validate fields

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

//?Prompt for Salesperson Code; ELSE Validate Salesperson Code
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> DTL.Salesperson Code
AND PGM.*Cursor_field = DTL.Salesperson_Code;

// DTL.Text USR 7 = CON.*BLANK
DTL.Text_USR_7 = *BLANK;

// Call program SEL Regional Sls Mgr 2 SR.
CALL PROGRAM(SEL Regional Sls Mgr 2 SR) ('PUECSRR');
PARAMETER(DTL.Salesperson_Code);
PARAMETER(DTL.Text_USR_7);

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?Prompt for Salesperson Code; ELSE Validate Salesperson Code
// IF *OTHERWISE
IF *OTHERWISE;

//?T11489 DN 08/17/17-Allow to Select a Regional Sales Manager.
CASE;

// IF DTL.Status Flag 3  Y/N is Yes
IF DTL.Status_Flag_3_Y_N = 'Y';

//?Validate Salesperson Code.
CASE;

// IF DTL.Salesperson Code is entered
IF DTL.Salesperson_Code <> *BLANK;

EXECUTE FUNCTION(RTV Regional Sls Mgr   RT) TYPE(RTVOBJ) FILE(CAAPREP)          AC2142312;
PARAMETER(DTL.Salesperson_Code);
PARAMETER(LCL.Salesperson_Name);
{
 //?USER: Initialize routine

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?Check Return Code.
CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

// DTL.Text USR 7 = LCL.Salesperson Name
DTL.Text_USR_7 = LCL.Salesperson_Name;

//?Defer Confrim If First Time Through.
CASE;

// IF LCL.First Time Flag is Yes
IF LCL.First_Time_Flag = 'Y';

// LCL.First Time Flag = CND.NO
LCL.First_Time_Flag = 'N';

// LCL.Salesperson Code = DTL.Salesperson Code
LCL.Salesperson_Code = DTL.Salesperson_Code;

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

//?Defer Confrim If Salesperson Code Changes.
CASE;

// IF DTL.Salesperson Code NE LCL.Salesperson Code
IF DTL.Salesperson_Code <> LCL.Salesperson_Code;

// LCL.Salesperson Code = DTL.Salesperson Code
LCL.Salesperson_Code = DTL.Salesperson_Code;

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

ENDIF;

// LCL.Salesperson Code = DTL.Salesperson Code
LCL.Salesperson_Code = DTL.Salesperson_Code;

//?Check Return Code.
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Generic Message 80 USR = CONCAT(CON.Regional Sales Manager co,CON.de invalid.,CON.*ZERO)
LCL.Generic_Message_80_USR = 'Regional Sales Manager co' + 'de invalid.' (*ZERO);

// Send error message - '&1'
ERROR(USR4977);
MSGPARM(LCL.Generic_Message_80_USR);

ENDIF;

//?Validate Salesperson Code.
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Generic Message 80 USR = CONCAT(CON.Must select a Regional Sa,CON.les Manager.,CON.*ZERO)
LCL.Generic_Message_80_USR = 'Must select a Regional Sa' + 'les Manager.' (*ZERO);

// Send error message - '&1'
ERROR(USR4977);
MSGPARM(LCL.Generic_Message_80_USR);

ENDIF;

//?T11489 DN 08/17/17-Allow to Select a Regional Sales Manager.
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Salesperson Code = CON.*BLANK
LCL.Salesperson_Code = *BLANK;

// LCL.Salesperson Name = CON.*BLANK
LCL.Salesperson_Name = *BLANK;

ENDIF;

ENDIF;

//?USER: Validate relations

CASE;

// IF DTL.Salesperson Code is not entered
IF DTL.Salesperson_Code = *BLANK;

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: User defined action

//?08/06/24 SP S312312-Start (Adding new condition c6)
//?Perform print, email, or fax
CASE;

// IF DTL.Print (Yes/No) USR is Yes
IF DTL.Print_Yes_No_USR = 'Y';

// OR DTL.Status Flag 7  Y/N is Yes
OR DTL.Status_Flag_7_Y_N = 'Y';

// OR DTL.Status Flag 2  Y/N is Yes
OR DTL.Status_Flag_2_Y_N = 'Y';

// OR DTL.Status Flag 3  Y/N is Yes
OR DTL.Status_Flag_3_Y_N = 'Y';

// OR DTL.Status Flag 8  Y/N is Yes
OR DTL.Status_Flag_8_Y_N = 'Y';

// OR DTL.Email to Broker Usr is Yes
OR DTL.Email_to_Broker_Usr = 'Y';

// OR DTL.Email to Salesperson Usr is Yes
OR DTL.Email_to_Salesperson_Usr = 'Y';

// Call program PMT Print Option  SHR  PV.
CALL PROGRAM(PMT Print Option  SHR  PV) ('PDG0PVR');
PARAMETER('Print Acknowledgement');
PARAMETER(LCL.PRT_Printer_Device);
PARAMETER(LCL.PRT_Hold_Output_Sts);
PARAMETER(LCL.PRT_Save_Output_Sts);
PARAMETER(LCL.PRT_Number_of_Copies);
PARAMETER(LCL.PRT_Night_Queue_Run_Sts);
PARAMETER(LCL.PRT_Night_Queue);
PARAMETER('OMS');

//?If F3 pressed, remain on screen; ELSE process request
CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

//?If F3 pressed, remain on screen; ELSE process request
// IF *OTHERWISE
IF *OTHERWISE;

//?Print Acknowledgement: Print Y/N = Y OR Status Flag 8 = Y
CASE;

// IF DTL.Print (Yes/No) USR is Yes
IF DTL.Print_Yes_No_USR = 'Y';

// OR DTL.Status Flag 8  Y/N is Yes
OR DTL.Status_Flag_8_Y_N = 'Y';

// OR DTL.Email to Salesperson Usr is Yes
OR DTL.Email_to_Salesperson_Usr = 'Y';

//?** Status Flag 8=Email to Warehouse
// LCL.PRT Night Queue Run Sts = CND.no
LCL.PRT_Night_Queue_Run_Sts = 'N';

//?If F3 pressed, do not print; ELSE print acknowledgement
CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

// PGM.*Return code = CND.*Normal
PGM.*Return_code = *BLANK;

//?If F3 pressed, do not print; ELSE print acknowledgement
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Email to Warehouse Code = LCL.Warehouse Code
LCL.Email_to_Warehouse_Code = LCL.Warehouse_Code;

// Call program PRT Acknowledgements UP.
CALL PROGRAM(PRT Acknowledgements UP) ('PDJWPCLP');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*ZERO);
PARAMETER(*BLANK);
PARAMETER(LCL.Blank_for_4_USR);
PARAMETER(1);
PARAMETER('A');
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER(*BLANK);
PARAMETER('S');
PARAMETER(LCL.PRT_Printer_Device);
PARAMETER(LCL.PRT_Hold_Output_Sts);
PARAMETER(LCL.PRT_Save_Output_Sts);
PARAMETER(LCL.PRT_Number_of_Copies);
PARAMETER(*JOBD);
PARAMETER(*ZERO);
PARAMETER(DTL.Status_Flag_8_Y_N);
PARAMETER(LCL.Email_to_Warehouse_Code);
PARAMETER(DTL.Email_to_Salesperson_Usr);

ENDIF;

ENDIF;

//?Email to Regional Sales Manager: Status Flag 3 = Y
CASE;

// IF DTL.Status Flag 3  Y/N is Yes
IF DTL.Status_Flag_3_Y_N = 'Y';

//?** Status Flag 3=Regional Sales Manager
//?08/06/24 SP S312312-Start (Passing Blank to Email ID)
// Call program Eml Acknowledgements UP.
CALL PROGRAM(Eml Acknowledgements UP) ('PBIQUPC');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(*ZERO);
PARAMETER(DTL.Salesperson_Code);
PARAMETER('N');
PARAMETER(DTL.Status_Flag_3_Y_N);
PARAMETER(*BLANK);

//?08/06/24 SP S312312-End
ENDIF;

//?08/06/24 SP S312312-Start(Adding new condition c4)
//?Fax Acknowledgement..: Status flag 2 OR 7 = Y
CASE;

// IF DTL.Status Flag 2  Y/N is Yes
IF DTL.Status_Flag_2_Y_N = 'Y';

// OR DTL.Status Flag 7  Y/N is Yes
OR DTL.Status_Flag_7_Y_N = 'Y';

// OR DTL.Email to Broker Usr is Yes
OR DTL.Email_to_Broker_Usr = 'Y';

//?** Status Flag 2=Buyer Fax/Email
//?** Status Flag 7=Customer Fax
//?08/21/2017 DN T11489-Added Salesperson Code to Parm.
//?07/23/25 AA S033369-Start -Do not pass Regional Sales Flag to parameter
//?'USR Check Y/N Status' as email sent in previous step.
// Call program EXC Fax Acknwgmnt     XF.
CALL PROGRAM(EXC Fax Acknwgmnt     XF) ('PPFDXFR');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(DTL.HPB_Ship_to_Warehouse);
PARAMETER(PAR.Salesperson_Code);
PARAMETER(DTL.Status_Flag_2_Y_N);
PARAMETER(*BLANK);
PARAMETER('N');
PARAMETER(DTL.Status_Flag_7_Y_N);
PARAMETER(DTL.Email_to_Broker_Usr);

//?07/23/25 AA S033369-End
ENDIF;

//?08/06/24 SP S312312-End
ENDIF;

ENDIF;

//?USER: Exit program processing

//?Disable F3 key, user must press enter.
CASE;

// IF DTL.*CMD key is *Exit
IF DTL.*CMD_key = '03';

QUIT;

ENDIF;

