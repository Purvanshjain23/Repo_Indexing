// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDCFXFR
// ?Date: 14.08.2025 Time: 03:34:00
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Run this before change the warehouse on the order detail !!!
//?warehouse code = new warehouse
//?usr warehouse code = old warehouse
// PAR.USR Process status = CND.no
PAR.USR_Process_status = 'N';

CASE;

// IF PAR.Load ID EQ WRK.ZERO
IF PAR.Load_ID = WRK.ZERO;

//?                   * no processing needed
// IF *OTHERWISE
IF *OTHERWISE;

//?Find out if old whse is Plant controlled
EXECUTE FUNCTION(RTV Warehouse Control  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1304300;
PARAMETER(PAR.USR_Warehouse_Code);
PARAMETER(PAR.Trans_Contol_AS400_Plant);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If old whse is Plant, check new whse
CASE;

// IF PAR.Trans Contol AS400/Plant is Plant
IF PAR.Trans_Contol_AS400_Plant = 'P';

EXECUTE FUNCTION(RTV Warehouse Control  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1304300;
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.USR_Trans_Control_A_P);
{
 //?USER: Processing if Data record not found

 MOVE *ALL (To: PAR From: CON);

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


CASE;

// IF PAR.USR Trans Control A/P is AS400
IF PAR.USR_Trans_Control_A_P = 'A';

// PAR.USR Process status = CND.yes
PAR.USR_Process_status = 'Y';

// IF *OTHERWISE
IF *OTHERWISE;

//?do nothing
ENDIF;

ENDIF;

ENDIF;

//?Only process if changing from Plant to non-plant
CASE;

// IF PAR.USR Process status is yes
IF PAR.USR_Process_status = 'Y';

//?Check if this load has previously been unlocked.  Only want to send
//? delete request if it has.
EXECUTE FUNCTION(Val Type Exists        RT) TYPE(RTVOBJ) FILE(PDLHCPP)          AC1481852;
PARAMETER(PAR.Load_ID);
PARAMETER('SNDACC');
PARAMETER(PAR.Order_Number);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF PAR.Order Number EQ DB1.Order Number
 IF PAR.Order_Number = DB1.Order_Number;

 // PGM.*Return code = CND.*Normal
 PGM.*Return_code = *BLANK;

 QUIT;

 // IF *OTHERWISE
 IF *OTHERWISE;

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 ENDIF;

}


CASE;

// IF PGM.*Return code is *Normal
IF PGM.*Return_code = *BLANK;

//?Check for Accu-Sort or Georgia Freezer
EXECUTE FUNCTION(Rtv Cust/Func          RT) TYPE(RTVOBJ) FILE(POAEREP)          AC1579918;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.GAF_Customer_Number);
PARAMETER(PAR.GAF_Function);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

}


//?If no record found then send to accusort else send to Function
CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

EXECUTE FUNCTION(UPD Download Dlt/1 Ord RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1580010;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
{
 //?USER: Process Data record

 CASE;

 // IF PAR.Load ID is NE Blank
 IF PAR.Load_ID <> *ZERO;

 // AND DB1.Load ID NE PAR.Load ID
 AND DB1.Load_ID <> PAR.Load_ID;

 RETURN;

 ENDIF;

 //?** Write  -Accusort Processing if This is a Plant Floor Load
 DO;

 CASE;

 // IF DB1.Ship Status is Open
 IF DB1.Ship_Status = 'O';

 // OR DB1.Ship Status EQ WRK.BLANK
 OR DB1.Ship_Status = WRK.BLANK;

 // Call program Zzz Lock/Unlock Box ID XF.
 CALL PROGRAM(Zzz Lock/Unlock Box ID XF) ('PDXFXFR');
 PARAMETER('L');

 // Call program Zzz AS Ord Hdr/Dtl DLT XF.
 CALL PROGRAM(Zzz AS Ord Hdr/Dtl DLT XF) ('PDCGXFR');
 PARAMETER(PAR.Load_ID);
 PARAMETER(PAR.Company_Number);
 PARAMETER(PAR.Order_Number);

 // Call program Zzz Lock/Unlock Box ID XF.
 CALL PROGRAM(Zzz Lock/Unlock Box ID XF) ('PDXFXFR');
 PARAMETER('U');

 ENDIF;

 ENDDO;

}


EXECUTE FUNCTION(Del SNDACC Entry/Ord   RT) TYPE(RTVOBJ) FILE(PDLHCPP)          AC1481967;
PARAMETER(PAR.Load_ID);
PARAMETER('SNDACC');
PARAMETER(PAR.Order_Number);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Order Number EQ PAR.Order Number
 IF DB1.Order_Number = PAR.Order_Number;

 EXECUTE FUNCTION(DEL Load/Order Chg Log DR) TYPE(DLTOBJ) FILE(PDLHCPP)          AC1465746;
 PARAMETER(DB1.Created_Date);
 PARAMETER(DB1.Created_Time);
 PARAMETER(DB1.Sequence_Number);
 ENDIF;

}


//?If no record found then send to accusort else send to Function
// IF PAR.GAF Function is Georgia Freezer-Pendegras
IF PAR.GAF_Function = 'GFP';

EXECUTE FUNCTION(UPD Downld Dlt/Gaf Ord RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1481853;
PARAMETER(PAR.Load_ID);
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Order_Number);
PARAMETER(PAR.GAF_Customer_Number);
{
 //?USER: Process Data record

 CASE;

 // IF PAR.Load ID is NE Blank
 IF PAR.Load_ID <> *ZERO;

 // AND DB1.Load ID NE PAR.Load ID
 AND DB1.Load_ID <> PAR.Load_ID;

 RETURN;

 ENDIF;

 // Call program zDlt GAF Order Hdr/Dtl XF.
 CALL PROGRAM(zDlt GAF Order Hdr/Dtl XF) ('POAYXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(PAR.Order_Number);
 PARAMETER(DB1.Load_ID);
 PARAMETER(PAR.GAF_Customer_Number);

}


EXECUTE FUNCTION(Del SNDACC Entry/Ord   RT) TYPE(RTVOBJ) FILE(PDLHCPP)          AC1481967;
PARAMETER(PAR.Load_ID);
PARAMETER('SNDGAF');
PARAMETER(PAR.Order_Number);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 CASE;

 // IF DB1.Order Number EQ PAR.Order Number
 IF DB1.Order_Number = PAR.Order_Number;

 EXECUTE FUNCTION(DEL Load/Order Chg Log DR) TYPE(DLTOBJ) FILE(PDLHCPP)          AC1465746;
 PARAMETER(DB1.Created_Date);
 PARAMETER(DB1.Created_Time);
 PARAMETER(DB1.Sequence_Number);
 ENDIF;

}


ENDIF;

ENDIF;

ENDIF;

