/*********************************************************************/
/* PROGRAM : PWORUPC                                                 */
/* DESC    : CNV PURGE KILLDTE<2023 CL EXECUTE USER PROGRAM          */
/* DATE    : 05/29/2024                                              */
/* PROJECT : WI 568.13 DDS TO DDL EFFORTS; SR # 3014587              */
/* BY      : DANNY NGUYEN                                            */
/* PURPOSE : Create one time conversion process to move all Kill Date*/
/*           records that are in year 2022 & prior into library      */
/*           PRKFHST.                                                */
/*           This is required so to help speed up the deployment of  */
/*           PKCPCPP table to PROD via Implementer.                  */
/*                                                                   */
/*           ***MANUALLY SUBMIT PWORUPC TO BATCH.                    */
/*                                                                   */
/*********************************************************************/
/* MAINTENANCE LOG:                                                  */
/*-------------------------------------------------------------------*/
/* DATE     BY  CHANGE DESCRIPTION                                   */
/* -------- --- ---------------------------------------------------- */
/* MM/DD/YY                                                          */
/*                                                                   */
/*********************************************************************/

             PGM

             DCL        VAR(&DATA) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DATAH) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LIB1) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LIB2) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LIB3) TYPE(*CHAR) LEN(10)


/*-------------------------------------------------------------------*/
/* PROD OR TEST ENVIRONMENT?                                         */
/*-------------------------------------------------------------------*/
             CALL       PGM(CAQXXFR) PARM(' ' &DATA &DATAH)

/*-------------------------------------------------------------------*/
/* Copy PKCPCPP TO PRKFHST LIBRARY FOR EACH PLANT.                   */
/*-------------------------------------------------------------------*/
  /***********************************/
  /*TEST Environment Processing     */
  /***********************************/
             IF         COND(&DATA *NE 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&LIB1) VALUE('PRKFTSTGUP')  /* 360 */
             CHGVAR     VAR(&LIB2) VALUE('PRKFTSTSTP')  /* 440 */
             CHGVAR     VAR(&LIB3) VALUE('PRKFTSTTFP')  /* 960 */

    /* Move Inactive Records with Kill Date <= 1221231 to Backup Library */
      /* For 360 */
             CHKOBJ     OBJ(ISDNGUYLIB/PKCPCPPGUY) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)  /* NOT FOUND */
             RUNSQL     SQL('CREATE TABLE +
                          ISDNGUYLIB/EVAL_TRANS_UPL_GUY FOR SYSTEM +
                          NAME PKCPCPPGUY LIKE HPEDEVSQC/PKCPCPP +
                          RCDFMT @CPCPMV') COMMIT(*NONE)
             ENDDO

             CPYF       FROMFILE(&LIB1/PKCPCPP) +
                          TOFILE(ISDNGUYLIB/PKCPCPPGUY) +
                          MBROPT(*REPLACE) CRTFILE(*YES) FROMRCD(1) +
                          INCREL((*IF CPB7DT *LE 1221231))

      /* For 440 */
             CHKOBJ     OBJ(ISDNGUYLIB/PKCPCPPSTP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)  /* NOT FOUND */
             RUNSQL     SQL('CREATE TABLE +
                          ISDNGUYLIB/EVAL_TRANS_UPL_440 FOR SYSTEM +
                          NAME PKCPCPPSTP LIKE HPEDEVSQC/PKCPCPP +
                          RCDFMT @CPCPMV') COMMIT(*NONE)
             ENDDO

             CPYF       FROMFILE(&LIB2/PKCPCPP) +
                          TOFILE(ISDNGUYLIB/PKCPCPPSTP) +
                          MBROPT(*REPLACE) CRTFILE(*YES) FROMRCD(1) +
                          INCREL((*IF CPB7DT *LE 1221231))

      /* For 960 */
             CHKOBJ     OBJ(ISDNGUYLIB/PKCPCPPTFP) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)  /* NOT FOUND */
             RUNSQL     SQL('CREATE TABLE +
                          ISDNGUYLIB/EVAL_TRANS_UPL_960 FOR SYSTEM +
                          NAME PKCPCPPTFP LIKE HPEDEVSQC/PKCPCPP +
                          RCDFMT @CPCPMV') COMMIT(*NONE)
             ENDDO

             CPYF       FROMFILE(&LIB3/PKCPCPP) +
                          TOFILE(ISDNGUYLIB/PKCPCPPTFP) +
                          MBROPT(*REPLACE) CRTFILE(*YES) FROMRCD(1) +
                          INCREL((*IF CPB7DT *LE 1221231))

    /* Now Delete the Inactive Records with Kill Date <= 1221231 */
      /* Override to Co 360 File Library JOBD for TEST */
             CHGLBLJOBD JOBD(PRKTSTGUP)

             OVRDBF     FILE(PKCPCPP) TOFILE(&LIB1/PKCPCPP)
             OVRDBF     FILE(PKCPCPL3) TOFILE(&LIB1/PKCPCPL3)
             OVRDBF     FILE(PKCPCPL0) TOFILE(&LIB1/PKCPCPL0)

             CALL       PGM(PWOSXFR) PARM((' '))

             DLTOVR     FILE(*ALL)

      /* Override to Co 440 File Library JOBD for TEST */
             CHGLBLJOBD JOBD(PRKTSTSTP)

             OVRDBF     FILE(PKCPCPP) TOFILE(&LIB2/PKCPCPP)
             OVRDBF     FILE(PKCPCPL3) TOFILE(&LIB2/PKCPCPL3)
             OVRDBF     FILE(PKCPCPL0) TOFILE(&LIB2/PKCPCPL0)

             CALL       PGM(PWOSXFR) PARM((' '))

             DLTOVR     FILE(*ALL)

      /* Override to Co 960 File Library JOBD for TEST */
             CHGLBLJOBD JOBD(PRKTSTTFP)

             OVRDBF     FILE(PKCPCPP) TOFILE(&LIB3/PKCPCPP)
             OVRDBF     FILE(PKCPCPL3) TOFILE(&LIB3/PKCPCPL3)
             OVRDBF     FILE(PKCPCPL0) TOFILE(&LIB3/PKCPCPL0)

             CALL       PGM(PWOSXFR) PARM((' '))

             DLTOVR     FILE(*ALL)

             ENDDO

  /***********************************/
  /*ˆPROD Environment Processing     */
  /***********************************/
    /*AT THE TIME OF CPYF, PROD FILES WILL STILL BE DDS SO LEAVE CPYF AS IS */
             IF         COND(&DATA *EQ 'PRKFLIB') THEN(DO)
             CHGVAR     VAR(&LIB1) VALUE('PRKFGUP')     /* 360 */
             CHGVAR     VAR(&LIB2) VALUE('PRKFSTP')     /* 440 */

    /* Move Inactive Records with Kill Date <= 1221231 to Backup Library */
      /* For 360 - *ADD */
             CPYF       FROMFILE(&LIB1/PKCPCPP) +
                          TOFILE(PRKFHST/PKCPCPP360) MBROPT(*ADD) +
                          FROMRCD(1) INCREL((*IF CPB7DT *LE 1221231))

      /* For 440 - CREATE FILE=*YES */
             CPYF       FROMFILE(&LIB2/PKCPCPP) +
                          TOFILE(PRKFHST/PKCPCPP440) CRTFILE(*YES) +
                          FROMRCD(1) INCREL((*IF CPB7DT *LE 1221231))

    /* Now Delete the Inactive Records with Kill Date <= 1221231 */
      /* Override to Co 360 File Library JOBD for PROD */
             CHGLBLJOBD JOBD(PRKPRDGUP)

             OVRDBF     FILE(PKCPCPP) TOFILE(&LIB1/PKCPCPP)
             OVRDBF     FILE(PKCPCPL3) TOFILE(&LIB1/PKCPCPL3)
             OVRDBF     FILE(PKCPCPL0) TOFILE(&LIB1/PKCPCPL0)

             CALL       PGM(PWOSXFR) PARM((' '))

             RGZPFM     FILE(&LIB1/PKCPCPP)

             DLTOVR     FILE(*ALL)

      /* Override to Co 440 File Library JOBD for PROD */
             CHGLBLJOBD JOBD(PRKPRDSTP)

             OVRDBF     FILE(PKCPCPP) TOFILE(&LIB2/PKCPCPP)
             OVRDBF     FILE(PKCPCPL3) TOFILE(&LIB2/PKCPCPL3)
             OVRDBF     FILE(PKCPCPL0) TOFILE(&LIB2/PKCPCPL0)

             CALL       PGM(PWOSXFR) PARM((' '))

             RGZPFM     FILE(&LIB2/PKCPCPP)

             DLTOVR     FILE(*ALL)

             ENDDO


 ENDPGM:     ENDPGM
