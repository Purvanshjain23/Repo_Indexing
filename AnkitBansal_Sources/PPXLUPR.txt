/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  SQL PFS INVENTORY ERROR REASON XLS                  */
/*                                                                  */
/*  SYSTEM    - INVENTORY MANAGEMENT SYSTEM                         */
/*  DATE      - 04/06/06                                            */
/*                                                                  */
/*      PARAMETERS:                                                 */
/*                                                                  */
/*     O    &RETURN     - RETURN CODE                               */
/********************************************************************/
/* Modification History:                                            */
/*  2/16/17 JBB E9064 - Add processing for company 440              */
/********************************************************************/

 PPXLUPR:    PGM        PARM(&RETURN &ASOF)

/* PARMS                                                                      */
        DCL    &RETURN     *CHAR   (7)           /* Return Code               */
        DCL    &ASOF      *CHAR   (1)           /* AS OF TIME CODE           */
        DCL    &ASOFT     *char   (6)           /* AS OF TIME                */
        DCL    &COMPL      *char  (3)           /* COMPANY                   */
        DCL    &COMPN      *DEC   (3 0)         /* COMPANY                   */
        DCL    &DATEL      *char  (8)           /* AS OF DATE                */
        DCL    &DATEN      *DEC   (8 0)         /* AS OF DATE                */

/* INTERNAL FIELDS                                                            */
        DCL    &RECIP      *CHAR  (40)          /* Recipient                 */
        DCL    &TEXT       *CHAR  (40)          /* Execute email text        */

/* ERROR MESSAGE FIELDS                                                       */
        DCL    &MSG        *CHAR   (512)         /* message                   */
        DCL    &MSGID      *CHAR   (7)           /* message id                */
        DCL    &MSGL       *DEC    (5 0)
        DCL    &COMMAND    *CHAR   (512)

/********************************************************************/
/*   INITIALIZE VARIABLES                                           */
/********************************************************************/

             CHGVAR     VAR(&RETURN) VALUE('       ')
/********************************************************************/
/*   MONITOR FOR ALL MESSAGES AT PROGRAM LEVEL                      */
/********************************************************************/

             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(MSGTRAP))

   /*------------------------------------------------*/
   /* EXECUTE SEQUEL TO DIST LIST FOR EACH COMPANY   */
   /*------------------------------------------------*/
/*-------------------------------------------------------------------*/
 /* THIS IS SCHEDULED TO RUN AT 6AM.                                     */
 /* GET PREVIOUS PROD DATE FOR COMPANY, RUN FROM 4PM THAT DAY TO CURRENT TM  */
/*-------------------------------------------------------------------*/

 SIXAM:     IF         COND(&ASOF = '1') THEN(DO)

 GUYMON1:    CHGVAR     VAR(&COMPL) VALUE('360')
             CHGVAR     VAR(&COMPN) VALUE(360)
             CALL       PGM(PPXNXFR) PARM('' &COMPN &DATEN)
             CHGVAR     VAR(&ASOFT) VALUE('160000')
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 360')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 360')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)

 COMP440:    CHGVAR     VAR(&COMPL) VALUE('440')
             CHGVAR     VAR(&COMPN) VALUE(440)
             CALL       PGM(PPXNXFR) PARM('' &COMPN &DATEN)
             CHGVAR     VAR(&ASOFT) VALUE('160000')
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 440')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 440')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)

 STJO1:      CHGVAR     VAR(&COMPL) VALUE('960')
             CHGVAR     VAR(&COMPN) VALUE(960)
             CALL       PGM(PPXNXFR) PARM('' &COMPN &DATEN)
             CHGVAR     VAR(&ASOFT) VALUE('160000')
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 960')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 960')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
      ENDDO

/*-------------------------------------------------------------------*/
 /*  THIS IS SCHEDULED TO RUN AT 12 NOON                             */
 /*  FOR CURRENT DATE, RUN FROM 6:00:00AM  TO CURRENT TIME           */
/*-------------------------------------------------------------------*/

 TWELVE:    IF         COND(&ASOF = '2') THEN(DO)

 GUYMON2:    CHGVAR     VAR(&COMPL) VALUE('360')
             CHGVAR     VAR(&ASOFT) VALUE('060000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 360')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 360')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)

 COMP4402:   CHGVAR     VAR(&COMPL) VALUE('440')
             CHGVAR     VAR(&ASOFT) VALUE('060000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 440')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 440')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)

 STJO2:      CHGVAR     VAR(&COMPL) VALUE('960')
             CHGVAR     VAR(&ASOFT) VALUE('060000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 960')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 960')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) EMLMSG(*DFT) +
                          SETVAR((&COMP &COMPL) (&DATE &DATEL) +
                          (&TIME &ASOFT)) TEXT(&TEXT)
      ENDDO

/*-------------------------------------------------------------------*/
 /* THIS IS SCHEDULED TO RUN AT 4 PM                                 */
 /*  FOR CURRENT DATE, RUN FROM 12:00:00 NOON TO CURRENT TIME        */
/*-------------------------------------------------------------------*/
 FOUR:    IF         COND(&ASOF = '3') THEN(DO)

 GUYMON3:    CHGVAR     VAR(&COMPL) VALUE('360')
             CHGVAR     VAR(&ASOFT) VALUE('120000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS INV ERRORS - 360')
             CHGVAR     VAR(&TEXT)  VALUE('PFS INV ERRORS - 360')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 360')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 360')
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)

 COMP4403:   CHGVAR     VAR(&COMPL) VALUE('440')
             CHGVAR     VAR(&ASOFT) VALUE('120000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS INV ERRORS - 440')
             CHGVAR     VAR(&TEXT)  VALUE('PFS INV ERRORS - 440')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 440')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 440')
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) EMLMSG(*DFT) +
                          SETVAR((&COMP &COMPL) (&DATE &DATEL) +
                          (&TIME &ASOFT)) TEXT(&TEXT)

 STJO3:      CHGVAR     VAR(&COMPL) VALUE('960')
             CHGVAR     VAR(&ASOFT) VALUE('120000')
             CALL       PGM(PPXOXFR) PARM('' &DATEN)
             CHGVAR     VAR(&DATEL) VALUE(&DATEN)
             CHGVAR     VAR(&RECIP) VALUE('PFS INV ERRORS - 960')
             CHGVAR     VAR(&TEXT)  VALUE('PFS INV ERRORS - 960')
             EXECUTE    VIEW(*LIBL/PFSERROR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)
             CHGVAR     VAR(&RECIP) VALUE('PFS Inv Errors - 960')
             CHGVAR     VAR(&TEXT)  VALUE('PFS Inv Errors - 960')
             EXECUTE    VIEW(*LIBL/PFSSHIPERR) PCFMT(*XLS) +
                          RECIPIENT(&RECIP) SETVAR((&COMP &COMPL) +
                          (&DATE &DATEL) (&TIME &ASOFT)) TEXT(&TEXT)


      ENDDO
/*------------------------------------------------------------------*/
             GOTO       CMDLBL(END)
/*----------------------RECEIVE MESSAGES----------------------------*/

 MSGTRAP:    RCVMSG     MSGTYPE(*EXCP) MSGDTA(&MSG) MSGDTALEN(&MSGL) +
                          MSGID(&MSGID)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             SNDPGMMSG  MSGID(&MSGID) MSGF(QCPFMSG) MSGDTA(%SST(&MSG +
                          1 &MSGL)) MSGTYPE(*ESCAPE)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

 END:        ENDPGM

