// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POQOXFR
// ?Date: 14.08.2025 Time: 03:38:40
// ?------------------------------------------------------------------------------------------------

//?Execute user function

CASE;

// IF PAR.PPS Process STS is Reallocate by Ship Date
IF PAR.PPS_Process_STS = '2';

// Call program Zzz Realc Ord Init    XF.
CALL PROGRAM(Zzz Realc Ord Init    XF) ('POQXXFR');
PARAMETER(PAR.Company_Number);

ENDIF;

//?C6096 Deallocate order instead
//?Delete OP Order Detail Schedule
EXECUTE FUNCTION(DLT Ord Dtl Schedule   RT) TYPE(RTVOBJ) FILE(PDKNCPP)          AC1415697;
PARAMETER(PAR.Company_Number);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(DLT Ord Detail Sched   DL) TYPE(DLTOBJ) FILE(PDKNCPP)          AC1385631;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.OD_Production_Date);
}


EXECUTE FUNCTION(Del OrdDtl SchInv ALL RT) TYPE(RTVOBJ) FILE(POB5CPP)           AC1648693;
PARAMETER(PAR.Company_Number);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del Ord Dtl Sch-Inv   DL) TYPE(DLTOBJ) FILE(POB5CPP)           AC1647003;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.OD_Production_Date);
}


EXECUTE FUNCTION(Del OrdDtl SchCnsmdALLRT) TYPE(RTVOBJ) FILE(POB6CPP)           AC1649514;
PARAMETER(PAR.Company_Number);
{
 //?USER: Process Data record

 EXECUTE FUNCTION(Del OrdDtl Sch-Consmd DL) TYPE(DLTOBJ) FILE(POB6CPP)           AC1647985;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.OD_Production_Date);
 PARAMETER(DB1.ODS_Sequence_Number);
}


//?Allocate the Orders
EXECUTE FUNCTION(UPS ReAlc Ord by SD   RT) TYPE(RTVOBJ) FILE(OPBGWKP)           AC1648695;
PARAMETER(PAR.Company_Number);
{
 //?USER: Initialize routine

 //?***** PA PROCESS - USE REQUESTED SHIP DATE FOR Ship Date USR *****
 // LCL.Company Number = CON.*ZERO
 LCL.Company_Number = *ZERO;

 // LCL.Order Number = CON.*ZERO
 LCL.Order_Number = *ZERO;

 // LCL.Ship To Customer = CON.*ZERO
 LCL.Ship_To_Customer = *ZERO;

 // LCL.First Time Flag = CND.Yes
 LCL.First_Time_Flag = 'Y';

 //?USER: Process Data record

 //?First Time Processing
 CASE;

 // IF LCL.First Time Flag is Yes
 IF LCL.First_Time_Flag = 'Y';

 // LCL.Company Number = DB1.Company Number
 LCL.Company_Number = DB1.Company_Number;

 // LCL.Order Number = DB1.Order Number
 LCL.Order_Number = DB1.Order_Number;

 // LCL.Ship To Customer = DB1.Ship To Customer
 LCL.Ship_To_Customer = DB1.Ship_To_Customer;

 // LCL.ATS Adj Type USR 2 = CND.Ship Off Cut
 LCL.ATS_Adj_Type_USR_2 = 'SC';

 // LCL.First Time Flag = CND.NO
 LCL.First_Time_Flag = 'N';

 EXECUTE FUNCTION(RTV Order Type         RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1564834;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Order_Type_Sales);
 {
  //?USER: Process Data record

  // PAR.Order Type - Sales = DB1.Order Type - Sales
  PAR.Order_Type_Sales = DB1.Order_Type_Sales;

  QUIT;

 }

 ENDIF;

 //?NEW Order Number
 CASE;

 // IF LCL.Order Number NE DB1.Order Number
 IF LCL.Order_Number <> DB1.Order_Number;

 CASE;

 // IF LCL.Order Type - Sales is Regular Order
 IF LCL.Order_Type_Sales = 'OR';

 // Call program EDT Post Open Orders   XF.
 CALL PROGRAM(EDT Post Open Orders   XF) ('PDHRXFR');
 PARAMETER(LCL.Company_Number);
 PARAMETER(LCL.Order_Number);
 PARAMETER(LCL.Ship_To_Customer);
 PARAMETER(LCL.Order_Value_Total);
 PARAMETER(LCL.Order_Weight_Total);
 PARAMETER('PS');

 ENDIF;

 // LCL.Company Number = DB1.Company Number
 LCL.Company_Number = DB1.Company_Number;

 // LCL.Order Number = DB1.Order Number
 LCL.Order_Number = DB1.Order_Number;

 // LCL.Ship To Customer = DB1.Ship To Customer
 LCL.Ship_To_Customer = DB1.Ship_To_Customer;

 EXECUTE FUNCTION(RTV Order Type         RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1564834;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(LCL.Order_Type_Sales);
 {
  //?USER: Process Data record

  // PAR.Order Type - Sales = DB1.Order Type - Sales
  PAR.Order_Type_Sales = DB1.Order_Type_Sales;

  QUIT;

 }

 ENDIF;

 CASE;

 // IF LCL.Order Type - Sales is Regular Order
 IF LCL.Order_Type_Sales = 'OR';

 // OR LCL.Order Type - Sales is Transfer Order
 OR LCL.Order_Type_Sales = 'TR';

 //?Reallocate Item
 CASE;

 // IF DB1.Detail Line Status is Conf/Comp/Canc
 IF DB1.Detail_Line_Status = 'X'/'C'/'R';

 //?Reallocate Item
 // IF *OTHERWISE
 IF *OTHERWISE;

 // LCL.Quantity Scheduled = CON.*ZERO
 LCL.Quantity_Scheduled = *ZERO;

 // LCL.Weight Scheduled = CON.*ZERO
 LCL.Weight_Scheduled = *ZERO;

 // Call program UPD Avail-To-Sell  ORD XF.
 CALL PROGRAM(UPD Avail-To-Sell  ORD XF) ('PDQNXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.Requested_Ship_Date);
 PARAMETER(DB1.Quantity_Ordered);
 PARAMETER(DB1.Weight_Ordered);
 PARAMETER(LCL.Quantity_Scheduled);
 PARAMETER(LCL.Weight_Scheduled);
 PARAMETER('OA');
 PARAMETER('REALC');
 PARAMETER(DB1.Item_Age_Days);
 PARAMETER(DB1.Production_Ovr_AgeDte_Fr);
 PARAMETER(DB1.Production_Ovr_AgeDte_To);

 //?Short
 CASE;

 // IF LCL.Quantity Scheduled NE DB1.Quantity Ordered
 IF LCL.Quantity_Scheduled <> DB1.Quantity_Ordered;

 //?Ship Off Cut
 CASE;

 // IF DB1.Scheduled Ship Date LE JOB.*Job date
 IF DB1.Scheduled_Ship_Date <= JOB.*Job_date;

 // Call program UPD Avail-To-Sell  ORD XF.
 CALL PROGRAM(UPD Avail-To-Sell  ORD XF) ('PDQNXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.Requested_Ship_Date);
 PARAMETER(DB1.Quantity_Ordered);
 PARAMETER(DB1.Weight_Ordered);
 PARAMETER(LCL.Quantity_Scheduled);
 PARAMETER(LCL.Weight_Scheduled);
 PARAMETER('SC');
 PARAMETER('SHIPOFFCUT');
 PARAMETER(DB1.Item_Age_Days);
 PARAMETER(DB1.Production_Ovr_AgeDte_Fr);
 PARAMETER(DB1.Production_Ovr_AgeDte_To);

 //?Ship Off Cut
 // IF *OTHERWISE
 IF *OTHERWISE;

 // Call program UPD Avail-To-Sell  ORD XF.
 CALL PROGRAM(UPD Avail-To-Sell  ORD XF) ('PDQNXFR');
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(DB1.Item_Code);
 PARAMETER(DB1.Warehouse_Code);
 PARAMETER(DB1.Requested_Ship_Date);
 PARAMETER(DB1.Quantity_Scheduled);
 PARAMETER(DB1.Weight_Scheduled);
 PARAMETER(LCL.Quantity_Scheduled);
 PARAMETER(LCL.Weight_Scheduled);
 PARAMETER('AO');
 PARAMETER('SCHEDASORD');
 PARAMETER(DB1.Item_Age_Days);
 PARAMETER(DB1.Production_Ovr_AgeDte_Fr);
 PARAMETER(DB1.Production_Ovr_AgeDte_To);

 ENDIF;

 ENDIF;

 EXECUTE FUNCTION(Chg Qty/Wgt Scheduled CH) TYPE(CHGOBJ) FILE(OPBGWKP)           AC1425232;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.Order_Number);
 PARAMETER(DB1.Order_Sequence_Number);
 PARAMETER(DB1.Order_Secondary_Line_Seq);
 PARAMETER(LCL.Quantity_Scheduled);
 PARAMETER(LCL.Weight_Scheduled);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*PROGRAM
   PAR.Job_Name = JOB.*PROGRAM;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 ENDIF;

 //?USER: Exit processing

 // Call program EDT Post Open Orders   XF.
 CALL PROGRAM(EDT Post Open Orders   XF) ('PDHRXFR');
 PARAMETER(LCL.Company_Number);
 PARAMETER(LCL.Order_Number);
 PARAMETER(LCL.Ship_To_Customer);
 PARAMETER(LCL.Order_Value_Total);
 PARAMETER(LCL.Order_Weight_Total);
 PARAMETER('PS');

}


