// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POULXFR
// ?Date: 14.08.2025 Time: 03:39:04
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv Upd Closest Farms RT) TYPE(RTVOBJ) FILE(POB2CPP)           AC1662475;
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.PT_Prod_Date_YYYYMMDD);
PARAMETER(PAR.Date_8_0_USR);
{
 //?USER: Process Data record

 CASE;

 // IF DB1.PT Prod Date YYYYMMDD LE PAR.Date 8.0 USR
 IF DB1.PT_Prod_Date_YYYYMMDD <= PAR.Date_8_0_USR;

 // OR PAR.Date 8.0 USR is zero
 OR PAR.Date_8_0_USR = *ZERO;

 CASE;

 // IF DB1.PT Producer/Farm Code is Entered
 IF DB1.PT_Producer_Farm_Code <> *BLANK;

 // AND DB1.PT Producer/Farm Code 1 is Not Entered
 AND DB1.PT_Producer_Farm_Code_1 = *BLANK;

 //?Clear Arrays
 EXECUTE FUNCTION(DLT PT Closest Farms  DL) TYPE(DLTOBJ) ARRAY(ARR_Closest_Farms)AC1662503;
 EXECUTE FUNCTION(DLT PT Closest Farms2 DL) TYPE(DLTOBJ) ARRAY(ARR_Closest_Farms_AC1662512;
 //?If Internal, use farm code, else use Prod Loc Vendor #    RMC 2/11/05
 CASE;

 // IF DB1.PT Source Type is Internal
 IF DB1.PT_Source_Type = 'I';

 // OR DB1.Company Number is St. Joseph
 OR DB1.Company_Number = 960;

 // OR DB1.Company Number is Seaboard Triumph Foods
 OR DB1.Company_Number = 440;

 // LCL.PT Producer/Farm Code = DB1.PT Producer/Farm Code
 LCL.PT_Producer_Farm_Code = DB1.PT_Producer_Farm_Code;

 //?If Internal, use farm code, else use Prod Loc Vendor #    RMC 2/11/05
 // IF *OTHERWISE
 IF *OTHERWISE;

 // Call program Rtv Prd Loc Vnd# 4 OMS XF.
 CALL PROGRAM(Rtv Prd Loc Vnd# 4 OMS XF) ('PKRTVVND');
 PARAMETER(DB1.PT_Producer_Farm_Code);
 PARAMETER(NLL.PT_Producer_Farm_Name);
 PARAMETER(DB1.PT_Producer_Location_Code);
 PARAMETER(LCL.Address_Number_6A);

 // LCL.PT Producer/Farm Code = LCL.Address Number 6A
 LCL.PT_Producer_Farm_Code = LCL.Address_Number_6A;

 ENDIF;

 //?Get Next 4 farms after the offset date/time
 EXECUTE FUNCTION(Rtv Next 4 Farms      RT) TYPE(RTVOBJ) FILE(POB2CPP)           AC1662491;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.PT_Offset_Prod_Date);
 PARAMETER(DB1.PT_Offset_Prod_Time);
 PARAMETER(LCL.PT_Producer_Farm_Code);
 {
  //?USER: Initialize routine

  //?T12136 RMC 12/5/17 added stf
  // LCL.PT Offset Prod Date = PAR.PT Offset Prod Date
  LCL.PT_Offset_Prod_Date = PAR.PT_Offset_Prod_Date;

  // LCL.PT Offset Prod Time = PAR.PT Offset Prod Time
  LCL.PT_Offset_Prod_Time = PAR.PT_Offset_Prod_Time;

  // LCL.Count USR = CON.*ZERO
  LCL.Count_USR = 0;

  //?USER: Process Data record

  //?RMC TFS027 For ST JO the producer/farm code is the trace seq
  CASE;

  // IF DB1.PT Source Type is Internal
  IF DB1.PT_Source_Type = 'I';

  // OR DB1.Company Number is St. Joseph
  OR DB1.Company_Number = 960;

  // OR DB1.Company Number is Seaboard Triumph Foods
  OR DB1.Company_Number = 440;

  CASE;

  // IF DB1.PT Producer/Farm Code NE PAR.PT Producer/Farm Code
  IF DB1.PT_Producer_Farm_Code <> PAR.PT_Producer_Farm_Code;

  // AND DB1.PT Producer/Farm Code is Entered
  AND DB1.PT_Producer_Farm_Code <> *BLANK;

  EXECUTE FUNCTION(UPD PT Closest Farms  RT) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms)AC1662483;
  PARAMETER(DB1.PT_Producer_Farm_Code);
  PARAMETER(LCL.Time_Difference_USR);
  PARAMETER(LCL.Count_USR);
  PARAMETER(DB1.PT_Offset_Prod_Date);
  PARAMETER(DB1.PT_Offset_Prod_Time);
  PARAMETER(LCL.PT_Offset_Prod_Date);
  PARAMETER(LCL.PT_Offset_Prod_Time);
  {
   //?USER: Processing if Data record not found

   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   EXECUTE FUNCTION(CRT PT Closest Farms  CR) TYPE(CRTOBJ) ARRAY(ARR_Closest_Farms)AC1662486;
   PARAMETER(PAR.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   // PAR.Count USR = PAR.Count USR + CON.1
   PAR.Count_USR = PAR.Count_USR + 1;

   //?USER: Process Data record

   //?For this farm, If this time diff is less that it was, update it.
   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR LT DB1.Time Difference USR
   IF LCL.Time_Difference_USR < DB1.Time_Difference_USR;

   EXECUTE FUNCTION(UPD PT Closest Farms  CR) TYPE(CHGOBJ) ARRAY(ARR_Closest_Farms)AC1662542;
   PARAMETER(DB1.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   ENDIF;

  }

  ENDIF;

  // IF *OTHERWISE
  IF *OTHERWISE;

  //?External --  compare to producer loc address #
  CASE;

  // IF DB1.PT Source Type is External
  IF DB1.PT_Source_Type = 'E';

  // Call program Rtv Prd Loc Vnd# 4 OMS XF.
  CALL PROGRAM(Rtv Prd Loc Vnd# 4 OMS XF) ('PKRTVVND');
  PARAMETER(DB1.PT_Producer_Farm_Code);
  PARAMETER(NLL.PT_Producer_Farm_Name);
  PARAMETER(DB1.PT_Producer_Location_Code);
  PARAMETER(WRK.Address_Number_6A);

  CASE;

  // IF WRK.Address Number 6A NE PAR.PT Producer/Farm Code
  IF WRK.Address_Number_6A <> PAR.PT_Producer_Farm_Code;

  // AND WRK.Address Number 6A is Entered
  AND WRK.Address_Number_6A > *BLANK;

  EXECUTE FUNCTION(UPD PT Closest Farms  RT) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms)AC1662483;
  PARAMETER(WRK.Address_Number_6A);
  PARAMETER(LCL.Time_Difference_USR);
  PARAMETER(LCL.Count_USR);
  PARAMETER(DB1.PT_Offset_Prod_Date);
  PARAMETER(DB1.PT_Offset_Prod_Time);
  PARAMETER(LCL.PT_Offset_Prod_Date);
  PARAMETER(LCL.PT_Offset_Prod_Time);
  {
   //?USER: Processing if Data record not found

   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   EXECUTE FUNCTION(CRT PT Closest Farms  CR) TYPE(CRTOBJ) ARRAY(ARR_Closest_Farms)AC1662486;
   PARAMETER(PAR.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   // PAR.Count USR = PAR.Count USR + CON.1
   PAR.Count_USR = PAR.Count_USR + 1;

   //?USER: Process Data record

   //?For this farm, If this time diff is less that it was, update it.
   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR LT DB1.Time Difference USR
   IF LCL.Time_Difference_USR < DB1.Time_Difference_USR;

   EXECUTE FUNCTION(UPD PT Closest Farms  CR) TYPE(CHGOBJ) ARRAY(ARR_Closest_Farms)AC1662542;
   PARAMETER(DB1.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   ENDIF;

  }

  ENDIF;

  ENDIF;

  ENDIF;

  CASE;

  // IF LCL.Count USR is Four
  IF LCL.Count_USR = 4;

  QUIT;

  ENDIF;

 }

 //?Get Previous 4 farms before the offset date/time
 EXECUTE FUNCTION(Rtv Previous 4 Farms  RT) TYPE(RTVOBJ) FILE(POB2CPP)           AC1662492;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.PT_Offset_Prod_Date);
 PARAMETER(DB1.PT_Offset_Prod_Time);
 PARAMETER(LCL.PT_Producer_Farm_Code);
 {
  //?USER: Initialize routine

  //?T12136 RMC 12/5/17 added stf
  // LCL.PT Offset Prod Date = PAR.PT Offset Prod Date
  LCL.PT_Offset_Prod_Date = PAR.PT_Offset_Prod_Date;

  // LCL.PT Offset Prod Time = PAR.PT Offset Prod Time
  LCL.PT_Offset_Prod_Time = PAR.PT_Offset_Prod_Time;

  // LCL.Count USR = CON.*ZERO
  LCL.Count_USR = 0;

  //?USER: Process Data record

  //?RMC TFS027 For ST JO the producer/farm code is the trace seq
  CASE;

  // IF DB1.PT Source Type is Internal
  IF DB1.PT_Source_Type = 'I';

  // OR DB1.Company Number is St. Joseph
  OR DB1.Company_Number = 960;

  // OR DB1.Company Number is Seaboard Triumph Foods
  OR DB1.Company_Number = 440;

  CASE;

  // IF DB1.PT Producer/Farm Code NE PAR.PT Producer/Farm Code
  IF DB1.PT_Producer_Farm_Code <> PAR.PT_Producer_Farm_Code;

  // AND DB1.PT Producer/Farm Code is Entered
  AND DB1.PT_Producer_Farm_Code <> *BLANK;

  EXECUTE FUNCTION(UPD PT Closest Farms  RT) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms)AC1662483;
  PARAMETER(DB1.PT_Producer_Farm_Code);
  PARAMETER(LCL.Time_Difference_USR);
  PARAMETER(LCL.Count_USR);
  PARAMETER(DB1.PT_Offset_Prod_Date);
  PARAMETER(DB1.PT_Offset_Prod_Time);
  PARAMETER(LCL.PT_Offset_Prod_Date);
  PARAMETER(LCL.PT_Offset_Prod_Time);
  {
   //?USER: Processing if Data record not found

   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   EXECUTE FUNCTION(CRT PT Closest Farms  CR) TYPE(CRTOBJ) ARRAY(ARR_Closest_Farms)AC1662486;
   PARAMETER(PAR.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   // PAR.Count USR = PAR.Count USR + CON.1
   PAR.Count_USR = PAR.Count_USR + 1;

   //?USER: Process Data record

   //?For this farm, If this time diff is less that it was, update it.
   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR LT DB1.Time Difference USR
   IF LCL.Time_Difference_USR < DB1.Time_Difference_USR;

   EXECUTE FUNCTION(UPD PT Closest Farms  CR) TYPE(CHGOBJ) ARRAY(ARR_Closest_Farms)AC1662542;
   PARAMETER(DB1.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   ENDIF;

  }

  ENDIF;

  // IF *OTHERWISE
  IF *OTHERWISE;

  //?External -- compare to producer loc address #
  CASE;

  // IF DB1.PT Source Type is External
  IF DB1.PT_Source_Type = 'E';

  // Call program Rtv Prd Loc Vnd# 4 OMS XF.
  CALL PROGRAM(Rtv Prd Loc Vnd# 4 OMS XF) ('PKRTVVND');
  PARAMETER(DB1.PT_Producer_Farm_Code);
  PARAMETER(NLL.PT_Producer_Farm_Name);
  PARAMETER(DB1.PT_Producer_Location_Code);
  PARAMETER(WRK.Address_Number_6A);

  CASE;

  // IF WRK.Address Number 6A NE PAR.PT Producer/Farm Code
  IF WRK.Address_Number_6A <> PAR.PT_Producer_Farm_Code;

  // AND WRK.Address Number 6A is Entered
  AND WRK.Address_Number_6A > *BLANK;

  EXECUTE FUNCTION(UPD PT Closest Farms  RT) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms)AC1662483;
  PARAMETER(WRK.Address_Number_6A);
  PARAMETER(LCL.Time_Difference_USR);
  PARAMETER(LCL.Count_USR);
  PARAMETER(DB1.PT_Offset_Prod_Date);
  PARAMETER(DB1.PT_Offset_Prod_Time);
  PARAMETER(LCL.PT_Offset_Prod_Date);
  PARAMETER(LCL.PT_Offset_Prod_Time);
  {
   //?USER: Processing if Data record not found

   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   EXECUTE FUNCTION(CRT PT Closest Farms  CR) TYPE(CRTOBJ) ARRAY(ARR_Closest_Farms)AC1662486;
   PARAMETER(PAR.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   // PAR.Count USR = PAR.Count USR + CON.1
   PAR.Count_USR = PAR.Count_USR + 1;

   //?USER: Process Data record

   //?For this farm, If this time diff is less that it was, update it.
   CASE;

   // IF PAR.PT Offset Prod Date EQ PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date = PAR.From_Prod_Date_YYYYMMDD;

   // LCL.Time Difference USR = PAR.PT Offset Prod Time - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(PAR.PT_Offset_Prod_Time PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   CASE;

   // IF PAR.PT Offset Prod Date LT PAR.From Prod Date YYYYMMDD
   IF PAR.PT_Offset_Prod_Date < PAR.From_Prod_Date_YYYYMMDD;

   // WRK.Days = PAR.PT Offset Prod Date - PAR.From Prod Date YYYYMMDD *DAYS
   WRK.Days = DURATION(PAR.PT_Offset_Prod_Date PAR.From_Prod_Date_YYYYMMDD 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   // IF *OTHERWISE
   IF *OTHERWISE;

   // WRK.Days = PAR.From Prod Date YYYYMMDD - PAR.PT Offset Prod Date *DAYS
   WRK.Days = DURATION(PAR.From_Prod_Date_YYYYMMDD PAR.PT_Offset_Prod_Date 'DY' 1111111
   'NONE' 'N' 1);

   // LCL.Time Difference USR = WRK.Days * CON.240000 *
   LCL.Time_Difference_USR = WRK.Days * 240000;

   // LCL.Time Difference USR = LCL.Time Difference USR - PAR.Time In *HHMMSS
   LCL.Time_Difference_USR = TIMELAPSED(LCL.Time_Difference_USR PAR.Time_In 'HS');

   ENDIF;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR is Less than 0
   IF LCL.Time_Difference_USR < *ZERO;

   // LCL.Time Difference USR = CON.*ZERO - LCL.Time Difference USR
   LCL.Time_Difference_USR = 0 - LCL.Time_Difference_USR;

   ENDIF;

   CASE;

   // IF LCL.Time Difference USR LT DB1.Time Difference USR
   IF LCL.Time_Difference_USR < DB1.Time_Difference_USR;

   EXECUTE FUNCTION(UPD PT Closest Farms  CR) TYPE(CHGOBJ) ARRAY(ARR_Closest_Farms)AC1662542;
   PARAMETER(DB1.PT_Producer_Farm_Code_1);
   PARAMETER(LCL.Time_Difference_USR);
   ENDIF;

  }

  ENDIF;

  ENDIF;

  ENDIF;

  CASE;

  // IF LCL.Count USR is Four
  IF LCL.Count_USR = 4;

  QUIT;

  ENDIF;

 }

 //?Copy Array to another Array in Time Diff Seq
 EXECUTE FUNCTION(RTV PT Crt ClstFrms2  DL) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms)AC1662513;
 {
  //?USER: Process Data record

  EXECUTE FUNCTION(CRT PT Closest Farms2 CR) TYPE(CRTOBJ) ARRAY(ARR_Closest_Farms_AC1662514;
  PARAMETER(DB1.Time_Difference_USR);
  PARAMETER(DB1.PT_Producer_Farm_Code_1);
 }

 //?Load Db fields from the array  -- 1st 4 farms should be the closest.
 EXECUTE FUNCTION(Rtv PT Closest Farms2 RT) TYPE(RTVOBJ) ARRAY(ARR_Closest_Farms_AC1662494;
 PARAMETER(WRK.PT_Producer_Farm_Code_1);
 PARAMETER(WRK.PT_Producer_Farm_Code_2);
 PARAMETER(WRK.PT_Producer_Farm_Code_3);
 PARAMETER(WRK.PT_Producer_Farm_Code_4);
 {
  //?USER: Initialize routine

  // PAR.PT Producer/Farm Code 1 = CON.*BLANK
  PAR.PT_Producer_Farm_Code_1 = *BLANK;

  // PAR.PT Producer/Farm Code 2 = CON.*BLANK
  PAR.PT_Producer_Farm_Code_2 = *BLANK;

  // PAR.PT Producer/Farm Code 3 = CON.*BLANK
  PAR.PT_Producer_Farm_Code_3 = *BLANK;

  // PAR.PT Producer/Farm Code 4 = CON.*BLANK
  PAR.PT_Producer_Farm_Code_4 = *BLANK;

  //?USER: Process Data record

  CASE;

  // IF PAR.PT Producer/Farm Code 1 is Not Entered
  IF PAR.PT_Producer_Farm_Code_1 = *BLANK;

  // PAR.PT Producer/Farm Code 1 = DB1.PT Producer/Farm Code 1
  PAR.PT_Producer_Farm_Code_1 = DB1.PT_Producer_Farm_Code_1;

  // IF PAR.PT Producer/Farm Code 2 is Not Entered
  IF PAR.PT_Producer_Farm_Code_2 = *BLANK;

  // PAR.PT Producer/Farm Code 2 = DB1.PT Producer/Farm Code 1
  PAR.PT_Producer_Farm_Code_2 = DB1.PT_Producer_Farm_Code_1;

  // IF PAR.PT Producer/Farm Code 3 is Not Entered
  IF PAR.PT_Producer_Farm_Code_3 = *BLANK;

  // PAR.PT Producer/Farm Code 3 = DB1.PT Producer/Farm Code 1
  PAR.PT_Producer_Farm_Code_3 = DB1.PT_Producer_Farm_Code_1;

  // IF PAR.PT Producer/Farm Code 4 is Not Entered
  IF PAR.PT_Producer_Farm_Code_4 = *BLANK;

  // PAR.PT Producer/Farm Code 4 = DB1.PT Producer/Farm Code 1
  PAR.PT_Producer_Farm_Code_4 = DB1.PT_Producer_Farm_Code_1;

  ENDIF;

 }

 EXECUTE FUNCTION(Chg PT Closest Farms CH) TYPE(CHGOBJ) FILE(POB2CPP)            AC1662511;
 PARAMETER(DB1.Company_Number);
 PARAMETER(DB1.PT_Serial_Number);
 PARAMETER(DB1.PT_Prod_Date_YYYYMMDD);
 PARAMETER(DB1.PT_Production_Time);
 PARAMETER(WRK.PT_Producer_Farm_Code_1);
 PARAMETER(WRK.PT_Producer_Farm_Code_2);
 PARAMETER(WRK.PT_Producer_Farm_Code_3);
 PARAMETER(WRK.PT_Producer_Farm_Code_4);
 {
  //?USER: Processing before Data update

  EXECUTE FUNCTION(Set Date/Time Stamp   IF) TYPE(EXCINTFUN)                      AC1142219;
  PARAMETER(DB1.Job_Time);
  PARAMETER(DB1.User_Id);
  PARAMETER(DB1.Job_Name);
  PARAMETER(DB1.Job_Date);
  {
   //?Execute internal function

   // PAR.Job Time = JOB.*Job time
   PAR.Job_Time = JOB.*Job_time;

   // PAR.User Id = JOB.*USER
   PAR.User_Id = JOB.*USER;

   // PAR.Job Name = JOB.*JOB
   PAR.Job_Name = JOB.*JOB;

   // PAR.Job Date = JOB.*Job date
   PAR.Job_Date = JOB.*Job_date;

  }

 }

 ENDIF;

 ENDIF;

}


