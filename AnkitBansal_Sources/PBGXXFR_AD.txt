// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBGXXFR
// ?Date: 14.08.2025 Time: 03:47:56
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(Rtv/Crt WF BrkCustBCS/RT) TYPE(RTVOBJ) FILE(OMHOREP)           AC2057225;
PARAMETER(PAR.Ship_To_Customer);
PARAMETER(PAR.Date_Entered);
PARAMETER(PAR.Customer_Name_USR);
{
 //?USER: Process Data record

 CASE;

 // IF PAR.Date Entered GE DB1.Period Beginning Date
 IF PAR.Date_Entered >= DB1.Period_Beginning_Date;

 // AND PAR.Date Entered LE DB1.Period Ending Date
 AND PAR.Date_Entered <= DB1.Period_Ending_Date;

 DO;

 CASE;

 // IF DB1.All Products (Y/N) is Yes
 IF DB1.All_Products_Y_N = 'Y';

 //?Read only the Item default no need to go to Customer Accrual Item
 //?Rate will be populate from the Customer Accrual
 //?*** currently the rate is being pull from the Accrual Prog ONLY
 // IF DB1.All Products (Y/N) is No
 IF DB1.All_Products_Y_N = 'N';

 // OR DB1.All Products (Y/N) is Yes + Exceptions
 OR DB1.All_Products_Y_N = 'X';

 //?Read the Item default
 //?then read the Customer Accrual Item  - CA - Customer Acc Rate
 //?If the Customer Accrual Item is found the use the rate from CAI
 //?Write out wf with the Customer Accrual Item rate = CAI
 //?If the Customer Accrual Item is not found the used CA Rate only
 //?Write out wf with the Customer Accrual rate = CAR
 ENDIF;

 //?CREATE A RTV ON THE ITEM DEFAULT AND INSERT THE NEXT
 EXECUTE FUNCTION(RTV Brkr Cust Itm/Rate RT) TYPE(RTVOBJ) FILE(OMHPREP)          AC2055582;
 PARAMETER(LCL.Accrual_Code);
 PARAMETER(DB1.Ship_To_Customer);
 PARAMETER(DB1.CAH_Sequence_No);
 PARAMETER(LCL.Item_Code);
 PARAMETER(PAR.Date_Entered);
 PARAMETER(DB1.Accrual_Rate);
 PARAMETER(PAR.Customer_Name_USR);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Accrual Rate is Entered
  IF DB1.Accrual_Rate <> *ZERO;

  // WRK.Accrual Rate = DB1.Accrual Rate
  WRK.Accrual_Rate = DB1.Accrual_Rate;

  // IF *OTHERWISE
  IF *OTHERWISE;

  // WRK.Accrual Rate = PAR.Accrual Rate Customer Usr
  WRK.Accrual_Rate = PAR.Accrual_Rate_Customer_Usr;

  ENDIF;

  EXECUTE FUNCTION(Rtv Item Descriptions  RT) TYPE(RTVOBJ) FILE(OMBYREP)          AC1341279;
  PARAMETER(DB1.Item_Code);
  PARAMETER(WRK.Description_Line_One);
  PARAMETER(WRK.Description_Line_Two);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  EXECUTE FUNCTION(RtvCrt WF Brkr Cust RteRT) TYPE(RTVOBJ) FILE(PBAQCPP)          AC2057040;
  PARAMETER(DB1.Accrual_Code);
  PARAMETER(DB1.Ship_To_Customer);
  PARAMETER(DB1.Item_Code);
  {
   //?USER: Processing if Data record not found

   EXECUTE FUNCTION(Crt WF Brkr Comm Rate CR) TYPE(CRTOBJ) FILE(PBAQCPP)           AC2055286;
   PARAMETER(PAR.Accrual_Code);
   PARAMETER(PAR.Ship_To_Customer);
   PARAMETER(PAR.Item_Code);
   PARAMETER(PAR.Description_Line_One);
   PARAMETER(PAR.Accrual_Rate);
   PARAMETER(PAR.Customer_Name);
   PARAMETER(PAR.WFBC_Accrual_Built);
  }

 }

 ENDDO;

 ENDIF;

}


