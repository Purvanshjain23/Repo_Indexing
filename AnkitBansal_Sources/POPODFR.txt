// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for POPODFR
// ?Date: 14.08.2025 Time: 03:39:39
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

EXECUTE FUNCTION(VAL Set Inter. Access  IF) TYPE(EXCINTFUN)                     AC1144606;
PARAMETER('OMS');
PARAMETER(PAR.Company_Number);
PARAMETER(PAR.Warehouse_Code);
PARAMETER(PAR.Allow_Multi_Company);
PARAMETER(PAR.Default_Printer);
PARAMETER(PAR.Salesperson_Code);

// LCL.First Time Flag = CND.Yes
LCL.First_Time_Flag = 'Y';

// LCL.From Date             USR = CON.*ZERO
LCL.From_Date_USR = *ZERO;

// LCL.To Date               USR = CON.*ZERO
LCL.To_Date_USR = *ZERO;

//?***** Change Log and Comments
DO;

//?** E01104 RMC 11/10/2010 Added F22=List all/dates
//?** FP1098 LJB 06/23/2008
//?** Add option 3=Copy Price Code to copy price code records to
//?** a new date range
//?** Add F10=Create Japanese Chilled Orders
//?** Allow 2=Edit, even if there are orders. The edit program will
//?** check and if orders exist, change to output (except for
//?** Record Status)
ENDDO;

//?USER: Initialize subfile control

//?First Time
CASE;

// IF LCL.First Time Flag is Yes
IF LCL.First_Time_Flag = 'Y';

// CTL.Price End Date = JOB.*Job date
CTL.Price_End_Date = JOB.*Job_date;

// LCL.First Time Flag = CND.NO
LCL.First_Time_Flag = 'N';

ENDIF;

//?USER: Initialize subfile record from DBF record

EXECUTE FUNCTION(Ship To Name          DRV) TYPE(DRVFLD)                        AC1573561;
PARAMETER(RCD.Ship_To_Name_DRV);
PARAMETER(RCD.Ship_To_Customer);

//?USER: Process subfile control (Pre-confirm)

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?4/9/2004 slm add shipped to customer on f4
//?F4 Only on shipped to customer
CASE;

// IF CTL.*CMD key is *Prompt
IF CTL.*CMD_key = '04';

// AND PGM.*Cursor field <IS> CTL.Ship To Customer
AND PGM.*Cursor_field = CTL.Ship_To_Customer;

// Call program SEL Cust/ShpTo Flag 'Y'SR.
CALL PROGRAM(SEL Cust/ShpTo Flag 'Y'SR) ('PDYSSRR');
PARAMETER(CTL.Ship_To_Customer);

EXECUTE FUNCTION(Ship To Name          DRV) TYPE(DRVFLD)                        AC1573561;
PARAMETER(CTL.Ship_To_Name_DRV);
PARAMETER(CTL.Ship_To_Customer);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F6=Create
CASE;

// IF CTL.*CMD key is *Create
IF CTL.*CMD_key = '06';

// Call program Pmt Add Cust Prc Hdr  PV.
CALL PROGRAM(Pmt Add Cust Prc Hdr  PV) ('PPATPVR');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F13=Edit End Dates
CASE;

// IF CTL.*CMD key is *Edit Details
IF CTL.*CMD_key = '13';

// Call program DSP Edit Prc Cde Dates DF.
CALL PROGRAM(DSP Edit Prc Cde Dates DF) ('PBC8DFR');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F10=WW Create Orders
CASE;

// IF CTL.*CMD key is CF10
IF CTL.*CMD_key = '10';

// Call program zzz Japn Chlld Ord TmplPV.
CALL PROGRAM(zzz Japn Chlld Ord TmplPV) ('PMV3PVR');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F21=Print List - from a menu of several reports
CASE;

// IF CTL.*CMD key is *Print 21
IF CTL.*CMD_key = '21';

// PAR.System Value Numeric = PAR.PRT Number of Copies
PAR.System_Value_Numeric = PAR.PRT_Number_of_Copies;

//?** Create work file in QTEMP, print report from the work file
//?** WF Customer Price Hdr - PMD4CPP
// WRK.Broker Code = CND.Not entered
WRK.Broker_Code = *BLANK;

// Call program PMT PRT Contr Ords Rpt PV.
CALL PROGRAM(PMT PRT Contr Ords Rpt PV) ('PMWJPVR');
PARAMETER(WRK.Broker_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F22=Print List all/dates
CASE;

// IF CTL.*CMD key is CF22
IF CTL.*CMD_key = '22';

// Call program Zzz Cust Prc List SelctPV.
CALL PROGRAM(Zzz Cust Prc List SelctPV) ('PMVNPVR');
PARAMETER(WRK.Return_Code_Usr);

// PAR.System Value Numeric = PAR.PRT Number of Copies
PAR.System_Value_Numeric = PAR.PRT_Number_of_Copies;

CASE;

// IF WRK.Return Code Usr is Submit Cancelled
IF WRK.Return_Code_Usr = 'USR3649';

// Send information message - 'Submit has been cancelled'
MESSAGE(USR3649 *INFO);

// IF *OTHERWISE
IF *OTHERWISE;

// Send information message - 'Print has been submitted.'
MESSAGE(USR1832 *INFO);

ENDIF;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?F23=email price codes per sel item
CASE;

// IF CTL.*CMD key is CF23
IF CTL.*CMD_key = '23';

// Execute command - 'EXECUTE SQL SCRIPT'
EXECUTE COMMAND(USR4564);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?USER: Process subfile record (Pre-confirm)

//?2=Edit
CASE;

// IF RCD.*SFLSEL is *Edit
IF RCD.*SFLSEL = '2'/'2';

EXECUTE FUNCTION(VAL Cust/Price Code    RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1677004;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(LCL.Record_Found_USR);

//?Change to allow edit even if there are existing orders
// Call program Edt Customer Price    ET.
CALL PROGRAM(Edt Customer Price    ET) ('POPOETR');
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(LCL.Access_Denied_Y_N);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?3=Copy Price Code
CASE;

// IF RCD.*SFLSEL is *Copy request
IF RCD.*SFLSEL = '3'/'3';

// LCL.Ship to Customer      USR = RCD.Ship To Customer
LCL.Ship_to_Customer_USR = RCD.Ship_To_Customer;

// Call program PMT Date Rng for Copy  PV.
CALL PROGRAM(PMT Date Rng for Copy  PV) ('PMVMPVR');
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.To_Date_USR);
PARAMETER(LCL.Ship_to_Customer_USR);

CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

// IF LCL.Ship to Customer      USR is Not entered
IF LCL.Ship_to_Customer_USR = *ZERO;

// Send error message - 'Fields not found.'
ERROR(USR2408);

// IF LCL.From Date             USR is Not Entered
IF LCL.From_Date_USR = *ZERO;

// OR LCL.From Date             USR is Not Entered
OR LCL.From_Date_USR = *ZERO;

// Send error message - 'A Date Range is Required.'
ERROR(USR2591);
MSGPARM(LCL.From_Date_USR);
MSGPARM(LCL.To_Date_USR);
MSGPARM(LCL.From_Date_USR);

// IF *OTHERWISE
IF *OTHERWISE;

EXECUTE FUNCTION(RTV CPY Cust Price Hdr RT) TYPE(RTVOBJ) FILE(POC6REP)          AC1887189;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(LCL.From_Date_USR);
PARAMETER(LCL.To_Date_USR);
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(LCL.Ship_to_Customer_USR);

CASE;

// IF WRK.Return Code Usr is *Blank
IF WRK.Return_Code_Usr = *BLANK;

// Send information message - 'Price Code(s) have been created'
MESSAGE(USR3955 *INFO);

ENDIF;

ENDIF;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?4=Delete
CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(VAL Cust/Price Code    RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1677004;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER(LCL.Record_Found_USR);

CASE;

// IF LCL.Record Found USR is Record Found
IF LCL.Record_Found_USR = 'Y';

// Send error message - 'Customer Price &1 cannot be deleted. Orders exist.'
ERROR(USR3309);
MSGPARM(RCD.Price_Code);

// IF *OTHERWISE
IF *OTHERWISE;

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

ENDIF;

//?5=Display
CASE;

// IF RCD.*SFLSEL is *Display
IF RCD.*SFLSEL = '5'/'5';

// Call program Dsp Customer Price    DT.
CALL PROGRAM(Dsp Customer Price    DT) ('PPAMDTR');
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?6=Print Confirmation
CASE;

// IF RCD.*SFLSEL is *Print
IF RCD.*SFLSEL = '6'/'6';

// PAR.PRT Night Queue Run Sts = CND.no
PAR.PRT_Night_Queue_Run_Sts = 'N';

// LCL.Customer Number Pass  USR = RCD.Ship To Customer
LCL.Customer_Number_Pass_USR = RCD.Ship_To_Customer;

// LCL.Load Id Pass = RCD.Price Code
LCL.Load_Id_Pass = RCD.Price_Code;

// Call program PMT Prt Opt w/PSz SHR  PV.
CALL PROGRAM(PMT Prt Opt w/PSz SHR  PV) ('PDV8PVR');
PARAMETER('Customer Price Confirm');
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Number_of_Copies);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Application_Code);
PARAMETER(*MISSING);
PARAMETER(1);

CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

// IF *OTHERWISE
IF *OTHERWISE;

// PAR.System Value Numeric = PAR.PRT Number of Copies
PAR.System_Value_Numeric = PAR.PRT_Number_of_Copies;

// Call program PRT Cust Prc Confirm  UP.
SBMJOB;
CALL PROGRAM(PRT Cust Prc Confirm  UP) ('PPAVUPC');
PARAMETER(WRK.Return_Code_Usr);
PARAMETER(LCL.Customer_Number_Pass_USR);
PARAMETER(LCL.Load_Id_Pass);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.System_Value_Numeric);
SBMJOBOVR JOB(CPRCONF);
SBMJOBOVR JOBD(*USRPRF);
SBMJOBEND;

CASE;

// IF WRK.Return Code Usr is *Blank
IF WRK.Return_Code_Usr = *BLANK;

// Send information message - 'Print has been submitted.'
MESSAGE(USR1832 *INFO);

ENDIF;

ENDIF;

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?7=Inactivate
CASE;

// IF RCD.*SFLSEL is Option 7
IF RCD.*SFLSEL = '7'/'7';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: Process subfile record (Post-confirm)

CASE;

// IF RCD.*SFLSEL is *Delete
IF RCD.*SFLSEL = '4'/'4';

EXECUTE FUNCTION(Del Customer Prc H/D  IF) TYPE(EXCINTFUN)                      AC1677006;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

CASE;

// IF RCD.*SFLSEL is Option 7
IF RCD.*SFLSEL = '7'/'7';

EXECUTE FUNCTION(Chg Record Status     RT) TYPE(RTVOBJ) FILE(POC6REP)           AC2030273;
PARAMETER(RCD.Ship_To_Customer);
PARAMETER(RCD.Price_Code);
PARAMETER('I');

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

