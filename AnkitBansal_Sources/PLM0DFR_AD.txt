// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLM0DFR
// ?Date: 14.08.2025 Time: 02:54:44
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

// Execute function Mov ApplN to Company  US.
EXECUTE FUNCTION(Mov ApplN to Company  US) TYPE(EXCUSRSRC) ('PKMFUFR');
PARAMETER(PAR.Oms_System_Value_Alpha);
{
 C***   MOVE USER SOURCE                      ***
 C                     MOVEL#IEVTX    ##CMP
}


//?** 9/17/08 slm - New file used to capiture name of Subsidary
//?USER: Initialize subfile control

CASE;

// IF WRK.First Time Flag Usr EQ WRK.Blank USR
IF WRK.First_Time_Flag_Usr = WRK.Blank_USR;

// CTL.RS Record Status = CND.Active
CTL.RS_Record_Status = 'A';

// WRK.First Time Flag Usr = CND.Yes
WRK.First_Time_Flag_Usr = 'Y';

ENDIF;

EXECUTE FUNCTION(Producer Name         DRV) TYPE(DRVFLD)                        AB1100361;
PARAMETER(CTL.@Name);
PARAMETER(CTL.PD_Producer_Code);
{
 //?Calculate derived field

 EXECUTE FUNCTION(Rtv Producer Name     RT) TYPE(RTVOBJ) FILE(PKACREP)           AB1101542;
 PARAMETER(PAR.PD_Producer_Code);
 PARAMETER(PAR.Producer_Name_DRV);
 {
  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


//?USER: Process subfile control (Pre-confirm)

// PGM.*Defer confirm = CND.Defer confirm
PGM.*Defer_confirm = 'Y';

//?F6=Create
CASE;

// IF CTL.*CMD key is CF06
IF CTL.*CMD_key = '06';

// CTL.Producer Subsidary = WRK.Blank USR
CTL.Producer_Subsidiary_Code = WRK.Blank_USR;

// Call program Zzz ProdSubsidiary    E1.
CALL PROGRAM(Zzz ProdSubsidiary    E1) ('PLM1E1R');
PARAMETER(CTL.PD_Producer_Code);
PARAMETER(CTL.Producer_Subsidiary_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(LCL.Producer_Name_DRV);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: Process subfile record (Pre-confirm)

//?2=Edit
CASE;

// IF RCD.*SFLSEL is *Revise request
IF RCD.*SFLSEL = '2'/'2';

// Call program Zzz ProdSubsidiary    E1.
CALL PROGRAM(Zzz ProdSubsidiary    E1) ('PLM1E1R');
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.Producer_Subsidiary_Code);
PARAMETER(PAR.Oms_System_Value_Alpha);
PARAMETER(LCL.Producer_Name_DRV);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

//?Options 4
CASE;

// IF RCD.*SFLSEL is Select Purge
IF RCD.*SFLSEL = '4'/'4';

//?susan come back to this ???????????????????????
//?verify that no tattoo header exists for this
//?also review the producer purge
// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

// PGM.*Defer confirm = CND.Proceed to confirm
PGM.*Defer_confirm = 'N';

ENDIF;

//?USER: Process subfile record (Post-confirm)

CASE;

// IF RCD.*SFLSEL is *Delete request
IF RCD.*SFLSEL = '4'/'4';

//?Verify that the Tattoo are not using this subsidary
//?when the Tattoo Header Ext is changed to have the Producer Subsidary
//?then read the Tattoo Header Ext by Producer subsidary & if not found
//?then allow the delete
//?Add new routine to verify the Tattoo Header Ext
EXECUTE FUNCTION(Dlt Producer SubsidaryDO) TYPE(DLTOBJ) FILE(PLA8REP)           AB1291263;
PARAMETER(RCD.PD_Producer_Code);
PARAMETER(RCD.Producer_Subsidiary_Code);

// PGM.*Reload subfile = CND.*YES
PGM.*Reload_subfile = 'Y';

ENDIF;

