// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PLSYXFR
// ?Date: 14.08.2025 Time: 02:55:23
// ?------------------------------------------------------------------------------------------------

//?Execute user function

//?Modifications
//?11/05/2020 ISE H16853 - Recompiled due to change in Buy Order Number
// LCL.Count of Records Usr = CON.*ZERO
LCL.Count_of_Records_Usr = *ZERO;

// LCL.Company Number USR = CVTVAR(PAR.Company Number Alpha Usr)
LCL.Company_Number_USR = CVTVAR(PAR.Company_Number_Alpha_Usr);

// LCL.Number of Times Usr = CVTVAR(PAR.Number of Times Alpha Usr)
LCL.Number_of_Times_Usr = CVTVAR(PAR.Number_of_Times_Alpha_Usr);

// LCL.Kill Date Usr = JOB.*Job date
LCL.Kill_Date_Usr = JOB.*Job_date;

// WRK.Number of Times Usr = CON.00005
WRK.Number_of_Times_Usr = 00005;

// Call program Rtv Prv Kill Dt HPE#TMXF.
CALL PROGRAM(Rtv Prv Kill Dt HPE#TMXF) ('PBJIXFR');
PARAMETER(LCL.Return_Code_USR);
PARAMETER(LCL.Company_Number_USR);
PARAMETER(LCL.Kill_Date_Usr);
PARAMETER(LCL.Kill_Date_1_Usr);
PARAMETER(LCL.Number_of_Times_Usr);

CASE;

// IF LCL.Number of Times Usr GT WRK.Number of Times Usr
IF LCL.Number_of_Times_Usr > WRK.Number_of_Times_Usr;

//?Since we are working with job date must keep at least 5 days
//?do not remove records less then 5 days
CASE;

// IF LCL.Kill Date 1 Usr LT LCL.Kill Date Usr
IF LCL.Kill_Date_1_Usr < LCL.Kill_Date_Usr;

// Call program Prt Tattoo Pending CntPF.
CALL PROGRAM(Prt Tattoo Pending CntPF) ('PLS7PFR');
PARAMETER(LCL.Count_of_Records_Usr);
PARAMETER(LCL.Kill_Date_1_Usr);

EXECUTE FUNCTION(Rtv/Prg TatPndByDte(D)RT) TYPE(RTVOBJ) FILE(PKFJCPP)           AB1313735;
PARAMETER(LCL.Company_Number_USR);
PARAMETER(LCL.Kill_Date_1_Usr);
PARAMETER(LCL.Count_of_Records_Usr);
{
 //?USER: Initialize routine

 // PAR.Count of Records Usr = CON.*ZERO
 PAR.Count_of_Records_Usr = *ZERO;

 //?USER: Process Data record

 CASE;

 // IF DB1.TP Tattoo Date LE PAR.TP Tattoo Date
 IF DB1.TP_Tattoo_Date <= PAR.TP_Tattoo_Date;

 EXECUTE FUNCTION(Del Tattoo Pending    DL) TYPE(DLTOBJ) FILE(PKFJCPP)           AB1243800;
 PARAMETER(DB1.CC_Company_Number);
 PARAMETER(DB1.TP_Tattoo_Date);
 PARAMETER(DB1.TP_Tattoo_Number);
 // PAR.Count of Records Usr = PAR.Count of Records Usr + CON.1
 PAR.Count_of_Records_Usr = PAR.Count_of_Records_Usr + 1;

 // IF *OTHERWISE
 IF *OTHERWISE;

 QUIT;

 ENDIF;

}


// Call program Prt Tattoo Pending CntPF.
CALL PROGRAM(Prt Tattoo Pending CntPF) ('PLS7PFR');
PARAMETER(LCL.Count_of_Records_Usr);
PARAMETER(LCL.Kill_Date_1_Usr);

ENDIF;

ENDIF;

