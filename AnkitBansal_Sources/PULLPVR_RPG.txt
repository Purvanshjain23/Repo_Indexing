     H/TITLE Pmt Copy Fr/To Co Date PV Prompt & validate record
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H* - Prompts fields, allowing user changes
     H* - Validates fields
     H* - If valid, performs an action
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Prompt & validate record
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 09/06/19  Time  : 11:52:31
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FCAVLLSL0IF  E           K        DISK
      * Values list details file
      *
     FPULLPVR#CF  E                    WORKSTN
     F                                              KINFDS INFDS#
      * DSP: Pmt Copy Fr/To Co Date PV Prompt & validate record
      *
     FPUBBCPL1IF  E           K        DISK
      * RTV : PFS Balance Fallout Code  Retrieval index
      *
     FCAAFREL1IF  E           K        DISK
      * RTV : Calendar                  Retrieval index       NV
      *
     FPUBBCPL2IF  E           K        DISK
      * RSQ : PFS Balance Fallout Code  Co/ProdDte(D)/Item
      *
     FPDJYREL2IF  E           K        DISK
      * RTV : Company Defaults Internal Active Records
      *
     FCADRREL1IF  E           K        DISK
      * RTV : User Profile Control      Retrieval index       NV
      *
     FCADTREL1IF  E           K        DISK
      * RTV : User Application Profile  Retrieval index       NV
      *
     FCADNREL2IF  E           K        DISK
      * RSQ : Application               RSQ Application Code
      *
     FPUBBCPL0UF  E           K        DISK                      A
      * UPD : PFS Balance Fallout Code  Update index
      *
      * Days in month for date validation
     E                    @XD    12  12  2 0
     E                    UCT        40  1               CENTER TABLE
      * Long constants
     E                    @CN#    1  08  6   @CN    25
      * Set wdw location allowed?
     E                    YSL         1  1
     E                    YDOW        7  1               *Days of week
     I@BBCPEJ
      * PFS Balance Fallout Code  Update index
      * Renamed input format fields
     I              BBY1NX                          WAY1NX
     I              BBP7DT                          WAP7DT
     I              BBY2NX                          WAY2NX
     I              BBI2SC                          WAI2SC
     I              BBI3SC                          WAI3SC
     I              BBVJNA                          WAVJNA
     I              BBUWSX                          WAUWSX
     I              BBUXSX                          WAUXSX
     I              BBV3SX                          WAV3SX
     I              BBAHNY                          WAAHNY
     I              BBAINY                          WAAINY
     I              BBAJNY                          WAAJNY
     I              BBAKNY                          WAAKNY
      *
     I@AFREBE
      * Calendar                  Retrieval index       NV
      * Renamed input format fields
     I              AFAIC3                          WBAIC3
     I              AFBCDT                          WBBCDT
     I              AFCQNB                          WBCQNB
     I              AFESNB                          WBESNB
     I              AFETNB                          WBETNB
     I              AFBZNB                          WBBZNB
     I              AFA9ST                          WBA9ST
     I              AFEINB                          WBEINB
     I              AFC5ST                          WBC5ST
     I              AFAQNB                          WBAQNB
     I              AFCMST                          WBCMST
     I              AFV9ST                          WBV9ST
     I              AFWAST                          WBWAST
     I              AFX2ST                          WBX2ST
     I              AFOJDT                          WBOJDT
     I              AFNQNX                          WBNQNX
     I              AFNRNX                          WBNRNX
     I              AFI9SX                          WBI9SX
     I              AFJASX                          WBJASX
     I              AFOKDT                          WBOKDT
     I              AFOLDT                          WBOLDT
     I              AFUVST                          WBUVST
     I              AFUWST                          WBUWST
     I              AFUXST                          WBUXST
     I              AFAATM                          WBAATM
     I              AFAYNA                          WBAYNA
     I              AFA0NA                          WBA0NA
     I              AFAXDT                          WBAXDT
      *
     I@BBCPES
      * PFS Balance Fallout Code  Co/ProdDte(D)/Item
      * Renamed input format fields
     I              BBY1NX                          WCY1NX
     I              BBP7DT                          WCP7DT
     I              BBY2NX                          WCY2NX
     I              BBI2SC                          WCI2SC
     I              BBI3SC                          WCI3SC
     I              BBVJNA                          WCVJNA
     I              BBUWSX                          WCUWSX
     I              BBUXSX                          WCUXSX
     I              BBV3SX                          WCV3SX
     I              BBAHNY                          WCAHNY
     I              BBAINY                          WCAINY
     I              BBAJNY                          WCAJNY
     I              BBAKNY                          WCAKNY
      *
     I@JYRECE
      * Company Defaults Internal Active Records
      * Renamed input format fields
     I              JYAIC3                          WDAIC3
     I              JYZ9ST                          WDZ9ST
     I              JYCSST                          WDCSST
     I              JYZ8ST                          WDZ8ST
     I              JYCXST                          WDCXST
     I              JYSWST                          WDSWST
     I              JYXXTM                          WDXXTM
     I              JYUECD                          WDUECD
     I              JYHSST                          WDHSST
     I              JYAMEO                          WDAMEO
     I              JYSSDF                          WDSSDF
     I              JYPDFT                          WDPDFT
     I              JYYISX                          WDYISX
     I              JYYJSX                          WDYJSX
     I              JYYKSX                          WDYKSX
     I              JYYLSX                          WDYLSX
     I              JYYMSX                          WDYMSX
     I              JYYNSX                          WDYNSX
     I              JYUVST                          WDUVST
     I              JYUWST                          WDUWST
     I              JYUXST                          WDUXST
     I              JYVSST                          WDVSST
     I              JYAATM                          WDAATM
     I              JYAYNA                          WDAYNA
     I              JYA0NA                          WDA0NA
     I              JYAXDT                          WDAXDT
      *
     I@DRRETH
      * User Profile Control      Retrieval index       NV
      * Renamed input format fields
     I              DRAJVN                          WEAJVN
     I              DRAUNA                          WEAUNA
     I              DRB8NA                          WEB8NA
     I              DRAHVN                          WEAHVN
     I              DRI6ST                          WEI6ST
     I              DRI7ST                          WEI7ST
     I              DRXMST                          WEXMST
     I              DRXNST                          WEXNST
     I              DRI8ST                          WEI8ST
     I              DRNLNB                          WENLNB
     I              DRMPNA                          WEMPNA
     I              DRBCCD                          WEBCCD
     I              DRAIC3                          WEAIC3
     I              DRDQCD                          WEDQCD
     I              DRDRCD                          WEDRCD
     I              DRAJCD                          WEAJCD
     I              DRBUVN                          WEBUVN
     I              DRUVST                          WEUVST
     I              DRUWST                          WEUWST
     I              DRUXST                          WEUXST
     I              DRAATM                          WEAATM
     I              DRAYNA                          WEAYNA
     I              DRA0NA                          WEA0NA
     I              DRAXDT                          WEAXDT
      *
     I@DTRETE
      * User Application Profile  Retrieval index       NV
      * Renamed input format fields
     I              DTAJVN                          WFAJVN
     I              DTDNCD                          WFDNCD
     I              DTAIC3                          WFAIC3
     I              DTDQCD                          WFDQCD
     I              DTDRCD                          WFDRCD
     I              DTAJCD                          WFAJCD
     I              DTJFST                          WFJFST
     I              DTUVST                          WFUVST
     I              DTUWST                          WFUWST
     I              DTUXST                          WFUXST
     I              DTAATM                          WFAATM
     I              DTAYNA                          WFAYNA
     I              DTA0NA                          WFA0NA
     I              DTAXDT                          WFAXDT
      *
     I@DNRESF
      * Application               RSQ Application Code
      * Renamed input format fields
     I              DNDNCD                          WGDNCD
     I              DNAUNA                          WGAUNA
     I              DNVKST                          WGVKST
     I              DNRSCD                          WGRSCD
     I              DNUVST                          WGUVST
     I              DNUWST                          WGUWST
     I              DNUXST                          WGUXST
     I              DNAATM                          WGAATM
     I              DNAYNA                          WGAYNA
     I              DNA0NA                          WGA0NA
     I              DNAXDT                          WGAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IQPUBB1    E DSPUBBCPL0
      * UPD : PFS Balance Fallout Code  Update index
      * Renamed input format fields
     I              BBY1NX                          WAY1NX
     I              BBP7DT                          WAP7DT
     I              BBY2NX                          WAY2NX
     I              BBI2SC                          WAI2SC
     I              BBI3SC                          WAI3SC
     I              BBVJNA                          WAVJNA
     I              BBUWSX                          WAUWSX
     I              BBUXSX                          WAUXSX
     I              BBV3SX                          WAV3SX
     I              BBAHNY                          WAAHNY
     I              BBAINY                          WAAINY
     I              BBAJNY                          WAAJNY
     I              BBAKNY                          WAAKNY
      *
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
      /EJECT
     IXDINT       DS
      * Internal date
     I                                        1   70XDINDT
     I                                        1   30XDINYY
     I                                        4   50XDINMM
     I                                        6   70XDINDD
      /EJECT
     IXD2T        DS
      * Internal date
     I                                        1   70XDINT2
     I                                        1   30XDINY2
     I                                        4   50XDINM2
     I                                        6   70XDIND2
      /EJECT
     IXDEX        DS
      * External date
     I                                        1   80XDEXDT
     I                                        1   40XDEY01
     I                                        1   20XDEX01
     I                                        3   40XDEX02
     I                                        5   80XDEY02
     I                                        5   60XDEX03
     I                                        7   80XDEX04
      /EJECT
     IXDI8T       DS
      * Internal date
     I                                        1   80XDI8DT
     I                                        1   40XDI8CY
     I                                        1   10XDI8CC
     I                                        2   40XDI8YY
     I                                        5   60XDI8MM
     I                                        7   80XDI8DD
      /EJECT
     IXTCK        DS
      * Time: hours, minutes, seconds
     I                                        1   60XTTIM
     I                                        1   20XTHH
     I                                        3   40XTNN
     I                                        5   60XTSS
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: PFS Balance Fallout Code
      * I : MAP PFS Company Number
     I                                        1   30P1Y1NX
      * I : MAP PFS Production Date
     I                                        4  110P1P7DT
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Company must be a Plant'
      * @Numeric 3,0
     I                                    P   1   20ZA0001
      * Message data for 'Generic Message 80 NBR'
      * Generic Message 80 USR
     I                                        1  80 ZA0002
      * @Numeric 15.2
     I                                    P  81  882ZA0003
      * Message data for 'Generic Message 80 NBR'
      * Generic Message 80 USR
     I                                        1  80 ZA0004
      * @Numeric 15.2
     I                                    P  81  882ZA0005
      * Message data for 'Generic Message 80 NBR'
      * Generic Message 80 USR
     I                                        1  80 ZA0006
      * @Numeric 15.2
     I                                    P  81  882ZA0007
      * Message data for 'Value Required (numeric)'
      * @Numeric 15.2
     I                                    P   1   82ZA0008
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0009
      * Application Code
     I                                       11  16 ZA0010
      * Message data for 'Application access denied'
      * User Profile Name
     I                                        1  10 ZA0011
      * Application Code
     I                                       11  16 ZA0012
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1Y1NX    PARM           WP0001  30       PFS Company Num
     C           P1P7DT    PARM           WP0002  80       PFS Production
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Conduct screen conversation
     C                     DO   *HIVAL
      * Start new transaction
     C                     MOVEL'Y'       W0TRN   1
      * Process current transaction
     C           W0TRN     DOWEQ'Y'
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Reset screen fields
     C   30                CAS            MALDSC
      * Reposition window
     C   26                CAS            ZRRPWD
      * Process screen input
     C                     CAS            DAPRSC
     C                     END
      *
     C                     END
      *
     C                     END
      *****************************************************************
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSA1
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN04     YPMT04  1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE YPMT04    *IN04
     C                     MOVE HELP25    *IN25
     C                     Z-ADD1         YWPNNO  10       Panel number
     C                     MOVEL'S'       YWLCTP  1        Locate action t
     C                     EXSR ZSSTLC                     Set window loca
     C                     Z-ADD1         W0WASM  10
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDDTL1
      * Test cursor
     C                     EXSR Y8TST
      * Check if prompt requested
     C                     EXSR ZDVPMT
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSC    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate screen input
     C                     EXSR DBVLSC
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * Prompt for confirmation
     C                     EXSR DHPMCF
      * Quit if not confirmed
     C           *IN99     CABEQ'1'       DAEXIT
      * USER: User defined action
      * Delete all current & future date first except if To Company & Sta
      * Date Range is equal to the From Co/From Prod Date.
      * Upd Dlt Curr/Future Dt RT - PFS Balance Fallout Code  * 
     C                     EXSR SARVGN
      * Re-Create PFS Balance Fallout Code if it does NOT exist. Existing
      * records will not be updated.
      * Rtv Copy Fr/To Co Date RT - PFS Balance Fallout Code  * 
     C                     EXSR SCRVGN
      * Exit program
     C                     EXSR ZXEXPG
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBVLSC    BEGSR
      *================================================================
      * Validate screen input
      *================================================================
      * Validate Date Range Start USR
      * External date
     C                     Z-ADDVDA6DX    XDEXDT
      * Check date
     C                     EXSR XDC84
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
     C                     Z-ADDXDI8DT    #DA6DX
      * Validate Date Range End USR
      * External date
     C                     Z-ADDVDA7DX    XDEXDT
      * Check date
     C                     EXSR XDC84
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
     C                     Z-ADDXDI8DT    #DA7DX
     C           YPMTFD    IFEQ *BLANKS
      * USER: Validate fields
      * Validations.
      * CASE: *OTHERWISE
      * To Company.
      * CASE: DTL.To Company USR is not equal to zero
     C           #DD2NZ    IFNE *ZERO                      *IF
      * Company Must Be a Plant.
      * CASE: *OTHERWISE
      * Rtv Plant Co/Org      RT - Company Defaults Internal  * 
     C                     EXSR SGRVGN
      * CASE: LCL.Plant Company Sts is Plant Company
     C           YL0010    IFEQ 'P'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     Z-ADD#DD2NZ    ZA0001           To Company USR
      * Send message 'Company must be a Plant'
     C                     MOVEL'USR3706' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Date Range Start is Blank, Use From Prod Date.
      * CASE: DTL.Date Range Start USR is Not Entered
     C           #DA6DX    IFEQ *ZERO                      *IF
     C                     Z-ADD#1P7DT    #DA6DX           Date Range Star
     C                     END                             *FI
      * Production Date Range.
      * CASE: DTL.Date Range Start USR is Entered
     C           #DA6DX    IFGT *ZERO                      *IF
      * Start Date Range Cannot Equal From Prod Date if Copying to Same C
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DTL.Date Range Start USR EQ DTL.PFS Production Date
      *   |- c2    : DTL.PFS Company Number EQ DTL.To Company USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #DA6DX    IFEQ #1P7DT                     *IF
     C           #1Y1NX    IFEQ #DD2NZ                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL*BLANK    YL0011           Generic Message
     C                     MOVEL@CN,001   YL0011           Generic Message
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  @CN,002:ZQYL0011    P      Generic Message
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  @CN,003:ZQYL0011    P      Generic Message
      * Setup message data for message
     C                     MOVELYL0011    ZA0002           Generic Message
      * Convert Date Range Start USR to display format
      * Convert date
     C                     Z-ADD#DA6DX    XDI8DT
     C                     EXSR XDV82T
     C                     Z-ADDXDEXDT    ZA0003
      * Send message 'Generic Message 80 NBR'
     C                     MOVEL'USR5117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     END                             *FI
      * Check Date Range End.
      * CASE: DTL.Date Range End USR is Entered
     C           #DA7DX    IFGT *ZERO                      *IF
      * CASE: DTL.Date Range Start USR EQ DTL.Date Range End USR
     C           #DA6DX    IFEQ #DA7DX                     *IF
     C                     MOVEL*BLANK    YL0011           Generic Message
     C                     MOVEL@CN,004   YL0011           Generic Message
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  @CN,005:ZQYL0011    P      Generic Message
      * Setup message data for message
     C                     MOVELYL0011    ZA0004           Generic Message
      * Convert Date Range Start USR to display format
      * Convert date
     C                     Z-ADD#DA6DX    XDI8DT
     C                     EXSR XDV82T
     C                     Z-ADDXDEXDT    ZA0005
      * Send message 'Generic Message 80 NBR'
     C                     MOVEL'USR5117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     ELSE
      * CASE: DTL.Date Range End USR LT DTL.Date Range Start USR
     C           #DA7DX    IFLT #DA6DX                     *IF
     C                     MOVEL*BLANK    YL0011           Generic Message
     C                     MOVEL@CN,006   YL0011           Generic Message
     C                     Z-ADD1         ZQ      50
     C           YL0011    CAT  @CN,007:ZQYL0011    P      Generic Message
      * Setup message data for message
     C                     MOVELYL0011    ZA0006           Generic Message
      * Convert Date Range End USR to display format
      * Convert date
     C                     Z-ADD#DA7DX    XDI8DT
     C                     EXSR XDV82T
     C                     Z-ADDXDEXDT    ZA0007
      * Send message 'Generic Message 80 NBR'
     C                     MOVEL'USR5117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     ELSE
      * CASE: DTL.Date Range Start USR is Not Entered
     C           #DA6DX    IFEQ *ZERO                      *IF
      * Setup message data for message
      * Convert Date Range Start USR to display format
      * Convert date
     C                     Z-ADD#DA6DX    XDI8DT
     C                     EXSR XDV82T
     C                     Z-ADDXDEXDT    ZA0008
      * Send message 'Value Required (numeric)'
     C                     MOVEL'USR1962' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     GOTO DBEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      * To Company USR required
     C           #DD2NZ    IFEQ *ZERO                      IF
     C           YPMTFD    ANDEQ*BLANKS
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DHPMCF    BEGSR
      *================================================================
      * Prompt for confirmation
      *================================================================
      * Convert fields to external form
     C                     EXSR MNCV#1
      * Set screen conditioning indicators
     C                     EXSR GADSA1
      * Update screen time
     C                     TIME           ##TME
      * Refresh screen
     C                     MOVEL*BLANK    ##CFCD
     C                     MOVEL'N'       ##CFCD
      * Save CMD keys
     C                     MOVEA*IN       WN30   30
     C                     SETOF                     29    *
      * Generate internal/external key list
     C           KINEX     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2INVL
      * Convert *CONFIRM to external value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2INVL
     C                     MOVEL##CFCD    Y2INVL           *CONFIRM
     C           KINEX     CHAIN@Y2INEX              90    *
     C  N90                MOVELY2EXVL    V#CFCD           *CONFIRM
      *
     C           W0HLP     DOUEQ'N'
     C           *IN29     ANDEQ'0'
     C                     EXSR ZVCFPM
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     WRITE#RCDDTL1
     C                     EXFMT#CONFIRM
     C           *IN29     IFEQ '1'
     C                     SETON                     99
     C                     GOTO DHEXIT
     C                     END
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      * Validate *CONFIRM
     C                     MOVEL*BLANK    W0RTN
     C                     MOVELV#CFCD    W0NSRQ  1        *CONFIRM
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C           'V#CFCD'  OREQ YPMTFD
     C                     CALL 'CAVLLWR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1001713   Y2LSNO  70
     C           V#CFCD    PARM V#CFCD    W0EXVL 25        *CONFIRM
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C           W0NSRQ    IFNE '?'
     C                     MOVEL'*DONE'   YPMTFD
     C                     END
     C                     END
      * Check external value of *CONFIRM
      * Generate internal/external key list
     C           KEXIN     KLIST
     C                     KFLD           Y2LSNO
     C                     KFLD           Y2EXVL
      * Convert *CONFIRM to internal value
     C                     Z-ADD1001713   Y2LSNO
     C                     MOVEL*BLANK    Y2EXVL
     C                     MOVELV#CFCD    Y2EXVL           *CONFIRM
     C           KEXIN     CHAIN@Y2EXIN              90    *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANK    ##CFCD
     C           YPMTFD    IFEQ *BLANK
     C                     SETON                     96    *
     C                     WRITE#CONFIRM
     C                     SETOF                     96    *
     C                     END
     C                     ELSE
     C                     MOVELY2INVL    ##CFCD           *CONFIRM
     C                     END
      *
     C   90                SETON                     29    *
     C  N90                SETOF                     29    *
     C                     END
      * Restore CMD keys
     C                     MOVEAWN30      *IN
      * Update job time
     C                     TIME           ##JTM
     C           ##CFCD    IFEQ 'Y'
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     END
     C           ##CFCD    COMP 'Y'                  9999  *
      * Not confirmed
      *================================================================
     CSR         DHEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for screen
      *================================================================
     C                     MOVEL'0'       *IN79
     C           YL0012    IFEQ *BLANK                     *IF
     C           YL0012    OREQ 'N'
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         MALDSC    BEGSR
      *================================================================
      * Load screen from passed parameters
      *================================================================
     C                     Z-ADDP1Y1NX    #1Y1NX           PFS Company Num
     C                     Z-ADDP1P7DT    #1P7DT           PFS Production
      * Clear external version also
     C                     Z-ADD*ZERO     V1P7DT
     C                     Z-ADD*ZERO     #DD2NZ           To Company USR
     C                     Z-ADD*ZERO     #DA6DX           Date Range Star
      * Clear external version also
     C                     Z-ADD*ZERO     VDA6DX
     C                     Z-ADD*ZERO     #DA7DX           Date Range End
      * Clear external version also
     C                     Z-ADD*ZERO     VDA7DX
      * USER: Load screen
     C                     Z-ADDP1Y1NX    #DD2NZ           To Company USR
      * Do Not Allow to Change To Company.
      * CASE: LCL.Allow Multi-Company is Not Yes
     C           YL0012    IFEQ *BLANK                     *IF
     C           YL0012    OREQ 'N'
     C                     Z-ADD#1Y1NX    #DD2NZ           To Company USR
     C                     END                             *FI
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MNCV#1    BEGSR
      *================================================================
      * Convert fields into external form
      *================================================================
      * Convert PFS Production Date to display format
      * Convert date
     C                     Z-ADD#1P7DT    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    V1P7DT
      * Convert Date Range Start USR to display format
      * Convert date
     C                     Z-ADD#DA6DX    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    VDA6DX
      * Convert Date Range End USR to display format
      * Convert date
     C                     Z-ADD#DA7DX    XDI8DT
     C                     EXSR XDV84T
     C                     Z-ADDXDEXDT    VDA7DX
      *================================================================
     CSR         MNEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Upd Dlt Curr/Future Dt RT - PFS Balance Fallout Code  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * LCL.Current Date D8# = JOB.*Job date
     C           ##JDT     IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0001
     C                     ELSE
     C           ##JDT     ADD  19000000  YL0001           Current Date D8
     C                     END
      * Set Date When to Quit Read.
      * CASE: PAR.Date Range End USR is Not Entered
     C           #DA7DX    IFEQ 0                          *IF
     C                     Z-ADD#DA6DX    YL0002           Production Date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#DA7DX    YL0002           Production Date
     C                     END                             *FI
      * Declare restrictor key work fields
     C           *LIKE     DEFN BBY1NX    WQSA01           PFS Company Num
      * Define keylist
     C           KPSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
     C                     KFLD           BBP7DT           PFS Production
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           PFS Company Num
      * Setup key
     C                     Z-ADD#DD2NZ    WQSA01           PFS Company Num
     C                     Z-ADD#DA6DX    BBP7DT           PFS Production
      * Establish starting position
     C           KPSSA     SETLL@BBCPEK                    *
     C           KRSSA     READE@BBCPEK                  90*
      * Data record not found
     C   90                MOVEL'USR5110' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Delete from Date Range Else from Single Date.
      * CASE: PAR.Date Range End USR is Entered
     C           #DA7DX    IFGT 0                          *IF
      * CASE:
      *  - c1 AND c2 AND c3
      *   |- c1    : DB1.PFS Production Date GE PAR.PFS Production Date
      *   |- c2    : DB1.PFS Production Date LE PAR.Date Range End USR
      *   |- c3    : DB1.PFS Production Date GE LCL.Current Date D8#
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           BBP7DT    IFGE #DA6DX                     *IF
     C           BBP7DT    IFLE #DA7DX                     *IF
     C           BBP7DT    IFGE YL0001                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * If Same Company/Same Date Then Do Not Delete.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : PAR.From Company USR EQ PAR.PFS Company Number
      *   |- c2    : PAR.From Prod Date YYYYMMDD EQ DB1.PFS Production Da
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           #1Y1NX    IFEQ #DD2NZ                     *IF
     C           #1P7DT    IFEQ BBP7DT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Dlt PFS Bal Fallout CdeDL - PFS Balance Fallout Code  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDBBY1NX    WL0001           PFS Company Num
     C                     Z-ADDBBP7DT    WL0002           PFS Production
     C                     Z-ADDBBY2NX    WL0003           PFS Item Code
     C                     EXSR SBDLRC
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Delete from Single Date.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.PFS Production Date EQ PAR.PFS Production Date
      *   |- c2    : DB1.PFS Production Date GE LCL.Current Date D8#
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           BBP7DT    IFEQ #DA6DX                     *IF
     C           BBP7DT    IFGE YL0001                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Dlt PFS Bal Fallout CdeDL - PFS Balance Fallout Code  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADDBBY1NX    WL0001           PFS Company Num
     C                     Z-ADDBBP7DT    WL0002           PFS Production
     C                     Z-ADDBBY2NX    WL0003           PFS Item Code
     C                     EXSR SBDLRC
     C                     END                             *FI
     C                     END                             *FI
      * CASE: DB1.PFS Production Date GT LCL.Production Date USR D8#
     C           BBP7DT    IFGT YL0002                     *IF
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C           KRSSA     READE@BBCPEK                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * Dlt PFS Bal Fallout CdeDL - PFS Balance Fallout Code  * 
      *================================================================
      * This is a shared subroutine
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BBCPEJ
     C                     Z-ADDWL0001    WAY1NX           PFS Company Num
     C                     Z-ADDWL0002    WAP7DT           PFS Production
     C                     Z-ADDWL0003    WAY2NX           PFS Item Code
      *
     C           KLDLSB    KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAP7DT           PFS Production
     C                     KFLD           WAY2NX           PFS Item Code
     C           KLDLSB    CHAIN@BBCPEJ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PUBBCPL0'MDACP
     C                     MOVEL'@BBCPEJ' MDFMT
     C                     MOVEL'*DLT'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      *................................................................
     C                     DELET@BBCPEJ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv Copy Fr/To Co Date RT - PFS Balance Fallout Code  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
      * LCL.Current Date D8# = JOB.*Job date
     C           ##JDT     IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0003
     C                     ELSE
     C           ##JDT     ADD  19000000  YL0003           Current Date D8
     C                     END
      * Format Date Range Start.
      * CASE: *OTHERWISE
      * LCL.From Production Date = PAR.Date Range Start USR
     C           #DA6DX    IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0004
     C                     ELSE
     C           #DA6DX    SUB  19000000  YL0004           From Production
     C                     END
      * Format Date Range To.
      * CASE: PAR.Date Range To USR is Entered
     C           #DA7DX    IFGT 0                          *IF
      * LCL.To Production Date = PAR.Date Range To USR
     C           #DA7DX    IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0005
     C                     ELSE
     C           #DA7DX    SUB  19000000  YL0005           To Production D
     C                     END
     C                     END                             *FI
      * Declare restrictor key work fields
     C           *LIKE     DEFN BBY1NX    WQSC01           PFS Company Num
     C           *LIKE     DEFN BBP7DT    WQSC02           PFS Production
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           PFS Company Num
     C                     KFLD           WQSC02           PFS Production
      * Setup key
     C                     Z-ADD#1Y1NX    WQSC01           PFS Company Num
     C                     Z-ADD#1P7DT    WQSC02           PFS Production
      * Establish starting position
     C           KRSSC     SETLL@BBCPEK                    *
     C           KRSSC     READE@BBCPEK                  90*
      * Data record not found
     C   90                MOVEL'USR5110' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Do Not Copy if Both Balance & Fallout Sts = 'N'.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : DB1.PFS Balance Flag is No
      *   |- c2    : DB1.PFS Fallout Flag is No
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           BBI2SC    IFEQ 'N'                        *IF
     C           BBI3SC    IFEQ 'N'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Create for Single Date Else for a Date Range.
      * CASE: PAR.Date Range End USR is Not Entered
     C           #DA7DX    IFEQ 0                          *IF
      * Create it if Not Found.
      * CASE: *OTHERWISE
      * Rtv Prd Day Sts       RT - Calendar  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#DD2NZ    WL0004           Company Number
     C                     Z-ADDYL0004    WL0005           Post to G/L Dat
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    YL0006    P      Production Day
      * CASE: LCL.Production Day Status is yes
     C           YL0006    IFEQ 'Y'                        *IF
      * Upd Crt Balance FalloutRT - PFS Balance Fallout Code  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#DD2NZ    WL0007           PFS Company Num
     C                     Z-ADD#DA6DX    WL0008           PFS Production
     C                     Z-ADDBBY2NX    WL0009           PFS Item Code
     C                     MOVELBBI2SC    WL0010    P      PFS Balance Fla
     C                     MOVELBBI3SC    WL0011    P      PFS Fallout Fla
     C                     MOVELBBVJNA    WL0012    P      PFS Notes
     C                     MOVELBBUWSX    WL0013    P      PFS Record Stat
     C                     Z-ADDBBUXSX    WL0014           PFS Process Sta
     C                     MOVELBBV3SX    WL0015    P      PFS Error Reaso
     C                     EXSR SERVGN
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#DA6DX    YL0008           Date Range Star
      * Create Balance Fallout Code for Date Range.
      * DO WHILE: LCL.Date Range Start USR LE PAR.Date Range End USR
     C           YL0008    DOWLE#DA7DX                     *DOW
      * Format Start Date Range.
      * CASE: *OTHERWISE
      * LCL.Post to G/L Date = LCL.Date Range Start USR
     C           YL0008    IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0009
     C                     ELSE
     C           YL0008    SUB  19000000  YL0009           Post to G/L Dat
     C                     END
      * Rtv Prd Day Sts       RT - Calendar  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#DD2NZ    WL0004           Company Number
     C                     Z-ADDYL0009    WL0005           Post to G/L Dat
     C                     EXSR SDRVGN
      * Move subroutine local variables to output parameters.
     C                     MOVELWL0006    YL0006    P      Production Day
      * CASE: LCL.Production Day Status is yes
     C           YL0006    IFEQ 'Y'                        *IF
      * Upd Crt Balance FalloutRT - PFS Balance Fallout Code  * 
      * Move input parameters to subroutine local variables.
     C                     Z-ADD#DD2NZ    WL0007           PFS Company Num
     C                     Z-ADDYL0008    WL0008           PFS Production
     C                     Z-ADDBBY2NX    WL0009           PFS Item Code
     C                     MOVELBBI2SC    WL0010    P      PFS Balance Fla
     C                     MOVELBBI3SC    WL0011    P      PFS Fallout Fla
     C                     MOVELBBVJNA    WL0012    P      PFS Notes
     C                     MOVELBBUWSX    WL0013    P      PFS Record Stat
     C                     Z-ADDBBUXSX    WL0014           PFS Process Sta
     C                     MOVELBBV3SX    WL0015    P      PFS Error Reaso
     C                     EXSR SERVGN
     C                     END                             *FI
      * LCL.Date Range Start USR = LCL.Date Range Start USR + CON.1 *DAYS
     C           YL0008    SUB  18000000  XDINDT
     C                     EXSR XCVTA
     C                     Z-ADDXDAY1     XDAY2   60
     C                     Z-ADD1         XDURR   80
     C                     MOVEL'1'       XDSEL   1
     C                     MOVEL'1111111' XDCDW   7
     C                     EXSR XDOWS
     C                     EXSR XDADY
     C                     EXSR XCVFA
     C           XDINDT    IFLT 010101
     C           XDINDT    ORGT 4000000
     C                     Z-ADD*ZERO     YL0008
     C                     ELSE
     C           XDINDT    ADD  18000000  YL0008
     C                     END
     C                     END                             *ITR
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSC     READE@BBCPEK                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Prd Day Sts       RT - Calendar  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WBAIC3           Company Number
     C                     KFLD           WBBCDT           Post to G/L Dat
      * Setup key
     C                     Z-ADDWL0004    WBAIC3           Company Number
     C                     Z-ADDWL0005    WBBCDT           Post to G/L Dat
      * Establish starting position
     C           KRSSD     CHAIN@AFREBE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0018' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WL0006           Production Day
     C                     GOTO SDEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWBWAST    WL0006           Production Day
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Upd Crt Balance FalloutRT - PFS Balance Fallout Code  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCY1NX    WQSE01           PFS Company Num
     C           *LIKE     DEFN WCP7DT    WQSE02           PFS Production
     C           *LIKE     DEFN WCY2NX    WQSE03           PFS Item Code
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           PFS Company Num
     C                     KFLD           WQSE02           PFS Production
     C                     KFLD           WQSE03           PFS Item Code
      * Setup key
     C                     Z-ADDWL0007    WQSE01           PFS Company Num
     C                     Z-ADDWL0008    WQSE02           PFS Production
     C                     Z-ADDWL0009    WQSE03           PFS Item Code
      * Establish starting position
     C           KRSSE     SETLL@BBCPES                    *
     C           KRSSE     READE@BBCPES                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR5110' W0RTN   7
      * USER: Processing if Data record not found
      * Crt PFS Bal Fallout CdeCR - PFS Balance Fallout Code  * 
     C                     EXSR SFCRRC
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCRRC    BEGSR
      *================================================================
      * Crt PFS Bal Fallout CdeCR - PFS Balance Fallout Code  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  80       PFS Create Date
     C                     Z-ADD*ZERO     WN0002  60       PFS Create Time
     C                     Z-ADD*ZERO     WN0003  80       PFS Change Date
     C                     Z-ADD*ZERO     WN0004  60       PFS Change time
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BBCPEJ
     C                     Z-ADDWL0007    WAY1NX           PFS Company Num
     C                     Z-ADDWL0008    WAP7DT           PFS Production
     C                     Z-ADDWL0009    WAY2NX           PFS Item Code
     C                     MOVELWL0010    WAI2SC           PFS Balance Fla
     C                     MOVELWL0011    WAI3SC           PFS Fallout Fla
     C                     MOVELWL0012    WAVJNA           PFS Notes
     C                     MOVEL'A'       WAUWSX           PFS Record Stat
     C                     Z-ADDWL0014    WAUXSX           PFS Process Sta
     C                     MOVELWL0015    WAV3SX           PFS Error Reaso
      *
      * USER: Processing before Data update
      * Set Create Stamp 2    IF
     C                     Z-ADD0         WAUXSX           PFS Process Sta
      * LCL.USR Internal D8# YYYYMMDD = JOB.*Job date
     C           ##JDT     IFEQ *ZERO
     C                     Z-ADD*ZERO     YL0007
     C                     ELSE
     C           ##JDT     ADD  19000000  YL0007           USR Internal D8
     C                     END
     C                     Z-ADDYL0007    WAAHNY           PFS Create Date
     C                     Z-ADD##JTM     WAAINY           PFS Create Time
     C           KLCRSF    KLIST
     C                     KFLD           WAY1NX           PFS Company Num
     C                     KFLD           WAP7DT           PFS Production
     C                     KFLD           WAY2NX           PFS Item Code
      * Check for duplicate primary key
     C           KLCRSF    SETLL@BBCPEJ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR5111' W0RTN   7
      * Send message 'PFS Balance Fallout Co EX'
     C                     MOVEL'USR5111' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C                     WRITE@BBCPEJ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Plant Co/Org      RT - Company Defaults Internal  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WDAIC3           Company Number
      * Setup key
     C                     Z-ADD#DD2NZ    WDAIC3           Company Number
      * Establish starting position
     C           KRSSG     CHAIN@JYRECE              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR2025' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    YL0010           Plant Company S
     C                     GOTO SGEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWDYISX    YL0010           Plant Company S
     C                     ENDIF
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * RTV Program Setup w/Co RT - User Profile Control  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WEAJVN           User Profile Na
      * Setup key
     C                     MOVELWN0005    WEAJVN           User Profile Na
      * Establish starting position
     C           KRSSH     CHAIN@DRRETH              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0763' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWEI6ST    YL0012           Allow Multi-Com
     C                     Z-ADDWEAIC3    YL0013           Company Number
     C                     MOVELWEBUVN    WN0006           User Code Model
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * RTV Appl. Profile      RT - User Application Profile  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           WFAJVN           User Profile Na
     C                     KFLD           WFDNCD           Application Cod
      * Setup key
     C                     MOVELWL0016    WFAJVN           User Profile Na
     C                     MOVELWL0017    WFDNCD           Application Cod
      * Establish starting position
     C           KRSSI     CHAIN@DTRETE              90    *
      * Data record not found
     C   90                MOVEL'USR0767' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     Z-ADDWFAIC3    WL0018           Company Number
     C                     MOVELWFAJCD    WL0019           Warehouse Code
     C                     ENDIF
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * RTV Applic. Group Desc RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGDNCD    WQSJ01           Application Cod
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           Application Cod
      * Setup key
     C                     MOVE *BLANK    WQSJ01           Application Cod
     C                     MOVEL'P/S'     WQSJ01           Application Cod
      * Establish starting position
     C           KRSSJ     SETLL@DNRESF                    *
     C           KRSSJ     READE@DNRESF                  90*
      * Data record not found
     C   90                MOVEL'USR0755' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Application Group is Blank
     C           WGRSCD    IFEQ *BLANK                     *IF
      * PAR = DB1 By name
     C                     MOVELWGAUNA    WUAUNA           Description
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Application Desc   RT - Application  * 
     C                     EXSR SKRVGN
     C                     END                             *FI
     C           KRSSJ     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * RTV Application Desc   RT - Application  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WGDNCD    WQSK01           Application Cod
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Application Cod
      * Setup key
     C                     MOVELWGRSCD    WQSK01           Application Cod
      * Establish starting position
     C           KRSSK     SETLL@DNRESF                    *
     C           KRSSK     READE@DNRESF                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0755' W0RTN   7
      * USER: Processing if Data record not found
      * PAR = CON By name
     C                     MOVEL*BLANK    WUAUNA           Description
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SKEXIT
     C                     ENDIF
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * PAR = DB1 By name
     C                     MOVELWGAUNA    WUAUNA           Description
     C           KRSSK     READE@DNRESF                  90*
     C                     ENDDO
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         XCVFA     BEGSR
      *================================================================
      * Convert absolute day to date
      *================================================================
     C           XDAY1     IFGT 109267
     C                     ADD  2         XDAY1
     C                     ELSE
     C           XDAY1     IFGT 36218
     C                     ADD  1         XDAY1
     C                     END
     C                     END
      * Full years (up to the date)
     C           XDAY1     DIV  365.25    XDWK1   80
     C                     MVR            XDWK3   71
     C                     Z-ADDXDWK1     XDINYY
     C           XDWK3     IFEQ 0
      * The date is the end of a year
     C                     Z-ADD12        XDINMM
     C                     Z-ADD31        XDINDD
     C                     ELSE
      * Year days up to the date
     C           XDWK1     MULT 365.25    XDWK2   60
     C                     SUB  XDWK2     XDAY1
     C                     ADD  1         XDINYY
      * Leap year ?
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
      * March 1 (relative day of the year)
     C           XDWK1     IFEQ 0
     C                     Z-ADD60        XDWK1
     C                     ELSE
     C                     Z-ADD59        XDWK1
     C                     END
      * Define date base month and offset day -
     C           XDAY1     IFLE XDWK1
      *  - January (thru February)
     C                     Z-ADD1         XDINMM
     C                     ELSE
     C                     SUB  XDWK1     XDAY1
     C           XDAY1     IFLE 153
      *  - March (thru July)
     C                     Z-ADD3         XDINMM
     C                     ELSE
      *  - August (thru December)
     C                     Z-ADD8         XDINMM
     C                     SUB  153       XDAY1
     C                     END
      * Calculate 2 month base and offset day
     C           XDAY1     SUB  1         XDWK1
     C                     DIV  61        XDWK1
     C                     MVR            XDAY1
     C                     ADD  1         XDAY1
     C                     MULT 2         XDWK1
     C                     ADD  XDWK1     XDINMM
     C                     END
      * Calculate date increment,
     C           XDAY1     IFGT 31
     C                     ADD  1         XDINMM
     C                     SUB  31        XDAY1
     C                     END
     C                     Z-ADDXDAY1     XDINDD
     C                     END
      *================================================================
     CSR         XCVFAE    ENDSR
      /EJECT
     CSR         XCVTA     BEGSR
      *================================================================
      * Convert date to absolute day (from 01/01/01)
      *================================================================
      * Absolute day =
      * 365*(YY-1)+(YY-1)/4 (past years w/extra days of leap ones) ...
     C           XDINYY    SUB  1         XDWK1   80
     C           XDWK1     MULT 365.25    XDAY1   60
     C           XDWK1     IFGE 300
     C                     SUB  2         XDAY1
     C                     ELSE
     C           XDWK1     IFGE 100
     C                     SUB  1         XDAY1
     C                     END
     C                     END
      * (from the beginning of the year to the beginning of the month:)
     C           XDINMM    SUB  1         XDWK1
     C           XDINMM    IFLT 3
      *     ...+31*(MM-1) (for January-February) ...
     C                     MULT 31        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *     ...+30*(MM-1) (for March-December) ...
     C                     MULT 30        XDWK1
     C                     ADD  XDWK1     XDAY1
      *         ...-2 (for preceding February) ...
     C                     SUB  2         XDAY1
     C           XDINYY    IFNE 100
     C           XDINYY    ANDNE300
      *         ...+1 (for preceding February, if leap year) ...
     C           XDINYY    DIV  4         XDWK1
     C                     MVR            XDWK1
     C           XDWK1     IFEQ 0
     C                     ADD  1         XDAY1
     C                     END
     C                     END
     C           XDINMM    IFLT 8
      *         ...+MM/2 (preceding 31-sts for March-July) ...
     C           XDINMM    MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     ELSE
      *         ...+(MM+1)/2 (same for August-December) ...
     C           XDINMM    ADD  1         XDWK1
     C                     MULT .5        XDWK1
     C                     ADD  XDWK1     XDAY1
     C                     END
     C                     END
      * ...+DD (days in the month up to the ending date)
     C                     ADD  XDINDD    XDAY1
      *================================================================
     CSR         XCVTAE    ENDSR
      /EJECT
     CSR         XDADY     BEGSR
      *================================================================
      * Calculate date increment, *DAYS
      *================================================================
     C           XDURR     IFEQ 0
     C           XDWSL     OREQ 0
      * None days of week selected
     C                     Z-ADDXDAY2     XDAY1
     C           XDURR     IFNE *ZERO
      * Return Code: Unable to increment date.
     C                     MOVEL'Y2U0059' W0RTN   7
     C                     ENDIF
     C                     GOTO XDADYE
     C                     ENDIF
     C           XDWSL     IFEQ 7
      * All days of week selected
     C           XDAY2     ADD  XDURR     XDAY1
     C                     GOTO XDADYM
     C                     ENDIF
      * Some days of week selected
     C           XDURR     IFGE 0
     C                     Z-ADD1         XDSTP   10
     C                     ELSE
     C                     Z-ADD-1        XDSTP
     C                     ENDIF
      * Get number of full weeks in the duration
     C           XDURR     DIV  XDWSL     XDWNB   60
      * Isolate the last week
     C                     MVR            XDLSW   10
     C           XDLSW     IFEQ 0
     C           XDWSL     MULT XDSTP     XDLSW
     C                     SUB  XDSTP     XDWNB
     C                     ENDIF
      * Increment the date by the full weeks
     C           XDWNB     MULT 7         XDWK1   80
     C           XDAY2     ADD  XDWK1     XDAY1   60
      * Determine day of week of the beginning date
     C           XDAY2     ADD  3         YY      60
     C                     DIV  7         YY
     C                     MVR            YY
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ENDIF
      * Loop: Increment the date by the last week
     C           XDLSW     DOWNE0
      * Increment the date
     C                     ADD  XDSTP     XDAY1
      * Increment the day of week
     C                     ADD  XDSTP     YY
      * Put day of week into the range 1-7
     C           YY        IFEQ 0
     C                     Z-ADD7         YY
     C                     ELSE
     C           YY        IFEQ 8
     C                     Z-ADD1         YY
     C                     ELSE
     C           YY        IFEQ -1
     C                     Z-ADD6         YY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           YDOW,YY   IFEQ XDSEL
      * Selected day of the last week has been processed
     C                     SUB  XDSTP     XDLSW
     C                     ENDIF
      * End of loop
     C                     ENDDO
     C           XDADYM    TAG
     C           XDINDD    IFLT 1
     C                     Z-ADD1         XDINDD
     C                     MOVEL'Y2U0006' W0RTN   7
     C                     ENDIF
      *================================================================
     CSR         XDADYE    ENDSR
      /EJECT
     CSR         XDC84     BEGSR
      *================================================================
      * Validate external date format
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
     C                     Z-ADD*ZERO     XDI8DT
      * If external date is zero, do not check
     C           XDEXDT    CABEQ*ZERO     XDC84E
      *................................................................
      * Map external to internal according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDEX01    XDI8DD           DD
     C                     Z-ADDXDEX02    XDI8MM           MM
     C           XDEY02    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY02    XDI8YY            YYY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDEX01    XDI8MM           MM
     C                     Z-ADDXDEX02    XDI8DD           DD
     C           XDEY02    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY02    XDI8YY            YYY
     C                     ELSE
     C           XDEY01    DIV  1000      XDI8CC           Y
     C                     Z-ADDXDEY01    XDI8YY            YYY
     C                     Z-ADDXDEX03    XDI8MM           MM
     C                     Z-ADDXDEX04    XDI8DD           DD
     C                     END
     C                     END
     C           YPMTFD    CABNE*BLANK    XDC84E
     C           XDDTFM    IFEQ 'YMD'
      *................................................................
     C           XDEY01    IFGE 2200
     C           XDI8DT    ORNE *ZERO
     C           XDEY01    ANDLT1801
     C                     GOTO XDC84M
     C                     END
     C                     ELSE
      *................................................................
     C           XDEY02    IFGE 2200
     C           XDI8DT    ORNE *ZERO
     C           XDEY02    ANDLT1801
     C                     GOTO XDC84M
     C                     END
     C                     END
      *................................................................
      * Check months in range 1 to 12
     C           XDI8MM    CABLT1         XDC84M
     C           XDI8MM    CABGT12        XDC84M
      *................................................................
      * Check days in range 1 to maximum for month
     C           XDI8DD    CABLT1         XDC84M
     C           XDI8DD    CABGT@XD,XDI8MMXDC84M
      *................................................................
      * Special case: leap year
     C           XDI8MM    IFEQ 2
     C           XDI8YY    IFNE 900
     C           XDI8YY    ANDNE100
     C           XDI8YY    DIV  4         XDWK1   80
     C                     MVR            XDWK1
     C                     ELSE
     C                     Z-ADD1         XDWK1
     C                     END
      * Year is not leap
     C           XDWK1     IFNE *ZERO
     C           XDI8DD    CABGT28        XDC84M
     C                     END
     C                     END
     C                     GOTO XDC84E
      *................................................................
      * Send error message
     C           XDC84M    TAG
      * Send message '*Invalid date'
     C                     MOVEL'Y2U0006' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0006' W0RTN
      * Disable time portion if timestamp is validated
     C                     Z-ADD*ZERO     XTTIM
      *================================================================
     CSR         XDC84E    ENDSR
      /EJECT
     CSR         XDOWS     BEGSR
      *================================================================
      * Setup days of week array
      *================================================================
     C                     MOVEAXDCDW     YDOW
     C                     Z-ADD0         XDWSL   10
     C                     Z-ADD1         YY
     C           YY        DOWLE7
     C           YDOW,YY   IFEQ XDSEL
     C                     ADD  1         XDWSL
     C                     END
     C                     ADD  1         YY
     C                     END
      *================================================================
     CSR         XDOWSE    ENDSR
      /EJECT
     CSR         XDV82T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C                     Z-ADD0         XDEX01           CC
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDI8DD    XDEX02           DD
     C                     Z-ADDXDI8MM    XDEX03           MM
     C                     Z-ADDXDI8YY    XDEX04           YY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDI8MM    XDEX02           MM
     C                     Z-ADDXDI8DD    XDEX03           DD
     C                     Z-ADDXDI8YY    XDEX04           YY
     C                     ELSE
      * YMD format
     C                     Z-ADDXDI8YY    XDEX02           YY
     C                     Z-ADDXDI8MM    XDEX03           MM
     C                     Z-ADDXDI8DD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDV82E    ENDSR
      /EJECT
     CSR         XDV84T    BEGSR
      *================================================================
      * Convert internal to external date format
      *================================================================
      * Map according to date format
     C           XDDTFM    IFEQ 'DMY'
     C                     Z-ADDXDI8DD    XDEX01           DD
     C                     Z-ADDXDI8MM    XDEX02           MM
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
     C           XDDTFM    IFEQ 'MDY'
     C                     Z-ADDXDI8MM    XDEX01           MM
     C                     Z-ADDXDI8DD    XDEX02           DD
     C           1000      MULT XDI8CC    XDEY02           Y
     C                     ADD  XDI8YY    XDEY02            YYY
     C                     ELSE
      * YMD format
     C           1000      MULT XDI8CC    XDEY01           Y
     C                     ADD  XDI8YY    XDEY01            YYY
     C                     Z-ADDXDI8MM    XDEX03           MM
     C                     Z-ADDXDI8DD    XDEX04           DD
     C                     END
     C                     END
      *================================================================
     CSR         XDV84E    ENDSR
      /EJECT
     CSR         YKDDW1    BEGSR
      *================================================================
      * Calculate window location for drop down lists on screen 1
      *================================================================
      *================================================================
     CSR         YKEXT1    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ##WSR     MULT 256       ZWORK   50
     C                     ADD  ##WSC     ZWORK
     C                     SUB  ZWORK     ZINPOS
     C                     SUB  1         ZINPOS
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZDVPMT    BEGSR
      *================================================================
      * Process prompt request
      *================================================================
      *
      * Initialise prompt workfields
     C                     MOVEL*BLANK    YPMTFD 10
     C                     Z-ADD*ZERO     YAFSCH  40
     C                     Z-ADD*ZERO     YPMRRN  40
      *
     C           *IN04     IFEQ '1'
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50
     C                     MVR            ZHCSCL  50
      *
      * Save cursor position for redisplay
     C           @#WWRC    DIV  256       ZZCSRW  30       Row
     C                     MVR            ZZCSCL  30       Column
      *
     C           YPMTFD    IFEQ *BLANK
      * Error if user defined prompting is not specified.
     C           W0PMT     IFEQ 'N'
     C                     MOVEL'*NONE'   YPMTFD
     C                     MOVEL'Y'       W0HLP   1
     C                     MOVEL'Y'       ZAFSMS
      * Send error message.
     C                     MOVEL'Y2U0101' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         ZDEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C           @#WWRC    DIV  256       ZZCSRW  30       Row
     C                     MVR            ZZCSCL  30       Column
      *
     C           ZHCSRW    SUB  ##WSR     YWPORW  30
     C           ZHCSCL    SUB  ##WSC     YWPOC1  30
     C                     SUB  1         YWPOC1
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM YWPORW    YYRW    50       Row
     C                     PARM YWPOC1    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZRRPWD    BEGSR
      *================================================================
      * *Reposition window
      *================================================================
     C                     MOVEL'Y'       YSL,1            Set wdw locatio
     C                     MOVEL'R'       YWLCTP  1        Locate action t
     C                     EXSR ZSSTLC                     Set window loca
      *
      * Redisplay previous panel
     C                     WRITEASSUME
      *================================================================
     CSR         ZREXIT    ENDSR
      /EJECT
     CSR         ZSSTLC    BEGSR
      *================================================================
      * Set window location
      *================================================================
     C           YSL,1     IFEQ 'Y'                        Set wdw locatio
     C           YWLCTP    IFEQ 'S'                        Locate action t
     C                     Z-ADD021       YWWDRW           Window start ro
     C                     Z-ADD074       YWWDCL           Window start co
     C                     MOVEL'*BR  '   YWWDCR           Window referenc
     C                     ELSE
     C                     MOVEL'S'       YWLCTP           Locate action t
     C                     MOVEL'*CALC'   YWWDCR           Window referenc
     C                     Z-ADD-3        YWWDRW           Window start ro
     C                     Z-ADD-3        YWWDCL           Window start co
     C                     END
     C                     Z-ADD063       YWWDWD           Window width
     C                     Z-ADD014       YWWDDP           Window depth
     C                     MOVEL'N'       YSL,1            Set wdw locatio
      *
     C                     EXSR ZURTLC                     Retrieve window
     C                     EXSR ZTWDFD                     Move window fie
     C                     END
      *================================================================
     CSR         ZSEXIT    ENDSR
      /EJECT
     CSR         ZTWDFD    BEGSR
      *================================================================
      * Move window fields by panel
      *================================================================
     C                     Z-ADDYWWDRW    ##WSR            Window start ro
     C                     Z-ADDYWWDCL    ##WSC            Window start co
     C                     EXSR YKDDW1
      *================================================================
     CSR         ZTEXIT    ENDSR
      /EJECT
     CSR         ZURTLC    BEGSR
      *================================================================
      * Retrieve window location
      *================================================================
      *
      * Set up parameters to API
      *
      * Return code
     C                     MOVEL*BLANKS   W0RTN
      * Retrieval Function
     C                     MOVEL*BLANKS   YWRTFN
     C                     MOVEL'*WDWLOC' YWRTFN
      *
     C                     SETOF                       90  *
      *
     C                     CALL 'YWRTLCI'              90  *
     C                     PARM           YWRTFN 10        Retrieval Funct
     C                     PARM           YWWDWD  30       Window width
     C                     PARM           YWWDDP  30       Window depth
     C                     PARM           YWWDCR  5        Window referenc
     C                     PARM           YWWDRW  30       *Window start r
     C                     PARM           YWWDCL  30       *Window start c
     C                     PARM           W0RTN            Return code
      * If error on call to API - default window location to top left cor
     C           *IN90     IFEQ '1'
     C           W0RTN     ORNE *BLANKS
     C                     Z-ADD2         YWWDRW           *Window start r
     C                     Z-ADD2         YWWDCL           *Window start c
     C                     END
      *
      *================================================================
     CSR         ZUEXIT    ENDSR
      /EJECT
     CSR         ZVCFPM    BEGSR
      *================================================================
      * Set Confirm Prompt window location
      *================================================================
      *
     C           ##WSR     ADD  014       YWWDRW
     C           ##WSC     ADD  063       YWWDCL
      *
     C                     ADD  1         YWWDCL
     C                     SUB  1         YWWDRW           Window start ro
     C                     SUB  21        YWWDCL           Window start co
     C                     Z-ADD18        YWWDWD           Window width
     C                     Z-ADD2         YWWDDP           Window depth
     C                     MOVEL'*TL  '   YWWDCR           Window referenc
     C                     MOVEL*BLANKS   YWRTFN
     C                     MOVEL'*WDWLOC' YWRTFN           Retrieval Funct
     C                     EXSR ZURTLC                     Retrieve window
     C                     Z-ADDYWWDRW    ##WSRC           *Window start r
     C                     Z-ADDYWWDCL    ##WSCC           *Window start c
      *
      *================================================================
     CSR         ZVEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialise Allow Set Window Location flags
     C                     MOVEA*ALL'Y'   YSL
      * Set display size
     C                     SETOF                         93*
     C           @#SCRW    COMP 27                       93*
      * Initialise window location variables.
     C                     Z-ADD*ZEROS    ##WSR
     C                     Z-ADD*ZEROS    ##WSC
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAY1NX           PFS Company Num
     C                     Z-ADD*ZERO     WAP7DT           PFS Production
     C                     Z-ADD*ZERO     WAY2NX           PFS Item Code
     C                     Z-ADD*ZERO     WAUXSX           PFS Process Sta
     C                     Z-ADD*ZERO     WAAHNY           PFS Create Date
     C                     Z-ADD*ZERO     WAAINY           PFS Create Time
     C                     Z-ADD*ZERO     WAAJNY           PFS Change Date
     C                     Z-ADD*ZERO     WAAKNY           PFS Change time
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WBAIC3           Company Number
     C                     Z-ADD*ZERO     WBBCDT           Post to G/L Dat
     C                     Z-ADD*ZERO     WBCQNB           Julian Date
     C                     Z-ADD*ZERO     WBESNB           Accounting Year
     C                     Z-ADD*ZERO     WBETNB           Accounting Peri
     C                     Z-ADD*ZERO     WBBZNB           OM Week
     C                     Z-ADD*ZERO     WBEINB           Week Number
     C                     Z-ADD*ZERO     WBAQNB           Billing Cycle
     C                     Z-ADD*ZERO     WBOJDT           HPS PIC Date
     C                     Z-ADD*ZERO     WBNQNX           HPS Calendar Ye
     C                     Z-ADD*ZERO     WBNRNX           HPS Calendar We
     C                     Z-ADD*ZERO     WBOKDT           Calendar Unused
     C                     Z-ADD*ZERO     WBOLDT           Calendar Unused
     C                     Z-ADD*ZERO     WBAATM           Job Time
     C                     Z-ADD*ZERO     WBAXDT           Job Date
      * Obtain default message file
     C           *NAMVAR   DEFN CAMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDXXTM           Departure Time
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WENLNB           Entity Number
     C                     Z-ADD*ZERO     WEAIC3           Company Number
     C                     Z-ADD*ZERO     WEAATM           Job Time
     C                     Z-ADD*ZERO     WEAXDT           Job Date
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WFAIC3           Company Number
     C                     Z-ADD*ZERO     WFAATM           Job Time
     C                     Z-ADD*ZERO     WFAXDT           Job Date
      * Define work field Description
     C                     MOVEL*BLANK    WUAUNA 30
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WGAATM           Job Time
     C                     Z-ADD*ZERO     WGAXDT           Job Date
      * Define work field USR Description 40
     C                     MOVEL*BLANK    WUDSC4 40
      * Define work field USR Description 40   2
     C                     MOVEL*BLANK    WUDE40 40
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Dummy move for compiler
     C                     MOVE '0'       @CN#,1
     C                     MOVEL'N'       W0PMT   1
      * Define local variables for subroutine SBDLRC.
     C                     Z-ADD*ZERO     WL0001  30
     C                     Z-ADD*ZERO     WL0002  80
     C                     Z-ADD*ZERO     WL0003  70
      * Define local variables for subroutine SDRVGN.
     C                     Z-ADD*ZERO     WL0004  30
     C                     Z-ADD*ZERO     WL0005  70
     C                     MOVEL*BLANK    WL0006  1
      * Define local variables for subroutine SERVGN.
     C                     Z-ADD*ZERO     WL0007  30
     C                     Z-ADD*ZERO     WL0008  80
     C                     Z-ADD*ZERO     WL0009  70
     C                     MOVEL*BLANK    WL0010  1
     C                     MOVEL*BLANK    WL0011  1
     C                     MOVEL*BLANK    WL0012 50
     C                     MOVEL*BLANK    WL0013  1
     C                     Z-ADD*ZERO     WL0014  10
     C                     MOVEL*BLANK    WL0015  6
      * Define local variables for subroutine SIRVGN.
     C                     MOVEL*BLANK    WL0016 10
     C                     MOVEL*BLANK    WL0017  6
     C                     Z-ADD*ZERO     WL0018  30
     C                     MOVEL*BLANK    WL0019  3
      * Define local work field Current Date D8#
     C                     Z-ADD*ZERO     YL0001  80
      * Define local work field Production Date USR D8#
     C                     Z-ADD*ZERO     YL0002  80
      * Define local work field Current Date D8#
     C                     Z-ADD*ZERO     YL0003  80
      * Define local work field From Production Date
     C                     Z-ADD*ZERO     YL0004  70
      * Define local work field To Production Date
     C                     Z-ADD*ZERO     YL0005  70
      * Define local work field Production Day Status
     C                     MOVEL*BLANK    YL0006  1
      * Define local work field USR Internal D8# YYYYMMDD
     C                     Z-ADD*ZERO     YL0007  80
      * Define local work field Date Range Start USR
     C                     Z-ADD*ZERO     YL0008  80
      * Define local work field Post to G/L Date
     C                     Z-ADD*ZERO     YL0009  70
      * Define local work field Plant Company Sts
     C                     MOVEL*BLANK    YL0010  1
      * Define null work field Company Organization
     C                     MOVEL*BLANK    YN0001  1
      * Define local work field Generic Message 80 USR
     C                     MOVEL*BLANK    YL0011 80
      * Define local work field Allow Multi-Company
     C                     MOVEL*BLANK    YL0012  1
      * Define null work field Warehouse Code
     C                     MOVEL*BLANK    YN0002  3
      * Define null work field Company Number
     C                     Z-ADD*ZERO     YN0003  30
      * Define null work field Salesperson Code
     C                     MOVEL*BLANK    YN0004  3
      * Define null work field Default Printer
     C                     MOVEL*BLANK    YN0005 10
      * Define local work field Company Number
     C                     Z-ADD*ZERO     YL0013  30
      * Define local work field Warehouse Code
     C                     MOVEL*BLANK    YL0014  3
      * Obtain system date format
     C           *NAMVAR   DEFN Y2DTFMA   XDDTFM  3
     C                     IN   XDDTFM
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      *
     C                     MOVEL*BLANK    WN0005 10        User Profile Na
      *
      * VAL Set Inter. Access  IF
     C                     MOVEL##USR     WN0005           User Profile Na
      *
     C                     MOVEL*BLANK    WN0006 10        User Code Model
      *
      * VAL User/Application   IF
      * RMC 5/11/09 Rtv default company from user profile --
      *   Override user code model company if it exists
      * RTV Program Setup w/Co RT - User Profile Control  * 
     C                     EXSR SHRVGN
      * User Profile Record Not found
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ @CN,008                    *IF
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0005    ZA0009           User Profile Na
     C                     MOVEL'P/S'     ZA0010           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * CASE: PAR.User Code Model is equal to blank
     C           WN0006    IFEQ *BLANK                     *IF
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0005    WL0016    P      User Profile Na
     C                     MOVEL'P/S'     WL0017    P      Application Cod
     C                     EXSR SIRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0018    YN0003           Company Number
     C                     MOVELWL0019    YL0014    P      Warehouse Code
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Appl. Profile      RT - User Application Profile  * 
      * Move input parameters to subroutine local variables.
     C                     MOVELWN0006    WL0016    P      User Profile Na
     C                     MOVEL'P/S'     WL0017    P      Application Cod
     C                     EXSR SIRVGN
      * Move subroutine local variables to output parameters.
     C                     Z-ADDWL0018    YN0003           Company Number
     C                     MOVELWL0019    YL0014    P      Warehouse Code
     C                     END                             *FI
     C                     MOVELYL0014    YN0002           Warehouse Code
      * Return code when not normal for Application Profile
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * SET Message Queue Dest US - /UT User Source  * 
     C                     MOVEL'*PRV '   ZAPGRL           PREVIOUS
      * Setup message data for message
     C                     MOVELWN0005    ZA0011           User Profile Na
     C                     MOVEL'P/S'     ZA0012           Application Cod
      * Send message 'Application access denied'
     C                     MOVEL'USR0810' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     MOVEL'*COMP  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Override company with User profile control's company if found
      * CASE: LCL.Company Number is not equal to zero
     C           YL0013    IFNE 0                          *IF
     C                     Z-ADDYL0013    YN0003           Company Number
      * Get prod warehouse, if the appl got a warehouse
      * CASE: LCL.Warehouse Code is Not Blanks
     C           YL0014    IFNE *BLANK                     *IF
      * RTV Prod Whse for Co  XF - Warehouse  * 
     C                     CALL 'PNKDXFR'              90  RTV Prod Whse f
     C                     PARM *BLANK    W0RTN   7
     C                     PARM *BLANK    WQ0001  3        Warehouse Code
     C                     PARM YL0013    WQ0002  30       Shipping Compan
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PNKDXFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
      * SET Screen Headings    IF
      * RTV Applic. Group Desc RT - Application  * 
     C                     EXSR SJRVGN
     C                     MOVEL*BLANK    WUDSC4           USR Description
     C                     MOVELWUAUNA    WUDSC4           USR Description
      * CLC Center Txt Str 40  US - /UT User Source  * 
     C                     MOVEAWUDSC4    UCT              LOAD ARRAY
     C                     Z-ADD40        UX      20       SET COUNTER
     C           UX        DOWGT0
     C           UCT,UX    IFEQ ' '
     C                     SUB  1         UX
     C                     ELSE
     C                     Z-ADDUX        UXH     20
     C                     Z-ADD0         UX
     C                     END
     C                     END
     C           40        SUB  UXH       UX
     C           UX        DIV  2         UX
     C           UX        IFGT 0
     C                     MOVE *BLANKS   UCT
     C                     MOVEAWUDSC4    UCT,UX
     C                     END
     C                     MOVEAUCT       WUDE40           LOAD OUTPUT
      * MOV Appl Desc-Co Head  US - /UT User Source  * 
     C                     MOVE WUDE40    ##CMP  40
      * Load screen
     C                     EXSR MALDSC
      *================================================================
     CSR         ZZEXIT    ENDSR
** @XD
312931303130313130313031
** @CN
00001 Start date cannot equal
00002 to From Prod Date for
00003 same Company.
00004 Prod Date range cannot be
00005 equal.
00006 Date Range To cannot be
00007 less than Date Range From
00008 Y2U0005
