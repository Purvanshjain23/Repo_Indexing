      *****************  RPG PROGRAM HEADING  ************************
      * SYSTEM:      HPS Hog Production
      * PROGRAM:     HP374 - Workfile: Actual Movement Log Download
      * PROGRAMMER:  LeAnne Ramsey
      * CREATED:     06/24/09
      *
      * FUNCTION:    This program builds a workfile to email as an XLS.
      *
      ****************************************************************
      * MODIFICATIONS:
      ****************************************************************
      * DATE      PROGRAMMER
      *
      * 05/23/11  LeAnne Ramsey  (E1556)
      *           Recompile only. Sex Code was added for the Destination Group
      *           in both workfiles.
      *
      * 06/07/21  Danny Nguyen   (P2098)
      *           Recompile only due to HSP370 & HSP374 file change.
      *
      /eject
      ****************************************************************
      * FILE SPECIFICATIONS
      ****************************************************************
      *
     Fhsp370    if   e           k disk    rename(wfrec:wfrec370)
      *  Workfile for Various Actual Movement Reports (records selected with open query)
      *
      *
     Fhsp374    o    e           k disk
      *  Workfile for Downloading Actual Movement Data
      *
      /eject
      ****************************************************************
      * DEFINITION SPECIFICATIONS
      ****************************************************************
      *
      ****************************************************************
      * CONSTANTS
      ****************************************************************
      *
     D yes             c                   'Y'
     D no              c                   'N'
      *
      ****************************************************************
      * ARRAYS AND TABLES
      ****************************************************************
      *
      ****************************************************************
      * STANDALONE FIELDS
      ****************************************************************
      *
      * Control fields
      *
     D count           s              7  0
      *
      *
      * Parms
      *
     D xxflag          s              1
      *
      ****************************************************************
      * DATA STRUCTURES
      ****************************************************************
      *
      *---------------------------------------------------------------
      * Standard program status data structure
      *---------------------------------------------------------------
      *    externally defined as UTPGFR (record format: PGMDSR)
     D pgmds         esds                  extname(utpgfr)
      *
      *
      * The following is a dummy C-spec to keep the D-specs from
      * running over into the C-specs on the compile listing. It
      * serves no other purpose and can be deleted at any time.
      *
     C                   if        sdpgm = *blank
     C                   endif
      /EJECT
      ****************************************************************
      * MAINLINE
      ****************************************************************
      *
      * Process all Workfile records selected by the Open Query.
      * Write a download workfile record for each one.
      *
     C                   dou       *in90 = *on                                  Main do
     C                   read      hsp370                                 90
     C                   if        *in90 = *off                                 If not EOF
      *
     C                   write     wfrec
     C                   clear                   wfrec
     C                   add       1             count
      *
     C                   endif                                                  If not EOF
     C                   enddo                                                  Main do
      *
      *
      * We are going to ultimately e-mail this workfile as an Excel Spreadsheet
      * using Sequel. Rose has warned me that the Excel limit is 66,000 records.
      * When/if you exceed this limit, the "view" goes into "la-la" land.
      * So, we have counted each record that we wrote to the workfile. If it
      * exceeds 66,000, we will send a "too many" message from the CL instead
      * of executing the SQL statement. Likewise, if the "count" is zero, we will
      * issue a "no data extracted; change your selections message".
      *
     C                   select
     C                   when      count = 0
     C                   move      'Z'           xxflag
      *
     C                   when      count >= 66000
     C                   move      'T'           xxflag
     C                   other
      *
     C                   move      *blank        xxflag
     C                   endsl
      *
     C                   seton                                        lr
      /eject
      *---------------------------------------------------------------
      * Initialization subroutine
      *---------------------------------------------------------------
      *
     C     *inzsr        begsr
      *
     C     *entry        plist
     C                   parm                    xxflag
      *
     C                   endsr
      /eject
