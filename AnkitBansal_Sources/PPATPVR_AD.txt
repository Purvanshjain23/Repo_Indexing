// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPATPVR
// ?Date: 14.08.2025 Time: 03:39:44
// ?------------------------------------------------------------------------------------------------

//?USER: Validate fields

CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.Ship to Customer      USR
IF PGM.*Cursor_field = DTL.Ship_to_Customer_USR;

//?4/08/2004 SLM Add ship to customer select with customer search
// Call program SEL Cust/ShpTo Flag 'Y'SR.
CALL PROGRAM(SEL Cust/ShpTo Flag 'Y'SR) ('PDYSSRR');
PARAMETER(DTL.Ship_to_Customer_USR);

ENDIF;

ENDIF;

EXECUTE FUNCTION(Ship To Name          DRV) TYPE(DRVFLD)                        AC1573561;
PARAMETER(DTL.Ship_To_Name_DRV);
PARAMETER(DTL.Ship_to_Customer_USR);
{
 //?Calculate derived field

 EXECUTE FUNCTION(RTV Customer Name      RT) TYPE(RTVOBJ) FILE(CABBREP)          AC1108159;
 PARAMETER(PAR.Ship_To_Customer);
 PARAMETER(PAR.Ship_To_Name_DRV);
 {
  //?USER: Processing if Data record not found

  MOVE *ALL (To: PAR From: CON);

  // PGM.*Return code = CND.*Record does not exist
  PGM.*Return_code = 'Y2U0005';

  //?USER: Process Data record

  MOVE *ALL (To: PAR From: DB1);

 }

}


CASE;

// IF DTL.Ship To Name          DRV is blanks
IF DTL.Ship_To_Name_DRV = *BLANK;

// Send error message - 'Customer Master not found.'
ERROR(USR0170);
MSGPARM(DTL.Ship_to_Customer_USR);

ENDIF;

//?USER: User defined action

// Call program Edt Customer Price    ET.
CALL PROGRAM(Edt Customer Price    ET) ('POPOETR');
PARAMETER(DTL.Ship_to_Customer_USR);
PARAMETER(*ZERO);
PARAMETER('N');

