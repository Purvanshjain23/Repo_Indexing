/*********************************************************************/
/*     Program: POAZUPC                                              */
/*       Title: Pork A/R CB Aging Reports                            */
/*        Date: 06/02/99                                             */
/* Description: -                                                    */
/*********************************************************************/
/* Modifications:                                                    */
/*                                                                   */
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/* 12/18/01  RMC       ADD SALESPERSON TO PARM AND NEW REPORT TYPE 2 */
/* 04/04/05  RMC       REMOVED COMPANY FROM PARMS, WORKFILE          */
/* 01/31/06  LJB       ADDED COMPANY BACK INTO PARMS, WORKFILE       */
/* 11/28/06  LJB       ADDED A/R AGING CODE, EMAIL ADDRESS & FORMAT  */
/* 12/11/06  LJB       CHANGED TO SAVE(*YES) SO IT CAN BE EMAILED    */
/*                     ESEND THE SPOOLDED FILE TO THE RECIPIENT      */
/* 01/15/07  LJB       ADD ADDITIONAL LOGICAL FILE, ADD MONITOR MSG  */
/*                     ADD CALL TO PMDLPFR-REPORT BY CUST NAME       */
/* 02/06/07  LJB       REMOVE SBDPRTOVR COMMAND AND REPLACED WITH    */
/* 06/05/07  JRB       REMOVED COMMENT.                              */
/* 02/07/08  RMC       ADDED SQL TABLE VIEW IF REQUESTED-PARM &TABLE */
/* 05/22/09  SAZ       ADDED REPORT TYPE 4 AND LOGICAL PDLOCPL4      */
/* 06/07/10  LJB       SEQUENCE# ADDED TO WORK FILE                  */
/* 11/03/10  SLM       Starting work on E000912                      */
/* 11/03/10  SLM       I want to see the work file.                  */
/* 08/24/16  JBB      ADD INCLUDE CHARGE BACK AND INCLUDE REBILL     */
/*                     FLAGS TO PARAMETERS.                          */
/***********************************************DATE******************/
 POAZUPC:    PGM        PARM(&REPORT &SLS &CONBR &OUTQ &HOLD &SAVE +
                          &COPY &AGECODE &EMAILFMT &EMAIL &TABLE +
                          &INCLCB &INCLRB)

   /*-------------------*/
   /* Declare Variables */
   /*-------------------*/

             /* Parameter Fields */
             DCL  VAR(&REPORT) TYPE(*CHAR) LEN(1)
             DCL  VAR(&SLS) TYPE(*CHAR) LEN(3)
             DCL  VAR(&OUTQ) TYPE(*CHAR) LEN(10)
             DCL  VAR(&HOLD) TYPE(*CHAR) LEN(4)
             DCL  VAR(&SAVE) TYPE(*CHAR) LEN(4)
             DCL  VAR(&COPY) TYPE(*DEC)
             DCL  VAR(&CONBR) TYPE(*DEC) LEN(15 5)
             DCL  VAR(&AGECODE) TYPE(*CHAR) LEN(6)
             DCL  VAR(&TABLE)   TYPE(*CHAR) LEN(1)
             DCL  VAR(&EMAIL)   TYPE(*CHAR) LEN(50)
             DCL  VAR(&EMAILFMT) TYPE(*CHAR) LEN(5)
             DCL  VAR(&INCLCB)  TYPE(*CHAR) LEN(1)
             DCL  VAR(&INCLRB)  TYPE(*CHAR) LEN(1)

             /* Internal Work Fields */
             DCL  VAR(&COPYN)   TYPE(*DEC)  LEN(2 0)
             DCL  VAR(&COMMAND) TYPE(*CHAR) LEN(512)
             DCL  VAR(&RETURN)  TYPE(*CHAR) LEN(7)
             DCL  VAR(&PRTF) TYPE(*CHAR) LEN(10)

/*-------------------------------------------------------------------*/
/* GLOBAL MONITOR MESSAGE                                            */
/*-------------------------------------------------------------------*/
             MONMSG     MSGID(CPF9999 EML9999)

   /*--------------------------------------*/
   /* PRINT NIGHTLY AGING FOR CHARGEBACKS  */
   /*--------------------------------------*/
             CHGVAR VAR(&COPYN) VALUE(&COPY)

/* BUILD THE WORKFILE                                              */
             CRTDUPOBJ  OBJ(PDLOCPP) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)
             CRTDUPOBJ  OBJ(PDLOCPL0) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)
             CRTDUPOBJ   OBJ(PDLOCPL1) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)
             CRTDUPOBJ   OBJ(PDLOCPL2) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)
             CRTDUPOBJ  OBJ(PDLOCPL3) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)
             CRTDUPOBJ  OBJ(PDLOCPL4) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) DATA(*NO) CST(*NO) TRG(*NO)

             CALL       PGM(PDAYXFR) PARM('' &CONBR)

/**** TEST ONLY ******************************************************/
/***         DLTF       FILE(OMSDEVGEN/PDLOCPPSV)            +
             CPYF       FROMFILE(QTEMP/PDLOCPP) +
                          TOFILE(OMSDEVGEN/PDLOCPPSV) +
                          MBROPT(*REPLACE) CRTFILE(*YES)         *****/
/*********************************************************************/
/* REPORT TYPE 1 - BY COMPANY/CUSTOMER (ORIGINAL)                    */

             IF         COND(&REPORT = '1') THEN(DO)

             OVRPRTF    FILE(PDAZPFR$) OUTQ(&OUTQ) COPIES(&COPYN) +
                          HOLD(&HOLD) SAVE(*YES)

             CALL       PGM(PDAZPFR) PARM('' &CONBR &AGECODE &INCLCB +
                          &INCLRB)

/* EMAIL IF AN EMAIL ADDRESS WAS PASSED IN                           */
             IF         COND(&EMAIL *NE '              ') THEN(DO)
             IF         COND(&EMAILFMT *EQ '*TEXT') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Company/Customer in TEXT format') +
                          MSGTYPE(*TEXT) ATTLIST((PDAZPFR$ *TEXT *N +
                          PDAZPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*PDF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Company/Customer in PDF format') +
                          MSGTYPE(*TEXT) ATTLIST((PDAZPFR$ *PDF *N +
                          PDAZPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*RTF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Company/Customer in RTF format') +
                          MSGTYPE(*TEXT) ATTLIST((PDAZPFR$ *RTF *N +
                          PDAZPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*HTML') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Company/Customer in HTML format') +
                          MSGTYPE(*TEXT) ATTLIST((PDAZPFR$ *HTML *N +
                          PDAZPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO
             ENDDO
             ENDDO
/*-------------------------------------------------------------------*/
/* REPORT TYPE 2 - BY SALESPERSON                                    */

             IF         COND(&REPORT = '2') THEN(DO)

             OVRPRTF    FILE(POOJPFR$) OUTQ(&OUTQ) COPIES(&COPYN) +
                          HOLD(&HOLD) SAVE(*YES)

             CALL       PGM(POOJPFR) PARM('' &CONBR &SLS &AGECODE +
                          &INCLCB &INCLRB)

/* EMAIL IF AN EMAIL ADDRESS WAS PASSED IN                           */
             IF         COND(&EMAIL *NE '              ') THEN(DO)
             IF         COND(&EMAILFMT *EQ '*TEXT') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in TEXT format') +
                          MSGTYPE(*TEXT) ATTLIST((POOJPFR$ *TEXT *N +
                          POOJPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*PDF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in PDF format') +
                          MSGTYPE(*TEXT) ATTLIST((POOJPFR$ *PDF *N +
                          POOJPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*RTF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer in RTF format') MSGTYPE(*TEXT) +
                          ATTLIST((POOJPFR$ *RTF *N POOJPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*HTML') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in HTML format') +
                          MSGTYPE(*TEXT) ATTLIST((POOJPFR$ *HTML *N +
                          POOJPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             ENDDO
             ENDDO
/*-------------------------------------------------------------------*/
/* REPORT TYPE 3 - BY CUSTOMER NAME                                  */

             IF         COND(&REPORT = '3') THEN(DO)

             OVRPRTF    FILE(PMDLPFR$) OUTQ(&OUTQ) COPIES(&COPYN) +
                          HOLD(&HOLD) SAVE(*YES)

             CALL       PGM(PMDLPFR) PARM('' &CONBR &AGECODE &INCLCB +
                          &INCLRB)

/* EMAIL IF AN EMAIL ADDRESS WAS PASSED IN                           */
             IF         COND(&EMAIL *NE '              ') THEN(DO)
             IF         COND(&EMAILFMT *EQ '*TEXT') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer Name in TEXT format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDLPFR$ *TEXT *N +
                          PMDLPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*PDF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer Name in PDF format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDLPFR$ *PDF *N +
                          PMDLPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*RTF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer Name in RTF format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDLPFR$ *RTF *N +
                          PMDLPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*HTML') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer Name in HTML format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDLPFR$ *HTML *N +
                          PMDLPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO
             ENDDO
             ENDDO
/*-------------------------------------------------------------------*/
/* REPORT TYPE 4 - BY SUMMARY BY CHARGE BACK GROUPING                */

             IF         COND(&REPORT = '4') THEN(DO)

             OVRPRTF    FILE(PMDNPFR$) OUTQ(&OUTQ) COPIES(&COPYN) +
                          HOLD(&HOLD) SAVE(*YES)

             CALL       PGM(PMDNPFR) PARM('' &CONBR &SLS &AGECODE +
                          &INCLCB &INCLRB)

/* EMAIL IF AN EMAIL ADDRESS WAS PASSED IN                           */
             IF         COND(&EMAIL *NE '              ') THEN(DO)
             IF         COND(&EMAILFMT *EQ '*TEXT') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in TEXT format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDNPFR$ *TEXT *N +
                          PMDNPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*PDF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in PDF format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDNPFR$ *PDF *N +
                          PMDNPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*RTF') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Customer in RTF format') MSGTYPE(*TEXT) +
                          ATTLIST((PMDNPFR$ *RTF *N PMDNPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             IF         COND(&EMAILFMT *EQ '*HTML') THEN(DO)
             ESNDMAIL   RECIPIENT(&EMAIL) SUBJECT('Daily Chargeback +
                          Report') MSG('Daily Chargeback Report by +
                          Salesperson in HTML format') +
                          MSGTYPE(*TEXT) ATTLIST((PMDNPFR$ *HTML *N +
                          PMDNPFR$))
             MONMSG     MSGID(EML0999)
             ENDDO

             ENDDO
             ENDDO
/*-------------------------------------------------------------------*/
/*  EMAIL SUMMARY TABLE - VALID FOR ALL REPORT TYPES                 */
/*-------------------------------------------------------------------*/
             IF         COND(&TABLE *EQ 'Y')    THEN(DO)
             EXECUTE    VIEW(CBDETAILT) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('CB DETAIL TABLE')
             EXECUTE    VIEW(CBSUMMARYT) PCFMT(*XLS) +
                          RECIPIENT(&EMAIL) EMLMSG('CB SUMMARY TABLE')
                          ENDDO
/*-------------------------------------------------------------------*/
             DLTOVR     FILE(*ALL)

 END:        ENDPGM
