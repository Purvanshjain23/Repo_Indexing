/********************************************************************/
/*                                                                  */
/*  SYNOPSIS -  PRINT PROGRAM WITH COMPANY, WAREHOUSE, ITEM, ITEM   */
/*              TYPE, ITEM LEVEL, QUALITY LEVEL                     */
/*              ITEM STR TYPE, ITEM STR GROUP, ITEM STR CLASS,      */
/*              NON-ZERO QUANTITY ONLY AND INCLUDE TODAYS TRANS     */
/*              OPEN QUERY FILE OVER IC ITEM BALANCE                */
/*              AGED INVENTOUR                                      */
/*********************************************************************/
/* Modifications:                                                    */
/*                                                                   */
/*   Date     Pgmr     Description                                   */
/* -------- ---------- --------------------------------------------  */
/* 052107   S.MASON    PASS AGEDAYS THROUGH OUT                      */
/*                     ALSO ATTACHED THIS CL TO THE OMS MODULE       */
/* 10/06/11 RMC        CALL NEW PGM PBALPFR--> AGED - NOT ALLOC      */
/* 10/10/11 RMC        CALL NEW PGM PBAMPFR--> AGED - ALLOC TO ITM/ORDS  */
/* 10/21/11 RMC        NEW PARM SEL &AVAILG                    */
/* 08/01/13 RMC        CALL NEW PGM PBJEPFR--> AGED - ALLOC TO ORD/ITEM */
/* 05/24/22 RMC DDSDDL REPLACE OPNQRYF WITH OPNSQLF        */
/*                     ADDED NEEDED OVRDBF AROUND THE COMMAND.              */
/*                     CHANGE *AND TO AND IN &G, CHG *EQ TO = IN QRY  */
/*********************************************************************/
/*                                                                  */
/*  COMPANY   - SEABOARD CORP                                       */
/*  SYSTEM    - INVENTORY CONTROL                                   */
/*  DATE      - 06/20/95                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER                            */
/*          &WHSE       - WAREHOUSE CODE                            */
/*          &ITEM       - ITEM CODE                                 */
/*          &ITEMTP     - ITEM TYPE                                 */
/*          &ITEMLV     - ITEM LEVEL                                */
/*          &QLTYLV     - QUALITY LEVEL                             */
/*          &ITMTYP     - ITEM STR TYPE                             */
/*          &ITMGRP     - ITEM STR GROUP                            */
/*          &ITMCLS     - ITEM STR CLASS                            */
/*          &AVAILG     - AVAIL GROUP                               */
/*          &NONZER     - NON-ZERO QUANTITY ONLY                    */
/*          &INTDTR     - TODAYS TRANSACTIONS                       */
/*          &OUTQ       - OUTPUT QUEUE                             */
/*          &HOLD       - HOLD                                     */
/*          &SAVE       - SAVE                                     */
/*          &COPIESL    - NUMBER OF COPIES                          */
/*          &NIGHTQ     - NIGHT QUEUE                               */
/********************************************************************/

 PDRZCLP:    PGM        PARM(&PGM &COMPL &WHSE &ITEML +
                         &ITEMTP &ITEMLV &QLTYLV &ITMTYPL &ITMGRPL +
                         &ITMCLSL &NONZER &INTDTR &OUTQ &HOLD &SAVE +
                         &COPIESL &NIGHTQ &AGEDAYS &AVAILG)

             DCL        &COPIESL    *DEC
             DCL        &COPIES     *DEC     LEN(3 0)
             DCL        &COMPL      *DEC         /*  CO. #       */
             DCL        &COMP       *DEC     LEN(3 0)
             DCL        &ITEML      *DEC         /*  ITEM         */
             DCL        &ITEM       *DEC     LEN(7 0)
             DCL        &ITEMTP     *CHAR    3   /* ITEM TYPE    */
             DCL        &ITEMLV     *CHAR    2   /* ITEM LEVEL   */
             DCL        &QLTYLV     *CHAR    2   /* QUALITY LEVEL*/
             DCL        &ITMTYPL    *DEC         /*  ITEM TYPE    */
             DCL        &ITMTYP     *DEC     LEN(3 0)
             DCL        &ITMGRPL    *DEC         /*  ITEM GROUP   */
             DCL        &ITMGRP     *DEC     LEN(3 0)
             DCL        &ITMCLSL    *DEC         /*  ITEM CLASS   */
             DCL        &ITMCLS     *DEC     LEN(3 0)
             DCL        &NONZER     *CHAR    1   /* NON-ZERO QTY */
             DCL        &INTDTR     *CHAR    1   /* TODAYS TRANS */
             DCL        &OUTQ       *CHAR    10  /* OUTPUT QUEUE */
             DCL        &NIGHTQ     *CHAR   10  /*  NIGHT JOB QUEUE*/
             DCL        &HOLD       *CHAR   4   /* HOLD        */
             DCL        &SAVE       *CHAR   4   /* SAVE        */
             DCL        &PGM        *CHAR    10  /*  PGM NAME    */
             DCL        &COMPA      *CHAR    3  /* CO. # FOR MSG */
             DCL        &ITEMA      *CHAR    7  /* ITEM FOR QRY  */
             DCL        &ITMTYPA    *CHAR    3  /* ITEM TYPE FOR QRY */
             DCL        &ITMGRPA    *CHAR    3  /* ITEM GRP FOR QRY */
             DCL        &ITMCLSA    *CHAR    3  /* ITEM CLS FOR QRY */
             DCL        &WHSE       *CHAR    3  /* WAREHOUSE     */
             DCL        &AVAILG     *CHAR    3  /* AVAIL GROUP       */
             DCL        &PGMO       *CHAR    10 /* PRINTER NAME  */
             DCL        &RETURN     *CHAR    7
             DCL        &COMMAND    *CHAR    512
             DCL        &A          *CHAR    25 /* QRY SELECT    */
             DCL        &B          *CHAR    35 /* QRY SELECT    */
             DCL        &C          *CHAR    35 /* QRY SELECT    */
             DCL        &D          *CHAR    35 /* QRY SELECT    */
             DCL        &E          *CHAR    35 /* QRY SELECT    */
             DCL        &F          *CHAR    35 /* QRY SELECT    */
             DCL        &G          *CHAR   200 /* QRY SELECT    */
             DCL        &SELECT     *CHAR    1   /* SELECT       */
             DCL        &AGEDAYS    *DEC         /*  AGEING DAYS  */
             DCL        &AGED       *DEC     LEN(5 0)

             MONMSG     MSGID(CPF9841) /* DLTOVR ERROR MSG  */

/********************************************************************/
/* APPEND $ TO THE PROGRAM NAME                                     */
/********************************************************************/

             CHGVAR     VAR(&PGMO) VALUE(&PGM *TCAT '$')
             CHGVAR     VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR     VAR(&COMPA) VALUE(&COMP) /* Change FOR  +
                          MESSAGES for print program */
             CHGVAR     VAR(&COPIES) VALUE(&COPIESL) /* Change to length +
                          for print program */
             CHGVAR     VAR(&ITEM) VALUE(&ITEML) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITEMA) VALUE(&ITEM)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMTYP) VALUE(&ITMTYPL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMTYPA) VALUE(&ITMTYP)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMGRP) VALUE(&ITMGRPL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMGRPA) VALUE(&ITMGRP)  /*  FOR QRY +
                          SELECTION  */
             CHGVAR     VAR(&ITMCLS) VALUE(&ITMCLSL) /* Change to +
                          length for print program */
             CHGVAR     VAR(&ITMCLSA) VALUE(&ITMCLS)  /*  FOR QRY +
                          SELECTION  */

             CHGVAR     VAR(&AGED) VALUE(&AGEDAYS)
/********************************************************************/
/* Override printer file with user specified values                 */
/********************************************************************/

     /*      SBDPRTOVR  CMDVAR(&COMMAND) FILE(&PGMO) OUTQ(&OUTQ) +
                          COPIES(&COPIES) HOLD(&HOLD) SAVE(&SAVE)    +
                                                                     +
             CALL       PGM(QCMDEXC) PARM(&COMMAND 512)            */
             OVRPRTF    FILE(&PGMO) OUTQ(&OUTQ) COPIES(&COPIES) +
                          HOLD(&HOLD) SAVE(&SAVE)
/*********************************************************************/
/*   CREATE OPEN QUERY FILE TO BE USED TO DISPLAY DETAILS            */
/*********************************************************************/

             IF         COND(&COMPA *NE '000') THEN(DO)
             CHGVAR     VAR(&A) VALUE('B0AIC3 = ' *CAT &COMPA)
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO

             IF         COND(&ITEMA *NE '0000000') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&B) VALUE('AND B0HGCD = ' *CAT &ITEMA)
             ENDDO
             ELSE DO
             CHGVAR     VAR(&B) VALUE('B0HGCD = ' *CAT &ITEMA)
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO

             IF         COND(&WHSE *NE '   ') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR     VAR(&C) VALUE('AND B0AJCD = "' *CAT &WHSE +
                        *CAT '"')
             ENDDO
             ELSE DO
             CHGVAR     VAR(&C) VALUE('B0AJCD = "' *CAT &WHSE +
                        *CAT '"')
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO

             IF        COND(&ITMTYPA *NE '000') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR    VAR(&D) VALUE('AND B0RGNB = ' *CAT &ITMTYPA)
             ENDDO
             ELSE DO
             CHGVAR    VAR(&D) VALUE('B0RGNB = ' *CAT &ITMTYPA)
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO

             IF        COND(&ITMGRPA *NE '000') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR    VAR(&E) VALUE('AND B0RHNB = ' *CAT &ITMGRPA)
             ENDDO
             ELSE DO
             CHGVAR    VAR(&E) VALUE('B0RHNB = ' *CAT &ITMGRPA)
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO

             IF        COND(&ITMCLSA *NE '000') THEN(DO)
             IF         COND(&SELECT *EQ 'Y') THEN(DO)
             CHGVAR    VAR(&F) VALUE('AND B0RINB = ' *CAT &ITMCLSA)
             ENDDO
             ELSE DO
             CHGVAR    VAR(&F) VALUE('B0RINB = ' *CAT &ITMCLSA)
             CHGVAR     VAR(&SELECT) VALUE('Y')
             ENDDO
             ENDDO


             CHGVAR     VAR(&G) VALUE(&A *BCAT &B *BCAT &C *BCAT &D +
                                      *BCAT &E *BCAT &F)

/********************  PRINT DETAIL REPORT  **************************/

/*   OPEN QUERY FOR DETAIL PRINT.    */

             IF         (&SELECT = 'Y') THEN(DO)

/*   PRINT INVENTORY SUMMARY BY WAREHOUSE/ITEM & STOCK STS BY WHSE*/
             IF         COND(&PGM = 'OMGBPFR' *OR &PGM = 'PDVAPFR') +
                          THEN(DO)
 /*          OVRDBF     FILE(CAB0RELC) SHARE(*YES)                      */
 /*          OPNQRYF    FILE((CAB0RELC)) QRYSLT(&G) KEYFLD(*FILE) +
                           SEQONLY(*YES)                                */

/*   OPEN SQL                                                      */
             OVRDBF     FILE(CAB0REP) TOFILE(CAB0REP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM CAB0REP WHERE' *BCAT &G +
                          *BCAT 'ORDER BY  BOAIC3 ASC,B0AJCD +
                          ASC,B0HGCD ASC') OPNID(CAB0RELC) +
                          RCDFMT(@B0REHD) ALWCPY(*IFRQD)
   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB0RELC) TOFILE(CAB0REP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)
            ENDDO

/*   PRINT INVENTORY SUMMARY BY WAREHOUSE/TYPE/GROUP/CLASS/ITEM.    */
             IF         (&PGM = 'PDR1PFR') THEN(DO)
   /*        OVRDBF     FILE(CAB0RELM) SHARE(*YES)                   */
   /*        OPNQRYF    FILE((CAB0RELM)) QRYSLT(&G) KEYFLD(*FILE) +
                           SEQONLY(*YES)                             */

/*   OPEN SQL                                                      */
             OVRDBF     FILE(CAB0REP) TOFILE(CAB0REP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM CAB0REP WHERE' *BCAT &G +
                          *BCAT 'ORDER BY  B0AIC3 ASC,B0AJCD +
                          ASC,B0RGNB ASC,B0RHNB ASC,B0RINB ASC, +
                          B0HGCD ASC') OPNID(CAB0RELM) +
                          RCDFMT(@B0REBY) ALWCPY(*IFRQD)
   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB0RELM) TOFILE(CAB0REP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)
             ENDDO

/*   PRINT INVENTORY CONSOLIDATION & ITEM STOCK STATUS */
/*   & AGE INVENTORY & INVENTORY REVALUATION           */
             IF         COND(&PGM = 'PDR2PFR' *OR &PGM = 'ICQ0PFR' +
        *OR &PGM = 'PDVBPFR' *OR &PGM = 'PDVEPFR' *OR &PGM = 'PBALPFR' *OR  +
               &PGM = 'PBAMPFR')        +
                          THEN(DO)
  /*         OVRDBF     FILE(CAB0REL1) SHARE(*YES)                     */
  /*         OPNQRYF    FILE((CAB0REL1)) QRYSLT(&G) KEYFLD(*FILE) +
                           SEQONLY(*YES)                               */
/*   OPEN SQL                                                      */
             OVRDBF     FILE(CAB0REP) TOFILE(CAB0REP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM CAB0REP WHERE' *BCAT &G +
                          *BCAT 'ORDER BY  B0AIC3 ASC,B0HGCD +
                          ASC,B0AJCD ASC') OPNID(CAB0REL1) +
                          RCDFMT(@B0REJX) ALWCPY(*IFRQD)
   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB0REL1) TOFILE(CAB0REP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)
             ENDDO

/*   PRINT INVENTORY CONSOLIDATION BY TYPE/GROUP/CLASS  & STOCK STS */
/*   BY ITEM STRUCTURE CLASS                            */
             IF         COND(&PGM = 'PDR3PFR' *OR &PGM = 'ICQUPFR') +
                          THEN(DO)
 /*          OVRDBF     FILE(CAB0RELN) SHARE(*YES)                     */
 /*          OPNQRYF    FILE((CAB0RELN)) QRYSLT(&G) KEYFLD(*FILE) +
                           SEQONLY(*YES)                              */
/*   OPEN SQL                                                      */
             OVRDBF     FILE(CAB0REP) TOFILE(CAB0REP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM CAB0REP WHERE' *BCAT &G +
                          *BCAT 'ORDER BY  B0AIC3 ASC,B0RGNB +
                          ASC,B0RHNB ASC, B0RINB ASC, B0HGCD ASC') +
                          OPNID(CAB0RELN) RCDFMT(@B0REBZ) +
                          ALWCPY(*IFRQD)
   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB0RELN) TOFILE(CAB0REP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)
             ENDDO

/*   PRINT VENDOR STOCK STATUS */
             IF         COND(&PGM = 'PDU9PFR') THEN(DO)
 /*          OVRDBF     FILE(CAB0RELO) SHARE(*YES)                   */
/*           OPNQRYF    FILE((CAB0RELO)) QRYSLT(&G) KEYFLD(*FILE) +
                           SEQONLY(*YES)                             */
/*   OPEN SQL                                                      */
             OVRDBF     FILE(CAB0REP) TOFILE(CAB0REP) LVLCHK(*NO)
             OPNSQLF    SQL('SELECT * FROM CAB0REP WHERE' *BCAT &G +
                          *BCAT 'ORDER BY  B0AIC3 ASC,B0HGCD +
                          ASC,B0AJCD ASC') OPNID(CAB0REL0) +
                          RCDFMT(@B0REJT) ALWCPY(*IFRQD)
   /*  Fromfile is the file in the program, tofile is 1st file in the opnsqlf */
     /*  For the override to be SEEN BY ALL PROGRAMS, THE OVRDBF +
                command must specify OVRSCOPE(*JOB) and OPNSCOPE(*JOB). */

             OVRDBF     FILE(CAB0REL0) TOFILE(CAB0REP) LVLCHK(*NO) +
                          OVRSCOPE(*JOB) SHARE(*YES) OPNSCOPE(*JOB)
             ENDDO

             ENDDO

             IF         COND(&PGM = 'PDVBPFR') THEN(DO)

             CALL       PGM(&PGM) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &ITEMTP &NONZER +
                          &ITEMLV &QLTYLV &INTDTR &AGED &AVAILG)

             ENDDO
             IF         COND(&PGM = 'PBALPFR' *OR &PGM = 'PBAMPFR')  THEN(DO)

             CALL       PGM(&PGM) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &ITEMTP &NONZER +
                          &ITEMLV &QLTYLV &INTDTR &AGED &AVAILG)
             ENDDO

 E2703:      IF         COND(&PGM = 'PBJEPFR')  THEN(DO)

             CALL       PGM(&PGM) PARM(&RETURN &COMP &WHSE &AGED +
                          &AVAILG)
             ENDDO

  IF  COND(&PGM *NE 'PDVBPFR' *AND &PGM *NE 'PBALPFR' *AND &PGM *NE 'PBAMPFR'  +
     *AND &PGM *NE 'PBJEPFR') THEN(DO)
             CALL       PGM(&PGM) PARM(&RETURN &COMP &ITEM &WHSE +
                          &ITMCLS &ITMGRP &ITMTYP &ITEMTP &NONZER +
                          &ITEMLV &QLTYLV &INTDTR)
             ENDDO

             IF         (&SELECT = 'Y') THEN(DO)

/*   PRINT INVENTORY SUMMARY BY WAREHOUSE/ITEM & STOCK STS BY WHSE  */
             IF         COND(&PGM = 'OMGBPFR' *OR &PGM = 'PDVAPFR') +
                          THEN(DO)
             CLOF       OPNID(CAB0RELC) /* Close query file */
             DLTOVR     FILE(CAB0RELC) /* Delete override */
             ENDDO

/*   PRINT INVENTORY SUMMARY BY WAREHOUSE/TYPE/GROUP/CLASS/ITEM.    */
             IF         (&PGM = 'PDR1PFR') THEN(DO)
             CLOF       OPNID(CAB0RELM) /* Close query file */
             DLTOVR     FILE(CAB0RELM) /* Delete override */
             ENDDO

/*   PRINT INVENTORY CONSOLIDATION & ITEM STOCK STATUS */
/*   & AGE INVENTORY & INVENTORY REVALUATION           */
             IF         COND(&PGM = 'PDR2PFR' *OR &PGM = 'ICQ0PFR' +
                          *OR &PGM = 'PDVBPFR' *OR &PGM = 'PDVEPFR' +
      *OR &PGM = 'PBALPFR' *OR &PGM = 'PBAMPFR') THEN(DO)
             CLOF       OPNID(CAB0REL1) /* Close query file */
             DLTOVR     FILE(CAB0REL1) /* Delete override */
             ENDDO

/*   PRINT INVENTORY CONSOLIDATION BY TYPE/GROUP/CLASS & STOCK STS  */
/*   BY ITEM STRUCTURE TYPE                                         */
             IF         COND(&PGM = 'PDR3PFR' *OR &PGM = 'ICQUPFR') +
                          THEN(DO)
             CLOF       OPNID(CAB0RELN) /* Close query file */
             DLTOVR     FILE(CAB0RELN) /* Delete override */
             ENDDO

/*   PRINT VENDOR STOCK STATUS */
             IF         COND(&PGM = 'PDU9PFR') THEN(DO)
             CLOF       OPNID(CAB0RELO) /* Close query file */
             DLTOVR     FILE(CAB0RELO) /* Delete override */
             ENDDO

             ENDDO
