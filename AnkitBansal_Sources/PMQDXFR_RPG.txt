     H/TITLE Fix Sales Hist p/AcBrk XF Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by AllFusion 2E release 8.1SP2 (1250)
     H* Function type : Execute external function
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISSMASO
     H* Date          : 02/23/10  Time  : 09:01:06
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPDICCPL5IF  E           K        DISK
      * RSQ : History Dtl Accrual       AccrType/BrkrCde/ASDate
      *
     FPDICCPL1IF  E           K        DISK
      * RTV : History Dtl Accrual       Retrieval index
      *
     FOMHRCPL1IF  E           K        DISK
      * RTV : Shipping Dtl Accrual      Retrieval index
      *
     FPDICCPL0UF  E           K        DISK
      * UPD : History Dtl Accrual       Update index
      *
     FOMHRCPL0UF  E           K        DISK
      * UPD : Shipping Dtl Accrual      Update index
      *
     I@ICCPKN
      * History Dtl Accrual       AccrType/BrkrCde/ASDate
      * Renamed input format fields
     I              ICAIC3                          WAAIC3
     I              ICC4NB                          WAC4NB
     I              ICDPNB                          WADPNB
     I              ICUENB                          WAUENB
     I              ICDXNB                          WADXNB
     I              ICBKPR                          WABKPR
     I              ICAYVA                          WAAYVA
     I              ICEDVL                          WAEDVL
     I              ICHGCD                          WAHGCD
     I              ICBKC7                          WABKC7
     I              ICPTDT                          WAPTDT
     I              ICBYWG                          WABYWG
     I              ICBVST                          WABVST
     I              ICP7SX                          WAP7SX
     I              ICOKCD                          WAOKCD
     I              ICQQSX                          WAQQSX
     I              ICQRSX                          WAQRSX
     I              ICFLTX                          WAFLTX
     I              ICQSSX                          WAQSSX
     I              ICPRDT                          WAPRDT
     I              ICPSDT                          WAPSDT
     I              ICEGVL                          WAEGVL
     I              ICEHVL                          WAEHVL
     I              ICAVNB                          WAAVNB
     I              ICDSCD                          WADSCD
     I              ICFMTX                          WAFMTX
     I              ICFNTX                          WAFNTX
     I              ICQ9DT                          WAQ9DT
     I              ICFOTX                          WAFOTX
     I              ICH1NY                          WAH1NY
     I              ICKRT1                          WAKRT1
     I              ICKST1                          WAKST1
     I              ICHJAA                          WAHJAA
     I              ICHKAA                          WAHKAA
     I              ICHHAA                          WAHHAA
     I              ICOJCD                          WAOJCD
     I              ICAATM                          WAAATM
     I              ICAYNA                          WAAYNA
     I              ICA0NA                          WAA0NA
     I              ICAXDT                          WAAXDT
      *
     I@ICCPS0
      * History Dtl Accrual       Retrieval index
      * Renamed input format fields
     I              ICAIC3                          WBAIC3
     I              ICC4NB                          WBC4NB
     I              ICDPNB                          WBDPNB
     I              ICUENB                          WBUENB
     I              ICDXNB                          WBDXNB
     I              ICBKPR                          WBBKPR
     I              ICAYVA                          WBAYVA
     I              ICEDVL                          WBEDVL
     I              ICHGCD                          WBHGCD
     I              ICBKC7                          WBBKC7
     I              ICPTDT                          WBPTDT
     I              ICBYWG                          WBBYWG
     I              ICBVST                          WBBVST
     I              ICP7SX                          WBP7SX
     I              ICOKCD                          WBOKCD
     I              ICQQSX                          WBQQSX
     I              ICQRSX                          WBQRSX
     I              ICFLTX                          WBFLTX
     I              ICQSSX                          WBQSSX
     I              ICPRDT                          WBPRDT
     I              ICPSDT                          WBPSDT
     I              ICEGVL                          WBEGVL
     I              ICEHVL                          WBEHVL
     I              ICAVNB                          WBAVNB
     I              ICDSCD                          WBDSCD
     I              ICFMTX                          WBFMTX
     I              ICFNTX                          WBFNTX
     I              ICQ9DT                          WBQ9DT
     I              ICFOTX                          WBFOTX
     I              ICH1NY                          WBH1NY
     I              ICKRT1                          WBKRT1
     I              ICKST1                          WBKST1
     I              ICHJAA                          WBHJAA
     I              ICHKAA                          WBHKAA
     I              ICHHAA                          WBHHAA
     I              ICOJCD                          WBOJCD
     I              ICAATM                          WBAATM
     I              ICAYNA                          WBAYNA
     I              ICA0NA                          WBA0NA
     I              ICAXDT                          WBAXDT
      *
     I@ICCPSZ
      * History Dtl Accrual       Update index
      * Renamed input format fields
     I              ICAIC3                          WCAIC3
     I              ICC4NB                          WCC4NB
     I              ICDPNB                          WCDPNB
     I              ICUENB                          WCUENB
     I              ICDXNB                          WCDXNB
     I              ICBKPR                          WCBKPR
     I              ICAYVA                          WCAYVA
     I              ICEDVL                          WCEDVL
     I              ICHGCD                          WCHGCD
     I              ICBKC7                          WCBKC7
     I              ICPTDT                          WCPTDT
     I              ICBYWG                          WCBYWG
     I              ICBVST                          WCBVST
     I              ICP7SX                          WCP7SX
     I              ICOKCD                          WCOKCD
     I              ICQQSX                          WCQQSX
     I              ICQRSX                          WCQRSX
     I              ICFLTX                          WCFLTX
     I              ICQSSX                          WCQSSX
     I              ICPRDT                          WCPRDT
     I              ICPSDT                          WCPSDT
     I              ICEGVL                          WCEGVL
     I              ICEHVL                          WCEHVL
     I              ICAVNB                          WCAVNB
     I              ICDSCD                          WCDSCD
     I              ICFMTX                          WCFMTX
     I              ICFNTX                          WCFNTX
     I              ICQ9DT                          WCQ9DT
     I              ICFOTX                          WCFOTX
     I              ICH1NY                          WCH1NY
     I              ICKRT1                          WCKRT1
     I              ICKST1                          WCKST1
     I              ICHJAA                          WCHJAA
     I              ICHKAA                          WCHKAA
     I              ICHHAA                          WCHHAA
     I              ICOJCD                          WCOJCD
     I              ICAATM                          WCAATM
     I              ICAYNA                          WCAYNA
     I              ICA0NA                          WCA0NA
     I              ICAXDT                          WCAXDT
      *
     I@HRCPLM
      * Shipping Dtl Accrual      Retrieval index
      * Renamed input format fields
     I              HRAIC3                          WDAIC3
     I              HRC4NB                          WDC4NB
     I              HRDPNB                          WDDPNB
     I              HRUENB                          WDUENB
     I              HRDXNB                          WDDXNB
     I              HRBKPR                          WDBKPR
     I              HRC5PC                          WDC5PC
     I              HRAYVA                          WDAYVA
     I              HREDVL                          WDEDVL
     I              HRHGCD                          WDHGCD
     I              HRBKC7                          WDBKC7
     I              HRDUC7                          WDDUC7
     I              HRHHAA                          WDHHAA
     I              HRPODT                          WDPODT
     I              HRBYWG                          WDBYWG
     I              HRBVST                          WDBVST
     I              HRP7SX                          WDP7SX
     I              HROKCD                          WDOKCD
     I              HRP8SX                          WDP8SX
     I              HRP9SX                          WDP9SX
     I              HRQASX                          WDQASX
     I              HRQBSX                          WDQBSX
     I              HRPPDT                          WDPPDT
     I              HRPQDT                          WDPQDT
     I              HREEVL                          WDEEVL
     I              HREFVL                          WDEFVL
     I              HRFITX                          WDFITX
     I              HRFJTX                          WDFJTX
     I              HRQ8DT                          WDQ8DT
     I              HRFKTX                          WDFKTX
     I              HRH0NY                          WDH0NY
     I              HRKQT1                          WDKQT1
     I              HRKTT1                          WDKTT1
     I              HRHIAA                          WDHIAA
     I              HRHLAA                          WDHLAA
     I              HROJCD                          WDOJCD
     I              HRAVNB                          WDAVNB
     I              HRDSCD                          WDDSCD
     I              HRUVST                          WDUVST
     I              HRUWST                          WDUWST
     I              HRUXST                          WDUXST
     I              HRAATM                          WDAATM
     I              HRAYNA                          WDAYNA
     I              HRA0NA                          WDA0NA
     I              HRAXDT                          WDAXDT
      *
     I@HRCPLL
      * Shipping Dtl Accrual      Update index
      * Renamed input format fields
     I              HRAIC3                          WEAIC3
     I              HRC4NB                          WEC4NB
     I              HRDPNB                          WEDPNB
     I              HRUENB                          WEUENB
     I              HRDXNB                          WEDXNB
     I              HRBKPR                          WEBKPR
     I              HRC5PC                          WEC5PC
     I              HRAYVA                          WEAYVA
     I              HREDVL                          WEEDVL
     I              HRHGCD                          WEHGCD
     I              HRBKC7                          WEBKC7
     I              HRDUC7                          WEDUC7
     I              HRHHAA                          WEHHAA
     I              HRPODT                          WEPODT
     I              HRBYWG                          WEBYWG
     I              HRBVST                          WEBVST
     I              HRP7SX                          WEP7SX
     I              HROKCD                          WEOKCD
     I              HRP8SX                          WEP8SX
     I              HRP9SX                          WEP9SX
     I              HRQASX                          WEQASX
     I              HRQBSX                          WEQBSX
     I              HRPPDT                          WEPPDT
     I              HRPQDT                          WEPQDT
     I              HREEVL                          WEEEVL
     I              HREFVL                          WEEFVL
     I              HRFITX                          WEFITX
     I              HRFJTX                          WEFJTX
     I              HRQ8DT                          WEQ8DT
     I              HRFKTX                          WEFKTX
     I              HRH0NY                          WEH0NY
     I              HRKQT1                          WEKQT1
     I              HRKTT1                          WEKTT1
     I              HRHIAA                          WEHIAA
     I              HRHLAA                          WEHLAA
     I              HROJCD                          WEOJCD
     I              HRAVNB                          WEAVNB
     I              HRDSCD                          WEDSCD
     I              HRUVST                          WEUVST
     I              HRUWST                          WEUWST
     I              HRUXST                          WEUXST
     I              HRAATM                          WEAATM
     I              HRAYNA                          WEAYNA
     I              HRA0NA                          WEA0NA
     I              HRAXDT                          WEAXDT
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPDIC1    E DSPDICCPL0
      * UPD : History Dtl Accrual       Update index
      * Renamed input format fields
     I              ICAIC3                          WCAIC3
     I              ICC4NB                          WCC4NB
     I              ICDPNB                          WCDPNB
     I              ICUENB                          WCUENB
     I              ICDXNB                          WCDXNB
     I              ICBKPR                          WCBKPR
     I              ICAYVA                          WCAYVA
     I              ICEDVL                          WCEDVL
     I              ICHGCD                          WCHGCD
     I              ICBKC7                          WCBKC7
     I              ICPTDT                          WCPTDT
     I              ICBYWG                          WCBYWG
     I              ICBVST                          WCBVST
     I              ICP7SX                          WCP7SX
     I              ICOKCD                          WCOKCD
     I              ICQQSX                          WCQQSX
     I              ICQRSX                          WCQRSX
     I              ICFLTX                          WCFLTX
     I              ICQSSX                          WCQSSX
     I              ICPRDT                          WCPRDT
     I              ICPSDT                          WCPSDT
     I              ICEGVL                          WCEGVL
     I              ICEHVL                          WCEHVL
     I              ICAVNB                          WCAVNB
     I              ICDSCD                          WCDSCD
     I              ICFMTX                          WCFMTX
     I              ICFNTX                          WCFNTX
     I              ICQ9DT                          WCQ9DT
     I              ICFOTX                          WCFOTX
     I              ICH1NY                          WCH1NY
     I              ICKRT1                          WCKRT1
     I              ICKST1                          WCKST1
     I              ICHJAA                          WCHJAA
     I              ICHKAA                          WCHKAA
     I              ICHHAA                          WCHHAA
     I              ICOJCD                          WCOJCD
     I              ICAATM                          WCAATM
     I              ICAYNA                          WCAYNA
     I              ICA0NA                          WCA0NA
     I              ICAXDT                          WCAXDT
      *
     IYARDCS      DS                            173
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IQOMHR1    E DSOMHRCPL0
      * UPD : Shipping Dtl Accrual      Update index
      * Renamed input format fields
     I              HRAIC3                          WEAIC3
     I              HRC4NB                          WEC4NB
     I              HRDPNB                          WEDPNB
     I              HRUENB                          WEUENB
     I              HRDXNB                          WEDXNB
     I              HRBKPR                          WEBKPR
     I              HRC5PC                          WEC5PC
     I              HRAYVA                          WEAYVA
     I              HREDVL                          WEEDVL
     I              HRHGCD                          WEHGCD
     I              HRBKC7                          WEBKC7
     I              HRDUC7                          WEDUC7
     I              HRHHAA                          WEHHAA
     I              HRPODT                          WEPODT
     I              HRBYWG                          WEBYWG
     I              HRBVST                          WEBVST
     I              HRP7SX                          WEP7SX
     I              HROKCD                          WEOKCD
     I              HRP8SX                          WEP8SX
     I              HRP9SX                          WEP9SX
     I              HRQASX                          WEQASX
     I              HRQBSX                          WEQBSX
     I              HRPPDT                          WEPPDT
     I              HRPQDT                          WEPQDT
     I              HREEVL                          WEEEVL
     I              HREFVL                          WEEFVL
     I              HRFITX                          WEFITX
     I              HRFJTX                          WEFJTX
     I              HRQ8DT                          WEQ8DT
     I              HRFKTX                          WEFKTX
     I              HRH0NY                          WEH0NY
     I              HRKQT1                          WEKQT1
     I              HRKTT1                          WEKTT1
     I              HRHIAA                          WEHIAA
     I              HRHLAA                          WEHLAA
     I              HROJCD                          WEOJCD
     I              HRAVNB                          WEAVNB
     I              HRDSCD                          WEDSCD
     I              HRUVST                          WEUVST
     I              HRUWST                          WEUWST
     I              HRUXST                          WEUXST
     I              HRAATM                          WEAATM
     I              HRAYNA                          WEAYNA
     I              HRA0NA                          WEA0NA
     I              HRAXDT                          WEAXDT
      *
     IYBRDCS      DS                            183
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: History Dtl Accrual
      * I :  Accrual Type
     I                                        1   2 P1OKCD
      * I :  Broker Code
     I                                        3   8 P1HHAA
      * I :  Accrual Code
     I                                        9  11 P1OJCD
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1OKCD    PARM           WP0001  2        Accrual Type
     C           P1HHAA    PARM           WP0002  6        Broker Code
     C           P1OJCD    PARM           WP0003  3        Accrual Code
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Fix Sales Hist p/AcBrk XF
      * Fix Sales Hist p/AcBrk RT - History Dtl Accrual  * 
     C                     EXSR SARVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Fix Sales Hist p/AcBrk RT - History Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD1070923   WUL9DT           From Date
      * Declare restrictor key work fields
     C           *LIKE     DEFN WAOKCD    WQSA01           Accrual Type
     C           *LIKE     DEFN WAHHAA    WQSA02           Broker Code
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Accrual Type
     C                     KFLD           WQSA02           Broker Code
      * Setup key
     C                     MOVELP1OKCD    WQSA01           Accrual Type
     C                     MOVELP1HHAA    WQSA02           Broker Code
      * Establish starting position
     C           KRSSA     SETLL@ICCPKN                    *
     C           KRSSA     READE@ICCPKN                  90*
      * Data record not found
     C   90                MOVEL'USR1655' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.HDA Actual Ship Date GE WRK.From Date             USR
     C           WAPTDT    IFGE WUL9DT                     *IF
      * CASE: DB1.Accrual Code EQ PAR.Accrual Code
     C           WAOJCD    IFEQ P1OJCD                     *IF
      * Chg Affect Sales RealzRT - History Dtl Accrual  * 
     C                     EXSR SBRVGN
      * Upd Fix TF/CM/SB Amt  XF - Sales History  * 
     C                     CALL 'PPF8XFR'              90  Upd Fix TF/CM/S
     C                     PARM *BLANK    W0RTN   7
     C                     PARM WAAIC3    WQ0001  30       Company Number
     C                     PARM WAC4NB    WQ0002  70       Order Number
      *
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PPF8XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSA     READE@ICCPKN                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Chg Affect Sales RealzRT - History Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBAIC3    WQSB01           Company Number
     C           *LIKE     DEFN WBC4NB    WQSB02           Order Number
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           WQSB01           Company Number
     C                     KFLD           WQSB02           Order Number
      * Setup key
     C                     Z-ADDWAAIC3    WQSB01           Company Number
     C                     Z-ADDWAC4NB    WQSB02           Order Number
      * Establish starting position
     C           KRSSB     SETLL@ICCPS0                    *
     C           KRSSB     READE@ICCPS0                  90*
      * Data record not found
     C   90                MOVEL'USR1655' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.Accrual Type is Commission
     C           WBOKCD    IFEQ 'CM'                       *IF
      * Chg Affect Sales RealzCH - History Dtl Accrual  * 
     C                     EXSR SCCHRC
      * Rtv Fix Sales Realx fl RT - Shipping Dtl Accrual  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
     C           KRSSB     READE@ICCPS0                  90*
     C                     ENDDO
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Chg Affect Sales RealzCH - History Dtl Accrual  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  96       Accrual Rate
     C                     Z-ADD*ZERO     WN0002 112       Extended Amount
     C                     Z-ADD*ZERO     WN0003 112       Item Accrual Am
     C                     Z-ADD*ZERO     WN0004  70       Item Code
     C                     Z-ADD*ZERO     WN0005  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0006  70       HDA Actual Ship
     C                     Z-ADD*ZERO     WN0007 112       Weight Billed
     C                     MOVEL*BLANK    WN0008  1        Use G/L Code Dr
     C                     MOVEL*BLANK    WN0009  1        Retro Comm Calc
     C                     MOVEL*BLANK    WN0010  2        Accrual Type
     C                     MOVEL*BLANK    WN0011  1        HDA Affect Invo
     C                     MOVEL*BLANK    WN0012  1        HDA Print on In
     C                     MOVEL*BLANK    WN0013  2        HDA Invoice Pri
     C                     Z-ADD*ZERO     WN0014  70       HDA SA Week End
     C                     Z-ADD*ZERO     WN0015  70       HDA Unused Date
     C                     Z-ADD*ZERO     WN0016 112       HDA Unused Amt
     C                     Z-ADD*ZERO     WN0017 112       HDA Unused Amt
     C                     MOVEL*BLANK    WN0018  6        G/L Account for
     C                     MOVEL*BLANK    WN0019  8        G/L Sub Account
     C                     MOVEL*BLANK    WN0020  1        HDA Ledger Accr
     C                     MOVEL*BLANK    WN0021  2        HDA Accrual Rat
     C                     Z-ADD*ZERO     WN0022  70       HDA Invoice Dat
     C                     MOVEL*BLANK    WN0023  2        HDA Sub Ledger
     C                     Z-ADD*ZERO     WN0024  80       HDA G/L Sub Led
     C                     MOVEL*BLANK    WN0025  8        HDA G/L Code Dr
     C                     MOVEL*BLANK    WN0026  8        HDA G/L Code Cr
     C                     MOVEL*BLANK    WN0027  8        HDA JDE Account
     C                     MOVEL*BLANK    WN0028  8        HDA JDE Account
     C                     MOVEL*BLANK    WN0029  6        Broker Code
     C                     MOVEL*BLANK    WN0030  3        Accrual Code
     C                     Z-ADD*ZERO     WN0031  60       Job Time
     C                     MOVEL*BLANK    WN0032 10        User Id
     C                     MOVEL*BLANK    WN0033 10        Job Name
     C                     Z-ADD*ZERO     WN0034  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @ICCPSZ
     C                     Z-ADDWBAIC3    WCAIC3           Company Number
     C                     Z-ADDWBC4NB    WCC4NB           Order Number
     C                     Z-ADDWBDPNB    WCDPNB           Order Sequence
     C                     Z-ADDWBUENB    WCUENB           Order Secondary
     C                     Z-ADDWBDXNB    WCDXNB           Sequence Number
      *
     C           KLCHSC    KLIST
     C                     KFLD           WCAIC3           Company Number
     C                     KFLD           WCC4NB           Order Number
     C                     KFLD           WCDPNB           Order Sequence
     C                     KFLD           WCUENB           Order Secondary
     C                     KFLD           WCDXNB           Sequence Number
     C           KLCHSC    CHAIN@ICCPSZ              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PDICCPL0'MDACP
     C                     MOVEL'@ICCPSZ' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SCEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPDIC1    YARDCS
      * Move non-key fields to @ICCPSZ
     C                     MOVEL'N'       WCQQSX    P      HDA Affect Sale
      *
      * Set PGM.*Record Data Changed flag
     C           QPDIC1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@ICCPSZ                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPDICCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Fix Sales Realx fl RT - Shipping Dtl Accrual  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WDAIC3           Company Number
     C                     KFLD           WDC4NB           Order Number
     C                     KFLD           WDDPNB           Order Sequence
     C                     KFLD           WDUENB           Order Secondary
     C                     KFLD           WDDXNB           Sequence Number
      * Setup key
     C                     Z-ADDWBAIC3    WDAIC3           Company Number
     C                     Z-ADDWBC4NB    WDC4NB           Order Number
     C                     Z-ADDWBDPNB    WDDPNB           Order Sequence
     C                     Z-ADDWBUENB    WDUENB           Order Secondary
     C                     Z-ADDWBDXNB    WDDXNB           Sequence Number
      * Establish starting position
     C           KRSSD     CHAIN@HRCPLM              90    *
      * Data record not found
     C   90                MOVEL'USR1526' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE: DB1.Accrual Type is Commission
     C           WDOKCD    IFEQ 'CM'                       *IF
      * Chg Affect SalesRealz RT - Shipping Dtl Accrual  * 
     C                     EXSR SECHRC
     C                     END                             *FI
     C                     ENDIF
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Chg Affect SalesRealz RT - Shipping Dtl Accrual  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0035  96       Accrual Rate
     C                     Z-ADD*ZERO     WN0036  52       Accrual Percent
     C                     Z-ADD*ZERO     WN0037 112       Extended Amount
     C                     Z-ADD*ZERO     WN0038 112       Item Accrual Am
     C                     Z-ADD*ZERO     WN0039  70       Item Code
     C                     Z-ADD*ZERO     WN0040  70       Ship To Custome
     C                     Z-ADD*ZERO     WN0041  70       A/R Customer
     C                     MOVEL*BLANK    WN0042  6        Broker Code
     C                     Z-ADD*ZERO     WN0043  70       SDA Actual Ship
     C                     Z-ADD*ZERO     WN0044 112       Weight Billed
     C                     MOVEL*BLANK    WN0045  1        Use G/L Code Dr
     C                     MOVEL*BLANK    WN0046  1        Retro Comm Calc
     C                     MOVEL*BLANK    WN0047  2        Accrual Type
     C                     MOVEL*BLANK    WN0048  1        SDA Affect Invo
     C                     MOVEL*BLANK    WN0049  1        SDA Print on In
     C                     MOVEL*BLANK    WN0050  2        SDA Invoice Pri
     C                     Z-ADD*ZERO     WN0051  70       SDA Ord Dtl Acr
     C                     Z-ADD*ZERO     WN0052  70       SDA Unused Date
     C                     Z-ADD*ZERO     WN0053 112       SDA Unused Amt
     C                     Z-ADD*ZERO     WN0054 112       SDA Unused Amt
     C                     MOVEL*BLANK    WN0055  1        SDA Ledger Accr
     C                     MOVEL*BLANK    WN0056  2        SDA Accrual Rat
     C                     Z-ADD*ZERO     WN0057  70       SDA Invoice Dat
     C                     MOVEL*BLANK    WN0058  2        SDA Sub Ledger
     C                     Z-ADD*ZERO     WN0059  80       SDA G/L Sub Led
     C                     MOVEL*BLANK    WN0060  8        SDA G/L Code Dr
     C                     MOVEL*BLANK    WN0061  8        SDA G/L Code Cr
     C                     MOVEL*BLANK    WN0062  8        SDA JDE Account
     C                     MOVEL*BLANK    WN0063  8        SDA JDE Account
     C                     MOVEL*BLANK    WN0064  3        Accrual Code
     C                     MOVEL*BLANK    WN0065  6        G/L Account for
     C                     MOVEL*BLANK    WN0066  8        G/L Sub Account
     C                     MOVEL*BLANK    WN0067  1        EDI Status 1
     C                     MOVEL*BLANK    WN0068  1        EDI Status 2
     C                     MOVEL*BLANK    WN0069  1        EDI Status 3
     C                     Z-ADD*ZERO     WN0070  60       Job Time
     C                     MOVEL*BLANK    WN0071 10        User Id
     C                     MOVEL*BLANK    WN0072 10        Job Name
     C                     Z-ADD*ZERO     WN0073  70       Job Date
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @HRCPLL
     C                     Z-ADDWDAIC3    WEAIC3           Company Number
     C                     Z-ADDWDC4NB    WEC4NB           Order Number
     C                     Z-ADDWDDPNB    WEDPNB           Order Sequence
     C                     Z-ADDWDUENB    WEUENB           Order Secondary
     C                     Z-ADDWDDXNB    WEDXNB           Sequence Number
      *
     C           KLCHSE    KLIST
     C                     KFLD           WEAIC3           Company Number
     C                     KFLD           WEC4NB           Order Number
     C                     KFLD           WEDPNB           Order Sequence
     C                     KFLD           WEUENB           Order Secondary
     C                     KFLD           WEDXNB           Sequence Number
     C           KLCHSE    CHAIN@HRCPLL              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'OMHRCPL0'MDACP
     C                     MOVEL'@HRCPLL' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QOMHR1    YBRDCS
      * Move non-key fields to @HRCPLL
     C                     MOVEL'N'       WEP8SX    P      SDA Affect Sale
      *
      * Set PGM.*Record Data Changed flag
     C           QOMHR1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * USER: Processing before Data update
      * Set Date/Time Stamp   IF
     C                     Z-ADD##JTM     WN0070           Job Time
     C                     MOVEL##USR     WN0071           User Id
     C                     MOVEL##JOB     WN0072           Job Name
     C                     Z-ADD##JDT     WN0073           Job Date
      * Set PGM.*Record Data Changed flag
     C           QOMHR1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@HRCPLL                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKOMHRCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAAIC3           Company Number
     C                     Z-ADD*ZERO     WAC4NB           Order Number
     C                     Z-ADD*ZERO     WADPNB           Order Sequence
     C                     Z-ADD*ZERO     WAUENB           Order Secondary
     C                     Z-ADD*ZERO     WADXNB           Sequence Number
     C                     Z-ADD*ZERO     WABKPR           Accrual Rate
     C                     Z-ADD*ZERO     WAAYVA           Extended Amount
     C                     Z-ADD*ZERO     WAEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WAHGCD           Item Code
     C                     Z-ADD*ZERO     WABKC7           Ship To Custome
     C                     Z-ADD*ZERO     WAPTDT           HDA Actual Ship
     C                     Z-ADD*ZERO     WABYWG           Weight Billed
     C                     Z-ADD*ZERO     WAPRDT           HDA SA Week End
     C                     Z-ADD*ZERO     WAPSDT           HDA Unused Date
     C                     Z-ADD*ZERO     WAEGVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WAEHVL           HDA Unused Amt
     C                     Z-ADD*ZERO     WAQ9DT           HDA Invoice Dat
     C                     Z-ADD*ZERO     WAH1NY           HDA G/L Sub Led
     C                     Z-ADD*ZERO     WAAATM           Job Time
     C                     Z-ADD*ZERO     WAAXDT           Job Date
      * Define work field From Date             USR
     C                     Z-ADD*ZERO     WUL9DT  70
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WDAIC3           Company Number
     C                     Z-ADD*ZERO     WDC4NB           Order Number
     C                     Z-ADD*ZERO     WDDPNB           Order Sequence
     C                     Z-ADD*ZERO     WDUENB           Order Secondary
     C                     Z-ADD*ZERO     WDDXNB           Sequence Number
     C                     Z-ADD*ZERO     WDBKPR           Accrual Rate
     C                     Z-ADD*ZERO     WDC5PC           Accrual Percent
     C                     Z-ADD*ZERO     WDAYVA           Extended Amount
     C                     Z-ADD*ZERO     WDEDVL           Item Accrual Am
     C                     Z-ADD*ZERO     WDHGCD           Item Code
     C                     Z-ADD*ZERO     WDBKC7           Ship To Custome
     C                     Z-ADD*ZERO     WDDUC7           A/R Customer
     C                     Z-ADD*ZERO     WDPODT           SDA Actual Ship
     C                     Z-ADD*ZERO     WDBYWG           Weight Billed
     C                     Z-ADD*ZERO     WDPPDT           SDA Ord Dtl Acr
     C                     Z-ADD*ZERO     WDPQDT           SDA Unused Date
     C                     Z-ADD*ZERO     WDEEVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDEFVL           SDA Unused Amt
     C                     Z-ADD*ZERO     WDQ8DT           SDA Invoice Dat
     C                     Z-ADD*ZERO     WDH0NY           SDA G/L Sub Led
     C                     Z-ADD*ZERO     WDAATM           Job Time
     C                     Z-ADD*ZERO     WDAXDT           Job Date
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
