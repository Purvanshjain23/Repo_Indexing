// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PDCZXFR
// ?Date: 14.08.2025 Time: 03:34:13
// ?------------------------------------------------------------------------------------------------

//?Execute user function

EXECUTE FUNCTION(CNV OMS280 Lock Loads  RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1483749;
{
 //?USER: Process Data record

 CASE;

 // IF DB1.Load Status is Lock
 IF DB1.Load_Status = 'L';

 EXECUTE FUNCTION(CNV OMS280 Get A/S     RT) TYPE(RTVOBJ) FILE(OPBFCPP)          AC1483750;
 PARAMETER(DB1.Load_ID);
 PARAMETER(DB1.Carrier_Broker);
 {
  //?USER: Initialize routine

  //?05/14/04 SLM PKTR01 Multi-Company - Funct chg remove Company RST or Pos
  //?USER: Process Data record

  // PAR.Trans Contol AS400/Plant = CND.AS400
  PAR.Trans_Contol_AS400_Plant = 'A';

  EXECUTE FUNCTION(RTV 1st Warehouse/Ctl  RT) TYPE(RTVOBJ) FILE(OPBGWKP)          AC1360958;
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  PARAMETER(*ZERO);
  PARAMETER(*ZERO);
  PARAMETER(PAR.Warehouse_Code);
  PARAMETER(PAR.Trans_Contol_AS400_Plant);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   EXECUTE FUNCTION(RTV Warehouse Control  RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1304300;
   PARAMETER(DB1.Warehouse_Code);
   PARAMETER(PAR.Trans_Contol_AS400_Plant);
   {
    //?USER: Processing if Data record not found

    MOVE *ALL (To: PAR From: CON);

    // PGM.*Return code = CND.*Record does not exist
    PGM.*Return_code = 'Y2U0005';

    //?USER: Process Data record

    MOVE *ALL (To: PAR From: DB1);

   }

   MOVE *ALL (To: PAR From: DB1);

   QUIT;

  }

  CASE;

  // IF PAR.Trans Contol AS400/Plant is Plant
  IF PAR.Trans_Contol_AS400_Plant = 'P';

  EXECUTE FUNCTION(CNV OMS280 Get Stop    RT) TYPE(RTVOBJ) FILE(OMFLCPP)          AC1483751;
  PARAMETER(DB1.Load_ID);
  PARAMETER(PAR.Stop_Drop);
  PARAMETER(DB1.Order_Number);
  {
   //?USER: Processing if Data record not found

   MOVE *ALL (To: PAR From: CON);

   //?USER: Process Data record

   MOVE *ALL (To: PAR From: DB1);

  }

  // WRK.Sequence Number = CON.*ZERO
  WRK.Sequence_Number = *ZERO;

  // PGM.*Return code = CND.*Record already exists
  PGM.*Return_code = 'Y2U0003';

  // DOW PGM.*Return code is *Record already exists
  DOW PGM.*Return_code = 'Y2U0003';

  // WRK.Sequence Number = WRK.Sequence Number + CON.1
  WRK.Sequence_Number = WRK.Sequence_Number + 1;

  EXECUTE FUNCTION(CNV OMS280 Create Log  CR) TYPE(CRTOBJ) FILE(PDLHCPP)          AC1483763;
  PARAMETER(JOB.*Job_date);
  PARAMETER(JOB.*Job_time);
  PARAMETER(WRK.Sequence_Number);
  PARAMETER(DB1.Load_ID);
  PARAMETER(PAR.Stop_Drop);
  PARAMETER('SNDACC');
  PARAMETER('INT');
  PARAMETER(*BLANK);
  PARAMETER(*BLANK);
  PARAMETER(JOB.*USER);
  PARAMETER(JOB.*JOB);
  PARAMETER(DB1.Carrier_Code);
  PARAMETER(PAR.Carrier_Broker);
  PARAMETER(DB1.Company_Number);
  PARAMETER(DB1.Order_Number);
  {
   //?USER: Processing if Data record already exists

   // PGM.*Return code = CND.*Record already exists
   PGM.*Return_code = 'Y2U0003';

   //?USER: Processing after Data update

   // PGM.*Return code = CND.*Normal
   PGM.*Return_code = *BLANK;

  }

  ENDDO;

  ENDIF;

 }

 ENDIF;

}


