// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PBCCPVR
// ?Date: 14.08.2025 Time: 03:47:26
// ?------------------------------------------------------------------------------------------------

//?USER: Initialize program

//?***** Change log and comments
DO;

//?** E001891 slm 02/27/2012
//?** E001891 *************************************
//?** The following two pars are used when the report is requested
//?** and the only time we are going to send a spread sheet
//?** is from the INVNIGHT runs for Guymon and St Joseph
//?** PS Prt Prd Sched/Plan - *MESSAGE
//?** Pass PRDSPS Production Spread Sheet as blanks
//?** Pass HAMSPS Ham Spread Sheet as blanks
//?** E001891 *************************************
//?** FP1054 SLM 04/14/2009
//?** if the date being selected is the same as the job date
//?** then use the standard data
//?** else use the production data
//?** FP1054 SLM 04/14/2009
//?** Since the removal of company - have the warehouse supply
//?** the accounting company
//?** FP1054 SLM 02/25/2009
//?** Report is being change from seleting on warehouse
//?** to also sum, on the production wares house and select on warehouse
//?** E00243 SLM 11/28/2008
//?** Remove the trim and belly from this selection screen
//?** Alice want this on a menu
//?** E00243 SLM 10/28/2008
//?** Add option to perform the Trim Production Schedul
//?** Add option to perform the Belly Production schedule
//?** FP1235 LJB 04/14/2008
//?** Add option to email the make sheet to the distribution list
//?** "DL Triumph Production Sheet"
//?** FP1235 LJB 01/23/2008 Leave report type as "Day" Schedule
//?** Add program & display file names for new variance style report
//?** Pass the program based on the requested schedule. If "D" for
//?** Day Schedule or "V" for Variance, pass the original program.
//?** If "M" for Make Sheet Schedule, pass the Make Sheet with
//?** Variance program name.
//?RMC 10/21/05 make warehouse a BOTH parameter so its passed in/out
ENDDO;

//?USER: Load screen

// DTL.Print Comments Usr = CND.yes
DTL.Print_Comments_Usr = 'Y';

// DTL.Report TypeSchWTrm/Bel SR = CND.Day Schedule
DTL.Report_TypeSchWTrm_Bel_SR = 'D';

// DTL.Condition Desc. 3  USR = Condition name of DTL.Report Type Schedule  USR
DTL.Condition_Desc_3_USR = RTVCND(DTL.Report_Type_Schedule_USR);

// DTL.Warehouse Code PASS   USR = PAR.Warehouse Code
DTL.Warehouse_Code_PASS_USR = PAR.Warehouse_Code;

EXECUTE FUNCTION(RTV Whse Descrip       RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1257603;
PARAMETER(DTL.Warehouse_Code_PASS_USR);
PARAMETER(DTL.Warehouse_Description);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 // PAR.Warehouse Description = DB1.Warehouse Description
 PAR.Warehouse_Description = DB1.Warehouse_Description;

}


// DTL.Production Date = PAR.Production Date
DTL.Production_Date = PAR.Production_Date;

// DTL.Email Selection usr = CND.Not Selected
DTL.Email_Selection_usr = *BLANK;

//?USER: Validate fields

//?Prompt warehouse
CASE;

// IF DTL.*CMD key is *Prompt
IF DTL.*CMD_key = '04';

CASE;

// IF PGM.*Cursor field <IS> DTL.Warehouse Code PASS   USR
IF PGM.*Cursor_field = DTL.Warehouse_Code_PASS_USR;

// Call program SEL Prod Whse          SR.
CALL PROGRAM(SEL Prod Whse          SR) ('PDLISRR');
PARAMETER(DTL.Warehouse_Code_PASS_USR);

ENDIF;

ENDIF;

//?CALC: Screen function fields

EXECUTE FUNCTION(RTV Whse Descrip       RT) TYPE(RTVOBJ) FILE(CAADREP)          AC1257603;
PARAMETER(DTL.Warehouse_Code_PASS_USR);
PARAMETER(DTL.Warehouse_Description);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 MOVE *ALL (To: PAR From: CON);

 //?USER: Process Data record

 // PAR.Warehouse Description = DB1.Warehouse Description
 PAR.Warehouse_Description = DB1.Warehouse_Description;

}


// DTL.Condition Desc. 3  USR = Condition name of DTL.Report TypeSchWTrm/Bel SR
DTL.Condition_Desc_3_USR = RTVCND(DTL.Report_TypeSchWTrm_Bel_SR);

//?USER: Validate relations

EXECUTE FUNCTION(Val WHS/Rtv ActCo PFS RT) TYPE(RTVOBJ) FILE(CAADREP)           AC1801267;
PARAMETER(DTL.Warehouse_Code_PASS_USR);
PARAMETER(LCL.Lot_Tracking_Flag);
PARAMETER(LCL.Accounting_Company);
{
 //?USER: Processing if Data record not found

 // PGM.*Return code = CND.*Record does not exist
 PGM.*Return_code = 'Y2U0005';

 //?USER: Process Data record

 MOVE *ALL (To: PAR From: DB1);

 // PGM.*Return code = CND.*Record already exists
 PGM.*Return_code = 'Y2U0003';

}


CASE;

// IF PGM.*Return code is *Record does not exist
IF PGM.*Return_code = 'Y2U0005';

// Send error message - 'Warehouse not found'
ERROR(USR0372);
MSGPARM(DTL.Warehouse_Code_PASS_USR);

ENDIF;

//?USER: Exit program processing

// LCL.Production Spread Sheet = CON.*BLANK
LCL.Production_Spread_Sheet = *BLANK;

CASE;

// IF DTL.*CMD key is CF03
IF DTL.*CMD_key = '03';

// IF *OTHERWISE
IF *OTHERWISE;

CASE;

// IF DTL.Production Date EQ JOB.*Job date
IF DTL.Production_Date = JOB.*Job_date;

// DTL.Production Type = CND.Schedule
DTL.Production_Type = 'S';

// IF *OTHERWISE
IF *OTHERWISE;

// DTL.Production Type = PAR.Production Type
DTL.Production_Type = PAR.Production_Type;

ENDIF;

//?Load parms for sbmjob
// LCL.Status - Y or N = DTL.Print Comments Usr
LCL.Status_Y_or_N = DTL.Print_Comments_Usr;

// LCL.Report Type Schedule  USR = DTL.Report TypeSchWTrm/Bel SR
LCL.Report_Type_Schedule_USR = DTL.Report_TypeSchWTrm_Bel_SR;

// LCL.Warehouse Code = DTL.Warehouse Code PASS   USR
LCL.Warehouse_Code = DTL.Warehouse_Code_PASS_USR;

// LCL.Production Date = DTL.Production Date
LCL.Production_Date = DTL.Production_Date;

//?** Pass the program based on the requested schedule   FP1235 LJB
CASE;

// IF DTL.Report TypeSchWTrm/Bel SR is Make Sheet with Variance
IF DTL.Report_TypeSchWTrm_Bel_SR = 'M';

// LCL.Program name USR = CON.PMRVPFR
LCL.Program_name_USR = 'PMRVPFR';

// LCL.Program Name$ USR = CON.PMRVPFR$
LCL.Program_Name$_USR = 'PMRVPFR$';

// LCL.Email Selection usr = DTL.Email Selection usr
LCL.Email_Selection_usr = DTL.Email_Selection_usr;

//?** Pass the program based on the requested schedule   FP1235 LJB
// IF DTL.Report TypeSchWTrm/Bel SR is Day Schedule
IF DTL.Report_TypeSchWTrm_Bel_SR = 'D';

// LCL.Production Spread Sheet = CON.PRDSPS
LCL.Production_Spread_Sheet = 'PRDSPS';

// LCL.Program name USR = CON.PMFAPFR
LCL.Program_name_USR = 'PMFAPFR';

// LCL.Program Name$ USR = CON.PMFAPFR$
LCL.Program_Name$_USR = 'PMFAPFR$';

//?** Pass the program based on the requested schedule   FP1235 LJB
// IF DTL.Report TypeSchWTrm/Bel SR is Variance Schedule
IF DTL.Report_TypeSchWTrm_Bel_SR = 'V';

// LCL.Program name USR = CON.PMFAPFR
LCL.Program_name_USR = 'PMFAPFR';

// LCL.Program Name$ USR = CON.PMFAPFR$
LCL.Program_Name$_USR = 'PMFAPFR$';

ENDIF;

// Call program PMT Prt Opt w/PSz SHR  PV.
CALL PROGRAM(PMT Prt Opt w/PSz SHR  PV) ('PDV8PVR');
PARAMETER(PAR.PRT_Description);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Number_of_Copies);
PARAMETER(PAR.PRT_Night_Queue_Run_Sts);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(PAR.Application_Code);
PARAMETER(*MISSING);
PARAMETER(PAR.Paper_Type_USR);

// PAR.Display Prt Opt Pmt USR = CND.*NO
PAR.Display_Prt_Opt_Pmt_USR = *NO;

CASE;

// IF DTL.Sel Spread Sheet Usr is yes
IF DTL.Sel_Spread_Sheet_Usr = 'Y';

// LCL.Production Spread Sheet = CON.PRDSPDS
LCL.Production_Spread_Sheet = 'PRDSPDS';

// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Production Spread Sheet = CON.*BLANK
LCL.Production_Spread_Sheet = *BLANK;

ENDIF;

//?Submit Report
CASE;

// IF PGM.*Return code is *User QUIT requested
IF PGM.*Return_code = 'Y2U9999';

//?Submit Report
// IF *OTHERWISE
IF *OTHERWISE;

// LCL.Prod Date Alpha USR = CVTVAR(DTL.Production Date)
LCL.Prod_Date_Alpha_USR = CVTVAR(DTL.Production_Date);

// Execute command - 'PS Print Production Scheduled/Plan'
EXECUTE COMMAND(USR2282);
PARAMETER(PAR.PRT_Printer_Device);
PARAMETER(PAR.PRT_Hold_Output_Sts);
PARAMETER(PAR.PRT_Save_Output_Sts);
PARAMETER(PAR.PRT_Number_of_Copies);
PARAMETER(PAR.PRT_Night_Queue);
PARAMETER(LCL.Program_name_USR);
PARAMETER(LCL.Program_Name$_USR);
PARAMETER('P/S');
PARAMETER(LCL.Accounting_Company);
PARAMETER(DTL.Production_Type);
PARAMETER(LCL.Prod_Date_Alpha_USR);
PARAMETER(DTL.Job_Name);
PARAMETER(LCL.Status_Y_or_N);
PARAMETER(LCL.Report_Type_Schedule_USR);
PARAMETER(LCL.Warehouse_Code);
PARAMETER(DTL.Email_Selection_usr);
PARAMETER(*BLANK);
PARAMETER('Y');

ENDIF;

ENDIF;

