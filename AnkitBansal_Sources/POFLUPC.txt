/********************************************************************/
/*                                                                  */
/*  SYNOPSIS - BUILT THE ITEM DOWNLOAD FILE FOR TOM DYE TO FTP      */
/*                                                                  */
/*  COMPANY   - SEABOARD COPRORATION                                */
/*  SYSTEM    - ORDER MANAGEMENT                                    */
/*  USER NAME - ROSE CENTONZE                                       */
/*  DATE      - 05/16/00                                            */
/*                                                                  */
/*      PARAMETERS RECEIVED:                                        */
/*                                                                  */
/*          &PGM        - PROGRAM NAME                              */
/*          &COMPL      - COMPANY NUMBER - BLANK FOR ALL            */
/*          &FDATEL     - MARKET DATE                         */
/*          &DOCUM      - DOCUMENT NAME                            */
/*          &DOCUMENT   - PARM DOCUMENT                             */
/*          &EMAIL      - REQ                                      */
/*          &EMAIL2     - OPTIONAL                                 */
/********************************************************************/
/* RMC  1/9/2001  CALL FTPPRKSRVR TO PUSH DOCUMENT TO FTP WEBSITE */
/* RMC  1/11/2002 CALL FTPPRKSRV3 TO PUSH DOC TO \\PORKCFILE01\TDYE$  */
/* RMC  4/09/07   REPLACE FTP WITH EMAIL                          */
/********************************************************************/

 POFLUPC:   PGM        PARM(&RTN &COMPL &FDATEL  &EMAIL &EMAIL2)


             DCL        VAR(&RTN) TYPE(*CHAR) LEN(7) /*  RETURN +
                          CODE   */
        DCL    &COMP      *DEC    (3 0)           /*  COMPANY #     */
        DCL    &COMPL     *DEC                    /*  FOR PASSING   */
        DCL    &FDATE     *DEC    (7 0)          /*  PROD DATE      */
        DCL    &FDATEL    *DEC                   /*  FOR PASSING    */
        DCL    &FDATEX    *CHAR   (7)          /*  PROD DATE      */
        DCL    &DOCUMENT  *CHAR   (10)
        DCL    &PCFILE    *CHAR   (32)
        DCL    &DOCUM     *CHAR   (08)
        DCL    &EMAIL     *CHAR   (50)
        DCL    &EMAIL2    *CHAR   (50)

        DCL     &DATA     *CHAR   10
        DCL     &DATAH    *CHAR   10

/* SEND PROGRAM MESSAGE PARAMETERS  */

             /* Internal Fields */
             DCL  VAR(&ALREADY)  TYPE(*CHAR) LEN(1)

             DCL        VAR(&SEL)  TYPE(*CHAR) LEN(1500)

             CHGVAR    VAR(&COMP) VALUE(&COMPL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATE) VALUE(&FDATEL) /* Change to length +
                          for print program */
             CHGVAR    VAR(&FDATEX) VALUE(&FDATE) /* Change to CHAR  */
 /*------------------------------------------------*/
 /*     BUILD THE WORKFILE   */
 /*------------------------------------------------*/
             CALL      PGM(CAQXXFR) PARM(' ' &DATA &DATAH)
             CRTDUPOBJ  OBJ(POAPCPP) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ OBJ(POAPCPL0) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)
             CRTDUPOBJ OBJ(POAPCPL1) FROMLIB(&DATA) OBJTYPE(*FILE) +
                          TOLIB(QTEMP)

             CALL       PGM(POFNXFR) PARM('' &COMP &FDATE)
 /*------------------------------------------------*/

             ADDLIBLE LIB(SEQUEL) POSITION(*LAST)
             MONMSG MSGID(CPF2103) EXEC(DO)       /* already in libl */
                CHGVAR VAR(&ALREADY) VALUE('Y')
                ENDDO
   /*------------------------------------------------*/
   /* EXECUTE SEQUEL TO SELECT THE WORKF FILE AND FTP IT -*/
   /*-----------------------------------------------*/
             CHGVAR     VAR(&SEL) VALUE('SELECT APAIC3 +
                          COLHDG("Company"), APHGCD EDTCDE(Z) +
                          COLHDG("Item" "Code"), APAVNA +
                          COLHDG("Description"), APLQCD +
                          COLHDG("Market" "Code"), APLRCD +
                          COLHDG("Commod" "Price Group"),  APEQDT +
                          COLHDG("Market" "Date"), APEAPR +
                          COLHDG("Market" "Price") FROM QTEMP/POAPCPP')



             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') TEXT('Item +
                          Download')
        IF COND(&EMAIL2 > '     ') THEN(DO)
             EXECUTE    SQL(&SEL) MBROPT(*REPLACE) NBRRCDS(*ALL) +
                          KEYFLDCNT(*ALL) ALWNULL(*NO) PCFMT(*XLS) +
                          REPLACE(*YES) RECIPIENT(&EMAIL2) +
                          OPTIMIZE(*TOTAL) ALWCPY(*YES) MSG(*YES) +
                          UNIQUEKEY(*NONE) IGNDECERR(*NO) +
                          DTSTYLE(*FIELD '/' *FIELD ':') TEXT('Item +
                          Download')
             ENDDO
             GOTO       CMDLBL(END)
   /*---------------------------------*/
   /* Remove SEQUEL Library from List */
   /*---------------------------------*/
             IF COND(&ALREADY *EQ 'N') THEN(DO)
                RMVLIBLE   LIB(SEQUEL)
             ENDDO
   /*------------------------------------*/
   /* PUSH documents to \\PORKCFILE01\TDYE   */
   /*------------------------------------*/
             CHGVAR VAR(&DOCUMENT) VALUE(&DOCUM)
             CHGVAR VAR(&PCFILE)   VALUE(&DOCUM *TCAT '.CSV')
             CALL PGM(FTPPRKSRV3) PARM(&DOCUMENT &PCFILE)


 END:        ENDPGM
