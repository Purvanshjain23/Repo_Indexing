     H/TITLE Cnv Mov MnfDt 2/PRKFHSTXF Execute external functio
     H DATFMT(*YMD) DATEDIT(*YMD) DEBUG(*YES)
     Z* CRTBNDRPG
     Z* DFTACTGRP(*NO) BNDDIR(YBNDDIR) DBGVIEW(*SOURCE)
     Z* CVTOPT(*DATETIME) ACTGRP(*CALLER) OPTIMIZE(*BASIC)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.7.1 (1635)
     H* Function type : Execute external function
     H* Object type   : *PGM
      *
     H* Company       : OMS Development Model
     H* System        : OMS Development Model
     H* User name     : ISDNGUY
     H* Date          : 09/27/24  Time  : 14:11:07
     H* Copyright     : OMS Development Model
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FOPBFCPH9  IF   E           K DISK
      * RSQ : Order Header TRG          Co/CstPO/Shpto/Ord Invoi
      *
     FOMFNCPL1  IF   E           K DISK
      * RTV : Manifest Detail           Retrieval index
      *
     FOMFNCPL0  UF   E           K DISK
      * UPD : Manifest Detail           Update index
      *
      * Long constants
     D @CN#            S              6    DIM(02)CTDATA PERRCD(1)
     D @CN             S             25    DIM(02) ALT(@CN#)
      /EJECT
      * Data structures:
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Modified Program data structure
     D JBDTTM          DS
      * Job date/time
     D  ##JDT                  1      7  0
     D  ##JCC                  1      1  0
     D  ##JYY                  2      3  0
     D  ##JMM                  4      5  0
     D  ##JDD                  6      7  0
     D  ##JTM                  8     13  0
     D  ##JHH                  8      9  0
     D  ##JNN                 10     11  0
     D  ##JSS                 12     13  0
      * Outward parameters
     D PARC            DS           159
      * RCD : Manifest Detail           Retrieval index
      * I :  Company Number
     D  PAAIC3                 1      2P 0
      * I :  Order Number
     D  PAC4NB                 3      6P 0
      * I :  Order Sequence Number
     D  PADPNB                 7      8P 0
      * I :  Order Secondary Line Seq
     D  PAUENB                 9     10P 0
      * I :  Case Sequence Number
     D  PARZNB                11     13P 0
      * I :  Case Quantity
     D  PAFOQT                14     16P 0
      * I :  Case Weight
     D  PAR0NB                17     22P 2
      * I :  Inventory Updated Flag
     D  PAPMST                23     23
      * I :  Label Date
     D  PAK7DT                24     27P 0
      * I :  PT Serial Number
     D  PAPFNX                28     32P 0
      * I :  Item Code
     D  PAHGCD                33     36P 0
      * I :  Warehouse Code
     D  PAAJCD                37     39
      * I :  Production Date
     D  PAELDT                40     43P 0
      * I :  Manifest Gross Weight
     D  PAN5WG                44     49P 2
      * I :  Manifest Lot ID
     D  PARZNA                50     59
      * I :  Manifest Total Tare
     D  PAH5NY                60     67  2
      * I :  Manifest Co_Park Lot Nbr
     D  PAH6NY                68     72  0
      * I :  Manifest Pallet Number
     D  PAH7NY                73     81  0
      * I :  Manifest Shift
     D  PAGBTX                82     82
      * I :  HPB Meter Net Gallon
     D  PAN6WG                83     88P 2
      * I :  Manifest Net Weight_Kg
     D  PAN7WG                89     94P 2
      * I :  Manifest Unused Status 1A
     D  PAGCTX                95     95
      * I :  Manifest Unused Status 2A
     D  PAGDTX                96     96
      * I :  Manifest Unused Date
     D  PARBDT                97    100P 0
      * I :  HPB COA Batch Number
     D  PAITNY               101    103P 0
      * I :  HPB Meter Start Gallon
     D  PAIVNY               104    108P 0
      * I :  HPB Meter Ending Gallon
     D  PAIUNY               109    113P 0
      * I :  HPB Meter Total Gallon
     D  PAIWNY               114    118P 0
      * I :  HPB Meter Net Weight
     D  PAIXNY               119    123P 0
      * I :  HPB Density Ref Gravity
     D  PAIYNY               124    127P 4
      * I :  EDI Status 1
     D  PAUVST               128    128
      * I :  EDI Status 2
     D  PAUWST               129    129
      * I :  EDI Status 3
     D  PAUXST               130    130
      * I :  Record Status
     D  PAVSST               131    131
      * I :  Job Time
     D  PAAATM               132    135P 0
      * I :  User Id
     D  PAAYNA               136    145
      * I :  Job Name
     D  PAA0NA               146    155
      * I :  Job Date
     D  PAAXDT               156    159P 0
      *
     D QOMFN1        E DS                  EXTNAME(OMFNCPL0)
      * UPD : Manifest Detail           Update index
      * Renamed input format fields
     D  WCAIC3       E                     EXTFLD(FNAIC3)
     D  WCC4NB       E                     EXTFLD(FNC4NB)
     D  WCDPNB       E                     EXTFLD(FNDPNB)
     D  WCUENB       E                     EXTFLD(FNUENB)
     D  WCRZNB       E                     EXTFLD(FNRZNB)
     D  WCFOQT       E                     EXTFLD(FNFOQT)
     D  WCR0NB       E                     EXTFLD(FNR0NB)
     D  WCPMST       E                     EXTFLD(FNPMST)
     D  WCK7DT       E                     EXTFLD(FNK7DT)
     D  WCPFNX       E                     EXTFLD(FNPFNX)
     D  WCHGCD       E                     EXTFLD(FNHGCD)
     D  WCAJCD       E                     EXTFLD(FNAJCD)
     D  WCELDT       E                     EXTFLD(FNELDT)
     D  WCN5WG       E                     EXTFLD(FNN5WG)
     D  WCRZNA       E                     EXTFLD(FNRZNA)
     D  WCH5NY       E                     EXTFLD(FNH5NY)
     D  WCH6NY       E                     EXTFLD(FNH6NY)
     D  WCH7NY       E                     EXTFLD(FNH7NY)
     D  WCGBTX       E                     EXTFLD(FNGBTX)
     D  WCN6WG       E                     EXTFLD(FNN6WG)
     D  WCN7WG       E                     EXTFLD(FNN7WG)
     D  WCGCTX       E                     EXTFLD(FNGCTX)
     D  WCGDTX       E                     EXTFLD(FNGDTX)
     D  WCRBDT       E                     EXTFLD(FNRBDT)
     D  WCITNY       E                     EXTFLD(FNITNY)
     D  WCIVNY       E                     EXTFLD(FNIVNY)
     D  WCIUNY       E                     EXTFLD(FNIUNY)
     D  WCIWNY       E                     EXTFLD(FNIWNY)
     D  WCIXNY       E                     EXTFLD(FNIXNY)
     D  WCIYNY       E                     EXTFLD(FNIYNY)
     D  WCUVST       E                     EXTFLD(FNUVST)
     D  WCUWST       E                     EXTFLD(FNUWST)
     D  WCUXST       E                     EXTFLD(FNUXST)
     D  WCVSST       E                     EXTFLD(FNVSST)
     D  WCAATM       E                     EXTFLD(FNAATM)
     D  WCAYNA       E                     EXTFLD(FNAYNA)
     D  WCA0NA       E                     EXTFLD(FNA0NA)
     D  WCAXDT       E                     EXTFLD(FNAXDT)
      *
      * Message data for message Y2U0009.
     D MD0009          DS
     D  MDPGM                  1     10
     D  MDACP                 11     20
     D  MDFMT                 21     30
     D  MDACT                 31     34
     D  MDLBL                 35     40
      *
      * Declared stand-alone variables
     D  P0RTN          S              7
     D  W0ICL          S              1
     D  W0RTN          S              7
     D  W0RSL          S              1
     D  W0RSF          S              1
     D  W0RTW          S              9  0
     D  W0ENV          S              3
     D  ##TME          S              6  0
     D  YL0001         S              7  0
     D  YN0001         S             10
     D  YL0002         S              8
     D  Y0CX01         S              1
     D  WL0001         S              3  0
     D  WL0002         S              7  0
     D  WQSB01         S                   LIKE(WBAIC3)
     D  WQSB02         S                   LIKE(WBC4NB)
     D  W0CLPG         S             10
     D  ZAPGMQ         S             10
     D  ZAPGRL         S              5
     D  ZAMSID         S              7
     D  ZAMSGF         S             10
     D  ZAMSTP         S              7
     D  YILE           S              1
     D  W0PMT          S              1
     d SysDateUSA      S               D   datfmt(*USA)
     d SysTimeHMS      S              8a
     D                 DS
     D  ZAMSDA                 1    132
     I@BFCPH1
      * Order Header TRG          Co/CstPO/Shpto/Ord Invoi
      * Renamed input format fields
     I              BEAIC3                      WAAIC3
     I              BEC4NB                      WAC4NB
     I              BEJNCD                      WAJNCD
     I              BEANC7                      WAANC7
     I              BEBKC7                      WABKC7
     I              BEBRTX                      WABRTX
     I              BEHMNA                      WAHMNA
     I              BEHONA                      WAHONA
     I              BEHPNA                      WAHPNA
     I              BEHNNA                      WAHNNA
     I              BEDBCD                      WADBCD
     I              BECKTX                      WACKTX
     I              BEB0C7                      WAB0C7
     I              BEAETX                      WAAETX
     I              BEB1NA                      WAB1NA
     I              BEB3NA                      WAB3NA
     I              BEB4NA                      WAB4NA
     I              BEB2NA                      WAB2NA
     I              BEBHCD                      WABHCD
     I              BEC8TX                      WAC8TX
     I              BEBCNA                      WABCNA
     I              BEA0DT                      WAA0DT
     I              BEA5DT                      WAA5DT
     I              BEGNDT                      WAGNDT
     I              BEACDT                      WAACDT
     I              BEAQCD                      WAAQCD
     I              BEB6NA                      WAB6NA
     I              BEBYNA                      WABYNA
     I              BEBZNA                      WABZNA
     I              BEGTST                      WAGTST
     I              BEGVST                      WAGVST
     I              BEGUST                      WAGUST
     I              BEQFST                      WAQFST
     I              BECQCD                      WACQCD
     I              BEGJST                      WAGJST
     I              BEGWST                      WAGWST
     I              BEGXST                      WAGXST
     I              BEGYST                      WAGYST
     I              BEAODT                      WAAODT
     I              BEAIVN                      WAAIVN
     I              BECXDT                      WACXDT
     I              BEJZVA                      WAJZVA
     I              BEA1WG                      WAA1WG
     I              BEXIST                      WAXIST
     I              BEXJST                      WAXJST
     I              BEXKST                      WAXKST
     I              BEEIDT                      WAEIDT
     I              BEAFTM                      WAAFTM
     I              BEE8CD                      WAE8CD
     I              BEE9CD                      WAE9CD
     I              BERMNB                      WARMNB
     I              BETBNB                      WATBNB
     I              BER1NB                      WAR1NB
     I              BEPJST                      WAPJST
     I              BEU0ST                      WAU0ST
     I              BEU1ST                      WAU1ST
     I              BEQ2CD                      WAQ2CD
     I              BEU2ST                      WAU2ST
     I              BEVEST                      WAVEST
     I              BEVFST                      WAVFST
     I              BEVGST                      WAVGST
     I              BERPCD                      WARPCD
     I              BERNNB                      WARNNB
     I              BEVDST                      WAVDST
     I              BEATIN                      WAATIN
     I              BEU4ST                      WAU4ST
     I              BEU5ST                      WAU5ST
     I              BERSRN                      WARSRN
     I              BEMHNA                      WAMHNA
     I              BEMINA                      WAMINA
     I              BEWBST                      WAWBST
     I              BER4CD                      WAR4CD
     I              BEBFCD                      WABFCD
     I              BEQ4CD                      WAQ4CD
     I              BET3NB                      WAT3NB
     I              BESICD                      WASICD
     I              BECONB                      WACONB
     I              BECEST                      WACEST
     I              BEAWDT                      WAAWDT
     I              BEJPCD                      WAJPCD
     I              BEXUST                      WAXUST
     I              BEZ1ST                      WAZ1ST
     I              BEVRVA                      WAVRVA
     I              BEOBST                      WAOBST
     I              BEBCST                      WABCST
     I              BEBDST                      WABDST
     I              BEB7VL                      WAB7VL
     I              BEGASX                      WAGASX
     I              BEGBSX                      WAGBSX
     I              BEGCSX                      WAGCSX
     I              BEGDSX                      WAGDSX
     I              BEFNSX                      WAFNSX
     I              BEFOSX                      WAFOSX
     I              BEFPSX                      WAFPSX
     I              BEFQSX                      WAFQSX
     I              BEFRSX                      WAFRSX
     I              BEFSSX                      WAFSSX
     I              BEFTSX                      WAFTSX
     I              BEFUSX                      WAFUSX
     I              BEFVSX                      WAFVSX
     I              BEFWSX                      WAFWSX
     I              BEFXSX                      WAFXSX
     I              BEFYSX                      WAFYSX
     I              BENODT                      WANODT
     I              BENPDT                      WANPDT
     I              BENQDT                      WANQDT
     I              BENRDT                      WANRDT
     I              BENSDT                      WANSDT
     I              BEBPTM                      WABPTM
     I              BEBQTM                      WABQTM
     I              BEBRTM                      WABRTM
     I              BEBSTM                      WABSTM
     I              BEBTTM                      WABTTM
     I              BEH0NX                      WAH0NX
     I              BEH1NX                      WAH1NX
     I              BEH2NX                      WAH2NX
     I              BEH3NX                      WAH3NX
     I              BEH4NX                      WAH4NX
     I              BEC0C7                      WAC0C7
     I              BEUVST                      WAUVST
     I              BEUWST                      WAUWST
     I              BEUXST                      WAUXST
     I              BEAATM                      WAAATM
     I              BEAYNA                      WAAYNA
     I              BEA0NA                      WAA0NA
     I              BEAXDT                      WAAXDT
      *
     I@FNCPCT
      * Manifest Detail           Retrieval index
      * Renamed input format fields
     I              FNAIC3                      WBAIC3
     I              FNC4NB                      WBC4NB
     I              FNDPNB                      WBDPNB
     I              FNUENB                      WBUENB
     I              FNRZNB                      WBRZNB
     I              FNFOQT                      WBFOQT
     I              FNR0NB                      WBR0NB
     I              FNPMST                      WBPMST
     I              FNK7DT                      WBK7DT
     I              FNPFNX                      WBPFNX
     I              FNHGCD                      WBHGCD
     I              FNAJCD                      WBAJCD
     I              FNELDT                      WBELDT
     I              FNN5WG                      WBN5WG
     I              FNRZNA                      WBRZNA
     I              FNH5NY                      WBH5NY
     I              FNH6NY                      WBH6NY
     I              FNH7NY                      WBH7NY
     I              FNGBTX                      WBGBTX
     I              FNN6WG                      WBN6WG
     I              FNN7WG                      WBN7WG
     I              FNGCTX                      WBGCTX
     I              FNGDTX                      WBGDTX
     I              FNRBDT                      WBRBDT
     I              FNITNY                      WBITNY
     I              FNIVNY                      WBIVNY
     I              FNIUNY                      WBIUNY
     I              FNIWNY                      WBIWNY
     I              FNIXNY                      WBIXNY
     I              FNIYNY                      WBIYNY
     I              FNUVST                      WBUVST
     I              FNUWST                      WBUWST
     I              FNUXST                      WBUXST
     I              FNVSST                      WBVSST
     I              FNAATM                      WBAATM
     I              FNAYNA                      WBAYNA
     I              FNA0NA                      WBA0NA
     I              FNAXDT                      WBAXDT
      *
     I@FNCPCS
      * Manifest Detail           Update index
      * Renamed input format fields
     I              FNAIC3                      WCAIC3
     I              FNC4NB                      WCC4NB
     I              FNDPNB                      WCDPNB
     I              FNUENB                      WCUENB
     I              FNRZNB                      WCRZNB
     I              FNFOQT                      WCFOQT
     I              FNR0NB                      WCR0NB
     I              FNPMST                      WCPMST
     I              FNK7DT                      WCK7DT
     I              FNPFNX                      WCPFNX
     I              FNHGCD                      WCHGCD
     I              FNAJCD                      WCAJCD
     I              FNELDT                      WCELDT
     I              FNN5WG                      WCN5WG
     I              FNRZNA                      WCRZNA
     I              FNH5NY                      WCH5NY
     I              FNH6NY                      WCH6NY
     I              FNH7NY                      WCH7NY
     I              FNGBTX                      WCGBTX
     I              FNN6WG                      WCN6WG
     I              FNN7WG                      WCN7WG
     I              FNGCTX                      WCGCTX
     I              FNGDTX                      WCGDTX
     I              FNRBDT                      WCRBDT
     I              FNITNY                      WCITNY
     I              FNIVNY                      WCIVNY
     I              FNIUNY                      WCIUNY
     I              FNIWNY                      WCIWNY
     I              FNIXNY                      WCIXNY
     I              FNIYNY                      WCIYNY
     I              FNUVST                      WCUVST
     I              FNUWST                      WCUWST
     I              FNUXST                      WCUXST
     I              FNVSST                      WCVSST
     I              FNAATM                      WCAATM
     I              FNAYNA                      WCAYNA
     I              FNA0NA                      WCA0NA
     I              FNAXDT                      WCAXDT
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C     *ENTRY        PLIST
     C                   PARM                    P0RTN
      *****************************************************************
      * Initialize
     C                   EXSR      ZZINIT
      *
      * Cnv Mov MnfDt 2/PRKFHSTXF
      * Per Lucas H., we should target 1 rolling year, Year to date.
      * E.g. All of 2023 and YTD for 2024.
      * Selecting Actual Ship Date all of 2023 and up to 2024 YTD.
      * Set Cutoff Date USR to what Lucas decide.?????
     C                   Z-ADD     1230101       YL0001                         Cutoff Date USR
      * Selecting Completed & Cancelled Orders Only. (OH = MD Population)
      * Cnv Mov MnfDt 2/PRKFHSTRT - Order Header TRG  * 
     C                   EXSR      SARVGN
      *----------------------------------------------------------------
      * Exit program
     C     AAEXIT        TAG
     C                   EVAL      P0RTN = ' '
     C                   EXSR      ZYEXPG
      *================================================================
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Cnv Mov MnfDt 2/PRKFHSTRT - Order Header TRG  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Establish starting position
     C     *LOVAL        SETLL     @BFCPH1                                      *
     C                   READ      @BFCPH1                                90    *
      * Data record not found
     C   90              MOVEL     'USR0176'     W0RTN
      * USER: Process Data record
      * Get System Date/Time 2 US - /UT User Source  * 
     C                   DOW       NOT *IN90
      * Get System Date/Time 2 US
      *
      /free
         SysDateUSA = %date();
         YN0001 = %char(SysDateUSA);

         SysTimeHMS = %char(%time():*HMS);
         YL0002 = SysTimeHMS;
      /end-free
      * Quit Job if Still Running @9PM.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : LCL.System Time *HMS USR is GE 21:00:00
      *   |- c2    : LCL.System Time *HMS USR is LE 21:03:00
      *   '-
     C                   MOVEL     '0'           Y0CX01
     C                   IF        YL0002 >= @CN(001)
     C                   IF        YL0002 <= @CN(002)
     C                   MOVEL     '1'           Y0CX01
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   IF        Y0CX01 = '1'
     C                   GOTO      SAEXIT                                       *QUIT
     C                   END                                                    *FI
      * Do NOT select Cancelled Orders.
      * A/P Selects 'Completed' (C) or 'Shipped' (R) Orders.
      * Processing for Completed Orders Only.
      * CASE: DB1.Header Status is Complete
      * Check Actual Shipped Date.
      * CASE: DB1.Actual Shipped Date is entered
     C                   IF        WAGWST = 'C'
      * Actual Shipped Date Must be Less Than Cutoff Date.
      * CASE: DB1.Actual Shipped Date LT PAR.Cutoff Date USR
     C                   IF        WAGNDT <> 0
      * ***Move Record to PRKHST.
      * Cnv Mov MnfDt 2/PRKFHSTRT - Manifest Detail  * 
      * Move input parameters to subroutine local variables.
     C                   IF        WAGNDT < YL0001
     C                   Z-ADD     WAAIC3        WL0001                         Company Number
     C                   Z-ADD     WAC4NB        WL0002                         Order Number
     C                   EXSR      SBRVGN
     C                   END                                                    *FI
     C                   ELSE
      * CASE: *OTHERWISE
      * Check Date of Original Entry.
      * CASE: DB1.Date of Original Entry is Entered
      * Orig Entry Date Must be Less Than Cutoff Date.
      * CASE: DB1.Date of Original Entry LT PAR.Cutoff Date USR
     C                   IF        WACXDT <> 0
      * ***Move Record to PRKHST.
      * Cnv Mov MnfDt 2/PRKFHSTRT - Manifest Detail  * 
      * Move input parameters to subroutine local variables.
     C                   IF        WACXDT < YL0001
     C                   Z-ADD     WAAIC3        WL0001                         Company Number
     C                   Z-ADD     WAC4NB        WL0002                         Order Number
     C                   EXSR      SBRVGN
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   READ      @BFCPH1                                90    *
     C                   ENDDO
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Cnv Mov MnfDt 2/PRKFHSTRT - Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Declare restrictor key work fields
      * Define keylist
     C     KRSSB         KLIST
     C                   KFLD                    WQSB01                         Company Number
     C                   KFLD                    WQSB02                         Order Number
      * Setup key
     C                   Z-ADD     WL0001        WQSB01                         Company Number
     C                   Z-ADD     WL0002        WQSB02                         Order Number
      * Establish starting position
     C     KRSSB         SETLL     @FNCPCT                                      *
     C     KRSSB         READE     @FNCPCT                                90    *
      * Data record not found
     C   90              MOVEL     'USR1196'     W0RTN
      * USER: Process Data record
      * Copy Record to PRKFHST First.
      * Cnv Mov MnfDt 2/PRKFHSTUP - Manifest Detail  * 
     C                   DOW       NOT *IN90
     C                   CLEAR                   PARC
     C                   Z-ADD     WBAIC3        PAAIC3                         Company Number
     C                   Z-ADD     WBC4NB        PAC4NB                         Order Number
     C                   Z-ADD     WBDPNB        PADPNB                         Order Sequence
     C                   Z-ADD     WBUENB        PAUENB                         Order Secondary
     C                   Z-ADD     WBRZNB        PARZNB                         Case Sequence N
     C                   Z-ADD     WBFOQT        PAFOQT                         Case Quantity
     C                   Z-ADD     WBR0NB        PAR0NB                         Case Weight
     C                   MOVEL(P)  WBPMST        PAPMST                         Inventory Updat
     C                   Z-ADD     WBK7DT        PAK7DT                         Label Date
     C                   Z-ADD     WBPFNX        PAPFNX                         PT Serial Numbe
     C                   Z-ADD     WBHGCD        PAHGCD                         Item Code
     C                   MOVEL(P)  WBAJCD        PAAJCD                         Warehouse Code
     C                   Z-ADD     WBELDT        PAELDT                         Production Date
     C                   Z-ADD     WBN5WG        PAN5WG                         Manifest Gross
     C                   MOVEL(P)  WBRZNA        PARZNA                         Manifest Lot ID
     C                   Z-ADD     WBH5NY        PAH5NY                         Manifest Total
     C                   Z-ADD     WBH6NY        PAH6NY                         Manifest Co_Par
     C                   Z-ADD     WBH7NY        PAH7NY                         Manifest Pallet
     C                   MOVEL(P)  WBGBTX        PAGBTX                         Manifest Shift
     C                   Z-ADD     WBN6WG        PAN6WG                         HPB Meter Net G
     C                   Z-ADD     WBN7WG        PAN7WG                         Manifest Net We
     C                   MOVEL(P)  WBGCTX        PAGCTX                         Manifest Unused
     C                   MOVEL(P)  WBGDTX        PAGDTX                         Manifest Unused
     C                   Z-ADD     WBRBDT        PARBDT                         Manifest Unused
     C                   Z-ADD     WBITNY        PAITNY                         HPB COA Batch N
     C                   Z-ADD     WBIVNY        PAIVNY                         HPB Meter Start
     C                   Z-ADD     WBIUNY        PAIUNY                         HPB Meter Endin
     C                   Z-ADD     WBIWNY        PAIWNY                         HPB Meter Total
     C                   Z-ADD     WBIXNY        PAIXNY                         HPB Meter Net W
     C                   Z-ADD     WBIYNY        PAIYNY                         HPB Density Ref
     C                   MOVEL(P)  WBUVST        PAUVST                         EDI Status 1
     C                   MOVEL(P)  WBUWST        PAUWST                         EDI Status 2
     C                   MOVEL(P)  WBUXST        PAUXST                         EDI Status 3
     C                   MOVEL(P)  WBVSST        PAVSST                         Record Status
     C                   Z-ADD     WBAATM        PAAATM                         Job Time
     C                   MOVEL(P)  WBAYNA        PAAYNA                         User Id
     C                   MOVEL(P)  WBA0NA        PAA0NA                         Job Name
     C                   Z-ADD     WBAXDT        PAAXDT                         Job Date
      *
     C                   CALL      'PVHGUPR'                            90      Cnv Mov MnfDt 2
     C                   PARM                    PARC                           RCD: Manifest D
      *
      * Call to program ended in error
     C                   IF        *IN90
     C                   MOVEL     'Y2U0032'     W0RTN
     C                   EVAL      W0CLPG = ' '
     C                   MOVEL     'PVHGUPR'     W0CLPG
      * Send message '*Error occured on CALL...'
     C                   MOVEL     'Y2U0032'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     W0CLPG        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   SETON                                        99        *
     C                   END
      * Delete Record.
      * DLT OM Manifest Detail DL - Manifest Detail  * 
     C                   EXSR      SCDLRC
     C     KRSSB         READE     @FNCPCT                                90    *
     C                   ENDDO
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCDLRC        BEGSR
      *================================================================
      * DLT OM Manifest Detail DL - Manifest Detail  * 
      *================================================================
     C                   EVAL      W0RTN = ' '
      * Move key fields to @FNCPCS
     C                   Z-ADD     WBAIC3        WCAIC3                         Company Number
     C                   Z-ADD     WBC4NB        WCC4NB                         Order Number
     C                   Z-ADD     WBDPNB        WCDPNB                         Order Sequence
     C                   Z-ADD     WBUENB        WCUENB                         Order Secondary
     C                   Z-ADD     WBRZNB        WCRZNB                         Case Sequence N
      *
     C     KLDLSC        KLIST
     C                   KFLD                    WCAIC3                         Company Number
     C                   KFLD                    WCC4NB                         Order Number
     C                   KFLD                    WCDPNB                         Order Sequence
     C                   KFLD                    WCUENB                         Order Secondary
     C                   KFLD                    WCRZNB                         Case Sequence N
     C     KLDLSC        CHAIN     @FNCPCS                            9091      *
      * Record already deleted
     C                   IF        *IN90
     C                   MOVEL     'Y2U0009'     W0RTN
     C                   MOVEL     ##PGM         MDPGM
     C                   MOVEL     'OMFNCPL0'    MDACP
     C                   MOVEL     '@FNCPCS'     MDFMT
     C                   MOVEL     '*DLT'        MDACT
      * Record not found label: LBL001.
     C                   MOVEL     'LBL001'      MDLBL
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   MOVEL     MD0009        ZAMSDA                         Message data
     C                   EXSR      ZASNMS
     C                   EVAL      MD0009 = ' '
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      * Record locked
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
      * Send message '*Database operation error'
     C                   MOVEL     'Y2U0004'     ZAMSID
     C                   MOVEL     'Y2USRMSG'    ZAMSGF
     C                   EXSR      ZASNMS
     C                   GOTO      SCEXIT
     C                   ENDIF
      *
      *................................................................
     C                   DELETE    @FNCPCS                              91      *
      * Delete error detected
     C                   IF        *IN91
     C                   MOVEL     'Y2U0004'     W0RTN
     C                   ENDIF
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C                   IF        ZAPGMQ = ' '
     C                   MOVEL     ##PGM         ZAPGMQ
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGMQ                         Program queue
     C                   PARM                    ZAPGRL                         Rel queue
     C                   PARM                    ZAMSID                         Message ID
     C                   PARM                    ZAMSGF                         Message file
     C                   PARM                    ZAMSDA                         Message data
     C                   PARM                    ZAMSTP                         Message type
     C                   PARM      'Y'           YILE
      * Clear all fields for default mechanism next time
     C                   EVAL      ZAPGMQ = ' '
     C                   EVAL      ZAPGRL = ' '
     C                   EVAL      ZAMSID = ' '
     C                   EVAL      ZAMSGF = ' '
     C                   EVAL      ZAMSDA = ' '
     C                   EVAL      ZAMSTP = ' '
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                   SETON                                        LR
      *
      * Exit program
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                   IF        W0ICL = ' '
     C                   MOVEL     'Y'           W0ICL                          *Initial call
     C                   ELSE
     C                   MOVEL     'N'           W0ICL
     C                   END
     C                   EVALR     P0RTN = ' '
     C                   EVALR     W0RTN = ' '
     C                   EVAL      W0RSL = ' '
     C                   EVAL      W0RSF = ' '
     C                   MOVEL     *ZEROS        W0RTW
     C                   MOVEL     '400'         W0ENV
      *
      *
      * Retrieve job attributes
     C                   CALL      'Y2RTJCR'
     C                   PARM                    PGMDS
      * Setup job date/time
     C                   Z-ADD     ##SD7         ##JDT
     C                   TIME                    ##JTM
      * Update screen time
     C                   TIME                    ##TME
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WAAIC3                         Company Number
     C                   Z-ADD     *ZERO         WAC4NB                         Order Number
     C                   Z-ADD     *ZERO         WAANC7                         AR Customer Num
     C                   Z-ADD     *ZERO         WABKC7                         Ship To Custome
     C                   Z-ADD     *ZERO         WAB0C7                         Bill to Custome
     C                   Z-ADD     *ZERO         WAA0DT                         Order Date
     C                   Z-ADD     *ZERO         WAA5DT                         Requested Ship
     C                   Z-ADD     *ZERO         WAGNDT                         Actual Shipped
     C                   Z-ADD     *ZERO         WAACDT                         Cancel Date
     C                   Z-ADD     *ZERO         WAAODT                         Scheduled Ship
     C                   Z-ADD     *ZERO         WACXDT                         Date of Origina
     C                   Z-ADD     *ZERO         WAJZVA                         Order Value Tot
     C                   Z-ADD     *ZERO         WAA1WG                         Order Weight To
     C                   Z-ADD     *ZERO         WAEIDT                         Requested Deliv
     C                   Z-ADD     *ZERO         WAAFTM                         Requested Deliv
     C                   Z-ADD     *ZERO         WARMNB                         Load ID
     C                   Z-ADD     *ZERO         WATBNB                         Absorbed Freigh
     C                   Z-ADD     *ZERO         WAR1NB                         Rated Freight
     C                   Z-ADD     *ZERO         WARNNB                         Reefer Temperat
     C                   Z-ADD     *ZERO         WAATIN                         Attach to Invoi
     C                   Z-ADD     *ZERO         WARSRN                         Resell Referenc
     C                   Z-ADD     *ZERO         WAT3NB                         Attach to Order
     C                   Z-ADD     *ZERO         WACONB                         Invoice Number
     C                   Z-ADD     *ZERO         WAAWDT                         Invoice Date
     C                   Z-ADD     *ZERO         WAVRVA                         A_R order Value
     C                   Z-ADD     *ZERO         WAB7VL                         Invoice Order V
     C                   Z-ADD     *ZERO         WANODT                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WANPDT                         JPN Invoice Iss
     C                   Z-ADD     *ZERO         WANQDT                         Load Actual Shi
     C                   Z-ADD     *ZERO         WANRDT                         Load BOL Comple
     C                   Z-ADD     *ZERO         WANSDT                         Load Truck Depa
     C                   Z-ADD     *ZERO         WABPTM                         Maximum Gross W
     C                   Z-ADD     *ZERO         WABQTM                         Time of Origina
     C                   Z-ADD     *ZERO         WABRTM                         OH Appt Confirm
     C                   Z-ADD     *ZERO         WABSTM                         Load BOL Comple
     C                   Z-ADD     *ZERO         WABTTM                         Load Truck Depa
     C                   Z-ADD     *ZERO         WAH0NX                         Act Frt Referen
     C                   Z-ADD     *ZERO         WAH1NX                         Act Non_Ref Frt
     C                   Z-ADD     *ZERO         WAH2NX                         OH Fuel Surchar
     C                   Z-ADD     *ZERO         WAH3NX                         OH Total Non_Re
     C                   Z-ADD     *ZERO         WAH4NX                         OH Total Ref Fr
     C                   Z-ADD     *ZERO         WAC0C7                         Claim Number
     C                   Z-ADD     *ZERO         WAAATM                         Job Time
     C                   Z-ADD     *ZERO         WAAXDT                         Job Date
      * Initialize renamed input format fields
     C                   Z-ADD     *ZERO         WBAIC3                         Company Number
     C                   Z-ADD     *ZERO         WBC4NB                         Order Number
     C                   Z-ADD     *ZERO         WBDPNB                         Order Sequence
     C                   Z-ADD     *ZERO         WBUENB                         Order Secondary
     C                   Z-ADD     *ZERO         WBRZNB                         Case Sequence N
     C                   Z-ADD     *ZERO         WBFOQT                         Case Quantity
     C                   Z-ADD     *ZERO         WBR0NB                         Case Weight
     C                   Z-ADD     *ZERO         WBK7DT                         Label Date
     C                   Z-ADD     *ZERO         WBPFNX                         PT Serial Numbe
     C                   Z-ADD     *ZERO         WBHGCD                         Item Code
     C                   Z-ADD     *ZERO         WBELDT                         Production Date
     C                   Z-ADD     *ZERO         WBN5WG                         Manifest Gross
     C                   Z-ADD     *ZERO         WBH5NY                         Manifest Total
     C                   Z-ADD     *ZERO         WBH6NY                         Manifest Co_Par
     C                   Z-ADD     *ZERO         WBH7NY                         Manifest Pallet
     C                   Z-ADD     *ZERO         WBN6WG                         HPB Meter Net G
     C                   Z-ADD     *ZERO         WBN7WG                         Manifest Net We
     C                   Z-ADD     *ZERO         WBRBDT                         Manifest Unused
     C                   Z-ADD     *ZERO         WBITNY                         HPB COA Batch N
     C                   Z-ADD     *ZERO         WBIVNY                         HPB Meter Start
     C                   Z-ADD     *ZERO         WBIUNY                         HPB Meter Endin
     C                   Z-ADD     *ZERO         WBIWNY                         HPB Meter Total
     C                   Z-ADD     *ZERO         WBIXNY                         HPB Meter Net W
     C                   Z-ADD     *ZERO         WBIYNY                         HPB Density Ref
     C                   Z-ADD     *ZERO         WBAATM                         Job Time
     C                   Z-ADD     *ZERO         WBAXDT                         Job Date
      * Dummy move for compiler
     C                   MOVE      '0'           @CN#(1)
     C                   MOVEL     @CN(1)        @CN(1)
     C                   MOVEL     'N'           W0PMT
      * Define local variables for subroutine SBRVGN.
     C                   Z-ADD     *ZERO         WL0001
     C                   Z-ADD     *ZERO         WL0002
      * Define local work field Cutoff Date USR
     C                   Z-ADD     *ZERO         YL0001
      * Define null work field System Date *USA USR
     C                   EVAL      YN0001 = ' '
      * Define local work field System Time *HMS USR
     C                   EVAL      YL0002 = ' '
      *================================================================
     CSR   ZZEXIT        ENDSR
** @CN
00001 21:00:00
00002 21:03:00
