     H/TITLE Exc Bld W002 from CD  XF  Execute external functio
     H            Y
     Z* CRTRPGPGM
     Z* CVTOPT(*DATETIME)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by CA 2E release 8.6 (1547)
     H* Function type : Execute external function
      *
     H* Company       : HPEDEVMDL
     H* System        : HPEDEVMDL
     H* User name     : ISDREDD
     H* Date          : 12/17/20  Time  : 01:21:03
     H* Copyright     : HPEDEVMDL
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     FPLAMCPL1IF  E           K        DISK
      * RTV : W002 Broken Back Wgt Rng  Retrieval index
      *
     FPKB1CPL9IF  E           K        DISK
      * RSQ : Carcass Detail            Co/Kdte
      *
     FPLAMCPL2IF  E           K        DISK
      * RSQ : W002 Broken Back Wgt Rng  Max Wgt (D)
      *
     FPLAMCPL0UF  E           K        DISK
      * UPD : W002 Broken Back Wgt Rng  Update index
      *
     I@AMCPKB
      * W002 Broken Back Wgt Rng  Retrieval index
      * Renamed input format fields
     I              AMJMA1                          WAJMA1
     I              AMJNA1                          WAJNA1
     I              AMJPA1                          WAJPA1
     I              AMJLA1                          WAJLA1
     I              AMIHPC                          WAIHPC
     I              AMJQA1                          WAJQA1
     I              AMJOA1                          WAJOA1
     I              AMIIPC                          WAIIPC
      *
     I@AMCPKA
      * W002 Broken Back Wgt Rng  Update index
      * Renamed input format fields
     I              AMJMA1                          WBJMA1
     I              AMJNA1                          WBJNA1
     I              AMJPA1                          WBJPA1
     I              AMJLA1                          WBJLA1
     I              AMIHPC                          WBIHPC
     I              AMJQA1                          WBJQA1
     I              AMJOA1                          WBJOA1
     I              AMIIPC                          WBIIPC
      *
     I@B1CPQ6
      * Carcass Detail            Co/Kdte
      * Renamed input format fields
     I              B1HMNB                          WCHMNB
     I              B1BNNB                          WCBNNB
     I              B1BONB                          WCBONB
     I              B1CVNB                          WCCVNB
     I              B1B0DT                          WCB0DT
     I              B1LGNB                          WCLGNB
     I              B1EUNB                          WCEUNB
     I              B1LHNB                          WCLHNB
     I              B1INST                          WCINST
     I              B1BEPR                          WCBEPR
     I              B1ASPC                          WCASPC
     I              B1EWNB                          WCEWNB
     I              B1B4PR                          WCB4PR
     I              B1EYNB                          WCEYNB
     I              B1B1PR                          WCB1PR
     I              B1AVPR                          WCAVPR
     I              B1AUPC                          WCAUPC
     I              B1AWPR                          WCAWPR
     I              B1AXPR                          WCAXPR
     I              B1EZNB                          WCEZNB
     I              B1AYPR                          WCAYPR
     I              B1BBDT                          WCBBDT
     I              B1AKTM                          WCAKTM
     I              B1IQST                          WCIQST
     I              B1EFST                          WCEFST
     I              B1H6NB                          WCH6NB
     I              B1BEPC                          WCBEPC
     I              B1GCST                          WCGCST
     I              B1GDST                          WCGDST
     I              B1GEST                          WCGEST
     I              B1BHPC                          WCBHPC
     I              B1IOST                          WCIOST
     I              B1IPST                          WCIPST
     I              B1LTNB                          WCLTNB
     I              B1JNST                          WCJNST
     I              B1X4NB                          WCX4NB
     I              B1FNPC                          WCFNPC
     I              B1FOPC                          WCFOPC
     I              B1FPPC                          WCFPPC
     I              B1K2ST                          WCK2ST
     I              B1K3ST                          WCK3ST
     I              B1JWPR                          WCJWPR
     I              B1F5PC                          WCF5PC
     I              B1JXPR                          WCJXPR
     I              B1JYPR                          WCJYPR
     I              B1JZPR                          WCJZPR
     I              B1J0PR                          WCJ0PR
     I              B1J1PR                          WCJ1PR
     I              B1J2PR                          WCJ2PR
     I              B1J3PR                          WCJ3PR
     I              B1J4PR                          WCJ4PR
     I              B1UTST                          WCUTST
     I              B1HVCD                          WCHVCD
     I              B1DKJR                          WCDKJR
     I              B1ITJF                          WCITJF
     I              B1IJGR                          WCIJGR
     I              B1ORJE                          WCORJE
     I              B1OTJR                          WCOTJR
     I              B1PEIR                          WCPEIR
     I              B1IEUF                          WCIEUF
     I              B1ORUE                          WCORUE
     I              B1IUTR                          WCIUTR
     I              B1IJRR                          WCIJRR
     I              B1VCST                          WCVCST
     I              B1VDST                          WCVDST
     I              B1VEST                          WCVEST
     I              B1VFST                          WCVFST
     I              B1VGST                          WCVGST
     I              B1ABCD                          WCABCD
     I              B1AACD                          WCAACD
     I              B1AAVN                          WCAAVN
     I              B1AADT                          WCAADT
     I              B1AMTM                          WCAMTM
     I              B1AJST                          WCAJST
     I              B1AHVN                          WCAHVN
     I              B1AGVN                          WCAGVN
     I              B1ABVN                          WCABVN
     I              B1ABDT                          WCABDT
     I              B1ABTM                          WCABTM
      *
     I@AMCPKD
      * W002 Broken Back Wgt Rng  Max Wgt (D)
      * Renamed input format fields
     I              AMJMA1                          WDJMA1
     I              AMJNA1                          WDJNA1
     I              AMJPA1                          WDJPA1
     I              AMJLA1                          WDJLA1
     I              AMIHPC                          WDIHPC
     I              AMJQA1                          WDJQA1
     I              AMJOA1                          WDJOA1
     I              AMIIPC                          WDIIPC
      *
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Modified Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IQPLAM1    E DSPLAMCPL0
      * UPD : W002 Broken Back Wgt Rng  Update index
      * Renamed input format fields
     I              AMJMA1                          WBJMA1
     I              AMJNA1                          WBJNA1
     I              AMJPA1                          WBJPA1
     I              AMJLA1                          WBJLA1
     I              AMIHPC                          WBIHPC
     I              AMJQA1                          WBJQA1
     I              AMJOA1                          WBJOA1
     I              AMIIPC                          WBIIPC
      *
     IYARDCS      DS                             34
      * Message data for message Y2U0009.
     IMD0009      DS
     I                                        1  10 MDPGM
     I                                       11  20 MDACP
     I                                       21  30 MDFMT
     I                                       31  34 MDACT
     I                                       35  40 MDLBL
     IYBRDCS      DS                             34
     IYCRDCS      DS                             34
     IYDRDCS      DS                             34
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Date From Format USR
     I                                        1   8 P1ASVN
     IP2PARM      DS
      * I :  Date To Format USR
     I                                        1   8 P2ARVN
     IP3PARM      DS
      * N :  Date From USR
     I                                    P   1   40P3B3DT
     IP4PARM      DS
      * N :  Date To   USR
     I                                    P   1   40P4B4DT
     I            DS
     I                                        1 132 ZAMSDA
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1ASVN    PARM           WP0001  8        Date From Forma
     C           P2ARVN    PARM           WP0002  8        Date To Format
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Exc Bld W002 from CD  XF
      * 11/05/2020 ISE H16853 Recompiled due to change in Buy Order Numbe
     C                     Z-ADD2         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP1ASVN:ZQ WUP0TX    P  90  Month Alpha USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD4         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP1ASVN:ZQ WUP7TX    P  90  Day Alpha USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD7         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP1ASVN:ZQ WUIPNB    P  90  Year 2 USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD*ZERO     ZQ      50
     C           '1'       CAT  WUIPNB:ZQ WUC0CD    P      Cen + Yr USR
     C                     Z-ADD*ZERO     ZQ      50
     C           WUC0CD    CAT  WUP0TX:ZQ WUC1CD    P      Cen + Yr + Mo U
     C                     Z-ADD*ZERO     ZQ      50
     C           WUC1CD    CAT  WUP7TX:ZQ WUC2CD    P      Cen + Yr + Mo +
     C                     MOVE WUC2CD    P3B3DT           Date From USR
     C                     Z-ADD2         YRSW00
     C                     Z-ADD1         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP2ARVN:ZQ WUP0TX    P  90  Month Alpha USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD4         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP2ARVN:ZQ WUP7TX    P  90  Day Alpha USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD2         YRSW00
     C                     Z-ADD7         ZQ      50
     C           YRSW00    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW00    ORGT 00008
     C           ZQ        ORGT 00008
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW00    SUBSTP2ARVN:ZQ WUIPNB    P  90  Year 2 USR
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
     C                     Z-ADD*ZERO     ZQ      50
     C           '1'       CAT  WUIPNB:ZQ WUC0CD    P      Cen + Yr USR
     C                     Z-ADD*ZERO     ZQ      50
     C           WUC0CD    CAT  WUP0TX:ZQ WUC1CD    P      Cen + Yr + Mo U
     C                     Z-ADD*ZERO     ZQ      50
     C           WUC1CD    CAT  WUP7TX:ZQ WUC2CD    P      Cen + Yr + Mo +
     C                     MOVE WUC2CD    P4B4DT           Date To   USR
      * Rtv Co for User       XF - STR Order Management Sys  * 
     C                     CALL 'PLF8XFR'              90  Rtv Co for User
     C                     PARM *BLANK    W0RTN   7
     C           WUHONB    PARM *ZERO     WQ0001  30       CC Company Numb
     C                     PARM 'HPE'     WQ0002  6        Oms Application
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'PLF8XFR' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Rtv Clear fields      RT - W002 Broken Back Wgt Rng  * 
     C                     EXSR SARVGN
      * Rtv CD for BrokenBck  RT - Carcass Detail  * 
     C                     EXSR SCRVGN
      * Rtv Clc Pcts          RT - W002 Broken Back Wgt Rng  * 
     C                     EXSR SGRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Clear fields      RT - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@AMCPKB                    *
     C                     READ @AMCPKB                  90*
      * Data record not found
     C   90                MOVEL'PRK1091' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
     C                     EXSR SBCHRC
     C                     READ @AMCPKB                  90*
     C                     ENDDO
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCHRC    BEGSR
      *================================================================
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YARDC   1
      *
      * Move key fields to @AMCPKA
     C                     Z-ADDWAJMA1    WBJMA1           BB Min Wgt
     C                     Z-ADDWAJNA1    WBJNA1           BB Max Wgt
      *
     C           KLCHSB    KLIST
     C                     KFLD           WBJMA1           BB Min Wgt
     C                     KFLD           WBJNA1           BB Max Wgt
     C           KLCHSB    CHAIN@AMCPKA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAMCPL0'MDACP
     C                     MOVEL'@AMCPKA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL001.
     C                     MOVEL'LBL001'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SBEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPLAM1    YARDCS
      * Move non-key fields to @AMCPKA
     C                     Z-ADD*ZERO     WBJPA1           BB Head Killd S
     C                     Z-ADD*ZERO     WBJLA1           BB Head Count S
     C                     Z-ADD*ZERO     WBIHPC           BB Pct Broken S
     C                     Z-ADD*ZERO     WBJQA1           BB Head Killd S
     C                     Z-ADD*ZERO     WBJOA1           BB Head Count S
     C                     Z-ADD*ZERO     WBIIPC           BB Pct Broken S
      *
      * Set PGM.*Record Data Changed flag
     C           QPLAM1    IFNE YARDCS
     C           YARDC     ANDNE'N'
     C                     MOVE 'Y'       YARDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AMCPKA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Rtv CD for BrokenBck  RT - Carcass Detail  * 
      *================================================================
      *
     C                     Z-ADD*ZERO     WN0001  51       BB Min Wgt
     C                     Z-ADD*ZERO     WN0002  51       BB Max Wgt
     C                     Z-ADD*ZERO     WN0003  90       BB Head Killd S
     C                     Z-ADD*ZERO     WN0004  90       BB Head Count S
     C                     Z-ADD*ZERO     WN0005  74       BB Pct Broken S
     C                     Z-ADD*ZERO     WN0006  90       BB Head Killd S
     C                     Z-ADD*ZERO     WN0007  90       BB Head Count S
     C                     Z-ADD*ZERO     WN0008  74       BB Pct Broken S
      *
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCHMNB    WQSC01           BOH Company Num
      * Define keylist
     C           KPSSC     KLIST
     C                     KFLD           WQSC01           BOH Company Num
     C                     KFLD           WCB0DT           TH Kill Date
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           BOH Company Num
      * Setup key
     C                     Z-ADDWUHONB    WQSC01           BOH Company Num
     C                     Z-ADDP3B3DT    WCB0DT           TH Kill Date
      * Establish starting position
     C           KPSSC     SETLL@B1CPQ6                    *
     C           KRSSC     READE@B1CPQ6                  90*
      * Data record not found
     C   90                MOVEL'PRK0138' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Kill date
      * CASE:
      *  - c1ANDc2
      *   |- c1    : DB1.TH Kill Date GE PAR.Date From USR
      *   |- c2    : DB1.TH Kill Date LE PAR.Date To   USR
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WCB0DT    IFGE P3B3DT                     *IF
     C           WCB0DT    IFLE P4B4DT                     *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Rtv Chg Count         RT - W002 Broken Back Wgt Rng  * 
     C                     EXSR SDRVGN
     C                     END                             *FI
     C           KRSSC     READE@B1CPQ6                  90*
     C                     ENDDO
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv Chg Count         RT - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WDJNA1           BB Max Wgt
      * Setup key
     C                     Z-ADDWCEWNB    WDJNA1           BB Max Wgt
      * Establish starting position
     C           KPSSD     SETLL@AMCPKD                    *
     C                     READ @AMCPKD                  90*
      * Data record not found
     C   90                MOVEL'PRK1091' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: PAR.CD Shift is Shift 1
     C           WCIQST    IFEQ '1'                        *IF
     C           WDJPA1    ADD  1         YL0001           BB Head Killd S
     C                     Z-ADDWDJLA1    YL0002           BB Head Count S
      * CASE: PAR.CD Broken Back Sts is Yes
     C           WCVCST    IFEQ '1'                        *IF
     C           WDJLA1    ADD  1         YL0002           BB Head Count S
     C                     END                             *FI
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
     C                     EXSR SECHRC
     C                     GOTO SDEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.CD Shift is Shift 2
     C           WCIQST    IFEQ '2'                        *IF
     C           WDJQA1    ADD  1         YL0003           BB Head Killd S
     C                     Z-ADDWDJOA1    YL0004           BB Head Count S
      * CASE: PAR.CD Broken Back Sts is Yes
     C           WCVCST    IFEQ '1'                        *IF
     C           WDJOA1    ADD  1         YL0004           BB Head Count S
     C                     END                             *FI
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
     C                     EXSR SFCHRC
     C                     GOTO SDEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     READ @AMCPKD                  90*
     C                     ENDDO
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YBRDC   1
      *
      * Move key fields to @AMCPKA
     C                     Z-ADDWDJMA1    WBJMA1           BB Min Wgt
     C                     Z-ADDWDJNA1    WBJNA1           BB Max Wgt
      *
     C           KLCHSE    KLIST
     C                     KFLD           WBJMA1           BB Min Wgt
     C                     KFLD           WBJNA1           BB Max Wgt
     C           KLCHSE    CHAIN@AMCPKA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAMCPL0'MDACP
     C                     MOVEL'@AMCPKA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL002.
     C                     MOVEL'LBL002'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SEEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPLAM1    YBRDCS
      * Move non-key fields to @AMCPKA
     C                     Z-ADDYL0001    WBJPA1           BB Head Killd S
     C                     Z-ADDYL0002    WBJLA1           BB Head Count S
     C                     Z-ADDWDIHPC    WBIHPC           BB Pct Broken S
     C                     Z-ADDWDJQA1    WBJQA1           BB Head Killd S
     C                     Z-ADDWDJOA1    WBJOA1           BB Head Count S
     C                     Z-ADDWDIIPC    WBIIPC           BB Pct Broken S
      *
      * Set PGM.*Record Data Changed flag
     C           QPLAM1    IFNE YBRDCS
     C           YBRDC     ANDNE'N'
     C                     MOVE 'Y'       YBRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AMCPKA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YCRDC   1
      *
      * Move key fields to @AMCPKA
     C                     Z-ADDWDJMA1    WBJMA1           BB Min Wgt
     C                     Z-ADDWDJNA1    WBJNA1           BB Max Wgt
      *
     C           KLCHSF    KLIST
     C                     KFLD           WBJMA1           BB Min Wgt
     C                     KFLD           WBJNA1           BB Max Wgt
     C           KLCHSF    CHAIN@AMCPKA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAMCPL0'MDACP
     C                     MOVEL'@AMCPKA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL003.
     C                     MOVEL'LBL003'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SFEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPLAM1    YCRDCS
      * Move non-key fields to @AMCPKA
     C                     Z-ADDWDJPA1    WBJPA1           BB Head Killd S
     C                     Z-ADDWDJLA1    WBJLA1           BB Head Count S
     C                     Z-ADDWDIHPC    WBIHPC           BB Pct Broken S
     C                     Z-ADDYL0003    WBJQA1           BB Head Killd S
     C                     Z-ADDYL0004    WBJOA1           BB Head Count S
     C                     Z-ADDWDIIPC    WBIIPC           BB Pct Broken S
      *
      * Set PGM.*Record Data Changed flag
     C           QPLAM1    IFNE YCRDCS
     C           YCRDC     ANDNE'N'
     C                     MOVE 'Y'       YCRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@AMCPKA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Rtv Clc Pcts          RT - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Establish starting position
     C           *LOVAL    SETLL@AMCPKB                    *
     C                     READ @AMCPKB                  90*
      * Data record not found
     C   90                MOVEL'PRK1091' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * CASE: DB1.BB Head Killd Shift 1 is GT Zero
     C           WAJPA1    IFGT 0                          *IF
      * LCL.BB Pct Broken Shift 1 =
      *    *COMPUTE ((x1 / x2)* x3)
      * x1    : DB1.BB Head Count Shift 1
      * /     : LCL.BB Pct Broken Shift 1 = DB1.BB Head Count Shift 1 / D
      * x2    : DB1.BB Head Killd Shift 1
      * *     : PGM.*Synon (17,7) work field *
      * x3    : CON.100
     C           WAJLA1    DIV  WAJPA1    YL0005           BB Pct Broken S
     C           YL0005    MULT 100       W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    YL0005           BB Pct Broken S
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     YL0005           BB Pct Broken S
     C                     END                             *FI
      * CASE: DB1.BB Head Killd Shift 2 is GT Zero
     C           WAJQA1    IFGT 0                          *IF
      * LCL.BB Pct Broken Shift 2 =
      *    *COMPUTE ((x1 / x2) *x3)
      * x1    : DB1.BB Head Count Shift 2
      * /     : LCL.BB Pct Broken Shift 2 = DB1.BB Head Count Shift 2 / D
      * x2    : DB1.BB Head Killd Shift 2
      * *     : PGM.*Synon (17,7) work field *
      * x3    : CON.100
     C           WAJOA1    DIV  WAJQA1    YL0006           BB Pct Broken S
     C           YL0006    MULT 100       W0WD00           *Synon (17,7) w
     C                     Z-ADDW0WD00    YL0006           BB Pct Broken S
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     YL0006           BB Pct Broken S
     C                     END                             *FI
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
     C                     EXSR SHCHRC
     C                     READ @AMCPKB                  90*
     C                     ENDDO
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Change W002 Broken Back W - W002 Broken Back Wgt Rng  * 
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE *BLANK    YDRDC   1
      *
      * Move key fields to @AMCPKA
     C                     Z-ADDWAJMA1    WBJMA1           BB Min Wgt
     C                     Z-ADDWAJNA1    WBJNA1           BB Max Wgt
      *
     C           KLCHSH    KLIST
     C                     KFLD           WBJMA1           BB Min Wgt
     C                     KFLD           WBJNA1           BB Max Wgt
     C           KLCHSH    CHAIN@AMCPKA              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
     C                     MOVEL##PGM     MDPGM
     C                     MOVEL'PLAMCPL0'MDACP
     C                     MOVEL'@AMCPKA' MDFMT
     C                     MOVEL'*CHG'    MDACT
      * Record not found label: LBL004.
     C                     MOVEL'LBL004'  MDLBL
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELMD0009    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   MD0009
     C                     GOTO SHEXIT
     C                     ENDIF
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     ENDIF
      *
      * Store record data for null update check
     C                     MOVE QPLAM1    YDRDCS
      * Move non-key fields to @AMCPKA
     C                     Z-ADDWAJPA1    WBJPA1           BB Head Killd S
     C                     Z-ADDWAJLA1    WBJLA1           BB Head Count S
     C                     Z-ADDYL0005    WBIHPC           BB Pct Broken S
     C                     Z-ADDWAJQA1    WBJQA1           BB Head Killd S
     C                     Z-ADDWAJOA1    WBJOA1           BB Head Count S
     C                     Z-ADDYL0006    WBIIPC           BB Pct Broken S
      *
      * Set PGM.*Record Data Changed flag
     C           QPLAM1    IFNE YDRDCS
     C           YDRDC     ANDNE'N'
     C                     MOVE 'Y'       YDRDC
     C                     ENDIF
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AMCPKA                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKPLAMCPL0               91  *
     C                     ENDIF
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     ENDIF
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA           Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Clear all neither parameters
     C                     Z-ADD*ZERO     P3B3DT           Date From USR
     C                     Z-ADD*ZERO     P4B4DT           Date To   USR
      *
      * Retrieve job attributes
     C                     CALL 'Y2RTJCR'
     C                     PARM           PGMDS
      * Setup job date/time
     C                     Z-ADD##SD7     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Month Alpha USR
     C                     MOVEL*BLANK    WUP0TX  2
      * Define work field Day Alpha USR
     C                     MOVEL*BLANK    WUP7TX  2
      * Define work field Year 2 USR
     C                     MOVEL*BLANK    WUIPNB  2
      * Define work field Cen + Yr USR
     C                     MOVEL*BLANK    WUC0CD  3
      * Define work field Cen + Yr + Mo USR
     C                     MOVEL*BLANK    WUC1CD  5
      * Define work field Cen + Yr + Mo + Dy USR
     C                     MOVEL*BLANK    WUC2CD  7
      * Define work field CC Company Number
     C                     Z-ADD*ZERO     WUHONB  30
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WAJMA1           BB Min Wgt
     C                     Z-ADD*ZERO     WAJNA1           BB Max Wgt
     C                     Z-ADD*ZERO     WAJPA1           BB Head Killd S
     C                     Z-ADD*ZERO     WAJLA1           BB Head Count S
     C                     Z-ADD*ZERO     WAIHPC           BB Pct Broken S
     C                     Z-ADD*ZERO     WAJQA1           BB Head Killd S
     C                     Z-ADD*ZERO     WAJOA1           BB Head Count S
     C                     Z-ADD*ZERO     WAIIPC           BB Pct Broken S
      * Initialize renamed input format fields
     C                     Z-ADD*ZERO     WCHMNB           BOH Company Num
     C                     Z-ADD*ZERO     WCBNNB           BOH Buy Order N
     C                     Z-ADD*ZERO     WCBONB           BOL Load Number
     C                     Z-ADD*ZERO     WCCVNB           TH Tattoo Numbe
     C                     Z-ADD*ZERO     WCB0DT           TH Kill Date
     C                     Z-ADD*ZERO     WCLGNB           CD Scale Sequen
     C                     Z-ADD*ZERO     WCEUNB           CD Carcass Numb
     C                     Z-ADD*ZERO     WCLHNB           CD Carcass Numb
     C                     Z-ADD*ZERO     WCBEPR           CD Sort Loss
     C                     Z-ADD*ZERO     WCASPC           CD STD Yield
     C                     Z-ADD*ZERO     WCEWNB           CD Carcass/Hot
     C                     Z-ADD*ZERO     WCB4PR           CD Base Carcass
     C                     Z-ADD*ZERO     WCEYNB           CD Crc Value Pe
     C                     Z-ADD*ZERO     WCB1PR           CD Base Carc Va
     C                     Z-ADD*ZERO     WCAVPR           CD Crc Value $
     C                     Z-ADD*ZERO     WCAUPC           CD Lean Percent
     C                     Z-ADD*ZERO     WCAWPR           CD Lean Premium
     C                     Z-ADD*ZERO     WCAXPR           CD Lean Premium
     C                     Z-ADD*ZERO     WCEZNB           CD Gross Value
     C                     Z-ADD*ZERO     WCAYPR           CD Gross Value
     C                     Z-ADD*ZERO     WCBBDT           CD Kill Date
     C                     Z-ADD*ZERO     WCAKTM           CD Kill Time
     C                     Z-ADD*ZERO     WCH6NB           CD Backfat Thic
     C                     Z-ADD*ZERO     WCBEPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WCGCST           CD Light Reflec
     C                     Z-ADD*ZERO     WCBHPC           CD FFLI
     C                     Z-ADD*ZERO     WCLTNB           CD LOT
     C                     Z-ADD*ZERO     WCX4NB           CD Backfat Thic
     C                     Z-ADD*ZERO     WCFNPC           CD Loin-Eye Dep
     C                     Z-ADD*ZERO     WCFOPC           CD Light Reflec
     C                     Z-ADD*ZERO     WCFPPC           CD Lean Percent
     C                     Z-ADD*ZERO     WCJWPR           CD CA Sort Loss
     C                     Z-ADD*ZERO     WCF5PC           CD CA Std Yield
     C                     Z-ADD*ZERO     WCJXPR           CD CA Base Carc
     C                     Z-ADD*ZERO     WCJYPR           CD CA Crc Value
     C                     Z-ADD*ZERO     WCJZPR           CD CA Base Carc
     C                     Z-ADD*ZERO     WCJ0PR           CD CA Crc Value
     C                     Z-ADD*ZERO     WCJ1PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     WCJ2PR           CD CA Lean Prem
     C                     Z-ADD*ZERO     WCJ3PR           CD CA Gross Val
     C                     Z-ADD*ZERO     WCJ4PR           CD CA Gross Val
     C                     Z-ADD*ZERO     WCDKJR           CD Loin Eye Inc
     C                     Z-ADD*ZERO     WCITJF           CD Backfat Inch
     C                     Z-ADD*ZERO     WCIJGR           CD Meat Value F
     C                     Z-ADD*ZERO     WCORJE           CD Lean Prem/Di
     C                     Z-ADD*ZERO     WCOTJR           CD Fixed Cost F
     C                     Z-ADD*ZERO     WCPEIR           CD MPR Sort Los
     C                     Z-ADD*ZERO     WCIEUF           CD Meat Value F
     C                     Z-ADD*ZERO     WCORUE           CD Fixed Cost F
     C                     Z-ADD*ZERO     WCIUTR           CD Gross Before
     C                     Z-ADD*ZERO     WCIJRR           CD Gross Before
     C                     Z-ADD*ZERO     WCAADT           RS Date Changed
     C                     Z-ADD*ZERO     WCAMTM           RS Time Changed
     C                     Z-ADD*ZERO     WCABDT           RS Date Added
     C                     Z-ADD*ZERO     WCABTM           RS Time Added
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    W0WD00 177       *Synon (17,7) w
     C                     MOVEL'N'       W0PMT   1
      * Define local work field BB Head Killd Shift 1
     C                     Z-ADD*ZERO     YL0001  90
      * Define local work field BB Head Count Shift 1
     C                     Z-ADD*ZERO     YL0002  90
      * Define local work field BB Head Killd Shift 2
     C                     Z-ADD*ZERO     YL0003  90
      * Define local work field BB Head Count Shift 2
     C                     Z-ADD*ZERO     YL0004  90
      * Define local work field BB Pct Broken Shift 1
     C                     Z-ADD*ZERO     YL0005  74
      * Define local work field BB Pct Broken Shift 2
     C                     Z-ADD*ZERO     YL0006  74
      *================================================================
     CSR         ZZEXIT    ENDSR
