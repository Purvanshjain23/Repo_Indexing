/****************************************************************/
/*  PROGRAM NAME:  PMI3UPR                                      */
/*  DESCRIPTION :  RECEIVE UMB LOCKBOX FILE                     */
/*                 THE LOCKBOX WILL BE UPLOADED FROM UMB        */
/*                 SERVER.                                      */
/*                                                              */
/*  CREATED     :  SHARON ZURN     06/27/07                     */
/*  MODIFIED    :  BARB GUTIERREZ  05/24/10                     */
/*                 MIGRATING TO BANK OF NEW YORK FOR LOCKBOX    */
/*                 PROCESSING.  NEED TO KEEP CURRENT UMB        */
/*                 PROCESSING IN TACT UNTIL WE KNOW IT HAS BEEN */
/*                 TURNED OFF AT THE BANK.                      */
/*                                                              */
/*                 THIS CL WAS ONLY UTILIZED BY DAILYS PREMIUM  */
/*                 MEATS.  NOW SEABOARD FOODS WILL ALSO USE IT. */
/*                                                              */
/*                 ALSO, DAILYS LOCKBOXES ARE NOW GOING TO BE   */
/*                 COMBINED INTO ONE INSTEAD OF INDIVIDUAL FOR  */
/*                 EACH COMPANY.                                */
/*                                                              */
/*  MODIFIED    :  BARB GUTIERREZ  07/08/10                     */
/*                 ENHANCED PROCESS BY:                         */
/*                -CLEARING THE XXLCKBOX FILE PRIOR TO THE      */
/*                 PROCESS STARTING FOR BNY FILES.  WHERE XX IS */
/*                 THE LOCATION BEING PROCESSED.                */
/*                -IF NO FILE PICKED UP FROM THE BANK, SEND     */
/*                 MESSAGE TO THE USER THAT NOTHING WAS         */
/*                 AVAILABLE AND DON'T ATTEMPT TO PROCESS.      */
/*                -IF ANY CONNECTION ERRORS, SEND MESSAGE TO    */
/*                 USER TO CONTACT IT.                          */
/*                                                              */
/*  MODIFIED    :  BARB GUTIERREZ  02/12/18                     */
/*                 BNYM is mandating we switch from FTP over    */
/*                 the VPN to SFTP over the internet.  The      */
/*                 AS/400 doesn't work well with SFTP so we are */
/*                 going to utilize Informatica to pick up the  */
/*                 Lockbox from BNYM and push it to the AS/400. */
/*                 Informatica will then execute this program   */
/*                 instead of it running on the AS/400 job      */
/*                 scheduler.  E012064                          */
/*                                                              */
/****************************************************************/
             PGM        PARM(&LOC &FILE &SYS)

             DCL        VAR(&LOC) TYPE(*CHAR) LEN(2)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&LIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&QRYSLT) TYPE(*CHAR) LEN(35)
             DCL        VAR(&UPLDFILE) TYPE(*CHAR) LEN(28) /*FILE +
                          NAME*/
             DCL        VAR(&DIST) TYPE(*CHAR) LEN(10)
             DCL        VAR(&SYS) TYPE(*CHAR) LEN(1)

 /*      Begin Obsolete    */
 /*   Obsolete - only used on the FTP command which is no  */
 /*   longer being executed from the AS/400                */

 /*THIS USER ID IS ONLY USED WHEN TESTING WITH BNY         */

 /*          DCL        VAR(&TESTUSR) TYPE(*CHAR) LEN(8) +
                          VALUE('SEABR2TS')       */
 /*PROD FILE USER ID FOR BNY                               */

 /*          DCL        VAR(&PRODUSR) TYPE(*CHAR) LEN(8) +
                          VALUE('SEABR2AL')    */
 /*      End Obsolete    */

 /* UMB LOCKBOXES.. */     /* UMB is obsolete  */

/*           DCL        VAR(&SLF) TYPE(*CHAR) LEN(28) +
                          VALUE('LBX.LBX0350.SEABOARD.LKBXSLC')     */

/*           DCL        VAR(&MTF) TYPE(*CHAR) LEN(28) +
                          VALUE('LBX.LBX0350.SEABOARD.LKBXMMT')     */

 /* BNY LOCKBOXES.. */

             DCL        VAR(&PDV) TYPE(*CHAR) LEN(28) +
                          VALUE('LCKBXPRK')

/*           DCL        VAR(&DPM) TYPE(*CHAR) LEN(28) +
                          VALUE('LCKBXDPM')                    */

          /*---------------------------------------------------*/
          /*    INFORMATICA REQUIRES US TO SET THE LIBL      */
          /*---------------------------------------------------*/

/*  If running in production, set to production, else test.      */

             IF         COND(&SYS = 'P') +
                          THEN(DO)
             SETLIBL    JOBD(PRKPRDGUY)
             ENDDO
             ELSE       CMD(DO)        /*  running in test     */
             SETLIBL    JOBD(PRKINTT)
             ADDLIBLE   LIB(OMSDEVGEN) POSITION(*LAST)
             ENDDO

          /*---------------------------------------------------*/
          /*    SET UP THE DESTINATION LOCKBOX FILE NAME       */
          /*---------------------------------------------------*/
/*  Obsolete -   Informatica passing in the file now  */

/*           CHGVAR     VAR(&FILE) VALUE(&LOC *TCAT 'LCKBOX')    */

          /*---------------------------------------------------*/
          /*    GET LIBRARY OF FILE                            */
         /*----------------------------------------------------*/
/*  Obsolete -   &lib is only used on FTP command which is not being */
/*               on the AS/400 now.                                  */
/*           RTVOBJD    OBJ(&FILE) OBJTYPE(*FILE) RTNLIB(&LIB)   */

          /*---------------------------------------------------*/
          /*    SET UP THE RETRIEVED LOCKBOX FILE NAME AND     */
          /*    DISTRIBUTION LIST                              */
          /*---------------------------------------------------*/

 /* UMB LOCKBOXES.. */  /* Obsolete */

 /*          IF         (&LOC  *EQ 'SL')  THEN(DO)  */
 /*          CHGVAR     VAR(&UPLDFILE) VALUE(&SLF)  */
 /*          ENDDO                                  */

 /*          IF         (&LOC  *EQ 'MT')  THEN(DO)  */
 /*          CHGVAR     VAR(&UPLDFILE) VALUE(&MTF)  */
 /*          ENDDO                                  */

 /* BNY LOCKBOXES.. */   /*  Moved clear of PDLCKBOX to end of pgm. */
                         /*  Informatica is sending this file to us */
                         /*  so we don't want to clear before we    */
                         /*  process it. We want it cleared before  */
                         /*  the next run though.                   */

             IF         (&LOC  *EQ 'PD')  THEN(DO)
/*           CLRPFM     FILE(PDLCKBOX)                     */
             CHGVAR     VAR(&UPLDFILE) VALUE(&PDV)
             CHGVAR     VAR(&DIST) VALUE('PDVLCKBX')
             ENDDO

 /*  Dailys is in M3 now.                                     */
 /*          IF         (&LOC  *EQ 'DF')  THEN(DO)            */
 /*          CLRPFM     FILE(DFLCKBOX)                        */
 /*          CHGVAR     VAR(&UPLDFILE) VALUE(&DPM)            */
 /*          CHGVAR     VAR(&DIST) VALUE('DPMLCKBX')          */
 /*          ENDDO                                            */

 /*  FTP logic is obsolete now that Informatica is picking up file */
                /*------------------------------------------*/
                /* ADD FTP REMOTE LIBRARY FOR COMMANDS      */
                /*------------------------------------------*/
 /*          ADDLIBLE   LIB(FTP_REMOTE) POSITION(*LAST)         */
 /*          MONMSG     MSGID(CPF0000)                          */

                /*------------------------------------------*/
                /*  FTP GET THE FILE FROM UMB            */
                /*------------------------------------------*/

/*           IF         ((&LOC *EQ 'SL')  *OR (&LOC *EQ 'MT')) THEN(DO)  */

/*           CHGVAR     VAR(%SST(&QRYSLT 1 1)) VALUE('"')                */
/*           CHGVAR     VAR(%SST(&QRYSLT 2 1)) VALUE('''')               */
/*           CHGVAR     VAR(%SST(&QRYSLT 3 28)) VALUE(&UPLDFILE)         */
/*           CHGVAR     VAR(%SST(&QRYSLT 31 1)) VALUE('''')              */
/*           CHGVAR     VAR(%SST(&QRYSLT 32 1)) VALUE('"')               */

/*           FTP_LOC2   FUNCTION(*RECEIVE) IFILE(&QRYSLT) +
                          HFILE(&LIB/&FILE) HMBR(*FIRST) +
                          USERBLEN(*YES) RECLEN(80) BLKLEN(27840) +
                          URL('198.176.221.9') USER('KC98T29') +
                          PASS('XJL6RVWG') ASCII(*NO)                    */
/*           MONMSG     MSGID(CPF0000)                                   */
/*           ENDDO                                                       */

                /*------------------------------------------*/
                /*  Informatica is now picking up the    */
                /*  file from BNYM.                      */
                /*  FTP GET THE FILE FROM BNY            */
                /*------------------------------------------*/

/*           IF         ((&LOC *EQ 'PD') *OR (&LOC *EQ 'DF'))  THEN(DO)  */

/*USE THIS *RECEIVE FOR TESTING  */

/*           FTP_LOC2   FUNCTION(*RECEIVE) IFILE(&UPLDFILE) +
                          HFILE(&LIB/&FILE) HMBR(*FIRST) +
                          USERBLEN(*NO) URL('FTPSERVV.MELLON.COM') +
                          USER(&TESTUSR) PASS('F00T6ATH') ASCII(*YES) */

/*USE THIS *RECEIVE FOR PRODUCTION   */

/*           FTP_LOC2   FUNCTION(*RECEIVE) IFILE(&UPLDFILE) +
                          HFILE(&LIB/&FILE) HMBR(*FIRST) +
                          USERBLEN(*NO) URL('FTPSERVV.MELLON.COM') +
                          USER(&PRODUSR) PASS('L8CROS53') ASCII(*YES)    */

/*IF NO CONNECTION MADE  */

/*           MONMSG     MSGID(FTP1000) EXEC(DO)                       */

/*           SNDPGRMSG  TOPGR(&DIST) MSG(&FILE *BCAT ' - FTP +
                          error.  File not retrieved.  Contact IT +
                          for support.') CONFMSG(*NO)                 */
/*           GOTO CMDLBL(END)  */
/*           ENDDO             */

/*IF MADE CONNECTION BUT NO FILE FOUND ON FTP SITE */

/*           MONMSG     MSGID(FTP2000) EXEC(DO)                       */

/*           SNDPGRMSG  TOPGR(&DIST) MSG(&FILE *BCAT ' - No   +
                          checks to be retrieved.') CONFMSG(*NO)     */
/*           GOTO CMDLBL(END)                                        */
/*           ENDDO                                                   */

/*           ENDDO                                                   */

/*VALIDATE LOCKBOX */

             CALL       PGM(POJAUPC) PARM(&LOC &FILE)

/*Clear file ready for the next run */

             CLRPFM     FILE(PDLCKBOX)

END:         ENDPGM
