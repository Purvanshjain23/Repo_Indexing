// ?------------------------------------------------------------------------------------------------
// ?Synon action diagram for PPY3PVR
// ?Date: 14.08.2025 Time: 03:42:24
// ?------------------------------------------------------------------------------------------------

//?USER: Process command keys

CASE;

// IF DTL.*CMD key is *Exit
IF DTL.*CMD_key = '03';

PGM.*Return_code = 'Y2U9999';

RETURN;

ENDIF;

//?USER: User defined action

//?Update is a go
CASE;

// IF DTL.Status Flag 1  Y/N is Yes
IF DTL.Status_Flag_1_Y_N = 'Y';

EXECUTE FUNCTION(EXC Chg On Reason-New  IF) TYPE(EXCINTFUN)                     AC1785144;
{
 //?Execute internal function

 // WRK.Load ID = CON.1
 WRK.Load_ID = 1;

 EXECUTE FUNCTION(Rtv/Chg On Reason-New  RT) TYPE(RTVOBJ) FILE(OMFJCPP)          AC1510334;
 PARAMETER(WRK.Load_ID);
 {
  //?USER: Process Data record

  CASE;

  // IF DB1.Load Held Over Reason is *Not Blank
  IF DB1.Load_Held_Over_Reason = 'P'/'S'/'T'/'K'/'M'/'O'/'I';

  EXECUTE FUNCTION(CHG Load On Time flag  CH) TYPE(CHGOBJ) FILE(OMFJCPP)          AC1510313;
  PARAMETER(DB1.Load_ID);
  PARAMETER(DB1.Load_Held_Over_Reason);
  PARAMETER(DB1.Load_Held_Over_Rsn_Cmt);
  PARAMETER(DB1.LH_Held_Over_Rsn_Cmt);
  PARAMETER(DB1.LH_Held_Over_Reason);
  {
   //?USER: Processing before Data update

   //?** 09/20/2006 LJB PK0036
   //?** Convert the new 3 char heldover reason code
   CASE;

   // IF PAR.Load Held Over Reason is Mechanical
   IF PAR.Load_Held_Over_Reason = 'M';

   // DB1.LH Held Over Reason = CND.SB Mechanical
   DB1.LH_Held_Over_Reason = 'TME';

   //?** Convert the new 3 char heldover reason code
   // IF PAR.Load Held Over Reason is Shipping Error
   IF PAR.Load_Held_Over_Reason = 'I';

   // DB1.LH Held Over Reason = CND.SB Shipping
   DB1.LH_Held_Over_Reason = 'SHP';

   //?** Convert the new 3 char heldover reason code
   // IF PAR.Load Held Over Reason is Trailer Unavailable
   IF PAR.Load_Held_Over_Reason = 'K';

   // DB1.LH Held Over Reason = CND.SB Trailer Unavail
   DB1.LH_Held_Over_Reason = 'TRU';

   //?** Convert the new 3 char heldover reason code
   // IF PAR.Load Held Over Reason is Overbooked Ld Cap/Time
   IF PAR.Load_Held_Over_Reason = 'T';

   // DB1.LH Held Over Reason = CND.SB Overbooked
   DB1.LH_Held_Over_Reason = 'LPU';

   //?** Convert the new 3 char heldover reason code
   // IF PAR.Load Held Over Reason is Other
   IF PAR.Load_Held_Over_Reason = 'O';

   // DB1.LH Held Over Reason = CND.SB Other
   DB1.LH_Held_Over_Reason = 'PRD';

   //?** Convert the new 3 char heldover reason code
   // IF PAR.Load Held Over Reason is Product/Sched Error
   IF PAR.Load_Held_Over_Reason = 'P';

   // DB1.LH Held Over Reason = CND.SB Product/Sch
   DB1.LH_Held_Over_Reason = 'SCH';

   //?** Convert the new 3 char heldover reason code
   // IF DB1.Load Held Over Reason is Sales
   IF DB1.Load_Held_Over_Reason = 'S';

   CASE;

   // IF DB1.Load U/M is Box
   IF DB1.Load_U_M = 'BX';

   // DB1.LH Held Over Reason = CND.SB Sales
   DB1.LH_Held_Over_Reason = 'SAR';

   // IF *OTHERWISE
   IF *OTHERWISE;

   // DB1.LH Held Over Reason = CND.V
   DB1.LH_Held_Over_Reason = 'SAP';

   ENDIF;

   ENDIF;

   //?** Put 15 char comment into new 25 char field
   // DB1.LH Held Over Rsn Cmt = PAR.Load Held Over Rsn Cmt
   DB1.LH_Held_Over_Rsn_Cmt = PAR.Load_Held_Over_Rsn_Cmt;

   EXECUTE FUNCTION(Set Record Stamp CHGOB IF) TYPE(EXCINTFUN)                     AC1283156;
   PARAMETER(DB1.Job_Time);
   PARAMETER(DB1.User_Id);
   PARAMETER(DB1.Job_Name);
   PARAMETER(DB1.Job_Date);
   {
    //?Execute internal function

    // PAR.Job Time = JOB.*Job time
    PAR.Job_Time = JOB.*Job_time;

    // PAR.User Id = JOB.*USER
    PAR.User_Id = JOB.*USER;

    // PAR.Job Name = JOB.*PROGRAM
    PAR.Job_Name = JOB.*PROGRAM;

    // PAR.Job Date = JOB.*Job date
    PAR.Job_Date = JOB.*Job_date;

   }

  }

  ENDIF;

 }

}


ENDIF;

